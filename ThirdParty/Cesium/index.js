/**
 * @license
 * Cesium - https://github.com/CesiumGS/cesium
 * Version 1.123
 *
 * Copyright 2011-2022 Cesium Contributors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * Columbus View (Pat. Pend.)
 *
 * Portions licensed separately.
 * See https://github.com/CesiumGS/cesium/blob/main/LICENSE.md for full licensing details.
 */

var cAe=Object.create;var L$=Object.defineProperty;var lAe=Object.getOwnPropertyDescriptor;var uAe=Object.getOwnPropertyNames;var fAe=Object.getPrototypeOf,dAe=Object.prototype.hasOwnProperty;var VP=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(t,n)=>(typeof require<"u"?require:t)[n]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')});var vu=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var hAe=(e,t,n,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of uAe(t))!dAe.call(e,o)&&o!==n&&L$(e,o,{get:()=>t[o],enumerable:!(i=lAe(t,o))||i.enumerable});return e};var Ur=(e,t,n)=>(n=e!=null?cAe(fAe(e)):{},hAe(t||!e||!e.__esModule?L$(n,"default",{value:e,enumerable:!0}):n,e));var UP=vu((oSt,F$)=>{var ym=function(e){e==null&&(e=new Date().getTime()),this.N=624,this.M=397,this.MATRIX_A=2567483615,this.UPPER_MASK=2147483648,this.LOWER_MASK=2147483647,this.mt=new Array(this.N),this.mti=this.N+1,e.constructor==Array?this.init_by_array(e,e.length):this.init_seed(e)};ym.prototype.init_seed=function(e){for(this.mt[0]=e>>>0,this.mti=1;this.mti<this.N;this.mti++){var e=this.mt[this.mti-1]^this.mt[this.mti-1]>>>30;this.mt[this.mti]=(((e&4294901760)>>>16)*1812433253<<16)+(e&65535)*1812433253+this.mti,this.mt[this.mti]>>>=0}};ym.prototype.init_by_array=function(e,t){var n,i,o;for(this.init_seed(19650218),n=1,i=0,o=this.N>t?this.N:t;o;o--){var r=this.mt[n-1]^this.mt[n-1]>>>30;this.mt[n]=(this.mt[n]^(((r&4294901760)>>>16)*1664525<<16)+(r&65535)*1664525)+e[i]+i,this.mt[n]>>>=0,n++,i++,n>=this.N&&(this.mt[0]=this.mt[this.N-1],n=1),i>=t&&(i=0)}for(o=this.N-1;o;o--){var r=this.mt[n-1]^this.mt[n-1]>>>30;this.mt[n]=(this.mt[n]^(((r&4294901760)>>>16)*1566083941<<16)+(r&65535)*1566083941)-n,this.mt[n]>>>=0,n++,n>=this.N&&(this.mt[0]=this.mt[this.N-1],n=1)}this.mt[0]=2147483648};ym.prototype.random_int=function(){var e,t=new Array(0,this.MATRIX_A);if(this.mti>=this.N){var n;for(this.mti==this.N+1&&this.init_seed(5489),n=0;n<this.N-this.M;n++)e=this.mt[n]&this.UPPER_MASK|this.mt[n+1]&this.LOWER_MASK,this.mt[n]=this.mt[n+this.M]^e>>>1^t[e&1];for(;n<this.N-1;n++)e=this.mt[n]&this.UPPER_MASK|this.mt[n+1]&this.LOWER_MASK,this.mt[n]=this.mt[n+(this.M-this.N)]^e>>>1^t[e&1];e=this.mt[this.N-1]&this.UPPER_MASK|this.mt[0]&this.LOWER_MASK,this.mt[this.N-1]=this.mt[this.M-1]^e>>>1^t[e&1],this.mti=0}return e=this.mt[this.mti++],e^=e>>>11,e^=e<<7&2636928640,e^=e<<15&4022730752,e^=e>>>18,e>>>0};ym.prototype.random_int31=function(){return this.random_int()>>>1};ym.prototype.random_incl=function(){return this.random_int()*(1/4294967295)};ym.prototype.random=function(){return this.random_int()*(1/4294967296)};ym.prototype.random_excl=function(){return(this.random_int()+.5)*(1/4294967296)};ym.prototype.random_long=function(){var e=this.random_int()>>>5,t=this.random_int()>>>6;return(e*67108864+t)*(1/9007199254740992)};F$.exports=ym});var K$=vu((Cx,Ex)=>{/*! https://mths.be/punycode v1.4.0 by @mathias */(function(e){var t=typeof Cx=="object"&&Cx&&!Cx.nodeType&&Cx,n=typeof Ex=="object"&&Ex&&!Ex.nodeType&&Ex,i=typeof global=="object"&&global;(i.global===i||i.window===i||i.self===i)&&(e=i);var o,r=2147483647,s=36,a=1,l=26,u=38,f=700,d=72,p=128,g="-",m=/^xn--/,b=/[^\x20-\x7E]/,x=/[\x2E\u3002\uFF0E\uFF61]/g,T={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},C=s-a,S=Math.floor,v=String.fromCharCode,D;function I(z){throw new RangeError(T[z])}function L(z,W){for(var U=z.length,q=[];U--;)q[U]=W(z[U]);return q}function M(z,W){var U=z.split("@"),q="";U.length>1&&(q=U[0]+"@",z=U[1]),z=z.replace(x,".");var K=z.split("."),te=L(K,W).join(".");return q+te}function N(z){for(var W=[],U=0,q=z.length,K,te;U<q;)K=z.charCodeAt(U++),K>=55296&&K<=56319&&U<q?(te=z.charCodeAt(U++),(te&64512)==56320?W.push(((K&1023)<<10)+(te&1023)+65536):(W.push(K),U--)):W.push(K);return W}function B(z){return L(z,function(W){var U="";return W>65535&&(W-=65536,U+=v(W>>>10&1023|55296),W=56320|W&1023),U+=v(W),U}).join("")}function _(z){return z-48<10?z-22:z-65<26?z-65:z-97<26?z-97:s}function w(z,W){return z+22+75*(z<26)-((W!=0)<<5)}function P(z,W,U){var q=0;for(z=U?S(z/f):z>>1,z+=S(z/W);z>C*l>>1;q+=s)z=S(z/C);return S(q+(C+1)*z/(z+u))}function O(z){var W=[],U=z.length,q,K=0,te=p,Y=d,Z,ee,me,be,le,ge,xe,Pe,Ee;for(Z=z.lastIndexOf(g),Z<0&&(Z=0),ee=0;ee<Z;++ee)z.charCodeAt(ee)>=128&&I("not-basic"),W.push(z.charCodeAt(ee));for(me=Z>0?Z+1:0;me<U;){for(be=K,le=1,ge=s;me>=U&&I("invalid-input"),xe=_(z.charCodeAt(me++)),(xe>=s||xe>S((r-K)/le))&&I("overflow"),K+=xe*le,Pe=ge<=Y?a:ge>=Y+l?l:ge-Y,!(xe<Pe);ge+=s)Ee=s-Pe,le>S(r/Ee)&&I("overflow"),le*=Ee;q=W.length+1,Y=P(K-be,q,be==0),S(K/q)>r-te&&I("overflow"),te+=S(K/q),K%=q,W.splice(K++,0,te)}return B(W)}function F(z){var W,U,q,K,te,Y,Z,ee,me,be,le,ge=[],xe,Pe,Ee,Ue;for(z=N(z),xe=z.length,W=p,U=0,te=d,Y=0;Y<xe;++Y)le=z[Y],le<128&&ge.push(v(le));for(q=K=ge.length,K&&ge.push(g);q<xe;){for(Z=r,Y=0;Y<xe;++Y)le=z[Y],le>=W&&le<Z&&(Z=le);for(Pe=q+1,Z-W>S((r-U)/Pe)&&I("overflow"),U+=(Z-W)*Pe,W=Z,Y=0;Y<xe;++Y)if(le=z[Y],le<W&&++U>r&&I("overflow"),le==W){for(ee=U,me=s;be=me<=te?a:me>=te+l?l:me-te,!(ee<be);me+=s)Ue=ee-be,Ee=s-be,ge.push(v(w(be+Ue%Ee,0))),ee=S(Ue/Ee);ge.push(v(w(ee,0))),te=P(U,Pe,q==K),U=0,++q}++U,++W}return ge.join("")}function V(z){return M(z,function(W){return m.test(W)?O(W.slice(4).toLowerCase()):W})}function G(z){return M(z,function(W){return b.test(W)?"xn--"+F(W):W})}if(o={version:"1.3.2",ucs2:{decode:N,encode:B},decode:O,encode:F,toASCII:G,toUnicode:V},typeof define=="function"&&typeof define.amd=="object"&&define.amd)define("punycode",function(){return o});else if(t&&n)if(Ex.exports==t)n.exports=o;else for(D in o)o.hasOwnProperty(D)&&(t[D]=o[D]);else e.punycode=o})(Cx)});var Z$=vu(($$,ZP)=>{/*!
 * URI.js - Mutating URLs
 * IPv6 Support
 *
 * Version: 1.19.11
 *
 * Author: Rodney Rehm
 * Web: http://medialize.github.io/URI.js/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *
 */(function(e,t){"use strict";typeof ZP=="object"&&ZP.exports?ZP.exports=t():typeof define=="function"&&define.amd?define(t):e.IPv6=t(e)})($$,function(e){"use strict";var t=e&&e.IPv6;function n(o){var r=o.toLowerCase(),s=r.split(":"),a=s.length,l=8;s[0]===""&&s[1]===""&&s[2]===""?(s.shift(),s.shift()):s[0]===""&&s[1]===""?s.shift():s[a-1]===""&&s[a-2]===""&&s.pop(),a=s.length,s[a-1].indexOf(".")!==-1&&(l=7);var u;for(u=0;u<a&&s[u]!=="";u++);if(u<l)for(s.splice(u,1,"0000");s.length<l;)s.splice(u,0,"0000");for(var f,d=0;d<l;d++){f=s[d].split("");for(var p=0;p<3&&(f[0]==="0"&&f.length>1);p++)f.splice(0,1);s[d]=f.join("")}var g=-1,m=0,b=0,x=-1,T=!1;for(d=0;d<l;d++)T?s[d]==="0"?b+=1:(T=!1,b>m&&(g=x,m=b)):s[d]==="0"&&(T=!0,x=d,b=1);b>m&&(g=x,m=b),m>1&&s.splice(g,m,""),a=s.length;var C="";for(s[0]===""&&(C=":"),d=0;d<a&&(C+=s[d],d!==a-1);d++)C+=":";return s[a-1]===""&&(C+=":"),C}function i(){return e.IPv6===this&&(e.IPv6=t),this}return{best:n,noConflict:i}})});var Q$=vu((J$,JP)=>{/*!
 * URI.js - Mutating URLs
 * Second Level Domain (SLD) Support
 *
 * Version: 1.19.11
 *
 * Author: Rodney Rehm
 * Web: http://medialize.github.io/URI.js/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *
 */(function(e,t){"use strict";typeof JP=="object"&&JP.exports?JP.exports=t():typeof define=="function"&&define.amd?define(t):e.SecondLevelDomains=t(e)})(J$,function(e){"use strict";var t=e&&e.SecondLevelDomains,n={list:{ac:" com gov mil net org ",ae:" ac co gov mil name net org pro sch ",af:" com edu gov net org ",al:" com edu gov mil net org ",ao:" co ed gv it og pb ",ar:" com edu gob gov int mil net org tur ",at:" ac co gv or ",au:" asn com csiro edu gov id net org ",ba:" co com edu gov mil net org rs unbi unmo unsa untz unze ",bb:" biz co com edu gov info net org store tv ",bh:" biz cc com edu gov info net org ",bn:" com edu gov net org ",bo:" com edu gob gov int mil net org tv ",br:" adm adv agr am arq art ato b bio blog bmd cim cng cnt com coop ecn edu eng esp etc eti far flog fm fnd fot fst g12 ggf gov imb ind inf jor jus lel mat med mil mus net nom not ntr odo org ppg pro psc psi qsl rec slg srv tmp trd tur tv vet vlog wiki zlg ",bs:" com edu gov net org ",bz:" du et om ov rg ",ca:" ab bc mb nb nf nl ns nt nu on pe qc sk yk ",ck:" biz co edu gen gov info net org ",cn:" ac ah bj com cq edu fj gd gov gs gx gz ha hb he hi hl hn jl js jx ln mil net nm nx org qh sc sd sh sn sx tj tw xj xz yn zj ",co:" com edu gov mil net nom org ",cr:" ac c co ed fi go or sa ",cy:" ac biz com ekloges gov ltd name net org parliament press pro tm ",do:" art com edu gob gov mil net org sld web ",dz:" art asso com edu gov net org pol ",ec:" com edu fin gov info med mil net org pro ",eg:" com edu eun gov mil name net org sci ",er:" com edu gov ind mil net org rochest w ",es:" com edu gob nom org ",et:" biz com edu gov info name net org ",fj:" ac biz com info mil name net org pro ",fk:" ac co gov net nom org ",fr:" asso com f gouv nom prd presse tm ",gg:" co net org ",gh:" com edu gov mil org ",gn:" ac com gov net org ",gr:" com edu gov mil net org ",gt:" com edu gob ind mil net org ",gu:" com edu gov net org ",hk:" com edu gov idv net org ",hu:" 2000 agrar bolt casino city co erotica erotika film forum games hotel info ingatlan jogasz konyvelo lakas media news org priv reklam sex shop sport suli szex tm tozsde utazas video ",id:" ac co go mil net or sch web ",il:" ac co gov idf k12 muni net org ",in:" ac co edu ernet firm gen gov i ind mil net nic org res ",iq:" com edu gov i mil net org ",ir:" ac co dnssec gov i id net org sch ",it:" edu gov ",je:" co net org ",jo:" com edu gov mil name net org sch ",jp:" ac ad co ed go gr lg ne or ",ke:" ac co go info me mobi ne or sc ",kh:" com edu gov mil net org per ",ki:" biz com de edu gov info mob net org tel ",km:" asso com coop edu gouv k medecin mil nom notaires pharmaciens presse tm veterinaire ",kn:" edu gov net org ",kr:" ac busan chungbuk chungnam co daegu daejeon es gangwon go gwangju gyeongbuk gyeonggi gyeongnam hs incheon jeju jeonbuk jeonnam k kg mil ms ne or pe re sc seoul ulsan ",kw:" com edu gov net org ",ky:" com edu gov net org ",kz:" com edu gov mil net org ",lb:" com edu gov net org ",lk:" assn com edu gov grp hotel int ltd net ngo org sch soc web ",lr:" com edu gov net org ",lv:" asn com conf edu gov id mil net org ",ly:" com edu gov id med net org plc sch ",ma:" ac co gov m net org press ",mc:" asso tm ",me:" ac co edu gov its net org priv ",mg:" com edu gov mil nom org prd tm ",mk:" com edu gov inf name net org pro ",ml:" com edu gov net org presse ",mn:" edu gov org ",mo:" com edu gov net org ",mt:" com edu gov net org ",mv:" aero biz com coop edu gov info int mil museum name net org pro ",mw:" ac co com coop edu gov int museum net org ",mx:" com edu gob net org ",my:" com edu gov mil name net org sch ",nf:" arts com firm info net other per rec store web ",ng:" biz com edu gov mil mobi name net org sch ",ni:" ac co com edu gob mil net nom org ",np:" com edu gov mil net org ",nr:" biz com edu gov info net org ",om:" ac biz co com edu gov med mil museum net org pro sch ",pe:" com edu gob mil net nom org sld ",ph:" com edu gov i mil net ngo org ",pk:" biz com edu fam gob gok gon gop gos gov net org web ",pl:" art bialystok biz com edu gda gdansk gorzow gov info katowice krakow lodz lublin mil net ngo olsztyn org poznan pwr radom slupsk szczecin torun warszawa waw wroc wroclaw zgora ",pr:" ac biz com edu est gov info isla name net org pro prof ",ps:" com edu gov net org plo sec ",pw:" belau co ed go ne or ",ro:" arts com firm info nom nt org rec store tm www ",rs:" ac co edu gov in org ",sb:" com edu gov net org ",sc:" com edu gov net org ",sh:" co com edu gov net nom org ",sl:" com edu gov net org ",st:" co com consulado edu embaixada gov mil net org principe saotome store ",sv:" com edu gob org red ",sz:" ac co org ",tr:" av bbs bel biz com dr edu gen gov info k12 name net org pol tel tsk tv web ",tt:" aero biz cat co com coop edu gov info int jobs mil mobi museum name net org pro tel travel ",tw:" club com ebiz edu game gov idv mil net org ",mu:" ac co com gov net or org ",mz:" ac co edu gov org ",na:" co com ",nz:" ac co cri geek gen govt health iwi maori mil net org parliament school ",pa:" abo ac com edu gob ing med net nom org sld ",pt:" com edu gov int net nome org publ ",py:" com edu gov mil net org ",qa:" com edu gov mil net org ",re:" asso com nom ",ru:" ac adygeya altai amur arkhangelsk astrakhan bashkiria belgorod bir bryansk buryatia cbg chel chelyabinsk chita chukotka chuvashia com dagestan e-burg edu gov grozny int irkutsk ivanovo izhevsk jar joshkar-ola kalmykia kaluga kamchatka karelia kazan kchr kemerovo khabarovsk khakassia khv kirov koenig komi kostroma kranoyarsk kuban kurgan kursk lipetsk magadan mari mari-el marine mil mordovia mosreg msk murmansk nalchik net nnov nov novosibirsk nsk omsk orenburg org oryol penza perm pp pskov ptz rnd ryazan sakhalin samara saratov simbirsk smolensk spb stavropol stv surgut tambov tatarstan tom tomsk tsaritsyn tsk tula tuva tver tyumen udm udmurtia ulan-ude vladikavkaz vladimir vladivostok volgograd vologda voronezh vrn vyatka yakutia yamal yekaterinburg yuzhno-sakhalinsk ",rw:" ac co com edu gouv gov int mil net ",sa:" com edu gov med net org pub sch ",sd:" com edu gov info med net org tv ",se:" a ac b bd c d e f g h i k l m n o org p parti pp press r s t tm u w x y z ",sg:" com edu gov idn net org per ",sn:" art com edu gouv org perso univ ",sy:" com edu gov mil net news org ",th:" ac co go in mi net or ",tj:" ac biz co com edu go gov info int mil name net nic org test web ",tn:" agrinet com defense edunet ens fin gov ind info intl mincom nat net org perso rnrt rns rnu tourism ",tz:" ac co go ne or ",ua:" biz cherkassy chernigov chernovtsy ck cn co com crimea cv dn dnepropetrovsk donetsk dp edu gov if in ivano-frankivsk kh kharkov kherson khmelnitskiy kiev kirovograd km kr ks kv lg lugansk lutsk lviv me mk net nikolaev od odessa org pl poltava pp rovno rv sebastopol sumy te ternopil uzhgorod vinnica vn zaporizhzhe zhitomir zp zt ",ug:" ac co go ne or org sc ",uk:" ac bl british-library co cym gov govt icnet jet lea ltd me mil mod national-library-scotland nel net nhs nic nls org orgn parliament plc police sch scot soc ",us:" dni fed isa kids nsn ",uy:" com edu gub mil net org ",ve:" co com edu gob info mil net org web ",vi:" co com k12 net org ",vn:" ac biz com edu gov health info int name net org pro ",ye:" co com gov ltd me net org plc ",yu:" ac co edu gov org ",za:" ac agric alt bourse city co cybernet db edu gov grondar iaccess imt inca landesign law mil net ngo nis nom olivetti org pix school tm web ",zm:" ac co com edu gov net org sch ",com:"ar br cn de eu gb gr hu jpn kr no qc ru sa se uk us uy za ",net:"gb jp se uk ",org:"ae",de:"com "},has:function(i){var o=i.lastIndexOf(".");if(o<=0||o>=i.length-1)return!1;var r=i.lastIndexOf(".",o-1);if(r<=0||r>=o-1)return!1;var s=n.list[i.slice(o+1)];return s?s.indexOf(" "+i.slice(r+1,o)+" ")>=0:!1},is:function(i){var o=i.lastIndexOf(".");if(o<=0||o>=i.length-1)return!1;var r=i.lastIndexOf(".",o-1);if(r>=0)return!1;var s=n.list[i.slice(o+1)];return s?s.indexOf(" "+i.slice(0,o)+" ")>=0:!1},get:function(i){var o=i.lastIndexOf(".");if(o<=0||o>=i.length-1)return null;var r=i.lastIndexOf(".",o-1);if(r<=0||r>=o-1)return null;var s=n.list[i.slice(o+1)];return!s||s.indexOf(" "+i.slice(r+1,o)+" ")<0?null:i.slice(r+1)},noConflict:function(){return e.SecondLevelDomains===this&&(e.SecondLevelDomains=t),this}};return n})});var Pl=vu((eZ,QP)=>{/*!
 * URI.js - Mutating URLs
 *
 * Version: 1.19.11
 *
 * Author: Rodney Rehm
 * Web: http://medialize.github.io/URI.js/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *
 */(function(e,t){"use strict";typeof QP=="object"&&QP.exports?QP.exports=t(K$(),Z$(),Q$()):typeof define=="function"&&define.amd?define(["./punycode","./IPv6","./SecondLevelDomains"],t):e.URI=t(e.punycode,e.IPv6,e.SecondLevelDomains,e)})(eZ,function(e,t,n,i){"use strict";var o=i&&i.URI;function r(w,P){var O=arguments.length>=1,F=arguments.length>=2;if(!(this instanceof r))return O?F?new r(w,P):new r(w):new r;if(w===void 0){if(O)throw new TypeError("undefined is not a valid argument for URI");typeof location<"u"?w=location.href+"":w=""}if(w===null&&O)throw new TypeError("null is not a valid argument for URI");return this.href(w),P!==void 0?this.absoluteTo(P):this}function s(w){return/^[0-9]+$/.test(w)}r.version="1.19.11";var a=r.prototype,l=Object.prototype.hasOwnProperty;function u(w){return w.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function f(w){return w===void 0?"Undefined":String(Object.prototype.toString.call(w)).slice(8,-1)}function d(w){return f(w)==="Array"}function p(w,P){var O={},F,V;if(f(P)==="RegExp")O=null;else if(d(P))for(F=0,V=P.length;F<V;F++)O[P[F]]=!0;else O[P]=!0;for(F=0,V=w.length;F<V;F++){var G=O&&O[w[F]]!==void 0||!O&&P.test(w[F]);G&&(w.splice(F,1),V--,F--)}return w}function g(w,P){var O,F;if(d(P)){for(O=0,F=P.length;O<F;O++)if(!g(w,P[O]))return!1;return!0}var V=f(P);for(O=0,F=w.length;O<F;O++)if(V==="RegExp"){if(typeof w[O]=="string"&&w[O].match(P))return!0}else if(w[O]===P)return!0;return!1}function m(w,P){if(!d(w)||!d(P)||w.length!==P.length)return!1;w.sort(),P.sort();for(var O=0,F=w.length;O<F;O++)if(w[O]!==P[O])return!1;return!0}function b(w){var P=/^\/+|\/+$/g;return w.replace(P,"")}r._parts=function(){return{protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null,preventInvalidHostname:r.preventInvalidHostname,duplicateQueryParameters:r.duplicateQueryParameters,escapeQuerySpace:r.escapeQuerySpace}},r.preventInvalidHostname=!1,r.duplicateQueryParameters=!1,r.escapeQuerySpace=!0,r.protocol_expression=/^[a-z][a-z0-9.+-]*$/i,r.idn_expression=/[^a-z0-9\._-]/i,r.punycode_expression=/(xn--)/i,r.ip4_expression=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,r.ip6_expression=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,r.find_uri_expression=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/ig,r.findUri={start:/\b(?:([a-z][a-z0-9.+-]*:\/\/)|www\.)/gi,end:/[\s\r\n]|$/,trim:/[`!()\[\]{};:'".,<>?«»“”„‘’]+$/,parens:/(\([^\)]*\)|\[[^\]]*\]|\{[^}]*\}|<[^>]*>)/g},r.leading_whitespace_expression=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,r.ascii_tab_whitespace=/[\u0009\u000A\u000D]+/g,r.defaultPorts={http:"80",https:"443",ftp:"21",gopher:"70",ws:"80",wss:"443"},r.hostProtocols=["http","https"],r.invalid_hostname_characters=/[^a-zA-Z0-9\.\-:_]/,r.domAttributes={a:"href",blockquote:"cite",link:"href",base:"href",script:"src",form:"action",img:"src",area:"href",iframe:"src",embed:"src",source:"src",track:"src",input:"src",audio:"src",video:"src"},r.getDomAttribute=function(w){if(!(!w||!w.nodeName)){var P=w.nodeName.toLowerCase();if(!(P==="input"&&w.type!=="image"))return r.domAttributes[P]}};function x(w){return escape(w)}function T(w){return encodeURIComponent(w).replace(/[!'()*]/g,x).replace(/\*/g,"%2A")}r.encode=T,r.decode=decodeURIComponent,r.iso8859=function(){r.encode=escape,r.decode=unescape},r.unicode=function(){r.encode=T,r.decode=decodeURIComponent},r.characters={pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/ig,map:{"%24":"$","%26":"&","%2B":"+","%2C":",","%3B":";","%3D":"=","%3A":":","%40":"@"}},decode:{expression:/[\/\?#]/g,map:{"/":"%2F","?":"%3F","#":"%23"}}},reserved:{encode:{expression:/%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/ig,map:{"%3A":":","%2F":"/","%3F":"?","%23":"#","%5B":"[","%5D":"]","%40":"@","%21":"!","%24":"$","%26":"&","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"="}}},urnpath:{encode:{expression:/%(21|24|27|28|29|2A|2B|2C|3B|3D|40)/ig,map:{"%21":"!","%24":"$","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"=","%40":"@"}},decode:{expression:/[\/\?#:]/g,map:{"/":"%2F","?":"%3F","#":"%23",":":"%3A"}}}},r.encodeQuery=function(w,P){var O=r.encode(w+"");return P===void 0&&(P=r.escapeQuerySpace),P?O.replace(/%20/g,"+"):O},r.decodeQuery=function(w,P){w+="",P===void 0&&(P=r.escapeQuerySpace);try{return r.decode(P?w.replace(/\+/g,"%20"):w)}catch{return w}};var C={encode:"encode",decode:"decode"},S,v=function(w,P){return function(O){try{return r[P](O+"").replace(r.characters[w][P].expression,function(F){return r.characters[w][P].map[F]})}catch{return O}}};for(S in C)r[S+"PathSegment"]=v("pathname",C[S]),r[S+"UrnPathSegment"]=v("urnpath",C[S]);var D=function(w,P,O){return function(F){var V;O?V=function(U){return r[P](r[O](U))}:V=r[P];for(var G=(F+"").split(w),z=0,W=G.length;z<W;z++)G[z]=V(G[z]);return G.join(w)}};r.decodePath=D("/","decodePathSegment"),r.decodeUrnPath=D(":","decodeUrnPathSegment"),r.recodePath=D("/","encodePathSegment","decode"),r.recodeUrnPath=D(":","encodeUrnPathSegment","decode"),r.encodeReserved=v("reserved","encode"),r.parse=function(w,P){var O;return P||(P={preventInvalidHostname:r.preventInvalidHostname}),w=w.replace(r.leading_whitespace_expression,""),w=w.replace(r.ascii_tab_whitespace,""),O=w.indexOf("#"),O>-1&&(P.fragment=w.substring(O+1)||null,w=w.substring(0,O)),O=w.indexOf("?"),O>-1&&(P.query=w.substring(O+1)||null,w=w.substring(0,O)),w=w.replace(/^(https?|ftp|wss?)?:+[/\\]*/i,"$1://"),w=w.replace(/^[/\\]{2,}/i,"//"),w.substring(0,2)==="//"?(P.protocol=null,w=w.substring(2),w=r.parseAuthority(w,P)):(O=w.indexOf(":"),O>-1&&(P.protocol=w.substring(0,O)||null,P.protocol&&!P.protocol.match(r.protocol_expression)?P.protocol=void 0:w.substring(O+1,O+3).replace(/\\/g,"/")==="//"?(w=w.substring(O+3),w=r.parseAuthority(w,P)):(w=w.substring(O+1),P.urn=!0))),P.path=w,P},r.parseHost=function(w,P){w||(w=""),w=w.replace(/\\/g,"/");var O=w.indexOf("/"),F,V;if(O===-1&&(O=w.length),w.charAt(0)==="[")F=w.indexOf("]"),P.hostname=w.substring(1,F)||null,P.port=w.substring(F+2,O)||null,P.port==="/"&&(P.port=null);else{var G=w.indexOf(":"),z=w.indexOf("/"),W=w.indexOf(":",G+1);W!==-1&&(z===-1||W<z)?(P.hostname=w.substring(0,O)||null,P.port=null):(V=w.substring(0,O).split(":"),P.hostname=V[0]||null,P.port=V[1]||null)}return P.hostname&&w.substring(O).charAt(0)!=="/"&&(O++,w="/"+w),P.preventInvalidHostname&&r.ensureValidHostname(P.hostname,P.protocol),P.port&&r.ensureValidPort(P.port),w.substring(O)||"/"},r.parseAuthority=function(w,P){return w=r.parseUserinfo(w,P),r.parseHost(w,P)},r.parseUserinfo=function(w,P){var O=w,F=w.indexOf("\\");F!==-1&&(w=w.replace(/\\/g,"/"));var V=w.indexOf("/"),G=w.lastIndexOf("@",V>-1?V:w.length-1),z;return G>-1&&(V===-1||G<V)?(z=w.substring(0,G).split(":"),P.username=z[0]?r.decode(z[0]):null,z.shift(),P.password=z[0]?r.decode(z.join(":")):null,w=O.substring(G+1)):(P.username=null,P.password=null),w},r.parseQuery=function(w,P){if(!w)return{};if(w=w.replace(/&+/g,"&").replace(/^\?*&*|&+$/g,""),!w)return{};for(var O={},F=w.split("&"),V=F.length,G,z,W,U=0;U<V;U++)G=F[U].split("="),z=r.decodeQuery(G.shift(),P),W=G.length?r.decodeQuery(G.join("="),P):null,z!=="__proto__"&&(l.call(O,z)?((typeof O[z]=="string"||O[z]===null)&&(O[z]=[O[z]]),O[z].push(W)):O[z]=W);return O},r.build=function(w){var P="",O=!1;return w.protocol&&(P+=w.protocol+":"),!w.urn&&(P||w.hostname)&&(P+="//",O=!0),P+=r.buildAuthority(w)||"",typeof w.path=="string"&&(w.path.charAt(0)!=="/"&&O&&(P+="/"),P+=w.path),typeof w.query=="string"&&w.query&&(P+="?"+w.query),typeof w.fragment=="string"&&w.fragment&&(P+="#"+w.fragment),P},r.buildHost=function(w){var P="";if(w.hostname)r.ip6_expression.test(w.hostname)?P+="["+w.hostname+"]":P+=w.hostname;else return"";return w.port&&(P+=":"+w.port),P},r.buildAuthority=function(w){return r.buildUserinfo(w)+r.buildHost(w)},r.buildUserinfo=function(w){var P="";return w.username&&(P+=r.encode(w.username)),w.password&&(P+=":"+r.encode(w.password)),P&&(P+="@"),P},r.buildQuery=function(w,P,O){var F="",V,G,z,W;for(G in w)if(G!=="__proto__"&&l.call(w,G))if(d(w[G]))for(V={},z=0,W=w[G].length;z<W;z++)w[G][z]!==void 0&&V[w[G][z]+""]===void 0&&(F+="&"+r.buildQueryParameter(G,w[G][z],O),P!==!0&&(V[w[G][z]+""]=!0));else w[G]!==void 0&&(F+="&"+r.buildQueryParameter(G,w[G],O));return F.substring(1)},r.buildQueryParameter=function(w,P,O){return r.encodeQuery(w,O)+(P!==null?"="+r.encodeQuery(P,O):"")},r.addQuery=function(w,P,O){if(typeof P=="object")for(var F in P)l.call(P,F)&&r.addQuery(w,F,P[F]);else if(typeof P=="string"){if(w[P]===void 0){w[P]=O;return}else typeof w[P]=="string"&&(w[P]=[w[P]]);d(O)||(O=[O]),w[P]=(w[P]||[]).concat(O)}else throw new TypeError("URI.addQuery() accepts an object, string as the name parameter")},r.setQuery=function(w,P,O){if(typeof P=="object")for(var F in P)l.call(P,F)&&r.setQuery(w,F,P[F]);else if(typeof P=="string")w[P]=O===void 0?null:O;else throw new TypeError("URI.setQuery() accepts an object, string as the name parameter")},r.removeQuery=function(w,P,O){var F,V,G;if(d(P))for(F=0,V=P.length;F<V;F++)w[P[F]]=void 0;else if(f(P)==="RegExp")for(G in w)P.test(G)&&(w[G]=void 0);else if(typeof P=="object")for(G in P)l.call(P,G)&&r.removeQuery(w,G,P[G]);else if(typeof P=="string")O!==void 0?f(O)==="RegExp"?!d(w[P])&&O.test(w[P])?w[P]=void 0:w[P]=p(w[P],O):w[P]===String(O)&&(!d(O)||O.length===1)?w[P]=void 0:d(w[P])&&(w[P]=p(w[P],O)):w[P]=void 0;else throw new TypeError("URI.removeQuery() accepts an object, string, RegExp as the first parameter")},r.hasQuery=function(w,P,O,F){switch(f(P)){case"String":break;case"RegExp":for(var V in w)if(l.call(w,V)&&P.test(V)&&(O===void 0||r.hasQuery(w,V,O)))return!0;return!1;case"Object":for(var G in P)if(l.call(P,G)&&!r.hasQuery(w,G,P[G]))return!1;return!0;default:throw new TypeError("URI.hasQuery() accepts a string, regular expression or object as the name parameter")}switch(f(O)){case"Undefined":return P in w;case"Boolean":var z=!!(d(w[P])?w[P].length:w[P]);return O===z;case"Function":return!!O(w[P],P,w);case"Array":if(!d(w[P]))return!1;var W=F?g:m;return W(w[P],O);case"RegExp":return d(w[P])?F?g(w[P],O):!1:!!(w[P]&&w[P].match(O));case"Number":O=String(O);case"String":return d(w[P])?F?g(w[P],O):!1:w[P]===O;default:throw new TypeError("URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter")}},r.joinPaths=function(){for(var w=[],P=[],O=0,F=0;F<arguments.length;F++){var V=new r(arguments[F]);w.push(V);for(var G=V.segment(),z=0;z<G.length;z++)typeof G[z]=="string"&&P.push(G[z]),G[z]&&O++}if(!P.length||!O)return new r("");var W=new r("").segment(P);return(w[0].path()===""||w[0].path().slice(0,1)==="/")&&W.path("/"+W.path()),W.normalize()},r.commonPath=function(w,P){var O=Math.min(w.length,P.length),F;for(F=0;F<O;F++)if(w.charAt(F)!==P.charAt(F)){F--;break}return F<1?w.charAt(0)===P.charAt(0)&&w.charAt(0)==="/"?"/":"":((w.charAt(F)!=="/"||P.charAt(F)!=="/")&&(F=w.substring(0,F).lastIndexOf("/")),w.substring(0,F+1))},r.withinString=function(w,P,O){O||(O={});var F=O.start||r.findUri.start,V=O.end||r.findUri.end,G=O.trim||r.findUri.trim,z=O.parens||r.findUri.parens,W=/[a-z0-9-]=["']?$/i;for(F.lastIndex=0;;){var U=F.exec(w);if(!U)break;var q=U.index;if(O.ignoreHtml){var K=w.slice(Math.max(q-3,0),q);if(K&&W.test(K))continue}for(var te=q+w.slice(q).search(V),Y=w.slice(q,te),Z=-1;;){var ee=z.exec(Y);if(!ee)break;var me=ee.index+ee[0].length;Z=Math.max(Z,me)}if(Z>-1?Y=Y.slice(0,Z)+Y.slice(Z).replace(G,""):Y=Y.replace(G,""),!(Y.length<=U[0].length)&&!(O.ignore&&O.ignore.test(Y))){te=q+Y.length;var be=P(Y,q,te,w);if(be===void 0){F.lastIndex=te;continue}be=String(be),w=w.slice(0,q)+be+w.slice(te),F.lastIndex=q+be.length}}return F.lastIndex=0,w},r.ensureValidHostname=function(w,P){var O=!!w,F=!!P,V=!1;if(F&&(V=g(r.hostProtocols,P)),V&&!O)throw new TypeError("Hostname cannot be empty, if protocol is "+P);if(w&&w.match(r.invalid_hostname_characters)){if(!e)throw new TypeError('Hostname "'+w+'" contains characters other than [A-Z0-9.-:_] and Punycode.js is not available');if(e.toASCII(w).match(r.invalid_hostname_characters))throw new TypeError('Hostname "'+w+'" contains characters other than [A-Z0-9.-:_]')}},r.ensureValidPort=function(w){if(w){var P=Number(w);if(!(s(P)&&P>0&&P<65536))throw new TypeError('Port "'+w+'" is not a valid port')}},r.noConflict=function(w){if(w){var P={URI:this.noConflict()};return i.URITemplate&&typeof i.URITemplate.noConflict=="function"&&(P.URITemplate=i.URITemplate.noConflict()),i.IPv6&&typeof i.IPv6.noConflict=="function"&&(P.IPv6=i.IPv6.noConflict()),i.SecondLevelDomains&&typeof i.SecondLevelDomains.noConflict=="function"&&(P.SecondLevelDomains=i.SecondLevelDomains.noConflict()),P}else i.URI===this&&(i.URI=o);return this},a.build=function(w){return w===!0?this._deferred_build=!0:(w===void 0||this._deferred_build)&&(this._string=r.build(this._parts),this._deferred_build=!1),this},a.clone=function(){return new r(this)},a.valueOf=a.toString=function(){return this.build(!1)._string};function I(w){return function(P,O){return P===void 0?this._parts[w]||"":(this._parts[w]=P||null,this.build(!O),this)}}function L(w,P){return function(O,F){return O===void 0?this._parts[w]||"":(O!==null&&(O=O+"",O.charAt(0)===P&&(O=O.substring(1))),this._parts[w]=O,this.build(!F),this)}}a.protocol=I("protocol"),a.username=I("username"),a.password=I("password"),a.hostname=I("hostname"),a.port=I("port"),a.query=L("query","?"),a.fragment=L("fragment","#"),a.search=function(w,P){var O=this.query(w,P);return typeof O=="string"&&O.length?"?"+O:O},a.hash=function(w,P){var O=this.fragment(w,P);return typeof O=="string"&&O.length?"#"+O:O},a.pathname=function(w,P){if(w===void 0||w===!0){var O=this._parts.path||(this._parts.hostname?"/":"");return w?(this._parts.urn?r.decodeUrnPath:r.decodePath)(O):O}else return this._parts.urn?this._parts.path=w?r.recodeUrnPath(w):"":this._parts.path=w?r.recodePath(w):"/",this.build(!P),this},a.path=a.pathname,a.href=function(w,P){var O;if(w===void 0)return this.toString();this._string="",this._parts=r._parts();var F=w instanceof r,V=typeof w=="object"&&(w.hostname||w.path||w.pathname);if(w.nodeName){var G=r.getDomAttribute(w);w=w[G]||"",V=!1}if(!F&&V&&w.pathname!==void 0&&(w=w.toString()),typeof w=="string"||w instanceof String)this._parts=r.parse(String(w),this._parts);else if(F||V){var z=F?w._parts:w;for(O in z)O!=="query"&&l.call(this._parts,O)&&(this._parts[O]=z[O]);z.query&&this.query(z.query,!1)}else throw new TypeError("invalid input");return this.build(!P),this},a.is=function(w){var P=!1,O=!1,F=!1,V=!1,G=!1,z=!1,W=!1,U=!this._parts.urn;switch(this._parts.hostname&&(U=!1,O=r.ip4_expression.test(this._parts.hostname),F=r.ip6_expression.test(this._parts.hostname),P=O||F,V=!P,G=V&&n&&n.has(this._parts.hostname),z=V&&r.idn_expression.test(this._parts.hostname),W=V&&r.punycode_expression.test(this._parts.hostname)),w.toLowerCase()){case"relative":return U;case"absolute":return!U;case"domain":case"name":return V;case"sld":return G;case"ip":return P;case"ip4":case"ipv4":case"inet4":return O;case"ip6":case"ipv6":case"inet6":return F;case"idn":return z;case"url":return!this._parts.urn;case"urn":return!!this._parts.urn;case"punycode":return W}return null};var M=a.protocol,N=a.port,B=a.hostname;a.protocol=function(w,P){if(w&&(w=w.replace(/:(\/\/)?$/,""),!w.match(r.protocol_expression)))throw new TypeError('Protocol "'+w+`" contains characters other than [A-Z0-9.+-] or doesn't start with [A-Z]`);return M.call(this,w,P)},a.scheme=a.protocol,a.port=function(w,P){return this._parts.urn?w===void 0?"":this:(w!==void 0&&(w===0&&(w=null),w&&(w+="",w.charAt(0)===":"&&(w=w.substring(1)),r.ensureValidPort(w))),N.call(this,w,P))},a.hostname=function(w,P){if(this._parts.urn)return w===void 0?"":this;if(w!==void 0){var O={preventInvalidHostname:this._parts.preventInvalidHostname},F=r.parseHost(w,O);if(F!=="/")throw new TypeError('Hostname "'+w+'" contains characters other than [A-Z0-9.-]');w=O.hostname,this._parts.preventInvalidHostname&&r.ensureValidHostname(w,this._parts.protocol)}return B.call(this,w,P)},a.origin=function(w,P){if(this._parts.urn)return w===void 0?"":this;if(w===void 0){var O=this.protocol(),F=this.authority();return F?(O?O+"://":"")+this.authority():""}else{var V=r(w);return this.protocol(V.protocol()).authority(V.authority()).build(!P),this}},a.host=function(w,P){if(this._parts.urn)return w===void 0?"":this;if(w===void 0)return this._parts.hostname?r.buildHost(this._parts):"";var O=r.parseHost(w,this._parts);if(O!=="/")throw new TypeError('Hostname "'+w+'" contains characters other than [A-Z0-9.-]');return this.build(!P),this},a.authority=function(w,P){if(this._parts.urn)return w===void 0?"":this;if(w===void 0)return this._parts.hostname?r.buildAuthority(this._parts):"";var O=r.parseAuthority(w,this._parts);if(O!=="/")throw new TypeError('Hostname "'+w+'" contains characters other than [A-Z0-9.-]');return this.build(!P),this},a.userinfo=function(w,P){if(this._parts.urn)return w===void 0?"":this;if(w===void 0){var O=r.buildUserinfo(this._parts);return O&&O.substring(0,O.length-1)}else return w[w.length-1]!=="@"&&(w+="@"),r.parseUserinfo(w,this._parts),this.build(!P),this},a.resource=function(w,P){var O;return w===void 0?this.path()+this.search()+this.hash():(O=r.parse(w),this._parts.path=O.path,this._parts.query=O.query,this._parts.fragment=O.fragment,this.build(!P),this)},a.subdomain=function(w,P){if(this._parts.urn)return w===void 0?"":this;if(w===void 0){if(!this._parts.hostname||this.is("IP"))return"";var O=this._parts.hostname.length-this.domain().length-1;return this._parts.hostname.substring(0,O)||""}else{var F=this._parts.hostname.length-this.domain().length,V=this._parts.hostname.substring(0,F),G=new RegExp("^"+u(V));if(w&&w.charAt(w.length-1)!=="."&&(w+="."),w.indexOf(":")!==-1)throw new TypeError("Domains cannot contain colons");return w&&r.ensureValidHostname(w,this._parts.protocol),this._parts.hostname=this._parts.hostname.replace(G,w),this.build(!P),this}},a.domain=function(w,P){if(this._parts.urn)return w===void 0?"":this;if(typeof w=="boolean"&&(P=w,w=void 0),w===void 0){if(!this._parts.hostname||this.is("IP"))return"";var O=this._parts.hostname.match(/\./g);if(O&&O.length<2)return this._parts.hostname;var F=this._parts.hostname.length-this.tld(P).length-1;return F=this._parts.hostname.lastIndexOf(".",F-1)+1,this._parts.hostname.substring(F)||""}else{if(!w)throw new TypeError("cannot set domain empty");if(w.indexOf(":")!==-1)throw new TypeError("Domains cannot contain colons");if(r.ensureValidHostname(w,this._parts.protocol),!this._parts.hostname||this.is("IP"))this._parts.hostname=w;else{var V=new RegExp(u(this.domain())+"$");this._parts.hostname=this._parts.hostname.replace(V,w)}return this.build(!P),this}},a.tld=function(w,P){if(this._parts.urn)return w===void 0?"":this;if(typeof w=="boolean"&&(P=w,w=void 0),w===void 0){if(!this._parts.hostname||this.is("IP"))return"";var O=this._parts.hostname.lastIndexOf("."),F=this._parts.hostname.substring(O+1);return P!==!0&&n&&n.list[F.toLowerCase()]&&n.get(this._parts.hostname)||F}else{var V;if(w)if(w.match(/[^a-zA-Z0-9-]/))if(n&&n.is(w))V=new RegExp(u(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(V,w);else throw new TypeError('TLD "'+w+'" contains characters other than [A-Z0-9]');else{if(!this._parts.hostname||this.is("IP"))throw new ReferenceError("cannot set TLD on non-domain host");V=new RegExp(u(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(V,w)}else throw new TypeError("cannot set TLD empty");return this.build(!P),this}},a.directory=function(w,P){if(this._parts.urn)return w===void 0?"":this;if(w===void 0||w===!0){if(!this._parts.path&&!this._parts.hostname)return"";if(this._parts.path==="/")return"/";var O=this._parts.path.length-this.filename().length-1,F=this._parts.path.substring(0,O)||(this._parts.hostname?"/":"");return w?r.decodePath(F):F}else{var V=this._parts.path.length-this.filename().length,G=this._parts.path.substring(0,V),z=new RegExp("^"+u(G));return this.is("relative")||(w||(w="/"),w.charAt(0)!=="/"&&(w="/"+w)),w&&w.charAt(w.length-1)!=="/"&&(w+="/"),w=r.recodePath(w),this._parts.path=this._parts.path.replace(z,w),this.build(!P),this}},a.filename=function(w,P){if(this._parts.urn)return w===void 0?"":this;if(typeof w!="string"){if(!this._parts.path||this._parts.path==="/")return"";var O=this._parts.path.lastIndexOf("/"),F=this._parts.path.substring(O+1);return w?r.decodePathSegment(F):F}else{var V=!1;w.charAt(0)==="/"&&(w=w.substring(1)),w.match(/\.?\//)&&(V=!0);var G=new RegExp(u(this.filename())+"$");return w=r.recodePath(w),this._parts.path=this._parts.path.replace(G,w),V?this.normalizePath(P):this.build(!P),this}},a.suffix=function(w,P){if(this._parts.urn)return w===void 0?"":this;if(w===void 0||w===!0){if(!this._parts.path||this._parts.path==="/")return"";var O=this.filename(),F=O.lastIndexOf("."),V,G;return F===-1?"":(V=O.substring(F+1),G=/^[a-z0-9%]+$/i.test(V)?V:"",w?r.decodePathSegment(G):G)}else{w.charAt(0)==="."&&(w=w.substring(1));var z=this.suffix(),W;if(z)w?W=new RegExp(u(z)+"$"):W=new RegExp(u("."+z)+"$");else{if(!w)return this;this._parts.path+="."+r.recodePath(w)}return W&&(w=r.recodePath(w),this._parts.path=this._parts.path.replace(W,w)),this.build(!P),this}},a.segment=function(w,P,O){var F=this._parts.urn?":":"/",V=this.path(),G=V.substring(0,1)==="/",z=V.split(F);if(w!==void 0&&typeof w!="number"&&(O=P,P=w,w=void 0),w!==void 0&&typeof w!="number")throw new Error('Bad segment "'+w+'", must be 0-based integer');if(G&&z.shift(),w<0&&(w=Math.max(z.length+w,0)),P===void 0)return w===void 0?z:z[w];if(w===null||z[w]===void 0)if(d(P)){z=[];for(var W=0,U=P.length;W<U;W++)!P[W].length&&(!z.length||!z[z.length-1].length)||(z.length&&!z[z.length-1].length&&z.pop(),z.push(b(P[W])))}else(P||typeof P=="string")&&(P=b(P),z[z.length-1]===""?z[z.length-1]=P:z.push(P));else P?z[w]=b(P):z.splice(w,1);return G&&z.unshift(""),this.path(z.join(F),O)},a.segmentCoded=function(w,P,O){var F,V,G;if(typeof w!="number"&&(O=P,P=w,w=void 0),P===void 0){if(F=this.segment(w,P,O),!d(F))F=F!==void 0?r.decode(F):void 0;else for(V=0,G=F.length;V<G;V++)F[V]=r.decode(F[V]);return F}if(!d(P))P=typeof P=="string"||P instanceof String?r.encode(P):P;else for(V=0,G=P.length;V<G;V++)P[V]=r.encode(P[V]);return this.segment(w,P,O)};var _=a.query;return a.query=function(w,P){if(w===!0)return r.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if(typeof w=="function"){var O=r.parseQuery(this._parts.query,this._parts.escapeQuerySpace),F=w.call(this,O);return this._parts.query=r.buildQuery(F||O,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!P),this}else return w!==void 0&&typeof w!="string"?(this._parts.query=r.buildQuery(w,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!P),this):_.call(this,w,P)},a.setQuery=function(w,P,O){var F=r.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if(typeof w=="string"||w instanceof String)F[w]=P!==void 0?P:null;else if(typeof w=="object")for(var V in w)l.call(w,V)&&(F[V]=w[V]);else throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");return this._parts.query=r.buildQuery(F,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),typeof w!="string"&&(O=P),this.build(!O),this},a.addQuery=function(w,P,O){var F=r.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return r.addQuery(F,w,P===void 0?null:P),this._parts.query=r.buildQuery(F,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),typeof w!="string"&&(O=P),this.build(!O),this},a.removeQuery=function(w,P,O){var F=r.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return r.removeQuery(F,w,P),this._parts.query=r.buildQuery(F,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),typeof w!="string"&&(O=P),this.build(!O),this},a.hasQuery=function(w,P,O){var F=r.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return r.hasQuery(F,w,P,O)},a.setSearch=a.setQuery,a.addSearch=a.addQuery,a.removeSearch=a.removeQuery,a.hasSearch=a.hasQuery,a.normalize=function(){return this._parts.urn?this.normalizeProtocol(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build():this.normalizeProtocol(!1).normalizeHostname(!1).normalizePort(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build()},a.normalizeProtocol=function(w){return typeof this._parts.protocol=="string"&&(this._parts.protocol=this._parts.protocol.toLowerCase(),this.build(!w)),this},a.normalizeHostname=function(w){return this._parts.hostname&&(this.is("IDN")&&e?this._parts.hostname=e.toASCII(this._parts.hostname):this.is("IPv6")&&t&&(this._parts.hostname=t.best(this._parts.hostname)),this._parts.hostname=this._parts.hostname.toLowerCase(),this.build(!w)),this},a.normalizePort=function(w){return typeof this._parts.protocol=="string"&&this._parts.port===r.defaultPorts[this._parts.protocol]&&(this._parts.port=null,this.build(!w)),this},a.normalizePath=function(w){var P=this._parts.path;if(!P)return this;if(this._parts.urn)return this._parts.path=r.recodeUrnPath(this._parts.path),this.build(!w),this;if(this._parts.path==="/")return this;P=r.recodePath(P);var O,F="",V,G;for(P.charAt(0)!=="/"&&(O=!0,P="/"+P),(P.slice(-3)==="/.."||P.slice(-2)==="/.")&&(P+="/"),P=P.replace(/(\/(\.\/)+)|(\/\.$)/g,"/").replace(/\/{2,}/g,"/"),O&&(F=P.substring(1).match(/^(\.\.\/)+/)||"",F&&(F=F[0]));V=P.search(/\/\.\.(\/|$)/),V!==-1;){if(V===0){P=P.substring(3);continue}G=P.substring(0,V).lastIndexOf("/"),G===-1&&(G=V),P=P.substring(0,G)+P.substring(V+3)}return O&&this.is("relative")&&(P=F+P.substring(1)),this._parts.path=P,this.build(!w),this},a.normalizePathname=a.normalizePath,a.normalizeQuery=function(w){return typeof this._parts.query=="string"&&(this._parts.query.length?this.query(r.parseQuery(this._parts.query,this._parts.escapeQuerySpace)):this._parts.query=null,this.build(!w)),this},a.normalizeFragment=function(w){return this._parts.fragment||(this._parts.fragment=null,this.build(!w)),this},a.normalizeSearch=a.normalizeQuery,a.normalizeHash=a.normalizeFragment,a.iso8859=function(){var w=r.encode,P=r.decode;r.encode=escape,r.decode=decodeURIComponent;try{this.normalize()}finally{r.encode=w,r.decode=P}return this},a.unicode=function(){var w=r.encode,P=r.decode;r.encode=T,r.decode=unescape;try{this.normalize()}finally{r.encode=w,r.decode=P}return this},a.readable=function(){var w=this.clone();w.username("").password("").normalize();var P="";if(w._parts.protocol&&(P+=w._parts.protocol+"://"),w._parts.hostname&&(w.is("punycode")&&e?(P+=e.toUnicode(w._parts.hostname),w._parts.port&&(P+=":"+w._parts.port)):P+=w.host()),w._parts.hostname&&w._parts.path&&w._parts.path.charAt(0)!=="/"&&(P+="/"),P+=w.path(!0),w._parts.query){for(var O="",F=0,V=w._parts.query.split("&"),G=V.length;F<G;F++){var z=(V[F]||"").split("=");O+="&"+r.decodeQuery(z[0],this._parts.escapeQuerySpace).replace(/&/g,"%26"),z[1]!==void 0&&(O+="="+r.decodeQuery(z[1],this._parts.escapeQuerySpace).replace(/&/g,"%26"))}P+="?"+O.substring(1)}return P+=r.decodeQuery(w.hash(),!0),P},a.absoluteTo=function(w){var P=this.clone(),O=["protocol","username","password","hostname","port"],F,V,G;if(this._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(w instanceof r||(w=new r(w)),P._parts.protocol||(P._parts.protocol=w._parts.protocol,this._parts.hostname))return P;for(V=0;G=O[V];V++)P._parts[G]=w._parts[G];return P._parts.path?(P._parts.path.substring(-2)===".."&&(P._parts.path+="/"),P.path().charAt(0)!=="/"&&(F=w.directory(),F=F||(w.path().indexOf("/")===0?"/":""),P._parts.path=(F?F+"/":"")+P._parts.path,P.normalizePath())):(P._parts.path=w._parts.path,P._parts.query||(P._parts.query=w._parts.query)),P.build(),P},a.relativeTo=function(w){var P=this.clone().normalize(),O,F,V,G,z;if(P._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(w=new r(w).normalize(),O=P._parts,F=w._parts,G=P.path(),z=w.path(),G.charAt(0)!=="/")throw new Error("URI is already relative");if(z.charAt(0)!=="/")throw new Error("Cannot calculate a URI relative to another relative URI");if(O.protocol===F.protocol&&(O.protocol=null),O.username!==F.username||O.password!==F.password||O.protocol!==null||O.username!==null||O.password!==null)return P.build();if(O.hostname===F.hostname&&O.port===F.port)O.hostname=null,O.port=null;else return P.build();if(G===z)return O.path="",P.build();if(V=r.commonPath(G,z),!V)return P.build();var W=F.path.substring(V.length).replace(/[^\/]*$/,"").replace(/.*?\//g,"../");return O.path=W+O.path.substring(V.length)||"./",P.build()},a.equals=function(w){var P=this.clone(),O=new r(w),F={},V={},G={},z,W,U;if(P.normalize(),O.normalize(),P.toString()===O.toString())return!0;if(z=P.query(),W=O.query(),P.query(""),O.query(""),P.toString()!==O.toString()||z.length!==W.length)return!1;F=r.parseQuery(z,this._parts.escapeQuerySpace),V=r.parseQuery(W,this._parts.escapeQuerySpace);for(U in F)if(l.call(F,U)){if(d(F[U])){if(!m(F[U],V[U]))return!1}else if(F[U]!==V[U])return!1;G[U]=!0}for(U in V)if(l.call(V,U)&&!G[U])return!1;return!0},a.preventInvalidHostname=function(w){return this._parts.preventInvalidHostname=!!w,this},a.duplicateQueryParameters=function(w){return this._parts.duplicateQueryParameters=!!w,this},a.escapeQuerySpace=function(w){return this._parts.escapeQuerySpace=!!w,this},r})});var jse=vu((_In,Gse)=>{"use strict";Gse.exports=d5e;var ww=1e20;function d5e(e,t){t||(t={});var n=t.cutoff==null?.25:t.cutoff,i=t.radius==null?8:t.radius,o=t.channel||0,r,s,a,l,u,f,d,p,g,m,b;if(ArrayBuffer.isView(e)||Array.isArray(e)){if(!t.width||!t.height)throw Error("For raw data width and height should be provided by options");r=t.width,s=t.height,l=e,t.stride?f=t.stride:f=Math.floor(e.length/r/s)}else window.HTMLCanvasElement&&e instanceof window.HTMLCanvasElement?(p=e,d=p.getContext("2d"),r=p.width,s=p.height,g=d.getImageData(0,0,r,s),l=g.data,f=4):window.CanvasRenderingContext2D&&e instanceof window.CanvasRenderingContext2D?(p=e.canvas,d=e,r=p.width,s=p.height,g=d.getImageData(0,0,r,s),l=g.data,f=4):window.ImageData&&e instanceof window.ImageData&&(g=e,r=e.width,s=e.height,l=g.data,f=4);if(a=Math.max(r,s),window.Uint8ClampedArray&&l instanceof window.Uint8ClampedArray||window.Uint8Array&&l instanceof window.Uint8Array)for(u=l,l=Array(r*s),m=0,b=Math.floor(u.length/f);m<b;m++)l[m]=u[m*f+o]/255;else if(f!==1)throw Error("Raw data can have only 1 value per pixel");var x=Array(r*s),T=Array(r*s),C=Array(a),S=Array(a),v=Array(a+1),D=Array(a);for(m=0,b=r*s;m<b;m++){var I=l[m];x[m]=I===1?0:I===0?ww:Math.pow(Math.max(0,.5-I),2),T[m]=I===1?ww:I===0?0:Math.pow(Math.max(0,I-.5),2)}zse(x,r,s,C,S,D,v),zse(T,r,s,C,S,D,v);var L=window.Float32Array?new Float32Array(r*s):new Array(r*s);for(m=0,b=r*s;m<b;m++)L[m]=Math.min(Math.max(1-((x[m]-T[m])/i+n),0),1);return L}function zse(e,t,n,i,o,r,s){for(var a=0;a<t;a++){for(var l=0;l<n;l++)i[l]=e[l*t+a];for(Hse(i,o,r,s,n),l=0;l<n;l++)e[l*t+a]=o[l]}for(l=0;l<n;l++){for(a=0;a<t;a++)i[a]=e[l*t+a];for(Hse(i,o,r,s,t),a=0;a<t;a++)e[l*t+a]=Math.sqrt(o[a])}}function Hse(e,t,n,i,o){n[0]=0,i[0]=-ww,i[1]=+ww;for(var r=1,s=0;r<o;r++){for(var a=(e[r]+r*r-(e[n[s]]+n[s]*n[s]))/(2*r-2*n[s]);a<=i[s];)s--,a=(e[r]+r*r-(e[n[s]]+n[s]*n[s]))/(2*r-2*n[s]);s++,n[s]=r,i[s]=a,i[s+1]=+ww}for(r=0,s=0;r<o;r++){for(;i[s+1]<r;)s++;t[r]=(r-n[s])*(r-n[s])+e[n[s]]}}});var Kse=vu((LIn,E1)=>{function C5e(){var e=0,t=1,n=2,i=3,o=4,r=5,s=6,a=7,l=8,u=9,f=10,d=11,p=12,g=13,m=14,b=15,x=16,T=17,C=0,S=1,v=2,D=3,I=4;function L(_,w){return 55296<=_.charCodeAt(w)&&_.charCodeAt(w)<=56319&&56320<=_.charCodeAt(w+1)&&_.charCodeAt(w+1)<=57343}function M(_,w){w===void 0&&(w=0);var P=_.charCodeAt(w);if(55296<=P&&P<=56319&&w<_.length-1){var O=P,F=_.charCodeAt(w+1);return 56320<=F&&F<=57343?(O-55296)*1024+(F-56320)+65536:O}if(56320<=P&&P<=57343&&w>=1){var O=_.charCodeAt(w-1),F=P;return 55296<=O&&O<=56319?(O-55296)*1024+(F-56320)+65536:F}return P}function N(_,w,P){var O=[_].concat(w).concat([P]),F=O[O.length-2],V=P,G=O.lastIndexOf(m);if(G>1&&O.slice(1,G).every(function(U){return U==i})&&[i,g,T].indexOf(_)==-1)return v;var z=O.lastIndexOf(o);if(z>0&&O.slice(1,z).every(function(U){return U==o})&&[p,o].indexOf(F)==-1)return O.filter(function(U){return U==o}).length%2==1?D:I;if(F==e&&V==t)return C;if(F==n||F==e||F==t)return V==m&&w.every(function(U){return U==i})?v:S;if(V==n||V==e||V==t)return S;if(F==s&&(V==s||V==a||V==u||V==f))return C;if((F==u||F==a)&&(V==a||V==l))return C;if((F==f||F==l)&&V==l)return C;if(V==i||V==b)return C;if(V==r)return C;if(F==p)return C;var W=O.indexOf(i)!=-1?O.lastIndexOf(i)-1:O.length-2;return[g,T].indexOf(O[W])!=-1&&O.slice(W+1,-1).every(function(U){return U==i})&&V==m||F==b&&[x,T].indexOf(V)!=-1?C:w.indexOf(o)!=-1?v:F==o&&V==o?C:S}this.nextBreak=function(_,w){if(w===void 0&&(w=0),w<0)return 0;if(w>=_.length-1)return _.length;for(var P=B(M(_,w)),O=[],F=w+1;F<_.length;F++)if(!L(_,F-1)){var V=B(M(_,F));if(N(P,O,V))return F;O.push(V)}return _.length},this.splitGraphemes=function(_){for(var w=[],P=0,O;(O=this.nextBreak(_,P))<_.length;)w.push(_.slice(P,O)),P=O;return P<_.length&&w.push(_.slice(P)),w},this.iterateGraphemes=function(_){var w=0,P={next:function(){var O,F;return(F=this.nextBreak(_,w))<_.length?(O=_.slice(w,F),w=F,{value:O,done:!1}):w<_.length?(O=_.slice(w),w=_.length,{value:O,done:!1}):{value:void 0,done:!0}}.bind(this)};return typeof Symbol<"u"&&Symbol.iterator&&(P[Symbol.iterator]=function(){return P}),P},this.countGraphemes=function(_){for(var w=0,P=0,O;(O=this.nextBreak(_,P))<_.length;)P=O,w++;return P<_.length&&w++,w};function B(_){return 1536<=_&&_<=1541||_==1757||_==1807||_==2274||_==3406||_==69821||70082<=_&&_<=70083||_==72250||72326<=_&&_<=72329||_==73030?p:_==13?e:_==10?t:0<=_&&_<=9||11<=_&&_<=12||14<=_&&_<=31||127<=_&&_<=159||_==173||_==1564||_==6158||_==8203||8206<=_&&_<=8207||_==8232||_==8233||8234<=_&&_<=8238||8288<=_&&_<=8292||_==8293||8294<=_&&_<=8303||55296<=_&&_<=57343||_==65279||65520<=_&&_<=65528||65529<=_&&_<=65531||113824<=_&&_<=113827||119155<=_&&_<=119162||_==917504||_==917505||917506<=_&&_<=917535||917632<=_&&_<=917759||918e3<=_&&_<=921599?n:768<=_&&_<=879||1155<=_&&_<=1159||1160<=_&&_<=1161||1425<=_&&_<=1469||_==1471||1473<=_&&_<=1474||1476<=_&&_<=1477||_==1479||1552<=_&&_<=1562||1611<=_&&_<=1631||_==1648||1750<=_&&_<=1756||1759<=_&&_<=1764||1767<=_&&_<=1768||1770<=_&&_<=1773||_==1809||1840<=_&&_<=1866||1958<=_&&_<=1968||2027<=_&&_<=2035||2070<=_&&_<=2073||2075<=_&&_<=2083||2085<=_&&_<=2087||2089<=_&&_<=2093||2137<=_&&_<=2139||2260<=_&&_<=2273||2275<=_&&_<=2306||_==2362||_==2364||2369<=_&&_<=2376||_==2381||2385<=_&&_<=2391||2402<=_&&_<=2403||_==2433||_==2492||_==2494||2497<=_&&_<=2500||_==2509||_==2519||2530<=_&&_<=2531||2561<=_&&_<=2562||_==2620||2625<=_&&_<=2626||2631<=_&&_<=2632||2635<=_&&_<=2637||_==2641||2672<=_&&_<=2673||_==2677||2689<=_&&_<=2690||_==2748||2753<=_&&_<=2757||2759<=_&&_<=2760||_==2765||2786<=_&&_<=2787||2810<=_&&_<=2815||_==2817||_==2876||_==2878||_==2879||2881<=_&&_<=2884||_==2893||_==2902||_==2903||2914<=_&&_<=2915||_==2946||_==3006||_==3008||_==3021||_==3031||_==3072||3134<=_&&_<=3136||3142<=_&&_<=3144||3146<=_&&_<=3149||3157<=_&&_<=3158||3170<=_&&_<=3171||_==3201||_==3260||_==3263||_==3266||_==3270||3276<=_&&_<=3277||3285<=_&&_<=3286||3298<=_&&_<=3299||3328<=_&&_<=3329||3387<=_&&_<=3388||_==3390||3393<=_&&_<=3396||_==3405||_==3415||3426<=_&&_<=3427||_==3530||_==3535||3538<=_&&_<=3540||_==3542||_==3551||_==3633||3636<=_&&_<=3642||3655<=_&&_<=3662||_==3761||3764<=_&&_<=3769||3771<=_&&_<=3772||3784<=_&&_<=3789||3864<=_&&_<=3865||_==3893||_==3895||_==3897||3953<=_&&_<=3966||3968<=_&&_<=3972||3974<=_&&_<=3975||3981<=_&&_<=3991||3993<=_&&_<=4028||_==4038||4141<=_&&_<=4144||4146<=_&&_<=4151||4153<=_&&_<=4154||4157<=_&&_<=4158||4184<=_&&_<=4185||4190<=_&&_<=4192||4209<=_&&_<=4212||_==4226||4229<=_&&_<=4230||_==4237||_==4253||4957<=_&&_<=4959||5906<=_&&_<=5908||5938<=_&&_<=5940||5970<=_&&_<=5971||6002<=_&&_<=6003||6068<=_&&_<=6069||6071<=_&&_<=6077||_==6086||6089<=_&&_<=6099||_==6109||6155<=_&&_<=6157||6277<=_&&_<=6278||_==6313||6432<=_&&_<=6434||6439<=_&&_<=6440||_==6450||6457<=_&&_<=6459||6679<=_&&_<=6680||_==6683||_==6742||6744<=_&&_<=6750||_==6752||_==6754||6757<=_&&_<=6764||6771<=_&&_<=6780||_==6783||6832<=_&&_<=6845||_==6846||6912<=_&&_<=6915||_==6964||6966<=_&&_<=6970||_==6972||_==6978||7019<=_&&_<=7027||7040<=_&&_<=7041||7074<=_&&_<=7077||7080<=_&&_<=7081||7083<=_&&_<=7085||_==7142||7144<=_&&_<=7145||_==7149||7151<=_&&_<=7153||7212<=_&&_<=7219||7222<=_&&_<=7223||7376<=_&&_<=7378||7380<=_&&_<=7392||7394<=_&&_<=7400||_==7405||_==7412||7416<=_&&_<=7417||7616<=_&&_<=7673||7675<=_&&_<=7679||_==8204||8400<=_&&_<=8412||8413<=_&&_<=8416||_==8417||8418<=_&&_<=8420||8421<=_&&_<=8432||11503<=_&&_<=11505||_==11647||11744<=_&&_<=11775||12330<=_&&_<=12333||12334<=_&&_<=12335||12441<=_&&_<=12442||_==42607||42608<=_&&_<=42610||42612<=_&&_<=42621||42654<=_&&_<=42655||42736<=_&&_<=42737||_==43010||_==43014||_==43019||43045<=_&&_<=43046||43204<=_&&_<=43205||43232<=_&&_<=43249||43302<=_&&_<=43309||43335<=_&&_<=43345||43392<=_&&_<=43394||_==43443||43446<=_&&_<=43449||_==43452||_==43493||43561<=_&&_<=43566||43569<=_&&_<=43570||43573<=_&&_<=43574||_==43587||_==43596||_==43644||_==43696||43698<=_&&_<=43700||43703<=_&&_<=43704||43710<=_&&_<=43711||_==43713||43756<=_&&_<=43757||_==43766||_==44005||_==44008||_==44013||_==64286||65024<=_&&_<=65039||65056<=_&&_<=65071||65438<=_&&_<=65439||_==66045||_==66272||66422<=_&&_<=66426||68097<=_&&_<=68099||68101<=_&&_<=68102||68108<=_&&_<=68111||68152<=_&&_<=68154||_==68159||68325<=_&&_<=68326||_==69633||69688<=_&&_<=69702||69759<=_&&_<=69761||69811<=_&&_<=69814||69817<=_&&_<=69818||69888<=_&&_<=69890||69927<=_&&_<=69931||69933<=_&&_<=69940||_==70003||70016<=_&&_<=70017||70070<=_&&_<=70078||70090<=_&&_<=70092||70191<=_&&_<=70193||_==70196||70198<=_&&_<=70199||_==70206||_==70367||70371<=_&&_<=70378||70400<=_&&_<=70401||_==70460||_==70462||_==70464||_==70487||70502<=_&&_<=70508||70512<=_&&_<=70516||70712<=_&&_<=70719||70722<=_&&_<=70724||_==70726||_==70832||70835<=_&&_<=70840||_==70842||_==70845||70847<=_&&_<=70848||70850<=_&&_<=70851||_==71087||71090<=_&&_<=71093||71100<=_&&_<=71101||71103<=_&&_<=71104||71132<=_&&_<=71133||71219<=_&&_<=71226||_==71229||71231<=_&&_<=71232||_==71339||_==71341||71344<=_&&_<=71349||_==71351||71453<=_&&_<=71455||71458<=_&&_<=71461||71463<=_&&_<=71467||72193<=_&&_<=72198||72201<=_&&_<=72202||72243<=_&&_<=72248||72251<=_&&_<=72254||_==72263||72273<=_&&_<=72278||72281<=_&&_<=72283||72330<=_&&_<=72342||72344<=_&&_<=72345||72752<=_&&_<=72758||72760<=_&&_<=72765||_==72767||72850<=_&&_<=72871||72874<=_&&_<=72880||72882<=_&&_<=72883||72885<=_&&_<=72886||73009<=_&&_<=73014||_==73018||73020<=_&&_<=73021||73023<=_&&_<=73029||_==73031||92912<=_&&_<=92916||92976<=_&&_<=92982||94095<=_&&_<=94098||113821<=_&&_<=113822||_==119141||119143<=_&&_<=119145||119150<=_&&_<=119154||119163<=_&&_<=119170||119173<=_&&_<=119179||119210<=_&&_<=119213||119362<=_&&_<=119364||121344<=_&&_<=121398||121403<=_&&_<=121452||_==121461||_==121476||121499<=_&&_<=121503||121505<=_&&_<=121519||122880<=_&&_<=122886||122888<=_&&_<=122904||122907<=_&&_<=122913||122915<=_&&_<=122916||122918<=_&&_<=122922||125136<=_&&_<=125142||125252<=_&&_<=125258||917536<=_&&_<=917631||917760<=_&&_<=917999?i:127462<=_&&_<=127487?o:_==2307||_==2363||2366<=_&&_<=2368||2377<=_&&_<=2380||2382<=_&&_<=2383||2434<=_&&_<=2435||2495<=_&&_<=2496||2503<=_&&_<=2504||2507<=_&&_<=2508||_==2563||2622<=_&&_<=2624||_==2691||2750<=_&&_<=2752||_==2761||2763<=_&&_<=2764||2818<=_&&_<=2819||_==2880||2887<=_&&_<=2888||2891<=_&&_<=2892||_==3007||3009<=_&&_<=3010||3014<=_&&_<=3016||3018<=_&&_<=3020||3073<=_&&_<=3075||3137<=_&&_<=3140||3202<=_&&_<=3203||_==3262||3264<=_&&_<=3265||3267<=_&&_<=3268||3271<=_&&_<=3272||3274<=_&&_<=3275||3330<=_&&_<=3331||3391<=_&&_<=3392||3398<=_&&_<=3400||3402<=_&&_<=3404||3458<=_&&_<=3459||3536<=_&&_<=3537||3544<=_&&_<=3550||3570<=_&&_<=3571||_==3635||_==3763||3902<=_&&_<=3903||_==3967||_==4145||4155<=_&&_<=4156||4182<=_&&_<=4183||_==4228||_==6070||6078<=_&&_<=6085||6087<=_&&_<=6088||6435<=_&&_<=6438||6441<=_&&_<=6443||6448<=_&&_<=6449||6451<=_&&_<=6456||6681<=_&&_<=6682||_==6741||_==6743||6765<=_&&_<=6770||_==6916||_==6965||_==6971||6973<=_&&_<=6977||6979<=_&&_<=6980||_==7042||_==7073||7078<=_&&_<=7079||_==7082||_==7143||7146<=_&&_<=7148||_==7150||7154<=_&&_<=7155||7204<=_&&_<=7211||7220<=_&&_<=7221||_==7393||7410<=_&&_<=7411||_==7415||43043<=_&&_<=43044||_==43047||43136<=_&&_<=43137||43188<=_&&_<=43203||43346<=_&&_<=43347||_==43395||43444<=_&&_<=43445||43450<=_&&_<=43451||43453<=_&&_<=43456||43567<=_&&_<=43568||43571<=_&&_<=43572||_==43597||_==43755||43758<=_&&_<=43759||_==43765||44003<=_&&_<=44004||44006<=_&&_<=44007||44009<=_&&_<=44010||_==44012||_==69632||_==69634||_==69762||69808<=_&&_<=69810||69815<=_&&_<=69816||_==69932||_==70018||70067<=_&&_<=70069||70079<=_&&_<=70080||70188<=_&&_<=70190||70194<=_&&_<=70195||_==70197||70368<=_&&_<=70370||70402<=_&&_<=70403||_==70463||70465<=_&&_<=70468||70471<=_&&_<=70472||70475<=_&&_<=70477||70498<=_&&_<=70499||70709<=_&&_<=70711||70720<=_&&_<=70721||_==70725||70833<=_&&_<=70834||_==70841||70843<=_&&_<=70844||_==70846||_==70849||71088<=_&&_<=71089||71096<=_&&_<=71099||_==71102||71216<=_&&_<=71218||71227<=_&&_<=71228||_==71230||_==71340||71342<=_&&_<=71343||_==71350||71456<=_&&_<=71457||_==71462||72199<=_&&_<=72200||_==72249||72279<=_&&_<=72280||_==72343||_==72751||_==72766||_==72873||_==72881||_==72884||94033<=_&&_<=94078||_==119142||_==119149?r:4352<=_&&_<=4447||43360<=_&&_<=43388?s:4448<=_&&_<=4519||55216<=_&&_<=55238?a:4520<=_&&_<=4607||55243<=_&&_<=55291?l:_==44032||_==44060||_==44088||_==44116||_==44144||_==44172||_==44200||_==44228||_==44256||_==44284||_==44312||_==44340||_==44368||_==44396||_==44424||_==44452||_==44480||_==44508||_==44536||_==44564||_==44592||_==44620||_==44648||_==44676||_==44704||_==44732||_==44760||_==44788||_==44816||_==44844||_==44872||_==44900||_==44928||_==44956||_==44984||_==45012||_==45040||_==45068||_==45096||_==45124||_==45152||_==45180||_==45208||_==45236||_==45264||_==45292||_==45320||_==45348||_==45376||_==45404||_==45432||_==45460||_==45488||_==45516||_==45544||_==45572||_==45600||_==45628||_==45656||_==45684||_==45712||_==45740||_==45768||_==45796||_==45824||_==45852||_==45880||_==45908||_==45936||_==45964||_==45992||_==46020||_==46048||_==46076||_==46104||_==46132||_==46160||_==46188||_==46216||_==46244||_==46272||_==46300||_==46328||_==46356||_==46384||_==46412||_==46440||_==46468||_==46496||_==46524||_==46552||_==46580||_==46608||_==46636||_==46664||_==46692||_==46720||_==46748||_==46776||_==46804||_==46832||_==46860||_==46888||_==46916||_==46944||_==46972||_==47e3||_==47028||_==47056||_==47084||_==47112||_==47140||_==47168||_==47196||_==47224||_==47252||_==47280||_==47308||_==47336||_==47364||_==47392||_==47420||_==47448||_==47476||_==47504||_==47532||_==47560||_==47588||_==47616||_==47644||_==47672||_==47700||_==47728||_==47756||_==47784||_==47812||_==47840||_==47868||_==47896||_==47924||_==47952||_==47980||_==48008||_==48036||_==48064||_==48092||_==48120||_==48148||_==48176||_==48204||_==48232||_==48260||_==48288||_==48316||_==48344||_==48372||_==48400||_==48428||_==48456||_==48484||_==48512||_==48540||_==48568||_==48596||_==48624||_==48652||_==48680||_==48708||_==48736||_==48764||_==48792||_==48820||_==48848||_==48876||_==48904||_==48932||_==48960||_==48988||_==49016||_==49044||_==49072||_==49100||_==49128||_==49156||_==49184||_==49212||_==49240||_==49268||_==49296||_==49324||_==49352||_==49380||_==49408||_==49436||_==49464||_==49492||_==49520||_==49548||_==49576||_==49604||_==49632||_==49660||_==49688||_==49716||_==49744||_==49772||_==49800||_==49828||_==49856||_==49884||_==49912||_==49940||_==49968||_==49996||_==50024||_==50052||_==50080||_==50108||_==50136||_==50164||_==50192||_==50220||_==50248||_==50276||_==50304||_==50332||_==50360||_==50388||_==50416||_==50444||_==50472||_==50500||_==50528||_==50556||_==50584||_==50612||_==50640||_==50668||_==50696||_==50724||_==50752||_==50780||_==50808||_==50836||_==50864||_==50892||_==50920||_==50948||_==50976||_==51004||_==51032||_==51060||_==51088||_==51116||_==51144||_==51172||_==51200||_==51228||_==51256||_==51284||_==51312||_==51340||_==51368||_==51396||_==51424||_==51452||_==51480||_==51508||_==51536||_==51564||_==51592||_==51620||_==51648||_==51676||_==51704||_==51732||_==51760||_==51788||_==51816||_==51844||_==51872||_==51900||_==51928||_==51956||_==51984||_==52012||_==52040||_==52068||_==52096||_==52124||_==52152||_==52180||_==52208||_==52236||_==52264||_==52292||_==52320||_==52348||_==52376||_==52404||_==52432||_==52460||_==52488||_==52516||_==52544||_==52572||_==52600||_==52628||_==52656||_==52684||_==52712||_==52740||_==52768||_==52796||_==52824||_==52852||_==52880||_==52908||_==52936||_==52964||_==52992||_==53020||_==53048||_==53076||_==53104||_==53132||_==53160||_==53188||_==53216||_==53244||_==53272||_==53300||_==53328||_==53356||_==53384||_==53412||_==53440||_==53468||_==53496||_==53524||_==53552||_==53580||_==53608||_==53636||_==53664||_==53692||_==53720||_==53748||_==53776||_==53804||_==53832||_==53860||_==53888||_==53916||_==53944||_==53972||_==54e3||_==54028||_==54056||_==54084||_==54112||_==54140||_==54168||_==54196||_==54224||_==54252||_==54280||_==54308||_==54336||_==54364||_==54392||_==54420||_==54448||_==54476||_==54504||_==54532||_==54560||_==54588||_==54616||_==54644||_==54672||_==54700||_==54728||_==54756||_==54784||_==54812||_==54840||_==54868||_==54896||_==54924||_==54952||_==54980||_==55008||_==55036||_==55064||_==55092||_==55120||_==55148||_==55176?u:44033<=_&&_<=44059||44061<=_&&_<=44087||44089<=_&&_<=44115||44117<=_&&_<=44143||44145<=_&&_<=44171||44173<=_&&_<=44199||44201<=_&&_<=44227||44229<=_&&_<=44255||44257<=_&&_<=44283||44285<=_&&_<=44311||44313<=_&&_<=44339||44341<=_&&_<=44367||44369<=_&&_<=44395||44397<=_&&_<=44423||44425<=_&&_<=44451||44453<=_&&_<=44479||44481<=_&&_<=44507||44509<=_&&_<=44535||44537<=_&&_<=44563||44565<=_&&_<=44591||44593<=_&&_<=44619||44621<=_&&_<=44647||44649<=_&&_<=44675||44677<=_&&_<=44703||44705<=_&&_<=44731||44733<=_&&_<=44759||44761<=_&&_<=44787||44789<=_&&_<=44815||44817<=_&&_<=44843||44845<=_&&_<=44871||44873<=_&&_<=44899||44901<=_&&_<=44927||44929<=_&&_<=44955||44957<=_&&_<=44983||44985<=_&&_<=45011||45013<=_&&_<=45039||45041<=_&&_<=45067||45069<=_&&_<=45095||45097<=_&&_<=45123||45125<=_&&_<=45151||45153<=_&&_<=45179||45181<=_&&_<=45207||45209<=_&&_<=45235||45237<=_&&_<=45263||45265<=_&&_<=45291||45293<=_&&_<=45319||45321<=_&&_<=45347||45349<=_&&_<=45375||45377<=_&&_<=45403||45405<=_&&_<=45431||45433<=_&&_<=45459||45461<=_&&_<=45487||45489<=_&&_<=45515||45517<=_&&_<=45543||45545<=_&&_<=45571||45573<=_&&_<=45599||45601<=_&&_<=45627||45629<=_&&_<=45655||45657<=_&&_<=45683||45685<=_&&_<=45711||45713<=_&&_<=45739||45741<=_&&_<=45767||45769<=_&&_<=45795||45797<=_&&_<=45823||45825<=_&&_<=45851||45853<=_&&_<=45879||45881<=_&&_<=45907||45909<=_&&_<=45935||45937<=_&&_<=45963||45965<=_&&_<=45991||45993<=_&&_<=46019||46021<=_&&_<=46047||46049<=_&&_<=46075||46077<=_&&_<=46103||46105<=_&&_<=46131||46133<=_&&_<=46159||46161<=_&&_<=46187||46189<=_&&_<=46215||46217<=_&&_<=46243||46245<=_&&_<=46271||46273<=_&&_<=46299||46301<=_&&_<=46327||46329<=_&&_<=46355||46357<=_&&_<=46383||46385<=_&&_<=46411||46413<=_&&_<=46439||46441<=_&&_<=46467||46469<=_&&_<=46495||46497<=_&&_<=46523||46525<=_&&_<=46551||46553<=_&&_<=46579||46581<=_&&_<=46607||46609<=_&&_<=46635||46637<=_&&_<=46663||46665<=_&&_<=46691||46693<=_&&_<=46719||46721<=_&&_<=46747||46749<=_&&_<=46775||46777<=_&&_<=46803||46805<=_&&_<=46831||46833<=_&&_<=46859||46861<=_&&_<=46887||46889<=_&&_<=46915||46917<=_&&_<=46943||46945<=_&&_<=46971||46973<=_&&_<=46999||47001<=_&&_<=47027||47029<=_&&_<=47055||47057<=_&&_<=47083||47085<=_&&_<=47111||47113<=_&&_<=47139||47141<=_&&_<=47167||47169<=_&&_<=47195||47197<=_&&_<=47223||47225<=_&&_<=47251||47253<=_&&_<=47279||47281<=_&&_<=47307||47309<=_&&_<=47335||47337<=_&&_<=47363||47365<=_&&_<=47391||47393<=_&&_<=47419||47421<=_&&_<=47447||47449<=_&&_<=47475||47477<=_&&_<=47503||47505<=_&&_<=47531||47533<=_&&_<=47559||47561<=_&&_<=47587||47589<=_&&_<=47615||47617<=_&&_<=47643||47645<=_&&_<=47671||47673<=_&&_<=47699||47701<=_&&_<=47727||47729<=_&&_<=47755||47757<=_&&_<=47783||47785<=_&&_<=47811||47813<=_&&_<=47839||47841<=_&&_<=47867||47869<=_&&_<=47895||47897<=_&&_<=47923||47925<=_&&_<=47951||47953<=_&&_<=47979||47981<=_&&_<=48007||48009<=_&&_<=48035||48037<=_&&_<=48063||48065<=_&&_<=48091||48093<=_&&_<=48119||48121<=_&&_<=48147||48149<=_&&_<=48175||48177<=_&&_<=48203||48205<=_&&_<=48231||48233<=_&&_<=48259||48261<=_&&_<=48287||48289<=_&&_<=48315||48317<=_&&_<=48343||48345<=_&&_<=48371||48373<=_&&_<=48399||48401<=_&&_<=48427||48429<=_&&_<=48455||48457<=_&&_<=48483||48485<=_&&_<=48511||48513<=_&&_<=48539||48541<=_&&_<=48567||48569<=_&&_<=48595||48597<=_&&_<=48623||48625<=_&&_<=48651||48653<=_&&_<=48679||48681<=_&&_<=48707||48709<=_&&_<=48735||48737<=_&&_<=48763||48765<=_&&_<=48791||48793<=_&&_<=48819||48821<=_&&_<=48847||48849<=_&&_<=48875||48877<=_&&_<=48903||48905<=_&&_<=48931||48933<=_&&_<=48959||48961<=_&&_<=48987||48989<=_&&_<=49015||49017<=_&&_<=49043||49045<=_&&_<=49071||49073<=_&&_<=49099||49101<=_&&_<=49127||49129<=_&&_<=49155||49157<=_&&_<=49183||49185<=_&&_<=49211||49213<=_&&_<=49239||49241<=_&&_<=49267||49269<=_&&_<=49295||49297<=_&&_<=49323||49325<=_&&_<=49351||49353<=_&&_<=49379||49381<=_&&_<=49407||49409<=_&&_<=49435||49437<=_&&_<=49463||49465<=_&&_<=49491||49493<=_&&_<=49519||49521<=_&&_<=49547||49549<=_&&_<=49575||49577<=_&&_<=49603||49605<=_&&_<=49631||49633<=_&&_<=49659||49661<=_&&_<=49687||49689<=_&&_<=49715||49717<=_&&_<=49743||49745<=_&&_<=49771||49773<=_&&_<=49799||49801<=_&&_<=49827||49829<=_&&_<=49855||49857<=_&&_<=49883||49885<=_&&_<=49911||49913<=_&&_<=49939||49941<=_&&_<=49967||49969<=_&&_<=49995||49997<=_&&_<=50023||50025<=_&&_<=50051||50053<=_&&_<=50079||50081<=_&&_<=50107||50109<=_&&_<=50135||50137<=_&&_<=50163||50165<=_&&_<=50191||50193<=_&&_<=50219||50221<=_&&_<=50247||50249<=_&&_<=50275||50277<=_&&_<=50303||50305<=_&&_<=50331||50333<=_&&_<=50359||50361<=_&&_<=50387||50389<=_&&_<=50415||50417<=_&&_<=50443||50445<=_&&_<=50471||50473<=_&&_<=50499||50501<=_&&_<=50527||50529<=_&&_<=50555||50557<=_&&_<=50583||50585<=_&&_<=50611||50613<=_&&_<=50639||50641<=_&&_<=50667||50669<=_&&_<=50695||50697<=_&&_<=50723||50725<=_&&_<=50751||50753<=_&&_<=50779||50781<=_&&_<=50807||50809<=_&&_<=50835||50837<=_&&_<=50863||50865<=_&&_<=50891||50893<=_&&_<=50919||50921<=_&&_<=50947||50949<=_&&_<=50975||50977<=_&&_<=51003||51005<=_&&_<=51031||51033<=_&&_<=51059||51061<=_&&_<=51087||51089<=_&&_<=51115||51117<=_&&_<=51143||51145<=_&&_<=51171||51173<=_&&_<=51199||51201<=_&&_<=51227||51229<=_&&_<=51255||51257<=_&&_<=51283||51285<=_&&_<=51311||51313<=_&&_<=51339||51341<=_&&_<=51367||51369<=_&&_<=51395||51397<=_&&_<=51423||51425<=_&&_<=51451||51453<=_&&_<=51479||51481<=_&&_<=51507||51509<=_&&_<=51535||51537<=_&&_<=51563||51565<=_&&_<=51591||51593<=_&&_<=51619||51621<=_&&_<=51647||51649<=_&&_<=51675||51677<=_&&_<=51703||51705<=_&&_<=51731||51733<=_&&_<=51759||51761<=_&&_<=51787||51789<=_&&_<=51815||51817<=_&&_<=51843||51845<=_&&_<=51871||51873<=_&&_<=51899||51901<=_&&_<=51927||51929<=_&&_<=51955||51957<=_&&_<=51983||51985<=_&&_<=52011||52013<=_&&_<=52039||52041<=_&&_<=52067||52069<=_&&_<=52095||52097<=_&&_<=52123||52125<=_&&_<=52151||52153<=_&&_<=52179||52181<=_&&_<=52207||52209<=_&&_<=52235||52237<=_&&_<=52263||52265<=_&&_<=52291||52293<=_&&_<=52319||52321<=_&&_<=52347||52349<=_&&_<=52375||52377<=_&&_<=52403||52405<=_&&_<=52431||52433<=_&&_<=52459||52461<=_&&_<=52487||52489<=_&&_<=52515||52517<=_&&_<=52543||52545<=_&&_<=52571||52573<=_&&_<=52599||52601<=_&&_<=52627||52629<=_&&_<=52655||52657<=_&&_<=52683||52685<=_&&_<=52711||52713<=_&&_<=52739||52741<=_&&_<=52767||52769<=_&&_<=52795||52797<=_&&_<=52823||52825<=_&&_<=52851||52853<=_&&_<=52879||52881<=_&&_<=52907||52909<=_&&_<=52935||52937<=_&&_<=52963||52965<=_&&_<=52991||52993<=_&&_<=53019||53021<=_&&_<=53047||53049<=_&&_<=53075||53077<=_&&_<=53103||53105<=_&&_<=53131||53133<=_&&_<=53159||53161<=_&&_<=53187||53189<=_&&_<=53215||53217<=_&&_<=53243||53245<=_&&_<=53271||53273<=_&&_<=53299||53301<=_&&_<=53327||53329<=_&&_<=53355||53357<=_&&_<=53383||53385<=_&&_<=53411||53413<=_&&_<=53439||53441<=_&&_<=53467||53469<=_&&_<=53495||53497<=_&&_<=53523||53525<=_&&_<=53551||53553<=_&&_<=53579||53581<=_&&_<=53607||53609<=_&&_<=53635||53637<=_&&_<=53663||53665<=_&&_<=53691||53693<=_&&_<=53719||53721<=_&&_<=53747||53749<=_&&_<=53775||53777<=_&&_<=53803||53805<=_&&_<=53831||53833<=_&&_<=53859||53861<=_&&_<=53887||53889<=_&&_<=53915||53917<=_&&_<=53943||53945<=_&&_<=53971||53973<=_&&_<=53999||54001<=_&&_<=54027||54029<=_&&_<=54055||54057<=_&&_<=54083||54085<=_&&_<=54111||54113<=_&&_<=54139||54141<=_&&_<=54167||54169<=_&&_<=54195||54197<=_&&_<=54223||54225<=_&&_<=54251||54253<=_&&_<=54279||54281<=_&&_<=54307||54309<=_&&_<=54335||54337<=_&&_<=54363||54365<=_&&_<=54391||54393<=_&&_<=54419||54421<=_&&_<=54447||54449<=_&&_<=54475||54477<=_&&_<=54503||54505<=_&&_<=54531||54533<=_&&_<=54559||54561<=_&&_<=54587||54589<=_&&_<=54615||54617<=_&&_<=54643||54645<=_&&_<=54671||54673<=_&&_<=54699||54701<=_&&_<=54727||54729<=_&&_<=54755||54757<=_&&_<=54783||54785<=_&&_<=54811||54813<=_&&_<=54839||54841<=_&&_<=54867||54869<=_&&_<=54895||54897<=_&&_<=54923||54925<=_&&_<=54951||54953<=_&&_<=54979||54981<=_&&_<=55007||55009<=_&&_<=55035||55037<=_&&_<=55063||55065<=_&&_<=55091||55093<=_&&_<=55119||55121<=_&&_<=55147||55149<=_&&_<=55175||55177<=_&&_<=55203?f:_==9757||_==9977||9994<=_&&_<=9997||_==127877||127938<=_&&_<=127940||_==127943||127946<=_&&_<=127948||128066<=_&&_<=128067||128070<=_&&_<=128080||_==128110||128112<=_&&_<=128120||_==128124||128129<=_&&_<=128131||128133<=_&&_<=128135||_==128170||128372<=_&&_<=128373||_==128378||_==128400||128405<=_&&_<=128406||128581<=_&&_<=128583||128587<=_&&_<=128591||_==128675||128692<=_&&_<=128694||_==128704||_==128716||129304<=_&&_<=129308||129310<=_&&_<=129311||_==129318||129328<=_&&_<=129337||129341<=_&&_<=129342||129489<=_&&_<=129501?g:127995<=_&&_<=127999?m:_==8205?b:_==9792||_==9794||9877<=_&&_<=9878||_==9992||_==10084||_==127752||_==127806||_==127859||_==127891||_==127908||_==127912||_==127979||_==127981||_==128139||128187<=_&&_<=128188||_==128295||_==128300||_==128488||_==128640||_==128658?x:128102<=_&&_<=128105?T:d}return this}typeof E1<"u"&&E1.exports&&(E1.exports=C5e)});var Ffe=vu((L6,N6)=>{(function(e,t){typeof L6=="object"&&typeof N6<"u"?N6.exports=t():typeof define=="function"&&define.amd?define(t):(e=e||self).RBush=t()})(L6,function(){"use strict";function e(x,T,C,S,v){(function D(I,L,M,N,B){for(;N>M;){if(N-M>600){var _=N-M+1,w=L-M+1,P=Math.log(_),O=.5*Math.exp(2*P/3),F=.5*Math.sqrt(P*O*(_-O)/_)*(w-_/2<0?-1:1),V=Math.max(M,Math.floor(L-w*O/_+F)),G=Math.min(N,Math.floor(L+(_-w)*O/_+F));D(I,L,V,G,B)}var z=I[L],W=M,U=N;for(t(I,M,L),B(I[N],z)>0&&t(I,M,N);W<U;){for(t(I,W,U),W++,U--;B(I[W],z)<0;)W++;for(;B(I[U],z)>0;)U--}B(I[M],z)===0?t(I,M,U):t(I,++U,N),U<=L&&(M=U+1),L<=U&&(N=U-1)}})(x,T,C||0,S||x.length-1,v||n)}function t(x,T,C){var S=x[T];x[T]=x[C],x[C]=S}function n(x,T){return x<T?-1:x>T?1:0}var i=function(x){x===void 0&&(x=9),this._maxEntries=Math.max(4,x),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function o(x,T,C){if(!C)return T.indexOf(x);for(var S=0;S<T.length;S++)if(C(x,T[S]))return S;return-1}function r(x,T){s(x,0,x.children.length,T,x)}function s(x,T,C,S,v){v||(v=m(null)),v.minX=1/0,v.minY=1/0,v.maxX=-1/0,v.maxY=-1/0;for(var D=T;D<C;D++){var I=x.children[D];a(v,x.leaf?S(I):I)}return v}function a(x,T){return x.minX=Math.min(x.minX,T.minX),x.minY=Math.min(x.minY,T.minY),x.maxX=Math.max(x.maxX,T.maxX),x.maxY=Math.max(x.maxY,T.maxY),x}function l(x,T){return x.minX-T.minX}function u(x,T){return x.minY-T.minY}function f(x){return(x.maxX-x.minX)*(x.maxY-x.minY)}function d(x){return x.maxX-x.minX+(x.maxY-x.minY)}function p(x,T){return x.minX<=T.minX&&x.minY<=T.minY&&T.maxX<=x.maxX&&T.maxY<=x.maxY}function g(x,T){return T.minX<=x.maxX&&T.minY<=x.maxY&&T.maxX>=x.minX&&T.maxY>=x.minY}function m(x){return{children:x,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function b(x,T,C,S,v){for(var D=[T,C];D.length;)if(!((C=D.pop())-(T=D.pop())<=S)){var I=T+Math.ceil((C-T)/S/2)*S;e(x,I,T,C,v),D.push(T,I,I,C)}}return i.prototype.all=function(){return this._all(this.data,[])},i.prototype.search=function(x){var T=this.data,C=[];if(!g(x,T))return C;for(var S=this.toBBox,v=[];T;){for(var D=0;D<T.children.length;D++){var I=T.children[D],L=T.leaf?S(I):I;g(x,L)&&(T.leaf?C.push(I):p(x,L)?this._all(I,C):v.push(I))}T=v.pop()}return C},i.prototype.collides=function(x){var T=this.data;if(!g(x,T))return!1;for(var C=[];T;){for(var S=0;S<T.children.length;S++){var v=T.children[S],D=T.leaf?this.toBBox(v):v;if(g(x,D)){if(T.leaf||p(x,D))return!0;C.push(v)}}T=C.pop()}return!1},i.prototype.load=function(x){if(!x||!x.length)return this;if(x.length<this._minEntries){for(var T=0;T<x.length;T++)this.insert(x[T]);return this}var C=this._build(x.slice(),0,x.length-1,0);if(this.data.children.length)if(this.data.height===C.height)this._splitRoot(this.data,C);else{if(this.data.height<C.height){var S=this.data;this.data=C,C=S}this._insert(C,this.data.height-C.height-1,!0)}else this.data=C;return this},i.prototype.insert=function(x){return x&&this._insert(x,this.data.height-1),this},i.prototype.clear=function(){return this.data=m([]),this},i.prototype.remove=function(x,T){if(!x)return this;for(var C,S,v,D=this.data,I=this.toBBox(x),L=[],M=[];D||L.length;){if(D||(D=L.pop(),S=L[L.length-1],C=M.pop(),v=!0),D.leaf){var N=o(x,D.children,T);if(N!==-1)return D.children.splice(N,1),L.push(D),this._condense(L),this}v||D.leaf||!p(D,I)?S?(C++,D=S.children[C],v=!1):D=null:(L.push(D),M.push(C),C=0,S=D,D=D.children[0])}return this},i.prototype.toBBox=function(x){return x},i.prototype.compareMinX=function(x,T){return x.minX-T.minX},i.prototype.compareMinY=function(x,T){return x.minY-T.minY},i.prototype.toJSON=function(){return this.data},i.prototype.fromJSON=function(x){return this.data=x,this},i.prototype._all=function(x,T){for(var C=[];x;)x.leaf?T.push.apply(T,x.children):C.push.apply(C,x.children),x=C.pop();return T},i.prototype._build=function(x,T,C,S){var v,D=C-T+1,I=this._maxEntries;if(D<=I)return r(v=m(x.slice(T,C+1)),this.toBBox),v;S||(S=Math.ceil(Math.log(D)/Math.log(I)),I=Math.ceil(D/Math.pow(I,S-1))),(v=m([])).leaf=!1,v.height=S;var L=Math.ceil(D/I),M=L*Math.ceil(Math.sqrt(I));b(x,T,C,M,this.compareMinX);for(var N=T;N<=C;N+=M){var B=Math.min(N+M-1,C);b(x,N,B,L,this.compareMinY);for(var _=N;_<=B;_+=L){var w=Math.min(_+L-1,B);v.children.push(this._build(x,_,w,S-1))}}return r(v,this.toBBox),v},i.prototype._chooseSubtree=function(x,T,C,S){for(;S.push(T),!T.leaf&&S.length-1!==C;){for(var v=1/0,D=1/0,I=void 0,L=0;L<T.children.length;L++){var M=T.children[L],N=f(M),B=(_=x,w=M,(Math.max(w.maxX,_.maxX)-Math.min(w.minX,_.minX))*(Math.max(w.maxY,_.maxY)-Math.min(w.minY,_.minY))-N);B<D?(D=B,v=N<v?N:v,I=M):B===D&&N<v&&(v=N,I=M)}T=I||T.children[0]}var _,w;return T},i.prototype._insert=function(x,T,C){var S=C?x:this.toBBox(x),v=[],D=this._chooseSubtree(S,this.data,T,v);for(D.children.push(x),a(D,S);T>=0&&v[T].children.length>this._maxEntries;)this._split(v,T),T--;this._adjustParentBBoxes(S,v,T)},i.prototype._split=function(x,T){var C=x[T],S=C.children.length,v=this._minEntries;this._chooseSplitAxis(C,v,S);var D=this._chooseSplitIndex(C,v,S),I=m(C.children.splice(D,C.children.length-D));I.height=C.height,I.leaf=C.leaf,r(C,this.toBBox),r(I,this.toBBox),T?x[T-1].children.push(I):this._splitRoot(C,I)},i.prototype._splitRoot=function(x,T){this.data=m([x,T]),this.data.height=x.height+1,this.data.leaf=!1,r(this.data,this.toBBox)},i.prototype._chooseSplitIndex=function(x,T,C){for(var S,v,D,I,L,M,N,B=1/0,_=1/0,w=T;w<=C-T;w++){var P=s(x,0,w,this.toBBox),O=s(x,w,C,this.toBBox),F=(v=P,D=O,I=void 0,L=void 0,M=void 0,N=void 0,I=Math.max(v.minX,D.minX),L=Math.max(v.minY,D.minY),M=Math.min(v.maxX,D.maxX),N=Math.min(v.maxY,D.maxY),Math.max(0,M-I)*Math.max(0,N-L)),V=f(P)+f(O);F<B?(B=F,S=w,_=V<_?V:_):F===B&&V<_&&(_=V,S=w)}return S||C-T},i.prototype._chooseSplitAxis=function(x,T,C){var S=x.leaf?this.compareMinX:l,v=x.leaf?this.compareMinY:u;this._allDistMargin(x,T,C,S)<this._allDistMargin(x,T,C,v)&&x.children.sort(S)},i.prototype._allDistMargin=function(x,T,C,S){x.children.sort(S);for(var v=this.toBBox,D=s(x,0,T,v),I=s(x,C-T,C,v),L=d(D)+d(I),M=T;M<C-T;M++){var N=x.children[M];a(D,x.leaf?v(N):N),L+=d(D)}for(var B=C-T-1;B>=T;B--){var _=x.children[B];a(I,x.leaf?v(_):_),L+=d(I)}return L},i.prototype._adjustParentBBoxes=function(x,T,C){for(var S=C;S>=0;S--)a(T[S],x)},i.prototype._condense=function(x){for(var T=x.length-1,C=void 0;T>=0;T--)x[T].children.length===0?T>0?(C=x[T-1].children).splice(C.indexOf(x[T]),1):this.clear():r(x[T],this.toBBox)},i})});var pW=vu((exports,module)=>{/*!
 * protobuf.js v7.4.0 (c) 2016, daniel wirtz
 * compiled thu, 22 aug 2024 20:30:39 utc
 * licensed under the bsd-3-clause license
 * see: https://github.com/dcodeio/protobuf.js for details
 */(function(undefined){"use strict";(function(t,n,i){function o(s){var a=n[s];return a||t[s][0].call(a=n[s]={exports:{}},o,a,a.exports),a.exports}var r=o(i[0]);r.util.global.protobuf=r,typeof define=="function"&&define.amd&&define(["long"],function(s){return s&&s.isLong&&(r.util.Long=s,r.configure()),r}),typeof module=="object"&&module&&module.exports&&(module.exports=r)})({1:[function(e,t,n){"use strict";t.exports=i;function i(o,r){for(var s=new Array(arguments.length-1),a=0,l=2,u=!0;l<arguments.length;)s[a++]=arguments[l++];return new Promise(function(d,p){s[a]=function(m){if(u)if(u=!1,m)p(m);else{for(var b=new Array(arguments.length-1),x=0;x<b.length;)b[x++]=arguments[x];d.apply(null,b)}};try{o.apply(r||null,s)}catch(g){u&&(u=!1,p(g))}})}},{}],2:[function(e,t,n){"use strict";var i=n;i.length=function(u){var f=u.length;if(!f)return 0;for(var d=0;--f%4>1&&u.charAt(f)==="=";)++d;return Math.ceil(u.length*3)/4-d};for(var o=new Array(64),r=new Array(123),s=0;s<64;)r[o[s]=s<26?s+65:s<52?s+71:s<62?s-4:s-59|43]=s++;i.encode=function(u,f,d){for(var p=null,g=[],m=0,b=0,x;f<d;){var T=u[f++];switch(b){case 0:g[m++]=o[T>>2],x=(T&3)<<4,b=1;break;case 1:g[m++]=o[x|T>>4],x=(T&15)<<2,b=2;break;case 2:g[m++]=o[x|T>>6],g[m++]=o[T&63],b=0;break}m>8191&&((p||(p=[])).push(String.fromCharCode.apply(String,g)),m=0)}return b&&(g[m++]=o[x],g[m++]=61,b===1&&(g[m++]=61)),p?(m&&p.push(String.fromCharCode.apply(String,g.slice(0,m))),p.join("")):String.fromCharCode.apply(String,g.slice(0,m))};var a="invalid encoding";i.decode=function(u,f,d){for(var p=d,g=0,m,b=0;b<u.length;){var x=u.charCodeAt(b++);if(x===61&&g>1)break;if((x=r[x])===undefined)throw Error(a);switch(g){case 0:m=x,g=1;break;case 1:f[d++]=m<<2|(x&48)>>4,m=x,g=2;break;case 2:f[d++]=(m&15)<<4|(x&60)>>2,m=x,g=3;break;case 3:f[d++]=(m&3)<<6|x,g=0;break}}if(g===1)throw Error(a);return d-p},i.test=function(u){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(u)}},{}],3:[function(e,t,n){"use strict";t.exports=i;function i(){this._listeners={}}i.prototype.on=function(r,s,a){return(this._listeners[r]||(this._listeners[r]=[])).push({fn:s,ctx:a||this}),this},i.prototype.off=function(r,s){if(r===undefined)this._listeners={};else if(s===undefined)this._listeners[r]=[];else for(var a=this._listeners[r],l=0;l<a.length;)a[l].fn===s?a.splice(l,1):++l;return this},i.prototype.emit=function(r){var s=this._listeners[r];if(s){for(var a=[],l=1;l<arguments.length;)a.push(arguments[l++]);for(l=0;l<s.length;)s[l].fn.apply(s[l++].ctx,a)}return this}},{}],4:[function(e,t,n){"use strict";t.exports=i(i);function i(l){return typeof Float32Array<"u"?function(){var u=new Float32Array([-0]),f=new Uint8Array(u.buffer),d=f[3]===128;function p(x,T,C){u[0]=x,T[C]=f[0],T[C+1]=f[1],T[C+2]=f[2],T[C+3]=f[3]}function g(x,T,C){u[0]=x,T[C]=f[3],T[C+1]=f[2],T[C+2]=f[1],T[C+3]=f[0]}l.writeFloatLE=d?p:g,l.writeFloatBE=d?g:p;function m(x,T){return f[0]=x[T],f[1]=x[T+1],f[2]=x[T+2],f[3]=x[T+3],u[0]}function b(x,T){return f[3]=x[T],f[2]=x[T+1],f[1]=x[T+2],f[0]=x[T+3],u[0]}l.readFloatLE=d?m:b,l.readFloatBE=d?b:m}():function(){function u(d,p,g,m){var b=p<0?1:0;if(b&&(p=-p),p===0)d(1/p>0?0:2147483648,g,m);else if(isNaN(p))d(2143289344,g,m);else if(p>34028234663852886e22)d((b<<31|2139095040)>>>0,g,m);else if(p<11754943508222875e-54)d((b<<31|Math.round(p/1401298464324817e-60))>>>0,g,m);else{var x=Math.floor(Math.log(p)/Math.LN2),T=Math.round(p*Math.pow(2,-x)*8388608)&8388607;d((b<<31|x+127<<23|T)>>>0,g,m)}}l.writeFloatLE=u.bind(null,o),l.writeFloatBE=u.bind(null,r);function f(d,p,g){var m=d(p,g),b=(m>>31)*2+1,x=m>>>23&255,T=m&8388607;return x===255?T?NaN:b*(1/0):x===0?b*1401298464324817e-60*T:b*Math.pow(2,x-150)*(T+8388608)}l.readFloatLE=f.bind(null,s),l.readFloatBE=f.bind(null,a)}(),typeof Float64Array<"u"?function(){var u=new Float64Array([-0]),f=new Uint8Array(u.buffer),d=f[7]===128;function p(x,T,C){u[0]=x,T[C]=f[0],T[C+1]=f[1],T[C+2]=f[2],T[C+3]=f[3],T[C+4]=f[4],T[C+5]=f[5],T[C+6]=f[6],T[C+7]=f[7]}function g(x,T,C){u[0]=x,T[C]=f[7],T[C+1]=f[6],T[C+2]=f[5],T[C+3]=f[4],T[C+4]=f[3],T[C+5]=f[2],T[C+6]=f[1],T[C+7]=f[0]}l.writeDoubleLE=d?p:g,l.writeDoubleBE=d?g:p;function m(x,T){return f[0]=x[T],f[1]=x[T+1],f[2]=x[T+2],f[3]=x[T+3],f[4]=x[T+4],f[5]=x[T+5],f[6]=x[T+6],f[7]=x[T+7],u[0]}function b(x,T){return f[7]=x[T],f[6]=x[T+1],f[5]=x[T+2],f[4]=x[T+3],f[3]=x[T+4],f[2]=x[T+5],f[1]=x[T+6],f[0]=x[T+7],u[0]}l.readDoubleLE=d?m:b,l.readDoubleBE=d?b:m}():function(){function u(d,p,g,m,b,x){var T=m<0?1:0;if(T&&(m=-m),m===0)d(0,b,x+p),d(1/m>0?0:2147483648,b,x+g);else if(isNaN(m))d(0,b,x+p),d(2146959360,b,x+g);else if(m>17976931348623157e292)d(0,b,x+p),d((T<<31|2146435072)>>>0,b,x+g);else{var C;if(m<22250738585072014e-324)C=m/5e-324,d(C>>>0,b,x+p),d((T<<31|C/4294967296)>>>0,b,x+g);else{var S=Math.floor(Math.log(m)/Math.LN2);S===1024&&(S=1023),C=m*Math.pow(2,-S),d(C*4503599627370496>>>0,b,x+p),d((T<<31|S+1023<<20|C*1048576&1048575)>>>0,b,x+g)}}}l.writeDoubleLE=u.bind(null,o,0,4),l.writeDoubleBE=u.bind(null,r,4,0);function f(d,p,g,m,b){var x=d(m,b+p),T=d(m,b+g),C=(T>>31)*2+1,S=T>>>20&2047,v=4294967296*(T&1048575)+x;return S===2047?v?NaN:C*(1/0):S===0?C*5e-324*v:C*Math.pow(2,S-1075)*(v+4503599627370496)}l.readDoubleLE=f.bind(null,s,0,4),l.readDoubleBE=f.bind(null,a,4,0)}(),l}function o(l,u,f){u[f]=l&255,u[f+1]=l>>>8&255,u[f+2]=l>>>16&255,u[f+3]=l>>>24}function r(l,u,f){u[f]=l>>>24,u[f+1]=l>>>16&255,u[f+2]=l>>>8&255,u[f+3]=l&255}function s(l,u){return(l[u]|l[u+1]<<8|l[u+2]<<16|l[u+3]<<24)>>>0}function a(l,u){return(l[u]<<24|l[u+1]<<16|l[u+2]<<8|l[u+3])>>>0}},{}],5:[function(require,module,exports){"use strict";module.exports=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}},{}],6:[function(e,t,n){"use strict";t.exports=i;function i(o,r,s){var a=s||8192,l=a>>>1,u=null,f=a;return function(p){if(p<1||p>l)return o(p);f+p>a&&(u=o(a),f=0);var g=r.call(u,f,f+=p);return f&7&&(f=(f|7)+1),g}}},{}],7:[function(e,t,n){"use strict";var i=n;i.length=function(r){for(var s=0,a=0,l=0;l<r.length;++l)a=r.charCodeAt(l),a<128?s+=1:a<2048?s+=2:(a&64512)===55296&&(r.charCodeAt(l+1)&64512)===56320?(++l,s+=4):s+=3;return s},i.read=function(r,s,a){var l=a-s;if(l<1)return"";for(var u=null,f=[],d=0,p;s<a;)p=r[s++],p<128?f[d++]=p:p>191&&p<224?f[d++]=(p&31)<<6|r[s++]&63:p>239&&p<365?(p=((p&7)<<18|(r[s++]&63)<<12|(r[s++]&63)<<6|r[s++]&63)-65536,f[d++]=55296+(p>>10),f[d++]=56320+(p&1023)):f[d++]=(p&15)<<12|(r[s++]&63)<<6|r[s++]&63,d>8191&&((u||(u=[])).push(String.fromCharCode.apply(String,f)),d=0);return u?(d&&u.push(String.fromCharCode.apply(String,f.slice(0,d))),u.join("")):String.fromCharCode.apply(String,f.slice(0,d))},i.write=function(r,s,a){for(var l=a,u,f,d=0;d<r.length;++d)u=r.charCodeAt(d),u<128?s[a++]=u:u<2048?(s[a++]=u>>6|192,s[a++]=u&63|128):(u&64512)===55296&&((f=r.charCodeAt(d+1))&64512)===56320?(u=65536+((u&1023)<<10)+(f&1023),++d,s[a++]=u>>18|240,s[a++]=u>>12&63|128,s[a++]=u>>6&63|128,s[a++]=u&63|128):(s[a++]=u>>12|224,s[a++]=u>>6&63|128,s[a++]=u&63|128);return a-l}},{}],8:[function(e,t,n){"use strict";var i=n;i.build="minimal",i.Writer=e(16),i.BufferWriter=e(17),i.Reader=e(9),i.BufferReader=e(10),i.util=e(15),i.rpc=e(12),i.roots=e(11),i.configure=o;function o(){i.util._configure(),i.Writer._configure(i.BufferWriter),i.Reader._configure(i.BufferReader)}o()},{10:10,11:11,12:12,15:15,16:16,17:17,9:9}],9:[function(e,t,n){"use strict";t.exports=l;var i=e(15),o,r=i.LongBits,s=i.utf8;function a(m,b){return RangeError("index out of range: "+m.pos+" + "+(b||1)+" > "+m.len)}function l(m){this.buf=m,this.pos=0,this.len=m.length}var u=typeof Uint8Array<"u"?function(b){if(b instanceof Uint8Array||Array.isArray(b))return new l(b);throw Error("illegal buffer")}:function(b){if(Array.isArray(b))return new l(b);throw Error("illegal buffer")},f=function(){return i.Buffer?function(x){return(l.create=function(C){return i.Buffer.isBuffer(C)?new o(C):u(C)})(x)}:u};l.create=f(),l.prototype._slice=i.Array.prototype.subarray||i.Array.prototype.slice,l.prototype.uint32=function(){var b=4294967295;return function(){if(b=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(b=(b|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(b=(b|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(b=(b|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(b=(b|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return b;if((this.pos+=5)>this.len)throw this.pos=this.len,a(this,10);return b}}(),l.prototype.int32=function(){return this.uint32()|0},l.prototype.sint32=function(){var b=this.uint32();return b>>>1^-(b&1)|0};function d(){var m=new r(0,0),b=0;if(this.len-this.pos>4){for(;b<4;++b)if(m.lo=(m.lo|(this.buf[this.pos]&127)<<b*7)>>>0,this.buf[this.pos++]<128)return m;if(m.lo=(m.lo|(this.buf[this.pos]&127)<<28)>>>0,m.hi=(m.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return m;b=0}else{for(;b<3;++b){if(this.pos>=this.len)throw a(this);if(m.lo=(m.lo|(this.buf[this.pos]&127)<<b*7)>>>0,this.buf[this.pos++]<128)return m}return m.lo=(m.lo|(this.buf[this.pos++]&127)<<b*7)>>>0,m}if(this.len-this.pos>4){for(;b<5;++b)if(m.hi=(m.hi|(this.buf[this.pos]&127)<<b*7+3)>>>0,this.buf[this.pos++]<128)return m}else for(;b<5;++b){if(this.pos>=this.len)throw a(this);if(m.hi=(m.hi|(this.buf[this.pos]&127)<<b*7+3)>>>0,this.buf[this.pos++]<128)return m}throw Error("invalid varint encoding")}l.prototype.bool=function(){return this.uint32()!==0};function p(m,b){return(m[b-4]|m[b-3]<<8|m[b-2]<<16|m[b-1]<<24)>>>0}l.prototype.fixed32=function(){if(this.pos+4>this.len)throw a(this,4);return p(this.buf,this.pos+=4)},l.prototype.sfixed32=function(){if(this.pos+4>this.len)throw a(this,4);return p(this.buf,this.pos+=4)|0};function g(){if(this.pos+8>this.len)throw a(this,8);return new r(p(this.buf,this.pos+=4),p(this.buf,this.pos+=4))}l.prototype.float=function(){if(this.pos+4>this.len)throw a(this,4);var b=i.float.readFloatLE(this.buf,this.pos);return this.pos+=4,b},l.prototype.double=function(){if(this.pos+8>this.len)throw a(this,4);var b=i.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,b},l.prototype.bytes=function(){var b=this.uint32(),x=this.pos,T=this.pos+b;if(T>this.len)throw a(this,b);if(this.pos+=b,Array.isArray(this.buf))return this.buf.slice(x,T);if(x===T){var C=i.Buffer;return C?C.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,x,T)},l.prototype.string=function(){var b=this.bytes();return s.read(b,0,b.length)},l.prototype.skip=function(b){if(typeof b=="number"){if(this.pos+b>this.len)throw a(this,b);this.pos+=b}else do if(this.pos>=this.len)throw a(this);while(this.buf[this.pos++]&128);return this},l.prototype.skipType=function(m){switch(m){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(m=this.uint32()&7)!==4;)this.skipType(m);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+m+" at offset "+this.pos)}return this},l._configure=function(m){o=m,l.create=f(),o._configure();var b=i.Long?"toLong":"toNumber";i.merge(l.prototype,{int64:function(){return d.call(this)[b](!1)},uint64:function(){return d.call(this)[b](!0)},sint64:function(){return d.call(this).zzDecode()[b](!1)},fixed64:function(){return g.call(this)[b](!0)},sfixed64:function(){return g.call(this)[b](!1)}})}},{15:15}],10:[function(e,t,n){"use strict";t.exports=r;var i=e(9);(r.prototype=Object.create(i.prototype)).constructor=r;var o=e(15);function r(s){i.call(this,s)}r._configure=function(){o.Buffer&&(r.prototype._slice=o.Buffer.prototype.slice)},r.prototype.string=function(){var a=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+a,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+a,this.len))},r._configure()},{15:15,9:9}],11:[function(e,t,n){"use strict";t.exports={}},{}],12:[function(e,t,n){"use strict";var i=n;i.Service=e(13)},{13:13}],13:[function(e,t,n){"use strict";t.exports=o;var i=e(15);(o.prototype=Object.create(i.EventEmitter.prototype)).constructor=o;function o(r,s,a){if(typeof r!="function")throw TypeError("rpcImpl must be a function");i.EventEmitter.call(this),this.rpcImpl=r,this.requestDelimited=!!s,this.responseDelimited=!!a}o.prototype.rpcCall=function r(s,a,l,u,f){if(!u)throw TypeError("request must be specified");var d=this;if(!f)return i.asPromise(r,d,s,a,l,u);if(!d.rpcImpl)return setTimeout(function(){f(Error("already ended"))},0),undefined;try{return d.rpcImpl(s,a[d.requestDelimited?"encodeDelimited":"encode"](u).finish(),function(g,m){if(g)return d.emit("error",g,s),f(g);if(m===null)return d.end(!0),undefined;if(!(m instanceof l))try{m=l[d.responseDelimited?"decodeDelimited":"decode"](m)}catch(b){return d.emit("error",b,s),f(b)}return d.emit("data",m,s),f(null,m)})}catch(p){return d.emit("error",p,s),setTimeout(function(){f(p)},0),undefined}},o.prototype.end=function(s){return this.rpcImpl&&(s||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},{15:15}],14:[function(e,t,n){"use strict";t.exports=o;var i=e(15);function o(l,u){this.lo=l>>>0,this.hi=u>>>0}var r=o.zero=new o(0,0);r.toNumber=function(){return 0},r.zzEncode=r.zzDecode=function(){return this},r.length=function(){return 1};var s=o.zeroHash="\0\0\0\0\0\0\0\0";o.fromNumber=function(u){if(u===0)return r;var f=u<0;f&&(u=-u);var d=u>>>0,p=(u-d)/4294967296>>>0;return f&&(p=~p>>>0,d=~d>>>0,++d>4294967295&&(d=0,++p>4294967295&&(p=0))),new o(d,p)},o.from=function(u){if(typeof u=="number")return o.fromNumber(u);if(i.isString(u))if(i.Long)u=i.Long.fromString(u);else return o.fromNumber(parseInt(u,10));return u.low||u.high?new o(u.low>>>0,u.high>>>0):r},o.prototype.toNumber=function(u){if(!u&&this.hi>>>31){var f=~this.lo+1>>>0,d=~this.hi>>>0;return f||(d=d+1>>>0),-(f+d*4294967296)}return this.lo+this.hi*4294967296},o.prototype.toLong=function(u){return i.Long?new i.Long(this.lo|0,this.hi|0,!!u):{low:this.lo|0,high:this.hi|0,unsigned:!!u}};var a=String.prototype.charCodeAt;o.fromHash=function(u){return u===s?r:new o((a.call(u,0)|a.call(u,1)<<8|a.call(u,2)<<16|a.call(u,3)<<24)>>>0,(a.call(u,4)|a.call(u,5)<<8|a.call(u,6)<<16|a.call(u,7)<<24)>>>0)},o.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},o.prototype.zzEncode=function(){var u=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^u)>>>0,this.lo=(this.lo<<1^u)>>>0,this},o.prototype.zzDecode=function(){var u=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^u)>>>0,this.hi=(this.hi>>>1^u)>>>0,this},o.prototype.length=function(){var u=this.lo,f=(this.lo>>>28|this.hi<<4)>>>0,d=this.hi>>>24;return d===0?f===0?u<16384?u<128?1:2:u<2097152?3:4:f<16384?f<128?5:6:f<2097152?7:8:d<128?9:10}},{15:15}],15:[function(e,t,n){"use strict";var i=n;i.asPromise=e(1),i.base64=e(2),i.EventEmitter=e(3),i.float=e(4),i.inquire=e(5),i.utf8=e(7),i.pool=e(6),i.LongBits=e(14),i.isNode=!!(typeof global<"u"&&global&&global.process&&global.process.versions&&global.process.versions.node),i.global=i.isNode&&global||typeof window<"u"&&window||typeof self<"u"&&self||this,i.emptyArray=Object.freeze?Object.freeze([]):[],i.emptyObject=Object.freeze?Object.freeze({}):{},i.isInteger=Number.isInteger||function(a){return typeof a=="number"&&isFinite(a)&&Math.floor(a)===a},i.isString=function(a){return typeof a=="string"||a instanceof String},i.isObject=function(a){return a&&typeof a=="object"},i.isset=i.isSet=function(a,l){var u=a[l];return u!=null&&a.hasOwnProperty(l)?typeof u!="object"||(Array.isArray(u)?u.length:Object.keys(u).length)>0:!1},i.Buffer=function(){try{var s=i.inquire("buffer").Buffer;return s.prototype.utf8Write?s:null}catch{return null}}(),i._Buffer_from=null,i._Buffer_allocUnsafe=null,i.newBuffer=function(a){return typeof a=="number"?i.Buffer?i._Buffer_allocUnsafe(a):new i.Array(a):i.Buffer?i._Buffer_from(a):typeof Uint8Array>"u"?a:new Uint8Array(a)},i.Array=typeof Uint8Array<"u"?Uint8Array:Array,i.Long=i.global.dcodeIO&&i.global.dcodeIO.Long||i.global.Long||i.inquire("long"),i.key2Re=/^true|false|0|1$/,i.key32Re=/^-?(?:0|[1-9][0-9]*)$/,i.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,i.longToHash=function(a){return a?i.LongBits.from(a).toHash():i.LongBits.zeroHash},i.longFromHash=function(a,l){var u=i.LongBits.fromHash(a);return i.Long?i.Long.fromBits(u.lo,u.hi,l):u.toNumber(!!l)};function o(s,a,l){for(var u=Object.keys(a),f=0;f<u.length;++f)(s[u[f]]===undefined||!l)&&(s[u[f]]=a[u[f]]);return s}i.merge=o,i.lcFirst=function(a){return a.charAt(0).toLowerCase()+a.substring(1)};function r(s){function a(l,u){if(!(this instanceof a))return new a(l,u);Object.defineProperty(this,"message",{get:function(){return l}}),Error.captureStackTrace?Error.captureStackTrace(this,a):Object.defineProperty(this,"stack",{value:new Error().stack||""}),u&&o(this,u)}return a.prototype=Object.create(Error.prototype,{constructor:{value:a,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return s},set:undefined,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),a}i.newError=r,i.ProtocolError=r("ProtocolError"),i.oneOfGetter=function(a){for(var l={},u=0;u<a.length;++u)l[a[u]]=1;return function(){for(var f=Object.keys(this),d=f.length-1;d>-1;--d)if(l[f[d]]===1&&this[f[d]]!==undefined&&this[f[d]]!==null)return f[d]}},i.oneOfSetter=function(a){return function(l){for(var u=0;u<a.length;++u)a[u]!==l&&delete this[a[u]]}},i.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},i._configure=function(){var s=i.Buffer;if(!s){i._Buffer_from=i._Buffer_allocUnsafe=null;return}i._Buffer_from=s.from!==Uint8Array.from&&s.from||function(l,u){return new s(l,u)},i._Buffer_allocUnsafe=s.allocUnsafe||function(l){return new s(l)}}},{1:1,14:14,2:2,3:3,4:4,5:5,6:6,7:7}],16:[function(e,t,n){"use strict";t.exports=d;var i=e(15),o,r=i.LongBits,s=i.base64,a=i.utf8;function l(S,v,D){this.fn=S,this.len=v,this.next=undefined,this.val=D}function u(){}function f(S){this.head=S.head,this.tail=S.tail,this.len=S.len,this.next=S.states}function d(){this.len=0,this.head=new l(u,0,0),this.tail=this.head,this.states=null}var p=function(){return i.Buffer?function(){return(d.create=function(){return new o})()}:function(){return new d}};d.create=p(),d.alloc=function(v){return new i.Array(v)},i.Array!==Array&&(d.alloc=i.pool(d.alloc,i.Array.prototype.subarray)),d.prototype._push=function(v,D,I){return this.tail=this.tail.next=new l(v,D,I),this.len+=D,this};function g(S,v,D){v[D]=S&255}function m(S,v,D){for(;S>127;)v[D++]=S&127|128,S>>>=7;v[D]=S}function b(S,v){this.len=S,this.next=undefined,this.val=v}b.prototype=Object.create(l.prototype),b.prototype.fn=m,d.prototype.uint32=function(v){return this.len+=(this.tail=this.tail.next=new b((v=v>>>0)<128?1:v<16384?2:v<2097152?3:v<268435456?4:5,v)).len,this},d.prototype.int32=function(v){return v<0?this._push(x,10,r.fromNumber(v)):this.uint32(v)},d.prototype.sint32=function(v){return this.uint32((v<<1^v>>31)>>>0)};function x(S,v,D){for(;S.hi;)v[D++]=S.lo&127|128,S.lo=(S.lo>>>7|S.hi<<25)>>>0,S.hi>>>=7;for(;S.lo>127;)v[D++]=S.lo&127|128,S.lo=S.lo>>>7;v[D++]=S.lo}d.prototype.uint64=function(v){var D=r.from(v);return this._push(x,D.length(),D)},d.prototype.int64=d.prototype.uint64,d.prototype.sint64=function(v){var D=r.from(v).zzEncode();return this._push(x,D.length(),D)},d.prototype.bool=function(v){return this._push(g,1,v?1:0)};function T(S,v,D){v[D]=S&255,v[D+1]=S>>>8&255,v[D+2]=S>>>16&255,v[D+3]=S>>>24}d.prototype.fixed32=function(v){return this._push(T,4,v>>>0)},d.prototype.sfixed32=d.prototype.fixed32,d.prototype.fixed64=function(v){var D=r.from(v);return this._push(T,4,D.lo)._push(T,4,D.hi)},d.prototype.sfixed64=d.prototype.fixed64,d.prototype.float=function(v){return this._push(i.float.writeFloatLE,4,v)},d.prototype.double=function(v){return this._push(i.float.writeDoubleLE,8,v)};var C=i.Array.prototype.set?function(v,D,I){D.set(v,I)}:function(v,D,I){for(var L=0;L<v.length;++L)D[I+L]=v[L]};d.prototype.bytes=function(v){var D=v.length>>>0;if(!D)return this._push(g,1,0);if(i.isString(v)){var I=d.alloc(D=s.length(v));s.decode(v,I,0),v=I}return this.uint32(D)._push(C,D,v)},d.prototype.string=function(v){var D=a.length(v);return D?this.uint32(D)._push(a.write,D,v):this._push(g,1,0)},d.prototype.fork=function(){return this.states=new f(this),this.head=this.tail=new l(u,0,0),this.len=0,this},d.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new l(u,0,0),this.len=0),this},d.prototype.ldelim=function(){var v=this.head,D=this.tail,I=this.len;return this.reset().uint32(I),I&&(this.tail.next=v.next,this.tail=D,this.len+=I),this},d.prototype.finish=function(){for(var v=this.head.next,D=this.constructor.alloc(this.len),I=0;v;)v.fn(v.val,D,I),I+=v.len,v=v.next;return D},d._configure=function(S){o=S,d.create=p(),o._configure()}},{15:15}],17:[function(e,t,n){"use strict";t.exports=r;var i=e(16);(r.prototype=Object.create(i.prototype)).constructor=r;var o=e(15);function r(){i.call(this)}r._configure=function(){r.alloc=o._Buffer_allocUnsafe,r.writeBytesBuffer=o.Buffer&&o.Buffer.prototype instanceof Uint8Array&&o.Buffer.prototype.set.name==="set"?function(l,u,f){u.set(l,f)}:function(l,u,f){if(l.copy)l.copy(u,f,0,l.length);else for(var d=0;d<l.length;)u[f++]=l[d++]}},r.prototype.bytes=function(l){o.isString(l)&&(l=o._Buffer_from(l,"base64"));var u=l.length>>>0;return this.uint32(u),u&&this._push(r.writeBytesBuffer,u,l),this};function s(a,l,u){a.length<40?o.utf8.write(a,l,u):l.utf8Write?l.utf8Write(a,u):l.write(a,u)}r.prototype.string=function(l){var u=o.Buffer.byteLength(l);return this.uint32(u),u&&this._push(s,u,l),this},r._configure()},{15:15,16:16}]},{},[8])})()});var mbe=vu((sBi,BN)=>{/* Copyright 2015-2018 Esri. Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0 @preserve */(function(){var e=function(){var o={};o.defaultNoDataValue=-34027999387901484e22,o.decode=function(f,d){d=d||{};var p=d.encodedMaskData||d.encodedMaskData===null,g=l(f,d.inputOffset||0,p),m=d.noDataValue!==null?d.noDataValue:o.defaultNoDataValue,b=r(g,d.pixelType||Float32Array,d.encodedMaskData,m,d.returnMask),x={width:g.width,height:g.height,pixelData:b.resultPixels,minValue:b.minValue,maxValue:g.pixels.maxValue,noDataValue:m};return b.resultMask&&(x.maskData=b.resultMask),d.returnEncodedMask&&g.mask&&(x.encodedMaskData=g.mask.bitset?g.mask.bitset:null),d.returnFileInfo&&(x.fileInfo=s(g),d.computeUsedBitDepths&&(x.fileInfo.bitDepths=a(g))),x};var r=function(f,d,p,g,m){var b=0,x=f.pixels.numBlocksX,T=f.pixels.numBlocksY,C=Math.floor(f.width/x),S=Math.floor(f.height/T),v=2*f.maxZError,D=Number.MAX_VALUE,I;p=p||(f.mask?f.mask.bitset:null);var L,M;L=new d(f.width*f.height),m&&p&&(M=new Uint8Array(f.width*f.height));for(var N=new Float32Array(C*S),B,_,w=0;w<=T;w++){var P=w!==T?S:f.height%T;if(P!==0)for(var O=0;O<=x;O++){var F=O!==x?C:f.width%x;if(F!==0){var V=w*f.width*S+O*C,G=f.width-F,z=f.pixels.blocks[b],W,U,q;z.encoding<2?(z.encoding===0?W=z.rawData:(u(z.stuffedData,z.bitsPerPixel,z.numValidPixels,z.offset,v,N,f.pixels.maxValue),W=N),U=0):z.encoding===2?q=0:q=z.offset;var K;if(p)for(_=0;_<P;_++){for(V&7&&(K=p[V>>3],K<<=V&7),B=0;B<F;B++)V&7||(K=p[V>>3]),K&128?(M&&(M[V]=1),I=z.encoding<2?W[U++]:q,D=D>I?I:D,L[V++]=I):(M&&(M[V]=0),L[V++]=g),K<<=1;V+=G}else if(z.encoding<2)for(_=0;_<P;_++){for(B=0;B<F;B++)I=W[U++],D=D>I?I:D,L[V++]=I;V+=G}else for(D=D>q?q:D,_=0;_<P;_++){for(B=0;B<F;B++)L[V++]=q;V+=G}if(z.encoding===1&&U!==z.numValidPixels)throw"Block and Mask do not match";b++}}}return{resultPixels:L,resultMask:M,minValue:D}},s=function(f){return{fileIdentifierString:f.fileIdentifierString,fileVersion:f.fileVersion,imageType:f.imageType,height:f.height,width:f.width,maxZError:f.maxZError,eofOffset:f.eofOffset,mask:f.mask?{numBlocksX:f.mask.numBlocksX,numBlocksY:f.mask.numBlocksY,numBytes:f.mask.numBytes,maxValue:f.mask.maxValue}:null,pixels:{numBlocksX:f.pixels.numBlocksX,numBlocksY:f.pixels.numBlocksY,numBytes:f.pixels.numBytes,maxValue:f.pixels.maxValue,noDataValue:f.noDataValue}}},a=function(f){for(var d=f.pixels.numBlocksX*f.pixels.numBlocksY,p={},g=0;g<d;g++){var m=f.pixels.blocks[g];m.encoding===0?p.float32=!0:m.encoding===1?p[m.bitsPerPixel]=!0:p[0]=!0}return Object.keys(p)},l=function(f,d,p){var g={},m=new Uint8Array(f,d,10);if(g.fileIdentifierString=String.fromCharCode.apply(null,m),g.fileIdentifierString.trim()!=="CntZImage")throw"Unexpected file identifier string: "+g.fileIdentifierString;d+=10;var b=new DataView(f,d,24);if(g.fileVersion=b.getInt32(0,!0),g.imageType=b.getInt32(4,!0),g.height=b.getUint32(8,!0),g.width=b.getUint32(12,!0),g.maxZError=b.getFloat64(16,!0),d+=24,!p)if(b=new DataView(f,d,16),g.mask={},g.mask.numBlocksY=b.getUint32(0,!0),g.mask.numBlocksX=b.getUint32(4,!0),g.mask.numBytes=b.getUint32(8,!0),g.mask.maxValue=b.getFloat32(12,!0),d+=16,g.mask.numBytes>0){var x=new Uint8Array(Math.ceil(g.width*g.height/8));b=new DataView(f,d,g.mask.numBytes);var T=b.getInt16(0,!0),C=2,S=0;do{if(T>0)for(;T--;)x[S++]=b.getUint8(C++);else{var v=b.getUint8(C++);for(T=-T;T--;)x[S++]=v}T=b.getInt16(C,!0),C+=2}while(C<g.mask.numBytes);if(T!==-32768||S<x.length)throw"Unexpected end of mask RLE encoding";g.mask.bitset=x,d+=g.mask.numBytes}else g.mask.numBytes|g.mask.numBlocksY|g.mask.maxValue||(g.mask.bitset=new Uint8Array(Math.ceil(g.width*g.height/8)));b=new DataView(f,d,16),g.pixels={},g.pixels.numBlocksY=b.getUint32(0,!0),g.pixels.numBlocksX=b.getUint32(4,!0),g.pixels.numBytes=b.getUint32(8,!0),g.pixels.maxValue=b.getFloat32(12,!0),d+=16;var D=g.pixels.numBlocksX,I=g.pixels.numBlocksY,L=D+(g.width%D>0?1:0),M=I+(g.height%I>0?1:0);g.pixels.blocks=new Array(L*M);for(var N=0,B=0;B<M;B++)for(var _=0;_<L;_++){var w=0,P=f.byteLength-d;b=new DataView(f,d,Math.min(10,P));var O={};g.pixels.blocks[N++]=O;var F=b.getUint8(0);if(w++,O.encoding=F&63,O.encoding>3)throw"Invalid block encoding ("+O.encoding+")";if(O.encoding===2){d++;continue}if(F!==0&&F!==2){if(F>>=6,O.offsetType=F,F===2)O.offset=b.getInt8(1),w++;else if(F===1)O.offset=b.getInt16(1,!0),w+=2;else if(F===0)O.offset=b.getFloat32(1,!0),w+=4;else throw"Invalid block offset type";if(O.encoding===1)if(F=b.getUint8(w),w++,O.bitsPerPixel=F&63,F>>=6,O.numValidPixelsType=F,F===2)O.numValidPixels=b.getUint8(w),w++;else if(F===1)O.numValidPixels=b.getUint16(w,!0),w+=2;else if(F===0)O.numValidPixels=b.getUint32(w,!0),w+=4;else throw"Invalid valid pixel count type"}if(d+=w,O.encoding!==3){var V,G;if(O.encoding===0){var z=(g.pixels.numBytes-1)/4;if(z!==Math.floor(z))throw"uncompressed block has invalid length";V=new ArrayBuffer(z*4),G=new Uint8Array(V),G.set(new Uint8Array(f,d,z*4));var W=new Float32Array(V);O.rawData=W,d+=z*4}else if(O.encoding===1){var U=Math.ceil(O.numValidPixels*O.bitsPerPixel/8),q=Math.ceil(U/4);V=new ArrayBuffer(q*4),G=new Uint8Array(V),G.set(new Uint8Array(f,d,U)),O.stuffedData=new Uint32Array(V),d+=U}}}return g.eofOffset=d,g},u=function(f,d,p,g,m,b,x){var T=(1<<d)-1,C=0,S,v=0,D,I,L=Math.ceil((x-g)/m),M=f.length*4-Math.ceil(d*p/8);for(f[f.length-1]<<=8*M,S=0;S<p;S++){if(v===0&&(I=f[C++],v=32),v>=d)D=I>>>v-d&T,v-=d;else{var N=d-v;D=(I&T)<<N&T,I=f[C++],v=32-N,D+=I>>>v}b[S]=D<L?g+D*m:x}return b};return o}(),t=function(){"use strict";var o={unstuff:function(l,u,f,d,p,g,m,b){var x=(1<<f)-1,T=0,C,S=0,v,D,I,L,M=l.length*4-Math.ceil(f*d/8);if(l[l.length-1]<<=8*M,p)for(C=0;C<d;C++)S===0&&(D=l[T++],S=32),S>=f?(v=D>>>S-f&x,S-=f):(I=f-S,v=(D&x)<<I&x,D=l[T++],S=32-I,v+=D>>>S),u[C]=p[v];else for(L=Math.ceil((b-g)/m),C=0;C<d;C++)S===0&&(D=l[T++],S=32),S>=f?(v=D>>>S-f&x,S-=f):(I=f-S,v=(D&x)<<I&x,D=l[T++],S=32-I,v+=D>>>S),u[C]=v<L?g+v*m:b},unstuffLUT:function(l,u,f,d,p,g){var m=(1<<u)-1,b=0,x=0,T=0,C=0,S=0,v,D=[],I=l.length*4-Math.ceil(u*f/8);l[l.length-1]<<=8*I;var L=Math.ceil((g-d)/p);for(x=0;x<f;x++)C===0&&(v=l[b++],C=32),C>=u?(S=v>>>C-u&m,C-=u):(T=u-C,S=(v&m)<<T&m,v=l[b++],C=32-T,S+=v>>>C),D[x]=S<L?d+S*p:g;return D.unshift(d),D},unstuff2:function(l,u,f,d,p,g,m,b){var x=(1<<f)-1,T=0,C,S=0,v=0,D,I,L;if(p)for(C=0;C<d;C++)S===0&&(I=l[T++],S=32,v=0),S>=f?(D=I>>>v&x,S-=f,v+=f):(L=f-S,D=I>>>v&x,I=l[T++],S=32-L,D|=(I&(1<<L)-1)<<f-L,v=L),u[C]=p[D];else{var M=Math.ceil((b-g)/m);for(C=0;C<d;C++)S===0&&(I=l[T++],S=32,v=0),S>=f?(D=I>>>v&x,S-=f,v+=f):(L=f-S,D=I>>>v&x,I=l[T++],S=32-L,D|=(I&(1<<L)-1)<<f-L,v=L),u[C]=D<M?g+D*m:b}return u},unstuffLUT2:function(l,u,f,d,p,g){var m=(1<<u)-1,b=0,x=0,T=0,C=0,S=0,v=0,D,I=[],L=Math.ceil((g-d)/p);for(x=0;x<f;x++)C===0&&(D=l[b++],C=32,v=0),C>=u?(S=D>>>v&m,C-=u,v+=u):(T=u-C,S=D>>>v&m,D=l[b++],C=32-T,S|=(D&(1<<T)-1)<<u-T,v=T),I[x]=S<L?d+S*p:g;return I.unshift(d),I},originalUnstuff:function(l,u,f,d){var p=(1<<f)-1,g=0,m,b=0,x,T,C,S=l.length*4-Math.ceil(f*d/8);for(l[l.length-1]<<=8*S,m=0;m<d;m++)b===0&&(T=l[g++],b=32),b>=f?(x=T>>>b-f&p,b-=f):(C=f-b,x=(T&p)<<C&p,T=l[g++],b=32-C,x+=T>>>b),u[m]=x;return u},originalUnstuff2:function(l,u,f,d){var p=(1<<f)-1,g=0,m,b=0,x=0,T,C,S;for(m=0;m<d;m++)b===0&&(C=l[g++],b=32,x=0),b>=f?(T=C>>>x&p,b-=f,x+=f):(S=f-b,T=C>>>x&p,C=l[g++],b=32-S,T|=(C&(1<<S)-1)<<f-S,x=S),u[m]=T;return u}},r={HUFFMAN_LUT_BITS_MAX:12,computeChecksumFletcher32:function(l){for(var u=65535,f=65535,d=l.length,p=Math.floor(d/2),g=0;p;){var m=p>=359?359:p;p-=m;do u+=l[g++]<<8,f+=u+=l[g++];while(--m);u=(u&65535)+(u>>>16),f=(f&65535)+(f>>>16)}return d&1&&(f+=u+=l[g]<<8),u=(u&65535)+(u>>>16),f=(f&65535)+(f>>>16),(f<<16|u)>>>0},readHeaderInfo:function(l,u){var f=u.ptr,d=new Uint8Array(l,f,6),p={};if(p.fileIdentifierString=String.fromCharCode.apply(null,d),p.fileIdentifierString.lastIndexOf("Lerc2",0)!==0)throw"Unexpected file identifier string (expect Lerc2 ): "+p.fileIdentifierString;f+=6;var g=new DataView(l,f,8),m=g.getInt32(0,!0);p.fileVersion=m,f+=4,m>=3&&(p.checksum=g.getUint32(4,!0),f+=4),g=new DataView(l,f,12),p.height=g.getUint32(0,!0),p.width=g.getUint32(4,!0),f+=8,m>=4?(p.numDims=g.getUint32(8,!0),f+=4):p.numDims=1,g=new DataView(l,f,40),p.numValidPixel=g.getUint32(0,!0),p.microBlockSize=g.getInt32(4,!0),p.blobSize=g.getInt32(8,!0),p.imageType=g.getInt32(12,!0),p.maxZError=g.getFloat64(16,!0),p.zMin=g.getFloat64(24,!0),p.zMax=g.getFloat64(32,!0),f+=40,u.headerInfo=p,u.ptr=f;var b,x;if(m>=3&&(x=m>=4?52:48,b=this.computeChecksumFletcher32(new Uint8Array(l,f-x,p.blobSize-14)),b!==p.checksum))throw"Checksum failed.";return!0},checkMinMaxRanges:function(l,u){var f=u.headerInfo,d=this.getDataTypeArray(f.imageType),p=f.numDims*this.getDataTypeSize(f.imageType),g=this.readSubArray(l,u.ptr,d,p),m=this.readSubArray(l,u.ptr+p,d,p);u.ptr+=2*p;var b,x=!0;for(b=0;b<f.numDims;b++)if(g[b]!==m[b]){x=!1;break}return f.minValues=g,f.maxValues=m,x},readSubArray:function(l,u,f,d){var p;if(f===Uint8Array)p=new Uint8Array(l,u,d);else{var g=new ArrayBuffer(d),m=new Uint8Array(g);m.set(new Uint8Array(l,u,d)),p=new f(g)}return p},readMask:function(l,u){var f=u.ptr,d=u.headerInfo,p=d.width*d.height,g=d.numValidPixel,m=new DataView(l,f,4),b={};if(b.numBytes=m.getUint32(0,!0),f+=4,(g===0||p===g)&&b.numBytes!==0)throw"invalid mask";var x,T;if(g===0)x=new Uint8Array(Math.ceil(p/8)),b.bitset=x,T=new Uint8Array(p),u.pixels.resultMask=T,f+=b.numBytes;else if(b.numBytes>0){x=new Uint8Array(Math.ceil(p/8)),m=new DataView(l,f,b.numBytes);var C=m.getInt16(0,!0),S=2,v=0,D=0;do{if(C>0)for(;C--;)x[v++]=m.getUint8(S++);else for(D=m.getUint8(S++),C=-C;C--;)x[v++]=D;C=m.getInt16(S,!0),S+=2}while(S<b.numBytes);if(C!==-32768||v<x.length)throw"Unexpected end of mask RLE encoding";T=new Uint8Array(p);var I=0,L=0;for(L=0;L<p;L++)L&7?(I=x[L>>3],I<<=L&7):I=x[L>>3],I&128&&(T[L]=1);u.pixels.resultMask=T,b.bitset=x,f+=b.numBytes}return u.ptr=f,u.mask=b,!0},readDataOneSweep:function(l,u,f){var d=u.ptr,p=u.headerInfo,g=p.numDims,m=p.width*p.height,b=p.imageType,x=p.numValidPixel*r.getDataTypeSize(b)*g,T,C=u.pixels.resultMask;if(f===Uint8Array)T=new Uint8Array(l,d,x);else{var S=new ArrayBuffer(x),v=new Uint8Array(S);v.set(new Uint8Array(l,d,x)),T=new f(S)}if(T.length===m*g)u.pixels.resultPixels=T;else{u.pixels.resultPixels=new f(m*g);var D=0,I=0,L=0,M=0;if(g>1)for(L=0;L<g;L++)for(M=L*m,I=0;I<m;I++)C[I]&&(u.pixels.resultPixels[M+I]=T[D++]);else for(I=0;I<m;I++)C[I]&&(u.pixels.resultPixels[I]=T[D++])}return d+=x,u.ptr=d,!0},readHuffmanTree:function(l,u){var f=this.HUFFMAN_LUT_BITS_MAX,d=new DataView(l,u.ptr,16);u.ptr+=16;var p=d.getInt32(0,!0);if(p<2)throw"unsupported Huffman version";var g=d.getInt32(4,!0),m=d.getInt32(8,!0),b=d.getInt32(12,!0);if(m>=b)return!1;var x=new Uint32Array(b-m);r.decodeBits(l,u,x);var T=[],C,S,v,D;for(C=m;C<b;C++)S=C-(C<g?0:g),T[S]={first:x[C-m],second:null};var I=l.byteLength-u.ptr,L=Math.ceil(I/4),M=new ArrayBuffer(L*4),N=new Uint8Array(M);N.set(new Uint8Array(l,u.ptr,I));var B=new Uint32Array(M),_=0,w,P=0;for(w=B[0],C=m;C<b;C++)S=C-(C<g?0:g),D=T[S].first,D>0&&(T[S].second=w<<_>>>32-D,32-_>=D?(_+=D,_===32&&(_=0,P++,w=B[P])):(_+=D-32,P++,w=B[P],T[S].second|=w>>>32-_));var O=0,F=0,V=new s;for(C=0;C<T.length;C++)T[C]!==void 0&&(O=Math.max(O,T[C].first));O>=f?F=f:F=O,O>=30&&console.log("WARning, large NUM LUT BITS IS "+O);var G=[],z,W,U,q,K,te;for(C=m;C<b;C++)if(S=C-(C<g?0:g),D=T[S].first,D>0)if(z=[D,S],D<=F)for(W=T[S].second<<F-D,U=1<<F-D,v=0;v<U;v++)G[W|v]=z;else for(W=T[S].second,te=V,q=D-1;q>=0;q--)K=W>>>q&1,K?(te.right||(te.right=new s),te=te.right):(te.left||(te.left=new s),te=te.left),q===0&&!te.val&&(te.val=z[1]);return{decodeLut:G,numBitsLUTQick:F,numBitsLUT:O,tree:V,stuffedData:B,srcPtr:P,bitPos:_}},readHuffman:function(l,u,f){var d=u.headerInfo,p=d.numDims,g=u.headerInfo.height,m=u.headerInfo.width,b=m*g,x=this.readHuffmanTree(l,u),T=x.decodeLut,C=x.tree,S=x.stuffedData,v=x.srcPtr,D=x.bitPos,I=x.numBitsLUTQick,L=x.numBitsLUT,M=u.headerInfo.imageType===0?128:0,N,B,_,w=u.pixels.resultMask,P,O,F,V,G,z,W,U=0;D>0&&(v++,D=0);var q=S[v],K=u.encodeMode===1,te=new f(b*p),Y=te,Z;for(Z=0;Z<d.numDims;Z++){if(p>1&&(Y=new f(te.buffer,b*Z,b),U=0),u.headerInfo.numValidPixel===m*g)for(z=0,V=0;V<g;V++)for(G=0;G<m;G++,z++){if(B=0,P=q<<D>>>32-I,O=P,32-D<I&&(P|=S[v+1]>>>64-D-I,O=P),T[O])B=T[O][1],D+=T[O][0];else for(P=q<<D>>>32-L,O=P,32-D<L&&(P|=S[v+1]>>>64-D-L,O=P),N=C,W=0;W<L;W++)if(F=P>>>L-W-1&1,N=F?N.right:N.left,!(N.left||N.right)){B=N.val,D=D+W+1;break}D>=32&&(D-=32,v++,q=S[v]),_=B-M,K?(G>0?_+=U:V>0?_+=Y[z-m]:_+=U,_&=255,Y[z]=_,U=_):Y[z]=_}else for(z=0,V=0;V<g;V++)for(G=0;G<m;G++,z++)if(w[z]){if(B=0,P=q<<D>>>32-I,O=P,32-D<I&&(P|=S[v+1]>>>64-D-I,O=P),T[O])B=T[O][1],D+=T[O][0];else for(P=q<<D>>>32-L,O=P,32-D<L&&(P|=S[v+1]>>>64-D-L,O=P),N=C,W=0;W<L;W++)if(F=P>>>L-W-1&1,N=F?N.right:N.left,!(N.left||N.right)){B=N.val,D=D+W+1;break}D>=32&&(D-=32,v++,q=S[v]),_=B-M,K?(G>0&&w[z-1]?_+=U:V>0&&w[z-m]?_+=Y[z-m]:_+=U,_&=255,Y[z]=_,U=_):Y[z]=_}u.ptr=u.ptr+(v+1)*4+(D>0?4:0)}u.pixels.resultPixels=te},decodeBits:function(l,u,f,d,p){{var g=u.headerInfo,m=g.fileVersion,b=0,x=new DataView(l,u.ptr,5),T=x.getUint8(0);b++;var C=T>>6,S=C===0?4:3-C,v=(T&32)>0,D=T&31,I=0;if(S===1)I=x.getUint8(b),b++;else if(S===2)I=x.getUint16(b,!0),b+=2;else if(S===4)I=x.getUint32(b,!0),b+=4;else throw"Invalid valid pixel count type";var L=2*g.maxZError,M,N,B,_,w,P,O,F,V,G,z=g.numDims>1?g.maxValues[p]:g.zMax;if(v){for(u.counter.lut++,F=x.getUint8(b),V=D,b++,_=Math.ceil((F-1)*D/8),w=Math.ceil(_/4),N=new ArrayBuffer(w*4),B=new Uint8Array(N),u.ptr+=b,B.set(new Uint8Array(l,u.ptr,_)),O=new Uint32Array(N),u.ptr+=_,G=0;F-1>>>G;)G++;_=Math.ceil(I*G/8),w=Math.ceil(_/4),N=new ArrayBuffer(w*4),B=new Uint8Array(N),B.set(new Uint8Array(l,u.ptr,_)),M=new Uint32Array(N),u.ptr+=_,m>=3?P=o.unstuffLUT2(O,D,F-1,d,L,z):P=o.unstuffLUT(O,D,F-1,d,L,z),m>=3?o.unstuff2(M,f,G,I,P):o.unstuff(M,f,G,I,P)}else u.counter.bitstuffer++,G=D,u.ptr+=b,G>0&&(_=Math.ceil(I*G/8),w=Math.ceil(_/4),N=new ArrayBuffer(w*4),B=new Uint8Array(N),B.set(new Uint8Array(l,u.ptr,_)),M=new Uint32Array(N),u.ptr+=_,m>=3?d==null?o.originalUnstuff2(M,f,G,I):o.unstuff2(M,f,G,I,!1,d,L,z):d==null?o.originalUnstuff(M,f,G,I):o.unstuff(M,f,G,I,!1,d,L,z))}},readTiles:function(l,u,f){var d=u.headerInfo,p=d.width,g=d.height,m=d.microBlockSize,b=d.imageType,x=r.getDataTypeSize(b),T=Math.ceil(p/m),C=Math.ceil(g/m);u.pixels.numBlocksY=C,u.pixels.numBlocksX=T,u.pixels.ptr=0;var S=0,v=0,D=0,I=0,L=0,M=0,N=0,B=0,_=0,w=0,P=0,O=0,F=0,V=0,G=0,z=0,W,U,q,K,te,Y,Z=new f(m*m),ee=g%m||m,me=p%m||m,be,le,ge=d.numDims,xe,Pe=u.pixels.resultMask,Ee=u.pixels.resultPixels;for(D=0;D<C;D++)for(L=D!==C-1?m:ee,I=0;I<T;I++)for(M=I!==T-1?m:me,P=D*p*m+I*m,O=p-M,xe=0;xe<ge;xe++){if(ge>1&&(Ee=new f(u.pixels.resultPixels.buffer,p*g*xe*x,p*g)),N=l.byteLength-u.ptr,W=new DataView(l,u.ptr,Math.min(10,N)),U={},z=0,B=W.getUint8(0),z++,_=B>>6&255,w=B>>2&15,w!==(I*m>>3&15))throw"integrity issue";if(Y=B&3,Y>3)throw u.ptr+=z,"Invalid block encoding ("+Y+")";if(Y===2){u.counter.constant++,u.ptr+=z;continue}else if(Y===0){if(u.counter.uncompressed++,u.ptr+=z,F=L*M*x,V=l.byteLength-u.ptr,F=F<V?F:V,q=new ArrayBuffer(F%x===0?F:F+x-F%x),K=new Uint8Array(q),K.set(new Uint8Array(l,u.ptr,F)),te=new f(q),G=0,Pe)for(S=0;S<L;S++){for(v=0;v<M;v++)Pe[P]&&(Ee[P]=te[G++]),P++;P+=O}else for(S=0;S<L;S++){for(v=0;v<M;v++)Ee[P++]=te[G++];P+=O}u.ptr+=G*x}else if(be=r.getDataTypeUsed(b,_),le=r.getOnePixel(U,z,be,W),z+=r.getDataTypeSize(be),Y===3)if(u.ptr+=z,u.counter.constantoffset++,Pe)for(S=0;S<L;S++){for(v=0;v<M;v++)Pe[P]&&(Ee[P]=le),P++;P+=O}else for(S=0;S<L;S++){for(v=0;v<M;v++)Ee[P++]=le;P+=O}else if(u.ptr+=z,r.decodeBits(l,u,Z,le,xe),z=0,Pe)for(S=0;S<L;S++){for(v=0;v<M;v++)Pe[P]&&(Ee[P]=Z[z++]),P++;P+=O}else for(S=0;S<L;S++){for(v=0;v<M;v++)Ee[P++]=Z[z++];P+=O}}},formatFileInfo:function(l){return{fileIdentifierString:l.headerInfo.fileIdentifierString,fileVersion:l.headerInfo.fileVersion,imageType:l.headerInfo.imageType,height:l.headerInfo.height,width:l.headerInfo.width,numValidPixel:l.headerInfo.numValidPixel,microBlockSize:l.headerInfo.microBlockSize,blobSize:l.headerInfo.blobSize,maxZError:l.headerInfo.maxZError,pixelType:r.getPixelType(l.headerInfo.imageType),eofOffset:l.eofOffset,mask:l.mask?{numBytes:l.mask.numBytes}:null,pixels:{numBlocksX:l.pixels.numBlocksX,numBlocksY:l.pixels.numBlocksY,maxValue:l.headerInfo.zMax,minValue:l.headerInfo.zMin,noDataValue:l.noDataValue}}},constructConstantSurface:function(l){var u=l.headerInfo.zMax,f=l.headerInfo.numDims,d=l.headerInfo.height*l.headerInfo.width,p=d*f,g=0,m=0,b=0,x=l.pixels.resultMask;if(x)if(f>1)for(g=0;g<f;g++)for(b=g*d,m=0;m<d;m++)x[m]&&(l.pixels.resultPixels[b+m]=u);else for(m=0;m<d;m++)x[m]&&(l.pixels.resultPixels[m]=u);else if(l.pixels.resultPixels.fill)l.pixels.resultPixels.fill(u);else for(m=0;m<p;m++)l.pixels.resultPixels[m]=u},getDataTypeArray:function(l){var u;switch(l){case 0:u=Int8Array;break;case 1:u=Uint8Array;break;case 2:u=Int16Array;break;case 3:u=Uint16Array;break;case 4:u=Int32Array;break;case 5:u=Uint32Array;break;case 6:u=Float32Array;break;case 7:u=Float64Array;break;default:u=Float32Array}return u},getPixelType:function(l){var u;switch(l){case 0:u="S8";break;case 1:u="U8";break;case 2:u="S16";break;case 3:u="U16";break;case 4:u="S32";break;case 5:u="U32";break;case 6:u="F32";break;case 7:u="F64";break;default:u="F32"}return u},isValidPixelValue:function(l,u){if(u==null)return!1;var f;switch(l){case 0:f=u>=-128&&u<=127;break;case 1:f=u>=0&&u<=255;break;case 2:f=u>=-32768&&u<=32767;break;case 3:f=u>=0&&u<=65536;break;case 4:f=u>=-2147483648&&u<=2147483647;break;case 5:f=u>=0&&u<=4294967296;break;case 6:f=u>=-34027999387901484e22&&u<=34027999387901484e22;break;case 7:f=u>=5e-324&&u<=17976931348623157e292;break;default:f=!1}return f},getDataTypeSize:function(l){var u=0;switch(l){case 0:case 1:u=1;break;case 2:case 3:u=2;break;case 4:case 5:case 6:u=4;break;case 7:u=8;break;default:u=l}return u},getDataTypeUsed:function(l,u){var f=l;switch(l){case 2:case 4:f=l-u;break;case 3:case 5:f=l-2*u;break;case 6:u===0?f=l:u===1?f=2:f=1;break;case 7:u===0?f=l:f=l-2*u+1;break;default:f=l;break}return f},getOnePixel:function(l,u,f,d){var p=0;switch(f){case 0:p=d.getInt8(u);break;case 1:p=d.getUint8(u);break;case 2:p=d.getInt16(u,!0);break;case 3:p=d.getUint16(u,!0);break;case 4:p=d.getInt32(u,!0);break;case 5:p=d.getUInt32(u,!0);break;case 6:p=d.getFloat32(u,!0);break;case 7:p=d.getFloat64(u,!0);break;default:throw"the decoder does not understand this pixel type"}return p}},s=function(l,u,f){this.val=l,this.left=u,this.right=f},a={decode:function(l,u){u=u||{};var f=u.noDataValue,d=0,p={};if(p.ptr=u.inputOffset||0,p.pixels={},!!r.readHeaderInfo(l,p)){var g=p.headerInfo,m=g.fileVersion,b=r.getDataTypeArray(g.imageType);r.readMask(l,p),g.numValidPixel!==g.width*g.height&&!p.pixels.resultMask&&(p.pixels.resultMask=u.maskData);var x=g.width*g.height;if(p.pixels.resultPixels=new b(x*g.numDims),p.counter={onesweep:0,uncompressed:0,lut:0,bitstuffer:0,constant:0,constantoffset:0},g.numValidPixel!==0)if(g.zMax===g.zMin)r.constructConstantSurface(p);else if(m>=4&&r.checkMinMaxRanges(l,p))r.constructConstantSurface(p);else{var T=new DataView(l,p.ptr,2),C=T.getUint8(0);if(p.ptr++,C)r.readDataOneSweep(l,p,b);else if(m>1&&g.imageType<=1&&Math.abs(g.maxZError-.5)<1e-5){var S=T.getUint8(1);if(p.ptr++,p.encodeMode=S,S>2||m<4&&S>1)throw"Invalid Huffman flag "+S;S?r.readHuffman(l,p,b):r.readTiles(l,p,b)}else r.readTiles(l,p,b)}p.eofOffset=p.ptr;var v;u.inputOffset?(v=p.headerInfo.blobSize+u.inputOffset-p.ptr,Math.abs(v)>=1&&(p.eofOffset=u.inputOffset+p.headerInfo.blobSize)):(v=p.headerInfo.blobSize-p.ptr,Math.abs(v)>=1&&(p.eofOffset=p.headerInfo.blobSize));var D={width:g.width,height:g.height,pixelData:p.pixels.resultPixels,minValue:g.zMin,maxValue:g.zMax,validPixelCount:g.numValidPixel,dimCount:g.numDims,dimStats:{minValues:g.minValues,maxValues:g.maxValues},maskData:p.pixels.resultMask};if(p.pixels.resultMask&&r.isValidPixelValue(g.imageType,f)){var I=p.pixels.resultMask;for(d=0;d<x;d++)I[d]||(D.pixelData[d]=f);D.noDataValue=f}return p.noDataValue=f,u.returnFileInfo&&(D.fileInfo=r.formatFileInfo(p)),D}},getBandCount:function(l){var u=0,f=0,d={};for(d.ptr=0,d.pixels={};f<l.byteLength-58;)r.readHeaderInfo(l,d),f+=d.headerInfo.blobSize,u++,d.ptr=f;return u}};return a}(),n=function(){var o=new ArrayBuffer(4),r=new Uint8Array(o),s=new Uint32Array(o);return s[0]=1,r[0]===1}(),i={decode:function(o,r){if(!n)throw"Big endian system is not supported.";r=r||{};var s=r.inputOffset||0,a=new Uint8Array(o,s,10),l=String.fromCharCode.apply(null,a),u,f;if(l.trim()==="CntZImage")u=e,f=1;else if(l.substring(0,5)==="Lerc2")u=t,f=2;else throw"Unexpected file identifier string: "+l;for(var d=0,p=o.byteLength-10,g,m=[],b,x,T={width:0,height:0,pixels:[],pixelType:r.pixelType,mask:null,statistics:[]};s<p;){var C=u.decode(o,{inputOffset:s,encodedMaskData:g,maskData:x,returnMask:d===0,returnEncodedMask:d===0,returnFileInfo:!0,pixelType:r.pixelType||null,noDataValue:r.noDataValue||null});s=C.fileInfo.eofOffset,d===0&&(g=C.encodedMaskData,x=C.maskData,T.width=C.width,T.height=C.height,T.dimCount=C.dimCount||1,T.pixelType=C.pixelType||C.fileInfo.pixelType,T.mask=C.maskData),f>1&&C.fileInfo.mask&&C.fileInfo.mask.numBytes>0&&m.push(C.maskData),d++,T.pixels.push(C.pixelData),T.statistics.push({minValue:C.minValue,maxValue:C.maxValue,noDataValue:C.noDataValue,dimStats:C.dimStats})}var S,v,D;if(f>1&&m.length>1){for(D=T.width*T.height,T.bandMasks=m,x=new Uint8Array(D),x.set(m[0]),S=1;S<m.length;S++)for(b=m[S],v=0;v<D;v++)x[v]=x[v]&b[v];T.maskData=x}return T}};typeof define=="function"&&define.amd?define([],function(){return i}):typeof BN<"u"&&BN.exports?BN.exports=i:this.Lerc=i})()});var ZTe=vu((P$i,$Te)=>{$Te.exports={webm:"data:video/webm;base64,GkXfowEAAAAAAAAfQoaBAUL3gQFC8oEEQvOBCEKChHdlYm1Ch4EEQoWBAhhTgGcBAAAAAAAVkhFNm3RALE27i1OrhBVJqWZTrIHfTbuMU6uEFlSua1OsggEwTbuMU6uEHFO7a1OsghV17AEAAAAAAACkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmAQAAAAAAAEUq17GDD0JATYCNTGF2ZjU1LjMzLjEwMFdBjUxhdmY1NS4zMy4xMDBzpJBlrrXf3DCDVB8KcgbMpcr+RImIQJBgAAAAAAAWVK5rAQAAAAAAD++uAQAAAAAAADLXgQFzxYEBnIEAIrWcg3VuZIaFVl9WUDiDgQEj44OEAmJaAOABAAAAAAAABrCBsLqBkK4BAAAAAAAPq9eBAnPFgQKcgQAitZyDdW5khohBX1ZPUkJJU4OBAuEBAAAAAAAAEZ+BArWIQOdwAAAAAABiZIEgY6JPbwIeVgF2b3JiaXMAAAAAAoC7AAAAAAAAgLUBAAAAAAC4AQN2b3JiaXMtAAAAWGlwaC5PcmcgbGliVm9yYmlzIEkgMjAxMDExMDEgKFNjaGF1ZmVudWdnZXQpAQAAABUAAABlbmNvZGVyPUxhdmM1NS41Mi4xMDIBBXZvcmJpcyVCQ1YBAEAAACRzGCpGpXMWhBAaQlAZ4xxCzmvsGUJMEYIcMkxbyyVzkCGkoEKIWyiB0JBVAABAAACHQXgUhIpBCCGEJT1YkoMnPQghhIg5eBSEaUEIIYQQQgghhBBCCCGERTlokoMnQQgdhOMwOAyD5Tj4HIRFOVgQgydB6CCED0K4moOsOQghhCQ1SFCDBjnoHITCLCiKgsQwuBaEBDUojILkMMjUgwtCiJqDSTX4GoRnQXgWhGlBCCGEJEFIkIMGQcgYhEZBWJKDBjm4FITLQagahCo5CB+EIDRkFQCQAACgoiiKoigKEBqyCgDIAAAQQFEUx3EcyZEcybEcCwgNWQUAAAEACAAAoEiKpEiO5EiSJFmSJVmSJVmS5omqLMuyLMuyLMsyEBqyCgBIAABQUQxFcRQHCA1ZBQBkAAAIoDiKpViKpWiK54iOCISGrAIAgAAABAAAEDRDUzxHlETPVFXXtm3btm3btm3btm3btm1blmUZCA1ZBQBAAAAQ0mlmqQaIMAMZBkJDVgEACAAAgBGKMMSA0JBVAABAAACAGEoOogmtOd+c46BZDppKsTkdnEi1eZKbirk555xzzsnmnDHOOeecopxZDJoJrTnnnMSgWQqaCa0555wnsXnQmiqtOeeccc7pYJwRxjnnnCateZCajbU555wFrWmOmkuxOeecSLl5UptLtTnnnHPOOeecc84555zqxekcnBPOOeecqL25lpvQxTnnnE/G6d6cEM4555xzzjnnnHPOOeecIDRkFQAABABAEIaNYdwpCNLnaCBGEWIaMulB9+gwCRqDnELq0ehopJQ6CCWVcVJKJwgNWQUAAAIAQAghhRRSSCGFFFJIIYUUYoghhhhyyimnoIJKKqmooowyyyyzzDLLLLPMOuyssw47DDHEEEMrrcRSU2011lhr7jnnmoO0VlprrbVSSimllFIKQkNWAQAgAAAEQgYZZJBRSCGFFGKIKaeccgoqqIDQkFUAACAAgAAAAABP8hzRER3RER3RER3RER3R8RzPESVREiVREi3TMjXTU0VVdWXXlnVZt31b2IVd933d933d+HVhWJZlWZZlWZZlWZZlWZZlWZYgNGQVAAACAAAghBBCSCGFFFJIKcYYc8w56CSUEAgNWQUAAAIACAAAAHAUR3EcyZEcSbIkS9IkzdIsT/M0TxM9URRF0zRV0RVdUTdtUTZl0zVdUzZdVVZtV5ZtW7Z125dl2/d93/d93/d93/d93/d9XQdCQ1YBABIAADqSIymSIimS4ziOJElAaMgqAEAGAEAAAIriKI7jOJIkSZIlaZJneZaomZrpmZ4qqkBoyCoAABAAQAAAAAAAAIqmeIqpeIqoeI7oiJJomZaoqZoryqbsuq7ruq7ruq7ruq7ruq7ruq7ruq7ruq7ruq7ruq7ruq7ruq4LhIasAgAkAAB0JEdyJEdSJEVSJEdygNCQVQCADACAAAAcwzEkRXIsy9I0T/M0TxM90RM901NFV3SB0JBVAAAgAIAAAAAAAAAMybAUy9EcTRIl1VItVVMt1VJF1VNVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVN0zRNEwgNWQkAkAEAkBBTLS3GmgmLJGLSaqugYwxS7KWxSCpntbfKMYUYtV4ah5RREHupJGOKQcwtpNApJq3WVEKFFKSYYyoVUg5SIDRkhQAQmgHgcBxAsixAsiwAAAAAAAAAkDQN0DwPsDQPAAAAAAAAACRNAyxPAzTPAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABA0jRA8zxA8zwAAAAAAAAA0DwP8DwR8EQRAAAAAAAAACzPAzTRAzxRBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABA0jRA8zxA8zwAAAAAAAAAsDwP8EQR0DwRAAAAAAAAACzPAzxRBDzRAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAEOAAABBgIRQasiIAiBMAcEgSJAmSBM0DSJYFTYOmwTQBkmVB06BpME0AAAAAAAAAAAAAJE2DpkHTIIoASdOgadA0iCIAAAAAAAAAAAAAkqZB06BpEEWApGnQNGgaRBEAAAAAAAAAAAAAzzQhihBFmCbAM02IIkQRpgkAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAGHAAAAgwoQwUGrIiAIgTAHA4imUBAIDjOJYFAACO41gWAABYliWKAABgWZooAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAYcAAACDChDBQashIAiAIAcCiKZQHHsSzgOJYFJMmyAJYF0DyApgFEEQAIAAAocAAACLBBU2JxgEJDVgIAUQAABsWxLE0TRZKkaZoniiRJ0zxPFGma53meacLzPM80IYqiaJoQRVE0TZimaaoqME1VFQAAUOAAABBgg6bE4gCFhqwEAEICAByKYlma5nmeJ4qmqZokSdM8TxRF0TRNU1VJkqZ5niiKommapqqyLE3zPFEURdNUVVWFpnmeKIqiaaqq6sLzPE8URdE0VdV14XmeJ4qiaJqq6roQRVE0TdNUTVV1XSCKpmmaqqqqrgtETxRNU1Vd13WB54miaaqqq7ouEE3TVFVVdV1ZBpimaaqq68oyQFVV1XVdV5YBqqqqruu6sgxQVdd1XVmWZQCu67qyLMsCAAAOHAAAAoygk4wqi7DRhAsPQKEhKwKAKAAAwBimFFPKMCYhpBAaxiSEFEImJaXSUqogpFJSKRWEVEoqJaOUUmopVRBSKamUCkIqJZVSAADYgQMA2IGFUGjISgAgDwCAMEYpxhhzTiKkFGPOOScRUoox55yTSjHmnHPOSSkZc8w556SUzjnnnHNSSuacc845KaVzzjnnnJRSSuecc05KKSWEzkEnpZTSOeecEwAAVOAAABBgo8jmBCNBhYasBABSAQAMjmNZmuZ5omialiRpmud5niiapiZJmuZ5nieKqsnzPE8URdE0VZXneZ4oiqJpqirXFUXTNE1VVV2yLIqmaZqq6rowTdNUVdd1XZimaaqq67oubFtVVdV1ZRm2raqq6rqyDFzXdWXZloEsu67s2rIAAPAEBwCgAhtWRzgpGgssNGQlAJABAEAYg5BCCCFlEEIKIYSUUggJAAAYcAAACDChDBQashIASAUAAIyx1lprrbXWQGettdZaa62AzFprrbXWWmuttdZaa6211lJrrbXWWmuttdZaa6211lprrbXWWmuttdZaa6211lprrbXWWmuttdZaa6211lprrbXWWmstpZRSSimllFJKKaWUUkoppZRSSgUA+lU4APg/2LA6wknRWGChISsBgHAAAMAYpRhzDEIppVQIMeacdFRai7FCiDHnJKTUWmzFc85BKCGV1mIsnnMOQikpxVZjUSmEUlJKLbZYi0qho5JSSq3VWIwxqaTWWoutxmKMSSm01FqLMRYjbE2ptdhqq7EYY2sqLbQYY4zFCF9kbC2m2moNxggjWywt1VprMMYY3VuLpbaaizE++NpSLDHWXAAAd4MDAESCjTOsJJ0VjgYXGrISAAgJACAQUooxxhhzzjnnpFKMOeaccw5CCKFUijHGnHMOQgghlIwx5pxzEEIIIYRSSsaccxBCCCGEkFLqnHMQQgghhBBKKZ1zDkIIIYQQQimlgxBCCCGEEEoopaQUQgghhBBCCKmklEIIIYRSQighlZRSCCGEEEIpJaSUUgohhFJCCKGElFJKKYUQQgillJJSSimlEkoJJYQSUikppRRKCCGUUkpKKaVUSgmhhBJKKSWllFJKIYQQSikFAAAcOAAABBhBJxlVFmGjCRcegEJDVgIAZAAAkKKUUiktRYIipRikGEtGFXNQWoqocgxSzalSziDmJJaIMYSUk1Qy5hRCDELqHHVMKQYtlRhCxhik2HJLoXMOAAAAQQCAgJAAAAMEBTMAwOAA4XMQdAIERxsAgCBEZohEw0JweFAJEBFTAUBigkIuAFRYXKRdXECXAS7o4q4DIQQhCEEsDqCABByccMMTb3jCDU7QKSp1IAAAAAAADADwAACQXAAREdHMYWRobHB0eHyAhIiMkAgAAAAAABcAfAAAJCVAREQ0cxgZGhscHR4fICEiIyQBAIAAAgAAAAAggAAEBAQAAAAAAAIAAAAEBB9DtnUBAAAAAAAEPueBAKOFggAAgACjzoEAA4BwBwCdASqwAJAAAEcIhYWIhYSIAgIABhwJ7kPfbJyHvtk5D32ych77ZOQ99snIe+2TkPfbJyHvtk5D32ych77ZOQ99YAD+/6tQgKOFggADgAqjhYIAD4AOo4WCACSADqOZgQArADECAAEQEAAYABhYL/QACIBDmAYAAKOFggA6gA6jhYIAT4AOo5mBAFMAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCAGSADqOFggB6gA6jmYEAewAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYIAj4AOo5mBAKMAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCAKSADqOFggC6gA6jmYEAywAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYIAz4AOo4WCAOSADqOZgQDzADECAAEQEAAYABhYL/QACIBDmAYAAKOFggD6gA6jhYIBD4AOo5iBARsAEQIAARAQFGAAYWC/0AAiAQ5gGACjhYIBJIAOo4WCATqADqOZgQFDADECAAEQEAAYABhYL/QACIBDmAYAAKOFggFPgA6jhYIBZIAOo5mBAWsAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCAXqADqOFggGPgA6jmYEBkwAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYIBpIAOo4WCAbqADqOZgQG7ADECAAEQEAAYABhYL/QACIBDmAYAAKOFggHPgA6jmYEB4wAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYIB5IAOo4WCAfqADqOZgQILADECAAEQEAAYABhYL/QACIBDmAYAAKOFggIPgA6jhYICJIAOo5mBAjMAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCAjqADqOFggJPgA6jmYECWwAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYICZIAOo4WCAnqADqOZgQKDADECAAEQEAAYABhYL/QACIBDmAYAAKOFggKPgA6jhYICpIAOo5mBAqsAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCArqADqOFggLPgA6jmIEC0wARAgABEBAUYABhYL/QACIBDmAYAKOFggLkgA6jhYIC+oAOo5mBAvsAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCAw+ADqOZgQMjADECAAEQEAAYABhYL/QACIBDmAYAAKOFggMkgA6jhYIDOoAOo5mBA0sAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCA0+ADqOFggNkgA6jmYEDcwAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYIDeoAOo4WCA4+ADqOZgQObADECAAEQEAAYABhYL/QACIBDmAYAAKOFggOkgA6jhYIDuoAOo5mBA8MAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCA8+ADqOFggPkgA6jhYID+oAOo4WCBA+ADhxTu2sBAAAAAAAAEbuPs4EDt4r3gQHxghEr8IEK",mp4:"data:video/mp4;base64,AAAAHGZ0eXBNNFYgAAACAGlzb21pc28yYXZjMQAAAAhmcmVlAAAGF21kYXTeBAAAbGliZmFhYyAxLjI4AABCAJMgBDIARwAAArEGBf//rdxF6b3m2Ui3lizYINkj7u94MjY0IC0gY29yZSAxNDIgcjIgOTU2YzhkOCAtIEguMjY0L01QRUctNCBBVkMgY29kZWMgLSBDb3B5bGVmdCAyMDAzLTIwMTQgLSBodHRwOi8vd3d3LnZpZGVvbGFuLm9yZy94MjY0Lmh0bWwgLSBvcHRpb25zOiBjYWJhYz0wIHJlZj0zIGRlYmxvY2s9MTowOjAgYW5hbHlzZT0weDE6MHgxMTEgbWU9aGV4IHN1Ym1lPTcgcHN5PTEgcHN5X3JkPTEuMDA6MC4wMCBtaXhlZF9yZWY9MSBtZV9yYW5nZT0xNiBjaHJvbWFfbWU9MSB0cmVsbGlzPTEgOHg4ZGN0PTAgY3FtPTAgZGVhZHpvbmU9MjEsMTEgZmFzdF9wc2tpcD0xIGNocm9tYV9xcF9vZmZzZXQ9LTIgdGhyZWFkcz02IGxvb2thaGVhZF90aHJlYWRzPTEgc2xpY2VkX3RocmVhZHM9MCBucj0wIGRlY2ltYXRlPTEgaW50ZXJsYWNlZD0wIGJsdXJheV9jb21wYXQ9MCBjb25zdHJhaW5lZF9pbnRyYT0wIGJmcmFtZXM9MCB3ZWlnaHRwPTAga2V5aW50PTI1MCBrZXlpbnRfbWluPTI1IHNjZW5lY3V0PTQwIGludHJhX3JlZnJlc2g9MCByY19sb29rYWhlYWQ9NDAgcmM9Y3JmIG1idHJlZT0xIGNyZj0yMy4wIHFjb21wPTAuNjAgcXBtaW49MCBxcG1heD02OSBxcHN0ZXA9NCB2YnZfbWF4cmF0ZT03NjggdmJ2X2J1ZnNpemU9MzAwMCBjcmZfbWF4PTAuMCBuYWxfaHJkPW5vbmUgZmlsbGVyPTAgaXBfcmF0aW89MS40MCBhcT0xOjEuMDAAgAAAAFZliIQL8mKAAKvMnJycnJycnJycnXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXiEASZACGQAjgCEASZACGQAjgAAAAAdBmjgX4GSAIQBJkAIZACOAAAAAB0GaVAX4GSAhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZpgL8DJIQBJkAIZACOAIQBJkAIZACOAAAAABkGagC/AySEASZACGQAjgAAAAAZBmqAvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZrAL8DJIQBJkAIZACOAAAAABkGa4C/AySEASZACGQAjgCEASZACGQAjgAAAAAZBmwAvwMkhAEmQAhkAI4AAAAAGQZsgL8DJIQBJkAIZACOAIQBJkAIZACOAAAAABkGbQC/AySEASZACGQAjgCEASZACGQAjgAAAAAZBm2AvwMkhAEmQAhkAI4AAAAAGQZuAL8DJIQBJkAIZACOAIQBJkAIZACOAAAAABkGboC/AySEASZACGQAjgAAAAAZBm8AvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZvgL8DJIQBJkAIZACOAAAAABkGaAC/AySEASZACGQAjgCEASZACGQAjgAAAAAZBmiAvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZpAL8DJIQBJkAIZACOAAAAABkGaYC/AySEASZACGQAjgCEASZACGQAjgAAAAAZBmoAvwMkhAEmQAhkAI4AAAAAGQZqgL8DJIQBJkAIZACOAIQBJkAIZACOAAAAABkGawC/AySEASZACGQAjgAAAAAZBmuAvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZsAL8DJIQBJkAIZACOAAAAABkGbIC/AySEASZACGQAjgCEASZACGQAjgAAAAAZBm0AvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZtgL8DJIQBJkAIZACOAAAAABkGbgCvAySEASZACGQAjgCEASZACGQAjgAAAAAZBm6AnwMkhAEmQAhkAI4AhAEmQAhkAI4AhAEmQAhkAI4AhAEmQAhkAI4AAAAhubW9vdgAAAGxtdmhkAAAAAAAAAAAAAAAAAAAD6AAABDcAAQAAAQAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAzB0cmFrAAAAXHRraGQAAAADAAAAAAAAAAAAAAABAAAAAAAAA+kAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAALAAAACQAAAAAAAkZWR0cwAAABxlbHN0AAAAAAAAAAEAAAPpAAAAAAABAAAAAAKobWRpYQAAACBtZGhkAAAAAAAAAAAAAAAAAAB1MAAAdU5VxAAAAAAALWhkbHIAAAAAAAAAAHZpZGUAAAAAAAAAAAAAAABWaWRlb0hhbmRsZXIAAAACU21pbmYAAAAUdm1oZAAAAAEAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAhNzdGJsAAAAr3N0c2QAAAAAAAAAAQAAAJ9hdmMxAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAALAAkABIAAAASAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGP//AAAALWF2Y0MBQsAN/+EAFWdCwA3ZAsTsBEAAAPpAADqYA8UKkgEABWjLg8sgAAAAHHV1aWRraEDyXyRPxbo5pRvPAyPzAAAAAAAAABhzdHRzAAAAAAAAAAEAAAAeAAAD6QAAABRzdHNzAAAAAAAAAAEAAAABAAAAHHN0c2MAAAAAAAAAAQAAAAEAAAABAAAAAQAAAIxzdHN6AAAAAAAAAAAAAAAeAAADDwAAAAsAAAALAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAAiHN0Y28AAAAAAAAAHgAAAEYAAANnAAADewAAA5gAAAO0AAADxwAAA+MAAAP2AAAEEgAABCUAAARBAAAEXQAABHAAAASMAAAEnwAABLsAAATOAAAE6gAABQYAAAUZAAAFNQAABUgAAAVkAAAFdwAABZMAAAWmAAAFwgAABd4AAAXxAAAGDQAABGh0cmFrAAAAXHRraGQAAAADAAAAAAAAAAAAAAACAAAAAAAABDcAAAAAAAAAAAAAAAEBAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAkZWR0cwAAABxlbHN0AAAAAAAAAAEAAAQkAAADcAABAAAAAAPgbWRpYQAAACBtZGhkAAAAAAAAAAAAAAAAAAC7gAAAykBVxAAAAAAALWhkbHIAAAAAAAAAAHNvdW4AAAAAAAAAAAAAAABTb3VuZEhhbmRsZXIAAAADi21pbmYAAAAQc21oZAAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAADT3N0YmwAAABnc3RzZAAAAAAAAAABAAAAV21wNGEAAAAAAAAAAQAAAAAAAAAAAAIAEAAAAAC7gAAAAAAAM2VzZHMAAAAAA4CAgCIAAgAEgICAFEAVBbjYAAu4AAAADcoFgICAAhGQBoCAgAECAAAAIHN0dHMAAAAAAAAAAgAAADIAAAQAAAAAAQAAAkAAAAFUc3RzYwAAAAAAAAAbAAAAAQAAAAEAAAABAAAAAgAAAAIAAAABAAAAAwAAAAEAAAABAAAABAAAAAIAAAABAAAABgAAAAEAAAABAAAABwAAAAIAAAABAAAACAAAAAEAAAABAAAACQAAAAIAAAABAAAACgAAAAEAAAABAAAACwAAAAIAAAABAAAADQAAAAEAAAABAAAADgAAAAIAAAABAAAADwAAAAEAAAABAAAAEAAAAAIAAAABAAAAEQAAAAEAAAABAAAAEgAAAAIAAAABAAAAFAAAAAEAAAABAAAAFQAAAAIAAAABAAAAFgAAAAEAAAABAAAAFwAAAAIAAAABAAAAGAAAAAEAAAABAAAAGQAAAAIAAAABAAAAGgAAAAEAAAABAAAAGwAAAAIAAAABAAAAHQAAAAEAAAABAAAAHgAAAAIAAAABAAAAHwAAAAQAAAABAAAA4HN0c3oAAAAAAAAAAAAAADMAAAAaAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAACMc3RjbwAAAAAAAAAfAAAALAAAA1UAAANyAAADhgAAA6IAAAO+AAAD0QAAA+0AAAQAAAAEHAAABC8AAARLAAAEZwAABHoAAASWAAAEqQAABMUAAATYAAAE9AAABRAAAAUjAAAFPwAABVIAAAVuAAAFgQAABZ0AAAWwAAAFzAAABegAAAX7AAAGFwAAAGJ1ZHRhAAAAWm1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAALWlsc3QAAAAlqXRvbwAAAB1kYXRhAAAAAQAAAABMYXZmNTUuMzMuMTAw"}});var QTe=vu((I$i,JTe)=>{var{webm:nEt,mp4:iEt}=ZTe(),C$=()=>typeof navigator<"u"&&parseFloat((""+(/CPU.*OS ([0-9_]{3,4})[0-9_]{0,1}|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))<10&&!window.MSStream,E$=()=>"wakeLock"in navigator,S$=class{constructor(){if(this.enabled=!1,E$()){this._wakeLock=null;let t=()=>{this._wakeLock!==null&&document.visibilityState==="visible"&&this.enable()};document.addEventListener("visibilitychange",t),document.addEventListener("fullscreenchange",t)}else C$()?this.noSleepTimer=null:(this.noSleepVideo=document.createElement("video"),this.noSleepVideo.setAttribute("title","No Sleep"),this.noSleepVideo.setAttribute("playsinline",""),this._addSourceToVideo(this.noSleepVideo,"webm",nEt),this._addSourceToVideo(this.noSleepVideo,"mp4",iEt),this.noSleepVideo.addEventListener("loadedmetadata",()=>{this.noSleepVideo.duration<=1?this.noSleepVideo.setAttribute("loop",""):this.noSleepVideo.addEventListener("timeupdate",()=>{this.noSleepVideo.currentTime>.5&&(this.noSleepVideo.currentTime=Math.random())})}))}_addSourceToVideo(t,n,i){var o=document.createElement("source");o.src=i,o.type=`video/${n}`,t.appendChild(o)}get isEnabled(){return this.enabled}enable(){return E$()?navigator.wakeLock.request("screen").then(t=>{this._wakeLock=t,this.enabled=!0,console.log("Wake Lock active."),this._wakeLock.addEventListener("release",()=>{console.log("Wake Lock released.")})}).catch(t=>{throw this.enabled=!1,console.error(`${t.name}, ${t.message}`),t}):C$()?(this.disable(),console.warn(`
        NoSleep enabled for older iOS devices. This can interrupt
        active or long-running network requests from completing successfully.
        See https://github.com/richtr/NoSleep.js/issues/15 for more details.
      `),this.noSleepTimer=window.setInterval(()=>{document.hidden||(window.location.href=window.location.href.split("#")[0],window.setTimeout(window.stop,0))},15e3),this.enabled=!0,Promise.resolve()):this.noSleepVideo.play().then(n=>(this.enabled=!0,n)).catch(n=>{throw this.enabled=!1,n})}disable(){E$()?(this._wakeLock&&this._wakeLock.release(),this._wakeLock=null):C$()?this.noSleepTimer&&(console.warn(`
          NoSleep now disabled for older iOS devices.
        `),window.clearInterval(this.noSleepTimer),this.noSleepTimer=null):this.noSleepVideo.pause(),this.enabled=!1}};JTe.exports=S$});function N$(e,t){return e??t}N$.EMPTY_OBJECT=Object.freeze({});var y=N$;function mAe(e){return e!=null}var c=mAe;function Py(e){this.name="DeveloperError",this.message=e;let t;try{throw new Error}catch(n){t=n.stack}this.stack=t}c(Object.create)&&(Py.prototype=Object.create(Error.prototype),Py.prototype.constructor=Py);Py.prototype.toString=function(){let e=`${this.name}: ${this.message}`;return c(this.stack)&&(e+=`
${this.stack.toString()}`),e};Py.throwInstantiationError=function(){throw new Py("This function defines an interface and should not be called directly.")};var E=Py;var as={};as.typeOf={};function pAe(e){return`${e} is required, actual value was undefined`}function bx(e,t,n){return`Expected ${n} to be typeof ${t}, actual typeof was ${e}`}as.defined=function(e,t){if(!c(t))throw new E(pAe(e))};as.typeOf.func=function(e,t){if(typeof t!="function")throw new E(bx(typeof t,"function",e))};as.typeOf.string=function(e,t){if(typeof t!="string")throw new E(bx(typeof t,"string",e))};as.typeOf.number=function(e,t){if(typeof t!="number")throw new E(bx(typeof t,"number",e))};as.typeOf.number.lessThan=function(e,t,n){if(as.typeOf.number(e,t),t>=n)throw new E(`Expected ${e} to be less than ${n}, actual value was ${t}`)};as.typeOf.number.lessThanOrEquals=function(e,t,n){if(as.typeOf.number(e,t),t>n)throw new E(`Expected ${e} to be less than or equal to ${n}, actual value was ${t}`)};as.typeOf.number.greaterThan=function(e,t,n){if(as.typeOf.number(e,t),t<=n)throw new E(`Expected ${e} to be greater than ${n}, actual value was ${t}`)};as.typeOf.number.greaterThanOrEquals=function(e,t,n){if(as.typeOf.number(e,t),t<n)throw new E(`Expected ${e} to be greater than or equal to ${n}, actual value was ${t}`)};as.typeOf.object=function(e,t){if(typeof t!="object")throw new E(bx(typeof t,"object",e))};as.typeOf.bool=function(e,t){if(typeof t!="boolean")throw new E(bx(typeof t,"boolean",e))};as.typeOf.bigint=function(e,t){if(typeof t!="bigint")throw new E(bx(typeof t,"bigint",e))};as.typeOf.number.equals=function(e,t,n,i){if(as.typeOf.number(e,n),as.typeOf.number(t,i),n!==i)throw new E(`${e} must be equal to ${t}, the actual values are ${n} and ${i}`)};var A=as;function iE(){this._listeners=[],this._scopes=[],this._toRemove=[],this._insideRaiseEvent=!1}Object.defineProperties(iE.prototype,{numberOfListeners:{get:function(){return this._listeners.length-this._toRemove.length}}});iE.prototype.addEventListener=function(e,t){A.typeOf.func("listener",e),this._listeners.push(e),this._scopes.push(t);let n=this;return function(){n.removeEventListener(e,t)}};iE.prototype.removeEventListener=function(e,t){A.typeOf.func("listener",e);let n=this._listeners,i=this._scopes,o=-1;for(let r=0;r<n.length;r++)if(n[r]===e&&i[r]===t){o=r;break}return o!==-1?(this._insideRaiseEvent?(this._toRemove.push(o),n[o]=void 0,i[o]=void 0):(n.splice(o,1),i.splice(o,1)),!0):!1};function _Ae(e,t){return t-e}iE.prototype.raiseEvent=function(){this._insideRaiseEvent=!0;let e,t=this._listeners,n=this._scopes,i=t.length;for(e=0;e<i;e++){let r=t[e];c(r)&&t[e].apply(n[e],arguments)}let o=this._toRemove;if(i=o.length,i>0){for(o.sort(_Ae),e=0;e<i;e++){let r=o[e];t.splice(r,1),n.splice(r,1)}o.length=0}this._insideRaiseEvent=!1};var pe=iE;function f_(e){this._value=void 0,this._hasClone=!1,this._hasEquals=!1,this._definitionChanged=new pe,this.setValue(e)}Object.defineProperties(f_.prototype,{isConstant:{value:!0},definitionChanged:{get:function(){return this._definitionChanged}}});f_.prototype.getValue=function(e,t){return this._hasClone?this._value.clone(t):this._value};f_.prototype.setValue=function(e){let t=this._value;if(t!==e){let n=c(e),i=n&&typeof e.clone=="function",o=n&&typeof e.equals=="function";(!o||!e.equals(t))&&(this._hasClone=i,this._hasEquals=o,this._value=i?e.clone(this._value):e,this._definitionChanged.raiseEvent(this))}};f_.prototype.equals=function(e){return this===e||e instanceof f_&&(!this._hasEquals&&this._value===e._value||this._hasEquals&&this._value.equals(e._value))};f_.prototype.valueOf=function(){return this._value};f_.prototype.toString=function(){return String(this._value)};var Kn=f_;function gAe(e,t,n,i,o){return{configurable:i,get:function(){return this[t]},set:function(r){let s=this[t],a=this[n];c(a)&&(a(),this[n]=void 0),r!==void 0&&(!c(r)||!c(r.getValue))&&c(o)&&(r=o(r)),s!==r&&(this[t]=r,this._definitionChanged.raiseEvent(this,e,r,s)),c(r)&&c(r.definitionChanged)&&(this[n]=r.definitionChanged.addEventListener(function(){this._definitionChanged.raiseEvent(this,e,r,r)},this))}}}function yAe(e){return new Kn(e)}function bAe(e,t,n){return gAe(e,`_${e.toString()}`,`_${e.toString()}Subscription`,y(t,!1),y(n,yAe))}var fe=bAe;function oE(e){this._definitionChanged=new pe,this._show=void 0,this._showSubscription=void 0,this._image=void 0,this._imageSubscription=void 0,this._scale=void 0,this._scaleSubscription=void 0,this._pixelOffset=void 0,this._pixelOffsetSubscription=void 0,this._eyeOffset=void 0,this._eyeOffsetSubscription=void 0,this._horizontalOrigin=void 0,this._horizontalOriginSubscription=void 0,this._verticalOrigin=void 0,this._verticalOriginSubscription=void 0,this._heightReference=void 0,this._heightReferenceSubscription=void 0,this._color=void 0,this._colorSubscription=void 0,this._rotation=void 0,this._rotationSubscription=void 0,this._alignedAxis=void 0,this._alignedAxisSubscription=void 0,this._sizeInMeters=void 0,this._sizeInMetersSubscription=void 0,this._width=void 0,this._widthSubscription=void 0,this._height=void 0,this._heightSubscription=void 0,this._scaleByDistance=void 0,this._scaleByDistanceSubscription=void 0,this._translucencyByDistance=void 0,this._translucencyByDistanceSubscription=void 0,this._pixelOffsetScaleByDistance=void 0,this._pixelOffsetScaleByDistanceSubscription=void 0,this._imageSubRegion=void 0,this._imageSubRegionSubscription=void 0,this._distanceDisplayCondition=void 0,this._distanceDisplayConditionSubscription=void 0,this._disableDepthTestDistance=void 0,this._disableDepthTestDistanceSubscription=void 0,this._splitDirection=void 0,this._splitDirectionSubscription=void 0,this.merge(y(e,y.EMPTY_OBJECT))}Object.defineProperties(oE.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:fe("show"),image:fe("image"),scale:fe("scale"),pixelOffset:fe("pixelOffset"),eyeOffset:fe("eyeOffset"),horizontalOrigin:fe("horizontalOrigin"),verticalOrigin:fe("verticalOrigin"),heightReference:fe("heightReference"),color:fe("color"),rotation:fe("rotation"),alignedAxis:fe("alignedAxis"),sizeInMeters:fe("sizeInMeters"),width:fe("width"),height:fe("height"),scaleByDistance:fe("scaleByDistance"),translucencyByDistance:fe("translucencyByDistance"),pixelOffsetScaleByDistance:fe("pixelOffsetScaleByDistance"),imageSubRegion:fe("imageSubRegion"),distanceDisplayCondition:fe("distanceDisplayCondition"),disableDepthTestDistance:fe("disableDepthTestDistance"),splitDirection:fe("splitDirection")});oE.prototype.clone=function(e){return c(e)?(e.show=this._show,e.image=this._image,e.scale=this._scale,e.pixelOffset=this._pixelOffset,e.eyeOffset=this._eyeOffset,e.horizontalOrigin=this._horizontalOrigin,e.verticalOrigin=this._verticalOrigin,e.heightReference=this._heightReference,e.color=this._color,e.rotation=this._rotation,e.alignedAxis=this._alignedAxis,e.sizeInMeters=this._sizeInMeters,e.width=this._width,e.height=this._height,e.scaleByDistance=this._scaleByDistance,e.translucencyByDistance=this._translucencyByDistance,e.pixelOffsetScaleByDistance=this._pixelOffsetScaleByDistance,e.imageSubRegion=this._imageSubRegion,e.distanceDisplayCondition=this._distanceDisplayCondition,e.disableDepthTestDistance=this._disableDepthTestDistance,e.splitDirection=this._splitDirection,e):new oE(this)};oE.prototype.merge=function(e){if(!c(e))throw new E("source is required.");this.show=y(this._show,e.show),this.image=y(this._image,e.image),this.scale=y(this._scale,e.scale),this.pixelOffset=y(this._pixelOffset,e.pixelOffset),this.eyeOffset=y(this._eyeOffset,e.eyeOffset),this.horizontalOrigin=y(this._horizontalOrigin,e.horizontalOrigin),this.verticalOrigin=y(this._verticalOrigin,e.verticalOrigin),this.heightReference=y(this._heightReference,e.heightReference),this.color=y(this._color,e.color),this.rotation=y(this._rotation,e.rotation),this.alignedAxis=y(this._alignedAxis,e.alignedAxis),this.sizeInMeters=y(this._sizeInMeters,e.sizeInMeters),this.width=y(this._width,e.width),this.height=y(this._height,e.height),this.scaleByDistance=y(this._scaleByDistance,e.scaleByDistance),this.translucencyByDistance=y(this._translucencyByDistance,e.translucencyByDistance),this.pixelOffsetScaleByDistance=y(this._pixelOffsetScaleByDistance,e.pixelOffsetScaleByDistance),this.imageSubRegion=y(this._imageSubRegion,e.imageSubRegion),this.distanceDisplayCondition=y(this._distanceDisplayCondition,e.distanceDisplayCondition),this.disableDepthTestDistance=y(this._disableDepthTestDistance,e.disableDepthTestDistance),this.splitDirection=y(this.splitDirection,e.splitDirection)};var Wc=oE;function Iy(){this._array=[],this._hash={}}Object.defineProperties(Iy.prototype,{length:{get:function(){return this._array.length}},values:{get:function(){return this._array}}});Iy.prototype.contains=function(e){if(typeof e!="string"&&typeof e!="number")throw new E("key is required to be a string or number.");return c(this._hash[e])};Iy.prototype.set=function(e,t){if(typeof e!="string"&&typeof e!="number")throw new E("key is required to be a string or number.");let n=this._hash[e];t!==n&&(this.remove(e),this._hash[e]=t,this._array.push(t))};Iy.prototype.get=function(e){if(typeof e!="string"&&typeof e!="number")throw new E("key is required to be a string or number.");return this._hash[e]};Iy.prototype.remove=function(e){if(c(e)&&typeof e!="string"&&typeof e!="number")throw new E("key is required to be a string or number.");let t=this._hash[e],n=c(t);if(n){let i=this._array;i.splice(i.indexOf(t),1),delete this._hash[e]}return n};Iy.prototype.removeAll=function(){let e=this._array;e.length>0&&(this._hash={},e.length=0)};var St=Iy;var QF=Ur(UP(),1);var at={};at.EPSILON1=.1;at.EPSILON2=.01;at.EPSILON3=.001;at.EPSILON4=1e-4;at.EPSILON5=1e-5;at.EPSILON6=1e-6;at.EPSILON7=1e-7;at.EPSILON8=1e-8;at.EPSILON9=1e-9;at.EPSILON10=1e-10;at.EPSILON11=1e-11;at.EPSILON12=1e-12;at.EPSILON13=1e-13;at.EPSILON14=1e-14;at.EPSILON15=1e-15;at.EPSILON16=1e-16;at.EPSILON17=1e-17;at.EPSILON18=1e-18;at.EPSILON19=1e-19;at.EPSILON20=1e-20;at.EPSILON21=1e-21;at.GRAVITATIONALPARAMETER=3986004418e5;at.SOLAR_RADIUS=6955e5;at.LUNAR_RADIUS=1737400;at.SIXTY_FOUR_KILOBYTES=64*1024;at.FOUR_GIGABYTES=4*1024*1024*1024;at.sign=y(Math.sign,function(t){return t=+t,t===0||t!==t?t:t>0?1:-1});at.signNotZero=function(e){return e<0?-1:1};at.toSNorm=function(e,t){return t=y(t,255),Math.round((at.clamp(e,-1,1)*.5+.5)*t)};at.fromSNorm=function(e,t){return t=y(t,255),at.clamp(e,0,t)/t*2-1};at.normalize=function(e,t,n){return n=Math.max(n-t,0),n===0?0:at.clamp((e-t)/n,0,1)};at.sinh=y(Math.sinh,function(t){return(Math.exp(t)-Math.exp(-t))/2});at.cosh=y(Math.cosh,function(t){return(Math.exp(t)+Math.exp(-t))/2});at.lerp=function(e,t,n){return(1-n)*e+n*t};at.PI=Math.PI;at.ONE_OVER_PI=1/Math.PI;at.PI_OVER_TWO=Math.PI/2;at.PI_OVER_THREE=Math.PI/3;at.PI_OVER_FOUR=Math.PI/4;at.PI_OVER_SIX=Math.PI/6;at.THREE_PI_OVER_TWO=3*Math.PI/2;at.TWO_PI=2*Math.PI;at.ONE_OVER_TWO_PI=1/(2*Math.PI);at.RADIANS_PER_DEGREE=Math.PI/180;at.DEGREES_PER_RADIAN=180/Math.PI;at.RADIANS_PER_ARCSECOND=at.RADIANS_PER_DEGREE/3600;at.toRadians=function(e){if(!c(e))throw new E("degrees is required.");return e*at.RADIANS_PER_DEGREE};at.toDegrees=function(e){if(!c(e))throw new E("radians is required.");return e*at.DEGREES_PER_RADIAN};at.convertLongitudeRange=function(e){if(!c(e))throw new E("angle is required.");let t=at.TWO_PI,n=e-Math.floor(e/t)*t;return n<-Math.PI?n+t:n>=Math.PI?n-t:n};at.clampToLatitudeRange=function(e){if(!c(e))throw new E("angle is required.");return at.clamp(e,-1*at.PI_OVER_TWO,at.PI_OVER_TWO)};at.negativePiToPi=function(e){if(!c(e))throw new E("angle is required.");return e>=-at.PI&&e<=at.PI?e:at.zeroToTwoPi(e+at.PI)-at.PI};at.zeroToTwoPi=function(e){if(!c(e))throw new E("angle is required.");if(e>=0&&e<=at.TWO_PI)return e;let t=at.mod(e,at.TWO_PI);return Math.abs(t)<at.EPSILON14&&Math.abs(e)>at.EPSILON14?at.TWO_PI:t};at.mod=function(e,t){if(!c(e))throw new E("m is required.");if(!c(t))throw new E("n is required.");if(t===0)throw new E("divisor cannot be 0.");return at.sign(e)===at.sign(t)&&Math.abs(e)<Math.abs(t)?e:(e%t+t)%t};at.equalsEpsilon=function(e,t,n,i){if(!c(e))throw new E("left is required.");if(!c(t))throw new E("right is required.");n=y(n,0),i=y(i,n);let o=Math.abs(e-t);return o<=i||o<=n*Math.max(Math.abs(e),Math.abs(t))};at.lessThan=function(e,t,n){if(!c(e))throw new E("first is required.");if(!c(t))throw new E("second is required.");if(!c(n))throw new E("absoluteEpsilon is required.");return e-t<-n};at.lessThanOrEquals=function(e,t,n){if(!c(e))throw new E("first is required.");if(!c(t))throw new E("second is required.");if(!c(n))throw new E("absoluteEpsilon is required.");return e-t<n};at.greaterThan=function(e,t,n){if(!c(e))throw new E("first is required.");if(!c(t))throw new E("second is required.");if(!c(n))throw new E("absoluteEpsilon is required.");return e-t>n};at.greaterThanOrEquals=function(e,t,n){if(!c(e))throw new E("first is required.");if(!c(t))throw new E("second is required.");if(!c(n))throw new E("absoluteEpsilon is required.");return e-t>-n};var zP=[1];at.factorial=function(e){if(typeof e!="number"||e<0)throw new E("A number greater than or equal to 0 is required.");let t=zP.length;if(e>=t){let n=zP[t-1];for(let i=t;i<=e;i++){let o=n*i;zP.push(o),n=o}}return zP[e]};at.incrementWrap=function(e,t,n){if(n=y(n,0),!c(e))throw new E("n is required.");if(t<=n)throw new E("maximumValue must be greater than minimumValue.");return++e,e>t&&(e=n),e};at.isPowerOfTwo=function(e){if(typeof e!="number"||e<0||e>4294967295)throw new E("A number between 0 and (2^32)-1 is required.");return e!==0&&(e&e-1)===0};at.nextPowerOfTwo=function(e){if(typeof e!="number"||e<0||e>2147483648)throw new E("A number between 0 and 2^31 is required.");return--e,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e,e};at.previousPowerOfTwo=function(e){if(typeof e!="number"||e<0||e>4294967295)throw new E("A number between 0 and (2^32)-1 is required.");return e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,e|=e>>32,e=(e>>>0)-(e>>>1),e};at.clamp=function(e,t,n){return A.typeOf.number("value",e),A.typeOf.number("min",t),A.typeOf.number("max",n),e<t?t:e>n?n:e};var B$=new QF.default;at.setRandomNumberSeed=function(e){if(!c(e))throw new E("seed is required.");B$=new QF.default(e)};at.nextRandomNumber=function(){return B$.random()};at.randomBetween=function(e,t){return at.nextRandomNumber()*(t-e)+e};at.acosClamped=function(e){if(!c(e))throw new E("value is required.");return Math.acos(at.clamp(e,-1,1))};at.asinClamped=function(e){if(!c(e))throw new E("value is required.");return Math.asin(at.clamp(e,-1,1))};at.chordLength=function(e,t){if(!c(e))throw new E("angle is required.");if(!c(t))throw new E("radius is required.");return 2*t*Math.sin(e*.5)};at.logBase=function(e,t){if(!c(e))throw new E("number is required.");if(!c(t))throw new E("base is required.");return Math.log(e)/Math.log(t)};at.cbrt=y(Math.cbrt,function(t){let n=Math.pow(Math.abs(t),.3333333333333333);return t<0?-n:n});at.log2=y(Math.log2,function(t){return Math.log(t)*Math.LOG2E});at.fog=function(e,t){let n=e*t;return 1-Math.exp(-(n*n))};at.fastApproximateAtan=function(e){return A.typeOf.number("x",e),e*(-.1784*Math.abs(e)-.0663*e*e+1.0301)};at.fastApproximateAtan2=function(e,t){A.typeOf.number("x",e),A.typeOf.number("y",t);let n,i=Math.abs(e);n=Math.abs(t);let o=Math.max(i,n);n=Math.min(i,n);let r=n/o;if(isNaN(r))throw new E("either x or y must be nonzero");return i=at.fastApproximateAtan(r),i=Math.abs(t)>Math.abs(e)?at.PI_OVER_TWO-i:i,i=e<0?at.PI-i:i,i=t<0?-i:i,i};var R=at;function kt(e,t){this.x=y(e,0),this.y=y(t,0)}kt.fromElements=function(e,t,n){return c(n)?(n.x=e,n.y=t,n):new kt(e,t)};kt.clone=function(e,t){if(c(e))return c(t)?(t.x=e.x,t.y=e.y,t):new kt(e.x,e.y)};kt.fromCartesian3=kt.clone;kt.fromCartesian4=kt.clone;kt.packedLength=2;kt.pack=function(e,t,n){return A.typeOf.object("value",e),A.defined("array",t),n=y(n,0),t[n++]=e.x,t[n]=e.y,t};kt.unpack=function(e,t,n){return A.defined("array",e),t=y(t,0),c(n)||(n=new kt),n.x=e[t++],n.y=e[t],n};kt.packArray=function(e,t){A.defined("array",e);let n=e.length,i=n*2;if(!c(t))t=new Array(i);else{if(!Array.isArray(t)&&t.length!==i)throw new E("If result is a typed array, it must have exactly array.length * 2 elements");t.length!==i&&(t.length=i)}for(let o=0;o<n;++o)kt.pack(e[o],t,o*2);return t};kt.unpackArray=function(e,t){if(A.defined("array",e),A.typeOf.number.greaterThanOrEquals("array.length",e.length,2),e.length%2!==0)throw new E("array length must be a multiple of 2.");let n=e.length;c(t)?t.length=n/2:t=new Array(n/2);for(let i=0;i<n;i+=2){let o=i/2;t[o]=kt.unpack(e,i,t[o])}return t};kt.fromArray=kt.unpack;kt.maximumComponent=function(e){return A.typeOf.object("cartesian",e),Math.max(e.x,e.y)};kt.minimumComponent=function(e){return A.typeOf.object("cartesian",e),Math.min(e.x,e.y)};kt.minimumByComponent=function(e,t,n){return A.typeOf.object("first",e),A.typeOf.object("second",t),A.typeOf.object("result",n),n.x=Math.min(e.x,t.x),n.y=Math.min(e.y,t.y),n};kt.maximumByComponent=function(e,t,n){return A.typeOf.object("first",e),A.typeOf.object("second",t),A.typeOf.object("result",n),n.x=Math.max(e.x,t.x),n.y=Math.max(e.y,t.y),n};kt.clamp=function(e,t,n,i){A.typeOf.object("value",e),A.typeOf.object("min",t),A.typeOf.object("max",n),A.typeOf.object("result",i);let o=R.clamp(e.x,t.x,n.x),r=R.clamp(e.y,t.y,n.y);return i.x=o,i.y=r,i};kt.magnitudeSquared=function(e){return A.typeOf.object("cartesian",e),e.x*e.x+e.y*e.y};kt.magnitude=function(e){return Math.sqrt(kt.magnitudeSquared(e))};var HP=new kt;kt.distance=function(e,t){return A.typeOf.object("left",e),A.typeOf.object("right",t),kt.subtract(e,t,HP),kt.magnitude(HP)};kt.distanceSquared=function(e,t){return A.typeOf.object("left",e),A.typeOf.object("right",t),kt.subtract(e,t,HP),kt.magnitudeSquared(HP)};kt.normalize=function(e,t){A.typeOf.object("cartesian",e),A.typeOf.object("result",t);let n=kt.magnitude(e);if(t.x=e.x/n,t.y=e.y/n,isNaN(t.x)||isNaN(t.y))throw new E("normalized result is not a number");return t};kt.dot=function(e,t){return A.typeOf.object("left",e),A.typeOf.object("right",t),e.x*t.x+e.y*t.y};kt.cross=function(e,t){return A.typeOf.object("left",e),A.typeOf.object("right",t),e.x*t.y-e.y*t.x};kt.multiplyComponents=function(e,t,n){return A.typeOf.object("left",e),A.typeOf.object("right",t),A.typeOf.object("result",n),n.x=e.x*t.x,n.y=e.y*t.y,n};kt.divideComponents=function(e,t,n){return A.typeOf.object("left",e),A.typeOf.object("right",t),A.typeOf.object("result",n),n.x=e.x/t.x,n.y=e.y/t.y,n};kt.add=function(e,t,n){return A.typeOf.object("left",e),A.typeOf.object("right",t),A.typeOf.object("result",n),n.x=e.x+t.x,n.y=e.y+t.y,n};kt.subtract=function(e,t,n){return A.typeOf.object("left",e),A.typeOf.object("right",t),A.typeOf.object("result",n),n.x=e.x-t.x,n.y=e.y-t.y,n};kt.multiplyByScalar=function(e,t,n){return A.typeOf.object("cartesian",e),A.typeOf.number("scalar",t),A.typeOf.object("result",n),n.x=e.x*t,n.y=e.y*t,n};kt.divideByScalar=function(e,t,n){return A.typeOf.object("cartesian",e),A.typeOf.number("scalar",t),A.typeOf.object("result",n),n.x=e.x/t,n.y=e.y/t,n};kt.negate=function(e,t){return A.typeOf.object("cartesian",e),A.typeOf.object("result",t),t.x=-e.x,t.y=-e.y,t};kt.abs=function(e,t){return A.typeOf.object("cartesian",e),A.typeOf.object("result",t),t.x=Math.abs(e.x),t.y=Math.abs(e.y),t};var k$=new kt;kt.lerp=function(e,t,n,i){return A.typeOf.object("start",e),A.typeOf.object("end",t),A.typeOf.number("t",n),A.typeOf.object("result",i),kt.multiplyByScalar(t,n,k$),i=kt.multiplyByScalar(e,1-n,i),kt.add(k$,i,i)};var V$=new kt,U$=new kt;kt.angleBetween=function(e,t){return A.typeOf.object("left",e),A.typeOf.object("right",t),kt.normalize(e,V$),kt.normalize(t,U$),R.acosClamped(kt.dot(V$,U$))};var xAe=new kt;kt.mostOrthogonalAxis=function(e,t){A.typeOf.object("cartesian",e),A.typeOf.object("result",t);let n=kt.normalize(e,xAe);return kt.abs(n,n),n.x<=n.y?t=kt.clone(kt.UNIT_X,t):t=kt.clone(kt.UNIT_Y,t),t};kt.equals=function(e,t){return e===t||c(e)&&c(t)&&e.x===t.x&&e.y===t.y};kt.equalsArray=function(e,t,n){return e.x===t[n]&&e.y===t[n+1]};kt.equalsEpsilon=function(e,t,n,i){return e===t||c(e)&&c(t)&&R.equalsEpsilon(e.x,t.x,n,i)&&R.equalsEpsilon(e.y,t.y,n,i)};kt.ZERO=Object.freeze(new kt(0,0));kt.ONE=Object.freeze(new kt(1,1));kt.UNIT_X=Object.freeze(new kt(1,0));kt.UNIT_Y=Object.freeze(new kt(0,1));kt.prototype.clone=function(e){return kt.clone(this,e)};kt.prototype.equals=function(e){return kt.equals(this,e)};kt.prototype.equalsEpsilon=function(e,t,n){return kt.equalsEpsilon(this,e,t,n)};kt.prototype.toString=function(){return`(${this.x}, ${this.y})`};var H=kt;function Je(e,t,n){this.x=y(e,0),this.y=y(t,0),this.z=y(n,0)}Je.fromSpherical=function(e,t){A.typeOf.object("spherical",e),c(t)||(t=new Je);let n=e.clock,i=e.cone,o=y(e.magnitude,1),r=o*Math.sin(i);return t.x=r*Math.cos(n),t.y=r*Math.sin(n),t.z=o*Math.cos(i),t};Je.fromElements=function(e,t,n,i){return c(i)?(i.x=e,i.y=t,i.z=n,i):new Je(e,t,n)};Je.clone=function(e,t){if(c(e))return c(t)?(t.x=e.x,t.y=e.y,t.z=e.z,t):new Je(e.x,e.y,e.z)};Je.fromCartesian4=Je.clone;Je.packedLength=3;Je.pack=function(e,t,n){return A.typeOf.object("value",e),A.defined("array",t),n=y(n,0),t[n++]=e.x,t[n++]=e.y,t[n]=e.z,t};Je.unpack=function(e,t,n){return A.defined("array",e),t=y(t,0),c(n)||(n=new Je),n.x=e[t++],n.y=e[t++],n.z=e[t],n};Je.packArray=function(e,t){A.defined("array",e);let n=e.length,i=n*3;if(!c(t))t=new Array(i);else{if(!Array.isArray(t)&&t.length!==i)throw new E("If result is a typed array, it must have exactly array.length * 3 elements");t.length!==i&&(t.length=i)}for(let o=0;o<n;++o)Je.pack(e[o],t,o*3);return t};Je.unpackArray=function(e,t){if(A.defined("array",e),A.typeOf.number.greaterThanOrEquals("array.length",e.length,3),e.length%3!==0)throw new E("array length must be a multiple of 3.");let n=e.length;c(t)?t.length=n/3:t=new Array(n/3);for(let i=0;i<n;i+=3){let o=i/3;t[o]=Je.unpack(e,i,t[o])}return t};Je.fromArray=Je.unpack;Je.maximumComponent=function(e){return A.typeOf.object("cartesian",e),Math.max(e.x,e.y,e.z)};Je.minimumComponent=function(e){return A.typeOf.object("cartesian",e),Math.min(e.x,e.y,e.z)};Je.minimumByComponent=function(e,t,n){return A.typeOf.object("first",e),A.typeOf.object("second",t),A.typeOf.object("result",n),n.x=Math.min(e.x,t.x),n.y=Math.min(e.y,t.y),n.z=Math.min(e.z,t.z),n};Je.maximumByComponent=function(e,t,n){return A.typeOf.object("first",e),A.typeOf.object("second",t),A.typeOf.object("result",n),n.x=Math.max(e.x,t.x),n.y=Math.max(e.y,t.y),n.z=Math.max(e.z,t.z),n};Je.clamp=function(e,t,n,i){A.typeOf.object("value",e),A.typeOf.object("min",t),A.typeOf.object("max",n),A.typeOf.object("result",i);let o=R.clamp(e.x,t.x,n.x),r=R.clamp(e.y,t.y,n.y),s=R.clamp(e.z,t.z,n.z);return i.x=o,i.y=r,i.z=s,i};Je.magnitudeSquared=function(e){return A.typeOf.object("cartesian",e),e.x*e.x+e.y*e.y+e.z*e.z};Je.magnitude=function(e){return Math.sqrt(Je.magnitudeSquared(e))};var jP=new Je;Je.distance=function(e,t){return A.typeOf.object("left",e),A.typeOf.object("right",t),Je.subtract(e,t,jP),Je.magnitude(jP)};Je.distanceSquared=function(e,t){return A.typeOf.object("left",e),A.typeOf.object("right",t),Je.subtract(e,t,jP),Je.magnitudeSquared(jP)};Je.normalize=function(e,t){A.typeOf.object("cartesian",e),A.typeOf.object("result",t);let n=Je.magnitude(e);if(t.x=e.x/n,t.y=e.y/n,t.z=e.z/n,isNaN(t.x)||isNaN(t.y)||isNaN(t.z))throw new E("normalized result is not a number");return t};Je.dot=function(e,t){return A.typeOf.object("left",e),A.typeOf.object("right",t),e.x*t.x+e.y*t.y+e.z*t.z};Je.multiplyComponents=function(e,t,n){return A.typeOf.object("left",e),A.typeOf.object("right",t),A.typeOf.object("result",n),n.x=e.x*t.x,n.y=e.y*t.y,n.z=e.z*t.z,n};Je.divideComponents=function(e,t,n){return A.typeOf.object("left",e),A.typeOf.object("right",t),A.typeOf.object("result",n),n.x=e.x/t.x,n.y=e.y/t.y,n.z=e.z/t.z,n};Je.add=function(e,t,n){return A.typeOf.object("left",e),A.typeOf.object("right",t),A.typeOf.object("result",n),n.x=e.x+t.x,n.y=e.y+t.y,n.z=e.z+t.z,n};Je.subtract=function(e,t,n){return A.typeOf.object("left",e),A.typeOf.object("right",t),A.typeOf.object("result",n),n.x=e.x-t.x,n.y=e.y-t.y,n.z=e.z-t.z,n};Je.multiplyByScalar=function(e,t,n){return A.typeOf.object("cartesian",e),A.typeOf.number("scalar",t),A.typeOf.object("result",n),n.x=e.x*t,n.y=e.y*t,n.z=e.z*t,n};Je.divideByScalar=function(e,t,n){return A.typeOf.object("cartesian",e),A.typeOf.number("scalar",t),A.typeOf.object("result",n),n.x=e.x/t,n.y=e.y/t,n.z=e.z/t,n};Je.negate=function(e,t){return A.typeOf.object("cartesian",e),A.typeOf.object("result",t),t.x=-e.x,t.y=-e.y,t.z=-e.z,t};Je.abs=function(e,t){return A.typeOf.object("cartesian",e),A.typeOf.object("result",t),t.x=Math.abs(e.x),t.y=Math.abs(e.y),t.z=Math.abs(e.z),t};var z$=new Je;Je.lerp=function(e,t,n,i){return A.typeOf.object("start",e),A.typeOf.object("end",t),A.typeOf.number("t",n),A.typeOf.object("result",i),Je.multiplyByScalar(t,n,z$),i=Je.multiplyByScalar(e,1-n,i),Je.add(z$,i,i)};var GP=new Je,e2=new Je;Je.angleBetween=function(e,t){A.typeOf.object("left",e),A.typeOf.object("right",t),Je.normalize(e,GP),Je.normalize(t,e2);let n=Je.dot(GP,e2),i=Je.magnitude(Je.cross(GP,e2,GP));return Math.atan2(i,n)};var TAe=new Je;Je.mostOrthogonalAxis=function(e,t){A.typeOf.object("cartesian",e),A.typeOf.object("result",t);let n=Je.normalize(e,TAe);return Je.abs(n,n),n.x<=n.y?n.x<=n.z?t=Je.clone(Je.UNIT_X,t):t=Je.clone(Je.UNIT_Z,t):n.y<=n.z?t=Je.clone(Je.UNIT_Y,t):t=Je.clone(Je.UNIT_Z,t),t};Je.projectVector=function(e,t,n){A.defined("a",e),A.defined("b",t),A.defined("result",n);let i=Je.dot(e,t)/Je.dot(t,t);return Je.multiplyByScalar(t,i,n)};Je.equals=function(e,t){return e===t||c(e)&&c(t)&&e.x===t.x&&e.y===t.y&&e.z===t.z};Je.equalsArray=function(e,t,n){return e.x===t[n]&&e.y===t[n+1]&&e.z===t[n+2]};Je.equalsEpsilon=function(e,t,n,i){return e===t||c(e)&&c(t)&&R.equalsEpsilon(e.x,t.x,n,i)&&R.equalsEpsilon(e.y,t.y,n,i)&&R.equalsEpsilon(e.z,t.z,n,i)};Je.cross=function(e,t,n){A.typeOf.object("left",e),A.typeOf.object("right",t),A.typeOf.object("result",n);let i=e.x,o=e.y,r=e.z,s=t.x,a=t.y,l=t.z,u=o*l-r*a,f=r*s-i*l,d=i*a-o*s;return n.x=u,n.y=f,n.z=d,n};Je.midpoint=function(e,t,n){return A.typeOf.object("left",e),A.typeOf.object("right",t),A.typeOf.object("result",n),n.x=(e.x+t.x)*.5,n.y=(e.y+t.y)*.5,n.z=(e.z+t.z)*.5,n};Je.fromDegrees=function(e,t,n,i,o){return A.typeOf.number("longitude",e),A.typeOf.number("latitude",t),e=R.toRadians(e),t=R.toRadians(t),Je.fromRadians(e,t,n,i,o)};var Du=new Je,xx=new Je;Je._ellipsoidRadiiSquared=new Je(6378137*6378137,6378137*6378137,6356752314245179e-9*6356752314245179e-9);Je.fromRadians=function(e,t,n,i,o){A.typeOf.number("longitude",e),A.typeOf.number("latitude",t),n=y(n,0);let r=c(i)?i.radiiSquared:Je._ellipsoidRadiiSquared,s=Math.cos(t);Du.x=s*Math.cos(e),Du.y=s*Math.sin(e),Du.z=Math.sin(t),Du=Je.normalize(Du,Du),Je.multiplyComponents(r,Du,xx);let a=Math.sqrt(Je.dot(Du,xx));return xx=Je.divideByScalar(xx,a,xx),Du=Je.multiplyByScalar(Du,n,Du),c(o)||(o=new Je),Je.add(xx,Du,o)};Je.fromDegreesArray=function(e,t,n){if(A.defined("coordinates",e),e.length<2||e.length%2!==0)throw new E("the number of coordinates must be a multiple of 2 and at least 2");let i=e.length;c(n)?n.length=i/2:n=new Array(i/2);for(let o=0;o<i;o+=2){let r=e[o],s=e[o+1],a=o/2;n[a]=Je.fromDegrees(r,s,0,t,n[a])}return n};Je.fromRadiansArray=function(e,t,n){if(A.defined("coordinates",e),e.length<2||e.length%2!==0)throw new E("the number of coordinates must be a multiple of 2 and at least 2");let i=e.length;c(n)?n.length=i/2:n=new Array(i/2);for(let o=0;o<i;o+=2){let r=e[o],s=e[o+1],a=o/2;n[a]=Je.fromRadians(r,s,0,t,n[a])}return n};Je.fromDegreesArrayHeights=function(e,t,n){if(A.defined("coordinates",e),e.length<3||e.length%3!==0)throw new E("the number of coordinates must be a multiple of 3 and at least 3");let i=e.length;c(n)?n.length=i/3:n=new Array(i/3);for(let o=0;o<i;o+=3){let r=e[o],s=e[o+1],a=e[o+2],l=o/3;n[l]=Je.fromDegrees(r,s,a,t,n[l])}return n};Je.fromRadiansArrayHeights=function(e,t,n){if(A.defined("coordinates",e),e.length<3||e.length%3!==0)throw new E("the number of coordinates must be a multiple of 3 and at least 3");let i=e.length;c(n)?n.length=i/3:n=new Array(i/3);for(let o=0;o<i;o+=3){let r=e[o],s=e[o+1],a=e[o+2],l=o/3;n[l]=Je.fromRadians(r,s,a,t,n[l])}return n};Je.ZERO=Object.freeze(new Je(0,0,0));Je.ONE=Object.freeze(new Je(1,1,1));Je.UNIT_X=Object.freeze(new Je(1,0,0));Je.UNIT_Y=Object.freeze(new Je(0,1,0));Je.UNIT_Z=Object.freeze(new Je(0,0,1));Je.prototype.clone=function(e){return Je.clone(this,e)};Je.prototype.equals=function(e){return Je.equals(this,e)};Je.prototype.equalsEpsilon=function(e,t,n){return Je.equalsEpsilon(this,e,t,n)};Je.prototype.toString=function(){return`(${this.x}, ${this.y}, ${this.z})`};var h=Je;var AAe=new h,CAe=new h;function EAe(e,t,n,i,o){if(!c(e))throw new E("cartesian is required.");if(!c(t))throw new E("oneOverRadii is required.");if(!c(n))throw new E("oneOverRadiiSquared is required.");if(!c(i))throw new E("centerToleranceSquared is required.");let r=e.x,s=e.y,a=e.z,l=t.x,u=t.y,f=t.z,d=r*r*l*l,p=s*s*u*u,g=a*a*f*f,m=d+p+g,b=Math.sqrt(1/m),x=h.multiplyByScalar(e,b,AAe);if(m<i)return isFinite(b)?h.clone(x,o):void 0;let T=n.x,C=n.y,S=n.z,v=CAe;v.x=x.x*T*2,v.y=x.y*C*2,v.z=x.z*S*2;let D=(1-b)*h.magnitude(e)/(.5*h.magnitude(v)),I=0,L,M,N,B,_,w,P,O,F,V,G;do{D-=I,N=1/(1+D*T),B=1/(1+D*C),_=1/(1+D*S),w=N*N,P=B*B,O=_*_,F=w*N,V=P*B,G=O*_,L=d*w+p*P+g*O-1,M=d*F*T+p*V*C+g*G*S;let z=-2*M;I=L/z}while(Math.abs(L)>R.EPSILON12);return c(o)?(o.x=r*N,o.y=s*B,o.z=a*_,o):new h(r*N,s*B,a*_)}var rE=EAe;function wo(e,t,n){this.longitude=y(e,0),this.latitude=y(t,0),this.height=y(n,0)}wo.fromRadians=function(e,t,n,i){return A.typeOf.number("longitude",e),A.typeOf.number("latitude",t),n=y(n,0),c(i)?(i.longitude=e,i.latitude=t,i.height=n,i):new wo(e,t,n)};wo.fromDegrees=function(e,t,n,i){return A.typeOf.number("longitude",e),A.typeOf.number("latitude",t),e=R.toRadians(e),t=R.toRadians(t),wo.fromRadians(e,t,n,i)};var SAe=new h,wAe=new h,vAe=new h;wo._ellipsoidOneOverRadii=new h(1/6378137,1/6378137,1/6356752314245179e-9);wo._ellipsoidOneOverRadiiSquared=new h(1/(6378137*6378137),1/(6378137*6378137),1/(6356752314245179e-9*6356752314245179e-9));wo._ellipsoidCenterToleranceSquared=R.EPSILON1;wo.fromCartesian=function(e,t,n){let i=c(t)?t.oneOverRadii:wo._ellipsoidOneOverRadii,o=c(t)?t.oneOverRadiiSquared:wo._ellipsoidOneOverRadiiSquared,r=c(t)?t._centerToleranceSquared:wo._ellipsoidCenterToleranceSquared,s=rE(e,i,o,r,wAe);if(!c(s))return;let a=h.multiplyComponents(s,o,SAe);a=h.normalize(a,a);let l=h.subtract(e,s,vAe),u=Math.atan2(a.y,a.x),f=Math.asin(a.z),d=R.sign(h.dot(l,e))*h.magnitude(l);return c(n)?(n.longitude=u,n.latitude=f,n.height=d,n):new wo(u,f,d)};wo.toCartesian=function(e,t,n){return A.defined("cartographic",e),h.fromRadians(e.longitude,e.latitude,e.height,t,n)};wo.clone=function(e,t){if(c(e))return c(t)?(t.longitude=e.longitude,t.latitude=e.latitude,t.height=e.height,t):new wo(e.longitude,e.latitude,e.height)};wo.equals=function(e,t){return e===t||c(e)&&c(t)&&e.longitude===t.longitude&&e.latitude===t.latitude&&e.height===t.height};wo.equalsEpsilon=function(e,t,n){return n=y(n,0),e===t||c(e)&&c(t)&&Math.abs(e.longitude-t.longitude)<=n&&Math.abs(e.latitude-t.latitude)<=n&&Math.abs(e.height-t.height)<=n};wo.ZERO=Object.freeze(new wo(0,0,0));wo.prototype.clone=function(e){return wo.clone(this,e)};wo.prototype.equals=function(e){return wo.equals(this,e)};wo.prototype.equalsEpsilon=function(e,t){return wo.equalsEpsilon(this,e,t)};wo.prototype.toString=function(){return`(${this.longitude}, ${this.latitude}, ${this.height})`};var he=wo;function G$(e,t,n,i){t=y(t,0),n=y(n,0),i=y(i,0),A.typeOf.number.greaterThanOrEquals("x",t,0),A.typeOf.number.greaterThanOrEquals("y",n,0),A.typeOf.number.greaterThanOrEquals("z",i,0),e._radii=new h(t,n,i),e._radiiSquared=new h(t*t,n*n,i*i),e._radiiToTheFourth=new h(t*t*t*t,n*n*n*n,i*i*i*i),e._oneOverRadii=new h(t===0?0:1/t,n===0?0:1/n,i===0?0:1/i),e._oneOverRadiiSquared=new h(t===0?0:1/(t*t),n===0?0:1/(n*n),i===0?0:1/(i*i)),e._minimumRadius=Math.min(t,n,i),e._maximumRadius=Math.max(t,n,i),e._centerToleranceSquared=R.EPSILON1,e._radiiSquared.z!==0&&(e._squaredXOverSquaredZ=e._radiiSquared.x/e._radiiSquared.z)}function ui(e,t,n){this._radii=void 0,this._radiiSquared=void 0,this._radiiToTheFourth=void 0,this._oneOverRadii=void 0,this._oneOverRadiiSquared=void 0,this._minimumRadius=void 0,this._maximumRadius=void 0,this._centerToleranceSquared=void 0,this._squaredXOverSquaredZ=void 0,G$(this,e,t,n)}Object.defineProperties(ui.prototype,{radii:{get:function(){return this._radii}},radiiSquared:{get:function(){return this._radiiSquared}},radiiToTheFourth:{get:function(){return this._radiiToTheFourth}},oneOverRadii:{get:function(){return this._oneOverRadii}},oneOverRadiiSquared:{get:function(){return this._oneOverRadiiSquared}},minimumRadius:{get:function(){return this._minimumRadius}},maximumRadius:{get:function(){return this._maximumRadius}}});ui.clone=function(e,t){if(!c(e))return;let n=e._radii;return c(t)?(h.clone(n,t._radii),h.clone(e._radiiSquared,t._radiiSquared),h.clone(e._radiiToTheFourth,t._radiiToTheFourth),h.clone(e._oneOverRadii,t._oneOverRadii),h.clone(e._oneOverRadiiSquared,t._oneOverRadiiSquared),t._minimumRadius=e._minimumRadius,t._maximumRadius=e._maximumRadius,t._centerToleranceSquared=e._centerToleranceSquared,t):new ui(n.x,n.y,n.z)};ui.fromCartesian3=function(e,t){return c(t)||(t=new ui),c(e)&&G$(t,e.x,e.y,e.z),t};ui.WGS84=Object.freeze(new ui(6378137,6378137,6356752314245179e-9));ui.UNIT_SPHERE=Object.freeze(new ui(1,1,1));ui.MOON=Object.freeze(new ui(R.LUNAR_RADIUS,R.LUNAR_RADIUS,R.LUNAR_RADIUS));ui._default=ui.WGS84;Object.defineProperties(ui,{default:{get:function(){return ui._default},set:function(e){A.typeOf.object("value",e),ui._default=e,h._ellipsoidRadiiSquared=e.radiiSquared,he._ellipsoidOneOverRadii=e.oneOverRadii,he._ellipsoidOneOverRadiiSquared=e.oneOverRadiiSquared,he._ellipsoidCenterToleranceSquared=e._centerToleranceSquared}}});ui.prototype.clone=function(e){return ui.clone(this,e)};ui.packedLength=h.packedLength;ui.pack=function(e,t,n){return A.typeOf.object("value",e),A.defined("array",t),n=y(n,0),h.pack(e._radii,t,n),t};ui.unpack=function(e,t,n){A.defined("array",e),t=y(t,0);let i=h.unpack(e,t);return ui.fromCartesian3(i,n)};ui.prototype.geocentricSurfaceNormal=h.normalize;ui.prototype.geodeticSurfaceNormalCartographic=function(e,t){A.typeOf.object("cartographic",e);let n=e.longitude,i=e.latitude,o=Math.cos(i),r=o*Math.cos(n),s=o*Math.sin(n),a=Math.sin(i);return c(t)||(t=new h),t.x=r,t.y=s,t.z=a,h.normalize(t,t)};ui.prototype.geodeticSurfaceNormal=function(e,t){if(A.typeOf.object("cartesian",e),isNaN(e.x)||isNaN(e.y)||isNaN(e.z))throw new E("cartesian has a NaN component");if(!h.equalsEpsilon(e,h.ZERO,R.EPSILON14))return c(t)||(t=new h),t=h.multiplyComponents(e,this._oneOverRadiiSquared,t),h.normalize(t,t)};var DAe=new h,PAe=new h;ui.prototype.cartographicToCartesian=function(e,t){let n=DAe,i=PAe;this.geodeticSurfaceNormalCartographic(e,n),h.multiplyComponents(this._radiiSquared,n,i);let o=Math.sqrt(h.dot(n,i));return h.divideByScalar(i,o,i),h.multiplyByScalar(n,e.height,n),c(t)||(t=new h),h.add(i,n,t)};ui.prototype.cartographicArrayToCartesianArray=function(e,t){A.defined("cartographics",e);let n=e.length;c(t)?t.length=n:t=new Array(n);for(let i=0;i<n;i++)t[i]=this.cartographicToCartesian(e[i],t[i]);return t};var IAe=new h,OAe=new h,RAe=new h;ui.prototype.cartesianToCartographic=function(e,t){let n=this.scaleToGeodeticSurface(e,OAe);if(!c(n))return;let i=this.geodeticSurfaceNormal(n,IAe),o=h.subtract(e,n,RAe),r=Math.atan2(i.y,i.x),s=Math.asin(i.z),a=R.sign(h.dot(o,e))*h.magnitude(o);return c(t)?(t.longitude=r,t.latitude=s,t.height=a,t):new he(r,s,a)};ui.prototype.cartesianArrayToCartographicArray=function(e,t){A.defined("cartesians",e);let n=e.length;c(t)?t.length=n:t=new Array(n);for(let i=0;i<n;++i)t[i]=this.cartesianToCartographic(e[i],t[i]);return t};ui.prototype.scaleToGeodeticSurface=function(e,t){return rE(e,this._oneOverRadii,this._oneOverRadiiSquared,this._centerToleranceSquared,t)};ui.prototype.scaleToGeocentricSurface=function(e,t){A.typeOf.object("cartesian",e),c(t)||(t=new h);let n=e.x,i=e.y,o=e.z,r=this._oneOverRadiiSquared,s=1/Math.sqrt(n*n*r.x+i*i*r.y+o*o*r.z);return h.multiplyByScalar(e,s,t)};ui.prototype.transformPositionToScaledSpace=function(e,t){return c(t)||(t=new h),h.multiplyComponents(e,this._oneOverRadii,t)};ui.prototype.transformPositionFromScaledSpace=function(e,t){return c(t)||(t=new h),h.multiplyComponents(e,this._radii,t)};ui.prototype.equals=function(e){return this===e||c(e)&&h.equals(this._radii,e._radii)};ui.prototype.toString=function(){return this._radii.toString()};ui.prototype.getSurfaceNormalIntersectionWithZAxis=function(e,t,n){if(A.typeOf.object("position",e),!R.equalsEpsilon(this._radii.x,this._radii.y,R.EPSILON15))throw new E("Ellipsoid must be an ellipsoid of revolution (radii.x == radii.y)");A.typeOf.number.greaterThan("Ellipsoid.radii.z",this._radii.z,0),t=y(t,0);let i=this._squaredXOverSquaredZ;if(c(n)||(n=new h),n.x=0,n.y=0,n.z=e.z*(1-i),!(Math.abs(n.z)>=this._radii.z-t))return n};var MAe=new h;ui.prototype.getLocalCurvature=function(e,t){A.typeOf.object("surfacePosition",e),c(t)||(t=new H);let n=this.getSurfaceNormalIntersectionWithZAxis(e,0,MAe),i=h.distance(e,n),o=this.minimumRadius*i/this.maximumRadius**2,r=i*o**2;return H.fromElements(1/i,1/r,t)};var LAe=[.14887433898163,.43339539412925,.67940956829902,.86506336668898,.97390652851717,0],NAe=[.29552422471475,.26926671930999,.21908636251598,.14945134915058,.066671344308684,0];function H$(e,t,n){A.typeOf.number("a",e),A.typeOf.number("b",t),A.typeOf.func("func",n);let i=.5*(t+e),o=.5*(t-e),r=0;for(let s=0;s<5;s++){let a=o*LAe[s];r+=NAe[s]*(n(i+a)+n(i-a))}return r*=o,r}ui.prototype.surfaceArea=function(e){A.typeOf.object("rectangle",e);let t=e.west,n=e.east,i=e.south,o=e.north;for(;n<t;)n+=R.TWO_PI;let r=this._radiiSquared,s=r.x,a=r.y,l=r.z,u=s*a;return H$(i,o,function(f){let d=Math.cos(f),p=Math.sin(f);return Math.cos(f)*H$(t,n,function(g){let m=Math.cos(g),b=Math.sin(g);return Math.sqrt(u*p*p+l*(a*m*m+s*b*b)*d*d)})})};var ie=ui;function WP(e){this._ellipsoid=y(e,ie.default),this._semimajorAxis=this._ellipsoid.maximumRadius,this._oneOverSemimajorAxis=1/this._semimajorAxis}Object.defineProperties(WP.prototype,{ellipsoid:{get:function(){return this._ellipsoid}}});WP.prototype.project=function(e,t){let n=this._semimajorAxis,i=e.longitude*n,o=e.latitude*n,r=e.height;return c(t)?(t.x=i,t.y=o,t.z=r,t):new h(i,o,r)};WP.prototype.unproject=function(e,t){if(!c(e))throw new E("cartesian is required");let n=this._oneOverSemimajorAxis,i=e.x*n,o=e.y*n,r=e.z;return c(t)?(t.longitude=i,t.latitude=o,t.height=r,t):new he(i,o,r)};var Mi=WP;var FAe={OUTSIDE:-1,INTERSECTING:0,INSIDE:1},qt=Object.freeze(FAe);function pt(e,t,n,i){this.x=y(e,0),this.y=y(t,0),this.z=y(n,0),this.w=y(i,0)}pt.fromElements=function(e,t,n,i,o){return c(o)?(o.x=e,o.y=t,o.z=n,o.w=i,o):new pt(e,t,n,i)};pt.fromColor=function(e,t){return A.typeOf.object("color",e),c(t)?(t.x=e.red,t.y=e.green,t.z=e.blue,t.w=e.alpha,t):new pt(e.red,e.green,e.blue,e.alpha)};pt.clone=function(e,t){if(c(e))return c(t)?(t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t):new pt(e.x,e.y,e.z,e.w)};pt.packedLength=4;pt.pack=function(e,t,n){return A.typeOf.object("value",e),A.defined("array",t),n=y(n,0),t[n++]=e.x,t[n++]=e.y,t[n++]=e.z,t[n]=e.w,t};pt.unpack=function(e,t,n){return A.defined("array",e),t=y(t,0),c(n)||(n=new pt),n.x=e[t++],n.y=e[t++],n.z=e[t++],n.w=e[t],n};pt.packArray=function(e,t){A.defined("array",e);let n=e.length,i=n*4;if(!c(t))t=new Array(i);else{if(!Array.isArray(t)&&t.length!==i)throw new E("If result is a typed array, it must have exactly array.length * 4 elements");t.length!==i&&(t.length=i)}for(let o=0;o<n;++o)pt.pack(e[o],t,o*4);return t};pt.unpackArray=function(e,t){if(A.defined("array",e),A.typeOf.number.greaterThanOrEquals("array.length",e.length,4),e.length%4!==0)throw new E("array length must be a multiple of 4.");let n=e.length;c(t)?t.length=n/4:t=new Array(n/4);for(let i=0;i<n;i+=4){let o=i/4;t[o]=pt.unpack(e,i,t[o])}return t};pt.fromArray=pt.unpack;pt.maximumComponent=function(e){return A.typeOf.object("cartesian",e),Math.max(e.x,e.y,e.z,e.w)};pt.minimumComponent=function(e){return A.typeOf.object("cartesian",e),Math.min(e.x,e.y,e.z,e.w)};pt.minimumByComponent=function(e,t,n){return A.typeOf.object("first",e),A.typeOf.object("second",t),A.typeOf.object("result",n),n.x=Math.min(e.x,t.x),n.y=Math.min(e.y,t.y),n.z=Math.min(e.z,t.z),n.w=Math.min(e.w,t.w),n};pt.maximumByComponent=function(e,t,n){return A.typeOf.object("first",e),A.typeOf.object("second",t),A.typeOf.object("result",n),n.x=Math.max(e.x,t.x),n.y=Math.max(e.y,t.y),n.z=Math.max(e.z,t.z),n.w=Math.max(e.w,t.w),n};pt.clamp=function(e,t,n,i){A.typeOf.object("value",e),A.typeOf.object("min",t),A.typeOf.object("max",n),A.typeOf.object("result",i);let o=R.clamp(e.x,t.x,n.x),r=R.clamp(e.y,t.y,n.y),s=R.clamp(e.z,t.z,n.z),a=R.clamp(e.w,t.w,n.w);return i.x=o,i.y=r,i.z=s,i.w=a,i};pt.magnitudeSquared=function(e){return A.typeOf.object("cartesian",e),e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w};pt.magnitude=function(e){return Math.sqrt(pt.magnitudeSquared(e))};var qP=new pt;pt.distance=function(e,t){return A.typeOf.object("left",e),A.typeOf.object("right",t),pt.subtract(e,t,qP),pt.magnitude(qP)};pt.distanceSquared=function(e,t){return A.typeOf.object("left",e),A.typeOf.object("right",t),pt.subtract(e,t,qP),pt.magnitudeSquared(qP)};pt.normalize=function(e,t){A.typeOf.object("cartesian",e),A.typeOf.object("result",t);let n=pt.magnitude(e);if(t.x=e.x/n,t.y=e.y/n,t.z=e.z/n,t.w=e.w/n,isNaN(t.x)||isNaN(t.y)||isNaN(t.z)||isNaN(t.w))throw new E("normalized result is not a number");return t};pt.dot=function(e,t){return A.typeOf.object("left",e),A.typeOf.object("right",t),e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w};pt.multiplyComponents=function(e,t,n){return A.typeOf.object("left",e),A.typeOf.object("right",t),A.typeOf.object("result",n),n.x=e.x*t.x,n.y=e.y*t.y,n.z=e.z*t.z,n.w=e.w*t.w,n};pt.divideComponents=function(e,t,n){return A.typeOf.object("left",e),A.typeOf.object("right",t),A.typeOf.object("result",n),n.x=e.x/t.x,n.y=e.y/t.y,n.z=e.z/t.z,n.w=e.w/t.w,n};pt.add=function(e,t,n){return A.typeOf.object("left",e),A.typeOf.object("right",t),A.typeOf.object("result",n),n.x=e.x+t.x,n.y=e.y+t.y,n.z=e.z+t.z,n.w=e.w+t.w,n};pt.subtract=function(e,t,n){return A.typeOf.object("left",e),A.typeOf.object("right",t),A.typeOf.object("result",n),n.x=e.x-t.x,n.y=e.y-t.y,n.z=e.z-t.z,n.w=e.w-t.w,n};pt.multiplyByScalar=function(e,t,n){return A.typeOf.object("cartesian",e),A.typeOf.number("scalar",t),A.typeOf.object("result",n),n.x=e.x*t,n.y=e.y*t,n.z=e.z*t,n.w=e.w*t,n};pt.divideByScalar=function(e,t,n){return A.typeOf.object("cartesian",e),A.typeOf.number("scalar",t),A.typeOf.object("result",n),n.x=e.x/t,n.y=e.y/t,n.z=e.z/t,n.w=e.w/t,n};pt.negate=function(e,t){return A.typeOf.object("cartesian",e),A.typeOf.object("result",t),t.x=-e.x,t.y=-e.y,t.z=-e.z,t.w=-e.w,t};pt.abs=function(e,t){return A.typeOf.object("cartesian",e),A.typeOf.object("result",t),t.x=Math.abs(e.x),t.y=Math.abs(e.y),t.z=Math.abs(e.z),t.w=Math.abs(e.w),t};var j$=new pt;pt.lerp=function(e,t,n,i){return A.typeOf.object("start",e),A.typeOf.object("end",t),A.typeOf.number("t",n),A.typeOf.object("result",i),pt.multiplyByScalar(t,n,j$),i=pt.multiplyByScalar(e,1-n,i),pt.add(j$,i,i)};var BAe=new pt;pt.mostOrthogonalAxis=function(e,t){A.typeOf.object("cartesian",e),A.typeOf.object("result",t);let n=pt.normalize(e,BAe);return pt.abs(n,n),n.x<=n.y?n.x<=n.z?n.x<=n.w?t=pt.clone(pt.UNIT_X,t):t=pt.clone(pt.UNIT_W,t):n.z<=n.w?t=pt.clone(pt.UNIT_Z,t):t=pt.clone(pt.UNIT_W,t):n.y<=n.z?n.y<=n.w?t=pt.clone(pt.UNIT_Y,t):t=pt.clone(pt.UNIT_W,t):n.z<=n.w?t=pt.clone(pt.UNIT_Z,t):t=pt.clone(pt.UNIT_W,t),t};pt.equals=function(e,t){return e===t||c(e)&&c(t)&&e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w};pt.equalsArray=function(e,t,n){return e.x===t[n]&&e.y===t[n+1]&&e.z===t[n+2]&&e.w===t[n+3]};pt.equalsEpsilon=function(e,t,n,i){return e===t||c(e)&&c(t)&&R.equalsEpsilon(e.x,t.x,n,i)&&R.equalsEpsilon(e.y,t.y,n,i)&&R.equalsEpsilon(e.z,t.z,n,i)&&R.equalsEpsilon(e.w,t.w,n,i)};pt.ZERO=Object.freeze(new pt(0,0,0,0));pt.ONE=Object.freeze(new pt(1,1,1,1));pt.UNIT_X=Object.freeze(new pt(1,0,0,0));pt.UNIT_Y=Object.freeze(new pt(0,1,0,0));pt.UNIT_Z=Object.freeze(new pt(0,0,1,0));pt.UNIT_W=Object.freeze(new pt(0,0,0,1));pt.prototype.clone=function(e){return pt.clone(this,e)};pt.prototype.equals=function(e){return pt.equals(this,e)};pt.prototype.equalsEpsilon=function(e,t,n){return pt.equalsEpsilon(this,e,t,n)};pt.prototype.toString=function(){return`(${this.x}, ${this.y}, ${this.z}, ${this.w})`};var t2=new Float32Array(1),Ma=new Uint8Array(t2.buffer),kAe=new Uint32Array([287454020]),VAe=new Uint8Array(kAe.buffer),W$=VAe[0]===68;pt.packFloat=function(e,t){return A.typeOf.number("value",e),c(t)||(t=new pt),t2[0]=e,W$?(t.x=Ma[0],t.y=Ma[1],t.z=Ma[2],t.w=Ma[3]):(t.x=Ma[3],t.y=Ma[2],t.z=Ma[1],t.w=Ma[0]),t};pt.unpackFloat=function(e){return A.typeOf.object("packedFloat",e),W$?(Ma[0]=e.x,Ma[1]=e.y,Ma[2]=e.z,Ma[3]=e.w):(Ma[0]=e.w,Ma[1]=e.z,Ma[2]=e.y,Ma[3]=e.x),t2[0]};var se=pt;function UAe(e,t,n){A.defined("array",e),A.defined("itemToFind",t),A.defined("comparator",n);let i=0,o=e.length-1,r,s;for(;i<=o;){if(r=~~((i+o)/2),s=n(e[r],t),s<0){i=r+1;continue}if(s>0){o=r-1;continue}return r}return~(o+1)}var vo=UAe;function zAe(e,t,n,i,o){this.xPoleWander=e,this.yPoleWander=t,this.xPoleOffset=n,this.yPoleOffset=i,this.ut1MinusUtc=o}var Tx=zAe;function HAe(e){if(e===null||isNaN(e))throw new E("year is required and must be a number.");return e%4===0&&e%100!==0||e%400===0}var bm=HAe;var q$=[31,28,31,30,31,30,31,31,30,31,30,31];function GAe(e,t,n,i,o,r,s,a){e=y(e,1),t=y(t,1),n=y(n,1),i=y(i,0),o=y(o,0),r=y(r,0),s=y(s,0),a=y(a,!1),b(),x(),this.year=e,this.month=t,this.day=n,this.hour=i,this.minute=o,this.second=r,this.millisecond=s,this.isLeapSecond=a;function b(){A.typeOf.number.greaterThanOrEquals("Year",e,1),A.typeOf.number.lessThanOrEquals("Year",e,9999),A.typeOf.number.greaterThanOrEquals("Month",t,1),A.typeOf.number.lessThanOrEquals("Month",t,12),A.typeOf.number.greaterThanOrEquals("Day",n,1),A.typeOf.number.lessThanOrEquals("Day",n,31),A.typeOf.number.greaterThanOrEquals("Hour",i,0),A.typeOf.number.lessThanOrEquals("Hour",i,23),A.typeOf.number.greaterThanOrEquals("Minute",o,0),A.typeOf.number.lessThanOrEquals("Minute",o,59),A.typeOf.bool("IsLeapSecond",a),A.typeOf.number.greaterThanOrEquals("Second",r,0),A.typeOf.number.lessThanOrEquals("Second",r,a?60:59),A.typeOf.number.greaterThanOrEquals("Millisecond",s,0),A.typeOf.number.lessThan("Millisecond",s,1e3)}function x(){let T=t===2&&bm(e)?q$[t-1]+1:q$[t-1];if(n>T)throw new E("Month and Day represents invalid date")}}var d_=GAe;function jAe(e,t){this.julianDate=e,this.offset=t}var qi=jAe;var WAe={SECONDS_PER_MILLISECOND:.001,SECONDS_PER_MINUTE:60,MINUTES_PER_HOUR:60,HOURS_PER_DAY:24,SECONDS_PER_HOUR:3600,MINUTES_PER_DAY:1440,SECONDS_PER_DAY:86400,DAYS_PER_JULIAN_CENTURY:36525,PICOSECOND:1e-9,MODIFIED_JULIAN_DATE_DIFFERENCE:24000005e-1},qn=Object.freeze(WAe);var qAe={UTC:0,TAI:1},Wn=Object.freeze(qAe);var X$=new d_,YP=[31,28,31,30,31,30,31,31,30,31,30,31],XP=29;function n2(e,t){return Mt.compare(e.julianDate,t.julianDate)}var Ax=new qi;function $P(e){Ax.julianDate=e;let t=Mt.leapSeconds,n=vo(t,Ax,n2);n<0&&(n=~n),n>=t.length&&(n=t.length-1);let i=t[n].offset;n>0&&Mt.secondsDifference(t[n].julianDate,e)>i&&(n--,i=t[n].offset),Mt.addSeconds(e,i,e)}function Y$(e,t){Ax.julianDate=e;let n=Mt.leapSeconds,i=vo(n,Ax,n2);if(i<0&&(i=~i),i===0)return Mt.addSeconds(e,-n[0].offset,t);if(i>=n.length)return Mt.addSeconds(e,-n[i-1].offset,t);let o=Mt.secondsDifference(n[i].julianDate,e);if(o===0)return Mt.addSeconds(e,-n[i].offset,t);if(!(o<=1))return Mt.addSeconds(e,-n[--i].offset,t)}function h_(e,t,n){let i=t/qn.SECONDS_PER_DAY|0;return e+=i,t-=qn.SECONDS_PER_DAY*i,t<0&&(e--,t+=qn.SECONDS_PER_DAY),n.dayNumber=e,n.secondsOfDay=t,n}function i2(e,t,n,i,o,r,s){let a=(t-14)/12|0,l=e+4800+a,u=(1461*l/4|0)+(367*(t-2-12*a)/12|0)-(3*((l+100)/100|0)/4|0)+n-32075;i=i-12,i<0&&(i+=24);let f=r+(i*qn.SECONDS_PER_HOUR+o*qn.SECONDS_PER_MINUTE+s*qn.SECONDS_PER_MILLISECOND);return f>=43200&&(u-=1),[u,f]}var YAe=/^(\d{4})$/,XAe=/^(\d{4})-(\d{2})$/,KAe=/^(\d{4})-?(\d{3})$/,$Ae=/^(\d{4})-?W(\d{2})-?(\d{1})?$/,ZAe=/^(\d{4})-?(\d{2})-?(\d{2})$/,o2=/([Z+\-])?(\d{2})?:?(\d{2})?$/,JAe=/^(\d{2})(\.\d+)?/.source+o2.source,QAe=/^(\d{2}):?(\d{2})(\.\d+)?/.source+o2.source,eCe=/^(\d{2}):?(\d{2}):?(\d{2})(\.\d+)?/.source+o2.source,Ff="Invalid ISO 8601 date.";function Mt(e,t,n){this.dayNumber=void 0,this.secondsOfDay=void 0,e=y(e,0),t=y(t,0),n=y(n,Wn.UTC);let i=e|0;t=t+(e-i)*qn.SECONDS_PER_DAY,h_(i,t,this),n===Wn.UTC&&$P(this)}Mt.fromGregorianDate=function(e,t){if(!(e instanceof d_))throw new E("date must be a valid GregorianDate.");let n=i2(e.year,e.month,e.day,e.hour,e.minute,e.second,e.millisecond);return c(t)?(h_(n[0],n[1],t),$P(t),t):new Mt(n[0],n[1],Wn.UTC)};Mt.fromDate=function(e,t){if(!(e instanceof Date)||isNaN(e.getTime()))throw new E("date must be a valid JavaScript Date.");let n=i2(e.getUTCFullYear(),e.getUTCMonth()+1,e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds());return c(t)?(h_(n[0],n[1],t),$P(t),t):new Mt(n[0],n[1],Wn.UTC)};Mt.fromIso8601=function(e,t){if(typeof e!="string")throw new E(Ff);e=e.replace(",",".");let n=e.split("T"),i,o=1,r=1,s=0,a=0,l=0,u=0,f=n[0],d=n[1],p,g;if(!c(f))throw new E(Ff);let m;if(n=f.match(ZAe),n!==null){if(m=f.split("-").length-1,m>0&&m!==2)throw new E(Ff);i=+n[1],o=+n[2],r=+n[3]}else if(n=f.match(XAe),n!==null)i=+n[1],o=+n[2];else if(n=f.match(YAe),n!==null)i=+n[1];else{let C;if(n=f.match(KAe),n!==null){if(i=+n[1],C=+n[2],g=bm(i),C<1||g&&C>366||!g&&C>365)throw new E(Ff)}else if(n=f.match($Ae),n!==null){i=+n[1];let S=+n[2],v=+n[3]||0;if(m=f.split("-").length-1,m>0&&(!c(n[3])&&m!==1||c(n[3])&&m!==2))throw new E(Ff);let D=new Date(Date.UTC(i,0,4));C=S*7+v-D.getUTCDay()-3}else throw new E(Ff);p=new Date(Date.UTC(i,0,1)),p.setUTCDate(C),o=p.getUTCMonth()+1,r=p.getUTCDate()}if(g=bm(i),o<1||o>12||r<1||(o!==2||!g)&&r>YP[o-1]||g&&o===2&&r>XP)throw new E(Ff);let b;if(c(d)){if(n=d.match(eCe),n!==null){if(m=d.split(":").length-1,m>0&&m!==2&&m!==3)throw new E(Ff);s=+n[1],a=+n[2],l=+n[3],u=+(n[4]||0)*1e3,b=5}else if(n=d.match(QAe),n!==null){if(m=d.split(":").length-1,m>2)throw new E(Ff);s=+n[1],a=+n[2],l=+(n[3]||0)*60,b=4}else if(n=d.match(JAe),n!==null)s=+n[1],a=+(n[2]||0)*60,b=3;else throw new E(Ff);if(a>=60||l>=61||s>24||s===24&&(a>0||l>0||u>0))throw new E(Ff);let C=n[b],S=+n[b+1],v=+(n[b+2]||0);switch(C){case"+":s=s-S,a=a-v;break;case"-":s=s+S,a=a+v;break;case"Z":break;default:a=a+new Date(Date.UTC(i,o-1,r,s,a)).getTimezoneOffset();break}}let x=l===60;for(x&&l--;a>=60;)a-=60,s++;for(;s>=24;)s-=24,r++;for(p=g&&o===2?XP:YP[o-1];r>p;)r-=p,o++,o>12&&(o-=12,i++),p=g&&o===2?XP:YP[o-1];for(;a<0;)a+=60,s--;for(;s<0;)s+=24,r--;for(;r<1;)o--,o<1&&(o+=12,i--),p=g&&o===2?XP:YP[o-1],r+=p;let T=i2(i,o,r,s,a,l,u);return c(t)?(h_(T[0],T[1],t),$P(t)):t=new Mt(T[0],T[1],Wn.UTC),x&&Mt.addSeconds(t,1,t),t};Mt.now=function(e){return Mt.fromDate(new Date,e)};var KP=new Mt(0,0,Wn.TAI);Mt.toGregorianDate=function(e,t){if(!c(e))throw new E("julianDate is required.");let n=!1,i=Y$(e,KP);c(i)||(Mt.addSeconds(e,-1,KP),i=Y$(KP,KP),n=!0);let o=i.dayNumber,r=i.secondsOfDay;r>=43200&&(o+=1);let s=o+68569|0,a=4*s/146097|0;s=s-((146097*a+3)/4|0)|0;let l=4e3*(s+1)/1461001|0;s=s-(1461*l/4|0)+31|0;let u=80*s/2447|0,f=s-(2447*u/80|0)|0;s=u/11|0;let d=u+2-12*s|0,p=100*(a-49)+l+s|0,g=r/qn.SECONDS_PER_HOUR|0,m=r-g*qn.SECONDS_PER_HOUR,b=m/qn.SECONDS_PER_MINUTE|0;m=m-b*qn.SECONDS_PER_MINUTE;let x=m|0,T=(m-x)/qn.SECONDS_PER_MILLISECOND;return g+=12,g>23&&(g-=24),n&&(x+=1),c(t)?(t.year=p,t.month=d,t.day=f,t.hour=g,t.minute=b,t.second=x,t.millisecond=T,t.isLeapSecond=n,t):new d_(p,d,f,g,b,x,T,n)};Mt.toDate=function(e){if(!c(e))throw new E("julianDate is required.");let t=Mt.toGregorianDate(e,X$),n=t.second;return t.isLeapSecond&&(n-=1),new Date(Date.UTC(t.year,t.month-1,t.day,t.hour,t.minute,n,t.millisecond))};Mt.toIso8601=function(e,t){if(!c(e))throw new E("julianDate is required.");let n=Mt.toGregorianDate(e,X$),i=n.year,o=n.month,r=n.day,s=n.hour,a=n.minute,l=n.second,u=n.millisecond;i===1e4&&o===1&&r===1&&s===0&&a===0&&l===0&&u===0&&(i=9999,o=12,r=31,s=24);let f;return!c(t)&&u!==0?(f=(u*.01).toString().replace(".",""),`${i.toString().padStart(4,"0")}-${o.toString().padStart(2,"0")}-${r.toString().padStart(2,"0")}T${s.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}:${l.toString().padStart(2,"0")}.${f}Z`):!c(t)||t===0?`${i.toString().padStart(4,"0")}-${o.toString().padStart(2,"0")}-${r.toString().padStart(2,"0")}T${s.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}:${l.toString().padStart(2,"0")}Z`:(f=(u*.01).toFixed(t).replace(".","").slice(0,t),`${i.toString().padStart(4,"0")}-${o.toString().padStart(2,"0")}-${r.toString().padStart(2,"0")}T${s.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}:${l.toString().padStart(2,"0")}.${f}Z`)};Mt.clone=function(e,t){if(c(e))return c(t)?(t.dayNumber=e.dayNumber,t.secondsOfDay=e.secondsOfDay,t):new Mt(e.dayNumber,e.secondsOfDay,Wn.TAI)};Mt.compare=function(e,t){if(!c(e))throw new E("left is required.");if(!c(t))throw new E("right is required.");let n=e.dayNumber-t.dayNumber;return n!==0?n:e.secondsOfDay-t.secondsOfDay};Mt.equals=function(e,t){return e===t||c(e)&&c(t)&&e.dayNumber===t.dayNumber&&e.secondsOfDay===t.secondsOfDay};Mt.equalsEpsilon=function(e,t,n){return n=y(n,0),e===t||c(e)&&c(t)&&Math.abs(Mt.secondsDifference(e,t))<=n};Mt.totalDays=function(e){if(!c(e))throw new E("julianDate is required.");return e.dayNumber+e.secondsOfDay/qn.SECONDS_PER_DAY};Mt.secondsDifference=function(e,t){if(!c(e))throw new E("left is required.");if(!c(t))throw new E("right is required.");return(e.dayNumber-t.dayNumber)*qn.SECONDS_PER_DAY+(e.secondsOfDay-t.secondsOfDay)};Mt.daysDifference=function(e,t){if(!c(e))throw new E("left is required.");if(!c(t))throw new E("right is required.");let n=e.dayNumber-t.dayNumber,i=(e.secondsOfDay-t.secondsOfDay)/qn.SECONDS_PER_DAY;return n+i};Mt.computeTaiMinusUtc=function(e){Ax.julianDate=e;let t=Mt.leapSeconds,n=vo(t,Ax,n2);return n<0&&(n=~n,--n,n<0&&(n=0)),t[n].offset};Mt.addSeconds=function(e,t,n){if(!c(e))throw new E("julianDate is required.");if(!c(t))throw new E("seconds is required.");if(!c(n))throw new E("result is required.");return h_(e.dayNumber,e.secondsOfDay+t,n)};Mt.addMinutes=function(e,t,n){if(!c(e))throw new E("julianDate is required.");if(!c(t))throw new E("minutes is required.");if(!c(n))throw new E("result is required.");let i=e.secondsOfDay+t*qn.SECONDS_PER_MINUTE;return h_(e.dayNumber,i,n)};Mt.addHours=function(e,t,n){if(!c(e))throw new E("julianDate is required.");if(!c(t))throw new E("hours is required.");if(!c(n))throw new E("result is required.");let i=e.secondsOfDay+t*qn.SECONDS_PER_HOUR;return h_(e.dayNumber,i,n)};Mt.addDays=function(e,t,n){if(!c(e))throw new E("julianDate is required.");if(!c(t))throw new E("days is required.");if(!c(n))throw new E("result is required.");let i=e.dayNumber+t;return h_(i,e.secondsOfDay,n)};Mt.lessThan=function(e,t){return Mt.compare(e,t)<0};Mt.lessThanOrEquals=function(e,t){return Mt.compare(e,t)<=0};Mt.greaterThan=function(e,t){return Mt.compare(e,t)>0};Mt.greaterThanOrEquals=function(e,t){return Mt.compare(e,t)>=0};Mt.prototype.clone=function(e){return Mt.clone(this,e)};Mt.prototype.equals=function(e){return Mt.equals(this,e)};Mt.prototype.equalsEpsilon=function(e,t){return Mt.equalsEpsilon(this,e,t)};Mt.prototype.toString=function(){return Mt.toIso8601(this)};Mt.leapSeconds=[new qi(new Mt(2441317,43210,Wn.TAI),10),new qi(new Mt(2441499,43211,Wn.TAI),11),new qi(new Mt(2441683,43212,Wn.TAI),12),new qi(new Mt(2442048,43213,Wn.TAI),13),new qi(new Mt(2442413,43214,Wn.TAI),14),new qi(new Mt(2442778,43215,Wn.TAI),15),new qi(new Mt(2443144,43216,Wn.TAI),16),new qi(new Mt(2443509,43217,Wn.TAI),17),new qi(new Mt(2443874,43218,Wn.TAI),18),new qi(new Mt(2444239,43219,Wn.TAI),19),new qi(new Mt(2444786,43220,Wn.TAI),20),new qi(new Mt(2445151,43221,Wn.TAI),21),new qi(new Mt(2445516,43222,Wn.TAI),22),new qi(new Mt(2446247,43223,Wn.TAI),23),new qi(new Mt(2447161,43224,Wn.TAI),24),new qi(new Mt(2447892,43225,Wn.TAI),25),new qi(new Mt(2448257,43226,Wn.TAI),26),new qi(new Mt(2448804,43227,Wn.TAI),27),new qi(new Mt(2449169,43228,Wn.TAI),28),new qi(new Mt(2449534,43229,Wn.TAI),29),new qi(new Mt(2450083,43230,Wn.TAI),30),new qi(new Mt(2450630,43231,Wn.TAI),31),new qi(new Mt(2451179,43232,Wn.TAI),32),new qi(new Mt(2453736,43233,Wn.TAI),33),new qi(new Mt(2454832,43234,Wn.TAI),34),new qi(new Mt(2456109,43235,Wn.TAI),35),new qi(new Mt(2457204,43236,Wn.TAI),36),new qi(new Mt(2457754,43237,Wn.TAI),37)];var J=Mt;var hZ=Ur(Pl(),1);function tCe(e){return(e.length===0||e[e.length-1]!=="/")&&(e=`${e}/`),e}var r2=tCe;function tZ(e,t){if(e===null||typeof e!="object")return e;t=y(t,!1);let n=new e.constructor;for(let i in e)if(e.hasOwnProperty(i)){let o=e[i];t&&(o=tZ(o,t)),n[i]=o}return n}var qe=tZ;function nZ(e,t,n){n=y(n,!1);let i={},o=c(e),r=c(t),s,a,l;if(o)for(s in e)e.hasOwnProperty(s)&&(a=e[s],r&&n&&typeof a=="object"&&t.hasOwnProperty(s)?(l=t[s],typeof l=="object"?i[s]=nZ(a,l,n):i[s]=a):i[s]=a);if(r)for(s in t)t.hasOwnProperty(s)&&!i.hasOwnProperty(s)&&(l=t[s],i[s]=l);return i}var At=nZ;function nCe(){let e,t,n=new Promise(function(i,o){e=i,t=o});return{resolve:e,reject:t,promise:n}}var Pu=nCe;var iZ=Ur(Pl(),1);function s2(e,t){let n;return typeof document<"u"&&(n=document),s2._implementation(e,t,n)}s2._implementation=function(e,t,n){if(!c(e))throw new E("relative uri is required.");if(!c(t)){if(typeof n>"u")return e;t=y(n.baseURI,n.location.href)}let i=new iZ.default(e);return i.scheme()!==""?i.toString():i.absoluteTo(t).toString()};var m_=s2;var oZ=Ur(Pl(),1);function iCe(e,t){if(!c(e))throw new E("uri is required.");let n="",i=e.lastIndexOf("/");return i!==-1&&(n=e.substring(0,i+1)),t&&(e=new oZ.default(e),e.query().length!==0&&(n+=`?${e.query()}`),e.fragment().length!==0&&(n+=`#${e.fragment()}`)),n}var a2=iCe;var rZ=Ur(Pl(),1);function oCe(e){if(!c(e))throw new E("uri is required.");let t=new rZ.default(e);t.normalize();let n=t.path(),i=n.lastIndexOf("/");return i!==-1&&(n=n.substr(i+1)),i=n.lastIndexOf("."),i===-1?n="":n=n.substr(i+1),n}var sE=oCe;var sZ={};function rCe(e,t,n){c(t)||(t=e.width),c(n)||(n=e.height);let i=sZ[t];c(i)||(i={},sZ[t]=i);let o=i[n];if(!c(o)){let r=document.createElement("canvas");r.width=t,r.height=n,o=r.getContext("2d",{willReadFrequently:!0}),o.globalCompositeOperation="copy",i[n]=o}return o.drawImage(e,0,0,t,n),o.getImageData(0,0,t,n).data}var xm=rCe;var sCe=/^blob:/i;function aCe(e){return A.typeOf.string("uri",e),sCe.test(e)}var aE=aCe;var Jd;function cCe(e){c(Jd)||(Jd=document.createElement("a")),Jd.href=window.location.href;let t=Jd.host,n=Jd.protocol;return Jd.href=e,Jd.href=Jd.href,n!==Jd.protocol||t!==Jd.host}var Sx=cCe;var lCe=/^data:/i;function uCe(e){return A.typeOf.string("uri",e),lCe.test(e)}var Oy=uCe;function fCe(e){let t=document.createElement("script");return t.async=!0,t.src=e,new Promise((n,i)=>{window.crossOriginIsolated&&t.setAttribute("crossorigin","anonymous");let o=document.getElementsByTagName("head")[0];t.onload=function(){t.onload=void 0,o.removeChild(t),n()},t.onerror=function(r){i(r)},o.appendChild(t)})}var cE=fCe;function dCe(e){if(!c(e))throw new E("obj is required.");let t="";for(let n in e)if(e.hasOwnProperty(n)){let i=e[n],o=`${encodeURIComponent(n)}=`;if(Array.isArray(i))for(let r=0,s=i.length;r<s;++r)t+=`${o+encodeURIComponent(i[r])}&`;else t+=`${o+encodeURIComponent(i)}&`}return t=t.slice(0,-1),t}var lE=dCe;function hCe(e){if(!c(e))throw new E("queryString is required.");let t={};if(e==="")return t;let n=e.replace(/\+/g,"%20").split(/[&;]/);for(let i=0,o=n.length;i<o;++i){let r=n[i].split("="),s=decodeURIComponent(r[0]),a=r[1];c(a)?a=decodeURIComponent(a):a="";let l=t[s];typeof l=="string"?t[s]=[l,a]:Array.isArray(l)?l.push(a):t[s]=a}return t}var Bf=hCe;var mCe={UNISSUED:0,ISSUED:1,ACTIVE:2,RECEIVED:3,CANCELLED:4,FAILED:5},Jn=Object.freeze(mCe);var pCe={TERRAIN:0,IMAGERY:1,TILES3D:2,OTHER:3},Es=Object.freeze(pCe);function eI(e){e=y(e,y.EMPTY_OBJECT);let t=y(e.throttleByServer,!1),n=y(e.throttle,!1);this.url=e.url,this.requestFunction=e.requestFunction,this.cancelFunction=e.cancelFunction,this.priorityFunction=e.priorityFunction,this.priority=y(e.priority,0),this.throttle=n,this.throttleByServer=t,this.type=y(e.type,Es.OTHER),this.serverKey=e.serverKey,this.state=Jn.UNISSUED,this.deferred=void 0,this.cancelled=!1}eI.prototype.cancel=function(){this.cancelled=!0};eI.prototype.clone=function(e){return c(e)?(e.url=this.url,e.requestFunction=this.requestFunction,e.cancelFunction=this.cancelFunction,e.priorityFunction=this.priorityFunction,e.priority=this.priority,e.throttle=this.throttle,e.throttleByServer=this.throttleByServer,e.type=this.type,e.serverKey=this.serverKey,e.state=Jn.UNISSUED,e.deferred=void 0,e.cancelled=!1,e):new eI(this)};var ur=eI;function _Ce(e){let t={};if(!e)return t;let n=e.split(`\r
`);for(let i=0;i<n.length;++i){let o=n[i],r=o.indexOf(": ");if(r>0){let s=o.substring(0,r),a=o.substring(r+2);t[s]=a}}return t}var c2=_Ce;function aZ(e,t,n){this.statusCode=e,this.response=t,this.responseHeaders=n,typeof this.responseHeaders=="string"&&(this.responseHeaders=c2(this.responseHeaders))}aZ.prototype.toString=function(){let e="Request has failed.";return c(this.statusCode)&&(e+=` Status Code: ${this.statusCode}`),e};var p_=aZ;var tI=Ur(Pl(),1);function Ry(e){A.typeOf.object("options",e),A.defined("options.comparator",e.comparator),this._comparator=e.comparator,this._array=[],this._length=0,this._maximumLength=void 0}Object.defineProperties(Ry.prototype,{length:{get:function(){return this._length}},internalArray:{get:function(){return this._array}},maximumLength:{get:function(){return this._maximumLength},set:function(e){A.typeOf.number.greaterThanOrEquals("maximumLength",e,0);let t=this._length;if(e<t){let n=this._array;for(let i=e;i<t;++i)n[i]=void 0;this._length=e,n.length=e}this._maximumLength=e}},comparator:{get:function(){return this._comparator}}});function l2(e,t,n){let i=e[t];e[t]=e[n],e[n]=i}Ry.prototype.reserve=function(e){e=y(e,this._length),this._array.length=e};Ry.prototype.heapify=function(e){e=y(e,0);let t=this._length,n=this._comparator,i=this._array,o=-1,r=!0;for(;r;){let s=2*(e+1),a=s-1;a<t&&n(i[a],i[e])<0?o=a:o=e,s<t&&n(i[s],i[o])<0&&(o=s),o!==e?(l2(i,o,e),e=o):r=!1}};Ry.prototype.resort=function(){let e=this._length;for(let t=Math.ceil(e/2);t>=0;--t)this.heapify(t)};Ry.prototype.insert=function(e){A.defined("element",e);let t=this._array,n=this._comparator,i=this._maximumLength,o=this._length++;for(o<t.length?t[o]=e:t.push(e);o!==0;){let s=Math.floor((o-1)/2);if(n(t[o],t[s])<0)l2(t,o,s),o=s;else break}let r;return c(i)&&this._length>i&&(r=t[i],this._length=i),r};Ry.prototype.pop=function(e){if(e=y(e,0),this._length===0)return;A.typeOf.number.lessThan("index",e,this._length);let t=this._array,n=t[e];return l2(t,e,--this._length),this.heapify(e),t[this._length]=void 0,n};var u2=Ry;function gCe(e,t){return e.priority-t.priority}var Yi={numberOfAttemptedRequests:0,numberOfActiveRequests:0,numberOfCancelledRequests:0,numberOfCancelledActiveRequests:0,numberOfFailedRequests:0,numberOfActiveRequestsEver:0,lastNumberOfActiveRequests:0},wx=20,La=new u2({comparator:gCe});La.maximumLength=wx;La.reserve(wx);var Qd=[],Tm={},yCe=typeof document<"u"?new tI.default(document.location.href):new tI.default,nI=new pe;function Bo(){}Bo.maximumRequests=50;Bo.maximumRequestsPerServer=18;Bo.requestsByServer={};Bo.throttleRequests=!0;Bo.debugShowStatistics=!1;Bo.requestCompletedEvent=nI;Object.defineProperties(Bo,{statistics:{get:function(){return Yi}},priorityHeapLength:{get:function(){return wx},set:function(e){if(e<wx)for(;La.length>e;){let t=La.pop();My(t)}wx=e,La.maximumLength=e,La.reserve(e)}}});function cZ(e){c(e.priorityFunction)&&(e.priority=e.priorityFunction())}Bo.serverHasOpenSlots=function(e,t){t=y(t,1);let n=y(Bo.requestsByServer[e],Bo.maximumRequestsPerServer);return Tm[e]+t<=n};Bo.heapHasOpenSlots=function(e){return La.length+e<=wx};function lZ(e){return e.state===Jn.UNISSUED&&(e.state=Jn.ISSUED,e.deferred=Pu()),e.deferred.promise}function bCe(e){return function(t){if(e.state===Jn.CANCELLED)return;let n=e.deferred;--Yi.numberOfActiveRequests,--Tm[e.serverKey],nI.raiseEvent(),e.state=Jn.RECEIVED,e.deferred=void 0,n.resolve(t)}}function xCe(e){return function(t){e.state!==Jn.CANCELLED&&(++Yi.numberOfFailedRequests,--Yi.numberOfActiveRequests,--Tm[e.serverKey],nI.raiseEvent(t),e.state=Jn.FAILED,e.deferred.reject(t))}}function uZ(e){let t=lZ(e);return e.state=Jn.ACTIVE,Qd.push(e),++Yi.numberOfActiveRequests,++Yi.numberOfActiveRequestsEver,++Tm[e.serverKey],e.requestFunction().then(bCe(e)).catch(xCe(e)),t}function My(e){let t=e.state===Jn.ACTIVE;if(e.state=Jn.CANCELLED,++Yi.numberOfCancelledRequests,c(e.deferred)){let n=e.deferred;e.deferred=void 0,n.reject()}t&&(--Yi.numberOfActiveRequests,--Tm[e.serverKey],++Yi.numberOfCancelledActiveRequests),c(e.cancelFunction)&&e.cancelFunction()}Bo.update=function(){let e,t,n=0,i=Qd.length;for(e=0;e<i;++e){if(t=Qd[e],t.cancelled&&My(t),t.state!==Jn.ACTIVE){++n;continue}n>0&&(Qd[e-n]=t)}Qd.length-=n;let o=La.internalArray,r=La.length;for(e=0;e<r;++e)cZ(o[e]);La.resort();let s=Math.max(Bo.maximumRequests-Qd.length,0),a=0;for(;a<s&&La.length>0;){if(t=La.pop(),t.cancelled){My(t);continue}if(t.throttleByServer&&!Bo.serverHasOpenSlots(t.serverKey)){My(t);continue}uZ(t),++a}TCe()};Bo.getServerKey=function(e){A.typeOf.string("url",e);let t=new tI.default(e);t.scheme()===""&&(t=t.absoluteTo(yCe),t.normalize());let n=t.authority();/:/.test(n)||(n=`${n}:${t.scheme()==="https"?"443":"80"}`);let i=Tm[n];return c(i)||(Tm[n]=0),n};Bo.request=function(e){if(A.typeOf.object("request",e),A.typeOf.string("request.url",e.url),A.typeOf.func("request.requestFunction",e.requestFunction),Oy(e.url)||aE(e.url))return nI.raiseEvent(),e.state=Jn.RECEIVED,e.requestFunction();if(++Yi.numberOfAttemptedRequests,c(e.serverKey)||(e.serverKey=Bo.getServerKey(e.url)),Bo.throttleRequests&&e.throttleByServer&&!Bo.serverHasOpenSlots(e.serverKey))return;if(!Bo.throttleRequests||!e.throttle)return uZ(e);if(Qd.length>=Bo.maximumRequests)return;cZ(e);let t=La.insert(e);if(c(t)){if(t===e)return;My(t)}return lZ(e)};function TCe(){Bo.debugShowStatistics&&(Yi.numberOfActiveRequests===0&&Yi.lastNumberOfActiveRequests>0&&(Yi.numberOfAttemptedRequests>0&&(console.log(`Number of attempted requests: ${Yi.numberOfAttemptedRequests}`),Yi.numberOfAttemptedRequests=0),Yi.numberOfCancelledRequests>0&&(console.log(`Number of cancelled requests: ${Yi.numberOfCancelledRequests}`),Yi.numberOfCancelledRequests=0),Yi.numberOfCancelledActiveRequests>0&&(console.log(`Number of cancelled active requests: ${Yi.numberOfCancelledActiveRequests}`),Yi.numberOfCancelledActiveRequests=0),Yi.numberOfFailedRequests>0&&(console.log(`Number of failed requests: ${Yi.numberOfFailedRequests}`),Yi.numberOfFailedRequests=0)),Yi.lastNumberOfActiveRequests=Yi.numberOfActiveRequests)}Bo.clearForSpecs=function(){for(;La.length>0;){let t=La.pop();My(t)}let e=Qd.length;for(let t=0;t<e;++t)My(Qd[t]);Qd.length=0,Tm={},Yi.numberOfAttemptedRequests=0,Yi.numberOfActiveRequests=0,Yi.numberOfCancelledRequests=0,Yi.numberOfCancelledActiveRequests=0,Yi.numberOfFailedRequests=0,Yi.numberOfActiveRequestsEver=0,Yi.lastNumberOfActiveRequests=0};Bo.numberOfActiveRequestsByServer=function(e){return Tm[e]};Bo.requestHeap=La;var qc=Bo;function uE(e){this.name="RuntimeError",this.message=e;let t;try{throw new Error}catch(n){t=n.stack}this.stack=t}c(Object.create)&&(uE.prototype=Object.create(Error.prototype),uE.prototype.constructor=uE);uE.prototype.toString=function(){let e=`${this.name}: ${this.message}`;return c(this.stack)&&(e+=`
${this.stack.toString()}`),e};var ue=uE;var fZ=Ur(Pl(),1);var fE={},vx={};fE.add=function(e,t){if(!c(e))throw new E("host is required.");if(!c(t)||t<=0)throw new E("port is required to be greater than 0.");let n=`${e.toLowerCase()}:${t}`;c(vx[n])||(vx[n]=!0)};fE.remove=function(e,t){if(!c(e))throw new E("host is required.");if(!c(t)||t<=0)throw new E("port is required to be greater than 0.");let n=`${e.toLowerCase()}:${t}`;c(vx[n])&&delete vx[n]};function ACe(e){let t=new fZ.default(e);t.normalize();let n=t.authority();if(n.length!==0){if(t.authority(n),n.indexOf("@")!==-1&&(n=n.split("@")[1]),n.indexOf(":")===-1){let i=t.scheme();if(i.length===0&&(i=window.location.protocol,i=i.substring(0,i.length-1)),i==="http")n+=":80";else if(i==="https")n+=":443";else return}return n}}fE.contains=function(e){if(!c(e))throw new E("url is required.");let t=ACe(e);return!!(c(t)&&c(vx[t]))};fE.clear=function(){vx={}};var iI=fE;var mZ=function(){try{let e=new XMLHttpRequest;return e.open("GET","#",!0),e.responseType="blob",e.responseType==="blob"}catch{return!1}}();function wt(e){e=y(e,y.EMPTY_OBJECT),typeof e=="string"&&(e={url:e}),A.typeOf.string("options.url",e.url),this._url=void 0,this._templateValues=eh(e.templateValues,{}),this._queryParameters=eh(e.queryParameters,{}),this.headers=eh(e.headers,{}),this.request=y(e.request,new ur),this.proxy=e.proxy,this.retryCallback=e.retryCallback,this.retryAttempts=y(e.retryAttempts,0),this._retryCount=0,y(e.parseUrl,!0)?this.parseUrl(e.url,!0,!0):this._url=e.url,this._credits=e.credits}function eh(e,t){return c(e)?qe(e):t}wt.createIfNeeded=function(e){return e instanceof wt?e.getDerivedResource({request:e.request}):typeof e!="string"?e:new wt({url:e})};var Dx;wt.supportsImageBitmapOptions=function(){return c(Dx)?Dx:typeof createImageBitmap!="function"?(Dx=Promise.resolve(!1),Dx):(Dx=wt.fetchBlob({url:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAIAAACQd1PeAAAABGdBTUEAAE4g3rEiDgAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAADElEQVQI12Ng6GAAAAEUAIngE3ZiAAAAAElFTkSuQmCC"}).then(function(t){let n={imageOrientation:"flipY",premultiplyAlpha:"none",colorSpaceConversion:"none"};return Promise.all([createImageBitmap(t,n),createImageBitmap(t)])}).then(function(t){let n=xm(t[0]),i=xm(t[1]);return n[1]!==i[1]}).catch(function(){return!1}),Dx)};Object.defineProperties(wt,{isBlobSupported:{get:function(){return mZ}}});Object.defineProperties(wt.prototype,{queryParameters:{get:function(){return this._queryParameters}},templateValues:{get:function(){return this._templateValues}},url:{get:function(){return this.getUrlComponent(!0,!0)},set:function(e){this.parseUrl(e,!1,!1)}},extension:{get:function(){return sE(this._url)}},isDataUri:{get:function(){return Oy(this._url)}},isBlobUri:{get:function(){return aE(this._url)}},isCrossOriginUrl:{get:function(){return Sx(this._url)}},hasHeaders:{get:function(){return Object.keys(this.headers).length>0}},credits:{get:function(){return this._credits}}});wt.prototype.toString=function(){return this.getUrlComponent(!0,!0)};wt.prototype.parseUrl=function(e,t,n,i){let o=new hZ.default(e),r=CCe(o.query());this._queryParameters=t?rI(r,this.queryParameters,n):r,o.search(""),o.fragment(""),c(i)&&o.scheme()===""&&(o=o.absoluteTo(m_(i))),this._url=o.toString()};function CCe(e){return e.length===0?{}:e.indexOf("=")===-1?{[e]:void 0}:Bf(e)}function rI(e,t,n){if(!n)return At(e,t);let i=qe(e,!0);for(let o in t)if(t.hasOwnProperty(o)){let r=i[o],s=t[o];c(r)?(Array.isArray(r)||(r=i[o]=[r]),i[o]=r.concat(s)):i[o]=Array.isArray(s)?s.slice():s}return i}wt.prototype.getUrlComponent=function(e,t){if(this.isDataUri)return this._url;let n=this._url;e&&(n=`${n}${ECe(this.queryParameters)}`),n=n.replace(/%7B/g,"{").replace(/%7D/g,"}");let i=this._templateValues;return Object.keys(i).length>0&&(n=n.replace(/{(.*?)}/g,function(o,r){let s=i[r];return c(s)?encodeURIComponent(s):o})),t&&c(this.proxy)&&(n=this.proxy.getURL(n)),n};function ECe(e){let t=Object.keys(e);return t.length===0?"":t.length===1&&!c(e[t[0]])?`?${t[0]}`:`?${lE(e)}`}wt.prototype.setQueryParameters=function(e,t){t?this._queryParameters=rI(this._queryParameters,e,!1):this._queryParameters=rI(e,this._queryParameters,!1)};wt.prototype.appendQueryParameters=function(e){this._queryParameters=rI(e,this._queryParameters,!0)};wt.prototype.setTemplateValues=function(e,t){t?this._templateValues=At(this._templateValues,e):this._templateValues=At(e,this._templateValues)};wt.prototype.getDerivedResource=function(e){let t=this.clone();if(t._retryCount=0,c(e.url)){let n=y(e.preserveQueryParameters,!1);t.parseUrl(e.url,!0,n,this._url)}return c(e.queryParameters)&&(t._queryParameters=At(e.queryParameters,t.queryParameters)),c(e.templateValues)&&(t._templateValues=At(e.templateValues,t.templateValues)),c(e.headers)&&(t.headers=At(e.headers,t.headers)),c(e.proxy)&&(t.proxy=e.proxy),c(e.request)&&(t.request=e.request),c(e.retryCallback)&&(t.retryCallback=e.retryCallback),c(e.retryAttempts)&&(t.retryAttempts=e.retryAttempts),t};wt.prototype.retryOnError=function(e){let t=this.retryCallback;if(typeof t!="function"||this._retryCount>=this.retryAttempts)return Promise.resolve(!1);let n=this;return Promise.resolve(t(this,e)).then(function(i){return++n._retryCount,i})};wt.prototype.clone=function(e){return c(e)?(e._url=this._url,e._queryParameters=qe(this._queryParameters),e._templateValues=qe(this._templateValues),e.headers=qe(this.headers),e.proxy=this.proxy,e.retryCallback=this.retryCallback,e.retryAttempts=this.retryAttempts,e._retryCount=0,e.request=this.request.clone(),e):new wt({url:this._url,queryParameters:this.queryParameters,templateValues:this.templateValues,headers:this.headers,proxy:this.proxy,retryCallback:this.retryCallback,retryAttempts:this.retryAttempts,request:this.request.clone(),parseUrl:!1,credits:c(this.credits)?this.credits.slice():void 0})};wt.prototype.getBaseUri=function(e){return a2(this.getUrlComponent(e),e)};wt.prototype.appendForwardSlash=function(){this._url=r2(this._url)};wt.prototype.fetchArrayBuffer=function(){return this.fetch({responseType:"arraybuffer"})};wt.fetchArrayBuffer=function(e){return new wt(e).fetchArrayBuffer()};wt.prototype.fetchBlob=function(){return this.fetch({responseType:"blob"})};wt.fetchBlob=function(e){return new wt(e).fetchBlob()};wt.prototype.fetchImage=function(e){e=y(e,y.EMPTY_OBJECT);let t=y(e.preferImageBitmap,!1),n=y(e.preferBlob,!1),i=y(e.flipY,!1),o=y(e.skipColorSpaceConversion,!1);if(d2(this.request),!mZ||this.isDataUri||this.isBlobUri||!this.hasHeaders&&!n)return f2({resource:this,flipY:i,skipColorSpaceConversion:o,preferImageBitmap:t});let r=this.fetchBlob();if(!c(r))return;let s,a,l,u;return wt.supportsImageBitmapOptions().then(function(f){return s=f,a=s&&t,r}).then(function(f){if(!c(f))return;if(u=f,a)return wt.createImageBitmapFromBlob(f,{flipY:i,premultiplyAlpha:!1,skipColorSpaceConversion:o});let d=window.URL.createObjectURL(f);return l=new wt({url:d}),f2({resource:l,flipY:i,skipColorSpaceConversion:o,preferImageBitmap:!1})}).then(function(f){if(c(f))return f.blob=u,a||window.URL.revokeObjectURL(l.url),f}).catch(function(f){return c(l)&&window.URL.revokeObjectURL(l.url),f.blob=u,Promise.reject(f)})};function f2(e){let t=e.resource,n=e.flipY,i=e.skipColorSpaceConversion,o=e.preferImageBitmap,r=t.request;r.url=t.url,r.requestFunction=function(){let a=!1;!t.isDataUri&&!t.isBlobUri&&(a=t.isCrossOriginUrl);let l=Pu();return wt._Implementations.createImage(r,a,l,n,i,o),l.promise};let s=qc.request(r);if(c(s))return s.catch(function(a){return r.state!==Jn.FAILED?Promise.reject(a):t.retryOnError(a).then(function(l){return l?(r.state=Jn.UNISSUED,r.deferred=void 0,f2({resource:t,flipY:n,skipColorSpaceConversion:i,preferImageBitmap:o})):Promise.reject(a)})})}wt.fetchImage=function(e){return new wt(e).fetchImage({flipY:e.flipY,skipColorSpaceConversion:e.skipColorSpaceConversion,preferBlob:e.preferBlob,preferImageBitmap:e.preferImageBitmap})};wt.prototype.fetchText=function(){return this.fetch({responseType:"text"})};wt.fetchText=function(e){return new wt(e).fetchText()};wt.prototype.fetchJson=function(){let e=this.fetch({responseType:"text",headers:{Accept:"application/json,*/*;q=0.01"}});if(c(e))return e.then(function(t){if(c(t))return JSON.parse(t)})};wt.fetchJson=function(e){return new wt(e).fetchJson()};wt.prototype.fetchXML=function(){return this.fetch({responseType:"document",overrideMimeType:"text/xml"})};wt.fetchXML=function(e){return new wt(e).fetchXML()};wt.prototype.fetchJsonp=function(e){e=y(e,"callback"),d2(this.request);let t;do t=`loadJsonp${R.nextRandomNumber().toString().substring(2,8)}`;while(c(window[t]));return pZ(this,e,t)};function pZ(e,t,n){let i={};i[t]=n,e.setQueryParameters(i);let o=e.request,r=e.url;o.url=r,o.requestFunction=function(){let a=Pu();return window[n]=function(l){a.resolve(l);try{delete window[n]}catch{window[n]=void 0}},wt._Implementations.loadAndExecuteScript(r,n,a),a.promise};let s=qc.request(o);if(c(s))return s.catch(function(a){return o.state!==Jn.FAILED?Promise.reject(a):e.retryOnError(a).then(function(l){return l?(o.state=Jn.UNISSUED,o.deferred=void 0,pZ(e,t,n)):Promise.reject(a)})})}wt.fetchJsonp=function(e){return new wt(e).fetchJsonp(e.callbackParameterName)};wt.prototype._makeRequest=function(e){let t=this;d2(t.request);let n=t.request,i=t.url;n.url=i,n.requestFunction=function(){let r=e.responseType,s=At(e.headers,t.headers),a=e.overrideMimeType,l=e.method,u=e.data,f=Pu(),d=wt._Implementations.loadWithXhr(i,r,l,u,s,f,a);return c(d)&&c(d.abort)&&(n.cancelFunction=function(){d.abort()}),f.promise};let o=qc.request(n);if(c(o))return o.then(function(r){return n.cancelFunction=void 0,r}).catch(function(r){return n.cancelFunction=void 0,n.state!==Jn.FAILED?Promise.reject(r):t.retryOnError(r).then(function(s){return s?(n.state=Jn.UNISSUED,n.deferred=void 0,t.fetch(e)):Promise.reject(r)})})};function d2(e){if(e.state===Jn.ISSUED||e.state===Jn.ACTIVE)throw new ue("The Resource is already being fetched.");e.state=Jn.UNISSUED,e.deferred=void 0}var SCe=/^data:(.*?)(;base64)?,(.*)$/;function oI(e,t){let n=decodeURIComponent(t);return e?atob(n):n}function dZ(e,t){let n=oI(e,t),i=new ArrayBuffer(n.length),o=new Uint8Array(i);for(let r=0;r<n.length;r++)o[r]=n.charCodeAt(r);return i}function wCe(e,t){t=y(t,"");let n=e[1],i=!!e[2],o=e[3],r,s;switch(t){case"":case"text":return oI(i,o);case"arraybuffer":return dZ(i,o);case"blob":return r=dZ(i,o),new Blob([r],{type:n});case"document":return s=new DOMParser,s.parseFromString(oI(i,o),n);case"json":return JSON.parse(oI(i,o));default:throw new E(`Unhandled responseType: ${t}`)}}wt.prototype.fetch=function(e){return e=eh(e,{}),e.method="GET",this._makeRequest(e)};wt.fetch=function(e){return new wt(e).fetch({responseType:e.responseType,overrideMimeType:e.overrideMimeType})};wt.prototype.delete=function(e){return e=eh(e,{}),e.method="DELETE",this._makeRequest(e)};wt.delete=function(e){return new wt(e).delete({responseType:e.responseType,overrideMimeType:e.overrideMimeType,data:e.data})};wt.prototype.head=function(e){return e=eh(e,{}),e.method="HEAD",this._makeRequest(e)};wt.head=function(e){return new wt(e).head({responseType:e.responseType,overrideMimeType:e.overrideMimeType})};wt.prototype.options=function(e){return e=eh(e,{}),e.method="OPTIONS",this._makeRequest(e)};wt.options=function(e){return new wt(e).options({responseType:e.responseType,overrideMimeType:e.overrideMimeType})};wt.prototype.post=function(e,t){return A.defined("data",e),t=eh(t,{}),t.method="POST",t.data=e,this._makeRequest(t)};wt.post=function(e){return new wt(e).post(e.data,{responseType:e.responseType,overrideMimeType:e.overrideMimeType})};wt.prototype.put=function(e,t){return A.defined("data",e),t=eh(t,{}),t.method="PUT",t.data=e,this._makeRequest(t)};wt.put=function(e){return new wt(e).put(e.data,{responseType:e.responseType,overrideMimeType:e.overrideMimeType})};wt.prototype.patch=function(e,t){return A.defined("data",e),t=eh(t,{}),t.method="PATCH",t.data=e,this._makeRequest(t)};wt.patch=function(e){return new wt(e).patch(e.data,{responseType:e.responseType,overrideMimeType:e.overrideMimeType})};wt._Implementations={};wt._Implementations.loadImageElement=function(e,t,n){let i=new Image;i.onload=function(){i.naturalWidth===0&&i.naturalHeight===0&&i.width===0&&i.height===0&&(i.width=300,i.height=150),n.resolve(i)},i.onerror=function(o){n.reject(o)},t&&(iI.contains(e)?i.crossOrigin="use-credentials":i.crossOrigin=""),i.src=e};wt._Implementations.createImage=function(e,t,n,i,o,r){let s=e.url;wt.supportsImageBitmapOptions().then(function(a){if(!(a&&r)){wt._Implementations.loadImageElement(s,t,n);return}let l="blob",u="GET",f=Pu(),d=wt._Implementations.loadWithXhr(s,l,u,void 0,void 0,f,void 0,void 0,void 0);return c(d)&&c(d.abort)&&(e.cancelFunction=function(){d.abort()}),f.promise.then(function(p){if(!c(p)){n.reject(new ue(`Successfully retrieved ${s} but it contained no content.`));return}return wt.createImageBitmapFromBlob(p,{flipY:i,premultiplyAlpha:!1,skipColorSpaceConversion:o})}).then(function(p){n.resolve(p)})}).catch(function(a){n.reject(a)})};wt.createImageBitmapFromBlob=function(e,t){return A.defined("options",t),A.typeOf.bool("options.flipY",t.flipY),A.typeOf.bool("options.premultiplyAlpha",t.premultiplyAlpha),A.typeOf.bool("options.skipColorSpaceConversion",t.skipColorSpaceConversion),createImageBitmap(e,{imageOrientation:t.flipY?"flipY":"none",premultiplyAlpha:t.premultiplyAlpha?"premultiply":"none",colorSpaceConversion:t.skipColorSpaceConversion?"none":"default"})};function vCe(e,t,n,i,o,r,s){fetch(e,{method:n,headers:o}).then(async a=>{if(!a.ok){let l={};a.headers.forEach((u,f)=>{l[f]=u}),r.reject(new p_(a.status,a,l));return}switch(t){case"text":r.resolve(a.text());break;case"json":r.resolve(a.json());break;default:r.resolve(new Uint8Array(await a.arrayBuffer()).buffer);break}}).catch(()=>{r.reject(new p_)})}var DCe=typeof XMLHttpRequest>"u";wt._Implementations.loadWithXhr=function(e,t,n,i,o,r,s){let a=SCe.exec(e);if(a!==null){r.resolve(wCe(a,t));return}if(DCe){vCe(e,t,n,i,o,r,s);return}let l=new XMLHttpRequest;if(iI.contains(e)&&(l.withCredentials=!0),l.open(n,e,!0),c(s)&&c(l.overrideMimeType)&&l.overrideMimeType(s),c(o))for(let f in o)o.hasOwnProperty(f)&&l.setRequestHeader(f,o[f]);c(t)&&(l.responseType=t);let u=!1;return typeof e=="string"&&(u=e.indexOf("file://")===0||typeof window<"u"&&window.location.origin==="file://"),l.onload=function(){if((l.status<200||l.status>=300)&&!(u&&l.status===0)){r.reject(new p_(l.status,l.response,l.getAllResponseHeaders()));return}let f=l.response,d=l.responseType;if(n==="HEAD"||n==="OPTIONS"){let g=l.getAllResponseHeaders().trim().split(/[\r\n]+/),m={};g.forEach(function(b){let x=b.split(": "),T=x.shift();m[T]=x.join(": ")}),r.resolve(m);return}if(l.status===204)r.resolve(void 0);else if(c(f)&&(!c(t)||d===t))r.resolve(f);else if(t==="json"&&typeof f=="string")try{r.resolve(JSON.parse(f))}catch(p){r.reject(p)}else(d===""||d==="document")&&c(l.responseXML)&&l.responseXML.hasChildNodes()?r.resolve(l.responseXML):(d===""||d==="text")&&c(l.responseText)?r.resolve(l.responseText):r.reject(new ue("Invalid XMLHttpRequest response type."))},l.onerror=function(f){r.reject(new p_)},l.send(i),l};wt._Implementations.loadAndExecuteScript=function(e,t,n){return cE(e,t).catch(function(i){n.reject(i)})};wt._DefaultImplementations={};wt._DefaultImplementations.createImage=wt._Implementations.createImage;wt._DefaultImplementations.loadWithXhr=wt._Implementations.loadWithXhr;wt._DefaultImplementations.loadAndExecuteScript=wt._Implementations.loadAndExecuteScript;wt.DEFAULT=Object.freeze(new wt({url:typeof document>"u"?"":document.location.href.split("?")[0]}));var De=wt;function hE(e){e=y(e,y.EMPTY_OBJECT),this._dates=void 0,this._samples=void 0,this._dateColumn=-1,this._xPoleWanderRadiansColumn=-1,this._yPoleWanderRadiansColumn=-1,this._ut1MinusUtcSecondsColumn=-1,this._xCelestialPoleOffsetRadiansColumn=-1,this._yCelestialPoleOffsetRadiansColumn=-1,this._taiMinusUtcSecondsColumn=-1,this._columnCount=0,this._lastIndex=-1,this._addNewLeapSeconds=y(e.addNewLeapSeconds,!0),c(e.data)?_Z(this,e.data):_Z(this,{columnNames:["dateIso8601","modifiedJulianDateUtc","xPoleWanderRadians","yPoleWanderRadians","ut1MinusUtcSeconds","lengthOfDayCorrectionSeconds","xCelestialPoleOffsetRadians","yCelestialPoleOffsetRadians","taiMinusUtcSeconds"],samples:[]})}hE.fromUrl=async function(e,t){A.defined("url",e),t=y(t,y.EMPTY_OBJECT);let n=De.createIfNeeded(e),i;try{i=await n.fetchJson()}catch{throw new ue(`An error occurred while retrieving the EOP data from the URL ${n.url}.`)}return new hE({addNewLeapSeconds:t.addNewLeapSeconds,data:i})};hE.NONE=Object.freeze({compute:function(e,t){return c(t)?(t.xPoleWander=0,t.yPoleWander=0,t.xPoleOffset=0,t.yPoleOffset=0,t.ut1MinusUtc=0):t=new Tx(0,0,0,0,0),t}});hE.prototype.compute=function(e,t){if(!c(this._samples))return;if(c(t)||(t=new Tx(0,0,0,0,0)),this._samples.length===0)return t.xPoleWander=0,t.yPoleWander=0,t.xPoleOffset=0,t.yPoleOffset=0,t.ut1MinusUtc=0,t;let n=this._dates,i=this._lastIndex,o=0,r=0;if(c(i)){let a=n[i],l=n[i+1],u=J.lessThanOrEquals(a,e),f=!c(l),d=f||J.greaterThanOrEquals(l,e);if(u&&d)return o=i,!f&&l.equals(e)&&++o,r=o+1,yZ(this,n,this._samples,e,o,r,t),t}let s=vo(n,e,J.compare,this._dateColumn);return s>=0?(s<n.length-1&&n[s+1].equals(e)&&++s,o=s,r=s):(r=~s,o=r-1,o<0&&(o=0)),this._lastIndex=o,yZ(this,n,this._samples,e,o,r,t),t};function PCe(e,t){return J.compare(e.julianDate,t)}function _Z(e,t){if(!c(t.columnNames))throw new ue("Error in loaded EOP data: The columnNames property is required.");if(!c(t.samples))throw new ue("Error in loaded EOP data: The samples property is required.");let n=t.columnNames.indexOf("modifiedJulianDateUtc"),i=t.columnNames.indexOf("xPoleWanderRadians"),o=t.columnNames.indexOf("yPoleWanderRadians"),r=t.columnNames.indexOf("ut1MinusUtcSeconds"),s=t.columnNames.indexOf("xCelestialPoleOffsetRadians"),a=t.columnNames.indexOf("yCelestialPoleOffsetRadians"),l=t.columnNames.indexOf("taiMinusUtcSeconds");if(n<0||i<0||o<0||r<0||s<0||a<0||l<0)throw new ue("Error in loaded EOP data: The columnNames property must include modifiedJulianDateUtc, xPoleWanderRadians, yPoleWanderRadians, ut1MinusUtcSeconds, xCelestialPoleOffsetRadians, yCelestialPoleOffsetRadians, and taiMinusUtcSeconds columns");let u=e._samples=t.samples,f=e._dates=[];e._dateColumn=n,e._xPoleWanderRadiansColumn=i,e._yPoleWanderRadiansColumn=o,e._ut1MinusUtcSecondsColumn=r,e._xCelestialPoleOffsetRadiansColumn=s,e._yCelestialPoleOffsetRadiansColumn=a,e._taiMinusUtcSecondsColumn=l,e._columnCount=t.columnNames.length,e._lastIndex=void 0;let d,p=e._addNewLeapSeconds;for(let g=0,m=u.length;g<m;g+=e._columnCount){let b=u[g+n],x=u[g+l],T=b+qn.MODIFIED_JULIAN_DATE_DIFFERENCE,C=new J(T,x,Wn.TAI);if(f.push(C),p){if(x!==d&&c(d)){let S=J.leapSeconds,v=vo(S,C,PCe);if(v<0){let D=new qi(C,x);S.splice(~v,0,D)}}d=x}}}function gZ(e,t,n,i,o){let r=n*i;o.xPoleWander=t[r+e._xPoleWanderRadiansColumn],o.yPoleWander=t[r+e._yPoleWanderRadiansColumn],o.xPoleOffset=t[r+e._xCelestialPoleOffsetRadiansColumn],o.yPoleOffset=t[r+e._yCelestialPoleOffsetRadiansColumn],o.ut1MinusUtc=t[r+e._ut1MinusUtcSecondsColumn]}function dE(e,t,n){return t+e*(n-t)}function yZ(e,t,n,i,o,r,s){let a=e._columnCount;if(r>t.length-1)return s.xPoleWander=0,s.yPoleWander=0,s.xPoleOffset=0,s.yPoleOffset=0,s.ut1MinusUtc=0,s;let l=t[o],u=t[r];if(l.equals(u)||i.equals(l))return gZ(e,n,o,a,s),s;if(i.equals(u))return gZ(e,n,r,a,s),s;let f=J.secondsDifference(i,l)/J.secondsDifference(u,l),d=o*a,p=r*a,g=n[d+e._ut1MinusUtcSecondsColumn],m=n[p+e._ut1MinusUtcSecondsColumn],b=m-g;if(b>.5||b<-.5){let x=n[d+e._taiMinusUtcSecondsColumn],T=n[p+e._taiMinusUtcSecondsColumn];x!==T&&(u.equals(i)?g=m:m-=T-x)}return s.xPoleWander=dE(f,n[d+e._xPoleWanderRadiansColumn],n[p+e._xPoleWanderRadiansColumn]),s.yPoleWander=dE(f,n[d+e._yPoleWanderRadiansColumn],n[p+e._yPoleWanderRadiansColumn]),s.xPoleOffset=dE(f,n[d+e._xCelestialPoleOffsetRadiansColumn],n[p+e._xCelestialPoleOffsetRadiansColumn]),s.yPoleOffset=dE(f,n[d+e._yCelestialPoleOffsetRadiansColumn],n[p+e._yCelestialPoleOffsetRadiansColumn]),s.ut1MinusUtc=dE(f,g,m),s}var h2=hE;function Na(e,t,n){this.heading=y(e,0),this.pitch=y(t,0),this.roll=y(n,0)}Na.fromQuaternion=function(e,t){if(!c(e))throw new E("quaternion is required");c(t)||(t=new Na);let n=2*(e.w*e.y-e.z*e.x),i=1-2*(e.x*e.x+e.y*e.y),o=2*(e.w*e.x+e.y*e.z),r=1-2*(e.y*e.y+e.z*e.z),s=2*(e.w*e.z+e.x*e.y);return t.heading=-Math.atan2(s,r),t.roll=Math.atan2(o,i),t.pitch=-R.asinClamped(n),t};Na.fromDegrees=function(e,t,n,i){if(!c(e))throw new E("heading is required");if(!c(t))throw new E("pitch is required");if(!c(n))throw new E("roll is required");return c(i)||(i=new Na),i.heading=e*R.RADIANS_PER_DEGREE,i.pitch=t*R.RADIANS_PER_DEGREE,i.roll=n*R.RADIANS_PER_DEGREE,i};Na.clone=function(e,t){if(c(e))return c(t)?(t.heading=e.heading,t.pitch=e.pitch,t.roll=e.roll,t):new Na(e.heading,e.pitch,e.roll)};Na.equals=function(e,t){return e===t||c(e)&&c(t)&&e.heading===t.heading&&e.pitch===t.pitch&&e.roll===t.roll};Na.equalsEpsilon=function(e,t,n,i){return e===t||c(e)&&c(t)&&R.equalsEpsilon(e.heading,t.heading,n,i)&&R.equalsEpsilon(e.pitch,t.pitch,n,i)&&R.equalsEpsilon(e.roll,t.roll,n,i)};Na.prototype.clone=function(e){return Na.clone(this,e)};Na.prototype.equals=function(e){return Na.equals(this,e)};Na.prototype.equalsEpsilon=function(e,t,n){return Na.equalsEpsilon(this,e,t,n)};Na.prototype.toString=function(){return`(${this.heading}, ${this.pitch}, ${this.roll})`};var Fa=Na;var bZ=/((?:.*\/)|^)Cesium\.js(?:\?|\#|$)/;function ICe(){let e=document.getElementsByTagName("script");for(let t=0,n=e.length;t<n;++t){let i=e[t].getAttribute("src"),o=bZ.exec(i);if(o!==null)return o[1]}}var sI;function xZ(e){return typeof document>"u"?e:(c(sI)||(sI=document.createElement("a")),sI.href=e,sI.href)}var Ly;function TZ(){if(c(Ly))return Ly;let e;if(typeof CESIUM_BASE_URL<"u"?e=CESIUM_BASE_URL:c(import.meta?.url)?e=m_(".",import.meta.url):typeof define=="object"&&c(define.amd)&&!define.amd.toUrlUndefined&&c(VP.toUrl)?e=m_("..",Ny("Core/buildModuleUrl.js")):e=ICe(),!c(e))throw new E("Unable to determine Cesium base URL automatically, try defining a global variable called CESIUM_BASE_URL.");return Ly=new De({url:xZ(e)}),Ly.appendForwardSlash(),Ly}function OCe(e){return xZ(VP.toUrl(`../${e}`))}function AZ(e){return TZ().getDerivedResource({url:e}).url}var aI;function Ny(e){return c(aI)||(typeof define=="object"&&c(define.amd)&&!define.amd.toUrlUndefined&&c(VP.toUrl)?aI=OCe:aI=AZ),aI(e)}Ny._cesiumScriptRegex=bZ;Ny._buildModuleUrlFromBaseUrl=AZ;Ny._clearBaseResource=function(){Ly=void 0};Ny.setBaseUrl=function(e){Ly=De.DEFAULT.getDerivedResource({url:e})};Ny.getCesiumBaseUrl=TZ;var sn=Ny;function RCe(e,t,n){this.x=e,this.y=t,this.s=n}var mE=RCe;function _2(e){e=y(e,y.EMPTY_OBJECT),this._xysFileUrlTemplate=De.createIfNeeded(e.xysFileUrlTemplate),this._interpolationOrder=y(e.interpolationOrder,9),this._sampleZeroJulianEphemerisDate=y(e.sampleZeroJulianEphemerisDate,24423965e-1),this._sampleZeroDateTT=new J(this._sampleZeroJulianEphemerisDate,0,Wn.TAI),this._stepSizeDays=y(e.stepSizeDays,1),this._samplesPerXysFile=y(e.samplesPerXysFile,1e3),this._totalSamples=y(e.totalSamples,27426),this._samples=new Array(this._totalSamples*3),this._chunkDownloadsInProgress=[];let t=this._interpolationOrder,n=this._denominators=new Array(t+1),i=this._xTable=new Array(t+1),o=Math.pow(this._stepSizeDays,t);for(let r=0;r<=t;++r){n[r]=o,i[r]=r*this._stepSizeDays;for(let s=0;s<=t;++s)s!==r&&(n[r]*=r-s);n[r]=1/n[r]}this._work=new Array(t+1),this._coef=new Array(t+1)}var MCe=new J(0,0,Wn.TAI);function m2(e,t,n){let i=MCe;return i.dayNumber=t,i.secondsOfDay=n,J.daysDifference(i,e._sampleZeroDateTT)}_2.prototype.preload=function(e,t,n,i){let o=m2(this,e,t),r=m2(this,n,i),s=o/this._stepSizeDays-this._interpolationOrder/2|0;s<0&&(s=0);let a=r/this._stepSizeDays-this._interpolationOrder/2|0+this._interpolationOrder;a>=this._totalSamples&&(a=this._totalSamples-1);let l=s/this._samplesPerXysFile|0,u=a/this._samplesPerXysFile|0,f=[];for(let d=l;d<=u;++d)f.push(p2(this,d));return Promise.all(f)};_2.prototype.computeXysRadians=function(e,t,n){let i=m2(this,e,t);if(i<0)return;let o=i/this._stepSizeDays|0;if(o>=this._totalSamples)return;let r=this._interpolationOrder,s=o-(r/2|0);s<0&&(s=0);let a=s+r;a>=this._totalSamples&&(a=this._totalSamples-1,s=a-r,s<0&&(s=0));let l=!1,u=this._samples;if(c(u[s*3])||(p2(this,s/this._samplesPerXysFile|0),l=!0),c(u[a*3])||(p2(this,a/this._samplesPerXysFile|0),l=!0),l)return;c(n)?(n.x=0,n.y=0,n.s=0):n=new mE(0,0,0);let f=i-s*this._stepSizeDays,d=this._work,p=this._denominators,g=this._coef,m=this._xTable,b,x;for(b=0;b<=r;++b)d[b]=f-m[b];for(b=0;b<=r;++b){for(g[b]=1,x=0;x<=r;++x)x!==b&&(g[b]*=d[x]);g[b]*=p[b];let T=(s+b)*3;n.x+=g[b]*u[T++],n.y+=g[b]*u[T++],n.s+=g[b]*u[T]}return n};function p2(e,t){if(e._chunkDownloadsInProgress[t])return e._chunkDownloadsInProgress[t];let n,i=e._xysFileUrlTemplate;c(i)?n=i.getDerivedResource({templateValues:{0:t}}):n=new De({url:sn(`Assets/IAU2006_XYS/IAU2006_XYS_${t}.json`)});let o=n.fetchJson().then(function(r){e._chunkDownloadsInProgress[t]=!1;let s=e._samples,a=r.samples,l=t*e._samplesPerXysFile*3;for(let u=0,f=a.length;u<f;++u)s[l+u]=a[u]});return e._chunkDownloadsInProgress[t]=o,o}var g2=_2;function tt(e,t,n,i,o,r,s,a,l){this[0]=y(e,0),this[1]=y(i,0),this[2]=y(s,0),this[3]=y(t,0),this[4]=y(o,0),this[5]=y(a,0),this[6]=y(n,0),this[7]=y(r,0),this[8]=y(l,0)}tt.packedLength=9;tt.pack=function(e,t,n){return A.typeOf.object("value",e),A.defined("array",t),n=y(n,0),t[n++]=e[0],t[n++]=e[1],t[n++]=e[2],t[n++]=e[3],t[n++]=e[4],t[n++]=e[5],t[n++]=e[6],t[n++]=e[7],t[n++]=e[8],t};tt.unpack=function(e,t,n){return A.defined("array",e),t=y(t,0),c(n)||(n=new tt),n[0]=e[t++],n[1]=e[t++],n[2]=e[t++],n[3]=e[t++],n[4]=e[t++],n[5]=e[t++],n[6]=e[t++],n[7]=e[t++],n[8]=e[t++],n};tt.packArray=function(e,t){A.defined("array",e);let n=e.length,i=n*9;if(!c(t))t=new Array(i);else{if(!Array.isArray(t)&&t.length!==i)throw new E("If result is a typed array, it must have exactly array.length * 9 elements");t.length!==i&&(t.length=i)}for(let o=0;o<n;++o)tt.pack(e[o],t,o*9);return t};tt.unpackArray=function(e,t){if(A.defined("array",e),A.typeOf.number.greaterThanOrEquals("array.length",e.length,9),e.length%9!==0)throw new E("array length must be a multiple of 9.");let n=e.length;c(t)?t.length=n/9:t=new Array(n/9);for(let i=0;i<n;i+=9){let o=i/9;t[o]=tt.unpack(e,i,t[o])}return t};tt.clone=function(e,t){if(c(e))return c(t)?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t):new tt(e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8])};tt.fromArray=tt.unpack;tt.fromColumnMajorArray=function(e,t){return A.defined("values",e),tt.clone(e,t)};tt.fromRowMajorArray=function(e,t){return A.defined("values",e),c(t)?(t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],t):new tt(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])};tt.fromQuaternion=function(e,t){A.typeOf.object("quaternion",e);let n=e.x*e.x,i=e.x*e.y,o=e.x*e.z,r=e.x*e.w,s=e.y*e.y,a=e.y*e.z,l=e.y*e.w,u=e.z*e.z,f=e.z*e.w,d=e.w*e.w,p=n-s-u+d,g=2*(i-f),m=2*(o+l),b=2*(i+f),x=-n+s-u+d,T=2*(a-r),C=2*(o-l),S=2*(a+r),v=-n-s+u+d;return c(t)?(t[0]=p,t[1]=b,t[2]=C,t[3]=g,t[4]=x,t[5]=S,t[6]=m,t[7]=T,t[8]=v,t):new tt(p,g,m,b,x,T,C,S,v)};tt.fromHeadingPitchRoll=function(e,t){A.typeOf.object("headingPitchRoll",e);let n=Math.cos(-e.pitch),i=Math.cos(-e.heading),o=Math.cos(e.roll),r=Math.sin(-e.pitch),s=Math.sin(-e.heading),a=Math.sin(e.roll),l=n*i,u=-o*s+a*r*i,f=a*s+o*r*i,d=n*s,p=o*i+a*r*s,g=-a*i+o*r*s,m=-r,b=a*n,x=o*n;return c(t)?(t[0]=l,t[1]=d,t[2]=m,t[3]=u,t[4]=p,t[5]=b,t[6]=f,t[7]=g,t[8]=x,t):new tt(l,u,f,d,p,g,m,b,x)};tt.fromScale=function(e,t){return A.typeOf.object("scale",e),c(t)?(t[0]=e.x,t[1]=0,t[2]=0,t[3]=0,t[4]=e.y,t[5]=0,t[6]=0,t[7]=0,t[8]=e.z,t):new tt(e.x,0,0,0,e.y,0,0,0,e.z)};tt.fromUniformScale=function(e,t){return A.typeOf.number("scale",e),c(t)?(t[0]=e,t[1]=0,t[2]=0,t[3]=0,t[4]=e,t[5]=0,t[6]=0,t[7]=0,t[8]=e,t):new tt(e,0,0,0,e,0,0,0,e)};tt.fromCrossProduct=function(e,t){return A.typeOf.object("vector",e),c(t)?(t[0]=0,t[1]=e.z,t[2]=-e.y,t[3]=-e.z,t[4]=0,t[5]=e.x,t[6]=e.y,t[7]=-e.x,t[8]=0,t):new tt(0,-e.z,e.y,e.z,0,-e.x,-e.y,e.x,0)};tt.fromRotationX=function(e,t){A.typeOf.number("angle",e);let n=Math.cos(e),i=Math.sin(e);return c(t)?(t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=n,t[5]=i,t[6]=0,t[7]=-i,t[8]=n,t):new tt(1,0,0,0,n,-i,0,i,n)};tt.fromRotationY=function(e,t){A.typeOf.number("angle",e);let n=Math.cos(e),i=Math.sin(e);return c(t)?(t[0]=n,t[1]=0,t[2]=-i,t[3]=0,t[4]=1,t[5]=0,t[6]=i,t[7]=0,t[8]=n,t):new tt(n,0,i,0,1,0,-i,0,n)};tt.fromRotationZ=function(e,t){A.typeOf.number("angle",e);let n=Math.cos(e),i=Math.sin(e);return c(t)?(t[0]=n,t[1]=i,t[2]=0,t[3]=-i,t[4]=n,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t):new tt(n,-i,0,i,n,0,0,0,1)};tt.toArray=function(e,t){return A.typeOf.object("matrix",e),c(t)?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t):[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]};tt.getElementIndex=function(e,t){return A.typeOf.number.greaterThanOrEquals("row",t,0),A.typeOf.number.lessThanOrEquals("row",t,2),A.typeOf.number.greaterThanOrEquals("column",e,0),A.typeOf.number.lessThanOrEquals("column",e,2),e*3+t};tt.getColumn=function(e,t,n){A.typeOf.object("matrix",e),A.typeOf.number.greaterThanOrEquals("index",t,0),A.typeOf.number.lessThanOrEquals("index",t,2),A.typeOf.object("result",n);let i=t*3,o=e[i],r=e[i+1],s=e[i+2];return n.x=o,n.y=r,n.z=s,n};tt.setColumn=function(e,t,n,i){A.typeOf.object("matrix",e),A.typeOf.number.greaterThanOrEquals("index",t,0),A.typeOf.number.lessThanOrEquals("index",t,2),A.typeOf.object("cartesian",n),A.typeOf.object("result",i),i=tt.clone(e,i);let o=t*3;return i[o]=n.x,i[o+1]=n.y,i[o+2]=n.z,i};tt.getRow=function(e,t,n){A.typeOf.object("matrix",e),A.typeOf.number.greaterThanOrEquals("index",t,0),A.typeOf.number.lessThanOrEquals("index",t,2),A.typeOf.object("result",n);let i=e[t],o=e[t+3],r=e[t+6];return n.x=i,n.y=o,n.z=r,n};tt.setRow=function(e,t,n,i){return A.typeOf.object("matrix",e),A.typeOf.number.greaterThanOrEquals("index",t,0),A.typeOf.number.lessThanOrEquals("index",t,2),A.typeOf.object("cartesian",n),A.typeOf.object("result",i),i=tt.clone(e,i),i[t]=n.x,i[t+3]=n.y,i[t+6]=n.z,i};var LCe=new h;tt.setScale=function(e,t,n){A.typeOf.object("matrix",e),A.typeOf.object("scale",t),A.typeOf.object("result",n);let i=tt.getScale(e,LCe),o=t.x/i.x,r=t.y/i.y,s=t.z/i.z;return n[0]=e[0]*o,n[1]=e[1]*o,n[2]=e[2]*o,n[3]=e[3]*r,n[4]=e[4]*r,n[5]=e[5]*r,n[6]=e[6]*s,n[7]=e[7]*s,n[8]=e[8]*s,n};var NCe=new h;tt.setUniformScale=function(e,t,n){A.typeOf.object("matrix",e),A.typeOf.number("scale",t),A.typeOf.object("result",n);let i=tt.getScale(e,NCe),o=t/i.x,r=t/i.y,s=t/i.z;return n[0]=e[0]*o,n[1]=e[1]*o,n[2]=e[2]*o,n[3]=e[3]*r,n[4]=e[4]*r,n[5]=e[5]*r,n[6]=e[6]*s,n[7]=e[7]*s,n[8]=e[8]*s,n};var y2=new h;tt.getScale=function(e,t){return A.typeOf.object("matrix",e),A.typeOf.object("result",t),t.x=h.magnitude(h.fromElements(e[0],e[1],e[2],y2)),t.y=h.magnitude(h.fromElements(e[3],e[4],e[5],y2)),t.z=h.magnitude(h.fromElements(e[6],e[7],e[8],y2)),t};var CZ=new h;tt.getMaximumScale=function(e){return tt.getScale(e,CZ),h.maximumComponent(CZ)};var FCe=new h;tt.setRotation=function(e,t,n){A.typeOf.object("matrix",e),A.typeOf.object("result",n);let i=tt.getScale(e,FCe);return n[0]=t[0]*i.x,n[1]=t[1]*i.x,n[2]=t[2]*i.x,n[3]=t[3]*i.y,n[4]=t[4]*i.y,n[5]=t[5]*i.y,n[6]=t[6]*i.z,n[7]=t[7]*i.z,n[8]=t[8]*i.z,n};var BCe=new h;tt.getRotation=function(e,t){A.typeOf.object("matrix",e),A.typeOf.object("result",t);let n=tt.getScale(e,BCe);return t[0]=e[0]/n.x,t[1]=e[1]/n.x,t[2]=e[2]/n.x,t[3]=e[3]/n.y,t[4]=e[4]/n.y,t[5]=e[5]/n.y,t[6]=e[6]/n.z,t[7]=e[7]/n.z,t[8]=e[8]/n.z,t};tt.multiply=function(e,t,n){A.typeOf.object("left",e),A.typeOf.object("right",t),A.typeOf.object("result",n);let i=e[0]*t[0]+e[3]*t[1]+e[6]*t[2],o=e[1]*t[0]+e[4]*t[1]+e[7]*t[2],r=e[2]*t[0]+e[5]*t[1]+e[8]*t[2],s=e[0]*t[3]+e[3]*t[4]+e[6]*t[5],a=e[1]*t[3]+e[4]*t[4]+e[7]*t[5],l=e[2]*t[3]+e[5]*t[4]+e[8]*t[5],u=e[0]*t[6]+e[3]*t[7]+e[6]*t[8],f=e[1]*t[6]+e[4]*t[7]+e[7]*t[8],d=e[2]*t[6]+e[5]*t[7]+e[8]*t[8];return n[0]=i,n[1]=o,n[2]=r,n[3]=s,n[4]=a,n[5]=l,n[6]=u,n[7]=f,n[8]=d,n};tt.add=function(e,t,n){return A.typeOf.object("left",e),A.typeOf.object("right",t),A.typeOf.object("result",n),n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n[3]=e[3]+t[3],n[4]=e[4]+t[4],n[5]=e[5]+t[5],n[6]=e[6]+t[6],n[7]=e[7]+t[7],n[8]=e[8]+t[8],n};tt.subtract=function(e,t,n){return A.typeOf.object("left",e),A.typeOf.object("right",t),A.typeOf.object("result",n),n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n[3]=e[3]-t[3],n[4]=e[4]-t[4],n[5]=e[5]-t[5],n[6]=e[6]-t[6],n[7]=e[7]-t[7],n[8]=e[8]-t[8],n};tt.multiplyByVector=function(e,t,n){A.typeOf.object("matrix",e),A.typeOf.object("cartesian",t),A.typeOf.object("result",n);let i=t.x,o=t.y,r=t.z,s=e[0]*i+e[3]*o+e[6]*r,a=e[1]*i+e[4]*o+e[7]*r,l=e[2]*i+e[5]*o+e[8]*r;return n.x=s,n.y=a,n.z=l,n};tt.multiplyByScalar=function(e,t,n){return A.typeOf.object("matrix",e),A.typeOf.number("scalar",t),A.typeOf.object("result",n),n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n[3]=e[3]*t,n[4]=e[4]*t,n[5]=e[5]*t,n[6]=e[6]*t,n[7]=e[7]*t,n[8]=e[8]*t,n};tt.multiplyByScale=function(e,t,n){return A.typeOf.object("matrix",e),A.typeOf.object("scale",t),A.typeOf.object("result",n),n[0]=e[0]*t.x,n[1]=e[1]*t.x,n[2]=e[2]*t.x,n[3]=e[3]*t.y,n[4]=e[4]*t.y,n[5]=e[5]*t.y,n[6]=e[6]*t.z,n[7]=e[7]*t.z,n[8]=e[8]*t.z,n};tt.multiplyByUniformScale=function(e,t,n){return A.typeOf.object("matrix",e),A.typeOf.number("scale",t),A.typeOf.object("result",n),n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n[3]=e[3]*t,n[4]=e[4]*t,n[5]=e[5]*t,n[6]=e[6]*t,n[7]=e[7]*t,n[8]=e[8]*t,n};tt.negate=function(e,t){return A.typeOf.object("matrix",e),A.typeOf.object("result",t),t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=-e[7],t[8]=-e[8],t};tt.transpose=function(e,t){A.typeOf.object("matrix",e),A.typeOf.object("result",t);let n=e[0],i=e[3],o=e[6],r=e[1],s=e[4],a=e[7],l=e[2],u=e[5],f=e[8];return t[0]=n,t[1]=i,t[2]=o,t[3]=r,t[4]=s,t[5]=a,t[6]=l,t[7]=u,t[8]=f,t};function kCe(e){let t=0;for(let n=0;n<9;++n){let i=e[n];t+=i*i}return Math.sqrt(t)}var b2=[1,0,0],x2=[2,2,1];function VCe(e){let t=0;for(let n=0;n<3;++n){let i=e[tt.getElementIndex(x2[n],b2[n])];t+=2*i*i}return Math.sqrt(t)}function UCe(e,t){let n=R.EPSILON15,i=0,o=1;for(let u=0;u<3;++u){let f=Math.abs(e[tt.getElementIndex(x2[u],b2[u])]);f>i&&(o=u,i=f)}let r=1,s=0,a=b2[o],l=x2[o];if(Math.abs(e[tt.getElementIndex(l,a)])>n){let u=e[tt.getElementIndex(l,l)],f=e[tt.getElementIndex(a,a)],d=e[tt.getElementIndex(l,a)],p=(u-f)/2/d,g;p<0?g=-1/(-p+Math.sqrt(1+p*p)):g=1/(p+Math.sqrt(1+p*p)),r=1/Math.sqrt(1+g*g),s=g*r}return t=tt.clone(tt.IDENTITY,t),t[tt.getElementIndex(a,a)]=t[tt.getElementIndex(l,l)]=r,t[tt.getElementIndex(l,a)]=s,t[tt.getElementIndex(a,l)]=-s,t}var cI=new tt,EZ=new tt;tt.computeEigenDecomposition=function(e,t){A.typeOf.object("matrix",e);let n=R.EPSILON20,i=10,o=0,r=0;c(t)||(t={});let s=t.unitary=tt.clone(tt.IDENTITY,t.unitary),a=t.diagonal=tt.clone(e,t.diagonal),l=n*kCe(a);for(;r<i&&VCe(a)>l;)UCe(a,cI),tt.transpose(cI,EZ),tt.multiply(a,cI,a),tt.multiply(EZ,a,a),tt.multiply(s,cI,s),++o>2&&(++r,o=0);return t};tt.abs=function(e,t){return A.typeOf.object("matrix",e),A.typeOf.object("result",t),t[0]=Math.abs(e[0]),t[1]=Math.abs(e[1]),t[2]=Math.abs(e[2]),t[3]=Math.abs(e[3]),t[4]=Math.abs(e[4]),t[5]=Math.abs(e[5]),t[6]=Math.abs(e[6]),t[7]=Math.abs(e[7]),t[8]=Math.abs(e[8]),t};tt.determinant=function(e){A.typeOf.object("matrix",e);let t=e[0],n=e[3],i=e[6],o=e[1],r=e[4],s=e[7],a=e[2],l=e[5],u=e[8];return t*(r*u-l*s)+o*(l*i-n*u)+a*(n*s-r*i)};tt.inverse=function(e,t){A.typeOf.object("matrix",e),A.typeOf.object("result",t);let n=e[0],i=e[1],o=e[2],r=e[3],s=e[4],a=e[5],l=e[6],u=e[7],f=e[8],d=tt.determinant(e);if(Math.abs(d)<=R.EPSILON15)throw new E("matrix is not invertible");t[0]=s*f-u*a,t[1]=u*o-i*f,t[2]=i*a-s*o,t[3]=l*a-r*f,t[4]=n*f-l*o,t[5]=r*o-n*a,t[6]=r*u-l*s,t[7]=l*i-n*u,t[8]=n*s-r*i;let p=1/d;return tt.multiplyByScalar(t,p,t)};var zCe=new tt;tt.inverseTranspose=function(e,t){return A.typeOf.object("matrix",e),A.typeOf.object("result",t),tt.inverse(tt.transpose(e,zCe),t)};tt.equals=function(e,t){return e===t||c(e)&&c(t)&&e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]};tt.equalsEpsilon=function(e,t,n){return n=y(n,0),e===t||c(e)&&c(t)&&Math.abs(e[0]-t[0])<=n&&Math.abs(e[1]-t[1])<=n&&Math.abs(e[2]-t[2])<=n&&Math.abs(e[3]-t[3])<=n&&Math.abs(e[4]-t[4])<=n&&Math.abs(e[5]-t[5])<=n&&Math.abs(e[6]-t[6])<=n&&Math.abs(e[7]-t[7])<=n&&Math.abs(e[8]-t[8])<=n};tt.IDENTITY=Object.freeze(new tt(1,0,0,0,1,0,0,0,1));tt.ZERO=Object.freeze(new tt(0,0,0,0,0,0,0,0,0));tt.COLUMN0ROW0=0;tt.COLUMN0ROW1=1;tt.COLUMN0ROW2=2;tt.COLUMN1ROW0=3;tt.COLUMN1ROW1=4;tt.COLUMN1ROW2=5;tt.COLUMN2ROW0=6;tt.COLUMN2ROW1=7;tt.COLUMN2ROW2=8;Object.defineProperties(tt.prototype,{length:{get:function(){return tt.packedLength}}});tt.prototype.clone=function(e){return tt.clone(this,e)};tt.prototype.equals=function(e){return tt.equals(this,e)};tt.equalsArray=function(e,t,n){return e[0]===t[n]&&e[1]===t[n+1]&&e[2]===t[n+2]&&e[3]===t[n+3]&&e[4]===t[n+4]&&e[5]===t[n+5]&&e[6]===t[n+6]&&e[7]===t[n+7]&&e[8]===t[n+8]};tt.prototype.equalsEpsilon=function(e,t){return tt.equalsEpsilon(this,e,t)};tt.prototype.toString=function(){return`(${this[0]}, ${this[3]}, ${this[6]})
(${this[1]}, ${this[4]}, ${this[7]})
(${this[2]}, ${this[5]}, ${this[8]})`};var Q=tt;function Qe(e,t,n,i,o,r,s,a,l,u,f,d,p,g,m,b){this[0]=y(e,0),this[1]=y(o,0),this[2]=y(l,0),this[3]=y(p,0),this[4]=y(t,0),this[5]=y(r,0),this[6]=y(u,0),this[7]=y(g,0),this[8]=y(n,0),this[9]=y(s,0),this[10]=y(f,0),this[11]=y(m,0),this[12]=y(i,0),this[13]=y(a,0),this[14]=y(d,0),this[15]=y(b,0)}Qe.packedLength=16;Qe.pack=function(e,t,n){return A.typeOf.object("value",e),A.defined("array",t),n=y(n,0),t[n++]=e[0],t[n++]=e[1],t[n++]=e[2],t[n++]=e[3],t[n++]=e[4],t[n++]=e[5],t[n++]=e[6],t[n++]=e[7],t[n++]=e[8],t[n++]=e[9],t[n++]=e[10],t[n++]=e[11],t[n++]=e[12],t[n++]=e[13],t[n++]=e[14],t[n]=e[15],t};Qe.unpack=function(e,t,n){return A.defined("array",e),t=y(t,0),c(n)||(n=new Qe),n[0]=e[t++],n[1]=e[t++],n[2]=e[t++],n[3]=e[t++],n[4]=e[t++],n[5]=e[t++],n[6]=e[t++],n[7]=e[t++],n[8]=e[t++],n[9]=e[t++],n[10]=e[t++],n[11]=e[t++],n[12]=e[t++],n[13]=e[t++],n[14]=e[t++],n[15]=e[t],n};Qe.packArray=function(e,t){A.defined("array",e);let n=e.length,i=n*16;if(!c(t))t=new Array(i);else{if(!Array.isArray(t)&&t.length!==i)throw new E("If result is a typed array, it must have exactly array.length * 16 elements");t.length!==i&&(t.length=i)}for(let o=0;o<n;++o)Qe.pack(e[o],t,o*16);return t};Qe.unpackArray=function(e,t){if(A.defined("array",e),A.typeOf.number.greaterThanOrEquals("array.length",e.length,16),e.length%16!==0)throw new E("array length must be a multiple of 16.");let n=e.length;c(t)?t.length=n/16:t=new Array(n/16);for(let i=0;i<n;i+=16){let o=i/16;t[o]=Qe.unpack(e,i,t[o])}return t};Qe.clone=function(e,t){if(c(e))return c(t)?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t):new Qe(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15])};Qe.fromArray=Qe.unpack;Qe.fromColumnMajorArray=function(e,t){return A.defined("values",e),Qe.clone(e,t)};Qe.fromRowMajorArray=function(e,t){return A.defined("values",e),c(t)?(t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15],t):new Qe(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])};Qe.fromRotationTranslation=function(e,t,n){return A.typeOf.object("rotation",e),t=y(t,h.ZERO),c(n)?(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=0,n[4]=e[3],n[5]=e[4],n[6]=e[5],n[7]=0,n[8]=e[6],n[9]=e[7],n[10]=e[8],n[11]=0,n[12]=t.x,n[13]=t.y,n[14]=t.z,n[15]=1,n):new Qe(e[0],e[3],e[6],t.x,e[1],e[4],e[7],t.y,e[2],e[5],e[8],t.z,0,0,0,1)};Qe.fromTranslationQuaternionRotationScale=function(e,t,n,i){A.typeOf.object("translation",e),A.typeOf.object("rotation",t),A.typeOf.object("scale",n),c(i)||(i=new Qe);let o=n.x,r=n.y,s=n.z,a=t.x*t.x,l=t.x*t.y,u=t.x*t.z,f=t.x*t.w,d=t.y*t.y,p=t.y*t.z,g=t.y*t.w,m=t.z*t.z,b=t.z*t.w,x=t.w*t.w,T=a-d-m+x,C=2*(l-b),S=2*(u+g),v=2*(l+b),D=-a+d-m+x,I=2*(p-f),L=2*(u-g),M=2*(p+f),N=-a-d+m+x;return i[0]=T*o,i[1]=v*o,i[2]=L*o,i[3]=0,i[4]=C*r,i[5]=D*r,i[6]=M*r,i[7]=0,i[8]=S*s,i[9]=I*s,i[10]=N*s,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,i};Qe.fromTranslationRotationScale=function(e,t){return A.typeOf.object("translationRotationScale",e),Qe.fromTranslationQuaternionRotationScale(e.translation,e.rotation,e.scale,t)};Qe.fromTranslation=function(e,t){return A.typeOf.object("translation",e),Qe.fromRotationTranslation(Q.IDENTITY,e,t)};Qe.fromScale=function(e,t){return A.typeOf.object("scale",e),c(t)?(t[0]=e.x,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e.y,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e.z,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t):new Qe(e.x,0,0,0,0,e.y,0,0,0,0,e.z,0,0,0,0,1)};Qe.fromUniformScale=function(e,t){return A.typeOf.number("scale",e),c(t)?(t[0]=e,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t):new Qe(e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1)};Qe.fromRotation=function(e,t){return A.typeOf.object("rotation",e),c(t)||(t=new Qe),t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=0,t[4]=e[3],t[5]=e[4],t[6]=e[5],t[7]=0,t[8]=e[6],t[9]=e[7],t[10]=e[8],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t};var Px=new h,Ix=new h,pE=new h;Qe.fromCamera=function(e,t){A.typeOf.object("camera",e);let n=e.position,i=e.direction,o=e.up;A.typeOf.object("camera.position",n),A.typeOf.object("camera.direction",i),A.typeOf.object("camera.up",o),h.normalize(i,Px),h.normalize(h.cross(Px,o,Ix),Ix),h.normalize(h.cross(Ix,Px,pE),pE);let r=Ix.x,s=Ix.y,a=Ix.z,l=Px.x,u=Px.y,f=Px.z,d=pE.x,p=pE.y,g=pE.z,m=n.x,b=n.y,x=n.z,T=r*-m+s*-b+a*-x,C=d*-m+p*-b+g*-x,S=l*m+u*b+f*x;return c(t)?(t[0]=r,t[1]=d,t[2]=-l,t[3]=0,t[4]=s,t[5]=p,t[6]=-u,t[7]=0,t[8]=a,t[9]=g,t[10]=-f,t[11]=0,t[12]=T,t[13]=C,t[14]=S,t[15]=1,t):new Qe(r,s,a,T,d,p,g,C,-l,-u,-f,S,0,0,0,1)};Qe.computePerspectiveFieldOfView=function(e,t,n,i,o){A.typeOf.number.greaterThan("fovY",e,0),A.typeOf.number.lessThan("fovY",e,Math.PI),A.typeOf.number.greaterThan("near",n,0),A.typeOf.number.greaterThan("far",i,0),A.typeOf.object("result",o);let s=1/Math.tan(e*.5),a=s/t,l=(i+n)/(n-i),u=2*i*n/(n-i);return o[0]=a,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=s,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=l,o[11]=-1,o[12]=0,o[13]=0,o[14]=u,o[15]=0,o};Qe.computeOrthographicOffCenter=function(e,t,n,i,o,r,s){A.typeOf.number("left",e),A.typeOf.number("right",t),A.typeOf.number("bottom",n),A.typeOf.number("top",i),A.typeOf.number("near",o),A.typeOf.number("far",r),A.typeOf.object("result",s);let a=1/(t-e),l=1/(i-n),u=1/(r-o),f=-(t+e)*a,d=-(i+n)*l,p=-(r+o)*u;return a*=2,l*=2,u*=-2,s[0]=a,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=l,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=u,s[11]=0,s[12]=f,s[13]=d,s[14]=p,s[15]=1,s};Qe.computePerspectiveOffCenter=function(e,t,n,i,o,r,s){A.typeOf.number("left",e),A.typeOf.number("right",t),A.typeOf.number("bottom",n),A.typeOf.number("top",i),A.typeOf.number("near",o),A.typeOf.number("far",r),A.typeOf.object("result",s);let a=2*o/(t-e),l=2*o/(i-n),u=(t+e)/(t-e),f=(i+n)/(i-n),d=-(r+o)/(r-o),p=-1,g=-2*r*o/(r-o);return s[0]=a,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=l,s[6]=0,s[7]=0,s[8]=u,s[9]=f,s[10]=d,s[11]=p,s[12]=0,s[13]=0,s[14]=g,s[15]=0,s};Qe.computeInfinitePerspectiveOffCenter=function(e,t,n,i,o,r){A.typeOf.number("left",e),A.typeOf.number("right",t),A.typeOf.number("bottom",n),A.typeOf.number("top",i),A.typeOf.number("near",o),A.typeOf.object("result",r);let s=2*o/(t-e),a=2*o/(i-n),l=(t+e)/(t-e),u=(i+n)/(i-n),f=-1,d=-1,p=-2*o;return r[0]=s,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=a,r[6]=0,r[7]=0,r[8]=l,r[9]=u,r[10]=f,r[11]=d,r[12]=0,r[13]=0,r[14]=p,r[15]=0,r};Qe.computeViewportTransformation=function(e,t,n,i){c(i)||(i=new Qe),e=y(e,y.EMPTY_OBJECT);let o=y(e.x,0),r=y(e.y,0),s=y(e.width,0),a=y(e.height,0);t=y(t,0),n=y(n,1);let l=s*.5,u=a*.5,f=(n-t)*.5,d=l,p=u,g=f,m=o+l,b=r+u,x=t+f,T=1;return i[0]=d,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=p,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=g,i[11]=0,i[12]=m,i[13]=b,i[14]=x,i[15]=T,i};Qe.computeView=function(e,t,n,i,o){return A.typeOf.object("position",e),A.typeOf.object("direction",t),A.typeOf.object("up",n),A.typeOf.object("right",i),A.typeOf.object("result",o),o[0]=i.x,o[1]=n.x,o[2]=-t.x,o[3]=0,o[4]=i.y,o[5]=n.y,o[6]=-t.y,o[7]=0,o[8]=i.z,o[9]=n.z,o[10]=-t.z,o[11]=0,o[12]=-h.dot(i,e),o[13]=-h.dot(n,e),o[14]=h.dot(t,e),o[15]=1,o};Qe.toArray=function(e,t){return A.typeOf.object("matrix",e),c(t)?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t):[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]};Qe.getElementIndex=function(e,t){return A.typeOf.number.greaterThanOrEquals("row",t,0),A.typeOf.number.lessThanOrEquals("row",t,3),A.typeOf.number.greaterThanOrEquals("column",e,0),A.typeOf.number.lessThanOrEquals("column",e,3),e*4+t};Qe.getColumn=function(e,t,n){A.typeOf.object("matrix",e),A.typeOf.number.greaterThanOrEquals("index",t,0),A.typeOf.number.lessThanOrEquals("index",t,3),A.typeOf.object("result",n);let i=t*4,o=e[i],r=e[i+1],s=e[i+2],a=e[i+3];return n.x=o,n.y=r,n.z=s,n.w=a,n};Qe.setColumn=function(e,t,n,i){A.typeOf.object("matrix",e),A.typeOf.number.greaterThanOrEquals("index",t,0),A.typeOf.number.lessThanOrEquals("index",t,3),A.typeOf.object("cartesian",n),A.typeOf.object("result",i),i=Qe.clone(e,i);let o=t*4;return i[o]=n.x,i[o+1]=n.y,i[o+2]=n.z,i[o+3]=n.w,i};Qe.getRow=function(e,t,n){A.typeOf.object("matrix",e),A.typeOf.number.greaterThanOrEquals("index",t,0),A.typeOf.number.lessThanOrEquals("index",t,3),A.typeOf.object("result",n);let i=e[t],o=e[t+4],r=e[t+8],s=e[t+12];return n.x=i,n.y=o,n.z=r,n.w=s,n};Qe.setRow=function(e,t,n,i){return A.typeOf.object("matrix",e),A.typeOf.number.greaterThanOrEquals("index",t,0),A.typeOf.number.lessThanOrEquals("index",t,3),A.typeOf.object("cartesian",n),A.typeOf.object("result",i),i=Qe.clone(e,i),i[t]=n.x,i[t+4]=n.y,i[t+8]=n.z,i[t+12]=n.w,i};Qe.setTranslation=function(e,t,n){return A.typeOf.object("matrix",e),A.typeOf.object("translation",t),A.typeOf.object("result",n),n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=t.x,n[13]=t.y,n[14]=t.z,n[15]=e[15],n};var HCe=new h;Qe.setScale=function(e,t,n){A.typeOf.object("matrix",e),A.typeOf.object("scale",t),A.typeOf.object("result",n);let i=Qe.getScale(e,HCe),o=t.x/i.x,r=t.y/i.y,s=t.z/i.z;return n[0]=e[0]*o,n[1]=e[1]*o,n[2]=e[2]*o,n[3]=e[3],n[4]=e[4]*r,n[5]=e[5]*r,n[6]=e[6]*r,n[7]=e[7],n[8]=e[8]*s,n[9]=e[9]*s,n[10]=e[10]*s,n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n};var GCe=new h;Qe.setUniformScale=function(e,t,n){A.typeOf.object("matrix",e),A.typeOf.number("scale",t),A.typeOf.object("result",n);let i=Qe.getScale(e,GCe),o=t/i.x,r=t/i.y,s=t/i.z;return n[0]=e[0]*o,n[1]=e[1]*o,n[2]=e[2]*o,n[3]=e[3],n[4]=e[4]*r,n[5]=e[5]*r,n[6]=e[6]*r,n[7]=e[7],n[8]=e[8]*s,n[9]=e[9]*s,n[10]=e[10]*s,n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n};var T2=new h;Qe.getScale=function(e,t){return A.typeOf.object("matrix",e),A.typeOf.object("result",t),t.x=h.magnitude(h.fromElements(e[0],e[1],e[2],T2)),t.y=h.magnitude(h.fromElements(e[4],e[5],e[6],T2)),t.z=h.magnitude(h.fromElements(e[8],e[9],e[10],T2)),t};var SZ=new h;Qe.getMaximumScale=function(e){return Qe.getScale(e,SZ),h.maximumComponent(SZ)};var jCe=new h;Qe.setRotation=function(e,t,n){A.typeOf.object("matrix",e),A.typeOf.object("result",n);let i=Qe.getScale(e,jCe);return n[0]=t[0]*i.x,n[1]=t[1]*i.x,n[2]=t[2]*i.x,n[3]=e[3],n[4]=t[3]*i.y,n[5]=t[4]*i.y,n[6]=t[5]*i.y,n[7]=e[7],n[8]=t[6]*i.z,n[9]=t[7]*i.z,n[10]=t[8]*i.z,n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n};var WCe=new h;Qe.getRotation=function(e,t){A.typeOf.object("matrix",e),A.typeOf.object("result",t);let n=Qe.getScale(e,WCe);return t[0]=e[0]/n.x,t[1]=e[1]/n.x,t[2]=e[2]/n.x,t[3]=e[4]/n.y,t[4]=e[5]/n.y,t[5]=e[6]/n.y,t[6]=e[8]/n.z,t[7]=e[9]/n.z,t[8]=e[10]/n.z,t};Qe.multiply=function(e,t,n){A.typeOf.object("left",e),A.typeOf.object("right",t),A.typeOf.object("result",n);let i=e[0],o=e[1],r=e[2],s=e[3],a=e[4],l=e[5],u=e[6],f=e[7],d=e[8],p=e[9],g=e[10],m=e[11],b=e[12],x=e[13],T=e[14],C=e[15],S=t[0],v=t[1],D=t[2],I=t[3],L=t[4],M=t[5],N=t[6],B=t[7],_=t[8],w=t[9],P=t[10],O=t[11],F=t[12],V=t[13],G=t[14],z=t[15],W=i*S+a*v+d*D+b*I,U=o*S+l*v+p*D+x*I,q=r*S+u*v+g*D+T*I,K=s*S+f*v+m*D+C*I,te=i*L+a*M+d*N+b*B,Y=o*L+l*M+p*N+x*B,Z=r*L+u*M+g*N+T*B,ee=s*L+f*M+m*N+C*B,me=i*_+a*w+d*P+b*O,be=o*_+l*w+p*P+x*O,le=r*_+u*w+g*P+T*O,ge=s*_+f*w+m*P+C*O,xe=i*F+a*V+d*G+b*z,Pe=o*F+l*V+p*G+x*z,Ee=r*F+u*V+g*G+T*z,Ue=s*F+f*V+m*G+C*z;return n[0]=W,n[1]=U,n[2]=q,n[3]=K,n[4]=te,n[5]=Y,n[6]=Z,n[7]=ee,n[8]=me,n[9]=be,n[10]=le,n[11]=ge,n[12]=xe,n[13]=Pe,n[14]=Ee,n[15]=Ue,n};Qe.add=function(e,t,n){return A.typeOf.object("left",e),A.typeOf.object("right",t),A.typeOf.object("result",n),n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n[3]=e[3]+t[3],n[4]=e[4]+t[4],n[5]=e[5]+t[5],n[6]=e[6]+t[6],n[7]=e[7]+t[7],n[8]=e[8]+t[8],n[9]=e[9]+t[9],n[10]=e[10]+t[10],n[11]=e[11]+t[11],n[12]=e[12]+t[12],n[13]=e[13]+t[13],n[14]=e[14]+t[14],n[15]=e[15]+t[15],n};Qe.subtract=function(e,t,n){return A.typeOf.object("left",e),A.typeOf.object("right",t),A.typeOf.object("result",n),n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n[3]=e[3]-t[3],n[4]=e[4]-t[4],n[5]=e[5]-t[5],n[6]=e[6]-t[6],n[7]=e[7]-t[7],n[8]=e[8]-t[8],n[9]=e[9]-t[9],n[10]=e[10]-t[10],n[11]=e[11]-t[11],n[12]=e[12]-t[12],n[13]=e[13]-t[13],n[14]=e[14]-t[14],n[15]=e[15]-t[15],n};Qe.multiplyTransformation=function(e,t,n){A.typeOf.object("left",e),A.typeOf.object("right",t),A.typeOf.object("result",n);let i=e[0],o=e[1],r=e[2],s=e[4],a=e[5],l=e[6],u=e[8],f=e[9],d=e[10],p=e[12],g=e[13],m=e[14],b=t[0],x=t[1],T=t[2],C=t[4],S=t[5],v=t[6],D=t[8],I=t[9],L=t[10],M=t[12],N=t[13],B=t[14],_=i*b+s*x+u*T,w=o*b+a*x+f*T,P=r*b+l*x+d*T,O=i*C+s*S+u*v,F=o*C+a*S+f*v,V=r*C+l*S+d*v,G=i*D+s*I+u*L,z=o*D+a*I+f*L,W=r*D+l*I+d*L,U=i*M+s*N+u*B+p,q=o*M+a*N+f*B+g,K=r*M+l*N+d*B+m;return n[0]=_,n[1]=w,n[2]=P,n[3]=0,n[4]=O,n[5]=F,n[6]=V,n[7]=0,n[8]=G,n[9]=z,n[10]=W,n[11]=0,n[12]=U,n[13]=q,n[14]=K,n[15]=1,n};Qe.multiplyByMatrix3=function(e,t,n){A.typeOf.object("matrix",e),A.typeOf.object("rotation",t),A.typeOf.object("result",n);let i=e[0],o=e[1],r=e[2],s=e[4],a=e[5],l=e[6],u=e[8],f=e[9],d=e[10],p=t[0],g=t[1],m=t[2],b=t[3],x=t[4],T=t[5],C=t[6],S=t[7],v=t[8],D=i*p+s*g+u*m,I=o*p+a*g+f*m,L=r*p+l*g+d*m,M=i*b+s*x+u*T,N=o*b+a*x+f*T,B=r*b+l*x+d*T,_=i*C+s*S+u*v,w=o*C+a*S+f*v,P=r*C+l*S+d*v;return n[0]=D,n[1]=I,n[2]=L,n[3]=0,n[4]=M,n[5]=N,n[6]=B,n[7]=0,n[8]=_,n[9]=w,n[10]=P,n[11]=0,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n};Qe.multiplyByTranslation=function(e,t,n){A.typeOf.object("matrix",e),A.typeOf.object("translation",t),A.typeOf.object("result",n);let i=t.x,o=t.y,r=t.z,s=i*e[0]+o*e[4]+r*e[8]+e[12],a=i*e[1]+o*e[5]+r*e[9]+e[13],l=i*e[2]+o*e[6]+r*e[10]+e[14];return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=s,n[13]=a,n[14]=l,n[15]=e[15],n};Qe.multiplyByScale=function(e,t,n){A.typeOf.object("matrix",e),A.typeOf.object("scale",t),A.typeOf.object("result",n);let i=t.x,o=t.y,r=t.z;return i===1&&o===1&&r===1?Qe.clone(e,n):(n[0]=i*e[0],n[1]=i*e[1],n[2]=i*e[2],n[3]=e[3],n[4]=o*e[4],n[5]=o*e[5],n[6]=o*e[6],n[7]=e[7],n[8]=r*e[8],n[9]=r*e[9],n[10]=r*e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n)};Qe.multiplyByUniformScale=function(e,t,n){return A.typeOf.object("matrix",e),A.typeOf.number("scale",t),A.typeOf.object("result",n),n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n[3]=e[3],n[4]=e[4]*t,n[5]=e[5]*t,n[6]=e[6]*t,n[7]=e[7],n[8]=e[8]*t,n[9]=e[9]*t,n[10]=e[10]*t,n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n};Qe.multiplyByVector=function(e,t,n){A.typeOf.object("matrix",e),A.typeOf.object("cartesian",t),A.typeOf.object("result",n);let i=t.x,o=t.y,r=t.z,s=t.w,a=e[0]*i+e[4]*o+e[8]*r+e[12]*s,l=e[1]*i+e[5]*o+e[9]*r+e[13]*s,u=e[2]*i+e[6]*o+e[10]*r+e[14]*s,f=e[3]*i+e[7]*o+e[11]*r+e[15]*s;return n.x=a,n.y=l,n.z=u,n.w=f,n};Qe.multiplyByPointAsVector=function(e,t,n){A.typeOf.object("matrix",e),A.typeOf.object("cartesian",t),A.typeOf.object("result",n);let i=t.x,o=t.y,r=t.z,s=e[0]*i+e[4]*o+e[8]*r,a=e[1]*i+e[5]*o+e[9]*r,l=e[2]*i+e[6]*o+e[10]*r;return n.x=s,n.y=a,n.z=l,n};Qe.multiplyByPoint=function(e,t,n){A.typeOf.object("matrix",e),A.typeOf.object("cartesian",t),A.typeOf.object("result",n);let i=t.x,o=t.y,r=t.z,s=e[0]*i+e[4]*o+e[8]*r+e[12],a=e[1]*i+e[5]*o+e[9]*r+e[13],l=e[2]*i+e[6]*o+e[10]*r+e[14];return n.x=s,n.y=a,n.z=l,n};Qe.multiplyByScalar=function(e,t,n){return A.typeOf.object("matrix",e),A.typeOf.number("scalar",t),A.typeOf.object("result",n),n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n[3]=e[3]*t,n[4]=e[4]*t,n[5]=e[5]*t,n[6]=e[6]*t,n[7]=e[7]*t,n[8]=e[8]*t,n[9]=e[9]*t,n[10]=e[10]*t,n[11]=e[11]*t,n[12]=e[12]*t,n[13]=e[13]*t,n[14]=e[14]*t,n[15]=e[15]*t,n};Qe.negate=function(e,t){return A.typeOf.object("matrix",e),A.typeOf.object("result",t),t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=-e[7],t[8]=-e[8],t[9]=-e[9],t[10]=-e[10],t[11]=-e[11],t[12]=-e[12],t[13]=-e[13],t[14]=-e[14],t[15]=-e[15],t};Qe.transpose=function(e,t){A.typeOf.object("matrix",e),A.typeOf.object("result",t);let n=e[1],i=e[2],o=e[3],r=e[6],s=e[7],a=e[11];return t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=r,t[10]=e[10],t[11]=e[14],t[12]=o,t[13]=s,t[14]=a,t[15]=e[15],t};Qe.abs=function(e,t){return A.typeOf.object("matrix",e),A.typeOf.object("result",t),t[0]=Math.abs(e[0]),t[1]=Math.abs(e[1]),t[2]=Math.abs(e[2]),t[3]=Math.abs(e[3]),t[4]=Math.abs(e[4]),t[5]=Math.abs(e[5]),t[6]=Math.abs(e[6]),t[7]=Math.abs(e[7]),t[8]=Math.abs(e[8]),t[9]=Math.abs(e[9]),t[10]=Math.abs(e[10]),t[11]=Math.abs(e[11]),t[12]=Math.abs(e[12]),t[13]=Math.abs(e[13]),t[14]=Math.abs(e[14]),t[15]=Math.abs(e[15]),t};Qe.equals=function(e,t){return e===t||c(e)&&c(t)&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[3]===t[3]&&e[7]===t[7]&&e[11]===t[11]&&e[15]===t[15]};Qe.equalsEpsilon=function(e,t,n){return n=y(n,0),e===t||c(e)&&c(t)&&Math.abs(e[0]-t[0])<=n&&Math.abs(e[1]-t[1])<=n&&Math.abs(e[2]-t[2])<=n&&Math.abs(e[3]-t[3])<=n&&Math.abs(e[4]-t[4])<=n&&Math.abs(e[5]-t[5])<=n&&Math.abs(e[6]-t[6])<=n&&Math.abs(e[7]-t[7])<=n&&Math.abs(e[8]-t[8])<=n&&Math.abs(e[9]-t[9])<=n&&Math.abs(e[10]-t[10])<=n&&Math.abs(e[11]-t[11])<=n&&Math.abs(e[12]-t[12])<=n&&Math.abs(e[13]-t[13])<=n&&Math.abs(e[14]-t[14])<=n&&Math.abs(e[15]-t[15])<=n};Qe.getTranslation=function(e,t){return A.typeOf.object("matrix",e),A.typeOf.object("result",t),t.x=e[12],t.y=e[13],t.z=e[14],t};Qe.getMatrix3=function(e,t){return A.typeOf.object("matrix",e),A.typeOf.object("result",t),t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t};var qCe=new Q,YCe=new Q,XCe=new se,KCe=new se(0,0,0,1);Qe.inverse=function(e,t){A.typeOf.object("matrix",e),A.typeOf.object("result",t);let n=e[0],i=e[4],o=e[8],r=e[12],s=e[1],a=e[5],l=e[9],u=e[13],f=e[2],d=e[6],p=e[10],g=e[14],m=e[3],b=e[7],x=e[11],T=e[15],C=p*T,S=g*x,v=d*T,D=g*b,I=d*x,L=p*b,M=f*T,N=g*m,B=f*x,_=p*m,w=f*b,P=d*m,O=C*a+D*l+I*u-(S*a+v*l+L*u),F=S*s+M*l+_*u-(C*s+N*l+B*u),V=v*s+N*a+w*u-(D*s+M*a+P*u),G=L*s+B*a+P*l-(I*s+_*a+w*l),z=S*i+v*o+L*r-(C*i+D*o+I*r),W=C*n+N*o+B*r-(S*n+M*o+_*r),U=D*n+M*i+P*r-(v*n+N*i+w*r),q=I*n+_*i+w*o-(L*n+B*i+P*o);C=o*u,S=r*l,v=i*u,D=r*a,I=i*l,L=o*a,M=n*u,N=r*s,B=n*l,_=o*s,w=n*a,P=i*s;let K=C*b+D*x+I*T-(S*b+v*x+L*T),te=S*m+M*x+_*T-(C*m+N*x+B*T),Y=v*m+N*b+w*T-(D*m+M*b+P*T),Z=L*m+B*b+P*x-(I*m+_*b+w*x),ee=v*p+L*g+S*d-(I*g+C*d+D*p),me=B*g+C*f+N*p-(M*p+_*g+S*f),be=M*d+P*g+D*f-(w*g+v*f+N*d),le=w*p+I*f+_*d-(B*d+P*p+L*f),ge=n*O+i*F+o*V+r*G;if(Math.abs(ge)<R.EPSILON21){if(Q.equalsEpsilon(Qe.getMatrix3(e,qCe),YCe,R.EPSILON7)&&se.equals(Qe.getRow(e,3,XCe),KCe))return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=0,t[11]=0,t[12]=-e[12],t[13]=-e[13],t[14]=-e[14],t[15]=1,t;throw new ue("matrix is not invertible because its determinate is zero.")}return ge=1/ge,t[0]=O*ge,t[1]=F*ge,t[2]=V*ge,t[3]=G*ge,t[4]=z*ge,t[5]=W*ge,t[6]=U*ge,t[7]=q*ge,t[8]=K*ge,t[9]=te*ge,t[10]=Y*ge,t[11]=Z*ge,t[12]=ee*ge,t[13]=me*ge,t[14]=be*ge,t[15]=le*ge,t};Qe.inverseTransformation=function(e,t){A.typeOf.object("matrix",e),A.typeOf.object("result",t);let n=e[0],i=e[1],o=e[2],r=e[4],s=e[5],a=e[6],l=e[8],u=e[9],f=e[10],d=e[12],p=e[13],g=e[14],m=-n*d-i*p-o*g,b=-r*d-s*p-a*g,x=-l*d-u*p-f*g;return t[0]=n,t[1]=r,t[2]=l,t[3]=0,t[4]=i,t[5]=s,t[6]=u,t[7]=0,t[8]=o,t[9]=a,t[10]=f,t[11]=0,t[12]=m,t[13]=b,t[14]=x,t[15]=1,t};var $Ce=new Qe;Qe.inverseTranspose=function(e,t){return A.typeOf.object("matrix",e),A.typeOf.object("result",t),Qe.inverse(Qe.transpose(e,$Ce),t)};Qe.IDENTITY=Object.freeze(new Qe(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1));Qe.ZERO=Object.freeze(new Qe(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0));Qe.COLUMN0ROW0=0;Qe.COLUMN0ROW1=1;Qe.COLUMN0ROW2=2;Qe.COLUMN0ROW3=3;Qe.COLUMN1ROW0=4;Qe.COLUMN1ROW1=5;Qe.COLUMN1ROW2=6;Qe.COLUMN1ROW3=7;Qe.COLUMN2ROW0=8;Qe.COLUMN2ROW1=9;Qe.COLUMN2ROW2=10;Qe.COLUMN2ROW3=11;Qe.COLUMN3ROW0=12;Qe.COLUMN3ROW1=13;Qe.COLUMN3ROW2=14;Qe.COLUMN3ROW3=15;Object.defineProperties(Qe.prototype,{length:{get:function(){return Qe.packedLength}}});Qe.prototype.clone=function(e){return Qe.clone(this,e)};Qe.prototype.equals=function(e){return Qe.equals(this,e)};Qe.equalsArray=function(e,t,n){return e[0]===t[n]&&e[1]===t[n+1]&&e[2]===t[n+2]&&e[3]===t[n+3]&&e[4]===t[n+4]&&e[5]===t[n+5]&&e[6]===t[n+6]&&e[7]===t[n+7]&&e[8]===t[n+8]&&e[9]===t[n+9]&&e[10]===t[n+10]&&e[11]===t[n+11]&&e[12]===t[n+12]&&e[13]===t[n+13]&&e[14]===t[n+14]&&e[15]===t[n+15]};Qe.prototype.equalsEpsilon=function(e,t){return Qe.equalsEpsilon(this,e,t)};Qe.prototype.toString=function(){return`(${this[0]}, ${this[4]}, ${this[8]}, ${this[12]})
(${this[1]}, ${this[5]}, ${this[9]}, ${this[13]})
(${this[2]}, ${this[6]}, ${this[10]}, ${this[14]})
(${this[3]}, ${this[7]}, ${this[11]}, ${this[15]})`};var k=Qe;var __,Sr={requestFullscreen:void 0,exitFullscreen:void 0,fullscreenEnabled:void 0,fullscreenElement:void 0,fullscreenchange:void 0,fullscreenerror:void 0},Yc={};Object.defineProperties(Yc,{element:{get:function(){if(Yc.supportsFullscreen())return document[Sr.fullscreenElement]}},changeEventName:{get:function(){if(Yc.supportsFullscreen())return Sr.fullscreenchange}},errorEventName:{get:function(){if(Yc.supportsFullscreen())return Sr.fullscreenerror}},enabled:{get:function(){if(Yc.supportsFullscreen())return document[Sr.fullscreenEnabled]}},fullscreen:{get:function(){if(Yc.supportsFullscreen())return Yc.element!==null}}});Yc.supportsFullscreen=function(){if(c(__))return __;__=!1;let e=document.body;if(typeof e.requestFullscreen=="function")return Sr.requestFullscreen="requestFullscreen",Sr.exitFullscreen="exitFullscreen",Sr.fullscreenEnabled="fullscreenEnabled",Sr.fullscreenElement="fullscreenElement",Sr.fullscreenchange="fullscreenchange",Sr.fullscreenerror="fullscreenerror",__=!0,__;let t=["webkit","moz","o","ms","khtml"],n;for(let i=0,o=t.length;i<o;++i){let r=t[i];n=`${r}RequestFullscreen`,typeof e[n]=="function"?(Sr.requestFullscreen=n,__=!0):(n=`${r}RequestFullScreen`,typeof e[n]=="function"&&(Sr.requestFullscreen=n,__=!0)),n=`${r}ExitFullscreen`,typeof document[n]=="function"?Sr.exitFullscreen=n:(n=`${r}CancelFullScreen`,typeof document[n]=="function"&&(Sr.exitFullscreen=n)),n=`${r}FullscreenEnabled`,document[n]!==void 0?Sr.fullscreenEnabled=n:(n=`${r}FullScreenEnabled`,document[n]!==void 0&&(Sr.fullscreenEnabled=n)),n=`${r}FullscreenElement`,document[n]!==void 0?Sr.fullscreenElement=n:(n=`${r}FullScreenElement`,document[n]!==void 0&&(Sr.fullscreenElement=n)),n=`${r}fullscreenchange`,document[`on${n}`]!==void 0&&(r==="ms"&&(n="MSFullscreenChange"),Sr.fullscreenchange=n),n=`${r}fullscreenerror`,document[`on${n}`]!==void 0&&(r==="ms"&&(n="MSFullscreenError"),Sr.fullscreenerror=n)}return __};Yc.requestFullscreen=function(e,t){Yc.supportsFullscreen()&&e[Sr.requestFullscreen]({vrDisplay:t})};Yc.exitFullscreen=function(){Yc.supportsFullscreen()&&document[Sr.exitFullscreen]()};Yc._names=Sr;var wr=Yc;var ka;typeof navigator<"u"?ka=navigator:ka={};function Fy(e){let t=e.split(".");for(let n=0,i=t.length;n<i;++n)t[n]=parseInt(t[n],10);return t}var lI,wZ;function v2(){if(!c(lI)&&(lI=!1,!pI())){let e=/ Chrome\/([\.0-9]+)/.exec(ka.userAgent);e!==null&&(lI=!0,wZ=Fy(e[1]))}return lI}function ZCe(){return v2()&&wZ}var uI,vZ;function DZ(){if(!c(uI)&&(uI=!1,!v2()&&!pI()&&/ Safari\/[\.0-9]+/.test(ka.userAgent))){let e=/ Version\/([\.0-9]+)/.exec(ka.userAgent);e!==null&&(uI=!0,vZ=Fy(e[1]))}return uI}function JCe(){return DZ()&&vZ}var fI,S2;function PZ(){if(!c(fI)){fI=!1;let e=/ AppleWebKit\/([\.0-9]+)(\+?)/.exec(ka.userAgent);e!==null&&(fI=!0,S2=Fy(e[1]),S2.isNightly=!!e[2])}return fI}function QCe(){return PZ()&&S2}var _E,w2;function IZ(){if(!c(_E)){_E=!1;let e;ka.appName==="Microsoft Internet Explorer"?(e=/MSIE ([0-9]{1,}[\.0-9]{0,})/.exec(ka.userAgent),e!==null&&(_E=!0,w2=Fy(e[1]))):ka.appName==="Netscape"&&(e=/Trident\/.*rv:([0-9]{1,}[\.0-9]{0,})/.exec(ka.userAgent),e!==null&&(_E=!0,w2=Fy(e[1])))}return _E}function eEe(){return IZ()&&w2}var dI,OZ;function pI(){if(!c(dI)){dI=!1;let e=/ Edg\/([\.0-9]+)/.exec(ka.userAgent);e!==null&&(dI=!0,OZ=Fy(e[1]))}return dI}function tEe(){return pI()&&OZ}var hI,D2;function _I(){if(!c(hI)){hI=!1;let e=/Firefox\/([\.0-9]+)/.exec(ka.userAgent);e!==null&&(hI=!0,D2=Fy(e[1]))}return hI}var A2;function nEe(){return c(A2)||(A2=/Windows/i.test(ka.appVersion)),A2}var C2;function iEe(){return c(C2)||(C2=navigator.platform==="iPhone"||navigator.platform==="iPod"||navigator.platform==="iPad"),C2}function oEe(){return _I()&&D2}var E2;function rEe(){return c(E2)||(E2=!_I()&&typeof PointerEvent<"u"&&(!c(ka.pointerEnabled)||ka.pointerEnabled)),E2}var RZ,mI;function MZ(){if(!c(mI)){let e=document.createElement("canvas");e.setAttribute("style","image-rendering: -moz-crisp-edges;image-rendering: pixelated;");let t=e.style.imageRendering;mI=c(t)&&t!=="",mI&&(RZ=t)}return mI}function sEe(){return MZ()?RZ:void 0}function Ba(){if(!Ba.initialized)throw new E("You must call FeatureDetection.supportsWebP.initialize and wait for the promise to resolve before calling FeatureDetection.supportsWebP");return Ba._result}Ba._promise=void 0;Ba._result=void 0;Ba.initialize=function(){return c(Ba._promise)||(Ba._promise=new Promise(e=>{let t=new Image;t.onload=function(){Ba._result=t.width>0&&t.height>0,e(Ba._result)},t.onerror=function(){Ba._result=!1,e(Ba._result)},t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA"})),Ba._promise};Object.defineProperties(Ba,{initialized:{get:function(){return c(Ba._result)}}});var Ox=[];typeof ArrayBuffer<"u"&&(Ox.push(Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array),typeof Uint8ClampedArray<"u"&&Ox.push(Uint8ClampedArray),typeof Uint8ClampedArray<"u"&&Ox.push(Uint8ClampedArray),typeof BigInt64Array<"u"&&Ox.push(BigInt64Array),typeof BigUint64Array<"u"&&Ox.push(BigUint64Array));var Iu={isChrome:v2,chromeVersion:ZCe,isSafari:DZ,safariVersion:JCe,isWebkit:PZ,webkitVersion:QCe,isInternetExplorer:IZ,internetExplorerVersion:eEe,isEdge:pI,edgeVersion:tEe,isFirefox:_I,firefoxVersion:oEe,isWindows:nEe,isIPadOrIOS:iEe,hardwareConcurrency:y(ka.hardwareConcurrency,3),supportsPointerEvents:rEe,supportsImageRenderingPixelated:MZ,supportsWebP:Ba,imageRenderingValue:sEe,typedArrayTypes:Ox};Iu.supportsBasis=function(e){return Iu.supportsWebAssembly()&&e.context.supportsBasis};Iu.supportsFullscreen=function(){return wr.supportsFullscreen()};Iu.supportsTypedArrays=function(){return typeof ArrayBuffer<"u"};Iu.supportsBigInt64Array=function(){return typeof BigInt64Array<"u"};Iu.supportsBigUint64Array=function(){return typeof BigUint64Array<"u"};Iu.supportsBigInt=function(){return typeof BigInt<"u"};Iu.supportsWebWorkers=function(){return typeof Worker<"u"};Iu.supportsWebAssembly=function(){return typeof WebAssembly<"u"};Iu.supportsWebgl2=function(e){return A.defined("scene",e),e.context.webgl2};Iu.supportsEsmWebWorkers=function(){return!_I()||parseInt(D2)>=114};var zt=Iu;function nt(e,t,n,i){this.x=y(e,0),this.y=y(t,0),this.z=y(n,0),this.w=y(i,0)}var gE=new h;nt.fromAxisAngle=function(e,t,n){A.typeOf.object("axis",e),A.typeOf.number("angle",t);let i=t/2,o=Math.sin(i);gE=h.normalize(e,gE);let r=gE.x*o,s=gE.y*o,a=gE.z*o,l=Math.cos(i);return c(n)?(n.x=r,n.y=s,n.z=a,n.w=l,n):new nt(r,s,a,l)};var aEe=[1,2,0],cEe=new Array(3);nt.fromRotationMatrix=function(e,t){A.typeOf.object("matrix",e);let n,i,o,r,s,a=e[Q.COLUMN0ROW0],l=e[Q.COLUMN1ROW1],u=e[Q.COLUMN2ROW2],f=a+l+u;if(f>0)n=Math.sqrt(f+1),s=.5*n,n=.5/n,i=(e[Q.COLUMN1ROW2]-e[Q.COLUMN2ROW1])*n,o=(e[Q.COLUMN2ROW0]-e[Q.COLUMN0ROW2])*n,r=(e[Q.COLUMN0ROW1]-e[Q.COLUMN1ROW0])*n;else{let d=aEe,p=0;l>a&&(p=1),u>a&&u>l&&(p=2);let g=d[p],m=d[g];n=Math.sqrt(e[Q.getElementIndex(p,p)]-e[Q.getElementIndex(g,g)]-e[Q.getElementIndex(m,m)]+1);let b=cEe;b[p]=.5*n,n=.5/n,s=(e[Q.getElementIndex(m,g)]-e[Q.getElementIndex(g,m)])*n,b[g]=(e[Q.getElementIndex(g,p)]+e[Q.getElementIndex(p,g)])*n,b[m]=(e[Q.getElementIndex(m,p)]+e[Q.getElementIndex(p,m)])*n,i=-b[0],o=-b[1],r=-b[2]}return c(t)?(t.x=i,t.y=o,t.z=r,t.w=s,t):new nt(i,o,r,s)};var LZ=new nt,NZ=new nt,P2=new nt,FZ=new nt;nt.fromHeadingPitchRoll=function(e,t){return A.typeOf.object("headingPitchRoll",e),FZ=nt.fromAxisAngle(h.UNIT_X,e.roll,LZ),P2=nt.fromAxisAngle(h.UNIT_Y,-e.pitch,t),t=nt.multiply(P2,FZ,P2),NZ=nt.fromAxisAngle(h.UNIT_Z,-e.heading,LZ),nt.multiply(NZ,t,t)};var gI=new h,I2=new h,kf=new nt,BZ=new nt,yI=new nt;nt.packedLength=4;nt.pack=function(e,t,n){return A.typeOf.object("value",e),A.defined("array",t),n=y(n,0),t[n++]=e.x,t[n++]=e.y,t[n++]=e.z,t[n]=e.w,t};nt.unpack=function(e,t,n){return A.defined("array",e),t=y(t,0),c(n)||(n=new nt),n.x=e[t],n.y=e[t+1],n.z=e[t+2],n.w=e[t+3],n};nt.packedInterpolationLength=3;nt.convertPackedArrayForInterpolation=function(e,t,n,i){nt.unpack(e,n*4,yI),nt.conjugate(yI,yI);for(let o=0,r=n-t+1;o<r;o++){let s=o*3;nt.unpack(e,(t+o)*4,kf),nt.multiply(kf,yI,kf),kf.w<0&&nt.negate(kf,kf),nt.computeAxis(kf,gI);let a=nt.computeAngle(kf);c(i)||(i=[]),i[s]=gI.x*a,i[s+1]=gI.y*a,i[s+2]=gI.z*a}};nt.unpackInterpolationResult=function(e,t,n,i,o){c(o)||(o=new nt),h.fromArray(e,0,I2);let r=h.magnitude(I2);return nt.unpack(t,i*4,BZ),r===0?nt.clone(nt.IDENTITY,kf):nt.fromAxisAngle(I2,r,kf),nt.multiply(kf,BZ,o)};nt.clone=function(e,t){if(c(e))return c(t)?(t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t):new nt(e.x,e.y,e.z,e.w)};nt.conjugate=function(e,t){return A.typeOf.object("quaternion",e),A.typeOf.object("result",t),t.x=-e.x,t.y=-e.y,t.z=-e.z,t.w=e.w,t};nt.magnitudeSquared=function(e){return A.typeOf.object("quaternion",e),e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w};nt.magnitude=function(e){return Math.sqrt(nt.magnitudeSquared(e))};nt.normalize=function(e,t){A.typeOf.object("result",t);let n=1/nt.magnitude(e),i=e.x*n,o=e.y*n,r=e.z*n,s=e.w*n;return t.x=i,t.y=o,t.z=r,t.w=s,t};nt.inverse=function(e,t){A.typeOf.object("result",t);let n=nt.magnitudeSquared(e);return t=nt.conjugate(e,t),nt.multiplyByScalar(t,1/n,t)};nt.add=function(e,t,n){return A.typeOf.object("left",e),A.typeOf.object("right",t),A.typeOf.object("result",n),n.x=e.x+t.x,n.y=e.y+t.y,n.z=e.z+t.z,n.w=e.w+t.w,n};nt.subtract=function(e,t,n){return A.typeOf.object("left",e),A.typeOf.object("right",t),A.typeOf.object("result",n),n.x=e.x-t.x,n.y=e.y-t.y,n.z=e.z-t.z,n.w=e.w-t.w,n};nt.negate=function(e,t){return A.typeOf.object("quaternion",e),A.typeOf.object("result",t),t.x=-e.x,t.y=-e.y,t.z=-e.z,t.w=-e.w,t};nt.dot=function(e,t){return A.typeOf.object("left",e),A.typeOf.object("right",t),e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w};nt.multiply=function(e,t,n){A.typeOf.object("left",e),A.typeOf.object("right",t),A.typeOf.object("result",n);let i=e.x,o=e.y,r=e.z,s=e.w,a=t.x,l=t.y,u=t.z,f=t.w,d=s*a+i*f+o*u-r*l,p=s*l-i*u+o*f+r*a,g=s*u+i*l-o*a+r*f,m=s*f-i*a-o*l-r*u;return n.x=d,n.y=p,n.z=g,n.w=m,n};nt.multiplyByScalar=function(e,t,n){return A.typeOf.object("quaternion",e),A.typeOf.number("scalar",t),A.typeOf.object("result",n),n.x=e.x*t,n.y=e.y*t,n.z=e.z*t,n.w=e.w*t,n};nt.divideByScalar=function(e,t,n){return A.typeOf.object("quaternion",e),A.typeOf.number("scalar",t),A.typeOf.object("result",n),n.x=e.x/t,n.y=e.y/t,n.z=e.z/t,n.w=e.w/t,n};nt.computeAxis=function(e,t){A.typeOf.object("quaternion",e),A.typeOf.object("result",t);let n=e.w;if(Math.abs(n-1)<R.EPSILON6||Math.abs(n+1)<R.EPSILON6)return t.x=1,t.y=t.z=0,t;let i=1/Math.sqrt(1-n*n);return t.x=e.x*i,t.y=e.y*i,t.z=e.z*i,t};nt.computeAngle=function(e){return A.typeOf.object("quaternion",e),Math.abs(e.w-1)<R.EPSILON6?0:2*Math.acos(e.w)};var O2=new nt;nt.lerp=function(e,t,n,i){return A.typeOf.object("start",e),A.typeOf.object("end",t),A.typeOf.number("t",n),A.typeOf.object("result",i),O2=nt.multiplyByScalar(t,n,O2),i=nt.multiplyByScalar(e,1-n,i),nt.add(O2,i,i)};var kZ=new nt,R2=new nt,M2=new nt;nt.slerp=function(e,t,n,i){A.typeOf.object("start",e),A.typeOf.object("end",t),A.typeOf.number("t",n),A.typeOf.object("result",i);let o=nt.dot(e,t),r=t;if(o<0&&(o=-o,r=kZ=nt.negate(t,kZ)),1-o<R.EPSILON6)return nt.lerp(e,r,n,i);let s=Math.acos(o);return R2=nt.multiplyByScalar(e,Math.sin((1-n)*s),R2),M2=nt.multiplyByScalar(r,Math.sin(n*s),M2),i=nt.add(R2,M2,i),nt.multiplyByScalar(i,1/Math.sin(s),i)};nt.log=function(e,t){A.typeOf.object("quaternion",e),A.typeOf.object("result",t);let n=R.acosClamped(e.w),i=0;return n!==0&&(i=n/Math.sin(n)),h.multiplyByScalar(e,i,t)};nt.exp=function(e,t){A.typeOf.object("cartesian",e),A.typeOf.object("result",t);let n=h.magnitude(e),i=0;return n!==0&&(i=Math.sin(n)/n),t.x=e.x*i,t.y=e.y*i,t.z=e.z*i,t.w=Math.cos(n),t};var lEe=new h,uEe=new h,yE=new nt,Rx=new nt;nt.computeInnerQuadrangle=function(e,t,n,i){A.typeOf.object("q0",e),A.typeOf.object("q1",t),A.typeOf.object("q2",n),A.typeOf.object("result",i);let o=nt.conjugate(t,yE);nt.multiply(o,n,Rx);let r=nt.log(Rx,lEe);nt.multiply(o,e,Rx);let s=nt.log(Rx,uEe);return h.add(r,s,r),h.multiplyByScalar(r,.25,r),h.negate(r,r),nt.exp(r,yE),nt.multiply(t,yE,i)};nt.squad=function(e,t,n,i,o,r){A.typeOf.object("q0",e),A.typeOf.object("q1",t),A.typeOf.object("s0",n),A.typeOf.object("s1",i),A.typeOf.number("t",o),A.typeOf.object("result",r);let s=nt.slerp(e,t,o,yE),a=nt.slerp(n,i,o,Rx);return nt.slerp(s,a,2*o*(1-o),r)};var fEe=new nt,VZ=1.9011074535173003,bI=zt.supportsTypedArrays()?new Float32Array(8):[],xI=zt.supportsTypedArrays()?new Float32Array(8):[],Am=zt.supportsTypedArrays()?new Float32Array(8):[],Cm=zt.supportsTypedArrays()?new Float32Array(8):[];for(let e=0;e<7;++e){let t=e+1,n=2*t+1;bI[e]=1/(t*n),xI[e]=t/n}bI[7]=VZ/(8*17);xI[7]=VZ*8/17;nt.fastSlerp=function(e,t,n,i){A.typeOf.object("start",e),A.typeOf.object("end",t),A.typeOf.number("t",n),A.typeOf.object("result",i);let o=nt.dot(e,t),r;o>=0?r=1:(r=-1,o=-o);let s=o-1,a=1-n,l=n*n,u=a*a;for(let g=7;g>=0;--g)Am[g]=(bI[g]*l-xI[g])*s,Cm[g]=(bI[g]*u-xI[g])*s;let f=r*n*(1+Am[0]*(1+Am[1]*(1+Am[2]*(1+Am[3]*(1+Am[4]*(1+Am[5]*(1+Am[6]*(1+Am[7])))))))),d=a*(1+Cm[0]*(1+Cm[1]*(1+Cm[2]*(1+Cm[3]*(1+Cm[4]*(1+Cm[5]*(1+Cm[6]*(1+Cm[7])))))))),p=nt.multiplyByScalar(e,d,fEe);return nt.multiplyByScalar(t,f,i),nt.add(p,i,i)};nt.fastSquad=function(e,t,n,i,o,r){A.typeOf.object("q0",e),A.typeOf.object("q1",t),A.typeOf.object("s0",n),A.typeOf.object("s1",i),A.typeOf.number("t",o),A.typeOf.object("result",r);let s=nt.fastSlerp(e,t,o,yE),a=nt.fastSlerp(n,i,o,Rx);return nt.fastSlerp(s,a,2*o*(1-o),r)};nt.equals=function(e,t){return e===t||c(e)&&c(t)&&e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w};nt.equalsEpsilon=function(e,t,n){return n=y(n,0),e===t||c(e)&&c(t)&&Math.abs(e.x-t.x)<=n&&Math.abs(e.y-t.y)<=n&&Math.abs(e.z-t.z)<=n&&Math.abs(e.w-t.w)<=n};nt.ZERO=Object.freeze(new nt(0,0,0,0));nt.IDENTITY=Object.freeze(new nt(0,0,0,1));nt.prototype.clone=function(e){return nt.clone(this,e)};nt.prototype.equals=function(e){return nt.equals(this,e)};nt.prototype.equalsEpsilon=function(e,t){return nt.equalsEpsilon(this,e,t)};nt.prototype.toString=function(){return`(${this.x}, ${this.y}, ${this.z}, ${this.w})`};var Ne=nt;var ei={},L2={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},Mx={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},N2={},Xc={east:new h,north:new h,up:new h,west:new h,south:new h,down:new h},g_=new h,y_=new h,b_=new h;ei.localFrameToFixedFrameGenerator=function(e,t){if(!L2.hasOwnProperty(e)||!L2[e].hasOwnProperty(t))throw new E("firstAxis and secondAxis must be east, north, up, west, south or down.");let n=L2[e][t],i,o=e+t;return c(N2[o])?i=N2[o]:(i=function(r,s,a){if(!c(r))throw new E("origin is required.");if(isNaN(r.x)||isNaN(r.y)||isNaN(r.z))throw new E("origin has a NaN component");if(c(a)||(a=new k),h.equalsEpsilon(r,h.ZERO,R.EPSILON14))h.unpack(Mx[e],0,g_),h.unpack(Mx[t],0,y_),h.unpack(Mx[n],0,b_);else if(R.equalsEpsilon(r.x,0,R.EPSILON14)&&R.equalsEpsilon(r.y,0,R.EPSILON14)){let l=R.sign(r.z);h.unpack(Mx[e],0,g_),e!=="east"&&e!=="west"&&h.multiplyByScalar(g_,l,g_),h.unpack(Mx[t],0,y_),t!=="east"&&t!=="west"&&h.multiplyByScalar(y_,l,y_),h.unpack(Mx[n],0,b_),n!=="east"&&n!=="west"&&h.multiplyByScalar(b_,l,b_)}else{s=y(s,ie.default),s.geodeticSurfaceNormal(r,Xc.up);let l=Xc.up,u=Xc.east;u.x=-r.y,u.y=r.x,u.z=0,h.normalize(u,Xc.east),h.cross(l,u,Xc.north),h.multiplyByScalar(Xc.up,-1,Xc.down),h.multiplyByScalar(Xc.east,-1,Xc.west),h.multiplyByScalar(Xc.north,-1,Xc.south),g_=Xc[e],y_=Xc[t],b_=Xc[n]}return a[0]=g_.x,a[1]=g_.y,a[2]=g_.z,a[3]=0,a[4]=y_.x,a[5]=y_.y,a[6]=y_.z,a[7]=0,a[8]=b_.x,a[9]=b_.y,a[10]=b_.z,a[11]=0,a[12]=r.x,a[13]=r.y,a[14]=r.z,a[15]=1,a},N2[o]=i),i};ei.eastNorthUpToFixedFrame=ei.localFrameToFixedFrameGenerator("east","north");ei.northEastDownToFixedFrame=ei.localFrameToFixedFrameGenerator("north","east");ei.northUpEastToFixedFrame=ei.localFrameToFixedFrameGenerator("north","up");ei.northWestUpToFixedFrame=ei.localFrameToFixedFrameGenerator("north","west");var dEe=new Ne,hEe=new h(1,1,1),mEe=new k;ei.headingPitchRollToFixedFrame=function(e,t,n,i,o){A.typeOf.object("HeadingPitchRoll",t),i=y(i,ei.eastNorthUpToFixedFrame);let r=Ne.fromHeadingPitchRoll(t,dEe),s=k.fromTranslationQuaternionRotationScale(h.ZERO,r,hEe,mEe);return o=i(e,n,o),k.multiply(o,s,o)};var pEe=new k,_Ee=new Q;ei.headingPitchRollQuaternion=function(e,t,n,i,o){A.typeOf.object("HeadingPitchRoll",t);let r=ei.headingPitchRollToFixedFrame(e,t,n,i,pEe),s=k.getMatrix3(r,_Ee);return Ne.fromRotationMatrix(s,o)};var gEe=new h(1,1,1),yEe=new h,UZ=new k,bEe=new k,xEe=new Q,TEe=new Ne;ei.fixedFrameToHeadingPitchRoll=function(e,t,n,i){A.defined("transform",e),t=y(t,ie.default),n=y(n,ei.eastNorthUpToFixedFrame),c(i)||(i=new Fa);let o=k.getTranslation(e,yEe);if(h.equals(o,h.ZERO))return i.heading=0,i.pitch=0,i.roll=0,i;let r=k.inverseTransformation(n(o,t,UZ),UZ),s=k.setScale(e,gEe,bEe);s=k.setTranslation(s,h.ZERO,s),r=k.multiply(r,s,r);let a=Ne.fromRotationMatrix(k.getMatrix3(r,xEe),TEe);return a=Ne.normalize(a,a),Fa.fromQuaternion(a,i)};var AEe=6*3600+41*60+50.54841,CEe=8640184812866e-6,EEe=.093104,SEe=-62e-7,wEe=11772758384668e-32,vEe=72921158553e-15,DEe=R.TWO_PI/86400,TI=new J;ei.computeIcrfToCentralBodyFixedMatrix=function(e,t){let n=ei.computeIcrfToFixedMatrix(e,t);return c(n)||(n=ei.computeTemeToPseudoFixedMatrix(e,t)),n};ei.computeTemeToPseudoFixedMatrix=function(e,t){if(!c(e))throw new E("date is required.");TI=J.addSeconds(e,-J.computeTaiMinusUtc(e),TI);let n=TI.dayNumber,i=TI.secondsOfDay,o,r=n-2451545;i>=43200?o=(r+.5)/qn.DAYS_PER_JULIAN_CENTURY:o=(r-.5)/qn.DAYS_PER_JULIAN_CENTURY;let a=(AEe+o*(CEe+o*(EEe+o*SEe)))*DEe%R.TWO_PI,l=vEe+wEe*(n-24515455e-1),u=(i+qn.SECONDS_PER_DAY*.5)%qn.SECONDS_PER_DAY,f=a+l*u,d=Math.cos(f),p=Math.sin(f);return c(t)?(t[0]=d,t[1]=-p,t[2]=0,t[3]=p,t[4]=d,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t):new Q(d,p,0,-p,d,0,0,0,1)};ei.iau2006XysData=new g2;ei.earthOrientationParameters=h2.NONE;var k2=32.184,PEe=2451545;ei.preloadIcrfFixed=function(e){let t=e.start.dayNumber,n=e.start.secondsOfDay+k2,i=e.stop.dayNumber,o=e.stop.secondsOfDay+k2;return ei.iau2006XysData.preload(t,n,i,o)};ei.computeIcrfToFixedMatrix=function(e,t){if(!c(e))throw new E("date is required.");c(t)||(t=new Q);let n=ei.computeFixedToIcrfMatrix(e,t);if(c(n))return Q.transpose(n,t)};var IEe=32.184,OEe=2451545,AI=new Fa,REe=new Q,MEe=new J;ei.computeMoonFixedToIcrfMatrix=function(e,t){if(!c(e))throw new E("date is required.");c(t)||(t=new Q);let n=J.addSeconds(e,IEe,MEe),i=J.totalDays(n)-OEe,o=R.toRadians(12.112)-R.toRadians(.052992)*i,r=R.toRadians(24.224)-R.toRadians(.105984)*i,s=R.toRadians(227.645)+R.toRadians(13.012)*i,a=R.toRadians(261.105)+R.toRadians(13.340716)*i,l=R.toRadians(358)+R.toRadians(.9856)*i;return AI.pitch=R.toRadians(180)-R.toRadians(3.878)*Math.sin(o)-R.toRadians(.12)*Math.sin(r)+R.toRadians(.07)*Math.sin(s)-R.toRadians(.017)*Math.sin(a),AI.roll=R.toRadians(66.53-90)+R.toRadians(1.543)*Math.cos(o)+R.toRadians(.24)*Math.cos(r)-R.toRadians(.028)*Math.cos(s)+R.toRadians(.007)*Math.cos(a),AI.heading=R.toRadians(244.375-90)+R.toRadians(13.17635831)*i+R.toRadians(3.558)*Math.sin(o)+R.toRadians(.121)*Math.sin(r)-R.toRadians(.064)*Math.sin(s)+R.toRadians(.016)*Math.sin(a)+R.toRadians(.025)*Math.sin(l),Q.fromHeadingPitchRoll(AI,REe)};ei.computeIcrfToMoonFixedMatrix=function(e,t){if(!c(e))throw new E("date is required.");c(t)||(t=new Q);let n=ei.computeMoonFixedToIcrfMatrix(e,t);if(c(n))return Q.transpose(n,t)};var LEe=new mE(0,0,0),NEe=new Tx(0,0,0,0,0,0),F2=new Q,B2=new Q;ei.computeFixedToIcrfMatrix=function(e,t){if(!c(e))throw new E("date is required.");c(t)||(t=new Q);let n=ei.earthOrientationParameters.compute(e,NEe);if(!c(n))return;let i=e.dayNumber,o=e.secondsOfDay+k2,r=ei.iau2006XysData.computeXysRadians(i,o,LEe);if(!c(r))return;let s=r.x+n.xPoleOffset,a=r.y+n.yPoleOffset,l=1/(1+Math.sqrt(1-s*s-a*a)),u=F2;u[0]=1-l*s*s,u[3]=-l*s*a,u[6]=s,u[1]=-l*s*a,u[4]=1-l*a*a,u[7]=a,u[2]=-s,u[5]=-a,u[8]=1-l*(s*s+a*a);let f=Q.fromRotationZ(-r.s,B2),d=Q.multiply(u,f,F2),p=e.dayNumber,g=e.secondsOfDay-J.computeTaiMinusUtc(e)+n.ut1MinusUtc,m=p-2451545,b=g/qn.SECONDS_PER_DAY,x=.779057273264+b+.00273781191135448*(m+b);x=x%1*R.TWO_PI;let T=Q.fromRotationZ(x,B2),C=Q.multiply(d,T,F2),S=Math.cos(n.xPoleWander),v=Math.cos(n.yPoleWander),D=Math.sin(n.xPoleWander),I=Math.sin(n.yPoleWander),L=i-PEe+o/qn.SECONDS_PER_DAY;L/=36525;let M=-47e-6*L*R.RADIANS_PER_DEGREE/3600,N=Math.cos(M),B=Math.sin(M),_=B2;return _[0]=S*N,_[1]=S*B,_[2]=D,_[3]=-v*B+I*D*N,_[4]=v*N+I*D*B,_[5]=-I*S,_[6]=-I*B-v*D*N,_[7]=I*N-v*D*B,_[8]=v*S,Q.multiply(C,_,t)};var FEe=new se;ei.pointToWindowCoordinates=function(e,t,n,i){return i=ei.pointToGLWindowCoordinates(e,t,n,i),i.y=2*t[5]-i.y,i};ei.pointToGLWindowCoordinates=function(e,t,n,i){if(!c(e))throw new E("modelViewProjectionMatrix is required.");if(!c(t))throw new E("viewportTransformation is required.");if(!c(n))throw new E("point is required.");c(i)||(i=new H);let o=FEe;return k.multiplyByVector(e,se.fromElements(n.x,n.y,n.z,1,o),o),se.multiplyByScalar(o,1/o.w,o),k.multiplyByVector(t,o,o),H.fromCartesian4(o,i)};var BEe=new h,kEe=new h,VEe=new h;ei.rotationMatrixFromPositionVelocity=function(e,t,n,i){if(!c(e))throw new E("position is required.");if(!c(t))throw new E("velocity is required.");let o=y(n,ie.default).geodeticSurfaceNormal(e,BEe),r=h.cross(t,o,kEe);h.equalsEpsilon(r,h.ZERO,R.EPSILON6)&&(r=h.clone(h.UNIT_X,r));let s=h.cross(r,t,VEe);return h.normalize(s,s),h.cross(t,s,r),h.negate(r,r),h.normalize(r,r),c(i)||(i=new Q),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=r.x,i[4]=r.y,i[5]=r.z,i[6]=s.x,i[7]=s.y,i[8]=s.z,i};var zZ=new k(0,0,1,0,1,0,0,0,0,1,0,0,0,0,0,1),HZ=new he,V2=new h,UEe=new h,zEe=new Q,U2=new k,GZ=new k;ei.basisTo2D=function(e,t,n){if(!c(e))throw new E("projection is required.");if(!c(t))throw new E("matrix is required.");if(!c(n))throw new E("result is required.");let i=k.getTranslation(t,UEe),o=e.ellipsoid,r;if(h.equals(i,h.ZERO))r=h.clone(h.ZERO,V2);else{let f=o.cartesianToCartographic(i,HZ);r=e.project(f,V2),h.fromElements(r.z,r.x,r.y,r)}let s=ei.eastNorthUpToFixedFrame(i,o,U2),a=k.inverseTransformation(s,GZ),l=k.getMatrix3(t,zEe),u=k.multiplyByMatrix3(a,l,n);return k.multiply(zZ,u,n),k.setTranslation(n,r,n),n};ei.ellipsoidTo2DModelMatrix=function(e,t,n){if(!c(e))throw new E("projection is required.");if(!c(t))throw new E("center is required.");if(!c(n))throw new E("result is required.");let i=e.ellipsoid,o=ei.eastNorthUpToFixedFrame(t,i,U2),r=k.inverseTransformation(o,GZ),s=i.cartesianToCartographic(t,HZ),a=e.project(s,V2);h.fromElements(a.z,a.x,a.y,a);let l=k.fromTranslation(a,U2);return k.multiply(zZ,r,n),k.multiply(l,n,n),n};var Ft=ei;var jZ={};function bE(e,t){if(!c(e))throw new E("identifier is required.");c(jZ[e])||(jZ[e]=!0,console.warn(y(t,e)))}bE.geometryOutlines="Entity geometry outlines are unsupported on terrain. Outlines will be disabled. To enable outlines, disable geometry terrain clamping by explicitly setting height to 0.";bE.geometryZIndex="Entity geometry with zIndex are unsupported when height or extrudedHeight are defined.  zIndex will be ignored";bE.geometryHeightReference="Entity corridor, ellipse, polygon or rectangle with heightReference must also have a defined height.  heightReference will be ignored";bE.geometryExtrudedHeightReference="Entity corridor, ellipse, polygon or rectangle with extrudedHeightReference must also have a defined extrudedHeight.  extrudedHeightReference will be ignored";var _t=bE;function HEe(e,t){if(!c(e)||!c(t))throw new E("identifier and message are required.");_t(e,t)}var Ss=HEe;function Tn(e,t,n,i){this.west=y(e,0),this.south=y(t,0),this.east=y(n,0),this.north=y(i,0)}Object.defineProperties(Tn.prototype,{width:{get:function(){return Tn.computeWidth(this)}},height:{get:function(){return Tn.computeHeight(this)}}});Tn.packedLength=4;Tn.pack=function(e,t,n){return A.typeOf.object("value",e),A.defined("array",t),n=y(n,0),t[n++]=e.west,t[n++]=e.south,t[n++]=e.east,t[n]=e.north,t};Tn.unpack=function(e,t,n){return A.defined("array",e),t=y(t,0),c(n)||(n=new Tn),n.west=e[t++],n.south=e[t++],n.east=e[t++],n.north=e[t],n};Tn.computeWidth=function(e){A.typeOf.object("rectangle",e);let t=e.east,n=e.west;return t<n&&(t+=R.TWO_PI),t-n};Tn.computeHeight=function(e){return A.typeOf.object("rectangle",e),e.north-e.south};Tn.fromDegrees=function(e,t,n,i,o){return e=R.toRadians(y(e,0)),t=R.toRadians(y(t,0)),n=R.toRadians(y(n,0)),i=R.toRadians(y(i,0)),c(o)?(o.west=e,o.south=t,o.east=n,o.north=i,o):new Tn(e,t,n,i)};Tn.fromRadians=function(e,t,n,i,o){return c(o)?(o.west=y(e,0),o.south=y(t,0),o.east=y(n,0),o.north=y(i,0),o):new Tn(e,t,n,i)};Tn.fromCartographicArray=function(e,t){A.defined("cartographics",e);let n=Number.MAX_VALUE,i=-Number.MAX_VALUE,o=Number.MAX_VALUE,r=-Number.MAX_VALUE,s=Number.MAX_VALUE,a=-Number.MAX_VALUE;for(let l=0,u=e.length;l<u;l++){let f=e[l];n=Math.min(n,f.longitude),i=Math.max(i,f.longitude),s=Math.min(s,f.latitude),a=Math.max(a,f.latitude);let d=f.longitude>=0?f.longitude:f.longitude+R.TWO_PI;o=Math.min(o,d),r=Math.max(r,d)}return i-n>r-o&&(n=o,i=r,i>R.PI&&(i=i-R.TWO_PI),n>R.PI&&(n=n-R.TWO_PI)),c(t)?(t.west=n,t.south=s,t.east=i,t.north=a,t):new Tn(n,s,i,a)};Tn.fromCartesianArray=function(e,t,n){A.defined("cartesians",e),t=y(t,ie.default);let i=Number.MAX_VALUE,o=-Number.MAX_VALUE,r=Number.MAX_VALUE,s=-Number.MAX_VALUE,a=Number.MAX_VALUE,l=-Number.MAX_VALUE;for(let u=0,f=e.length;u<f;u++){let d=t.cartesianToCartographic(e[u]);i=Math.min(i,d.longitude),o=Math.max(o,d.longitude),a=Math.min(a,d.latitude),l=Math.max(l,d.latitude);let p=d.longitude>=0?d.longitude:d.longitude+R.TWO_PI;r=Math.min(r,p),s=Math.max(s,p)}return o-i>s-r&&(i=r,o=s,o>R.PI&&(o=o-R.TWO_PI),i>R.PI&&(i=i-R.TWO_PI)),c(n)?(n.west=i,n.south=a,n.east=o,n.north=l,n):new Tn(i,a,o,l)};var GEe=new h,jEe=new h,WEe=new h,qEe=new h,YEe=new h,z2=new Array(5);for(let e=0;e<z2.length;++e)z2[e]=new h;Tn.fromBoundingSphere=function(e,t,n){A.typeOf.object("boundingSphere",e);let i=e.center,o=e.radius;if(c(t)||(t=ie.default),c(n)||(n=new Tn),h.equals(i,h.ZERO))return Tn.clone(Tn.MAX_VALUE,n),n;let r=Ft.eastNorthUpToFixedFrame(i,t,GEe),s=k.multiplyByPointAsVector(r,h.UNIT_X,jEe);h.normalize(s,s);let a=k.multiplyByPointAsVector(r,h.UNIT_Y,WEe);h.normalize(a,a),h.multiplyByScalar(a,o,a),h.multiplyByScalar(s,o,s);let l=h.negate(a,YEe),u=h.negate(s,qEe),f=z2,d=f[0];return h.add(i,a,d),d=f[1],h.add(i,u,d),d=f[2],h.add(i,l,d),d=f[3],h.add(i,s,d),f[4]=i,Tn.fromCartesianArray(f,t,n)};Tn.clone=function(e,t){if(c(e))return c(t)?(t.west=e.west,t.south=e.south,t.east=e.east,t.north=e.north,t):new Tn(e.west,e.south,e.east,e.north)};Tn.equalsEpsilon=function(e,t,n){return n=y(n,0),e===t||c(e)&&c(t)&&Math.abs(e.west-t.west)<=n&&Math.abs(e.south-t.south)<=n&&Math.abs(e.east-t.east)<=n&&Math.abs(e.north-t.north)<=n};Tn.prototype.clone=function(e){return Tn.clone(this,e)};Tn.prototype.equals=function(e){return Tn.equals(this,e)};Tn.equals=function(e,t){return e===t||c(e)&&c(t)&&e.west===t.west&&e.south===t.south&&e.east===t.east&&e.north===t.north};Tn.prototype.equalsEpsilon=function(e,t){return Tn.equalsEpsilon(this,e,t)};Tn.validate=function(e){return Ss("Rectangle.validate","Rectangle.validate is a no-op and has been deprecated. It will be removed in Cesium 1.124."),Tn._validate(e)};Tn._validate=function(e){A.typeOf.object("rectangle",e);let t=e.north;A.typeOf.number.greaterThanOrEquals("north",t,-R.PI_OVER_TWO),A.typeOf.number.lessThanOrEquals("north",t,R.PI_OVER_TWO);let n=e.south;A.typeOf.number.greaterThanOrEquals("south",n,-R.PI_OVER_TWO),A.typeOf.number.lessThanOrEquals("south",n,R.PI_OVER_TWO);let i=e.west;A.typeOf.number.greaterThanOrEquals("west",i,-Math.PI),A.typeOf.number.lessThanOrEquals("west",i,Math.PI);let o=e.east;A.typeOf.number.greaterThanOrEquals("east",o,-Math.PI),A.typeOf.number.lessThanOrEquals("east",o,Math.PI)};Tn.southwest=function(e,t){return A.typeOf.object("rectangle",e),c(t)?(t.longitude=e.west,t.latitude=e.south,t.height=0,t):new he(e.west,e.south)};Tn.northwest=function(e,t){return A.typeOf.object("rectangle",e),c(t)?(t.longitude=e.west,t.latitude=e.north,t.height=0,t):new he(e.west,e.north)};Tn.northeast=function(e,t){return A.typeOf.object("rectangle",e),c(t)?(t.longitude=e.east,t.latitude=e.north,t.height=0,t):new he(e.east,e.north)};Tn.southeast=function(e,t){return A.typeOf.object("rectangle",e),c(t)?(t.longitude=e.east,t.latitude=e.south,t.height=0,t):new he(e.east,e.south)};Tn.center=function(e,t){A.typeOf.object("rectangle",e);let n=e.east,i=e.west;n<i&&(n+=R.TWO_PI);let o=R.negativePiToPi((i+n)*.5),r=(e.south+e.north)*.5;return c(t)?(t.longitude=o,t.latitude=r,t.height=0,t):new he(o,r)};Tn.intersection=function(e,t,n){A.typeOf.object("rectangle",e),A.typeOf.object("otherRectangle",t);let i=e.east,o=e.west,r=t.east,s=t.west;i<o&&r>0?i+=R.TWO_PI:r<s&&i>0&&(r+=R.TWO_PI),i<o&&s<0?s+=R.TWO_PI:r<s&&o<0&&(o+=R.TWO_PI);let a=R.negativePiToPi(Math.max(o,s)),l=R.negativePiToPi(Math.min(i,r));if((e.west<e.east||t.west<t.east)&&l<=a)return;let u=Math.max(e.south,t.south),f=Math.min(e.north,t.north);if(!(u>=f))return c(n)?(n.west=a,n.south=u,n.east=l,n.north=f,n):new Tn(a,u,l,f)};Tn.simpleIntersection=function(e,t,n){A.typeOf.object("rectangle",e),A.typeOf.object("otherRectangle",t);let i=Math.max(e.west,t.west),o=Math.max(e.south,t.south),r=Math.min(e.east,t.east),s=Math.min(e.north,t.north);if(!(o>=s||i>=r))return c(n)?(n.west=i,n.south=o,n.east=r,n.north=s,n):new Tn(i,o,r,s)};Tn.union=function(e,t,n){A.typeOf.object("rectangle",e),A.typeOf.object("otherRectangle",t),c(n)||(n=new Tn);let i=e.east,o=e.west,r=t.east,s=t.west;i<o&&r>0?i+=R.TWO_PI:r<s&&i>0&&(r+=R.TWO_PI),i<o&&s<0?s+=R.TWO_PI:r<s&&o<0&&(o+=R.TWO_PI);let a=R.negativePiToPi(Math.min(o,s)),l=R.negativePiToPi(Math.max(i,r));return n.west=a,n.south=Math.min(e.south,t.south),n.east=l,n.north=Math.max(e.north,t.north),n};Tn.expand=function(e,t,n){return A.typeOf.object("rectangle",e),A.typeOf.object("cartographic",t),c(n)||(n=new Tn),n.west=Math.min(e.west,t.longitude),n.south=Math.min(e.south,t.latitude),n.east=Math.max(e.east,t.longitude),n.north=Math.max(e.north,t.latitude),n};Tn.contains=function(e,t){A.typeOf.object("rectangle",e),A.typeOf.object("cartographic",t);let n=t.longitude,i=t.latitude,o=e.west,r=e.east;return r<o&&(r+=R.TWO_PI,n<0&&(n+=R.TWO_PI)),(n>o||R.equalsEpsilon(n,o,R.EPSILON14))&&(n<r||R.equalsEpsilon(n,r,R.EPSILON14))&&i>=e.south&&i<=e.north};var XEe=new he;Tn.subsample=function(e,t,n,i){A.typeOf.object("rectangle",e),t=y(t,ie.default),n=y(n,0),c(i)||(i=[]);let o=0,r=e.north,s=e.south,a=e.east,l=e.west,u=XEe;u.height=n,u.longitude=l,u.latitude=r,i[o]=t.cartographicToCartesian(u,i[o]),o++,u.longitude=a,i[o]=t.cartographicToCartesian(u,i[o]),o++,u.latitude=s,i[o]=t.cartographicToCartesian(u,i[o]),o++,u.longitude=l,i[o]=t.cartographicToCartesian(u,i[o]),o++,r<0?u.latitude=r:s>0?u.latitude=s:u.latitude=0;for(let f=1;f<8;++f)u.longitude=-Math.PI+f*R.PI_OVER_TWO,Tn.contains(e,u)&&(i[o]=t.cartographicToCartesian(u,i[o]),o++);return u.latitude===0&&(u.longitude=l,i[o]=t.cartographicToCartesian(u,i[o]),o++,u.longitude=a,i[o]=t.cartographicToCartesian(u,i[o]),o++),i.length=o,i};Tn.subsection=function(e,t,n,i,o,r){if(A.typeOf.object("rectangle",e),A.typeOf.number.greaterThanOrEquals("westLerp",t,0),A.typeOf.number.lessThanOrEquals("westLerp",t,1),A.typeOf.number.greaterThanOrEquals("southLerp",n,0),A.typeOf.number.lessThanOrEquals("southLerp",n,1),A.typeOf.number.greaterThanOrEquals("eastLerp",i,0),A.typeOf.number.lessThanOrEquals("eastLerp",i,1),A.typeOf.number.greaterThanOrEquals("northLerp",o,0),A.typeOf.number.lessThanOrEquals("northLerp",o,1),A.typeOf.number.lessThanOrEquals("westLerp",t,i),A.typeOf.number.lessThanOrEquals("southLerp",n,o),c(r)||(r=new Tn),e.west<=e.east){let a=e.east-e.west;r.west=e.west+t*a,r.east=e.west+i*a}else{let a=R.TWO_PI+e.east-e.west;r.west=R.negativePiToPi(e.west+t*a),r.east=R.negativePiToPi(e.west+i*a)}let s=e.north-e.south;return r.south=e.south+n*s,r.north=e.south+o*s,t===1&&(r.west=e.east),i===1&&(r.east=e.east),n===1&&(r.south=e.north),o===1&&(r.north=e.north),r};Tn.MAX_VALUE=Object.freeze(new Tn(-Math.PI,-R.PI_OVER_TWO,Math.PI,R.PI_OVER_TWO));var ae=Tn;function vr(e,t,n,i){this.x=y(e,0),this.y=y(t,0),this.width=y(n,0),this.height=y(i,0)}vr.packedLength=4;vr.pack=function(e,t,n){return A.typeOf.object("value",e),A.defined("array",t),n=y(n,0),t[n++]=e.x,t[n++]=e.y,t[n++]=e.width,t[n]=e.height,t};vr.unpack=function(e,t,n){return A.defined("array",e),t=y(t,0),c(n)||(n=new vr),n.x=e[t++],n.y=e[t++],n.width=e[t++],n.height=e[t],n};vr.fromPoints=function(e,t){if(c(t)||(t=new vr),!c(e)||e.length===0)return t.x=0,t.y=0,t.width=0,t.height=0,t;let n=e.length,i=e[0].x,o=e[0].y,r=e[0].x,s=e[0].y;for(let a=1;a<n;a++){let l=e[a],u=l.x,f=l.y;i=Math.min(u,i),r=Math.max(u,r),o=Math.min(f,o),s=Math.max(f,s)}return t.x=i,t.y=o,t.width=r-i,t.height=s-o,t};var WZ=new Mi,KEe=new he,$Ee=new he;vr.fromRectangle=function(e,t,n){if(c(n)||(n=new vr),!c(e))return n.x=0,n.y=0,n.width=0,n.height=0,n;WZ._ellipsoid=ie.default,t=y(t,WZ);let i=t.project(ae.southwest(e,KEe)),o=t.project(ae.northeast(e,$Ee));return H.subtract(o,i,o),n.x=i.x,n.y=i.y,n.width=o.x,n.height=o.y,n};vr.clone=function(e,t){if(c(e))return c(t)?(t.x=e.x,t.y=e.y,t.width=e.width,t.height=e.height,t):new vr(e.x,e.y,e.width,e.height)};vr.union=function(e,t,n){A.typeOf.object("left",e),A.typeOf.object("right",t),c(n)||(n=new vr);let i=Math.min(e.x,t.x),o=Math.min(e.y,t.y),r=Math.max(e.x+e.width,t.x+t.width),s=Math.max(e.y+e.height,t.y+t.height);return n.x=i,n.y=o,n.width=r-i,n.height=s-o,n};vr.expand=function(e,t,n){A.typeOf.object("rectangle",e),A.typeOf.object("point",t),n=vr.clone(e,n);let i=t.x-n.x,o=t.y-n.y;return i>n.width?n.width=i:i<0&&(n.width-=i,n.x=t.x),o>n.height?n.height=o:o<0&&(n.height-=o,n.y=t.y),n};vr.intersect=function(e,t){A.typeOf.object("left",e),A.typeOf.object("right",t);let n=e.x,i=e.y,o=t.x,r=t.y;return n>o+t.width||n+e.width<o||i+e.height<r||i>r+t.height?qt.OUTSIDE:qt.INTERSECTING};vr.equals=function(e,t){return e===t||c(e)&&c(t)&&e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height};vr.prototype.clone=function(e){return vr.clone(this,e)};vr.prototype.intersect=function(e){return vr.intersect(this,e)};vr.prototype.equals=function(e){return vr.equals(this,e)};var Ke=vr;function H2(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n*6<1?e+(t-e)*6*n:n*2<1?t:n*3<2?e+(t-e)*(2/3-n)*6:e}function re(e,t,n,i){this.red=y(e,1),this.green=y(t,1),this.blue=y(n,1),this.alpha=y(i,1)}re.fromCartesian4=function(e,t){return A.typeOf.object("cartesian",e),c(t)?(t.red=e.x,t.green=e.y,t.blue=e.z,t.alpha=e.w,t):new re(e.x,e.y,e.z,e.w)};re.fromBytes=function(e,t,n,i,o){return e=re.byteToFloat(y(e,255)),t=re.byteToFloat(y(t,255)),n=re.byteToFloat(y(n,255)),i=re.byteToFloat(y(i,255)),c(o)?(o.red=e,o.green=t,o.blue=n,o.alpha=i,o):new re(e,t,n,i)};re.fromAlpha=function(e,t,n){return A.typeOf.object("color",e),A.typeOf.number("alpha",t),c(n)?(n.red=e.red,n.green=e.green,n.blue=e.blue,n.alpha=t,n):new re(e.red,e.green,e.blue,t)};var G2,j2,Em;zt.supportsTypedArrays()&&(G2=new ArrayBuffer(4),j2=new Uint32Array(G2),Em=new Uint8Array(G2));re.fromRgba=function(e,t){return j2[0]=e,re.fromBytes(Em[0],Em[1],Em[2],Em[3],t)};re.fromHsl=function(e,t,n,i,o){e=y(e,0)%1,t=y(t,0),n=y(n,0),i=y(i,1);let r=n,s=n,a=n;if(t!==0){let l;n<.5?l=n*(1+t):l=n+t-n*t;let u=2*n-l;r=H2(u,l,e+1/3),s=H2(u,l,e),a=H2(u,l,e-1/3)}return c(o)?(o.red=r,o.green=s,o.blue=a,o.alpha=i,o):new re(r,s,a,i)};re.fromRandom=function(e,t){e=y(e,y.EMPTY_OBJECT);let n=e.red;if(!c(n)){let s=y(e.minimumRed,0),a=y(e.maximumRed,1);A.typeOf.number.lessThanOrEquals("minimumRed",s,a),n=s+R.nextRandomNumber()*(a-s)}let i=e.green;if(!c(i)){let s=y(e.minimumGreen,0),a=y(e.maximumGreen,1);A.typeOf.number.lessThanOrEquals("minimumGreen",s,a),i=s+R.nextRandomNumber()*(a-s)}let o=e.blue;if(!c(o)){let s=y(e.minimumBlue,0),a=y(e.maximumBlue,1);A.typeOf.number.lessThanOrEquals("minimumBlue",s,a),o=s+R.nextRandomNumber()*(a-s)}let r=e.alpha;if(!c(r)){let s=y(e.minimumAlpha,0),a=y(e.maximumAlpha,1);A.typeOf.number.lessThanOrEquals("minimumAlpha",s,a),r=s+R.nextRandomNumber()*(a-s)}return c(t)?(t.red=n,t.green=i,t.blue=o,t.alpha=r,t):new re(n,i,o,r)};var ZEe=/^#([0-9a-f])([0-9a-f])([0-9a-f])([0-9a-f])?$/i,JEe=/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i,QEe=/^rgba?\s*\(\s*([0-9.]+%?)\s*[,\s]+\s*([0-9.]+%?)\s*[,\s]+\s*([0-9.]+%?)(?:\s*[,\s/]+\s*([0-9.]+))?\s*\)$/i,eSe=/^hsla?\s*\(\s*([0-9.]+)\s*[,\s]+\s*([0-9.]+%)\s*[,\s]+\s*([0-9.]+%)(?:\s*[,\s/]+\s*([0-9.]+))?\s*\)$/i;re.fromCssColorString=function(e,t){A.typeOf.string("color",e),c(t)||(t=new re),e=e.trim();let n=re[e.toUpperCase()];if(c(n))return re.clone(n,t),t;let i=ZEe.exec(e);return i!==null?(t.red=parseInt(i[1],16)/15,t.green=parseInt(i[2],16)/15,t.blue=parseInt(i[3],16)/15,t.alpha=parseInt(y(i[4],"f"),16)/15,t):(i=JEe.exec(e),i!==null?(t.red=parseInt(i[1],16)/255,t.green=parseInt(i[2],16)/255,t.blue=parseInt(i[3],16)/255,t.alpha=parseInt(y(i[4],"ff"),16)/255,t):(i=QEe.exec(e),i!==null?(t.red=parseFloat(i[1])/(i[1].substr(-1)==="%"?100:255),t.green=parseFloat(i[2])/(i[2].substr(-1)==="%"?100:255),t.blue=parseFloat(i[3])/(i[3].substr(-1)==="%"?100:255),t.alpha=parseFloat(y(i[4],"1.0")),t):(i=eSe.exec(e),i!==null?re.fromHsl(parseFloat(i[1])/360,parseFloat(i[2])/100,parseFloat(i[3])/100,parseFloat(y(i[4],"1.0")),t):(t=void 0,t))))};re.packedLength=4;re.pack=function(e,t,n){return A.typeOf.object("value",e),A.defined("array",t),n=y(n,0),t[n++]=e.red,t[n++]=e.green,t[n++]=e.blue,t[n]=e.alpha,t};re.unpack=function(e,t,n){return A.defined("array",e),t=y(t,0),c(n)||(n=new re),n.red=e[t++],n.green=e[t++],n.blue=e[t++],n.alpha=e[t],n};re.byteToFloat=function(e){return e/255};re.floatToByte=function(e){return e===1?255:e*256|0};re.clone=function(e,t){if(c(e))return c(t)?(t.red=e.red,t.green=e.green,t.blue=e.blue,t.alpha=e.alpha,t):new re(e.red,e.green,e.blue,e.alpha)};re.equals=function(e,t){return e===t||c(e)&&c(t)&&e.red===t.red&&e.green===t.green&&e.blue===t.blue&&e.alpha===t.alpha};re.equalsArray=function(e,t,n){return e.red===t[n]&&e.green===t[n+1]&&e.blue===t[n+2]&&e.alpha===t[n+3]};re.prototype.clone=function(e){return re.clone(this,e)};re.prototype.equals=function(e){return re.equals(this,e)};re.prototype.equalsEpsilon=function(e,t){return this===e||c(e)&&Math.abs(this.red-e.red)<=t&&Math.abs(this.green-e.green)<=t&&Math.abs(this.blue-e.blue)<=t&&Math.abs(this.alpha-e.alpha)<=t};re.prototype.toString=function(){return`(${this.red}, ${this.green}, ${this.blue}, ${this.alpha})`};re.prototype.toCssColorString=function(){let e=re.floatToByte(this.red),t=re.floatToByte(this.green),n=re.floatToByte(this.blue);return this.alpha===1?`rgb(${e},${t},${n})`:`rgba(${e},${t},${n},${this.alpha})`};re.prototype.toCssHexString=function(){let e=re.floatToByte(this.red).toString(16);e.length<2&&(e=`0${e}`);let t=re.floatToByte(this.green).toString(16);t.length<2&&(t=`0${t}`);let n=re.floatToByte(this.blue).toString(16);if(n.length<2&&(n=`0${n}`),this.alpha<1){let i=re.floatToByte(this.alpha).toString(16);return i.length<2&&(i=`0${i}`),`#${e}${t}${n}${i}`}return`#${e}${t}${n}`};re.prototype.toBytes=function(e){let t=re.floatToByte(this.red),n=re.floatToByte(this.green),i=re.floatToByte(this.blue),o=re.floatToByte(this.alpha);return c(e)?(e[0]=t,e[1]=n,e[2]=i,e[3]=o,e):[t,n,i,o]};re.prototype.toRgba=function(){return Em[0]=re.floatToByte(this.red),Em[1]=re.floatToByte(this.green),Em[2]=re.floatToByte(this.blue),Em[3]=re.floatToByte(this.alpha),j2[0]};re.prototype.brighten=function(e,t){return A.typeOf.number("magnitude",e),A.typeOf.number.greaterThanOrEquals("magnitude",e,0),A.typeOf.object("result",t),e=1-e,t.red=1-(1-this.red)*e,t.green=1-(1-this.green)*e,t.blue=1-(1-this.blue)*e,t.alpha=this.alpha,t};re.prototype.darken=function(e,t){return A.typeOf.number("magnitude",e),A.typeOf.number.greaterThanOrEquals("magnitude",e,0),A.typeOf.object("result",t),e=1-e,t.red=this.red*e,t.green=this.green*e,t.blue=this.blue*e,t.alpha=this.alpha,t};re.prototype.withAlpha=function(e,t){return re.fromAlpha(this,e,t)};re.add=function(e,t,n){return A.typeOf.object("left",e),A.typeOf.object("right",t),A.typeOf.object("result",n),n.red=e.red+t.red,n.green=e.green+t.green,n.blue=e.blue+t.blue,n.alpha=e.alpha+t.alpha,n};re.subtract=function(e,t,n){return A.typeOf.object("left",e),A.typeOf.object("right",t),A.typeOf.object("result",n),n.red=e.red-t.red,n.green=e.green-t.green,n.blue=e.blue-t.blue,n.alpha=e.alpha-t.alpha,n};re.multiply=function(e,t,n){return A.typeOf.object("left",e),A.typeOf.object("right",t),A.typeOf.object("result",n),n.red=e.red*t.red,n.green=e.green*t.green,n.blue=e.blue*t.blue,n.alpha=e.alpha*t.alpha,n};re.divide=function(e,t,n){return A.typeOf.object("left",e),A.typeOf.object("right",t),A.typeOf.object("result",n),n.red=e.red/t.red,n.green=e.green/t.green,n.blue=e.blue/t.blue,n.alpha=e.alpha/t.alpha,n};re.mod=function(e,t,n){return A.typeOf.object("left",e),A.typeOf.object("right",t),A.typeOf.object("result",n),n.red=e.red%t.red,n.green=e.green%t.green,n.blue=e.blue%t.blue,n.alpha=e.alpha%t.alpha,n};re.lerp=function(e,t,n,i){return A.typeOf.object("start",e),A.typeOf.object("end",t),A.typeOf.number("t",n),A.typeOf.object("result",i),i.red=R.lerp(e.red,t.red,n),i.green=R.lerp(e.green,t.green,n),i.blue=R.lerp(e.blue,t.blue,n),i.alpha=R.lerp(e.alpha,t.alpha,n),i};re.multiplyByScalar=function(e,t,n){return A.typeOf.object("color",e),A.typeOf.number("scalar",t),A.typeOf.object("result",n),n.red=e.red*t,n.green=e.green*t,n.blue=e.blue*t,n.alpha=e.alpha*t,n};re.divideByScalar=function(e,t,n){return A.typeOf.object("color",e),A.typeOf.number("scalar",t),A.typeOf.object("result",n),n.red=e.red/t,n.green=e.green/t,n.blue=e.blue/t,n.alpha=e.alpha/t,n};re.ALICEBLUE=Object.freeze(re.fromCssColorString("#F0F8FF"));re.ANTIQUEWHITE=Object.freeze(re.fromCssColorString("#FAEBD7"));re.AQUA=Object.freeze(re.fromCssColorString("#00FFFF"));re.AQUAMARINE=Object.freeze(re.fromCssColorString("#7FFFD4"));re.AZURE=Object.freeze(re.fromCssColorString("#F0FFFF"));re.BEIGE=Object.freeze(re.fromCssColorString("#F5F5DC"));re.BISQUE=Object.freeze(re.fromCssColorString("#FFE4C4"));re.BLACK=Object.freeze(re.fromCssColorString("#000000"));re.BLANCHEDALMOND=Object.freeze(re.fromCssColorString("#FFEBCD"));re.BLUE=Object.freeze(re.fromCssColorString("#0000FF"));re.BLUEVIOLET=Object.freeze(re.fromCssColorString("#8A2BE2"));re.BROWN=Object.freeze(re.fromCssColorString("#A52A2A"));re.BURLYWOOD=Object.freeze(re.fromCssColorString("#DEB887"));re.CADETBLUE=Object.freeze(re.fromCssColorString("#5F9EA0"));re.CHARTREUSE=Object.freeze(re.fromCssColorString("#7FFF00"));re.CHOCOLATE=Object.freeze(re.fromCssColorString("#D2691E"));re.CORAL=Object.freeze(re.fromCssColorString("#FF7F50"));re.CORNFLOWERBLUE=Object.freeze(re.fromCssColorString("#6495ED"));re.CORNSILK=Object.freeze(re.fromCssColorString("#FFF8DC"));re.CRIMSON=Object.freeze(re.fromCssColorString("#DC143C"));re.CYAN=Object.freeze(re.fromCssColorString("#00FFFF"));re.DARKBLUE=Object.freeze(re.fromCssColorString("#00008B"));re.DARKCYAN=Object.freeze(re.fromCssColorString("#008B8B"));re.DARKGOLDENROD=Object.freeze(re.fromCssColorString("#B8860B"));re.DARKGRAY=Object.freeze(re.fromCssColorString("#A9A9A9"));re.DARKGREEN=Object.freeze(re.fromCssColorString("#006400"));re.DARKGREY=re.DARKGRAY;re.DARKKHAKI=Object.freeze(re.fromCssColorString("#BDB76B"));re.DARKMAGENTA=Object.freeze(re.fromCssColorString("#8B008B"));re.DARKOLIVEGREEN=Object.freeze(re.fromCssColorString("#556B2F"));re.DARKORANGE=Object.freeze(re.fromCssColorString("#FF8C00"));re.DARKORCHID=Object.freeze(re.fromCssColorString("#9932CC"));re.DARKRED=Object.freeze(re.fromCssColorString("#8B0000"));re.DARKSALMON=Object.freeze(re.fromCssColorString("#E9967A"));re.DARKSEAGREEN=Object.freeze(re.fromCssColorString("#8FBC8F"));re.DARKSLATEBLUE=Object.freeze(re.fromCssColorString("#483D8B"));re.DARKSLATEGRAY=Object.freeze(re.fromCssColorString("#2F4F4F"));re.DARKSLATEGREY=re.DARKSLATEGRAY;re.DARKTURQUOISE=Object.freeze(re.fromCssColorString("#00CED1"));re.DARKVIOLET=Object.freeze(re.fromCssColorString("#9400D3"));re.DEEPPINK=Object.freeze(re.fromCssColorString("#FF1493"));re.DEEPSKYBLUE=Object.freeze(re.fromCssColorString("#00BFFF"));re.DIMGRAY=Object.freeze(re.fromCssColorString("#696969"));re.DIMGREY=re.DIMGRAY;re.DODGERBLUE=Object.freeze(re.fromCssColorString("#1E90FF"));re.FIREBRICK=Object.freeze(re.fromCssColorString("#B22222"));re.FLORALWHITE=Object.freeze(re.fromCssColorString("#FFFAF0"));re.FORESTGREEN=Object.freeze(re.fromCssColorString("#228B22"));re.FUCHSIA=Object.freeze(re.fromCssColorString("#FF00FF"));re.GAINSBORO=Object.freeze(re.fromCssColorString("#DCDCDC"));re.GHOSTWHITE=Object.freeze(re.fromCssColorString("#F8F8FF"));re.GOLD=Object.freeze(re.fromCssColorString("#FFD700"));re.GOLDENROD=Object.freeze(re.fromCssColorString("#DAA520"));re.GRAY=Object.freeze(re.fromCssColorString("#808080"));re.GREEN=Object.freeze(re.fromCssColorString("#008000"));re.GREENYELLOW=Object.freeze(re.fromCssColorString("#ADFF2F"));re.GREY=re.GRAY;re.HONEYDEW=Object.freeze(re.fromCssColorString("#F0FFF0"));re.HOTPINK=Object.freeze(re.fromCssColorString("#FF69B4"));re.INDIANRED=Object.freeze(re.fromCssColorString("#CD5C5C"));re.INDIGO=Object.freeze(re.fromCssColorString("#4B0082"));re.IVORY=Object.freeze(re.fromCssColorString("#FFFFF0"));re.KHAKI=Object.freeze(re.fromCssColorString("#F0E68C"));re.LAVENDER=Object.freeze(re.fromCssColorString("#E6E6FA"));re.LAVENDAR_BLUSH=Object.freeze(re.fromCssColorString("#FFF0F5"));re.LAWNGREEN=Object.freeze(re.fromCssColorString("#7CFC00"));re.LEMONCHIFFON=Object.freeze(re.fromCssColorString("#FFFACD"));re.LIGHTBLUE=Object.freeze(re.fromCssColorString("#ADD8E6"));re.LIGHTCORAL=Object.freeze(re.fromCssColorString("#F08080"));re.LIGHTCYAN=Object.freeze(re.fromCssColorString("#E0FFFF"));re.LIGHTGOLDENRODYELLOW=Object.freeze(re.fromCssColorString("#FAFAD2"));re.LIGHTGRAY=Object.freeze(re.fromCssColorString("#D3D3D3"));re.LIGHTGREEN=Object.freeze(re.fromCssColorString("#90EE90"));re.LIGHTGREY=re.LIGHTGRAY;re.LIGHTPINK=Object.freeze(re.fromCssColorString("#FFB6C1"));re.LIGHTSEAGREEN=Object.freeze(re.fromCssColorString("#20B2AA"));re.LIGHTSKYBLUE=Object.freeze(re.fromCssColorString("#87CEFA"));re.LIGHTSLATEGRAY=Object.freeze(re.fromCssColorString("#778899"));re.LIGHTSLATEGREY=re.LIGHTSLATEGRAY;re.LIGHTSTEELBLUE=Object.freeze(re.fromCssColorString("#B0C4DE"));re.LIGHTYELLOW=Object.freeze(re.fromCssColorString("#FFFFE0"));re.LIME=Object.freeze(re.fromCssColorString("#00FF00"));re.LIMEGREEN=Object.freeze(re.fromCssColorString("#32CD32"));re.LINEN=Object.freeze(re.fromCssColorString("#FAF0E6"));re.MAGENTA=Object.freeze(re.fromCssColorString("#FF00FF"));re.MAROON=Object.freeze(re.fromCssColorString("#800000"));re.MEDIUMAQUAMARINE=Object.freeze(re.fromCssColorString("#66CDAA"));re.MEDIUMBLUE=Object.freeze(re.fromCssColorString("#0000CD"));re.MEDIUMORCHID=Object.freeze(re.fromCssColorString("#BA55D3"));re.MEDIUMPURPLE=Object.freeze(re.fromCssColorString("#9370DB"));re.MEDIUMSEAGREEN=Object.freeze(re.fromCssColorString("#3CB371"));re.MEDIUMSLATEBLUE=Object.freeze(re.fromCssColorString("#7B68EE"));re.MEDIUMSPRINGGREEN=Object.freeze(re.fromCssColorString("#00FA9A"));re.MEDIUMTURQUOISE=Object.freeze(re.fromCssColorString("#48D1CC"));re.MEDIUMVIOLETRED=Object.freeze(re.fromCssColorString("#C71585"));re.MIDNIGHTBLUE=Object.freeze(re.fromCssColorString("#191970"));re.MINTCREAM=Object.freeze(re.fromCssColorString("#F5FFFA"));re.MISTYROSE=Object.freeze(re.fromCssColorString("#FFE4E1"));re.MOCCASIN=Object.freeze(re.fromCssColorString("#FFE4B5"));re.NAVAJOWHITE=Object.freeze(re.fromCssColorString("#FFDEAD"));re.NAVY=Object.freeze(re.fromCssColorString("#000080"));re.OLDLACE=Object.freeze(re.fromCssColorString("#FDF5E6"));re.OLIVE=Object.freeze(re.fromCssColorString("#808000"));re.OLIVEDRAB=Object.freeze(re.fromCssColorString("#6B8E23"));re.ORANGE=Object.freeze(re.fromCssColorString("#FFA500"));re.ORANGERED=Object.freeze(re.fromCssColorString("#FF4500"));re.ORCHID=Object.freeze(re.fromCssColorString("#DA70D6"));re.PALEGOLDENROD=Object.freeze(re.fromCssColorString("#EEE8AA"));re.PALEGREEN=Object.freeze(re.fromCssColorString("#98FB98"));re.PALETURQUOISE=Object.freeze(re.fromCssColorString("#AFEEEE"));re.PALEVIOLETRED=Object.freeze(re.fromCssColorString("#DB7093"));re.PAPAYAWHIP=Object.freeze(re.fromCssColorString("#FFEFD5"));re.PEACHPUFF=Object.freeze(re.fromCssColorString("#FFDAB9"));re.PERU=Object.freeze(re.fromCssColorString("#CD853F"));re.PINK=Object.freeze(re.fromCssColorString("#FFC0CB"));re.PLUM=Object.freeze(re.fromCssColorString("#DDA0DD"));re.POWDERBLUE=Object.freeze(re.fromCssColorString("#B0E0E6"));re.PURPLE=Object.freeze(re.fromCssColorString("#800080"));re.RED=Object.freeze(re.fromCssColorString("#FF0000"));re.ROSYBROWN=Object.freeze(re.fromCssColorString("#BC8F8F"));re.ROYALBLUE=Object.freeze(re.fromCssColorString("#4169E1"));re.SADDLEBROWN=Object.freeze(re.fromCssColorString("#8B4513"));re.SALMON=Object.freeze(re.fromCssColorString("#FA8072"));re.SANDYBROWN=Object.freeze(re.fromCssColorString("#F4A460"));re.SEAGREEN=Object.freeze(re.fromCssColorString("#2E8B57"));re.SEASHELL=Object.freeze(re.fromCssColorString("#FFF5EE"));re.SIENNA=Object.freeze(re.fromCssColorString("#A0522D"));re.SILVER=Object.freeze(re.fromCssColorString("#C0C0C0"));re.SKYBLUE=Object.freeze(re.fromCssColorString("#87CEEB"));re.SLATEBLUE=Object.freeze(re.fromCssColorString("#6A5ACD"));re.SLATEGRAY=Object.freeze(re.fromCssColorString("#708090"));re.SLATEGREY=re.SLATEGRAY;re.SNOW=Object.freeze(re.fromCssColorString("#FFFAFA"));re.SPRINGGREEN=Object.freeze(re.fromCssColorString("#00FF7F"));re.STEELBLUE=Object.freeze(re.fromCssColorString("#4682B4"));re.TAN=Object.freeze(re.fromCssColorString("#D2B48C"));re.TEAL=Object.freeze(re.fromCssColorString("#008080"));re.THISTLE=Object.freeze(re.fromCssColorString("#D8BFD8"));re.TOMATO=Object.freeze(re.fromCssColorString("#FF6347"));re.TURQUOISE=Object.freeze(re.fromCssColorString("#40E0D0"));re.VIOLET=Object.freeze(re.fromCssColorString("#EE82EE"));re.WHEAT=Object.freeze(re.fromCssColorString("#F5DEB3"));re.WHITE=Object.freeze(re.fromCssColorString("#FFFFFF"));re.WHITESMOKE=Object.freeze(re.fromCssColorString("#F5F5F5"));re.YELLOW=Object.freeze(re.fromCssColorString("#FFFF00"));re.YELLOWGREEN=Object.freeze(re.fromCssColorString("#9ACD32"));re.TRANSPARENT=Object.freeze(new re(0,0,0,0));var j=re;function tSe(){return!0}function nSe(e,t){t=y(t,"This object was destroyed, i.e., destroy() was called.");function n(){throw new E(t)}for(let i in e)typeof e[i]=="function"&&(e[i]=n);e.isDestroyed=tSe}var de=nSe;function Il(e,t){e=y(e,0),this._near=e,t=y(t,Number.MAX_VALUE),this._far=t}Object.defineProperties(Il.prototype,{near:{get:function(){return this._near},set:function(e){this._near=e}},far:{get:function(){return this._far},set:function(e){this._far=e}}});Il.packedLength=2;Il.pack=function(e,t,n){if(!c(e))throw new E("value is required");if(!c(t))throw new E("array is required");return n=y(n,0),t[n++]=e.near,t[n]=e.far,t};Il.unpack=function(e,t,n){if(!c(e))throw new E("array is required");return t=y(t,0),c(n)||(n=new Il),n.near=e[t++],n.far=e[t],n};Il.equals=function(e,t){return e===t||c(e)&&c(t)&&e.near===t.near&&e.far===t.far};Il.clone=function(e,t){if(c(e))return c(t)||(t=new Il),t.near=e.near,t.far=e.far,t};Il.prototype.clone=function(e){return Il.clone(this,e)};Il.prototype.equals=function(e){return Il.equals(this,e)};var Bt=Il;function Ou(e,t,n,i){this.near=y(e,0),this.nearValue=y(t,0),this.far=y(n,1),this.farValue=y(i,0)}Ou.clone=function(e,t){if(c(e))return c(t)?(t.near=e.near,t.nearValue=e.nearValue,t.far=e.far,t.farValue=e.farValue,t):new Ou(e.near,e.nearValue,e.far,e.farValue)};Ou.packedLength=4;Ou.pack=function(e,t,n){if(!c(e))throw new E("value is required");if(!c(t))throw new E("array is required");return n=y(n,0),t[n++]=e.near,t[n++]=e.nearValue,t[n++]=e.far,t[n]=e.farValue,t};Ou.unpack=function(e,t,n){if(!c(e))throw new E("array is required");return t=y(t,0),c(n)||(n=new Ou),n.near=e[t++],n.nearValue=e[t++],n.far=e[t++],n.farValue=e[t],n};Ou.equals=function(e,t){return e===t||c(e)&&c(t)&&e.near===t.near&&e.nearValue===t.nearValue&&e.far===t.far&&e.farValue===t.farValue};Ou.prototype.clone=function(e){return Ou.clone(this,e)};Ou.prototype.equals=function(e){return Ou.equals(this,e)};var Vt=Ou;var By={NONE:0,CLAMP_TO_GROUND:1,RELATIVE_TO_GROUND:2,CLAMP_TO_TERRAIN:3,RELATIVE_TO_TERRAIN:4,CLAMP_TO_3D_TILE:5,RELATIVE_TO_3D_TILE:6},$e=Object.freeze(By);function Ru(e){return e===By.CLAMP_TO_GROUND||e===By.CLAMP_TO_3D_TILE||e===By.CLAMP_TO_TERRAIN}function Lx(e){return e===By.RELATIVE_TO_GROUND||e===By.RELATIVE_TO_3D_TILE||e===By.RELATIVE_TO_TERRAIN}var iSe={CENTER:0,LEFT:1,RIGHT:-1},bi=Object.freeze(iSe);var oSe={CENTER:0,BOTTOM:1,BASELINE:2,TOP:-1},Ln=Object.freeze(oSe);var rSe={DONE:0,PENDING:1,FAILED:2},ct=Object.freeze(rSe);function Vf(){E.throwInstantiationError()}Object.defineProperties(Vf.prototype,{isConstant:{get:E.throwInstantiationError},definitionChanged:{get:E.throwInstantiationError}});Vf.prototype.getValue=E.throwInstantiationError;Vf.prototype.equals=E.throwInstantiationError;Vf.equals=function(e,t){return e===t||c(e)&&e.equals(t)};Vf.arrayEquals=function(e,t){if(e===t)return!0;if(!c(e)||!c(t)||e.length!==t.length)return!1;let n=e.length;for(let i=0;i<n;i++)if(!Vf.equals(e[i],t[i]))return!1;return!0};Vf.isConstant=function(e){return!c(e)||e.isConstant};Vf.getValueOrUndefined=function(e,t,n){return c(e)?e.getValue(t,n):void 0};Vf.getValueOrDefault=function(e,t,n,i){return c(e)?y(e.getValue(t,i),n):n};Vf.getValueOrClonedDefault=function(e,t,n,i){let o;return c(e)&&(o=e.getValue(t,i)),c(o)||(o=n.clone(o)),o};var X=Vf;var sSe={LEFT:-1,NONE:0,RIGHT:1},$r=Object.freeze(sSe);var aSe=j.WHITE,cSe=h.ZERO,lSe=$e.NONE,uSe=H.ZERO,fSe=1,dSe=0,hSe=h.ZERO,mSe=bi.CENTER,pSe=Ln.CENTER,_Se=!1,gSe=$r.NONE,ySe=new h,bSe=new j,xSe=new h,TSe=new H,ASe=new Vt,CSe=new Vt,ESe=new Vt,SSe=new Ke,wSe=new Bt;function qZ(e){this.entity=e,this.billboard=void 0,this.textureValue=void 0}function x_(e,t){if(!c(e))throw new E("entityCluster is required.");if(!c(t))throw new E("entityCollection is required.");t.collectionChanged.addEventListener(x_.prototype._onCollectionChanged,this),this._cluster=e,this._entityCollection=t,this._items=new St,this._onCollectionChanged(t,t.values,[],[])}x_.prototype.update=function(e){if(!c(e))throw new E("time is required.");let t=this._items.values,n=this._cluster;for(let i=0,o=t.length;i<o;i++){let r=t[i],s=r.entity,a=s._billboard,l,u=r.billboard,f=s.isShowing&&s.isAvailable(e)&&X.getValueOrDefault(a._show,e,!0),d;if(f&&(d=X.getValueOrUndefined(s._position,e,ySe),l=X.getValueOrUndefined(a._image,e),f=c(d)&&c(l)),!f){W2(r,s,n);continue}X.isConstant(s._position)||(n._clusterDirty=!0),c(u)||(u=n.getBillboard(s),u.id=s,u.image=void 0,r.billboard=u),u.show=f,(!c(u.image)||r.textureValue!==l)&&(u.image=l,r.textureValue=l),u.position=d,u.color=X.getValueOrDefault(a._color,e,aSe,bSe),u.eyeOffset=X.getValueOrDefault(a._eyeOffset,e,cSe,xSe),u.heightReference=X.getValueOrDefault(a._heightReference,e,lSe),u.pixelOffset=X.getValueOrDefault(a._pixelOffset,e,uSe,TSe),u.scale=X.getValueOrDefault(a._scale,e,fSe),u.rotation=X.getValueOrDefault(a._rotation,e,dSe),u.alignedAxis=X.getValueOrDefault(a._alignedAxis,e,hSe),u.horizontalOrigin=X.getValueOrDefault(a._horizontalOrigin,e,mSe),u.verticalOrigin=X.getValueOrDefault(a._verticalOrigin,e,pSe),u.width=X.getValueOrUndefined(a._width,e),u.height=X.getValueOrUndefined(a._height,e),u.scaleByDistance=X.getValueOrUndefined(a._scaleByDistance,e,ASe),u.translucencyByDistance=X.getValueOrUndefined(a._translucencyByDistance,e,CSe),u.pixelOffsetScaleByDistance=X.getValueOrUndefined(a._pixelOffsetScaleByDistance,e,ESe),u.sizeInMeters=X.getValueOrDefault(a._sizeInMeters,e,_Se),u.distanceDisplayCondition=X.getValueOrUndefined(a._distanceDisplayCondition,e,wSe),u.disableDepthTestDistance=X.getValueOrUndefined(a._disableDepthTestDistance,e),u.splitDirection=X.getValueOrDefault(a._splitDirection,e,gSe);let p=X.getValueOrUndefined(a._imageSubRegion,e,SSe);c(p)&&u.setImageSubRegion(u._imageId,p)}return!0};x_.prototype.getBoundingSphere=function(e,t){if(!c(e))throw new E("entity is required.");if(!c(t))throw new E("result is required.");let n=this._items.get(e.id);if(!c(n)||!c(n.billboard))return ct.FAILED;let i=n.billboard;if(i.heightReference===$e.NONE)t.center=h.clone(i.position,t.center);else{if(!c(i._clampedPosition))return ct.PENDING;t.center=h.clone(i._clampedPosition,t.center)}return t.radius=0,ct.DONE};x_.prototype.isDestroyed=function(){return!1};x_.prototype.destroy=function(){this._entityCollection.collectionChanged.removeEventListener(x_.prototype._onCollectionChanged,this);let e=this._entityCollection.values;for(let t=0;t<e.length;t++)this._cluster.removeBillboard(e[t]);return de(this)};x_.prototype._onCollectionChanged=function(e,t,n,i){let o,r,s=this._items,a=this._cluster;for(o=t.length-1;o>-1;o--)r=t[o],c(r._billboard)&&c(r._position)&&s.set(r.id,new qZ(r));for(o=i.length-1;o>-1;o--)r=i[o],c(r._billboard)&&c(r._position)?s.contains(r.id)||s.set(r.id,new qZ(r)):(W2(s.get(r.id),r,a),s.remove(r.id));for(o=n.length-1;o>-1;o--)r=n[o],W2(s.get(r.id),r,a),s.remove(r.id)};function W2(e,t,n){c(e)&&(e.billboard=void 0,n.removeBillboard(t))}var q2=x_;function vSe(e,t){this.start=y(e,0),this.stop=y(t,0)}var lc=vSe;function dn(e,t){this.center=h.clone(y(e,h.ZERO)),this.radius=y(t,0)}var K2=new h,$2=new h,Z2=new h,J2=new h,Q2=new h,eB=new h,tB=new h,Gs=new h,nB=new h,iB=new h,oB=new h,rB=new h,DSe=4/3*R.PI;dn.fromPoints=function(e,t){if(c(t)||(t=new dn),!c(e)||e.length===0)return t.center=h.clone(h.ZERO,t.center),t.radius=0,t;let n=h.clone(e[0],tB),i=h.clone(n,K2),o=h.clone(n,$2),r=h.clone(n,Z2),s=h.clone(n,J2),a=h.clone(n,Q2),l=h.clone(n,eB),u=e.length,f;for(f=1;f<u;f++){h.clone(e[f],n);let M=n.x,N=n.y,B=n.z;M<i.x&&h.clone(n,i),M>s.x&&h.clone(n,s),N<o.y&&h.clone(n,o),N>a.y&&h.clone(n,a),B<r.z&&h.clone(n,r),B>l.z&&h.clone(n,l)}let d=h.magnitudeSquared(h.subtract(s,i,Gs)),p=h.magnitudeSquared(h.subtract(a,o,Gs)),g=h.magnitudeSquared(h.subtract(l,r,Gs)),m=i,b=s,x=d;p>x&&(x=p,m=o,b=a),g>x&&(x=g,m=r,b=l);let T=nB;T.x=(m.x+b.x)*.5,T.y=(m.y+b.y)*.5,T.z=(m.z+b.z)*.5;let C=h.magnitudeSquared(h.subtract(b,T,Gs)),S=Math.sqrt(C),v=iB;v.x=i.x,v.y=o.y,v.z=r.z;let D=oB;D.x=s.x,D.y=a.y,D.z=l.z;let I=h.midpoint(v,D,rB),L=0;for(f=0;f<u;f++){h.clone(e[f],n);let M=h.magnitude(h.subtract(n,I,Gs));M>L&&(L=M);let N=h.magnitudeSquared(h.subtract(n,T,Gs));if(N>C){let B=Math.sqrt(N);S=(S+B)*.5,C=S*S;let _=B-S;T.x=(S*T.x+_*n.x)/B,T.y=(S*T.y+_*n.y)/B,T.z=(S*T.z+_*n.z)/B}}return S<L?(h.clone(T,t.center),t.radius=S):(h.clone(I,t.center),t.radius=L),t};var YZ=new Mi,PSe=new h,ISe=new h,Y2=new he,X2=new he;dn.fromRectangle2D=function(e,t,n){return dn.fromRectangleWithHeights2D(e,t,0,0,n)};dn.fromRectangleWithHeights2D=function(e,t,n,i,o){if(c(o)||(o=new dn),!c(e))return o.center=h.clone(h.ZERO,o.center),o.radius=0,o;YZ._ellipsoid=ie.default,t=y(t,YZ),ae.southwest(e,Y2),Y2.height=n,ae.northeast(e,X2),X2.height=i;let r=t.project(Y2,PSe),s=t.project(X2,ISe),a=s.x-r.x,l=s.y-r.y,u=s.z-r.z;o.radius=Math.sqrt(a*a+l*l+u*u)*.5;let f=o.center;return f.x=r.x+a*.5,f.y=r.y+l*.5,f.z=r.z+u*.5,o};var OSe=[];dn.fromRectangle3D=function(e,t,n,i){if(t=y(t,ie.default),n=y(n,0),c(i)||(i=new dn),!c(e))return i.center=h.clone(h.ZERO,i.center),i.radius=0,i;let o=ae.subsample(e,t,n,OSe);return dn.fromPoints(o,i)};dn.fromVertices=function(e,t,n,i){if(c(i)||(i=new dn),!c(e)||e.length===0)return i.center=h.clone(h.ZERO,i.center),i.radius=0,i;t=y(t,h.ZERO),n=y(n,3),A.typeOf.number.greaterThanOrEquals("stride",n,3);let o=tB;o.x=e[0]+t.x,o.y=e[1]+t.y,o.z=e[2]+t.z;let r=h.clone(o,K2),s=h.clone(o,$2),a=h.clone(o,Z2),l=h.clone(o,J2),u=h.clone(o,Q2),f=h.clone(o,eB),d=e.length,p;for(p=0;p<d;p+=n){let B=e[p]+t.x,_=e[p+1]+t.y,w=e[p+2]+t.z;o.x=B,o.y=_,o.z=w,B<r.x&&h.clone(o,r),B>l.x&&h.clone(o,l),_<s.y&&h.clone(o,s),_>u.y&&h.clone(o,u),w<a.z&&h.clone(o,a),w>f.z&&h.clone(o,f)}let g=h.magnitudeSquared(h.subtract(l,r,Gs)),m=h.magnitudeSquared(h.subtract(u,s,Gs)),b=h.magnitudeSquared(h.subtract(f,a,Gs)),x=r,T=l,C=g;m>C&&(C=m,x=s,T=u),b>C&&(C=b,x=a,T=f);let S=nB;S.x=(x.x+T.x)*.5,S.y=(x.y+T.y)*.5,S.z=(x.z+T.z)*.5;let v=h.magnitudeSquared(h.subtract(T,S,Gs)),D=Math.sqrt(v),I=iB;I.x=r.x,I.y=s.y,I.z=a.z;let L=oB;L.x=l.x,L.y=u.y,L.z=f.z;let M=h.midpoint(I,L,rB),N=0;for(p=0;p<d;p+=n){o.x=e[p]+t.x,o.y=e[p+1]+t.y,o.z=e[p+2]+t.z;let B=h.magnitude(h.subtract(o,M,Gs));B>N&&(N=B);let _=h.magnitudeSquared(h.subtract(o,S,Gs));if(_>v){let w=Math.sqrt(_);D=(D+w)*.5,v=D*D;let P=w-D;S.x=(D*S.x+P*o.x)/w,S.y=(D*S.y+P*o.y)/w,S.z=(D*S.z+P*o.z)/w}}return D<N?(h.clone(S,i.center),i.radius=D):(h.clone(M,i.center),i.radius=N),i};dn.fromEncodedCartesianVertices=function(e,t,n){if(c(n)||(n=new dn),!c(e)||!c(t)||e.length!==t.length||e.length===0)return n.center=h.clone(h.ZERO,n.center),n.radius=0,n;let i=tB;i.x=e[0]+t[0],i.y=e[1]+t[1],i.z=e[2]+t[2];let o=h.clone(i,K2),r=h.clone(i,$2),s=h.clone(i,Z2),a=h.clone(i,J2),l=h.clone(i,Q2),u=h.clone(i,eB),f=e.length,d;for(d=0;d<f;d+=3){let N=e[d]+t[d],B=e[d+1]+t[d+1],_=e[d+2]+t[d+2];i.x=N,i.y=B,i.z=_,N<o.x&&h.clone(i,o),N>a.x&&h.clone(i,a),B<r.y&&h.clone(i,r),B>l.y&&h.clone(i,l),_<s.z&&h.clone(i,s),_>u.z&&h.clone(i,u)}let p=h.magnitudeSquared(h.subtract(a,o,Gs)),g=h.magnitudeSquared(h.subtract(l,r,Gs)),m=h.magnitudeSquared(h.subtract(u,s,Gs)),b=o,x=a,T=p;g>T&&(T=g,b=r,x=l),m>T&&(T=m,b=s,x=u);let C=nB;C.x=(b.x+x.x)*.5,C.y=(b.y+x.y)*.5,C.z=(b.z+x.z)*.5;let S=h.magnitudeSquared(h.subtract(x,C,Gs)),v=Math.sqrt(S),D=iB;D.x=o.x,D.y=r.y,D.z=s.z;let I=oB;I.x=a.x,I.y=l.y,I.z=u.z;let L=h.midpoint(D,I,rB),M=0;for(d=0;d<f;d+=3){i.x=e[d]+t[d],i.y=e[d+1]+t[d+1],i.z=e[d+2]+t[d+2];let N=h.magnitude(h.subtract(i,L,Gs));N>M&&(M=N);let B=h.magnitudeSquared(h.subtract(i,C,Gs));if(B>S){let _=Math.sqrt(B);v=(v+_)*.5,S=v*v;let w=_-v;C.x=(v*C.x+w*i.x)/_,C.y=(v*C.y+w*i.y)/_,C.z=(v*C.z+w*i.z)/_}}return v<M?(h.clone(C,n.center),n.radius=v):(h.clone(L,n.center),n.radius=M),n};dn.fromCornerPoints=function(e,t,n){A.typeOf.object("corner",e),A.typeOf.object("oppositeCorner",t),c(n)||(n=new dn);let i=h.midpoint(e,t,n.center);return n.radius=h.distance(i,t),n};dn.fromEllipsoid=function(e,t){return A.typeOf.object("ellipsoid",e),c(t)||(t=new dn),h.clone(h.ZERO,t.center),t.radius=e.maximumRadius,t};var RSe=new h;dn.fromBoundingSpheres=function(e,t){if(c(t)||(t=new dn),!c(e)||e.length===0)return t.center=h.clone(h.ZERO,t.center),t.radius=0,t;let n=e.length;if(n===1)return dn.clone(e[0],t);if(n===2)return dn.union(e[0],e[1],t);let i=[],o;for(o=0;o<n;o++)i.push(e[o].center);t=dn.fromPoints(i,t);let r=t.center,s=t.radius;for(o=0;o<n;o++){let a=e[o];s=Math.max(s,h.distance(r,a.center,RSe)+a.radius)}return t.radius=s,t};var MSe=new h,LSe=new h,NSe=new h;dn.fromOrientedBoundingBox=function(e,t){A.defined("orientedBoundingBox",e),c(t)||(t=new dn);let n=e.halfAxes,i=Q.getColumn(n,0,MSe),o=Q.getColumn(n,1,LSe),r=Q.getColumn(n,2,NSe);return h.add(i,o,i),h.add(i,r,i),t.center=h.clone(e.center,t.center),t.radius=h.magnitude(i),t};var FSe=new h,BSe=new h;dn.fromTransformation=function(e,t){A.typeOf.object("transformation",e),c(t)||(t=new dn);let n=k.getTranslation(e,FSe),i=k.getScale(e,BSe),o=.5*h.magnitude(i);return t.center=h.clone(n,t.center),t.radius=o,t};dn.clone=function(e,t){if(c(e))return c(t)?(t.center=h.clone(e.center,t.center),t.radius=e.radius,t):new dn(e.center,e.radius)};dn.packedLength=4;dn.pack=function(e,t,n){A.typeOf.object("value",e),A.defined("array",t),n=y(n,0);let i=e.center;return t[n++]=i.x,t[n++]=i.y,t[n++]=i.z,t[n]=e.radius,t};dn.unpack=function(e,t,n){A.defined("array",e),t=y(t,0),c(n)||(n=new dn);let i=n.center;return i.x=e[t++],i.y=e[t++],i.z=e[t++],n.radius=e[t],n};var kSe=new h,VSe=new h;dn.union=function(e,t,n){A.typeOf.object("left",e),A.typeOf.object("right",t),c(n)||(n=new dn);let i=e.center,o=e.radius,r=t.center,s=t.radius,a=h.subtract(r,i,kSe),l=h.magnitude(a);if(o>=l+s)return e.clone(n),n;if(s>=l+o)return t.clone(n),n;let u=(o+l+s)*.5,f=h.multiplyByScalar(a,(-o+u)/l,VSe);return h.add(f,i,f),h.clone(f,n.center),n.radius=u,n};var USe=new h;dn.expand=function(e,t,n){A.typeOf.object("sphere",e),A.typeOf.object("point",t),n=dn.clone(e,n);let i=h.magnitude(h.subtract(t,n.center,USe));return i>n.radius&&(n.radius=i),n};dn.intersectPlane=function(e,t){A.typeOf.object("sphere",e),A.typeOf.object("plane",t);let n=e.center,i=e.radius,o=t.normal,r=h.dot(o,n)+t.distance;return r<-i?qt.OUTSIDE:r<i?qt.INTERSECTING:qt.INSIDE};dn.transform=function(e,t,n){return A.typeOf.object("sphere",e),A.typeOf.object("transform",t),c(n)||(n=new dn),n.center=k.multiplyByPoint(t,e.center,n.center),n.radius=k.getMaximumScale(t)*e.radius,n};var zSe=new h;dn.distanceSquaredTo=function(e,t){A.typeOf.object("sphere",e),A.typeOf.object("cartesian",t);let n=h.subtract(e.center,t,zSe),i=h.magnitude(n)-e.radius;return i<=0?0:i*i};dn.transformWithoutScale=function(e,t,n){return A.typeOf.object("sphere",e),A.typeOf.object("transform",t),c(n)||(n=new dn),n.center=k.multiplyByPoint(t,e.center,n.center),n.radius=e.radius,n};var HSe=new h;dn.computePlaneDistances=function(e,t,n,i){A.typeOf.object("sphere",e),A.typeOf.object("position",t),A.typeOf.object("direction",n),c(i)||(i=new lc);let o=h.subtract(e.center,t,HSe),r=h.dot(n,o);return i.start=r-e.radius,i.stop=r+e.radius,i};var XZ=new h,GSe=new h,jSe=new h,WSe=new h,qSe=new h,YSe=new he,$Z=new Array(8);for(let e=0;e<8;++e)$Z[e]=new h;var KZ=new Mi;dn.projectTo2D=function(e,t,n){A.typeOf.object("sphere",e),KZ._ellipsoid=ie.default,t=y(t,KZ);let i=t.ellipsoid,o=e.center,r=e.radius,s;h.equals(o,h.ZERO)?s=h.clone(h.UNIT_X,XZ):s=i.geodeticSurfaceNormal(o,XZ);let a=h.cross(h.UNIT_Z,s,GSe);h.normalize(a,a);let l=h.cross(s,a,jSe);h.normalize(l,l),h.multiplyByScalar(s,r,s),h.multiplyByScalar(l,r,l),h.multiplyByScalar(a,r,a);let u=h.negate(l,qSe),f=h.negate(a,WSe),d=$Z,p=d[0];h.add(s,l,p),h.add(p,a,p),p=d[1],h.add(s,l,p),h.add(p,f,p),p=d[2],h.add(s,u,p),h.add(p,f,p),p=d[3],h.add(s,u,p),h.add(p,a,p),h.negate(s,s),p=d[4],h.add(s,l,p),h.add(p,a,p),p=d[5],h.add(s,l,p),h.add(p,f,p),p=d[6],h.add(s,u,p),h.add(p,f,p),p=d[7],h.add(s,u,p),h.add(p,a,p);let g=d.length;for(let T=0;T<g;++T){let C=d[T];h.add(o,C,C);let S=i.cartesianToCartographic(C,YSe);t.project(S,C)}n=dn.fromPoints(d,n),o=n.center;let m=o.x,b=o.y,x=o.z;return o.x=x,o.y=m,o.z=b,n};dn.isOccluded=function(e,t){return A.typeOf.object("sphere",e),A.typeOf.object("occluder",t),!t.isBoundingSphereVisible(e)};dn.equals=function(e,t){return e===t||c(e)&&c(t)&&h.equals(e.center,t.center)&&e.radius===t.radius};dn.prototype.intersectPlane=function(e){return dn.intersectPlane(this,e)};dn.prototype.distanceSquaredTo=function(e){return dn.distanceSquaredTo(this,e)};dn.prototype.computePlaneDistances=function(e,t,n){return dn.computePlaneDistances(this,e,t,n)};dn.prototype.isOccluded=function(e){return dn.isOccluded(this,e)};dn.prototype.equals=function(e){return dn.equals(this,e)};dn.prototype.clone=function(e){return dn.clone(this,e)};dn.prototype.volume=function(){let e=this.radius;return DSe*e*e*e};var ce=dn;var XSe={DEPTH_BUFFER_BIT:256,STENCIL_BUFFER_BIT:1024,COLOR_BUFFER_BIT:16384,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,ZERO:0,ONE:1,SRC_COLOR:768,ONE_MINUS_SRC_COLOR:769,SRC_ALPHA:770,ONE_MINUS_SRC_ALPHA:771,DST_ALPHA:772,ONE_MINUS_DST_ALPHA:773,DST_COLOR:774,ONE_MINUS_DST_COLOR:775,SRC_ALPHA_SATURATE:776,FUNC_ADD:32774,BLEND_EQUATION:32777,BLEND_EQUATION_RGB:32777,BLEND_EQUATION_ALPHA:34877,FUNC_SUBTRACT:32778,FUNC_REVERSE_SUBTRACT:32779,BLEND_DST_RGB:32968,BLEND_SRC_RGB:32969,BLEND_DST_ALPHA:32970,BLEND_SRC_ALPHA:32971,CONSTANT_COLOR:32769,ONE_MINUS_CONSTANT_COLOR:32770,CONSTANT_ALPHA:32771,ONE_MINUS_CONSTANT_ALPHA:32772,BLEND_COLOR:32773,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,ARRAY_BUFFER_BINDING:34964,ELEMENT_ARRAY_BUFFER_BINDING:34965,STREAM_DRAW:35040,STATIC_DRAW:35044,DYNAMIC_DRAW:35048,BUFFER_SIZE:34660,BUFFER_USAGE:34661,CURRENT_VERTEX_ATTRIB:34342,FRONT:1028,BACK:1029,FRONT_AND_BACK:1032,CULL_FACE:2884,BLEND:3042,DITHER:3024,STENCIL_TEST:2960,DEPTH_TEST:2929,SCISSOR_TEST:3089,POLYGON_OFFSET_FILL:32823,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_COVERAGE:32928,NO_ERROR:0,INVALID_ENUM:1280,INVALID_VALUE:1281,INVALID_OPERATION:1282,OUT_OF_MEMORY:1285,CW:2304,CCW:2305,LINE_WIDTH:2849,ALIASED_POINT_SIZE_RANGE:33901,ALIASED_LINE_WIDTH_RANGE:33902,CULL_FACE_MODE:2885,FRONT_FACE:2886,DEPTH_RANGE:2928,DEPTH_WRITEMASK:2930,DEPTH_CLEAR_VALUE:2931,DEPTH_FUNC:2932,STENCIL_CLEAR_VALUE:2961,STENCIL_FUNC:2962,STENCIL_FAIL:2964,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STENCIL_BACK_FUNC:34816,STENCIL_BACK_FAIL:34817,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,VIEWPORT:2978,SCISSOR_BOX:3088,COLOR_CLEAR_VALUE:3106,COLOR_WRITEMASK:3107,UNPACK_ALIGNMENT:3317,PACK_ALIGNMENT:3333,MAX_TEXTURE_SIZE:3379,MAX_VIEWPORT_DIMS:3386,SUBPIXEL_BITS:3408,RED_BITS:3410,GREEN_BITS:3411,BLUE_BITS:3412,ALPHA_BITS:3413,DEPTH_BITS:3414,STENCIL_BITS:3415,POLYGON_OFFSET_UNITS:10752,POLYGON_OFFSET_FACTOR:32824,TEXTURE_BINDING_2D:32873,SAMPLE_BUFFERS:32936,SAMPLES:32937,SAMPLE_COVERAGE_VALUE:32938,SAMPLE_COVERAGE_INVERT:32939,COMPRESSED_TEXTURE_FORMATS:34467,DONT_CARE:4352,FASTEST:4353,NICEST:4354,GENERATE_MIPMAP_HINT:33170,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DEPTH_COMPONENT:6402,ALPHA:6406,RGB:6407,RGBA:6408,LUMINANCE:6409,LUMINANCE_ALPHA:6410,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,FRAGMENT_SHADER:35632,VERTEX_SHADER:35633,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VARYING_VECTORS:36348,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_FRAGMENT_UNIFORM_VECTORS:36349,SHADER_TYPE:35663,DELETE_STATUS:35712,LINK_STATUS:35714,VALIDATE_STATUS:35715,ATTACHED_SHADERS:35717,ACTIVE_UNIFORMS:35718,ACTIVE_ATTRIBUTES:35721,SHADING_LANGUAGE_VERSION:35724,CURRENT_PROGRAM:35725,NEVER:512,LESS:513,EQUAL:514,LEQUAL:515,GREATER:516,NOTEQUAL:517,GEQUAL:518,ALWAYS:519,KEEP:7680,REPLACE:7681,INCR:7682,DECR:7683,INVERT:5386,INCR_WRAP:34055,DECR_WRAP:34056,VENDOR:7936,RENDERER:7937,VERSION:7938,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TEXTURE_2D:3553,TEXTURE:5890,TEXTURE_CUBE_MAP:34067,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,MAX_CUBE_MAP_TEXTURE_SIZE:34076,TEXTURE0:33984,TEXTURE1:33985,TEXTURE2:33986,TEXTURE3:33987,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE30:34014,TEXTURE31:34015,ACTIVE_TEXTURE:34016,REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,SAMPLER_2D:35678,SAMPLER_CUBE:35680,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,IMPLEMENTATION_COLOR_READ_TYPE:35738,IMPLEMENTATION_COLOR_READ_FORMAT:35739,COMPILE_STATUS:35713,LOW_FLOAT:36336,MEDIUM_FLOAT:36337,HIGH_FLOAT:36338,LOW_INT:36339,MEDIUM_INT:36340,HIGH_INT:36341,FRAMEBUFFER:36160,RENDERBUFFER:36161,RGBA4:32854,RGB5_A1:32855,RGB565:36194,DEPTH_COMPONENT16:33189,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,DEPTH_STENCIL:34041,RENDERBUFFER_WIDTH:36162,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_STENCIL_SIZE:36181,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,COLOR_ATTACHMENT0:36064,DEPTH_ATTACHMENT:36096,STENCIL_ATTACHMENT:36128,DEPTH_STENCIL_ATTACHMENT:33306,NONE:0,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_UNSUPPORTED:36061,FRAMEBUFFER_BINDING:36006,RENDERBUFFER_BINDING:36007,MAX_RENDERBUFFER_SIZE:34024,INVALID_FRAMEBUFFER_OPERATION:1286,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGBA_ASTC_4x4_WEBGL:37808,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGBA_BPTC_UNORM:36492,HALF_FLOAT_OES:36193,DOUBLE:5130,READ_BUFFER:3074,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_ROWS:3315,UNPACK_SKIP_PIXELS:3316,PACK_ROW_LENGTH:3330,PACK_SKIP_ROWS:3331,PACK_SKIP_PIXELS:3332,COLOR:6144,DEPTH:6145,STENCIL:6146,RED:6403,RGB8:32849,RGBA8:32856,RGB10_A2:32857,TEXTURE_BINDING_3D:32874,UNPACK_SKIP_IMAGES:32877,UNPACK_IMAGE_HEIGHT:32878,TEXTURE_3D:32879,TEXTURE_WRAP_R:32882,MAX_3D_TEXTURE_SIZE:32883,UNSIGNED_INT_2_10_10_10_REV:33640,MAX_ELEMENTS_VERTICES:33e3,MAX_ELEMENTS_INDICES:33001,TEXTURE_MIN_LOD:33082,TEXTURE_MAX_LOD:33083,TEXTURE_BASE_LEVEL:33084,TEXTURE_MAX_LEVEL:33085,MIN:32775,MAX:32776,DEPTH_COMPONENT24:33190,MAX_TEXTURE_LOD_BIAS:34045,TEXTURE_COMPARE_MODE:34892,TEXTURE_COMPARE_FUNC:34893,CURRENT_QUERY:34917,QUERY_RESULT:34918,QUERY_RESULT_AVAILABLE:34919,STREAM_READ:35041,STREAM_COPY:35042,STATIC_READ:35045,STATIC_COPY:35046,DYNAMIC_READ:35049,DYNAMIC_COPY:35050,MAX_DRAW_BUFFERS:34852,DRAW_BUFFER0:34853,DRAW_BUFFER1:34854,DRAW_BUFFER2:34855,DRAW_BUFFER3:34856,DRAW_BUFFER4:34857,DRAW_BUFFER5:34858,DRAW_BUFFER6:34859,DRAW_BUFFER7:34860,DRAW_BUFFER8:34861,DRAW_BUFFER9:34862,DRAW_BUFFER10:34863,DRAW_BUFFER11:34864,DRAW_BUFFER12:34865,DRAW_BUFFER13:34866,DRAW_BUFFER14:34867,DRAW_BUFFER15:34868,MAX_FRAGMENT_UNIFORM_COMPONENTS:35657,MAX_VERTEX_UNIFORM_COMPONENTS:35658,SAMPLER_3D:35679,SAMPLER_2D_SHADOW:35682,FRAGMENT_SHADER_DERIVATIVE_HINT:35723,PIXEL_PACK_BUFFER:35051,PIXEL_UNPACK_BUFFER:35052,PIXEL_PACK_BUFFER_BINDING:35053,PIXEL_UNPACK_BUFFER_BINDING:35055,FLOAT_MAT2x3:35685,FLOAT_MAT2x4:35686,FLOAT_MAT3x2:35687,FLOAT_MAT3x4:35688,FLOAT_MAT4x2:35689,FLOAT_MAT4x3:35690,SRGB:35904,SRGB8:35905,SRGB8_ALPHA8:35907,COMPARE_REF_TO_TEXTURE:34894,RGBA32F:34836,RGB32F:34837,RGBA16F:34842,RGB16F:34843,VERTEX_ATTRIB_ARRAY_INTEGER:35069,MAX_ARRAY_TEXTURE_LAYERS:35071,MIN_PROGRAM_TEXEL_OFFSET:35076,MAX_PROGRAM_TEXEL_OFFSET:35077,MAX_VARYING_COMPONENTS:35659,TEXTURE_2D_ARRAY:35866,TEXTURE_BINDING_2D_ARRAY:35869,R11F_G11F_B10F:35898,UNSIGNED_INT_10F_11F_11F_REV:35899,RGB9_E5:35901,UNSIGNED_INT_5_9_9_9_REV:35902,TRANSFORM_FEEDBACK_BUFFER_MODE:35967,MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS:35968,TRANSFORM_FEEDBACK_VARYINGS:35971,TRANSFORM_FEEDBACK_BUFFER_START:35972,TRANSFORM_FEEDBACK_BUFFER_SIZE:35973,TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN:35976,RASTERIZER_DISCARD:35977,MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS:35978,MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS:35979,INTERLEAVED_ATTRIBS:35980,SEPARATE_ATTRIBS:35981,TRANSFORM_FEEDBACK_BUFFER:35982,TRANSFORM_FEEDBACK_BUFFER_BINDING:35983,RGBA32UI:36208,RGB32UI:36209,RGBA16UI:36214,RGB16UI:36215,RGBA8UI:36220,RGB8UI:36221,RGBA32I:36226,RGB32I:36227,RGBA16I:36232,RGB16I:36233,RGBA8I:36238,RGB8I:36239,RED_INTEGER:36244,RGB_INTEGER:36248,RGBA_INTEGER:36249,SAMPLER_2D_ARRAY:36289,SAMPLER_2D_ARRAY_SHADOW:36292,SAMPLER_CUBE_SHADOW:36293,UNSIGNED_INT_VEC2:36294,UNSIGNED_INT_VEC3:36295,UNSIGNED_INT_VEC4:36296,INT_SAMPLER_2D:36298,INT_SAMPLER_3D:36299,INT_SAMPLER_CUBE:36300,INT_SAMPLER_2D_ARRAY:36303,UNSIGNED_INT_SAMPLER_2D:36306,UNSIGNED_INT_SAMPLER_3D:36307,UNSIGNED_INT_SAMPLER_CUBE:36308,UNSIGNED_INT_SAMPLER_2D_ARRAY:36311,DEPTH_COMPONENT32F:36012,DEPTH32F_STENCIL8:36013,FLOAT_32_UNSIGNED_INT_24_8_REV:36269,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE:33297,FRAMEBUFFER_ATTACHMENT_RED_SIZE:33298,FRAMEBUFFER_ATTACHMENT_GREEN_SIZE:33299,FRAMEBUFFER_ATTACHMENT_BLUE_SIZE:33300,FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE:33301,FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE:33302,FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE:33303,FRAMEBUFFER_DEFAULT:33304,UNSIGNED_INT_24_8:34042,DEPTH24_STENCIL8:35056,UNSIGNED_NORMALIZED:35863,DRAW_FRAMEBUFFER_BINDING:36006,READ_FRAMEBUFFER:36008,DRAW_FRAMEBUFFER:36009,READ_FRAMEBUFFER_BINDING:36010,RENDERBUFFER_SAMPLES:36011,FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER:36052,MAX_COLOR_ATTACHMENTS:36063,COLOR_ATTACHMENT1:36065,COLOR_ATTACHMENT2:36066,COLOR_ATTACHMENT3:36067,COLOR_ATTACHMENT4:36068,COLOR_ATTACHMENT5:36069,COLOR_ATTACHMENT6:36070,COLOR_ATTACHMENT7:36071,COLOR_ATTACHMENT8:36072,COLOR_ATTACHMENT9:36073,COLOR_ATTACHMENT10:36074,COLOR_ATTACHMENT11:36075,COLOR_ATTACHMENT12:36076,COLOR_ATTACHMENT13:36077,COLOR_ATTACHMENT14:36078,COLOR_ATTACHMENT15:36079,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:36182,MAX_SAMPLES:36183,HALF_FLOAT:5131,RG:33319,RG_INTEGER:33320,R8:33321,RG8:33323,R16F:33325,R32F:33326,RG16F:33327,RG32F:33328,R8I:33329,R8UI:33330,R16I:33331,R16UI:33332,R32I:33333,R32UI:33334,RG8I:33335,RG8UI:33336,RG16I:33337,RG16UI:33338,RG32I:33339,RG32UI:33340,VERTEX_ARRAY_BINDING:34229,R8_SNORM:36756,RG8_SNORM:36757,RGB8_SNORM:36758,RGBA8_SNORM:36759,SIGNED_NORMALIZED:36764,COPY_READ_BUFFER:36662,COPY_WRITE_BUFFER:36663,COPY_READ_BUFFER_BINDING:36662,COPY_WRITE_BUFFER_BINDING:36663,UNIFORM_BUFFER:35345,UNIFORM_BUFFER_BINDING:35368,UNIFORM_BUFFER_START:35369,UNIFORM_BUFFER_SIZE:35370,MAX_VERTEX_UNIFORM_BLOCKS:35371,MAX_FRAGMENT_UNIFORM_BLOCKS:35373,MAX_COMBINED_UNIFORM_BLOCKS:35374,MAX_UNIFORM_BUFFER_BINDINGS:35375,MAX_UNIFORM_BLOCK_SIZE:35376,MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS:35377,MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS:35379,UNIFORM_BUFFER_OFFSET_ALIGNMENT:35380,ACTIVE_UNIFORM_BLOCKS:35382,UNIFORM_TYPE:35383,UNIFORM_SIZE:35384,UNIFORM_BLOCK_INDEX:35386,UNIFORM_OFFSET:35387,UNIFORM_ARRAY_STRIDE:35388,UNIFORM_MATRIX_STRIDE:35389,UNIFORM_IS_ROW_MAJOR:35390,UNIFORM_BLOCK_BINDING:35391,UNIFORM_BLOCK_DATA_SIZE:35392,UNIFORM_BLOCK_ACTIVE_UNIFORMS:35394,UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES:35395,UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER:35396,UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER:35398,INVALID_INDEX:4294967295,MAX_VERTEX_OUTPUT_COMPONENTS:37154,MAX_FRAGMENT_INPUT_COMPONENTS:37157,MAX_SERVER_WAIT_TIMEOUT:37137,OBJECT_TYPE:37138,SYNC_CONDITION:37139,SYNC_STATUS:37140,SYNC_FLAGS:37141,SYNC_FENCE:37142,SYNC_GPU_COMMANDS_COMPLETE:37143,UNSIGNALED:37144,SIGNALED:37145,ALREADY_SIGNALED:37146,TIMEOUT_EXPIRED:37147,CONDITION_SATISFIED:37148,WAIT_FAILED:37149,SYNC_FLUSH_COMMANDS_BIT:1,VERTEX_ATTRIB_ARRAY_DIVISOR:35070,ANY_SAMPLES_PASSED:35887,ANY_SAMPLES_PASSED_CONSERVATIVE:36202,SAMPLER_BINDING:35097,RGB10_A2UI:36975,INT_2_10_10_10_REV:36255,TRANSFORM_FEEDBACK:36386,TRANSFORM_FEEDBACK_PAUSED:36387,TRANSFORM_FEEDBACK_ACTIVE:36388,TRANSFORM_FEEDBACK_BINDING:36389,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_SRGB8_ETC2:37493,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37494,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37495,COMPRESSED_RGBA8_ETC2_EAC:37496,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37497,TEXTURE_IMMUTABLE_FORMAT:37167,MAX_ELEMENT_INDEX:36203,TEXTURE_IMMUTABLE_LEVELS:33503,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047},ne=Object.freeze(XSe);var An={BYTE:ne.BYTE,UNSIGNED_BYTE:ne.UNSIGNED_BYTE,SHORT:ne.SHORT,UNSIGNED_SHORT:ne.UNSIGNED_SHORT,INT:ne.INT,UNSIGNED_INT:ne.UNSIGNED_INT,FLOAT:ne.FLOAT,DOUBLE:ne.DOUBLE};An.getSizeInBytes=function(e){if(!c(e))throw new E("value is required.");switch(e){case An.BYTE:return Int8Array.BYTES_PER_ELEMENT;case An.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case An.SHORT:return Int16Array.BYTES_PER_ELEMENT;case An.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case An.INT:return Int32Array.BYTES_PER_ELEMENT;case An.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT;case An.FLOAT:return Float32Array.BYTES_PER_ELEMENT;case An.DOUBLE:return Float64Array.BYTES_PER_ELEMENT;default:throw new E("componentDatatype is not a valid value.")}};An.fromTypedArray=function(e){if(e instanceof Int8Array)return An.BYTE;if(e instanceof Uint8Array)return An.UNSIGNED_BYTE;if(e instanceof Int16Array)return An.SHORT;if(e instanceof Uint16Array)return An.UNSIGNED_SHORT;if(e instanceof Int32Array)return An.INT;if(e instanceof Uint32Array)return An.UNSIGNED_INT;if(e instanceof Float32Array)return An.FLOAT;if(e instanceof Float64Array)return An.DOUBLE;throw new E("array must be an Int8Array, Uint8Array, Int16Array, Uint16Array, Int32Array, Uint32Array, Float32Array, or Float64Array.")};An.validate=function(e){return c(e)&&(e===An.BYTE||e===An.UNSIGNED_BYTE||e===An.SHORT||e===An.UNSIGNED_SHORT||e===An.INT||e===An.UNSIGNED_INT||e===An.FLOAT||e===An.DOUBLE)};An.createTypedArray=function(e,t){if(!c(e))throw new E("componentDatatype is required.");if(!c(t))throw new E("valuesOrLength is required.");switch(e){case An.BYTE:return new Int8Array(t);case An.UNSIGNED_BYTE:return new Uint8Array(t);case An.SHORT:return new Int16Array(t);case An.UNSIGNED_SHORT:return new Uint16Array(t);case An.INT:return new Int32Array(t);case An.UNSIGNED_INT:return new Uint32Array(t);case An.FLOAT:return new Float32Array(t);case An.DOUBLE:return new Float64Array(t);default:throw new E("componentDatatype is not a valid value.")}};An.createArrayBufferView=function(e,t,n,i){if(!c(e))throw new E("componentDatatype is required.");if(!c(t))throw new E("buffer is required.");switch(n=y(n,0),i=y(i,(t.byteLength-n)/An.getSizeInBytes(e)),e){case An.BYTE:return new Int8Array(t,n,i);case An.UNSIGNED_BYTE:return new Uint8Array(t,n,i);case An.SHORT:return new Int16Array(t,n,i);case An.UNSIGNED_SHORT:return new Uint16Array(t,n,i);case An.INT:return new Int32Array(t,n,i);case An.UNSIGNED_INT:return new Uint32Array(t,n,i);case An.FLOAT:return new Float32Array(t,n,i);case An.DOUBLE:return new Float64Array(t,n,i);default:throw new E("componentDatatype is not a valid value.")}};An.fromName=function(e){switch(e){case"BYTE":return An.BYTE;case"UNSIGNED_BYTE":return An.UNSIGNED_BYTE;case"SHORT":return An.SHORT;case"UNSIGNED_SHORT":return An.UNSIGNED_SHORT;case"INT":return An.INT;case"UNSIGNED_INT":return An.UNSIGNED_INT;case"FLOAT":return An.FLOAT;case"DOUBLE":return An.DOUBLE;default:throw new E("name is not a valid value.")}};var $=Object.freeze(An);var KSe={NONE:0,TRIANGLES:1,LINES:2,POLYLINES:3},th=Object.freeze(KSe);function Kt(e,t,n,i){this[0]=y(e,0),this[1]=y(n,0),this[2]=y(t,0),this[3]=y(i,0)}Kt.packedLength=4;Kt.pack=function(e,t,n){return A.typeOf.object("value",e),A.defined("array",t),n=y(n,0),t[n++]=e[0],t[n++]=e[1],t[n++]=e[2],t[n++]=e[3],t};Kt.unpack=function(e,t,n){return A.defined("array",e),t=y(t,0),c(n)||(n=new Kt),n[0]=e[t++],n[1]=e[t++],n[2]=e[t++],n[3]=e[t++],n};Kt.packArray=function(e,t){A.defined("array",e);let n=e.length,i=n*4;if(!c(t))t=new Array(i);else{if(!Array.isArray(t)&&t.length!==i)throw new E("If result is a typed array, it must have exactly array.length * 4 elements");t.length!==i&&(t.length=i)}for(let o=0;o<n;++o)Kt.pack(e[o],t,o*4);return t};Kt.unpackArray=function(e,t){if(A.defined("array",e),A.typeOf.number.greaterThanOrEquals("array.length",e.length,4),e.length%4!==0)throw new E("array length must be a multiple of 4.");let n=e.length;c(t)?t.length=n/4:t=new Array(n/4);for(let i=0;i<n;i+=4){let o=i/4;t[o]=Kt.unpack(e,i,t[o])}return t};Kt.clone=function(e,t){if(c(e))return c(t)?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t):new Kt(e[0],e[2],e[1],e[3])};Kt.fromArray=Kt.unpack;Kt.fromColumnMajorArray=function(e,t){return A.defined("values",e),Kt.clone(e,t)};Kt.fromRowMajorArray=function(e,t){return A.defined("values",e),c(t)?(t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3],t):new Kt(e[0],e[1],e[2],e[3])};Kt.fromScale=function(e,t){return A.typeOf.object("scale",e),c(t)?(t[0]=e.x,t[1]=0,t[2]=0,t[3]=e.y,t):new Kt(e.x,0,0,e.y)};Kt.fromUniformScale=function(e,t){return A.typeOf.number("scale",e),c(t)?(t[0]=e,t[1]=0,t[2]=0,t[3]=e,t):new Kt(e,0,0,e)};Kt.fromRotation=function(e,t){A.typeOf.number("angle",e);let n=Math.cos(e),i=Math.sin(e);return c(t)?(t[0]=n,t[1]=i,t[2]=-i,t[3]=n,t):new Kt(n,-i,i,n)};Kt.toArray=function(e,t){return A.typeOf.object("matrix",e),c(t)?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t):[e[0],e[1],e[2],e[3]]};Kt.getElementIndex=function(e,t){return A.typeOf.number.greaterThanOrEquals("row",t,0),A.typeOf.number.lessThanOrEquals("row",t,1),A.typeOf.number.greaterThanOrEquals("column",e,0),A.typeOf.number.lessThanOrEquals("column",e,1),e*2+t};Kt.getColumn=function(e,t,n){A.typeOf.object("matrix",e),A.typeOf.number.greaterThanOrEquals("index",t,0),A.typeOf.number.lessThanOrEquals("index",t,1),A.typeOf.object("result",n);let i=t*2,o=e[i],r=e[i+1];return n.x=o,n.y=r,n};Kt.setColumn=function(e,t,n,i){A.typeOf.object("matrix",e),A.typeOf.number.greaterThanOrEquals("index",t,0),A.typeOf.number.lessThanOrEquals("index",t,1),A.typeOf.object("cartesian",n),A.typeOf.object("result",i),i=Kt.clone(e,i);let o=t*2;return i[o]=n.x,i[o+1]=n.y,i};Kt.getRow=function(e,t,n){A.typeOf.object("matrix",e),A.typeOf.number.greaterThanOrEquals("index",t,0),A.typeOf.number.lessThanOrEquals("index",t,1),A.typeOf.object("result",n);let i=e[t],o=e[t+2];return n.x=i,n.y=o,n};Kt.setRow=function(e,t,n,i){return A.typeOf.object("matrix",e),A.typeOf.number.greaterThanOrEquals("index",t,0),A.typeOf.number.lessThanOrEquals("index",t,1),A.typeOf.object("cartesian",n),A.typeOf.object("result",i),i=Kt.clone(e,i),i[t]=n.x,i[t+2]=n.y,i};var $Se=new H;Kt.setScale=function(e,t,n){A.typeOf.object("matrix",e),A.typeOf.object("scale",t),A.typeOf.object("result",n);let i=Kt.getScale(e,$Se),o=t.x/i.x,r=t.y/i.y;return n[0]=e[0]*o,n[1]=e[1]*o,n[2]=e[2]*r,n[3]=e[3]*r,n};var ZSe=new H;Kt.setUniformScale=function(e,t,n){A.typeOf.object("matrix",e),A.typeOf.number("scale",t),A.typeOf.object("result",n);let i=Kt.getScale(e,ZSe),o=t/i.x,r=t/i.y;return n[0]=e[0]*o,n[1]=e[1]*o,n[2]=e[2]*r,n[3]=e[3]*r,n};var ZZ=new H;Kt.getScale=function(e,t){return A.typeOf.object("matrix",e),A.typeOf.object("result",t),t.x=H.magnitude(H.fromElements(e[0],e[1],ZZ)),t.y=H.magnitude(H.fromElements(e[2],e[3],ZZ)),t};var JZ=new H;Kt.getMaximumScale=function(e){return Kt.getScale(e,JZ),H.maximumComponent(JZ)};var JSe=new H;Kt.setRotation=function(e,t,n){A.typeOf.object("matrix",e),A.typeOf.object("result",n);let i=Kt.getScale(e,JSe);return n[0]=t[0]*i.x,n[1]=t[1]*i.x,n[2]=t[2]*i.y,n[3]=t[3]*i.y,n};var QSe=new H;Kt.getRotation=function(e,t){A.typeOf.object("matrix",e),A.typeOf.object("result",t);let n=Kt.getScale(e,QSe);return t[0]=e[0]/n.x,t[1]=e[1]/n.x,t[2]=e[2]/n.y,t[3]=e[3]/n.y,t};Kt.multiply=function(e,t,n){A.typeOf.object("left",e),A.typeOf.object("right",t),A.typeOf.object("result",n);let i=e[0]*t[0]+e[2]*t[1],o=e[0]*t[2]+e[2]*t[3],r=e[1]*t[0]+e[3]*t[1],s=e[1]*t[2]+e[3]*t[3];return n[0]=i,n[1]=r,n[2]=o,n[3]=s,n};Kt.add=function(e,t,n){return A.typeOf.object("left",e),A.typeOf.object("right",t),A.typeOf.object("result",n),n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n[3]=e[3]+t[3],n};Kt.subtract=function(e,t,n){return A.typeOf.object("left",e),A.typeOf.object("right",t),A.typeOf.object("result",n),n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n[3]=e[3]-t[3],n};Kt.multiplyByVector=function(e,t,n){A.typeOf.object("matrix",e),A.typeOf.object("cartesian",t),A.typeOf.object("result",n);let i=e[0]*t.x+e[2]*t.y,o=e[1]*t.x+e[3]*t.y;return n.x=i,n.y=o,n};Kt.multiplyByScalar=function(e,t,n){return A.typeOf.object("matrix",e),A.typeOf.number("scalar",t),A.typeOf.object("result",n),n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n[3]=e[3]*t,n};Kt.multiplyByScale=function(e,t,n){return A.typeOf.object("matrix",e),A.typeOf.object("scale",t),A.typeOf.object("result",n),n[0]=e[0]*t.x,n[1]=e[1]*t.x,n[2]=e[2]*t.y,n[3]=e[3]*t.y,n};Kt.multiplyByUniformScale=function(e,t,n){return A.typeOf.object("matrix",e),A.typeOf.number("scale",t),A.typeOf.object("result",n),n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n[3]=e[3]*t,n};Kt.negate=function(e,t){return A.typeOf.object("matrix",e),A.typeOf.object("result",t),t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t};Kt.transpose=function(e,t){A.typeOf.object("matrix",e),A.typeOf.object("result",t);let n=e[0],i=e[2],o=e[1],r=e[3];return t[0]=n,t[1]=i,t[2]=o,t[3]=r,t};Kt.abs=function(e,t){return A.typeOf.object("matrix",e),A.typeOf.object("result",t),t[0]=Math.abs(e[0]),t[1]=Math.abs(e[1]),t[2]=Math.abs(e[2]),t[3]=Math.abs(e[3]),t};Kt.equals=function(e,t){return e===t||c(e)&&c(t)&&e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]};Kt.equalsArray=function(e,t,n){return e[0]===t[n]&&e[1]===t[n+1]&&e[2]===t[n+2]&&e[3]===t[n+3]};Kt.equalsEpsilon=function(e,t,n){return n=y(n,0),e===t||c(e)&&c(t)&&Math.abs(e[0]-t[0])<=n&&Math.abs(e[1]-t[1])<=n&&Math.abs(e[2]-t[2])<=n&&Math.abs(e[3]-t[3])<=n};Kt.IDENTITY=Object.freeze(new Kt(1,0,0,1));Kt.ZERO=Object.freeze(new Kt(0,0,0,0));Kt.COLUMN0ROW0=0;Kt.COLUMN0ROW1=1;Kt.COLUMN1ROW0=2;Kt.COLUMN1ROW1=3;Object.defineProperties(Kt.prototype,{length:{get:function(){return Kt.packedLength}}});Kt.prototype.clone=function(e){return Kt.clone(this,e)};Kt.prototype.equals=function(e){return Kt.equals(this,e)};Kt.prototype.equalsEpsilon=function(e,t){return Kt.equalsEpsilon(this,e,t)};Kt.prototype.toString=function(){return`(${this[0]}, ${this[2]})
(${this[1]}, ${this[3]})`};var Gi=Kt;var ca={POINTS:ne.POINTS,LINES:ne.LINES,LINE_LOOP:ne.LINE_LOOP,LINE_STRIP:ne.LINE_STRIP,TRIANGLES:ne.TRIANGLES,TRIANGLE_STRIP:ne.TRIANGLE_STRIP,TRIANGLE_FAN:ne.TRIANGLE_FAN};ca.isLines=function(e){return e===ca.LINES||e===ca.LINE_LOOP||e===ca.LINE_STRIP};ca.isTriangles=function(e){return e===ca.TRIANGLES||e===ca.TRIANGLE_STRIP||e===ca.TRIANGLE_FAN};ca.validate=function(e){return e===ca.POINTS||e===ca.LINES||e===ca.LINE_LOOP||e===ca.LINE_STRIP||e===ca.TRIANGLES||e===ca.TRIANGLE_STRIP||e===ca.TRIANGLE_FAN};var Me=Object.freeze(ca);function sB(e){e=y(e,y.EMPTY_OBJECT),A.typeOf.object("options.attributes",e.attributes),this.attributes=e.attributes,this.indices=e.indices,this.primitiveType=y(e.primitiveType,Me.TRIANGLES),this.boundingSphere=e.boundingSphere,this.geometryType=y(e.geometryType,th.NONE),this.boundingSphereCV=e.boundingSphereCV,this.offsetAttribute=e.offsetAttribute}sB.computeNumberOfVertices=function(e){A.typeOf.object("geometry",e);let t=-1;for(let n in e.attributes)if(e.attributes.hasOwnProperty(n)&&c(e.attributes[n])&&c(e.attributes[n].values)){let i=e.attributes[n],o=i.values.length/i.componentsPerAttribute;if(t!==o&&t!==-1)throw new E("All attribute lists must have the same number of attributes.");t=o}return t};var ewe=new he,twe=new h,QZ=new k,nwe=[new he,new he,new he],iwe=[new H,new H,new H],owe=[new H,new H,new H],rwe=new h,swe=new Ne,awe=new k,cwe=new Gi;sB._textureCoordinateRotationPoints=function(e,t,n,i){let o,r=ae.center(i,ewe),s=he.toCartesian(r,n,twe),a=Ft.eastNorthUpToFixedFrame(s,n,QZ),l=k.inverse(a,QZ),u=iwe,f=nwe;f[0].longitude=i.west,f[0].latitude=i.south,f[1].longitude=i.west,f[1].latitude=i.north,f[2].longitude=i.east,f[2].latitude=i.south;let d=rwe;for(o=0;o<3;o++)he.toCartesian(f[o],n,d),d=k.multiplyByPointAsVector(l,d,d),u[o].x=d.x,u[o].y=d.y;let p=Ne.fromAxisAngle(h.UNIT_Z,-t,swe),g=Q.fromQuaternion(p,awe),m=e.length,b=Number.POSITIVE_INFINITY,x=Number.POSITIVE_INFINITY,T=Number.NEGATIVE_INFINITY,C=Number.NEGATIVE_INFINITY;for(o=0;o<m;o++)d=k.multiplyByPointAsVector(l,e[o],d),d=Q.multiplyByVector(g,d,d),b=Math.min(b,d.x),x=Math.min(x,d.y),T=Math.max(T,d.x),C=Math.max(C,d.y);let S=Gi.fromRotation(t,cwe),v=owe;v[0].x=b,v[0].y=x,v[1].x=b,v[1].y=C,v[2].x=T,v[2].y=x;let D=u[0],I=u[2].x-D.x,L=u[1].y-D.y;for(o=0;o<3;o++){let w=v[o];Gi.multiplyByVector(S,w,w),w.x=(w.x-D.x)/I,w.y=(w.y-D.y)/L}let M=v[0],N=v[1],B=v[2],_=new Array(6);return H.pack(M,_),H.pack(N,_,2),H.pack(B,_,4),_};var ut=sB;function lwe(e){if(e=y(e,y.EMPTY_OBJECT),!c(e.componentDatatype))throw new E("options.componentDatatype is required.");if(!c(e.componentsPerAttribute))throw new E("options.componentsPerAttribute is required.");if(e.componentsPerAttribute<1||e.componentsPerAttribute>4)throw new E("options.componentsPerAttribute must be between 1 and 4.");if(!c(e.values))throw new E("options.values is required.");this.componentDatatype=e.componentDatatype,this.componentsPerAttribute=e.componentsPerAttribute,this.normalize=y(e.normalize,!1),this.values=e.values}var we=lwe;function uwe(e){e=y(e,y.EMPTY_OBJECT),this.position=e.position,this.normal=e.normal,this.st=e.st,this.bitangent=e.bitangent,this.tangent=e.tangent,this.color=e.color}var pn=uwe;var fwe={NONE:0,TOP:1,ALL:2},Jt=Object.freeze(fwe);function Zr(e){e=y(e,y.EMPTY_OBJECT),this.position=y(e.position,!1),this.normal=y(e.normal,!1),this.st=y(e.st,!1),this.bitangent=y(e.bitangent,!1),this.tangent=y(e.tangent,!1),this.color=y(e.color,!1)}Zr.POSITION_ONLY=Object.freeze(new Zr({position:!0}));Zr.POSITION_AND_NORMAL=Object.freeze(new Zr({position:!0,normal:!0}));Zr.POSITION_NORMAL_AND_ST=Object.freeze(new Zr({position:!0,normal:!0,st:!0}));Zr.POSITION_AND_ST=Object.freeze(new Zr({position:!0,st:!0}));Zr.POSITION_AND_COLOR=Object.freeze(new Zr({position:!0,color:!0}));Zr.ALL=Object.freeze(new Zr({position:!0,normal:!0,st:!0,tangent:!0,bitangent:!0}));Zr.DEFAULT=Zr.POSITION_NORMAL_AND_ST;Zr.packedLength=6;Zr.pack=function(e,t,n){if(!c(e))throw new E("value is required");if(!c(t))throw new E("array is required");return n=y(n,0),t[n++]=e.position?1:0,t[n++]=e.normal?1:0,t[n++]=e.st?1:0,t[n++]=e.tangent?1:0,t[n++]=e.bitangent?1:0,t[n]=e.color?1:0,t};Zr.unpack=function(e,t,n){if(!c(e))throw new E("array is required");return t=y(t,0),c(n)||(n=new Zr),n.position=e[t++]===1,n.normal=e[t++]===1,n.st=e[t++]===1,n.tangent=e[t++]===1,n.bitangent=e[t++]===1,n.color=e[t]===1,n};Zr.clone=function(e,t){if(c(e))return c(t)||(t=new Zr),t.position=e.position,t.normal=e.normal,t.st=e.st,t.tangent=e.tangent,t.bitangent=e.bitangent,t.color=e.color,t};var Ie=Zr;var dwe=new h;function Ol(e){e=y(e,y.EMPTY_OBJECT);let t=e.minimum,n=e.maximum;if(A.typeOf.object("min",t),A.typeOf.object("max",n),c(e.offsetAttribute)&&e.offsetAttribute===Jt.TOP)throw new E("GeometryOffsetAttribute.TOP is not a supported options.offsetAttribute for this geometry.");let i=y(e.vertexFormat,Ie.DEFAULT);this._minimum=h.clone(t),this._maximum=h.clone(n),this._vertexFormat=i,this._offsetAttribute=e.offsetAttribute,this._workerName="createBoxGeometry"}Ol.fromDimensions=function(e){e=y(e,y.EMPTY_OBJECT);let t=e.dimensions;A.typeOf.object("dimensions",t),A.typeOf.number.greaterThanOrEquals("dimensions.x",t.x,0),A.typeOf.number.greaterThanOrEquals("dimensions.y",t.y,0),A.typeOf.number.greaterThanOrEquals("dimensions.z",t.z,0);let n=h.multiplyByScalar(t,.5,new h);return new Ol({minimum:h.negate(n,new h),maximum:n,vertexFormat:e.vertexFormat,offsetAttribute:e.offsetAttribute})};Ol.fromAxisAlignedBoundingBox=function(e){return A.typeOf.object("boundingBox",e),new Ol({minimum:e.minimum,maximum:e.maximum})};Ol.packedLength=2*h.packedLength+Ie.packedLength+1;Ol.pack=function(e,t,n){return A.typeOf.object("value",e),A.defined("array",t),n=y(n,0),h.pack(e._minimum,t,n),h.pack(e._maximum,t,n+h.packedLength),Ie.pack(e._vertexFormat,t,n+2*h.packedLength),t[n+2*h.packedLength+Ie.packedLength]=y(e._offsetAttribute,-1),t};var tJ=new h,nJ=new h,iJ=new Ie,eJ={minimum:tJ,maximum:nJ,vertexFormat:iJ,offsetAttribute:void 0};Ol.unpack=function(e,t,n){A.defined("array",e),t=y(t,0);let i=h.unpack(e,t,tJ),o=h.unpack(e,t+h.packedLength,nJ),r=Ie.unpack(e,t+2*h.packedLength,iJ),s=e[t+2*h.packedLength+Ie.packedLength];return c(n)?(n._minimum=h.clone(i,n._minimum),n._maximum=h.clone(o,n._maximum),n._vertexFormat=Ie.clone(r,n._vertexFormat),n._offsetAttribute=s===-1?void 0:s,n):(eJ.offsetAttribute=s===-1?void 0:s,new Ol(eJ))};Ol.createGeometry=function(e){let t=e._minimum,n=e._maximum,i=e._vertexFormat;if(h.equals(t,n))return;let o=new pn,r,s;if(i.position&&(i.st||i.normal||i.tangent||i.bitangent)){if(i.position&&(s=new Float64Array(6*4*3),s[0]=t.x,s[1]=t.y,s[2]=n.z,s[3]=n.x,s[4]=t.y,s[5]=n.z,s[6]=n.x,s[7]=n.y,s[8]=n.z,s[9]=t.x,s[10]=n.y,s[11]=n.z,s[12]=t.x,s[13]=t.y,s[14]=t.z,s[15]=n.x,s[16]=t.y,s[17]=t.z,s[18]=n.x,s[19]=n.y,s[20]=t.z,s[21]=t.x,s[22]=n.y,s[23]=t.z,s[24]=n.x,s[25]=t.y,s[26]=t.z,s[27]=n.x,s[28]=n.y,s[29]=t.z,s[30]=n.x,s[31]=n.y,s[32]=n.z,s[33]=n.x,s[34]=t.y,s[35]=n.z,s[36]=t.x,s[37]=t.y,s[38]=t.z,s[39]=t.x,s[40]=n.y,s[41]=t.z,s[42]=t.x,s[43]=n.y,s[44]=n.z,s[45]=t.x,s[46]=t.y,s[47]=n.z,s[48]=t.x,s[49]=n.y,s[50]=t.z,s[51]=n.x,s[52]=n.y,s[53]=t.z,s[54]=n.x,s[55]=n.y,s[56]=n.z,s[57]=t.x,s[58]=n.y,s[59]=n.z,s[60]=t.x,s[61]=t.y,s[62]=t.z,s[63]=n.x,s[64]=t.y,s[65]=t.z,s[66]=n.x,s[67]=t.y,s[68]=n.z,s[69]=t.x,s[70]=t.y,s[71]=n.z,o.position=new we({componentDatatype:$.DOUBLE,componentsPerAttribute:3,values:s})),i.normal){let u=new Float32Array(72);u[0]=0,u[1]=0,u[2]=1,u[3]=0,u[4]=0,u[5]=1,u[6]=0,u[7]=0,u[8]=1,u[9]=0,u[10]=0,u[11]=1,u[12]=0,u[13]=0,u[14]=-1,u[15]=0,u[16]=0,u[17]=-1,u[18]=0,u[19]=0,u[20]=-1,u[21]=0,u[22]=0,u[23]=-1,u[24]=1,u[25]=0,u[26]=0,u[27]=1,u[28]=0,u[29]=0,u[30]=1,u[31]=0,u[32]=0,u[33]=1,u[34]=0,u[35]=0,u[36]=-1,u[37]=0,u[38]=0,u[39]=-1,u[40]=0,u[41]=0,u[42]=-1,u[43]=0,u[44]=0,u[45]=-1,u[46]=0,u[47]=0,u[48]=0,u[49]=1,u[50]=0,u[51]=0,u[52]=1,u[53]=0,u[54]=0,u[55]=1,u[56]=0,u[57]=0,u[58]=1,u[59]=0,u[60]=0,u[61]=-1,u[62]=0,u[63]=0,u[64]=-1,u[65]=0,u[66]=0,u[67]=-1,u[68]=0,u[69]=0,u[70]=-1,u[71]=0,o.normal=new we({componentDatatype:$.FLOAT,componentsPerAttribute:3,values:u})}if(i.st){let u=new Float32Array(48);u[0]=0,u[1]=0,u[2]=1,u[3]=0,u[4]=1,u[5]=1,u[6]=0,u[7]=1,u[8]=1,u[9]=0,u[10]=0,u[11]=0,u[12]=0,u[13]=1,u[14]=1,u[15]=1,u[16]=0,u[17]=0,u[18]=1,u[19]=0,u[20]=1,u[21]=1,u[22]=0,u[23]=1,u[24]=1,u[25]=0,u[26]=0,u[27]=0,u[28]=0,u[29]=1,u[30]=1,u[31]=1,u[32]=1,u[33]=0,u[34]=0,u[35]=0,u[36]=0,u[37]=1,u[38]=1,u[39]=1,u[40]=0,u[41]=0,u[42]=1,u[43]=0,u[44]=1,u[45]=1,u[46]=0,u[47]=1,o.st=new we({componentDatatype:$.FLOAT,componentsPerAttribute:2,values:u})}if(i.tangent){let u=new Float32Array(72);u[0]=1,u[1]=0,u[2]=0,u[3]=1,u[4]=0,u[5]=0,u[6]=1,u[7]=0,u[8]=0,u[9]=1,u[10]=0,u[11]=0,u[12]=-1,u[13]=0,u[14]=0,u[15]=-1,u[16]=0,u[17]=0,u[18]=-1,u[19]=0,u[20]=0,u[21]=-1,u[22]=0,u[23]=0,u[24]=0,u[25]=1,u[26]=0,u[27]=0,u[28]=1,u[29]=0,u[30]=0,u[31]=1,u[32]=0,u[33]=0,u[34]=1,u[35]=0,u[36]=0,u[37]=-1,u[38]=0,u[39]=0,u[40]=-1,u[41]=0,u[42]=0,u[43]=-1,u[44]=0,u[45]=0,u[46]=-1,u[47]=0,u[48]=-1,u[49]=0,u[50]=0,u[51]=-1,u[52]=0,u[53]=0,u[54]=-1,u[55]=0,u[56]=0,u[57]=-1,u[58]=0,u[59]=0,u[60]=1,u[61]=0,u[62]=0,u[63]=1,u[64]=0,u[65]=0,u[66]=1,u[67]=0,u[68]=0,u[69]=1,u[70]=0,u[71]=0,o.tangent=new we({componentDatatype:$.FLOAT,componentsPerAttribute:3,values:u})}if(i.bitangent){let u=new Float32Array(72);u[0]=0,u[1]=1,u[2]=0,u[3]=0,u[4]=1,u[5]=0,u[6]=0,u[7]=1,u[8]=0,u[9]=0,u[10]=1,u[11]=0,u[12]=0,u[13]=1,u[14]=0,u[15]=0,u[16]=1,u[17]=0,u[18]=0,u[19]=1,u[20]=0,u[21]=0,u[22]=1,u[23]=0,u[24]=0,u[25]=0,u[26]=1,u[27]=0,u[28]=0,u[29]=1,u[30]=0,u[31]=0,u[32]=1,u[33]=0,u[34]=0,u[35]=1,u[36]=0,u[37]=0,u[38]=1,u[39]=0,u[40]=0,u[41]=1,u[42]=0,u[43]=0,u[44]=1,u[45]=0,u[46]=0,u[47]=1,u[48]=0,u[49]=0,u[50]=1,u[51]=0,u[52]=0,u[53]=1,u[54]=0,u[55]=0,u[56]=1,u[57]=0,u[58]=0,u[59]=1,u[60]=0,u[61]=0,u[62]=1,u[63]=0,u[64]=0,u[65]=1,u[66]=0,u[67]=0,u[68]=1,u[69]=0,u[70]=0,u[71]=1,o.bitangent=new we({componentDatatype:$.FLOAT,componentsPerAttribute:3,values:u})}r=new Uint16Array(6*2*3),r[0]=0,r[1]=1,r[2]=2,r[3]=0,r[4]=2,r[5]=3,r[6]=6,r[7]=5,r[8]=4,r[9]=7,r[10]=6,r[11]=4,r[12]=8,r[13]=9,r[14]=10,r[15]=8,r[16]=10,r[17]=11,r[18]=14,r[19]=13,r[20]=12,r[21]=15,r[22]=14,r[23]=12,r[24]=18,r[25]=17,r[26]=16,r[27]=19,r[28]=18,r[29]=16,r[30]=20,r[31]=21,r[32]=22,r[33]=20,r[34]=22,r[35]=23}else s=new Float64Array(8*3),s[0]=t.x,s[1]=t.y,s[2]=t.z,s[3]=n.x,s[4]=t.y,s[5]=t.z,s[6]=n.x,s[7]=n.y,s[8]=t.z,s[9]=t.x,s[10]=n.y,s[11]=t.z,s[12]=t.x,s[13]=t.y,s[14]=n.z,s[15]=n.x,s[16]=t.y,s[17]=n.z,s[18]=n.x,s[19]=n.y,s[20]=n.z,s[21]=t.x,s[22]=n.y,s[23]=n.z,o.position=new we({componentDatatype:$.DOUBLE,componentsPerAttribute:3,values:s}),r=new Uint16Array(6*2*3),r[0]=4,r[1]=5,r[2]=6,r[3]=4,r[4]=6,r[5]=7,r[6]=1,r[7]=0,r[8]=3,r[9]=1,r[10]=3,r[11]=2,r[12]=1,r[13]=6,r[14]=5,r[15]=1,r[16]=2,r[17]=6,r[18]=2,r[19]=3,r[20]=7,r[21]=2,r[22]=7,r[23]=6,r[24]=3,r[25]=0,r[26]=4,r[27]=3,r[28]=4,r[29]=7,r[30]=0,r[31]=1,r[32]=5,r[33]=0,r[34]=5,r[35]=4;let a=h.subtract(n,t,dwe),l=h.magnitude(a)*.5;if(c(e._offsetAttribute)){let u=s.length,f=e._offsetAttribute===Jt.NONE?0:1,d=new Uint8Array(u/3).fill(f);o.applyOffset=new we({componentDatatype:$.UNSIGNED_BYTE,componentsPerAttribute:1,values:d})}return new ut({attributes:o,indices:r,primitiveType:Me.TRIANGLES,boundingSphere:new ce(h.ZERO,l),offsetAttribute:e._offsetAttribute})};var aB;Ol.getUnitBox=function(){return c(aB)||(aB=Ol.createGeometry(Ol.fromDimensions({dimensions:new h(1,1,1),vertexFormat:Ie.POSITION_ONLY}))),aB};var uc=Ol;var hwe=new h;function nh(e){e=y(e,y.EMPTY_OBJECT);let t=e.minimum,n=e.maximum;if(A.typeOf.object("min",t),A.typeOf.object("max",n),c(e.offsetAttribute)&&e.offsetAttribute===Jt.TOP)throw new E("GeometryOffsetAttribute.TOP is not a supported options.offsetAttribute for this geometry.");this._min=h.clone(t),this._max=h.clone(n),this._offsetAttribute=e.offsetAttribute,this._workerName="createBoxOutlineGeometry"}nh.fromDimensions=function(e){e=y(e,y.EMPTY_OBJECT);let t=e.dimensions;A.typeOf.object("dimensions",t),A.typeOf.number.greaterThanOrEquals("dimensions.x",t.x,0),A.typeOf.number.greaterThanOrEquals("dimensions.y",t.y,0),A.typeOf.number.greaterThanOrEquals("dimensions.z",t.z,0);let n=h.multiplyByScalar(t,.5,new h);return new nh({minimum:h.negate(n,new h),maximum:n,offsetAttribute:e.offsetAttribute})};nh.fromAxisAlignedBoundingBox=function(e){return A.typeOf.object("boundindBox",e),new nh({minimum:e.minimum,maximum:e.maximum})};nh.packedLength=2*h.packedLength+1;nh.pack=function(e,t,n){return A.typeOf.object("value",e),A.defined("array",t),n=y(n,0),h.pack(e._min,t,n),h.pack(e._max,t,n+h.packedLength),t[n+h.packedLength*2]=y(e._offsetAttribute,-1),t};var rJ=new h,sJ=new h,oJ={minimum:rJ,maximum:sJ,offsetAttribute:void 0};nh.unpack=function(e,t,n){A.defined("array",e),t=y(t,0);let i=h.unpack(e,t,rJ),o=h.unpack(e,t+h.packedLength,sJ),r=e[t+h.packedLength*2];return c(n)?(n._min=h.clone(i,n._min),n._max=h.clone(o,n._max),n._offsetAttribute=r===-1?void 0:r,n):(oJ.offsetAttribute=r===-1?void 0:r,new nh(oJ))};nh.createGeometry=function(e){let t=e._min,n=e._max;if(h.equals(t,n))return;let i=new pn,o=new Uint16Array(12*2),r=new Float64Array(8*3);r[0]=t.x,r[1]=t.y,r[2]=t.z,r[3]=n.x,r[4]=t.y,r[5]=t.z,r[6]=n.x,r[7]=n.y,r[8]=t.z,r[9]=t.x,r[10]=n.y,r[11]=t.z,r[12]=t.x,r[13]=t.y,r[14]=n.z,r[15]=n.x,r[16]=t.y,r[17]=n.z,r[18]=n.x,r[19]=n.y,r[20]=n.z,r[21]=t.x,r[22]=n.y,r[23]=n.z,i.position=new we({componentDatatype:$.DOUBLE,componentsPerAttribute:3,values:r}),o[0]=4,o[1]=5,o[2]=5,o[3]=6,o[4]=6,o[5]=7,o[6]=7,o[7]=4,o[8]=0,o[9]=1,o[10]=1,o[11]=2,o[12]=2,o[13]=3,o[14]=3,o[15]=0,o[16]=0,o[17]=4,o[18]=1,o[19]=5,o[20]=2,o[21]=6,o[22]=3,o[23]=7;let s=h.subtract(n,t,hwe),a=h.magnitude(s)*.5;if(c(e._offsetAttribute)){let l=r.length,u=e._offsetAttribute===Jt.NONE?0:1,f=new Uint8Array(l/3).fill(u);i.applyOffset=new we({componentDatatype:$.UNSIGNED_BYTE,componentsPerAttribute:1,values:f})}return new ut({attributes:i,indices:o,primitiveType:Me.LINES,boundingSphere:new ce(h.ZERO,a),offsetAttribute:e._offsetAttribute})};var Sm=nh;function Nx(e,t,n,i){e=y(e,1),t=y(t,1),n=y(n,1),i=y(i,1),this.value=new Uint8Array([j.floatToByte(e),j.floatToByte(t),j.floatToByte(n),j.floatToByte(i)])}Object.defineProperties(Nx.prototype,{componentDatatype:{get:function(){return $.UNSIGNED_BYTE}},componentsPerAttribute:{get:function(){return 4}},normalize:{get:function(){return!0}}});Nx.fromColor=function(e){if(!c(e))throw new E("color is required.");return new Nx(e.red,e.green,e.blue,e.alpha)};Nx.toValue=function(e,t){if(!c(e))throw new E("color is required.");return c(t)?e.toBytes(t):new Uint8Array(e.toBytes())};Nx.equals=function(e,t){return e===t||c(e)&&c(t)&&e.value[0]===t.value[0]&&e.value[1]===t.value[1]&&e.value[2]===t.value[2]&&e.value[3]===t.value[3]};var Wt=Nx;function xE(e,t){if(e=y(e,0),t=y(t,Number.MAX_VALUE),t<=e)throw new E("far distance must be greater than near distance.");this.value=new Float32Array([e,t])}Object.defineProperties(xE.prototype,{componentDatatype:{get:function(){return $.FLOAT}},componentsPerAttribute:{get:function(){return 2}},normalize:{get:function(){return!1}}});xE.fromDistanceDisplayCondition=function(e){if(!c(e))throw new E("distanceDisplayCondition is required.");if(e.far<=e.near)throw new E("distanceDisplayCondition.far distance must be greater than distanceDisplayCondition.near distance.");return new xE(e.near,e.far)};xE.toValue=function(e,t){if(!c(e))throw new E("distanceDisplayCondition is required.");return c(t)?(t[0]=e.near,t[1]=e.far,t):new Float32Array([e.near,e.far])};var kn=xE;function mwe(e){if(e=y(e,y.EMPTY_OBJECT),!c(e.geometry))throw new E("options.geometry is required.");this.geometry=e.geometry,this.modelMatrix=k.clone(y(e.modelMatrix,k.IDENTITY)),this.id=e.id,this.pickPrimitive=e.pickPrimitive,this.attributes=y(e.attributes,{}),this.westHemisphereGeometry=void 0,this.eastHemisphereGeometry=void 0}var vt=mwe;function Vo(e){e=y(e,y.EMPTY_OBJECT),this.start=c(e.start)?J.clone(e.start):new J,this.stop=c(e.stop)?J.clone(e.stop):new J,this.data=e.data,this.isStartIncluded=y(e.isStartIncluded,!0),this.isStopIncluded=y(e.isStopIncluded,!0)}Object.defineProperties(Vo.prototype,{isEmpty:{get:function(){let e=J.compare(this.stop,this.start);return e<0||e===0&&(!this.isStartIncluded||!this.isStopIncluded)}}});var Fx={start:void 0,stop:void 0,isStartIncluded:void 0,isStopIncluded:void 0,data:void 0};Vo.fromIso8601=function(e,t){A.typeOf.object("options",e),A.typeOf.string("options.iso8601",e.iso8601);let n=e.iso8601.split("/");if(n.length!==2)throw new E("options.iso8601 is an invalid ISO 8601 interval.");let i=J.fromIso8601(n[0]),o=J.fromIso8601(n[1]),r=y(e.isStartIncluded,!0),s=y(e.isStopIncluded,!0),a=e.data;return c(t)?(t.start=i,t.stop=o,t.isStartIncluded=r,t.isStopIncluded=s,t.data=a,t):(Fx.start=i,Fx.stop=o,Fx.isStartIncluded=r,Fx.isStopIncluded=s,Fx.data=a,new Vo(Fx))};Vo.toIso8601=function(e,t){return A.typeOf.object("timeInterval",e),`${J.toIso8601(e.start,t)}/${J.toIso8601(e.stop,t)}`};Vo.clone=function(e,t){if(c(e))return c(t)?(t.start=e.start,t.stop=e.stop,t.isStartIncluded=e.isStartIncluded,t.isStopIncluded=e.isStopIncluded,t.data=e.data,t):new Vo(e)};Vo.equals=function(e,t,n){return e===t||c(e)&&c(t)&&(e.isEmpty&&t.isEmpty||e.isStartIncluded===t.isStartIncluded&&e.isStopIncluded===t.isStopIncluded&&J.equals(e.start,t.start)&&J.equals(e.stop,t.stop)&&(e.data===t.data||c(n)&&n(e.data,t.data)))};Vo.equalsEpsilon=function(e,t,n,i){return n=y(n,0),e===t||c(e)&&c(t)&&(e.isEmpty&&t.isEmpty||e.isStartIncluded===t.isStartIncluded&&e.isStopIncluded===t.isStopIncluded&&J.equalsEpsilon(e.start,t.start,n)&&J.equalsEpsilon(e.stop,t.stop,n)&&(e.data===t.data||c(i)&&i(e.data,t.data)))};Vo.intersect=function(e,t,n,i){if(A.typeOf.object("left",e),!c(t))return Vo.clone(Vo.EMPTY,n);let o=e.start,r=e.stop,s=t.start,a=t.stop,l=J.greaterThanOrEquals(s,o)&&J.greaterThanOrEquals(r,s),u=!l&&J.lessThanOrEquals(s,o)&&J.lessThanOrEquals(o,a);if(!l&&!u)return Vo.clone(Vo.EMPTY,n);let f=e.isStartIncluded,d=e.isStopIncluded,p=t.isStartIncluded,g=t.isStopIncluded,m=J.lessThan(r,a);return c(n)||(n=new Vo),n.start=l?s:o,n.isStartIncluded=f&&p||!J.equals(s,o)&&(l&&p||u&&f),n.stop=m?r:a,n.isStopIncluded=m?d:d&&g||!J.equals(a,r)&&g,n.data=c(i)?i(e.data,t.data):e.data,n};Vo.contains=function(e,t){if(A.typeOf.object("timeInterval",e),A.typeOf.object("julianDate",t),e.isEmpty)return!1;let n=J.compare(e.start,t);if(n===0)return e.isStartIncluded;let i=J.compare(t,e.stop);return i===0?e.isStopIncluded:n<0&&i<0};Vo.prototype.clone=function(e){return Vo.clone(this,e)};Vo.prototype.equals=function(e,t){return Vo.equals(this,e,t)};Vo.prototype.equalsEpsilon=function(e,t,n){return Vo.equalsEpsilon(this,e,t,n)};Vo.prototype.toString=function(){return Vo.toIso8601(this)};Vo.EMPTY=Object.freeze(new Vo({start:new J,stop:new J,isStartIncluded:!1,isStopIncluded:!1}));var wn=Vo;var aJ=Object.freeze(J.fromIso8601("0000-01-01T00:00:00Z")),cJ=Object.freeze(J.fromIso8601("9999-12-31T24:00:00Z")),pwe=Object.freeze(new wn({start:aJ,stop:cJ})),_we={MINIMUM_VALUE:aJ,MAXIMUM_VALUE:cJ,MAXIMUM_INTERVAL:pwe},je=_we;function TE(e,t,n){e=y(e,0),t=y(t,0),n=y(n,0),this.value=new Float32Array([e,t,n])}Object.defineProperties(TE.prototype,{componentDatatype:{get:function(){return $.FLOAT}},componentsPerAttribute:{get:function(){return 3}},normalize:{get:function(){return!1}}});TE.fromCartesian3=function(e){return A.defined("offset",e),new TE(e.x,e.y,e.z)};TE.toValue=function(e,t){return A.defined("offset",e),c(t)||(t=new Float32Array([e.x,e.y,e.z])),t[0]=e.x,t[1]=e.y,t[2]=e.z,t};var Qi=TE;function CI(e){e=y(e,!0),this.value=CI.toValue(e)}Object.defineProperties(CI.prototype,{componentDatatype:{get:function(){return $.UNSIGNED_BYTE}},componentsPerAttribute:{get:function(){return 1}},normalize:{get:function(){return!1}}});CI.toValue=function(e,t){if(!c(e))throw new E("show is required.");return c(t)?(t[0]=e,t):new Uint8Array([e])};var Cn=CI;var cB=`in vec3 v_positionEC;
in vec3 v_normalEC;
in vec3 v_tangentEC;
in vec3 v_bitangentEC;
in vec2 v_st;
void main()
{
vec3 positionToEyeEC = -v_positionEC;
mat3 tangentToEyeMatrix = czm_tangentToEyeSpaceMatrix(v_normalEC, v_tangentEC, v_bitangentEC);
vec3 normalEC = normalize(v_normalEC);
#ifdef FACE_FORWARD
normalEC = faceforward(normalEC, vec3(0.0, 0.0, 1.0), -normalEC);
#endif
czm_materialInput materialInput;
materialInput.normalEC = normalEC;
materialInput.tangentToEyeMatrix = tangentToEyeMatrix;
materialInput.positionToEyeEC = positionToEyeEC;
materialInput.st = v_st;
czm_material material = czm_getMaterial(materialInput);
#ifdef FLAT
out_FragColor = vec4(material.diffuse + material.emission, material.alpha);
#else
out_FragColor = czm_phong(normalize(positionToEyeEC), material, czm_lightDirectionEC);
#endif
}
`;var lB=`in vec3 position3DHigh;
in vec3 position3DLow;
in vec3 normal;
in vec3 tangent;
in vec3 bitangent;
in vec2 st;
in float batchId;
out vec3 v_positionEC;
out vec3 v_normalEC;
out vec3 v_tangentEC;
out vec3 v_bitangentEC;
out vec2 v_st;
void main()
{
vec4 p = czm_computePosition();
v_positionEC = (czm_modelViewRelativeToEye * p).xyz;
v_normalEC = czm_normal * normal;
v_tangentEC = czm_normal * tangent;
v_bitangentEC = czm_normal * bitangent;
v_st = st;
gl_Position = czm_modelViewProjectionRelativeToEye * p;
}
`;var uB=`in vec3 v_positionEC;
in vec3 v_normalEC;
void main()
{
vec3 positionToEyeEC = -v_positionEC;
vec3 normalEC = normalize(v_normalEC);
#ifdef FACE_FORWARD
normalEC = faceforward(normalEC, vec3(0.0, 0.0, 1.0), -normalEC);
#endif
czm_materialInput materialInput;
materialInput.normalEC = normalEC;
materialInput.positionToEyeEC = positionToEyeEC;
czm_material material = czm_getMaterial(materialInput);
#ifdef FLAT
out_FragColor = vec4(material.diffuse + material.emission, material.alpha);
#else
out_FragColor = czm_phong(normalize(positionToEyeEC), material, czm_lightDirectionEC);
#endif
}
`;var fB=`in vec3 position3DHigh;
in vec3 position3DLow;
in vec3 normal;
in float batchId;
out vec3 v_positionEC;
out vec3 v_normalEC;
void main()
{
vec4 p = czm_computePosition();
v_positionEC = (czm_modelViewRelativeToEye * p).xyz;
v_normalEC = czm_normal * normal;
gl_Position = czm_modelViewProjectionRelativeToEye * p;
}
`;var dB=`in vec3 v_positionEC;
in vec3 v_normalEC;
in vec2 v_st;
void main()
{
vec3 positionToEyeEC = -v_positionEC;
vec3 normalEC = normalize(v_normalEC);
#ifdef FACE_FORWARD
normalEC = faceforward(normalEC, vec3(0.0, 0.0, 1.0), -normalEC);
#endif
czm_materialInput materialInput;
materialInput.normalEC = normalEC;
materialInput.positionToEyeEC = positionToEyeEC;
materialInput.st = v_st;
czm_material material = czm_getMaterial(materialInput);
#ifdef FLAT
out_FragColor = vec4(material.diffuse + material.emission, material.alpha);
#else
out_FragColor = czm_phong(normalize(positionToEyeEC), material, czm_lightDirectionEC);
#endif
}
`;var hB=`in vec3 position3DHigh;
in vec3 position3DLow;
in vec3 normal;
in vec2 st;
in float batchId;
out vec3 v_positionEC;
out vec3 v_normalEC;
out vec2 v_st;
void main()
{
vec4 p = czm_computePosition();
v_positionEC = (czm_modelViewRelativeToEye * p).xyz;
v_normalEC = czm_normal * normal;
v_st = st;
gl_Position = czm_modelViewProjectionRelativeToEye * p;
}
`;var gwe={ADD:ne.FUNC_ADD,SUBTRACT:ne.FUNC_SUBTRACT,REVERSE_SUBTRACT:ne.FUNC_REVERSE_SUBTRACT,MIN:ne.MIN,MAX:ne.MAX},fc=Object.freeze(gwe);var ywe={ZERO:ne.ZERO,ONE:ne.ONE,SOURCE_COLOR:ne.SRC_COLOR,ONE_MINUS_SOURCE_COLOR:ne.ONE_MINUS_SRC_COLOR,DESTINATION_COLOR:ne.DST_COLOR,ONE_MINUS_DESTINATION_COLOR:ne.ONE_MINUS_DST_COLOR,SOURCE_ALPHA:ne.SRC_ALPHA,ONE_MINUS_SOURCE_ALPHA:ne.ONE_MINUS_SRC_ALPHA,DESTINATION_ALPHA:ne.DST_ALPHA,ONE_MINUS_DESTINATION_ALPHA:ne.ONE_MINUS_DST_ALPHA,CONSTANT_COLOR:ne.CONSTANT_COLOR,ONE_MINUS_CONSTANT_COLOR:ne.ONE_MINUS_CONSTANT_COLOR,CONSTANT_ALPHA:ne.CONSTANT_ALPHA,ONE_MINUS_CONSTANT_ALPHA:ne.ONE_MINUS_CONSTANT_ALPHA,SOURCE_ALPHA_SATURATE:ne.SRC_ALPHA_SATURATE},Do=Object.freeze(ywe);var bwe={DISABLED:Object.freeze({enabled:!1}),ALPHA_BLEND:Object.freeze({enabled:!0,equationRgb:fc.ADD,equationAlpha:fc.ADD,functionSourceRgb:Do.SOURCE_ALPHA,functionSourceAlpha:Do.ONE,functionDestinationRgb:Do.ONE_MINUS_SOURCE_ALPHA,functionDestinationAlpha:Do.ONE_MINUS_SOURCE_ALPHA}),PRE_MULTIPLIED_ALPHA_BLEND:Object.freeze({enabled:!0,equationRgb:fc.ADD,equationAlpha:fc.ADD,functionSourceRgb:Do.ONE,functionSourceAlpha:Do.ONE,functionDestinationRgb:Do.ONE_MINUS_SOURCE_ALPHA,functionDestinationAlpha:Do.ONE_MINUS_SOURCE_ALPHA}),ADDITIVE_BLEND:Object.freeze({enabled:!0,equationRgb:fc.ADD,equationAlpha:fc.ADD,functionSourceRgb:Do.SOURCE_ALPHA,functionSourceAlpha:Do.ONE,functionDestinationRgb:Do.ONE,functionDestinationAlpha:Do.ONE})},hn=Object.freeze(bwe);var xwe={FRONT:ne.FRONT,BACK:ne.BACK,FRONT_AND_BACK:ne.FRONT_AND_BACK},xi=Object.freeze(xwe);function Bx(e){e=y(e,y.EMPTY_OBJECT),this.material=e.material,this.translucent=y(e.translucent,!0),this._vertexShaderSource=e.vertexShaderSource,this._fragmentShaderSource=e.fragmentShaderSource,this._renderState=e.renderState,this._closed=y(e.closed,!1)}Object.defineProperties(Bx.prototype,{vertexShaderSource:{get:function(){return this._vertexShaderSource}},fragmentShaderSource:{get:function(){return this._fragmentShaderSource}},renderState:{get:function(){return this._renderState}},closed:{get:function(){return this._closed}}});Bx.prototype.getFragmentShaderSource=function(){let e=[];return this.flat&&e.push("#define FLAT"),this.faceForward&&e.push("#define FACE_FORWARD"),c(this.material)&&e.push(this.material.shaderSource),e.push(this.fragmentShaderSource),e.join(`
`)};Bx.prototype.isTranslucent=function(){return c(this.material)&&this.material.isTranslucent()||!c(this.material)&&this.translucent};Bx.prototype.getRenderState=function(){let e=this.isTranslucent(),t=qe(this.renderState,!1);return e?(t.depthMask=!1,t.blending=hn.ALPHA_BLEND):t.depthMask=!0,t};Bx.getDefaultRenderState=function(e,t,n){let i={depthTest:{enabled:!0}};return e&&(i.depthMask=!1,i.blending=hn.ALPHA_BLEND),t&&(i.cull={enabled:!0,face:xi.BACK}),c(n)&&(i=At(n,i,!0)),i};var io=Bx;function Twe(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){let t=Math.random()*16|0;return(e==="x"?t:t&3|8).toString(16)})}var Hn=Twe;function kx(e,t,n,i,o){this._format=e,this._datatype=t,this._width=n,this._height=i,this._buffer=o}Object.defineProperties(kx.prototype,{internalFormat:{get:function(){return this._format}},pixelDatatype:{get:function(){return this._datatype}},width:{get:function(){return this._width}},height:{get:function(){return this._height}},bufferView:{get:function(){return this._buffer}},arrayBufferView:{get:function(){return this._buffer}}});kx.clone=function(e){if(c(e))return new kx(e._format,e._datatype,e._width,e._height,e._buffer)};kx.prototype.clone=function(){return kx.clone(this)};var mB=kx;var lJ=Ur(Pl(),1);function uJ(){if(!c(js._canTransferArrayBuffer)){let e=gB("transferTypedArrayTest");e.postMessage=y(e.webkitPostMessage,e.postMessage);let t=99,n=new Int8Array([t]);try{e.postMessage({array:n},[n.buffer])}catch{return js._canTransferArrayBuffer=!1,js._canTransferArrayBuffer}js._canTransferArrayBuffer=new Promise(i=>{e.onmessage=function(o){let r=o.data.array,s=c(r)&&r[0]===t;i(s),e.terminate(),js._canTransferArrayBuffer=s}})}return js._canTransferArrayBuffer}var _B=new pe;function pB(e){let t;try{t=new Blob([e],{type:"application/javascript"})}catch{let o=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,r=new o;r.append(e),t=r.getBlob("application/javascript")}return(window.URL||window.webkitURL).createObjectURL(t)}function gB(e){let t=new lJ.default(e),n=t.scheme().length!==0&&t.fragment().length===0,i=e.replace(/\.js$/,""),o={},r,s;if(Sx(e))s=e;else if(!n){let a=sn(`${js._workerModulePrefix}/${i}.js`);Sx(a)&&(s=a)}if(s){let a=`import "${s}";`;return r=pB(a),o.type="module",new Worker(r,o)}if(!n&&typeof CESIUM_WORKERS<"u"){let a=`
      importScripts("${pB(CESIUM_WORKERS)}");
      CesiumWorkers["${i}"]();
    `;return r=pB(a),new Worker(r,o)}if(r=e,n||(r=sn(`${js._workerModulePrefix+i}.js`)),!zt.supportsEsmWebWorkers())throw new ue("This browser is not supported. Please update your browser to continue.");return o.type="module",new Worker(r,o)}async function Awe(e,t){let n={modulePath:void 0,wasmBinaryFile:void 0,wasmBinary:void 0};if(!zt.supportsWebAssembly()){if(!c(t.fallbackModulePath))throw new ue(`This browser does not support Web Assembly, and no backup module was provided for ${e._workerPath}`);return n.modulePath=sn(t.fallbackModulePath),n}n.wasmBinaryFile=sn(t.wasmBinaryFile);let i=await De.fetchArrayBuffer({url:n.wasmBinaryFile});return n.wasmBinary=i,n}function js(e,t){this._workerPath=e,this._maximumActiveTasks=y(t,Number.POSITIVE_INFINITY),this._activeTasks=0,this._nextID=0,this._webAssemblyPromise=void 0}var Cwe=(e,t,n,i)=>{let o=({data:r})=>{if(r.id===t){if(c(r.error)){let s=r.error;s.name==="RuntimeError"?(s=new ue(r.error.message),s.stack=r.error.stack):s.name==="DeveloperError"?(s=new E(r.error.message),s.stack=r.error.stack):s.name==="Error"&&(s=new Error(r.error.message),s.stack=r.error.stack),_B.raiseEvent(s),i(s)}else _B.raiseEvent(),n(r.result);e.removeEventListener("message",o)}};return o},Ewe=[];async function Swe(e,t,n){let i=await Promise.resolve(uJ());c(n)?i||(n.length=0):n=Ewe;let o=e._nextID++,r=new Promise((s,a)=>{e._worker.addEventListener("message",Cwe(e._worker,o,s,a))});return e._worker.postMessage({id:o,baseUrl:sn.getCesiumBaseUrl().url,parameters:t,canTransferArrayBuffer:i},n),r}async function wwe(e,t,n){++e._activeTasks;try{let i=await Swe(e,t,n);return--e._activeTasks,i}catch(i){throw--e._activeTasks,i}}js.prototype.scheduleTask=function(e,t){if(c(this._worker)||(this._worker=gB(this._workerPath)),!(this._activeTasks>=this._maximumActiveTasks))return wwe(this,e,t)};js.prototype.initWebAssemblyModule=async function(e){if(c(this._webAssemblyPromise))return this._webAssemblyPromise;let t=async()=>{let n=this._worker=gB(this._workerPath),i=await Awe(this,e),o=await Promise.resolve(uJ()),r,s=i.wasmBinary;c(s)&&o&&(r=[s]);let a=new Promise((l,u)=>{n.onmessage=function({data:f}){c(f)?l(f.result):u(new ue("Could not configure wasm module"))}});return n.postMessage({canTransferArrayBuffer:o,parameters:{webAssemblyConfig:i}},r),a};return this._webAssemblyPromise=t(),this._webAssemblyPromise};js.prototype.isDestroyed=function(){return!1};js.prototype.destroy=function(){return c(this._worker)&&this._worker.terminate(),de(this)};js.taskCompletedEvent=_B;js._defaultWorkerModulePrefix="Workers/";js._workerModulePrefix=js._defaultWorkerModulePrefix;js._canTransferArrayBuffer=void 0;var Ti=js;function wm(){}wm._transcodeTaskProcessor=new Ti("transcodeKTX2",Number.POSITIVE_INFINITY);wm._readyPromise=void 0;function vwe(){let e=wm._transcodeTaskProcessor.initWebAssemblyModule({wasmBinaryFile:"ThirdParty/basis_transcoder.wasm"}).then(function(t){if(t)return wm._transcodeTaskProcessor;throw new ue("KTX2 transcoder could not be initialized.")});wm._readyPromise=e}wm.transcode=function(e,t){return A.defined("supportedTargetFormats",t),c(wm._readyPromise)||vwe(),wm._readyPromise.then(function(n){let i=e;e instanceof ArrayBuffer&&(i=new Uint8Array(e));let o={supportedTargetFormats:t,ktx2Buffer:i};return n.scheduleTask(o,[i.buffer])}).then(function(n){let i=n.length,o=Object.keys(n[0]);for(let r=0;r<i;r++){let s=n[r];for(let a=0;a<o.length;a++){let l=s[o[a]];s[o[a]]=new mB(l.internalFormat,l.datatype,l.width,l.height,l.levelBuffer)}}if(o.length===1){for(let r=0;r<i;++r)n[r]=n[r][o[0]];i===1&&(n=n[0])}return n}).catch(function(n){throw n})};var yB=wm;var fJ;dJ.setKTX2SupportedFormats=function(e,t,n,i,o,r){fJ={s3tc:e,pvrtc:t,astc:n,etc:i,etc1:o,bc7:r}};function dJ(e){A.defined("resourceOrUrlOrBuffer",e);let t;return e instanceof ArrayBuffer||ArrayBuffer.isView(e)?t=Promise.resolve(e):t=De.createIfNeeded(e).fetchArrayBuffer(),t.then(function(n){return yB.transcode(n,fJ)})}var Mu=dJ;var Xi={SCALAR:"SCALAR",VEC2:"VEC2",VEC3:"VEC3",VEC4:"VEC4",MAT2:"MAT2",MAT3:"MAT3",MAT4:"MAT4"};Xi.getMathType=function(e){switch(e){case Xi.SCALAR:return Number;case Xi.VEC2:return H;case Xi.VEC3:return h;case Xi.VEC4:return se;case Xi.MAT2:return Gi;case Xi.MAT3:return Q;case Xi.MAT4:return k;default:throw new E("attributeType is not a valid value.")}};Xi.getNumberOfComponents=function(e){switch(e){case Xi.SCALAR:return 1;case Xi.VEC2:return 2;case Xi.VEC3:return 3;case Xi.VEC4:case Xi.MAT2:return 4;case Xi.MAT3:return 9;case Xi.MAT4:return 16;default:throw new E("attributeType is not a valid value.")}};Xi.getAttributeLocationCount=function(e){switch(e){case Xi.SCALAR:case Xi.VEC2:case Xi.VEC3:case Xi.VEC4:return 1;case Xi.MAT2:return 2;case Xi.MAT3:return 3;case Xi.MAT4:return 4;default:throw new E("attributeType is not a valid value.")}};Xi.getGlslType=function(e){switch(A.typeOf.string("attributeType",e),e){case Xi.SCALAR:return"float";case Xi.VEC2:return"vec2";case Xi.VEC3:return"vec3";case Xi.VEC4:return"vec4";case Xi.MAT2:return"mat2";case Xi.MAT3:return"mat3";case Xi.MAT4:return"mat4";default:throw new E("attributeType is not a valid value.")}};var cn=Object.freeze(Xi);var hJ=1/256,mJ=256,lo={};lo.octEncodeInRange=function(e,t,n){A.defined("vector",e),A.defined("result",n);let i=h.magnitudeSquared(e);if(Math.abs(i-1)>R.EPSILON6)throw new E("vector must be normalized.");if(n.x=e.x/(Math.abs(e.x)+Math.abs(e.y)+Math.abs(e.z)),n.y=e.y/(Math.abs(e.x)+Math.abs(e.y)+Math.abs(e.z)),e.z<0){let o=n.x,r=n.y;n.x=(1-Math.abs(r))*R.signNotZero(o),n.y=(1-Math.abs(o))*R.signNotZero(r)}return n.x=R.toSNorm(n.x,t),n.y=R.toSNorm(n.y,t),n};lo.octEncode=function(e,t){return lo.octEncodeInRange(e,255,t)};var AE=new H,pJ=new Uint8Array(1);function EI(e){return pJ[0]=e,pJ[0]}lo.octEncodeToCartesian4=function(e,t){return lo.octEncodeInRange(e,65535,AE),t.x=EI(AE.x*hJ),t.y=EI(AE.x),t.z=EI(AE.y*hJ),t.w=EI(AE.y),t};lo.octDecodeInRange=function(e,t,n,i){if(A.defined("result",i),e<0||e>n||t<0||t>n)throw new E(`x and y must be unsigned normalized integers between 0 and ${n}`);if(i.x=R.fromSNorm(e,n),i.y=R.fromSNorm(t,n),i.z=1-(Math.abs(i.x)+Math.abs(i.y)),i.z<0){let o=i.x;i.x=(1-Math.abs(i.y))*R.signNotZero(o),i.y=(1-Math.abs(o))*R.signNotZero(i.y)}return h.normalize(i,i)};lo.octDecode=function(e,t,n){return lo.octDecodeInRange(e,t,255,n)};lo.octDecodeFromCartesian4=function(e,t){A.typeOf.object("encoded",e),A.typeOf.object("result",t);let n=e.x,i=e.y,o=e.z,r=e.w;if(n<0||n>255||i<0||i>255||o<0||o>255||r<0||r>255)throw new E("x, y, z, and w must be unsigned normalized integers between 0 and 255");let s=n*mJ+i,a=o*mJ+r;return lo.octDecodeInRange(s,a,65535,t)};lo.octPackFloat=function(e){return A.defined("encoded",e),256*e.x+e.y};var xB=new H;lo.octEncodeFloat=function(e){return lo.octEncode(e,xB),lo.octPackFloat(xB)};lo.octDecodeFloat=function(e,t){A.defined("value",e);let n=e/256,i=Math.floor(n),o=(n-i)*256;return lo.octDecode(i,o,t)};lo.octPack=function(e,t,n,i){A.defined("v1",e),A.defined("v2",t),A.defined("v3",n),A.defined("result",i);let o=lo.octEncodeFloat(e),r=lo.octEncodeFloat(t),s=lo.octEncode(n,xB);return i.x=65536*s.x+o,i.y=65536*s.y+r,i};lo.octUnpack=function(e,t,n,i){A.defined("packed",e),A.defined("v1",t),A.defined("v2",n),A.defined("v3",i);let o=e.x/65536,r=Math.floor(o),s=(o-r)*65536;o=e.y/65536;let a=Math.floor(o),l=(o-a)*65536;lo.octDecodeFloat(s,t),lo.octDecodeFloat(l,n),lo.octDecode(r,a,i)};lo.compressTextureCoordinates=function(e){A.defined("textureCoordinates",e);let t=e.x*4095|0,n=e.y*4095|0;return 4096*t+n};lo.decompressTextureCoordinates=function(e,t){A.defined("compressed",e),A.defined("result",t);let n=e/4096,i=Math.floor(n);return t.x=i/4095,t.y=(e-i*4096)/4095,t};function bB(e){return e>>1^-(e&1)}lo.zigZagDeltaDecode=function(e,t,n){A.defined("uBuffer",e),A.defined("vBuffer",t),A.typeOf.number.equals("uBuffer.length","vBuffer.length",e.length,t.length),c(n)&&A.typeOf.number.equals("uBuffer.length","heightBuffer.length",e.length,n.length);let i=e.length,o=0,r=0,s=0;for(let a=0;a<i;++a)o+=bB(e[a]),r+=bB(t[a]),e[a]=o,t[a]=r,c(n)&&(s+=bB(n[a]),n[a]=s)};lo.dequantize=function(e,t,n,i){A.defined("typedArray",e),A.defined("componentDatatype",t),A.defined("type",n),A.defined("count",i);let o=cn.getNumberOfComponents(n),r;switch(t){case $.BYTE:r=127;break;case $.UNSIGNED_BYTE:r=255;break;case $.SHORT:r=32767;break;case $.UNSIGNED_SHORT:r=65535;break;case $.INT:r=2147483647;break;case $.UNSIGNED_INT:r=4294967295;break;default:throw new E(`Cannot dequantize component datatype: ${t}`)}let s=new Float32Array(i*o);for(let a=0;a<i;a++)for(let l=0;l<o;l++){let u=a*o+l;s[u]=Math.max(e[u]/r,-1)}return s};lo.decodeRGB565=function(e,t){A.defined("typedArray",e);let n=e.length*3;c(t)&&A.typeOf.number.equals("result.length","typedArray.length * 3",t.length,n);let i=e.length;c(t)||(t=new Float32Array(i*3));let o=31,r=63,s=1/31,a=1/63;for(let l=0;l<i;l++){let u=e[l],f=u>>11,d=u>>5&r,p=u&o,g=3*l;t[g]=f*s,t[g+1]=d*a,t[g+2]=p*s}return t};var Nn=lo;var _J=new h,gJ=new h,yJ=new h;function Dwe(e,t,n,i,o){A.defined("point",e),A.defined("p0",t),A.defined("p1",n),A.defined("p2",i),c(o)||(o=new h);let r,s,a,l,u,f,d,p;if(c(t.z)){if(h.equalsEpsilon(e,t,R.EPSILON14))return h.clone(h.UNIT_X,o);if(h.equalsEpsilon(e,n,R.EPSILON14))return h.clone(h.UNIT_Y,o);if(h.equalsEpsilon(e,i,R.EPSILON14))return h.clone(h.UNIT_Z,o);r=h.subtract(n,t,_J),s=h.subtract(i,t,gJ),a=h.subtract(e,t,yJ),l=h.dot(r,r),u=h.dot(r,s),f=h.dot(r,a),d=h.dot(s,s),p=h.dot(s,a)}else{if(H.equalsEpsilon(e,t,R.EPSILON14))return h.clone(h.UNIT_X,o);if(H.equalsEpsilon(e,n,R.EPSILON14))return h.clone(h.UNIT_Y,o);if(H.equalsEpsilon(e,i,R.EPSILON14))return h.clone(h.UNIT_Z,o);r=H.subtract(n,t,_J),s=H.subtract(i,t,gJ),a=H.subtract(e,t,yJ),l=H.dot(r,r),u=H.dot(r,s),f=H.dot(r,a),d=H.dot(s,s),p=H.dot(s,a)}o.y=d*f-u*p,o.z=l*p-u*f;let g=l*d-u*u;if(g!==0)return o.y/=g,o.z/=g,o.x=1-o.y-o.z,o}var CE=Dwe;function ih(){this.high=h.clone(h.ZERO),this.low=h.clone(h.ZERO)}ih.encode=function(e,t){A.typeOf.number("value",e),c(t)||(t={high:0,low:0});let n;return e>=0?(n=Math.floor(e/65536)*65536,t.high=n,t.low=e-n):(n=Math.floor(-e/65536)*65536,t.high=-n,t.low=e+n),t};var vm={high:0,low:0};ih.fromCartesian=function(e,t){A.typeOf.object("cartesian",e),c(t)||(t=new ih);let n=t.high,i=t.low;return ih.encode(e.x,vm),n.x=vm.high,i.x=vm.low,ih.encode(e.y,vm),n.y=vm.high,i.y=vm.low,ih.encode(e.z,vm),n.z=vm.high,i.z=vm.low,t};var TB=new ih;ih.writeElements=function(e,t,n){A.defined("cartesianArray",t),A.typeOf.number("index",n),A.typeOf.number.greaterThanOrEquals("index",n,0),ih.fromCartesian(e,TB);let i=TB.high,o=TB.low;t[n]=i.x,t[n+1]=i.y,t[n+2]=i.z,t[n+3]=o.x,t[n+4]=o.y,t[n+5]=o.z};var Gn=ih;var ws={UNSIGNED_BYTE:ne.UNSIGNED_BYTE,UNSIGNED_SHORT:ne.UNSIGNED_SHORT,UNSIGNED_INT:ne.UNSIGNED_INT};ws.getSizeInBytes=function(e){switch(e){case ws.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case ws.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case ws.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT}throw new E("indexDatatype is required and must be a valid IndexDatatype constant.")};ws.fromSizeInBytes=function(e){switch(e){case 2:return ws.UNSIGNED_SHORT;case 4:return ws.UNSIGNED_INT;case 1:return ws.UNSIGNED_BYTE;default:throw new E("Size in bytes cannot be mapped to an IndexDatatype")}};ws.validate=function(e){return c(e)&&(e===ws.UNSIGNED_BYTE||e===ws.UNSIGNED_SHORT||e===ws.UNSIGNED_INT)};ws.createTypedArray=function(e,t){if(!c(e))throw new E("numberOfVertices is required.");return e>=R.SIXTY_FOUR_KILOBYTES?new Uint32Array(t):new Uint16Array(t)};ws.createTypedArrayFromArrayBuffer=function(e,t,n,i){if(!c(e))throw new E("numberOfVertices is required.");if(!c(t))throw new E("sourceArray is required.");if(!c(n))throw new E("byteOffset is required.");return e>=R.SIXTY_FOUR_KILOBYTES?new Uint32Array(t,n,i):new Uint16Array(t,n,i)};ws.fromTypedArray=function(e){if(e instanceof Uint8Array)return ws.UNSIGNED_BYTE;if(e instanceof Uint16Array)return ws.UNSIGNED_SHORT;if(e instanceof Uint32Array)return ws.UNSIGNED_INT;throw new E("array must be a Uint8Array, Uint16Array, or Uint32Array.")};var Fe=Object.freeze(ws);var AB={};AB.computeDiscriminant=function(e,t,n){if(typeof e!="number")throw new E("a is a required number.");if(typeof t!="number")throw new E("b is a required number.");if(typeof n!="number")throw new E("c is a required number.");return t*t-4*e*n};function bJ(e,t,n){let i=e+t;return R.sign(e)!==R.sign(t)&&Math.abs(i/Math.max(Math.abs(e),Math.abs(t)))<n?0:i}AB.computeRealRoots=function(e,t,n){if(typeof e!="number")throw new E("a is a required number.");if(typeof t!="number")throw new E("b is a required number.");if(typeof n!="number")throw new E("c is a required number.");let i;if(e===0)return t===0?[]:[-n/t];if(t===0){if(n===0)return[0,0];let l=Math.abs(n),u=Math.abs(e);if(l<u&&l/u<R.EPSILON14)return[0,0];if(l>u&&u/l<R.EPSILON14)return[];if(i=-n/e,i<0)return[];let f=Math.sqrt(i);return[-f,f]}else if(n===0)return i=-t/e,i<0?[i,0]:[0,i];let o=t*t,r=4*e*n,s=bJ(o,-r,R.EPSILON14);if(s<0)return[];let a=-.5*bJ(t,R.sign(t)*Math.sqrt(s),R.EPSILON14);return t>0?[a/e,n/a]:[n/a,a/e]};var Rl=AB;var EB={};EB.computeDiscriminant=function(e,t,n,i){if(typeof e!="number")throw new E("a is a required number.");if(typeof t!="number")throw new E("b is a required number.");if(typeof n!="number")throw new E("c is a required number.");if(typeof i!="number")throw new E("d is a required number.");let o=e*e,r=t*t,s=n*n,a=i*i;return 18*e*t*n*i+r*s-27*o*a-4*(e*s*n+r*t*i)};function CB(e,t,n,i){let o=e,r=t/3,s=n/3,a=i,l=o*s,u=r*a,f=r*r,d=s*s,p=o*s-f,g=o*a-r*s,m=r*a-d,b=4*p*m-g*g,x,T;if(b<0){let q,K,te;f*u>=l*d?(q=o,K=p,te=-2*r*p+o*g):(q=a,K=m,te=-a*g+2*s*m);let Z=-(te<0?-1:1)*Math.abs(q)*Math.sqrt(-b);T=-te+Z;let ee=T/2,me=ee<0?-Math.pow(-ee,1/3):Math.pow(ee,1/3),be=T===Z?-me:-K/me;return x=K<=0?me+be:-te/(me*me+be*be+K),f*u>=l*d?[(x-r)/o]:[-a/(x+s)]}let C=p,S=-2*r*p+o*g,v=m,D=-a*g+2*s*m,I=Math.sqrt(b),L=Math.sqrt(3)/2,M=Math.abs(Math.atan2(o*I,-S)/3);x=2*Math.sqrt(-C);let N=Math.cos(M);T=x*N;let B=x*(-N/2-L*Math.sin(M)),_=T+B>2*r?T-r:B-r,w=o,P=_/w;M=Math.abs(Math.atan2(a*I,-D)/3),x=2*Math.sqrt(-v),N=Math.cos(M),T=x*N,B=x*(-N/2-L*Math.sin(M));let O=-a,F=T+B<2*s?T+s:B+s,V=O/F,G=w*F,z=-_*F-w*O,W=_*O,U=(s*z-r*W)/(-r*z+s*G);return P<=U?P<=V?U<=V?[P,U,V]:[P,V,U]:[V,P,U]:P<=V?[U,P,V]:U<=V?[U,V,P]:[V,U,P]}EB.computeRealRoots=function(e,t,n,i){if(typeof e!="number")throw new E("a is a required number.");if(typeof t!="number")throw new E("b is a required number.");if(typeof n!="number")throw new E("c is a required number.");if(typeof i!="number")throw new E("d is a required number.");let o,r;if(e===0)return Rl.computeRealRoots(t,n,i);if(t===0){if(n===0){if(i===0)return[0,0,0];r=-i/e;let s=r<0?-Math.pow(-r,1/3):Math.pow(r,1/3);return[s,s,s]}else if(i===0)return o=Rl.computeRealRoots(e,0,n),o.Length===0?[0]:[o[0],0,o[1]];return CB(e,0,n,i)}else{if(n===0)return i===0?(r=-t/e,r<0?[r,0,0]:[0,0,r]):CB(e,t,0,i);if(i===0)return o=Rl.computeRealRoots(e,t,n),o.length===0?[0]:o[1]<=0?[o[0],o[1],0]:o[0]>=0?[0,o[0],o[1]]:[o[0],0,o[1]]}return CB(e,t,n,i)};var EE=EB;var SB={};SB.computeDiscriminant=function(e,t,n,i,o){if(typeof e!="number")throw new E("a is a required number.");if(typeof t!="number")throw new E("b is a required number.");if(typeof n!="number")throw new E("c is a required number.");if(typeof i!="number")throw new E("d is a required number.");if(typeof o!="number")throw new E("e is a required number.");let r=e*e,s=r*e,a=t*t,l=a*t,u=n*n,f=u*n,d=i*i,p=d*i,g=o*o,m=g*o;return a*u*d-4*l*p-4*e*f*d+18*e*t*n*p-27*r*d*d+256*s*m+o*(18*l*n*i-4*a*f+16*e*u*u-80*e*t*u*i-6*e*a*d+144*r*n*d)+g*(144*e*a*n-27*a*a-128*r*u-192*r*t*i)};function Uf(e,t,n,i){let o=e*e,r=t-3*o/8,s=n-t*e/2+o*e/8,a=i-n*e/4+t*o/16-3*o*o/256,l=EE.computeRealRoots(1,2*r,r*r-4*a,-s*s);if(l.length>0){let u=-e/4,f=l[l.length-1];if(Math.abs(f)<R.EPSILON14){let d=Rl.computeRealRoots(1,r,a);if(d.length===2){let p=d[0],g=d[1],m;if(p>=0&&g>=0){let b=Math.sqrt(p),x=Math.sqrt(g);return[u-x,u-b,u+b,u+x]}else{if(p>=0&&g<0)return m=Math.sqrt(p),[u-m,u+m];if(p<0&&g>=0)return m=Math.sqrt(g),[u-m,u+m]}}return[]}else if(f>0){let d=Math.sqrt(f),p=(r+f-s/d)/2,g=(r+f+s/d)/2,m=Rl.computeRealRoots(1,d,p),b=Rl.computeRealRoots(1,-d,g);return m.length!==0?(m[0]+=u,m[1]+=u,b.length!==0?(b[0]+=u,b[1]+=u,m[1]<=b[0]?[m[0],m[1],b[0],b[1]]:b[1]<=m[0]?[b[0],b[1],m[0],m[1]]:m[0]>=b[0]&&m[1]<=b[1]?[b[0],m[0],m[1],b[1]]:b[0]>=m[0]&&b[1]<=m[1]?[m[0],b[0],b[1],m[1]]:m[0]>b[0]&&m[0]<b[1]?[b[0],m[0],b[1],m[1]]:[m[0],b[0],m[1],b[1]]):m):b.length!==0?(b[0]+=u,b[1]+=u,b):[]}}return[]}function SE(e,t,n,i){let o=n*n,r=t*t,s=e*e,a=-2*t,l=n*e+r-4*i,u=s*i-n*t*e+o,f=EE.computeRealRoots(1,a,l,u);if(f.length>0){let d=f[0],p=t-d,g=p*p,m=e/2,b=p/2,x=g-4*i,T=g+4*Math.abs(i),C=s-4*d,S=s+4*Math.abs(d),v,D;if(d<0||x*S<C*T){let w=Math.sqrt(C);v=w/2,D=w===0?0:(e*b-n)/w}else{let w=Math.sqrt(x);v=w===0?0:(e*b-n)/w,D=w/2}let I,L;m===0&&v===0?(I=0,L=0):R.sign(m)===R.sign(v)?(I=m+v,L=d/I):(L=m-v,I=d/L);let M,N;b===0&&D===0?(M=0,N=0):R.sign(b)===R.sign(D)?(M=b+D,N=i/M):(N=b-D,M=i/N);let B=Rl.computeRealRoots(1,I,M),_=Rl.computeRealRoots(1,L,N);if(B.length!==0)return _.length!==0?B[1]<=_[0]?[B[0],B[1],_[0],_[1]]:_[1]<=B[0]?[_[0],_[1],B[0],B[1]]:B[0]>=_[0]&&B[1]<=_[1]?[_[0],B[0],B[1],_[1]]:_[0]>=B[0]&&_[1]<=B[1]?[B[0],_[0],_[1],B[1]]:B[0]>_[0]&&B[0]<_[1]?[_[0],B[0],_[1],B[1]]:[B[0],_[0],B[1],_[1]]:B;if(_.length!==0)return _}return[]}SB.computeRealRoots=function(e,t,n,i,o){if(typeof e!="number")throw new E("a is a required number.");if(typeof t!="number")throw new E("b is a required number.");if(typeof n!="number")throw new E("c is a required number.");if(typeof i!="number")throw new E("d is a required number.");if(typeof o!="number")throw new E("e is a required number.");if(Math.abs(e)<R.EPSILON15)return EE.computeRealRoots(t,n,i,o);let r=t/e,s=n/e,a=i/e,l=o/e,u=r<0?1:0;switch(u+=s<0?u+1:u,u+=a<0?u+1:u,u+=l<0?u+1:u,u){case 0:return Uf(r,s,a,l);case 1:return SE(r,s,a,l);case 2:return SE(r,s,a,l);case 3:return Uf(r,s,a,l);case 4:return Uf(r,s,a,l);case 5:return SE(r,s,a,l);case 6:return Uf(r,s,a,l);case 7:return Uf(r,s,a,l);case 8:return SE(r,s,a,l);case 9:return Uf(r,s,a,l);case 10:return Uf(r,s,a,l);case 11:return SE(r,s,a,l);case 12:return Uf(r,s,a,l);case 13:return Uf(r,s,a,l);case 14:return Uf(r,s,a,l);case 15:return Uf(r,s,a,l);default:return}};var wB=SB;function SI(e,t){t=h.clone(y(t,h.ZERO)),h.equals(t,h.ZERO)||h.normalize(t,t),this.origin=h.clone(y(e,h.ZERO)),this.direction=t}SI.clone=function(e,t){if(c(e))return c(t)?(t.origin=h.clone(e.origin),t.direction=h.clone(e.direction),t):new SI(e.origin,e.direction)};SI.getPoint=function(e,t,n){return A.typeOf.object("ray",e),A.typeOf.number("t",t),c(n)||(n=new h),n=h.multiplyByScalar(e.direction,t,n),h.add(e.origin,n,n)};var _n=SI;var Po={};Po.rayPlane=function(e,t,n){if(!c(e))throw new E("ray is required.");if(!c(t))throw new E("plane is required.");c(n)||(n=new h);let i=e.origin,o=e.direction,r=t.normal,s=h.dot(r,o);if(Math.abs(s)<R.EPSILON15)return;let a=(-t.distance-h.dot(r,i))/s;if(!(a<0))return n=h.multiplyByScalar(o,a,n),h.add(i,n,n)};var Pwe=new h,Iwe=new h,vJ=new h,xJ=new h,TJ=new h;Po.rayTriangleParametric=function(e,t,n,i,o){if(!c(e))throw new E("ray is required.");if(!c(t))throw new E("p0 is required.");if(!c(n))throw new E("p1 is required.");if(!c(i))throw new E("p2 is required.");o=y(o,!1);let r=e.origin,s=e.direction,a=h.subtract(n,t,Pwe),l=h.subtract(i,t,Iwe),u=h.cross(s,l,vJ),f=h.dot(a,u),d,p,g,m,b;if(o){if(f<R.EPSILON6||(d=h.subtract(r,t,xJ),g=h.dot(d,u),g<0||g>f)||(p=h.cross(d,a,TJ),m=h.dot(s,p),m<0||g+m>f))return;b=h.dot(l,p)/f}else{if(Math.abs(f)<R.EPSILON6)return;let x=1/f;if(d=h.subtract(r,t,xJ),g=h.dot(d,u)*x,g<0||g>1||(p=h.cross(d,a,TJ),m=h.dot(s,p)*x,m<0||g+m>1))return;b=h.dot(l,p)*x}return b};Po.rayTriangle=function(e,t,n,i,o,r){let s=Po.rayTriangleParametric(e,t,n,i,o);if(!(!c(s)||s<0))return c(r)||(r=new h),h.multiplyByScalar(e.direction,s,r),h.add(e.origin,r,r)};var Owe=new _n;Po.lineSegmentTriangle=function(e,t,n,i,o,r,s){if(!c(e))throw new E("v0 is required.");if(!c(t))throw new E("v1 is required.");if(!c(n))throw new E("p0 is required.");if(!c(i))throw new E("p1 is required.");if(!c(o))throw new E("p2 is required.");let a=Owe;h.clone(e,a.origin),h.subtract(t,e,a.direction),h.normalize(a.direction,a.direction);let l=Po.rayTriangleParametric(a,n,i,o,r);if(!(!c(l)||l<0||l>h.distance(e,t)))return c(s)||(s=new h),h.multiplyByScalar(a.direction,l,s),h.add(a.origin,s,s)};function Rwe(e,t,n,i){let o=t*t-4*e*n;if(o<0)return;if(o>0){let s=1/(2*e),a=Math.sqrt(o),l=(-t+a)*s,u=(-t-a)*s;return l<u?(i.root0=l,i.root1=u):(i.root0=u,i.root1=l),i}let r=-t/(2*e);if(r!==0)return i.root0=i.root1=r,i}var Mwe={root0:0,root1:0};function DJ(e,t,n){c(n)||(n=new lc);let i=e.origin,o=e.direction,r=t.center,s=t.radius*t.radius,a=h.subtract(i,r,vJ),l=h.dot(o,o),u=2*h.dot(o,a),f=h.magnitudeSquared(a)-s,d=Rwe(l,u,f,Mwe);if(c(d))return n.start=d.root0,n.stop=d.root1,n}Po.raySphere=function(e,t,n){if(!c(e))throw new E("ray is required.");if(!c(t))throw new E("sphere is required.");if(n=DJ(e,t,n),!(!c(n)||n.stop<0))return n.start=Math.max(n.start,0),n};var Lwe=new _n;Po.lineSegmentSphere=function(e,t,n,i){if(!c(e))throw new E("p0 is required.");if(!c(t))throw new E("p1 is required.");if(!c(n))throw new E("sphere is required.");let o=Lwe;h.clone(e,o.origin);let r=h.subtract(t,e,o.direction),s=h.magnitude(r);if(h.normalize(r,r),i=DJ(o,n,i),!(!c(i)||i.stop<0||i.start>s))return i.start=Math.max(i.start,0),i.stop=Math.min(i.stop,s),i};var Nwe=new h,Fwe=new h;Po.rayEllipsoid=function(e,t){if(!c(e))throw new E("ray is required.");if(!c(t))throw new E("ellipsoid is required.");let n=t.oneOverRadii,i=h.multiplyComponents(n,e.origin,Nwe),o=h.multiplyComponents(n,e.direction,Fwe),r=h.magnitudeSquared(i),s=h.dot(i,o),a,l,u,f,d;if(r>1){if(s>=0)return;let p=s*s;if(a=r-1,l=h.magnitudeSquared(o),u=l*a,p<u)return;if(p>u){f=s*s-u,d=-s+Math.sqrt(f);let m=d/l,b=a/d;return m<b?new lc(m,b):{start:b,stop:m}}let g=Math.sqrt(a/l);return new lc(g,g)}else if(r<1)return a=r-1,l=h.magnitudeSquared(o),u=l*a,f=s*s-u,d=-s+Math.sqrt(f),new lc(0,d/l);if(s<0)return l=h.magnitudeSquared(o),new lc(0,-s/l)};function ky(e,t,n){let i=e+t;return R.sign(e)!==R.sign(t)&&Math.abs(i/Math.max(Math.abs(e),Math.abs(t)))<n?0:i}Po.quadraticVectorExpression=function(e,t,n,i,o){let r=i*i,s=o*o,a=(e[Q.COLUMN1ROW1]-e[Q.COLUMN2ROW2])*s,l=o*(i*ky(e[Q.COLUMN1ROW0],e[Q.COLUMN0ROW1],R.EPSILON15)+t.y),u=e[Q.COLUMN0ROW0]*r+e[Q.COLUMN2ROW2]*s+i*t.x+n,f=s*ky(e[Q.COLUMN2ROW1],e[Q.COLUMN1ROW2],R.EPSILON15),d=o*(i*ky(e[Q.COLUMN2ROW0],e[Q.COLUMN0ROW2])+t.z),p,g=[];if(d===0&&f===0){if(p=Rl.computeRealRoots(a,l,u),p.length===0)return g;let M=p[0],N=Math.sqrt(Math.max(1-M*M,0));if(g.push(new h(i,o*M,o*-N)),g.push(new h(i,o*M,o*N)),p.length===2){let B=p[1],_=Math.sqrt(Math.max(1-B*B,0));g.push(new h(i,o*B,o*-_)),g.push(new h(i,o*B,o*_))}return g}let m=d*d,b=f*f,x=a*a,T=d*f,C=x+b,S=2*(l*a+T),v=2*u*a+l*l-b+m,D=2*(u*l-T),I=u*u-m;if(C===0&&S===0&&v===0&&D===0)return g;p=wB.computeRealRoots(C,S,v,D,I);let L=p.length;if(L===0)return g;for(let M=0;M<L;++M){let N=p[M],B=N*N,_=Math.max(1-B,0),w=Math.sqrt(_),P;R.sign(a)===R.sign(u)?P=ky(a*B+u,l*N,R.EPSILON12):R.sign(u)===R.sign(l*N)?P=ky(a*B,l*N+u,R.EPSILON12):P=ky(a*B+l*N,u,R.EPSILON12);let O=ky(f*N,d,R.EPSILON15),F=P*O;F<0?g.push(new h(i,o*N,o*w)):F>0?g.push(new h(i,o*N,o*-w)):w!==0?(g.push(new h(i,o*N,o*-w)),g.push(new h(i,o*N,o*w)),++M):g.push(new h(i,o*N,o*w))}return g};var vB=new h,AJ=new h,CJ=new h,wI=new h,Bwe=new h,kwe=new Q,Vwe=new Q,Uwe=new Q,zwe=new Q,Hwe=new Q,EJ=new Q,SJ=new Q,wJ=new h,Gwe=new h,jwe=new he;Po.grazingAltitudeLocation=function(e,t){if(!c(e))throw new E("ray is required.");if(!c(t))throw new E("ellipsoid is required.");let n=e.origin,i=e.direction;if(!h.equals(n,h.ZERO)){let I=t.geodeticSurfaceNormal(n,vB);if(h.dot(i,I)>=0)return n}let o=c(this.rayEllipsoid(e,t)),r=t.transformPositionToScaledSpace(i,vB),s=h.normalize(r,r),a=h.mostOrthogonalAxis(r,wI),l=h.normalize(h.cross(a,s,AJ),AJ),u=h.normalize(h.cross(s,l,CJ),CJ),f=kwe;f[0]=s.x,f[1]=s.y,f[2]=s.z,f[3]=l.x,f[4]=l.y,f[5]=l.z,f[6]=u.x,f[7]=u.y,f[8]=u.z;let d=Q.transpose(f,Vwe),p=Q.fromScale(t.radii,Uwe),g=Q.fromScale(t.oneOverRadii,zwe),m=Hwe;m[0]=0,m[1]=-i.z,m[2]=i.y,m[3]=i.z,m[4]=0,m[5]=-i.x,m[6]=-i.y,m[7]=i.x,m[8]=0;let b=Q.multiply(Q.multiply(d,g,EJ),m,EJ),x=Q.multiply(Q.multiply(b,p,SJ),f,SJ),T=Q.multiplyByVector(b,n,Bwe),C=Po.quadraticVectorExpression(x,h.negate(T,vB),0,0,1),S,v,D=C.length;if(D>0){let I=h.clone(h.ZERO,Gwe),L=Number.NEGATIVE_INFINITY;for(let N=0;N<D;++N){S=Q.multiplyByVector(p,Q.multiplyByVector(f,C[N],wJ),wJ);let B=h.normalize(h.subtract(S,n,wI),wI),_=h.dot(B,i);_>L&&(L=_,I=h.clone(S,I))}let M=t.cartesianToCartographic(I,jwe);return L=R.clamp(L,0,1),v=h.magnitude(h.subtract(I,n,wI))*Math.sqrt(1-L*L),v=o?-v:v,M.height=v,t.cartographicToCartesian(M,new h)}};var Wwe=new h;Po.lineSegmentPlane=function(e,t,n,i){if(!c(e))throw new E("endPoint0 is required.");if(!c(t))throw new E("endPoint1 is required.");if(!c(n))throw new E("plane is required.");c(i)||(i=new h);let o=h.subtract(t,e,Wwe),r=n.normal,s=h.dot(r,o);if(Math.abs(s)<R.EPSILON6)return;let a=h.dot(r,e),l=-(n.distance+a)/s;if(!(l<0||l>1))return h.multiplyByScalar(o,l,i),h.add(e,i,i),i};Po.trianglePlaneIntersection=function(e,t,n,i){if(!c(e)||!c(t)||!c(n)||!c(i))throw new E("p0, p1, p2, and plane are required.");let o=i.normal,r=i.distance,s=h.dot(o,e)+r<0,a=h.dot(o,t)+r<0,l=h.dot(o,n)+r<0,u=0;u+=s?1:0,u+=a?1:0,u+=l?1:0;let f,d;if((u===1||u===2)&&(f=new h,d=new h),u===1){if(s)return Po.lineSegmentPlane(e,t,i,f),Po.lineSegmentPlane(e,n,i,d),{positions:[e,t,n,f,d],indices:[0,3,4,1,2,4,1,4,3]};if(a)return Po.lineSegmentPlane(t,n,i,f),Po.lineSegmentPlane(t,e,i,d),{positions:[e,t,n,f,d],indices:[1,3,4,2,0,4,2,4,3]};if(l)return Po.lineSegmentPlane(n,e,i,f),Po.lineSegmentPlane(n,t,i,d),{positions:[e,t,n,f,d],indices:[2,3,4,0,1,4,0,4,3]}}else if(u===2)if(s)if(a){if(!l)return Po.lineSegmentPlane(e,n,i,f),Po.lineSegmentPlane(t,n,i,d),{positions:[e,t,n,f,d],indices:[0,1,4,0,4,3,2,3,4]}}else return Po.lineSegmentPlane(n,t,i,f),Po.lineSegmentPlane(e,t,i,d),{positions:[e,t,n,f,d],indices:[2,0,4,2,4,3,1,3,4]};else return Po.lineSegmentPlane(t,e,i,f),Po.lineSegmentPlane(n,e,i,d),{positions:[e,t,n,f,d],indices:[1,2,4,1,4,3,0,3,4]}};var Qn=Po;function vs(e,t){if(A.typeOf.object("normal",e),!R.equalsEpsilon(h.magnitude(e),1,R.EPSILON6))throw new E("normal must be normalized.");A.typeOf.number("distance",t),this.normal=h.clone(e),this.distance=t}vs.fromPointNormal=function(e,t,n){if(A.typeOf.object("point",e),A.typeOf.object("normal",t),!R.equalsEpsilon(h.magnitude(t),1,R.EPSILON6))throw new E("normal must be normalized.");let i=-h.dot(t,e);return c(n)?(h.clone(t,n.normal),n.distance=i,n):new vs(t,i)};var qwe=new h;vs.fromCartesian4=function(e,t){A.typeOf.object("coefficients",e);let n=h.fromCartesian4(e,qwe),i=e.w;if(!R.equalsEpsilon(h.magnitude(n),1,R.EPSILON6))throw new E("normal must be normalized.");return c(t)?(h.clone(n,t.normal),t.distance=i,t):new vs(n,i)};vs.getPointDistance=function(e,t){return A.typeOf.object("plane",e),A.typeOf.object("point",t),h.dot(e.normal,t)+e.distance};var Ywe=new h;vs.projectPointOntoPlane=function(e,t,n){A.typeOf.object("plane",e),A.typeOf.object("point",t),c(n)||(n=new h);let i=vs.getPointDistance(e,t),o=h.multiplyByScalar(e.normal,i,Ywe);return h.subtract(t,o,n)};var Xwe=new k,Kwe=new se,$we=new h;vs.transform=function(e,t,n){A.typeOf.object("plane",e),A.typeOf.object("transform",t);let i=e.normal,o=e.distance,r=k.inverseTranspose(t,Xwe),s=se.fromElements(i.x,i.y,i.z,o,Kwe);s=k.multiplyByVector(r,s,s);let a=h.fromCartesian4(s,$we);return s=se.divideByScalar(s,h.magnitude(a),s),vs.fromCartesian4(s,n)};vs.clone=function(e,t){return A.typeOf.object("plane",e),c(t)?(h.clone(e.normal,t.normal),t.distance=e.distance,t):new vs(e.normal,e.distance)};vs.equals=function(e,t){return A.typeOf.object("left",e),A.typeOf.object("right",t),e.distance===t.distance&&h.equals(e.normal,t.normal)};vs.ORIGIN_XY_PLANE=Object.freeze(new vs(h.UNIT_Z,0));vs.ORIGIN_YZ_PLANE=Object.freeze(new vs(h.UNIT_X,0));vs.ORIGIN_ZX_PLANE=Object.freeze(new vs(h.UNIT_Y,0));var un=vs;var DB={};DB.calculateACMR=function(e){e=y(e,y.EMPTY_OBJECT);let t=e.indices,n=e.maximumIndex,i=y(e.cacheSize,24);if(!c(t))throw new E("indices is required.");let o=t.length;if(o<3||o%3!==0)throw new E("indices length must be a multiple of three.");if(n<=0)throw new E("maximumIndex must be greater than zero.");if(i<3)throw new E("cacheSize must be greater than two.");if(!c(n)){n=0;let a=0,l=t[a];for(;a<o;)l>n&&(n=l),++a,l=t[a]}let r=[];for(let a=0;a<n+1;a++)r[a]=0;let s=i+1;for(let a=0;a<o;++a)s-r[t[a]]>i&&(r[t[a]]=s,++s);return(s-i+1)/(o/3)};DB.tipsify=function(e){e=y(e,y.EMPTY_OBJECT);let t=e.indices,n=e.maximumIndex,i=y(e.cacheSize,24),o;function r(_,w,P,O){for(;w.length>=1;){let F=w[w.length-1];if(w.splice(w.length-1,1),_[F].numLiveTriangles>0)return F}for(;o<O;){if(_[o].numLiveTriangles>0)return++o,o-1;++o}return-1}function s(_,w,P,O,F,V,G){let z=-1,W,U=-1,q=0;for(;q<P.length;){let K=P[q];O[K].numLiveTriangles&&(W=0,F-O[K].timeStamp+2*O[K].numLiveTriangles<=w&&(W=F-O[K].timeStamp),(W>U||U===-1)&&(U=W,z=K)),++q}return z===-1?r(O,V,_,G):z}if(!c(t))throw new E("indices is required.");let a=t.length;if(a<3||a%3!==0)throw new E("indices length must be a multiple of three.");if(n<=0)throw new E("maximumIndex must be greater than zero.");if(i<3)throw new E("cacheSize must be greater than two.");let l=0,u=0,f=t[u],d=a;if(c(n))l=n+1;else{for(;u<d;)f>l&&(l=f),++u,f=t[u];if(l===-1)return 0;++l}let p=[],g;for(g=0;g<l;g++)p[g]={numLiveTriangles:0,timeStamp:0,vertexTriangles:[]};u=0;let m=0;for(;u<d;)p[t[u]].vertexTriangles.push(m),++p[t[u]].numLiveTriangles,p[t[u+1]].vertexTriangles.push(m),++p[t[u+1]].numLiveTriangles,p[t[u+2]].vertexTriangles.push(m),++p[t[u+2]].numLiveTriangles,++m,u+=3;let b=0,x=i+1;o=1;let T=[],C=[],S,v,D=0,I=[],L=a/3,M=[];for(g=0;g<L;g++)M[g]=!1;let N,B;for(;b!==-1;){T=[],v=p[b],B=v.vertexTriangles.length;for(let _=0;_<B;++_)if(m=v.vertexTriangles[_],!M[m]){M[m]=!0,u=m+m+m;for(let w=0;w<3;++w)N=t[u],T.push(N),C.push(N),I[D]=N,++D,S=p[N],--S.numLiveTriangles,x-S.timeStamp>i&&(S.timeStamp=x,++x),++u}b=s(t,i,T,p,x,C,l)}return I};var PB=DB;var dc={};function MI(e,t,n,i,o){e[t++]=n,e[t++]=i,e[t++]=i,e[t++]=o,e[t++]=o,e[t]=n}function Zwe(e){let t=e.length,n=t/3*6,i=Fe.createTypedArray(t,n),o=0;for(let r=0;r<t;r+=3,o+=6)MI(i,o,e[r],e[r+1],e[r+2]);return i}function Jwe(e){let t=e.length;if(t>=3){let n=(t-2)*6,i=Fe.createTypedArray(t,n);MI(i,0,e[0],e[1],e[2]);let o=6;for(let r=3;r<t;++r,o+=6)MI(i,o,e[r-1],e[r],e[r-2]);return i}return new Uint16Array}function Qwe(e){if(e.length>0){let t=e.length-1,n=(t-1)*6,i=Fe.createTypedArray(t,n),o=e[0],r=0;for(let s=1;s<t;++s,r+=6)MI(i,r,o,e[s],e[s+1]);return i}return new Uint16Array}dc.toWireframe=function(e){if(!c(e))throw new E("geometry is required.");let t=e.indices;if(c(t)){switch(e.primitiveType){case Me.TRIANGLES:e.indices=Zwe(t);break;case Me.TRIANGLE_STRIP:e.indices=Jwe(t);break;case Me.TRIANGLE_FAN:e.indices=Qwe(t);break;default:throw new E("geometry.primitiveType must be TRIANGLES, TRIANGLE_STRIP, or TRIANGLE_FAN.")}e.primitiveType=Me.LINES}return e};dc.createLineSegmentsForVectors=function(e,t,n){if(t=y(t,"normal"),!c(e))throw new E("geometry is required.");if(!c(e.attributes.position))throw new E("geometry.attributes.position is required.");if(!c(e.attributes[t]))throw new E(`geometry.attributes must have an attribute with the same name as the attributeName parameter, ${t}.`);n=y(n,1e4);let i=e.attributes.position.values,o=e.attributes[t].values,r=i.length,s=new Float64Array(2*r),a=0;for(let f=0;f<r;f+=3)s[a++]=i[f],s[a++]=i[f+1],s[a++]=i[f+2],s[a++]=i[f]+o[f]*n,s[a++]=i[f+1]+o[f+1]*n,s[a++]=i[f+2]+o[f+2]*n;let l,u=e.boundingSphere;return c(u)&&(l=new ce(u.center,u.radius+n)),new ut({attributes:{position:new we({componentDatatype:$.DOUBLE,componentsPerAttribute:3,values:s})},primitiveType:Me.LINES,boundingSphere:l})};dc.createAttributeLocations=function(e){if(!c(e))throw new E("geometry is required.");let t=["position","positionHigh","positionLow","position3DHigh","position3DLow","position2DHigh","position2DLow","pickColor","normal","st","tangent","bitangent","extrudeDirection","compressedAttributes"],n=e.attributes,i={},o=0,r,s=t.length;for(r=0;r<s;++r){let a=t[r];c(n[a])&&(i[a]=o++)}for(let a in n)n.hasOwnProperty(a)&&!c(i[a])&&(i[a]=o++);return i};dc.reorderForPreVertexCache=function(e){if(!c(e))throw new E("geometry is required.");let t=ut.computeNumberOfVertices(e),n=e.indices;if(c(n)){let i=new Int32Array(t);for(let p=0;p<t;p++)i[p]=-1;let o=n,r=o.length,s=Fe.createTypedArray(t,r),a=0,l=0,u=0,f;for(;a<r;)f=i[o[a]],f!==-1?s[l]=f:(f=o[a],i[f]=u,s[l]=u,++u),++a,++l;e.indices=s;let d=e.attributes;for(let p in d)if(d.hasOwnProperty(p)&&c(d[p])&&c(d[p].values)){let g=d[p],m=g.values,b=0,x=g.componentsPerAttribute,T=$.createTypedArray(g.componentDatatype,u*x);for(;b<t;){let C=i[b];if(C!==-1)for(let S=0;S<x;S++)T[x*C+S]=m[x*b+S];++b}g.values=T}}return e};dc.reorderForPostVertexCache=function(e,t){if(!c(e))throw new E("geometry is required.");let n=e.indices;if(e.primitiveType===Me.TRIANGLES&&c(n)){let i=n.length,o=0;for(let r=0;r<i;r++)n[r]>o&&(o=n[r]);e.indices=PB.tipsify({indices:n,maximumIndex:o,cacheSize:t})}return e};function PJ(e){let t={};for(let n in e)if(e.hasOwnProperty(n)&&c(e[n])&&c(e[n].values)){let i=e[n];t[n]=new we({componentDatatype:i.componentDatatype,componentsPerAttribute:i.componentsPerAttribute,normalize:i.normalize,values:[]})}return t}function eve(e,t,n){for(let i in t)if(t.hasOwnProperty(i)&&c(t[i])&&c(t[i].values)){let o=t[i];for(let r=0;r<o.componentsPerAttribute;++r)e[i].values.push(o.values[n*o.componentsPerAttribute+r])}}dc.fitToUnsignedShortIndices=function(e){if(!c(e))throw new E("geometry is required.");if(c(e.indices)&&e.primitiveType!==Me.TRIANGLES&&e.primitiveType!==Me.LINES&&e.primitiveType!==Me.POINTS)throw new E("geometry.primitiveType must equal to PrimitiveType.TRIANGLES, PrimitiveType.LINES, or PrimitiveType.POINTS.");let t=[],n=ut.computeNumberOfVertices(e);if(c(e.indices)&&n>=R.SIXTY_FOUR_KILOBYTES){let i=[],o=[],r=0,s=PJ(e.attributes),a=e.indices,l=a.length,u;e.primitiveType===Me.TRIANGLES?u=3:e.primitiveType===Me.LINES?u=2:e.primitiveType===Me.POINTS&&(u=1);for(let f=0;f<l;f+=u){for(let d=0;d<u;++d){let p=a[f+d],g=i[p];c(g)||(g=r++,i[p]=g,eve(s,e.attributes,p)),o.push(g)}r+u>=R.SIXTY_FOUR_KILOBYTES&&(t.push(new ut({attributes:s,indices:o,primitiveType:e.primitiveType,boundingSphere:e.boundingSphere,boundingSphereCV:e.boundingSphereCV})),i=[],o=[],r=0,s=PJ(e.attributes))}o.length!==0&&t.push(new ut({attributes:s,indices:o,primitiveType:e.primitiveType,boundingSphere:e.boundingSphere,boundingSphereCV:e.boundingSphereCV}))}else t.push(e);return t};var IJ=new h,tve=new he;dc.projectTo2D=function(e,t,n,i,o){if(!c(e))throw new E("geometry is required.");if(!c(t))throw new E("attributeName is required.");if(!c(n))throw new E("attributeName3D is required.");if(!c(i))throw new E("attributeName2D is required.");if(!c(e.attributes[t]))throw new E(`geometry must have attribute matching the attributeName argument: ${t}.`);if(e.attributes[t].componentDatatype!==$.DOUBLE)throw new E("The attribute componentDatatype must be ComponentDatatype.DOUBLE.");let r=e.attributes[t];o=c(o)?o:new Mi;let s=o.ellipsoid,a=r.values,l=new Float64Array(a.length),u=0;for(let f=0;f<a.length;f+=3){let d=h.fromArray(a,f,IJ),p=s.cartesianToCartographic(d,tve);if(!c(p))throw new E(`Could not project point (${d.x}, ${d.y}, ${d.z}) to 2D.`);let g=o.project(p,IJ);l[u++]=g.x,l[u++]=g.y,l[u++]=g.z}return e.attributes[n]=r,e.attributes[i]=new we({componentDatatype:$.DOUBLE,componentsPerAttribute:3,values:l}),delete e.attributes[t],e};var IB={high:0,low:0};dc.encodeAttribute=function(e,t,n,i){if(!c(e))throw new E("geometry is required.");if(!c(t))throw new E("attributeName is required.");if(!c(n))throw new E("attributeHighName is required.");if(!c(i))throw new E("attributeLowName is required.");if(!c(e.attributes[t]))throw new E(`geometry must have attribute matching the attributeName argument: ${t}.`);if(e.attributes[t].componentDatatype!==$.DOUBLE)throw new E("The attribute componentDatatype must be ComponentDatatype.DOUBLE.");let o=e.attributes[t],r=o.values,s=r.length,a=new Float32Array(s),l=new Float32Array(s);for(let f=0;f<s;++f)Gn.encode(r[f],IB),a[f]=IB.high,l[f]=IB.low;let u=o.componentsPerAttribute;return e.attributes[n]=new we({componentDatatype:$.FLOAT,componentsPerAttribute:u,values:a}),e.attributes[i]=new we({componentDatatype:$.FLOAT,componentsPerAttribute:u,values:l}),delete e.attributes[t],e};var Hf=new h;function OB(e,t){if(c(t)){let n=t.values,i=n.length;for(let o=0;o<i;o+=3)h.unpack(n,o,Hf),k.multiplyByPoint(e,Hf,Hf),h.pack(Hf,n,o)}}function RB(e,t){if(c(t)){let n=t.values,i=n.length;for(let o=0;o<i;o+=3)h.unpack(n,o,Hf),Q.multiplyByVector(e,Hf,Hf),Hf=h.normalize(Hf,Hf),h.pack(Hf,n,o)}}var vI=new k,DI=new Q;dc.transformToWorldCoordinates=function(e){if(!c(e))throw new E("instance is required.");let t=e.modelMatrix;if(k.equals(t,k.IDENTITY))return e;let n=e.geometry.attributes;OB(t,n.position),OB(t,n.prevPosition),OB(t,n.nextPosition),(c(n.normal)||c(n.tangent)||c(n.bitangent))&&(k.inverse(t,vI),k.transpose(vI,vI),k.getMatrix3(vI,DI),RB(DI,n.normal),RB(DI,n.tangent),RB(DI,n.bitangent));let i=e.geometry.boundingSphere;return c(i)&&(e.geometry.boundingSphere=ce.transform(i,t,i)),e.modelMatrix=k.clone(k.IDENTITY),e};function nve(e,t){let n=e.length,i={},o=e[0][t].attributes,r;for(r in o)if(o.hasOwnProperty(r)&&c(o[r])&&c(o[r].values)){let s=o[r],a=s.values.length,l=!0;for(let u=1;u<n;++u){let f=e[u][t].attributes[r];if(!c(f)||s.componentDatatype!==f.componentDatatype||s.componentsPerAttribute!==f.componentsPerAttribute||s.normalize!==f.normalize){l=!1;break}a+=f.values.length}l&&(i[r]=new we({componentDatatype:s.componentDatatype,componentsPerAttribute:s.componentsPerAttribute,normalize:s.normalize,values:$.createTypedArray(s.componentDatatype,a)}))}return i}var ive=new h;function MB(e,t){let n=e.length,i,o,r,s,a=e[0].modelMatrix,l=c(e[0][t].indices),u=e[0][t].primitiveType;for(o=1;o<n;++o){if(!k.equals(e[o].modelMatrix,a))throw new E("All instances must have the same modelMatrix.");if(c(e[o][t].indices)!==l)throw new E("All instance geometries must have an indices or not have one.");if(e[o][t].primitiveType!==u)throw new E("All instance geometries must have the same primitiveType.")}let f=nve(e,t),d,p,g;for(i in f)if(f.hasOwnProperty(i))for(d=f[i].values,s=0,o=0;o<n;++o)for(p=e[o][t].attributes[i].values,g=p.length,r=0;r<g;++r)d[s++]=p[r];let m;if(l){let C=0;for(o=0;o<n;++o)C+=e[o][t].indices.length;let S=ut.computeNumberOfVertices(new ut({attributes:f,primitiveType:Me.POINTS})),v=Fe.createTypedArray(S,C),D=0,I=0;for(o=0;o<n;++o){let L=e[o][t].indices,M=L.length;for(s=0;s<M;++s)v[D++]=I+L[s];I+=ut.computeNumberOfVertices(e[o][t])}m=v}let b=new h,x=0,T;for(o=0;o<n;++o){if(T=e[o][t].boundingSphere,!c(T)){b=void 0;break}h.add(T.center,b,b)}if(c(b))for(h.divideByScalar(b,n,b),o=0;o<n;++o){T=e[o][t].boundingSphere;let C=h.magnitude(h.subtract(T.center,b,ive))+T.radius;C>x&&(x=C)}return new ut({attributes:f,indices:m,primitiveType:u,boundingSphere:c(b)?new ce(b,x):void 0})}dc.combineInstances=function(e){if(!c(e)||e.length<1)throw new E("instances is required and must have length greater than zero.");let t=[],n=[],i=e.length;for(let r=0;r<i;++r){let s=e[r];c(s.geometry)?t.push(s):c(s.westHemisphereGeometry)&&c(s.eastHemisphereGeometry)&&n.push(s)}let o=[];return t.length>0&&o.push(MB(t,"geometry")),n.length>0&&(o.push(MB(n,"westHemisphereGeometry")),o.push(MB(n,"eastHemisphereGeometry"))),o};var Lu=new h,wE=new h,Vx=new h,Ux=new h;dc.computeNormal=function(e){if(!c(e))throw new E("geometry is required.");if(!c(e.attributes.position)||!c(e.attributes.position.values))throw new E("geometry.attributes.position.values is required.");if(!c(e.indices))throw new E("geometry.indices is required.");if(e.indices.length<2||e.indices.length%3!==0)throw new E("geometry.indices length must be greater than 0 and be a multiple of 3.");if(e.primitiveType!==Me.TRIANGLES)throw new E("geometry.primitiveType must be PrimitiveType.TRIANGLES.");let t=e.indices,n=e.attributes,i=n.position.values,o=n.position.values.length/3,r=t.length,s=new Array(o),a=new Array(r/3),l=new Array(r),u;for(u=0;u<o;u++)s[u]={indexOffset:0,count:0,currentCount:0};let f=0;for(u=0;u<r;u+=3){let m=t[u],b=t[u+1],x=t[u+2],T=m*3,C=b*3,S=x*3;wE.x=i[T],wE.y=i[T+1],wE.z=i[T+2],Vx.x=i[C],Vx.y=i[C+1],Vx.z=i[C+2],Ux.x=i[S],Ux.y=i[S+1],Ux.z=i[S+2],s[m].count++,s[b].count++,s[x].count++,h.subtract(Vx,wE,Vx),h.subtract(Ux,wE,Ux),a[f]=h.cross(Vx,Ux,new h),f++}let d=0;for(u=0;u<o;u++)s[u].indexOffset+=d,d+=s[u].count;f=0;let p;for(u=0;u<r;u+=3){p=s[t[u]];let m=p.indexOffset+p.currentCount;l[m]=f,p.currentCount++,p=s[t[u+1]],m=p.indexOffset+p.currentCount,l[m]=f,p.currentCount++,p=s[t[u+2]],m=p.indexOffset+p.currentCount,l[m]=f,p.currentCount++,f++}let g=new Float32Array(o*3);for(u=0;u<o;u++){let m=u*3;if(p=s[u],h.clone(h.ZERO,Lu),p.count>0){for(f=0;f<p.count;f++)h.add(Lu,a[l[p.indexOffset+f]],Lu);h.equalsEpsilon(h.ZERO,Lu,R.EPSILON10)&&h.clone(a[l[p.indexOffset]],Lu)}h.equalsEpsilon(h.ZERO,Lu,R.EPSILON10)&&(Lu.z=1),h.normalize(Lu,Lu),g[m]=Lu.x,g[m+1]=Lu.y,g[m+2]=Lu.z}return e.attributes.normal=new we({componentDatatype:$.FLOAT,componentsPerAttribute:3,values:g}),e};var ove=new h,OJ=new h,rve=new h;dc.computeTangentAndBitangent=function(e){if(!c(e))throw new E("geometry is required.");let t=e.attributes,n=e.indices;if(!c(t.position)||!c(t.position.values))throw new E("geometry.attributes.position.values is required.");if(!c(t.normal)||!c(t.normal.values))throw new E("geometry.attributes.normal.values is required.");if(!c(t.st)||!c(t.st.values))throw new E("geometry.attributes.st.values is required.");if(!c(n))throw new E("geometry.indices is required.");if(n.length<2||n.length%3!==0)throw new E("geometry.indices length must be greater than 0 and be a multiple of 3.");if(e.primitiveType!==Me.TRIANGLES)throw new E("geometry.primitiveType must be PrimitiveType.TRIANGLES.");let i=e.attributes.position.values,o=e.attributes.normal.values,r=e.attributes.st.values,s=e.attributes.position.values.length/3,a=n.length,l=new Array(s*3),u;for(u=0;u<l.length;u++)l[u]=0;let f,d,p;for(u=0;u<a;u+=3){let b=n[u],x=n[u+1],T=n[u+2];f=b*3,d=x*3,p=T*3;let C=b*2,S=x*2,v=T*2,D=i[f],I=i[f+1],L=i[f+2],M=r[C],N=r[C+1],B=r[S+1]-N,_=r[v+1]-N,w=1/((r[S]-M)*_-(r[v]-M)*B),P=(_*(i[d]-D)-B*(i[p]-D))*w,O=(_*(i[d+1]-I)-B*(i[p+1]-I))*w,F=(_*(i[d+2]-L)-B*(i[p+2]-L))*w;l[f]+=P,l[f+1]+=O,l[f+2]+=F,l[d]+=P,l[d+1]+=O,l[d+2]+=F,l[p]+=P,l[p+1]+=O,l[p+2]+=F}let g=new Float32Array(s*3),m=new Float32Array(s*3);for(u=0;u<s;u++){f=u*3,d=f+1,p=f+2;let b=h.fromArray(o,f,ove),x=h.fromArray(l,f,rve),T=h.dot(b,x);h.multiplyByScalar(b,T,OJ),h.normalize(h.subtract(x,OJ,x),x),g[f]=x.x,g[d]=x.y,g[p]=x.z,h.normalize(h.cross(b,x,x),x),m[f]=x.x,m[d]=x.y,m[p]=x.z}return e.attributes.tangent=new we({componentDatatype:$.FLOAT,componentsPerAttribute:3,values:g}),e.attributes.bitangent=new we({componentDatatype:$.FLOAT,componentsPerAttribute:3,values:m}),e};var vE=new H,zf=new h,RJ=new h,MJ=new h,PI=new H;dc.compressVertices=function(e){if(!c(e))throw new E("geometry is required.");let t=e.attributes.extrudeDirection,n,i;if(c(t)){let I=t.values;i=I.length/3;let L=new Float32Array(i*2),M=0;for(n=0;n<i;++n){if(h.fromArray(I,n*3,zf),h.equals(zf,h.ZERO)){M+=2;continue}PI=Nn.octEncodeInRange(zf,65535,PI),L[M++]=PI.x,L[M++]=PI.y}return e.attributes.compressedAttributes=new we({componentDatatype:$.FLOAT,componentsPerAttribute:2,values:L}),delete e.attributes.extrudeDirection,e}let o=e.attributes.normal,r=e.attributes.st,s=c(o),a=c(r);if(!s&&!a)return e;let l=e.attributes.tangent,u=e.attributes.bitangent,f=c(l),d=c(u),p,g,m,b;s&&(p=o.values),a&&(g=r.values),f&&(m=l.values),d&&(b=u.values),i=(s?p.length:g.length)/(s?3:2);let C=i,S=a&&s?2:1;S+=f||d?1:0,C*=S;let v=new Float32Array(C),D=0;for(n=0;n<i;++n){a&&(H.fromArray(g,n*2,vE),v[D++]=Nn.compressTextureCoordinates(vE));let I=n*3;s&&c(m)&&c(b)?(h.fromArray(p,I,zf),h.fromArray(m,I,RJ),h.fromArray(b,I,MJ),Nn.octPack(zf,RJ,MJ,vE),v[D++]=vE.x,v[D++]=vE.y):(s&&(h.fromArray(p,I,zf),v[D++]=Nn.octEncodeFloat(zf)),f&&(h.fromArray(m,I,zf),v[D++]=Nn.octEncodeFloat(zf)),d&&(h.fromArray(b,I,zf),v[D++]=Nn.octEncodeFloat(zf)))}return e.attributes.compressedAttributes=new we({componentDatatype:$.FLOAT,componentsPerAttribute:S,values:v}),s&&delete e.attributes.normal,a&&delete e.attributes.st,d&&delete e.attributes.bitangent,f&&delete e.attributes.tangent,e};function sve(e){if(c(e.indices))return e;let t=ut.computeNumberOfVertices(e);if(t<3)throw new E("The number of vertices must be at least three.");if(t%3!==0)throw new E("The number of vertices must be a multiple of three.");let n=Fe.createTypedArray(t,t);for(let i=0;i<t;++i)n[i]=i;return e.indices=n,e}function ave(e){let t=ut.computeNumberOfVertices(e);if(t<3)throw new E("The number of vertices must be at least three.");let n=Fe.createTypedArray(t,(t-2)*3);n[0]=1,n[1]=0,n[2]=2;let i=3;for(let o=3;o<t;++o)n[i++]=o-1,n[i++]=0,n[i++]=o;return e.indices=n,e.primitiveType=Me.TRIANGLES,e}function cve(e){let t=ut.computeNumberOfVertices(e);if(t<3)throw new E("The number of vertices must be at least 3.");let n=Fe.createTypedArray(t,(t-2)*3);n[0]=0,n[1]=1,n[2]=2,t>3&&(n[3]=0,n[4]=2,n[5]=3);let i=6;for(let o=3;o<t-1;o+=2)n[i++]=o,n[i++]=o-1,n[i++]=o+1,o+2<t&&(n[i++]=o,n[i++]=o+1,n[i++]=o+2);return e.indices=n,e.primitiveType=Me.TRIANGLES,e}function lve(e){if(c(e.indices))return e;let t=ut.computeNumberOfVertices(e);if(t<2)throw new E("The number of vertices must be at least two.");if(t%2!==0)throw new E("The number of vertices must be a multiple of 2.");let n=Fe.createTypedArray(t,t);for(let i=0;i<t;++i)n[i]=i;return e.indices=n,e}function uve(e){let t=ut.computeNumberOfVertices(e);if(t<2)throw new E("The number of vertices must be at least two.");let n=Fe.createTypedArray(t,(t-1)*2);n[0]=0,n[1]=1;let i=2;for(let o=2;o<t;++o)n[i++]=o-1,n[i++]=o;return e.indices=n,e.primitiveType=Me.LINES,e}function fve(e){let t=ut.computeNumberOfVertices(e);if(t<2)throw new E("The number of vertices must be at least two.");let n=Fe.createTypedArray(t,t*2);n[0]=0,n[1]=1;let i=2;for(let o=2;o<t;++o)n[i++]=o-1,n[i++]=o;return n[i++]=t-1,n[i]=0,e.indices=n,e.primitiveType=Me.LINES,e}function dve(e){switch(e.primitiveType){case Me.TRIANGLE_FAN:return ave(e);case Me.TRIANGLE_STRIP:return cve(e);case Me.TRIANGLES:return sve(e);case Me.LINE_STRIP:return uve(e);case Me.LINE_LOOP:return fve(e);case Me.LINES:return lve(e)}return e}function T_(e,t){Math.abs(e.y)<R.EPSILON6&&(t?e.y=-R.EPSILON6:e.y=R.EPSILON6)}function hve(e,t,n){if(e.y!==0&&t.y!==0&&n.y!==0){T_(e,e.y<0),T_(t,t.y<0),T_(n,n.y<0);return}let i=Math.abs(e.y),o=Math.abs(t.y),r=Math.abs(n.y),s;i>o?i>r?s=R.sign(e.y):s=R.sign(n.y):o>r?s=R.sign(t.y):s=R.sign(n.y);let a=s<0;T_(e,a),T_(t,a),T_(n,a)}var LJ=new h;function Nu(e,t,n,i){h.add(e,h.multiplyByScalar(h.subtract(t,e,LJ),e.y/(e.y-t.y),LJ),n),h.clone(n,i),T_(n,!0),T_(i,!1)}var Vy=new h,Uy=new h,zy=new h,Hy=new h,LB={positions:new Array(7),indices:new Array(3*3)};function mve(e,t,n){if(e.x>=0||t.x>=0||n.x>=0)return;hve(e,t,n);let i=e.y<0,o=t.y<0,r=n.y<0,s=0;s+=i?1:0,s+=o?1:0,s+=r?1:0;let a=LB.indices;s===1?(a[1]=3,a[2]=4,a[5]=6,a[7]=6,a[8]=5,i?(Nu(e,t,Vy,zy),Nu(e,n,Uy,Hy),a[0]=0,a[3]=1,a[4]=2,a[6]=1):o?(Nu(t,n,Vy,zy),Nu(t,e,Uy,Hy),a[0]=1,a[3]=2,a[4]=0,a[6]=2):r&&(Nu(n,e,Vy,zy),Nu(n,t,Uy,Hy),a[0]=2,a[3]=0,a[4]=1,a[6]=0)):s===2&&(a[2]=4,a[4]=4,a[5]=3,a[7]=5,a[8]=6,i?o?r||(Nu(n,e,Vy,zy),Nu(n,t,Uy,Hy),a[0]=0,a[1]=1,a[3]=0,a[6]=2):(Nu(t,n,Vy,zy),Nu(t,e,Uy,Hy),a[0]=2,a[1]=0,a[3]=2,a[6]=1):(Nu(e,t,Vy,zy),Nu(e,n,Uy,Hy),a[0]=1,a[1]=2,a[3]=1,a[6]=0));let l=LB.positions;return l[0]=e,l[1]=t,l[2]=n,l.length=3,(s===1||s===2)&&(l[3]=Vy,l[4]=Uy,l[5]=zy,l[6]=Hy,l.length=7),LB}function NJ(e,t){let n=e.attributes;if(n.position.values.length===0)return;for(let o in n)if(n.hasOwnProperty(o)&&c(n[o])&&c(n[o].values)){let r=n[o];r.values=$.createTypedArray(r.componentDatatype,r.values)}let i=ut.computeNumberOfVertices(e);return e.indices=Fe.createTypedArray(i,e.indices),t&&(e.boundingSphere=ce.fromVertices(n.position.values)),e}function Hx(e){let t=e.attributes,n={};for(let i in t)if(t.hasOwnProperty(i)&&c(t[i])&&c(t[i].values)){let o=t[i];n[i]=new we({componentDatatype:o.componentDatatype,componentsPerAttribute:o.componentsPerAttribute,normalize:o.normalize,values:[]})}return new ut({attributes:n,indices:[],primitiveType:e.primitiveType})}function kB(e,t,n){let i=c(e.geometry.boundingSphere);t=NJ(t,i),n=NJ(n,i),c(n)&&!c(t)?e.geometry=n:!c(n)&&c(t)?e.geometry=t:(e.westHemisphereGeometry=t,e.eastHemisphereGeometry=n,e.geometry=void 0)}function VB(e,t){let n=new e,i=new e,o=new e;return function(r,s,a,l,u,f,d,p){let g=e.fromArray(u,r*t,n),m=e.fromArray(u,s*t,i),b=e.fromArray(u,a*t,o);e.multiplyByScalar(g,l.x,g),e.multiplyByScalar(m,l.y,m),e.multiplyByScalar(b,l.z,b);let x=e.add(g,m,g);e.add(x,b,x),p&&e.normalize(x,x),e.pack(x,f,d*t)}}var pve=VB(se,4),RI=VB(h,3),zJ=VB(H,2),_ve=function(e,t,n,i,o,r,s){let a=o[e]*i.x,l=o[t]*i.y,u=o[n]*i.z;r[s]=a+l+u>R.EPSILON6?1:0},DE=new h,NB=new h,FB=new h,gve=new h;function II(e,t,n,i,o,r,s,a,l,u,f,d,p,g,m,b){if(!c(r)&&!c(s)&&!c(a)&&!c(l)&&!c(u)&&g===0)return;let x=h.fromArray(o,e*3,DE),T=h.fromArray(o,t*3,NB),C=h.fromArray(o,n*3,FB),S=CE(i,x,T,C,gve);if(c(S)){if(c(r)&&RI(e,t,n,S,r,d.normal.values,b,!0),c(u)){let v=h.fromArray(u,e*3,DE),D=h.fromArray(u,t*3,NB),I=h.fromArray(u,n*3,FB);h.multiplyByScalar(v,S.x,v),h.multiplyByScalar(D,S.y,D),h.multiplyByScalar(I,S.z,I);let L;!h.equals(v,h.ZERO)||!h.equals(D,h.ZERO)||!h.equals(I,h.ZERO)?(L=h.add(v,D,v),h.add(L,I,L),h.normalize(L,L)):(L=DE,L.x=0,L.y=0,L.z=0),h.pack(L,d.extrudeDirection.values,b*3)}if(c(f)&&_ve(e,t,n,S,f,d.applyOffset.values,b),c(s)&&RI(e,t,n,S,s,d.tangent.values,b,!0),c(a)&&RI(e,t,n,S,a,d.bitangent.values,b,!0),c(l)&&zJ(e,t,n,S,l,d.st.values,b),g>0)for(let v=0;v<g;v++){let D=p[v];yve(e,t,n,S,b,m[D],d[D])}}}function yve(e,t,n,i,o,r,s){let a=r.componentsPerAttribute,l=r.values,u=s.values;switch(a){case 4:pve(e,t,n,i,l,u,o,!1);break;case 3:RI(e,t,n,i,l,u,o,!1);break;case 2:zJ(e,t,n,i,l,u,o,!1);break;default:u[o]=l[e]*i.x+l[t]*i.y+l[n]*i.z}}function oh(e,t,n,i,o,r){let s=e.position.values.length/3;if(o!==-1){let a=i[o],l=n[a];return l===-1?(n[a]=s,e.position.values.push(r.x,r.y,r.z),t.push(s),s):(t.push(l),l)}return e.position.values.push(r.x,r.y,r.z),t.push(s),s}var bve={position:!0,normal:!0,bitangent:!0,tangent:!0,st:!0,extrudeDirection:!0,applyOffset:!0};function FJ(e){let t=e.geometry,n=t.attributes,i=n.position.values,o=c(n.normal)?n.normal.values:void 0,r=c(n.bitangent)?n.bitangent.values:void 0,s=c(n.tangent)?n.tangent.values:void 0,a=c(n.st)?n.st.values:void 0,l=c(n.extrudeDirection)?n.extrudeDirection.values:void 0,u=c(n.applyOffset)?n.applyOffset.values:void 0,f=t.indices,d=[];for(let L in n)n.hasOwnProperty(L)&&!bve[L]&&c(n[L])&&d.push(L);let p=d.length,g=Hx(t),m=Hx(t),b,x,T,C,S,v=[];v.length=i.length/3;let D=[];for(D.length=i.length/3,S=0;S<v.length;++S)v[S]=-1,D[S]=-1;let I=f.length;for(S=0;S<I;S+=3){let L=f[S],M=f[S+1],N=f[S+2],B=h.fromArray(i,L*3),_=h.fromArray(i,M*3),w=h.fromArray(i,N*3),P=mve(B,_,w);if(c(P)&&P.positions.length>3){let O=P.positions,F=P.indices,V=F.length;for(let G=0;G<V;++G){let z=F[G],W=O[z];W.y<0?(b=m.attributes,x=m.indices,T=v):(b=g.attributes,x=g.indices,T=D),C=oh(b,x,T,f,z<3?S+z:-1,W),II(L,M,N,W,i,o,s,r,a,l,u,b,d,p,n,C)}}else c(P)&&(B=P.positions[0],_=P.positions[1],w=P.positions[2]),B.y<0?(b=m.attributes,x=m.indices,T=v):(b=g.attributes,x=g.indices,T=D),C=oh(b,x,T,f,S,B),II(L,M,N,B,i,o,s,r,a,l,u,b,d,p,n,C),C=oh(b,x,T,f,S+1,_),II(L,M,N,_,i,o,s,r,a,l,u,b,d,p,n,C),C=oh(b,x,T,f,S+2,w),II(L,M,N,w,i,o,s,r,a,l,u,b,d,p,n,C)}kB(e,m,g)}var HJ=un.fromPointNormal(h.ZERO,h.UNIT_Y),xve=new h,Tve=new h;function zx(e,t,n,i,o,r,s){if(!c(s))return;let a=h.fromArray(i,e*3,DE);h.equalsEpsilon(a,n,R.EPSILON10)?r.applyOffset.values[o]=s[e]:r.applyOffset.values[o]=s[t]}function BJ(e){let t=e.geometry,n=t.attributes,i=n.position.values,o=c(n.applyOffset)?n.applyOffset.values:void 0,r=t.indices,s=Hx(t),a=Hx(t),l,u=r.length,f=[];f.length=i.length/3;let d=[];for(d.length=i.length/3,l=0;l<f.length;++l)f[l]=-1,d[l]=-1;for(l=0;l<u;l+=2){let p=r[l],g=r[l+1],m=h.fromArray(i,p*3,DE),b=h.fromArray(i,g*3,NB),x;Math.abs(m.y)<R.EPSILON6&&(m.y<0?m.y=-R.EPSILON6:m.y=R.EPSILON6),Math.abs(b.y)<R.EPSILON6&&(b.y<0?b.y=-R.EPSILON6:b.y=R.EPSILON6);let T=s.attributes,C=s.indices,S=d,v=a.attributes,D=a.indices,I=f,L=Qn.lineSegmentPlane(m,b,HJ,FB);if(c(L)){let M=h.multiplyByScalar(h.UNIT_Y,5*R.EPSILON9,xve);m.y<0&&(h.negate(M,M),T=a.attributes,C=a.indices,S=f,v=s.attributes,D=s.indices,I=d);let N=h.add(L,M,Tve);x=oh(T,C,S,r,l,m),zx(p,g,m,i,x,T,o),x=oh(T,C,S,r,-1,N),zx(p,g,N,i,x,T,o),h.negate(M,M),h.add(L,M,N),x=oh(v,D,I,r,-1,N),zx(p,g,N,i,x,v,o),x=oh(v,D,I,r,l+1,b),zx(p,g,b,i,x,v,o)}else{let M,N,B;m.y<0?(M=a.attributes,N=a.indices,B=f):(M=s.attributes,N=s.indices,B=d),x=oh(M,N,B,r,l,m),zx(p,g,m,i,x,M,o),x=oh(M,N,B,r,l+1,b),zx(p,g,b,i,x,M,o)}}kB(e,a,s)}var kJ=new H,Ave=new H,GJ=new h,jJ=new h,BB=new h,Cve=new h,Eve=new h,Sve=new h,VJ=new se;function UJ(e){let t=e.attributes,n=t.position.values,i=t.prevPosition.values,o=t.nextPosition.values,r=n.length;for(let s=0;s<r;s+=3){let a=h.unpack(n,s,GJ);if(a.x>0)continue;let l=h.unpack(i,s,jJ);(a.y<0&&l.y>0||a.y>0&&l.y<0)&&(s-3>0?(i[s]=n[s-3],i[s+1]=n[s-2],i[s+2]=n[s-1]):h.pack(a,i,s));let u=h.unpack(o,s,BB);(a.y<0&&u.y>0||a.y>0&&u.y<0)&&(s+3<r?(o[s]=n[s+3],o[s+1]=n[s+4],o[s+2]=n[s+5]):h.pack(a,o,s))}}var wve=5*R.EPSILON9,OI=R.EPSILON6;function vve(e){let t=e.geometry,n=t.attributes,i=n.position.values,o=n.prevPosition.values,r=n.nextPosition.values,s=n.expandAndWidth.values,a=c(n.st)?n.st.values:void 0,l=c(n.color)?n.color.values:void 0,u=Hx(t),f=Hx(t),d,p,g,m=!1,b=i.length/3;for(d=0;d<b;d+=4){let x=d,T=d+2,C=h.fromArray(i,x*3,GJ),S=h.fromArray(i,T*3,jJ);if(Math.abs(C.y)<OI)for(C.y=OI*(S.y<0?-1:1),i[d*3+1]=C.y,i[(d+1)*3+1]=C.y,p=x*3;p<x*3+4*3;p+=3)o[p]=i[d*3],o[p+1]=i[d*3+1],o[p+2]=i[d*3+2];if(Math.abs(S.y)<OI)for(S.y=OI*(C.y<0?-1:1),i[(d+2)*3+1]=S.y,i[(d+3)*3+1]=S.y,p=x*3;p<x*3+4*3;p+=3)r[p]=i[(d+2)*3],r[p+1]=i[(d+2)*3+1],r[p+2]=i[(d+2)*3+2];let v=u.attributes,D=u.indices,I=f.attributes,L=f.indices,M=Qn.lineSegmentPlane(C,S,HJ,Cve);if(c(M)){m=!0;let N=h.multiplyByScalar(h.UNIT_Y,wve,Eve);C.y<0&&(h.negate(N,N),v=f.attributes,D=f.indices,I=u.attributes,L=u.indices);let B=h.add(M,N,Sve);v.position.values.push(C.x,C.y,C.z,C.x,C.y,C.z),v.position.values.push(B.x,B.y,B.z),v.position.values.push(B.x,B.y,B.z),v.prevPosition.values.push(o[x*3],o[x*3+1],o[x*3+2]),v.prevPosition.values.push(o[x*3+3],o[x*3+4],o[x*3+5]),v.prevPosition.values.push(C.x,C.y,C.z,C.x,C.y,C.z),v.nextPosition.values.push(B.x,B.y,B.z),v.nextPosition.values.push(B.x,B.y,B.z),v.nextPosition.values.push(B.x,B.y,B.z),v.nextPosition.values.push(B.x,B.y,B.z),h.negate(N,N),h.add(M,N,B),I.position.values.push(B.x,B.y,B.z),I.position.values.push(B.x,B.y,B.z),I.position.values.push(S.x,S.y,S.z,S.x,S.y,S.z),I.prevPosition.values.push(B.x,B.y,B.z),I.prevPosition.values.push(B.x,B.y,B.z),I.prevPosition.values.push(B.x,B.y,B.z),I.prevPosition.values.push(B.x,B.y,B.z),I.nextPosition.values.push(S.x,S.y,S.z,S.x,S.y,S.z),I.nextPosition.values.push(r[T*3],r[T*3+1],r[T*3+2]),I.nextPosition.values.push(r[T*3+3],r[T*3+4],r[T*3+5]);let _=H.fromArray(s,x*2,kJ),w=Math.abs(_.y);v.expandAndWidth.values.push(-1,w,1,w),v.expandAndWidth.values.push(-1,-w,1,-w),I.expandAndWidth.values.push(-1,w,1,w),I.expandAndWidth.values.push(-1,-w,1,-w);let P=h.magnitudeSquared(h.subtract(M,C,BB));if(P/=h.magnitudeSquared(h.subtract(S,C,BB)),c(l)){let O=se.fromArray(l,x*4,VJ),F=se.fromArray(l,T*4,VJ),V=R.lerp(O.x,F.x,P),G=R.lerp(O.y,F.y,P),z=R.lerp(O.z,F.z,P),W=R.lerp(O.w,F.w,P);for(p=x*4;p<x*4+2*4;++p)v.color.values.push(l[p]);for(v.color.values.push(V,G,z,W),v.color.values.push(V,G,z,W),I.color.values.push(V,G,z,W),I.color.values.push(V,G,z,W),p=T*4;p<T*4+2*4;++p)I.color.values.push(l[p])}if(c(a)){let O=H.fromArray(a,x*2,kJ),F=H.fromArray(a,(d+3)*2,Ave),V=R.lerp(O.x,F.x,P);for(p=x*2;p<x*2+2*2;++p)v.st.values.push(a[p]);for(v.st.values.push(V,O.y),v.st.values.push(V,F.y),I.st.values.push(V,O.y),I.st.values.push(V,F.y),p=T*2;p<T*2+2*2;++p)I.st.values.push(a[p])}g=v.position.values.length/3-4,D.push(g,g+2,g+1),D.push(g+1,g+2,g+3),g=I.position.values.length/3-4,L.push(g,g+2,g+1),L.push(g+1,g+2,g+3)}else{let N,B;for(C.y<0?(N=f.attributes,B=f.indices):(N=u.attributes,B=u.indices),N.position.values.push(C.x,C.y,C.z),N.position.values.push(C.x,C.y,C.z),N.position.values.push(S.x,S.y,S.z),N.position.values.push(S.x,S.y,S.z),p=d*3;p<d*3+4*3;++p)N.prevPosition.values.push(o[p]),N.nextPosition.values.push(r[p]);for(p=d*2;p<d*2+4*2;++p)N.expandAndWidth.values.push(s[p]),c(a)&&N.st.values.push(a[p]);if(c(l))for(p=d*4;p<d*4+4*4;++p)N.color.values.push(l[p]);g=N.position.values.length/3-4,B.push(g,g+2,g+1),B.push(g+1,g+2,g+3)}}m&&(UJ(f),UJ(u)),kB(e,f,u)}dc.splitLongitude=function(e){if(!c(e))throw new E("instance is required.");let t=e.geometry,n=t.boundingSphere;if(c(n)&&(n.center.x-n.radius>0||ce.intersectPlane(n,un.ORIGIN_ZX_PLANE)!==qt.INTERSECTING))return e;if(t.geometryType!==th.NONE)switch(t.geometryType){case th.POLYLINES:vve(e);break;case th.TRIANGLES:FJ(e);break;case th.LINES:BJ(e);break}else dve(t),t.primitiveType===Me.TRIANGLES?FJ(e):t.primitiveType===Me.LINES&&BJ(e);return e};var Fn=dc;var ti={UNSIGNED_BYTE:ne.UNSIGNED_BYTE,UNSIGNED_SHORT:ne.UNSIGNED_SHORT,UNSIGNED_INT:ne.UNSIGNED_INT,FLOAT:ne.FLOAT,HALF_FLOAT:ne.HALF_FLOAT_OES,UNSIGNED_INT_24_8:ne.UNSIGNED_INT_24_8,UNSIGNED_SHORT_4_4_4_4:ne.UNSIGNED_SHORT_4_4_4_4,UNSIGNED_SHORT_5_5_5_1:ne.UNSIGNED_SHORT_5_5_5_1,UNSIGNED_SHORT_5_6_5:ne.UNSIGNED_SHORT_5_6_5};ti.toWebGLConstant=function(e,t){switch(e){case ti.UNSIGNED_BYTE:return ne.UNSIGNED_BYTE;case ti.UNSIGNED_SHORT:return ne.UNSIGNED_SHORT;case ti.UNSIGNED_INT:return ne.UNSIGNED_INT;case ti.FLOAT:return ne.FLOAT;case ti.HALF_FLOAT:return t.webgl2?ne.HALF_FLOAT:ne.HALF_FLOAT_OES;case ti.UNSIGNED_INT_24_8:return ne.UNSIGNED_INT_24_8;case ti.UNSIGNED_SHORT_4_4_4_4:return ne.UNSIGNED_SHORT_4_4_4_4;case ti.UNSIGNED_SHORT_5_5_5_1:return ne.UNSIGNED_SHORT_5_5_5_1;case ti.UNSIGNED_SHORT_5_6_5:return ti.UNSIGNED_SHORT_5_6_5}};ti.isPacked=function(e){return e===ti.UNSIGNED_INT_24_8||e===ti.UNSIGNED_SHORT_4_4_4_4||e===ti.UNSIGNED_SHORT_5_5_5_1||e===ti.UNSIGNED_SHORT_5_6_5};ti.sizeInBytes=function(e){switch(e){case ti.UNSIGNED_BYTE:return 1;case ti.UNSIGNED_SHORT:case ti.UNSIGNED_SHORT_4_4_4_4:case ti.UNSIGNED_SHORT_5_5_5_1:case ti.UNSIGNED_SHORT_5_6_5:case ti.HALF_FLOAT:return 2;case ti.UNSIGNED_INT:case ti.FLOAT:case ti.UNSIGNED_INT_24_8:return 4}};ti.validate=function(e){return e===ti.UNSIGNED_BYTE||e===ti.UNSIGNED_SHORT||e===ti.UNSIGNED_INT||e===ti.FLOAT||e===ti.HALF_FLOAT||e===ti.UNSIGNED_INT_24_8||e===ti.UNSIGNED_SHORT_4_4_4_4||e===ti.UNSIGNED_SHORT_5_5_5_1||e===ti.UNSIGNED_SHORT_5_6_5};ti.getTypedArrayConstructor=function(e){let t=ti.sizeInBytes(e);return t===Uint8Array.BYTES_PER_ELEMENT?Uint8Array:t===Uint16Array.BYTES_PER_ELEMENT?Uint16Array:t===Float32Array.BYTES_PER_ELEMENT&&e===ti.FLOAT?Float32Array:Uint32Array};var Be=Object.freeze(ti);var ot={DEPTH_COMPONENT:ne.DEPTH_COMPONENT,DEPTH_STENCIL:ne.DEPTH_STENCIL,ALPHA:ne.ALPHA,RED:ne.RED,RG:ne.RG,RGB:ne.RGB,RGBA:ne.RGBA,RGBA_INTEGER:ne.RGBA_INTEGER,LUMINANCE:ne.LUMINANCE,LUMINANCE_ALPHA:ne.LUMINANCE_ALPHA,RGB_DXT1:ne.COMPRESSED_RGB_S3TC_DXT1_EXT,RGBA_DXT1:ne.COMPRESSED_RGBA_S3TC_DXT1_EXT,RGBA_DXT3:ne.COMPRESSED_RGBA_S3TC_DXT3_EXT,RGBA_DXT5:ne.COMPRESSED_RGBA_S3TC_DXT5_EXT,RGB_PVRTC_4BPPV1:ne.COMPRESSED_RGB_PVRTC_4BPPV1_IMG,RGB_PVRTC_2BPPV1:ne.COMPRESSED_RGB_PVRTC_2BPPV1_IMG,RGBA_PVRTC_4BPPV1:ne.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG,RGBA_PVRTC_2BPPV1:ne.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG,RGBA_ASTC:ne.COMPRESSED_RGBA_ASTC_4x4_WEBGL,RGB_ETC1:ne.COMPRESSED_RGB_ETC1_WEBGL,RGB8_ETC2:ne.COMPRESSED_RGB8_ETC2,RGBA8_ETC2_EAC:ne.COMPRESSED_RGBA8_ETC2_EAC,RGBA_BC7:ne.COMPRESSED_RGBA_BPTC_UNORM};ot.componentsLength=function(e){switch(e){case ot.RGB:return 3;case ot.RGBA:case ot.RGBA_INTEGER:return 4;case ot.LUMINANCE_ALPHA:case ot.RG:return 2;case ot.ALPHA:case ot.RED:case ot.LUMINANCE:return 1;default:return 1}};ot.validate=function(e){return e===ot.DEPTH_COMPONENT||e===ot.DEPTH_STENCIL||e===ot.ALPHA||e===ot.RED||e===ot.RG||e===ot.RGB||e===ot.RGBA||e===ot.RGBA_INTEGER||e===ot.LUMINANCE||e===ot.LUMINANCE_ALPHA||e===ot.RGB_DXT1||e===ot.RGBA_DXT1||e===ot.RGBA_DXT3||e===ot.RGBA_DXT5||e===ot.RGB_PVRTC_4BPPV1||e===ot.RGB_PVRTC_2BPPV1||e===ot.RGBA_PVRTC_4BPPV1||e===ot.RGBA_PVRTC_2BPPV1||e===ot.RGBA_ASTC||e===ot.RGB_ETC1||e===ot.RGB8_ETC2||e===ot.RGBA8_ETC2_EAC||e===ot.RGBA_BC7};ot.isColorFormat=function(e){return e===ot.RED||e===ot.ALPHA||e===ot.RGB||e===ot.RGBA||e===ot.RGBA_INTEGER||e===ot.LUMINANCE||e===ot.LUMINANCE_ALPHA};ot.isDepthFormat=function(e){return e===ot.DEPTH_COMPONENT||e===ot.DEPTH_STENCIL};ot.isCompressedFormat=function(e){return e===ot.RGB_DXT1||e===ot.RGBA_DXT1||e===ot.RGBA_DXT3||e===ot.RGBA_DXT5||e===ot.RGB_PVRTC_4BPPV1||e===ot.RGB_PVRTC_2BPPV1||e===ot.RGBA_PVRTC_4BPPV1||e===ot.RGBA_PVRTC_2BPPV1||e===ot.RGBA_ASTC||e===ot.RGB_ETC1||e===ot.RGB8_ETC2||e===ot.RGBA8_ETC2_EAC||e===ot.RGBA_BC7};ot.isDXTFormat=function(e){return e===ot.RGB_DXT1||e===ot.RGBA_DXT1||e===ot.RGBA_DXT3||e===ot.RGBA_DXT5};ot.isPVRTCFormat=function(e){return e===ot.RGB_PVRTC_4BPPV1||e===ot.RGB_PVRTC_2BPPV1||e===ot.RGBA_PVRTC_4BPPV1||e===ot.RGBA_PVRTC_2BPPV1};ot.isASTCFormat=function(e){return e===ot.RGBA_ASTC};ot.isETC1Format=function(e){return e===ot.RGB_ETC1};ot.isETC2Format=function(e){return e===ot.RGB8_ETC2||e===ot.RGBA8_ETC2_EAC};ot.isBC7Format=function(e){return e===ot.RGBA_BC7};ot.compressedTextureSizeInBytes=function(e,t,n){switch(e){case ot.RGB_DXT1:case ot.RGBA_DXT1:case ot.RGB_ETC1:case ot.RGB8_ETC2:return Math.floor((t+3)/4)*Math.floor((n+3)/4)*8;case ot.RGBA_DXT3:case ot.RGBA_DXT5:case ot.RGBA_ASTC:case ot.RGBA8_ETC2_EAC:return Math.floor((t+3)/4)*Math.floor((n+3)/4)*16;case ot.RGB_PVRTC_4BPPV1:case ot.RGBA_PVRTC_4BPPV1:return Math.floor((Math.max(t,8)*Math.max(n,8)*4+7)/8);case ot.RGB_PVRTC_2BPPV1:case ot.RGBA_PVRTC_2BPPV1:return Math.floor((Math.max(t,16)*Math.max(n,8)*2+7)/8);case ot.RGBA_BC7:return Math.ceil(t/4)*Math.ceil(n/4)*16;default:return 0}};ot.textureSizeInBytes=function(e,t,n,i){let o=ot.componentsLength(e);return Be.isPacked(t)&&(o=1),o*Be.sizeInBytes(t)*n*i};ot.alignmentInBytes=function(e,t,n){let i=ot.textureSizeInBytes(e,t,n,1)%4;return i===0?4:i===2?2:1};ot.createTypedArray=function(e,t,n,i){let o=Be.getTypedArrayConstructor(t),r=ot.componentsLength(e)*n*i;return new o(r)};ot.flipY=function(e,t,n,i,o){if(o===1)return e;let r=ot.createTypedArray(t,n,i,o),s=ot.componentsLength(t),a=i*s;for(let l=0;l<o;++l){let u=l*i*s,f=(o-l-1)*i*s;for(let d=0;d<a;++d)r[f+d]=e[u+d]}return r};ot.toInternalFormat=function(e,t,n){if(!n.webgl2)return e;if(e===ot.DEPTH_STENCIL)return ne.DEPTH24_STENCIL8;if(e===ot.DEPTH_COMPONENT){if(t===Be.UNSIGNED_SHORT)return ne.DEPTH_COMPONENT16;if(t===Be.UNSIGNED_INT)return ne.DEPTH_COMPONENT24}if(t===Be.FLOAT)switch(e){case ot.RGBA:return ne.RGBA32F;case ot.RGB:return ne.RGB32F;case ot.RG:return ne.RG32F;case ot.RED:return ne.R32F}if(t===Be.HALF_FLOAT)switch(e){case ot.RGBA:return ne.RGBA16F;case ot.RGB:return ne.RGB16F;case ot.RG:return ne.RG16F;case ot.RED:return ne.R16F}if(e===ot.RGBA_INTEGER)switch(t){case Be.UNSIGNED_BYTE:return ne.RGBA8UI;case Be.UNSIGNED_SHORT:return ne.RGBA16UI;case Be.UNSIGNED_INT:return ne.RGBA32UI;case Be.BYTE:return ne.RGBA8I;case Be.SHORT:return ne.RGBA16I;case Be.INT:return ne.RGBA32I}return e};var Ve=Object.freeze(ot);var LI={STREAM_DRAW:ne.STREAM_DRAW,STATIC_DRAW:ne.STATIC_DRAW,DYNAMIC_DRAW:ne.DYNAMIC_DRAW,validate:function(e){return e===LI.STREAM_DRAW||e===LI.STATIC_DRAW||e===LI.DYNAMIC_DRAW}},ke=Object.freeze(LI);var fr={_maximumCombinedTextureImageUnits:0,_maximumCubeMapSize:0,_maximumFragmentUniformVectors:0,_maximumTextureImageUnits:0,_maximumRenderbufferSize:0,_maximumTextureSize:0,_maximumVaryingVectors:0,_maximumVertexAttributes:0,_maximumVertexTextureImageUnits:0,_maximumVertexUniformVectors:0,_minimumAliasedLineWidth:0,_maximumAliasedLineWidth:0,_minimumAliasedPointSize:0,_maximumAliasedPointSize:0,_maximumViewportWidth:0,_maximumViewportHeight:0,_maximumTextureFilterAnisotropy:0,_maximumDrawBuffers:0,_maximumColorAttachments:0,_maximumSamples:0,_highpFloatSupported:!1,_highpIntSupported:!1};Object.defineProperties(fr,{maximumCombinedTextureImageUnits:{get:function(){return fr._maximumCombinedTextureImageUnits}},maximumCubeMapSize:{get:function(){return fr._maximumCubeMapSize}},maximumFragmentUniformVectors:{get:function(){return fr._maximumFragmentUniformVectors}},maximumTextureImageUnits:{get:function(){return fr._maximumTextureImageUnits}},maximumRenderbufferSize:{get:function(){return fr._maximumRenderbufferSize}},maximumTextureSize:{get:function(){return fr._maximumTextureSize}},maximumVaryingVectors:{get:function(){return fr._maximumVaryingVectors}},maximumVertexAttributes:{get:function(){return fr._maximumVertexAttributes}},maximumVertexTextureImageUnits:{get:function(){return fr._maximumVertexTextureImageUnits}},maximumVertexUniformVectors:{get:function(){return fr._maximumVertexUniformVectors}},minimumAliasedLineWidth:{get:function(){return fr._minimumAliasedLineWidth}},maximumAliasedLineWidth:{get:function(){return fr._maximumAliasedLineWidth}},minimumAliasedPointSize:{get:function(){return fr._minimumAliasedPointSize}},maximumAliasedPointSize:{get:function(){return fr._maximumAliasedPointSize}},maximumViewportWidth:{get:function(){return fr._maximumViewportWidth}},maximumViewportHeight:{get:function(){return fr._maximumViewportHeight}},maximumTextureFilterAnisotropy:{get:function(){return fr._maximumTextureFilterAnisotropy}},maximumDrawBuffers:{get:function(){return fr._maximumDrawBuffers}},maximumColorAttachments:{get:function(){return fr._maximumColorAttachments}},maximumSamples:{get:function(){return fr._maximumSamples}},highpFloatSupported:{get:function(){return fr._highpFloatSupported}},highpIntSupported:{get:function(){return fr._highpIntSupported}}});var mt=fr;function PE(e,t,n,i,o,r,s,a,l,u,f){this._context=e,this._texture=t,this._textureTarget=n,this._targetFace=i,this._pixelDatatype=s,this._internalFormat=o,this._pixelFormat=r,this._size=a,this._preMultiplyAlpha=l,this._flipY=u,this._initialized=f}Object.defineProperties(PE.prototype,{pixelFormat:{get:function(){return this._pixelFormat}},pixelDatatype:{get:function(){return this._pixelDatatype}},_target:{get:function(){return this._targetFace}}});PE.prototype.copyFrom=function(e){A.defined("options",e);let{xOffset:t=0,yOffset:n=0,source:i,skipColorSpaceConversion:o=!1}=e;if(A.defined("options.source",i),A.typeOf.number.greaterThanOrEquals("xOffset",t,0),A.typeOf.number.greaterThanOrEquals("yOffset",n,0),t+i.width>this._size)throw new E("xOffset + options.source.width must be less than or equal to width.");if(n+i.height>this._size)throw new E("yOffset + options.source.height must be less than or equal to height.");let{width:r,height:s}=i,a=this._context._gl,l=this._textureTarget,u=this._targetFace;a.activeTexture(a.TEXTURE0),a.bindTexture(l,this._texture);let f=i.arrayBufferView,d=this._size,p=this._pixelFormat,g=this._internalFormat,m=this._pixelDatatype,b=this._preMultiplyAlpha,x=this._flipY,T=4;c(f)&&(T=Ve.alignmentInBytes(p,m,r)),a.pixelStorei(a.UNPACK_ALIGNMENT,T),o?a.pixelStorei(a.UNPACK_COLORSPACE_CONVERSION_WEBGL,a.NONE):a.pixelStorei(a.UNPACK_COLORSPACE_CONVERSION_WEBGL,a.BROWSER_DEFAULT_WEBGL);let C=!1;if(!this._initialized){let S;t===0&&n===0&&r===d&&s===d?(c(f)?(a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!1),x&&(f=Ve.flipY(f,p,m,d,d)),S=f):(a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,b),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,x),S=i),C=!0):(a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!1),S=Ve.createTypedArray(p,m,d,d)),a.texImage2D(u,0,g,d,d,0,p,Be.toWebGLConstant(m,this._context),S),this._initialized=!0}C||(c(f)?(a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!1),x&&(f=Ve.flipY(f,p,m,r,s)),a.texSubImage2D(u,0,t,n,r,s,p,Be.toWebGLConstant(m,this._context),f)):(a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,b),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,x),a.texSubImage2D(u,0,t,n,p,Be.toWebGLConstant(m,this._context),i))),a.bindTexture(l,null)};PE.prototype.copyFromFramebuffer=function(e,t,n,i,o,r){if(e=y(e,0),t=y(t,0),n=y(n,0),i=y(i,0),o=y(o,this._size),r=y(r,this._size),A.typeOf.number.greaterThanOrEquals("xOffset",e,0),A.typeOf.number.greaterThanOrEquals("yOffset",t,0),A.typeOf.number.greaterThanOrEquals("framebufferXOffset",n,0),A.typeOf.number.greaterThanOrEquals("framebufferYOffset",i,0),e+o>this._size)throw new E("xOffset + source.width must be less than or equal to width.");if(t+r>this._size)throw new E("yOffset + source.height must be less than or equal to height.");if(this._pixelDatatype===Be.FLOAT)throw new E("Cannot call copyFromFramebuffer when the texture pixel data type is FLOAT.");if(this._pixelDatatype===Be.HALF_FLOAT)throw new E("Cannot call copyFromFramebuffer when the texture pixel data type is HALF_FLOAT.");let s=this._context._gl,a=this._textureTarget;s.activeTexture(s.TEXTURE0),s.bindTexture(a,this._texture),s.copyTexSubImage2D(this._targetFace,0,e,t,n,i,o,r),s.bindTexture(a,null),this._initialized=!0};PE.prototype.copyMipmapFromFramebuffer=function(e,t,n,i,o){if(e=y(e,0),t=y(t,0),n=y(n,this._size),i=y(i,this._size),o=y(o,0),A.typeOf.number.greaterThanOrEquals("xOffset",e,0),A.typeOf.number.greaterThanOrEquals("yOffset",t,0),e+n>this._size)throw new E("xOffset + source.width must be less than or equal to width.");if(t+i>this._size)throw new E("yOffset + source.height must be less than or equal to height.");if(this._pixelDatatype===Be.FLOAT)throw new E("Cannot call copyFromFramebuffer when the texture pixel data type is FLOAT.");if(this._pixelDatatype===Be.HALF_FLOAT)throw new E("Cannot call copyFromFramebuffer when the texture pixel data type is HALF_FLOAT.");let r=this._context._gl,s=this._textureTarget;r.activeTexture(r.TEXTURE0),r.bindTexture(s,this._texture),r.copyTexImage2D(this._targetFace,o,this._internalFormat,e,t,n,i,0),r.bindTexture(s,null),this._initialized=!0};var UB=PE;function zB(e,t,n){let i=e._gl;i.framebufferTexture2D(i.FRAMEBUFFER,t,n._target,n._texture,0)}function NI(e,t,n){let i=e._gl;i.framebufferRenderbuffer(i.FRAMEBUFFER,t,i.RENDERBUFFER,n._getRenderbuffer())}function Gf(e){e=y(e,y.EMPTY_OBJECT);let t=e.context;A.defined("options.context",t);let n=t._gl,i=mt.maximumColorAttachments;if(this._gl=n,this._framebuffer=n.createFramebuffer(),this._colorTextures=[],this._colorRenderbuffers=[],this._activeColorAttachments=[],this._depthTexture=void 0,this._depthRenderbuffer=void 0,this._stencilRenderbuffer=void 0,this._depthStencilTexture=void 0,this._depthStencilRenderbuffer=void 0,this.destroyAttachments=y(e.destroyAttachments,!0),c(e.colorTextures)&&c(e.colorRenderbuffers))throw new E("Cannot have both color texture and color renderbuffer attachments.");if(c(e.depthTexture)&&c(e.depthRenderbuffer))throw new E("Cannot have both a depth texture and depth renderbuffer attachment.");if(c(e.depthStencilTexture)&&c(e.depthStencilRenderbuffer))throw new E("Cannot have both a depth-stencil texture and depth-stencil renderbuffer attachment.");let o=c(e.depthTexture)||c(e.depthRenderbuffer),r=c(e.depthStencilTexture)||c(e.depthStencilRenderbuffer);if(o&&r)throw new E("Cannot have both a depth and depth-stencil attachment.");if(c(e.stencilRenderbuffer)&&r)throw new E("Cannot have both a stencil and depth-stencil attachment.");if(o&&c(e.stencilRenderbuffer))throw new E("Cannot have both a depth and stencil attachment.");if(this._bind(),c(e.colorTextures)){let s=e.colorTextures,a=this._colorTextures.length=this._activeColorAttachments.length=s.length;if(a>i)throw new E("The number of color attachments exceeds the number supported.");for(let l=0;l<a;++l){let u=s[l];if(!Ve.isColorFormat(u.pixelFormat))throw new E("The color-texture pixel-format must be a color format.");if(u.pixelDatatype===Be.FLOAT&&!t.colorBufferFloat)throw new E("The color texture pixel datatype is FLOAT and the WebGL implementation does not support the EXT_color_buffer_float or WEBGL_color_buffer_float extensions. See Context.colorBufferFloat.");if(u.pixelDatatype===Be.HALF_FLOAT&&!t.colorBufferHalfFloat)throw new E("The color texture pixel datatype is HALF_FLOAT and the WebGL implementation does not support the EXT_color_buffer_half_float extension. See Context.colorBufferHalfFloat.");let f=this._gl.COLOR_ATTACHMENT0+l;zB(this,f,u),this._activeColorAttachments[l]=f,this._colorTextures[l]=u}}if(c(e.colorRenderbuffers)){let s=e.colorRenderbuffers,a=this._colorRenderbuffers.length=this._activeColorAttachments.length=s.length;if(a>i)throw new E("The number of color attachments exceeds the number supported.");for(let l=0;l<a;++l){let u=s[l],f=this._gl.COLOR_ATTACHMENT0+l;NI(this,f,u),this._activeColorAttachments[l]=f,this._colorRenderbuffers[l]=u}}if(c(e.depthTexture)){let s=e.depthTexture;if(s.pixelFormat!==Ve.DEPTH_COMPONENT)throw new E("The depth-texture pixel-format must be DEPTH_COMPONENT.");zB(this,this._gl.DEPTH_ATTACHMENT,s),this._depthTexture=s}if(c(e.depthRenderbuffer)){let s=e.depthRenderbuffer;NI(this,this._gl.DEPTH_ATTACHMENT,s),this._depthRenderbuffer=s}if(c(e.stencilRenderbuffer)){let s=e.stencilRenderbuffer;NI(this,this._gl.STENCIL_ATTACHMENT,s),this._stencilRenderbuffer=s}if(c(e.depthStencilTexture)){let s=e.depthStencilTexture;if(s.pixelFormat!==Ve.DEPTH_STENCIL)throw new E("The depth-stencil pixel-format must be DEPTH_STENCIL.");zB(this,this._gl.DEPTH_STENCIL_ATTACHMENT,s),this._depthStencilTexture=s}if(c(e.depthStencilRenderbuffer)){let s=e.depthStencilRenderbuffer;NI(this,this._gl.DEPTH_STENCIL_ATTACHMENT,s),this._depthStencilRenderbuffer=s}this._unBind()}Object.defineProperties(Gf.prototype,{status:{get:function(){this._bind();let e=this._gl.checkFramebufferStatus(this._gl.FRAMEBUFFER);return this._unBind(),e}},numberOfColorAttachments:{get:function(){return this._activeColorAttachments.length}},depthTexture:{get:function(){return this._depthTexture}},depthRenderbuffer:{get:function(){return this._depthRenderbuffer}},stencilRenderbuffer:{get:function(){return this._stencilRenderbuffer}},depthStencilTexture:{get:function(){return this._depthStencilTexture}},depthStencilRenderbuffer:{get:function(){return this._depthStencilRenderbuffer}},hasDepthAttachment:{get:function(){return!!(this.depthTexture||this.depthRenderbuffer||this.depthStencilTexture||this.depthStencilRenderbuffer)}}});Gf.prototype._bind=function(){let e=this._gl;e.bindFramebuffer(e.FRAMEBUFFER,this._framebuffer)};Gf.prototype._unBind=function(){let e=this._gl;e.bindFramebuffer(e.FRAMEBUFFER,null)};Gf.prototype.bindDraw=function(){let e=this._gl;e.bindFramebuffer(e.DRAW_FRAMEBUFFER,this._framebuffer)};Gf.prototype.bindRead=function(){let e=this._gl;e.bindFramebuffer(e.READ_FRAMEBUFFER,this._framebuffer)};Gf.prototype._getActiveColorAttachments=function(){return this._activeColorAttachments};Gf.prototype.getColorTexture=function(e){if(!c(e)||e<0||e>=this._colorTextures.length)throw new E("index is required, must be greater than or equal to zero and must be less than the number of color attachments.");return this._colorTextures[e]};Gf.prototype.getColorRenderbuffer=function(e){if(!c(e)||e<0||e>=this._colorRenderbuffers.length)throw new E("index is required, must be greater than or equal to zero and must be less than the number of color attachments.");return this._colorRenderbuffers[e]};Gf.prototype.isDestroyed=function(){return!1};Gf.prototype.destroy=function(){if(this.destroyAttachments){let e=this._colorTextures;for(let n=0;n<e.length;++n){let i=e[n];c(i)&&i.destroy()}let t=this._colorRenderbuffers;for(let n=0;n<t.length;++n){let i=t[n];c(i)&&i.destroy()}this._depthTexture=this._depthTexture&&this._depthTexture.destroy(),this._depthRenderbuffer=this._depthRenderbuffer&&this._depthRenderbuffer.destroy(),this._stencilRenderbuffer=this._stencilRenderbuffer&&this._stencilRenderbuffer.destroy(),this._depthStencilTexture=this._depthStencilTexture&&this._depthStencilTexture.destroy(),this._depthStencilRenderbuffer=this._depthStencilRenderbuffer&&this._depthStencilRenderbuffer.destroy()}return this._gl.deleteFramebuffer(this._framebuffer),de(this)};var Jr=Gf;var FI={DONT_CARE:ne.DONT_CARE,FASTEST:ne.FASTEST,NICEST:ne.NICEST,validate:function(e){return e===FI.DONT_CARE||e===FI.FASTEST||e===FI.NICEST}},rh=Object.freeze(FI);var BI={NEAREST:ne.NEAREST,LINEAR:ne.LINEAR};BI.validate=function(e){return e===BI.NEAREST||e===BI.LINEAR};var fi=Object.freeze(BI);var A_={NEAREST:ne.NEAREST,LINEAR:ne.LINEAR,NEAREST_MIPMAP_NEAREST:ne.NEAREST_MIPMAP_NEAREST,LINEAR_MIPMAP_NEAREST:ne.LINEAR_MIPMAP_NEAREST,NEAREST_MIPMAP_LINEAR:ne.NEAREST_MIPMAP_LINEAR,LINEAR_MIPMAP_LINEAR:ne.LINEAR_MIPMAP_LINEAR};A_.validate=function(e){return e===A_.NEAREST||e===A_.LINEAR||e===A_.NEAREST_MIPMAP_NEAREST||e===A_.LINEAR_MIPMAP_NEAREST||e===A_.NEAREST_MIPMAP_LINEAR||e===A_.LINEAR_MIPMAP_LINEAR};var $t=Object.freeze(A_);var kI={CLAMP_TO_EDGE:ne.CLAMP_TO_EDGE,REPEAT:ne.REPEAT,MIRRORED_REPEAT:ne.MIRRORED_REPEAT,validate:function(e){return e===kI.CLAMP_TO_EDGE||e===kI.REPEAT||e===kI.MIRRORED_REPEAT}},yn=Object.freeze(kI);function IE(e){e=y(e,y.EMPTY_OBJECT);let{wrapS:t=yn.CLAMP_TO_EDGE,wrapT:n=yn.CLAMP_TO_EDGE,minificationFilter:i=$t.LINEAR,magnificationFilter:o=fi.LINEAR,maximumAnisotropy:r=1}=e;if(!yn.validate(t))throw new E("Invalid sampler.wrapS.");if(!yn.validate(n))throw new E("Invalid sampler.wrapT.");if(!$t.validate(i))throw new E("Invalid sampler.minificationFilter.");if(!fi.validate(o))throw new E("Invalid sampler.magnificationFilter.");A.typeOf.number.greaterThanOrEquals("maximumAnisotropy",r,1),this._wrapS=t,this._wrapT=n,this._minificationFilter=i,this._magnificationFilter=o,this._maximumAnisotropy=r}Object.defineProperties(IE.prototype,{wrapS:{get:function(){return this._wrapS}},wrapT:{get:function(){return this._wrapT}},minificationFilter:{get:function(){return this._minificationFilter}},magnificationFilter:{get:function(){return this._magnificationFilter}},maximumAnisotropy:{get:function(){return this._maximumAnisotropy}}});IE.equals=function(e,t){return e===t||c(e)&&c(t)&&e._wrapS===t._wrapS&&e._wrapT===t._wrapT&&e._minificationFilter===t._minificationFilter&&e._magnificationFilter===t._magnificationFilter&&e._maximumAnisotropy===t._maximumAnisotropy};IE.NEAREST=Object.freeze(new IE({wrapS:yn.CLAMP_TO_EDGE,wrapT:yn.CLAMP_TO_EDGE,minificationFilter:$t.NEAREST,magnificationFilter:fi.NEAREST}));var Qt=IE;function Fu(e){if(e=y(e,y.EMPTY_OBJECT),A.defined("options.context",e.context),!c(e.typedArray)&&!c(e.sizeInBytes))throw new E("Either options.sizeInBytes or options.typedArray is required.");if(c(e.typedArray)&&c(e.sizeInBytes))throw new E("Cannot pass in both options.sizeInBytes and options.typedArray.");if(c(e.typedArray)&&(A.typeOf.object("options.typedArray",e.typedArray),A.typeOf.number("options.typedArray.byteLength",e.typedArray.byteLength)),!ke.validate(e.usage))throw new E("usage is invalid.");let t=e.context._gl,n=e.bufferTarget,i=e.typedArray,o=e.sizeInBytes,r=e.usage,s=c(i);s&&(o=i.byteLength),A.typeOf.number.greaterThan("sizeInBytes",o,0);let a=t.createBuffer();t.bindBuffer(n,a),t.bufferData(n,s?i:o,r),t.bindBuffer(n,null),this._id=Hn(),this._gl=t,this._webgl2=e.context._webgl2,this._bufferTarget=n,this._sizeInBytes=o,this._usage=r,this._buffer=a,this.vertexArrayDestroyable=!0}Fu.createVertexBuffer=function(e){return A.defined("options.context",e.context),new Fu({context:e.context,bufferTarget:ne.ARRAY_BUFFER,typedArray:e.typedArray,sizeInBytes:e.sizeInBytes,usage:e.usage})};Fu.createIndexBuffer=function(e){if(A.defined("options.context",e.context),!Fe.validate(e.indexDatatype))throw new E("Invalid indexDatatype.");if(e.indexDatatype===Fe.UNSIGNED_INT&&!e.context.elementIndexUint)throw new E("IndexDatatype.UNSIGNED_INT requires OES_element_index_uint, which is not supported on this system.  Check context.elementIndexUint.");let t=e.context,n=e.indexDatatype,i=Fe.getSizeInBytes(n),o=new Fu({context:t,bufferTarget:ne.ELEMENT_ARRAY_BUFFER,typedArray:e.typedArray,sizeInBytes:e.sizeInBytes,usage:e.usage}),r=o.sizeInBytes/i;return Object.defineProperties(o,{indexDatatype:{get:function(){return n}},bytesPerIndex:{get:function(){return i}},numberOfIndices:{get:function(){return r}}}),o};Object.defineProperties(Fu.prototype,{sizeInBytes:{get:function(){return this._sizeInBytes}},usage:{get:function(){return this._usage}}});Fu.prototype._getBuffer=function(){return this._buffer};Fu.prototype.copyFromArrayView=function(e,t){t=y(t,0),A.defined("arrayView",e),A.typeOf.number.lessThanOrEquals("offsetInBytes + arrayView.byteLength",t+e.byteLength,this._sizeInBytes);let n=this._gl,i=this._bufferTarget;n.bindBuffer(i,this._buffer),n.bufferSubData(i,t,e),n.bindBuffer(i,null)};Fu.prototype.copyFromBuffer=function(e,t,n,i){if(!this._webgl2)throw new E("A WebGL 2 context is required.");if(!c(e))throw new E("readBuffer must be defined.");if(!c(i)||i<=0)throw new E("sizeInBytes must be defined and be greater than zero.");if(!c(t)||t<0||t+i>e._sizeInBytes)throw new E("readOffset must be greater than or equal to zero and readOffset + sizeInBytes must be less than of equal to readBuffer.sizeInBytes.");if(!c(n)||n<0||n+i>this._sizeInBytes)throw new E("writeOffset must be greater than or equal to zero and writeOffset + sizeInBytes must be less than of equal to this.sizeInBytes.");if(this._buffer===e._buffer&&(n>=t&&n<t+i||t>n&&t<n+i))throw new E("When readBuffer is equal to this, the ranges [readOffset + sizeInBytes) and [writeOffset, writeOffset + sizeInBytes) must not overlap.");if(this._bufferTarget===ne.ELEMENT_ARRAY_BUFFER&&e._bufferTarget!==ne.ELEMENT_ARRAY_BUFFER||this._bufferTarget!==ne.ELEMENT_ARRAY_BUFFER&&e._bufferTarget===ne.ELEMENT_ARRAY_BUFFER)throw new E("Can not copy an index buffer into another buffer type.");let o=ne.COPY_READ_BUFFER,r=ne.COPY_WRITE_BUFFER,s=this._gl;s.bindBuffer(r,this._buffer),s.bindBuffer(o,e._buffer),s.copyBufferSubData(o,r,t,n,i),s.bindBuffer(r,null),s.bindBuffer(o,null)};Fu.prototype.getBufferData=function(e,t,n,i){if(t=y(t,0),n=y(n,0),!this._webgl2)throw new E("A WebGL 2 context is required.");if(!c(e))throw new E("arrayView is required.");let o,r,s=e.byteLength;if(c(i)?(o=i,c(s)?r=1:(s=e.length,r=e.BYTES_PER_ELEMENT)):c(s)?(o=s-n,r=1):(s=e.length,o=s-n,r=e.BYTES_PER_ELEMENT),n<0||n>s)throw new E("destinationOffset must be greater than zero and less than the arrayView length.");if(n+o>s)throw new E("destinationOffset + length must be less than or equal to the arrayViewLength.");if(t<0||t>this._sizeInBytes)throw new E("sourceOffset must be greater than zero and less than the buffers size.");if(t+o*r>this._sizeInBytes)throw new E("sourceOffset + length must be less than the buffers size.");let a=this._gl,l=ne.COPY_READ_BUFFER;a.bindBuffer(l,this._buffer),a.getBufferSubData(l,t,e,n,i),a.bindBuffer(l,null)};Fu.prototype.isDestroyed=function(){return!1};Fu.prototype.destroy=function(){return this._gl.deleteBuffer(this._buffer),de(this)};var xt=Fu;function Dve(e,t,n,i){let o=c(t.vertexBuffer),r=c(t.value),s=t.value?t.value.length:t.componentsPerAttribute;if(!o&&!r)throw new E("attribute must have a vertexBuffer or a value.");if(o&&r)throw new E("attribute cannot have both a vertexBuffer and a value.  It must have either a vertexBuffer property defining per-vertex data or a value property defining data for all vertices.");if(s!==1&&s!==2&&s!==3&&s!==4)throw r?new E("attribute.value.length must be in the range [1, 4]."):new E("attribute.componentsPerAttribute must be in the range [1, 4].");if(c(t.componentDatatype)&&!$.validate(t.componentDatatype))throw new E("attribute must have a valid componentDatatype or not specify it.");if(c(t.strideInBytes)&&t.strideInBytes>255)throw new E("attribute must have a strideInBytes less than or equal to 255 or not specify it.");if(c(t.instanceDivisor)&&t.instanceDivisor>0&&!i.instancedArrays)throw new E("instanced arrays is not supported");if(c(t.instanceDivisor)&&t.instanceDivisor<0)throw new E("attribute must have an instanceDivisor greater than or equal to zero");if(c(t.instanceDivisor)&&r)throw new E("attribute cannot have have an instanceDivisor if it is not backed by a buffer");if(c(t.instanceDivisor)&&t.instanceDivisor>0&&t.index===0)throw new E("attribute zero cannot have an instanceDivisor greater than 0");let a={index:y(t.index,n),enabled:y(t.enabled,!0),vertexBuffer:t.vertexBuffer,value:r?t.value.slice(0):void 0,componentsPerAttribute:s,componentDatatype:y(t.componentDatatype,$.FLOAT),normalize:y(t.normalize,!1),offsetInBytes:y(t.offsetInBytes,0),strideInBytes:y(t.strideInBytes,0),instanceDivisor:y(t.instanceDivisor,0),bindAsInteger:y(t.bindAsInteger,!1)};if(o)a.vertexAttrib=function(l){let u=this.index;l.enableVertexAttribArray(u),l.bindBuffer(l.ARRAY_BUFFER,this.vertexBuffer._getBuffer()),this.bindAsInteger?l.vertexAttribIPointer(u,this.componentsPerAttribute,this.componentDatatype,this.normalize,this.strideInBytes,this.offsetInBytes):l.vertexAttribPointer(u,this.componentsPerAttribute,this.componentDatatype,this.normalize,this.strideInBytes,this.offsetInBytes),this.instanceDivisor>0&&(i.glVertexAttribDivisor(u,this.instanceDivisor),i._vertexAttribDivisors[u]=this.instanceDivisor,i._previousDrawInstanced=!0)},a.disableVertexAttribArray=function(l){l.disableVertexAttribArray(this.index),this.instanceDivisor>0&&i.glVertexAttribDivisor(n,0)};else{switch(a.componentsPerAttribute){case 1:a.vertexAttrib=function(l){l.vertexAttrib1fv(this.index,this.value)};break;case 2:a.vertexAttrib=function(l){l.vertexAttrib2fv(this.index,this.value)};break;case 3:a.vertexAttrib=function(l){l.vertexAttrib3fv(this.index,this.value)};break;case 4:a.vertexAttrib=function(l){l.vertexAttrib4fv(this.index,this.value)};break}a.disableVertexAttribArray=function(l){}}e.push(a)}function qJ(e,t,n){for(let i=0;i<t.length;++i){let o=t[i];o.enabled&&o.vertexAttrib(e)}c(n)&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n._getBuffer())}function Dm(e){e=y(e,y.EMPTY_OBJECT),A.defined("options.context",e.context),A.defined("options.attributes",e.attributes);let t=e.context,n=t._gl,i=e.attributes,o=e.indexBuffer,r,s=[],a=1,l=!1,u=!1,f=i.length;for(r=0;r<f;++r)Dve(s,i[r],r,t);for(f=s.length,r=0;r<f;++r){let g=s[r];if(c(g.vertexBuffer)&&g.instanceDivisor===0){let m=g.strideInBytes||g.componentsPerAttribute*$.getSizeInBytes(g.componentDatatype);a=g.vertexBuffer.sizeInBytes/m;break}}for(r=0;r<f;++r)s[r].instanceDivisor>0&&(l=!0),c(s[r].value)&&(u=!0);let d={};for(r=0;r<f;++r){let g=s[r].index;if(d[g])throw new E(`Index ${g} is used by more than one attribute.`);d[g]=!0}let p;t.vertexArrayObject&&(p=t.glCreateVertexArray(),t.glBindVertexArray(p),qJ(n,s,o),t.glBindVertexArray(null)),this._numberOfVertices=a,this._hasInstancedAttributes=l,this._hasConstantAttributes=u,this._context=t,this._gl=n,this._vao=p,this._attributes=s,this._indexBuffer=o}function WJ(e){return e.values.length/e.componentsPerAttribute}function Pve(e){return $.getSizeInBytes(e.componentDatatype)*e.componentsPerAttribute}function Ive(e){let t,n,i,o=[];for(n in e)e.hasOwnProperty(n)&&c(e[n])&&c(e[n].values)&&(o.push(n),e[n].componentDatatype===$.DOUBLE&&(e[n].componentDatatype=$.FLOAT,e[n].values=$.createTypedArray($.FLOAT,e[n].values)));let r,s=o.length;if(s>0)for(r=WJ(e[o[0]]),t=1;t<s;++t){let u=WJ(e[o[t]]);if(u!==r)throw new ue(`Each attribute list must have the same number of vertices.  Attribute ${o[t]} has a different number of vertices (${u.toString()}) than attribute ${o[0]} (${r.toString()}).`)}o.sort(function(u,f){return $.getSizeInBytes(e[f].componentDatatype)-$.getSizeInBytes(e[u].componentDatatype)});let a=0,l={};for(t=0;t<s;++t)n=o[t],i=e[n],l[n]=a,a+=Pve(i);if(a>0){let u=$.getSizeInBytes(e[o[0]].componentDatatype),f=a%u;f!==0&&(a+=u-f);let d=r*a,p=new ArrayBuffer(d),g={};for(t=0;t<s;++t){n=o[t];let m=$.getSizeInBytes(e[n].componentDatatype);g[n]={pointer:$.createTypedArray(e[n].componentDatatype,p),index:l[n]/m,strideInComponentType:a/m}}for(t=0;t<r;++t)for(let m=0;m<s;++m){n=o[m],i=e[n];let b=i.values,x=g[n],T=x.pointer,C=i.componentsPerAttribute;for(let S=0;S<C;++S)T[x.index+S]=b[t*C+S];x.index+=x.strideInComponentType}return{buffer:p,offsetsInBytes:l,vertexSizeInBytes:a}}}Dm.fromGeometry=function(e){e=y(e,y.EMPTY_OBJECT),A.defined("options.context",e.context);let t=e.context,n=y(e.geometry,y.EMPTY_OBJECT),i=y(e.bufferUsage,ke.DYNAMIC_DRAW),o=y(e.attributeLocations,y.EMPTY_OBJECT),r=y(e.interleave,!1),s=e.vertexArrayAttributes,a,l,u,f=c(s)?s:[],d=n.attributes;if(r){let m=Ive(d);if(c(m)){u=xt.createVertexBuffer({context:t,typedArray:m.buffer,usage:i});let b=m.offsetsInBytes,x=m.vertexSizeInBytes;for(a in d)d.hasOwnProperty(a)&&c(d[a])&&(l=d[a],c(l.values)?f.push({index:o[a],vertexBuffer:u,componentDatatype:l.componentDatatype,componentsPerAttribute:l.componentsPerAttribute,normalize:l.normalize,offsetInBytes:b[a],strideInBytes:x}):f.push({index:o[a],value:l.value,componentDatatype:l.componentDatatype,normalize:l.normalize}))}}else for(a in d)if(d.hasOwnProperty(a)&&c(d[a])){l=d[a];let m=l.componentDatatype;m===$.DOUBLE&&(m=$.FLOAT),u=void 0,c(l.values)&&(u=xt.createVertexBuffer({context:t,typedArray:$.createTypedArray(m,l.values),usage:i})),f.push({index:o[a],vertexBuffer:u,value:l.value,componentDatatype:m,componentsPerAttribute:l.componentsPerAttribute,normalize:l.normalize})}let p,g=n.indices;return c(g)&&(ut.computeNumberOfVertices(n)>=R.SIXTY_FOUR_KILOBYTES&&t.elementIndexUint?p=xt.createIndexBuffer({context:t,typedArray:new Uint32Array(g),usage:i,indexDatatype:Fe.UNSIGNED_INT}):p=xt.createIndexBuffer({context:t,typedArray:new Uint16Array(g),usage:i,indexDatatype:Fe.UNSIGNED_SHORT})),new Dm({context:t,attributes:f,indexBuffer:p})};Object.defineProperties(Dm.prototype,{numberOfAttributes:{get:function(){return this._attributes.length}},numberOfVertices:{get:function(){return this._numberOfVertices}},indexBuffer:{get:function(){return this._indexBuffer}}});Dm.prototype.getAttribute=function(e){return A.defined("index",e),this._attributes[e]};function Ove(e){let t=e._context,n=e._hasInstancedAttributes;if(!n&&!t._previousDrawInstanced)return;t._previousDrawInstanced=n;let i=t._vertexAttribDivisors,o=e._attributes,r=mt.maximumVertexAttributes,s;if(n){let a=o.length;for(s=0;s<a;++s){let l=o[s];if(l.enabled){let u=l.instanceDivisor,f=l.index;u!==i[f]&&(t.glVertexAttribDivisor(f,u),i[f]=u)}}}else for(s=0;s<r;++s)i[s]>0&&(t.glVertexAttribDivisor(s,0),i[s]=0)}function Rve(e,t){let n=e._attributes,i=n.length;for(let o=0;o<i;++o){let r=n[o];r.enabled&&c(r.value)&&r.vertexAttrib(t)}}Dm.prototype._bind=function(){c(this._vao)?(this._context.glBindVertexArray(this._vao),this._context.instancedArrays&&Ove(this),this._hasConstantAttributes&&Rve(this,this._gl)):qJ(this._gl,this._attributes,this._indexBuffer)};Dm.prototype._unBind=function(){if(c(this._vao))this._context.glBindVertexArray(null);else{let e=this._attributes,t=this._gl;for(let n=0;n<e.length;++n){let i=e[n];i.enabled&&i.disableVertexAttribArray(t)}this._indexBuffer&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)}};Dm.prototype.isDestroyed=function(){return!1};Dm.prototype.destroy=function(){let e=this._attributes;for(let n=0;n<e.length;++n){let i=e[n].vertexBuffer;c(i)&&!i.isDestroyed()&&i.vertexArrayDestroyable&&i.destroy()}let t=this._indexBuffer;return c(t)&&!t.isDestroyed()&&t.vertexArrayDestroyable&&t.destroy(),c(this._vao)&&this._context.glDeleteVertexArray(this._vao),de(this)};var ni=Dm;function go(e){e=y(e,y.EMPTY_OBJECT),A.defined("options.context",e.context);let{context:t,source:n,pixelFormat:i=Ve.RGBA,pixelDatatype:o=Be.UNSIGNED_BYTE,flipY:r=!0,skipColorSpaceConversion:s=!1,sampler:a=new Qt}=e,l=e.preMultiplyAlpha||i===Ve.RGB||i===Ve.LUMINANCE,{width:u,height:f}=e;if(c(n)){if(!Object.values(go.FaceName).every(S=>c(n[S])))throw new E(`options.source requires faces ${Object.values(go.FaceName).join(", ")}.`);({width:u,height:f}=n.positiveX);for(let S of go.faceNames()){let v=n[S];if(Number(v.width)!==u||Number(v.height)!==f)throw new E("Each face in options.source must have the same width and height.")}}let d=u;if(!c(u)||!c(f))throw new E("options requires a source field to create an initialized cube map or width and height fields to create a blank cube map.");if(u!==f)throw new E("Width must equal height.");if(d<=0)throw new E("Width and height must be greater than zero.");if(d>mt.maximumCubeMapSize)throw new E(`Width and height must be less than or equal to the maximum cube map size (${mt.maximumCubeMapSize}). Check maximumCubeMapSize.`);if(!Ve.validate(i))throw new E("Invalid options.pixelFormat.");if(Ve.isDepthFormat(i))throw new E("options.pixelFormat cannot be DEPTH_COMPONENT or DEPTH_STENCIL.");if(!Be.validate(o))throw new E("Invalid options.pixelDatatype.");if(o===Be.FLOAT&&!t.floatingPointTexture)throw new E("When options.pixelDatatype is FLOAT, this WebGL implementation must support the OES_texture_float extension.");if(o===Be.HALF_FLOAT&&!t.halfFloatingPointTexture)throw new E("When options.pixelDatatype is HALF_FLOAT, this WebGL implementation must support the OES_texture_half_float extension.");let p=Ve.textureSizeInBytes(i,o,d,d)*6,g=Ve.toInternalFormat(i,o,t),m=t._gl,b=m.TEXTURE_CUBE_MAP,x=m.createTexture();this._context=t,this._textureFilterAnisotropic=t._textureFilterAnisotropic,this._textureTarget=b,this._texture=x,this._pixelFormat=i,this._pixelDatatype=o,this._size=d,this._hasMipmap=!1,this._sizeInBytes=p,this._preMultiplyAlpha=l,this._flipY=r;let T=c(n);function C(S){return new UB(t,x,b,S,g,i,o,d,l,r,T)}this._positiveX=C(m.TEXTURE_CUBE_MAP_POSITIVE_X),this._negativeX=C(m.TEXTURE_CUBE_MAP_NEGATIVE_X),this._positiveY=C(m.TEXTURE_CUBE_MAP_POSITIVE_Y),this._negativeY=C(m.TEXTURE_CUBE_MAP_NEGATIVE_Y),this._positiveZ=C(m.TEXTURE_CUBE_MAP_POSITIVE_Z),this._negativeZ=C(m.TEXTURE_CUBE_MAP_NEGATIVE_Z),this._sampler=a,YJ(this,a),m.activeTexture(m.TEXTURE0),m.bindTexture(b,x),s?m.pixelStorei(m.UNPACK_COLORSPACE_CONVERSION_WEBGL,m.NONE):m.pixelStorei(m.UNPACK_COLORSPACE_CONVERSION_WEBGL,m.BROWSER_DEFAULT_WEBGL);for(let S of go.faceNames())HB(this[S],n?.[S],0);m.bindTexture(b,null)}go.prototype.copyFace=function(e,t,n,i){let o=e.context,r=new Jr({context:o,colorTextures:[t],destroyAttachments:!1});r._bind(),this[n].copyMipmapFromFramebuffer(0,0,t.width,t.height,y(i,0)),r._unBind(),r.destroy()};go.FaceName=Object.freeze({POSITIVEX:"positiveX",NEGATIVEX:"negativeX",POSITIVEY:"positiveY",NEGATIVEY:"negativeY",POSITIVEZ:"positiveZ",NEGATIVEZ:"negativeZ"});function*Mve(){yield go.FaceName.POSITIVEX,yield go.FaceName.NEGATIVEX,yield go.FaceName.POSITIVEY,yield go.FaceName.NEGATIVEY,yield go.FaceName.POSITIVEZ,yield go.FaceName.NEGATIVEZ}go.faceNames=function(){return Mve()};function HB(e,t,n){n=y(n,0);let i=e._targetFace,o=Math.max(Math.floor(e._size/2**n),1),r=e._pixelFormat,s=e._pixelDatatype,a=e._internalFormat,l=e._flipY,u=e._preMultiplyAlpha,f=e._context,d=f._gl;if(!c(t)){d.texImage2D(i,n,a,o,o,0,r,Be.toWebGLConstant(s,f),null);return}let{arrayBufferView:p}=t,g=4;c(p)&&(g=Ve.alignmentInBytes(r,s,o)),d.pixelStorei(d.UNPACK_ALIGNMENT,g),c(p)?(d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,!1),l&&(p=Ve.flipY(p,r,s,o,o)),d.texImage2D(i,n,a,o,o,0,r,Be.toWebGLConstant(s,f),p)):(d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,u),d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,l),d.texImage2D(i,n,a,r,Be.toWebGLConstant(s,f),t))}go.loadFace=HB;Object.defineProperties(go.prototype,{positiveX:{get:function(){return this._positiveX}},negativeX:{get:function(){return this._negativeX}},positiveY:{get:function(){return this._positiveY}},negativeY:{get:function(){return this._negativeY}},positiveZ:{get:function(){return this._positiveZ}},negativeZ:{get:function(){return this._negativeZ}},sampler:{get:function(){return this._sampler},set:function(e){YJ(this,e),this._sampler=e}},pixelFormat:{get:function(){return this._pixelFormat}},pixelDatatype:{get:function(){return this._pixelDatatype}},width:{get:function(){return this._size}},height:{get:function(){return this._size}},sizeInBytes:{get:function(){return this._hasMipmap?Math.floor(this._sizeInBytes*4/3):this._sizeInBytes}},preMultiplyAlpha:{get:function(){return this._preMultiplyAlpha}},flipY:{get:function(){return this._flipY}},_target:{get:function(){return this._textureTarget}}});go.getDirection=function(e,t){switch(e){case go.FaceName.POSITIVEX:return h.clone(h.UNIT_X,t);case go.FaceName.NEGATIVEX:return h.negate(h.UNIT_X,t);case go.FaceName.POSITIVEY:return h.clone(h.UNIT_Y,t);case go.FaceName.NEGATIVEY:return h.negate(h.UNIT_Y,t);case go.FaceName.POSITIVEZ:return h.clone(h.UNIT_Z,t);case go.FaceName.NEGATIVEZ:return h.negate(h.UNIT_Z,t)}};function YJ(e,t){let{minificationFilter:n,magnificationFilter:i}=t,o=[$t.NEAREST_MIPMAP_NEAREST,$t.NEAREST_MIPMAP_LINEAR,$t.LINEAR_MIPMAP_NEAREST,$t.LINEAR_MIPMAP_LINEAR].includes(n),r=e._context,s=e._pixelDatatype;(s===Be.FLOAT&&!r.textureFloatLinear||s===Be.HALF_FLOAT&&!r.textureHalfFloatLinear)&&(n=o?$t.NEAREST_MIPMAP_NEAREST:$t.NEAREST,i=fi.NEAREST);let a=r._gl,l=e._textureTarget;a.activeTexture(a.TEXTURE0),a.bindTexture(l,e._texture),a.texParameteri(l,a.TEXTURE_MIN_FILTER,n),a.texParameteri(l,a.TEXTURE_MAG_FILTER,i),a.texParameteri(l,a.TEXTURE_WRAP_S,t.wrapS),a.texParameteri(l,a.TEXTURE_WRAP_T,t.wrapT),c(e._textureFilterAnisotropic)&&a.texParameteri(l,e._textureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.maximumAnisotropy),a.bindTexture(l,null)}go.prototype.loadMipmaps=function(e,t){if(A.defined("source",e),!Array.isArray(e))throw new E("source must be an array");let n=Math.log2(this._size);if(e.length!==n)throw new E("all mip levels must be defined");t=y(t,!1);let i=this._context._gl,o=this._texture,r=this._textureTarget;i.activeTexture(i.TEXTURE0),i.bindTexture(r,o),t?i.pixelStorei(i.UNPACK_COLORSPACE_CONVERSION_WEBGL,i.NONE):i.pixelStorei(i.UNPACK_COLORSPACE_CONVERSION_WEBGL,i.BROWSER_DEFAULT_WEBGL);for(let s=0;s<e.length;s++){let a=e[s],l=s+1;for(let u of go.faceNames())HB(this[u],a[u],l)}i.bindTexture(r,null),this._hasMipmap=!0};go.prototype.generateMipmap=function(e){if(e=y(e,rh.DONT_CARE),this._size>1&&!R.isPowerOfTwo(this._size))throw new E("width and height must be a power of two to call generateMipmap().");if(!rh.validate(e))throw new E("hint is invalid.");this._hasMipmap=!0;let t=this._context._gl,n=this._textureTarget;t.hint(t.GENERATE_MIPMAP_HINT,e),t.activeTexture(t.TEXTURE0),t.bindTexture(n,this._texture),t.generateMipmap(n),t.bindTexture(n,null)};go.createVertexArray=function(e){let t=uc.createGeometry(uc.fromDimensions({dimensions:new h(2,2,2),vertexFormat:Ie.POSITION_ONLY})),n=this._attributeLocations=Fn.createAttributeLocations(t);return ni.fromGeometry({context:e,geometry:t,attributeLocations:n,bufferUsage:ke.STATIC_DRAW})};go.prototype.isDestroyed=function(){return!1};go.prototype.destroy=function(){return this._context._gl.deleteTexture(this._texture),this._positiveX=de(this._positiveX),this._negativeX=de(this._negativeX),this._positiveY=de(this._positiveY),this._negativeY=de(this._negativeY),this._positiveZ=de(this._positiveZ),this._negativeZ=de(this._negativeZ),de(this)};var Jo=go;function jf(e){e=y(e,y.EMPTY_OBJECT),A.defined("options.context",e.context);let{context:t,source:n,pixelFormat:i=Ve.RGBA,pixelDatatype:o=Be.UNSIGNED_BYTE,flipY:r=!0,skipColorSpaceConversion:s=!1,sampler:a=new Qt}=e,l=e.width,u=e.height;c(n)&&(c(l)||(l=n.videoWidth??n.naturalWidth??n.width),c(u)||(u=n.videoHeight??n.naturalHeight??n.height));let f=e.preMultiplyAlpha||i===Ve.RGB||i===Ve.LUMINANCE,d=Ve.toInternalFormat(i,o,t),p=Ve.isCompressedFormat(d);if(!c(l)||!c(u))throw new E("options requires a source field to create an initialized texture or width and height fields to create a blank texture.");if(A.typeOf.number.greaterThan("width",l,0),l>mt.maximumTextureSize)throw new E(`Width must be less than or equal to the maximum texture size (${mt.maximumTextureSize}).  Check maximumTextureSize.`);if(A.typeOf.number.greaterThan("height",u,0),u>mt.maximumTextureSize)throw new E(`Height must be less than or equal to the maximum texture size (${mt.maximumTextureSize}).  Check maximumTextureSize.`);if(!Ve.validate(i))throw new E("Invalid options.pixelFormat.");if(!p&&!Be.validate(o))throw new E("Invalid options.pixelDatatype.");if(i===Ve.DEPTH_COMPONENT&&o!==Be.UNSIGNED_SHORT&&o!==Be.UNSIGNED_INT)throw new E("When options.pixelFormat is DEPTH_COMPONENT, options.pixelDatatype must be UNSIGNED_SHORT or UNSIGNED_INT.");if(i===Ve.DEPTH_STENCIL&&o!==Be.UNSIGNED_INT_24_8)throw new E("When options.pixelFormat is DEPTH_STENCIL, options.pixelDatatype must be UNSIGNED_INT_24_8.");if(o===Be.FLOAT&&!t.floatingPointTexture)throw new E("When options.pixelDatatype is FLOAT, this WebGL implementation must support the OES_texture_float extension.  Check context.floatingPointTexture.");if(o===Be.HALF_FLOAT&&!t.halfFloatingPointTexture)throw new E("When options.pixelDatatype is HALF_FLOAT, this WebGL implementation must support the OES_texture_half_float extension. Check context.halfFloatingPointTexture.");if(Ve.isDepthFormat(i)){if(c(n))throw new E("When options.pixelFormat is DEPTH_COMPONENT or DEPTH_STENCIL, source cannot be provided.");if(!t.depthTexture)throw new E("When options.pixelFormat is DEPTH_COMPONENT or DEPTH_STENCIL, this WebGL implementation must support WEBGL_depth_texture.  Check context.depthTexture.")}if(p){if(!c(n)||!c(n.arrayBufferView))throw new E("When options.pixelFormat is compressed, options.source.arrayBufferView must be defined.");if(Ve.isDXTFormat(d)&&!t.s3tc)throw new E("When options.pixelFormat is S3TC compressed, this WebGL implementation must support the WEBGL_compressed_texture_s3tc extension. Check context.s3tc.");if(Ve.isPVRTCFormat(d)&&!t.pvrtc)throw new E("When options.pixelFormat is PVRTC compressed, this WebGL implementation must support the WEBGL_compressed_texture_pvrtc extension. Check context.pvrtc.");if(Ve.isASTCFormat(d)&&!t.astc)throw new E("When options.pixelFormat is ASTC compressed, this WebGL implementation must support the WEBGL_compressed_texture_astc extension. Check context.astc.");if(Ve.isETC2Format(d)&&!t.etc)throw new E("When options.pixelFormat is ETC2 compressed, this WebGL implementation must support the WEBGL_compressed_texture_etc extension. Check context.etc.");if(Ve.isETC1Format(d)&&!t.etc1)throw new E("When options.pixelFormat is ETC1 compressed, this WebGL implementation must support the WEBGL_compressed_texture_etc1 extension. Check context.etc1.");if(Ve.isBC7Format(d)&&!t.bc7)throw new E("When options.pixelFormat is BC7 compressed, this WebGL implementation must support the EXT_texture_compression_bptc extension. Check context.bc7.");if(Ve.compressedTextureSizeInBytes(d,l,u)!==n.arrayBufferView.byteLength)throw new E("The byte length of the array buffer is invalid for the compressed texture with the given width and height.")}let g=t._gl,m=p?Ve.compressedTextureSizeInBytes(i,l,u):Ve.textureSizeInBytes(i,o,l,u);this._id=Hn(),this._context=t,this._textureFilterAnisotropic=t._textureFilterAnisotropic,this._textureTarget=g.TEXTURE_2D,this._texture=g.createTexture(),this._internalFormat=d,this._pixelFormat=i,this._pixelDatatype=o,this._width=l,this._height=u,this._dimensions=new H(l,u),this._hasMipmap=!1,this._sizeInBytes=m,this._preMultiplyAlpha=f,this._flipY=r,this._initialized=!1,this._sampler=void 0,this._sampler=a,XJ(this,a),g.activeTexture(g.TEXTURE0),g.bindTexture(this._textureTarget,this._texture),c(n)?(s?g.pixelStorei(g.UNPACK_COLORSPACE_CONVERSION_WEBGL,g.NONE):g.pixelStorei(g.UNPACK_COLORSPACE_CONVERSION_WEBGL,g.BROWSER_DEFAULT_WEBGL),c(n.arrayBufferView)?Ve.isCompressedFormat(d)?Lve(this,n):Nve(this,n):c(n.framebuffer)?Fve(this,n):Bve(this,n),this._initialized=!0):kve(this),g.bindTexture(this._textureTarget,null)}function Lve(e,t){let i=e._context._gl,o=e._textureTarget,r=e._internalFormat,{width:s,height:a}=e;if(i.pixelStorei(i.UNPACK_ALIGNMENT,4),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!1),i.compressedTexImage2D(o,0,r,s,a,0,t.arrayBufferView),c(t.mipLevels)){let l=s,u=a;for(let f=0;f<t.mipLevels.length;++f)l=VI(l),u=VI(u),i.compressedTexImage2D(o,f+1,r,l,u,0,t.mipLevels[f])}}function Nve(e,t){let n=e._context,i=n._gl,o=e._textureTarget,r=e._internalFormat,{width:s,height:a,pixelFormat:l,pixelDatatype:u,flipY:f}=e,d=Ve.alignmentInBytes(l,u,s);i.pixelStorei(i.UNPACK_ALIGNMENT,d),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!1);let p=t.arrayBufferView;if(f&&(p=Ve.flipY(p,l,u,s,a)),i.texImage2D(o,0,r,s,a,0,l,Be.toWebGLConstant(u,n),p),c(t.mipLevels)){let g=s,m=a;for(let b=0;b<t.mipLevels.length;++b)g=VI(g),m=VI(m),i.texImage2D(o,b+1,r,g,m,0,l,Be.toWebGLConstant(u,n),t.mipLevels[b])}}function Fve(e,t){let n=e._context,i=n._gl;i.pixelStorei(i.UNPACK_ALIGNMENT,4),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!1),t.framebuffer!==n.defaultFramebuffer&&t.framebuffer._bind(),i.copyTexImage2D(e._textureTarget,0,e._internalFormat,t.xOffset,t.yOffset,e.width,e.height,0),t.framebuffer!==n.defaultFramebuffer&&t.framebuffer._unBind()}function Bve(e,t){let n=e._context,i=n._gl;i.pixelStorei(i.UNPACK_ALIGNMENT,4),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.preMultiplyAlpha),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,e.flipY),i.texImage2D(e._textureTarget,0,e._internalFormat,e.pixelFormat,Be.toWebGLConstant(e.pixelDatatype,n),t)}function VI(e){let t=Math.floor(e/2)|0;return Math.max(t,1)}function kve(e){let t=e._context;t._gl.texImage2D(e._textureTarget,0,e._internalFormat,e._width,e._height,0,e._pixelFormat,Be.toWebGLConstant(e._pixelDatatype,t),null)}jf.create=function(e){return new jf(e)};jf.fromFramebuffer=function(e){e=y(e,y.EMPTY_OBJECT),A.defined("options.context",e.context);let t=e.context,n=t._gl,{pixelFormat:i=Ve.RGB,framebufferXOffset:o=0,framebufferYOffset:r=0,width:s=n.drawingBufferWidth,height:a=n.drawingBufferHeight,framebuffer:l}=e;if(!Ve.validate(i))throw new E("Invalid pixelFormat.");if(Ve.isDepthFormat(i)||Ve.isCompressedFormat(i))throw new E("pixelFormat cannot be DEPTH_COMPONENT, DEPTH_STENCIL or a compressed format.");if(A.defined("options.context",t),A.typeOf.number.greaterThanOrEquals("framebufferXOffset",o,0),A.typeOf.number.greaterThanOrEquals("framebufferYOffset",r,0),o+s>n.drawingBufferWidth)throw new E("framebufferXOffset + width must be less than or equal to drawingBufferWidth");if(r+a>n.drawingBufferHeight)throw new E("framebufferYOffset + height must be less than or equal to drawingBufferHeight.");return new jf({context:t,width:s,height:a,pixelFormat:i,source:{framebuffer:c(l)?l:t.defaultFramebuffer,xOffset:o,yOffset:r,width:s,height:a}})};Object.defineProperties(jf.prototype,{id:{get:function(){return this._id}},sampler:{get:function(){return this._sampler},set:function(e){XJ(this,e),this._sampler=e}},pixelFormat:{get:function(){return this._pixelFormat}},pixelDatatype:{get:function(){return this._pixelDatatype}},dimensions:{get:function(){return this._dimensions}},preMultiplyAlpha:{get:function(){return this._preMultiplyAlpha}},flipY:{get:function(){return this._flipY}},width:{get:function(){return this._width}},height:{get:function(){return this._height}},sizeInBytes:{get:function(){return this._hasMipmap?Math.floor(this._sizeInBytes*4/3):this._sizeInBytes}},_target:{get:function(){return this._textureTarget}}});function XJ(e,t){let{minificationFilter:n,magnificationFilter:i}=t,o=[$t.NEAREST_MIPMAP_NEAREST,$t.NEAREST_MIPMAP_LINEAR,$t.LINEAR_MIPMAP_NEAREST,$t.LINEAR_MIPMAP_LINEAR].includes(n),r=e._context,s=e._pixelFormat,a=e._pixelDatatype;(a===Be.FLOAT&&!r.textureFloatLinear||a===Be.HALF_FLOAT&&!r.textureHalfFloatLinear)&&(n=o?$t.NEAREST_MIPMAP_NEAREST:$t.NEAREST,i=fi.NEAREST),r.webgl2&&Ve.isDepthFormat(s)&&(n=$t.NEAREST,i=fi.NEAREST);let l=r._gl,u=e._textureTarget;l.activeTexture(l.TEXTURE0),l.bindTexture(u,e._texture),l.texParameteri(u,l.TEXTURE_MIN_FILTER,n),l.texParameteri(u,l.TEXTURE_MAG_FILTER,i),l.texParameteri(u,l.TEXTURE_WRAP_S,t.wrapS),l.texParameteri(u,l.TEXTURE_WRAP_T,t.wrapT),c(e._textureFilterAnisotropic)&&l.texParameteri(u,e._textureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.maximumAnisotropy),l.bindTexture(u,null)}jf.prototype.copyFrom=function(e){A.defined("options",e);let{xOffset:t=0,yOffset:n=0,source:i,skipColorSpaceConversion:o=!1}=e;if(A.defined("options.source",i),Ve.isDepthFormat(this._pixelFormat))throw new E("Cannot call copyFrom when the texture pixel format is DEPTH_COMPONENT or DEPTH_STENCIL.");if(Ve.isCompressedFormat(this._pixelFormat))throw new E("Cannot call copyFrom with a compressed texture pixel format.");A.typeOf.number.greaterThanOrEquals("xOffset",t,0),A.typeOf.number.greaterThanOrEquals("yOffset",n,0),A.typeOf.number.lessThanOrEquals("xOffset + options.source.width",t+i.width,this._width),A.typeOf.number.lessThanOrEquals("yOffset + options.source.height",n+i.height,this._height);let r=this._context,s=r._gl,a=this._textureTarget;s.activeTexture(s.TEXTURE0),s.bindTexture(a,this._texture);let{width:l,height:u}=i,f=i.arrayBufferView;c(i.videoWidth)&&c(i.videoHeight)?(l=i.videoWidth,u=i.videoHeight):c(i.naturalWidth)&&c(i.naturalHeight)&&(l=i.naturalWidth,u=i.naturalHeight);let d=this._width,p=this._height,g=this._internalFormat,m=this._pixelFormat,b=this._pixelDatatype,x=this._preMultiplyAlpha,T=this._flipY,C=4;c(f)&&(C=Ve.alignmentInBytes(m,b,l)),s.pixelStorei(s.UNPACK_ALIGNMENT,C),o?s.pixelStorei(s.UNPACK_COLORSPACE_CONVERSION_WEBGL,s.NONE):s.pixelStorei(s.UNPACK_COLORSPACE_CONVERSION_WEBGL,s.BROWSER_DEFAULT_WEBGL);let S=!1;if(!this._initialized){let v;t===0&&n===0&&l===d&&u===p?(c(f)?(s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,!1),T?v=Ve.flipY(f,m,b,d,p):v=f):(s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,x),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,T),v=i),S=!0):(s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,!1),v=Ve.createTypedArray(m,b,d,p)),s.texImage2D(a,0,g,d,p,0,m,Be.toWebGLConstant(b,r),v),this._initialized=!0}if(!S){let v;c(f)?(s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,!1),T?v=Ve.flipY(f,m,b,l,u):v=f):(s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,x),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,T),v=i),s.texSubImage2D(a,0,t,n,l,u,m,Be.toWebGLConstant(b,r),v)}s.bindTexture(a,null)};jf.prototype.copyFromFramebuffer=function(e,t,n,i,o,r){if(e=y(e,0),t=y(t,0),n=y(n,0),i=y(i,0),o=y(o,this._width),r=y(r,this._height),Ve.isDepthFormat(this._pixelFormat))throw new E("Cannot call copyFromFramebuffer when the texture pixel format is DEPTH_COMPONENT or DEPTH_STENCIL.");if(this._pixelDatatype===Be.FLOAT)throw new E("Cannot call copyFromFramebuffer when the texture pixel data type is FLOAT.");if(this._pixelDatatype===Be.HALF_FLOAT)throw new E("Cannot call copyFromFramebuffer when the texture pixel data type is HALF_FLOAT.");if(Ve.isCompressedFormat(this._pixelFormat))throw new E("Cannot call copyFrom with a compressed texture pixel format.");A.typeOf.number.greaterThanOrEquals("xOffset",e,0),A.typeOf.number.greaterThanOrEquals("yOffset",t,0),A.typeOf.number.greaterThanOrEquals("framebufferXOffset",n,0),A.typeOf.number.greaterThanOrEquals("framebufferYOffset",i,0),A.typeOf.number.lessThanOrEquals("xOffset + width",e+o,this._width),A.typeOf.number.lessThanOrEquals("yOffset + height",t+r,this._height);let s=this._context._gl,a=this._textureTarget;s.activeTexture(s.TEXTURE0),s.bindTexture(a,this._texture),s.copyTexSubImage2D(a,0,e,t,n,i,o,r),s.bindTexture(a,null),this._initialized=!0};jf.prototype.generateMipmap=function(e){if(e=y(e,rh.DONT_CARE),Ve.isDepthFormat(this._pixelFormat))throw new E("Cannot call generateMipmap when the texture pixel format is DEPTH_COMPONENT or DEPTH_STENCIL.");if(Ve.isCompressedFormat(this._pixelFormat))throw new E("Cannot call generateMipmap with a compressed pixel format.");if(!this._context.webgl2){if(this._width>1&&!R.isPowerOfTwo(this._width))throw new E("width must be a power of two to call generateMipmap() in a WebGL1 context.");if(this._height>1&&!R.isPowerOfTwo(this._height))throw new E("height must be a power of two to call generateMipmap() in a WebGL1 context.")}if(!rh.validate(e))throw new E("hint is invalid.");this._hasMipmap=!0;let t=this._context._gl,n=this._textureTarget;t.hint(t.GENERATE_MIPMAP_HINT,e),t.activeTexture(t.TEXTURE0),t.bindTexture(n,this._texture),t.generateMipmap(n),t.bindTexture(n,null)};jf.prototype.isDestroyed=function(){return!1};jf.prototype.destroy=function(){return this._context._gl.deleteTexture(this._texture),de(this)};var Lt=jf;var GB=`uniform sampler2D image;
czm_material czm_getMaterial(czm_materialInput materialInput)
{
czm_material material = czm_getDefaultMaterial(materialInput);
vec4 rampColor = texture(image, vec2(materialInput.aspect / (2.0 * czm_pi), 0.5));
rampColor = czm_gammaCorrect(rampColor);
material.diffuse = rampColor.rgb;
material.alpha = rampColor.a;
return material;
}
`;var jB=`uniform sampler2D image;
uniform float strength;
uniform vec2 repeat;
czm_material czm_getMaterial(czm_materialInput materialInput)
{
czm_material material = czm_getDefaultMaterial(materialInput);
vec2 st = materialInput.st;
vec2 centerPixel = fract(repeat * st);
float centerBump = texture(image, centerPixel).channel;
float imageWidth = float(imageDimensions.x);
vec2 rightPixel = fract(repeat * (st + vec2(1.0 / imageWidth, 0.0)));
float rightBump = texture(image, rightPixel).channel;
float imageHeight = float(imageDimensions.y);
vec2 leftPixel = fract(repeat * (st + vec2(0.0, 1.0 / imageHeight)));
float topBump = texture(image, leftPixel).channel;
vec3 normalTangentSpace = normalize(vec3(centerBump - rightBump, centerBump - topBump, clamp(1.0 - strength, 0.1, 1.0)));
vec3 normalEC = materialInput.tangentToEyeMatrix * normalTangentSpace;
material.normal = normalEC;
material.diffuse = vec3(0.01);
return material;
}
`;var WB=`uniform vec4 lightColor;
uniform vec4 darkColor;
uniform vec2 repeat;
czm_material czm_getMaterial(czm_materialInput materialInput)
{
czm_material material = czm_getDefaultMaterial(materialInput);
vec2 st = materialInput.st;
float b = mod(floor(repeat.s * st.s) + floor(repeat.t * st.t), 2.0);
float scaledWidth = fract(repeat.s * st.s);
scaledWidth = abs(scaledWidth - floor(scaledWidth + 0.5));
float scaledHeight = fract(repeat.t * st.t);
scaledHeight = abs(scaledHeight - floor(scaledHeight + 0.5));
float value = min(scaledWidth, scaledHeight);
vec4 currentColor = mix(lightColor, darkColor, b);
vec4 color = czm_antialias(lightColor, darkColor, currentColor, value, 0.03);
color = czm_gammaCorrect(color);
material.diffuse = color.rgb;
material.alpha = color.a;
return material;
}
`;var qB=`uniform vec4 lightColor;
uniform vec4 darkColor;
uniform vec2 repeat;
czm_material czm_getMaterial(czm_materialInput materialInput)
{
czm_material material = czm_getDefaultMaterial(materialInput);
float b = smoothstep(0.3, 0.32, length(fract(repeat * materialInput.st) - 0.5));
vec4 color = mix(lightColor, darkColor, b);
color = czm_gammaCorrect(color);
material.diffuse = color.rgb;
material.alpha = color.a;
return material;
}
`;var YB=`uniform sampler2D heights;
uniform sampler2D colors;
float getHeight(int idx, float invTexSize)
{
vec2 uv = vec2((float(idx) + 0.5) * invTexSize, 0.5);
#ifdef OES_texture_float
return texture(heights, uv).x;
#else
return czm_unpackFloat(texture(heights, uv));
#endif
}
czm_material czm_getMaterial(czm_materialInput materialInput)
{
czm_material material = czm_getDefaultMaterial(materialInput);
float height = materialInput.height;
float invTexSize = 1.0 / float(heightsDimensions.x);
float minHeight = getHeight(0, invTexSize);
float maxHeight = getHeight(heightsDimensions.x - 1, invTexSize);
if (height < minHeight || height > maxHeight) {
material.diffuse = vec3(0.0);
material.alpha = 0.0;
return material;
}
int idxBelow = 0;
int idxAbove = heightsDimensions.x;
float heightBelow = minHeight;
float heightAbove = maxHeight;
const int maxIterations = 16;
for (int i = 0; i < maxIterations; i++) {
if (idxBelow >= idxAbove - 1) {
break;
}
int idxMid = (idxBelow + idxAbove) / 2;
float heightTex = getHeight(idxMid, invTexSize);
if (height > heightTex) {
idxBelow = idxMid;
heightBelow = heightTex;
} else {
idxAbove = idxMid;
heightAbove = heightTex;
}
}
float lerper = heightBelow == heightAbove ? 1.0 : (height - heightBelow) / (heightAbove - heightBelow);
vec2 colorUv = vec2(invTexSize * (float(idxBelow) + 0.5 + lerper), 0.5);
vec4 color = texture(colors, colorUv);
if (color.a > 0.0)
{
color.rgb /= color.a;
}
color.rgb = czm_gammaCorrect(color.rgb);
material.diffuse = color.rgb;
material.alpha = color.a;
return material;
}
`;var XB=`uniform vec4 color;
uniform float spacing;
uniform float width;
czm_material czm_getMaterial(czm_materialInput materialInput)
{
czm_material material = czm_getDefaultMaterial(materialInput);
float distanceToContour = mod(materialInput.height, spacing);
#if (__VERSION__ == 300 || defined(GL_OES_standard_derivatives))
float dxc = abs(dFdx(materialInput.height));
float dyc = abs(dFdy(materialInput.height));
float dF = max(dxc, dyc) * czm_pixelRatio * width;
float alpha = (distanceToContour < dF) ? 1.0 : 0.0;
#else
float alpha = (distanceToContour < (czm_pixelRatio * width)) ? 1.0 : 0.0;
#endif
vec4 outColor = czm_gammaCorrect(vec4(color.rgb, alpha * color.a));
material.diffuse = outColor.rgb;
material.alpha = outColor.a;
return material;
}
`;var KB=`uniform sampler2D image;
uniform float minimumHeight;
uniform float maximumHeight;
czm_material czm_getMaterial(czm_materialInput materialInput)
{
czm_material material = czm_getDefaultMaterial(materialInput);
float scaledHeight = clamp((materialInput.height - minimumHeight) / (maximumHeight - minimumHeight), 0.0, 1.0);
vec4 rampColor = texture(image, vec2(scaledHeight, 0.5));
rampColor = czm_gammaCorrect(rampColor);
material.diffuse = rampColor.rgb;
material.alpha = rampColor.a;
return material;
}
`;var $B=`uniform vec4 fadeInColor;
uniform vec4 fadeOutColor;
uniform float maximumDistance;
uniform bool repeat;
uniform vec2 fadeDirection;
uniform vec2 time;
float getTime(float t, float coord)
{
float scalar = 1.0 / maximumDistance;
float q  = distance(t, coord) * scalar;
if (repeat)
{
float r = distance(t, coord + 1.0) * scalar;
float s = distance(t, coord - 1.0) * scalar;
q = min(min(r, s), q);
}
return clamp(q, 0.0, 1.0);
}
czm_material czm_getMaterial(czm_materialInput materialInput)
{
czm_material material = czm_getDefaultMaterial(materialInput);
vec2 st = materialInput.st;
float s = getTime(time.x, st.s) * fadeDirection.s;
float t = getTime(time.y, st.t) * fadeDirection.t;
float u = length(vec2(s, t));
vec4 color = mix(fadeInColor, fadeOutColor, u);
color = czm_gammaCorrect(color);
material.emission = color.rgb;
material.alpha = color.a;
return material;
}
`;var ZB=`uniform vec4 color;
uniform float cellAlpha;
uniform vec2 lineCount;
uniform vec2 lineThickness;
uniform vec2 lineOffset;
czm_material czm_getMaterial(czm_materialInput materialInput)
{
czm_material material = czm_getDefaultMaterial(materialInput);
vec2 st = materialInput.st;
float scaledWidth = fract(lineCount.s * st.s - lineOffset.s);
scaledWidth = abs(scaledWidth - floor(scaledWidth + 0.5));
float scaledHeight = fract(lineCount.t * st.t - lineOffset.t);
scaledHeight = abs(scaledHeight - floor(scaledHeight + 0.5));
float value;
#if (__VERSION__ == 300 || defined(GL_OES_standard_derivatives))
const float fuzz = 1.2;
vec2 thickness = (lineThickness * czm_pixelRatio) - 1.0;
vec2 dx = abs(dFdx(st));
vec2 dy = abs(dFdy(st));
vec2 dF = vec2(max(dx.s, dy.s), max(dx.t, dy.t)) * lineCount;
value = min(
smoothstep(dF.s * thickness.s, dF.s * (fuzz + thickness.s), scaledWidth),
smoothstep(dF.t * thickness.t, dF.t * (fuzz + thickness.t), scaledHeight));
#else
const float fuzz = 0.05;
vec2 range = 0.5 - (lineThickness * 0.05);
value = min(
1.0 - smoothstep(range.s, range.s + fuzz, scaledWidth),
1.0 - smoothstep(range.t, range.t + fuzz, scaledHeight));
#endif
float dRim = 1.0 - abs(dot(materialInput.normalEC, normalize(materialInput.positionToEyeEC)));
float sRim = smoothstep(0.8, 1.0, dRim);
value *= (1.0 - sRim);
vec4 halfColor;
halfColor.rgb = color.rgb * 0.5;
halfColor.a = color.a * (1.0 - ((1.0 - cellAlpha) * value));
halfColor = czm_gammaCorrect(halfColor);
material.diffuse = halfColor.rgb;
material.emission = halfColor.rgb;
material.alpha = halfColor.a;
return material;
}
`;var JB=`uniform sampler2D image;
uniform float strength;
uniform vec2 repeat;
czm_material czm_getMaterial(czm_materialInput materialInput)
{
czm_material material = czm_getDefaultMaterial(materialInput);
vec4 textureValue = texture(image, fract(repeat * materialInput.st));
vec3 normalTangentSpace = textureValue.channels;
normalTangentSpace.xy = normalTangentSpace.xy * 2.0 - 1.0;
normalTangentSpace.z = clamp(1.0 - strength, 0.1, 1.0);
normalTangentSpace = normalize(normalTangentSpace);
vec3 normalEC = materialInput.tangentToEyeMatrix * normalTangentSpace;
material.normal = normalEC;
return material;
}
`;var QB=`uniform vec4 color;
float getPointOnLine(vec2 p0, vec2 p1, float x)
{
float slope = (p0.y - p1.y) / (p0.x - p1.x);
return slope * (x - p0.x) + p0.y;
}
czm_material czm_getMaterial(czm_materialInput materialInput)
{
czm_material material = czm_getDefaultMaterial(materialInput);
vec2 st = materialInput.st;
#if (__VERSION__ == 300 || defined(GL_OES_standard_derivatives))
float base = 1.0 - abs(fwidth(st.s)) * 10.0 * czm_pixelRatio;
#else
float base = 0.975;
#endif
vec2 center = vec2(1.0, 0.5);
float ptOnUpperLine = getPointOnLine(vec2(base, 1.0), center, st.s);
float ptOnLowerLine = getPointOnLine(vec2(base, 0.0), center, st.s);
float halfWidth = 0.15;
float s = step(0.5 - halfWidth, st.t);
s *= 1.0 - step(0.5 + halfWidth, st.t);
s *= 1.0 - step(base, st.s);
float t = step(base, materialInput.st.s);
t *= 1.0 - step(ptOnUpperLine, st.t);
t *= step(ptOnLowerLine, st.t);
float dist;
if (st.s < base)
{
float d1 = abs(st.t - (0.5 - halfWidth));
float d2 = abs(st.t - (0.5 + halfWidth));
dist = min(d1, d2);
}
else
{
float d1 = czm_infinity;
if (st.t < 0.5 - halfWidth && st.t > 0.5 + halfWidth)
{
d1 = abs(st.s - base);
}
float d2 = abs(st.t - ptOnUpperLine);
float d3 = abs(st.t - ptOnLowerLine);
dist = min(min(d1, d2), d3);
}
vec4 outsideColor = vec4(0.0);
vec4 currentColor = mix(outsideColor, color, clamp(s + t, 0.0, 1.0));
vec4 outColor = czm_antialias(outsideColor, color, currentColor, dist);
outColor = czm_gammaCorrect(outColor);
material.diffuse = outColor.rgb;
material.alpha = outColor.a;
return material;
}
`;var e3=`uniform vec4 color;
uniform vec4 gapColor;
uniform float dashLength;
uniform float dashPattern;
in float v_polylineAngle;
const float maskLength = 16.0;
mat2 rotate(float rad) {
float c = cos(rad);
float s = sin(rad);
return mat2(
c, s,
-s, c
);
}
czm_material czm_getMaterial(czm_materialInput materialInput)
{
czm_material material = czm_getDefaultMaterial(materialInput);
vec2 pos = rotate(v_polylineAngle) * gl_FragCoord.xy;
float dashPosition = fract(pos.x / (dashLength * czm_pixelRatio));
float maskIndex = floor(dashPosition * maskLength);
float maskTest = floor(dashPattern / pow(2.0, maskIndex));
vec4 fragColor = (mod(maskTest, 2.0) < 1.0) ? gapColor : color;
if (fragColor.a < 0.005) {
discard;
}
fragColor = czm_gammaCorrect(fragColor);
material.emission = fragColor.rgb;
material.alpha = fragColor.a;
return material;
}
`;var t3=`uniform vec4 color;
uniform float glowPower;
uniform float taperPower;
czm_material czm_getMaterial(czm_materialInput materialInput)
{
czm_material material = czm_getDefaultMaterial(materialInput);
vec2 st = materialInput.st;
float glow = glowPower / abs(st.t - 0.5) - (glowPower / 0.5);
if (taperPower <= 0.99999) {
glow *= min(1.0, taperPower / (0.5 - st.s * 0.5) - (taperPower / 0.5));
}
vec4 fragColor;
fragColor.rgb = max(vec3(glow - 1.0 + color.rgb), color.rgb);
fragColor.a = clamp(0.0, 1.0, glow) * color.a;
fragColor = czm_gammaCorrect(fragColor);
material.emission = fragColor.rgb;
material.alpha = fragColor.a;
return material;
}
`;var n3=`uniform vec4 color;
uniform vec4 outlineColor;
uniform float outlineWidth;
in float v_width;
czm_material czm_getMaterial(czm_materialInput materialInput)
{
czm_material material = czm_getDefaultMaterial(materialInput);
vec2 st = materialInput.st;
float halfInteriorWidth =  0.5 * (v_width - outlineWidth) / v_width;
float b = step(0.5 - halfInteriorWidth, st.t);
b *= 1.0 - step(0.5 + halfInteriorWidth, st.t);
float d1 = abs(st.t - (0.5 - halfInteriorWidth));
float d2 = abs(st.t - (0.5 + halfInteriorWidth));
float dist = min(d1, d2);
vec4 currentColor = mix(outlineColor, color, b);
vec4 outColor = czm_antialias(outlineColor, color, currentColor, dist);
outColor = czm_gammaCorrect(outColor);
material.diffuse = outColor.rgb;
material.alpha = outColor.a;
return material;
}
`;var i3=`uniform vec4 color;
uniform vec4 rimColor;
uniform float width;
czm_material czm_getMaterial(czm_materialInput materialInput)
{
czm_material material = czm_getDefaultMaterial(materialInput);
float d = 1.0 - dot(materialInput.normalEC, normalize(materialInput.positionToEyeEC));
float s = smoothstep(1.0 - width, 1.0, d);
vec4 outColor = czm_gammaCorrect(color);
vec4 outRimColor = czm_gammaCorrect(rimColor);
material.diffuse = outColor.rgb;
material.emission = outRimColor.rgb * s;
material.alpha = mix(outColor.a, outRimColor.a, s);
return material;
}
`;var o3=`uniform sampler2D image;
czm_material czm_getMaterial(czm_materialInput materialInput)
{
czm_material material = czm_getDefaultMaterial(materialInput);
vec4 rampColor = texture(image, vec2(materialInput.slope / (czm_pi / 2.0), 0.5));
rampColor = czm_gammaCorrect(rampColor);
material.diffuse = rampColor.rgb;
material.alpha = rampColor.a;
return material;
}
`;var r3=`uniform vec4 evenColor;
uniform vec4 oddColor;
uniform float offset;
uniform float repeat;
uniform bool horizontal;
czm_material czm_getMaterial(czm_materialInput materialInput)
{
czm_material material = czm_getDefaultMaterial(materialInput);
float coord = mix(materialInput.st.s, materialInput.st.t, float(horizontal));
float value = fract((coord - offset) * (repeat * 0.5));
float dist = min(value, min(abs(value - 0.5), 1.0 - value));
vec4 currentColor = mix(evenColor, oddColor, step(0.5, value));
vec4 color = czm_antialias(evenColor, oddColor, currentColor, dist);
color = czm_gammaCorrect(color);
material.diffuse = color.rgb;
material.alpha = color.a;
return material;
}
`;var s3=`uniform vec4 waterColor;
uniform vec4 landColor;
czm_material czm_getMaterial(czm_materialInput materialInput)
{
czm_material material = czm_getDefaultMaterial(materialInput);
vec4 outColor = mix(landColor, waterColor, materialInput.waterMask);
outColor = czm_gammaCorrect(outColor);
material.diffuse = outColor.rgb;
material.alpha = outColor.a;
return material;
}
`;var a3=`uniform sampler2D specularMap;
uniform sampler2D normalMap;
uniform vec4 baseWaterColor;
uniform vec4 blendColor;
uniform float frequency;
uniform float animationSpeed;
uniform float amplitude;
uniform float specularIntensity;
uniform float fadeFactor;
czm_material czm_getMaterial(czm_materialInput materialInput)
{
czm_material material = czm_getDefaultMaterial(materialInput);
float time = czm_frameNumber * animationSpeed;
float fade = max(1.0, (length(materialInput.positionToEyeEC) / 10000000000.0) * frequency * fadeFactor);
float specularMapValue = texture(specularMap, materialInput.st).r;
vec4 noise = czm_getWaterNoise(normalMap, materialInput.st * frequency, time, 0.0);
vec3 normalTangentSpace = noise.xyz * vec3(1.0, 1.0, (1.0 / amplitude));
normalTangentSpace.xy /= fade;
normalTangentSpace = mix(vec3(0.0, 0.0, 50.0), normalTangentSpace, specularMapValue);
normalTangentSpace = normalize(normalTangentSpace);
float tsPerturbationRatio = clamp(dot(normalTangentSpace, vec3(0.0, 0.0, 1.0)), 0.0, 1.0);
material.alpha = mix(blendColor.a, baseWaterColor.a, specularMapValue) * specularMapValue;
material.diffuse = mix(blendColor.rgb, baseWaterColor.rgb, specularMapValue);
material.diffuse += (0.1 * tsPerturbationRatio);
material.diffuse = material.diffuse;
material.normal = normalize(materialInput.tangentToEyeMatrix * normalTangentSpace);
material.specular = specularIntensity;
material.shininess = 10.0;
return material;
}
`;function We(e){this.type=void 0,this.shaderSource=void 0,this.materials=void 0,this.uniforms=void 0,this._uniforms=void 0,this.translucent=void 0,this._minificationFilter=y(e.minificationFilter,$t.LINEAR),this._magnificationFilter=y(e.magnificationFilter,fi.LINEAR),this._strict=void 0,this._template=void 0,this._count=void 0,this._texturePaths={},this._loadedImages=[],this._loadedCubeMaps=[],this._textures={},this._updateFunctions=[],this._defaultTexture=void 0,Vve(e,this),Object.defineProperties(this,{type:{value:this.type,writable:!1}}),c(We._uniformList[this.type])||(We._uniformList[this.type]=Object.keys(this._uniforms))}We._uniformList={};We.fromType=function(e,t){if(!c(We._materialCache.getMaterial(e)))throw new E(`material with type '${e}' does not exist.`);let n=new We({fabric:{type:e}});if(c(t))for(let i in t)t.hasOwnProperty(i)&&(n.uniforms[i]=t[i]);return n};We.prototype.isTranslucent=function(){if(c(this.translucent))return typeof this.translucent=="function"?this.translucent():this.translucent;let e=!0,t=this._translucentFunctions,n=t.length;for(let i=0;i<n;++i){let o=t[i];if(typeof o=="function"?e=e&&o():e=e&&o,!e)break}return e};We.prototype.update=function(e){this._defaultTexture=e.defaultTexture;let t,n,i=this._loadedImages,o=i.length;for(t=0;t<o;++t){let l=i[t];n=l.id;let u=l.image,f;Array.isArray(u)&&(f=u.slice(1,u.length).map(function(b){return b.bufferView}),u=u[0]);let d=new Qt({minificationFilter:this._minificationFilter,magnificationFilter:this._magnificationFilter}),p;c(u.internalFormat)?p=new Lt({context:e,pixelFormat:u.internalFormat,width:u.width,height:u.height,source:{arrayBufferView:u.bufferView,mipLevels:f},sampler:d}):p=new Lt({context:e,source:u,sampler:d});let g=this._textures[n];c(g)&&g!==this._defaultTexture&&g.destroy(),this._textures[n]=p;let m=`${n}Dimensions`;if(this.uniforms.hasOwnProperty(m)){let b=this.uniforms[m];b.x=p._width,b.y=p._height}}i.length=0;let r=this._loadedCubeMaps;for(o=r.length,t=0;t<o;++t){let l=r[t];n=l.id;let u=l.images,f=new Jo({context:e,source:{positiveX:u[0],negativeX:u[1],positiveY:u[2],negativeY:u[3],positiveZ:u[4],negativeZ:u[5]},sampler:new Qt({minificationFilter:this._minificationFilter,magnificationFilter:this._magnificationFilter})});this._textures[n]=f}r.length=0;let s=this._updateFunctions;for(o=s.length,t=0;t<o;++t)s[t](this,e);let a=this.materials;for(let l in a)a.hasOwnProperty(l)&&a[l].update(e)};We.prototype.isDestroyed=function(){return!1};We.prototype.destroy=function(){let e=this._textures;for(let n in e)if(e.hasOwnProperty(n)){let i=e[n];i!==this._defaultTexture&&i.destroy()}let t=this.materials;for(let n in t)t.hasOwnProperty(n)&&t[n].destroy();return de(this)};function Vve(e,t){e=y(e,y.EMPTY_OBJECT),t._strict=y(e.strict,!1),t._count=y(e.count,0),t._template=qe(y(e.fabric,y.EMPTY_OBJECT)),t._template.uniforms=qe(y(t._template.uniforms,y.EMPTY_OBJECT)),t._template.materials=qe(y(t._template.materials,y.EMPTY_OBJECT)),t.type=c(t._template.type)?t._template.type:Hn(),t.shaderSource="",t.materials={},t.uniforms={},t._uniforms={},t._translucentFunctions=[];let n,i=We._materialCache.getMaterial(t.type);if(c(i)){let r=qe(i.fabric,!0);t._template=At(t._template,r,!0),n=i.translucent}Gve(t),c(i)||We._materialCache.addMaterial(t.type,t),Wve(t),Kve(t),Zve(t);let o=t._translucentFunctions.length===0?!0:void 0;if(n=y(n,o),n=y(e.translucent,n),c(n))if(typeof n=="function"){let r=function(){return n(t)};t._translucentFunctions.push(r)}else t._translucentFunctions.push(n)}function c3(e,t,n,i){if(c(e)){for(let o in e)if(e.hasOwnProperty(o)){let r=t.indexOf(o)!==-1;(i&&!r||!i&&r)&&n(o,t)}}}function KJ(e,t){let n=`fabric: property name '${e}' is not valid. It should be `;for(let i=0;i<t.length;i++){let o=`'${t[i]}'`;n+=i===t.length-1?`or ${o}.`:`${o}, `}throw new E(n)}function Uve(e,t){let n=`fabric: uniforms and materials cannot share the same property '${e}'`;throw new E(n)}var zve=["type","materials","uniforms","components","source"],Hve=["diffuse","specular","shininess","normal","emission","alpha"];function Gve(e){let t=e._template,n=t.uniforms,i=t.materials,o=t.components;if(c(o)&&c(t.source))throw new E("fabric: cannot have source and components in the same template.");c3(t,zve,KJ,!0),c3(o,Hve,KJ,!0);let r=[];for(let s in i)i.hasOwnProperty(s)&&r.push(s);c3(n,r,Uve,!1)}function jve(e,t){let n=t._template.materials;for(let i in n)if(n.hasOwnProperty(i)&&e.indexOf(i)>-1)return!0;return!1}function Wve(e){let t=e._template.components,n=e._template.source;if(c(n))e.shaderSource+=`${n}
`;else{if(e.shaderSource+=`czm_material czm_getMaterial(czm_materialInput materialInput)
{
`,e.shaderSource+=`czm_material material = czm_getDefaultMaterial(materialInput);
`,c(t)){let i=Object.keys(e._template.materials).length>0;for(let o in t)if(t.hasOwnProperty(o))if(o==="diffuse"||o==="emission"){let s=i&&jve(t[o],e)?t[o]:`czm_gammaCorrect(${t[o]})`;e.shaderSource+=`material.${o} = ${s}; 
`}else o==="alpha"?e.shaderSource+=`material.alpha = ${t.alpha}; 
`:e.shaderSource+=`material.${o} = ${t[o]};
`}e.shaderSource+=`return material;
}
`}}var $J={mat2:Gi,mat3:Q,mat4:k},qve=/\.ktx2$/i;function Yve(e){let t;return function(n,i){let o=n.uniforms,r=o[e],s=t!==r,a=!c(r)||r===We.DefaultImageId;t=r;let l=n._textures[e],u,f;if(r instanceof HTMLVideoElement){if(r.readyState>=2){if(s&&c(l)&&(l!==i.defaultTexture&&l.destroy(),l=void 0),!c(l)||l===i.defaultTexture){let p=new Qt({minificationFilter:n._minificationFilter,magnificationFilter:n._magnificationFilter});l=new Lt({context:i,source:r,sampler:p}),n._textures[e]=l;return}l.copyFrom({source:r})}else c(l)||(n._textures[e]=i.defaultTexture);return}if(r instanceof Lt&&r!==l){n._texturePaths[e]=void 0;let p=n._textures[e];c(p)&&p!==n._defaultTexture&&p.destroy(),n._textures[e]=r,u=`${e}Dimensions`,o.hasOwnProperty(u)&&(f=o[u],f.x=r._width,f.y=r._height);return}if(s&&c(l)&&a&&(l!==n._defaultTexture&&l.destroy(),l=void 0),c(l)||(n._texturePaths[e]=void 0,l=n._textures[e]=n._defaultTexture,u=`${e}Dimensions`,o.hasOwnProperty(u)&&(f=o[u],f.x=l._width,f.y=l._height)),a)return;let d=r instanceof De;if(!c(n._texturePaths[e])||d&&r.url!==n._texturePaths[e].url||!d&&r!==n._texturePaths[e]){if(typeof r=="string"||d){let p=d?r:De.createIfNeeded(r),g;qve.test(p.url)?g=Mu(p.url):g=p.fetchImage(),Promise.resolve(g).then(function(m){n._loadedImages.push({id:e,image:m})}).catch(function(){c(l)&&l!==n._defaultTexture&&l.destroy(),n._textures[e]=n._defaultTexture})}else(r instanceof HTMLCanvasElement||r instanceof HTMLImageElement)&&n._loadedImages.push({id:e,image:r});n._texturePaths[e]=r}}}function Xve(e){return function(t,n){let i=t.uniforms[e];if(i instanceof Jo){let r=t._textures[e];r!==t._defaultTexture&&r.destroy(),t._texturePaths[e]=void 0,t._textures[e]=i;return}if(c(t._textures[e])||(t._texturePaths[e]=void 0,t._textures[e]=n.defaultCubeMap),i===We.DefaultCubeMapId)return;let o=i.positiveX+i.negativeX+i.positiveY+i.negativeY+i.positiveZ+i.negativeZ;if(o!==t._texturePaths[e]){let r=[De.createIfNeeded(i.positiveX).fetchImage(),De.createIfNeeded(i.negativeX).fetchImage(),De.createIfNeeded(i.positiveY).fetchImage(),De.createIfNeeded(i.negativeY).fetchImage(),De.createIfNeeded(i.positiveZ).fetchImage(),De.createIfNeeded(i.negativeZ).fetchImage()];Promise.all(r).then(function(s){t._loadedCubeMaps.push({id:e,images:s})}),t._texturePaths[e]=o}}}function Kve(e){let t=e._template.uniforms;for(let n in t)t.hasOwnProperty(n)&&ZJ(e,n)}function ZJ(e,t){let n=e._strict,i=e._template.uniforms,o=i[t],r=$ve(o);if(!c(r))throw new E(`fabric: uniform '${t}' has invalid type.`);let s;if(r==="channels"){if(s=OE(e,t,o,!1),s===0&&n)throw new E(`strict: shader source does not use channels '${t}'.`)}else{if(r==="sampler2D"){let u=`${t}Dimensions`;Jve(e,u)>0&&(i[u]={type:"ivec3",x:1,y:1},ZJ(e,u))}if(!new RegExp(`uniform\\s+${r}\\s+${t}\\s*;`).test(e.shaderSource)){let u=`uniform ${r} ${t};`;e.shaderSource=u+e.shaderSource}let l=`${t}_${e._count++}`;if(s=OE(e,t,l),s===1&&n)throw new E(`strict: shader source does not use uniform '${t}'.`);if(e.uniforms[t]=o,r==="sampler2D")e._uniforms[l]=function(){return e._textures[t]},e._updateFunctions.push(Yve(t));else if(r==="samplerCube")e._uniforms[l]=function(){return e._textures[t]},e._updateFunctions.push(Xve(t));else if(r.indexOf("mat")!==-1){let u=new $J[r];e._uniforms[l]=function(){return $J[r].fromColumnMajorArray(e.uniforms[t],u)}}else e._uniforms[l]=function(){return e.uniforms[t]}}}function $ve(e){let t=e.type;if(!c(t)){let n=typeof e;if(n==="number")t="float";else if(n==="boolean")t="bool";else if(n==="string"||e instanceof De||e instanceof HTMLCanvasElement||e instanceof HTMLImageElement)/^([rgba]){1,4}$/i.test(e)?t="channels":e===We.DefaultCubeMapId?t="samplerCube":t="sampler2D";else if(n==="object")if(Array.isArray(e))(e.length===4||e.length===9||e.length===16)&&(t=`mat${Math.sqrt(e.length)}`);else{let i=0;for(let o in e)e.hasOwnProperty(o)&&(i+=1);i>=2&&i<=4?t=`vec${i}`:i===6&&(t="samplerCube")}}return t}function Zve(e){let t=e._strict,n=e._template.materials;for(let i in n)if(n.hasOwnProperty(i)){let o=new We({strict:t,fabric:n[i],count:e._count});e._count=o._count,e._uniforms=At(e._uniforms,o._uniforms,!0),e.materials[i]=o,e._translucentFunctions=e._translucentFunctions.concat(o._translucentFunctions);let r="czm_getMaterial",s=`${r}_${e._count++}`;OE(o,r,s),e.shaderSource=o.shaderSource+e.shaderSource;let a=`${s}(materialInput)`;if(OE(e,i,a)===0&&t)throw new E(`strict: shader source does not use material '${i}'.`)}}function OE(e,t,n,i){i=y(i,!0);let o=0,r="([\\w])?",s=`([\\w${i?".":""}])?`,a=new RegExp(s+t+r,"g");return e.shaderSource=e.shaderSource.replace(a,function(l,u,f){return u||f?l:(o+=1,n)}),o}function Jve(e,t,n){return OE(e,t,t,n)}We._materialCache={_materials:{},addMaterial:function(e,t){this._materials[e]=t},getMaterial:function(e){return this._materials[e]}};We.DefaultImageId="czm_defaultImage";We.DefaultCubeMapId="czm_defaultCubeMap";We.ColorType="Color";We._materialCache.addMaterial(We.ColorType,{fabric:{type:We.ColorType,uniforms:{color:new j(1,0,0,.5)},components:{diffuse:"color.rgb",alpha:"color.a"}},translucent:function(e){return e.uniforms.color.alpha<1}});We.ImageType="Image";We._materialCache.addMaterial(We.ImageType,{fabric:{type:We.ImageType,uniforms:{image:We.DefaultImageId,repeat:new H(1,1),color:new j(1,1,1,1)},components:{diffuse:"texture(image, fract(repeat * materialInput.st)).rgb * color.rgb",alpha:"texture(image, fract(repeat * materialInput.st)).a * color.a"}},translucent:function(e){return e.uniforms.color.alpha<1}});We.DiffuseMapType="DiffuseMap";We._materialCache.addMaterial(We.DiffuseMapType,{fabric:{type:We.DiffuseMapType,uniforms:{image:We.DefaultImageId,channels:"rgb",repeat:new H(1,1)},components:{diffuse:"texture(image, fract(repeat * materialInput.st)).channels"}},translucent:!1});We.AlphaMapType="AlphaMap";We._materialCache.addMaterial(We.AlphaMapType,{fabric:{type:We.AlphaMapType,uniforms:{image:We.DefaultImageId,channel:"a",repeat:new H(1,1)},components:{alpha:"texture(image, fract(repeat * materialInput.st)).channel"}},translucent:!0});We.SpecularMapType="SpecularMap";We._materialCache.addMaterial(We.SpecularMapType,{fabric:{type:We.SpecularMapType,uniforms:{image:We.DefaultImageId,channel:"r",repeat:new H(1,1)},components:{specular:"texture(image, fract(repeat * materialInput.st)).channel"}},translucent:!1});We.EmissionMapType="EmissionMap";We._materialCache.addMaterial(We.EmissionMapType,{fabric:{type:We.EmissionMapType,uniforms:{image:We.DefaultImageId,channels:"rgb",repeat:new H(1,1)},components:{emission:"texture(image, fract(repeat * materialInput.st)).channels"}},translucent:!1});We.BumpMapType="BumpMap";We._materialCache.addMaterial(We.BumpMapType,{fabric:{type:We.BumpMapType,uniforms:{image:We.DefaultImageId,channel:"r",strength:.8,repeat:new H(1,1)},source:jB},translucent:!1});We.NormalMapType="NormalMap";We._materialCache.addMaterial(We.NormalMapType,{fabric:{type:We.NormalMapType,uniforms:{image:We.DefaultImageId,channels:"rgb",strength:.8,repeat:new H(1,1)},source:JB},translucent:!1});We.GridType="Grid";We._materialCache.addMaterial(We.GridType,{fabric:{type:We.GridType,uniforms:{color:new j(0,1,0,1),cellAlpha:.1,lineCount:new H(8,8),lineThickness:new H(1,1),lineOffset:new H(0,0)},source:ZB},translucent:function(e){let t=e.uniforms;return t.color.alpha<1||t.cellAlpha<1}});We.StripeType="Stripe";We._materialCache.addMaterial(We.StripeType,{fabric:{type:We.StripeType,uniforms:{horizontal:!0,evenColor:new j(1,1,1,.5),oddColor:new j(0,0,1,.5),offset:0,repeat:5},source:r3},translucent:function(e){let t=e.uniforms;return t.evenColor.alpha<1||t.oddColor.alpha<1}});We.CheckerboardType="Checkerboard";We._materialCache.addMaterial(We.CheckerboardType,{fabric:{type:We.CheckerboardType,uniforms:{lightColor:new j(1,1,1,.5),darkColor:new j(0,0,0,.5),repeat:new H(5,5)},source:WB},translucent:function(e){let t=e.uniforms;return t.lightColor.alpha<1||t.darkColor.alpha<1}});We.DotType="Dot";We._materialCache.addMaterial(We.DotType,{fabric:{type:We.DotType,uniforms:{lightColor:new j(1,1,0,.75),darkColor:new j(0,1,1,.75),repeat:new H(5,5)},source:qB},translucent:function(e){let t=e.uniforms;return t.lightColor.alpha<1||t.darkColor.alpha<1}});We.WaterType="Water";We._materialCache.addMaterial(We.WaterType,{fabric:{type:We.WaterType,uniforms:{baseWaterColor:new j(.2,.3,.6,1),blendColor:new j(0,1,.699,1),specularMap:We.DefaultImageId,normalMap:We.DefaultImageId,frequency:10,animationSpeed:.01,amplitude:1,specularIntensity:.5,fadeFactor:1},source:a3},translucent:function(e){let t=e.uniforms;return t.baseWaterColor.alpha<1||t.blendColor.alpha<1}});We.RimLightingType="RimLighting";We._materialCache.addMaterial(We.RimLightingType,{fabric:{type:We.RimLightingType,uniforms:{color:new j(1,0,0,.7),rimColor:new j(1,1,1,.4),width:.3},source:i3},translucent:function(e){let t=e.uniforms;return t.color.alpha<1||t.rimColor.alpha<1}});We.FadeType="Fade";We._materialCache.addMaterial(We.FadeType,{fabric:{type:We.FadeType,uniforms:{fadeInColor:new j(1,0,0,1),fadeOutColor:new j(0,0,0,0),maximumDistance:.5,repeat:!0,fadeDirection:{x:!0,y:!0},time:new H(.5,.5)},source:$B},translucent:function(e){let t=e.uniforms;return t.fadeInColor.alpha<1||t.fadeOutColor.alpha<1}});We.PolylineArrowType="PolylineArrow";We._materialCache.addMaterial(We.PolylineArrowType,{fabric:{type:We.PolylineArrowType,uniforms:{color:new j(1,1,1,1)},source:QB},translucent:!0});We.PolylineDashType="PolylineDash";We._materialCache.addMaterial(We.PolylineDashType,{fabric:{type:We.PolylineDashType,uniforms:{color:new j(1,0,1,1),gapColor:new j(0,0,0,0),dashLength:16,dashPattern:255},source:e3},translucent:!0});We.PolylineGlowType="PolylineGlow";We._materialCache.addMaterial(We.PolylineGlowType,{fabric:{type:We.PolylineGlowType,uniforms:{color:new j(0,.5,1,1),glowPower:.25,taperPower:1},source:t3},translucent:!0});We.PolylineOutlineType="PolylineOutline";We._materialCache.addMaterial(We.PolylineOutlineType,{fabric:{type:We.PolylineOutlineType,uniforms:{color:new j(1,1,1,1),outlineColor:new j(1,0,0,1),outlineWidth:1},source:n3},translucent:function(e){let t=e.uniforms;return t.color.alpha<1||t.outlineColor.alpha<1}});We.ElevationContourType="ElevationContour";We._materialCache.addMaterial(We.ElevationContourType,{fabric:{type:We.ElevationContourType,uniforms:{spacing:100,color:new j(1,0,0,1),width:1},source:XB},translucent:!1});We.ElevationRampType="ElevationRamp";We._materialCache.addMaterial(We.ElevationRampType,{fabric:{type:We.ElevationRampType,uniforms:{image:We.DefaultImageId,minimumHeight:0,maximumHeight:1e4},source:KB},translucent:!1});We.SlopeRampMaterialType="SlopeRamp";We._materialCache.addMaterial(We.SlopeRampMaterialType,{fabric:{type:We.SlopeRampMaterialType,uniforms:{image:We.DefaultImageId},source:o3},translucent:!1});We.AspectRampMaterialType="AspectRamp";We._materialCache.addMaterial(We.AspectRampMaterialType,{fabric:{type:We.AspectRampMaterialType,uniforms:{image:We.DefaultImageId},source:GB},translucent:!1});We.ElevationBandType="ElevationBand";We._materialCache.addMaterial(We.ElevationBandType,{fabric:{type:We.ElevationBandType,uniforms:{heights:We.DefaultImageId,colors:We.DefaultImageId},source:YB},translucent:!0});We.WaterMaskType="WaterMask";We._materialCache.addMaterial(We.WaterMaskType,{fabric:{type:We.WaterMaskType,source:s3,uniforms:{waterColor:new j(1,1,1,1),landColor:new j(0,0,0,0)}},translucent:!1});var Ki=We;function Gy(e){e=y(e,y.EMPTY_OBJECT);let t=y(e.translucent,!0),n=y(e.closed,!1),i=y(e.materialSupport,Gy.MaterialSupport.TEXTURED);this.material=c(e.material)?e.material:Ki.fromType(Ki.ColorType),this.translucent=t,this._vertexShaderSource=y(e.vertexShaderSource,i.vertexShaderSource),this._fragmentShaderSource=y(e.fragmentShaderSource,i.fragmentShaderSource),this._renderState=io.getDefaultRenderState(t,n,e.renderState),this._closed=n,this._materialSupport=i,this._vertexFormat=i.vertexFormat,this._flat=y(e.flat,!1),this._faceForward=y(e.faceForward,!n)}Object.defineProperties(Gy.prototype,{vertexShaderSource:{get:function(){return this._vertexShaderSource}},fragmentShaderSource:{get:function(){return this._fragmentShaderSource}},renderState:{get:function(){return this._renderState}},closed:{get:function(){return this._closed}},materialSupport:{get:function(){return this._materialSupport}},vertexFormat:{get:function(){return this._vertexFormat}},flat:{get:function(){return this._flat}},faceForward:{get:function(){return this._faceForward}}});Gy.prototype.getFragmentShaderSource=io.prototype.getFragmentShaderSource;Gy.prototype.isTranslucent=io.prototype.isTranslucent;Gy.prototype.getRenderState=io.prototype.getRenderState;Gy.MaterialSupport={BASIC:Object.freeze({vertexFormat:Ie.POSITION_AND_NORMAL,vertexShaderSource:fB,fragmentShaderSource:uB}),TEXTURED:Object.freeze({vertexFormat:Ie.POSITION_NORMAL_AND_ST,vertexShaderSource:hB,fragmentShaderSource:dB}),ALL:Object.freeze({vertexFormat:Ie.ALL,vertexShaderSource:lB,fragmentShaderSource:cB})};var uo=Gy;var l3=`in vec3 v_positionEC;
in vec3 v_normalEC;
in vec4 v_color;
void main()
{
vec3 positionToEyeEC = -v_positionEC;
vec3 normalEC = normalize(v_normalEC);
#ifdef FACE_FORWARD
normalEC = faceforward(normalEC, vec3(0.0, 0.0, 1.0), -normalEC);
#endif
vec4 color = czm_gammaCorrect(v_color);
czm_materialInput materialInput;
materialInput.normalEC = normalEC;
materialInput.positionToEyeEC = positionToEyeEC;
czm_material material = czm_getDefaultMaterial(materialInput);
material.diffuse = color.rgb;
material.alpha = color.a;
out_FragColor = czm_phong(normalize(positionToEyeEC), material, czm_lightDirectionEC);
}
`;var u3=`in vec3 position3DHigh;
in vec3 position3DLow;
in vec3 normal;
in vec4 color;
in float batchId;
out vec3 v_positionEC;
out vec3 v_normalEC;
out vec4 v_color;
void main()
{
vec4 p = czm_computePosition();
v_positionEC = (czm_modelViewRelativeToEye * p).xyz;
v_normalEC = czm_normal * normal;
v_color = color;
gl_Position = czm_modelViewProjectionRelativeToEye * p;
}
`;var RE=`in vec4 v_color;
void main()
{
out_FragColor = czm_gammaCorrect(v_color);
}
`;var f3=`in vec3 position3DHigh;
in vec3 position3DLow;
in vec4 color;
in float batchId;
out vec4 v_color;
void main()
{
vec4 p = czm_computePosition();
v_color = color;
gl_Position = czm_modelViewProjectionRelativeToEye * p;
}
`;function Pm(e){e=y(e,y.EMPTY_OBJECT);let t=y(e.translucent,!0),n=y(e.closed,!1),i=y(e.flat,!1),o=i?f3:u3,r=i?RE:l3,s=i?Pm.FLAT_VERTEX_FORMAT:Pm.VERTEX_FORMAT;this.material=void 0,this.translucent=t,this._vertexShaderSource=y(e.vertexShaderSource,o),this._fragmentShaderSource=y(e.fragmentShaderSource,r),this._renderState=io.getDefaultRenderState(t,n,e.renderState),this._closed=n,this._vertexFormat=s,this._flat=i,this._faceForward=y(e.faceForward,!n)}Object.defineProperties(Pm.prototype,{vertexShaderSource:{get:function(){return this._vertexShaderSource}},fragmentShaderSource:{get:function(){return this._fragmentShaderSource}},renderState:{get:function(){return this._renderState}},closed:{get:function(){return this._closed}},vertexFormat:{get:function(){return this._vertexFormat}},flat:{get:function(){return this._flat}},faceForward:{get:function(){return this._faceForward}}});Pm.VERTEX_FORMAT=Ie.POSITION_AND_NORMAL;Pm.FLAT_VERTEX_FORMAT=Ie.POSITION_ONLY;Pm.prototype.getFragmentShaderSource=io.prototype.getFragmentShaderSource;Pm.prototype.isTranslucent=io.prototype.isTranslucent;Pm.prototype.getRenderState=io.prototype.getRenderState;var ln=Pm;function Gx(e){this._definitionChanged=new pe,this._color=void 0,this._colorSubscription=void 0,this.color=e}Object.defineProperties(Gx.prototype,{isConstant:{get:function(){return X.isConstant(this._color)}},definitionChanged:{get:function(){return this._definitionChanged}},color:fe("color")});Gx.prototype.getType=function(e){return"Color"};var Qve=new J;Gx.prototype.getValue=function(e,t){return c(e)||(e=J.now(Qve)),c(t)||(t={}),t.color=X.getValueOrClonedDefault(this._color,e,j.WHITE,t.color),t};Gx.prototype.equals=function(e){return this===e||e instanceof Gx&&X.equals(this._color,e._color)};var Ht=Gx;function C_(e){e=y(e,y.EMPTY_OBJECT),this._ellipsoid=y(e.ellipsoid,ie.default),this._rectangle=y(e.rectangle,ae.MAX_VALUE),this._projection=new Mi(this._ellipsoid),this._numberOfLevelZeroTilesX=y(e.numberOfLevelZeroTilesX,2),this._numberOfLevelZeroTilesY=y(e.numberOfLevelZeroTilesY,1)}Object.defineProperties(C_.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},rectangle:{get:function(){return this._rectangle}},projection:{get:function(){return this._projection}}});C_.prototype.getNumberOfXTilesAtLevel=function(e){return this._numberOfLevelZeroTilesX<<e};C_.prototype.getNumberOfYTilesAtLevel=function(e){return this._numberOfLevelZeroTilesY<<e};C_.prototype.rectangleToNativeRectangle=function(e,t){A.defined("rectangle",e);let n=R.toDegrees(e.west),i=R.toDegrees(e.south),o=R.toDegrees(e.east),r=R.toDegrees(e.north);return c(t)?(t.west=n,t.south=i,t.east=o,t.north=r,t):new ae(n,i,o,r)};C_.prototype.tileXYToNativeRectangle=function(e,t,n,i){let o=this.tileXYToRectangle(e,t,n,i);return o.west=R.toDegrees(o.west),o.south=R.toDegrees(o.south),o.east=R.toDegrees(o.east),o.north=R.toDegrees(o.north),o};C_.prototype.tileXYToRectangle=function(e,t,n,i){let o=this._rectangle,r=this.getNumberOfXTilesAtLevel(n),s=this.getNumberOfYTilesAtLevel(n),a=o.width/r,l=e*a+o.west,u=(e+1)*a+o.west,f=o.height/s,d=o.north-t*f,p=o.north-(t+1)*f;return c(i)||(i=new ae(l,p,u,d)),i.west=l,i.south=p,i.east=u,i.north=d,i};C_.prototype.positionToTileXY=function(e,t,n){let i=this._rectangle;if(!ae.contains(i,e))return;let o=this.getNumberOfXTilesAtLevel(t),r=this.getNumberOfYTilesAtLevel(t),s=i.width/o,a=i.height/r,l=e.longitude;i.east<i.west&&(l+=R.TWO_PI);let u=(l-i.west)/s|0;u>=o&&(u=o-1);let f=(i.north-e.latitude)/a|0;return f>=r&&(f=r-1),c(n)?(n.x=u,n.y=f,n):new H(u,f)};var $i=C_;var JJ=new h,QJ=new h,eQ=new he,d3=new h,eDe=new h,tQ=new ce,tDe=new $i,ME=[new he,new he,new he,new he],LE=new H,dr={};dr.initialize=function(){let e=dr._initPromise;return c(e)||(e=De.fetchJson(sn("Assets/approximateTerrainHeights.json")).then(function(t){dr._terrainHeights=t}),dr._initPromise=e),e};dr.getMinimumMaximumHeights=function(e,t){if(A.defined("rectangle",e),!c(dr._terrainHeights))throw new E("You must call ApproximateTerrainHeights.initialize and wait for the promise to resolve before using this function");t=y(t,ie.default);let n=nQ(e),i=dr._defaultMinTerrainHeight,o=dr._defaultMaxTerrainHeight;if(c(n)){let r=`${n.level}-${n.x}-${n.y}`,s=dr._terrainHeights[r];c(s)&&(i=s[0],o=s[1]),t.cartographicToCartesian(ae.northeast(e,eQ),JJ),t.cartographicToCartesian(ae.southwest(e,eQ),QJ),h.midpoint(QJ,JJ,d3);let a=t.scaleToGeodeticSurface(d3,eDe);if(c(a)){let l=h.distance(d3,a);i=Math.min(i,-l)}else i=dr._defaultMinTerrainHeight}return i=Math.max(dr._defaultMinTerrainHeight,i),{minimumTerrainHeight:i,maximumTerrainHeight:o}};dr.getBoundingSphere=function(e,t){if(A.defined("rectangle",e),!c(dr._terrainHeights))throw new E("You must call ApproximateTerrainHeights.initialize and wait for the promise to resolve before using this function");t=y(t,ie.default);let n=nQ(e),i=dr._defaultMaxTerrainHeight;if(c(n)){let r=`${n.level}-${n.x}-${n.y}`,s=dr._terrainHeights[r];c(s)&&(i=s[1])}let o=ce.fromRectangle3D(e,t,0);return ce.fromRectangle3D(e,t,i,tQ),ce.union(o,tQ,o)};function nQ(e){he.fromRadians(e.east,e.north,0,ME[0]),he.fromRadians(e.west,e.north,0,ME[1]),he.fromRadians(e.east,e.south,0,ME[2]),he.fromRadians(e.west,e.south,0,ME[3]);let t=0,n=0,i=0,o=0,r=dr._terrainHeightsMaxLevel,s;for(s=0;s<=r;++s){let a=!1;for(let l=0;l<4;++l){let u=ME[l];if(tDe.positionToTileXY(u,s,LE),l===0)i=LE.x,o=LE.y;else if(i!==LE.x||o!==LE.y){a=!0;break}}if(a)break;t=i,n=o}if(s!==0)return{x:t,y:n,level:s>r?r:s-1}}dr._terrainHeightsMaxLevel=6;dr._defaultMaxTerrainHeight=9e3;dr._defaultMinTerrainHeight=-1e5;dr._terrainHeights=void 0;dr._initPromise=void 0;Object.defineProperties(dr,{initialized:{get:function(){return c(dr._terrainHeights)}}});var di=dr;function hc(e,t,n){this.minimum=h.clone(y(e,h.ZERO)),this.maximum=h.clone(y(t,h.ZERO)),c(n)?n=h.clone(n):n=h.midpoint(this.minimum,this.maximum,new h),this.center=n}hc.fromCorners=function(e,t,n){return A.defined("minimum",e),A.defined("maximum",t),c(n)||(n=new hc),n.minimum=h.clone(e,n.minimum),n.maximum=h.clone(t,n.maximum),n.center=h.midpoint(e,t,n.center),n};hc.fromPoints=function(e,t){if(c(t)||(t=new hc),!c(e)||e.length===0)return t.minimum=h.clone(h.ZERO,t.minimum),t.maximum=h.clone(h.ZERO,t.maximum),t.center=h.clone(h.ZERO,t.center),t;let n=e[0].x,i=e[0].y,o=e[0].z,r=e[0].x,s=e[0].y,a=e[0].z,l=e.length;for(let d=1;d<l;d++){let p=e[d],g=p.x,m=p.y,b=p.z;n=Math.min(g,n),r=Math.max(g,r),i=Math.min(m,i),s=Math.max(m,s),o=Math.min(b,o),a=Math.max(b,a)}let u=t.minimum;u.x=n,u.y=i,u.z=o;let f=t.maximum;return f.x=r,f.y=s,f.z=a,t.center=h.midpoint(u,f,t.center),t};hc.clone=function(e,t){if(c(e))return c(t)?(t.minimum=h.clone(e.minimum,t.minimum),t.maximum=h.clone(e.maximum,t.maximum),t.center=h.clone(e.center,t.center),t):new hc(e.minimum,e.maximum,e.center)};hc.equals=function(e,t){return e===t||c(e)&&c(t)&&h.equals(e.center,t.center)&&h.equals(e.minimum,t.minimum)&&h.equals(e.maximum,t.maximum)};var UI=new h;hc.intersectPlane=function(e,t){A.defined("box",e),A.defined("plane",t),UI=h.subtract(e.maximum,e.minimum,UI);let n=h.multiplyByScalar(UI,.5,UI),i=t.normal,o=n.x*Math.abs(i.x)+n.y*Math.abs(i.y)+n.z*Math.abs(i.z),r=h.dot(e.center,i)+t.distance;return r-o>0?qt.INSIDE:r+o<0?qt.OUTSIDE:qt.INTERSECTING};hc.prototype.clone=function(e){return hc.clone(this,e)};hc.prototype.intersectPlane=function(e){return hc.intersectPlane(this,e)};hc.prototype.equals=function(e){return hc.equals(this,e)};var jx=hc;var h3=new se;function sh(e,t){if(A.defined("origin",e),t=y(t,ie.default),e=t.scaleToGeodeticSurface(e),!c(e))throw new E("origin must not be at the center of the ellipsoid.");let n=Ft.eastNorthUpToFixedFrame(e,t);this._ellipsoid=t,this._origin=e,this._xAxis=h.fromCartesian4(k.getColumn(n,0,h3)),this._yAxis=h.fromCartesian4(k.getColumn(n,1,h3));let i=h.fromCartesian4(k.getColumn(n,2,h3));this._plane=un.fromPointNormal(e,i)}Object.defineProperties(sh.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},origin:{get:function(){return this._origin}},plane:{get:function(){return this._plane}},xAxis:{get:function(){return this._xAxis}},yAxis:{get:function(){return this._yAxis}},zAxis:{get:function(){return this._plane.normal}}});var nDe=new jx;sh.fromPoints=function(e,t){A.defined("cartesians",e);let n=jx.fromPoints(e,nDe);return new sh(n.center,t)};var iQ=new _n,zI=new h;sh.prototype.projectPointOntoPlane=function(e,t){A.defined("cartesian",e);let n=iQ;n.origin=e,h.normalize(e,n.direction);let i=Qn.rayPlane(n,this._plane,zI);if(c(i)||(h.negate(n.direction,n.direction),i=Qn.rayPlane(n,this._plane,zI)),c(i)){let o=h.subtract(i,this._origin,i),r=h.dot(this._xAxis,o),s=h.dot(this._yAxis,o);return c(t)?(t.x=r,t.y=s,t):new H(r,s)}};sh.prototype.projectPointsOntoPlane=function(e,t){A.defined("cartesians",e),c(t)||(t=[]);let n=0,i=e.length;for(let o=0;o<i;o++){let r=this.projectPointOntoPlane(e[o],t[n]);c(r)&&(t[n]=r,n++)}return t.length=n,t};sh.prototype.projectPointToNearestOnPlane=function(e,t){A.defined("cartesian",e),c(t)||(t=new H);let n=iQ;n.origin=e,h.clone(this._plane.normal,n.direction);let i=Qn.rayPlane(n,this._plane,zI);c(i)||(h.negate(n.direction,n.direction),i=Qn.rayPlane(n,this._plane,zI));let o=h.subtract(i,this._origin,i),r=h.dot(this._xAxis,o),s=h.dot(this._yAxis,o);return t.x=r,t.y=s,t};sh.prototype.projectPointsToNearestOnPlane=function(e,t){A.defined("cartesians",e),c(t)||(t=[]);let n=e.length;t.length=n;for(let i=0;i<n;i++)t[i]=this.projectPointToNearestOnPlane(e[i],t[i]);return t};var iDe=new h;sh.prototype.projectPointOntoEllipsoid=function(e,t){A.defined("cartesian",e),c(t)||(t=new h);let n=this._ellipsoid,i=this._origin,o=this._xAxis,r=this._yAxis,s=iDe;return h.multiplyByScalar(o,e.x,s),t=h.add(i,s,t),h.multiplyByScalar(r,e.y,s),h.add(t,s,t),n.scaleToGeocentricSurface(t,t),t};sh.prototype.projectPointsOntoEllipsoid=function(e,t){A.defined("cartesians",e);let n=e.length;c(t)?t.length=n:t=new Array(n);for(let i=0;i<n;++i)t[i]=this.projectPointOntoEllipsoid(e[i],t[i]);return t};var cs=sh;function Di(e,t){this.center=h.clone(y(e,h.ZERO)),this.halfAxes=Q.clone(y(t,Q.ZERO))}Di.packedLength=h.packedLength+Q.packedLength;Di.pack=function(e,t,n){return A.typeOf.object("value",e),A.defined("array",t),n=y(n,0),h.pack(e.center,t,n),Q.pack(e.halfAxes,t,n+h.packedLength),t};Di.unpack=function(e,t,n){return A.defined("array",e),t=y(t,0),c(n)||(n=new Di),h.unpack(e,t,n.center),Q.unpack(e,t+h.packedLength,n.halfAxes),n};var oDe=new h,rDe=new h,sDe=new h,aDe=new h,cDe=new h,lDe=new h,uDe=new Q,fDe={unitary:new Q,diagonal:new Q};Di.fromPoints=function(e,t){if(c(t)||(t=new Di),!c(e)||e.length===0)return t.halfAxes=Q.ZERO,t.center=h.ZERO,t;let n,i=e.length,o=h.clone(e[0],oDe);for(n=1;n<i;n++)h.add(o,e[n],o);let r=1/i;h.multiplyByScalar(o,r,o);let s=0,a=0,l=0,u=0,f=0,d=0,p;for(n=0;n<i;n++)p=h.subtract(e[n],o,rDe),s+=p.x*p.x,a+=p.x*p.y,l+=p.x*p.z,u+=p.y*p.y,f+=p.y*p.z,d+=p.z*p.z;s*=r,a*=r,l*=r,u*=r,f*=r,d*=r;let g=uDe;g[0]=s,g[1]=a,g[2]=l,g[3]=a,g[4]=u,g[5]=f,g[6]=l,g[7]=f,g[8]=d;let m=Q.computeEigenDecomposition(g,fDe),b=Q.clone(m.unitary,t.halfAxes),x=Q.getColumn(b,0,aDe),T=Q.getColumn(b,1,cDe),C=Q.getColumn(b,2,lDe),S=-Number.MAX_VALUE,v=-Number.MAX_VALUE,D=-Number.MAX_VALUE,I=Number.MAX_VALUE,L=Number.MAX_VALUE,M=Number.MAX_VALUE;for(n=0;n<i;n++)p=e[n],S=Math.max(h.dot(x,p),S),v=Math.max(h.dot(T,p),v),D=Math.max(h.dot(C,p),D),I=Math.min(h.dot(x,p),I),L=Math.min(h.dot(T,p),L),M=Math.min(h.dot(C,p),M);x=h.multiplyByScalar(x,.5*(I+S),x),T=h.multiplyByScalar(T,.5*(L+v),T),C=h.multiplyByScalar(C,.5*(M+D),C);let N=h.add(x,T,t.center);h.add(N,C,N);let B=sDe;return B.x=S-I,B.y=v-L,B.z=D-M,h.multiplyByScalar(B,.5,B),Q.multiplyByScale(t.halfAxes,B,t.halfAxes),t};var lQ=new h,dDe=new h;function oQ(e,t,n,i,o,r,s,a,l,u,f){if(!c(o)||!c(r)||!c(s)||!c(a)||!c(l)||!c(u))throw new E("all extents (minimum/maximum X/Y/Z) are required.");c(f)||(f=new Di);let d=f.halfAxes;Q.setColumn(d,0,t,d),Q.setColumn(d,1,n,d),Q.setColumn(d,2,i,d);let p=lQ;p.x=(o+r)/2,p.y=(s+a)/2,p.z=(l+u)/2;let g=dDe;g.x=(r-o)/2,g.y=(a-s)/2,g.z=(u-l)/2;let m=f.center;return p=Q.multiplyByVector(d,p,p),h.add(e,p,m),Q.multiplyByScale(d,g,d),f}var rQ=new he,hDe=new h,mDe=new he,pDe=new he,_De=new he,gDe=new he,yDe=new he,bDe=new h,sQ=new h,xDe=new h,aQ=new h,TDe=new h,ADe=new H,CDe=new H,EDe=new H,SDe=new H,wDe=new H,vDe=new h,DDe=new h,PDe=new h,IDe=new h,ODe=new H,RDe=new h,MDe=new h,LDe=new h,NDe=new un(h.UNIT_X,0);Di.fromRectangle=function(e,t,n,i,o){if(!c(e))throw new E("rectangle is required");if(e.width<0||e.width>R.TWO_PI)throw new E("Rectangle width must be between 0 and 2 * pi");if(e.height<0||e.height>R.PI)throw new E("Rectangle height must be between 0 and pi");if(c(i)&&!R.equalsEpsilon(i.radii.x,i.radii.y,R.EPSILON15))throw new E("Ellipsoid must be an ellipsoid of revolution (radii.x == radii.y)");t=y(t,0),n=y(n,0),i=y(i,ie.default);let r,s,a,l,u,f,d;if(e.width<=R.PI){let L=ae.center(e,rQ),M=i.cartographicToCartesian(L,hDe),N=new cs(M,i);d=N.plane;let B=L.longitude,_=e.south<0&&e.north>0?0:L.latitude,w=he.fromRadians(B,e.north,n,mDe),P=he.fromRadians(e.west,e.north,n,pDe),O=he.fromRadians(e.west,_,n,_De),F=he.fromRadians(e.west,e.south,n,gDe),V=he.fromRadians(B,e.south,n,yDe),G=i.cartographicToCartesian(w,bDe),z=i.cartographicToCartesian(P,sQ),W=i.cartographicToCartesian(O,xDe),U=i.cartographicToCartesian(F,aQ),q=i.cartographicToCartesian(V,TDe),K=N.projectPointToNearestOnPlane(G,ADe),te=N.projectPointToNearestOnPlane(z,CDe),Y=N.projectPointToNearestOnPlane(W,EDe),Z=N.projectPointToNearestOnPlane(U,SDe),ee=N.projectPointToNearestOnPlane(q,wDe);return r=Math.min(te.x,Y.x,Z.x),s=-r,l=Math.max(te.y,K.y),a=Math.min(Z.y,ee.y),P.height=F.height=t,z=i.cartographicToCartesian(P,sQ),U=i.cartographicToCartesian(F,aQ),u=Math.min(un.getPointDistance(d,z),un.getPointDistance(d,U)),f=n,oQ(N.origin,N.xAxis,N.yAxis,N.zAxis,r,s,a,l,u,f,o)}let p=e.south>0,g=e.north<0,m=p?e.south:g?e.north:0,b=ae.center(e,rQ).longitude,x=h.fromRadians(b,m,n,i,vDe);x.z=0;let C=Math.abs(x.x)<R.EPSILON10&&Math.abs(x.y)<R.EPSILON10?h.UNIT_X:h.normalize(x,DDe),S=h.UNIT_Z,v=h.cross(C,S,PDe);d=un.fromPointNormal(x,C,NDe);let D=h.fromRadians(b+R.PI_OVER_TWO,m,n,i,IDe);s=h.dot(un.projectPointOntoPlane(d,D,ODe),v),r=-s,l=h.fromRadians(0,e.north,g?t:n,i,RDe).z,a=h.fromRadians(0,e.south,p?t:n,i,MDe).z;let I=h.fromRadians(e.east,m,n,i,LDe);return u=un.getPointDistance(d,I),f=0,oQ(x,v,S,C,r,s,a,l,u,f,o)};Di.fromTransformation=function(e,t){return A.typeOf.object("transformation",e),c(t)||(t=new Di),t.center=k.getTranslation(e,t.center),t.halfAxes=k.getMatrix3(e,t.halfAxes),t.halfAxes=Q.multiplyByScalar(t.halfAxes,.5,t.halfAxes),t};Di.clone=function(e,t){if(c(e))return c(t)?(h.clone(e.center,t.center),Q.clone(e.halfAxes,t.halfAxes),t):new Di(e.center,e.halfAxes)};Di.intersectPlane=function(e,t){if(!c(e))throw new E("box is required.");if(!c(t))throw new E("plane is required.");let n=e.center,i=t.normal,o=e.halfAxes,r=i.x,s=i.y,a=i.z,l=Math.abs(r*o[Q.COLUMN0ROW0]+s*o[Q.COLUMN0ROW1]+a*o[Q.COLUMN0ROW2])+Math.abs(r*o[Q.COLUMN1ROW0]+s*o[Q.COLUMN1ROW1]+a*o[Q.COLUMN1ROW2])+Math.abs(r*o[Q.COLUMN2ROW0]+s*o[Q.COLUMN2ROW1]+a*o[Q.COLUMN2ROW2]),u=h.dot(i,n)+t.distance;return u<=-l?qt.OUTSIDE:u>=l?qt.INSIDE:qt.INTERSECTING};var uQ=new h,fQ=new h,dQ=new h,FDe=new h,cQ=new h,BDe=new h;Di.distanceSquaredTo=function(e,t){if(!c(e))throw new E("box is required.");if(!c(t))throw new E("cartesian is required.");let n=h.subtract(t,e.center,lQ),i=e.halfAxes,o=Q.getColumn(i,0,uQ),r=Q.getColumn(i,1,fQ),s=Q.getColumn(i,2,dQ),a=h.magnitude(o),l=h.magnitude(r),u=h.magnitude(s),f=!0,d=!0,p=!0;a>0?h.divideByScalar(o,a,o):f=!1,l>0?h.divideByScalar(r,l,r):d=!1,u>0?h.divideByScalar(s,u,s):p=!1;let g=!f+!d+!p,m,b,x;if(g===1){let v=o;m=r,b=s,d?p||(v=s,b=o):(v=r,m=o),x=h.cross(m,b,cQ),v===o?o=x:v===r?r=x:v===s&&(s=x)}else if(g===2){m=o,d?m=r:p&&(m=s);let v=h.UNIT_Y;v.equalsEpsilon(m,R.EPSILON3)&&(v=h.UNIT_X),b=h.cross(m,v,FDe),h.normalize(b,b),x=h.cross(m,b,cQ),h.normalize(x,x),m===o?(r=b,s=x):m===r?(s=b,o=x):m===s&&(o=b,r=x)}else g===3&&(o=h.UNIT_X,r=h.UNIT_Y,s=h.UNIT_Z);let T=BDe;T.x=h.dot(n,o),T.y=h.dot(n,r),T.z=h.dot(n,s);let C=0,S;return T.x<-a?(S=T.x+a,C+=S*S):T.x>a&&(S=T.x-a,C+=S*S),T.y<-l?(S=T.y+l,C+=S*S):T.y>l&&(S=T.y-l,C+=S*S),T.z<-u?(S=T.z+u,C+=S*S):T.z>u&&(S=T.z-u,C+=S*S),C};var kDe=new h,VDe=new h;Di.computePlaneDistances=function(e,t,n,i){if(!c(e))throw new E("box is required.");if(!c(t))throw new E("position is required.");if(!c(n))throw new E("direction is required.");c(i)||(i=new lc);let o=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY,s=e.center,a=e.halfAxes,l=Q.getColumn(a,0,uQ),u=Q.getColumn(a,1,fQ),f=Q.getColumn(a,2,dQ),d=h.add(l,u,kDe);h.add(d,f,d),h.add(d,s,d);let p=h.subtract(d,t,VDe),g=h.dot(n,p);return o=Math.min(g,o),r=Math.max(g,r),h.add(s,l,d),h.add(d,u,d),h.subtract(d,f,d),h.subtract(d,t,p),g=h.dot(n,p),o=Math.min(g,o),r=Math.max(g,r),h.add(s,l,d),h.subtract(d,u,d),h.add(d,f,d),h.subtract(d,t,p),g=h.dot(n,p),o=Math.min(g,o),r=Math.max(g,r),h.add(s,l,d),h.subtract(d,u,d),h.subtract(d,f,d),h.subtract(d,t,p),g=h.dot(n,p),o=Math.min(g,o),r=Math.max(g,r),h.subtract(s,l,d),h.add(d,u,d),h.add(d,f,d),h.subtract(d,t,p),g=h.dot(n,p),o=Math.min(g,o),r=Math.max(g,r),h.subtract(s,l,d),h.add(d,u,d),h.subtract(d,f,d),h.subtract(d,t,p),g=h.dot(n,p),o=Math.min(g,o),r=Math.max(g,r),h.subtract(s,l,d),h.subtract(d,u,d),h.add(d,f,d),h.subtract(d,t,p),g=h.dot(n,p),o=Math.min(g,o),r=Math.max(g,r),h.subtract(s,l,d),h.subtract(d,u,d),h.subtract(d,f,d),h.subtract(d,t,p),g=h.dot(n,p),o=Math.min(g,o),r=Math.max(g,r),i.start=o,i.stop=r,i};var UDe=new h,zDe=new h,HDe=new h;Di.computeCorners=function(e,t){A.typeOf.object("box",e),c(t)||(t=[new h,new h,new h,new h,new h,new h,new h,new h]);let n=e.center,i=e.halfAxes,o=Q.getColumn(i,0,UDe),r=Q.getColumn(i,1,zDe),s=Q.getColumn(i,2,HDe);return h.clone(n,t[0]),h.subtract(t[0],o,t[0]),h.subtract(t[0],r,t[0]),h.subtract(t[0],s,t[0]),h.clone(n,t[1]),h.subtract(t[1],o,t[1]),h.subtract(t[1],r,t[1]),h.add(t[1],s,t[1]),h.clone(n,t[2]),h.subtract(t[2],o,t[2]),h.add(t[2],r,t[2]),h.subtract(t[2],s,t[2]),h.clone(n,t[3]),h.subtract(t[3],o,t[3]),h.add(t[3],r,t[3]),h.add(t[3],s,t[3]),h.clone(n,t[4]),h.add(t[4],o,t[4]),h.subtract(t[4],r,t[4]),h.subtract(t[4],s,t[4]),h.clone(n,t[5]),h.add(t[5],o,t[5]),h.subtract(t[5],r,t[5]),h.add(t[5],s,t[5]),h.clone(n,t[6]),h.add(t[6],o,t[6]),h.add(t[6],r,t[6]),h.subtract(t[6],s,t[6]),h.clone(n,t[7]),h.add(t[7],o,t[7]),h.add(t[7],r,t[7]),h.add(t[7],s,t[7]),t};var GDe=new Q;Di.computeTransformation=function(e,t){A.typeOf.object("box",e),c(t)||(t=new k);let n=e.center,i=Q.multiplyByUniformScale(e.halfAxes,2,GDe);return k.fromRotationTranslation(i,n,t)};var jDe=new ce;Di.isOccluded=function(e,t){if(!c(e))throw new E("box is required.");if(!c(t))throw new E("occluder is required.");let n=ce.fromOrientedBoundingBox(e,jDe);return!t.isBoundingSphereVisible(n)};Di.prototype.intersectPlane=function(e){return Di.intersectPlane(this,e)};Di.prototype.distanceSquaredTo=function(e){return Di.distanceSquaredTo(this,e)};Di.prototype.computePlaneDistances=function(e,t,n){return Di.computePlaneDistances(this,e,t,n)};Di.prototype.computeCorners=function(e){return Di.computeCorners(this,e)};Di.prototype.computeTransformation=function(e){return Di.computeTransformation(this,e)};Di.prototype.isOccluded=function(e){return Di.isOccluded(this,e)};Di.equals=function(e,t){return e===t||c(e)&&c(t)&&h.equals(e.center,t.center)&&Q.equals(e.halfAxes,t.halfAxes)};Di.prototype.clone=function(e){return Di.clone(this,e)};Di.prototype.equals=function(e){return Di.equals(this,e)};var Pn=Di;var HI={};HI.getHeight=function(e,t,n){if(!Number.isFinite(t))throw new E("scale must be a finite number.");if(!Number.isFinite(n))throw new E("relativeHeight must be a finite number.");return(e-n)*t+n};var WDe=new he;HI.getPosition=function(e,t,n,i,o){let r=t.cartesianToCartographic(e,WDe);if(!c(r))return h.clone(e,o);let s=HI.getHeight(r.height,n,i);return h.fromRadians(r.longitude,r.latitude,s,t,o)};var zr=HI;var hr={CULL:1,OCCLUDE:2,EXECUTE_IN_CLOSEST_FRUSTUM:4,DEBUG_SHOW_BOUNDING_VOLUME:8,CAST_SHADOWS:16,RECEIVE_SHADOWS:32,PICK_ONLY:64,DEPTH_FOR_TRANSLUCENT_CLASSIFICATION:128};function NE(e){e=y(e,y.EMPTY_OBJECT),this._boundingVolume=e.boundingVolume,this._orientedBoundingBox=e.orientedBoundingBox,this._modelMatrix=e.modelMatrix,this._primitiveType=y(e.primitiveType,Me.TRIANGLES),this._vertexArray=e.vertexArray,this._count=e.count,this._offset=y(e.offset,0),this._instanceCount=y(e.instanceCount,0),this._shaderProgram=e.shaderProgram,this._uniformMap=e.uniformMap,this._renderState=e.renderState,this._framebuffer=e.framebuffer,this._pass=e.pass,this._owner=e.owner,this._debugOverlappingFrustums=0,this._pickId=e.pickId,this._pickMetadataAllowed=e.pickMetadataAllowed===!0,this._pickedMetadataInfo=void 0,this._flags=0,this.cull=y(e.cull,!0),this.occlude=y(e.occlude,!0),this.executeInClosestFrustum=y(e.executeInClosestFrustum,!1),this.debugShowBoundingVolume=y(e.debugShowBoundingVolume,!1),this.castShadows=y(e.castShadows,!1),this.receiveShadows=y(e.receiveShadows,!1),this.pickOnly=y(e.pickOnly,!1),this.depthForTranslucentClassification=y(e.depthForTranslucentClassification,!1),this.dirty=!0,this.lastDirtyTime=0,this.derivedCommands={}}function Va(e,t){return(e._flags&t)===t}function E_(e,t,n){n?e._flags|=t:e._flags&=~t}Object.defineProperties(NE.prototype,{boundingVolume:{get:function(){return this._boundingVolume},set:function(e){this._boundingVolume!==e&&(this._boundingVolume=e,this.dirty=!0)}},orientedBoundingBox:{get:function(){return this._orientedBoundingBox},set:function(e){this._orientedBoundingBox!==e&&(this._orientedBoundingBox=e,this.dirty=!0)}},cull:{get:function(){return Va(this,hr.CULL)},set:function(e){Va(this,hr.CULL)!==e&&(E_(this,hr.CULL,e),this.dirty=!0)}},occlude:{get:function(){return Va(this,hr.OCCLUDE)},set:function(e){Va(this,hr.OCCLUDE)!==e&&(E_(this,hr.OCCLUDE,e),this.dirty=!0)}},modelMatrix:{get:function(){return this._modelMatrix},set:function(e){this._modelMatrix!==e&&(this._modelMatrix=e,this.dirty=!0)}},primitiveType:{get:function(){return this._primitiveType},set:function(e){this._primitiveType!==e&&(this._primitiveType=e,this.dirty=!0)}},vertexArray:{get:function(){return this._vertexArray},set:function(e){this._vertexArray!==e&&(this._vertexArray=e,this.dirty=!0)}},count:{get:function(){return this._count},set:function(e){this._count!==e&&(this._count=e,this.dirty=!0)}},offset:{get:function(){return this._offset},set:function(e){this._offset!==e&&(this._offset=e,this.dirty=!0)}},instanceCount:{get:function(){return this._instanceCount},set:function(e){this._instanceCount!==e&&(this._instanceCount=e,this.dirty=!0)}},shaderProgram:{get:function(){return this._shaderProgram},set:function(e){this._shaderProgram!==e&&(this._shaderProgram=e,this.dirty=!0)}},castShadows:{get:function(){return Va(this,hr.CAST_SHADOWS)},set:function(e){Va(this,hr.CAST_SHADOWS)!==e&&(E_(this,hr.CAST_SHADOWS,e),this.dirty=!0)}},receiveShadows:{get:function(){return Va(this,hr.RECEIVE_SHADOWS)},set:function(e){Va(this,hr.RECEIVE_SHADOWS)!==e&&(E_(this,hr.RECEIVE_SHADOWS,e),this.dirty=!0)}},uniformMap:{get:function(){return this._uniformMap},set:function(e){this._uniformMap!==e&&(this._uniformMap=e,this.dirty=!0)}},renderState:{get:function(){return this._renderState},set:function(e){this._renderState!==e&&(this._renderState=e,this.dirty=!0)}},framebuffer:{get:function(){return this._framebuffer},set:function(e){this._framebuffer!==e&&(this._framebuffer=e,this.dirty=!0)}},pass:{get:function(){return this._pass},set:function(e){this._pass!==e&&(this._pass=e,this.dirty=!0)}},executeInClosestFrustum:{get:function(){return Va(this,hr.EXECUTE_IN_CLOSEST_FRUSTUM)},set:function(e){Va(this,hr.EXECUTE_IN_CLOSEST_FRUSTUM)!==e&&(E_(this,hr.EXECUTE_IN_CLOSEST_FRUSTUM,e),this.dirty=!0)}},owner:{get:function(){return this._owner},set:function(e){this._owner!==e&&(this._owner=e,this.dirty=!0)}},debugShowBoundingVolume:{get:function(){return Va(this,hr.DEBUG_SHOW_BOUNDING_VOLUME)},set:function(e){Va(this,hr.DEBUG_SHOW_BOUNDING_VOLUME)!==e&&(E_(this,hr.DEBUG_SHOW_BOUNDING_VOLUME,e),this.dirty=!0)}},debugOverlappingFrustums:{get:function(){return this._debugOverlappingFrustums},set:function(e){this._debugOverlappingFrustums!==e&&(this._debugOverlappingFrustums=e,this.dirty=!0)}},pickId:{get:function(){return this._pickId},set:function(e){this._pickId!==e&&(this._pickId=e,this.dirty=!0)}},pickMetadataAllowed:{get:function(){return this._pickMetadataAllowed}},pickedMetadataInfo:{get:function(){return this._pickedMetadataInfo},set:function(e){this._pickedMetadataInfo!==e&&(this._pickedMetadataInfo=e,this.dirty=!0)}},pickOnly:{get:function(){return Va(this,hr.PICK_ONLY)},set:function(e){Va(this,hr.PICK_ONLY)!==e&&(E_(this,hr.PICK_ONLY,e),this.dirty=!0)}},depthForTranslucentClassification:{get:function(){return Va(this,hr.DEPTH_FOR_TRANSLUCENT_CLASSIFICATION)},set:function(e){Va(this,hr.DEPTH_FOR_TRANSLUCENT_CLASSIFICATION)!==e&&(E_(this,hr.DEPTH_FOR_TRANSLUCENT_CLASSIFICATION,e),this.dirty=!0)}}});NE.shallowClone=function(e,t){if(c(e))return c(t)||(t=new NE),t._boundingVolume=e._boundingVolume,t._orientedBoundingBox=e._orientedBoundingBox,t._modelMatrix=e._modelMatrix,t._primitiveType=e._primitiveType,t._vertexArray=e._vertexArray,t._count=e._count,t._offset=e._offset,t._instanceCount=e._instanceCount,t._shaderProgram=e._shaderProgram,t._uniformMap=e._uniformMap,t._renderState=e._renderState,t._framebuffer=e._framebuffer,t._pass=e._pass,t._owner=e._owner,t._debugOverlappingFrustums=e._debugOverlappingFrustums,t._pickId=e._pickId,t._pickMetadataAllowed=e._pickMetadataAllowed,t._pickedMetadataInfo=e._pickedMetadataInfo,t._flags=e._flags,t.dirty=!0,t.lastDirtyTime=0,t};NE.prototype.execute=function(e,t){e.draw(this,t)};var et=NE;var qDe={ENVIRONMENT:0,COMPUTE:1,GLOBE:2,TERRAIN_CLASSIFICATION:3,CESIUM_3D_TILE:4,CESIUM_3D_TILE_CLASSIFICATION:5,CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW:6,OPAQUE:7,TRANSLUCENT:8,VOXELS:9,OVERLAY:10,NUMBER_OF_PASSES:11},ve=Object.freeze(qDe);var GI={CLOCKWISE:ne.CW,COUNTER_CLOCKWISE:ne.CCW};GI.validate=function(e){return e===GI.CLOCKWISE||e===GI.COUNTER_CLOCKWISE};var ls=Object.freeze(GI);function hQ(e){if(typeof e!="object"||e===null)return e;let t,n=Object.keys(e);for(let i=0;i<n.length;i++)t=n[i],e.hasOwnProperty(t)&&t!=="_applyFunctions"&&(e[t]=hQ(e[t]));return Object.freeze(e)}var m3=hQ;function mQ(e){return e===ne.FUNC_ADD||e===ne.FUNC_SUBTRACT||e===ne.FUNC_REVERSE_SUBTRACT||e===ne.MIN||e===ne.MAX}function jI(e){return e===ne.ZERO||e===ne.ONE||e===ne.SRC_COLOR||e===ne.ONE_MINUS_SRC_COLOR||e===ne.DST_COLOR||e===ne.ONE_MINUS_DST_COLOR||e===ne.SRC_ALPHA||e===ne.ONE_MINUS_SRC_ALPHA||e===ne.DST_ALPHA||e===ne.ONE_MINUS_DST_ALPHA||e===ne.CONSTANT_COLOR||e===ne.ONE_MINUS_CONSTANT_COLOR||e===ne.CONSTANT_ALPHA||e===ne.ONE_MINUS_CONSTANT_ALPHA||e===ne.SRC_ALPHA_SATURATE}function YDe(e){return e===ne.FRONT||e===ne.BACK||e===ne.FRONT_AND_BACK}function XDe(e){return e===ne.NEVER||e===ne.LESS||e===ne.EQUAL||e===ne.LEQUAL||e===ne.GREATER||e===ne.NOTEQUAL||e===ne.GEQUAL||e===ne.ALWAYS}function pQ(e){return e===ne.NEVER||e===ne.LESS||e===ne.EQUAL||e===ne.LEQUAL||e===ne.GREATER||e===ne.NOTEQUAL||e===ne.GEQUAL||e===ne.ALWAYS}function Wx(e){return e===ne.ZERO||e===ne.KEEP||e===ne.REPLACE||e===ne.INCR||e===ne.DECR||e===ne.INVERT||e===ne.INCR_WRAP||e===ne.DECR_WRAP}function ch(e){let t=y(e,y.EMPTY_OBJECT),n=y(t.cull,y.EMPTY_OBJECT),i=y(t.polygonOffset,y.EMPTY_OBJECT),o=y(t.scissorTest,y.EMPTY_OBJECT),r=y(o.rectangle,y.EMPTY_OBJECT),s=y(t.depthRange,y.EMPTY_OBJECT),a=y(t.depthTest,y.EMPTY_OBJECT),l=y(t.colorMask,y.EMPTY_OBJECT),u=y(t.blending,y.EMPTY_OBJECT),f=y(u.color,y.EMPTY_OBJECT),d=y(t.stencilTest,y.EMPTY_OBJECT),p=y(d.frontOperation,y.EMPTY_OBJECT),g=y(d.backOperation,y.EMPTY_OBJECT),m=y(t.sampleCoverage,y.EMPTY_OBJECT),b=t.viewport;if(this.frontFace=y(t.frontFace,ls.COUNTER_CLOCKWISE),this.cull={enabled:y(n.enabled,!1),face:y(n.face,ne.BACK)},this.lineWidth=y(t.lineWidth,1),this.polygonOffset={enabled:y(i.enabled,!1),factor:y(i.factor,0),units:y(i.units,0)},this.scissorTest={enabled:y(o.enabled,!1),rectangle:Ke.clone(r)},this.depthRange={near:y(s.near,0),far:y(s.far,1)},this.depthTest={enabled:y(a.enabled,!1),func:y(a.func,ne.LESS)},this.colorMask={red:y(l.red,!0),green:y(l.green,!0),blue:y(l.blue,!0),alpha:y(l.alpha,!0)},this.depthMask=y(t.depthMask,!0),this.stencilMask=y(t.stencilMask,-1),this.blending={enabled:y(u.enabled,!1),color:new j(y(f.red,0),y(f.green,0),y(f.blue,0),y(f.alpha,0)),equationRgb:y(u.equationRgb,ne.FUNC_ADD),equationAlpha:y(u.equationAlpha,ne.FUNC_ADD),functionSourceRgb:y(u.functionSourceRgb,ne.ONE),functionSourceAlpha:y(u.functionSourceAlpha,ne.ONE),functionDestinationRgb:y(u.functionDestinationRgb,ne.ZERO),functionDestinationAlpha:y(u.functionDestinationAlpha,ne.ZERO)},this.stencilTest={enabled:y(d.enabled,!1),frontFunction:y(d.frontFunction,ne.ALWAYS),backFunction:y(d.backFunction,ne.ALWAYS),reference:y(d.reference,0),mask:y(d.mask,-1),frontOperation:{fail:y(p.fail,ne.KEEP),zFail:y(p.zFail,ne.KEEP),zPass:y(p.zPass,ne.KEEP)},backOperation:{fail:y(g.fail,ne.KEEP),zFail:y(g.zFail,ne.KEEP),zPass:y(g.zPass,ne.KEEP)}},this.sampleCoverage={enabled:y(m.enabled,!1),value:y(m.value,1),invert:y(m.invert,!1)},this.viewport=c(b)?new Ke(b.x,b.y,b.width,b.height):void 0,this.lineWidth<mt.minimumAliasedLineWidth||this.lineWidth>mt.maximumAliasedLineWidth)throw new E("renderState.lineWidth is out of range.  Check minimumAliasedLineWidth and maximumAliasedLineWidth.");if(!ls.validate(this.frontFace))throw new E("Invalid renderState.frontFace.");if(!YDe(this.cull.face))throw new E("Invalid renderState.cull.face.");if(this.scissorTest.rectangle.width<0||this.scissorTest.rectangle.height<0)throw new E("renderState.scissorTest.rectangle.width and renderState.scissorTest.rectangle.height must be greater than or equal to zero.");if(this.depthRange.near>this.depthRange.far)throw new E("renderState.depthRange.near can not be greater than renderState.depthRange.far.");if(this.depthRange.near<0)throw new E("renderState.depthRange.near must be greater than or equal to zero.");if(this.depthRange.far>1)throw new E("renderState.depthRange.far must be less than or equal to one.");if(!XDe(this.depthTest.func))throw new E("Invalid renderState.depthTest.func.");if(this.blending.color.red<0||this.blending.color.red>1||this.blending.color.green<0||this.blending.color.green>1||this.blending.color.blue<0||this.blending.color.blue>1||this.blending.color.alpha<0||this.blending.color.alpha>1)throw new E("renderState.blending.color components must be greater than or equal to zero and less than or equal to one.");if(!mQ(this.blending.equationRgb))throw new E("Invalid renderState.blending.equationRgb.");if(!mQ(this.blending.equationAlpha))throw new E("Invalid renderState.blending.equationAlpha.");if(!jI(this.blending.functionSourceRgb))throw new E("Invalid renderState.blending.functionSourceRgb.");if(!jI(this.blending.functionSourceAlpha))throw new E("Invalid renderState.blending.functionSourceAlpha.");if(!jI(this.blending.functionDestinationRgb))throw new E("Invalid renderState.blending.functionDestinationRgb.");if(!jI(this.blending.functionDestinationAlpha))throw new E("Invalid renderState.blending.functionDestinationAlpha.");if(!pQ(this.stencilTest.frontFunction))throw new E("Invalid renderState.stencilTest.frontFunction.");if(!pQ(this.stencilTest.backFunction))throw new E("Invalid renderState.stencilTest.backFunction.");if(!Wx(this.stencilTest.frontOperation.fail))throw new E("Invalid renderState.stencilTest.frontOperation.fail.");if(!Wx(this.stencilTest.frontOperation.zFail))throw new E("Invalid renderState.stencilTest.frontOperation.zFail.");if(!Wx(this.stencilTest.frontOperation.zPass))throw new E("Invalid renderState.stencilTest.frontOperation.zPass.");if(!Wx(this.stencilTest.backOperation.fail))throw new E("Invalid renderState.stencilTest.backOperation.fail.");if(!Wx(this.stencilTest.backOperation.zFail))throw new E("Invalid renderState.stencilTest.backOperation.zFail.");if(!Wx(this.stencilTest.backOperation.zPass))throw new E("Invalid renderState.stencilTest.backOperation.zPass.");if(c(this.viewport)){if(this.viewport.width<0)throw new E("renderState.viewport.width must be greater than or equal to zero.");if(this.viewport.height<0)throw new E("renderState.viewport.height must be greater than or equal to zero.");if(this.viewport.width>mt.maximumViewportWidth)throw new E(`renderState.viewport.width must be less than or equal to the maximum viewport width (${mt.maximumViewportWidth.toString()}).  Check maximumViewportWidth.`);if(this.viewport.height>mt.maximumViewportHeight)throw new E(`renderState.viewport.height must be less than or equal to the maximum viewport height (${mt.maximumViewportHeight.toString()}).  Check maximumViewportHeight.`)}this.id=0,this._applyFunctions=[]}var KDe=0,ah={};ch.fromCache=function(e){let t=JSON.stringify(e),n=ah[t];if(c(n))return++n.referenceCount,n.state;let i=new ch(e),o=JSON.stringify(i);return n=ah[o],c(n)||(i.id=KDe++,i=m3(i),n={referenceCount:0,state:i},ah[o]=n),++n.referenceCount,ah[t]={referenceCount:1,state:n.state},n.state};ch.removeFromCache=function(e){let t=new ch(e),n=JSON.stringify(t),i=ah[n],o=JSON.stringify(e),r=ah[o];c(r)&&(--r.referenceCount,r.referenceCount===0&&(delete ah[o],c(i)&&--i.referenceCount)),c(i)&&i.referenceCount===0&&delete ah[n]};ch.getCache=function(){return ah};ch.clearCache=function(){ah={}};function jy(e,t,n){n?e.enable(t):e.disable(t)}function _Q(e,t){e.frontFace(t.frontFace)}function gQ(e,t){let n=t.cull,i=n.enabled;jy(e,e.CULL_FACE,i),i&&e.cullFace(n.face)}function yQ(e,t){e.lineWidth(t.lineWidth)}function bQ(e,t){let n=t.polygonOffset,i=n.enabled;jy(e,e.POLYGON_OFFSET_FILL,i),i&&e.polygonOffset(n.factor,n.units)}function xQ(e,t,n){let i=t.scissorTest,o=c(n.scissorTest)?n.scissorTest.enabled:i.enabled;if(jy(e,e.SCISSOR_TEST,o),o){let r=c(n.scissorTest)?n.scissorTest.rectangle:i.rectangle;e.scissor(r.x,r.y,r.width,r.height)}}function TQ(e,t){let n=t.depthRange;e.depthRange(n.near,n.far)}function AQ(e,t){let n=t.depthTest,i=n.enabled;jy(e,e.DEPTH_TEST,i),i&&e.depthFunc(n.func)}function CQ(e,t){let n=t.colorMask;e.colorMask(n.red,n.green,n.blue,n.alpha)}function EQ(e,t){e.depthMask(t.depthMask)}function SQ(e,t){e.stencilMask(t.stencilMask)}function $De(e,t){e.blendColor(t.red,t.green,t.blue,t.alpha)}function wQ(e,t,n){let i=t.blending,o=c(n.blendingEnabled)?n.blendingEnabled:i.enabled;jy(e,e.BLEND,o),o&&($De(e,i.color),e.blendEquationSeparate(i.equationRgb,i.equationAlpha),e.blendFuncSeparate(i.functionSourceRgb,i.functionDestinationRgb,i.functionSourceAlpha,i.functionDestinationAlpha))}function vQ(e,t){let n=t.stencilTest,i=n.enabled;if(jy(e,e.STENCIL_TEST,i),i){let o=n.frontFunction,r=n.backFunction,s=n.reference,a=n.mask;e.stencilFunc(o,s,a),e.stencilFuncSeparate(e.BACK,r,s,a),e.stencilFuncSeparate(e.FRONT,o,s,a);let l=n.frontOperation,u=l.fail,f=l.zFail,d=l.zPass;e.stencilOpSeparate(e.FRONT,u,f,d);let p=n.backOperation,g=p.fail,m=p.zFail,b=p.zPass;e.stencilOpSeparate(e.BACK,g,m,b)}}function DQ(e,t){let n=t.sampleCoverage,i=n.enabled;jy(e,e.SAMPLE_COVERAGE,i),i&&e.sampleCoverage(n.value,n.invert)}var ZDe=new Ke;function PQ(e,t,n){let i=y(t.viewport,n.viewport);c(i)||(i=ZDe,i.width=n.context.drawingBufferWidth,i.height=n.context.drawingBufferHeight),n.context.uniformState.viewport=i,e.viewport(i.x,i.y,i.width,i.height)}ch.apply=function(e,t,n){_Q(e,t),gQ(e,t),yQ(e,t),bQ(e,t),TQ(e,t),AQ(e,t),CQ(e,t),EQ(e,t),SQ(e,t),vQ(e,t),DQ(e,t),xQ(e,t,n),wQ(e,t,n),PQ(e,t,n)};function JDe(e,t){let n=[];return e.frontFace!==t.frontFace&&n.push(_Q),(e.cull.enabled!==t.cull.enabled||e.cull.face!==t.cull.face)&&n.push(gQ),e.lineWidth!==t.lineWidth&&n.push(yQ),(e.polygonOffset.enabled!==t.polygonOffset.enabled||e.polygonOffset.factor!==t.polygonOffset.factor||e.polygonOffset.units!==t.polygonOffset.units)&&n.push(bQ),(e.depthRange.near!==t.depthRange.near||e.depthRange.far!==t.depthRange.far)&&n.push(TQ),(e.depthTest.enabled!==t.depthTest.enabled||e.depthTest.func!==t.depthTest.func)&&n.push(AQ),(e.colorMask.red!==t.colorMask.red||e.colorMask.green!==t.colorMask.green||e.colorMask.blue!==t.colorMask.blue||e.colorMask.alpha!==t.colorMask.alpha)&&n.push(CQ),e.depthMask!==t.depthMask&&n.push(EQ),e.stencilMask!==t.stencilMask&&n.push(SQ),(e.stencilTest.enabled!==t.stencilTest.enabled||e.stencilTest.frontFunction!==t.stencilTest.frontFunction||e.stencilTest.backFunction!==t.stencilTest.backFunction||e.stencilTest.reference!==t.stencilTest.reference||e.stencilTest.mask!==t.stencilTest.mask||e.stencilTest.frontOperation.fail!==t.stencilTest.frontOperation.fail||e.stencilTest.frontOperation.zFail!==t.stencilTest.frontOperation.zFail||e.stencilTest.backOperation.fail!==t.stencilTest.backOperation.fail||e.stencilTest.backOperation.zFail!==t.stencilTest.backOperation.zFail||e.stencilTest.backOperation.zPass!==t.stencilTest.backOperation.zPass)&&n.push(vQ),(e.sampleCoverage.enabled!==t.sampleCoverage.enabled||e.sampleCoverage.value!==t.sampleCoverage.value||e.sampleCoverage.invert!==t.sampleCoverage.invert)&&n.push(DQ),n}ch.partialApply=function(e,t,n,i,o,r){if(t!==n){let f=n._applyFunctions[t.id];c(f)||(f=JDe(t,n),n._applyFunctions[t.id]=f);let d=f.length;for(let p=0;p<d;++p)f[p](e,n)}let s=c(i.scissorTest)?i.scissorTest:t.scissorTest,a=c(o.scissorTest)?o.scissorTest:n.scissorTest;(s!==a||r)&&xQ(e,n,o);let l=c(i.blendingEnabled)?i.blendingEnabled:t.blending.enabled,u=c(o.blendingEnabled)?o.blendingEnabled:n.blending.enabled;(l!==u||u&&t.blending!==n.blending)&&wQ(e,n,o),(t!==n||i!==o||i.context!==o.context)&&PQ(e,n,o)};ch.getState=function(e){if(!c(e))throw new E("renderState is required.");return{frontFace:e.frontFace,cull:{enabled:e.cull.enabled,face:e.cull.face},lineWidth:e.lineWidth,polygonOffset:{enabled:e.polygonOffset.enabled,factor:e.polygonOffset.factor,units:e.polygonOffset.units},scissorTest:{enabled:e.scissorTest.enabled,rectangle:Ke.clone(e.scissorTest.rectangle)},depthRange:{near:e.depthRange.near,far:e.depthRange.far},depthTest:{enabled:e.depthTest.enabled,func:e.depthTest.func},colorMask:{red:e.colorMask.red,green:e.colorMask.green,blue:e.colorMask.blue,alpha:e.colorMask.alpha},depthMask:e.depthMask,stencilMask:e.stencilMask,blending:{enabled:e.blending.enabled,color:j.clone(e.blending.color),equationRgb:e.blending.equationRgb,equationAlpha:e.blending.equationAlpha,functionSourceRgb:e.blending.functionSourceRgb,functionSourceAlpha:e.blending.functionSourceAlpha,functionDestinationRgb:e.blending.functionDestinationRgb,functionDestinationAlpha:e.blending.functionDestinationAlpha},stencilTest:{enabled:e.stencilTest.enabled,frontFunction:e.stencilTest.frontFunction,backFunction:e.stencilTest.backFunction,reference:e.stencilTest.reference,mask:e.stencilTest.mask,frontOperation:{fail:e.stencilTest.frontOperation.fail,zFail:e.stencilTest.frontOperation.zFail,zPass:e.stencilTest.frontOperation.zPass},backOperation:{fail:e.stencilTest.backOperation.fail,zFail:e.stencilTest.backOperation.zFail,zPass:e.stencilTest.backOperation.zPass}},sampleCoverage:{enabled:e.sampleCoverage.enabled,value:e.sampleCoverage.value,invert:e.sampleCoverage.invert},viewport:c(e.viewport)?Ke.clone(e.viewport):void 0}};var ze=ch;var QDe=new h;function Dt(e){this._size=e.size,this._datatype=e.datatype,this.getValue=e.getValue}var Ds={};Ds[ne.FLOAT]="float";Ds[ne.FLOAT_VEC2]="vec2";Ds[ne.FLOAT_VEC3]="vec3";Ds[ne.FLOAT_VEC4]="vec4";Ds[ne.INT]="int";Ds[ne.INT_VEC2]="ivec2";Ds[ne.INT_VEC3]="ivec3";Ds[ne.INT_VEC4]="ivec4";Ds[ne.BOOL]="bool";Ds[ne.BOOL_VEC2]="bvec2";Ds[ne.BOOL_VEC3]="bvec3";Ds[ne.BOOL_VEC4]="bvec4";Ds[ne.FLOAT_MAT2]="mat2";Ds[ne.FLOAT_MAT3]="mat3";Ds[ne.FLOAT_MAT4]="mat4";Ds[ne.SAMPLER_2D]="sampler2D";Ds[ne.UNSIGNED_INT_SAMPLER_2D]="usampler2D";Ds[ne.SAMPLER_CUBE]="samplerCube";Dt.prototype.getDeclaration=function(e){let t=`uniform ${Ds[this._datatype]} ${e}`,n=this._size;return n===1?t+=";":t+=`[${n.toString()}];`,t};var ePe={czm_viewport:new Dt({size:1,datatype:ne.FLOAT_VEC4,getValue:function(e){return e.viewportCartesian4}}),czm_viewportOrthographic:new Dt({size:1,datatype:ne.FLOAT_MAT4,getValue:function(e){return e.viewportOrthographic}}),czm_viewportTransformation:new Dt({size:1,datatype:ne.FLOAT_MAT4,getValue:function(e){return e.viewportTransformation}}),czm_globeDepthTexture:new Dt({size:1,datatype:ne.SAMPLER_2D,getValue:function(e){return e.globeDepthTexture}}),czm_model:new Dt({size:1,datatype:ne.FLOAT_MAT4,getValue:function(e){return e.model}}),czm_inverseModel:new Dt({size:1,datatype:ne.FLOAT_MAT4,getValue:function(e){return e.inverseModel}}),czm_view:new Dt({size:1,datatype:ne.FLOAT_MAT4,getValue:function(e){return e.view}}),czm_view3D:new Dt({size:1,datatype:ne.FLOAT_MAT4,getValue:function(e){return e.view3D}}),czm_viewRotation:new Dt({size:1,datatype:ne.FLOAT_MAT3,getValue:function(e){return e.viewRotation}}),czm_viewRotation3D:new Dt({size:1,datatype:ne.FLOAT_MAT3,getValue:function(e){return e.viewRotation3D}}),czm_inverseView:new Dt({size:1,datatype:ne.FLOAT_MAT4,getValue:function(e){return e.inverseView}}),czm_inverseView3D:new Dt({size:1,datatype:ne.FLOAT_MAT4,getValue:function(e){return e.inverseView3D}}),czm_inverseViewRotation:new Dt({size:1,datatype:ne.FLOAT_MAT3,getValue:function(e){return e.inverseViewRotation}}),czm_inverseViewRotation3D:new Dt({size:1,datatype:ne.FLOAT_MAT3,getValue:function(e){return e.inverseViewRotation3D}}),czm_projection:new Dt({size:1,datatype:ne.FLOAT_MAT4,getValue:function(e){return e.projection}}),czm_inverseProjection:new Dt({size:1,datatype:ne.FLOAT_MAT4,getValue:function(e){return e.inverseProjection}}),czm_infiniteProjection:new Dt({size:1,datatype:ne.FLOAT_MAT4,getValue:function(e){return e.infiniteProjection}}),czm_modelView:new Dt({size:1,datatype:ne.FLOAT_MAT4,getValue:function(e){return e.modelView}}),czm_modelView3D:new Dt({size:1,datatype:ne.FLOAT_MAT4,getValue:function(e){return e.modelView3D}}),czm_modelViewRelativeToEye:new Dt({size:1,datatype:ne.FLOAT_MAT4,getValue:function(e){return e.modelViewRelativeToEye}}),czm_inverseModelView:new Dt({size:1,datatype:ne.FLOAT_MAT4,getValue:function(e){return e.inverseModelView}}),czm_inverseModelView3D:new Dt({size:1,datatype:ne.FLOAT_MAT4,getValue:function(e){return e.inverseModelView3D}}),czm_viewProjection:new Dt({size:1,datatype:ne.FLOAT_MAT4,getValue:function(e){return e.viewProjection}}),czm_inverseViewProjection:new Dt({size:1,datatype:ne.FLOAT_MAT4,getValue:function(e){return e.inverseViewProjection}}),czm_modelViewProjection:new Dt({size:1,datatype:ne.FLOAT_MAT4,getValue:function(e){return e.modelViewProjection}}),czm_inverseModelViewProjection:new Dt({size:1,datatype:ne.FLOAT_MAT4,getValue:function(e){return e.inverseModelViewProjection}}),czm_modelViewProjectionRelativeToEye:new Dt({size:1,datatype:ne.FLOAT_MAT4,getValue:function(e){return e.modelViewProjectionRelativeToEye}}),czm_modelViewInfiniteProjection:new Dt({size:1,datatype:ne.FLOAT_MAT4,getValue:function(e){return e.modelViewInfiniteProjection}}),czm_orthographicIn3D:new Dt({size:1,datatype:ne.FLOAT,getValue:function(e){return e.orthographicIn3D?1:0}}),czm_normal:new Dt({size:1,datatype:ne.FLOAT_MAT3,getValue:function(e){return e.normal}}),czm_normal3D:new Dt({size:1,datatype:ne.FLOAT_MAT3,getValue:function(e){return e.normal3D}}),czm_inverseNormal:new Dt({size:1,datatype:ne.FLOAT_MAT3,getValue:function(e){return e.inverseNormal}}),czm_inverseNormal3D:new Dt({size:1,datatype:ne.FLOAT_MAT3,getValue:function(e){return e.inverseNormal3D}}),czm_eyeHeight:new Dt({size:1,datatype:ne.FLOAT,getValue:function(e){return e.eyeHeight}}),czm_eyeHeight2D:new Dt({size:1,datatype:ne.FLOAT_VEC2,getValue:function(e){return e.eyeHeight2D}}),czm_eyeEllipsoidNormalEC:new Dt({size:1,datatype:ne.FLOAT_VEC3,getValue:function(e){return e.eyeEllipsoidNormalEC}}),czm_eyeEllipsoidCurvature:new Dt({size:1,datatype:ne.FLOAT_VEC2,getValue:function(e){return e.eyeEllipsoidCurvature}}),czm_modelToEnu:new Dt({size:1,datatype:ne.FLOAT_MAT4,getValue:function(e){return e.modelToEnu}}),czm_enuToModel:new Dt({size:1,datatype:ne.FLOAT_MAT4,getValue:function(e){return e.enuToModel}}),czm_entireFrustum:new Dt({size:1,datatype:ne.FLOAT_VEC2,getValue:function(e){return e.entireFrustum}}),czm_currentFrustum:new Dt({size:1,datatype:ne.FLOAT_VEC2,getValue:function(e){return e.currentFrustum}}),czm_frustumPlanes:new Dt({size:1,datatype:ne.FLOAT_VEC4,getValue:function(e){return e.frustumPlanes}}),czm_farDepthFromNearPlusOne:new Dt({size:1,datatype:ne.FLOAT,getValue:function(e){return e.farDepthFromNearPlusOne}}),czm_log2FarDepthFromNearPlusOne:new Dt({size:1,datatype:ne.FLOAT,getValue:function(e){return e.log2FarDepthFromNearPlusOne}}),czm_oneOverLog2FarDepthFromNearPlusOne:new Dt({size:1,datatype:ne.FLOAT,getValue:function(e){return e.oneOverLog2FarDepthFromNearPlusOne}}),czm_sunPositionWC:new Dt({size:1,datatype:ne.FLOAT_VEC3,getValue:function(e){return e.sunPositionWC}}),czm_sunPositionColumbusView:new Dt({size:1,datatype:ne.FLOAT_VEC3,getValue:function(e){return e.sunPositionColumbusView}}),czm_sunDirectionEC:new Dt({size:1,datatype:ne.FLOAT_VEC3,getValue:function(e){return e.sunDirectionEC}}),czm_sunDirectionWC:new Dt({size:1,datatype:ne.FLOAT_VEC3,getValue:function(e){return e.sunDirectionWC}}),czm_moonDirectionEC:new Dt({size:1,datatype:ne.FLOAT_VEC3,getValue:function(e){return e.moonDirectionEC}}),czm_lightDirectionEC:new Dt({size:1,datatype:ne.FLOAT_VEC3,getValue:function(e){return e.lightDirectionEC}}),czm_lightDirectionWC:new Dt({size:1,datatype:ne.FLOAT_VEC3,getValue:function(e){return e.lightDirectionWC}}),czm_lightColor:new Dt({size:1,datatype:ne.FLOAT_VEC3,getValue:function(e){return e.lightColor}}),czm_lightColorHdr:new Dt({size:1,datatype:ne.FLOAT_VEC3,getValue:function(e){return e.lightColorHdr}}),czm_encodedCameraPositionMCHigh:new Dt({size:1,datatype:ne.FLOAT_VEC3,getValue:function(e){return e.encodedCameraPositionMCHigh}}),czm_encodedCameraPositionMCLow:new Dt({size:1,datatype:ne.FLOAT_VEC3,getValue:function(e){return e.encodedCameraPositionMCLow}}),czm_viewerPositionWC:new Dt({size:1,datatype:ne.FLOAT_VEC3,getValue:function(e){return k.getTranslation(e.inverseView,QDe)}}),czm_frameNumber:new Dt({size:1,datatype:ne.FLOAT,getValue:function(e){return e.frameState.frameNumber}}),czm_morphTime:new Dt({size:1,datatype:ne.FLOAT,getValue:function(e){return e.frameState.morphTime}}),czm_sceneMode:new Dt({size:1,datatype:ne.FLOAT,getValue:function(e){return e.frameState.mode}}),czm_pass:new Dt({size:1,datatype:ne.FLOAT,getValue:function(e){return e.pass}}),czm_backgroundColor:new Dt({size:1,datatype:ne.FLOAT_VEC4,getValue:function(e){return e.backgroundColor}}),czm_brdfLut:new Dt({size:1,datatype:ne.SAMPLER_2D,getValue:function(e){return e.brdfLut}}),czm_environmentMap:new Dt({size:1,datatype:ne.SAMPLER_CUBE,getValue:function(e){return e.environmentMap}}),czm_specularEnvironmentMaps:new Dt({size:1,datatype:ne.SAMPLER_2D,getValue:function(e){return e.specularEnvironmentMaps}}),czm_specularEnvironmentMapsMaximumLOD:new Dt({size:1,datatype:ne.FLOAT,getValue:function(e){return e.specularEnvironmentMapsMaximumLOD}}),czm_sphericalHarmonicCoefficients:new Dt({size:9,datatype:ne.FLOAT_VEC3,getValue:function(e){return e.sphericalHarmonicCoefficients}}),czm_temeToPseudoFixed:new Dt({size:1,datatype:ne.FLOAT_MAT3,getValue:function(e){return e.temeToPseudoFixedMatrix}}),czm_pixelRatio:new Dt({size:1,datatype:ne.FLOAT,getValue:function(e){return e.pixelRatio}}),czm_fogDensity:new Dt({size:1,datatype:ne.FLOAT,getValue:function(e){return e.fogDensity}}),czm_fogVisualDensityScalar:new Dt({size:1,datatype:ne.FLOAT,getValue:function(e){return e.fogVisualDensityScalar}}),czm_fogMinimumBrightness:new Dt({size:1,datatype:ne.FLOAT,getValue:function(e){return e.fogMinimumBrightness}}),czm_atmosphereHsbShift:new Dt({size:1,datatype:ne.FLOAT_VEC3,getValue:function(e){return e.atmosphereHsbShift}}),czm_atmosphereLightIntensity:new Dt({size:1,datatype:ne.FLOAT,getValue:function(e){return e.atmosphereLightIntensity}}),czm_atmosphereRayleighCoefficient:new Dt({size:1,datatype:ne.FLOAT_VEC3,getValue:function(e){return e.atmosphereRayleighCoefficient}}),czm_atmosphereRayleighScaleHeight:new Dt({size:1,datatype:ne.FLOAT,getValue:function(e){return e.atmosphereRayleighScaleHeight}}),czm_atmosphereMieCoefficient:new Dt({size:1,datatype:ne.FLOAT_VEC3,getValue:function(e){return e.atmosphereMieCoefficient}}),czm_atmosphereMieScaleHeight:new Dt({size:1,datatype:ne.FLOAT,getValue:function(e){return e.atmosphereMieScaleHeight}}),czm_atmosphereMieAnisotropy:new Dt({size:1,datatype:ne.FLOAT,getValue:function(e){return e.atmosphereMieAnisotropy}}),czm_atmosphereDynamicLighting:new Dt({size:1,datatype:ne.FLOAT,getValue:function(e){return e.atmosphereDynamicLighting}}),czm_splitPosition:new Dt({size:1,datatype:ne.FLOAT,getValue:function(e){return e.splitPosition}}),czm_geometricToleranceOverMeter:new Dt({size:1,datatype:ne.FLOAT,getValue:function(e){return e.geometricToleranceOverMeter}}),czm_minimumDisableDepthTestDistance:new Dt({size:1,datatype:ne.FLOAT,getValue:function(e){return e.minimumDisableDepthTestDistance}}),czm_invertClassificationColor:new Dt({size:1,datatype:ne.FLOAT_VEC4,getValue:function(e){return e.invertClassificationColor}}),czm_gamma:new Dt({size:1,datatype:ne.FLOAT,getValue:function(e){return e.gamma}}),czm_ellipsoidRadii:new Dt({size:1,datatype:ne.FLOAT_VEC3,getValue:function(e){return e.ellipsoid.radii}}),czm_ellipsoidInverseRadii:new Dt({size:1,datatype:ne.FLOAT_VEC3,getValue:function(e){return e.ellipsoid.oneOverRadii}})},Wy=ePe;function tPe(e,t,n,i){switch(t.type){case e.FLOAT:return new IQ(e,t,n,i);case e.FLOAT_VEC2:return new OQ(e,t,n,i);case e.FLOAT_VEC3:return new RQ(e,t,n,i);case e.FLOAT_VEC4:return new MQ(e,t,n,i);case e.SAMPLER_2D:case e.UNSIGNED_INT_SAMPLER_2D:case e.SAMPLER_CUBE:return new p3(e,t,n,i);case e.INT:case e.BOOL:return new LQ(e,t,n,i);case e.INT_VEC2:case e.BOOL_VEC2:return new NQ(e,t,n,i);case e.INT_VEC3:case e.BOOL_VEC3:return new FQ(e,t,n,i);case e.INT_VEC4:case e.BOOL_VEC4:return new BQ(e,t,n,i);case e.FLOAT_MAT2:return new kQ(e,t,n,i);case e.FLOAT_MAT3:return new VQ(e,t,n,i);case e.FLOAT_MAT4:return new UQ(e,t,n,i);default:throw new ue(`Unrecognized uniform type: ${t.type} for uniform "${n}".`)}}function IQ(e,t,n,i){this.name=n,this.value=void 0,this._value=0,this._gl=e,this._location=i}IQ.prototype.set=function(){this.value!==this._value&&(this._value=this.value,this._gl.uniform1f(this._location,this.value))};function OQ(e,t,n,i){this.name=n,this.value=void 0,this._value=new H,this._gl=e,this._location=i}OQ.prototype.set=function(){let e=this.value;H.equals(e,this._value)||(H.clone(e,this._value),this._gl.uniform2f(this._location,e.x,e.y))};function RQ(e,t,n,i){this.name=n,this.value=void 0,this._value=void 0,this._gl=e,this._location=i}RQ.prototype.set=function(){let e=this.value;if(c(e.red))j.equals(e,this._value)||(this._value=j.clone(e,this._value),this._gl.uniform3f(this._location,e.red,e.green,e.blue));else if(c(e.x))h.equals(e,this._value)||(this._value=h.clone(e,this._value),this._gl.uniform3f(this._location,e.x,e.y,e.z));else throw new E(`Invalid vec3 value for uniform "${this.name}".`)};function MQ(e,t,n,i){this.name=n,this.value=void 0,this._value=void 0,this._gl=e,this._location=i}MQ.prototype.set=function(){let e=this.value;if(c(e.red))j.equals(e,this._value)||(this._value=j.clone(e,this._value),this._gl.uniform4f(this._location,e.red,e.green,e.blue,e.alpha));else if(c(e.x))se.equals(e,this._value)||(this._value=se.clone(e,this._value),this._gl.uniform4f(this._location,e.x,e.y,e.z,e.w));else throw new E(`Invalid vec4 value for uniform "${this.name}".`)};function p3(e,t,n,i){this.name=n,this.value=void 0,this._gl=e,this._location=i,this.textureUnitIndex=void 0}p3.prototype.set=function(){let e=this._gl;e.activeTexture(e.TEXTURE0+this.textureUnitIndex);let t=this.value;e.bindTexture(t._target,t._texture)};p3.prototype._setSampler=function(e){return this.textureUnitIndex=e,this._gl.uniform1i(this._location,e),e+1};function LQ(e,t,n,i){this.name=n,this.value=void 0,this._value=0,this._gl=e,this._location=i}LQ.prototype.set=function(){this.value!==this._value&&(this._value=this.value,this._gl.uniform1i(this._location,this.value))};function NQ(e,t,n,i){this.name=n,this.value=void 0,this._value=new H,this._gl=e,this._location=i}NQ.prototype.set=function(){let e=this.value;H.equals(e,this._value)||(H.clone(e,this._value),this._gl.uniform2i(this._location,e.x,e.y))};function FQ(e,t,n,i){this.name=n,this.value=void 0,this._value=new h,this._gl=e,this._location=i}FQ.prototype.set=function(){let e=this.value;h.equals(e,this._value)||(h.clone(e,this._value),this._gl.uniform3i(this._location,e.x,e.y,e.z))};function BQ(e,t,n,i){this.name=n,this.value=void 0,this._value=new se,this._gl=e,this._location=i}BQ.prototype.set=function(){let e=this.value;se.equals(e,this._value)||(se.clone(e,this._value),this._gl.uniform4i(this._location,e.x,e.y,e.z,e.w))};var nPe=new Float32Array(4);function kQ(e,t,n,i){this.name=n,this.value=void 0,this._value=new Gi,this._gl=e,this._location=i}kQ.prototype.set=function(){if(!Gi.equalsArray(this.value,this._value,0)){Gi.clone(this.value,this._value);let e=Gi.toArray(this.value,nPe);this._gl.uniformMatrix2fv(this._location,!1,e)}};var iPe=new Float32Array(9);function VQ(e,t,n,i){this.name=n,this.value=void 0,this._value=new Q,this._gl=e,this._location=i}VQ.prototype.set=function(){if(!Q.equalsArray(this.value,this._value,0)){Q.clone(this.value,this._value);let e=Q.toArray(this.value,iPe);this._gl.uniformMatrix3fv(this._location,!1,e)}};var oPe=new Float32Array(16);function UQ(e,t,n,i){this.name=n,this.value=void 0,this._value=new k,this._gl=e,this._location=i}UQ.prototype.set=function(){if(!k.equalsArray(this.value,this._value,0)){k.clone(this.value,this._value);let e=k.toArray(this.value,oPe);this._gl.uniformMatrix4fv(this._location,!1,e)}};var _3=tPe;function rPe(e,t,n,i){switch(t.type){case e.FLOAT:return new zQ(e,t,n,i);case e.FLOAT_VEC2:return new HQ(e,t,n,i);case e.FLOAT_VEC3:return new GQ(e,t,n,i);case e.FLOAT_VEC4:return new jQ(e,t,n,i);case e.SAMPLER_2D:case e.UNSIGNED_INT_SAMPLER_2D:case e.SAMPLER_CUBE:return new g3(e,t,n,i);case e.INT:case e.BOOL:return new WQ(e,t,n,i);case e.INT_VEC2:case e.BOOL_VEC2:return new qQ(e,t,n,i);case e.INT_VEC3:case e.BOOL_VEC3:return new YQ(e,t,n,i);case e.INT_VEC4:case e.BOOL_VEC4:return new XQ(e,t,n,i);case e.FLOAT_MAT2:return new KQ(e,t,n,i);case e.FLOAT_MAT3:return new $Q(e,t,n,i);case e.FLOAT_MAT4:return new ZQ(e,t,n,i);default:throw new ue(`Unrecognized uniform type: ${t.type} for uniform "${n}".`)}}function zQ(e,t,n,i){let o=i.length;this.name=n,this.value=new Array(o),this._value=new Float32Array(o),this._gl=e,this._location=i[0]}zQ.prototype.set=function(){let e=this.value,t=e.length,n=this._value,i=!1;for(let o=0;o<t;++o){let r=e[o];r!==n[o]&&(n[o]=r,i=!0)}i&&this._gl.uniform1fv(this._location,n)};function HQ(e,t,n,i){let o=i.length;this.name=n,this.value=new Array(o),this._value=new Float32Array(o*2),this._gl=e,this._location=i[0]}HQ.prototype.set=function(){let e=this.value,t=e.length,n=this._value,i=!1,o=0;for(let r=0;r<t;++r){let s=e[r];H.equalsArray(s,n,o)||(H.pack(s,n,o),i=!0),o+=2}i&&this._gl.uniform2fv(this._location,n)};function GQ(e,t,n,i){let o=i.length;this.name=n,this.value=new Array(o),this._value=new Float32Array(o*3),this._gl=e,this._location=i[0]}GQ.prototype.set=function(){let e=this.value,t=e.length,n=this._value,i=!1,o=0;for(let r=0;r<t;++r){let s=e[r];if(c(s.red))(s.red!==n[o]||s.green!==n[o+1]||s.blue!==n[o+2])&&(n[o]=s.red,n[o+1]=s.green,n[o+2]=s.blue,i=!0);else if(c(s.x))h.equalsArray(s,n,o)||(h.pack(s,n,o),i=!0);else throw new E("Invalid vec3 value.");o+=3}i&&this._gl.uniform3fv(this._location,n)};function jQ(e,t,n,i){let o=i.length;this.name=n,this.value=new Array(o),this._value=new Float32Array(o*4),this._gl=e,this._location=i[0]}jQ.prototype.set=function(){let e=this.value,t=e.length,n=this._value,i=!1,o=0;for(let r=0;r<t;++r){let s=e[r];if(c(s.red))j.equalsArray(s,n,o)||(j.pack(s,n,o),i=!0);else if(c(s.x))se.equalsArray(s,n,o)||(se.pack(s,n,o),i=!0);else throw new E("Invalid vec4 value.");o+=4}i&&this._gl.uniform4fv(this._location,n)};function g3(e,t,n,i){let o=i.length;this.name=n,this.value=new Array(o),this._value=new Float32Array(o),this._gl=e,this._locations=i,this.textureUnitIndex=void 0}g3.prototype.set=function(){let e=this._gl,t=e.TEXTURE0+this.textureUnitIndex,n=this.value,i=n.length;for(let o=0;o<i;++o){let r=n[o];e.activeTexture(t+o),e.bindTexture(r._target,r._texture)}};g3.prototype._setSampler=function(e){this.textureUnitIndex=e;let t=this._locations,n=t.length;for(let i=0;i<n;++i){let o=e+i;this._gl.uniform1i(t[i],o)}return e+n};function WQ(e,t,n,i){let o=i.length;this.name=n,this.value=new Array(o),this._value=new Int32Array(o),this._gl=e,this._location=i[0]}WQ.prototype.set=function(){let e=this.value,t=e.length,n=this._value,i=!1;for(let o=0;o<t;++o){let r=e[o];r!==n[o]&&(n[o]=r,i=!0)}i&&this._gl.uniform1iv(this._location,n)};function qQ(e,t,n,i){let o=i.length;this.name=n,this.value=new Array(o),this._value=new Int32Array(o*2),this._gl=e,this._location=i[0]}qQ.prototype.set=function(){let e=this.value,t=e.length,n=this._value,i=!1,o=0;for(let r=0;r<t;++r){let s=e[r];H.equalsArray(s,n,o)||(H.pack(s,n,o),i=!0),o+=2}i&&this._gl.uniform2iv(this._location,n)};function YQ(e,t,n,i){let o=i.length;this.name=n,this.value=new Array(o),this._value=new Int32Array(o*3),this._gl=e,this._location=i[0]}YQ.prototype.set=function(){let e=this.value,t=e.length,n=this._value,i=!1,o=0;for(let r=0;r<t;++r){let s=e[r];h.equalsArray(s,n,o)||(h.pack(s,n,o),i=!0),o+=3}i&&this._gl.uniform3iv(this._location,n)};function XQ(e,t,n,i){let o=i.length;this.name=n,this.value=new Array(o),this._value=new Int32Array(o*4),this._gl=e,this._location=i[0]}XQ.prototype.set=function(){let e=this.value,t=e.length,n=this._value,i=!1,o=0;for(let r=0;r<t;++r){let s=e[r];se.equalsArray(s,n,o)||(se.pack(s,n,o),i=!0),o+=4}i&&this._gl.uniform4iv(this._location,n)};function KQ(e,t,n,i){let o=i.length;this.name=n,this.value=new Array(o),this._value=new Float32Array(o*4),this._gl=e,this._location=i[0]}KQ.prototype.set=function(){let e=this.value,t=e.length,n=this._value,i=!1,o=0;for(let r=0;r<t;++r){let s=e[r];Gi.equalsArray(s,n,o)||(Gi.pack(s,n,o),i=!0),o+=4}i&&this._gl.uniformMatrix2fv(this._location,!1,n)};function $Q(e,t,n,i){let o=i.length;this.name=n,this.value=new Array(o),this._value=new Float32Array(o*9),this._gl=e,this._location=i[0]}$Q.prototype.set=function(){let e=this.value,t=e.length,n=this._value,i=!1,o=0;for(let r=0;r<t;++r){let s=e[r];Q.equalsArray(s,n,o)||(Q.pack(s,n,o),i=!0),o+=9}i&&this._gl.uniformMatrix3fv(this._location,!1,n)};function ZQ(e,t,n,i){let o=i.length;this.name=n,this.value=new Array(o),this._value=new Float32Array(o*16),this._gl=e,this._location=i[0]}ZQ.prototype.set=function(){let e=this.value,t=e.length,n=this._value,i=!1,o=0;for(let r=0;r<t;++r){let s=e[r];k.equalsArray(s,n,o)||(k.pack(s,n,o),i=!0),o+=16}i&&this._gl.uniformMatrix4fv(this._location,!1,n)};var y3=rPe;var sPe=0;function Im(e){let t=e.vertexShaderText,n=e.fragmentShaderText;typeof spector<"u"&&(t=t.replace(/^#line/gm,"//#line"),n=n.replace(/^#line/gm,"//#line"));let i=aPe(t,n);this._gl=e.gl,this._logShaderCompilation=e.logShaderCompilation,this._debugShaders=e.debugShaders,this._attributeLocations=e.attributeLocations,this._program=void 0,this._numberOfVertexAttributes=void 0,this._vertexAttributes=void 0,this._uniformsByName=void 0,this._uniforms=void 0,this._automaticUniforms=void 0,this._manualUniforms=void 0,this._duplicateUniformNames=i.duplicateUniformNames,this._cachedShader=void 0,this.maximumTextureUnitIndex=void 0,this._vertexShaderSource=e.vertexShaderSource,this._vertexShaderText=e.vertexShaderText,this._fragmentShaderSource=e.fragmentShaderSource,this._fragmentShaderText=i.fragmentShaderText,this.id=sPe++}Im.fromCache=function(e){return e=y(e,y.EMPTY_OBJECT),A.defined("options.context",e.context),e.context.shaderCache.getShaderProgram(e)};Im.replaceCache=function(e){return e=y(e,y.EMPTY_OBJECT),A.defined("options.context",e.context),e.context.shaderCache.replaceShaderProgram(e)};Object.defineProperties(Im.prototype,{vertexShaderSource:{get:function(){return this._vertexShaderSource}},fragmentShaderSource:{get:function(){return this._fragmentShaderSource}},vertexAttributes:{get:function(){return WI(this),this._vertexAttributes}},numberOfVertexAttributes:{get:function(){return WI(this),this._numberOfVertexAttributes}},allUniforms:{get:function(){return WI(this),this._uniformsByName}}});function JQ(e){let t=[],n=e.match(/uniform.*?(?![^{]*})(?=[=\[;])/g);if(c(n)){let i=n.length;for(let o=0;o<i;o++){let r=n[o].trim(),s=r.slice(r.lastIndexOf(" ")+1);t.push(s)}}return t}function aPe(e,t){let n={};if(!mt.highpFloatSupported||!mt.highpIntSupported){let i,o,r,s,a=JQ(e),l=JQ(t),u=a.length,f=l.length;for(i=0;i<u;i++)for(o=0;o<f;o++)if(a[i]===l[o]){r=a[i],s=`czm_mediump_${r}`;let d=new RegExp(`${r}\\b`,"g");t=t.replace(d,s),n[s]=r}}return{fragmentShaderText:t,duplicateUniformNames:n}}var lh="[Cesium WebGL] ";function cPe(e,t){let n=t._vertexShaderText,i=t._fragmentShaderText,o=e.createShader(e.VERTEX_SHADER);e.shaderSource(o,n),e.compileShader(o);let r=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(r,i),e.compileShader(r);let s=e.createProgram();e.attachShader(s,o),e.attachShader(s,r);let a=t._attributeLocations;if(c(a))for(let p in a)a.hasOwnProperty(p)&&e.bindAttribLocation(s,a[p],p);e.linkProgram(s);let l;if(e.getProgramParameter(s,e.LINK_STATUS))return t._logShaderCompilation&&(l=e.getShaderInfoLog(o),c(l)&&l.length>0&&console.log(`${lh}Vertex shader compile log: ${l}`),l=e.getShaderInfoLog(r),c(l)&&l.length>0&&console.log(`${lh}Fragment shader compile log: ${l}`),l=e.getProgramInfoLog(s),c(l)&&l.length>0&&console.log(`${lh}Shader program link log: ${l}`)),e.deleteShader(o),e.deleteShader(r),s;let u,f=t._debugShaders;throw e.getShaderParameter(r,e.COMPILE_STATUS)?e.getShaderParameter(o,e.COMPILE_STATUS)?(l=e.getProgramInfoLog(s),console.error(`${lh}Shader program link log: ${l}`),d(o,"vertex"),d(r,"fragment"),u=`Program failed to link.  Link log: ${l}`):(l=e.getShaderInfoLog(o),console.error(`${lh}Vertex shader compile log: ${l}`),console.error(`${lh} Vertex shader source:
${n}`),u=`Vertex shader failed to compile.  Compile log: ${l}`):(l=e.getShaderInfoLog(r),console.error(`${lh}Fragment shader compile log: ${l}`),console.error(`${lh} Fragment shader source:
${i}`),u=`Fragment shader failed to compile.  Compile log: ${l}`),e.deleteShader(o),e.deleteShader(r),e.deleteProgram(s),new ue(u);function d(p,g){if(!c(f))return;let m=f.getTranslatedShaderSource(p);if(m===""){console.error(`${lh}${g} shader translation failed.`);return}console.error(`${lh}Translated ${g} shaderSource:
${m}`)}}function lPe(e,t,n){let i={};for(let o=0;o<n;++o){let r=e.getActiveAttrib(t,o),s=e.getAttribLocation(t,r.name);i[r.name]={name:r.name,type:r.type,index:s}}return i}function uPe(e,t){let n={},i=[],o=[],r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let s=0;s<r;++s){let a=e.getActiveUniform(t,s),l="[0]",u=a.name.indexOf(l,a.name.length-l.length)!==-1?a.name.slice(0,a.name.length-3):a.name;if(u.indexOf("gl_")!==0)if(a.name.indexOf("[")<0){let f=e.getUniformLocation(t,u);if(f!==null){let d=_3(e,a,u,f);n[u]=d,i.push(d),d._setSampler&&o.push(d)}}else{let f,d,p,g,m=u.indexOf("[");if(m>=0){if(f=n[u.slice(0,m)],!c(f))continue;d=f._locations,d.length<=1&&(p=f.value,g=e.getUniformLocation(t,u),g!==null&&(d.push(g),p.push(e.getUniform(t,g))))}else{d=[];for(let b=0;b<a.size;++b)g=e.getUniformLocation(t,`${u}[${b}]`),g!==null&&d.push(g);f=y3(e,a,u,d),n[u]=f,i.push(f),f._setSampler&&o.push(f)}}}return{uniformsByName:n,uniforms:i,samplerUniforms:o}}function fPe(e,t){let n=[],i=[];for(let o in t)if(t.hasOwnProperty(o)){let r=t[o],s=o,a=e._duplicateUniformNames[s];c(a)&&(r.name=a,s=a);let l=Wy[s];c(l)?n.push({uniform:r,automaticUniform:l}):i.push(r)}return{automaticUniforms:n,manualUniforms:i}}function dPe(e,t,n){e.useProgram(t);let i=0,o=n.length;for(let r=0;r<o;++r)i=n[r]._setSampler(i);return e.useProgram(null),i}function WI(e){c(e._program)||QQ(e)}function QQ(e){let t=e._program,n=e._gl,i=cPe(n,e,e._debugShaders),o=n.getProgramParameter(i,n.ACTIVE_ATTRIBUTES),r=uPe(n,i),s=fPe(e,r.uniformsByName);e._program=i,e._numberOfVertexAttributes=o,e._vertexAttributes=lPe(n,i,o),e._uniformsByName=r.uniformsByName,e._uniforms=r.uniforms,e._automaticUniforms=s.automaticUniforms,e._manualUniforms=s.manualUniforms,e.maximumTextureUnitIndex=dPe(n,i,r.samplerUniforms),t&&e._gl.deleteProgram(t),typeof spector<"u"&&(e._program.__SPECTOR_rebuildProgram=function(a,l,u,f){let d=e._vertexShaderText,p=e._fragmentShaderText,g=/ ! = /g;e._vertexShaderText=a.replace(g," != "),e._fragmentShaderText=l.replace(g," != ");try{QQ(e),u(e._program)}catch(m){e._vertexShaderText=d,e._fragmentShaderText=p;let x=/(?:Compile|Link) error: ([^]*)/.exec(m.message);f(x?x[1]:m.message)}})}Im.prototype._bind=function(){WI(this),this._gl.useProgram(this._program)};Im.prototype._setUniforms=function(e,t,n){let i,o;if(c(e)){let a=this._manualUniforms;for(i=a.length,o=0;o<i;++o){let l=a[o];if(!c(e[l.name]))throw new E(`Unknown uniform: ${l.name}`);l.value=e[l.name]()}}let r=this._automaticUniforms;for(i=r.length,o=0;o<i;++o){let a=r[o];a.uniform.value=a.automaticUniform.getValue(t)}let s=this._uniforms;for(i=s.length,o=0;o<i;++o)s[o].set();if(n){let a=this._gl,l=this._program;if(a.validateProgram(l),!a.getProgramParameter(l,a.VALIDATE_STATUS))throw new E(`Program validation failed.  Program info log: ${a.getProgramInfoLog(l)}`)}};Im.prototype.isDestroyed=function(){return!1};Im.prototype.destroy=function(){this._cachedShader.cache.releaseShaderProgram(this)};Im.prototype.finalDestroy=function(){return this._gl.deleteProgram(this._program),de(this)};var an=Im;var b3=`const float czm_degreesPerRadian = 57.29577951308232;
`;var x3=`const czm_depthRangeStruct czm_depthRange = czm_depthRangeStruct(0.0, 1.0);
`;var T3=`const float czm_epsilon1 = 0.1;
`;var A3=`const float czm_epsilon2 = 0.01;
`;var C3=`const float czm_epsilon3 = 0.001;
`;var E3=`const float czm_epsilon4 = 0.0001;
`;var S3=`const float czm_epsilon5 = 0.00001;
`;var w3=`const float czm_epsilon6 = 0.000001;
`;var v3=`const float czm_epsilon7 = 0.0000001;
`;var D3=`const float czm_infinity = 5906376272000.0;
`;var P3=`const float czm_oneOverPi = 0.3183098861837907;
`;var I3=`const float czm_oneOverTwoPi = 0.15915494309189535;
`;var O3=`const float czm_passCesium3DTile = 4.0;
`;var R3=`const float czm_passCesium3DTileClassification = 5.0;
`;var M3=`const float czm_passCesium3DTileClassificationIgnoreShow = 6.0;
`;var L3=`const float czm_passClassification = 7.0;
`;var N3=`const float czm_passCompute = 1.0;
`;var F3=`const float czm_passEnvironment = 0.0;
`;var B3=`const float czm_passGlobe = 2.0;
`;var k3=`const float czm_passOpaque = 7.0;
`;var V3=`const float czm_passOverlay = 10.0;
`;var U3=`const float czm_passTerrainClassification = 3.0;
`;var z3=`const float czm_passTranslucent = 8.0;
`;var H3=`const float czm_passVoxels = 9.0;
`;var G3=`const float czm_pi = 3.141592653589793;
`;var j3=`const float czm_piOverFour = 0.7853981633974483;
`;var W3=`const float czm_piOverSix = 0.5235987755982988;
`;var q3=`const float czm_piOverThree = 1.0471975511965976;
`;var Y3=`const float czm_piOverTwo = 1.5707963267948966;
`;var X3=`const float czm_radiansPerDegree = 0.017453292519943295;
`;var K3=`const float czm_sceneMode2D = 2.0;
`;var $3=`const float czm_sceneMode3D = 3.0;
`;var Z3=`const float czm_sceneModeColumbusView = 1.0;
`;var J3=`const float czm_sceneModeMorphing = 0.0;
`;var Q3=`const float czm_solarRadius = 695500000.0;
`;var ek=`const float czm_threePiOver2 = 4.71238898038469;
`;var tk=`const float czm_twoPi = 6.283185307179586;
`;var nk=`const float czm_webMercatorMaxLatitude = 1.4844222297453324;
`;var ik=`struct czm_depthRangeStruct
{
float near;
float far;
};
`;var ok=`struct czm_material
{
vec3 diffuse;
float specular;
float shininess;
vec3 normal;
vec3 emission;
float alpha;
};
`;var rk=`struct czm_materialInput
{
float s;
vec2 st;
vec3 str;
vec3 normalEC;
mat3 tangentToEyeMatrix;
vec3 positionToEyeEC;
float height;
float slope;
float aspect;
float waterMask;
vec2 vPosition;
vec4 vColor;
};
`;var sk=`struct czm_modelMaterial {
vec4 baseColor;
vec3 diffuse;
float alpha;
vec3 specular;
float roughness;
vec3 normalEC;
float occlusion;
vec3 emissive;
#ifdef USE_SPECULAR
float specularWeight;
#endif
#ifdef USE_ANISOTROPY
vec3 anisotropicT;
vec3 anisotropicB;
float anisotropyStrength;
#endif
#ifdef USE_CLEARCOAT
float clearcoatFactor;
float clearcoatRoughness;
vec3 clearcoatNormal;
#endif
};
`;var ak=`struct czm_modelVertexOutput {
vec3 positionMC;
float pointSize;
};
`;var ck=`struct czm_ray
{
vec3 origin;
vec3 direction;
};
`;var lk=`struct czm_raySegment
{
float start;
float stop;
};
const czm_raySegment czm_emptyRaySegment = czm_raySegment(-czm_infinity, -czm_infinity);
const czm_raySegment czm_fullRaySegment = czm_raySegment(0.0, czm_infinity);
`;var uk=`struct czm_shadowParameters
{
#ifdef USE_CUBE_MAP_SHADOW
vec3 texCoords;
#else
vec2 texCoords;
#endif
float depthBias;
float depth;
float nDotL;
vec2 texelStepSize;
float normalShadingSmooth;
float darkness;
};
`;var fk=`vec3 czm_acesTonemapping(vec3 color) {
float g = 0.985;
float a = 0.065;
float b = 0.0001;
float c = 0.433;
float d = 0.238;
color = (color * (color + a) - b) / (color * (g * color + c) + d);
color = clamp(color, 0.0, 1.0);
return color;
}
`;var dk=`float czm_alphaWeight(float a)
{
float z = (gl_FragCoord.z - czm_viewportTransformation[3][2]) / czm_viewportTransformation[2][2];
return pow(a + 0.01, 4.0) + max(1e-2, min(3.0 * 1e3, 0.003 / (1e-5 + pow(abs(z) / 200.0, 4.0))));
}
`;var hk=`vec4 czm_antialias(vec4 color1, vec4 color2, vec4 currentColor, float dist, float fuzzFactor)
{
float val1 = clamp(dist / fuzzFactor, 0.0, 1.0);
float val2 = clamp((dist - 0.5) / fuzzFactor, 0.0, 1.0);
val1 = val1 * (1.0 - val2);
val1 = val1 * val1 * (3.0 - (2.0 * val1));
val1 = pow(val1, 0.5);
vec4 midColor = (color1 + color2) * 0.5;
return mix(midColor, currentColor, val1);
}
vec4 czm_antialias(vec4 color1, vec4 color2, vec4 currentColor, float dist)
{
return czm_antialias(color1, color2, currentColor, dist, 0.1);
}
`;var mk=`vec3 czm_applyHSBShift(vec3 rgb, vec3 hsbShift, bool ignoreBlackPixels) {
vec3 hsb = czm_RGBToHSB(rgb);
hsb.x += hsbShift.x;
hsb.y = clamp(hsb.y + hsbShift.y, 0.0, 1.0);
if (ignoreBlackPixels) {
hsb.z = hsb.z > czm_epsilon7 ? hsb.z + hsbShift.z : 0.0;
} else {
hsb.z = hsb.z + hsbShift.z;
}
hsb.z = clamp(hsb.z, 0.0, 1.0);
return czm_HSBToRGB(hsb);
}
`;var pk=`vec2 czm_approximateSphericalCoordinates(vec3 normal) {
float latitudeApproximation = czm_fastApproximateAtan(sqrt(normal.x * normal.x + normal.y * normal.y), normal.z);
float longitudeApproximation = czm_fastApproximateAtan(normal.x, normal.y);
return vec2(latitudeApproximation, longitudeApproximation);
}
`;var _k=`float czm_approximateTanh(float x) {
float x2 = x * x;
return max(-1.0, min(1.0, x * (27.0 + x2) / (27.0 + 9.0 * x2)));
}
`;var gk=`bool czm_backFacing()
{
return gl_FrontFacing == false;
}
`;var yk=`float czm_branchFreeTernary(bool comparison, float a, float b) {
float useA = float(comparison);
return a * useA + b * (1.0 - useA);
}
vec2 czm_branchFreeTernary(bool comparison, vec2 a, vec2 b) {
float useA = float(comparison);
return a * useA + b * (1.0 - useA);
}
vec3 czm_branchFreeTernary(bool comparison, vec3 a, vec3 b) {
float useA = float(comparison);
return a * useA + b * (1.0 - useA);
}
vec4 czm_branchFreeTernary(bool comparison, vec4 a, vec4 b) {
float useA = float(comparison);
return a * useA + b * (1.0 - useA);
}
`;var bk=`vec4 czm_cascadeColor(vec4 weights)
{
return vec4(1.0, 0.0, 0.0, 1.0) * weights.x +
vec4(0.0, 1.0, 0.0, 1.0) * weights.y +
vec4(0.0, 0.0, 1.0, 1.0) * weights.z +
vec4(1.0, 0.0, 1.0, 1.0) * weights.w;
}
`;var xk=`uniform vec4 shadowMap_cascadeDistances;
float czm_cascadeDistance(vec4 weights)
{
return dot(shadowMap_cascadeDistances, weights);
}
`;var Tk=`uniform mat4 shadowMap_cascadeMatrices[4];
mat4 czm_cascadeMatrix(vec4 weights)
{
return shadowMap_cascadeMatrices[0] * weights.x +
shadowMap_cascadeMatrices[1] * weights.y +
shadowMap_cascadeMatrices[2] * weights.z +
shadowMap_cascadeMatrices[3] * weights.w;
}
`;var Ak=`uniform vec4 shadowMap_cascadeSplits[2];
vec4 czm_cascadeWeights(float depthEye)
{
vec4 near = step(shadowMap_cascadeSplits[0], vec4(depthEye));
vec4 far = step(depthEye, shadowMap_cascadeSplits[1]);
return near * far;
}
`;var Ck=`float getSignedDistance(vec2 uv, highp sampler2D clippingDistance) {
float signedDistance = texture(clippingDistance, uv).r;
return (signedDistance - 0.5) * 2.0;
}
void czm_clipPolygons(highp sampler2D clippingDistance, int extentsLength, vec2 clippingPosition, int regionIndex) {
vec2 rectUv = clippingPosition;
if (regionIndex < 0 || rectUv.x <= 0.0 || rectUv.y <= 0.0 || rectUv.x >= 1.0 || rectUv.y >= 1.0) {
#ifdef CLIPPING_INVERSE
discard;
#endif
return;
}
vec2 clippingDistanceTextureDimensions = vec2(textureSize(clippingDistance, 0));
vec2 sampleOffset = max(1.0 / clippingDistanceTextureDimensions, vec2(0.005));
float dimension = float(extentsLength);
if (extentsLength > 2) {
dimension = ceil(log2(float(extentsLength)));
}
vec2 textureOffset = vec2(mod(float(regionIndex), dimension), floor(float(regionIndex) / dimension)) / dimension;
vec2 uv = textureOffset + rectUv / dimension;
float signedDistance = getSignedDistance(uv, clippingDistance);
#ifdef CLIPPING_INVERSE
if (signedDistance > 0.0)  {
discard;
}
#else
if (signedDistance < 0.0)  {
discard;
}
#endif
}
`;var Ek=`vec4 czm_columbusViewMorph(vec4 position2D, vec4 position3D, float time)
{
vec3 p = mix(position2D.xyz, position3D.xyz, time);
return vec4(p, 1.0);
}
`;var Sk=`vec4 czm_computeAtmosphereColor(
vec3 positionWC,
vec3 lightDirection,
vec3 rayleighColor,
vec3 mieColor,
float opacity
) {
vec3 cameraToPositionWC = positionWC - czm_viewerPositionWC;
vec3 cameraToPositionWCDirection = normalize(cameraToPositionWC);
float cosAngle = dot(cameraToPositionWCDirection, lightDirection);
float cosAngleSq = cosAngle * cosAngle;
float G = czm_atmosphereMieAnisotropy;
float GSq = G * G;
float rayleighPhase = 3.0 / (50.2654824574) * (1.0 + cosAngleSq);
float miePhase = 3.0 / (25.1327412287) * ((1.0 - GSq) * (cosAngleSq + 1.0)) / (pow(1.0 + GSq - 2.0 * cosAngle * G, 1.5) * (2.0 + GSq));
vec3 rayleigh = rayleighPhase * rayleighColor;
vec3 mie = miePhase * mieColor;
vec3 color = (rayleigh + mie) * czm_atmosphereLightIntensity;
return vec4(color, opacity);
}
vec4 czm_computeAtmosphereColor(
czm_ray primaryRay,
vec3 lightDirection,
vec3 rayleighColor,
vec3 mieColor,
float opacity
) {
vec3 direction = normalize(primaryRay.direction);
float cosAngle = dot(direction, lightDirection);
float cosAngleSq = cosAngle * cosAngle;
float G = czm_atmosphereMieAnisotropy;
float GSq = G * G;
float rayleighPhase = 3.0 / (50.2654824574) * (1.0 + cosAngleSq);
float miePhase = 3.0 / (25.1327412287) * ((1.0 - GSq) * (cosAngleSq + 1.0)) / (pow(1.0 + GSq - 2.0 * cosAngle * G, 1.5) * (2.0 + GSq));
vec3 rayleigh = rayleighPhase * rayleighColor;
vec3 mie = miePhase * mieColor;
vec3 color = (rayleigh + mie) * czm_atmosphereLightIntensity;
return vec4(color, opacity);
}
`;var wk=`void czm_computeGroundAtmosphereScattering(vec3 positionWC, vec3 lightDirection, out vec3 rayleighColor, out vec3 mieColor, out float opacity) {
vec3 cameraToPositionWC = positionWC - czm_viewerPositionWC;
vec3 cameraToPositionWCDirection = normalize(cameraToPositionWC);
czm_ray primaryRay = czm_ray(czm_viewerPositionWC, cameraToPositionWCDirection);
float atmosphereInnerRadius = length(positionWC);
czm_computeScattering(
primaryRay,
length(cameraToPositionWC),
lightDirection,
atmosphereInnerRadius,
rayleighColor,
mieColor,
opacity
);
}
`;var vk=`vec4 czm_computePosition();
`;var Dk=`void czm_computeScattering(
czm_ray primaryRay,
float primaryRayLength,
vec3 lightDirection,
float atmosphereInnerRadius,
out vec3 rayleighColor,
out vec3 mieColor,
out float opacity
) {
const float ATMOSPHERE_THICKNESS = 111e3;
const int PRIMARY_STEPS_MAX = 16;
const int LIGHT_STEPS_MAX = 4;
rayleighColor = vec3(0.0);
mieColor = vec3(0.0);
opacity = 0.0;
float atmosphereOuterRadius = atmosphereInnerRadius + ATMOSPHERE_THICKNESS;
vec3 origin = vec3(0.0);
czm_raySegment primaryRayAtmosphereIntersect = czm_raySphereIntersectionInterval(primaryRay, origin, atmosphereOuterRadius);
if (primaryRayAtmosphereIntersect == czm_emptyRaySegment) {
return;
}
float x = 1e-7 * primaryRayAtmosphereIntersect.stop / length(primaryRayLength);
float w_stop_gt_lprl = 0.5 * (1.0 + czm_approximateTanh(x));
float start_0 = primaryRayAtmosphereIntersect.start;
primaryRayAtmosphereIntersect.start = max(primaryRayAtmosphereIntersect.start, 0.0);
primaryRayAtmosphereIntersect.stop = min(primaryRayAtmosphereIntersect.stop, length(primaryRayLength));
float x_o_a = start_0 - ATMOSPHERE_THICKNESS;
float w_inside_atmosphere = 1.0 - 0.5 * (1.0 + czm_approximateTanh(x_o_a));
int PRIMARY_STEPS = PRIMARY_STEPS_MAX - int(w_inside_atmosphere * 12.0);
int LIGHT_STEPS = LIGHT_STEPS_MAX - int(w_inside_atmosphere * 2.0);
float rayPositionLength = primaryRayAtmosphereIntersect.start;
float totalRayLength = primaryRayAtmosphereIntersect.stop - rayPositionLength;
float rayStepLengthIncrease = w_inside_atmosphere * ((1.0 - w_stop_gt_lprl) * totalRayLength / (float(PRIMARY_STEPS * (PRIMARY_STEPS + 1)) / 2.0));
float rayStepLength = max(1.0 - w_inside_atmosphere, w_stop_gt_lprl) * totalRayLength / max(7.0 * w_inside_atmosphere, float(PRIMARY_STEPS));
vec3 rayleighAccumulation = vec3(0.0);
vec3 mieAccumulation = vec3(0.0);
vec2 opticalDepth = vec2(0.0);
vec2 heightScale = vec2(czm_atmosphereRayleighScaleHeight, czm_atmosphereMieScaleHeight);
for (int i = 0; i < PRIMARY_STEPS_MAX; ++i) {
if (i >= PRIMARY_STEPS) {
break;
}
vec3 samplePosition = primaryRay.origin + primaryRay.direction * (rayPositionLength + rayStepLength);
float sampleHeight = length(samplePosition) - atmosphereInnerRadius;
vec2 sampleDensity = exp(-sampleHeight / heightScale) * rayStepLength;
opticalDepth += sampleDensity;
czm_ray lightRay = czm_ray(samplePosition, lightDirection);
czm_raySegment lightRayAtmosphereIntersect = czm_raySphereIntersectionInterval(lightRay, origin, atmosphereOuterRadius);
float lightStepLength = lightRayAtmosphereIntersect.stop / float(LIGHT_STEPS);
float lightPositionLength = 0.0;
vec2 lightOpticalDepth = vec2(0.0);
for (int j = 0; j < LIGHT_STEPS_MAX; ++j) {
if (j >= LIGHT_STEPS) {
break;
}
vec3 lightPosition = samplePosition + lightDirection * (lightPositionLength + lightStepLength * 0.5);
float lightHeight = length(lightPosition) - atmosphereInnerRadius;
lightOpticalDepth += exp(-lightHeight / heightScale) * lightStepLength;
lightPositionLength += lightStepLength;
}
vec3 attenuation = exp(-((czm_atmosphereMieCoefficient * (opticalDepth.y + lightOpticalDepth.y)) + (czm_atmosphereRayleighCoefficient * (opticalDepth.x + lightOpticalDepth.x))));
rayleighAccumulation += sampleDensity.x * attenuation;
mieAccumulation += sampleDensity.y * attenuation;
rayPositionLength += (rayStepLength += rayStepLengthIncrease);
}
rayleighColor = czm_atmosphereRayleighCoefficient * rayleighAccumulation;
mieColor = czm_atmosphereMieCoefficient * mieAccumulation;
opacity = length(exp(-((czm_atmosphereMieCoefficient * opticalDepth.y) + (czm_atmosphereRayleighCoefficient * opticalDepth.x))));
}
`;var Pk=`vec2 cordic(float angle)
{
vec2 vector = vec2(6.0725293500888267e-1, 0.0);
float sense = (angle < 0.0) ? -1.0 : 1.0;
mat2 rotation = mat2(1.0, sense, -sense, 1.0);
vector = rotation * vector;
angle -= sense * 7.8539816339744828e-1;
sense = (angle < 0.0) ? -1.0 : 1.0;
float factor = sense * 5.0e-1;
rotation[0][1] = factor;
rotation[1][0] = -factor;
vector = rotation * vector;
angle -= sense * 4.6364760900080609e-1;
sense = (angle < 0.0) ? -1.0 : 1.0;
factor = sense * 2.5e-1;
rotation[0][1] = factor;
rotation[1][0] = -factor;
vector = rotation * vector;
angle -= sense * 2.4497866312686414e-1;
sense = (angle < 0.0) ? -1.0 : 1.0;
factor = sense * 1.25e-1;
rotation[0][1] = factor;
rotation[1][0] = -factor;
vector = rotation * vector;
angle -= sense * 1.2435499454676144e-1;
sense = (angle < 0.0) ? -1.0 : 1.0;
factor = sense * 6.25e-2;
rotation[0][1] = factor;
rotation[1][0] = -factor;
vector = rotation * vector;
angle -= sense * 6.2418809995957350e-2;
sense = (angle < 0.0) ? -1.0 : 1.0;
factor = sense * 3.125e-2;
rotation[0][1] = factor;
rotation[1][0] = -factor;
vector = rotation * vector;
angle -= sense * 3.1239833430268277e-2;
sense = (angle < 0.0) ? -1.0 : 1.0;
factor = sense * 1.5625e-2;
rotation[0][1] = factor;
rotation[1][0] = -factor;
vector = rotation * vector;
angle -= sense * 1.5623728620476831e-2;
sense = (angle < 0.0) ? -1.0 : 1.0;
factor = sense * 7.8125e-3;
rotation[0][1] = factor;
rotation[1][0] = -factor;
vector = rotation * vector;
angle -= sense * 7.8123410601011111e-3;
sense = (angle < 0.0) ? -1.0 : 1.0;
factor = sense * 3.90625e-3;
rotation[0][1] = factor;
rotation[1][0] = -factor;
vector = rotation * vector;
angle -= sense * 3.9062301319669718e-3;
sense = (angle < 0.0) ? -1.0 : 1.0;
factor = sense * 1.953125e-3;
rotation[0][1] = factor;
rotation[1][0] = -factor;
vector = rotation * vector;
angle -= sense * 1.9531225164788188e-3;
sense = (angle < 0.0) ? -1.0 : 1.0;
factor = sense * 9.765625e-4;
rotation[0][1] = factor;
rotation[1][0] = -factor;
vector = rotation * vector;
angle -= sense * 9.7656218955931946e-4;
sense = (angle < 0.0) ? -1.0 : 1.0;
factor = sense * 4.8828125e-4;
rotation[0][1] = factor;
rotation[1][0] = -factor;
vector = rotation * vector;
angle -= sense * 4.8828121119489829e-4;
sense = (angle < 0.0) ? -1.0 : 1.0;
factor = sense * 2.44140625e-4;
rotation[0][1] = factor;
rotation[1][0] = -factor;
vector = rotation * vector;
angle -= sense * 2.4414062014936177e-4;
sense = (angle < 0.0) ? -1.0 : 1.0;
factor = sense * 1.220703125e-4;
rotation[0][1] = factor;
rotation[1][0] = -factor;
vector = rotation * vector;
angle -= sense * 1.2207031189367021e-4;
sense = (angle < 0.0) ? -1.0 : 1.0;
factor = sense * 6.103515625e-5;
rotation[0][1] = factor;
rotation[1][0] = -factor;
vector = rotation * vector;
angle -= sense * 6.1035156174208773e-5;
sense = (angle < 0.0) ? -1.0 : 1.0;
factor = sense * 3.0517578125e-5;
rotation[0][1] = factor;
rotation[1][0] = -factor;
vector = rotation * vector;
angle -= sense * 3.0517578115526096e-5;
sense = (angle < 0.0) ? -1.0 : 1.0;
factor = sense * 1.52587890625e-5;
rotation[0][1] = factor;
rotation[1][0] = -factor;
vector = rotation * vector;
angle -= sense * 1.5258789061315762e-5;
sense = (angle < 0.0) ? -1.0 : 1.0;
factor = sense * 7.62939453125e-6;
rotation[0][1] = factor;
rotation[1][0] = -factor;
vector = rotation * vector;
angle -= sense * 7.6293945311019700e-6;
sense = (angle < 0.0) ? -1.0 : 1.0;
factor = sense * 3.814697265625e-6;
rotation[0][1] = factor;
rotation[1][0] = -factor;
vector = rotation * vector;
angle -= sense * 3.8146972656064961e-6;
sense = (angle < 0.0) ? -1.0 : 1.0;
factor = sense * 1.9073486328125e-6;
rotation[0][1] = factor;
rotation[1][0] = -factor;
vector = rotation * vector;
angle -= sense * 1.9073486328101870e-6;
sense = (angle < 0.0) ? -1.0 : 1.0;
factor = sense * 9.5367431640625e-7;
rotation[0][1] = factor;
rotation[1][0] = -factor;
vector = rotation * vector;
angle -= sense * 9.5367431640596084e-7;
sense = (angle < 0.0) ? -1.0 : 1.0;
factor = sense * 4.76837158203125e-7;
rotation[0][1] = factor;
rotation[1][0] = -factor;
vector = rotation * vector;
angle -= sense * 4.7683715820308884e-7;
sense = (angle < 0.0) ? -1.0 : 1.0;
factor = sense * 2.384185791015625e-7;
rotation[0][1] = factor;
rotation[1][0] = -factor;
vector = rotation * vector;
angle -= sense * 2.3841857910155797e-7;
sense = (angle < 0.0) ? -1.0 : 1.0;
factor = sense * 1.1920928955078125e-7;
rotation[0][1] = factor;
rotation[1][0] = -factor;
vector = rotation * vector;
return vector;
}
vec2 czm_cosineAndSine(float angle)
{
if (angle < -czm_piOverTwo || angle > czm_piOverTwo)
{
if (angle < 0.0)
{
return -cordic(angle + czm_pi);
}
else
{
return -cordic(angle - czm_pi);
}
}
else
{
return cordic(angle);
}
}
`;var Ik=`vec2 czm_decompressTextureCoordinates(float encoded)
{
float temp = encoded / 4096.0;
float xZeroTo4095 = floor(temp);
float stx = xZeroTo4095 / 4095.0;
float sty = (encoded - xZeroTo4095 * 4096.0) / 4095.0;
return vec2(stx, sty);
}
`;var Ok=`#if (__VERSION__ == 300 || defined(GL_EXT_frag_depth)) && !defined(LOG_DEPTH)
out float v_WindowZ;
#endif
vec4 czm_depthClamp(vec4 coords)
{
#ifndef LOG_DEPTH
#if __VERSION__ == 300 || defined(GL_EXT_frag_depth)
v_WindowZ = (0.5 * (coords.z / coords.w) + 0.5) * coords.w;
coords.z = 0.0;
#else
coords.z = min(coords.z, coords.w);
#endif
#endif
return coords;
}
`;var Rk=`mat3 czm_eastNorthUpToEyeCoordinates(vec3 positionMC, vec3 normalEC)
{
vec3 tangentMC = normalize(vec3(-positionMC.y, positionMC.x, 0.0));
vec3 tangentEC = normalize(czm_normal3D * tangentMC);
vec3 bitangentEC = normalize(cross(normalEC, tangentEC));
return mat3(
tangentEC.x,   tangentEC.y,   tangentEC.z,
bitangentEC.x, bitangentEC.y, bitangentEC.z,
normalEC.x,    normalEC.y,    normalEC.z);
}
`;var Mk=`bool czm_ellipsoidContainsPoint(vec3 ellipsoid_inverseRadii, vec3 point)
{
vec3 scaled = ellipsoid_inverseRadii * (czm_inverseModelView * vec4(point, 1.0)).xyz;
return (dot(scaled, scaled) <= 1.0);
}
`;var Lk=`vec2 czm_ellipsoidTextureCoordinates(vec3 normal)
{
return vec2(atan(normal.y, normal.x) * czm_oneOverTwoPi + 0.5, asin(normal.z) * czm_oneOverPi + 0.5);
}
`;var Nk=`bool czm_equalsEpsilon(vec4 left, vec4 right, float epsilon) {
return all(lessThanEqual(abs(left - right), vec4(epsilon)));
}
bool czm_equalsEpsilon(vec3 left, vec3 right, float epsilon) {
return all(lessThanEqual(abs(left - right), vec3(epsilon)));
}
bool czm_equalsEpsilon(vec2 left, vec2 right, float epsilon) {
return all(lessThanEqual(abs(left - right), vec2(epsilon)));
}
bool czm_equalsEpsilon(float left, float right, float epsilon) {
return (abs(left - right) <= epsilon);
}
`;var Fk=`vec4 czm_eyeOffset(vec4 positionEC, vec3 eyeOffset)
{
vec4 p = positionEC;
vec4 zEyeOffset = normalize(p) * eyeOffset.z;
p.xy += eyeOffset.xy + zEyeOffset.xy;
p.z += zEyeOffset.z;
return p;
}
`;var Bk=`vec4 czm_eyeToWindowCoordinates(vec4 positionEC)
{
vec4 q = czm_projection * positionEC;
q.xyz /= q.w;
q.xyz = (czm_viewportTransformation * vec4(q.xyz, 1.0)).xyz;
return q;
}
`;var kk=`float czm_fastApproximateAtan(float x) {
return x * (-0.1784 * x - 0.0663 * x * x + 1.0301);
}
float czm_fastApproximateAtan(float x, float y) {
float t = abs(x);
float opposite = abs(y);
float adjacent = max(t, opposite);
opposite = min(t, opposite);
t = czm_fastApproximateAtan(opposite / adjacent);
t = czm_branchFreeTernary(abs(y) > abs(x), czm_piOverTwo - t, t);
t = czm_branchFreeTernary(x < 0.0, czm_pi - t, t);
t = czm_branchFreeTernary(y < 0.0, -t, t);
return t;
}
`;var Vk=`vec3 czm_fog(float distanceToCamera, vec3 color, vec3 fogColor)
{
float scalar = distanceToCamera * czm_fogDensity;
float fog = 1.0 - exp(-(scalar * scalar));
return mix(color, fogColor, fog);
}
vec3 czm_fog(float distanceToCamera, vec3 color, vec3 fogColor, float fogModifierConstant)
{
float scalar = distanceToCamera * czm_fogDensity;
float fog = 1.0 - exp(-((fogModifierConstant * scalar + fogModifierConstant) * (scalar * (1.0 + fogModifierConstant))));
return mix(color, fogColor, fog);
}
`;var Uk=`vec3 czm_gammaCorrect(vec3 color) {
#ifdef HDR
color = pow(color, vec3(czm_gamma));
#endif
return color;
}
vec4 czm_gammaCorrect(vec4 color) {
#ifdef HDR
color.rgb = pow(color.rgb, vec3(czm_gamma));
#endif
return color;
}
`;var zk=`vec3 czm_geodeticSurfaceNormal(vec3 positionOnEllipsoid, vec3 ellipsoidCenter, vec3 oneOverEllipsoidRadiiSquared)
{
return normalize((positionOnEllipsoid - ellipsoidCenter) * oneOverEllipsoidRadiiSquared);
}
`;var Hk=`czm_material czm_getDefaultMaterial(czm_materialInput materialInput)
{
czm_material material;
material.diffuse = vec3(0.0);
material.specular = 0.0;
material.shininess = 1.0;
material.normal = materialInput.normalEC;
material.emission = vec3(0.0);
material.alpha = 1.0;
return material;
}
`;var Gk=`vec3 czm_getDynamicAtmosphereLightDirection(vec3 positionWC, float lightEnum) {
const float NONE = 0.0;
const float SCENE_LIGHT = 1.0;
const float SUNLIGHT = 2.0;
vec3 lightDirection =
positionWC * float(lightEnum == NONE) +
czm_lightDirectionWC * float(lightEnum == SCENE_LIGHT) +
czm_sunDirectionWC * float(lightEnum == SUNLIGHT);
return normalize(lightDirection);
}
`;var jk=`float czm_getLambertDiffuse(vec3 lightDirectionEC, vec3 normalEC)
{
return max(dot(lightDirectionEC, normalEC), 0.0);
}
`;var Wk=`float czm_getSpecular(vec3 lightDirectionEC, vec3 toEyeEC, vec3 normalEC, float shininess)
{
vec3 toReflectedLight = reflect(-lightDirectionEC, normalEC);
float specular = max(dot(toReflectedLight, toEyeEC), 0.0);
return pow(specular, max(shininess, czm_epsilon2));
}
`;var qk=`vec4 czm_getWaterNoise(sampler2D normalMap, vec2 uv, float time, float angleInRadians)
{
float cosAngle = cos(angleInRadians);
float sinAngle = sin(angleInRadians);
vec2 s0 = vec2(1.0/17.0, 0.0);
vec2 s1 = vec2(-1.0/29.0, 0.0);
vec2 s2 = vec2(1.0/101.0, 1.0/59.0);
vec2 s3 = vec2(-1.0/109.0, -1.0/57.0);
s0 = vec2((cosAngle * s0.x) - (sinAngle * s0.y), (sinAngle * s0.x) + (cosAngle * s0.y));
s1 = vec2((cosAngle * s1.x) - (sinAngle * s1.y), (sinAngle * s1.x) + (cosAngle * s1.y));
s2 = vec2((cosAngle * s2.x) - (sinAngle * s2.y), (sinAngle * s2.x) + (cosAngle * s2.y));
s3 = vec2((cosAngle * s3.x) - (sinAngle * s3.y), (sinAngle * s3.x) + (cosAngle * s3.y));
vec2 uv0 = (uv/103.0) + (time * s0);
vec2 uv1 = uv/107.0 + (time * s1) + vec2(0.23);
vec2 uv2 = uv/vec2(897.0, 983.0) + (time * s2) + vec2(0.51);
vec2 uv3 = uv/vec2(991.0, 877.0) + (time * s3) + vec2(0.71);
uv0 = fract(uv0);
uv1 = fract(uv1);
uv2 = fract(uv2);
uv3 = fract(uv3);
vec4 noise = (texture(normalMap, uv0)) +
(texture(normalMap, uv1)) +
(texture(normalMap, uv2)) +
(texture(normalMap, uv3));
return ((noise / 4.0) - 0.5) * 2.0;
}
`;var Yk=`const vec4 K_HSB2RGB = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 czm_HSBToRGB(vec3 hsb)
{
vec3 p = abs(fract(hsb.xxx + K_HSB2RGB.xyz) * 6.0 - K_HSB2RGB.www);
return hsb.z * mix(K_HSB2RGB.xxx, clamp(p - K_HSB2RGB.xxx, 0.0, 1.0), hsb.y);
}
`;var Xk=`vec3 hueToRGB(float hue)
{
float r = abs(hue * 6.0 - 3.0) - 1.0;
float g = 2.0 - abs(hue * 6.0 - 2.0);
float b = 2.0 - abs(hue * 6.0 - 4.0);
return clamp(vec3(r, g, b), 0.0, 1.0);
}
vec3 czm_HSLToRGB(vec3 hsl)
{
vec3 rgb = hueToRGB(hsl.x);
float c = (1.0 - abs(2.0 * hsl.z - 1.0)) * hsl.y;
return (rgb - 0.5) * c + hsl.z;
}
`;var Kk=`vec3 czm_hue(vec3 rgb, float adjustment)
{
const mat3 toYIQ = mat3(0.299,     0.587,     0.114,
0.595716, -0.274453, -0.321263,
0.211456, -0.522591,  0.311135);
const mat3 toRGB = mat3(1.0,  0.9563,  0.6210,
1.0, -0.2721, -0.6474,
1.0, -1.107,   1.7046);
vec3 yiq = toYIQ * rgb;
float hue = atan(yiq.z, yiq.y) + adjustment;
float chroma = sqrt(yiq.z * yiq.z + yiq.y * yiq.y);
vec3 color = vec3(yiq.x, chroma * cos(hue), chroma * sin(hue));
return toRGB * color;
}
`;var $k=`vec3 czm_inverseGamma(vec3 color) {
return pow(color, vec3(1.0 / czm_gamma));
}
`;var Zk=`bool czm_isEmpty(czm_raySegment interval)
{
return (interval.stop < 0.0);
}
`;var Jk=`bool czm_isFull(czm_raySegment interval)
{
return (interval.start == 0.0 && interval.stop == czm_infinity);
}
`;var Qk=`float czm_latitudeToWebMercatorFraction(float latitude, float southMercatorY, float oneOverMercatorHeight)
{
float sinLatitude = sin(latitude);
float mercatorY = 0.5 * log((1.0 + sinLatitude) / (1.0 - sinLatitude));
return (mercatorY - southMercatorY) * oneOverMercatorHeight;
}
`;var eV=`vec3 czm_linearToSrgb(vec3 linearIn)
{
return pow(linearIn, vec3(1.0/2.2));
}
vec4 czm_linearToSrgb(vec4 linearIn)
{
vec3 srgbOut = pow(linearIn.rgb, vec3(1.0/2.2));
return vec4(srgbOut, linearIn.a);
}
`;var tV=`float czm_lineDistance(vec2 point1, vec2 point2, vec2 point) {
return abs((point2.y - point1.y) * point.x - (point2.x - point1.x) * point.y + point2.x * point1.y - point2.y * point1.x) / distance(point2, point1);
}
`;var nV=`float czm_luminance(vec3 rgb)
{
const vec3 W = vec3(0.2125, 0.7154, 0.0721);
return dot(rgb, W);
}
`;var iV=`float czm_maximumComponent(vec2 v)
{
return max(v.x, v.y);
}
float czm_maximumComponent(vec3 v)
{
return max(max(v.x, v.y), v.z);
}
float czm_maximumComponent(vec4 v)
{
return max(max(max(v.x, v.y), v.z), v.w);
}
`;var oV=`float czm_metersPerPixel(vec4 positionEC, float pixelRatio)
{
float width = czm_viewport.z;
float height = czm_viewport.w;
float pixelWidth;
float pixelHeight;
float top = czm_frustumPlanes.x;
float bottom = czm_frustumPlanes.y;
float left = czm_frustumPlanes.z;
float right = czm_frustumPlanes.w;
if (czm_sceneMode == czm_sceneMode2D || czm_orthographicIn3D == 1.0)
{
float frustumWidth = right - left;
float frustumHeight = top - bottom;
pixelWidth = frustumWidth / width;
pixelHeight = frustumHeight / height;
}
else
{
float distanceToPixel = -positionEC.z;
float inverseNear = 1.0 / czm_currentFrustum.x;
float tanTheta = top * inverseNear;
pixelHeight = 2.0 * distanceToPixel * tanTheta / height;
tanTheta = right * inverseNear;
pixelWidth = 2.0 * distanceToPixel * tanTheta / width;
}
return max(pixelWidth, pixelHeight) * pixelRatio;
}
float czm_metersPerPixel(vec4 positionEC)
{
return czm_metersPerPixel(positionEC, czm_pixelRatio);
}
`;var rV=`vec4 czm_modelToWindowCoordinates(vec4 position)
{
vec4 q = czm_modelViewProjection * position;
q.xyz /= q.w;
q.xyz = (czm_viewportTransformation * vec4(q.xyz, 1.0)).xyz;
return q;
}
`;var sV=`vec3 czm_multiplyWithColorBalance(vec3 left, vec3 right)
{
const vec3 W = vec3(0.2125, 0.7154, 0.0721);
vec3 target = left * right;
float leftLuminance = dot(left, W);
float rightLuminance = dot(right, W);
float targetLuminance = dot(target, W);
return ((leftLuminance + rightLuminance) / (2.0 * targetLuminance)) * target;
}
`;var aV=`float czm_nearFarScalar(vec4 nearFarScalar, float cameraDistSq)
{
float valueAtMin = nearFarScalar.y;
float valueAtMax = nearFarScalar.w;
float nearDistanceSq = nearFarScalar.x * nearFarScalar.x;
float farDistanceSq = nearFarScalar.z * nearFarScalar.z;
float t = (cameraDistSq - nearDistanceSq) / (farDistanceSq - nearDistanceSq);
t = pow(clamp(t, 0.0, 1.0), 0.2);
return mix(valueAtMin, valueAtMax, t);
}
`;var cV=`vec3 czm_octDecode(vec2 encoded, float range)
{
if (encoded.x == 0.0 && encoded.y == 0.0) {
return vec3(0.0, 0.0, 0.0);
}
encoded = encoded / range * 2.0 - 1.0;
vec3 v = vec3(encoded.x, encoded.y, 1.0 - abs(encoded.x) - abs(encoded.y));
if (v.z < 0.0)
{
v.xy = (1.0 - abs(v.yx)) * czm_signNotZero(v.xy);
}
return normalize(v);
}
vec3 czm_octDecode(vec2 encoded)
{
return czm_octDecode(encoded, 255.0);
}
vec3 czm_octDecode(float encoded)
{
float temp = encoded / 256.0;
float x = floor(temp);
float y = (temp - x) * 256.0;
return czm_octDecode(vec2(x, y));
}
void czm_octDecode(vec2 encoded, out vec3 vector1, out vec3 vector2, out vec3 vector3)
{
float temp = encoded.x / 65536.0;
float x = floor(temp);
float encodedFloat1 = (temp - x) * 65536.0;
temp = encoded.y / 65536.0;
float y = floor(temp);
float encodedFloat2 = (temp - y) * 65536.0;
vector1 = czm_octDecode(encodedFloat1);
vector2 = czm_octDecode(encodedFloat2);
vector3 = czm_octDecode(vec2(x, y));
}
`;var lV=`vec4 czm_packDepth(float depth)
{
vec4 enc = vec4(1.0, 255.0, 65025.0, 16581375.0) * depth;
enc = fract(enc);
enc -= enc.yzww * vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);
return enc;
}
`;var uV=`vec3 lambertianDiffuse(vec3 diffuseColor)
{
return diffuseColor / czm_pi;
}
vec3 fresnelSchlick2(vec3 f0, vec3 f90, float VdotH)
{
float versine = 1.0 - VdotH;
float versineSquared = versine * versine;
return f0 + (f90 - f0) * versineSquared * versineSquared * versine;
}
#ifdef USE_ANISOTROPY
float smithVisibilityGGX_anisotropic(float bitangentRoughness, float tangentialRoughness, vec3 lightDirection, vec3 viewDirection)
{
vec3 roughnessScale = vec3(tangentialRoughness, bitangentRoughness, 1.0);
float GGXV = lightDirection.z * length(roughnessScale * viewDirection);
float GGXL = viewDirection.z * length(roughnessScale * lightDirection);
float v = 0.5 / (GGXV + GGXL);
return clamp(v, 0.0, 1.0);
}
float GGX_anisotropic(float bitangentRoughness, float tangentialRoughness, vec3 halfwayDirection)
{
float roughnessSquared = bitangentRoughness * tangentialRoughness;
vec3 f = halfwayDirection * vec3(bitangentRoughness, tangentialRoughness, roughnessSquared);
float w2 = roughnessSquared / dot(f, f);
return roughnessSquared * w2 * w2 / czm_pi;
}
#endif
float smithVisibilityGGX(float alphaRoughness, float NdotL, float NdotV)
{
float alphaRoughnessSq = alphaRoughness * alphaRoughness;
float GGXV = NdotL * sqrt(NdotV * NdotV * (1.0 - alphaRoughnessSq) + alphaRoughnessSq);
float GGXL = NdotV * sqrt(NdotL * NdotL * (1.0 - alphaRoughnessSq) + alphaRoughnessSq);
float GGX = GGXV + GGXL;
if (GGX > 0.0)
{
return 0.5 / GGX;
}
return 0.0;
}
float GGX(float alphaRoughness, float NdotH)
{
float alphaRoughnessSquared = alphaRoughness * alphaRoughness;
float f = (NdotH * alphaRoughnessSquared - NdotH) * NdotH + 1.0;
return alphaRoughnessSquared / (czm_pi * f * f);
}
float computeDirectSpecularStrength(vec3 normal, vec3 lightDirection, vec3 viewDirection, vec3 halfwayDirection, float alphaRoughness)
{
float NdotL = clamp(dot(normal, lightDirection), 0.0, 1.0);
float NdotV = clamp(dot(normal, viewDirection), 0.0, 1.0);
float G = smithVisibilityGGX(alphaRoughness, NdotL, NdotV);
float NdotH = clamp(dot(normal, halfwayDirection), 0.0, 1.0);
float D = GGX(alphaRoughness, NdotH);
return G * D;
}
vec3 czm_pbrLighting(vec3 viewDirectionEC, vec3 normalEC, vec3 lightDirectionEC, czm_modelMaterial material)
{
vec3 halfwayDirectionEC = normalize(viewDirectionEC + lightDirectionEC);
float VdotH = clamp(dot(viewDirectionEC, halfwayDirectionEC), 0.0, 1.0);
float NdotL = clamp(dot(normalEC, lightDirectionEC), 0.001, 1.0);
vec3 f0 = material.specular;
float reflectance = czm_maximumComponent(f0);
vec3 f90 = vec3(clamp(reflectance * 25.0, 0.0, 1.0));
vec3 F = fresnelSchlick2(f0, f90, VdotH);
#if defined(USE_SPECULAR)
F *= material.specularWeight;
#endif
float alphaRoughness = material.roughness * material.roughness;
#ifdef USE_ANISOTROPY
mat3 tbn = mat3(material.anisotropicT, material.anisotropicB, normalEC);
vec3 lightDirection = lightDirectionEC * tbn;
vec3 viewDirection = viewDirectionEC * tbn;
vec3 halfwayDirection = halfwayDirectionEC * tbn;
float anisotropyStrength = material.anisotropyStrength;
float tangentialRoughness = mix(alphaRoughness, 1.0, anisotropyStrength * anisotropyStrength);
float bitangentRoughness = clamp(alphaRoughness, 0.001, 1.0);
float G = smithVisibilityGGX_anisotropic(bitangentRoughness, tangentialRoughness, lightDirection, viewDirection);
float D = GGX_anisotropic(bitangentRoughness, tangentialRoughness, halfwayDirection);
vec3 specularContribution = F * G * D;
#else
float specularStrength = computeDirectSpecularStrength(normalEC, lightDirectionEC, viewDirectionEC, halfwayDirectionEC, alphaRoughness);
vec3 specularContribution = F * specularStrength;
#endif
vec3 diffuseColor = material.diffuse;
vec3 diffuseContribution = (1.0 - F) * lambertianDiffuse(diffuseColor);
return (diffuseContribution + specularContribution) * NdotL;
}
`;var fV=`vec3 czm_pbrNeutralTonemapping(vec3 color) {
const float startCompression = 0.8 - 0.04;
const float desaturation = 0.15;
float x = min(color.r, min(color.g, color.b));
float offset = czm_branchFreeTernary(x < 0.08, x - 6.25 * x * x, 0.04);
color -= offset;
float peak = max(color.r, max(color.g, color.b));
if (peak < startCompression) return color;
const float d = 1.0 - startCompression;
float newPeak = 1.0 - d * d / (peak + d - startCompression);
color *= newPeak / peak;
float g = 1.0 - 1.0 / (desaturation * (peak - newPeak) + 1.0);
return mix(color, newPeak * vec3(1.0, 1.0, 1.0), g);
}
`;var dV=`float czm_private_getLambertDiffuseOfMaterial(vec3 lightDirectionEC, czm_material material)
{
return czm_getLambertDiffuse(lightDirectionEC, material.normal);
}
float czm_private_getSpecularOfMaterial(vec3 lightDirectionEC, vec3 toEyeEC, czm_material material)
{
return czm_getSpecular(lightDirectionEC, toEyeEC, material.normal, material.shininess);
}
vec4 czm_phong(vec3 toEye, czm_material material, vec3 lightDirectionEC)
{
float diffuse = czm_private_getLambertDiffuseOfMaterial(vec3(0.0, 0.0, 1.0), material);
if (czm_sceneMode == czm_sceneMode3D) {
diffuse += czm_private_getLambertDiffuseOfMaterial(vec3(0.0, 1.0, 0.0), material);
}
float specular = czm_private_getSpecularOfMaterial(lightDirectionEC, toEye, material);
vec3 materialDiffuse = material.diffuse * 0.5;
vec3 ambient = materialDiffuse;
vec3 color = ambient + material.emission;
color += materialDiffuse * diffuse * czm_lightColor;
color += material.specular * specular * czm_lightColor;
return vec4(color, material.alpha);
}
vec4 czm_private_phong(vec3 toEye, czm_material material, vec3 lightDirectionEC)
{
float diffuse = czm_private_getLambertDiffuseOfMaterial(lightDirectionEC, material);
float specular = czm_private_getSpecularOfMaterial(lightDirectionEC, toEye, material);
vec3 ambient = vec3(0.0);
vec3 color = ambient + material.emission;
color += material.diffuse * diffuse * czm_lightColor;
color += material.specular * specular * czm_lightColor;
return vec4(color, material.alpha);
}
`;var hV=`float czm_planeDistance(vec4 plane, vec3 point) {
return (dot(plane.xyz, point) + plane.w);
}
float czm_planeDistance(vec3 planeNormal, float planeDistance, vec3 point) {
return (dot(planeNormal, point) + planeDistance);
}
`;var mV=`vec3 czm_pointAlongRay(czm_ray ray, float time)
{
return ray.origin + (time * ray.direction);
}
`;var pV=`czm_raySegment czm_rayEllipsoidIntersectionInterval(czm_ray ray, vec3 ellipsoid_center, vec3 ellipsoid_inverseRadii)
{
vec3 q = ellipsoid_inverseRadii * (czm_inverseModelView * vec4(ray.origin, 1.0)).xyz;
vec3 w = ellipsoid_inverseRadii * (czm_inverseModelView * vec4(ray.direction, 0.0)).xyz;
q = q - ellipsoid_inverseRadii * (czm_inverseModelView * vec4(ellipsoid_center, 1.0)).xyz;
float q2 = dot(q, q);
float qw = dot(q, w);
if (q2 > 1.0)
{
if (qw >= 0.0)
{
return czm_emptyRaySegment;
}
else
{
float qw2 = qw * qw;
float difference = q2 - 1.0;
float w2 = dot(w, w);
float product = w2 * difference;
if (qw2 < product)
{
return czm_emptyRaySegment;
}
else if (qw2 > product)
{
float discriminant = qw * qw - product;
float temp = -qw + sqrt(discriminant);
float root0 = temp / w2;
float root1 = difference / temp;
if (root0 < root1)
{
czm_raySegment i = czm_raySegment(root0, root1);
return i;
}
else
{
czm_raySegment i = czm_raySegment(root1, root0);
return i;
}
}
else
{
float root = sqrt(difference / w2);
czm_raySegment i = czm_raySegment(root, root);
return i;
}
}
}
else if (q2 < 1.0)
{
float difference = q2 - 1.0;
float w2 = dot(w, w);
float product = w2 * difference;
float discriminant = qw * qw - product;
float temp = -qw + sqrt(discriminant);
czm_raySegment i = czm_raySegment(0.0, temp / w2);
return i;
}
else
{
if (qw < 0.0)
{
float w2 = dot(w, w);
czm_raySegment i = czm_raySegment(0.0, -qw / w2);
return i;
}
else
{
return czm_emptyRaySegment;
}
}
}
`;var _V=`czm_raySegment czm_raySphereIntersectionInterval(czm_ray ray, vec3 center, float radius)
{
vec3 o = ray.origin;
vec3 d = ray.direction;
vec3 oc = o - center;
float a = dot(d, d);
float b = 2.0 * dot(d, oc);
float c = dot(oc, oc) - (radius * radius);
float det = (b * b) - (4.0 * a * c);
if (det < 0.0) {
return czm_emptyRaySegment;
}
float sqrtDet = sqrt(det);
float t0 = (-b - sqrtDet) / (2.0 * a);
float t1 = (-b + sqrtDet) / (2.0 * a);
czm_raySegment result = czm_raySegment(t0, t1);
return result;
}
`;var gV=`float czm_readDepth(sampler2D depthTexture, vec2 texCoords)
{
return czm_reverseLogDepth(texture(depthTexture, texCoords).r);
}
`;var yV=`float czm_readNonPerspective(float value, float oneOverW) {
return value * oneOverW;
}
vec2 czm_readNonPerspective(vec2 value, float oneOverW) {
return value * oneOverW;
}
vec3 czm_readNonPerspective(vec3 value, float oneOverW) {
return value * oneOverW;
}
vec4 czm_readNonPerspective(vec4 value, float oneOverW) {
return value * oneOverW;
}
`;var bV=`float czm_reverseLogDepth(float logZ)
{
#ifdef LOG_DEPTH
float near = czm_currentFrustum.x;
float far = czm_currentFrustum.y;
float log2Depth = logZ * czm_log2FarDepthFromNearPlusOne;
float depthFromNear = pow(2.0, log2Depth) - 1.0;
return far * (1.0 - near / (depthFromNear + near)) / (far - near);
#endif
return logZ;
}
`;var xV=`const vec4 K_RGB2HSB = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec3 czm_RGBToHSB(vec3 rgb)
{
vec4 p = mix(vec4(rgb.bg, K_RGB2HSB.wz), vec4(rgb.gb, K_RGB2HSB.xy), step(rgb.b, rgb.g));
vec4 q = mix(vec4(p.xyw, rgb.r), vec4(rgb.r, p.yzx), step(p.x, rgb.r));
float d = q.x - min(q.w, q.y);
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + czm_epsilon7)), d / (q.x + czm_epsilon7), q.x);
}
`;var TV=`vec3 RGBtoHCV(vec3 rgb)
{
vec4 p = (rgb.g < rgb.b) ? vec4(rgb.bg, -1.0, 2.0 / 3.0) : vec4(rgb.gb, 0.0, -1.0 / 3.0);
vec4 q = (rgb.r < p.x) ? vec4(p.xyw, rgb.r) : vec4(rgb.r, p.yzx);
float c = q.x - min(q.w, q.y);
float h = abs((q.w - q.y) / (6.0 * c + czm_epsilon7) + q.z);
return vec3(h, c, q.x);
}
vec3 czm_RGBToHSL(vec3 rgb)
{
vec3 hcv = RGBtoHCV(rgb);
float l = hcv.z - hcv.y * 0.5;
float s = hcv.y / (1.0 - abs(l * 2.0 - 1.0) + czm_epsilon7);
return vec3(hcv.x, s, l);
}
`;var AV=`vec3 czm_RGBToXYZ(vec3 rgb)
{
const mat3 RGB2XYZ = mat3(0.4124, 0.2126, 0.0193,
0.3576, 0.7152, 0.1192,
0.1805, 0.0722, 0.9505);
vec3 xyz = RGB2XYZ * rgb;
vec3 Yxy;
Yxy.r = xyz.g;
float temp = dot(vec3(1.0), xyz);
Yxy.gb = xyz.rg / temp;
return Yxy;
}
`;var CV=`float czm_round(float value) {
return floor(value + 0.5);
}
vec2 czm_round(vec2 value) {
return floor(value + 0.5);
}
vec3 czm_round(vec3 value) {
return floor(value + 0.5);
}
vec4 czm_round(vec4 value) {
return floor(value + 0.5);
}
`;var EV=`vec3 czm_saturation(vec3 rgb, float adjustment)
{
const vec3 W = vec3(0.2125, 0.7154, 0.0721);
vec3 intensity = vec3(dot(rgb, W));
return mix(intensity, rgb, adjustment);
}
`;var SV=`float czm_sampleShadowMap(highp samplerCube shadowMap, vec3 d)
{
return czm_unpackDepth(czm_textureCube(shadowMap, d));
}
float czm_sampleShadowMap(highp sampler2D shadowMap, vec2 uv)
{
#ifdef USE_SHADOW_DEPTH_TEXTURE
return texture(shadowMap, uv).r;
#else
return czm_unpackDepth(texture(shadowMap, uv));
#endif
}
float czm_shadowDepthCompare(samplerCube shadowMap, vec3 uv, float depth)
{
return step(depth, czm_sampleShadowMap(shadowMap, uv));
}
float czm_shadowDepthCompare(sampler2D shadowMap, vec2 uv, float depth)
{
return step(depth, czm_sampleShadowMap(shadowMap, uv));
}
`;var wV=`float czm_private_shadowVisibility(float visibility, float nDotL, float normalShadingSmooth, float darkness)
{
#ifdef USE_NORMAL_SHADING
#ifdef USE_NORMAL_SHADING_SMOOTH
float strength = clamp(nDotL / normalShadingSmooth, 0.0, 1.0);
#else
float strength = step(0.0, nDotL);
#endif
visibility *= strength;
#endif
visibility = max(visibility, darkness);
return visibility;
}
#ifdef USE_CUBE_MAP_SHADOW
float czm_shadowVisibility(samplerCube shadowMap, czm_shadowParameters shadowParameters)
{
float depthBias = shadowParameters.depthBias;
float depth = shadowParameters.depth;
float nDotL = shadowParameters.nDotL;
float normalShadingSmooth = shadowParameters.normalShadingSmooth;
float darkness = shadowParameters.darkness;
vec3 uvw = shadowParameters.texCoords;
depth -= depthBias;
float visibility = czm_shadowDepthCompare(shadowMap, uvw, depth);
return czm_private_shadowVisibility(visibility, nDotL, normalShadingSmooth, darkness);
}
#else
float czm_shadowVisibility(sampler2D shadowMap, czm_shadowParameters shadowParameters)
{
float depthBias = shadowParameters.depthBias;
float depth = shadowParameters.depth;
float nDotL = shadowParameters.nDotL;
float normalShadingSmooth = shadowParameters.normalShadingSmooth;
float darkness = shadowParameters.darkness;
vec2 uv = shadowParameters.texCoords;
depth -= depthBias;
#ifdef USE_SOFT_SHADOWS
vec2 texelStepSize = shadowParameters.texelStepSize;
float radius = 1.0;
float dx0 = -texelStepSize.x * radius;
float dy0 = -texelStepSize.y * radius;
float dx1 = texelStepSize.x * radius;
float dy1 = texelStepSize.y * radius;
float visibility = (
czm_shadowDepthCompare(shadowMap, uv, depth) +
czm_shadowDepthCompare(shadowMap, uv + vec2(dx0, dy0), depth) +
czm_shadowDepthCompare(shadowMap, uv + vec2(0.0, dy0), depth) +
czm_shadowDepthCompare(shadowMap, uv + vec2(dx1, dy0), depth) +
czm_shadowDepthCompare(shadowMap, uv + vec2(dx0, 0.0), depth) +
czm_shadowDepthCompare(shadowMap, uv + vec2(dx1, 0.0), depth) +
czm_shadowDepthCompare(shadowMap, uv + vec2(dx0, dy1), depth) +
czm_shadowDepthCompare(shadowMap, uv + vec2(0.0, dy1), depth) +
czm_shadowDepthCompare(shadowMap, uv + vec2(dx1, dy1), depth)
) * (1.0 / 9.0);
#else
float visibility = czm_shadowDepthCompare(shadowMap, uv, depth);
#endif
return czm_private_shadowVisibility(visibility, nDotL, normalShadingSmooth, darkness);
}
#endif
`;var vV=`float czm_signNotZero(float value)
{
return value >= 0.0 ? 1.0 : -1.0;
}
vec2 czm_signNotZero(vec2 value)
{
return vec2(czm_signNotZero(value.x), czm_signNotZero(value.y));
}
vec3 czm_signNotZero(vec3 value)
{
return vec3(czm_signNotZero(value.x), czm_signNotZero(value.y), czm_signNotZero(value.z));
}
vec4 czm_signNotZero(vec4 value)
{
return vec4(czm_signNotZero(value.x), czm_signNotZero(value.y), czm_signNotZero(value.z), czm_signNotZero(value.w));
}
`;var DV=`vec3 czm_sphericalHarmonics(vec3 normal, vec3 coefficients[9])
{
vec3 L00 = coefficients[0];
vec3 L1_1 = coefficients[1];
vec3 L10 = coefficients[2];
vec3 L11 = coefficients[3];
vec3 L2_2 = coefficients[4];
vec3 L2_1 = coefficients[5];
vec3 L20 = coefficients[6];
vec3 L21 = coefficients[7];
vec3 L22 = coefficients[8];
float x = normal.x;
float y = normal.y;
float z = normal.z;
vec3 L =
L00
+ L1_1 * y
+ L10 * z
+ L11 * x
+ L2_2 * (y * x)
+ L2_1 * (y * z)
+ L20 * (3.0 * z * z - 1.0)
+ L21 * (z * x)
+ L22 * (x * x - y * y);
return max(L, vec3(0.0));
}
`;var PV=`vec3 czm_srgbToLinear(vec3 srgbIn)
{
return pow(srgbIn, vec3(2.2));
}
vec4 czm_srgbToLinear(vec4 srgbIn)
{
vec3 linearOut = pow(srgbIn.rgb, vec3(2.2));
return vec4(linearOut, srgbIn.a);
}
`;var IV=`mat3 czm_tangentToEyeSpaceMatrix(vec3 normalEC, vec3 tangentEC, vec3 bitangentEC)
{
vec3 normal = normalize(normalEC);
vec3 tangent = normalize(tangentEC);
vec3 bitangent = normalize(bitangentEC);
return mat3(tangent.x  , tangent.y  , tangent.z,
bitangent.x, bitangent.y, bitangent.z,
normal.x   , normal.y   , normal.z);
}
`;var OV=`vec4 czm_textureCube(samplerCube sampler, vec3 p) {
#if __VERSION__ == 300
return texture(sampler, p);
#else
return textureCube(sampler, p);
#endif
}
vec4 czm_textureCube(samplerCube sampler, vec3 p, float lod) {
#if __VERSION__ == 300
return textureLod(sampler, p, lod);
#elif defined(GL_EXT_shader_texture_lod)
return textureCubeLodEXT(sampler, p, lod);
#endif
}
`;var RV=`vec4 czm_transformPlane(vec4 plane, mat4 transform) {
vec4 transformedPlane = transform * plane;
float normalMagnitude = length(transformedPlane.xyz);
return transformedPlane / normalMagnitude;
}
`;var MV=`vec4 czm_translateRelativeToEye(vec3 high, vec3 low)
{
vec3 highDifference = high - czm_encodedCameraPositionMCHigh;
if (length(highDifference) == 0.0) {
highDifference = vec3(0);
}
vec3 lowDifference = low - czm_encodedCameraPositionMCLow;
return vec4(highDifference + lowDifference, 1.0);
}
`;var LV=`vec4 czm_translucentPhong(vec3 toEye, czm_material material, vec3 lightDirectionEC)
{
float diffuse = czm_getLambertDiffuse(vec3(0.0, 0.0, 1.0), material.normal);
if (czm_sceneMode == czm_sceneMode3D) {
diffuse += czm_getLambertDiffuse(vec3(0.0, 1.0, 0.0), material.normal);
}
diffuse = clamp(diffuse, 0.0, 1.0);
float specular = czm_getSpecular(lightDirectionEC, toEye, material.normal, material.shininess);
vec3 materialDiffuse = material.diffuse * 0.5;
vec3 ambient = materialDiffuse;
vec3 color = ambient + material.emission;
color += materialDiffuse * diffuse * czm_lightColor;
color += material.specular * specular * czm_lightColor;
return vec4(color, material.alpha);
}
`;var NV=`mat2 czm_transpose(mat2 matrix)
{
return mat2(
matrix[0][0], matrix[1][0],
matrix[0][1], matrix[1][1]);
}
mat3 czm_transpose(mat3 matrix)
{
return mat3(
matrix[0][0], matrix[1][0], matrix[2][0],
matrix[0][1], matrix[1][1], matrix[2][1],
matrix[0][2], matrix[1][2], matrix[2][2]);
}
mat4 czm_transpose(mat4 matrix)
{
return mat4(
matrix[0][0], matrix[1][0], matrix[2][0], matrix[3][0],
matrix[0][1], matrix[1][1], matrix[2][1], matrix[3][1],
matrix[0][2], matrix[1][2], matrix[2][2], matrix[3][2],
matrix[0][3], matrix[1][3], matrix[2][3], matrix[3][3]);
}
`;var FV=`vec2 getLookupUv(vec2 dimensions, int i) {
int pixY = i / int(dimensions.x);
int pixX = i - (pixY * int(dimensions.x));
float pixelWidth = 1.0 / dimensions.x;
float pixelHeight = 1.0 / dimensions.y;
float u = (float(pixX) + 0.5) * pixelWidth;
float v = (float(pixY) + 0.5) * pixelHeight;
return vec2(u, v);
}
vec4 czm_unpackClippingExtents(highp sampler2D extentsTexture, int index) {
vec2 textureDimensions = vec2(textureSize(extentsTexture, 0));
return texture(extentsTexture, getLookupUv(textureDimensions, index));
}
`;var BV=`float czm_unpackDepth(vec4 packedDepth)
{
return dot(packedDepth, vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0));
}
`;var kV=`float czm_unpackFloat(vec4 packedFloat)
{
packedFloat = floor(packedFloat * 255.0 + 0.5);
float sign = 1.0 - step(128.0, packedFloat[3]) * 2.0;
float exponent = 2.0 * mod(packedFloat[3], 128.0) + step(128.0, packedFloat[2]) - 127.0;
if (exponent == -127.0)
{
return 0.0;
}
float mantissa = mod(packedFloat[2], 128.0) * 65536.0 + packedFloat[1] * 256.0 + packedFloat[0] + float(0x800000);
float result = sign * exp2(exponent - 23.0) * mantissa;
return result;
}
`;var VV=`int czm_unpackUint(float packedValue) {
float rounded = czm_round(packedValue * 255.0);
return int(rounded);
}
int czm_unpackUint(vec2 packedValue) {
vec2 rounded = czm_round(packedValue * 255.0);
return int(dot(rounded, vec2(1.0, 256.0)));
}
int czm_unpackUint(vec3 packedValue) {
vec3 rounded = czm_round(packedValue * 255.0);
return int(dot(rounded, vec3(1.0, 256.0, 65536.0)));
}
int czm_unpackUint(vec4 packedValue) {
vec4 rounded = czm_round(packedValue * 255.0);
return int(dot(rounded, vec4(1.0, 256.0, 65536.0, 16777216.0)));
}
`;var UV=`float czm_valueTransform(float offset, float scale, float value) {
return scale * value + offset;
}
vec2 czm_valueTransform(vec2 offset, vec2 scale, vec2 value) {
return scale * value + offset;
}
vec3 czm_valueTransform(vec3 offset, vec3 scale, vec3 value) {
return scale * value + offset;
}
vec4 czm_valueTransform(vec4 offset, vec4 scale, vec4 value) {
return scale * value + offset;
}
mat2 czm_valueTransform(mat2 offset, mat2 scale, mat2 value) {
return matrixCompMult(scale, value) + offset;
}
mat3 czm_valueTransform(mat3 offset, mat3 scale, mat3 value) {
return matrixCompMult(scale, value) + offset;
}
mat4 czm_valueTransform(mat4 offset, mat4 scale, mat4 value) {
return matrixCompMult(scale, value) + offset;
}
`;var zV=`#ifdef LOG_DEPTH
out float v_depthFromNearPlusOne;
#ifdef SHADOW_MAP
out vec3 v_logPositionEC;
#endif
#endif
vec4 czm_updatePositionDepth(vec4 coords) {
#if defined(LOG_DEPTH)
#ifdef SHADOW_MAP
vec3 logPositionEC = (czm_inverseProjection * coords).xyz;
v_logPositionEC = logPositionEC;
#endif
coords.z = clamp(coords.z / coords.w, -1.0, 1.0) * coords.w;
#endif
return coords;
}
void czm_vertexLogDepth()
{
#ifdef LOG_DEPTH
v_depthFromNearPlusOne = (gl_Position.w - czm_currentFrustum.x) + 1.0;
gl_Position = czm_updatePositionDepth(gl_Position);
#endif
}
void czm_vertexLogDepth(vec4 clipCoords)
{
#ifdef LOG_DEPTH
v_depthFromNearPlusOne = (clipCoords.w - czm_currentFrustum.x) + 1.0;
czm_updatePositionDepth(clipCoords);
#endif
}
`;var HV=`vec4 czm_screenToEyeCoordinates(vec4 screenCoordinate)
{
float x = 2.0 * screenCoordinate.x - 1.0;
float y = 2.0 * screenCoordinate.y - 1.0;
float z = (screenCoordinate.z - czm_viewportTransformation[3][2]) / czm_viewportTransformation[2][2];
vec4 q = vec4(x, y, z, 1.0);
q /= screenCoordinate.w;
if (!(czm_inverseProjection == mat4(0.0)))
{
q = czm_inverseProjection * q;
}
else
{
float top = czm_frustumPlanes.x;
float bottom = czm_frustumPlanes.y;
float left = czm_frustumPlanes.z;
float right = czm_frustumPlanes.w;
float near = czm_currentFrustum.x;
float far = czm_currentFrustum.y;
q.x = (q.x * (right - left) + left + right) * 0.5;
q.y = (q.y * (top - bottom) + bottom + top) * 0.5;
q.z = (q.z * (near - far) - near - far) * 0.5;
q.w = 1.0;
}
return q;
}
vec4 czm_windowToEyeCoordinates(vec4 fragmentCoordinate)
{
vec2 screenCoordXY = (fragmentCoordinate.xy - czm_viewport.xy) / czm_viewport.zw;
return czm_screenToEyeCoordinates(vec4(screenCoordXY, fragmentCoordinate.zw));
}
vec4 czm_screenToEyeCoordinates(vec2 screenCoordinateXY, float depthOrLogDepth)
{
#if defined(LOG_DEPTH) || defined(LOG_DEPTH_READ_ONLY)
float near = czm_currentFrustum.x;
float far = czm_currentFrustum.y;
float log2Depth = depthOrLogDepth * czm_log2FarDepthFromNearPlusOne;
float depthFromNear = exp2(log2Depth) - 1.0;
float depthFromCamera = depthFromNear + near;
vec4 screenCoord = vec4(screenCoordinateXY, far * (1.0 - near / depthFromCamera) / (far - near), 1.0);
vec4 eyeCoordinate = czm_screenToEyeCoordinates(screenCoord);
eyeCoordinate.w = 1.0 / depthFromCamera;
return eyeCoordinate;
#else
vec4 screenCoord = vec4(screenCoordinateXY, depthOrLogDepth, 1.0);
vec4 eyeCoordinate = czm_screenToEyeCoordinates(screenCoord);
#endif
return eyeCoordinate;
}
vec4 czm_windowToEyeCoordinates(vec2 fragmentCoordinateXY, float depthOrLogDepth)
{
vec2 screenCoordXY = (fragmentCoordinateXY.xy - czm_viewport.xy) / czm_viewport.zw;
return czm_screenToEyeCoordinates(screenCoordXY, depthOrLogDepth);
}
`;var GV=`#if !defined(LOG_DEPTH)
in float v_WindowZ;
#endif
void czm_writeDepthClamp()
{
#if (!defined(LOG_DEPTH) && (__VERSION__ == 300 || defined(GL_EXT_frag_depth)))
gl_FragDepth = clamp(v_WindowZ * gl_FragCoord.w, 0.0, 1.0);
#endif
}
`;var jV=`#ifdef LOG_DEPTH
in float v_depthFromNearPlusOne;
#ifdef POLYGON_OFFSET
uniform vec2 u_polygonOffset;
#endif
#endif
void czm_writeLogDepth(float depth)
{
#if (defined(LOG_DEPTH) && (__VERSION__ == 300 || defined(GL_EXT_frag_depth)))
if (depth <= 0.9999999 || depth > czm_farDepthFromNearPlusOne) {
discard;
}
#ifdef POLYGON_OFFSET
float factor = u_polygonOffset[0];
float units = u_polygonOffset[1];
#if (__VERSION__ == 300 || defined(GL_OES_standard_derivatives))
if (factor != 0.0) {
float x = dFdx(depth);
float y = dFdy(depth);
float m = sqrt(x * x + y * y);
depth += m * factor;
}
#endif
#endif
gl_FragDepth = log2(depth) * czm_oneOverLog2FarDepthFromNearPlusOne;
#ifdef POLYGON_OFFSET
gl_FragDepth += czm_epsilon7 * units;
#endif
#endif
}
void czm_writeLogDepth() {
#ifdef LOG_DEPTH
czm_writeLogDepth(v_depthFromNearPlusOne);
#endif
}
`;var WV=`float czm_writeNonPerspective(float value, float w) {
return value * w;
}
vec2 czm_writeNonPerspective(vec2 value, float w) {
return value * w;
}
vec3 czm_writeNonPerspective(vec3 value, float w) {
return value * w;
}
vec4 czm_writeNonPerspective(vec4 value, float w) {
return value * w;
}
`;var qV=`vec3 czm_XYZToRGB(vec3 Yxy)
{
const mat3 XYZ2RGB = mat3( 3.2405, -0.9693,  0.0556,
-1.5371,  1.8760, -0.2040,
-0.4985,  0.0416,  1.0572);
vec3 xyz;
xyz.r = Yxy.r * Yxy.g / Yxy.b;
xyz.g = Yxy.r;
xyz.b = Yxy.r * (1.0 - Yxy.g - Yxy.b) / Yxy.b;
return XYZ2RGB * xyz;
}
`;var FE={czm_degreesPerRadian:b3,czm_depthRange:x3,czm_epsilon1:T3,czm_epsilon2:A3,czm_epsilon3:C3,czm_epsilon4:E3,czm_epsilon5:S3,czm_epsilon6:w3,czm_epsilon7:v3,czm_infinity:D3,czm_oneOverPi:P3,czm_oneOverTwoPi:I3,czm_passCesium3DTile:O3,czm_passCesium3DTileClassification:R3,czm_passCesium3DTileClassificationIgnoreShow:M3,czm_passClassification:L3,czm_passCompute:N3,czm_passEnvironment:F3,czm_passGlobe:B3,czm_passOpaque:k3,czm_passOverlay:V3,czm_passTerrainClassification:U3,czm_passTranslucent:z3,czm_passVoxels:H3,czm_pi:G3,czm_piOverFour:j3,czm_piOverSix:W3,czm_piOverThree:q3,czm_piOverTwo:Y3,czm_radiansPerDegree:X3,czm_sceneMode2D:K3,czm_sceneMode3D:$3,czm_sceneModeColumbusView:Z3,czm_sceneModeMorphing:J3,czm_solarRadius:Q3,czm_threePiOver2:ek,czm_twoPi:tk,czm_webMercatorMaxLatitude:nk,czm_depthRangeStruct:ik,czm_material:ok,czm_materialInput:rk,czm_modelMaterial:sk,czm_modelVertexOutput:ak,czm_ray:ck,czm_raySegment:lk,czm_shadowParameters:uk,czm_acesTonemapping:fk,czm_alphaWeight:dk,czm_antialias:hk,czm_applyHSBShift:mk,czm_approximateSphericalCoordinates:pk,czm_approximateTanh:_k,czm_backFacing:gk,czm_branchFreeTernary:yk,czm_cascadeColor:bk,czm_cascadeDistance:xk,czm_cascadeMatrix:Tk,czm_cascadeWeights:Ak,czm_clipPolygons:Ck,czm_columbusViewMorph:Ek,czm_computeAtmosphereColor:Sk,czm_computeGroundAtmosphereScattering:wk,czm_computePosition:vk,czm_computeScattering:Dk,czm_cosineAndSine:Pk,czm_decompressTextureCoordinates:Ik,czm_depthClamp:Ok,czm_eastNorthUpToEyeCoordinates:Rk,czm_ellipsoidContainsPoint:Mk,czm_ellipsoidTextureCoordinates:Lk,czm_equalsEpsilon:Nk,czm_eyeOffset:Fk,czm_eyeToWindowCoordinates:Bk,czm_fastApproximateAtan:kk,czm_fog:Vk,czm_gammaCorrect:Uk,czm_geodeticSurfaceNormal:zk,czm_getDefaultMaterial:Hk,czm_getDynamicAtmosphereLightDirection:Gk,czm_getLambertDiffuse:jk,czm_getSpecular:Wk,czm_getWaterNoise:qk,czm_HSBToRGB:Yk,czm_HSLToRGB:Xk,czm_hue:Kk,czm_inverseGamma:$k,czm_isEmpty:Zk,czm_isFull:Jk,czm_latitudeToWebMercatorFraction:Qk,czm_linearToSrgb:eV,czm_lineDistance:tV,czm_luminance:nV,czm_maximumComponent:iV,czm_metersPerPixel:oV,czm_modelToWindowCoordinates:rV,czm_multiplyWithColorBalance:sV,czm_nearFarScalar:aV,czm_octDecode:cV,czm_packDepth:lV,czm_pbrLighting:uV,czm_pbrNeutralTonemapping:fV,czm_phong:dV,czm_planeDistance:hV,czm_pointAlongRay:mV,czm_rayEllipsoidIntersectionInterval:pV,czm_raySphereIntersectionInterval:_V,czm_readDepth:gV,czm_readNonPerspective:yV,czm_reverseLogDepth:bV,czm_RGBToHSB:xV,czm_RGBToHSL:TV,czm_RGBToXYZ:AV,czm_round:CV,czm_saturation:EV,czm_shadowDepthCompare:SV,czm_shadowVisibility:wV,czm_signNotZero:vV,czm_sphericalHarmonics:DV,czm_srgbToLinear:PV,czm_tangentToEyeSpaceMatrix:IV,czm_textureCube:OV,czm_transformPlane:RV,czm_translateRelativeToEye:MV,czm_translucentPhong:LV,czm_transpose:NV,czm_unpackClippingExtents:FV,czm_unpackDepth:BV,czm_unpackFloat:kV,czm_unpackUint:VV,czm_valueTransform:UV,czm_vertexLogDepth:zV,czm_windowToEyeCoordinates:HV,czm_writeDepthClamp:GV,czm_writeLogDepth:jV,czm_writeNonPerspective:WV,czm_XYZToRGB:qV};function hPe(e,t){let n=e;return n=n.replaceAll("version 300 es",""),n=n.replaceAll(/(texture\()/g,"texture2D("),t?(n=n.replaceAll(/\n\s*(in)\s+(vec\d|mat\d|float)/g,`
varying $2`),/out_FragData_(\d+)/.test(n)&&(n=`#extension GL_EXT_draw_buffers : enable
${n}`,n=n.replaceAll(/layout\s+\(location\s*=\s*\d+\)\s*out\s+vec4\s+out_FragData_\d+;/g,""),n=n.replaceAll(/out_FragData_(\d+)/g,"gl_FragData[$1]")),n=n.replaceAll(/layout\s+\(location\s*=\s*0\)\s*out\s+vec4\s+out_FragColor;/g,""),n=n.replaceAll(/out_FragColor/g,"gl_FragColor"),n=n.replaceAll(/out_FragColor\[(\d+)\]/g,"gl_FragColor[$1]"),/gl_FragDepth/.test(n)&&(n=`#extension GL_EXT_frag_depth : enable
${n}`,n=n.replaceAll(/gl_FragDepth/g,"gl_FragDepthEXT")),n=`#ifdef GL_EXT_shader_texture_lod
#extension GL_EXT_shader_texture_lod : enable
#endif
${n}`,n=`#ifdef GL_OES_standard_derivatives
#extension GL_OES_standard_derivatives : enable
#endif
${n}`):(n=n.replaceAll(/(in)\s+(vec\d|mat\d|float)/g,"attribute $2"),n=n.replaceAll(/(out)\s+(vec\d|mat\d|float)\s+([\w]+);/g,"varying $2 $3;")),n=`#version 100
${n}`,n}var YV=hPe;function eee(e){return e=e.replace(/\/\/.*/g,""),e.replace(/\/\*\*[\s\S]*?\*\//gm,function(t){let n=t.match(/\n/gm).length,i="";for(let o=0;o<n;++o)i+=`
`;return i})}function tee(e,t,n){let i;for(let o=0;o<n.length;++o)n[o].name===e&&(i=n[o]);return c(i)||(t=eee(t),i={name:e,glslSource:t,dependsOn:[],requiredBy:[],evaluated:!1},n.push(i)),i}function nee(e,t){if(e.evaluated)return;e.evaluated=!0;let n=e.glslSource.match(/\bczm_[a-zA-Z0-9_]*/g);c(n)&&n!==null&&(n=n.filter(function(i,o){return n.indexOf(i)===o}),n.forEach(function(i){if(i!==e.name&&Ps._czmBuiltinsAndUniforms.hasOwnProperty(i)){let o=tee(i,Ps._czmBuiltinsAndUniforms[i],t);e.dependsOn.push(o),o.requiredBy.push(e),nee(o,t)}}))}function mPe(e){let t=[],n=[];for(;e.length>0;){let o=e.pop();n.push(o),o.requiredBy.length===0&&t.push(o)}for(;t.length>0;){let o=t.shift();e.push(o);for(let r=0;r<o.dependsOn.length;++r){let s=o.dependsOn[r],a=s.requiredBy.indexOf(o);s.requiredBy.splice(a,1),s.requiredBy.length===0&&t.push(s)}}let i=[];for(let o=0;o<n.length;++o)n[o].requiredBy.length!==0&&i.push(n[o]);if(i.length!==0){let o=`A circular dependency was found in the following built-in functions/structs/constants: 
`;for(let r=0;r<i.length;++r)o=`${o+i[r].name}
`;throw new E(o)}}function pPe(e){let t=[],n=tee("main",e,t);nee(n,t),mPe(t);let i="";for(let o=t.length-1;o>=0;--o)i=`${i+t[o].glslSource}
`;return i.replace(n.glslSource,"")}function iee(e,t,n){let i,o,r="",s=e.sources;if(c(s))for(i=0,o=s.length;i<o;++i)r+=`
#line 0
${s[i]}`;r=eee(r);let a;r=r.replace(/#version\s+(.*?)\n/gm,function(b,x){if(c(a)&&a!==x)throw new E(`inconsistent versions found: ${a} and ${x}`);return a=x,`
`});let l=[];r=r.replace(/#extension.*\n/gm,function(b){return l.push(b),`
`}),r=r.replace(/precision\s(lowp|mediump|highp)\s(float|int);/,"");let u=e.pickColorQualifier;c(u)&&(r=Ps.createPickFragmentShaderSource(r,u));let f="",d=l.length;for(i=0;i<d;i++)f+=l[i];t&&(f+=`#ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    precision highp int;
#else
    precision mediump float;
    precision mediump int;
    #define highp mediump
#endif

`);let p=e.defines;if(c(p))for(i=0,o=p.length;i<o;++i){let b=p[i];b.length!==0&&(f+=`#define ${b}
`)}n.textureFloatLinear&&(f+=`#define OES_texture_float_linear

`),n.floatingPointTexture&&(f+=`#define OES_texture_float

`);let g="";e.includeBuiltIns&&(g=pPe(r)),f+=`
#line 0
`;let m=g+r;return n.webgl2&&t&&!/layout\s*\(location\s*=\s*0\)\s*out\s+vec4\s+out_FragColor;/g.test(m)&&!/czm_out_FragColor/g.test(m)&&/out_FragColor/g.test(m)&&(f+=`layout(location = 0) out vec4 out_FragColor;

`),f+=g,f+=r,n.webgl2?f=`#version 300 es
${f}`:f=YV(f,t),f}function Ps(e){e=y(e,y.EMPTY_OBJECT);let t=e.pickColorQualifier;if(c(t)&&t!=="uniform"&&t!=="in")throw new E("options.pickColorQualifier must be 'uniform' or 'in'.");this.defines=c(e.defines)?e.defines.slice(0):[],this.sources=c(e.sources)?e.sources.slice(0):[],this.pickColorQualifier=t,this.includeBuiltIns=y(e.includeBuiltIns,!0)}Ps.prototype.clone=function(){return new Ps({sources:this.sources,defines:this.defines,pickColorQualifier:this.pickColorQualifier,includeBuiltIns:this.includeBuiltIns})};Ps.replaceMain=function(e,t){return t=`void ${t}()`,e.replace(/void\s+main\s*\(\s*(?:void)?\s*\)/g,t)};Ps.prototype.getCacheKey=function(){let t=this.defines.slice().sort().join(","),n=this.pickColorQualifier,i=this.includeBuiltIns,o=this.sources.join(`
`);return`${t}:${n}:${i}:${o}`};Ps.prototype.createCombinedVertexShader=function(e){return iee(this,!1,e)};Ps.prototype.createCombinedFragmentShader=function(e){return iee(this,!0,e)};Ps._czmBuiltinsAndUniforms={};for(let e in FE)FE.hasOwnProperty(e)&&(Ps._czmBuiltinsAndUniforms[e]=FE[e]);for(let e in Wy)if(Wy.hasOwnProperty(e)){let t=Wy[e];typeof t.getDeclaration=="function"&&(Ps._czmBuiltinsAndUniforms[e]=t.getDeclaration(e))}Ps.createPickVertexShaderSource=function(e){return`${Ps.replaceMain(e,"czm_old_main")}
in vec4 pickColor; 
out vec4 czm_pickColor; 
void main() 
{ 
    czm_old_main(); 
    czm_pickColor = pickColor; 
}`};Ps.createPickFragmentShaderSource=function(e,t){let n=Ps.replaceMain(e,"czm_old_main"),i=`${t} vec4 czm_pickColor; 
void main() 
{ 
    czm_old_main(); 
    if (out_FragColor.a == 0.0) { 
       discard; 
    } 
    out_FragColor = czm_pickColor; 
}`;return`${n}
${i}`};function _Pe(e,t){let n=e.defines,i=n.length;for(let o=0;o<i;++o)if(n[o]===t)return!0;return!1}function oee(e,t){let n=e.sources,i=n.length;for(let o=0;o<i;++o)if(n[o].indexOf(t)!==-1)return!0;return!1}function ree(e,t){let n=t.length;for(let i=0;i<n;++i){let o=t[i];if(oee(e,o))return o}}var gPe=["v_normalEC","v_normal"];Ps.findNormalVarying=function(e){return oee(e,"#ifdef HAS_NORMALS")?_Pe(e,"HAS_NORMALS")?"v_normalEC":void 0:ree(e,gPe)};var yPe=["v_positionEC"];Ps.findPositionVarying=function(e){return ree(e,yPe)};var Ge=Ps;var XV=`in vec3 position3DHigh;
in vec3 position3DLow;
in float batchId;
#ifdef EXTRUDED_GEOMETRY
in vec3 extrudeDirection;
uniform float u_globeMinimumAltitude;
#endif // EXTRUDED_GEOMETRY
#ifdef PER_INSTANCE_COLOR
out vec4 v_color;
#endif // PER_INSTANCE_COLOR
#ifdef TEXTURE_COORDINATES
#ifdef SPHERICAL
out vec4 v_sphericalExtents;
#else // SPHERICAL
out vec2 v_inversePlaneExtents;
out vec4 v_westPlane;
out vec4 v_southPlane;
#endif // SPHERICAL
out vec3 v_uvMinAndSphericalLongitudeRotation;
out vec3 v_uMaxAndInverseDistance;
out vec3 v_vMaxAndInverseDistance;
#endif // TEXTURE_COORDINATES
void main()
{
vec4 position = czm_computePosition();
#ifdef EXTRUDED_GEOMETRY
float delta = min(u_globeMinimumAltitude, czm_geometricToleranceOverMeter * length(position.xyz));
delta *= czm_sceneMode == czm_sceneMode3D ? 1.0 : 0.0;
position = position + vec4(extrudeDirection * delta, 0.0);
#endif
#ifdef TEXTURE_COORDINATES
#ifdef SPHERICAL
v_sphericalExtents = czm_batchTable_sphericalExtents(batchId);
v_uvMinAndSphericalLongitudeRotation.z = czm_batchTable_longitudeRotation(batchId);
#else // SPHERICAL
#ifdef COLUMBUS_VIEW_2D
vec4 planes2D_high = czm_batchTable_planes2D_HIGH(batchId);
vec4 planes2D_low = czm_batchTable_planes2D_LOW(batchId);
vec2 idlSplitNewPlaneHiLow = vec2(EAST_MOST_X_HIGH - (WEST_MOST_X_HIGH - planes2D_high.w), EAST_MOST_X_LOW - (WEST_MOST_X_LOW - planes2D_low.w));
bool idlSplit = planes2D_high.x > planes2D_high.w && position3DLow.y > 0.0;
planes2D_high.w = czm_branchFreeTernary(idlSplit, idlSplitNewPlaneHiLow.x, planes2D_high.w);
planes2D_low.w = czm_branchFreeTernary(idlSplit, idlSplitNewPlaneHiLow.y, planes2D_low.w);
idlSplit = planes2D_high.x > planes2D_high.w && position3DLow.y < 0.0;
idlSplitNewPlaneHiLow = vec2(WEST_MOST_X_HIGH - (EAST_MOST_X_HIGH - planes2D_high.x), WEST_MOST_X_LOW - (EAST_MOST_X_LOW - planes2D_low.x));
planes2D_high.x = czm_branchFreeTernary(idlSplit, idlSplitNewPlaneHiLow.x, planes2D_high.x);
planes2D_low.x = czm_branchFreeTernary(idlSplit, idlSplitNewPlaneHiLow.y, planes2D_low.x);
vec3 southWestCorner = (czm_modelViewRelativeToEye * czm_translateRelativeToEye(vec3(0.0, planes2D_high.xy), vec3(0.0, planes2D_low.xy))).xyz;
vec3 northWestCorner = (czm_modelViewRelativeToEye * czm_translateRelativeToEye(vec3(0.0, planes2D_high.x, planes2D_high.z), vec3(0.0, planes2D_low.x, planes2D_low.z))).xyz;
vec3 southEastCorner = (czm_modelViewRelativeToEye * czm_translateRelativeToEye(vec3(0.0, planes2D_high.w, planes2D_high.y), vec3(0.0, planes2D_low.w, planes2D_low.y))).xyz;
#else // COLUMBUS_VIEW_2D
vec3 southWestCorner = (czm_modelViewRelativeToEye * czm_translateRelativeToEye(czm_batchTable_southWest_HIGH(batchId), czm_batchTable_southWest_LOW(batchId))).xyz;
vec3 northWestCorner = czm_normal * czm_batchTable_northward(batchId) + southWestCorner;
vec3 southEastCorner = czm_normal * czm_batchTable_eastward(batchId) + southWestCorner;
#endif // COLUMBUS_VIEW_2D
vec3 eastWard = southEastCorner - southWestCorner;
float eastExtent = length(eastWard);
eastWard /= eastExtent;
vec3 northWard = northWestCorner - southWestCorner;
float northExtent = length(northWard);
northWard /= northExtent;
v_westPlane = vec4(eastWard, -dot(eastWard, southWestCorner));
v_southPlane = vec4(northWard, -dot(northWard, southWestCorner));
v_inversePlaneExtents = vec2(1.0 / eastExtent, 1.0 / northExtent);
#endif // SPHERICAL
vec4 uvMinAndExtents = czm_batchTable_uvMinAndExtents(batchId);
vec4 uMaxVmax = czm_batchTable_uMaxVmax(batchId);
v_uMaxAndInverseDistance = vec3(uMaxVmax.xy, uvMinAndExtents.z);
v_vMaxAndInverseDistance = vec3(uMaxVmax.zw, uvMinAndExtents.w);
v_uvMinAndSphericalLongitudeRotation.xy = uvMinAndExtents.xy;
#endif // TEXTURE_COORDINATES
#ifdef PER_INSTANCE_COLOR
v_color = czm_batchTable_color(batchId);
#endif
gl_Position = czm_depthClamp(czm_modelViewProjectionRelativeToEye * position);
}
`;var qx=`#ifdef VECTOR_TILE
uniform vec4 u_highlightColor;
#endif
void main(void)
{
#ifdef VECTOR_TILE
out_FragColor = czm_gammaCorrect(u_highlightColor);
#else
out_FragColor = vec4(1.0);
#endif
czm_writeDepthClamp();
}
`;var see={TERRAIN:0,CESIUM_3D_TILE:1,BOTH:2};see.NUMBER_OF_CLASSIFICATION_TYPES=3;var Vn=Object.freeze(see);var bPe={NEVER:ne.NEVER,LESS:ne.LESS,EQUAL:ne.EQUAL,LESS_OR_EQUAL:ne.LEQUAL,GREATER:ne.GREATER,NOT_EQUAL:ne.NOTEQUAL,GREATER_OR_EQUAL:ne.GEQUAL,ALWAYS:ne.ALWAYS},Kc=Object.freeze(bPe);function xPe(e,t){if(!c(e))throw new E("array is required.");if(!c(t)||t<1)throw new E("numberOfArrays must be greater than 0.");let n=[],i=e.length,o=0;for(;o<i;){let r=Math.ceil((i-o)/t--);n.push(e.slice(o,o+r)),o+=r}return n}var KV=xPe;function Om(e,t,n){if(!c(e))throw new E("context is required");if(!c(t))throw new E("attributes is required");if(!c(n))throw new E("numberOfInstances is required");if(this._attributes=t,this._numberOfInstances=n,t.length===0)return;let i=TPe(t),o=e.floatingPointTexture,r=i===Be.FLOAT&&!o,s=APe(t,r),a=CPe(s,t,r),l=Math.floor(mt.maximumTextureSize/a),u=Math.min(n,l),f=a*u,d=Math.ceil(n/u),p=1/f,g=p*.5,m=1/d,b=m*.5;this._textureDimensions=new H(f,d),this._textureStep=new se(p,g,m,b),this._pixelDatatype=r?Be.UNSIGNED_BYTE:i,this._packFloats=r,this._offsets=s,this._stride=a,this._texture=void 0;let x=4*f*d;this._batchValues=i===Be.FLOAT&&!r?new Float32Array(x):new Uint8Array(x),this._batchValuesDirty=!1}Object.defineProperties(Om.prototype,{attributes:{get:function(){return this._attributes}},numberOfInstances:{get:function(){return this._numberOfInstances}}});function TPe(e){let t=!1,n=e.length;for(let i=0;i<n;++i)if(e[i].componentDatatype!==$.UNSIGNED_BYTE){t=!0;break}return t?Be.FLOAT:Be.UNSIGNED_BYTE}function cee(e,t){let n=e[t].componentsPerAttribute;return n===2?H:n===3?h:n===4?se:Number}function APe(e,t){let n=new Array(e.length),i=0,o=e.length;for(let r=0;r<o;++r){let a=e[r].componentDatatype;n[r]=i,a!==$.UNSIGNED_BYTE&&t?i+=4:++i}return n}function CPe(e,t,n){let i=e.length,o=e[i-1];return t[i-1].componentDatatype!==$.UNSIGNED_BYTE&&n?o+4:o+1}var BE=new se;function EPe(e,t,n){let i=se.unpack(e,t,BE),o=se.unpackFloat(i);i=se.unpack(e,t+4,BE);let r=se.unpackFloat(i);i=se.unpack(e,t+8,BE);let s=se.unpackFloat(i);i=se.unpack(e,t+12,BE);let a=se.unpackFloat(i);return se.fromElements(o,r,s,a,n)}function SPe(e,t,n){let i=se.packFloat(e.x,BE);se.pack(i,t,n),i=se.packFloat(e.y,i),se.pack(i,t,n+4),i=se.packFloat(e.z,i),se.pack(i,t,n+8),i=se.packFloat(e.w,i),se.pack(i,t,n+12)}var aee=new se;Om.prototype.getBatchedAttribute=function(e,t,n){if(e<0||e>=this._numberOfInstances)throw new E("instanceIndex is out of range.");if(t<0||t>=this._attributes.length)throw new E("attributeIndex is out of range");let i=this._attributes,o=this._offsets[t],s=4*this._stride*e+4*o,a;this._packFloats&&i[t].componentDatatype!==Be.UNSIGNED_BYTE?a=EPe(this._batchValues,s,aee):a=se.unpack(this._batchValues,s,aee);let l=cee(i,t);return c(l.fromCartesian4)?l.fromCartesian4(a,n):c(l.clone)?l.clone(a,n):a.x};var wPe=[void 0,void 0,new H,new h,new se],vPe=new se;Om.prototype.setBatchedAttribute=function(e,t,n){if(e<0||e>=this._numberOfInstances)throw new E("instanceIndex is out of range.");if(t<0||t>=this._attributes.length)throw new E("attributeIndex is out of range");if(!c(n))throw new E("value is required.");let i=this._attributes,o=wPe[i[t].componentsPerAttribute],r=this.getBatchedAttribute(e,t,o),s=cee(this._attributes,t);if(c(s.equals)?s.equals(r,n):r===n)return;let l=vPe;l.x=c(n.x)?n.x:n,l.y=c(n.y)?n.y:0,l.z=c(n.z)?n.z:0,l.w=c(n.w)?n.w:0;let u=this._offsets[t],d=4*this._stride*e+4*u;this._packFloats&&i[t].componentDatatype!==Be.UNSIGNED_BYTE?SPe(l,this._batchValues,d):se.pack(l,this._batchValues,d),this._batchValuesDirty=!0};function DPe(e,t){let n=e._textureDimensions;e._texture=new Lt({context:t,pixelFormat:Ve.RGBA,pixelDatatype:e._pixelDatatype,width:n.x,height:n.y,sampler:Qt.NEAREST,flipY:!1})}function PPe(e){let t=e._textureDimensions;e._texture.copyFrom({source:{width:t.x,height:t.y,arrayBufferView:e._batchValues}})}Om.prototype.update=function(e){c(this._texture)&&!this._batchValuesDirty||this._attributes.length===0||(this._batchValuesDirty=!1,c(this._texture)||DPe(this,e.context),PPe(this))};Om.prototype.getUniformMapCallback=function(){let e=this;return function(t){return e._attributes.length===0?t:At(t,{batchTexture:function(){return e._texture},batchTextureDimensions:function(){return e._textureDimensions},batchTextureStep:function(){return e._textureStep}})}};function IPe(e){let t=e._stride;return e._textureDimensions.y===1?`uniform vec4 batchTextureStep; 
vec2 computeSt(float batchId) 
{ 
    float stepX = batchTextureStep.x; 
    float centerX = batchTextureStep.y; 
    float numberOfAttributes = float(${t}); 
    return vec2(centerX + (batchId * numberOfAttributes * stepX), 0.5); 
} 
`:`uniform vec4 batchTextureStep; 
uniform vec2 batchTextureDimensions; 
vec2 computeSt(float batchId) 
{ 
    float stepX = batchTextureStep.x; 
    float centerX = batchTextureStep.y; 
    float stepY = batchTextureStep.z; 
    float centerY = batchTextureStep.w; 
    float numberOfAttributes = float(${t}); 
    float xId = mod(batchId * numberOfAttributes, batchTextureDimensions.x); 
    float yId = floor(batchId * numberOfAttributes / batchTextureDimensions.x); 
    return vec2(centerX + (xId * stepX), centerY + (yId * stepY)); 
} 
`}function OPe(e){return e===1?"float":`vec${e}`}function RPe(e){return e===1?".x":e===2?".xy":e===3?".xyz":""}function MPe(e,t){let i=e._attributes[t],o=i.componentsPerAttribute,r=i.functionName,s=OPe(o),a=RPe(o),l=e._offsets[t],u=`${s} ${r}(float batchId) 
{ 
    vec2 st = computeSt(batchId); 
    st.x += batchTextureStep.x * float(${l}); 
`;return e._packFloats&&i.componentDatatype!==Be.UNSIGNED_BYTE?u+=`vec4 textureValue; 
textureValue.x = czm_unpackFloat(texture(batchTexture, st)); 
textureValue.y = czm_unpackFloat(texture(batchTexture, st + vec2(batchTextureStep.x, 0.0))); 
textureValue.z = czm_unpackFloat(texture(batchTexture, st + vec2(batchTextureStep.x * 2.0, 0.0))); 
textureValue.w = czm_unpackFloat(texture(batchTexture, st + vec2(batchTextureStep.x * 3.0, 0.0))); 
`:u+=`    vec4 textureValue = texture(batchTexture, st); 
`,u+=`    ${s} value = textureValue${a}; 
`,e._pixelDatatype===Be.UNSIGNED_BYTE&&i.componentDatatype===$.UNSIGNED_BYTE&&!i.normalize?u+=`value *= 255.0; 
`:e._pixelDatatype===Be.FLOAT&&i.componentDatatype===$.UNSIGNED_BYTE&&i.normalize&&(u+=`value /= 255.0; 
`),u+=`    return value; 
} 
`,u}Om.prototype.getVertexShaderCallback=function(){let e=this._attributes;if(e.length===0)return function(i){return i};let t=`uniform highp sampler2D batchTexture; 
`;t+=`${IPe(this)}
`;let n=e.length;for(let i=0;i<n;++i)t+=MPe(this,i);return function(i){let o=i.indexOf("void main"),r=i.substring(0,o),s=i.substring(o);return`${r}
${t}
${s}`}};Om.prototype.isDestroyed=function(){return!1};Om.prototype.destroy=function(){return this._texture=this._texture&&this._texture.destroy(),de(this)};var kE=Om;function $c(e){this._ellipsoid=y(e,ie.WGS84),this._semimajorAxis=this._ellipsoid.maximumRadius,this._oneOverSemimajorAxis=1/this._semimajorAxis}Object.defineProperties($c.prototype,{ellipsoid:{get:function(){return this._ellipsoid}}});$c.mercatorAngleToGeodeticLatitude=function(e){return R.PI_OVER_TWO-2*Math.atan(Math.exp(-e))};$c.geodeticLatitudeToMercatorAngle=function(e){e>$c.MaximumLatitude?e=$c.MaximumLatitude:e<-$c.MaximumLatitude&&(e=-$c.MaximumLatitude);let t=Math.sin(e);return .5*Math.log((1+t)/(1-t))};$c.MaximumLatitude=$c.mercatorAngleToGeodeticLatitude(Math.PI);$c.prototype.project=function(e,t){let n=this._semimajorAxis,i=e.longitude*n,o=$c.geodeticLatitudeToMercatorAngle(e.latitude)*n,r=e.height;return c(t)?(t.x=i,t.y=o,t.z=r,t):new h(i,o,r)};$c.prototype.unproject=function(e,t){if(!c(e))throw new E("cartesian is required");let n=this._oneOverSemimajorAxis,i=e.x*n,o=$c.mercatorAngleToGeodeticLatitude(e.y*n),r=e.z;return c(t)?(t.longitude=i,t.latitude=o,t.height=r,t):new he(i,o,r)};var Li=$c;function LPe(e,t,n){let i=!n,o=e.length,r;if(!i&&o>1){let s=e[0].modelMatrix;for(r=1;r<o;++r)if(!k.equals(s,e[r].modelMatrix)){i=!0;break}}if(i)for(r=0;r<o;++r)c(e[r].geometry)&&Fn.transformToWorldCoordinates(e[r]);else k.multiplyTransformation(t,e[0].modelMatrix,t)}function $V(e,t){let n=e.attributes,i=n.position,o=i.values.length/i.componentsPerAttribute;n.batchId=new we({componentDatatype:$.FLOAT,componentsPerAttribute:1,values:new Float32Array(o)});let r=n.batchId.values;for(let s=0;s<o;++s)r[s]=t}function NPe(e){let t=e.length;for(let n=0;n<t;++n){let i=e[n];c(i.geometry)?$V(i.geometry,n):c(i.westHemisphereGeometry)&&c(i.eastHemisphereGeometry)&&($V(i.westHemisphereGeometry,n),$V(i.eastHemisphereGeometry,n))}}function FPe(e){let t=e.instances,n=e.projection,i=e.elementIndexUintSupported,o=e.scene3DOnly,r=e.vertexCacheOptimize,s=e.compressVertices,a=e.modelMatrix,l,u,f,d=t.length;for(l=0;l<d;++l)if(c(t[l].geometry)){f=t[l].geometry.primitiveType;break}for(l=1;l<d;++l)if(c(t[l].geometry)&&t[l].geometry.primitiveType!==f)throw new E("All instance geometries must have the same primitiveType.");if(LPe(t,a,o),!o)for(l=0;l<d;++l)c(t[l].geometry)&&Fn.splitLongitude(t[l]);if(NPe(t),r)for(l=0;l<d;++l){let g=t[l];c(g.geometry)?(Fn.reorderForPostVertexCache(g.geometry),Fn.reorderForPreVertexCache(g.geometry)):c(g.westHemisphereGeometry)&&c(g.eastHemisphereGeometry)&&(Fn.reorderForPostVertexCache(g.westHemisphereGeometry),Fn.reorderForPreVertexCache(g.westHemisphereGeometry),Fn.reorderForPostVertexCache(g.eastHemisphereGeometry),Fn.reorderForPreVertexCache(g.eastHemisphereGeometry))}let p=Fn.combineInstances(t);for(d=p.length,l=0;l<d;++l){u=p[l];let g=u.attributes;if(o)for(let m in g)g.hasOwnProperty(m)&&g[m].componentDatatype===$.DOUBLE&&Fn.encodeAttribute(u,m,`${m}3DHigh`,`${m}3DLow`);else for(let m in g)if(g.hasOwnProperty(m)&&g[m].componentDatatype===$.DOUBLE){let b=`${m}3D`,x=`${m}2D`;Fn.projectTo2D(u,m,b,x,n),c(u.boundingSphere)&&m==="position"&&(u.boundingSphereCV=ce.fromVertices(u.attributes.position2D.values)),Fn.encodeAttribute(u,b,`${b}High`,`${b}Low`),Fn.encodeAttribute(u,x,`${x}High`,`${x}Low`)}s&&Fn.compressVertices(u)}if(!i){let g=[];for(d=p.length,l=0;l<d;++l)u=p[l],g=g.concat(Fn.fitToUnsignedShortIndices(u));p=g}return p}function ZV(e,t,n,i){let o,r,s,a=i.length-1;if(a>=0){let u=i[a];o=u.offset+u.count,s=u.index,r=n[s].indices.length}else o=0,s=0,r=n[s].indices.length;let l=e.length;for(let u=0;u<l;++u){let d=e[u][t];if(!c(d))continue;let p=d.indices.length;o+p>r&&(o=0,r=n[++s].indices.length),i.push({index:s,offset:o,count:p}),o+=p}}function BPe(e,t){let n=[];return ZV(e,"geometry",t,n),ZV(e,"westHemisphereGeometry",t,n),ZV(e,"eastHemisphereGeometry",t,n),n}var Rm={};Rm.combineGeometry=function(e){let t,n,i=e.instances,o=i.length,r,s,a=!1;o>0&&(t=FPe(e),t.length>0&&(n=Fn.createAttributeLocations(t[0]),e.createPickOffsets&&(r=BPe(i,t))),c(i[0].attributes)&&c(i[0].attributes.offset)&&(s=new Array(o),a=!0));let l=new Array(o),u=new Array(o);for(let f=0;f<o;++f){let d=i[f],p=d.geometry;c(p)&&(l[f]=p.boundingSphere,u[f]=p.boundingSphereCV,a&&(s[f]=d.geometry.offsetAttribute));let g=d.eastHemisphereGeometry,m=d.westHemisphereGeometry;c(g)&&c(m)&&(c(g.boundingSphere)&&c(m.boundingSphere)&&(l[f]=ce.union(g.boundingSphere,m.boundingSphere)),c(g.boundingSphereCV)&&c(m.boundingSphereCV)&&(u[f]=ce.union(g.boundingSphereCV,m.boundingSphereCV)))}return{geometries:t,modelMatrix:e.modelMatrix,attributeLocations:n,pickOffsets:r,offsetInstanceExtend:s,boundingSpheres:l,boundingSpheresCV:u}};function kPe(e,t){let n=e.attributes;for(let i in n)if(n.hasOwnProperty(i)){let o=n[i];c(o)&&c(o.values)&&t.push(o.values.buffer)}c(e.indices)&&t.push(e.indices.buffer)}function VPe(e,t){let n=e.length;for(let i=0;i<n;++i)kPe(e[i],t)}function UPe(e){let t=1,n=e.length;for(let i=0;i<n;i++){let o=e[i];if(++t,!c(o))continue;let r=o.attributes;t+=7+2*ce.packedLength+(c(o.indices)?o.indices.length:0);for(let s in r)if(r.hasOwnProperty(s)&&c(r[s])){let a=r[s];t+=5+a.values.length}}return t}Rm.packCreateGeometryResults=function(e,t){let n=new Float64Array(UPe(e)),i=[],o={},r=e.length,s=0;n[s++]=r;for(let a=0;a<r;a++){let l=e[a],u=c(l);if(n[s++]=u?1:0,!u)continue;n[s++]=l.primitiveType,n[s++]=l.geometryType,n[s++]=y(l.offsetAttribute,-1);let f=c(l.boundingSphere)?1:0;n[s++]=f,f&&ce.pack(l.boundingSphere,n,s),s+=ce.packedLength;let d=c(l.boundingSphereCV)?1:0;n[s++]=d,d&&ce.pack(l.boundingSphereCV,n,s),s+=ce.packedLength;let p=l.attributes,g=[];for(let b in p)p.hasOwnProperty(b)&&c(p[b])&&(g.push(b),c(o[b])||(o[b]=i.length,i.push(b)));n[s++]=g.length;for(let b=0;b<g.length;b++){let x=g[b],T=p[x];n[s++]=o[x],n[s++]=T.componentDatatype,n[s++]=T.componentsPerAttribute,n[s++]=T.normalize?1:0,n[s++]=T.values.length,n.set(T.values,s),s+=T.values.length}let m=c(l.indices)?l.indices.length:0;n[s++]=m,m>0&&(n.set(l.indices,s),s+=m)}return t.push(n.buffer),{stringTable:i,packedData:n}};Rm.unpackCreateGeometryResults=function(e){let t=e.stringTable,n=e.packedData,i,o=new Array(n[0]),r=0,s=1;for(;s<n.length;){if(!(n[s++]===1)){o[r++]=void 0;continue}let l=n[s++],u=n[s++],f=n[s++];f===-1&&(f=void 0);let d,p;n[s++]===1&&(d=ce.unpack(n,s)),s+=ce.packedLength,n[s++]===1&&(p=ce.unpack(n,s)),s+=ce.packedLength;let b,x,T,C=new pn,S=n[s++];for(i=0;i<S;i++){let D=t[n[s++]],I=n[s++];T=n[s++];let L=n[s++]!==0;b=n[s++],x=$.createTypedArray(I,b);for(let M=0;M<b;M++)x[M]=n[s++];C[D]=new we({componentDatatype:I,componentsPerAttribute:T,normalize:L,values:x})}let v;if(b=n[s++],b>0){let D=x.length/T;for(v=Fe.createTypedArray(D,b),i=0;i<b;i++)v[i]=n[s++]}o[r++]=new ut({primitiveType:l,geometryType:u,boundingSphere:d,boundingSphereCV:p,indices:v,attributes:C,offsetAttribute:f})}return o};function zPe(e,t){let n=e.length,i=new Float64Array(1+n*19),o=0;i[o++]=n;for(let r=0;r<n;r++){let s=e[r];if(k.pack(s.modelMatrix,i,o),o+=k.packedLength,c(s.attributes)&&c(s.attributes.offset)){let a=s.attributes.offset.value;i[o]=a[0],i[o+1]=a[1],i[o+2]=a[2]}o+=3}return t.push(i.buffer),i}function HPe(e){let t=e,n=new Array(t[0]),i=0,o=1;for(;o<t.length;){let r=k.unpack(t,o),s;o+=k.packedLength,c(t[o])&&(s={offset:new Qi(t[o],t[o+1],t[o+2])}),o+=3,n[i++]={modelMatrix:r,attributes:s}}return n}Rm.packCombineGeometryParameters=function(e,t){let n=e.createGeometryResults,i=n.length;for(let o=0;o<i;o++)t.push(n[o].packedData.buffer);return{createGeometryResults:e.createGeometryResults,packedInstances:zPe(e.instances,t),ellipsoid:e.ellipsoid,isGeographic:e.projection instanceof Mi,elementIndexUintSupported:e.elementIndexUintSupported,scene3DOnly:e.scene3DOnly,vertexCacheOptimize:e.vertexCacheOptimize,compressVertices:e.compressVertices,modelMatrix:e.modelMatrix,createPickOffsets:e.createPickOffsets}};Rm.unpackCombineGeometryParameters=function(e){let t=HPe(e.packedInstances),n=e.createGeometryResults,i=n.length,o=0;for(let a=0;a<i;a++){let l=Rm.unpackCreateGeometryResults(n[a]),u=l.length;for(let f=0;f<u;f++){let d=l[f],p=t[o];p.geometry=d,++o}}let r=ie.clone(e.ellipsoid),s=e.isGeographic?new Mi(r):new Li(r);return{instances:t,ellipsoid:r,projection:s,elementIndexUintSupported:e.elementIndexUintSupported,scene3DOnly:e.scene3DOnly,vertexCacheOptimize:e.vertexCacheOptimize,compressVertices:e.compressVertices,modelMatrix:k.clone(e.modelMatrix),createPickOffsets:e.createPickOffsets}};function lee(e){let t=e.length,n=1+(ce.packedLength+1)*t,i=new Float32Array(n),o=0;i[o++]=t;for(let r=0;r<t;++r){let s=e[r];c(s)?(i[o++]=1,ce.pack(e[r],i,o)):i[o++]=0,o+=ce.packedLength}return i}function uee(e){let t=new Array(e[0]),n=0,i=1;for(;i<e.length;)e[i++]===1&&(t[n]=ce.unpack(e,i)),++n,i+=ce.packedLength;return t}Rm.packCombineGeometryResults=function(e,t){c(e.geometries)&&VPe(e.geometries,t);let n=lee(e.boundingSpheres),i=lee(e.boundingSpheresCV);return t.push(n.buffer,i.buffer),{geometries:e.geometries,attributeLocations:e.attributeLocations,modelMatrix:e.modelMatrix,pickOffsets:e.pickOffsets,offsetInstanceExtend:e.offsetInstanceExtend,boundingSpheres:n,boundingSpheresCV:i}};Rm.unpackCombineGeometryResults=function(e){return{geometries:e.geometries,attributeLocations:e.attributeLocations,modelMatrix:e.modelMatrix,pickOffsets:e.pickOffsets,offsetInstanceExtend:e.offsetInstanceExtend,boundingSpheres:uee(e.boundingSpheres),boundingSpheresCV:uee(e.boundingSpheresCV)}};var VE=Rm;var GPe={READY:0,CREATING:1,CREATED:2,COMBINING:3,COMBINED:4,COMPLETE:5,FAILED:6},Hr=Object.freeze(GPe);var qI={MORPHING:0,COLUMBUS_VIEW:1,SCENE2D:2,SCENE3D:3};qI.getMorphTime=function(e){return e===qI.SCENE3D?1:e===qI.MORPHING?void 0:0};var oe=Object.freeze(qI);var Ml={DISABLED:0,ENABLED:1,CAST_ONLY:2,RECEIVE_ONLY:3};Ml.NUMBER_OF_SHADOW_MODES=4;Ml.castShadows=function(e){return e===Ml.ENABLED||e===Ml.CAST_ONLY};Ml.receiveShadows=function(e){return e===Ml.ENABLED||e===Ml.RECEIVE_ONLY};Ml.fromCastReceive=function(e,t){return e&&t?Ml.ENABLED:e?Ml.CAST_ONLY:t?Ml.RECEIVE_ONLY:Ml.DISABLED};var En=Object.freeze(Ml);function mr(e){if(e=y(e,y.EMPTY_OBJECT),this.geometryInstances=e.geometryInstances,this.appearance=e.appearance,this._appearance=void 0,this._material=void 0,this.depthFailAppearance=e.depthFailAppearance,this._depthFailAppearance=void 0,this._depthFailMaterial=void 0,this.modelMatrix=k.clone(y(e.modelMatrix,k.IDENTITY)),this._modelMatrix=new k,this.show=y(e.show,!0),this._vertexCacheOptimize=y(e.vertexCacheOptimize,!1),this._interleave=y(e.interleave,!1),this._releaseGeometryInstances=y(e.releaseGeometryInstances,!0),this._allowPicking=y(e.allowPicking,!0),this._asynchronous=y(e.asynchronous,!0),this._compressVertices=y(e.compressVertices,!0),this.cull=y(e.cull,!0),this.debugShowBoundingVolume=y(e.debugShowBoundingVolume,!1),this.rtcCenter=e.rtcCenter,c(this.rtcCenter)&&(!c(this.geometryInstances)||Array.isArray(this.geometryInstances)&&this.geometryInstances.length!==1))throw new E("Relative-to-center rendering only supports one geometry instance.");this.shadows=y(e.shadows,En.DISABLED),this._translucent=void 0,this._state=Hr.READY,this._geometries=[],this._error=void 0,this._numberOfInstances=0,this._boundingSpheres=[],this._boundingSphereWC=[],this._boundingSphereCV=[],this._boundingSphere2D=[],this._boundingSphereMorph=[],this._perInstanceAttributeCache=new Map,this._instanceIds=[],this._lastPerInstanceAttributeIndex=0,this._va=[],this._attributeLocations=void 0,this._primitiveType=void 0,this._frontFaceRS=void 0,this._backFaceRS=void 0,this._sp=void 0,this._depthFailAppearance=void 0,this._spDepthFail=void 0,this._frontFaceDepthFailRS=void 0,this._backFaceDepthFailRS=void 0,this._pickIds=[],this._colorCommands=[],this._pickCommands=[],this._createBoundingVolumeFunction=e._createBoundingVolumeFunction,this._createRenderStatesFunction=e._createRenderStatesFunction,this._createShaderProgramFunction=e._createShaderProgramFunction,this._createCommandsFunction=e._createCommandsFunction,this._updateAndQueueCommandsFunction=e._updateAndQueueCommandsFunction,this._createPickOffsets=e._createPickOffsets,this._pickOffsets=void 0,this._createGeometryResults=void 0,this._ready=!1,this._batchTable=void 0,this._batchTableAttributeIndices=void 0,this._offsetInstanceExtend=void 0,this._batchTableOffsetAttribute2DIndex=void 0,this._batchTableOffsetsUpdated=!1,this._instanceBoundingSpheres=void 0,this._instanceBoundingSpheresCV=void 0,this._tempBoundingSpheres=void 0,this._recomputeBoundingSpheres=!1,this._batchTableBoundingSpheresUpdated=!1,this._batchTableBoundingSphereAttributeIndices=void 0}Object.defineProperties(mr.prototype,{vertexCacheOptimize:{get:function(){return this._vertexCacheOptimize}},interleave:{get:function(){return this._interleave}},releaseGeometryInstances:{get:function(){return this._releaseGeometryInstances}},allowPicking:{get:function(){return this._allowPicking}},asynchronous:{get:function(){return this._asynchronous}},compressVertices:{get:function(){return this._compressVertices}},ready:{get:function(){return this._ready}}});function jPe(e){let t=e.length,n=[],i=e[0].attributes,o;for(o in i)if(i.hasOwnProperty(o)&&c(i[o])){let r=i[o],s=!0;for(let a=1;a<t;++a){let l=e[a].attributes[o];if(!c(l)||r.componentDatatype!==l.componentDatatype||r.componentsPerAttribute!==l.componentsPerAttribute||r.normalize!==l.normalize){s=!1;break}}s&&n.push(o)}return n}var WPe=new H,qPe=new h,bee=new se;function xee(e){let t=e.length;if(t===1)return e[0];if(t===2)return H.unpack(e,0,WPe);if(t===3)return h.unpack(e,0,qPe);if(t===4)return se.unpack(e,0,bee)}function YPe(e,t){let n=e.geometryInstances,i=Array.isArray(n)?n:[n],o=i.length;if(o===0)return;let r=jPe(i),s=r.length,a=[],l={},u={},f,p=i[0].attributes,g,m,b;for(g=0;g<s;++g)m=r[g],b=p[m],l[m]=g,a.push({functionName:`czm_batchTable_${m}`,componentDatatype:b.componentDatatype,componentsPerAttribute:b.componentsPerAttribute,normalize:b.normalize});r.indexOf("distanceDisplayCondition")!==-1&&(a.push({functionName:"czm_batchTable_boundingSphereCenter3DHigh",componentDatatype:$.FLOAT,componentsPerAttribute:3},{functionName:"czm_batchTable_boundingSphereCenter3DLow",componentDatatype:$.FLOAT,componentsPerAttribute:3},{functionName:"czm_batchTable_boundingSphereCenter2DHigh",componentDatatype:$.FLOAT,componentsPerAttribute:3},{functionName:"czm_batchTable_boundingSphereCenter2DLow",componentDatatype:$.FLOAT,componentsPerAttribute:3},{functionName:"czm_batchTable_boundingSphereRadius",componentDatatype:$.FLOAT,componentsPerAttribute:1}),u.center3DHigh=a.length-5,u.center3DLow=a.length-4,u.center2DHigh=a.length-3,u.center2DLow=a.length-2,u.radius=a.length-1),r.indexOf("offset")!==-1&&(a.push({functionName:"czm_batchTable_offset2D",componentDatatype:$.FLOAT,componentsPerAttribute:3}),f=a.length-1),a.push({functionName:"czm_batchTable_pickColor",componentDatatype:$.UNSIGNED_BYTE,componentsPerAttribute:4,normalize:!0});let x=a.length,T=new kE(t,a,o);for(g=0;g<o;++g){let C=i[g];p=C.attributes;for(let L=0;L<s;++L){m=r[L],b=p[m];let M=xee(b.value),N=l[m];T.setBatchedAttribute(g,N,M)}let S={primitive:y(C.pickPrimitive,e)};c(C.id)&&(S.id=C.id);let v=t.createPickId(S);e._pickIds.push(v);let D=v.color,I=bee;I.x=j.floatToByte(D.red),I.y=j.floatToByte(D.green),I.z=j.floatToByte(D.blue),I.w=j.floatToByte(D.alpha),T.setBatchedAttribute(g,x-1,I)}e._batchTable=T,e._batchTableAttributeIndices=l,e._batchTableBoundingSphereAttributeIndices=u,e._batchTableOffsetAttribute2DIndex=f}function XPe(e){let t;return Array.isArray(e.values)?t=e.values.slice(0):t=new e.values.constructor(e.values),new we({componentDatatype:e.componentDatatype,componentsPerAttribute:e.componentsPerAttribute,normalize:e.normalize,values:t})}function KPe(e){let t=e.attributes,n=new pn;for(let o in t)t.hasOwnProperty(o)&&c(t[o])&&(n[o]=XPe(t[o]));let i;if(c(e.indices)){let o=e.indices;Array.isArray(o)?i=o.slice(0):i=new o.constructor(o)}return new ut({attributes:n,indices:i,primitiveType:e.primitiveType,boundingSphere:ce.clone(e.boundingSphere)})}function $Pe(e,t){return{geometry:t,attributes:e.attributes,modelMatrix:k.clone(e.modelMatrix),pickPrimitive:e.pickPrimitive,id:e.id}}var ZPe=/in\s+vec(?:3|4)\s+(.*)3DHigh;/g;mr._modifyShaderPosition=function(e,t,n){let i,o="",r="",s="";for(;(i=ZPe.exec(t))!==null;){let a=i[1],l=`vec4 czm_compute${a[0].toUpperCase()}${a.substr(1)}()`;l!=="vec4 czm_computePosition()"&&(o+=`${l};
`),c(e.rtcCenter)?(t=t.replace(/in\s+vec(?:3|4)\s+position3DHigh;/g,""),t=t.replace(/in\s+vec(?:3|4)\s+position3DLow;/g,""),o+=`uniform mat4 u_modifiedModelView;
`,r+=`in vec4 position;
`,s+=`${l}
{
    return u_modifiedModelView * position;
}

`,t=t.replace(/czm_modelViewRelativeToEye\s+\*\s+/g,""),t=t.replace(/czm_modelViewProjectionRelativeToEye/g,"czm_projection")):n?s+=`${l}
{
    return czm_translateRelativeToEye(${a}3DHigh, ${a}3DLow);
}

`:(r+=`in vec3 ${a}2DHigh;
in vec3 ${a}2DLow;
`,s+=`${l}
{
    vec4 p;
    if (czm_morphTime == 1.0)
    {
        p = czm_translateRelativeToEye(${a}3DHigh, ${a}3DLow);
    }
    else if (czm_morphTime == 0.0)
    {
        p = czm_translateRelativeToEye(${a}2DHigh.zxy, ${a}2DLow.zxy);
    }
    else
    {
        p = czm_columbusViewMorph(
                czm_translateRelativeToEye(${a}2DHigh.zxy, ${a}2DLow.zxy),
                czm_translateRelativeToEye(${a}3DHigh, ${a}3DLow),
                czm_morphTime);
    }
    return p;
}

`)}return[o,r,t,s].join(`
`)};mr._appendShowToShader=function(e,t){return c(e._batchTableAttributeIndices.show)?`${Ge.replaceMain(t,"czm_non_show_main")}
void main() 
{ 
    czm_non_show_main(); 
    gl_Position *= czm_batchTable_show(batchId); 
}`:t};mr._updateColorAttribute=function(e,t,n){if(!c(e._batchTableAttributeIndices.color)&&!c(e._batchTableAttributeIndices.depthFailColor)||t.search(/in\s+vec4\s+color;/g)===-1)return t;if(n&&!c(e._batchTableAttributeIndices.depthFailColor))throw new E("A depthFailColor per-instance attribute is required when using a depth fail appearance that uses a color attribute.");let i=t;return i=i.replace(/in\s+vec4\s+color;/g,""),n?i=i.replace(/(\b)color(\b)/g,"$1czm_batchTable_depthFailColor(batchId)$2"):i=i.replace(/(\b)color(\b)/g,"$1czm_batchTable_color(batchId)$2"),i};function fee(e){return`${Ge.replaceMain(e,"czm_non_pick_main")}
out vec4 v_pickColor; 
void main() 
{ 
    czm_non_pick_main(); 
    v_pickColor = czm_batchTable_pickColor(batchId); 
}`}function dee(e){return`in vec4 v_pickColor;
${e}`}mr._updatePickColorAttribute=function(e){let t=e.replace(/in\s+vec4\s+pickColor;/g,"");return t=t.replace(/(\b)pickColor(\b)/g,"$1czm_batchTable_pickColor(batchId)$2"),t};mr._appendOffsetToShader=function(e,t){if(!c(e._batchTableAttributeIndices.offset))return t;let n=`in float batchId;
`;n+="in float applyOffset;";let i=t.replace(/in\s+float\s+batchId;/g,n),o=`vec4 $1 = czm_computePosition();
`;return o+=`    if (czm_sceneMode == czm_sceneMode3D)
`,o+=`    {
`,o+="        $1 = $1 + vec4(czm_batchTable_offset(batchId) * applyOffset, 0.0);",o+=`    }
`,o+=`    else
`,o+=`    {
`,o+="        $1 = $1 + vec4(czm_batchTable_offset2D(batchId) * applyOffset, 0.0);",o+=`    }
`,i=i.replace(/vec4\s+([A-Za-z0-9_]+)\s+=\s+czm_computePosition\(\);/g,o),i};mr._appendDistanceDisplayConditionToShader=function(e,t,n){if(!c(e._batchTableAttributeIndices.distanceDisplayCondition))return t;let i=Ge.replaceMain(t,"czm_non_distanceDisplayCondition_main"),o=`void main() 
{ 
    czm_non_distanceDisplayCondition_main(); 
    vec2 distanceDisplayCondition = czm_batchTable_distanceDisplayCondition(batchId);
    vec3 boundingSphereCenter3DHigh = czm_batchTable_boundingSphereCenter3DHigh(batchId);
    vec3 boundingSphereCenter3DLow = czm_batchTable_boundingSphereCenter3DLow(batchId);
    float boundingSphereRadius = czm_batchTable_boundingSphereRadius(batchId);
`;return n?o+=`    vec4 centerRTE = czm_translateRelativeToEye(boundingSphereCenter3DHigh, boundingSphereCenter3DLow);
`:o+=`    vec3 boundingSphereCenter2DHigh = czm_batchTable_boundingSphereCenter2DHigh(batchId);
    vec3 boundingSphereCenter2DLow = czm_batchTable_boundingSphereCenter2DLow(batchId);
    vec4 centerRTE;
    if (czm_morphTime == 1.0)
    {
        centerRTE = czm_translateRelativeToEye(boundingSphereCenter3DHigh, boundingSphereCenter3DLow);
    }
    else if (czm_morphTime == 0.0)
    {
        centerRTE = czm_translateRelativeToEye(boundingSphereCenter2DHigh.zxy, boundingSphereCenter2DLow.zxy);
    }
    else
    {
        centerRTE = czm_columbusViewMorph(
                czm_translateRelativeToEye(boundingSphereCenter2DHigh.zxy, boundingSphereCenter2DLow.zxy),
                czm_translateRelativeToEye(boundingSphereCenter3DHigh, boundingSphereCenter3DLow),
                czm_morphTime);
    }
`,o+=`    float radiusSq = boundingSphereRadius * boundingSphereRadius; 
    float distanceSq; 
    if (czm_sceneMode == czm_sceneMode2D) 
    { 
        distanceSq = czm_eyeHeight2D.y - radiusSq; 
    } 
    else 
    { 
        distanceSq = dot(centerRTE.xyz, centerRTE.xyz) - radiusSq; 
    } 
    distanceSq = max(distanceSq, 0.0); 
    float nearSq = distanceDisplayCondition.x * distanceDisplayCondition.x; 
    float farSq = distanceDisplayCondition.y * distanceDisplayCondition.y; 
    float show = (distanceSq >= nearSq && distanceSq <= farSq) ? 1.0 : 0.0; 
    gl_Position *= show; 
}`,`${i}
${o}`};function hee(e,t){if(!e.compressVertices)return t;let n=t.search(/in\s+vec3\s+normal;/g)!==-1,i=t.search(/in\s+vec2\s+st;/g)!==-1;if(!n&&!i)return t;let o=t.search(/in\s+vec3\s+tangent;/g)!==-1,r=t.search(/in\s+vec3\s+bitangent;/g)!==-1,s=i&&n?2:1;s+=o||r?1:0;let a=s>1?`vec${s}`:"float",l="compressedAttributes",u=`in ${a} ${l};`,f="",d="";if(i){f+=`vec2 st;
`;let m=s>1?`${l}.x`:l;d+=`    st = czm_decompressTextureCoordinates(${m});
`}n&&o&&r?(f+=`vec3 normal;
vec3 tangent;
vec3 bitangent;
`,d+=`    czm_octDecode(${l}.${i?"yz":"xy"}, normal, tangent, bitangent);
`):(n&&(f+=`vec3 normal;
`,d+=`    normal = czm_octDecode(${l}${s>1?`.${i?"y":"x"}`:""});
`),o&&(f+=`vec3 tangent;
`,d+=`    tangent = czm_octDecode(${l}.${i&&n?"z":"y"});
`),r&&(f+=`vec3 bitangent;
`,d+=`    bitangent = czm_octDecode(${l}.${i&&n?"z":"y"});
`));let p=t;p=p.replace(/in\s+vec3\s+normal;/g,""),p=p.replace(/in\s+vec2\s+st;/g,""),p=p.replace(/in\s+vec3\s+tangent;/g,""),p=p.replace(/in\s+vec3\s+bitangent;/g,""),p=Ge.replaceMain(p,"czm_non_compressed_main");let g=`void main() 
{ 
${d}    czm_non_compressed_main(); 
}`;return[u,f,p,g].join(`
`)}function JPe(e){let t=Ge.replaceMain(e,"czm_non_depth_clamp_main");return t+=`void main() {
    czm_non_depth_clamp_main();
    gl_Position = czm_depthClamp(gl_Position);}
`,t}function QPe(e){let t=Ge.replaceMain(e,"czm_non_depth_clamp_main");return t+=`void main() {
    czm_non_depth_clamp_main();
    #if defined(LOG_DEPTH)
        czm_writeLogDepth();
    #else
        czm_writeDepthClamp();
    #endif
}
`,t}function mee(e,t){let n=e.vertexAttributes;for(let i in n)if(n.hasOwnProperty(i)&&!c(t[i]))throw new E(`Appearance/Geometry mismatch.  The appearance requires vertex shader attribute input '${i}', which was not computed as part of the Geometry.  Use the appearance's vertexFormat property when constructing the geometry.`)}function eIe(e,t){return function(){return e[t]}}var JV=Math.max(zt.hardwareConcurrency-1,1),YI,tIe=new Ti("combineGeometry");function nIe(e,t){let n,i,o,r,s=e._instanceIds;if(e._state===Hr.READY){n=Array.isArray(e.geometryInstances)?e.geometryInstances:[e.geometryInstances];let a=e._numberOfInstances=n.length,l=[],u=[];for(o=0;o<a;++o){if(i=n[o].geometry,s.push(n[o].id),c(i._workerName)&&c(i._workerPath)||!c(i._workerName)&&!c(i._workerPath))throw new E("Must define either _workerName or _workerPath for asynchronous geometry.");u.push({moduleName:i._workerName,modulePath:i._workerPath,geometry:i})}if(!c(YI))for(YI=new Array(JV),o=0;o<JV;o++)YI[o]=new Ti("createGeometry");let f;for(u=KV(u,JV),o=0;o<u.length;o++){let d=0,p=u[o],g=p.length;for(r=0;r<g;++r)f=p[r],i=f.geometry,c(i.constructor.pack)&&(f.offset=d,d+=y(i.constructor.packedLength,i.packedLength));let m;if(d>0){let b=new Float64Array(d);for(m=[b.buffer],r=0;r<g;++r)f=p[r],i=f.geometry,c(i.constructor.pack)&&(i.constructor.pack(i,b,f.offset),f.geometry=b)}l.push(YI[o].scheduleTask({subTasks:u[o]},m))}e._state=Hr.CREATING,Promise.all(l).then(function(d){e._createGeometryResults=d,e._state=Hr.CREATED}).catch(function(d){zE(e,t,Hr.FAILED,d)})}else if(e._state===Hr.CREATED){let a=[];n=Array.isArray(e.geometryInstances)?e.geometryInstances:[e.geometryInstances];let l=t.scene3DOnly,u=t.mapProjection,f=tIe.scheduleTask(VE.packCombineGeometryParameters({createGeometryResults:e._createGeometryResults,instances:n,ellipsoid:u.ellipsoid,projection:u,elementIndexUintSupported:t.context.elementIndexUint,scene3DOnly:l,vertexCacheOptimize:e.vertexCacheOptimize,compressVertices:e.compressVertices,modelMatrix:e.modelMatrix,createPickOffsets:e._createPickOffsets},a),a);e._createGeometryResults=void 0,e._state=Hr.COMBINING,Promise.resolve(f).then(function(d){let p=VE.unpackCombineGeometryResults(d);e._geometries=p.geometries,e._attributeLocations=p.attributeLocations,e.modelMatrix=k.clone(p.modelMatrix,e.modelMatrix),e._pickOffsets=p.pickOffsets,e._offsetInstanceExtend=p.offsetInstanceExtend,e._instanceBoundingSpheres=p.boundingSpheres,e._instanceBoundingSpheresCV=p.boundingSpheresCV,c(e._geometries)&&e._geometries.length>0?(e._recomputeBoundingSpheres=!0,e._state=Hr.COMBINED):zE(e,t,Hr.FAILED,void 0)}).catch(function(d){zE(e,t,Hr.FAILED,d)})}}function iIe(e,t){let n=Array.isArray(e.geometryInstances)?e.geometryInstances:[e.geometryInstances],i=e._numberOfInstances=n.length,o=new Array(i),r=e._instanceIds,s,a,l=0;for(a=0;a<i;a++){s=n[a];let p=s.geometry,g;c(p.attributes)&&c(p.primitiveType)?g=KPe(p):g=p.constructor.createGeometry(p),o[l++]=$Pe(s,g),r.push(s.id)}o.length=l;let u=t.scene3DOnly,f=t.mapProjection,d=VE.combineGeometry({instances:o,ellipsoid:f.ellipsoid,projection:f,elementIndexUintSupported:t.context.elementIndexUint,scene3DOnly:u,vertexCacheOptimize:e.vertexCacheOptimize,compressVertices:e.compressVertices,modelMatrix:e.modelMatrix,createPickOffsets:e._createPickOffsets});e._geometries=d.geometries,e._attributeLocations=d.attributeLocations,e.modelMatrix=k.clone(d.modelMatrix,e.modelMatrix),e._pickOffsets=d.pickOffsets,e._offsetInstanceExtend=d.offsetInstanceExtend,e._instanceBoundingSpheres=d.boundingSpheres,e._instanceBoundingSpheresCV=d.boundingSpheresCV,c(e._geometries)&&e._geometries.length>0?(e._recomputeBoundingSpheres=!0,e._state=Hr.COMBINED):zE(e,t,Hr.FAILED,void 0)}function oIe(e,t){let n=e._batchTableAttributeIndices.offset;if(!e._recomputeBoundingSpheres||!c(n)){e._recomputeBoundingSpheres=!1;return}let i,o=e._offsetInstanceExtend,r=e._instanceBoundingSpheres,s=r.length,a=e._tempBoundingSpheres;if(!c(a)){for(a=new Array(s),i=0;i<s;i++)a[i]=new ce;e._tempBoundingSpheres=a}for(i=0;i<s;++i){let b=a[i],x=e._batchTable.getBatchedAttribute(i,n,new h);b=r[i].clone(b),Eee(b,x,o[i])}let l=[],u=[],f=[];for(i=0;i<s;++i){let b=a[i];b.center.x-b.radius>0||ce.intersectPlane(b,un.ORIGIN_ZX_PLANE)!==qt.INTERSECTING?l.push(b):(u.push(b),f.push(b))}let d=l[0],p=f[0],g=u[0];for(i=1;i<l.length;i++)d=ce.union(d,l[i]);for(i=1;i<f.length;i++)p=ce.union(p,f[i]);for(i=1;i<u.length;i++)g=ce.union(g,u[i]);let m=[];for(c(d)&&m.push(d),c(p)&&m.push(p),c(g)&&m.push(g),i=0;i<m.length;i++){let b=m[i].clone(e._boundingSpheres[i]);e._boundingSpheres[i]=b,e._boundingSphereCV[i]=ce.projectTo2D(b,t.mapProjection,e._boundingSphereCV[i])}mr._updateBoundingVolumes(e,t,e.modelMatrix,!0),e._recomputeBoundingSpheres=!1}var pee=new Gn,Tee=new he,Aee=new h,Cee=new ce;function rIe(e,t){if(!c(e._batchTableAttributeIndices.distanceDisplayCondition)||e._batchTableBoundingSpheresUpdated)return;let i=e._batchTableBoundingSphereAttributeIndices,o=i.center3DHigh,r=i.center3DLow,s=i.center2DHigh,a=i.center2DLow,l=i.radius,u=t.mapProjection,f=u.ellipsoid,d=e._batchTable,p=e._instanceBoundingSpheres,g=p.length;for(let m=0;m<g;++m){let b=p[m];if(!c(b))continue;let x=e.modelMatrix;c(x)&&(b=ce.transform(b,x,Cee));let T=b.center,C=b.radius,S=Gn.fromCartesian(T,pee);if(d.setBatchedAttribute(m,o,S.high),d.setBatchedAttribute(m,r,S.low),!t.scene3DOnly){let v=f.cartesianToCartographic(T,Tee),D=u.project(v,Aee);S=Gn.fromCartesian(D,pee),d.setBatchedAttribute(m,s,S.high),d.setBatchedAttribute(m,a,S.low)}d.setBatchedAttribute(m,l,C)}e._batchTableBoundingSpheresUpdated=!0}var QV=new h,sIe=new h;function _ee(e,t){if(!c(e._batchTableAttributeIndices.offset)||e._batchTableOffsetsUpdated||t.scene3DOnly)return;let i=e._batchTableOffsetAttribute2DIndex,o=t.mapProjection,r=o.ellipsoid,s=e._batchTable,a=e._instanceBoundingSpheres,l=a.length;for(let u=0;u<l;++u){let f=a[u];if(!c(f))continue;let d=s.getBatchedAttribute(u,e._batchTableAttributeIndices.offset);if(h.equals(d,h.ZERO)){s.setBatchedAttribute(u,i,h.ZERO);continue}let p=e.modelMatrix;c(p)&&(f=ce.transform(f,p,Cee));let g=f.center;g=r.scaleToGeodeticSurface(g,sIe);let m=r.cartesianToCartographic(g,Tee),b=o.project(m,Aee),x=h.add(d,g,QV);m=r.cartesianToCartographic(x,m);let T=o.project(m,QV),C=h.subtract(T,b,QV),S=C.x;C.x=C.z,C.z=C.y,C.y=S,s.setBatchedAttribute(u,i,C)}e._batchTableOffsetsUpdated=!0}function aIe(e,t){let n=e._attributeLocations,i=e._geometries,o=t.scene3DOnly,r=t.context,s=[],a=i.length;for(let l=0;l<a;++l){let u=i[l];if(s.push(ni.fromGeometry({context:r,geometry:u,attributeLocations:n,bufferUsage:ke.STATIC_DRAW,interleave:e._interleave})),c(e._createBoundingVolumeFunction))e._createBoundingVolumeFunction(t,u);else if(e._boundingSpheres.push(ce.clone(u.boundingSphere)),e._boundingSphereWC.push(new ce),!o){let f=u.boundingSphereCV.center,d=f.x,p=f.y,g=f.z;f.x=g,f.y=d,f.z=p,e._boundingSphereCV.push(ce.clone(u.boundingSphereCV)),e._boundingSphere2D.push(new ce),e._boundingSphereMorph.push(new ce)}}e._va=s,e._primitiveType=i[0].primitiveType,e.releaseGeometryInstances&&(e.geometryInstances=void 0),e._geometries=void 0,zE(e,t,Hr.COMPLETE,void 0)}function cIe(e,t,n,i){let o=n.getRenderState(),r;i?(r=qe(o,!1),r.cull={enabled:!0,face:xi.BACK},e._frontFaceRS=ze.fromCache(r),r.cull.face=xi.FRONT,e._backFaceRS=ze.fromCache(r)):(e._frontFaceRS=ze.fromCache(o),e._backFaceRS=e._frontFaceRS),r=qe(o,!1),c(e._depthFailAppearance)&&(r.depthTest.enabled=!1),c(e._depthFailAppearance)&&(o=e._depthFailAppearance.getRenderState(),r=qe(o,!1),r.depthTest.func=Kc.GREATER,i?(r.cull={enabled:!0,face:xi.BACK},e._frontFaceDepthFailRS=ze.fromCache(r),r.cull.face=xi.FRONT,e._backFaceDepthFailRS=ze.fromCache(r)):(e._frontFaceDepthFailRS=ze.fromCache(r),e._backFaceDepthFailRS=e._frontFaceRS))}function lIe(e,t,n){let i=t.context,o=e._attributeLocations,r=e._batchTable.getVertexShaderCallback()(n.vertexShaderSource);r=mr._appendOffsetToShader(e,r),r=mr._appendShowToShader(e,r),r=mr._appendDistanceDisplayConditionToShader(e,r,t.scene3DOnly),r=fee(r),r=mr._updateColorAttribute(e,r,!1),r=hee(e,r),r=mr._modifyShaderPosition(e,r,t.scene3DOnly);let s=n.getFragmentShaderSource();s=dee(s),e._sp=an.replaceCache({context:i,shaderProgram:e._sp,vertexShaderSource:r,fragmentShaderSource:s,attributeLocations:o}),mee(e._sp,o),c(e._depthFailAppearance)&&(r=e._batchTable.getVertexShaderCallback()(e._depthFailAppearance.vertexShaderSource),r=mr._appendShowToShader(e,r),r=mr._appendDistanceDisplayConditionToShader(e,r,t.scene3DOnly),r=fee(r),r=mr._updateColorAttribute(e,r,!0),r=hee(e,r),r=mr._modifyShaderPosition(e,r,t.scene3DOnly),r=JPe(r),s=e._depthFailAppearance.getFragmentShaderSource(),s=dee(s),s=QPe(s),e._spDepthFail=an.replaceCache({context:i,shaderProgram:e._spDepthFail,vertexShaderSource:r,fragmentShaderSource:s,attributeLocations:o}),mee(e._spDepthFail,o))}var UE=new k,gee=new h;function yee(e,t,n,i){let o=c(n)?n._uniforms:void 0,r={},s=t.uniforms;if(c(s)){for(let l in s)if(s.hasOwnProperty(l)){if(c(o)&&c(o[l]))throw new E(`Appearance and material have a uniform with the same name: ${l}`);r[l]=eIe(s,l)}}let a=At(r,o);return a=e._batchTable.getUniformMapCallback()(a),c(e.rtcCenter)&&(a.u_modifiedModelView=function(){let l=i.context.uniformState.view;return k.multiply(l,e._modelMatrix,UE),k.multiplyByPoint(UE,e.rtcCenter,gee),k.setTranslation(UE,gee,UE),UE}),a}function uIe(e,t,n,i,o,r,s,a){let l=yee(e,t,n,a),u;c(e._depthFailAppearance)&&(u=yee(e,e._depthFailAppearance,e._depthFailAppearance.material,a));let f=i?ve.TRANSLUCENT:ve.OPAQUE,d=o?2:1;d*=c(e._depthFailAppearance)?2:1,r.length=e._va.length*d;let p=r.length,g=0;for(let m=0;m<p;++m){let b;o&&(b=r[m],c(b)||(b=r[m]=new et({owner:e,primitiveType:e._primitiveType})),b.vertexArray=e._va[g],b.renderState=e._backFaceRS,b.shaderProgram=e._sp,b.uniformMap=l,b.pass=f,++m),b=r[m],c(b)||(b=r[m]=new et({owner:e,primitiveType:e._primitiveType})),b.vertexArray=e._va[g],b.renderState=e._frontFaceRS,b.shaderProgram=e._sp,b.uniformMap=l,b.pass=f,c(e._depthFailAppearance)&&(o&&(++m,b=r[m],c(b)||(b=r[m]=new et({owner:e,primitiveType:e._primitiveType})),b.vertexArray=e._va[g],b.renderState=e._backFaceDepthFailRS,b.shaderProgram=e._spDepthFail,b.uniformMap=u,b.pass=f),++m,b=r[m],c(b)||(b=r[m]=new et({owner:e,primitiveType:e._primitiveType})),b.vertexArray=e._va[g],b.renderState=e._frontFaceDepthFailRS,b.shaderProgram=e._spDepthFail,b.uniformMap=u,b.pass=f),++g}}mr._updateBoundingVolumes=function(e,t,n,i){let o,r,s;if(i||!k.equals(n,e._modelMatrix))for(k.clone(n,e._modelMatrix),r=e._boundingSpheres.length,o=0;o<r;++o)s=e._boundingSpheres[o],c(s)&&(e._boundingSphereWC[o]=ce.transform(s,n,e._boundingSphereWC[o]),t.scene3DOnly||(e._boundingSphere2D[o]=ce.clone(e._boundingSphereCV[o],e._boundingSphere2D[o]),e._boundingSphere2D[o].center.x=0,e._boundingSphereMorph[o]=ce.union(e._boundingSphereWC[o],e._boundingSphereCV[o])));let a=e.appearance.pixelSize;if(c(a))for(r=e._boundingSpheres.length,o=0;o<r;++o){s=e._boundingSpheres[o];let l=e._boundingSphereWC[o],f=t.camera.getPixelSize(s,t.context.drawingBufferWidth,t.context.drawingBufferHeight)*a;l.radius=s.radius+f}};function fIe(e,t,n,i,o,r,s,a){if(t.mode!==oe.SCENE3D&&!k.equals(o,k.IDENTITY))throw new E("Primitive.modelMatrix is only supported in 3D mode.");mr._updateBoundingVolumes(e,t,o);let l;t.mode===oe.SCENE3D?l=e._boundingSphereWC:t.mode===oe.COLUMBUS_VIEW?l=e._boundingSphereCV:t.mode===oe.SCENE2D&&c(e._boundingSphere2D)?l=e._boundingSphere2D:c(e._boundingSphereMorph)&&(l=e._boundingSphereMorph);let u=t.commandList,f=t.passes;if(f.render||f.pick){let d=e.allowPicking,p=En.castShadows(e.shadows),g=En.receiveShadows(e.shadows),m=n.length,b=a?2:1;b*=c(e._depthFailAppearance)?2:1;for(let x=0;x<m;++x){let T=Math.floor(x/b),C=n[x];C.modelMatrix=o,C.boundingVolume=l[T],C.cull=r,C.debugShowBoundingVolume=s,C.castShadows=p,C.receiveShadows=g,d?C.pickId="v_pickColor":C.pickId=void 0,u.push(C)}}}mr.prototype.update=function(e){if(!c(this.geometryInstances)&&this._va.length===0||c(this.geometryInstances)&&Array.isArray(this.geometryInstances)&&this.geometryInstances.length===0||!c(this.appearance)||e.mode!==oe.SCENE3D&&e.scene3DOnly||!e.passes.render&&!e.passes.pick)return;if(c(this._error))throw this._error;if(c(this.rtcCenter)&&!e.scene3DOnly)throw new E("RTC rendering is only available for 3D only scenes.");if(this._state===Hr.FAILED)return;let t=e.context;if(c(this._batchTable)||YPe(this,t),this._batchTable.attributes.length>0){if(mt.maximumVertexTextureImageUnits===0)throw new ue("Vertex texture fetch support is required to render primitives with per-instance attributes. The maximum number of vertex texture image units must be greater than zero.");this._batchTable.update(e)}if(this._state!==Hr.COMPLETE&&this._state!==Hr.COMBINED&&(this.asynchronous?nIe(this,e):iIe(this,e)),this._state===Hr.COMBINED&&(rIe(this,e),_ee(this,e),aIe(this,e)),!this.show||this._state!==Hr.COMPLETE)return;this._batchTableOffsetsUpdated||_ee(this,e),this._recomputeBoundingSpheres&&oIe(this,e);let n=this.appearance,i=n.material,o=!1,r=!1;this._appearance!==n?(this._appearance=n,this._material=i,o=!0,r=!0):this._material!==i&&(this._material=i,r=!0);let s=this.depthFailAppearance,a=c(s)?s.material:void 0;this._depthFailAppearance!==s?(this._depthFailAppearance=s,this._depthFailMaterial=a,o=!0,r=!0):this._depthFailMaterial!==a&&(this._depthFailMaterial=a,r=!0);let l=this._appearance.isTranslucent();this._translucent!==l&&(this._translucent=l,o=!0),c(this._material)&&this._material.update(t);let u=n.closed&&l;o&&y(this._createRenderStatesFunction,cIe)(this,t,n,u),r&&y(this._createShaderProgramFunction,lIe)(this,e,n),(o||r)&&y(this._createCommandsFunction,uIe)(this,n,i,l,u,this._colorCommands,this._pickCommands,e),y(this._updateAndQueueCommandsFunction,fIe)(this,e,this._colorCommands,this._pickCommands,this.modelMatrix,this.cull,this.debugShowBoundingVolume,u)};var dIe=new ce,hIe=new ce;function Eee(e,t,n){if(n===Jt.TOP){let i=ce.clone(e,dIe),o=ce.clone(e,hIe);o.center=h.add(o.center,t,o.center),e=ce.union(i,o,e)}else n===Jt.ALL&&(e.center=h.add(e.center,t,e.center));return e}function mIe(e,t,n){return function(){let i=e.getBatchedAttribute(t,n),o=e.attributes[n],r=o.componentsPerAttribute,s=$.createTypedArray(o.componentDatatype,r);return c(i.constructor.pack)?i.constructor.pack(i,s,0):s[0]=i,s}}function pIe(e,t,n,i,o){return function(r){if(!c(r)||!c(r.length)||r.length<1||r.length>4)throw new E("value must be and array with length between 1 and 4.");let s=xee(r);e.setBatchedAttribute(t,n,s),o==="offset"&&(i._recomputeBoundingSpheres=!0,i._batchTableOffsetsUpdated=!1)}}var _Ie=new h;function gIe(e,t,n){t.boundingSphere={get:function(){let i=e._instanceBoundingSpheres[n];if(c(i)){i=i.clone();let o=e.modelMatrix,r=t.offset;c(r)&&Eee(i,h.fromArray(r.get(),0,_Ie),e._offsetInstanceExtend[n]),c(o)&&(i=ce.transform(i,o))}return i}},t.boundingSphereCV={get:function(){return e._instanceBoundingSpheresCV[n]}}}function yIe(e,t,n){t.pickId={get:function(){return e._pickIds[n]}}}mr.prototype.getGeometryInstanceAttributes=function(e){if(!c(e))throw new E("id is required");if(!c(this._batchTable))throw new E("must call update before calling getGeometryInstanceAttributes");let t=this._perInstanceAttributeCache.get(e);if(c(t))return t;let n=-1,i=this._lastPerInstanceAttributeIndex,o=this._instanceIds,r=o.length;for(let u=0;u<r;++u){let f=(i+u)%r;if(e===o[f]){n=f;break}}if(n===-1)return;let s=this._batchTable,a=this._batchTableAttributeIndices;t={};let l={};for(let u in a)if(a.hasOwnProperty(u)){let f=a[u];l[u]={get:mIe(s,n,f),set:pIe(s,n,f,this,u)}}return gIe(this,l,n),yIe(this,l,n),Object.defineProperties(t,l),this._lastPerInstanceAttributeIndex=n,this._perInstanceAttributeCache.set(e,t),t};mr.prototype.isDestroyed=function(){return!1};mr.prototype.destroy=function(){let e,t;this._sp=this._sp&&this._sp.destroy(),this._spDepthFail=this._spDepthFail&&this._spDepthFail.destroy();let n=this._va;for(e=n.length,t=0;t<e;++t)n[t].destroy();this._va=void 0;let i=this._pickIds;for(e=i.length,t=0;t<e;++t)i[t].destroy();return this._pickIds=void 0,this._batchTable=this._batchTable&&this._batchTable.destroy(),this._instanceIds=void 0,this._perInstanceAttributeCache=void 0,this._attributeLocations=void 0,de(this)};function zE(e,t,n,i){e._error=i,e._state=n,t.afterRender.push(function(){e._ready=e._state===Hr.COMPLETE||e._state===Hr.FAILED})}var Rn=mr;function bIe(e){if(e=y(e,y.EMPTY_OBJECT),!c(e.componentDatatype))throw new E("options.componentDatatype is required.");if(!c(e.componentsPerAttribute))throw new E("options.componentsPerAttribute is required.");if(e.componentsPerAttribute<1||e.componentsPerAttribute>4)throw new E("options.componentsPerAttribute must be between 1 and 4.");if(!c(e.value))throw new E("options.value is required.");this.componentDatatype=e.componentDatatype,this.componentsPerAttribute=e.componentsPerAttribute,this.normalize=y(e.normalize,!1),this.value=e.value}var Zc=bIe;var XI=`#ifdef TEXTURE_COORDINATES
#ifdef SPHERICAL
in vec4 v_sphericalExtents;
#else // SPHERICAL
in vec2 v_inversePlaneExtents;
in vec4 v_westPlane;
in vec4 v_southPlane;
#endif // SPHERICAL
in vec3 v_uvMinAndSphericalLongitudeRotation;
in vec3 v_uMaxAndInverseDistance;
in vec3 v_vMaxAndInverseDistance;
#endif // TEXTURE_COORDINATES
#ifdef PER_INSTANCE_COLOR
in vec4 v_color;
#endif
#ifdef NORMAL_EC
vec3 getEyeCoordinate3FromWindowCoordinate(vec2 fragCoord, float logDepthOrDepth) {
vec4 eyeCoordinate = czm_windowToEyeCoordinates(fragCoord, logDepthOrDepth);
return eyeCoordinate.xyz / eyeCoordinate.w;
}
vec3 vectorFromOffset(vec4 eyeCoordinate, vec2 positiveOffset) {
vec2 glFragCoordXY = gl_FragCoord.xy;
float upOrRightLogDepth = czm_unpackDepth(texture(czm_globeDepthTexture, (glFragCoordXY + positiveOffset) / czm_viewport.zw));
float downOrLeftLogDepth = czm_unpackDepth(texture(czm_globeDepthTexture, (glFragCoordXY - positiveOffset) / czm_viewport.zw));
bvec2 upOrRightInBounds = lessThan(glFragCoordXY + positiveOffset, czm_viewport.zw);
float useUpOrRight = float(upOrRightLogDepth > 0.0 && upOrRightInBounds.x && upOrRightInBounds.y);
float useDownOrLeft = float(useUpOrRight == 0.0);
vec3 upOrRightEC = getEyeCoordinate3FromWindowCoordinate(glFragCoordXY + positiveOffset, upOrRightLogDepth);
vec3 downOrLeftEC = getEyeCoordinate3FromWindowCoordinate(glFragCoordXY - positiveOffset, downOrLeftLogDepth);
return (upOrRightEC - (eyeCoordinate.xyz / eyeCoordinate.w)) * useUpOrRight + ((eyeCoordinate.xyz / eyeCoordinate.w) - downOrLeftEC) * useDownOrLeft;
}
#endif // NORMAL_EC
void main(void)
{
#ifdef REQUIRES_EC
float logDepthOrDepth = czm_unpackDepth(texture(czm_globeDepthTexture, gl_FragCoord.xy / czm_viewport.zw));
vec4 eyeCoordinate = czm_windowToEyeCoordinates(gl_FragCoord.xy, logDepthOrDepth);
#endif
#ifdef REQUIRES_WC
vec4 worldCoordinate4 = czm_inverseView * eyeCoordinate;
vec3 worldCoordinate = worldCoordinate4.xyz / worldCoordinate4.w;
#endif
#ifdef TEXTURE_COORDINATES
vec2 uv;
#ifdef SPHERICAL
vec2 sphericalLatLong = czm_approximateSphericalCoordinates(worldCoordinate);
sphericalLatLong.y += v_uvMinAndSphericalLongitudeRotation.z;
sphericalLatLong.y = czm_branchFreeTernary(sphericalLatLong.y < czm_pi, sphericalLatLong.y, sphericalLatLong.y - czm_twoPi);
uv.x = (sphericalLatLong.y - v_sphericalExtents.y) * v_sphericalExtents.w;
uv.y = (sphericalLatLong.x - v_sphericalExtents.x) * v_sphericalExtents.z;
#else // SPHERICAL
uv.x = czm_planeDistance(v_westPlane, eyeCoordinate.xyz / eyeCoordinate.w) * v_inversePlaneExtents.x;
uv.y = czm_planeDistance(v_southPlane, eyeCoordinate.xyz / eyeCoordinate.w) * v_inversePlaneExtents.y;
#endif // SPHERICAL
#endif // TEXTURE_COORDINATES
#ifdef PICK
#ifdef CULL_FRAGMENTS
if (0.0 <= uv.x && uv.x <= 1.0 && 0.0 <= uv.y && uv.y <= 1.0 || logDepthOrDepth != 0.0) {
out_FragColor.a = 1.0;
czm_writeDepthClamp();
}
#else // CULL_FRAGMENTS
out_FragColor.a = 1.0;
#endif // CULL_FRAGMENTS
#else // PICK
#ifdef CULL_FRAGMENTS
if (uv.x <= 0.0 || 1.0 <= uv.x || uv.y <= 0.0 || 1.0 <= uv.y || logDepthOrDepth == 0.0) {
discard;
}
#endif
#ifdef NORMAL_EC
vec3 downUp = vectorFromOffset(eyeCoordinate, vec2(0.0, 1.0));
vec3 leftRight = vectorFromOffset(eyeCoordinate, vec2(1.0, 0.0));
vec3 normalEC = normalize(cross(leftRight, downUp));
#endif
#ifdef PER_INSTANCE_COLOR
vec4 color = czm_gammaCorrect(v_color);
#ifdef FLAT
out_FragColor = color;
#else // FLAT
czm_materialInput materialInput;
materialInput.normalEC = normalEC;
materialInput.positionToEyeEC = -eyeCoordinate.xyz;
czm_material material = czm_getDefaultMaterial(materialInput);
material.diffuse = color.rgb;
material.alpha = color.a;
out_FragColor = czm_phong(normalize(-eyeCoordinate.xyz), material, czm_lightDirectionEC);
#endif // FLAT
out_FragColor.rgb *= out_FragColor.a;
#else // PER_INSTANCE_COLOR
czm_materialInput materialInput;
#ifdef USES_NORMAL_EC
materialInput.normalEC = normalEC;
#endif
#ifdef USES_POSITION_TO_EYE_EC
materialInput.positionToEyeEC = -eyeCoordinate.xyz;
#endif
#ifdef USES_TANGENT_TO_EYE
materialInput.tangentToEyeMatrix = czm_eastNorthUpToEyeCoordinates(worldCoordinate, normalEC);
#endif
#ifdef USES_ST
materialInput.st.x = czm_lineDistance(v_uvMinAndSphericalLongitudeRotation.xy, v_uMaxAndInverseDistance.xy, uv) * v_uMaxAndInverseDistance.z;
materialInput.st.y = czm_lineDistance(v_uvMinAndSphericalLongitudeRotation.xy, v_vMaxAndInverseDistance.xy, uv) * v_vMaxAndInverseDistance.z;
#endif
czm_material material = czm_getMaterial(materialInput);
#ifdef FLAT
out_FragColor = vec4(material.diffuse + material.emission, material.alpha);
#else // FLAT
out_FragColor = czm_phong(normalize(-eyeCoordinate.xyz), material, czm_lightDirectionEC);
#endif // FLAT
out_FragColor.rgb *= out_FragColor.a;
#endif // PER_INSTANCE_COLOR
czm_writeDepthClamp();
#endif // PICK
}
`;function Bu(e,t,n){A.typeOf.bool("extentsCulling",e),A.typeOf.bool("planarExtents",t),A.typeOf.object("appearance",n),this._projectionExtentDefines={eastMostYhighDefine:"",eastMostYlowDefine:"",westMostYhighDefine:"",westMostYlowDefine:""};let i=new eU;i.requiresTextureCoordinates=e,i.requiresEC=!n.flat;let o=new eU;if(o.requiresTextureCoordinates=e,n instanceof ln)i.requiresNormalEC=!n.flat;else{let r=`${n.material.shaderSource}
${n.fragmentShaderSource}`;i.normalEC=r.indexOf("materialInput.normalEC")!==-1||r.indexOf("czm_getDefaultMaterial")!==-1,i.positionToEyeEC=r.indexOf("materialInput.positionToEyeEC")!==-1,i.tangentToEyeMatrix=r.indexOf("materialInput.tangentToEyeMatrix")!==-1,i.st=r.indexOf("materialInput.st")!==-1}this._colorShaderDependencies=i,this._pickShaderDependencies=o,this._appearance=n,this._extentsCulling=e,this._planarExtents=t}Bu.prototype.createFragmentShader=function(e){A.typeOf.bool("columbusView2D",e);let t=this._appearance,n=this._colorShaderDependencies,i=[];!e&&!this._planarExtents&&i.push("SPHERICAL"),n.requiresEC&&i.push("REQUIRES_EC"),n.requiresWC&&i.push("REQUIRES_WC"),n.requiresTextureCoordinates&&i.push("TEXTURE_COORDINATES"),this._extentsCulling&&i.push("CULL_FRAGMENTS"),n.requiresNormalEC&&i.push("NORMAL_EC"),t instanceof ln&&i.push("PER_INSTANCE_COLOR"),n.normalEC&&i.push("USES_NORMAL_EC"),n.positionToEyeEC&&i.push("USES_POSITION_TO_EYE_EC"),n.tangentToEyeMatrix&&i.push("USES_TANGENT_TO_EYE"),n.st&&i.push("USES_ST"),t.flat&&i.push("FLAT");let o="";return t instanceof ln||(o=t.material.shaderSource),new Ge({defines:i,sources:[o,XI]})};Bu.prototype.createPickFragmentShader=function(e){A.typeOf.bool("columbusView2D",e);let t=this._pickShaderDependencies,n=["PICK"];return!e&&!this._planarExtents&&n.push("SPHERICAL"),t.requiresEC&&n.push("REQUIRES_EC"),t.requiresWC&&n.push("REQUIRES_WC"),t.requiresTextureCoordinates&&n.push("TEXTURE_COORDINATES"),this._extentsCulling&&n.push("CULL_FRAGMENTS"),new Ge({defines:n,sources:[XI],pickColorQualifier:"in"})};Bu.prototype.createVertexShader=function(e,t,n,i){return A.defined("defines",e),A.typeOf.string("vertexShaderSource",t),A.typeOf.bool("columbusView2D",n),A.defined("mapProjection",i),Ree(this._colorShaderDependencies,this._planarExtents,n,e,t,this._appearance,i,this._projectionExtentDefines)};Bu.prototype.createPickVertexShader=function(e,t,n,i){return A.defined("defines",e),A.typeOf.string("vertexShaderSource",t),A.typeOf.bool("columbusView2D",n),A.defined("mapProjection",i),Ree(this._pickShaderDependencies,this._planarExtents,n,e,t,void 0,i,this._projectionExtentDefines)};var See=new h,wee=new he,vee={high:0,low:0};function Ree(e,t,n,i,o,r,s,a){let l=i.slice();if(a.eastMostYhighDefine===""){let u=wee;u.longitude=R.PI,u.latitude=0,u.height=0;let f=s.project(u,See),d=Gn.encode(f.x,vee);a.eastMostYhighDefine=`EAST_MOST_X_HIGH ${d.high.toFixed(`${d.high}`.length+1)}`,a.eastMostYlowDefine=`EAST_MOST_X_LOW ${d.low.toFixed(`${d.low}`.length+1)}`;let p=wee;p.longitude=-R.PI,p.latitude=0,p.height=0;let g=s.project(p,See);d=Gn.encode(g.x,vee),a.westMostYhighDefine=`WEST_MOST_X_HIGH ${d.high.toFixed(`${d.high}`.length+1)}`,a.westMostYlowDefine=`WEST_MOST_X_LOW ${d.low.toFixed(`${d.low}`.length+1)}`}return n&&(l.push(a.eastMostYhighDefine),l.push(a.eastMostYlowDefine),l.push(a.westMostYhighDefine),l.push(a.westMostYlowDefine)),c(r)&&r instanceof ln&&l.push("PER_INSTANCE_COLOR"),e.requiresTextureCoordinates&&(l.push("TEXTURE_COORDINATES"),t||n||l.push("SPHERICAL"),n&&l.push("COLUMBUS_VIEW_2D")),new Ge({defines:l,sources:[o]})}function eU(){this._requiresEC=!1,this._requiresWC=!1,this._requiresNormalEC=!1,this._requiresTextureCoordinates=!1,this._usesNormalEC=!1,this._usesPositionToEyeEC=!1,this._usesTangentToEyeMat=!1,this._usesSt=!1}Object.defineProperties(eU.prototype,{requiresEC:{get:function(){return this._requiresEC},set:function(e){this._requiresEC=e||this._requiresEC}},requiresWC:{get:function(){return this._requiresWC},set:function(e){this._requiresWC=e||this._requiresWC,this.requiresEC=this._requiresWC}},requiresNormalEC:{get:function(){return this._requiresNormalEC},set:function(e){this._requiresNormalEC=e||this._requiresNormalEC,this.requiresEC=this._requiresNormalEC}},requiresTextureCoordinates:{get:function(){return this._requiresTextureCoordinates},set:function(e){this._requiresTextureCoordinates=e||this._requiresTextureCoordinates,this.requiresWC=this._requiresTextureCoordinates}},normalEC:{set:function(e){this.requiresNormalEC=e,this._usesNormalEC=e},get:function(){return this._usesNormalEC}},tangentToEyeMatrix:{set:function(e){this.requiresWC=e,this.requiresNormalEC=e,this._usesTangentToEyeMat=e},get:function(){return this._usesTangentToEyeMat}},positionToEyeEC:{set:function(e){this.requiresEC=e,this._usesPositionToEyeEC=e},get:function(){return this._usesPositionToEyeEC}},st:{set:function(e){this.requiresTextureCoordinates=e,this._usesSt=e},get:function(){return this._usesSt}}});function Dee(e,t,n){return Math.abs((t.y-e.y)*n.x-(t.x-e.x)*n.y+t.x*e.y-t.y*e.x)/H.distance(t,e)}var xIe=[new H,new H,new H,new H];function Mee(e,t){let n=xIe,i=H.unpack(t,0,n[0]),o=H.unpack(t,2,n[1]),r=H.unpack(t,4,n[2]);e.uMaxVmax=new Zc({componentDatatype:$.FLOAT,componentsPerAttribute:4,normalize:!1,value:[o.x,o.y,r.x,r.y]});let s=1/Dee(i,o,r),a=1/Dee(i,r,o);e.uvMinAndExtents=new Zc({componentDatatype:$.FLOAT,componentsPerAttribute:4,normalize:!1,value:[i.x,i.y,s,a]})}var Lee=new he,Nee=new h,TIe=new h,AIe=new h,KI={high:0,low:0};function Fee(e,t,n){let i=Lee;i.height=0,i.longitude=e.west,i.latitude=e.south;let o=t.project(i,Nee);i.latitude=e.north;let r=t.project(i,TIe);i.longitude=e.east,i.latitude=e.south;let s=t.project(i,AIe),a=[0,0,0,0],l=[0,0,0,0],u=Gn.encode(o.x,KI);a[0]=u.high,l[0]=u.low,u=Gn.encode(o.y,KI),a[1]=u.high,l[1]=u.low,u=Gn.encode(r.y,KI),a[2]=u.high,l[2]=u.low,u=Gn.encode(s.x,KI),a[3]=u.high,l[3]=u.low,n.planes2D_HIGH=new Zc({componentDatatype:$.FLOAT,componentsPerAttribute:4,normalize:!1,value:a}),n.planes2D_LOW=new Zc({componentDatatype:$.FLOAT,componentsPerAttribute:4,normalize:!1,value:l})}var CIe=new k,EIe=new k,Pee=new h,SIe=new he,wIe=[new he,new he,new he,new he,new he,new he,new he,new he];function vIe(e,t,n,i,o,r){let s=ae.center(e,SIe);s.height=n;let a=he.toCartesian(s,t,Pee),l=Ft.eastNorthUpToFixedFrame(a,t,CIe),u=k.inverse(l,EIe),f=e.west,d=e.east,p=e.north,g=e.south,m=wIe;m[0].latitude=g,m[0].longitude=f,m[1].latitude=p,m[1].longitude=f,m[2].latitude=p,m[2].longitude=d,m[3].latitude=g,m[3].longitude=d;let b=(f+d)*.5,x=(p+g)*.5;m[4].latitude=g,m[4].longitude=b,m[5].latitude=p,m[5].longitude=b,m[6].latitude=x,m[6].longitude=f,m[7].latitude=x,m[7].longitude=d;let T=Number.POSITIVE_INFINITY,C=Number.NEGATIVE_INFINITY,S=Number.POSITIVE_INFINITY,v=Number.NEGATIVE_INFINITY;for(let M=0;M<8;M++){m[M].height=n;let N=he.toCartesian(m[M],t,Pee);k.multiplyByPoint(u,N,N),N.z=0,T=Math.min(T,N.x),C=Math.max(C,N.x),S=Math.min(S,N.y),v=Math.max(v,N.y)}let D=i;D.x=T,D.y=S,D.z=0,k.multiplyByPoint(l,D,D);let I=o;I.x=C,I.y=S,I.z=0,k.multiplyByPoint(l,I,I),h.subtract(I,D,o);let L=r;L.x=T,L.y=v,L.z=0,k.multiplyByPoint(l,L,L),h.subtract(L,D,r)}var DIe=new h,PIe=new h,IIe=new Gn;Bu.getPlanarTextureCoordinateAttributes=function(e,t,n,i,o){A.typeOf.object("boundingRectangle",e),A.defined("textureCoordinateRotationPoints",t),A.typeOf.object("ellipsoid",n),A.typeOf.object("projection",i);let r=Nee,s=DIe,a=PIe;vIe(e,n,y(o,0),r,s,a);let l={};Mee(l,t);let u=Gn.fromCartesian(r,IIe);return l.southWest_HIGH=new Zc({componentDatatype:$.FLOAT,componentsPerAttribute:3,normalize:!1,value:h.pack(u.high,[0,0,0])}),l.southWest_LOW=new Zc({componentDatatype:$.FLOAT,componentsPerAttribute:3,normalize:!1,value:h.pack(u.low,[0,0,0])}),l.eastward=new Zc({componentDatatype:$.FLOAT,componentsPerAttribute:3,normalize:!1,value:h.pack(s,[0,0,0])}),l.northward=new Zc({componentDatatype:$.FLOAT,componentsPerAttribute:3,normalize:!1,value:h.pack(a,[0,0,0])}),Fee(e,i,l),l};var OIe=new h;function Iee(e,t,n,i){let o=Lee;o.latitude=e,o.longitude=t,o.height=0;let r=he.toCartesian(o,n,OIe),s=Math.sqrt(r.x*r.x+r.y*r.y),a=R.fastApproximateAtan2(s,r.z),l=R.fastApproximateAtan2(r.x,r.y);return i.x=a,i.y=l,i}var Oee=new H;Bu.getSphericalExtentGeometryInstanceAttributes=function(e,t,n,i){A.typeOf.object("boundingRectangle",e),A.defined("textureCoordinateRotationPoints",t),A.typeOf.object("ellipsoid",n),A.typeOf.object("projection",i);let o=Iee(e.south,e.west,n,Oee),r=o.x,s=o.y,a=Iee(e.north,e.east,n,Oee),l=a.x,u=a.y,f=0;s>u&&(f=R.PI-s,s=-R.PI,u+=f),r-=R.EPSILON5,s-=R.EPSILON5,l+=R.EPSILON5,u+=R.EPSILON5;let d=1/(u-s),p=1/(l-r),g={sphericalExtents:new Zc({componentDatatype:$.FLOAT,componentsPerAttribute:4,normalize:!1,value:[r,s,p,d]}),longitudeRotation:new Zc({componentDatatype:$.FLOAT,componentsPerAttribute:1,normalize:!1,value:[f]})};return Mee(g,t),Fee(e,i,g),g};Bu.hasAttributesForTextureCoordinatePlanes=function(e){return c(e.southWest_HIGH)&&c(e.southWest_LOW)&&c(e.northward)&&c(e.eastward)&&c(e.planes2D_HIGH)&&c(e.planes2D_LOW)&&c(e.uMaxVmax)&&c(e.uvMinAndExtents)};Bu.hasAttributesForSphericalExtents=function(e){return c(e.sphericalExtents)&&c(e.longitudeRotation)&&c(e.planes2D_HIGH)&&c(e.planes2D_LOW)&&c(e.uMaxVmax)&&c(e.uvMinAndExtents)};function RIe(e){return Math.max(e.width,e.height)>Bu.MAX_WIDTH_FOR_PLANAR_EXTENTS}Bu.shouldUseSphericalCoordinates=function(e){return A.typeOf.object("rectangle",e),RIe(e)};Bu.MAX_WIDTH_FOR_PLANAR_EXTENTS=R.toRadians(1);var Wf=Bu;var MIe={NEVER:ne.NEVER,LESS:ne.LESS,EQUAL:ne.EQUAL,LESS_OR_EQUAL:ne.LEQUAL,GREATER:ne.GREATER,NOT_EQUAL:ne.NOTEQUAL,GREATER_OR_EQUAL:ne.GEQUAL,ALWAYS:ne.ALWAYS},Un=Object.freeze(MIe);var LIe={ZERO:ne.ZERO,KEEP:ne.KEEP,REPLACE:ne.REPLACE,INCREMENT:ne.INCR,DECREMENT:ne.DECR,INVERT:ne.INVERT,INCREMENT_WRAP:ne.INCR_WRAP,DECREMENT_WRAP:ne.DECR_WRAP},ft=Object.freeze(LIe);var $I={CESIUM_3D_TILE_MASK:128,SKIP_LOD_MASK:112,SKIP_LOD_BIT_SHIFT:4,CLASSIFICATION_MASK:15};$I.setCesium3DTileBit=function(){return{enabled:!0,frontFunction:Un.ALWAYS,frontOperation:{fail:ft.KEEP,zFail:ft.KEEP,zPass:ft.REPLACE},backFunction:Un.ALWAYS,backOperation:{fail:ft.KEEP,zFail:ft.KEEP,zPass:ft.REPLACE},reference:$I.CESIUM_3D_TILE_MASK,mask:$I.CESIUM_3D_TILE_MASK}};var Ut=Object.freeze($I);function qy(e){e=y(e,y.EMPTY_OBJECT);let t=e.geometryInstances;this.geometryInstances=t,this.show=y(e.show,!0),this.classificationType=y(e.classificationType,Vn.BOTH),this.debugShowBoundingVolume=y(e.debugShowBoundingVolume,!1),this.debugShowShadowVolume=y(e.debugShowShadowVolume,!1),this._debugShowShadowVolume=!1,this._extruded=y(e._extruded,!1),this._uniformMap=e._uniformMap,this._sp=void 0,this._spStencil=void 0,this._spPick=void 0,this._spColor=void 0,this._spPick2D=void 0,this._spColor2D=void 0,this._rsStencilDepthPass=void 0,this._rsStencilDepthPass3DTiles=void 0,this._rsColorPass=void 0,this._rsPickPass=void 0,this._commandsIgnoreShow=[],this._ready=!1,this._primitive=void 0,this._pickPrimitive=e._pickPrimitive,this._hasSphericalExtentsAttribute=!1,this._hasPlanarExtentsAttributes=!1,this._hasPerColorAttribute=!1,this.appearance=e.appearance,this._createBoundingVolumeFunction=e._createBoundingVolumeFunction,this._updateAndQueueCommandsFunction=e._updateAndQueueCommandsFunction,this._usePickOffsets=!1,this._primitiveOptions={geometryInstances:void 0,appearance:void 0,vertexCacheOptimize:y(e.vertexCacheOptimize,!1),interleave:y(e.interleave,!1),releaseGeometryInstances:y(e.releaseGeometryInstances,!0),allowPicking:y(e.allowPicking,!0),asynchronous:y(e.asynchronous,!0),compressVertices:y(e.compressVertices,!0),_createBoundingVolumeFunction:void 0,_createRenderStatesFunction:void 0,_createShaderProgramFunction:void 0,_createCommandsFunction:void 0,_updateAndQueueCommandsFunction:void 0,_createPickOffsets:!0}}Object.defineProperties(qy.prototype,{vertexCacheOptimize:{get:function(){return this._primitiveOptions.vertexCacheOptimize}},interleave:{get:function(){return this._primitiveOptions.interleave}},releaseGeometryInstances:{get:function(){return this._primitiveOptions.releaseGeometryInstances}},allowPicking:{get:function(){return this._primitiveOptions.allowPicking}},asynchronous:{get:function(){return this._primitiveOptions.asynchronous}},compressVertices:{get:function(){return this._primitiveOptions.compressVertices}},ready:{get:function(){return this._ready}},_needs2DShader:{get:function(){return this._hasPlanarExtentsAttributes||this._hasSphericalExtentsAttribute}}});qy.isSupported=function(e){return e.context.stencilBuffer};function Yx(e,t){let n=t?Un.EQUAL:Un.ALWAYS;return{colorMask:{red:!1,green:!1,blue:!1,alpha:!1},stencilTest:{enabled:e,frontFunction:n,frontOperation:{fail:ft.KEEP,zFail:ft.DECREMENT_WRAP,zPass:ft.KEEP},backFunction:n,backOperation:{fail:ft.KEEP,zFail:ft.INCREMENT_WRAP,zPass:ft.KEEP},reference:Ut.CESIUM_3D_TILE_MASK,mask:Ut.CESIUM_3D_TILE_MASK},stencilMask:Ut.CLASSIFICATION_MASK,depthTest:{enabled:!0,func:Kc.LESS_OR_EQUAL},depthMask:!1}}function nU(e){return{stencilTest:{enabled:e,frontFunction:Un.NOT_EQUAL,frontOperation:{fail:ft.ZERO,zFail:ft.ZERO,zPass:ft.ZERO},backFunction:Un.NOT_EQUAL,backOperation:{fail:ft.ZERO,zFail:ft.ZERO,zPass:ft.ZERO},reference:0,mask:Ut.CLASSIFICATION_MASK},stencilMask:Ut.CLASSIFICATION_MASK,depthTest:{enabled:!1},depthMask:!1,blending:hn.PRE_MULTIPLIED_ALPHA_BLEND}}var NIe={stencilTest:{enabled:!0,frontFunction:Un.NOT_EQUAL,frontOperation:{fail:ft.ZERO,zFail:ft.ZERO,zPass:ft.ZERO},backFunction:Un.NOT_EQUAL,backOperation:{fail:ft.ZERO,zFail:ft.ZERO,zPass:ft.ZERO},reference:0,mask:Ut.CLASSIFICATION_MASK},stencilMask:Ut.CLASSIFICATION_MASK,depthTest:{enabled:!1},depthMask:!1};function FIe(e,t,n,i){if(c(e._rsStencilDepthPass))return;let o=!e.debugShowShadowVolume;e._rsStencilDepthPass=ze.fromCache(Yx(o,!1)),e._rsStencilDepthPass3DTiles=ze.fromCache(Yx(o,!0)),e._rsColorPass=ze.fromCache(nU(o,!1)),e._rsPickPass=ze.fromCache(NIe)}function BIe(e,t){if(!e.compressVertices)return t;if(t.search(/in\s+vec3\s+extrudeDirection;/g)!==-1){let n="compressedAttributes",i=`in vec2 ${n};`,o=`vec3 extrudeDirection;
`,r=`    extrudeDirection = czm_octDecode(${n}, 65535.0);
`,s=t;s=s.replace(/in\s+vec3\s+extrudeDirection;/g,""),s=Ge.replaceMain(s,"czm_non_compressed_main");let a=`void main() 
{ 
${r}    czm_non_compressed_main(); 
}`;return[i,o,s,a].join(`
`)}}function kIe(e,t){let n=t.context,i=e._primitive,o=XV;o=e._primitive._batchTable.getVertexShaderCallback()(o),o=Rn._appendDistanceDisplayConditionToShader(i,o),o=Rn._modifyShaderPosition(e,o,t.scene3DOnly),o=Rn._updateColorAttribute(i,o);let r=e._hasPlanarExtentsAttributes,s=r||e._hasSphericalExtentsAttribute;e._extruded&&(o=BIe(i,o));let a=e._extruded?"EXTRUDED_GEOMETRY":"",l=new Ge({defines:[a],sources:[o]}),u=new Ge({sources:[qx]}),f=e._primitive._attributeLocations,d=new Wf(s,r,e.appearance);if(e._spStencil=an.replaceCache({context:n,shaderProgram:e._spStencil,vertexShaderSource:l,fragmentShaderSource:u,attributeLocations:f}),e._primitive.allowPicking){let m=Ge.createPickVertexShaderSource(o);m=Rn._appendShowToShader(i,m),m=Rn._updatePickColorAttribute(m);let b=d.createPickFragmentShader(!1),x=d.createPickVertexShader([a],m,!1,t.mapProjection);if(e._spPick=an.replaceCache({context:n,shaderProgram:e._spPick,vertexShaderSource:x,fragmentShaderSource:b,attributeLocations:f}),s){let T=n.shaderCache.getDerivedShaderProgram(e._spPick,"2dPick");if(!c(T)){let C=d.createPickFragmentShader(!0),S=d.createPickVertexShader([a],m,!0,t.mapProjection);T=n.shaderCache.createDerivedShaderProgram(e._spPick,"2dPick",{vertexShaderSource:S,fragmentShaderSource:C,attributeLocations:f})}e._spPick2D=T}}else e._spPick=an.fromCache({context:n,vertexShaderSource:l,fragmentShaderSource:u,attributeLocations:f});o=Rn._appendShowToShader(i,o),l=new Ge({defines:[a],sources:[o]}),e._sp=an.replaceCache({context:n,shaderProgram:e._sp,vertexShaderSource:l,fragmentShaderSource:u,attributeLocations:f});let p=d.createFragmentShader(!1),g=d.createVertexShader([a],o,!1,t.mapProjection);if(e._spColor=an.replaceCache({context:n,shaderProgram:e._spColor,vertexShaderSource:g,fragmentShaderSource:p,attributeLocations:f}),s){let m=n.shaderCache.getDerivedShaderProgram(e._spColor,"2dColor");if(!c(m)){let b=d.createFragmentShader(!0),x=d.createVertexShader([a],o,!0,t.mapProjection);m=n.shaderCache.createDerivedShaderProgram(e._spColor,"2dColor",{vertexShaderSource:x,fragmentShaderSource:b,attributeLocations:f})}e._spColor2D=m}}function VIe(e,t){let n=e._primitive,i=n._va.length*2;t.length=i;let o,r,s,a=0,l=n._batchTable.getUniformMapCallback()(e._uniformMap),u=e._needs2DShader;for(o=0;o<i;o+=2){let g=n._va[a++];r=t[o],c(r)||(r=t[o]=new et({owner:e,primitiveType:n._primitiveType})),r.vertexArray=g,r.renderState=e._rsStencilDepthPass,r.shaderProgram=e._sp,r.uniformMap=l,r.pass=ve.TERRAIN_CLASSIFICATION,s=et.shallowClone(r,r.derivedCommands.tileset),s.renderState=e._rsStencilDepthPass3DTiles,s.pass=ve.CESIUM_3D_TILE_CLASSIFICATION,r.derivedCommands.tileset=s,r=t[o+1],c(r)||(r=t[o+1]=new et({owner:e,primitiveType:n._primitiveType})),r.vertexArray=g,r.renderState=e._rsColorPass,r.shaderProgram=e._spColor,r.pass=ve.TERRAIN_CLASSIFICATION;let b=e.appearance.material;if(c(b)&&(l=At(l,b._uniforms)),r.uniformMap=l,s=et.shallowClone(r,r.derivedCommands.tileset),s.pass=ve.CESIUM_3D_TILE_CLASSIFICATION,r.derivedCommands.tileset=s,u){let x=et.shallowClone(r,r.derivedCommands.appearance2D);x.shaderProgram=e._spColor2D,r.derivedCommands.appearance2D=x,x=et.shallowClone(s,s.derivedCommands.appearance2D),x.shaderProgram=e._spColor2D,s.derivedCommands.appearance2D=x}}let f=e._commandsIgnoreShow,d=e._spStencil,p=0;i=f.length=i/2;for(let g=0;g<i;++g){let m=f[g]=et.shallowClone(t[p],f[g]);m.shaderProgram=d,m.pass=ve.CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW,p+=2}}function UIe(e,t){let n=e._usePickOffsets,i=e._primitive,o=i._va.length*2,r,s=0,a;n&&(r=i._pickOffsets,o=r.length*2),t.length=o;let l,u,f,d=0,p=i._batchTable.getUniformMapCallback()(e._uniformMap),g=e._needs2DShader;for(l=0;l<o;l+=2){let m=i._va[d++];if(n&&(a=r[s++],m=i._va[a.index]),u=t[l],c(u)||(u=t[l]=new et({owner:e,primitiveType:i._primitiveType,pickOnly:!0})),u.vertexArray=m,u.renderState=e._rsStencilDepthPass,u.shaderProgram=e._sp,u.uniformMap=p,u.pass=ve.TERRAIN_CLASSIFICATION,n&&(u.offset=a.offset,u.count=a.count),f=et.shallowClone(u,u.derivedCommands.tileset),f.renderState=e._rsStencilDepthPass3DTiles,f.pass=ve.CESIUM_3D_TILE_CLASSIFICATION,u.derivedCommands.tileset=f,u=t[l+1],c(u)||(u=t[l+1]=new et({owner:e,primitiveType:i._primitiveType,pickOnly:!0})),u.vertexArray=m,u.renderState=e._rsPickPass,u.shaderProgram=e._spPick,u.uniformMap=p,u.pass=ve.TERRAIN_CLASSIFICATION,n&&(u.offset=a.offset,u.count=a.count),f=et.shallowClone(u,u.derivedCommands.tileset),f.pass=ve.CESIUM_3D_TILE_CLASSIFICATION,u.derivedCommands.tileset=f,g){let b=et.shallowClone(u,u.derivedCommands.pick2D);b.shaderProgram=e._spPick2D,u.derivedCommands.pick2D=b,b=et.shallowClone(f,f.derivedCommands.pick2D),b.shaderProgram=e._spPick2D,f.derivedCommands.pick2D=b}}}function zIe(e,t,n,i,o,r,s){VIe(e,r),UIe(e,s)}function Bee(e,t){return Math.floor(e%t/2)}function tU(e,t,n,i,o,r){e.modelMatrix=n,e.boundingVolume=o,e.cull=i,e.debugShowBoundingVolume=r,t.commandList.push(e)}function kee(e,t,n,i,o){e.modelMatrix=n,e.boundingVolume=o,e.cull=i,t.commandList.push(e)}function HIe(e,t,n,i,o,r,s,a){let l=e._primitive;Rn._updateBoundingVolumes(l,t,o);let u;t.mode===oe.SCENE3D?u=l._boundingSphereWC:t.mode===oe.COLUMBUS_VIEW?u=l._boundingSphereCV:t.mode===oe.SCENE2D&&c(l._boundingSphere2D)?u=l._boundingSphere2D:c(l._boundingSphereMorph)&&(u=l._boundingSphereMorph);let f=e.classificationType,d=f!==Vn.CESIUM_3D_TILE,p=f!==Vn.TERRAIN,g=t.passes,m,b,x;if(g.render){let T=n.length;for(m=0;m<T;++m)b=u[Bee(m,T)],d&&(x=n[m],tU(x,t,o,r,b,s)),p&&(x=n[m].derivedCommands.tileset,tU(x,t,o,r,b,s));if(t.invertClassification){let C=e._commandsIgnoreShow,S=C.length;for(m=0;m<S;++m)b=u[m],x=C[m],tU(x,t,o,r,b,s)}}if(g.pick){let T=i.length,C=l._pickOffsets;for(m=0;m<T;++m){let S=C[Bee(m,T)];b=u[S.index],d&&(x=i[m],kee(x,t,o,r,b)),p&&(x=i[m].derivedCommands.tileset,kee(x,t,o,r,b))}}}qy.prototype.update=function(e){if(!c(this._primitive)&&!c(this.geometryInstances))return;let t=this.appearance;c(t)&&c(t.material)&&t.material.update(e.context);let n=this,i=this._primitiveOptions;if(!c(this._primitive)){let o=Array.isArray(this.geometryInstances)?this.geometryInstances:[this.geometryInstances],r=o.length,s,a,l,u=!1,f=!0,d,p=!1,g=!1;for(r>0&&(l=o[0].attributes,p=Wf.hasAttributesForSphericalExtents(l),g=Wf.hasAttributesForTextureCoordinatePlanes(l),d=l.color),s=0;s<r;s++){a=o[s];let b=a.attributes.color;if(c(b))u=!0;else if(u)throw new E("All GeometryInstances must have color attributes to use per-instance color.");f=f&&c(b)&&Wt.equals(d,b)}if(!f&&!p&&!g)throw new E("All GeometryInstances must have the same color attribute except via GroundPrimitives");if(u&&!c(t)&&(t=new ln({flat:!0}),this.appearance=t),!u&&t instanceof ln)throw new E("PerInstanceColorAppearance requires color GeometryInstanceAttributes on all GeometryInstances");if(c(t.material)&&!p&&!g)throw new E("Materials on ClassificationPrimitives are not supported except via GroundPrimitives");this._usePickOffsets=!p&&!g,this._hasSphericalExtentsAttribute=p,this._hasPlanarExtentsAttributes=g,this._hasPerColorAttribute=u;let m=new Array(r);for(s=0;s<r;++s)a=o[s],m[s]=new vt({geometry:a.geometry,attributes:a.attributes,modelMatrix:a.modelMatrix,id:a.id,pickPrimitive:y(this._pickPrimitive,n)});i.appearance=t,i.geometryInstances=m,c(this._createBoundingVolumeFunction)&&(i._createBoundingVolumeFunction=function(b,x){n._createBoundingVolumeFunction(b,x)}),i._createRenderStatesFunction=function(b,x,T,C){FIe(n,x)},i._createShaderProgramFunction=function(b,x,T){kIe(n,x)},i._createCommandsFunction=function(b,x,T,C,S,v,D){zIe(n,void 0,void 0,!0,!1,v,D)},c(this._updateAndQueueCommandsFunction)?i._updateAndQueueCommandsFunction=function(b,x,T,C,S,v,D,I){n._updateAndQueueCommandsFunction(b,x,T,C,S,v,D,I)}:i._updateAndQueueCommandsFunction=function(b,x,T,C,S,v,D,I){HIe(n,x,T,C,S,v,D,I)},this._primitive=new Rn(i)}if(this.debugShowShadowVolume&&!this._debugShowShadowVolume&&this._ready?(this._debugShowShadowVolume=!0,this._rsStencilDepthPass=ze.fromCache(Yx(!1,!1)),this._rsStencilDepthPass3DTiles=ze.fromCache(Yx(!1,!0)),this._rsColorPass=ze.fromCache(nU(!1))):!this.debugShowShadowVolume&&this._debugShowShadowVolume&&(this._debugShowShadowVolume=!1,this._rsStencilDepthPass=ze.fromCache(Yx(!0,!1)),this._rsStencilDepthPass3DTiles=ze.fromCache(Yx(!0,!0)),this._rsColorPass=ze.fromCache(nU(!0))),this._primitive.appearance!==t){if(!this._hasSphericalExtentsAttribute&&!this._hasPlanarExtentsAttributes&&c(t.material))throw new E("Materials on ClassificationPrimitives are not supported except via GroundPrimitive");if(!this._hasPerColorAttribute&&t instanceof ln)throw new E("PerInstanceColorAppearance requires color GeometryInstanceAttribute");this._primitive.appearance=t}this._primitive.show=this.show,this._primitive.debugShowBoundingVolume=this.debugShowBoundingVolume,this._primitive.update(e),e.afterRender.push(()=>{c(this._primitive)&&this._primitive.ready&&(this._ready=!0,this.releaseGeometryInstances&&(this.geometryInstances=void 0))})};qy.prototype.getGeometryInstanceAttributes=function(e){if(!c(this._primitive))throw new E("must call update before calling getGeometryInstanceAttributes");return this._primitive.getGeometryInstanceAttributes(e)};qy.prototype.isDestroyed=function(){return!1};qy.prototype.destroy=function(){return this._primitive=this._primitive&&this._primitive.destroy(),this._sp=this._sp&&this._sp.destroy(),this._spPick=this._spPick&&this._spPick.destroy(),this._spColor=this._spColor&&this._spColor.destroy(),this._spPick2D=void 0,this._spColor2D=void 0,de(this)};var ZI=qy;var GIe={u_globeMinimumAltitude:function(){return 55e3}};function Jc(e){e=y(e,y.EMPTY_OBJECT);let t=e.appearance,n=e.geometryInstances;if(!c(t)&&c(n)){let o=Array.isArray(n)?n:[n],r=o.length;for(let s=0;s<r;s++){let a=o[s].attributes;if(c(a)&&c(a.color)){t=new ln({flat:!0});break}}}this.appearance=t,this.geometryInstances=e.geometryInstances,this.show=y(e.show,!0),this.classificationType=y(e.classificationType,Vn.BOTH),this.debugShowBoundingVolume=y(e.debugShowBoundingVolume,!1),this.debugShowShadowVolume=y(e.debugShowShadowVolume,!1),this._boundingVolumes=[],this._boundingVolumes2D=[],this._ready=!1,this._primitive=void 0,this._maxHeight=void 0,this._minHeight=void 0,this._maxTerrainHeight=di._defaultMaxTerrainHeight,this._minTerrainHeight=di._defaultMinTerrainHeight,this._boundingSpheresKeys=[],this._boundingSpheres=[],this._useFragmentCulling=!1,this._zIndex=void 0;let i=this;this._classificationPrimitiveOptions={geometryInstances:void 0,appearance:void 0,vertexCacheOptimize:y(e.vertexCacheOptimize,!1),interleave:y(e.interleave,!1),releaseGeometryInstances:y(e.releaseGeometryInstances,!0),allowPicking:y(e.allowPicking,!0),asynchronous:y(e.asynchronous,!0),compressVertices:y(e.compressVertices,!0),_createBoundingVolumeFunction:void 0,_updateAndQueueCommandsFunction:void 0,_pickPrimitive:i,_extruded:!0,_uniformMap:GIe}}Object.defineProperties(Jc.prototype,{vertexCacheOptimize:{get:function(){return this._classificationPrimitiveOptions.vertexCacheOptimize}},interleave:{get:function(){return this._classificationPrimitiveOptions.interleave}},releaseGeometryInstances:{get:function(){return this._classificationPrimitiveOptions.releaseGeometryInstances}},allowPicking:{get:function(){return this._classificationPrimitiveOptions.allowPicking}},asynchronous:{get:function(){return this._classificationPrimitiveOptions.asynchronous}},compressVertices:{get:function(){return this._classificationPrimitiveOptions.compressVertices}},ready:{get:function(){return this._ready}}});Jc.isSupported=ZI.isSupported;function Vee(e){return function(t,n){let i=n.maximumRadius,o=i/Math.cos(t*.5)-i;return e._maxHeight+o}}function Uee(e){return function(t,n){return e._minHeight}}var jIe=new h,WIe=new h,qIe=new h,YIe=new he,XIe=new ae;function JI(e,t){let n=e.mapProjection.ellipsoid;if(!c(t.attributes)||!c(t.attributes.position3DHigh))return c(t.rectangle)?t.rectangle:void 0;let i=t.attributes.position3DHigh.values,o=t.attributes.position3DLow.values,r=i.length,s=Number.POSITIVE_INFINITY,a=Number.POSITIVE_INFINITY,l=Number.NEGATIVE_INFINITY,u=Number.NEGATIVE_INFINITY;for(let d=0;d<r;d+=3){let p=h.unpack(i,d,jIe),g=h.unpack(o,d,WIe),m=h.add(p,g,qIe),b=n.cartesianToCartographic(m,YIe),x=b.latitude,T=b.longitude;s=Math.min(s,x),a=Math.min(a,T),l=Math.max(l,x),u=Math.max(u,T)}let f=XIe;return f.north=l,f.south=s,f.east=u,f.west=a,f}function KIe(e,t,n){let i=di.getMinimumMaximumHeights(t,n);e._minTerrainHeight=i.minimumTerrainHeight,e._maxTerrainHeight=i.maximumTerrainHeight}function $Ie(e,t,n){let i=t.mapProjection.ellipsoid,o=JI(t,n),r=Pn.fromRectangle(o,e._minHeight,e._maxHeight,i);if(e._boundingVolumes.push(r),!t.scene3DOnly){let s=t.mapProjection,a=ce.fromRectangleWithHeights2D(o,s,e._maxHeight,e._minHeight);h.fromElements(a.center.z,a.center.x,a.center.y,a.center),e._boundingVolumes2D.push(a)}}function iU(e,t){return Math.floor(e%t/2)}function oU(e,t,n,i,o,r,s){let a=e._primitive;n.mode!==oe.SCENE3D&&t.shaderProgram===a._spColor&&a._needs2DShader&&(t=t.derivedCommands.appearance2D),t.owner=e,t.modelMatrix=i,t.boundingVolume=r,t.cull=o,t.debugShowBoundingVolume=s,n.commandList.push(t)}function zee(e,t,n,i,o,r){let s=e._primitive;n.mode!==oe.SCENE3D&&t.shaderProgram===s._spPick&&s._needs2DShader&&(t=t.derivedCommands.pick2D),t.owner=e,t.modelMatrix=i,t.boundingVolume=r,t.cull=o,n.commandList.push(t)}function ZIe(e,t,n,i,o,r,s,a){let l;t.mode===oe.SCENE3D?l=e._boundingVolumes:l=e._boundingVolumes2D;let u=e.classificationType,f=u!==Vn.CESIUM_3D_TILE,d=u!==Vn.TERRAIN,p=t.passes,g=e._primitive,m,b,x;if(p.render){let T=n.length;for(m=0;m<T;++m)b=l[iU(m,T)],f&&(x=n[m],oU(e,x,t,o,r,b,s)),d&&(x=n[m].derivedCommands.tileset,oU(e,x,t,o,r,b,s));if(t.invertClassification){let C=g._commandsIgnoreShow,S=C.length;for(m=0;m<S;++m)b=l[m],x=C[m],oU(e,x,t,o,r,b,s)}}if(p.pick){let T=i.length,C;for(e._useFragmentCulling||(C=g._primitive._pickOffsets),m=0;m<T;++m){if(b=l[iU(m,T)],!e._useFragmentCulling){let S=C[iU(m,T)];b=l[S.index]}f&&(x=i[m],zee(e,x,t,o,r,b)),d&&(x=i[m].derivedCommands.tileset,zee(e,x,t,o,r,b))}}}Jc.initializeTerrainHeights=function(){return di.initialize()};Jc.prototype.update=function(e){if(!c(this._primitive)&&!c(this.geometryInstances))return;if(!di.initialized){if(!this.asynchronous)throw new E("For synchronous GroundPrimitives, you must call GroundPrimitive.initializeTerrainHeights() and wait for the returned promise to resolve.");Jc.initializeTerrainHeights();return}let t=this,n=this._classificationPrimitiveOptions;if(!c(this._primitive)){let i=e.mapProjection.ellipsoid,o,r,s,a=Array.isArray(this.geometryInstances)?this.geometryInstances:[this.geometryInstances],l=a.length,u=new Array(l),f,d;for(f=0;f<l;++f){o=a[f],r=o.geometry;let b=JI(e,r);c(d)?c(b)&&ae.union(d,b,d):d=ae.clone(b);let x=o.id;if(c(x)&&c(b)){let T=di.getBoundingSphere(b,i);this._boundingSpheresKeys.push(x),this._boundingSpheres.push(T)}if(s=r.constructor,!c(s)||!c(s.createShadowVolume))throw new E("Not all of the geometry instances have GroundPrimitive support.")}KIe(this,d,i);let p=e.verticalExaggeration,g=e.verticalExaggerationRelativeHeight;this._minHeight=zr.getHeight(this._minTerrainHeight,p,g),this._maxHeight=zr.getHeight(this._maxTerrainHeight,p,g);let m=Jc._supportsMaterials(e.context);if(this._useFragmentCulling=m,m){let b,x=!0;for(f=0;f<l;++f)if(o=a[f],r=o.geometry,d=JI(e,r),Wf.shouldUseSphericalCoordinates(d)){x=!1;break}for(f=0;f<l;++f){o=a[f],r=o.geometry,s=r.constructor;let T=JI(e,r),C=r.textureCoordinateRotationPoints;x?b=Wf.getPlanarTextureCoordinateAttributes(T,C,i,e.mapProjection,this._maxHeight):b=Wf.getSphericalExtentGeometryInstanceAttributes(T,C,i,e.mapProjection);let S=o.attributes;for(let v in S)S.hasOwnProperty(v)&&(b[v]=S[v]);u[f]=new vt({geometry:s.createShadowVolume(r,Uee(this),Vee(this)),attributes:b,id:o.id})}}else for(f=0;f<l;++f)o=a[f],r=o.geometry,s=r.constructor,u[f]=new vt({geometry:s.createShadowVolume(r,Uee(this),Vee(this)),attributes:o.attributes,id:o.id});n.geometryInstances=u,n.appearance=this.appearance,n._createBoundingVolumeFunction=function(b,x){$Ie(t,b,x)},n._updateAndQueueCommandsFunction=function(b,x,T,C,S,v,D,I){ZIe(t,x,T,C,S,v,D,I)},this._primitive=new ZI(n)}this._primitive.appearance=this.appearance,this._primitive.show=this.show,this._primitive.debugShowShadowVolume=this.debugShowShadowVolume,this._primitive.debugShowBoundingVolume=this.debugShowBoundingVolume,this._primitive.update(e),e.afterRender.push(()=>{!this._ready&&c(this._primitive)&&this._primitive.ready&&(this._ready=!0,this.releaseGeometryInstances&&(this.geometryInstances=void 0))})};Jc.prototype.getBoundingSphere=function(e){let t=this._boundingSpheresKeys.indexOf(e);if(t!==-1)return this._boundingSpheres[t]};Jc.prototype.getGeometryInstanceAttributes=function(e){if(!c(this._primitive))throw new E("must call update before calling getGeometryInstanceAttributes");return this._primitive.getGeometryInstanceAttributes(e)};Jc.prototype.isDestroyed=function(){return!1};Jc.prototype.destroy=function(){return this._primitive=this._primitive&&this._primitive.destroy(),de(this)};Jc._supportsMaterials=function(e){return e.depthTexture};Jc.supportsMaterials=function(e){return A.typeOf.object("scene",e),Jc._supportsMaterials(e.frameState.context)};var Ll=Jc;function Xx(){E.throwInstantiationError()}Object.defineProperties(Xx.prototype,{isConstant:{get:E.throwInstantiationError},definitionChanged:{get:E.throwInstantiationError}});Xx.prototype.getType=E.throwInstantiationError;Xx.prototype.getValue=E.throwInstantiationError;Xx.prototype.equals=E.throwInstantiationError;var JIe=new J;Xx.getValue=function(e,t,n){let i;return c(e)||(e=J.now(JIe)),c(t)&&(i=t.getType(e),c(i))?((!c(n)||n.type!==i)&&(n=Ki.fromType(i)),t.getValue(e,n.uniforms),n):((!c(n)||n.type!==Ki.ColorType)&&(n=Ki.fromType(Ki.ColorType)),j.clone(j.WHITE,n.uniforms.color),n)};var pr=Xx;function Yy(e,t,n){A.defined("geometryUpdater",e),A.defined("primitives",t),A.defined("orderedGroundPrimitives",n),this._primitives=t,this._orderedGroundPrimitives=n,this._primitive=void 0,this._outlinePrimitive=void 0,this._geometryUpdater=e,this._options=e._options,this._entity=e._entity,this._material=void 0}Yy.prototype._isHidden=function(e,t,n){return!e.isShowing||!e.isAvailable(n)||!X.getValueOrDefault(t.show,n,!0)};Yy.prototype._setOptions=E.throwInstantiationError;Yy.prototype.update=function(e){A.defined("time",e);let t=this._geometryUpdater,n=t._onTerrain,i=this._primitives,o=this._orderedGroundPrimitives;n?o.remove(this._primitive):(i.removeAndDestroy(this._primitive),i.removeAndDestroy(this._outlinePrimitive),this._outlinePrimitive=void 0),this._primitive=void 0;let r=this._entity,s=r[this._geometryUpdater._geometryPropertyName];if(this._setOptions(r,s,e),this._isHidden(r,s,e))return;let a=this._geometryUpdater.shadowsProperty.getValue(e),l=this._options;if(!c(s.fill)||s.fill.getValue(e)){let u=t.fillMaterialProperty,f=u instanceof Ht,d,p=t._getIsClosed(l);if(f)d=new ln({closed:p,flat:n&&!t._supportsMaterialsforEntitiesOnTerrain});else{let g=pr.getValue(e,u,this._material);this._material=g,d=new uo({material:g,translucent:g.isTranslucent(),closed:p})}if(n)l.vertexFormat=ln.VERTEX_FORMAT,this._primitive=o.add(new Ll({geometryInstances:this._geometryUpdater.createFillGeometryInstance(e),appearance:d,asynchronous:!1,shadows:a,classificationType:this._geometryUpdater.classificationTypeProperty.getValue(e)}),X.getValueOrUndefined(this._geometryUpdater.zIndex,e));else{l.vertexFormat=d.vertexFormat;let g=this._geometryUpdater.createFillGeometryInstance(e);f&&(d.translucent=g.attributes.color.value[3]!==255),this._primitive=i.add(new Rn({geometryInstances:g,appearance:d,asynchronous:!1,shadows:a}))}}if(!n&&c(s.outline)&&s.outline.getValue(e)){let u=this._geometryUpdater.createOutlineGeometryInstance(e),f=X.getValueOrDefault(s.outlineWidth,e,1);this._outlinePrimitive=i.add(new Rn({geometryInstances:u,appearance:new ln({flat:!0,translucent:u.attributes.color.value[3]!==255,renderState:{lineWidth:t._scene.clampLineWidth(f)}}),asynchronous:!1,shadows:a}))}};Yy.prototype.getBoundingSphere=function(e){if(!c(e))throw new E("result is required.");let t=this._entity,n=this._primitive,i=this._outlinePrimitive,o;return c(n)&&n.show&&n.ready&&(o=n.getGeometryInstanceAttributes(t),c(o)&&c(o.boundingSphere))?(ce.clone(o.boundingSphere,e),ct.DONE):c(i)&&i.show&&i.ready&&(o=i.getGeometryInstanceAttributes(t),c(o)&&c(o.boundingSphere))?(ce.clone(o.boundingSphere,e),ct.DONE):c(n)&&!n.ready||c(i)&&!i.ready?ct.PENDING:ct.FAILED};Yy.prototype.isDestroyed=function(){return!1};Yy.prototype.destroy=function(){let e=this._primitives,t=this._orderedGroundPrimitives;this._geometryUpdater._onTerrain?t.remove(this._primitive):e.removeAndDestroy(this._primitive),e.removeAndDestroy(this._outlinePrimitive),de(this)};var ii=Yy;var QIe={NONE:0,GEODESIC:1,RHUMB:2},Yt=Object.freeze(QIe);var Hee=R.EPSILON10;function eOe(e,t,n,i){if(A.defined("equalsEpsilon",t),!c(e))return;n=y(n,!1);let o=c(i),r=e.length;if(r<2)return e;let s,a=e[0],l,u,f=0,d=-1;for(s=1;s<r;++s)l=e[s],t(a,l,Hee)?(c(u)||(u=e.slice(0,s),f=s-1,d=0),o&&i.push(s)):(c(u)&&(u.push(l),f=s,o&&(d=i.length)),a=l);return n&&t(e[0],e[r-1],Hee)&&(o&&(c(u)?i.splice(d,0,f):i.push(r-1)),c(u)?u.length-=1:u=e.slice(0,-1)),c(u)?u:e}var Ao=eOe;function tOe(e){let t=e._uSquared,n=e._ellipsoid.maximumRadius,i=e._ellipsoid.minimumRadius,o=(n-i)/n,r=Math.cos(e._startHeading),s=Math.sin(e._startHeading),a=(1-o)*Math.tan(e._start.latitude),l=1/Math.sqrt(1+a*a),u=l*a,f=Math.atan2(a,r),d=l*s,p=d*d,g=1-p,m=Math.sqrt(g),b=t/4,x=b*b,T=x*b,C=x*x,S=1+b-3*x/4+5*T/4-175*C/64,v=1-b+15*x/8-35*T/8,D=1-3*b+35*x/4,I=1-5*b,L=S*f-v*Math.sin(2*f)*b/2-D*Math.sin(4*f)*x/16-I*Math.sin(6*f)*T/48-Math.sin(8*f)*5*C/512,M=e._constants;M.a=n,M.b=i,M.f=o,M.cosineHeading=r,M.sineHeading=s,M.tanU=a,M.cosineU=l,M.sineU=u,M.sigma=f,M.sineAlpha=d,M.sineSquaredAlpha=p,M.cosineSquaredAlpha=g,M.cosineAlpha=m,M.u2Over4=b,M.u4Over16=x,M.u6Over64=T,M.u8Over256=C,M.a0=S,M.a1=v,M.a2=D,M.a3=I,M.distanceRatio=L}function nOe(e,t){return e*t*(4+e*(4-3*t))/16}function Gee(e,t,n,i,o,r,s){let a=nOe(e,n);return(1-a)*e*t*(i+a*o*(s+a*r*(2*s*s-1)))}function iOe(e,t,n,i,o,r,s){let a=(t-n)/t,l=r-i,u=Math.atan((1-a)*Math.tan(o)),f=Math.atan((1-a)*Math.tan(s)),d=Math.cos(u),p=Math.sin(u),g=Math.cos(f),m=Math.sin(f),b=d*g,x=d*m,T=p*m,C=p*g,S=l,v=R.TWO_PI,D=Math.cos(S),I=Math.sin(S),L,M,N,B,_;do{D=Math.cos(S),I=Math.sin(S);let U=x-C*D;N=Math.sqrt(g*g*I*I+U*U),M=T+b*D,L=Math.atan2(N,M);let q;N===0?(q=0,B=1):(q=b*I/N,B=1-q*q),v=S,_=M-2*T/B,isFinite(_)||(_=0),S=l+Gee(a,q,B,L,N,M,_)}while(Math.abs(S-v)>R.EPSILON12);let w=B*(t*t-n*n)/(n*n),P=1+w*(4096+w*(w*(320-175*w)-768))/16384,O=w*(256+w*(w*(74-47*w)-128))/1024,F=_*_,V=O*N*(_+O*(M*(2*F-1)-O*_*(4*N*N-3)*(4*F-3)/6)/4),G=n*P*(L-V),z=Math.atan2(g*I,x-C*D),W=Math.atan2(d*I,x*D-C);e._distance=G,e._startHeading=z,e._endHeading=W,e._uSquared=w}var oOe=new h,rU=new h;function jee(e,t,n,i){let o=h.normalize(i.cartographicToCartesian(t,rU),oOe),r=h.normalize(i.cartographicToCartesian(n,rU),rU);A.typeOf.number.greaterThanOrEquals("value",Math.abs(Math.abs(h.angleBetween(o,r))-Math.PI),.0125),iOe(e,i.maximumRadius,i.minimumRadius,t.longitude,t.latitude,n.longitude,n.latitude),e._start=he.clone(t,e._start),e._end=he.clone(n,e._end),e._start.height=0,e._end.height=0,tOe(e)}function HE(e,t,n){let i=y(n,ie.default);this._ellipsoid=i,this._start=new he,this._end=new he,this._constants={},this._startHeading=void 0,this._endHeading=void 0,this._distance=void 0,this._uSquared=void 0,c(e)&&c(t)&&jee(this,e,t,i)}Object.defineProperties(HE.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},surfaceDistance:{get:function(){return A.defined("distance",this._distance),this._distance}},start:{get:function(){return this._start}},end:{get:function(){return this._end}},startHeading:{get:function(){return A.defined("distance",this._distance),this._startHeading}},endHeading:{get:function(){return A.defined("distance",this._distance),this._endHeading}}});HE.prototype.setEndPoints=function(e,t){A.defined("start",e),A.defined("end",t),jee(this,e,t,this._ellipsoid)};HE.prototype.interpolateUsingFraction=function(e,t){return this.interpolateUsingSurfaceDistance(this._distance*e,t)};HE.prototype.interpolateUsingSurfaceDistance=function(e,t){A.defined("distance",this._distance);let n=this._constants,i=n.distanceRatio+e/n.b,o=Math.cos(2*i),r=Math.cos(4*i),s=Math.cos(6*i),a=Math.sin(2*i),l=Math.sin(4*i),u=Math.sin(6*i),f=Math.sin(8*i),d=i*i,p=i*d,g=n.u8Over256,m=n.u2Over4,b=n.u6Over64,x=n.u4Over16,T=2*p*g*o/3+i*(1-m+7*x/4-15*b/4+579*g/64-(x-15*b/4+187*g/16)*o-(5*b/4-115*g/16)*r-29*g*s/16)+(m/2-x+71*b/32-85*g/16)*a+(5*x/16-5*b/4+383*g/96)*l-d*((b-11*g/2)*a+5*g*l/2)+(29*b/96-29*g/16)*u+539*g*f/1536,C=Math.asin(Math.sin(T)*n.cosineAlpha),S=Math.atan(n.a/n.b*Math.tan(C));T=T-n.sigma;let v=Math.cos(2*n.sigma+T),D=Math.sin(T),I=Math.cos(T),L=n.cosineU*I,M=n.sineU*D,B=Math.atan2(D*n.sineHeading,L-M*n.cosineHeading)-Gee(n.f,n.sineAlpha,n.cosineSquaredAlpha,T,D,I,v);return c(t)?(t.longitude=this._start.longitude+B,t.latitude=S,t.height=0,t):new he(this._start.longitude+B,S,0)};var Xy=HE;function aU(e,t,n){if(e===0)return t*n;let i=e*e,o=i*i,r=o*i,s=r*i,a=s*i,l=a*i,u=n,f=Math.sin(2*u),d=Math.sin(4*u),p=Math.sin(6*u),g=Math.sin(8*u),m=Math.sin(10*u),b=Math.sin(12*u);return t*((1-i/4-3*o/64-5*r/256-175*s/16384-441*a/65536-4851*l/1048576)*u-(3*i/8+3*o/32+45*r/1024+105*s/4096+2205*a/131072+6237*l/524288)*f+(15*o/256+45*r/1024+525*s/16384+1575*a/65536+155925*l/8388608)*d-(35*r/3072+175*s/12288+3675*a/262144+13475*l/1048576)*p+(315*s/131072+2205*a/524288+43659*l/8388608)*g-(693*a/1310720+6237*l/5242880)*m+1001*l/8388608*b)}function rOe(e,t,n){let i=e/n;if(t===0)return i;let o=i*i,r=o*i,s=r*i,a=t,l=a*a,u=l*l,f=u*l,d=f*l,p=d*l,g=p*l,m=Math.sin(2*i),b=Math.cos(2*i),x=Math.sin(4*i),T=Math.cos(4*i),C=Math.sin(6*i),S=Math.cos(6*i),v=Math.sin(8*i),D=Math.cos(8*i),I=Math.sin(10*i),L=Math.cos(10*i),M=Math.sin(12*i);return i+i*l/4+7*i*u/64+15*i*f/256+579*i*d/16384+1515*i*p/65536+16837*i*g/1048576+(3*i*u/16+45*i*f/256-i*(32*o-561)*d/4096-i*(232*o-1677)*p/16384+i*(399985-90560*o+512*s)*g/5242880)*b+(21*i*f/256+483*i*d/4096-i*(224*o-1969)*p/16384-i*(33152*o-112599)*g/1048576)*T+(151*i*d/4096+4681*i*p/65536+1479*i*g/16384-453*r*g/32768)*S+(1097*i*p/65536+42783*i*g/1048576)*D+8011*i*g/1048576*L+(3*l/8+3*u/16+213*f/2048-3*o*f/64+255*d/4096-33*o*d/512+20861*p/524288-33*o*p/512+s*p/1024+28273*g/1048576-471*o*g/8192+9*s*g/4096)*m+(21*u/256+21*f/256+533*d/8192-21*o*d/512+197*p/4096-315*o*p/4096+584039*g/16777216-12517*o*g/131072+7*s*g/2048)*x+(151*f/6144+151*d/4096+5019*p/131072-453*o*p/16384+26965*g/786432-8607*o*g/131072)*C+(1097*d/131072+1097*p/65536+225797*g/10485760-1097*o*g/65536)*v+(8011*p/2621440+8011*g/1048576)*I+293393*g/251658240*M}function Kx(e,t){if(e===0)return Math.log(Math.tan(.5*(R.PI_OVER_TWO+t)));let n=e*Math.sin(t);return Math.log(Math.tan(.5*(R.PI_OVER_TWO+t)))-e/2*Math.log((1+n)/(1-n))}function sOe(e,t,n,i,o){let r=Kx(e._ellipticity,n),s=Kx(e._ellipticity,o);return Math.atan2(R.negativePiToPi(i-t),s-r)}function aOe(e,t,n,i,o,r,s){let a=e._heading,l=r-i,u=0;if(R.equalsEpsilon(Math.abs(a),R.PI_OVER_TWO,R.EPSILON8))if(t===n)u=t*Math.cos(o)*R.negativePiToPi(l);else{let f=Math.sin(o);u=t*Math.cos(o)*R.negativePiToPi(l)/Math.sqrt(1-e._ellipticitySquared*f*f)}else{let f=aU(e._ellipticity,t,o);u=(aU(e._ellipticity,t,s)-f)/Math.cos(a)}return Math.abs(u)}var cOe=new h,sU=new h;function Wee(e,t,n,i){let o=h.normalize(i.cartographicToCartesian(t,sU),cOe),r=h.normalize(i.cartographicToCartesian(n,sU),sU);A.typeOf.number.greaterThanOrEquals("value",Math.abs(Math.abs(h.angleBetween(o,r))-Math.PI),.0125);let s=i.maximumRadius,a=i.minimumRadius,l=s*s,u=a*a;e._ellipticitySquared=(l-u)/l,e._ellipticity=Math.sqrt(e._ellipticitySquared),e._start=he.clone(t,e._start),e._start.height=0,e._end=he.clone(n,e._end),e._end.height=0,e._heading=sOe(e,t.longitude,t.latitude,n.longitude,n.latitude),e._distance=aOe(e,i.maximumRadius,i.minimumRadius,t.longitude,t.latitude,n.longitude,n.latitude)}function qee(e,t,n,i,o,r){if(n===0)return he.clone(e,r);let s=o*o,a,l,u;if(Math.abs(R.PI_OVER_TWO-Math.abs(t))>R.EPSILON8){let f=aU(o,i,e.latitude),d=n*Math.cos(t),p=f+d;if(l=rOe(p,o,i),Math.abs(t)<R.EPSILON10)a=R.negativePiToPi(e.longitude);else{let g=Kx(o,e.latitude),m=Kx(o,l);u=Math.tan(t)*(m-g),a=R.negativePiToPi(e.longitude+u)}}else{l=e.latitude;let f;if(o===0)f=i*Math.cos(e.latitude);else{let d=Math.sin(e.latitude);f=i*Math.cos(e.latitude)/Math.sqrt(1-s*d*d)}u=n/f,t>0?a=R.negativePiToPi(e.longitude+u):a=R.negativePiToPi(e.longitude-u)}return c(r)?(r.longitude=a,r.latitude=l,r.height=0,r):new he(a,l,0)}function Mm(e,t,n){let i=y(n,ie.default);this._ellipsoid=i,this._start=new he,this._end=new he,this._heading=void 0,this._distance=void 0,this._ellipticity=void 0,this._ellipticitySquared=void 0,c(e)&&c(t)&&Wee(this,e,t,i)}Object.defineProperties(Mm.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},surfaceDistance:{get:function(){return A.defined("distance",this._distance),this._distance}},start:{get:function(){return this._start}},end:{get:function(){return this._end}},heading:{get:function(){return A.defined("distance",this._distance),this._heading}}});Mm.fromStartHeadingDistance=function(e,t,n,i,o){A.defined("start",e),A.defined("heading",t),A.defined("distance",n),A.typeOf.number.greaterThan("distance",n,0);let r=y(i,ie.default),s=r.maximumRadius,a=r.minimumRadius,l=s*s,u=a*a,f=Math.sqrt((l-u)/l);t=R.negativePiToPi(t);let d=qee(e,t,n,r.maximumRadius,f);return!c(o)||c(i)&&!i.equals(o.ellipsoid)?new Mm(e,d,r):(o.setEndPoints(e,d),o)};Mm.prototype.setEndPoints=function(e,t){A.defined("start",e),A.defined("end",t),Wee(this,e,t,this._ellipsoid)};Mm.prototype.interpolateUsingFraction=function(e,t){return this.interpolateUsingSurfaceDistance(e*this._distance,t)};Mm.prototype.interpolateUsingSurfaceDistance=function(e,t){if(A.typeOf.number("distance",e),!c(this._distance)||this._distance===0)throw new E("EllipsoidRhumbLine must have distinct start and end set.");return qee(this._start,this._heading,e,this._ellipsoid.maximumRadius,this._ellipticity,t)};Mm.prototype.findIntersectionWithLongitude=function(e,t){if(A.typeOf.number("intersectionLongitude",e),!c(this._distance)||this._distance===0)throw new E("EllipsoidRhumbLine must have distinct start and end set.");let n=this._ellipticity,i=this._heading,o=Math.abs(i),r=this._start;if(e=R.negativePiToPi(e),R.equalsEpsilon(Math.abs(e),Math.PI,R.EPSILON14)&&(e=R.sign(r.longitude)*Math.PI),c(t)||(t=new he),Math.abs(R.PI_OVER_TWO-o)<=R.EPSILON8)return t.longitude=e,t.latitude=r.latitude,t.height=0,t;if(R.equalsEpsilon(Math.abs(R.PI_OVER_TWO-o),R.PI_OVER_TWO,R.EPSILON8))return R.equalsEpsilon(e,r.longitude,R.EPSILON12)?void 0:(t.longitude=e,t.latitude=R.PI_OVER_TWO*R.sign(R.PI_OVER_TWO-i),t.height=0,t);let s=r.latitude,a=n*Math.sin(s),l=Math.tan(.5*(R.PI_OVER_TWO+s))*Math.exp((e-r.longitude)/Math.tan(i)),u=(1+a)/(1-a),f=r.latitude,d;do{d=f;let p=n*Math.sin(d),g=(1+p)/(1-p);f=2*Math.atan(l*Math.pow(g/u,n/2))-R.PI_OVER_TWO}while(!R.equalsEpsilon(f,d,R.EPSILON12));return t.longitude=e,t.latitude=f,t.height=0,t};Mm.prototype.findIntersectionWithLatitude=function(e,t){if(A.typeOf.number("intersectionLatitude",e),!c(this._distance)||this._distance===0)throw new E("EllipsoidRhumbLine must have distinct start and end set.");let n=this._ellipticity,i=this._heading,o=this._start;if(R.equalsEpsilon(Math.abs(i),R.PI_OVER_TWO,R.EPSILON8))return;let r=Kx(n,o.latitude),s=Kx(n,e),a=Math.tan(i)*(s-r),l=R.negativePiToPi(o.longitude+a);return c(t)?(t.longitude=l,t.latitude=e,t.height=0,t):new he(l,e,0)};var mc=Mm;var pU=[Mi,Li],lOe=pU.length,dte=Math.cos(R.toRadians(30)),Yee=Math.cos(R.toRadians(150)),hte=0,mte=1e3;function w_(e){e=y(e,y.EMPTY_OBJECT);let t=e.positions;if(!c(t)||t.length<2)throw new E("At least two positions are required.");if(c(e.arcType)&&e.arcType!==Yt.GEODESIC&&e.arcType!==Yt.RHUMB)throw new E("Valid options for arcType are ArcType.GEODESIC and ArcType.RHUMB.");this.width=y(e.width,1),this._positions=t,this.granularity=y(e.granularity,9999),this.loop=y(e.loop,!1),this.arcType=y(e.arcType,Yt.GEODESIC),this._ellipsoid=ie.default,this._projectionIndex=0,this._workerName="createGroundPolylineGeometry",this._scene3DOnly=!1}Object.defineProperties(w_.prototype,{packedLength:{get:function(){return 1+this._positions.length*3+1+1+1+ie.packedLength+1+1}}});w_.setProjectionAndEllipsoid=function(e,t){let n=0;for(let i=0;i<lOe;i++)if(t instanceof pU[i]){n=i;break}e._projectionIndex=n,e._ellipsoid=t.ellipsoid};var uOe=new h,Xee=new h,Kee=new h;function mU(e,t,n,i,o){let r=pc(i,e,0,uOe),s=pc(i,e,n,Xee),a=pc(i,t,0,Kee),l=Lm(s,r,Xee),u=Lm(a,r,Kee);return h.cross(u,l,o),h.normalize(o,o)}var fOe=new he,dOe=new h,hOe=new h,mOe=new h;function cU(e,t,n,i,o,r,s,a,l,u,f){if(o===0)return;let d;r===Yt.GEODESIC?d=new Xy(e,t,s):r===Yt.RHUMB&&(d=new mc(e,t,s));let p=d.surfaceDistance;if(p<o)return;let g=mU(e,t,i,s,mOe),m=Math.ceil(p/o),b=p/m,x=b,T=m-1,C=a.length;for(let S=0;S<T;S++){let v=d.interpolateUsingSurfaceDistance(x,fOe),D=pc(s,v,n,dOe),I=pc(s,v,i,hOe);h.pack(g,a,C),h.pack(D,l,C),h.pack(I,u,C),f.push(v.latitude),f.push(v.longitude),C+=3,x+=b}}var lU=new he;function pc(e,t,n,i){return he.clone(t,lU),lU.height=n,he.toCartesian(lU,e,i)}w_.pack=function(e,t,n){A.typeOf.object("value",e),A.defined("array",t);let i=y(n,0),o=e._positions,r=o.length;t[i++]=r;for(let s=0;s<r;++s){let a=o[s];h.pack(a,t,i),i+=3}return t[i++]=e.granularity,t[i++]=e.loop?1:0,t[i++]=e.arcType,ie.pack(e._ellipsoid,t,i),i+=ie.packedLength,t[i++]=e._projectionIndex,t[i++]=e._scene3DOnly?1:0,t};w_.unpack=function(e,t,n){A.defined("array",e);let i=y(t,0),o=e[i++],r=new Array(o);for(let p=0;p<o;p++)r[p]=h.unpack(e,i),i+=3;let s=e[i++],a=e[i++]===1,l=e[i++],u=ie.unpack(e,i);i+=ie.packedLength;let f=e[i++],d=e[i++]===1;return c(n)||(n=new w_({positions:r})),n._positions=r,n.granularity=s,n.loop=a,n.arcType=l,n._ellipsoid=u,n._projectionIndex=f,n._scene3DOnly=d,n};function Lm(e,t,n){return h.subtract(e,t,n),h.normalize(n,n),n}function $ee(e,t,n,i){return i=Lm(e,t,i),i=h.cross(i,n,i),i=h.normalize(i,i),i=h.cross(n,i,i),i}var pOe=new h,_Oe=new h,gOe=new h,pte=new h,yOe=0,bOe=-1;function uU(e,t,n,i,o){let r=Lm(n,t,pte),s=$ee(e,t,r,pOe),a=$ee(i,t,r,_Oe);if(R.equalsEpsilon(h.dot(s,a),bOe,R.EPSILON5))return o=h.cross(r,s,o),o=h.normalize(o,o),o;o=h.add(a,s,o),o=h.normalize(o,o);let l=h.cross(r,o,gOe);return h.dot(a,l)<yOe&&(o=h.negate(o,o)),o}var nO=un.fromPointNormal(h.ZERO,h.UNIT_Y),xOe=new h,TOe=new h,AOe=new h,COe=new h,EOe=new h,QI=new h,eO=new he,Zee=new he,Jee=new he;w_.createGeometry=function(e){let t=!e._scene3DOnly,n=e.loop,i=e._ellipsoid,o=e.granularity,r=e.arcType,s=new pU[e._projectionIndex](i),a=hte,l=mte,u,f,d=e._positions,p=d.length;p===2&&(n=!1);let g,m,b,x,T=new mc(void 0,void 0,i),C,S,v,D=[d[0]];for(f=0;f<p-1;f++)g=d[f],m=d[f+1],C=Qn.lineSegmentPlane(g,m,nO,QI),c(C)&&!h.equalsEpsilon(C,g,R.EPSILON7)&&!h.equalsEpsilon(C,m,R.EPSILON7)&&(e.arcType===Yt.GEODESIC?D.push(h.clone(C)):e.arcType===Yt.RHUMB&&(v=i.cartesianToCartographic(C,eO).longitude,b=i.cartesianToCartographic(g,eO),x=i.cartesianToCartographic(m,Zee),T.setEndPoints(b,x),S=T.findIntersectionWithLongitude(v,Jee),C=i.cartographicToCartesian(S,QI),c(C)&&!h.equalsEpsilon(C,g,R.EPSILON7)&&!h.equalsEpsilon(C,m,R.EPSILON7)&&D.push(h.clone(C)))),D.push(m);n&&(g=d[p-1],m=d[0],C=Qn.lineSegmentPlane(g,m,nO,QI),c(C)&&!h.equalsEpsilon(C,g,R.EPSILON7)&&!h.equalsEpsilon(C,m,R.EPSILON7)&&(e.arcType===Yt.GEODESIC?D.push(h.clone(C)):e.arcType===Yt.RHUMB&&(v=i.cartesianToCartographic(C,eO).longitude,b=i.cartesianToCartographic(g,eO),x=i.cartesianToCartographic(m,Zee),T.setEndPoints(b,x),S=T.findIntersectionWithLongitude(v,Jee),C=i.cartographicToCartesian(S,QI),c(C)&&!h.equalsEpsilon(C,g,R.EPSILON7)&&!h.equalsEpsilon(C,m,R.EPSILON7)&&D.push(h.clone(C)))));let I=D.length,L=new Array(I);for(f=0;f<I;f++){let K=he.fromCartesian(D[f],i);K.height=0,L[f]=K}if(L=Ao(L,he.equalsEpsilon),I=L.length,I<2)return;let M=[],N=[],B=[],_=[],w=xOe,P=TOe,O=AOe,F=COe,V=EOe,G=L[0],z=L[1],W=L[I-1];for(w=pc(i,W,a,w),F=pc(i,z,a,F),P=pc(i,G,a,P),O=pc(i,G,l,O),n?V=uU(w,P,O,F,V):V=mU(G,z,l,i,V),h.pack(V,N,0),h.pack(P,B,0),h.pack(O,_,0),M.push(G.latitude),M.push(G.longitude),cU(G,z,a,l,o,r,i,N,B,_,M),f=1;f<I-1;++f){w=h.clone(P,w),P=h.clone(F,P);let K=L[f];pc(i,K,l,O),pc(i,L[f+1],a,F),uU(w,P,O,F,V),u=N.length,h.pack(V,N,u),h.pack(P,B,u),h.pack(O,_,u),M.push(K.latitude),M.push(K.longitude),cU(L[f],L[f+1],a,l,o,r,i,N,B,_,M)}let U=L[I-1],q=L[I-2];if(P=pc(i,U,a,P),O=pc(i,U,l,O),n){let K=L[0];w=pc(i,q,a,w),F=pc(i,K,a,F),V=uU(w,P,O,F,V)}else V=mU(q,U,l,i,V);if(u=N.length,h.pack(V,N,u),h.pack(P,B,u),h.pack(O,_,u),M.push(U.latitude),M.push(U.longitude),n){for(cU(U,G,a,l,o,r,i,N,B,_,M),u=N.length,f=0;f<3;++f)N[u+f]=N[f],B[u+f]=B[f],_[u+f]=_[f];M.push(G.latitude),M.push(G.longitude)}return $Oe(n,s,B,_,N,M,t)};var SOe=new h,wOe=new Q,vOe=new Ne;function Qee(e,t,n,i){let o=Lm(n,t,SOe),r=h.dot(o,e);if(r>dte||r<Yee){let s=Lm(i,n,pte),a=r<Yee?R.PI_OVER_TWO:-R.PI_OVER_TWO,l=Ne.fromAxisAngle(s,a,vOe),u=Q.fromQuaternion(l,wOe);return Q.multiplyByVector(u,e,e),!0}return!1}var ete=new he,DOe=new h,tte=new h;function GE(e,t,n,i,o){let r=he.toCartesian(t,e._ellipsoid,DOe),s=h.add(r,n,tte),a=!1,l=e._ellipsoid,u=l.cartesianToCartographic(s,ete);Math.abs(t.longitude-u.longitude)>R.PI_OVER_TWO&&(a=!0,s=h.subtract(r,n,tte),u=l.cartesianToCartographic(s,ete)),u.height=0;let f=e.project(u,o);return o=h.subtract(f,i,o),o.z=0,o=h.normalize(o,o),a&&h.negate(o,o),o}var POe=new h,nte=new h;function ite(e,t,n,i,o,r){let s=h.subtract(t,e,POe);h.normalize(s,s);let a=n-hte,l=h.multiplyByScalar(s,a,nte);h.add(e,l,o);let u=i-mte;l=h.multiplyByScalar(s,u,nte),h.add(t,l,r)}var IOe=new h;function tO(e,t){let n=un.getPointDistance(nO,e),i=un.getPointDistance(nO,t),o=IOe;R.equalsEpsilon(n,0,R.EPSILON2)?(o=Lm(t,e,o),h.multiplyByScalar(o,R.EPSILON2,o),h.add(e,o,e)):R.equalsEpsilon(i,0,R.EPSILON2)&&(o=Lm(e,t,o),h.multiplyByScalar(o,R.EPSILON2,o),h.add(t,o,t))}function OOe(e,t){let n=Math.abs(e.longitude),i=Math.abs(t.longitude);if(R.equalsEpsilon(n,R.PI,R.EPSILON11)){let o=R.sign(t.longitude);return e.longitude=o*(n-R.EPSILON11),1}else if(R.equalsEpsilon(i,R.PI,R.EPSILON11)){let o=R.sign(e.longitude);return t.longitude=o*(i-R.EPSILON11),2}return 0}var _te=new he,gte=new he,ote=new h,fU=new h,rte=new h,ste=new h,ROe=new h,ate=new h,MOe=[_te,gte],LOe=new ae,NOe=new h,FOe=new h,BOe=new h,kOe=new h,VOe=new h,UOe=new h,dU=new h,hU=new h,zOe=new h,HOe=new h,GOe=new h,cte=new h,jOe=new h,WOe=new h,qOe=new Gn,YOe=new Gn,lte=new h,XOe=new h,ute=new h,KOe=[new ce,new ce],yte=[0,2,1,0,3,2,0,7,3,0,4,7,0,5,4,0,1,5,5,7,4,5,6,7,5,2,6,5,1,2,3,6,2,3,7,6],fte=yte.length;function $Oe(e,t,n,i,o,r,s){let a,l,u=t._ellipsoid,f=n.length/3-1,d=f*8,p=d*4,g=f*36,m=d>65535?new Uint32Array(g):new Uint16Array(g),b=new Float64Array(d*3),x=new Float32Array(p),T=new Float32Array(p),C=new Float32Array(p),S=new Float32Array(p),v=new Float32Array(p),D,I,L,M;s&&(D=new Float32Array(p),I=new Float32Array(p),L=new Float32Array(p),M=new Float32Array(d*2));let N=r.length/2,B=0,_=_te;_.height=0;let w=gte;w.height=0;let P=ote,O=fU;if(s)for(l=0,a=1;a<N;a++)_.latitude=r[l],_.longitude=r[l+1],w.latitude=r[l+2],w.longitude=r[l+3],P=t.project(_,P),O=t.project(w,O),B+=h.distance(P,O),l+=2;let F=i.length/3;O=h.unpack(i,0,O);let V=0;for(l=3,a=1;a<F;a++)P=h.clone(O,P),O=h.unpack(i,l,O),V+=h.distance(P,O),l+=3;let G;l=3;let z=0,W=0,U=0,q=0,K=!1,te=h.unpack(n,0,ste),Y=h.unpack(i,0,fU),Z=h.unpack(o,0,ate);if(e){let Ee=h.unpack(n,n.length-6,rte);Qee(Z,Ee,te,Y)&&(Z=h.negate(Z,Z))}let ee=0,me=0,be=0;for(a=0;a<f;a++){let Ee=h.clone(te,rte),Ue=h.clone(Y,ote),Ye=h.clone(Z,ROe);K&&(Ye=h.negate(Ye,Ye)),te=h.unpack(n,l,ste),Y=h.unpack(i,l,fU),Z=h.unpack(o,l,ate),K=Qee(Z,Ee,te,Y),_.latitude=r[z],_.longitude=r[z+1],w.latitude=r[z+2],w.longitude=r[z+3];let it,It,Ot,He;if(s){let li=OOe(_,w);it=t.project(_,VOe),It=t.project(w,UOe);let Hs=Lm(It,it,lte);Hs.y=Math.abs(Hs.y),Ot=dU,He=hU,li===0||h.dot(Hs,h.UNIT_Y)>dte?(Ot=GE(t,_,Ye,it,dU),He=GE(t,w,Z,It,hU)):li===1?(He=GE(t,w,Z,It,hU),Ot.x=0,Ot.y=R.sign(_.longitude-Math.abs(w.longitude)),Ot.z=0):(Ot=GE(t,_,Ye,it,dU),He.x=0,He.y=R.sign(_.longitude-w.longitude),He.z=0)}let tn=h.distance(Ue,Y),dt=Gn.fromCartesian(Ee,qOe),bt=h.subtract(te,Ee,zOe),nn=h.normalize(bt,cte),Ae=h.subtract(Ue,Ee,HOe);Ae=h.normalize(Ae,Ae);let Ce=h.cross(nn,Ae,cte);Ce=h.normalize(Ce,Ce);let rt=h.cross(Ae,Ye,jOe);rt=h.normalize(rt,rt);let Ri=h.subtract(Y,te,GOe);Ri=h.normalize(Ri,Ri);let lt=h.cross(Z,Ri,WOe);lt=h.normalize(lt,lt);let ao=tn/V,Fo=ee/V,va=0,Cr,ss,Le,st=0,Xe=0;if(s){va=h.distance(it,It),Cr=Gn.fromCartesian(it,YOe),ss=h.subtract(It,it,lte),Le=h.normalize(ss,XOe);let li=Le.x;Le.x=Le.y,Le.y=-li,st=va/B,Xe=me/B}for(G=0;G<8;G++){let li=q+G*4,Hs=W+G*2,kr=li+3,Hc=G<4?1:-1,co=G===2||G===3||G===6||G===7?1:-1;h.pack(dt.high,x,li),x[kr]=bt.x,h.pack(dt.low,T,li),T[kr]=bt.y,h.pack(rt,C,li),C[kr]=bt.z,h.pack(lt,S,li),S[kr]=ao*Hc,h.pack(Ce,v,li);let Er=Fo*co;Er===0&&co<0&&(Er=9),v[kr]=Er,s&&(D[li]=Cr.high.x,D[li+1]=Cr.high.y,D[li+2]=Cr.low.x,D[li+3]=Cr.low.y,L[li]=-Ot.y,L[li+1]=Ot.x,L[li+2]=He.y,L[li+3]=-He.x,I[li]=ss.x,I[li+1]=ss.y,I[li+2]=Le.x,I[li+3]=Le.y,M[Hs]=st*Hc,Er=Xe*co,Er===0&&co<0&&(Er=9),M[Hs+1]=Er)}let Ze=BOe,ht=kOe,jt=NOe,gn=FOe,To=ae.fromCartographicArray(MOe,LOe),_o=di.getMinimumMaximumHeights(To,u),Da=_o.minimumTerrainHeight,Pa=_o.maximumTerrainHeight;be+=Math.abs(Da),be+=Math.abs(Pa),ite(Ee,Ue,Da,Pa,Ze,jt),ite(te,Y,Da,Pa,ht,gn);let pi=h.multiplyByScalar(Ce,R.EPSILON5,ute);h.add(Ze,pi,Ze),h.add(ht,pi,ht),h.add(jt,pi,jt),h.add(gn,pi,gn),tO(Ze,ht),tO(jt,gn),h.pack(Ze,b,U),h.pack(ht,b,U+3),h.pack(gn,b,U+6),h.pack(jt,b,U+9),pi=h.multiplyByScalar(Ce,-2*R.EPSILON5,ute),h.add(Ze,pi,Ze),h.add(ht,pi,ht),h.add(jt,pi,jt),h.add(gn,pi,gn),tO(Ze,ht),tO(jt,gn),h.pack(Ze,b,U+12),h.pack(ht,b,U+15),h.pack(gn,b,U+18),h.pack(jt,b,U+21),z+=2,l+=3,W+=16,U+=24,q+=32,ee+=tn,me+=va}l=0;let le=0;for(a=0;a<f;a++){for(G=0;G<fte;G++)m[l+G]=yte[G]+le;le+=8,l+=fte}let ge=KOe;ce.fromVertices(n,h.ZERO,3,ge[0]),ce.fromVertices(i,h.ZERO,3,ge[1]);let xe=ce.fromBoundingSpheres(ge);xe.radius+=be/(f*2);let Pe={position:new we({componentDatatype:$.DOUBLE,componentsPerAttribute:3,normalize:!1,values:b}),startHiAndForwardOffsetX:S_(x),startLoAndForwardOffsetY:S_(T),startNormalAndForwardOffsetZ:S_(C),endNormalAndTextureCoordinateNormalizationX:S_(S),rightNormalAndTextureCoordinateNormalizationY:S_(v)};return s&&(Pe.startHiLo2D=S_(D),Pe.offsetAndRight2D=S_(I),Pe.startEndNormals2D=S_(L),Pe.texcoordNormalization2D=new we({componentDatatype:$.FLOAT,componentsPerAttribute:2,normalize:!1,values:M})),new ut({attributes:Pe,indices:m,boundingSphere:xe})}function S_(e){return new we({componentDatatype:$.FLOAT,componentsPerAttribute:4,normalize:!1,values:e})}w_._projectNormal=GE;var jE=w_;var _U=`in vec4 v_startPlaneNormalEcAndHalfWidth;
in vec4 v_endPlaneNormalEcAndBatchId;
in vec4 v_rightPlaneEC;
in vec4 v_endEcAndStartEcX;
in vec4 v_texcoordNormalizationAndStartEcYZ;
#ifdef PER_INSTANCE_COLOR
in vec4 v_color;
#endif
void main(void)
{
float logDepthOrDepth = czm_branchFreeTernary(czm_sceneMode == czm_sceneMode2D, gl_FragCoord.z, czm_unpackDepth(texture(czm_globeDepthTexture, gl_FragCoord.xy / czm_viewport.zw)));
vec3 ecStart = vec3(v_endEcAndStartEcX.w, v_texcoordNormalizationAndStartEcYZ.zw);
if (logDepthOrDepth == 0.0) {
#ifdef DEBUG_SHOW_VOLUME
out_FragColor = vec4(1.0, 0.0, 0.0, 0.5);
return;
#else // DEBUG_SHOW_VOLUME
discard;
#endif // DEBUG_SHOW_VOLUME
}
vec4 eyeCoordinate = czm_windowToEyeCoordinates(gl_FragCoord.xy, logDepthOrDepth);
eyeCoordinate /= eyeCoordinate.w;
float halfMaxWidth = v_startPlaneNormalEcAndHalfWidth.w * czm_metersPerPixel(eyeCoordinate);
float widthwiseDistance = czm_planeDistance(v_rightPlaneEC, eyeCoordinate.xyz);
float distanceFromStart = czm_planeDistance(v_startPlaneNormalEcAndHalfWidth.xyz, -dot(ecStart, v_startPlaneNormalEcAndHalfWidth.xyz), eyeCoordinate.xyz);
float distanceFromEnd = czm_planeDistance(v_endPlaneNormalEcAndBatchId.xyz, -dot(v_endEcAndStartEcX.xyz, v_endPlaneNormalEcAndBatchId.xyz), eyeCoordinate.xyz);
if (abs(widthwiseDistance) > halfMaxWidth || distanceFromStart < 0.0 || distanceFromEnd < 0.0) {
#ifdef DEBUG_SHOW_VOLUME
out_FragColor = vec4(1.0, 0.0, 0.0, 0.5);
return;
#else // DEBUG_SHOW_VOLUME
discard;
#endif // DEBUG_SHOW_VOLUME
}
vec3 alignedPlaneNormal;
alignedPlaneNormal = cross(v_rightPlaneEC.xyz, v_startPlaneNormalEcAndHalfWidth.xyz);
alignedPlaneNormal = normalize(cross(alignedPlaneNormal, v_rightPlaneEC.xyz));
distanceFromStart = czm_planeDistance(alignedPlaneNormal, -dot(alignedPlaneNormal, ecStart), eyeCoordinate.xyz);
alignedPlaneNormal = cross(v_rightPlaneEC.xyz, v_endPlaneNormalEcAndBatchId.xyz);
alignedPlaneNormal = normalize(cross(alignedPlaneNormal, v_rightPlaneEC.xyz));
distanceFromEnd = czm_planeDistance(alignedPlaneNormal, -dot(alignedPlaneNormal, v_endEcAndStartEcX.xyz), eyeCoordinate.xyz);
#ifdef PER_INSTANCE_COLOR
out_FragColor = czm_gammaCorrect(v_color);
#else // PER_INSTANCE_COLOR
float s = clamp(distanceFromStart / (distanceFromStart + distanceFromEnd), 0.0, 1.0);
s = (s * v_texcoordNormalizationAndStartEcYZ.x) + v_texcoordNormalizationAndStartEcYZ.y;
float t = (widthwiseDistance + halfMaxWidth) / (2.0 * halfMaxWidth);
czm_materialInput materialInput;
materialInput.s = s;
materialInput.st = vec2(s, t);
materialInput.str = vec3(s, t, 0.0);
czm_material material = czm_getMaterial(materialInput);
out_FragColor = vec4(material.diffuse + material.emission, material.alpha);
#endif // PER_INSTANCE_COLOR
out_FragColor.rgb *= out_FragColor.a;
czm_writeDepthClamp();
}
`;var gU=`in vec3 v_forwardDirectionEC;
in vec3 v_texcoordNormalizationAndHalfWidth;
in float v_batchId;
#ifdef PER_INSTANCE_COLOR
in vec4 v_color;
#else
in vec2 v_alignedPlaneDistances;
in float v_texcoordT;
#endif
float rayPlaneDistanceUnsafe(vec3 origin, vec3 direction, vec3 planeNormal, float planeDistance) {
return (-planeDistance - dot(planeNormal, origin)) / dot(planeNormal, direction);
}
void main(void)
{
vec4 eyeCoordinate = gl_FragCoord;
eyeCoordinate /= eyeCoordinate.w;
#ifdef PER_INSTANCE_COLOR
out_FragColor = czm_gammaCorrect(v_color);
#else // PER_INSTANCE_COLOR
float distanceFromStart = rayPlaneDistanceUnsafe(eyeCoordinate.xyz, -v_forwardDirectionEC, v_forwardDirectionEC.xyz, v_alignedPlaneDistances.x);
float distanceFromEnd = rayPlaneDistanceUnsafe(eyeCoordinate.xyz, v_forwardDirectionEC, -v_forwardDirectionEC.xyz, v_alignedPlaneDistances.y);
distanceFromStart = max(0.0, distanceFromStart);
distanceFromEnd = max(0.0, distanceFromEnd);
float s = distanceFromStart / (distanceFromStart + distanceFromEnd);
s = (s * v_texcoordNormalizationAndHalfWidth.x) + v_texcoordNormalizationAndHalfWidth.y;
czm_materialInput materialInput;
materialInput.s = s;
materialInput.st = vec2(s, v_texcoordT);
materialInput.str = vec3(s, v_texcoordT, 0.0);
czm_material material = czm_getMaterial(materialInput);
out_FragColor = vec4(material.diffuse + material.emission, material.alpha);
#endif // PER_INSTANCE_COLOR
}
`;var yU=`in vec3 position3DHigh;
in vec3 position3DLow;
in vec4 startHiAndForwardOffsetX;
in vec4 startLoAndForwardOffsetY;
in vec4 startNormalAndForwardOffsetZ;
in vec4 endNormalAndTextureCoordinateNormalizationX;
in vec4 rightNormalAndTextureCoordinateNormalizationY;
in vec4 startHiLo2D;
in vec4 offsetAndRight2D;
in vec4 startEndNormals2D;
in vec2 texcoordNormalization2D;
in float batchId;
out vec3 v_forwardDirectionEC;
out vec3 v_texcoordNormalizationAndHalfWidth;
out float v_batchId;
#ifdef WIDTH_VARYING
out float v_width;
#endif
#ifdef ANGLE_VARYING
out float v_polylineAngle;
#endif
#ifdef PER_INSTANCE_COLOR
out vec4 v_color;
#else
out vec2 v_alignedPlaneDistances;
out float v_texcoordT;
#endif
void main()
{
v_batchId = batchId;
vec4 posRelativeToEye2D = czm_translateRelativeToEye(vec3(0.0, startHiLo2D.xy), vec3(0.0, startHiLo2D.zw));
vec4 posRelativeToEye3D = czm_translateRelativeToEye(startHiAndForwardOffsetX.xyz, startLoAndForwardOffsetY.xyz);
vec4 posRelativeToEye = czm_columbusViewMorph(posRelativeToEye2D, posRelativeToEye3D, czm_morphTime);
vec3 posEc2D = (czm_modelViewRelativeToEye * posRelativeToEye2D).xyz;
vec3 posEc3D = (czm_modelViewRelativeToEye * posRelativeToEye3D).xyz;
vec3 startEC = (czm_modelViewRelativeToEye * posRelativeToEye).xyz;
vec4 startPlane2D;
vec4 startPlane3D;
startPlane2D.xyz = czm_normal * vec3(0.0, startEndNormals2D.xy);
startPlane3D.xyz = czm_normal * startNormalAndForwardOffsetZ.xyz;
startPlane2D.w = -dot(startPlane2D.xyz, posEc2D);
startPlane3D.w = -dot(startPlane3D.xyz, posEc3D);
vec4 rightPlane2D;
vec4 rightPlane3D;
rightPlane2D.xyz = czm_normal * vec3(0.0, offsetAndRight2D.zw);
rightPlane3D.xyz = czm_normal * rightNormalAndTextureCoordinateNormalizationY.xyz;
rightPlane2D.w = -dot(rightPlane2D.xyz, posEc2D);
rightPlane3D.w = -dot(rightPlane3D.xyz, posEc3D);
posRelativeToEye2D = posRelativeToEye2D + vec4(0.0, offsetAndRight2D.xy, 0.0);
posRelativeToEye3D = posRelativeToEye3D + vec4(startHiAndForwardOffsetX.w, startLoAndForwardOffsetY.w, startNormalAndForwardOffsetZ.w, 0.0);
posRelativeToEye = czm_columbusViewMorph(posRelativeToEye2D, posRelativeToEye3D, czm_morphTime);
posEc2D = (czm_modelViewRelativeToEye * posRelativeToEye2D).xyz;
posEc3D = (czm_modelViewRelativeToEye * posRelativeToEye3D).xyz;
vec3 endEC = (czm_modelViewRelativeToEye * posRelativeToEye).xyz;
vec3 forwardEc3D = czm_normal * normalize(vec3(startHiAndForwardOffsetX.w, startLoAndForwardOffsetY.w, startNormalAndForwardOffsetZ.w));
vec3 forwardEc2D = czm_normal * normalize(vec3(0.0, offsetAndRight2D.xy));
vec4 endPlane2D;
vec4 endPlane3D;
endPlane2D.xyz = czm_normal * vec3(0.0, startEndNormals2D.zw);
endPlane3D.xyz = czm_normal * endNormalAndTextureCoordinateNormalizationX.xyz;
endPlane2D.w = -dot(endPlane2D.xyz, posEc2D);
endPlane3D.w = -dot(endPlane3D.xyz, posEc3D);
v_forwardDirectionEC = normalize(endEC - startEC);
vec2 cleanTexcoordNormalization2D;
cleanTexcoordNormalization2D.x = abs(texcoordNormalization2D.x);
cleanTexcoordNormalization2D.y = czm_branchFreeTernary(texcoordNormalization2D.y > 1.0, 0.0, abs(texcoordNormalization2D.y));
vec2 cleanTexcoordNormalization3D;
cleanTexcoordNormalization3D.x = abs(endNormalAndTextureCoordinateNormalizationX.w);
cleanTexcoordNormalization3D.y = rightNormalAndTextureCoordinateNormalizationY.w;
cleanTexcoordNormalization3D.y = czm_branchFreeTernary(cleanTexcoordNormalization3D.y > 1.0, 0.0, abs(cleanTexcoordNormalization3D.y));
v_texcoordNormalizationAndHalfWidth.xy = mix(cleanTexcoordNormalization2D, cleanTexcoordNormalization3D, czm_morphTime);
#ifdef PER_INSTANCE_COLOR
v_color = czm_batchTable_color(batchId);
#else // PER_INSTANCE_COLOR
v_alignedPlaneDistances.x = -dot(v_forwardDirectionEC, startEC);
v_alignedPlaneDistances.y = -dot(-v_forwardDirectionEC, endEC);
#endif // PER_INSTANCE_COLOR
#ifdef WIDTH_VARYING
float width = czm_batchTable_width(batchId);
float halfWidth = width * 0.5;
v_width = width;
v_texcoordNormalizationAndHalfWidth.z = halfWidth;
#else
float halfWidth = 0.5 * czm_batchTable_width(batchId);
v_texcoordNormalizationAndHalfWidth.z = halfWidth;
#endif
vec4 positionEc3D = czm_modelViewRelativeToEye * czm_translateRelativeToEye(position3DHigh, position3DLow);
float absStartPlaneDistance = abs(czm_planeDistance(startPlane3D, positionEc3D.xyz));
float absEndPlaneDistance = abs(czm_planeDistance(endPlane3D, positionEc3D.xyz));
vec3 planeDirection = czm_branchFreeTernary(absStartPlaneDistance < absEndPlaneDistance, startPlane3D.xyz, endPlane3D.xyz);
vec3 upOrDown = normalize(cross(rightPlane3D.xyz, planeDirection));
vec3 normalEC = normalize(cross(planeDirection, upOrDown));
vec3 geodeticSurfaceNormal = normalize(cross(normalEC, forwardEc3D));
geodeticSurfaceNormal *= float(0.0 <= rightNormalAndTextureCoordinateNormalizationY.w && rightNormalAndTextureCoordinateNormalizationY.w <= 1.0);
geodeticSurfaceNormal *= MAX_TERRAIN_HEIGHT;
positionEc3D.xyz += geodeticSurfaceNormal;
normalEC *= sign(endNormalAndTextureCoordinateNormalizationX.w);
positionEc3D.xyz += halfWidth * max(0.0, czm_metersPerPixel(positionEc3D)) * normalEC;
vec4 positionEc2D = czm_modelViewRelativeToEye * czm_translateRelativeToEye(position2DHigh.zxy, position2DLow.zxy);
absStartPlaneDistance = abs(czm_planeDistance(startPlane2D, positionEc2D.xyz));
absEndPlaneDistance = abs(czm_planeDistance(endPlane2D, positionEc2D.xyz));
planeDirection = czm_branchFreeTernary(absStartPlaneDistance < absEndPlaneDistance, startPlane2D.xyz, endPlane2D.xyz);
upOrDown = normalize(cross(rightPlane2D.xyz, planeDirection));
normalEC = normalize(cross(planeDirection, upOrDown));
geodeticSurfaceNormal = normalize(cross(normalEC, forwardEc2D));
geodeticSurfaceNormal *= float(0.0 <= texcoordNormalization2D.y && texcoordNormalization2D.y <= 1.0);
geodeticSurfaceNormal *= MAX_TERRAIN_HEIGHT;
positionEc2D.xyz += geodeticSurfaceNormal;
normalEC *= sign(texcoordNormalization2D.x);
#ifndef PER_INSTANCE_COLOR
v_texcoordT = clamp(sign(texcoordNormalization2D.x), 0.0, 1.0);
#endif
positionEc2D.xyz += halfWidth * max(0.0, czm_metersPerPixel(positionEc2D)) * normalEC;
gl_Position = czm_projection * mix(positionEc2D, positionEc3D, czm_morphTime);
#ifdef ANGLE_VARYING
vec2 approxLineDirection = normalize(vec2(v_forwardDirectionEC.x, -v_forwardDirectionEC.y));
approxLineDirection.y = czm_branchFreeTernary(approxLineDirection.x == 0.0 && approxLineDirection.y == 0.0, -1.0, approxLineDirection.y);
v_polylineAngle = czm_fastApproximateAtan(approxLineDirection.x, approxLineDirection.y);
#endif
}
`;var bU=`in vec3 position3DHigh;
in vec3 position3DLow;
#ifndef COLUMBUS_VIEW_2D
in vec4 startHiAndForwardOffsetX;
in vec4 startLoAndForwardOffsetY;
in vec4 startNormalAndForwardOffsetZ;
in vec4 endNormalAndTextureCoordinateNormalizationX;
in vec4 rightNormalAndTextureCoordinateNormalizationY;
#else
in vec4 startHiLo2D;
in vec4 offsetAndRight2D;
in vec4 startEndNormals2D;
in vec2 texcoordNormalization2D;
#endif
in float batchId;
out vec4 v_startPlaneNormalEcAndHalfWidth;
out vec4 v_endPlaneNormalEcAndBatchId;
out vec4 v_rightPlaneEC;
out vec4 v_endEcAndStartEcX;
out vec4 v_texcoordNormalizationAndStartEcYZ;
#ifdef WIDTH_VARYING
out float v_width;
#endif
#ifdef ANGLE_VARYING
out float v_polylineAngle;
#endif
#ifdef PER_INSTANCE_COLOR
out vec4 v_color;
#endif
void main()
{
#ifdef COLUMBUS_VIEW_2D
vec3 ecStart = (czm_modelViewRelativeToEye * czm_translateRelativeToEye(vec3(0.0, startHiLo2D.xy), vec3(0.0, startHiLo2D.zw))).xyz;
vec3 forwardDirectionEC = czm_normal * vec3(0.0, offsetAndRight2D.xy);
vec3 ecEnd = forwardDirectionEC + ecStart;
forwardDirectionEC = normalize(forwardDirectionEC);
v_rightPlaneEC.xyz = czm_normal * vec3(0.0, offsetAndRight2D.zw);
v_rightPlaneEC.w = -dot(v_rightPlaneEC.xyz, ecStart);
vec4 startPlaneEC;
startPlaneEC.xyz =  czm_normal * vec3(0.0, startEndNormals2D.xy);
startPlaneEC.w = -dot(startPlaneEC.xyz, ecStart);
vec4 endPlaneEC;
endPlaneEC.xyz =  czm_normal * vec3(0.0, startEndNormals2D.zw);
endPlaneEC.w = -dot(endPlaneEC.xyz, ecEnd);
v_texcoordNormalizationAndStartEcYZ.x = abs(texcoordNormalization2D.x);
v_texcoordNormalizationAndStartEcYZ.y = texcoordNormalization2D.y;
#else // COLUMBUS_VIEW_2D
vec3 ecStart = (czm_modelViewRelativeToEye * czm_translateRelativeToEye(startHiAndForwardOffsetX.xyz, startLoAndForwardOffsetY.xyz)).xyz;
vec3 offset = czm_normal * vec3(startHiAndForwardOffsetX.w, startLoAndForwardOffsetY.w, startNormalAndForwardOffsetZ.w);
vec3 ecEnd = ecStart + offset;
vec3 forwardDirectionEC = normalize(offset);
vec4 startPlaneEC;
startPlaneEC.xyz = czm_normal * startNormalAndForwardOffsetZ.xyz;
startPlaneEC.w = -dot(startPlaneEC.xyz, ecStart);
vec4 endPlaneEC;
endPlaneEC.xyz = czm_normal * endNormalAndTextureCoordinateNormalizationX.xyz;
endPlaneEC.w = -dot(endPlaneEC.xyz, ecEnd);
v_rightPlaneEC.xyz = czm_normal * rightNormalAndTextureCoordinateNormalizationY.xyz;
v_rightPlaneEC.w = -dot(v_rightPlaneEC.xyz, ecStart);
v_texcoordNormalizationAndStartEcYZ.x = abs(endNormalAndTextureCoordinateNormalizationX.w);
v_texcoordNormalizationAndStartEcYZ.y = rightNormalAndTextureCoordinateNormalizationY.w;
#endif // COLUMBUS_VIEW_2D
v_endEcAndStartEcX.xyz = ecEnd;
v_endEcAndStartEcX.w = ecStart.x;
v_texcoordNormalizationAndStartEcYZ.zw = ecStart.yz;
#ifdef PER_INSTANCE_COLOR
v_color = czm_batchTable_color(batchId);
#endif // PER_INSTANCE_COLOR
vec4 positionRelativeToEye = czm_computePosition();
vec4 positionEC = czm_modelViewRelativeToEye * positionRelativeToEye;
float absStartPlaneDistance = abs(czm_planeDistance(startPlaneEC, positionEC.xyz));
float absEndPlaneDistance = abs(czm_planeDistance(endPlaneEC, positionEC.xyz));
vec3 planeDirection = czm_branchFreeTernary(absStartPlaneDistance < absEndPlaneDistance, startPlaneEC.xyz, endPlaneEC.xyz);
vec3 upOrDown = normalize(cross(v_rightPlaneEC.xyz, planeDirection));
vec3 normalEC = normalize(cross(planeDirection, upOrDown));
upOrDown = cross(forwardDirectionEC, normalEC);
upOrDown = float(czm_sceneMode == czm_sceneMode3D) * upOrDown;
upOrDown = float(v_texcoordNormalizationAndStartEcYZ.y > 1.0 || v_texcoordNormalizationAndStartEcYZ.y < 0.0) * upOrDown;
upOrDown = min(GLOBE_MINIMUM_ALTITUDE, czm_geometricToleranceOverMeter * length(positionRelativeToEye.xyz)) * upOrDown;
positionEC.xyz += upOrDown;
v_texcoordNormalizationAndStartEcYZ.y = czm_branchFreeTernary(v_texcoordNormalizationAndStartEcYZ.y > 1.0, 0.0, abs(v_texcoordNormalizationAndStartEcYZ.y));
float width = czm_batchTable_width(batchId);
#ifdef WIDTH_VARYING
v_width = width;
#endif
v_startPlaneNormalEcAndHalfWidth.xyz = startPlaneEC.xyz;
v_startPlaneNormalEcAndHalfWidth.w = width * 0.5;
v_endPlaneNormalEcAndBatchId.xyz = endPlaneEC.xyz;
v_endPlaneNormalEcAndBatchId.w = batchId;
width = width * max(0.0, czm_metersPerPixel(positionEC));
width = width / dot(normalEC, v_rightPlaneEC.xyz);
#ifdef COLUMBUS_VIEW_2D
normalEC *= sign(texcoordNormalization2D.x);
#else
normalEC *= sign(endNormalAndTextureCoordinateNormalizationX.w);
#endif
positionEC.xyz += width * normalEC;
gl_Position = czm_depthClamp(czm_projection * positionEC);
#ifdef ANGLE_VARYING
vec2 approxLineDirection = normalize(vec2(forwardDirectionEC.x, -forwardDirectionEC.y));
approxLineDirection.y = czm_branchFreeTernary(approxLineDirection.x == 0.0 && approxLineDirection.y == 0.0, -1.0, approxLineDirection.y);
v_polylineAngle = czm_fastApproximateAtan(approxLineDirection.x, approxLineDirection.y);
#endif
}
`;var xU=`in vec3 position3DHigh;
in vec3 position3DLow;
in vec3 prevPosition3DHigh;
in vec3 prevPosition3DLow;
in vec3 nextPosition3DHigh;
in vec3 nextPosition3DLow;
in vec2 expandAndWidth;
in vec4 color;
in float batchId;
out vec4 v_color;
void main()
{
float expandDir = expandAndWidth.x;
float width = abs(expandAndWidth.y) + 0.5;
bool usePrev = expandAndWidth.y < 0.0;
vec4 p = czm_computePosition();
vec4 prev = czm_computePrevPosition();
vec4 next = czm_computeNextPosition();
float angle;
vec4 positionWC = getPolylineWindowCoordinates(p, prev, next, expandDir, width, usePrev, angle);
gl_Position = czm_viewportOrthographic * positionWC;
v_color = color;
}
`;var qf=`void clipLineSegmentToNearPlane(
vec3 p0,
vec3 p1,
out vec4 positionWC,
out bool clipped,
out bool culledByNearPlane,
out vec4 clippedPositionEC)
{
culledByNearPlane = false;
clipped = false;
vec3 p0ToP1 = p1 - p0;
float magnitude = length(p0ToP1);
vec3 direction = normalize(p0ToP1);
float endPoint0Distance =  czm_currentFrustum.x + p0.z;
float denominator = -direction.z;
if (endPoint0Distance > 0.0 && abs(denominator) < czm_epsilon7)
{
culledByNearPlane = true;
}
else if (endPoint0Distance > 0.0)
{
float t = endPoint0Distance / denominator;
if (t < 0.0 || t > magnitude)
{
culledByNearPlane = true;
}
else
{
p0 = p0 + t * direction;
p0.z = min(p0.z, -czm_currentFrustum.x);
clipped = true;
}
}
clippedPositionEC = vec4(p0, 1.0);
positionWC = czm_eyeToWindowCoordinates(clippedPositionEC);
}
vec4 getPolylineWindowCoordinatesEC(vec4 positionEC, vec4 prevEC, vec4 nextEC, float expandDirection, float width, bool usePrevious, out float angle)
{
#ifdef POLYLINE_DASH
vec4 positionWindow = czm_eyeToWindowCoordinates(positionEC);
vec4 previousWindow = czm_eyeToWindowCoordinates(prevEC);
vec4 nextWindow = czm_eyeToWindowCoordinates(nextEC);
vec2 lineDir;
if (usePrevious) {
lineDir = normalize(positionWindow.xy - previousWindow.xy);
}
else {
lineDir = normalize(nextWindow.xy - positionWindow.xy);
}
angle = atan(lineDir.x, lineDir.y) - 1.570796327;
angle = floor(angle / czm_piOverFour + 0.5) * czm_piOverFour;
#endif
vec4 clippedPrevWC, clippedPrevEC;
bool prevSegmentClipped, prevSegmentCulled;
clipLineSegmentToNearPlane(prevEC.xyz, positionEC.xyz, clippedPrevWC, prevSegmentClipped, prevSegmentCulled, clippedPrevEC);
vec4 clippedNextWC, clippedNextEC;
bool nextSegmentClipped, nextSegmentCulled;
clipLineSegmentToNearPlane(nextEC.xyz, positionEC.xyz, clippedNextWC, nextSegmentClipped, nextSegmentCulled, clippedNextEC);
bool segmentClipped, segmentCulled;
vec4 clippedPositionWC, clippedPositionEC;
clipLineSegmentToNearPlane(positionEC.xyz, usePrevious ? prevEC.xyz : nextEC.xyz, clippedPositionWC, segmentClipped, segmentCulled, clippedPositionEC);
if (segmentCulled)
{
return vec4(0.0, 0.0, 0.0, 1.0);
}
vec2 directionToPrevWC = normalize(clippedPrevWC.xy - clippedPositionWC.xy);
vec2 directionToNextWC = normalize(clippedNextWC.xy - clippedPositionWC.xy);
if (prevSegmentCulled)
{
directionToPrevWC = -directionToNextWC;
}
else if (nextSegmentCulled)
{
directionToNextWC = -directionToPrevWC;
}
vec2 thisSegmentForwardWC, otherSegmentForwardWC;
if (usePrevious)
{
thisSegmentForwardWC = -directionToPrevWC;
otherSegmentForwardWC = directionToNextWC;
}
else
{
thisSegmentForwardWC = directionToNextWC;
otherSegmentForwardWC =  -directionToPrevWC;
}
vec2 thisSegmentLeftWC = vec2(-thisSegmentForwardWC.y, thisSegmentForwardWC.x);
vec2 leftWC = thisSegmentLeftWC;
float expandWidth = width * 0.5;
if (!czm_equalsEpsilon(prevEC.xyz - positionEC.xyz, vec3(0.0), czm_epsilon1) && !czm_equalsEpsilon(nextEC.xyz - positionEC.xyz, vec3(0.0), czm_epsilon1))
{
vec2 otherSegmentLeftWC = vec2(-otherSegmentForwardWC.y, otherSegmentForwardWC.x);
vec2 leftSumWC = thisSegmentLeftWC + otherSegmentLeftWC;
float leftSumLength = length(leftSumWC);
leftWC = leftSumLength < czm_epsilon6 ? thisSegmentLeftWC : (leftSumWC / leftSumLength);
vec2 u = -thisSegmentForwardWC;
vec2 v = leftWC;
float sinAngle = abs(u.x * v.y - u.y * v.x);
expandWidth = clamp(expandWidth / sinAngle, 0.0, width * 2.0);
}
vec2 offset = leftWC * expandDirection * expandWidth * czm_pixelRatio;
return vec4(clippedPositionWC.xy + offset, -clippedPositionWC.z, 1.0) * (czm_projection * clippedPositionEC).w;
}
vec4 getPolylineWindowCoordinates(vec4 position, vec4 previous, vec4 next, float expandDirection, float width, bool usePrevious, out float angle)
{
vec4 positionEC = czm_modelViewRelativeToEye * position;
vec4 prevEC = czm_modelViewRelativeToEye * previous;
vec4 nextEC = czm_modelViewRelativeToEye * next;
return getPolylineWindowCoordinatesEC(positionEC, prevEC, nextEC, expandDirection, width, usePrevious, angle);
}
`;var TU=`${qf}
${xU}`,ZOe=RE;zt.isInternetExplorer()||(TU=`#define CLIP_POLYLINE 
${TU}`);function Ky(e){e=y(e,y.EMPTY_OBJECT);let t=y(e.translucent,!0),n=!1,i=Ky.VERTEX_FORMAT;this.material=void 0,this.translucent=t,this._vertexShaderSource=y(e.vertexShaderSource,TU),this._fragmentShaderSource=y(e.fragmentShaderSource,ZOe),this._renderState=io.getDefaultRenderState(t,n,e.renderState),this._closed=n,this._vertexFormat=i}Object.defineProperties(Ky.prototype,{vertexShaderSource:{get:function(){return this._vertexShaderSource}},fragmentShaderSource:{get:function(){return this._fragmentShaderSource}},renderState:{get:function(){return this._renderState}},closed:{get:function(){return this._closed}},vertexFormat:{get:function(){return this._vertexFormat}}});Ky.VERTEX_FORMAT=Ie.POSITION_ONLY;Ky.prototype.getFragmentShaderSource=io.prototype.getFragmentShaderSource;Ky.prototype.isTranslucent=io.prototype.isTranslucent;Ky.prototype.getRenderState=io.prototype.getRenderState;var us=Ky;var AU=`in vec3 position3DHigh;
in vec3 position3DLow;
in vec3 prevPosition3DHigh;
in vec3 prevPosition3DLow;
in vec3 nextPosition3DHigh;
in vec3 nextPosition3DLow;
in vec2 expandAndWidth;
in vec2 st;
in float batchId;
out float v_width;
out vec2 v_st;
out float v_polylineAngle;
void main()
{
float expandDir = expandAndWidth.x;
float width = abs(expandAndWidth.y) + 0.5;
bool usePrev = expandAndWidth.y < 0.0;
vec4 p = czm_computePosition();
vec4 prev = czm_computePrevPosition();
vec4 next = czm_computeNextPosition();
float angle;
vec4 positionWC = getPolylineWindowCoordinates(p, prev, next, expandDir, width, usePrev, angle);
gl_Position = czm_viewportOrthographic * positionWC;
v_width = width;
v_st.s = st.s;
v_st.t = czm_writeNonPerspective(st.t, gl_Position.w);
v_polylineAngle = angle;
}
`;var WE=`#ifdef VECTOR_TILE
uniform vec4 u_highlightColor;
#endif
in vec2 v_st;
void main()
{
czm_materialInput materialInput;
vec2 st = v_st;
st.t = czm_readNonPerspective(st.t, gl_FragCoord.w);
materialInput.s = st.s;
materialInput.st = st;
materialInput.str = vec3(st, 0.0);
czm_material material = czm_getMaterial(materialInput);
out_FragColor = vec4(material.diffuse + material.emission, material.alpha);
#ifdef VECTOR_TILE
out_FragColor *= u_highlightColor;
#endif
czm_writeLogDepth();
}
`;var CU=`${qf}
${AU}`,JOe=WE;zt.isInternetExplorer()||(CU=`#define CLIP_POLYLINE 
${CU}`);function $y(e){e=y(e,y.EMPTY_OBJECT);let t=y(e.translucent,!0),n=!1,i=$y.VERTEX_FORMAT;this.material=c(e.material)?e.material:Ki.fromType(Ki.ColorType),this.translucent=t,this._vertexShaderSource=y(e.vertexShaderSource,CU),this._fragmentShaderSource=y(e.fragmentShaderSource,JOe),this._renderState=io.getDefaultRenderState(t,n,e.renderState),this._closed=n,this._vertexFormat=i}Object.defineProperties($y.prototype,{vertexShaderSource:{get:function(){let e=this._vertexShaderSource;return this.material.shaderSource.search(/in\s+float\s+v_polylineAngle;/g)!==-1&&(e=`#define POLYLINE_DASH
${e}`),e}},fragmentShaderSource:{get:function(){return this._fragmentShaderSource}},renderState:{get:function(){return this._renderState}},closed:{get:function(){return this._closed}},vertexFormat:{get:function(){return this._vertexFormat}}});$y.VERTEX_FORMAT=Ie.POSITION_AND_ST;$y.prototype.getFragmentShaderSource=io.prototype.getFragmentShaderSource;$y.prototype.isTranslucent=io.prototype.isTranslucent;$y.prototype.getRenderState=io.prototype.getRenderState;var Ua=$y;function Nm(e){e=y(e,y.EMPTY_OBJECT),this.geometryInstances=e.geometryInstances,this._hasPerInstanceColors=!0;let t=e.appearance;c(t)||(t=new Ua),this.appearance=t,this.show=y(e.show,!0),this.classificationType=y(e.classificationType,Vn.BOTH),this.debugShowBoundingVolume=y(e.debugShowBoundingVolume,!1),this._debugShowShadowVolume=y(e.debugShowShadowVolume,!1),this._primitiveOptions={geometryInstances:void 0,appearance:void 0,vertexCacheOptimize:!1,interleave:y(e.interleave,!1),releaseGeometryInstances:y(e.releaseGeometryInstances,!0),allowPicking:y(e.allowPicking,!0),asynchronous:y(e.asynchronous,!0),compressVertices:!1,_createShaderProgramFunction:void 0,_createCommandsFunction:void 0,_updateAndQueueCommandsFunction:void 0},this._zIndex=void 0,this._ready=!1,this._primitive=void 0,this._sp=void 0,this._sp2D=void 0,this._spMorph=void 0,this._renderState=bte(!1),this._renderState3DTiles=bte(!0),this._renderStateMorph=ze.fromCache({cull:{enabled:!0,face:xi.FRONT},depthTest:{enabled:!0},blending:hn.PRE_MULTIPLIED_ALPHA_BLEND,depthMask:!1})}Object.defineProperties(Nm.prototype,{interleave:{get:function(){return this._primitiveOptions.interleave}},releaseGeometryInstances:{get:function(){return this._primitiveOptions.releaseGeometryInstances}},allowPicking:{get:function(){return this._primitiveOptions.allowPicking}},asynchronous:{get:function(){return this._primitiveOptions.asynchronous}},ready:{get:function(){return this._ready}},debugShowShadowVolume:{get:function(){return this._debugShowShadowVolume}}});Nm.initializeTerrainHeights=function(){return di.initialize()};function QOe(e,t,n){let i=t.context,o=e._primitive,r=o._attributeLocations,s=o._batchTable.getVertexShaderCallback()(bU);s=Rn._appendShowToShader(o,s),s=Rn._appendDistanceDisplayConditionToShader(o,s),s=Rn._modifyShaderPosition(e,s,t.scene3DOnly);let a=o._batchTable.getVertexShaderCallback()(yU);a=Rn._appendShowToShader(o,a),a=Rn._appendDistanceDisplayConditionToShader(o,a),a=Rn._modifyShaderPosition(e,a,t.scene3DOnly);let l=o._batchTable.getVertexShaderCallback()(_U),u=[`GLOBE_MINIMUM_ALTITUDE ${t.mapProjection.ellipsoid.minimumRadius.toFixed(1)}`],f="",d="";c(n.material)?(d=c(n.material)?n.material.shaderSource:"",d.search(/in\s+float\s+v_polylineAngle;/g)!==-1&&u.push("ANGLE_VARYING"),d.search(/in\s+float\s+v_width;/g)!==-1&&u.push("WIDTH_VARYING")):f="PER_INSTANCE_COLOR",u.push(f);let p=e.debugShowShadowVolume?["DEBUG_SHOW_VOLUME",f]:[f],g=new Ge({defines:u,sources:[s]}),m=new Ge({defines:p,sources:[d,l]});e._sp=an.replaceCache({context:i,shaderProgram:o._sp,vertexShaderSource:g,fragmentShaderSource:m,attributeLocations:r});let b=i.shaderCache.getDerivedShaderProgram(e._sp,"2dColor");if(!c(b)){let T=new Ge({defines:u.concat(["COLUMBUS_VIEW_2D"]),sources:[s]});b=i.shaderCache.createDerivedShaderProgram(e._sp,"2dColor",{context:i,shaderProgram:e._sp2D,vertexShaderSource:T,fragmentShaderSource:m,attributeLocations:r})}e._sp2D=b;let x=i.shaderCache.getDerivedShaderProgram(e._sp,"MorphColor");if(!c(x)){let T=new Ge({defines:u.concat([`MAX_TERRAIN_HEIGHT ${di._defaultMaxTerrainHeight.toFixed(1)}`]),sources:[a]});l=o._batchTable.getVertexShaderCallback()(gU);let C=new Ge({defines:p,sources:[d,l]});x=i.shaderCache.createDerivedShaderProgram(e._sp,"MorphColor",{context:i,shaderProgram:e._spMorph,vertexShaderSource:T,fragmentShaderSource:C,attributeLocations:r})}e._spMorph=x}function bte(e){return ze.fromCache({cull:{enabled:!0},blending:hn.PRE_MULTIPLIED_ALPHA_BLEND,depthMask:!1,stencilTest:{enabled:e,frontFunction:Un.EQUAL,frontOperation:{fail:ft.KEEP,zFail:ft.KEEP,zPass:ft.KEEP},backFunction:Un.EQUAL,backOperation:{fail:ft.KEEP,zFail:ft.KEEP,zPass:ft.KEEP},reference:Ut.CESIUM_3D_TILE_MASK,mask:Ut.CESIUM_3D_TILE_MASK}})}function e1e(e,t,n,i,o,r){let s=e._primitive,a=s._va.length;o.length=a,r.length=a;let u=t instanceof us?{}:n._uniforms,f=s._batchTable.getUniformMapCallback()(u);for(let d=0;d<a;d++){let p=s._va[d],g=o[d];c(g)||(g=o[d]=new et({owner:e,primitiveType:s._primitiveType})),g.vertexArray=p,g.renderState=e._renderState,g.shaderProgram=e._sp,g.uniformMap=f,g.pass=ve.TERRAIN_CLASSIFICATION,g.pickId="czm_batchTable_pickColor(v_endPlaneNormalEcAndBatchId.w)";let m=et.shallowClone(g,g.derivedCommands.tileset);m.renderState=e._renderState3DTiles,m.pass=ve.CESIUM_3D_TILE_CLASSIFICATION,g.derivedCommands.tileset=m;let b=et.shallowClone(g,g.derivedCommands.color2D);b.shaderProgram=e._sp2D,g.derivedCommands.color2D=b;let x=et.shallowClone(m,m.derivedCommands.color2D);x.shaderProgram=e._sp2D,m.derivedCommands.color2D=x;let T=et.shallowClone(g,g.derivedCommands.colorMorph);T.renderState=e._renderStateMorph,T.shaderProgram=e._spMorph,T.pickId="czm_batchTable_pickColor(v_batchId)",g.derivedCommands.colorMorph=T}}function xte(e,t,n,i,o,r,s){n.mode===oe.MORPHING?t=t.derivedCommands.colorMorph:n.mode!==oe.SCENE3D&&(t=t.derivedCommands.color2D),t.modelMatrix=i,t.boundingVolume=r,t.cull=o,t.debugShowBoundingVolume=s,n.commandList.push(t)}function t1e(e,t,n,i,o,r,s){let a=e._primitive;Rn._updateBoundingVolumes(a,t,o);let l;t.mode===oe.SCENE3D?l=a._boundingSphereWC:t.mode===oe.COLUMBUS_VIEW?l=a._boundingSphereCV:t.mode===oe.SCENE2D&&c(a._boundingSphere2D)?l=a._boundingSphere2D:c(a._boundingSphereMorph)&&(l=a._boundingSphereMorph);let u=t.mode===oe.MORPHING,f=e.classificationType,d=f!==Vn.CESIUM_3D_TILE,p=f!==Vn.TERRAIN&&!u,g,m=t.passes;if(m.render||m.pick&&a.allowPicking){let b=n.length;for(let x=0;x<b;++x){let T=l[x];d&&(g=n[x],xte(e,g,t,o,r,T,s)),p&&(g=n[x].derivedCommands.tileset,xte(e,g,t,o,r,T,s))}}}Nm.prototype.update=function(e){if(!c(this._primitive)&&!c(this.geometryInstances))return;if(!di.initialized){if(!this.asynchronous)throw new E("For synchronous GroundPolylinePrimitives, you must call GroundPolylinePrimitives.initializeTerrainHeights() and wait for the returned promise to resolve.");Nm.initializeTerrainHeights();return}let t,n=this,i=this._primitiveOptions;if(!c(this._primitive)){let o=Array.isArray(this.geometryInstances)?this.geometryInstances:[this.geometryInstances],r=o.length,s=new Array(r),a;for(t=0;t<r;++t)if(a=o[t].attributes,!c(a)||!c(a.color)){this._hasPerInstanceColors=!1;break}for(t=0;t<r;++t){let l=o[t];a={};let u=l.attributes;for(let f in u)u.hasOwnProperty(f)&&(a[f]=u[f]);c(a.width)||(a.width=new Zc({componentDatatype:$.UNSIGNED_BYTE,componentsPerAttribute:1,value:[l.geometry.width]})),l.geometry._scene3DOnly=e.scene3DOnly,jE.setProjectionAndEllipsoid(l.geometry,e.mapProjection),s[t]=new vt({geometry:l.geometry,attributes:a,id:l.id,pickPrimitive:n})}i.geometryInstances=s,i.appearance=this.appearance,i._createShaderProgramFunction=function(l,u,f){QOe(n,u,f)},i._createCommandsFunction=function(l,u,f,d,p,g,m){e1e(n,u,f,d,g,m)},i._updateAndQueueCommandsFunction=function(l,u,f,d,p,g,m,b){t1e(n,u,f,d,p,g,m)},this._primitive=new Rn(i)}if(this.appearance instanceof us&&!this._hasPerInstanceColors)throw new E("All GeometryInstances must have color attributes to use PolylineColorAppearance with GroundPolylinePrimitive.");this._primitive.appearance=this.appearance,this._primitive.show=this.show,this._primitive.debugShowBoundingVolume=this.debugShowBoundingVolume,this._primitive.update(e),e.afterRender.push(()=>{!this._ready&&c(this._primitive)&&this._primitive.ready&&(this._ready=!0,this.releaseGeometryInstances&&(this.geometryInstances=void 0))})};Nm.prototype.getGeometryInstanceAttributes=function(e){if(!c(this._primitive))throw new E("must call update before calling getGeometryInstanceAttributes");return this._primitive.getGeometryInstanceAttributes(e)};Nm.isSupported=function(e){return e.frameState.context.depthTexture};Nm.prototype.isDestroyed=function(){return!1};Nm.prototype.destroy=function(){return this._primitive=this._primitive&&this._primitive.destroy(),this._sp=this._sp&&this._sp.destroy(),this._sp2D=void 0,this._spMorph=void 0,de(this)};var Fm=Nm;var n1e=new H(1,1),i1e=!1,o1e=j.WHITE;function $x(e){e=y(e,y.EMPTY_OBJECT),this._definitionChanged=new pe,this._image=void 0,this._imageSubscription=void 0,this._repeat=void 0,this._repeatSubscription=void 0,this._color=void 0,this._colorSubscription=void 0,this._transparent=void 0,this._transparentSubscription=void 0,this.image=e.image,this.repeat=e.repeat,this.color=e.color,this.transparent=e.transparent}Object.defineProperties($x.prototype,{isConstant:{get:function(){return X.isConstant(this._image)&&X.isConstant(this._repeat)}},definitionChanged:{get:function(){return this._definitionChanged}},image:fe("image"),repeat:fe("repeat"),color:fe("color"),transparent:fe("transparent")});$x.prototype.getType=function(e){return"Image"};var r1e=new J;$x.prototype.getValue=function(e,t){return c(e)||(e=J.now(r1e)),c(t)||(t={}),t.image=X.getValueOrUndefined(this._image,e),t.repeat=X.getValueOrClonedDefault(this._repeat,e,n1e,t.repeat),t.color=X.getValueOrClonedDefault(this._color,e,o1e,t.color),X.getValueOrDefault(this._transparent,e,i1e)&&(t.color.alpha=Math.min(.99,t.color.alpha)),t};$x.prototype.equals=function(e){return this===e||e instanceof $x&&X.equals(this._image,e._image)&&X.equals(this._repeat,e._repeat)&&X.equals(this._color,e._color)&&X.equals(this._transparent,e._transparent)};var Zx=$x;function s1e(e){if(e instanceof j)return new Ht(e);if(typeof e=="string"||e instanceof De||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement){let t=new Zx;return t.image=e,t}throw new E(`Unable to infer material type: ${e}`)}function a1e(e,t){return fe(e,t,s1e)}var Uo=a1e;function qE(e){this._definitionChanged=new pe,this._show=void 0,this._showSubscription=void 0,this._dimensions=void 0,this._dimensionsSubscription=void 0,this._heightReference=void 0,this._heightReferenceSubscription=void 0,this._fill=void 0,this._fillSubscription=void 0,this._material=void 0,this._materialSubscription=void 0,this._outline=void 0,this._outlineSubscription=void 0,this._outlineColor=void 0,this._outlineColorSubscription=void 0,this._outlineWidth=void 0,this._outlineWidthSubscription=void 0,this._shadows=void 0,this._shadowsSubscription=void 0,this._distanceDisplayCondition=void 0,this._distanceDisplayConditionSubscription=void 0,this.merge(y(e,y.EMPTY_OBJECT))}Object.defineProperties(qE.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:fe("show"),dimensions:fe("dimensions"),heightReference:fe("heightReference"),fill:fe("fill"),material:Uo("material"),outline:fe("outline"),outlineColor:fe("outlineColor"),outlineWidth:fe("outlineWidth"),shadows:fe("shadows"),distanceDisplayCondition:fe("distanceDisplayCondition")});qE.prototype.clone=function(e){return c(e)?(e.show=this.show,e.dimensions=this.dimensions,e.heightReference=this.heightReference,e.fill=this.fill,e.material=this.material,e.outline=this.outline,e.outlineColor=this.outlineColor,e.outlineWidth=this.outlineWidth,e.shadows=this.shadows,e.distanceDisplayCondition=this.distanceDisplayCondition,e):new qE(this)};qE.prototype.merge=function(e){if(!c(e))throw new E("source is required.");this.show=y(this.show,e.show),this.dimensions=y(this.dimensions,e.dimensions),this.heightReference=y(this.heightReference,e.heightReference),this.fill=y(this.fill,e.fill),this.material=y(this.material,e.material),this.outline=y(this.outline,e.outline),this.outlineColor=y(this.outlineColor,e.outlineColor),this.outlineWidth=y(this.outlineWidth,e.outlineWidth),this.shadows=y(this.shadows,e.shadows),this.distanceDisplayCondition=y(this.distanceDisplayCondition,e.distanceDisplayCondition)};var YE=qE;var c1e={FIXED:0,INERTIAL:1},ji=Object.freeze(c1e);function Jx(){E.throwInstantiationError()}Object.defineProperties(Jx.prototype,{isConstant:{get:E.throwInstantiationError},definitionChanged:{get:E.throwInstantiationError},referenceFrame:{get:E.throwInstantiationError}});Jx.prototype.getValue=E.throwInstantiationError;Jx.prototype.getValueInReferenceFrame=E.throwInstantiationError;Jx.prototype.equals=E.throwInstantiationError;var Tte=new Q;Jx.convertToReferenceFrame=function(e,t,n,i,o){if(!c(t))return t;if(c(o)||(o=new h),n===i)return h.clone(t,o);let r=Ft.computeIcrfToCentralBodyFixedMatrix(e,Tte);if(n===ji.INERTIAL)return Q.multiplyByVector(r,t,o);if(n===ji.FIXED)return Q.multiplyByVector(Q.transpose(r,Tte),t,o)};var Bm=Jx;function Zy(e,t){this._definitionChanged=new pe,this._value=h.clone(e),this._referenceFrame=y(t,ji.FIXED)}Object.defineProperties(Zy.prototype,{isConstant:{get:function(){return!c(this._value)||this._referenceFrame===ji.FIXED}},definitionChanged:{get:function(){return this._definitionChanged}},referenceFrame:{get:function(){return this._referenceFrame}}});var l1e=new J;Zy.prototype.getValue=function(e,t){return c(e)||(e=J.now(l1e)),this.getValueInReferenceFrame(e,ji.FIXED,t)};Zy.prototype.setValue=function(e,t){let n=!1;h.equals(this._value,e)||(n=!0,this._value=h.clone(e)),c(t)&&this._referenceFrame!==t&&(n=!0,this._referenceFrame=t),n&&this._definitionChanged.raiseEvent(this)};Zy.prototype.getValueInReferenceFrame=function(e,t,n){if(!c(e))throw new E("time is required.");if(!c(t))throw new E("referenceFrame is required.");return Bm.convertToReferenceFrame(e,this._value,this._referenceFrame,t,n)};Zy.prototype.equals=function(e){return this===e||e instanceof Zy&&h.equals(this._value,e._value)&&this._referenceFrame===e._referenceFrame};var Qc=Zy;function XE(e){this._definitionChanged=new pe,this._show=void 0,this._showSubscription=void 0,this._positions=void 0,this._positionsSubscription=void 0,this._width=void 0,this._widthSubscription=void 0,this._height=void 0,this._heightSubscription=void 0,this._heightReference=void 0,this._heightReferenceSubscription=void 0,this._extrudedHeight=void 0,this._extrudedHeightSubscription=void 0,this._extrudedHeightReference=void 0,this._extrudedHeightReferenceSubscription=void 0,this._cornerType=void 0,this._cornerTypeSubscription=void 0,this._granularity=void 0,this._granularitySubscription=void 0,this._fill=void 0,this._fillSubscription=void 0,this._material=void 0,this._materialSubscription=void 0,this._outline=void 0,this._outlineSubscription=void 0,this._outlineColor=void 0,this._outlineColorSubscription=void 0,this._outlineWidth=void 0,this._outlineWidthSubscription=void 0,this._shadows=void 0,this._shadowsSubscription=void 0,this._distanceDisplayCondition=void 0,this._distanceDisplayConditionSubscription=void 0,this._classificationType=void 0,this._classificationTypeSubscription=void 0,this._zIndex=void 0,this._zIndexSubscription=void 0,this.merge(y(e,y.EMPTY_OBJECT))}Object.defineProperties(XE.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:fe("show"),positions:fe("positions"),width:fe("width"),height:fe("height"),heightReference:fe("heightReference"),extrudedHeight:fe("extrudedHeight"),extrudedHeightReference:fe("extrudedHeightReference"),cornerType:fe("cornerType"),granularity:fe("granularity"),fill:fe("fill"),material:Uo("material"),outline:fe("outline"),outlineColor:fe("outlineColor"),outlineWidth:fe("outlineWidth"),shadows:fe("shadows"),distanceDisplayCondition:fe("distanceDisplayCondition"),classificationType:fe("classificationType"),zIndex:fe("zIndex")});XE.prototype.clone=function(e){return c(e)?(e.show=this.show,e.positions=this.positions,e.width=this.width,e.height=this.height,e.heightReference=this.heightReference,e.extrudedHeight=this.extrudedHeight,e.extrudedHeightReference=this.extrudedHeightReference,e.cornerType=this.cornerType,e.granularity=this.granularity,e.fill=this.fill,e.material=this.material,e.outline=this.outline,e.outlineColor=this.outlineColor,e.outlineWidth=this.outlineWidth,e.shadows=this.shadows,e.distanceDisplayCondition=this.distanceDisplayCondition,e.classificationType=this.classificationType,e.zIndex=this.zIndex,e):new XE(this)};XE.prototype.merge=function(e){if(!c(e))throw new E("source is required.");this.show=y(this.show,e.show),this.positions=y(this.positions,e.positions),this.width=y(this.width,e.width),this.height=y(this.height,e.height),this.heightReference=y(this.heightReference,e.heightReference),this.extrudedHeight=y(this.extrudedHeight,e.extrudedHeight),this.extrudedHeightReference=y(this.extrudedHeightReference,e.extrudedHeightReference),this.cornerType=y(this.cornerType,e.cornerType),this.granularity=y(this.granularity,e.granularity),this.fill=y(this.fill,e.fill),this.material=y(this.material,e.material),this.outline=y(this.outline,e.outline),this.outlineColor=y(this.outlineColor,e.outlineColor),this.outlineWidth=y(this.outlineWidth,e.outlineWidth),this.shadows=y(this.shadows,e.shadows),this.distanceDisplayCondition=y(this.distanceDisplayCondition,e.distanceDisplayCondition),this.classificationType=y(this.classificationType,e.classificationType),this.zIndex=y(this.zIndex,e.zIndex)};var KE=XE;function u1e(e){return e}function f1e(e,t){return fe(e,t,u1e)}var ku=f1e;function $E(e){this._definitionChanged=new pe,this._show=void 0,this._showSubscription=void 0,this._length=void 0,this._lengthSubscription=void 0,this._topRadius=void 0,this._topRadiusSubscription=void 0,this._bottomRadius=void 0,this._bottomRadiusSubscription=void 0,this._heightReference=void 0,this._heightReferenceSubscription=void 0,this._fill=void 0,this._fillSubscription=void 0,this._material=void 0,this._materialSubscription=void 0,this._outline=void 0,this._outlineSubscription=void 0,this._outlineColor=void 0,this._outlineColorSubscription=void 0,this._outlineWidth=void 0,this._outlineWidthSubscription=void 0,this._numberOfVerticalLines=void 0,this._numberOfVerticalLinesSubscription=void 0,this._slices=void 0,this._slicesSubscription=void 0,this._shadows=void 0,this._shadowsSubscription=void 0,this._distanceDisplayCondition=void 0,this._distanceDisplayConditionSubscription=void 0,this.merge(y(e,y.EMPTY_OBJECT))}Object.defineProperties($E.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:fe("show"),length:fe("length"),topRadius:fe("topRadius"),bottomRadius:fe("bottomRadius"),heightReference:fe("heightReference"),fill:fe("fill"),material:Uo("material"),outline:fe("outline"),outlineColor:fe("outlineColor"),outlineWidth:fe("outlineWidth"),numberOfVerticalLines:fe("numberOfVerticalLines"),slices:fe("slices"),shadows:fe("shadows"),distanceDisplayCondition:fe("distanceDisplayCondition")});$E.prototype.clone=function(e){return c(e)?(e.show=this.show,e.length=this.length,e.topRadius=this.topRadius,e.bottomRadius=this.bottomRadius,e.heightReference=this.heightReference,e.fill=this.fill,e.material=this.material,e.outline=this.outline,e.outlineColor=this.outlineColor,e.outlineWidth=this.outlineWidth,e.numberOfVerticalLines=this.numberOfVerticalLines,e.slices=this.slices,e.shadows=this.shadows,e.distanceDisplayCondition=this.distanceDisplayCondition,e):new $E(this)};$E.prototype.merge=function(e){if(!c(e))throw new E("source is required.");this.show=y(this.show,e.show),this.length=y(this.length,e.length),this.topRadius=y(this.topRadius,e.topRadius),this.bottomRadius=y(this.bottomRadius,e.bottomRadius),this.heightReference=y(this.heightReference,e.heightReference),this.fill=y(this.fill,e.fill),this.material=y(this.material,e.material),this.outline=y(this.outline,e.outline),this.outlineColor=y(this.outlineColor,e.outlineColor),this.outlineWidth=y(this.outlineWidth,e.outlineWidth),this.numberOfVerticalLines=y(this.numberOfVerticalLines,e.numberOfVerticalLines),this.slices=y(this.slices,e.slices),this.shadows=y(this.shadows,e.shadows),this.distanceDisplayCondition=y(this.distanceDisplayCondition,e.distanceDisplayCondition)};var ZE=$E;function JE(e){this._definitionChanged=new pe,this._show=void 0,this._showSubscription=void 0,this._semiMajorAxis=void 0,this._semiMajorAxisSubscription=void 0,this._semiMinorAxis=void 0,this._semiMinorAxisSubscription=void 0,this._height=void 0,this._heightSubscription=void 0,this._heightReference=void 0,this._heightReferenceSubscription=void 0,this._extrudedHeight=void 0,this._extrudedHeightSubscription=void 0,this._extrudedHeightReference=void 0,this._extrudedHeightReferenceSubscription=void 0,this._rotation=void 0,this._rotationSubscription=void 0,this._stRotation=void 0,this._stRotationSubscription=void 0,this._granularity=void 0,this._granularitySubscription=void 0,this._fill=void 0,this._fillSubscription=void 0,this._material=void 0,this._materialSubscription=void 0,this._outline=void 0,this._outlineSubscription=void 0,this._outlineColor=void 0,this._outlineColorSubscription=void 0,this._outlineWidth=void 0,this._outlineWidthSubscription=void 0,this._numberOfVerticalLines=void 0,this._numberOfVerticalLinesSubscription=void 0,this._shadows=void 0,this._shadowsSubscription=void 0,this._distanceDisplayCondition=void 0,this._distanceDisplayConditionSubscription=void 0,this._classificationType=void 0,this._classificationTypeSubscription=void 0,this._zIndex=void 0,this._zIndexSubscription=void 0,this.merge(y(e,y.EMPTY_OBJECT))}Object.defineProperties(JE.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:fe("show"),semiMajorAxis:fe("semiMajorAxis"),semiMinorAxis:fe("semiMinorAxis"),height:fe("height"),heightReference:fe("heightReference"),extrudedHeight:fe("extrudedHeight"),extrudedHeightReference:fe("extrudedHeightReference"),rotation:fe("rotation"),stRotation:fe("stRotation"),granularity:fe("granularity"),fill:fe("fill"),material:Uo("material"),outline:fe("outline"),outlineColor:fe("outlineColor"),outlineWidth:fe("outlineWidth"),numberOfVerticalLines:fe("numberOfVerticalLines"),shadows:fe("shadows"),distanceDisplayCondition:fe("distanceDisplayCondition"),classificationType:fe("classificationType"),zIndex:fe("zIndex")});JE.prototype.clone=function(e){return c(e)?(e.show=this.show,e.semiMajorAxis=this.semiMajorAxis,e.semiMinorAxis=this.semiMinorAxis,e.height=this.height,e.heightReference=this.heightReference,e.extrudedHeight=this.extrudedHeight,e.extrudedHeightReference=this.extrudedHeightReference,e.rotation=this.rotation,e.stRotation=this.stRotation,e.granularity=this.granularity,e.fill=this.fill,e.material=this.material,e.outline=this.outline,e.outlineColor=this.outlineColor,e.outlineWidth=this.outlineWidth,e.numberOfVerticalLines=this.numberOfVerticalLines,e.shadows=this.shadows,e.distanceDisplayCondition=this.distanceDisplayCondition,e.classificationType=this.classificationType,e.zIndex=this.zIndex,e):new JE(this)};JE.prototype.merge=function(e){if(!c(e))throw new E("source is required.");this.show=y(this.show,e.show),this.semiMajorAxis=y(this.semiMajorAxis,e.semiMajorAxis),this.semiMinorAxis=y(this.semiMinorAxis,e.semiMinorAxis),this.height=y(this.height,e.height),this.heightReference=y(this.heightReference,e.heightReference),this.extrudedHeight=y(this.extrudedHeight,e.extrudedHeight),this.extrudedHeightReference=y(this.extrudedHeightReference,e.extrudedHeightReference),this.rotation=y(this.rotation,e.rotation),this.stRotation=y(this.stRotation,e.stRotation),this.granularity=y(this.granularity,e.granularity),this.fill=y(this.fill,e.fill),this.material=y(this.material,e.material),this.outline=y(this.outline,e.outline),this.outlineColor=y(this.outlineColor,e.outlineColor),this.outlineWidth=y(this.outlineWidth,e.outlineWidth),this.numberOfVerticalLines=y(this.numberOfVerticalLines,e.numberOfVerticalLines),this.shadows=y(this.shadows,e.shadows),this.distanceDisplayCondition=y(this.distanceDisplayCondition,e.distanceDisplayCondition),this.classificationType=y(this.classificationType,e.classificationType),this.zIndex=y(this.zIndex,e.zIndex)};var QE=JE;function eS(e){this._definitionChanged=new pe,this._show=void 0,this._showSubscription=void 0,this._radii=void 0,this._radiiSubscription=void 0,this._innerRadii=void 0,this._innerRadiiSubscription=void 0,this._minimumClock=void 0,this._minimumClockSubscription=void 0,this._maximumClock=void 0,this._maximumClockSubscription=void 0,this._minimumCone=void 0,this._minimumConeSubscription=void 0,this._maximumCone=void 0,this._maximumConeSubscription=void 0,this._heightReference=void 0,this._heightReferenceSubscription=void 0,this._fill=void 0,this._fillSubscription=void 0,this._material=void 0,this._materialSubscription=void 0,this._outline=void 0,this._outlineSubscription=void 0,this._outlineColor=void 0,this._outlineColorSubscription=void 0,this._outlineWidth=void 0,this._outlineWidthSubscription=void 0,this._stackPartitions=void 0,this._stackPartitionsSubscription=void 0,this._slicePartitions=void 0,this._slicePartitionsSubscription=void 0,this._subdivisions=void 0,this._subdivisionsSubscription=void 0,this._shadows=void 0,this._shadowsSubscription=void 0,this._distanceDisplayCondition=void 0,this._distanceDisplayConditionSubscription=void 0,this.merge(y(e,y.EMPTY_OBJECT))}Object.defineProperties(eS.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:fe("show"),radii:fe("radii"),innerRadii:fe("innerRadii"),minimumClock:fe("minimumClock"),maximumClock:fe("maximumClock"),minimumCone:fe("minimumCone"),maximumCone:fe("maximumCone"),heightReference:fe("heightReference"),fill:fe("fill"),material:Uo("material"),outline:fe("outline"),outlineColor:fe("outlineColor"),outlineWidth:fe("outlineWidth"),stackPartitions:fe("stackPartitions"),slicePartitions:fe("slicePartitions"),subdivisions:fe("subdivisions"),shadows:fe("shadows"),distanceDisplayCondition:fe("distanceDisplayCondition")});eS.prototype.clone=function(e){return c(e)?(e.show=this.show,e.radii=this.radii,e.innerRadii=this.innerRadii,e.minimumClock=this.minimumClock,e.maximumClock=this.maximumClock,e.minimumCone=this.minimumCone,e.maximumCone=this.maximumCone,e.heightReference=this.heightReference,e.fill=this.fill,e.material=this.material,e.outline=this.outline,e.outlineColor=this.outlineColor,e.outlineWidth=this.outlineWidth,e.stackPartitions=this.stackPartitions,e.slicePartitions=this.slicePartitions,e.subdivisions=this.subdivisions,e.shadows=this.shadows,e.distanceDisplayCondition=this.distanceDisplayCondition,e):new eS(this)};eS.prototype.merge=function(e){if(!c(e))throw new E("source is required.");this.show=y(this.show,e.show),this.radii=y(this.radii,e.radii),this.innerRadii=y(this.innerRadii,e.innerRadii),this.minimumClock=y(this.minimumClock,e.minimumClock),this.maximumClock=y(this.maximumClock,e.maximumClock),this.minimumCone=y(this.minimumCone,e.minimumCone),this.maximumCone=y(this.maximumCone,e.maximumCone),this.heightReference=y(this.heightReference,e.heightReference),this.fill=y(this.fill,e.fill),this.material=y(this.material,e.material),this.outline=y(this.outline,e.outline),this.outlineColor=y(this.outlineColor,e.outlineColor),this.outlineWidth=y(this.outlineWidth,e.outlineWidth),this.stackPartitions=y(this.stackPartitions,e.stackPartitions),this.slicePartitions=y(this.slicePartitions,e.slicePartitions),this.subdivisions=y(this.subdivisions,e.subdivisions),this.shadows=y(this.shadows,e.shadows),this.distanceDisplayCondition=y(this.distanceDisplayCondition,e.distanceDisplayCondition)};var tS=eS;function nS(e){this._definitionChanged=new pe,this._show=void 0,this._showSubscription=void 0,this._text=void 0,this._textSubscription=void 0,this._font=void 0,this._fontSubscription=void 0,this._style=void 0,this._styleSubscription=void 0,this._scale=void 0,this._scaleSubscription=void 0,this._showBackground=void 0,this._showBackgroundSubscription=void 0,this._backgroundColor=void 0,this._backgroundColorSubscription=void 0,this._backgroundPadding=void 0,this._backgroundPaddingSubscription=void 0,this._pixelOffset=void 0,this._pixelOffsetSubscription=void 0,this._eyeOffset=void 0,this._eyeOffsetSubscription=void 0,this._horizontalOrigin=void 0,this._horizontalOriginSubscription=void 0,this._verticalOrigin=void 0,this._verticalOriginSubscription=void 0,this._heightReference=void 0,this._heightReferenceSubscription=void 0,this._fillColor=void 0,this._fillColorSubscription=void 0,this._outlineColor=void 0,this._outlineColorSubscription=void 0,this._outlineWidth=void 0,this._outlineWidthSubscription=void 0,this._translucencyByDistance=void 0,this._translucencyByDistanceSubscription=void 0,this._pixelOffsetScaleByDistance=void 0,this._pixelOffsetScaleByDistanceSubscription=void 0,this._scaleByDistance=void 0,this._scaleByDistanceSubscription=void 0,this._distanceDisplayCondition=void 0,this._distanceDisplayConditionSubscription=void 0,this._disableDepthTestDistance=void 0,this._disableDepthTestDistanceSubscription=void 0,this.merge(y(e,y.EMPTY_OBJECT))}Object.defineProperties(nS.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:fe("show"),text:fe("text"),font:fe("font"),style:fe("style"),scale:fe("scale"),showBackground:fe("showBackground"),backgroundColor:fe("backgroundColor"),backgroundPadding:fe("backgroundPadding"),pixelOffset:fe("pixelOffset"),eyeOffset:fe("eyeOffset"),horizontalOrigin:fe("horizontalOrigin"),verticalOrigin:fe("verticalOrigin"),heightReference:fe("heightReference"),fillColor:fe("fillColor"),outlineColor:fe("outlineColor"),outlineWidth:fe("outlineWidth"),translucencyByDistance:fe("translucencyByDistance"),pixelOffsetScaleByDistance:fe("pixelOffsetScaleByDistance"),scaleByDistance:fe("scaleByDistance"),distanceDisplayCondition:fe("distanceDisplayCondition"),disableDepthTestDistance:fe("disableDepthTestDistance")});nS.prototype.clone=function(e){return c(e)?(e.show=this.show,e.text=this.text,e.font=this.font,e.style=this.style,e.scale=this.scale,e.showBackground=this.showBackground,e.backgroundColor=this.backgroundColor,e.backgroundPadding=this.backgroundPadding,e.pixelOffset=this.pixelOffset,e.eyeOffset=this.eyeOffset,e.horizontalOrigin=this.horizontalOrigin,e.verticalOrigin=this.verticalOrigin,e.heightReference=this.heightReference,e.fillColor=this.fillColor,e.outlineColor=this.outlineColor,e.outlineWidth=this.outlineWidth,e.translucencyByDistance=this.translucencyByDistance,e.pixelOffsetScaleByDistance=this.pixelOffsetScaleByDistance,e.scaleByDistance=this.scaleByDistance,e.distanceDisplayCondition=this.distanceDisplayCondition,e.disableDepthTestDistance=this.disableDepthTestDistance,e):new nS(this)};nS.prototype.merge=function(e){if(!c(e))throw new E("source is required.");this.show=y(this.show,e.show),this.text=y(this.text,e.text),this.font=y(this.font,e.font),this.style=y(this.style,e.style),this.scale=y(this.scale,e.scale),this.showBackground=y(this.showBackground,e.showBackground),this.backgroundColor=y(this.backgroundColor,e.backgroundColor),this.backgroundPadding=y(this.backgroundPadding,e.backgroundPadding),this.pixelOffset=y(this.pixelOffset,e.pixelOffset),this.eyeOffset=y(this.eyeOffset,e.eyeOffset),this.horizontalOrigin=y(this.horizontalOrigin,e.horizontalOrigin),this.verticalOrigin=y(this.verticalOrigin,e.verticalOrigin),this.heightReference=y(this.heightReference,e.heightReference),this.fillColor=y(this.fillColor,e.fillColor),this.outlineColor=y(this.outlineColor,e.outlineColor),this.outlineWidth=y(this.outlineWidth,e.outlineWidth),this.translucencyByDistance=y(this.translucencyByDistance,e.translucencyByDistance),this.pixelOffsetScaleByDistance=y(this.pixelOffsetScaleByDistance,e.pixelOffsetScaleByDistance),this.scaleByDistance=y(this.scaleByDistance,e.scaleByDistance),this.distanceDisplayCondition=y(this.distanceDisplayCondition,e.distanceDisplayCondition),this.disableDepthTestDistance=y(this.disableDepthTestDistance,e.disableDepthTestDistance)};var km=nS;var d1e=new h(1,1,1),h1e=h.ZERO,m1e=Ne.IDENTITY;function Ate(e,t,n){this.translation=h.clone(y(e,h1e)),this.rotation=Ne.clone(y(t,m1e)),this.scale=h.clone(y(n,d1e))}Ate.prototype.equals=function(e){return this===e||c(e)&&h.equals(this.translation,e.translation)&&Ne.equals(this.rotation,e.rotation)&&h.equals(this.scale,e.scale)};var Qx=Ate;var EU=new Qx;function iS(e){e=y(e,y.EMPTY_OBJECT),this._definitionChanged=new pe,this._translation=void 0,this._translationSubscription=void 0,this._rotation=void 0,this._rotationSubscription=void 0,this._scale=void 0,this._scaleSubscription=void 0,this.translation=e.translation,this.rotation=e.rotation,this.scale=e.scale}Object.defineProperties(iS.prototype,{isConstant:{get:function(){return X.isConstant(this._translation)&&X.isConstant(this._rotation)&&X.isConstant(this._scale)}},definitionChanged:{get:function(){return this._definitionChanged}},translation:fe("translation"),rotation:fe("rotation"),scale:fe("scale")});var p1e=new J;iS.prototype.getValue=function(e,t){return c(e)||(e=J.now(p1e)),c(t)||(t=new Qx),t.translation=X.getValueOrClonedDefault(this._translation,e,EU.translation,t.translation),t.rotation=X.getValueOrClonedDefault(this._rotation,e,EU.rotation,t.rotation),t.scale=X.getValueOrClonedDefault(this._scale,e,EU.scale,t.scale),t};iS.prototype.equals=function(e){return this===e||e instanceof iS&&X.equals(this._translation,e._translation)&&X.equals(this._rotation,e._rotation)&&X.equals(this._scale,e._scale)};var oS=iS;function Vm(e,t){this._propertyNames=[],this._definitionChanged=new pe,c(e)&&this.merge(e,t)}Object.defineProperties(Vm.prototype,{propertyNames:{get:function(){return this._propertyNames}},isConstant:{get:function(){let e=this._propertyNames;for(let t=0,n=e.length;t<n;t++)if(!X.isConstant(this[e[t]]))return!1;return!0}},definitionChanged:{get:function(){return this._definitionChanged}}});Vm.prototype.hasProperty=function(e){return this._propertyNames.indexOf(e)!==-1};function _1e(e){return new Kn(e)}Vm.prototype.addProperty=function(e,t,n){let i=this._propertyNames;if(!c(e))throw new E("propertyName is required.");if(i.indexOf(e)!==-1)throw new E(`${e} is already a registered property.`);i.push(e),Object.defineProperty(this,e,fe(e,!0,y(n,_1e))),c(t)&&(this[e]=t),this._definitionChanged.raiseEvent(this)};Vm.prototype.removeProperty=function(e){let n=this._propertyNames.indexOf(e);if(!c(e))throw new E("propertyName is required.");if(n===-1)throw new E(`${e} is not a registered property.`);this._propertyNames.splice(n,1),delete this[e],this._definitionChanged.raiseEvent(this)};var g1e=new J;Vm.prototype.getValue=function(e,t){c(e)||(e=J.now(g1e)),c(t)||(t={});let n=this._propertyNames;for(let i=0,o=n.length;i<o;i++){let r=n[i];t[r]=X.getValueOrUndefined(this[r],e,t[r])}return t};Vm.prototype.merge=function(e,t){if(!c(e))throw new E("source is required.");let n=this._propertyNames,i=c(e._propertyNames)?e._propertyNames:Object.keys(e);for(let o=0,r=i.length;o<r;o++){let s=i[o],a=this[s],l=e[s];a===void 0&&n.indexOf(s)===-1&&this.addProperty(s,void 0,t),l!==void 0&&(a!==void 0?c(a)&&c(a.merge)&&a.merge(l):c(l)&&c(l.merge)&&c(l.clone)?this[s]=l.clone():this[s]=l)}};function y1e(e,t){let n=e._propertyNames,i=t._propertyNames,o=n.length;if(o!==i.length)return!1;for(let r=0;r<o;++r){let s=n[r];if(i.indexOf(s)===-1||!X.equals(e[s],t[s]))return!1}return!0}Vm.prototype.equals=function(e){return this===e||e instanceof Vm&&y1e(this,e)};var Vu=Vm;function Cte(e){return new oS(e)}function b1e(e){return new Vu(e,Cte)}function x1e(e){return new Vu(e)}function rS(e){this._definitionChanged=new pe,this._show=void 0,this._showSubscription=void 0,this._uri=void 0,this._uriSubscription=void 0,this._scale=void 0,this._scaleSubscription=void 0,this._hasVerticalExaggeration=void 0,this._hasVerticalExaggerationSubscription=void 0,this._enableVerticalExaggeration=void 0,this._enableVerticalExaggerationSubscription=void 0,this._minimumPixelSize=void 0,this._minimumPixelSizeSubscription=void 0,this._maximumScale=void 0,this._maximumScaleSubscription=void 0,this._incrementallyLoadTextures=void 0,this._incrementallyLoadTexturesSubscription=void 0,this._runAnimations=void 0,this._runAnimationsSubscription=void 0,this._clampAnimations=void 0,this._clampAnimationsSubscription=void 0,this._shadows=void 0,this._shadowsSubscription=void 0,this._heightReference=void 0,this._heightReferenceSubscription=void 0,this._silhouetteColor=void 0,this._silhouetteColorSubscription=void 0,this._silhouetteSize=void 0,this._silhouetteSizeSubscription=void 0,this._color=void 0,this._colorSubscription=void 0,this._colorBlendMode=void 0,this._colorBlendModeSubscription=void 0,this._colorBlendAmount=void 0,this._colorBlendAmountSubscription=void 0,this._imageBasedLightingFactor=void 0,this._imageBasedLightingFactorSubscription=void 0,this._lightColor=void 0,this._lightColorSubscription=void 0,this._distanceDisplayCondition=void 0,this._distanceDisplayConditionSubscription=void 0,this._nodeTransformations=void 0,this._nodeTransformationsSubscription=void 0,this._articulations=void 0,this._articulationsSubscription=void 0,this._clippingPlanes=void 0,this._clippingPlanesSubscription=void 0,this._customShader=void 0,this._customShaderSubscription=void 0,this.merge(y(e,y.EMPTY_OBJECT))}Object.defineProperties(rS.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:fe("show"),uri:fe("uri"),scale:fe("scale"),enableVerticalExaggeration:fe("enableVerticalExaggeration"),minimumPixelSize:fe("minimumPixelSize"),maximumScale:fe("maximumScale"),incrementallyLoadTextures:fe("incrementallyLoadTextures"),runAnimations:fe("runAnimations"),clampAnimations:fe("clampAnimations"),shadows:fe("shadows"),heightReference:fe("heightReference"),silhouetteColor:fe("silhouetteColor"),silhouetteSize:fe("silhouetteSize"),color:fe("color"),colorBlendMode:fe("colorBlendMode"),colorBlendAmount:fe("colorBlendAmount"),imageBasedLightingFactor:fe("imageBasedLightingFactor"),lightColor:fe("lightColor"),distanceDisplayCondition:fe("distanceDisplayCondition"),nodeTransformations:fe("nodeTransformations",void 0,b1e),articulations:fe("articulations",void 0,x1e),clippingPlanes:fe("clippingPlanes"),customShader:fe("customShader")});rS.prototype.clone=function(e){return c(e)?(e.show=this.show,e.uri=this.uri,e.scale=this.scale,e.enableVerticalExaggeration=this.enableVerticalExaggeration,e.minimumPixelSize=this.minimumPixelSize,e.maximumScale=this.maximumScale,e.incrementallyLoadTextures=this.incrementallyLoadTextures,e.runAnimations=this.runAnimations,e.clampAnimations=this.clampAnimations,e.heightReference=this._heightReference,e.silhouetteColor=this.silhouetteColor,e.silhouetteSize=this.silhouetteSize,e.color=this.color,e.colorBlendMode=this.colorBlendMode,e.colorBlendAmount=this.colorBlendAmount,e.imageBasedLightingFactor=this.imageBasedLightingFactor,e.lightColor=this.lightColor,e.distanceDisplayCondition=this.distanceDisplayCondition,e.nodeTransformations=this.nodeTransformations,e.articulations=this.articulations,e.clippingPlanes=this.clippingPlanes,e.customShader=this.customShader,e):new rS(this)};rS.prototype.merge=function(e){if(!c(e))throw new E("source is required.");this.show=y(this.show,e.show),this.uri=y(this.uri,e.uri),this.scale=y(this.scale,e.scale),this.enableVerticalExaggeration=y(this.enableVerticalExaggeration,e.enableVerticalExaggeration),this.minimumPixelSize=y(this.minimumPixelSize,e.minimumPixelSize),this.maximumScale=y(this.maximumScale,e.maximumScale),this.incrementallyLoadTextures=y(this.incrementallyLoadTextures,e.incrementallyLoadTextures),this.runAnimations=y(this.runAnimations,e.runAnimations),this.clampAnimations=y(this.clampAnimations,e.clampAnimations),this.shadows=y(this.shadows,e.shadows),this.heightReference=y(this.heightReference,e.heightReference),this.silhouetteColor=y(this.silhouetteColor,e.silhouetteColor),this.silhouetteSize=y(this.silhouetteSize,e.silhouetteSize),this.color=y(this.color,e.color),this.colorBlendMode=y(this.colorBlendMode,e.colorBlendMode),this.colorBlendAmount=y(this.colorBlendAmount,e.colorBlendAmount),this.imageBasedLightingFactor=y(this.imageBasedLightingFactor,e.imageBasedLightingFactor),this.lightColor=y(this.lightColor,e.lightColor),this.distanceDisplayCondition=y(this.distanceDisplayCondition,e.distanceDisplayCondition),this.clippingPlanes=y(this.clippingPlanes,e.clippingPlanes),this.customShader=y(this.customShader,e.customShader);let t=e.nodeTransformations;if(c(t)){let i=this.nodeTransformations;c(i)?i.merge(t):this.nodeTransformations=new Vu(t,Cte)}let n=e.articulations;if(c(n)){let i=this.articulations;c(i)?i.merge(n):this.articulations=new Vu(n)}};var Jy=rS;function sS(e){this._definitionChanged=new pe,this._show=void 0,this._showSubscription=void 0,this._uri=void 0,this._uriSubscription=void 0,this._maximumScreenSpaceError=void 0,this._maximumScreenSpaceErrorSubscription=void 0,this.merge(y(e,y.EMPTY_OBJECT))}Object.defineProperties(sS.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:fe("show"),uri:fe("uri"),maximumScreenSpaceError:fe("maximumScreenSpaceError")});sS.prototype.clone=function(e){return c(e)?(e.show=this.show,e.uri=this.uri,e.maximumScreenSpaceError=this.maximumScreenSpaceError,e):new sS(this)};sS.prototype.merge=function(e){if(!c(e))throw new E("source is required.");this.show=y(this.show,e.show),this.uri=y(this.uri,e.uri),this.maximumScreenSpaceError=y(this.maximumScreenSpaceError,e.maximumScreenSpaceError)};var aS=sS;function cS(e){this._definitionChanged=new pe,this._show=void 0,this._showSubscription=void 0,this._leadTime=void 0,this._leadTimeSubscription=void 0,this._trailTime=void 0,this._trailTimeSubscription=void 0,this._width=void 0,this._widthSubscription=void 0,this._resolution=void 0,this._resolutionSubscription=void 0,this._material=void 0,this._materialSubscription=void 0,this._distanceDisplayCondition=void 0,this._distanceDisplayConditionSubscription=void 0,this.merge(y(e,y.EMPTY_OBJECT))}Object.defineProperties(cS.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:fe("show"),leadTime:fe("leadTime"),trailTime:fe("trailTime"),width:fe("width"),resolution:fe("resolution"),material:Uo("material"),distanceDisplayCondition:fe("distanceDisplayCondition")});cS.prototype.clone=function(e){return c(e)?(e.show=this.show,e.leadTime=this.leadTime,e.trailTime=this.trailTime,e.width=this.width,e.resolution=this.resolution,e.material=this.material,e.distanceDisplayCondition=this.distanceDisplayCondition,e):new cS(this)};cS.prototype.merge=function(e){if(!c(e))throw new E("source is required.");this.show=y(this.show,e.show),this.leadTime=y(this.leadTime,e.leadTime),this.trailTime=y(this.trailTime,e.trailTime),this.width=y(this.width,e.width),this.resolution=y(this.resolution,e.resolution),this.material=y(this.material,e.material),this.distanceDisplayCondition=y(this.distanceDisplayCondition,e.distanceDisplayCondition)};var Qy=cS;function lS(e){this._definitionChanged=new pe,this._show=void 0,this._showSubscription=void 0,this._plane=void 0,this._planeSubscription=void 0,this._dimensions=void 0,this._dimensionsSubscription=void 0,this._fill=void 0,this._fillSubscription=void 0,this._material=void 0,this._materialSubscription=void 0,this._outline=void 0,this._outlineSubscription=void 0,this._outlineColor=void 0,this._outlineColorSubscription=void 0,this._outlineWidth=void 0,this._outlineWidthSubscription=void 0,this._shadows=void 0,this._shadowsSubscription=void 0,this._distanceDisplayCondition=void 0,this._distanceDisplayConditionSubscription=void 0,this.merge(y(e,y.EMPTY_OBJECT))}Object.defineProperties(lS.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:fe("show"),plane:fe("plane"),dimensions:fe("dimensions"),fill:fe("fill"),material:Uo("material"),outline:fe("outline"),outlineColor:fe("outlineColor"),outlineWidth:fe("outlineWidth"),shadows:fe("shadows"),distanceDisplayCondition:fe("distanceDisplayCondition")});lS.prototype.clone=function(e){return c(e)?(e.show=this.show,e.plane=this.plane,e.dimensions=this.dimensions,e.fill=this.fill,e.material=this.material,e.outline=this.outline,e.outlineColor=this.outlineColor,e.outlineWidth=this.outlineWidth,e.shadows=this.shadows,e.distanceDisplayCondition=this.distanceDisplayCondition,e):new lS(this)};lS.prototype.merge=function(e){if(!c(e))throw new E("source is required.");this.show=y(this.show,e.show),this.plane=y(this.plane,e.plane),this.dimensions=y(this.dimensions,e.dimensions),this.fill=y(this.fill,e.fill),this.material=y(this.material,e.material),this.outline=y(this.outline,e.outline),this.outlineColor=y(this.outlineColor,e.outlineColor),this.outlineWidth=y(this.outlineWidth,e.outlineWidth),this.shadows=y(this.shadows,e.shadows),this.distanceDisplayCondition=y(this.distanceDisplayCondition,e.distanceDisplayCondition)};var SU=lS;function uS(e){this._definitionChanged=new pe,this._show=void 0,this._showSubscription=void 0,this._pixelSize=void 0,this._pixelSizeSubscription=void 0,this._heightReference=void 0,this._heightReferenceSubscription=void 0,this._color=void 0,this._colorSubscription=void 0,this._outlineColor=void 0,this._outlineColorSubscription=void 0,this._outlineWidth=void 0,this._outlineWidthSubscription=void 0,this._scaleByDistance=void 0,this._scaleByDistanceSubscription=void 0,this._translucencyByDistance=void 0,this._translucencyByDistanceSubscription=void 0,this._distanceDisplayCondition=void 0,this._distanceDisplayConditionSubscription=void 0,this._disableDepthTestDistance=void 0,this._disableDepthTestDistanceSubscription=void 0,this._splitDirection=void 0,this._splitDirectionSubscription=void 0,this.merge(y(e,y.EMPTY_OBJECT))}Object.defineProperties(uS.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:fe("show"),pixelSize:fe("pixelSize"),heightReference:fe("heightReference"),color:fe("color"),outlineColor:fe("outlineColor"),outlineWidth:fe("outlineWidth"),scaleByDistance:fe("scaleByDistance"),translucencyByDistance:fe("translucencyByDistance"),distanceDisplayCondition:fe("distanceDisplayCondition"),disableDepthTestDistance:fe("disableDepthTestDistance"),splitDirection:fe("splitDirection")});uS.prototype.clone=function(e){return c(e)?(e.show=this.show,e.pixelSize=this.pixelSize,e.heightReference=this.heightReference,e.color=this.color,e.outlineColor=this.outlineColor,e.outlineWidth=this.outlineWidth,e.scaleByDistance=this.scaleByDistance,e.translucencyByDistance=this._translucencyByDistance,e.distanceDisplayCondition=this.distanceDisplayCondition,e.disableDepthTestDistance=this.disableDepthTestDistance,e.splitDirection=this.splitDirection,e):new uS(this)};uS.prototype.merge=function(e){if(!c(e))throw new E("source is required.");this.show=y(this.show,e.show),this.pixelSize=y(this.pixelSize,e.pixelSize),this.heightReference=y(this.heightReference,e.heightReference),this.color=y(this.color,e.color),this.outlineColor=y(this.outlineColor,e.outlineColor),this.outlineWidth=y(this.outlineWidth,e.outlineWidth),this.scaleByDistance=y(this.scaleByDistance,e.scaleByDistance),this.translucencyByDistance=y(this._translucencyByDistance,e.translucencyByDistance),this.distanceDisplayCondition=y(this.distanceDisplayCondition,e.distanceDisplayCondition),this.disableDepthTestDistance=y(this.disableDepthTestDistance,e.disableDepthTestDistance),this.splitDirection=y(this.splitDirection,e.splitDirection)};var fS=uS;function T1e(e,t){this.positions=c(e)?e:[],this.holes=c(t)?t:[]}var _c=T1e;function A1e(e){return Array.isArray(e)&&(e=new _c(e)),new Kn(e)}function dS(e){this._definitionChanged=new pe,this._show=void 0,this._showSubscription=void 0,this._hierarchy=void 0,this._hierarchySubscription=void 0,this._height=void 0,this._heightSubscription=void 0,this._heightReference=void 0,this._heightReferenceSubscription=void 0,this._extrudedHeight=void 0,this._extrudedHeightSubscription=void 0,this._extrudedHeightReference=void 0,this._extrudedHeightReferenceSubscription=void 0,this._stRotation=void 0,this._stRotationSubscription=void 0,this._granularity=void 0,this._granularitySubscription=void 0,this._fill=void 0,this._fillSubscription=void 0,this._material=void 0,this._materialSubscription=void 0,this._outline=void 0,this._outlineSubscription=void 0,this._outlineColor=void 0,this._outlineColorSubscription=void 0,this._outlineWidth=void 0,this._outlineWidthSubscription=void 0,this._perPositionHeight=void 0,this._perPositionHeightSubscription=void 0,this._closeTop=void 0,this._closeTopSubscription=void 0,this._closeBottom=void 0,this._closeBottomSubscription=void 0,this._arcType=void 0,this._arcTypeSubscription=void 0,this._shadows=void 0,this._shadowsSubscription=void 0,this._distanceDisplayCondition=void 0,this._distanceDisplayConditionSubscription=void 0,this._classificationType=void 0,this._classificationTypeSubscription=void 0,this._zIndex=void 0,this._zIndexSubscription=void 0,this._textureCoordinates=void 0,this._textureCoordinatesSubscription=void 0,this.merge(y(e,y.EMPTY_OBJECT))}Object.defineProperties(dS.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:fe("show"),hierarchy:fe("hierarchy",void 0,A1e),height:fe("height"),heightReference:fe("heightReference"),extrudedHeight:fe("extrudedHeight"),extrudedHeightReference:fe("extrudedHeightReference"),stRotation:fe("stRotation"),granularity:fe("granularity"),fill:fe("fill"),material:Uo("material"),outline:fe("outline"),outlineColor:fe("outlineColor"),outlineWidth:fe("outlineWidth"),perPositionHeight:fe("perPositionHeight"),closeTop:fe("closeTop"),closeBottom:fe("closeBottom"),arcType:fe("arcType"),shadows:fe("shadows"),distanceDisplayCondition:fe("distanceDisplayCondition"),classificationType:fe("classificationType"),zIndex:fe("zIndex"),textureCoordinates:fe("textureCoordinates")});dS.prototype.clone=function(e){return c(e)?(e.show=this.show,e.hierarchy=this.hierarchy,e.height=this.height,e.heightReference=this.heightReference,e.extrudedHeight=this.extrudedHeight,e.extrudedHeightReference=this.extrudedHeightReference,e.stRotation=this.stRotation,e.granularity=this.granularity,e.fill=this.fill,e.material=this.material,e.outline=this.outline,e.outlineColor=this.outlineColor,e.outlineWidth=this.outlineWidth,e.perPositionHeight=this.perPositionHeight,e.closeTop=this.closeTop,e.closeBottom=this.closeBottom,e.arcType=this.arcType,e.shadows=this.shadows,e.distanceDisplayCondition=this.distanceDisplayCondition,e.classificationType=this.classificationType,e.zIndex=this.zIndex,e.textureCoordinates=this.textureCoordinates,e):new dS(this)};dS.prototype.merge=function(e){if(!c(e))throw new E("source is required.");this.show=y(this.show,e.show),this.hierarchy=y(this.hierarchy,e.hierarchy),this.height=y(this.height,e.height),this.heightReference=y(this.heightReference,e.heightReference),this.extrudedHeight=y(this.extrudedHeight,e.extrudedHeight),this.extrudedHeightReference=y(this.extrudedHeightReference,e.extrudedHeightReference),this.stRotation=y(this.stRotation,e.stRotation),this.granularity=y(this.granularity,e.granularity),this.fill=y(this.fill,e.fill),this.material=y(this.material,e.material),this.outline=y(this.outline,e.outline),this.outlineColor=y(this.outlineColor,e.outlineColor),this.outlineWidth=y(this.outlineWidth,e.outlineWidth),this.perPositionHeight=y(this.perPositionHeight,e.perPositionHeight),this.closeTop=y(this.closeTop,e.closeTop),this.closeBottom=y(this.closeBottom,e.closeBottom),this.arcType=y(this.arcType,e.arcType),this.shadows=y(this.shadows,e.shadows),this.distanceDisplayCondition=y(this.distanceDisplayCondition,e.distanceDisplayCondition),this.classificationType=y(this.classificationType,e.classificationType),this.zIndex=y(this.zIndex,e.zIndex),this.textureCoordinates=y(this.textureCoordinates,e.textureCoordinates)};var Um=dS;function hS(e){this._definitionChanged=new pe,this._show=void 0,this._showSubscription=void 0,this._positions=void 0,this._positionsSubscription=void 0,this._width=void 0,this._widthSubscription=void 0,this._granularity=void 0,this._granularitySubscription=void 0,this._material=void 0,this._materialSubscription=void 0,this._depthFailMaterial=void 0,this._depthFailMaterialSubscription=void 0,this._arcType=void 0,this._arcTypeSubscription=void 0,this._clampToGround=void 0,this._clampToGroundSubscription=void 0,this._shadows=void 0,this._shadowsSubscription=void 0,this._distanceDisplayCondition=void 0,this._distanceDisplayConditionSubscription=void 0,this._classificationType=void 0,this._classificationTypeSubscription=void 0,this._zIndex=void 0,this._zIndexSubscription=void 0,this.merge(y(e,y.EMPTY_OBJECT))}Object.defineProperties(hS.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:fe("show"),positions:fe("positions"),width:fe("width"),granularity:fe("granularity"),material:Uo("material"),depthFailMaterial:Uo("depthFailMaterial"),arcType:fe("arcType"),clampToGround:fe("clampToGround"),shadows:fe("shadows"),distanceDisplayCondition:fe("distanceDisplayCondition"),classificationType:fe("classificationType"),zIndex:fe("zIndex")});hS.prototype.clone=function(e){return c(e)?(e.show=this.show,e.positions=this.positions,e.width=this.width,e.granularity=this.granularity,e.material=this.material,e.depthFailMaterial=this.depthFailMaterial,e.arcType=this.arcType,e.clampToGround=this.clampToGround,e.shadows=this.shadows,e.distanceDisplayCondition=this.distanceDisplayCondition,e.classificationType=this.classificationType,e.zIndex=this.zIndex,e):new hS(this)};hS.prototype.merge=function(e){if(!c(e))throw new E("source is required.");this.show=y(this.show,e.show),this.positions=y(this.positions,e.positions),this.width=y(this.width,e.width),this.granularity=y(this.granularity,e.granularity),this.material=y(this.material,e.material),this.depthFailMaterial=y(this.depthFailMaterial,e.depthFailMaterial),this.arcType=y(this.arcType,e.arcType),this.clampToGround=y(this.clampToGround,e.clampToGround),this.shadows=y(this.shadows,e.shadows),this.distanceDisplayCondition=y(this.distanceDisplayCondition,e.distanceDisplayCondition),this.classificationType=y(this.classificationType,e.classificationType),this.zIndex=y(this.zIndex,e.zIndex)};var el=hS;function mS(e){this._definitionChanged=new pe,this._show=void 0,this._showSubscription=void 0,this._positions=void 0,this._positionsSubscription=void 0,this._shape=void 0,this._shapeSubscription=void 0,this._cornerType=void 0,this._cornerTypeSubscription=void 0,this._granularity=void 0,this._granularitySubscription=void 0,this._fill=void 0,this._fillSubscription=void 0,this._material=void 0,this._materialSubscription=void 0,this._outline=void 0,this._outlineSubscription=void 0,this._outlineColor=void 0,this._outlineColorSubscription=void 0,this._outlineWidth=void 0,this._outlineWidthSubscription=void 0,this._shadows=void 0,this._shadowsSubscription=void 0,this._distanceDisplayCondition=void 0,this._distanceDisplayConditionSubsription=void 0,this.merge(y(e,y.EMPTY_OBJECT))}Object.defineProperties(mS.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:fe("show"),positions:fe("positions"),shape:fe("shape"),cornerType:fe("cornerType"),granularity:fe("granularity"),fill:fe("fill"),material:Uo("material"),outline:fe("outline"),outlineColor:fe("outlineColor"),outlineWidth:fe("outlineWidth"),shadows:fe("shadows"),distanceDisplayCondition:fe("distanceDisplayCondition")});mS.prototype.clone=function(e){return c(e)?(e.show=this.show,e.positions=this.positions,e.shape=this.shape,e.cornerType=this.cornerType,e.granularity=this.granularity,e.fill=this.fill,e.material=this.material,e.outline=this.outline,e.outlineColor=this.outlineColor,e.outlineWidth=this.outlineWidth,e.shadows=this.shadows,e.distanceDisplayCondition=this.distanceDisplayCondition,e):new mS(this)};mS.prototype.merge=function(e){if(!c(e))throw new E("source is required.");this.show=y(this.show,e.show),this.positions=y(this.positions,e.positions),this.shape=y(this.shape,e.shape),this.cornerType=y(this.cornerType,e.cornerType),this.granularity=y(this.granularity,e.granularity),this.fill=y(this.fill,e.fill),this.material=y(this.material,e.material),this.outline=y(this.outline,e.outline),this.outlineColor=y(this.outlineColor,e.outlineColor),this.outlineWidth=y(this.outlineWidth,e.outlineWidth),this.shadows=y(this.shadows,e.shadows),this.distanceDisplayCondition=y(this.distanceDisplayCondition,e.distanceDisplayCondition)};var pS=mS;function _S(e){this._definitionChanged=new pe,this._show=void 0,this._showSubscription=void 0,this._coordinates=void 0,this._coordinatesSubscription=void 0,this._height=void 0,this._heightSubscription=void 0,this._heightReference=void 0,this._heightReferenceSubscription=void 0,this._extrudedHeight=void 0,this._extrudedHeightSubscription=void 0,this._extrudedHeightReference=void 0,this._extrudedHeightReferenceSubscription=void 0,this._rotation=void 0,this._rotationSubscription=void 0,this._stRotation=void 0,this._stRotationSubscription=void 0,this._granularity=void 0,this._granularitySubscription=void 0,this._fill=void 0,this._fillSubscription=void 0,this._material=void 0,this._materialSubscription=void 0,this._outline=void 0,this._outlineSubscription=void 0,this._outlineColor=void 0,this._outlineColorSubscription=void 0,this._outlineWidth=void 0,this._outlineWidthSubscription=void 0,this._shadows=void 0,this._shadowsSubscription=void 0,this._distanceDisplayCondition=void 0,this._distancedisplayConditionSubscription=void 0,this._classificationType=void 0,this._classificationTypeSubscription=void 0,this._zIndex=void 0,this._zIndexSubscription=void 0,this.merge(y(e,y.EMPTY_OBJECT))}Object.defineProperties(_S.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:fe("show"),coordinates:fe("coordinates"),height:fe("height"),heightReference:fe("heightReference"),extrudedHeight:fe("extrudedHeight"),extrudedHeightReference:fe("extrudedHeightReference"),rotation:fe("rotation"),stRotation:fe("stRotation"),granularity:fe("granularity"),fill:fe("fill"),material:Uo("material"),outline:fe("outline"),outlineColor:fe("outlineColor"),outlineWidth:fe("outlineWidth"),shadows:fe("shadows"),distanceDisplayCondition:fe("distanceDisplayCondition"),classificationType:fe("classificationType"),zIndex:fe("zIndex")});_S.prototype.clone=function(e){return c(e)?(e.show=this.show,e.coordinates=this.coordinates,e.height=this.height,e.heightReference=this.heightReference,e.extrudedHeight=this.extrudedHeight,e.extrudedHeightReference=this.extrudedHeightReference,e.rotation=this.rotation,e.stRotation=this.stRotation,e.granularity=this.granularity,e.fill=this.fill,e.material=this.material,e.outline=this.outline,e.outlineColor=this.outlineColor,e.outlineWidth=this.outlineWidth,e.shadows=this.shadows,e.distanceDisplayCondition=this.distanceDisplayCondition,e.classificationType=this.classificationType,e.zIndex=this.zIndex,e):new _S(this)};_S.prototype.merge=function(e){if(!c(e))throw new E("source is required.");this.show=y(this.show,e.show),this.coordinates=y(this.coordinates,e.coordinates),this.height=y(this.height,e.height),this.heightReference=y(this.heightReference,e.heightReference),this.extrudedHeight=y(this.extrudedHeight,e.extrudedHeight),this.extrudedHeightReference=y(this.extrudedHeightReference,e.extrudedHeightReference),this.rotation=y(this.rotation,e.rotation),this.stRotation=y(this.stRotation,e.stRotation),this.granularity=y(this.granularity,e.granularity),this.fill=y(this.fill,e.fill),this.material=y(this.material,e.material),this.outline=y(this.outline,e.outline),this.outlineColor=y(this.outlineColor,e.outlineColor),this.outlineWidth=y(this.outlineWidth,e.outlineWidth),this.shadows=y(this.shadows,e.shadows),this.distanceDisplayCondition=y(this.distanceDisplayCondition,e.distanceDisplayCondition),this.classificationType=y(this.classificationType,e.classificationType),this.zIndex=y(this.zIndex,e.zIndex)};var zm=_S;function gS(e){this._definitionChanged=new pe,this._show=void 0,this._showSubscription=void 0,this._positions=void 0,this._positionsSubscription=void 0,this._minimumHeights=void 0,this._minimumHeightsSubscription=void 0,this._maximumHeights=void 0,this._maximumHeightsSubscription=void 0,this._granularity=void 0,this._granularitySubscription=void 0,this._fill=void 0,this._fillSubscription=void 0,this._material=void 0,this._materialSubscription=void 0,this._outline=void 0,this._outlineSubscription=void 0,this._outlineColor=void 0,this._outlineColorSubscription=void 0,this._outlineWidth=void 0,this._outlineWidthSubscription=void 0,this._shadows=void 0,this._shadowsSubscription=void 0,this._distanceDisplayCondition=void 0,this._distanceDisplayConditionSubscription=void 0,this.merge(y(e,y.EMPTY_OBJECT))}Object.defineProperties(gS.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:fe("show"),positions:fe("positions"),minimumHeights:fe("minimumHeights"),maximumHeights:fe("maximumHeights"),granularity:fe("granularity"),fill:fe("fill"),material:Uo("material"),outline:fe("outline"),outlineColor:fe("outlineColor"),outlineWidth:fe("outlineWidth"),shadows:fe("shadows"),distanceDisplayCondition:fe("distanceDisplayCondition")});gS.prototype.clone=function(e){return c(e)?(e.show=this.show,e.positions=this.positions,e.minimumHeights=this.minimumHeights,e.maximumHeights=this.maximumHeights,e.granularity=this.granularity,e.fill=this.fill,e.material=this.material,e.outline=this.outline,e.outlineColor=this.outlineColor,e.outlineWidth=this.outlineWidth,e.shadows=this.shadows,e.distanceDisplayCondition=this.distanceDisplayCondition,e):new gS(this)};gS.prototype.merge=function(e){if(!c(e))throw new E("source is required.");this.show=y(this.show,e.show),this.positions=y(this.positions,e.positions),this.minimumHeights=y(this.minimumHeights,e.minimumHeights),this.maximumHeights=y(this.maximumHeights,e.maximumHeights),this.granularity=y(this.granularity,e.granularity),this.fill=y(this.fill,e.fill),this.material=y(this.material,e.material),this.outline=y(this.outline,e.outline),this.outlineColor=y(this.outlineColor,e.outlineColor),this.outlineWidth=y(this.outlineWidth,e.outlineWidth),this.shadows=y(this.shadows,e.shadows),this.distanceDisplayCondition=y(this.distanceDisplayCondition,e.distanceDisplayCondition)};var e0=gS;var C1e=new he,wU=[];function E1e(e){return new Qc(e)}function S1e(e){return fe(e,void 0,E1e)}function Is(e,t){return fe(e,void 0,function(n){return n instanceof t?n:new t(n)})}function Uu(e){e=y(e,y.EMPTY_OBJECT);let t=e.id;c(t)||(t=Hn()),this._availability=void 0,this._id=t,this._definitionChanged=new pe,this._name=e.name,this._show=y(e.show,!0),this._parent=void 0,this._propertyNames=["billboard","box","corridor","cylinder","description","ellipse","ellipsoid","label","model","tileset","orientation","path","plane","point","polygon","polyline","polylineVolume","position","properties","rectangle","viewFrom","wall",...wU],this._billboard=void 0,this._billboardSubscription=void 0,this._box=void 0,this._boxSubscription=void 0,this._corridor=void 0,this._corridorSubscription=void 0,this._cylinder=void 0,this._cylinderSubscription=void 0,this._description=void 0,this._descriptionSubscription=void 0,this._ellipse=void 0,this._ellipseSubscription=void 0,this._ellipsoid=void 0,this._ellipsoidSubscription=void 0,this._label=void 0,this._labelSubscription=void 0,this._model=void 0,this._modelSubscription=void 0,this._tileset=void 0,this._tilesetSubscription=void 0,this._orientation=void 0,this._orientationSubscription=void 0,this._path=void 0,this._pathSubscription=void 0,this._plane=void 0,this._planeSubscription=void 0,this._point=void 0,this._pointSubscription=void 0,this._polygon=void 0,this._polygonSubscription=void 0,this._polyline=void 0,this._polylineSubscription=void 0,this._polylineVolume=void 0,this._polylineVolumeSubscription=void 0,this._position=void 0,this._positionSubscription=void 0,this._properties=void 0,this._propertiesSubscription=void 0,this._rectangle=void 0,this._rectangleSubscription=void 0,this._viewFrom=void 0,this._viewFromSubscription=void 0,this._wall=void 0,this._wallSubscription=void 0,this._children=[],this.entityCollection=void 0,this.parent=e.parent,this.merge(e)}function vU(e,t,n){let i=t.length;for(let o=0;o<i;o++){let r=t[o],s=r._show;(!n&&s)!==(n&&s)&&vU(r,r._children,n)}e._definitionChanged.raiseEvent(e,"isShowing",n,!n)}Object.defineProperties(Uu.prototype,{availability:ku("availability"),id:{get:function(){return this._id}},definitionChanged:{get:function(){return this._definitionChanged}},name:ku("name"),show:{get:function(){return this._show},set:function(e){if(!c(e))throw new E("value is required.");if(e===this._show)return;let t=this.isShowing;this._show=e;let n=this.isShowing;t!==n&&vU(this,this._children,n),this._definitionChanged.raiseEvent(this,"show",e,!e)}},isShowing:{get:function(){return this._show&&(!c(this.entityCollection)||this.entityCollection.show)&&(!c(this._parent)||this._parent.isShowing)}},parent:{get:function(){return this._parent},set:function(e){let t=this._parent;if(t===e)return;let n=this.isShowing;if(c(t)){let o=t._children.indexOf(this);t._children.splice(o,1)}this._parent=e,c(e)&&e._children.push(this);let i=this.isShowing;n!==i&&vU(this,this._children,i),this._definitionChanged.raiseEvent(this,"parent",e,t)}},propertyNames:{get:function(){return this._propertyNames}},billboard:Is("billboard",Wc),box:Is("box",YE),corridor:Is("corridor",KE),cylinder:Is("cylinder",ZE),description:fe("description"),ellipse:Is("ellipse",QE),ellipsoid:Is("ellipsoid",tS),label:Is("label",km),model:Is("model",Jy),tileset:Is("tileset",aS),orientation:fe("orientation"),path:Is("path",Qy),plane:Is("plane",SU),point:Is("point",fS),polygon:Is("polygon",Um),polyline:Is("polyline",el),polylineVolume:Is("polylineVolume",pS),properties:Is("properties",Vu),position:S1e("position"),rectangle:Is("rectangle",zm),viewFrom:fe("viewFrom"),wall:Is("wall",e0)});Uu.registerEntityType=function(e,t){Object.defineProperties(Uu.prototype,{[e]:Is(e,t)}),wU.includes(e)||wU.push(e)};Uu.prototype.isAvailable=function(e){if(!c(e))throw new E("time is required.");let t=this._availability;return!c(t)||t.contains(e)};Uu.prototype.addProperty=function(e){let t=this._propertyNames;if(!c(e))throw new E("propertyName is required.");if(t.indexOf(e)!==-1)throw new E(`${e} is already a registered property.`);if(e in this)throw new E(`${e} is a reserved property name.`);t.push(e),Object.defineProperty(this,e,ku(e,!0))};Uu.prototype.removeProperty=function(e){let n=this._propertyNames.indexOf(e);if(!c(e))throw new E("propertyName is required.");if(n===-1)throw new E(`${e} is not a registered property.`);this._propertyNames.splice(n,1),delete this[e]};Uu.prototype.merge=function(e){if(!c(e))throw new E("source is required.");this.name=y(this.name,e.name),this.availability=y(this.availability,e.availability);let t=this._propertyNames,n=c(e._propertyNames)?e._propertyNames:Object.keys(e),i=n.length;for(let o=0;o<i;o++){let r=n[o];if(r==="parent"||r==="name"||r==="availability"||r==="children")continue;let s=this[r],a=e[r];!c(s)&&t.indexOf(r)===-1&&this.addProperty(r),c(a)&&(c(s)?c(s.merge)&&s.merge(a):c(a.merge)&&c(a.clone)?this[r]=a.clone():this[r]=a)}};var Ete=new Q,Ste=new h,wte=new Ne;Uu.prototype.computeModelMatrix=function(e,t){A.typeOf.object("time",e);let n=X.getValueOrUndefined(this._position,e,Ste);if(!c(n))return;let i=X.getValueOrUndefined(this._orientation,e,wte);return c(i)?t=k.fromRotationTranslation(Q.fromQuaternion(i,Ete),n,t):t=Ft.eastNorthUpToFixedFrame(n,void 0,t),t};Uu.prototype.computeModelMatrixForHeightReference=function(e,t,n,i,o){A.typeOf.object("time",e);let r=X.getValueOrDefault(t,e,$e.NONE),s=X.getValueOrUndefined(this._position,e,Ste);if(r===$e.NONE||!c(s)||h.equalsEpsilon(s,h.ZERO,R.EPSILON8))return this.computeModelMatrix(e,o);let a=i.cartesianToCartographic(s,C1e);Ru(r)?a.height=n:a.height+=n,s=i.cartographicToCartesian(a,s);let l=X.getValueOrUndefined(this._orientation,e,wte);return c(l)?o=k.fromRotationTranslation(Q.fromQuaternion(l,Ete),s,o):o=Ft.eastNorthUpToFixedFrame(s,void 0,o),o};Uu.supportsMaterialsforEntitiesOnTerrain=function(e){return Ll.supportsMaterials(e)};Uu.supportsPolylinesOnTerrain=function(e){return Fm.isSupported(e)};var Qo=Uu;var w1e=new Ht(j.WHITE),v1e=new Kn(!0),D1e=new Kn(!0),P1e=new Kn(!1),I1e=new Kn(j.BLACK),O1e=new Kn(En.DISABLED),R1e=new Kn(new Bt),M1e=new Kn(Vn.BOTH);function gc(e){A.defined("options.entity",e.entity),A.defined("options.scene",e.scene),A.defined("options.geometryOptions",e.geometryOptions),A.defined("options.geometryPropertyName",e.geometryPropertyName),A.defined("options.observedPropertyNames",e.observedPropertyNames);let t=e.entity,n=e.geometryPropertyName;this._entity=t,this._scene=e.scene,this._fillEnabled=!1,this._isClosed=!1,this._onTerrain=!1,this._dynamic=!1,this._outlineEnabled=!1,this._geometryChanged=new pe,this._showProperty=void 0,this._materialProperty=void 0,this._showOutlineProperty=void 0,this._outlineColorProperty=void 0,this._outlineWidth=1,this._shadowsProperty=void 0,this._distanceDisplayConditionProperty=void 0,this._classificationTypeProperty=void 0,this._options=e.geometryOptions,this._geometryPropertyName=n,this._id=`${n}-${t.id}`,this._observedPropertyNames=e.observedPropertyNames,this._supportsMaterialsforEntitiesOnTerrain=Qo.supportsMaterialsforEntitiesOnTerrain(e.scene)}Object.defineProperties(gc.prototype,{id:{get:function(){return this._id}},entity:{get:function(){return this._entity}},fillEnabled:{get:function(){return this._fillEnabled}},hasConstantFill:{get:function(){return!this._fillEnabled||!c(this._entity.availability)&&X.isConstant(this._showProperty)&&X.isConstant(this._fillProperty)}},fillMaterialProperty:{get:function(){return this._materialProperty}},outlineEnabled:{get:function(){return this._outlineEnabled}},hasConstantOutline:{get:function(){return!this._outlineEnabled||!c(this._entity.availability)&&X.isConstant(this._showProperty)&&X.isConstant(this._showOutlineProperty)}},outlineColorProperty:{get:function(){return this._outlineColorProperty}},outlineWidth:{get:function(){return this._outlineWidth}},shadowsProperty:{get:function(){return this._shadowsProperty}},distanceDisplayConditionProperty:{get:function(){return this._distanceDisplayConditionProperty}},classificationTypeProperty:{get:function(){return this._classificationTypeProperty}},isDynamic:{get:function(){return this._dynamic}},isClosed:{get:function(){return this._isClosed}},onTerrain:{get:function(){return this._onTerrain}},geometryChanged:{get:function(){return this._geometryChanged}}});gc.prototype.isOutlineVisible=function(e){let t=this._entity,n=this._outlineEnabled&&t.isAvailable(e)&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e);return y(n,!1)};gc.prototype.isFilled=function(e){let t=this._entity,n=this._fillEnabled&&t.isAvailable(e)&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e);return y(n,!1)};gc.prototype.createFillGeometryInstance=E.throwInstantiationError;gc.prototype.createOutlineGeometryInstance=E.throwInstantiationError;gc.prototype.isDestroyed=function(){return!1};gc.prototype.destroy=function(){de(this)};gc.prototype._isHidden=function(e,t){let n=t.show;return c(n)&&n.isConstant&&!n.getValue(je.MINIMUM_VALUE)};gc.prototype._isOnTerrain=function(e,t){return!1};gc.prototype._getIsClosed=function(e){return!0};gc.prototype._isDynamic=E.throwInstantiationError;gc.prototype._setStaticOptions=E.throwInstantiationError;gc.prototype._onEntityPropertyChanged=function(e,t,n,i){if(this._observedPropertyNames.indexOf(t)===-1)return;let o=this._entity[this._geometryPropertyName];if(!c(o)){(this._fillEnabled||this._outlineEnabled)&&(this._fillEnabled=!1,this._outlineEnabled=!1,this._geometryChanged.raiseEvent(this));return}let r=o.fill,s=c(r)&&r.isConstant?r.getValue(je.MINIMUM_VALUE):!0,a=o.outline,l=c(a);if(l&&a.isConstant&&(l=a.getValue(je.MINIMUM_VALUE)),!s&&!l){(this._fillEnabled||this._outlineEnabled)&&(this._fillEnabled=!1,this._outlineEnabled=!1,this._geometryChanged.raiseEvent(this));return}let u=o.show;if(this._isHidden(e,o)){(this._fillEnabled||this._outlineEnabled)&&(this._fillEnabled=!1,this._outlineEnabled=!1,this._geometryChanged.raiseEvent(this));return}this._materialProperty=y(o.material,w1e),this._fillProperty=y(r,D1e),this._showProperty=y(u,v1e),this._showOutlineProperty=y(o.outline,P1e),this._outlineColorProperty=l?y(o.outlineColor,I1e):void 0,this._shadowsProperty=y(o.shadows,O1e),this._distanceDisplayConditionProperty=y(o.distanceDisplayCondition,R1e),this._classificationTypeProperty=y(o.classificationType,M1e),this._fillEnabled=s;let f=this._isOnTerrain(e,o)&&(this._supportsMaterialsforEntitiesOnTerrain||this._materialProperty instanceof Ht);if(l&&f&&(_t(_t.geometryOutlines),l=!1),this._onTerrain=f,this._outlineEnabled=l,this._isDynamic(e,o))this._dynamic||(this._dynamic=!0,this._geometryChanged.raiseEvent(this));else{this._setStaticOptions(e,o),this._isClosed=this._getIsClosed(this._options);let d=o.outlineWidth;this._outlineWidth=c(d)?d.getValue(je.MINIMUM_VALUE):1,this._dynamic=!1,this._geometryChanged.raiseEvent(this)}};gc.prototype.createDynamicUpdater=function(e,t){if(A.defined("primitives",e),A.defined("groundPrimitives",t),!this._dynamic)throw new E("This instance does not represent dynamic geometry.");return new this.constructor.DynamicGeometryUpdater(this,e,t)};var oi=gc;function eT(e,t){this._callback=void 0,this._isConstant=void 0,this._definitionChanged=new pe,this.setCallback(e,t)}Object.defineProperties(eT.prototype,{isConstant:{get:function(){return this._isConstant}},definitionChanged:{get:function(){return this._definitionChanged}}});var L1e=new J;eT.prototype.getValue=function(e,t){return c(e)||(e=J.now(L1e)),this._callback(e,t)};eT.prototype.setCallback=function(e,t){if(!c(e))throw new E("callback is required.");if(!c(t))throw new E("isConstant is required.");let n=this._callback!==e||this._isConstant!==t;this._callback=e,this._isConstant=t,n&&this._definitionChanged.raiseEvent(this)};eT.prototype.equals=function(e){return this===e||e instanceof eT&&this._callback===e._callback&&this._isConstant===e._isConstant};var Hm=eT;var vte=new h;function tT(e,t,n,i){A.defined("scene",e),A.defined("positionProperty",t),this._scene=e,this._heightReference=n,this._extrudedHeightReference=i,this._positionProperty=t,this._position=new h,this._cartographicPosition=new he,this._normal=new h,this._definitionChanged=new pe,this._terrainHeight=0,this._removeCallbackFunc=void 0,this._removeEventListener=void 0,this._removeModeListener=void 0;let o=this;if(c(e.globe)&&(this._removeEventListener=e.terrainProviderChanged.addEventListener(function(){o._updateClamping()}),this._removeModeListener=e.morphComplete.addEventListener(function(){o._updateClamping()})),t.isConstant){let r=t.getValue(je.MINIMUM_VALUE,vte);if(!c(r)||h.equals(r,h.ZERO)||!c(e.globe))return;this._position=h.clone(r,this._position),this._updateClamping(),this._normal=e.ellipsoid.geodeticSurfaceNormal(r,this._normal)}}Object.defineProperties(tT.prototype,{isConstant:{get:function(){return!1}},definitionChanged:{get:function(){return this._definitionChanged}}});tT.prototype._updateClamping=function(){c(this._removeCallbackFunc)&&this._removeCallbackFunc();let e=this._scene,t=this._position;if(h.equals(t,h.ZERO)){this._terrainHeight=0;return}let i=e.ellipsoid.cartesianToCartographic(t,this._cartographicPosition),o=e.getHeight(i,this._heightReference);c(o)?this._terrainHeight=o:this._terrainHeight=0;let r=s=>{this._terrainHeight=s.height,this.definitionChanged.raiseEvent()};this._removeCallbackFunc=e.updateHeight(i,r,this._heightReference)};var N1e=new J;tT.prototype.getValue=function(e,t){c(e)||(e=J.now(N1e));let n=X.getValueOrDefault(this._heightReference,e,$e.NONE),i=X.getValueOrDefault(this._extrudedHeightReference,e,$e.NONE);if(n===$e.NONE&&!Lx(i))return this._position=h.clone(h.ZERO,this._position),h.clone(h.ZERO,t);if(this._positionProperty.isConstant)return h.multiplyByScalar(this._normal,this._terrainHeight,t);let o=this._scene,r=this._positionProperty.getValue(e,vte);if(!c(r)||h.equals(r,h.ZERO)||!c(o.globe))return h.clone(h.ZERO,t);if(h.equalsEpsilon(this._position,r,R.EPSILON10))return h.multiplyByScalar(this._normal,this._terrainHeight,t);this._position=h.clone(r,this._position),this._updateClamping();let s=o.ellipsoid.geodeticSurfaceNormal(r,this._normal);return h.multiplyByScalar(s,this._terrainHeight,t)};tT.prototype.isDestroyed=function(){return!1};tT.prototype.destroy=function(){return c(this._removeEventListener)&&this._removeEventListener(),c(this._removeModeListener)&&this._removeModeListener(),c(this._removeCallbackFunc)&&this._removeCallbackFunc(),de(this)};var yS=tT;function F1e(e,t,n,i){if(oi.prototype._onEntityPropertyChanged.call(this,e,t,n,i),this._observedPropertyNames.indexOf(t)===-1)return;let o=this._entity[this._geometryPropertyName];if(!c(o))return;c(this._terrainOffsetProperty)&&(this._terrainOffsetProperty.destroy(),this._terrainOffsetProperty=void 0);let r=o.heightReference;if(c(r)){let s=new Hm(this._computeCenter.bind(this),!this._dynamic);this._terrainOffsetProperty=new yS(this._scene,s,r)}}var t0=F1e;var Dte=h.ZERO,Pte=new h,B1e=new h,Ite=new j;function k1e(e){this.id=e,this.vertexFormat=void 0,this.dimensions=void 0,this.offsetAttribute=void 0}function Nl(e,t){oi.call(this,{entity:e,scene:t,geometryOptions:new k1e(e),geometryPropertyName:"box",observedPropertyNames:["availability","position","orientation","box"]}),this._onEntityPropertyChanged(e,"box",e.box,void 0)}c(Object.create)&&(Nl.prototype=Object.create(oi.prototype),Nl.prototype.constructor=Nl);Object.defineProperties(Nl.prototype,{terrainOffsetProperty:{get:function(){return this._terrainOffsetProperty}}});Nl.prototype.createFillGeometryInstance=function(e){if(A.defined("time",e),!this._fillEnabled)throw new E("This instance does not represent a filled geometry.");let t=this._entity,n=t.isAvailable(e),i=new Cn(n&&t.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),o=this._distanceDisplayConditionProperty.getValue(e),r=kn.fromDistanceDisplayCondition(o),s={show:i,distanceDisplayCondition:r,color:void 0,offset:void 0};if(this._materialProperty instanceof Ht){let a;c(this._materialProperty.color)&&(this._materialProperty.color.isConstant||n)&&(a=this._materialProperty.color.getValue(e,Ite)),c(a)||(a=j.WHITE),s.color=Wt.fromColor(a)}return c(this._options.offsetAttribute)&&(s.offset=Qi.fromCartesian3(X.getValueOrDefault(this._terrainOffsetProperty,e,Dte,Pte))),new vt({id:t,geometry:uc.fromDimensions(this._options),modelMatrix:t.computeModelMatrixForHeightReference(e,t.box.heightReference,this._options.dimensions.z*.5,this._scene.ellipsoid),attributes:s})};Nl.prototype.createOutlineGeometryInstance=function(e){if(A.defined("time",e),!this._outlineEnabled)throw new E("This instance does not represent an outlined geometry.");let t=this._entity,n=t.isAvailable(e),i=X.getValueOrDefault(this._outlineColorProperty,e,j.BLACK,Ite),o=this._distanceDisplayConditionProperty.getValue(e),r={show:new Cn(n&&t.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:Wt.fromColor(i),distanceDisplayCondition:kn.fromDistanceDisplayCondition(o),offset:void 0};return c(this._options.offsetAttribute)&&(r.offset=Qi.fromCartesian3(X.getValueOrDefault(this._terrainOffsetProperty,e,Dte,Pte))),new vt({id:t,geometry:Sm.fromDimensions(this._options),modelMatrix:t.computeModelMatrixForHeightReference(e,t.box.heightReference,this._options.dimensions.z*.5,this._scene.ellipsoid),attributes:r})};Nl.prototype._computeCenter=function(e,t){return X.getValueOrUndefined(this._entity.position,e,t)};Nl.prototype._isHidden=function(e,t){return!c(t.dimensions)||!c(e.position)||oi.prototype._isHidden.call(this,e,t)};Nl.prototype._isDynamic=function(e,t){return!e.position.isConstant||!X.isConstant(e.orientation)||!t.dimensions.isConstant||!X.isConstant(t.outlineWidth)};Nl.prototype._setStaticOptions=function(e,t){let n=X.getValueOrDefault(t.heightReference,je.MINIMUM_VALUE,$e.NONE),i=this._options;i.vertexFormat=this._materialProperty instanceof Ht?ln.VERTEX_FORMAT:uo.MaterialSupport.TEXTURED.vertexFormat,i.dimensions=t.dimensions.getValue(je.MINIMUM_VALUE,i.dimensions),i.offsetAttribute=n!==$e.NONE?Jt.ALL:void 0};Nl.prototype._onEntityPropertyChanged=t0;Nl.DynamicGeometryUpdater=nT;function nT(e,t,n){ii.call(this,e,t,n)}c(Object.create)&&(nT.prototype=Object.create(ii.prototype),nT.prototype.constructor=nT);nT.prototype._isHidden=function(e,t,n){let i=X.getValueOrUndefined(e.position,n,B1e),o=this._options.dimensions;return!c(i)||!c(o)||ii.prototype._isHidden.call(this,e,t,n)};nT.prototype._setOptions=function(e,t,n){let i=X.getValueOrDefault(t.heightReference,n,$e.NONE),o=this._options;o.dimensions=X.getValueOrUndefined(t.dimensions,n,o.dimensions),o.offsetAttribute=i!==$e.NONE?Jt.ALL:void 0};var DU=Nl;function n0(e,t,n){this._callback=void 0,this._isConstant=void 0,this._referenceFrame=y(n,ji.FIXED),this._definitionChanged=new pe,this.setCallback(e,t)}Object.defineProperties(n0.prototype,{isConstant:{get:function(){return this._isConstant}},definitionChanged:{get:function(){return this._definitionChanged}},referenceFrame:{get:function(){return this._referenceFrame}}});var V1e=new J;n0.prototype.getValue=function(e,t){return c(e)||(e=J.now(V1e)),this.getValueInReferenceFrame(e,ji.FIXED,t)};n0.prototype.setCallback=function(e,t){if(!c(e))throw new E("callback is required.");if(!c(t))throw new E("isConstant is required.");let n=this._callback!==e||this._isConstant!==t;this._callback=e,this._isConstant=t,n&&this._definitionChanged.raiseEvent(this)};n0.prototype.getValueInReferenceFrame=function(e,t,n){if(!c(e))throw new E("time is required.");if(!c(t))throw new E("referenceFrame is required.");let i=this._callback(e,n);return Bm.convertToReferenceFrame(e,i,this._referenceFrame,t,n)};n0.prototype.equals=function(e){return this===e||e instanceof n0&&this._callback===e._callback&&this._isConstant===e._isConstant&&this._referenceFrame===e._referenceFrame};var PU=n0;/*! @license DOMPurify 3.2.0 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.2.0/LICENSE */var{entries:Vte,setPrototypeOf:Ote,isFrozen:U1e,getPrototypeOf:z1e,getOwnPropertyDescriptor:H1e}=Object,{freeze:bc,seal:zu,create:Ute}=Object,{apply:NU,construct:FU}=typeof Reflect<"u"&&Reflect;bc||(bc=function(t){return t});zu||(zu=function(t){return t});NU||(NU=function(t,n,i){return t.apply(n,i)});FU||(FU=function(t,n){return new t(...n)});var iO=Fl(Array.prototype.forEach),Rte=Fl(Array.prototype.pop),bS=Fl(Array.prototype.push),rO=Fl(String.prototype.toLowerCase),IU=Fl(String.prototype.toString),Mte=Fl(String.prototype.match),xS=Fl(String.prototype.replace),G1e=Fl(String.prototype.indexOf),j1e=Fl(String.prototype.trim),Yf=Fl(Object.prototype.hasOwnProperty),yc=Fl(RegExp.prototype.test),TS=W1e(TypeError);function Fl(e){return function(t){for(var n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];return NU(e,t,i)}}function W1e(e){return function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return FU(e,n)}}function Ai(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:rO;Ote&&Ote(e,null);let i=t.length;for(;i--;){let o=t[i];if(typeof o=="string"){let r=n(o);r!==o&&(U1e(t)||(t[i]=r),o=r)}e[o]=!0}return e}function q1e(e){for(let t=0;t<e.length;t++)Yf(e,t)||(e[t]=null);return e}function i0(e){let t=Ute(null);for(let[n,i]of Vte(e))Yf(e,n)&&(Array.isArray(i)?t[n]=q1e(i):i&&typeof i=="object"&&i.constructor===Object?t[n]=i0(i):t[n]=i);return t}function AS(e,t){for(;e!==null;){let i=H1e(e,t);if(i){if(i.get)return Fl(i.get);if(typeof i.value=="function")return Fl(i.value)}e=z1e(e)}function n(){return null}return n}var Lte=bc(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),OU=bc(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),RU=bc(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),Y1e=bc(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),MU=bc(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),X1e=bc(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),Nte=bc(["#text"]),Fte=bc(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),LU=bc(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),Bte=bc(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),oO=bc(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),K1e=zu(/\{\{[\w\W]*|[\w\W]*\}\}/gm),$1e=zu(/<%[\w\W]*|[\w\W]*%>/gm),Z1e=zu(/\${[\w\W]*}/gm),J1e=zu(/^data-[\-\w.\u00B7-\uFFFF]/),Q1e=zu(/^aria-[\-\w]+$/),zte=zu(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),eRe=zu(/^(?:\w+script|data):/i),tRe=zu(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),Hte=zu(/^html$/i),nRe=zu(/^[a-z][.\w]*(-[.\w]+)+$/i),kte=Object.freeze({__proto__:null,ARIA_ATTR:Q1e,ATTR_WHITESPACE:tRe,CUSTOM_ELEMENT:nRe,DATA_ATTR:J1e,DOCTYPE_NAME:Hte,ERB_EXPR:$1e,IS_ALLOWED_URI:zte,IS_SCRIPT_OR_DATA:eRe,MUSTACHE_EXPR:K1e,TMPLIT_EXPR:Z1e}),CS={element:1,attribute:2,text:3,cdataSection:4,entityReference:5,entityNode:6,progressingInstruction:7,comment:8,document:9,documentType:10,documentFragment:11,notation:12},iRe=function(){return typeof window>"u"?null:window},oRe=function(t,n){if(typeof t!="object"||typeof t.createPolicy!="function")return null;let i=null,o="data-tt-policy-suffix";n&&n.hasAttribute(o)&&(i=n.getAttribute(o));let r="dompurify"+(i?"#"+i:"");try{return t.createPolicy(r,{createHTML(s){return s},createScriptURL(s){return s}})}catch{return console.warn("TrustedTypes policy "+r+" could not be created."),null}};function Gte(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:iRe(),t=on=>Gte(on);if(t.version="3.2.0",t.removed=[],!e||!e.document||e.document.nodeType!==CS.document)return t.isSupported=!1,t;let{document:n}=e,i=n,o=i.currentScript,{DocumentFragment:r,HTMLTemplateElement:s,Node:a,Element:l,NodeFilter:u,NamedNodeMap:f=e.NamedNodeMap||e.MozNamedAttrMap,HTMLFormElement:d,DOMParser:p,trustedTypes:g}=e,m=l.prototype,b=AS(m,"cloneNode"),x=AS(m,"remove"),T=AS(m,"nextSibling"),C=AS(m,"childNodes"),S=AS(m,"parentNode");if(typeof s=="function"){let on=n.createElement("template");on.content&&on.content.ownerDocument&&(n=on.content.ownerDocument)}let v,D="",{implementation:I,createNodeIterator:L,createDocumentFragment:M,getElementsByTagName:N}=n,{importNode:B}=i,_={};t.isSupported=typeof Vte=="function"&&typeof S=="function"&&I&&I.createHTMLDocument!==void 0;let{MUSTACHE_EXPR:w,ERB_EXPR:P,TMPLIT_EXPR:O,DATA_ATTR:F,ARIA_ATTR:V,IS_SCRIPT_OR_DATA:G,ATTR_WHITESPACE:z,CUSTOM_ELEMENT:W}=kte,{IS_ALLOWED_URI:U}=kte,q=null,K=Ai({},[...Lte,...OU,...RU,...MU,...Nte]),te=null,Y=Ai({},[...Fte,...LU,...Bte,...oO]),Z=Object.seal(Ute(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),ee=null,me=null,be=!0,le=!0,ge=!1,xe=!0,Pe=!1,Ee=!0,Ue=!1,Ye=!1,it=!1,It=!1,Ot=!1,He=!1,tn=!0,dt=!1,bt="user-content-",nn=!0,Ae=!1,Ce={},rt=null,Ri=Ai({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]),lt=null,ao=Ai({},["audio","video","img","source","image","track"]),Fo=null,va=Ai({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),Cr="http://www.w3.org/1998/Math/MathML",ss="http://www.w3.org/2000/svg",Le="http://www.w3.org/1999/xhtml",st=Le,Xe=!1,Ze=null,ht=Ai({},[Cr,ss,Le],IU),jt=Ai({},["mi","mo","mn","ms","mtext"]),gn=Ai({},["annotation-xml"]),To=Ai({},["title","style","font","a","script"]),_o=null,Da=["application/xhtml+xml","text/html"],Pa="text/html",pi=null,li=null,Hs=n.createElement("form"),kr=function(Se){return Se instanceof RegExp||Se instanceof Function},Hc=function(){let Se=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(li&&li===Se)){if((!Se||typeof Se!="object")&&(Se={}),Se=i0(Se),_o=Da.indexOf(Se.PARSER_MEDIA_TYPE)===-1?Pa:Se.PARSER_MEDIA_TYPE,pi=_o==="application/xhtml+xml"?IU:rO,q=Yf(Se,"ALLOWED_TAGS")?Ai({},Se.ALLOWED_TAGS,pi):K,te=Yf(Se,"ALLOWED_ATTR")?Ai({},Se.ALLOWED_ATTR,pi):Y,Ze=Yf(Se,"ALLOWED_NAMESPACES")?Ai({},Se.ALLOWED_NAMESPACES,IU):ht,Fo=Yf(Se,"ADD_URI_SAFE_ATTR")?Ai(i0(va),Se.ADD_URI_SAFE_ATTR,pi):va,lt=Yf(Se,"ADD_DATA_URI_TAGS")?Ai(i0(ao),Se.ADD_DATA_URI_TAGS,pi):ao,rt=Yf(Se,"FORBID_CONTENTS")?Ai({},Se.FORBID_CONTENTS,pi):Ri,ee=Yf(Se,"FORBID_TAGS")?Ai({},Se.FORBID_TAGS,pi):{},me=Yf(Se,"FORBID_ATTR")?Ai({},Se.FORBID_ATTR,pi):{},Ce=Yf(Se,"USE_PROFILES")?Se.USE_PROFILES:!1,be=Se.ALLOW_ARIA_ATTR!==!1,le=Se.ALLOW_DATA_ATTR!==!1,ge=Se.ALLOW_UNKNOWN_PROTOCOLS||!1,xe=Se.ALLOW_SELF_CLOSE_IN_ATTR!==!1,Pe=Se.SAFE_FOR_TEMPLATES||!1,Ee=Se.SAFE_FOR_XML!==!1,Ue=Se.WHOLE_DOCUMENT||!1,It=Se.RETURN_DOM||!1,Ot=Se.RETURN_DOM_FRAGMENT||!1,He=Se.RETURN_TRUSTED_TYPE||!1,it=Se.FORCE_BODY||!1,tn=Se.SANITIZE_DOM!==!1,dt=Se.SANITIZE_NAMED_PROPS||!1,nn=Se.KEEP_CONTENT!==!1,Ae=Se.IN_PLACE||!1,U=Se.ALLOWED_URI_REGEXP||zte,st=Se.NAMESPACE||Le,jt=Se.MATHML_TEXT_INTEGRATION_POINTS||jt,gn=Se.HTML_INTEGRATION_POINTS||gn,Z=Se.CUSTOM_ELEMENT_HANDLING||{},Se.CUSTOM_ELEMENT_HANDLING&&kr(Se.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(Z.tagNameCheck=Se.CUSTOM_ELEMENT_HANDLING.tagNameCheck),Se.CUSTOM_ELEMENT_HANDLING&&kr(Se.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(Z.attributeNameCheck=Se.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),Se.CUSTOM_ELEMENT_HANDLING&&typeof Se.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(Z.allowCustomizedBuiltInElements=Se.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),Pe&&(le=!1),Ot&&(It=!0),Ce&&(q=Ai({},Nte),te=[],Ce.html===!0&&(Ai(q,Lte),Ai(te,Fte)),Ce.svg===!0&&(Ai(q,OU),Ai(te,LU),Ai(te,oO)),Ce.svgFilters===!0&&(Ai(q,RU),Ai(te,LU),Ai(te,oO)),Ce.mathMl===!0&&(Ai(q,MU),Ai(te,Bte),Ai(te,oO))),Se.ADD_TAGS&&(q===K&&(q=i0(q)),Ai(q,Se.ADD_TAGS,pi)),Se.ADD_ATTR&&(te===Y&&(te=i0(te)),Ai(te,Se.ADD_ATTR,pi)),Se.ADD_URI_SAFE_ATTR&&Ai(Fo,Se.ADD_URI_SAFE_ATTR,pi),Se.FORBID_CONTENTS&&(rt===Ri&&(rt=i0(rt)),Ai(rt,Se.FORBID_CONTENTS,pi)),nn&&(q["#text"]=!0),Ue&&Ai(q,["html","head","body"]),q.table&&(Ai(q,["tbody"]),delete ee.tbody),Se.TRUSTED_TYPES_POLICY){if(typeof Se.TRUSTED_TYPES_POLICY.createHTML!="function")throw TS('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof Se.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw TS('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');v=Se.TRUSTED_TYPES_POLICY,D=v.createHTML("")}else v===void 0&&(v=oRe(g,o)),v!==null&&typeof D=="string"&&(D=v.createHTML(""));bc&&bc(Se),li=Se}},co=Ai({},[...OU,...RU,...Y1e]),Er=Ai({},[...MU,...X1e]),gm=function(Se){let Rt=S(Se);(!Rt||!Rt.tagName)&&(Rt={namespaceURI:st,tagName:"template"});let mn=rO(Se.tagName),lr=rO(Rt.tagName);return Ze[Se.namespaceURI]?Se.namespaceURI===ss?Rt.namespaceURI===Le?mn==="svg":Rt.namespaceURI===Cr?mn==="svg"&&(lr==="annotation-xml"||jt[lr]):!!co[mn]:Se.namespaceURI===Cr?Rt.namespaceURI===Le?mn==="math":Rt.namespaceURI===ss?mn==="math"&&gn[lr]:!!Er[mn]:Se.namespaceURI===Le?Rt.namespaceURI===ss&&!gn[lr]||Rt.namespaceURI===Cr&&!jt[lr]?!1:!Er[mn]&&(To[mn]||!co[mn]):!!(_o==="application/xhtml+xml"&&Ze[Se.namespaceURI]):!1},Vr=function(Se){bS(t.removed,{element:Se});try{S(Se).removeChild(Se)}catch{x(Se)}},Cu=function(Se,Rt){try{bS(t.removed,{attribute:Rt.getAttributeNode(Se),from:Rt})}catch{bS(t.removed,{attribute:null,from:Rt})}if(Rt.removeAttribute(Se),Se==="is"&&!te[Se])if(It||Ot)try{Vr(Rt)}catch{}else try{Rt.setAttribute(Se,"")}catch{}},Ia=function(Se){let Rt=null,mn=null;if(it)Se="<remove></remove>"+Se;else{let aa=Mte(Se,/^[\r\n\t ]+/);mn=aa&&aa[0]}_o==="application/xhtml+xml"&&st===Le&&(Se='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+Se+"</body></html>");let lr=v?v.createHTML(Se):Se;if(st===Le)try{Rt=new p().parseFromString(lr,_o)}catch{}if(!Rt||!Rt.documentElement){Rt=I.createDocument(st,"template",null);try{Rt.documentElement.innerHTML=Xe?D:lr}catch{}}let Ra=Rt.body||Rt.documentElement;return Se&&mn&&Ra.insertBefore(n.createTextNode(mn),Ra.childNodes[0]||null),st===Le?N.call(Rt,Ue?"html":"body")[0]:Ue?Rt.documentElement:Ra},Dy=function(Se){return L.call(Se.ownerDocument||Se,Se,u.SHOW_ELEMENT|u.SHOW_COMMENT|u.SHOW_TEXT|u.SHOW_PROCESSING_INSTRUCTION|u.SHOW_CDATA_SECTION,null)},sa=function(Se){return Se instanceof d&&(typeof Se.nodeName!="string"||typeof Se.textContent!="string"||typeof Se.removeChild!="function"||!(Se.attributes instanceof f)||typeof Se.removeAttribute!="function"||typeof Se.setAttribute!="function"||typeof Se.namespaceURI!="string"||typeof Se.insertBefore!="function"||typeof Se.hasChildNodes!="function")},Gc=function(Se){return typeof a=="function"&&Se instanceof a};function Oa(on,Se,Rt){_[on]&&iO(_[on],mn=>{mn.call(t,Se,Rt,li)})}let Kr=function(Se){let Rt=null;if(Oa("beforeSanitizeElements",Se,null),sa(Se))return Vr(Se),!0;let mn=pi(Se.nodeName);if(Oa("uponSanitizeElement",Se,{tagName:mn,allowedTags:q}),Se.hasChildNodes()&&!Gc(Se.firstElementChild)&&yc(/<[/\w]/g,Se.innerHTML)&&yc(/<[/\w]/g,Se.textContent)||Se.nodeType===CS.progressingInstruction||Ee&&Se.nodeType===CS.comment&&yc(/<[/\w]/g,Se.data))return Vr(Se),!0;if(!q[mn]||ee[mn]){if(!ee[mn]&&Su(mn)&&(Z.tagNameCheck instanceof RegExp&&yc(Z.tagNameCheck,mn)||Z.tagNameCheck instanceof Function&&Z.tagNameCheck(mn)))return!1;if(nn&&!rt[mn]){let lr=S(Se)||Se.parentNode,Ra=C(Se)||Se.childNodes;if(Ra&&lr){let aa=Ra.length;for(let jc=aa-1;jc>=0;--jc){let Zd=b(Ra[jc],!0);Zd.__removalCount=(Se.__removalCount||0)+1,lr.insertBefore(Zd,T(Se))}}}return Vr(Se),!0}return Se instanceof l&&!gm(Se)||(mn==="noscript"||mn==="noembed"||mn==="noframes")&&yc(/<\/no(script|embed|frames)/i,Se.innerHTML)?(Vr(Se),!0):(Pe&&Se.nodeType===CS.text&&(Rt=Se.textContent,iO([w,P,O],lr=>{Rt=xS(Rt,lr," ")}),Se.textContent!==Rt&&(bS(t.removed,{element:Se.cloneNode()}),Se.textContent=Rt)),Oa("afterSanitizeElements",Se,null),!1)},Eu=function(Se,Rt,mn){if(tn&&(Rt==="id"||Rt==="name")&&(mn in n||mn in Hs))return!1;if(!(le&&!me[Rt]&&yc(F,Rt))){if(!(be&&yc(V,Rt))){if(!te[Rt]||me[Rt]){if(!(Su(Se)&&(Z.tagNameCheck instanceof RegExp&&yc(Z.tagNameCheck,Se)||Z.tagNameCheck instanceof Function&&Z.tagNameCheck(Se))&&(Z.attributeNameCheck instanceof RegExp&&yc(Z.attributeNameCheck,Rt)||Z.attributeNameCheck instanceof Function&&Z.attributeNameCheck(Rt))||Rt==="is"&&Z.allowCustomizedBuiltInElements&&(Z.tagNameCheck instanceof RegExp&&yc(Z.tagNameCheck,mn)||Z.tagNameCheck instanceof Function&&Z.tagNameCheck(mn))))return!1}else if(!Fo[Rt]){if(!yc(U,xS(mn,z,""))){if(!((Rt==="src"||Rt==="xlink:href"||Rt==="href")&&Se!=="script"&&G1e(mn,"data:")===0&&lt[Se])){if(!(ge&&!yc(G,xS(mn,z,"")))){if(mn)return!1}}}}}}return!0},Su=function(Se){return Se!=="annotation-xml"&&Mte(Se,W)},wu=function(Se){Oa("beforeSanitizeAttributes",Se,null);let{attributes:Rt}=Se;if(!Rt)return;let mn={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:te,forceKeepAttr:void 0},lr=Rt.length;for(;lr--;){let Ra=Rt[lr],{name:aa,namespaceURI:jc,value:Zd}=Ra,nE=pi(aa),cc=aa==="value"?Zd:j1e(Zd);if(mn.attrName=nE,mn.attrValue=cc,mn.keepAttr=!0,mn.forceKeepAttr=void 0,Oa("uponSanitizeAttribute",Se,mn),cc=mn.attrValue,dt&&(nE==="id"||nE==="name")&&(Cu(aa,Se),cc=bt+cc),Ee&&yc(/((--!?|])>)|<\/(style|title)/i,cc)){Cu(aa,Se);continue}if(mn.forceKeepAttr||(Cu(aa,Se),!mn.keepAttr))continue;if(!xe&&yc(/\/>/i,cc)){Cu(aa,Se);continue}Pe&&iO([w,P,O],M$=>{cc=xS(cc,M$," ")});let R$=pi(Se.nodeName);if(Eu(R$,nE,cc)){if(v&&typeof g=="object"&&typeof g.getAttributeType=="function"&&!jc)switch(g.getAttributeType(R$,nE)){case"TrustedHTML":{cc=v.createHTML(cc);break}case"TrustedScriptURL":{cc=v.createScriptURL(cc);break}}try{jc?Se.setAttributeNS(jc,aa,cc):Se.setAttribute(aa,cc),sa(Se)?Vr(Se):Rte(t.removed)}catch{}}}Oa("afterSanitizeAttributes",Se,null)},So=function on(Se){let Rt=null,mn=Dy(Se);for(Oa("beforeSanitizeShadowDOM",Se,null);Rt=mn.nextNode();)Oa("uponSanitizeShadowNode",Rt,null),!Kr(Rt)&&(Rt.content instanceof r&&on(Rt.content),wu(Rt));Oa("afterSanitizeShadowDOM",Se,null)};return t.sanitize=function(on){let Se=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},Rt=null,mn=null,lr=null,Ra=null;if(Xe=!on,Xe&&(on="<!-->"),typeof on!="string"&&!Gc(on))if(typeof on.toString=="function"){if(on=on.toString(),typeof on!="string")throw TS("dirty is not a string, aborting")}else throw TS("toString is not a function");if(!t.isSupported)return on;if(Ye||Hc(Se),t.removed=[],typeof on=="string"&&(Ae=!1),Ae){if(on.nodeName){let Zd=pi(on.nodeName);if(!q[Zd]||ee[Zd])throw TS("root node is forbidden and cannot be sanitized in-place")}}else if(on instanceof a)Rt=Ia("<!---->"),mn=Rt.ownerDocument.importNode(on,!0),mn.nodeType===CS.element&&mn.nodeName==="BODY"||mn.nodeName==="HTML"?Rt=mn:Rt.appendChild(mn);else{if(!It&&!Pe&&!Ue&&on.indexOf("<")===-1)return v&&He?v.createHTML(on):on;if(Rt=Ia(on),!Rt)return It?null:He?D:""}Rt&&it&&Vr(Rt.firstChild);let aa=Dy(Ae?on:Rt);for(;lr=aa.nextNode();)Kr(lr)||(lr.content instanceof r&&So(lr.content),wu(lr));if(Ae)return on;if(It){if(Ot)for(Ra=M.call(Rt.ownerDocument);Rt.firstChild;)Ra.appendChild(Rt.firstChild);else Ra=Rt;return(te.shadowroot||te.shadowrootmode)&&(Ra=B.call(i,Ra,!0)),Ra}let jc=Ue?Rt.outerHTML:Rt.innerHTML;return Ue&&q["!doctype"]&&Rt.ownerDocument&&Rt.ownerDocument.doctype&&Rt.ownerDocument.doctype.name&&yc(Hte,Rt.ownerDocument.doctype.name)&&(jc="<!DOCTYPE "+Rt.ownerDocument.doctype.name+`>
`+jc),Pe&&iO([w,P,O],Zd=>{jc=xS(jc,Zd," ")}),v&&He?v.createHTML(jc):jc},t.setConfig=function(){let on=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Hc(on),Ye=!0},t.clearConfig=function(){li=null,Ye=!1},t.isValidAttribute=function(on,Se,Rt){li||Hc({});let mn=pi(on),lr=pi(Se);return Eu(mn,lr,Rt)},t.addHook=function(on,Se){typeof Se=="function"&&(_[on]=_[on]||[],bS(_[on],Se))},t.removeHook=function(on){if(_[on])return Rte(_[on])},t.removeHooks=function(on){_[on]&&(_[on]=[])},t.removeAllHooks=function(){_={}},t}var jte=Gte();var rRe=0,BU={};function uh(e,t){A.typeOf.string("html",e);let n,i=e;c(BU[i])?n=BU[i]:(n=rRe++,BU[i]=n),t=y(t,!1),this._id=n,this._html=e,this._showOnScreen=t,this._element=void 0}Object.defineProperties(uh.prototype,{html:{get:function(){return this._html}},id:{get:function(){return this._id}},showOnScreen:{get:function(){return this._showOnScreen},set:function(e){this._showOnScreen=e}},element:{get:function(){if(!c(this._element)){let e=jte.sanitize(this._html),t=document.createElement("div");t.className="cesium-credit-wrapper",t._creditId=this._id,t.style.display="inline",t.innerHTML=e;let n=t.querySelectorAll("a");for(let i=0;i<n.length;i++)n[i].setAttribute("target","_blank");this._element=t}return this._element}}});uh.equals=function(e,t){return e===t||c(e)&&c(t)&&e._id===t._id&&e._showOnScreen===t._showOnScreen};uh.prototype.equals=function(e){return uh.equals(this,e)};uh.prototype.isIon=function(){return this.html.indexOf("ion-credit.png")!==-1};uh.getIonCredit=function(e){let t=c(e.collapsible)&&!e.collapsible;return new uh(e.html,t)};uh.clone=function(e){if(c(e))return new uh(e.html,e.showOnScreen)};var Pt=uh;function o0(e){this._url=e,this._cubeMapBuffers=void 0,this._texture=void 0,this._maximumMipmapLevel=void 0,this._loading=!1,this._ready=!1,this._errorEvent=new pe}Object.defineProperties(o0.prototype,{url:{get:function(){return this._url}},errorEvent:{get:function(){return this._errorEvent}},texture:{get:function(){return this._texture}},maximumMipmapLevel:{get:function(){return this._maximumMipmapLevel}},ready:{get:function(){return this._ready}}});o0.isSupported=function(e){return(e.colorBufferHalfFloat&&e.halfFloatingPointTexture||e.floatingPointTexture&&e.colorBufferFloat)&&e.supportsTextureLod};function kU(e){e._cubeMapBuffers=void 0}o0.prototype.update=function(e){let{context:t}=e;if(!o0.isSupported(t))return;if(c(this._texture)){kU(this);return}if(!c(this._texture)&&!this._loading){let f=t.textureCache.getTexture(this._url);c(f)&&(kU(this),this._texture=f,this._maximumMipmapLevel=this._texture.maximumMipmapLevel,this._ready=!0)}let n=this._cubeMapBuffers;if(!c(n)&&!this._loading){let f=this;Mu(this._url).then(function(d){f._cubeMapBuffers=d,f._loading=!1}).catch(function(d){f.isDestroyed()||f._errorEvent.raiseEvent(d)}),this._loading=!0}if(!c(this._cubeMapBuffers))return;let{pixelDatatype:i}=n[0].positiveX;c(i)||(i=t.halfFloatingPointTexture?Be.HALF_FLOAT:Be.FLOAT);let o=Ve.RGBA,r=n.length;this._maximumMipmapLevel=r-1;let s=n[0].positiveX.width,a=Math.log2(s)+1;if(r!==a){let f={};Object.values(Jo.FaceName).forEach(d=>{f[d]=void 0});for(let d=r;d<a;d++)n.push(f)}let l=new Qt({minificationFilter:$t.LINEAR_MIPMAP_LINEAR}),u=new Jo({context:t,source:n[0],flipY:!1,pixelDatatype:i,pixelFormat:o,sampler:l});u.loadMipmaps(n.slice(1)),this._texture=u,this._texture.maximumMipmapLevel=this._maximumMipmapLevel,t.textureCache.addTexture(this._url,this._texture),this._ready=!0};o0.prototype.isDestroyed=function(){return!1};o0.prototype.destroy=function(){return kU(this),this._texture=this._texture&&this._texture.destroy(),de(this)};var Gm=o0;function ES(e){e=y(e,y.EMPTY_OBJECT);let t=c(e.imageBasedLightingFactor)?H.clone(e.imageBasedLightingFactor):new H(1,1);A.typeOf.object("options.imageBasedLightingFactor",t),A.typeOf.number.greaterThanOrEquals("options.imageBasedLightingFactor.x",t.x,0),A.typeOf.number.lessThanOrEquals("options.imageBasedLightingFactor.x",t.x,1),A.typeOf.number.greaterThanOrEquals("options.imageBasedLightingFactor.y",t.y,0),A.typeOf.number.lessThanOrEquals("options.imageBasedLightingFactor.y",t.y,1),this._imageBasedLightingFactor=t;let n=e.sphericalHarmonicCoefficients;if(c(n)&&(!Array.isArray(n)||n.length!==9))throw new E("options.sphericalHarmonicCoefficients must be an array of 9 Cartesian3 values.");this._sphericalHarmonicCoefficients=n,this._specularEnvironmentMaps=e.specularEnvironmentMaps,this._specularEnvironmentCubeMap=void 0,this._specularEnvironmentCubeMapDirty=!0,this._specularEnvironmentMapLoaded=!1,this._previousSpecularEnvironmentMapLoaded=!1,this._useDefaultSpecularMaps=!1,this._useDefaultSphericalHarmonics=!1,this._shouldRegenerateShaders=!1,this._previousFrameNumber=void 0,this._previousImageBasedLightingFactor=H.clone(t),this._previousSphericalHarmonicCoefficients=n,this._removeErrorListener=void 0}Object.defineProperties(ES.prototype,{imageBasedLightingFactor:{get:function(){return this._imageBasedLightingFactor},set:function(e){A.typeOf.object("imageBasedLightingFactor",e),A.typeOf.number.greaterThanOrEquals("imageBasedLightingFactor.x",e.x,0),A.typeOf.number.lessThanOrEquals("imageBasedLightingFactor.x",e.x,1),A.typeOf.number.greaterThanOrEquals("imageBasedLightingFactor.y",e.y,0),A.typeOf.number.lessThanOrEquals("imageBasedLightingFactor.y",e.y,1),this._previousImageBasedLightingFactor=H.clone(this._imageBasedLightingFactor,this._previousImageBasedLightingFactor),this._imageBasedLightingFactor=H.clone(e,this._imageBasedLightingFactor)}},sphericalHarmonicCoefficients:{get:function(){return this._sphericalHarmonicCoefficients},set:function(e){if(c(e)&&(!Array.isArray(e)||e.length!==9))throw new E("sphericalHarmonicCoefficients must be an array of 9 Cartesian3 values.");this._previousSphericalHarmonicCoefficients=this._sphericalHarmonicCoefficients,this._sphericalHarmonicCoefficients=e}},specularEnvironmentMaps:{get:function(){return this._specularEnvironmentMaps},set:function(e){e!==this._specularEnvironmentMaps&&(this._specularEnvironmentCubeMapDirty=this._specularEnvironmentCubeMapDirty||e!==this._specularEnvironmentMaps,this._specularEnvironmentMapLoaded=!1),this._specularEnvironmentMaps=e}},enabled:{get:function(){return this._imageBasedLightingFactor.x>0||this._imageBasedLightingFactor.y>0}},shouldRegenerateShaders:{get:function(){return this._shouldRegenerateShaders}},specularEnvironmentCubeMap:{get:function(){return this._specularEnvironmentCubeMap}},useDefaultSphericalHarmonics:{get:function(){return this._useDefaultSphericalHarmonics}},useDefaultSpecularMaps:{get:function(){return this._useDefaultSpecularMaps}},useSpecularEnvironmentMaps:{get:function(){return c(this._specularEnvironmentCubeMap)&&this._specularEnvironmentCubeMap.ready||this._useDefaultSpecularMaps}}});function sRe(e,t){if(Gm.isSupported(t)){if(e._specularEnvironmentCubeMap=e._specularEnvironmentCubeMap&&e._specularEnvironmentCubeMap.destroy(),c(e._specularEnvironmentMaps)){let n=new Gm(e._specularEnvironmentMaps);e._specularEnvironmentCubeMap=n,e._removeErrorListener=n.errorEvent.addEventListener(i=>{console.error(`Error loading specularEnvironmentMaps: ${i}`)})}e._shouldRegenerateShaders=!0}}ES.prototype.update=function(e){if(e.frameNumber===this._previousFrameNumber)return;this._previousFrameNumber=e.frameNumber;let t=e.context;e.brdfLutGenerator.update(e),this._shouldRegenerateShaders=!1;let n=this._imageBasedLightingFactor,i=this._previousImageBasedLightingFactor;H.equals(n,i)||(this._shouldRegenerateShaders=n.x>0&&i.x===0||n.x===0&&i.x>0,this._shouldRegenerateShaders=this._shouldRegenerateShaders||n.y>0&&i.y===0||n.y===0&&i.y>0,this._previousImageBasedLightingFactor=H.clone(this._imageBasedLightingFactor,this._previousImageBasedLightingFactor)),this._previousSphericalHarmonicCoefficients!==this._sphericalHarmonicCoefficients&&(this._shouldRegenerateShaders=this._shouldRegenerateShaders||c(this._previousSphericalHarmonicCoefficients)!==c(this._sphericalHarmonicCoefficients),this._previousSphericalHarmonicCoefficients=this._sphericalHarmonicCoefficients),this._shouldRegenerateShaders=this._shouldRegenerateShaders||this._previousSpecularEnvironmentMapLoaded!==this._specularEnvironmentMapLoaded,this._previousSpecularEnvironmentMapLoaded=this._specularEnvironmentMapLoaded,this._specularEnvironmentCubeMapDirty&&(sRe(this,t),this._specularEnvironmentCubeMapDirty=!1),c(this._specularEnvironmentCubeMap)&&(this._specularEnvironmentCubeMap.update(e),this._specularEnvironmentCubeMap.ready&&(this._specularEnvironmentMapLoaded=!0));let o=!c(this._specularEnvironmentCubeMap)&&c(e.specularEnvironmentMaps)&&!this._useDefaultSpecularMaps,r=!c(e.specularEnvironmentMaps)&&this._useDefaultSpecularMaps,s=!c(this._sphericalHarmonicCoefficients)&&c(e.sphericalHarmonicCoefficients)&&!this._useDefaultSphericalHarmonics,a=!c(e.sphericalHarmonicCoefficients)&&this._useDefaultSphericalHarmonics;this._shouldRegenerateShaders=this._shouldRegenerateShaders||o||r||s||a,this._useDefaultSpecularMaps=!c(this._specularEnvironmentCubeMap)&&c(e.specularEnvironmentMaps),this._useDefaultSphericalHarmonics=!c(this._sphericalHarmonicCoefficients)&&c(e.sphericalHarmonicCoefficients)};ES.prototype.isDestroyed=function(){return!1};ES.prototype.destroy=function(){return this._specularEnvironmentCubeMap=this._specularEnvironmentCubeMap&&this._specularEnvironmentCubeMap.destroy(),this._removeErrorListener=this._removeErrorListener&&this._removeErrorListener(),de(this)};var SS=ES;var UU=Ur(Pl(),1);var VU,Wte="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiJiZjBmMDE4Ny05M2JlLTRlMzgtYjIxYi05YmJjM2QwMzJkYWMiLCJpZCI6MjU5LCJpYXQiOjE3MzA0NjY3MDl9.t-7gCGPUe-oGCyCoeXPtYmlMVdgqUQD9mn-Da23yUoI",sO={};sO.defaultAccessToken=Wte;sO.defaultServer=new De({url:"https://api.cesium.com/"});sO.getDefaultTokenCredit=function(e){if(e===Wte){if(!c(VU)){let t=`<b>             This application is using Cesium's default ion access token. Please assign <i>Cesium.Ion.defaultAccessToken</i>             with an access token from your ion account before making any Cesium API calls.             You can sign up for a free ion account at <a href="https://cesium.com">https://cesium.com</a>.</b>`;VU=new Pt(t,!0)}return VU}};var jm=sO;function xc(e,t){A.defined("endpoint",e),A.defined("endpointResource",t);let n,i=e.externalType,o=c(i);if(!o)n={url:e.url,retryAttempts:1,retryCallback:aRe};else if(i==="3DTILES"||i==="STK_TERRAIN_SERVER")n={url:e.options.url};else throw new ue("Ion.createResource does not support external imagery assets; use IonImageryProvider instead.");De.call(this,n),this._ionEndpoint=e,this._ionEndpointDomain=o?void 0:new UU.default(e.url).authority(),this._ionEndpointResource=t,this._ionRoot=void 0,this._pendingPromise=void 0,this._credits=void 0,this._isExternal=o}c(Object.create)&&(xc.prototype=Object.create(De.prototype),xc.prototype.constructor=xc);xc.fromAssetId=function(e,t){let n=xc._createEndpointResource(e,t);return n.fetchJson().then(function(i){return new xc(i,n)})};Object.defineProperties(xc.prototype,{credits:{get:function(){return c(this._ionRoot)?this._ionRoot.credits:c(this._credits)?this._credits:(this._credits=xc.getCreditsFromEndpoint(this._ionEndpoint,this._ionEndpointResource),this._credits)}}});xc.getCreditsFromEndpoint=function(e,t){let n=e.attributions.map(Pt.getIonCredit),i=jm.getDefaultTokenCredit(t.queryParameters.access_token);return c(i)&&n.push(Pt.clone(i)),n};xc.prototype.clone=function(e){let t=y(this._ionRoot,this);return c(e)||(e=new xc(t._ionEndpoint,t._ionEndpointResource)),e=De.prototype.clone.call(this,e),e._ionRoot=t,e._isExternal=this._isExternal,e};xc.prototype.fetchImage=function(e){if(!this._isExternal){let t=e;e={preferBlob:!0},c(t)&&(e.flipY=t.flipY,e.preferImageBitmap=t.preferImageBitmap)}return De.prototype.fetchImage.call(this,e)};xc.prototype._makeRequest=function(e){return this._isExternal||new UU.default(this.url).authority()!==this._ionEndpointDomain?De.prototype._makeRequest.call(this,e):(c(e.headers)||(e.headers={}),e.headers.Authorization=`Bearer ${this._ionEndpoint.accessToken}`,e.headers["X-Cesium-Client"]="CesiumJS",typeof CESIUM_VERSION<"u"&&(e.headers["X-Cesium-Client-Version"]=CESIUM_VERSION),De.prototype._makeRequest.call(this,e))};xc._createEndpointResource=function(e,t){A.defined("assetId",e),t=y(t,y.EMPTY_OBJECT);let n=y(t.server,jm.defaultServer),i=y(t.accessToken,jm.defaultAccessToken);n=De.createIfNeeded(n);let o={url:`v1/assets/${e}/endpoint`};return c(i)&&(o.queryParameters={access_token:i}),n.getDerivedResource(o)};function aRe(e,t){let n=y(e._ionRoot,e),i=n._ionEndpointResource,o=typeof Image<"u";return!c(t)||t.statusCode!==401&&!(o&&t.target instanceof Image)?Promise.resolve(!1):(c(n._pendingPromise)||(n._pendingPromise=i.fetchJson().then(function(r){return n._ionEndpoint=r,r}).finally(function(r){return n._pendingPromise=void 0,r})),n._pendingPromise.then(function(r){return e._ionEndpoint=r,!0}))}var Xf=xc;function fh(e){e=y(e,0),this._array=new Array(e),this._length=e}Object.defineProperties(fh.prototype,{length:{get:function(){return this._length},set:function(e){A.typeOf.number.greaterThanOrEquals("length",e,0);let t=this._array,n=this._length;if(e<n)for(let i=e;i<n;++i)t[i]=void 0;else e>t.length&&(t.length=e);this._length=e}},values:{get:function(){return this._array}}});fh.prototype.get=function(e){return A.typeOf.number.lessThan("index",e,this._array.length),this._array[e]};fh.prototype.set=function(e,t){A.typeOf.number("index",e),e>=this._length&&(this.length=e+1),this._array[e]=t};fh.prototype.peek=function(){return this._array[this._length-1]};fh.prototype.push=function(e){let t=this.length++;this._array[t]=e};fh.prototype.pop=function(){if(this._length===0)return;let e=this._array[this._length-1];return--this.length,e};fh.prototype.reserve=function(e){A.typeOf.number.greaterThanOrEquals("length",e,0),e>this._array.length&&(this._array.length=e)};fh.prototype.resize=function(e){A.typeOf.number.greaterThanOrEquals("length",e,0),this.length=e};fh.prototype.trim=function(e){e=y(e,this._length),this._array.length=e};var Bl=fh;function aO(e){e=y(e,y.EMPTY_OBJECT),this.color=e.color,this.depth=e.depth,this.stencil=e.stencil,this.renderState=e.renderState,this.framebuffer=e.framebuffer,this.owner=e.owner,this.pass=e.pass}aO.ALL=Object.freeze(new aO({color:new j(0,0,0,0),depth:1,stencil:0}));aO.prototype.execute=function(e,t){e.clear(this,t)};var ri=aO;var Wm={X:0,Y:1,Z:2};Wm.Y_UP_TO_Z_UP=k.fromRotationTranslation(Q.fromArray([1,0,0,0,0,1,0,-1,0]));Wm.Z_UP_TO_Y_UP=k.fromRotationTranslation(Q.fromArray([1,0,0,0,0,-1,0,1,0]));Wm.X_UP_TO_Z_UP=k.fromRotationTranslation(Q.fromArray([0,0,1,0,1,0,-1,0,0]));Wm.Z_UP_TO_X_UP=k.fromRotationTranslation(Q.fromArray([0,0,-1,0,1,0,1,0,0]));Wm.X_UP_TO_Y_UP=k.fromRotationTranslation(Q.fromArray([0,1,0,-1,0,0,0,0,1]));Wm.Y_UP_TO_X_UP=k.fromRotationTranslation(Q.fromArray([0,-1,0,1,0,0,0,0,1]));Wm.fromName=function(e){return A.typeOf.string("name",e),Wm[e]};var zo=Object.freeze(Wm);function Hu(e){this.planes=y(e,[])}var wS=[new h,new h,new h];h.clone(h.UNIT_X,wS[0]);h.clone(h.UNIT_Y,wS[1]);h.clone(h.UNIT_Z,wS[2]);var v_=new h,cRe=new h,qte=new un(new h(1,0,0),0);Hu.fromBoundingSphere=function(e,t){if(!c(e))throw new E("boundingSphere is required.");c(t)||(t=new Hu);let n=wS.length,i=t.planes;i.length=2*n;let o=e.center,r=e.radius,s=0;for(let a=0;a<n;++a){let l=wS[a],u=i[s],f=i[s+1];c(u)||(u=i[s]=new se),c(f)||(f=i[s+1]=new se),h.multiplyByScalar(l,-r,v_),h.add(o,v_,v_),u.x=l.x,u.y=l.y,u.z=l.z,u.w=-h.dot(l,v_),h.multiplyByScalar(l,r,v_),h.add(o,v_,v_),f.x=-l.x,f.y=-l.y,f.z=-l.z,f.w=-h.dot(h.negate(l,cRe),v_),s+=2}return t};Hu.prototype.computeVisibility=function(e){if(!c(e))throw new E("boundingVolume is required.");let t=this.planes,n=!1;for(let i=0,o=t.length;i<o;++i){let r=e.intersectPlane(un.fromCartesian4(t[i],qte));if(r===qt.OUTSIDE)return qt.OUTSIDE;r===qt.INTERSECTING&&(n=!0)}return n?qt.INTERSECTING:qt.INSIDE};Hu.prototype.computeVisibilityWithPlaneMask=function(e,t){if(!c(e))throw new E("boundingVolume is required.");if(!c(t))throw new E("parentPlaneMask is required.");if(t===Hu.MASK_OUTSIDE||t===Hu.MASK_INSIDE)return t;let n=Hu.MASK_INSIDE,i=this.planes;for(let o=0,r=i.length;o<r;++o){let s=o<31?1<<o:0;if(o<31&&!(t&s))continue;let a=e.intersectPlane(un.fromCartesian4(i[o],qte));if(a===qt.OUTSIDE)return Hu.MASK_OUTSIDE;a===qt.INTERSECTING&&(n|=s)}return n};Hu.MASK_OUTSIDE=4294967295;Hu.MASK_INSIDE=0;Hu.MASK_INDETERMINATE=2147483647;var Os=Hu;function dh(e){e=y(e,y.EMPTY_OBJECT),this.left=e.left,this._left=void 0,this.right=e.right,this._right=void 0,this.top=e.top,this._top=void 0,this.bottom=e.bottom,this._bottom=void 0,this.near=y(e.near,1),this._near=this.near,this.far=y(e.far,5e8),this._far=this.far,this._cullingVolume=new Os,this._orthographicMatrix=new k}function Yte(e){if(!c(e.right)||!c(e.left)||!c(e.top)||!c(e.bottom)||!c(e.near)||!c(e.far))throw new E("right, left, top, bottom, near, or far parameters are not set.");if(e.top!==e._top||e.bottom!==e._bottom||e.left!==e._left||e.right!==e._right||e.near!==e._near||e.far!==e._far){if(e.left>e.right)throw new E("right must be greater than left.");if(e.bottom>e.top)throw new E("top must be greater than bottom.");if(e.near<=0||e.near>e.far)throw new E("near must be greater than zero and less than far.");e._left=e.left,e._right=e.right,e._top=e.top,e._bottom=e.bottom,e._near=e.near,e._far=e.far,e._orthographicMatrix=k.computeOrthographicOffCenter(e.left,e.right,e.bottom,e.top,e.near,e.far,e._orthographicMatrix)}}Object.defineProperties(dh.prototype,{projectionMatrix:{get:function(){return Yte(this),this._orthographicMatrix}}});var lRe=new h,uRe=new h,fRe=new h,zU=new h;dh.prototype.computeCullingVolume=function(e,t,n){if(!c(e))throw new E("position is required.");if(!c(t))throw new E("direction is required.");if(!c(n))throw new E("up is required.");let i=this._cullingVolume.planes,o=this.top,r=this.bottom,s=this.right,a=this.left,l=this.near,u=this.far,f=h.cross(t,n,lRe);h.normalize(f,f);let d=uRe;h.multiplyByScalar(t,l,d),h.add(e,d,d);let p=fRe;h.multiplyByScalar(f,a,p),h.add(d,p,p);let g=i[0];return c(g)||(g=i[0]=new se),g.x=f.x,g.y=f.y,g.z=f.z,g.w=-h.dot(f,p),h.multiplyByScalar(f,s,p),h.add(d,p,p),g=i[1],c(g)||(g=i[1]=new se),g.x=-f.x,g.y=-f.y,g.z=-f.z,g.w=-h.dot(h.negate(f,zU),p),h.multiplyByScalar(n,r,p),h.add(d,p,p),g=i[2],c(g)||(g=i[2]=new se),g.x=n.x,g.y=n.y,g.z=n.z,g.w=-h.dot(n,p),h.multiplyByScalar(n,o,p),h.add(d,p,p),g=i[3],c(g)||(g=i[3]=new se),g.x=-n.x,g.y=-n.y,g.z=-n.z,g.w=-h.dot(h.negate(n,zU),p),g=i[4],c(g)||(g=i[4]=new se),g.x=t.x,g.y=t.y,g.z=t.z,g.w=-h.dot(t,d),h.multiplyByScalar(t,u,p),h.add(e,p,p),g=i[5],c(g)||(g=i[5]=new se),g.x=-t.x,g.y=-t.y,g.z=-t.z,g.w=-h.dot(h.negate(t,zU),p),this._cullingVolume};dh.prototype.getPixelDimensions=function(e,t,n,i,o){if(Yte(this),!c(e)||!c(t))throw new E("Both drawingBufferWidth and drawingBufferHeight are required.");if(e<=0)throw new E("drawingBufferWidth must be greater than zero.");if(t<=0)throw new E("drawingBufferHeight must be greater than zero.");if(!c(n))throw new E("distance is required.");if(!c(i))throw new E("pixelRatio is required.");if(i<=0)throw new E("pixelRatio must be greater than zero.");if(!c(o))throw new E("A result object is required.");let r=this.right-this.left,s=this.top-this.bottom,a=i*r/e,l=i*s/t;return o.x=a,o.y=l,o};dh.prototype.clone=function(e){return c(e)||(e=new dh),e.left=this.left,e.right=this.right,e.top=this.top,e.bottom=this.bottom,e.near=this.near,e.far=this.far,e._left=void 0,e._right=void 0,e._top=void 0,e._bottom=void 0,e._near=void 0,e._far=void 0,e};dh.prototype.equals=function(e){return c(e)&&e instanceof dh&&this.right===e.right&&this.left===e.left&&this.top===e.top&&this.bottom===e.bottom&&this.near===e.near&&this.far===e.far};dh.prototype.equalsEpsilon=function(e,t,n){return e===this||c(e)&&e instanceof dh&&R.equalsEpsilon(this.right,e.right,t,n)&&R.equalsEpsilon(this.left,e.left,t,n)&&R.equalsEpsilon(this.top,e.top,t,n)&&R.equalsEpsilon(this.bottom,e.bottom,t,n)&&R.equalsEpsilon(this.near,e.near,t,n)&&R.equalsEpsilon(this.far,e.far,t,n)};var er=dh;function tl(e){e=y(e,y.EMPTY_OBJECT),this._offCenterFrustum=new er,this.width=e.width,this._width=void 0,this.aspectRatio=e.aspectRatio,this._aspectRatio=void 0,this.near=y(e.near,1),this._near=this.near,this.far=y(e.far,5e8),this._far=this.far}tl.packedLength=4;tl.pack=function(e,t,n){return A.typeOf.object("value",e),A.defined("array",t),n=y(n,0),t[n++]=e.width,t[n++]=e.aspectRatio,t[n++]=e.near,t[n]=e.far,t};tl.unpack=function(e,t,n){return A.defined("array",e),t=y(t,0),c(n)||(n=new tl),n.width=e[t++],n.aspectRatio=e[t++],n.near=e[t++],n.far=e[t],n};function D_(e){if(!c(e.width)||!c(e.aspectRatio)||!c(e.near)||!c(e.far))throw new E("width, aspectRatio, near, or far parameters are not set.");let t=e._offCenterFrustum;if(e.width!==e._width||e.aspectRatio!==e._aspectRatio||e.near!==e._near||e.far!==e._far){if(e.aspectRatio<0)throw new E("aspectRatio must be positive.");if(e.near<0||e.near>e.far)throw new E("near must be greater than zero and less than far.");e._aspectRatio=e.aspectRatio,e._width=e.width,e._near=e.near,e._far=e.far;let n=1/e.aspectRatio;t.right=e.width*.5,t.left=-t.right,t.top=n*t.right,t.bottom=-t.top,t.near=e.near,t.far=e.far}}Object.defineProperties(tl.prototype,{projectionMatrix:{get:function(){return D_(this),this._offCenterFrustum.projectionMatrix}},offCenterFrustum:{get:function(){return D_(this),this._offCenterFrustum}}});tl.prototype.computeCullingVolume=function(e,t,n){return D_(this),this._offCenterFrustum.computeCullingVolume(e,t,n)};tl.prototype.getPixelDimensions=function(e,t,n,i,o){return D_(this),this._offCenterFrustum.getPixelDimensions(e,t,n,i,o)};tl.prototype.clone=function(e){return c(e)||(e=new tl),e.aspectRatio=this.aspectRatio,e.width=this.width,e.near=this.near,e.far=this.far,e._aspectRatio=void 0,e._width=void 0,e._near=void 0,e._far=void 0,this._offCenterFrustum.clone(e._offCenterFrustum),e};tl.prototype.equals=function(e){return!c(e)||!(e instanceof tl)?!1:(D_(this),D_(e),this.width===e.width&&this.aspectRatio===e.aspectRatio&&this._offCenterFrustum.equals(e._offCenterFrustum))};tl.prototype.equalsEpsilon=function(e,t,n){return!c(e)||!(e instanceof tl)?!1:(D_(this),D_(e),R.equalsEpsilon(this.width,e.width,t,n)&&R.equalsEpsilon(this.aspectRatio,e.aspectRatio,t,n)&&this._offCenterFrustum.equalsEpsilon(e._offCenterFrustum,t,n))};var rn=tl;function Xte(e){e=y(e,y.EMPTY_OBJECT),A.typeOf.object("options.metadata",e.metadata),this._metadata=e.metadata}Object.defineProperties(Xte.prototype,{metadata:{get:function(){return this._metadata}}});var vS=Xte;function P_(e,t,n){if(!c(e))throw new E("uint8Array is required.");if(t<0)throw new E("byteOffset cannot be negative.");if(n<0)throw new E("byteLength cannot be negative.");if(t+n>e.byteLength)throw new E("sub-region exceeds array bounds.");return t=y(t,0),n=y(n,e.byteLength-t),e=e.subarray(t,t+n),P_.decode(e)}P_.decodeWithTextDecoder=function(e){return new TextDecoder("utf-8").decode(e)};P_.decodeWithFromCharCode=function(e){let t="",n=dRe(e),i=n.length;for(let o=0;o<i;++o){let r=n[o];r<=65535?t+=String.fromCharCode(r):(r-=65536,t+=String.fromCharCode((r>>10)+55296,(r&1023)+56320))}return t};function DS(e,t,n){return t<=e&&e<=n}function dRe(e){let t=0,n=0,i=0,o=128,r=191,s=[],a=e.length;for(let l=0;l<a;++l){let u=e[l];if(i===0){if(DS(u,0,127)){s.push(u);continue}if(DS(u,194,223)){i=1,t=u&31;continue}if(DS(u,224,239)){u===224&&(o=160),u===237&&(r=159),i=2,t=u&15;continue}if(DS(u,240,244)){u===240&&(o=144),u===244&&(r=143),i=3,t=u&7;continue}throw new ue("String decoding failed.")}if(!DS(u,o,r)){t=i=n=0,o=128,r=191,--l;continue}o=128,r=191,t=t<<6|u&63,++n,n===i&&(s.push(t),t=i=n=0)}return s}typeof TextDecoder<"u"?P_.decode=P_.decodeWithTextDecoder:P_.decode=P_.decodeWithFromCharCode;var Gu=P_;function hRe(e,t){return t=y(t,0),Gu(e,t,Math.min(4,e.length))}var qm=hRe;function ju(e,t,n,i){this._tileset=e,this._tile=t,this._resource=n,c(i)||(i=[]),this._contents=i,this._metadata=void 0,this._group=void 0,this._ready=!1}Object.defineProperties(ju.prototype,{featurePropertiesDirty:{get:function(){let e=this._contents,t=e.length;for(let n=0;n<t;++n)if(e[n].featurePropertiesDirty)return!0;return!1},set:function(e){let t=this._contents,n=t.length;for(let i=0;i<n;++i)t[i].featurePropertiesDirty=e}},featuresLength:{get:function(){return 0}},pointsLength:{get:function(){return 0}},trianglesLength:{get:function(){return 0}},geometryByteLength:{get:function(){return 0}},texturesByteLength:{get:function(){return 0}},batchTableByteLength:{get:function(){return 0}},innerContents:{get:function(){return this._contents}},ready:{get:function(){return this._ready}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){return this._resource.getUrlComponent(!0)}},metadata:{get:function(){return this._metadata},set:function(e){this._metadata=e;let t=this._contents,n=t.length;for(let i=0;i<n;++i)t[i].metadata=e}},batchTable:{get:function(){}},group:{get:function(){return this._group},set:function(e){this._group=e;let t=this._contents,n=t.length;for(let i=0;i<n;++i)t[i].group=e}}});var PS=Uint32Array.BYTES_PER_ELEMENT;ju.fromTileType=async function(e,t,n,i,o,r){o=y(o,0);let s=new Uint8Array(i),a=new DataView(i);o+=PS;let l=a.getUint32(o,!0);if(l!==1)throw new ue(`Only Composite Tile version 1 is supported. Version ${l} is not.`);o+=PS,o+=PS;let u=a.getUint32(o,!0);o+=PS;let f=n.queryParameters.compositeIndex;c(f)?f=`${f}_`:f="";let d=[];d.length=u;for(let m=0;m<u;++m){let b=qm(s,o),x=a.getUint32(o+PS*2,!0),T=r[b],C=`${f}${m}`,S=n.getDerivedResource({queryParameters:{compositeIndex:C}});if(c(T))d[m]=Promise.resolve(T(e,t,S,i,o));else throw new ue(`Unknown tile content type, ${b}, inside Composite tile`);o+=x}let p=await Promise.all(d);return new ju(e,t,n,p)};ju.prototype.hasProperty=function(e,t){return!1};ju.prototype.getFeature=function(e){};ju.prototype.applyDebugSettings=function(e,t){let n=this._contents,i=n.length;for(let o=0;o<i;++o)n[o].applyDebugSettings(e,t)};ju.prototype.applyStyle=function(e){let t=this._contents,n=t.length;for(let i=0;i<n;++i)t[i].applyStyle(e)};ju.prototype.update=function(e,t){let n=this._contents,i=n.length,o=!0;for(let r=0;r<i;++r)n[r].update(e,t),o=o&&n[r].ready;!this._ready&&o&&(this._ready=!0)};ju.prototype.pick=function(e,t,n){if(!this._ready)return;let i,o=Number.POSITIVE_INFINITY,r=this._contents,s=r.length;for(let a=0;a<s;++a){let l=r[a].pick(e,t,n);if(!c(l))continue;let u=h.distance(e.origin,l);u<o&&(i=l,o=u)}if(c(i))return n};ju.prototype.isDestroyed=function(){return!1};ju.prototype.destroy=function(){let e=this._contents,t=e.length;for(let n=0;n<t;++n)e[n].destroy();return de(this)};var HU=ju;function mRe(e,t,n){return JSON.parse(Gu(e,t,n))}var Ho=mRe;function za(e){A.typeOf.number("options.featuresLength",e.featuresLength),A.typeOf.object("options.owner",e.owner),this._id=Hn();let t=e.featuresLength;this._showAlphaProperties=void 0,this._batchValues=void 0,this._batchValuesDirty=!1,this._batchTexture=void 0,this._defaultTexture=void 0,this._pickTexture=void 0,this._pickIds=[];let n,i;if(t>0){let o=Math.min(t,mt.maximumTextureSize),r=Math.ceil(t/mt.maximumTextureSize),s=1/o,a=s*.5,l=1/r,u=l*.5;n=new H(o,r),i=new se(s,a,l,u)}this._translucentFeaturesLength=0,this._featuresLength=t,this._textureDimensions=n,this._textureStep=i,this._owner=e.owner,this._statistics=e.statistics,this._colorChangedCallback=e.colorChangedCallback}Object.defineProperties(za.prototype,{translucentFeaturesLength:{get:function(){return this._translucentFeaturesLength}},byteLength:{get:function(){let e=0;return c(this._pickTexture)&&(e+=this._pickTexture.sizeInBytes),c(this._batchTexture)&&(e+=this._batchTexture.sizeInBytes),e}},textureDimensions:{get:function(){return this._textureDimensions}},textureStep:{get:function(){return this._textureStep}},batchTexture:{get:function(){return this._batchTexture}},defaultTexture:{get:function(){return this._defaultTexture}},pickTexture:{get:function(){return this._pickTexture}}});za.DEFAULT_COLOR_VALUE=j.WHITE;za.DEFAULT_SHOW_VALUE=!0;function Kte(e){let t=e._textureDimensions;return t.x*t.y*4}function $te(e){if(!c(e._batchValues)){let t=Kte(e),n=new Uint8Array(t).fill(255);e._batchValues=n}return e._batchValues}function Zte(e){if(!c(e._showAlphaProperties)){let t=2*e._featuresLength,n=new Uint8Array(t).fill(255);e._showAlphaProperties=n}return e._showAlphaProperties}function IS(e,t){if(!c(e)||e<0||e>=t)throw new E(`batchId is required and between zero and featuresLength - 1 (${t}`-+").")}za.prototype.setShow=function(e,t){if(IS(e,this._featuresLength),A.typeOf.bool("show",t),t&&!c(this._showAlphaProperties))return;let n=Zte(this),i=e*2,o=t?255:0;if(n[i]!==o){n[i]=o;let r=$te(this),s=e*4+3;r[s]=t?n[i+1]:0,this._batchValuesDirty=!0}};za.prototype.setAllShow=function(e){A.typeOf.bool("show",e);let t=this._featuresLength;for(let n=0;n<t;++n)this.setShow(n,e)};za.prototype.getShow=function(e){if(IS(e,this._featuresLength),!c(this._showAlphaProperties))return!0;let t=e*2;return this._showAlphaProperties[t]===255};var pRe=new Array(4);za.prototype.setColor=function(e,t){if(IS(e,this._featuresLength),A.typeOf.object("color",t),j.equals(t,za.DEFAULT_COLOR_VALUE)&&!c(this._batchValues))return;let n=t.toBytes(pRe),i=n[3],o=$te(this),r=e*4,s=Zte(this),a=e*2;if(o[r]!==n[0]||o[r+1]!==n[1]||o[r+2]!==n[2]||s[a+1]!==i){o[r]=n[0],o[r+1]=n[1],o[r+2]=n[2];let l=s[a+1]!==255,u=s[a]!==0;o[r+3]=u?i:0,s[a+1]=i;let f=i!==255;f&&!l?++this._translucentFeaturesLength:!f&&l&&--this._translucentFeaturesLength,this._batchValuesDirty=!0,c(this._colorChangedCallback)&&this._colorChangedCallback(e,t)}};za.prototype.setAllColor=function(e){A.typeOf.object("color",e);let t=this._featuresLength;for(let n=0;n<t;++n)this.setColor(n,e)};za.prototype.getColor=function(e,t){if(IS(e,this._featuresLength),A.typeOf.object("result",t),!c(this._batchValues))return j.clone(za.DEFAULT_COLOR_VALUE,t);let n=this._batchValues,i=e*4,o=this._showAlphaProperties,r=e*2;return j.fromBytes(n[i],n[i+1],n[i+2],o[r+1],t)};za.prototype.getPickColor=function(e){return IS(e,this._featuresLength),this._pickIds[e]};function Jte(e,t,n){let i=e._textureDimensions;return new Lt({context:t,pixelFormat:Ve.RGBA,pixelDatatype:Be.UNSIGNED_BYTE,source:{width:i.x,height:i.y,arrayBufferView:n},flipY:!1,sampler:Qt.NEAREST})}function _Re(e,t){let n=e._featuresLength;if(!c(e._pickTexture)&&n>0){let i=e._pickIds,o=Kte(e),r=new Uint8Array(o),s=e._owner,a=e._statistics;for(let l=0;l<n;++l){let u=t.createPickId(s.getFeature(l));i.push(u);let f=u.color,d=l*4;r[d]=j.floatToByte(f.red),r[d+1]=j.floatToByte(f.green),r[d+2]=j.floatToByte(f.blue),r[d+3]=j.floatToByte(f.alpha)}e._pickTexture=Jte(e,t,r),c(a)&&(a.batchTableByteLength+=e._pickTexture.sizeInBytes)}}function gRe(e){let t=e._textureDimensions;e._batchTexture.copyFrom({source:{width:t.x,height:t.y,arrayBufferView:e._batchValues}})}za.prototype.update=function(e,t){let n=t.context;this._defaultTexture=n.defaultTexture;let i=t.passes;(i.pick||i.postProcess)&&_Re(this,n),this._batchValuesDirty&&(this._batchValuesDirty=!1,c(this._batchTexture)||(this._batchTexture=Jte(this,n,this._batchValues),c(this._statistics)&&(this._statistics.batchTableByteLength+=this._batchTexture.sizeInBytes)),gRe(this))};za.prototype.isDestroyed=function(){return!1};za.prototype.destroy=function(){this._batchTexture=this._batchTexture&&this._batchTexture.destroy(),this._pickTexture=this._pickTexture&&this._pickTexture.destroy();let e=this._pickIds,t=e.length;for(let n=0;n<t;++n)e[n].destroy();return de(this)};var kl=za;var yRe={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},bRe={SCALAR:void 0,VEC2:H,VEC3:h,VEC4:se,MAT2:Gi,MAT3:Q,MAT4:k};function xRe(e){let t=e.componentType,n;typeof t=="string"?n=$.fromName(t):n=t;let i=yRe[e.type],o=bRe[e.type];return{componentsPerAttribute:i,classType:o,createArrayBufferView:function(r,s,a){return $.createArrayBufferView(n,r,s,i*a)}}}var Kf=xRe;function Ym(e){this._classes=void 0,this._classIds=void 0,this._classIndexes=void 0,this._parentCounts=void 0,this._parentIndexes=void 0,this._parentIds=void 0,this._byteLength=0,A.typeOf.object("options.extension",e.extension),TRe(this,e.extension,e.binaryBody),SRe(this)}Object.defineProperties(Ym.prototype,{byteLength:{get:function(){return this._byteLength}}});function TRe(e,t,n){let i,o,r,s=t.instancesLength,a=t.classes,l=t.classIds,u=t.parentCounts,f=t.parentIds,d=s,p=0;c(l.byteOffset)&&(l.componentType=y(l.componentType,$.UNSIGNED_SHORT),l.type=cn.SCALAR,r=Kf(l),l=r.createArrayBufferView(n.buffer,n.byteOffset+l.byteOffset,s),p+=l.byteLength);let g;if(c(u)){for(c(u.byteOffset)&&(u.componentType=y(u.componentType,$.UNSIGNED_SHORT),u.type=cn.SCALAR,r=Kf(u),u=r.createArrayBufferView(n.buffer,n.byteOffset+u.byteOffset,s),p+=u.byteLength),g=new Uint16Array(s),d=0,i=0;i<s;++i)g[i]=d,d+=u[i];p+=g.byteLength}c(f)&&c(f.byteOffset)&&(f.componentType=y(f.componentType,$.UNSIGNED_SHORT),f.type=cn.SCALAR,r=Kf(f),f=r.createArrayBufferView(n.buffer,n.byteOffset+f.byteOffset,d),p+=f.byteLength);let m=a.length;for(i=0;i<m;++i){let T=a[i].length,C=a[i].instances,S=ARe(T,C,n);p+=CRe(S),a[i].instances=At(S,C)}let b=new Array(m).fill(0),x=new Uint16Array(s);for(i=0;i<s;++i)o=l[i],x[i]=b[o],++b[o];p+=x.byteLength,e._classes=a,e._classIds=l,e._classIndexes=x,e._parentCounts=u,e._parentIndexes=g,e._parentIds=f,e._byteLength=p}function ARe(e,t,n){let i;for(let o in t)if(t.hasOwnProperty(o)){let r=t[o],s=r.byteOffset;if(c(s)){let a=r.componentType,l=r.type;if(!c(a))throw new ue("componentType is required.");if(!c(l))throw new ue("type is required.");if(!c(n))throw new ue(`Property ${o} requires a batch table binary.`);let u=Kf(r),f=u.componentsPerAttribute,d=u.classType,p=u.createArrayBufferView(n.buffer,n.byteOffset+s,e);c(i)||(i={}),i[o]={typedArray:p,componentCount:f,type:d}}}return i}function CRe(e){let t=0;for(let n in e)e.hasOwnProperty(n)&&(t+=e[n].typedArray.byteLength);return t}var ERe=[];function SRe(e){let t=ERe;t.length=0;let i=e._classIds.length;for(let o=0;o<i;++o)Qte(e,o,t)}function Qte(e,t,n){let i=e._parentCounts,o=e._parentIds,r=e._parentIndexes,a=e._classIds.length;if(!c(o))return;if(t>=a)throw new E(`Parent index ${t} exceeds the total number of instances: ${a}`);if(n.indexOf(t)>-1)throw new E("Circular dependency detected in the batch table hierarchy.");n.push(t);let l=c(i)?i[t]:1,u=c(i)?r[t]:t;for(let f=0;f<l;++f){let d=o[u+f];d!==t&&Qte(e,d,n)}n.pop(t)}var wRe=[],vRe=[],DRe=0;function PRe(e,t,n){let i=e._classIds,o=e._parentCounts,r=e._parentIds,s=e._parentIndexes,a=i.length,l=wRe;l.length=Math.max(l.length,a);let u=++DRe,f=vRe;for(f.length=0,f.push(t);f.length>0;){if(t=f.pop(),l[t]===u)continue;l[t]=u;let d=n(e,t);if(c(d))return d;let p=o[t],g=s[t];for(let m=0;m<p;++m){let b=r[g+m];b!==t&&f.push(b)}}}function IRe(e,t,n){let i=!0;for(;i;){let o=n(e,t);if(c(o))return o;let r=e._parentIds[t];i=r!==t,t=r}}function OS(e,t,n){let i=e._parentCounts,o=e._parentIds;if(c(o)){if(c(i))return PRe(e,t,n)}else return n(e,t);return IRe(e,t,n)}Ym.prototype.hasProperty=function(e,t){let n=OS(this,e,function(i,o){let r=i._classIds[o],s=i._classes[r].instances;if(c(s[t]))return!0});return c(n)};Ym.prototype.propertyExists=function(e){let t=this._classes,n=t.length;for(let i=0;i<n;++i){let o=t[i].instances;if(c(o[e]))return!0}return!1};Ym.prototype.getPropertyIds=function(e,t){return t=c(t)?t:[],t.length=0,OS(this,e,function(n,i){let o=n._classIds[i],r=n._classes[o].instances;for(let s in r)r.hasOwnProperty(s)&&t.indexOf(s)===-1&&t.push(s)}),t};Ym.prototype.getProperty=function(e,t){return OS(this,e,function(n,i){let o=n._classIds[i],r=n._classes[o],s=n._classIndexes[i],a=r.instances[t];if(c(a))return c(a.typedArray)?ORe(a,s):qe(a[s],!0)})};function ORe(e,t){let n=e.typedArray,i=e.componentCount;return i===1?n[t]:e.type.unpack(n,t*i)}Ym.prototype.setProperty=function(e,t,n){let i=OS(this,e,function(o,r){let s=o._classIds[r],a=o._classes[s],l=o._classIndexes[r],u=a.instances[t];if(c(u)){if(r!==e)throw new E(`Inherited property "${t}" is read-only.`);return c(u.typedArray)?RRe(u,l,n):u[l]=qe(n,!0),!0}});return c(i)};function RRe(e,t,n){let i=e.typedArray,o=e.componentCount;o===1?i[t]=n:e.type.pack(n,i,t*o)}Ym.prototype.isClass=function(e,t){let n=OS(this,e,function(i,o){let r=i._classIds[o];if(i._classes[r].name===t)return!0});return c(n)};Ym.prototype.getClassName=function(e){let t=this._classIds[e];return this._classes[t].name};var RS=Ym;var MRe={HIGHLIGHT:0,REPLACE:1,MIX:2},Vl=Object.freeze(MRe);var GU=kl.DEFAULT_COLOR_VALUE,jU=kl.DEFAULT_SHOW_VALUE;function oo(e,t,n,i,o){this.featuresLength=t;let r;c(n)&&(r=n.extensions),this._extensions=y(r,{});let s=LRe(n);this._properties=s,this._batchTableHierarchy=NRe(this,n,i);let a=tne(t,s,i);this._binaryPropertiesByteLength=FRe(a),this._batchTableBinaryProperties=a,this._content=e,this._batchTexture=new kl({featuresLength:t,colorChangedCallback:o,owner:e,statistics:e.tileset.statistics})}oo._deprecationWarning=Ss;Object.defineProperties(oo.prototype,{batchTableByteLength:{get:function(){let e=this._binaryPropertiesByteLength;return c(this._batchTableHierarchy)&&(e+=this._batchTableHierarchy.byteLength),e+=this._batchTexture.byteLength,e}}});function LRe(e){let t={};if(!c(e))return t;for(let n in e)e.hasOwnProperty(n)&&n!=="HIERARCHY"&&n!=="extensions"&&n!=="extras"&&(t[n]=qe(e[n],!0));return t}function NRe(e,t,n){if(!c(t))return;let i=e._extensions["3DTILES_batch_table_hierarchy"],o=t.HIERARCHY;if(c(o)&&(oo._deprecationWarning("batchTableHierarchyExtension","The batch table HIERARCHY property has been moved to an extension. Use extensions.3DTILES_batch_table_hierarchy instead."),e._extensions["3DTILES_batch_table_hierarchy"]=o,i=o),!!c(i))return new RS({extension:i,binaryBody:n})}function tne(e,t,n){let i;for(let o in t)if(t.hasOwnProperty(o)){let r=t[o],s=r.byteOffset;if(c(s)){let a=r.componentType,l=r.type;if(!c(a))throw new ue("componentType is required.");if(!c(l))throw new ue("type is required.");if(!c(n))throw new ue(`Property ${o} requires a batch table binary.`);let u=Kf(r),f=u.componentsPerAttribute,d=u.classType,p=u.createArrayBufferView(n.buffer,n.byteOffset+s,e);c(i)||(i={}),i[o]={typedArray:p,componentCount:f,type:d}}}return i}function FRe(e){if(!c(e))return 0;let t=0;for(let n in e)e.hasOwnProperty(n)&&(t+=e[n].typedArray.byteLength);return t}oo.getBinaryProperties=function(e,t,n){return tne(e,t,n)};oo.prototype.setShow=function(e,t){this._batchTexture.setShow(e,t)};oo.prototype.setAllShow=function(e){this._batchTexture.setAllShow(e)};oo.prototype.getShow=function(e){return this._batchTexture.getShow(e)};oo.prototype.setColor=function(e,t){this._batchTexture.setColor(e,t)};oo.prototype.setAllColor=function(e){this._batchTexture.setAllColor(e)};oo.prototype.getColor=function(e,t){return this._batchTexture.getColor(e,t)};oo.prototype.getPickColor=function(e){return this._batchTexture.getPickColor(e)};var BRe=new j;oo.prototype.applyStyle=function(e){if(!c(e)){this.setAllColor(GU),this.setAllShow(jU);return}let t=this._content,n=this.featuresLength;for(let i=0;i<n;++i){let o=t.getFeature(i),r=c(e.color)?y(e.color.evaluateColor(o,BRe),GU):GU,s=c(e.show)?y(e.show.evaluate(o),jU):jU;this.setColor(i,r),this.setShow(i,s)}};function kRe(e,t){let n=e.typedArray,i=e.componentCount;return i===1?n[t]:e.type.unpack(n,t*i)}function VRe(e,t,n){let i=e.typedArray,o=e.componentCount;o===1?i[t]=n:e.type.pack(n,i,t*o)}function iT(e,t){if(!c(e)||e<0||e>=t)throw new E(`batchId is required and must be between zero and featuresLength - 1 (${t}`-+").")}oo.prototype.isClass=function(e,t){iT(e,this.featuresLength),A.typeOf.string("className",t);let n=this._batchTableHierarchy;return c(n)?n.isClass(e,t):!1};oo.prototype.isExactClass=function(e,t){return A.typeOf.string("className",t),this.getExactClassName(e)===t};oo.prototype.getExactClassName=function(e){iT(e,this.featuresLength);let t=this._batchTableHierarchy;if(c(t))return t.getClassName(e)};oo.prototype.hasProperty=function(e,t){return iT(e,this.featuresLength),A.typeOf.string("name",t),c(this._properties[t])||c(this._batchTableHierarchy)&&this._batchTableHierarchy.hasProperty(e,t)};oo.prototype.hasPropertyBySemantic=function(){return!1};oo.prototype.getPropertyIds=function(e,t){iT(e,this.featuresLength),t=c(t)?t:[],t.length=0;let n=Object.keys(this._properties);return t.push.apply(t,n),c(this._batchTableHierarchy)&&t.push.apply(t,this._batchTableHierarchy.getPropertyIds(e,n)),t};oo.prototype.getPropertyBySemantic=function(e,t){};oo.prototype.getProperty=function(e,t){if(iT(e,this.featuresLength),A.typeOf.string("name",t),c(this._batchTableBinaryProperties)){let i=this._batchTableBinaryProperties[t];if(c(i))return kRe(i,e)}let n=this._properties[t];if(c(n))return qe(n[e],!0);if(c(this._batchTableHierarchy)){let i=this._batchTableHierarchy.getProperty(e,t);if(c(i))return i}};oo.prototype.setProperty=function(e,t,n){let i=this.featuresLength;if(iT(e,i),A.typeOf.string("name",t),c(this._batchTableBinaryProperties)){let r=this._batchTableBinaryProperties[t];if(c(r)){VRe(r,e,n);return}}if(c(this._batchTableHierarchy)&&this._batchTableHierarchy.setProperty(e,t,n))return;let o=this._properties[t];c(o)||(this._properties[t]=new Array(i),o=this._properties[t]),o[e]=qe(n,!0)};function URe(e){return e._batchTexture.textureDimensions.y===1?`uniform vec4 tile_textureStep; 
vec2 computeSt(float batchId) 
{ 
    float stepX = tile_textureStep.x; 
    float centerX = tile_textureStep.y; 
    return vec2(centerX + (batchId * stepX), 0.5); 
} 
`:`uniform vec4 tile_textureStep; 
uniform vec2 tile_textureDimensions; 
vec2 computeSt(float batchId) 
{ 
    float stepX = tile_textureStep.x; 
    float centerX = tile_textureStep.y; 
    float stepY = tile_textureStep.z; 
    float centerY = tile_textureStep.w; 
    float xId = mod(batchId, tile_textureDimensions.x); 
    float yId = floor(batchId / tile_textureDimensions.x); 
    return vec2(centerX + (xId * stepX), centerY + (yId * stepY)); 
} 
`}oo.prototype.getVertexShaderCallback=function(e,t,n){if(this.featuresLength===0)return;let i=this;return function(o){let r=nne(o,n,!1),s;return mt.maximumVertexTextureImageUnits>0?(s="",e&&(s+=`uniform bool tile_translucentCommand; 
`),s+=`uniform sampler2D tile_batchTexture; 
out vec4 tile_featureColor; 
out vec2 tile_featureSt; 
void main() 
{ 
    vec2 st = computeSt(${t}); 
    vec4 featureProperties = texture(tile_batchTexture, st); 
    tile_color(featureProperties); 
    float show = ceil(featureProperties.a); 
    gl_Position *= show; 
`,e&&(s+=`    bool isStyleTranslucent = (featureProperties.a != 1.0); 
    if (czm_pass == czm_passTranslucent) 
    { 
        if (!isStyleTranslucent && !tile_translucentCommand) 
        { 
            gl_Position *= 0.0; 
        } 
    } 
    else 
    { 
        if (isStyleTranslucent) 
        { 
            gl_Position *= 0.0; 
        } 
    } 
`),s+=`    tile_featureColor = featureProperties; 
    tile_featureSt = st; 
}`):s=`out vec2 tile_featureSt; 
void main() 
{ 
    tile_color(vec4(1.0)); 
    tile_featureSt = computeSt(${t}); 
}`,`${r}
${URe(i)}${s}`}};function ene(e,t){return e=Ge.replaceMain(e,"tile_main"),t?`${e}uniform float tile_colorBlend; 
void tile_color(vec4 tile_featureColor) 
{ 
    tile_main(); 
    tile_featureColor = czm_gammaCorrect(tile_featureColor); 
    out_FragColor.a *= tile_featureColor.a; 
    float highlight = ceil(tile_colorBlend); 
    out_FragColor.rgb *= mix(tile_featureColor.rgb, vec3(1.0), highlight); 
} 
`:`${e}void tile_color(vec4 tile_featureColor) 
{ 
    tile_main(); 
} 
`}function zRe(e,t){let n=`texture(${t}`,i=0,o=e.indexOf(n,i),r;for(;o>-1;){let s=0;for(let u=o;u<e.length;++u){let f=e.charAt(u);if(f==="(")++s;else if(f===")"&&(--s,s===0)){r=u+1;break}}let l=`tile_diffuse_final(${e.slice(o,r)}, tile_diffuse)`;e=e.slice(0,o)+l+e.slice(r),i=o+l.length,o=e.indexOf(n,i)}return e}function nne(e,t,n){if(!c(t))return ene(e,n);let i=new RegExp(`(uniform|attribute|in)\\s+(vec[34]|sampler2D)\\s+${t};`),o=e.match(i);if(!c(o))return ene(e,n);let r=o[0],s=o[2];e=Ge.replaceMain(e,"tile_main"),e=e.replace(r,"");let a=`bool isWhite(vec3 color) 
{ 
    return all(greaterThan(color, vec3(1.0 - czm_epsilon3))); 
} 
vec4 tile_diffuse_final(vec4 sourceDiffuse, vec4 tileDiffuse) 
{ 
    vec4 blendDiffuse = mix(sourceDiffuse, tileDiffuse, tile_colorBlend); 
    vec4 diffuse = isWhite(tileDiffuse.rgb) ? sourceDiffuse : blendDiffuse; 
    return vec4(diffuse.rgb, sourceDiffuse.a); 
} 
`,l=`    tile_featureColor = czm_gammaCorrect(tile_featureColor); 
    out_FragColor.a *= tile_featureColor.a; 
    float highlight = ceil(tile_colorBlend); 
    out_FragColor.rgb *= mix(tile_featureColor.rgb, vec3(1.0), highlight); 
`,u;if(s==="vec3"||s==="vec4"){let f=s==="vec3"?`vec4(${t}, 1.0)`:t,d=s==="vec3"?"tile_diffuse.xyz":"tile_diffuse";i=new RegExp(t,"g"),e=e.replace(i,d),u=`    vec4 source = ${f}; 
    tile_diffuse = tile_diffuse_final(source, tile_featureColor); 
    tile_main(); 
`}else s==="sampler2D"&&(e=zRe(e,t),u=`    tile_diffuse = tile_featureColor; 
    tile_main(); 
`);return e=`uniform float tile_colorBlend; 
vec4 tile_diffuse = vec4(1.0); 
${a}${r}
${e}
void tile_color(vec4 tile_featureColor) 
{ 
${u}`,n&&(e+=l),e+=`} 
`,e}oo.prototype.getFragmentShaderCallback=function(e,t,n){if(this.featuresLength!==0)return function(i){return i=nne(i,t,!0),mt.maximumVertexTextureImageUnits>0?(i+=`uniform sampler2D tile_pickTexture; 
in vec2 tile_featureSt; 
in vec4 tile_featureColor; 
void main() 
{ 
    tile_color(tile_featureColor); 
`,n&&(i+=`    out_FragColor.rgb *= out_FragColor.a; 
`),i+="}"):(e&&(i+=`uniform bool tile_translucentCommand; 
`),i+=`uniform sampler2D tile_pickTexture; 
uniform sampler2D tile_batchTexture; 
in vec2 tile_featureSt; 
void main() 
{ 
    vec4 featureProperties = texture(tile_batchTexture, tile_featureSt); 
    if (featureProperties.a == 0.0) { 
        discard; 
    } 
`,e&&(i+=`    bool isStyleTranslucent = (featureProperties.a != 1.0); 
    if (czm_pass == czm_passTranslucent) 
    { 
        if (!isStyleTranslucent && !tile_translucentCommand) 
        { 
            discard; 
        } 
    } 
    else 
    { 
        if (isStyleTranslucent) 
        { 
            discard; 
        } 
    } 
`),i+=`    tile_color(featureProperties); 
`,n&&(i+=`    out_FragColor.rgb *= out_FragColor.a; 
`),i+=`} 
`),i}};oo.prototype.getClassificationFragmentShaderCallback=function(){if(this.featuresLength!==0)return function(e){return e=Ge.replaceMain(e,"tile_main"),mt.maximumVertexTextureImageUnits>0?e+=`uniform sampler2D tile_pickTexture;
in vec2 tile_featureSt; 
in vec4 tile_featureColor; 
void main() 
{ 
    tile_main(); 
    out_FragColor = tile_featureColor; 
    out_FragColor.rgb *= out_FragColor.a; 
}`:e+=`uniform sampler2D tile_batchTexture; 
uniform sampler2D tile_pickTexture;
in vec2 tile_featureSt; 
void main() 
{ 
    tile_main(); 
    vec4 featureProperties = texture(tile_batchTexture, tile_featureSt); 
    if (featureProperties.a == 0.0) { 
        discard; 
    } 
    out_FragColor = featureProperties; 
    out_FragColor.rgb *= out_FragColor.a; 
} 
`,e}};function HRe(e){let t=e._content.tileset,n=t.colorBlendMode,i=t.colorBlendAmount;if(n===Vl.HIGHLIGHT)return 0;if(n===Vl.REPLACE)return 1;if(n===Vl.MIX)return R.clamp(i,R.EPSILON4,1);throw new E(`Invalid color blend mode "${n}".`)}oo.prototype.getUniformMapCallback=function(){if(this.featuresLength===0)return;let e=this;return function(t){return At(t,{tile_batchTexture:function(){return y(e._batchTexture.batchTexture,e._batchTexture.defaultTexture)},tile_textureDimensions:function(){return e._batchTexture.textureDimensions},tile_textureStep:function(){return e._batchTexture.textureStep},tile_colorBlend:function(){return HRe(e)},tile_pickTexture:function(){return e._batchTexture.pickTexture}})}};oo.prototype.getPickId=function(){return"texture(tile_pickTexture, tile_featureSt)"};var I_={ALL_OPAQUE:0,ALL_TRANSLUCENT:1,OPAQUE_AND_TRANSLUCENT:2};oo.prototype.addDerivedCommands=function(e,t){let n=e.commandList,i=n.length,o=this._content._tile,r=o._finalResolution,s=o.tileset,a=s.isSkippingLevelOfDetail&&s.hasMixedContent&&e.context.stencilBuffer,l=GRe(this);for(let u=t;u<i;++u){let f=n[u];if(f.pass===ve.COMPUTE)continue;let d=f.derivedCommands.tileset;(!c(d)||f.dirty)&&(d={},f.derivedCommands.tileset=d,d.originalCommand=jRe(f),f.dirty=!1);let p=d.originalCommand;l!==I_.ALL_OPAQUE&&f.pass!==ve.TRANSLUCENT&&(c(d.translucent)||(d.translucent=WRe(p))),l!==I_.ALL_TRANSLUCENT&&f.pass!==ve.TRANSLUCENT&&(c(d.opaque)||(d.opaque=qRe(p)),a&&(r||(c(d.zback)||(d.zback=XRe(e.context,p)),s._backfaceCommands.push(d.zback)),(!c(d.stencil)||o._selectionDepth!==$Re(d.stencil))&&(f.renderState.depthMask?d.stencil=KRe(p,o._selectionDepth):d.stencil=d.opaque)));let g=a?d.stencil:d.opaque,m=d.translucent;f.pass!==ve.TRANSLUCENT?(l===I_.ALL_OPAQUE&&(n[u]=g),l===I_.ALL_TRANSLUCENT&&(n[u]=m),l===I_.OPAQUE_AND_TRANSLUCENT&&(n[u]=g,n.push(m))):n[u]=p}};function GRe(e){let t=e._batchTexture.translucentFeaturesLength;return t===0?I_.ALL_OPAQUE:t===e.featuresLength?I_.ALL_TRANSLUCENT:I_.OPAQUE_AND_TRANSLUCENT}function jRe(e){let t=et.shallowClone(e),n=t.pass===ve.TRANSLUCENT;return t.uniformMap=c(t.uniformMap)?t.uniformMap:{},t.uniformMap.tile_translucentCommand=function(){return n},t}function WRe(e){let t=et.shallowClone(e);return t.pass=ve.TRANSLUCENT,t.renderState=ZRe(e.renderState),t}function qRe(e){let t=et.shallowClone(e);return t.renderState=JRe(e.renderState),t}function YRe(e,t){let n=e.shaderCache.getDerivedShaderProgram(t,"zBackfaceLogDepth");if(!c(n)){let i=t.fragmentShaderSource.clone();i.defines=c(i.defines)?i.defines.slice(0):[],i.defines.push("POLYGON_OFFSET"),n=e.shaderCache.createDerivedShaderProgram(t,"zBackfaceLogDepth",{vertexShaderSource:t.vertexShaderSource,fragmentShaderSource:i,attributeLocations:t._attributeLocations})}return n}function XRe(e,t){let n=et.shallowClone(t),i=qe(n.renderState,!0);i.cull.enabled=!0,i.cull.face=xi.FRONT,i.colorMask={red:!1,green:!1,blue:!1,alpha:!1},i.polygonOffset={enabled:!0,factor:5,units:5},i.stencilTest=Ut.setCesium3DTileBit(),i.stencilMask=Ut.CESIUM_3D_TILE_MASK,n.renderState=ze.fromCache(i),n.castShadows=!1,n.receiveShadows=!1,n.uniformMap=qe(t.uniformMap);let o=new H(5,5);return n.uniformMap.u_polygonOffset=function(){return o},n.shaderProgram=YRe(e,t.shaderProgram),n}function KRe(e,t){let n=et.shallowClone(e),i=qe(n.renderState,!0);return i.stencilTest.enabled=!0,i.stencilTest.mask=Ut.SKIP_LOD_MASK,i.stencilTest.reference=Ut.CESIUM_3D_TILE_MASK|t<<Ut.SKIP_LOD_BIT_SHIFT,i.stencilTest.frontFunction=Un.GREATER_OR_EQUAL,i.stencilTest.frontOperation.zPass=ft.REPLACE,i.stencilTest.backFunction=Un.GREATER_OR_EQUAL,i.stencilTest.backOperation.zPass=ft.REPLACE,i.stencilMask=Ut.CESIUM_3D_TILE_MASK|Ut.SKIP_LOD_MASK,n.renderState=ze.fromCache(i),n}function $Re(e){return(e.renderState.stencilTest.reference&Ut.SKIP_LOD_MASK)>>>Ut.SKIP_LOD_BIT_SHIFT}function ZRe(e){let t=qe(e,!0);return t.cull.enabled=!1,t.depthTest.enabled=!0,t.depthMask=!1,t.blending=hn.ALPHA_BLEND,t.stencilTest=Ut.setCesium3DTileBit(),t.stencilMask=Ut.CESIUM_3D_TILE_MASK,ze.fromCache(t)}function JRe(e){let t=qe(e,!0);return t.stencilTest=Ut.setCesium3DTileBit(),t.stencilMask=Ut.CESIUM_3D_TILE_MASK,ze.fromCache(t)}oo.prototype.update=function(e,t){this._batchTexture.update(e,t)};oo.prototype.isDestroyed=function(){return!1};oo.prototype.destroy=function(){return this._batchTexture=this._batchTexture&&this._batchTexture.destroy(),de(this)};var r0=oo;function QRe(e){this.offset=e.offset,this.count=e.count,this.color=e.color,this.batchIds=e.batchIds}var O_=QRe;var cO=`in vec3 position;
in float a_batchId;
uniform mat4 u_modifiedModelViewProjection;
void main()
{
gl_Position = czm_depthClamp(u_modifiedModelViewProjection * vec4(position, 1.0));
}
`;function Wu(e,t){this._content=e,this._batchId=t,this._color=void 0}Object.defineProperties(Wu.prototype,{show:{get:function(){return this._content.batchTable.getShow(this._batchId)},set:function(e){this._content.batchTable.setShow(this._batchId,e)}},color:{get:function(){return c(this._color)||(this._color=new j),this._content.batchTable.getColor(this._batchId,this._color)},set:function(e){this._content.batchTable.setColor(this._batchId,e)}},polylinePositions:{get:function(){if(c(this._content.getPolylinePositions))return this._content.getPolylinePositions(this._batchId)}},content:{get:function(){return this._content}},tileset:{get:function(){return this._content.tileset}},primitive:{get:function(){return this._content.tileset}},featureId:{get:function(){return this._batchId}},pickId:{get:function(){return this._content.batchTable.getPickColor(this._batchId)}}});Wu.prototype.hasProperty=function(e){return this._content.batchTable.hasProperty(this._batchId,e)};Wu.prototype.getPropertyIds=function(e){return this._content.batchTable.getPropertyIds(this._batchId,e)};Wu.prototype.getProperty=function(e){return this._content.batchTable.getProperty(this._batchId,e)};Wu.getPropertyInherited=function(e,t,n){let i=e.batchTable;if(c(i)){if(i.hasPropertyBySemantic(t,n))return i.getPropertyBySemantic(t,n);if(i.hasProperty(t,n))return i.getProperty(t,n)}let o=e.metadata;if(c(o)){if(o.hasPropertyBySemantic(n))return o.getPropertyBySemantic(n);if(o.hasProperty(n))return o.getProperty(n)}let r=e.tile,s=r.metadata;if(c(s)){if(s.hasPropertyBySemantic(n))return s.getPropertyBySemantic(n);if(s.hasProperty(n))return s.getProperty(n)}let a;if(c(r.implicitSubtree)&&(a=r.implicitSubtree.metadata),c(a)){if(a.hasPropertyBySemantic(n))return a.getPropertyBySemantic(n);if(a.hasProperty(n))return a.getProperty(n)}let l=c(e.group)?e.group.metadata:void 0;if(c(l)){if(l.hasPropertyBySemantic(n))return l.getPropertyBySemantic(n);if(l.hasProperty(n))return l.getProperty(n)}let u=e.tileset.metadata;if(c(u)){if(u.hasPropertyBySemantic(n))return u.getPropertyBySemantic(n);if(u.hasProperty(n))return u.getProperty(n)}};Wu.prototype.getPropertyInherited=function(e){return Wu.getPropertyInherited(this._content,this._batchId,e)};Wu.prototype.setProperty=function(e,t){this._content.batchTable.setProperty(this._batchId,e,t),this._content.featurePropertiesDirty=!0};Wu.prototype.isExactClass=function(e){return this._content.batchTable.isExactClass(this._batchId,e)};Wu.prototype.isClass=function(e){return this._content.batchTable.isClass(this._batchId,e)};Wu.prototype.getExactClassName=function(){return this._content.batchTable.getExactClassName(this._batchId)};var Ws=Wu;var WU=class{add(t,n,i){if(typeof arguments[0]!="string")for(let o in arguments[0])this.add(o,arguments[0][o],arguments[1]);else(Array.isArray(t)?t:[t]).forEach(function(o){this[o]=this[o]||[],n&&this[o][i?"unshift":"push"](n)},this)}run(t,n){this[t]=this[t]||[],this[t].forEach(function(i){i.call(n&&n.context?n.context:n,n)})}},qU=class{constructor(t){this.jsep=t,this.registered={}}register(...t){t.forEach(n=>{if(typeof n!="object"||!n.name||!n.init)throw new Error("Invalid JSEP plugin format");this.registered[n.name]||(n.init(this.jsep),this.registered[n.name]=n)})}},nl=class e{static get version(){return"1.4.0"}static toString(){return"JavaScript Expression Parser (JSEP) v"+e.version}static addUnaryOp(t){return e.max_unop_len=Math.max(t.length,e.max_unop_len),e.unary_ops[t]=1,e}static addBinaryOp(t,n,i){return e.max_binop_len=Math.max(t.length,e.max_binop_len),e.binary_ops[t]=n,i?e.right_associative.add(t):e.right_associative.delete(t),e}static addIdentifierChar(t){return e.additional_identifier_chars.add(t),e}static addLiteral(t,n){return e.literals[t]=n,e}static removeUnaryOp(t){return delete e.unary_ops[t],t.length===e.max_unop_len&&(e.max_unop_len=e.getMaxKeyLen(e.unary_ops)),e}static removeAllUnaryOps(){return e.unary_ops={},e.max_unop_len=0,e}static removeIdentifierChar(t){return e.additional_identifier_chars.delete(t),e}static removeBinaryOp(t){return delete e.binary_ops[t],t.length===e.max_binop_len&&(e.max_binop_len=e.getMaxKeyLen(e.binary_ops)),e.right_associative.delete(t),e}static removeAllBinaryOps(){return e.binary_ops={},e.max_binop_len=0,e}static removeLiteral(t){return delete e.literals[t],e}static removeAllLiterals(){return e.literals={},e}get char(){return this.expr.charAt(this.index)}get code(){return this.expr.charCodeAt(this.index)}constructor(t){this.expr=t,this.index=0}static parse(t){return new e(t).parse()}static getMaxKeyLen(t){return Math.max(0,...Object.keys(t).map(n=>n.length))}static isDecimalDigit(t){return t>=48&&t<=57}static binaryPrecedence(t){return e.binary_ops[t]||0}static isIdentifierStart(t){return t>=65&&t<=90||t>=97&&t<=122||t>=128&&!e.binary_ops[String.fromCharCode(t)]||e.additional_identifier_chars.has(String.fromCharCode(t))}static isIdentifierPart(t){return e.isIdentifierStart(t)||e.isDecimalDigit(t)}throwError(t){let n=new Error(t+" at character "+this.index);throw n.index=this.index,n.description=t,n}runHook(t,n){if(e.hooks[t]){let i={context:this,node:n};return e.hooks.run(t,i),i.node}return n}searchHook(t){if(e.hooks[t]){let n={context:this};return e.hooks[t].find(function(i){return i.call(n.context,n),n.node}),n.node}}gobbleSpaces(){let t=this.code;for(;t===e.SPACE_CODE||t===e.TAB_CODE||t===e.LF_CODE||t===e.CR_CODE;)t=this.expr.charCodeAt(++this.index);this.runHook("gobble-spaces")}parse(){this.runHook("before-all");let t=this.gobbleExpressions(),n=t.length===1?t[0]:{type:e.COMPOUND,body:t};return this.runHook("after-all",n)}gobbleExpressions(t){let n=[],i,o;for(;this.index<this.expr.length;)if(i=this.code,i===e.SEMCOL_CODE||i===e.COMMA_CODE)this.index++;else if(o=this.gobbleExpression())n.push(o);else if(this.index<this.expr.length){if(i===t)break;this.throwError('Unexpected "'+this.char+'"')}return n}gobbleExpression(){let t=this.searchHook("gobble-expression")||this.gobbleBinaryExpression();return this.gobbleSpaces(),this.runHook("after-expression",t)}gobbleBinaryOp(){this.gobbleSpaces();let t=this.expr.substr(this.index,e.max_binop_len),n=t.length;for(;n>0;){if(e.binary_ops.hasOwnProperty(t)&&(!e.isIdentifierStart(this.code)||this.index+t.length<this.expr.length&&!e.isIdentifierPart(this.expr.charCodeAt(this.index+t.length))))return this.index+=n,t;t=t.substr(0,--n)}return!1}gobbleBinaryExpression(){let t,n,i,o,r,s,a,l,u;if(s=this.gobbleToken(),!s||(n=this.gobbleBinaryOp(),!n))return s;for(r={value:n,prec:e.binaryPrecedence(n),right_a:e.right_associative.has(n)},a=this.gobbleToken(),a||this.throwError("Expected expression after "+n),o=[s,r,a];n=this.gobbleBinaryOp();){if(i=e.binaryPrecedence(n),i===0){this.index-=n.length;break}r={value:n,prec:i,right_a:e.right_associative.has(n)},u=n;let f=d=>r.right_a&&d.right_a?i>d.prec:i<=d.prec;for(;o.length>2&&f(o[o.length-2]);)a=o.pop(),n=o.pop().value,s=o.pop(),t={type:e.BINARY_EXP,operator:n,left:s,right:a},o.push(t);t=this.gobbleToken(),t||this.throwError("Expected expression after "+u),o.push(r,t)}for(l=o.length-1,t=o[l];l>1;)t={type:e.BINARY_EXP,operator:o[l-1].value,left:o[l-2],right:t},l-=2;return t}gobbleToken(){let t,n,i,o;if(this.gobbleSpaces(),o=this.searchHook("gobble-token"),o)return this.runHook("after-token",o);if(t=this.code,e.isDecimalDigit(t)||t===e.PERIOD_CODE)return this.gobbleNumericLiteral();if(t===e.SQUOTE_CODE||t===e.DQUOTE_CODE)o=this.gobbleStringLiteral();else if(t===e.OBRACK_CODE)o=this.gobbleArray();else{for(n=this.expr.substr(this.index,e.max_unop_len),i=n.length;i>0;){if(e.unary_ops.hasOwnProperty(n)&&(!e.isIdentifierStart(this.code)||this.index+n.length<this.expr.length&&!e.isIdentifierPart(this.expr.charCodeAt(this.index+n.length)))){this.index+=i;let r=this.gobbleToken();return r||this.throwError("missing unaryOp argument"),this.runHook("after-token",{type:e.UNARY_EXP,operator:n,argument:r,prefix:!0})}n=n.substr(0,--i)}e.isIdentifierStart(t)?(o=this.gobbleIdentifier(),e.literals.hasOwnProperty(o.name)?o={type:e.LITERAL,value:e.literals[o.name],raw:o.name}:o.name===e.this_str&&(o={type:e.THIS_EXP})):t===e.OPAREN_CODE&&(o=this.gobbleGroup())}return o?(o=this.gobbleTokenProperty(o),this.runHook("after-token",o)):this.runHook("after-token",!1)}gobbleTokenProperty(t){this.gobbleSpaces();let n=this.code;for(;n===e.PERIOD_CODE||n===e.OBRACK_CODE||n===e.OPAREN_CODE||n===e.QUMARK_CODE;){let i;if(n===e.QUMARK_CODE){if(this.expr.charCodeAt(this.index+1)!==e.PERIOD_CODE)break;i=!0,this.index+=2,this.gobbleSpaces(),n=this.code}this.index++,n===e.OBRACK_CODE?(t={type:e.MEMBER_EXP,computed:!0,object:t,property:this.gobbleExpression()},t.property||this.throwError('Unexpected "'+this.char+'"'),this.gobbleSpaces(),n=this.code,n!==e.CBRACK_CODE&&this.throwError("Unclosed ["),this.index++):n===e.OPAREN_CODE?t={type:e.CALL_EXP,arguments:this.gobbleArguments(e.CPAREN_CODE),callee:t}:(n===e.PERIOD_CODE||i)&&(i&&this.index--,this.gobbleSpaces(),t={type:e.MEMBER_EXP,computed:!1,object:t,property:this.gobbleIdentifier()}),i&&(t.optional=!0),this.gobbleSpaces(),n=this.code}return t}gobbleNumericLiteral(){let t="",n,i;for(;e.isDecimalDigit(this.code);)t+=this.expr.charAt(this.index++);if(this.code===e.PERIOD_CODE)for(t+=this.expr.charAt(this.index++);e.isDecimalDigit(this.code);)t+=this.expr.charAt(this.index++);if(n=this.char,n==="e"||n==="E"){for(t+=this.expr.charAt(this.index++),n=this.char,(n==="+"||n==="-")&&(t+=this.expr.charAt(this.index++));e.isDecimalDigit(this.code);)t+=this.expr.charAt(this.index++);e.isDecimalDigit(this.expr.charCodeAt(this.index-1))||this.throwError("Expected exponent ("+t+this.char+")")}return i=this.code,e.isIdentifierStart(i)?this.throwError("Variable names cannot start with a number ("+t+this.char+")"):(i===e.PERIOD_CODE||t.length===1&&t.charCodeAt(0)===e.PERIOD_CODE)&&this.throwError("Unexpected period"),{type:e.LITERAL,value:parseFloat(t),raw:t}}gobbleStringLiteral(){let t="",n=this.index,i=this.expr.charAt(this.index++),o=!1;for(;this.index<this.expr.length;){let r=this.expr.charAt(this.index++);if(r===i){o=!0;break}else if(r==="\\")switch(r=this.expr.charAt(this.index++),r){case"n":t+=`
`;break;case"r":t+="\r";break;case"t":t+="	";break;case"b":t+="\b";break;case"f":t+="\f";break;case"v":t+="\v";break;default:t+=r}else t+=r}return o||this.throwError('Unclosed quote after "'+t+'"'),{type:e.LITERAL,value:t,raw:this.expr.substring(n,this.index)}}gobbleIdentifier(){let t=this.code,n=this.index;for(e.isIdentifierStart(t)?this.index++:this.throwError("Unexpected "+this.char);this.index<this.expr.length&&(t=this.code,e.isIdentifierPart(t));)this.index++;return{type:e.IDENTIFIER,name:this.expr.slice(n,this.index)}}gobbleArguments(t){let n=[],i=!1,o=0;for(;this.index<this.expr.length;){this.gobbleSpaces();let r=this.code;if(r===t){i=!0,this.index++,t===e.CPAREN_CODE&&o&&o>=n.length&&this.throwError("Unexpected token "+String.fromCharCode(t));break}else if(r===e.COMMA_CODE){if(this.index++,o++,o!==n.length){if(t===e.CPAREN_CODE)this.throwError("Unexpected token ,");else if(t===e.CBRACK_CODE)for(let s=n.length;s<o;s++)n.push(null)}}else if(n.length!==o&&o!==0)this.throwError("Expected comma");else{let s=this.gobbleExpression();(!s||s.type===e.COMPOUND)&&this.throwError("Expected comma"),n.push(s)}}return i||this.throwError("Expected "+String.fromCharCode(t)),n}gobbleGroup(){this.index++;let t=this.gobbleExpressions(e.CPAREN_CODE);if(this.code===e.CPAREN_CODE)return this.index++,t.length===1?t[0]:t.length?{type:e.SEQUENCE_EXP,expressions:t}:!1;this.throwError("Unclosed (")}gobbleArray(){return this.index++,{type:e.ARRAY_EXP,elements:this.gobbleArguments(e.CBRACK_CODE)}}},eMe=new WU;Object.assign(nl,{hooks:eMe,plugins:new qU(nl),COMPOUND:"Compound",SEQUENCE_EXP:"SequenceExpression",IDENTIFIER:"Identifier",MEMBER_EXP:"MemberExpression",LITERAL:"Literal",THIS_EXP:"ThisExpression",CALL_EXP:"CallExpression",UNARY_EXP:"UnaryExpression",BINARY_EXP:"BinaryExpression",ARRAY_EXP:"ArrayExpression",TAB_CODE:9,LF_CODE:10,CR_CODE:13,SPACE_CODE:32,PERIOD_CODE:46,COMMA_CODE:44,SQUOTE_CODE:39,DQUOTE_CODE:34,OPAREN_CODE:40,CPAREN_CODE:41,OBRACK_CODE:91,CBRACK_CODE:93,QUMARK_CODE:63,SEMCOL_CODE:59,COLON_CODE:58,unary_ops:{"-":1,"!":1,"~":1,"+":1},binary_ops:{"||":1,"??":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10,"**":11},right_associative:new Set(["**"]),additional_identifier_chars:new Set(["$","_"]),literals:{true:!0,false:!1,null:null},this_str:"this"});nl.max_unop_len=nl.getMaxKeyLen(nl.unary_ops);nl.max_binop_len=nl.getMaxKeyLen(nl.binary_ops);var R_=e=>new nl(e).parse(),tMe=Object.getOwnPropertyNames(class{});Object.getOwnPropertyNames(nl).filter(e=>!tMe.includes(e)&&R_[e]===void 0).forEach(e=>{R_[e]=nl[e]});R_.Jsep=nl;var nMe="ConditionalExpression",iMe={name:"ternary",init(e){e.hooks.add("after-expression",function(n){if(n.node&&this.code===e.QUMARK_CODE){this.index++;let i=n.node,o=this.gobbleExpression();if(o||this.throwError("Expected expression"),this.gobbleSpaces(),this.code===e.COLON_CODE){this.index++;let r=this.gobbleExpression();if(r||this.throwError("Expected expression"),n.node={type:nMe,test:i,consequent:o,alternate:r},i.operator&&e.binary_ops[i.operator]<=.9){let s=i;for(;s.right.operator&&e.binary_ops[s.right.operator]<=.9;)s=s.right;n.node.test=s.right,s.right=n.node,n.node=i}}else this.throwError("Expected :")}})}};R_.plugins.register(iMe);var oMe={VARIABLE:0,UNARY:1,BINARY:2,TERNARY:3,CONDITIONAL:4,MEMBER:5,FUNCTION_CALL:6,ARRAY:7,REGEX:8,VARIABLE_IN_STRING:9,LITERAL_NULL:10,LITERAL_BOOLEAN:11,LITERAL_NUMBER:12,LITERAL_STRING:13,LITERAL_COLOR:14,LITERAL_VECTOR:15,LITERAL_REGEX:16,LITERAL_UNDEFINED:17,BUILTIN_VARIABLE:18},gt=Object.freeze(oMe);function $f(e,t){A.typeOf.string("expression",e),this._expression=e,e=gMe(e,t),e=bMe(yMe(e)),R_.addBinaryOp("=~",0),R_.addBinaryOp("!~",0);let n;try{n=R_(e)}catch(i){throw new ue(i)}this._runtimeAst=_i(this,n)}Object.defineProperties($f.prototype,{expression:{get:function(){return this._expression}}});var In={arrayIndex:0,arrayArray:[[]],cartesian2Index:0,cartesian3Index:0,cartesian4Index:0,cartesian2Array:[new H],cartesian3Array:[new h],cartesian4Array:[new se],reset:function(){this.arrayIndex=0,this.cartesian2Index=0,this.cartesian3Index=0,this.cartesian4Index=0},getArray:function(){this.arrayIndex>=this.arrayArray.length&&this.arrayArray.push([]);let e=this.arrayArray[this.arrayIndex++];return e.length=0,e},getCartesian2:function(){return this.cartesian2Index>=this.cartesian2Array.length&&this.cartesian2Array.push(new H),this.cartesian2Array[this.cartesian2Index++]},getCartesian3:function(){return this.cartesian3Index>=this.cartesian3Array.length&&this.cartesian3Array.push(new h),this.cartesian3Array[this.cartesian3Index++]},getCartesian4:function(){return this.cartesian4Index>=this.cartesian4Array.length&&this.cartesian4Array.push(new se),this.cartesian4Array[this.cartesian4Index++]}};$f.prototype.evaluate=function(e,t){In.reset();let n=this._runtimeAst.evaluate(e);return t instanceof j&&n instanceof se?j.fromCartesian4(n,t):n instanceof H||n instanceof h||n instanceof se?n.clone(t):n};$f.prototype.evaluateColor=function(e,t){In.reset();let n=this._runtimeAst.evaluate(e);return j.fromCartesian4(n,t)};$f.prototype.getShaderFunction=function(e,t,n,i){let o=this.getShaderExpression(t,n);return o=`${i} ${e}
{
    return ${o};
}
`,o};$f.prototype.getShaderExpression=function(e,t){return this._runtimeAst.getShaderExpression(e,t)};$f.prototype.getVariables=function(){let e=[];return this._runtimeAst.getVariables(e),e=e.filter(function(t,n,i){return i.indexOf(t)===n}),e};var rMe=["!","-","+"],ine=["+","-","*","/","%","===","!==",">",">=","<","<=","&&","||","!~","=~"],fO=/\${(.*?)}/g,sMe=/\\/g,aMe="@#%",cMe=/@#%/g,dO=new j,hO={abs:Rs(Math.abs),sqrt:Rs(Math.sqrt),cos:Rs(Math.cos),sin:Rs(Math.sin),tan:Rs(Math.tan),acos:Rs(Math.acos),asin:Rs(Math.asin),atan:Rs(Math.atan),radians:Rs(R.toRadians),degrees:Rs(R.toDegrees),sign:Rs(R.sign),floor:Rs(Math.floor),ceil:Rs(Math.ceil),round:Rs(Math.round),exp:Rs(Math.exp),exp2:Rs(uMe),log:Rs(Math.log),log2:Rs(fMe),fract:Rs(lMe),length:dMe,normalize:hMe},mO={atan2:lO(Math.atan2,!1),pow:lO(Math.pow,!1),min:lO(Math.min,!0),max:lO(Math.max,!0),distance:mMe,dot:pMe,cross:_Me},KU={clamp:one(R.clamp,!0),mix:one(R.lerp,!0)};function lMe(e){return e-Math.floor(e)}function uMe(e){return Math.pow(2,e)}function fMe(e){return R.log2(e)}function Rs(e){return function(t,n){if(typeof n=="number")return e(n);if(n instanceof H)return H.fromElements(e(n.x),e(n.y),In.getCartesian2());if(n instanceof h)return h.fromElements(e(n.x),e(n.y),e(n.z),In.getCartesian3());if(n instanceof se)return se.fromElements(e(n.x),e(n.y),e(n.z),e(n.w),In.getCartesian4());throw new ue(`Function "${t}" requires a vector or number argument. Argument is ${n}.`)}}function lO(e,t){return function(n,i,o){if(t&&typeof o=="number"){if(typeof i=="number")return e(i,o);if(i instanceof H)return H.fromElements(e(i.x,o),e(i.y,o),In.getCartesian2());if(i instanceof h)return h.fromElements(e(i.x,o),e(i.y,o),e(i.z,o),In.getCartesian3());if(i instanceof se)return se.fromElements(e(i.x,o),e(i.y,o),e(i.z,o),e(i.w,o),In.getCartesian4())}if(typeof i=="number"&&typeof o=="number")return e(i,o);if(i instanceof H&&o instanceof H)return H.fromElements(e(i.x,o.x),e(i.y,o.y),In.getCartesian2());if(i instanceof h&&o instanceof h)return h.fromElements(e(i.x,o.x),e(i.y,o.y),e(i.z,o.z),In.getCartesian3());if(i instanceof se&&o instanceof se)return se.fromElements(e(i.x,o.x),e(i.y,o.y),e(i.z,o.z),e(i.w,o.w),In.getCartesian4());throw new ue(`Function "${n}" requires vector or number arguments of matching types. Arguments are ${i} and ${o}.`)}}function one(e,t){return function(n,i,o,r){if(t&&typeof r=="number"){if(typeof i=="number"&&typeof o=="number")return e(i,o,r);if(i instanceof H&&o instanceof H)return H.fromElements(e(i.x,o.x,r),e(i.y,o.y,r),In.getCartesian2());if(i instanceof h&&o instanceof h)return h.fromElements(e(i.x,o.x,r),e(i.y,o.y,r),e(i.z,o.z,r),In.getCartesian3());if(i instanceof se&&o instanceof se)return se.fromElements(e(i.x,o.x,r),e(i.y,o.y,r),e(i.z,o.z,r),e(i.w,o.w,r),In.getCartesian4())}if(typeof i=="number"&&typeof o=="number"&&typeof r=="number")return e(i,o,r);if(i instanceof H&&o instanceof H&&r instanceof H)return H.fromElements(e(i.x,o.x,r.x),e(i.y,o.y,r.y),In.getCartesian2());if(i instanceof h&&o instanceof h&&r instanceof h)return h.fromElements(e(i.x,o.x,r.x),e(i.y,o.y,r.y),e(i.z,o.z,r.z),In.getCartesian3());if(i instanceof se&&o instanceof se&&r instanceof se)return se.fromElements(e(i.x,o.x,r.x),e(i.y,o.y,r.y),e(i.z,o.z,r.z),e(i.w,o.w,r.w),In.getCartesian4());throw new ue(`Function "${n}" requires vector or number arguments of matching types. Arguments are ${i}, ${o}, and ${r}.`)}}function dMe(e,t){if(typeof t=="number")return Math.abs(t);if(t instanceof H)return H.magnitude(t);if(t instanceof h)return h.magnitude(t);if(t instanceof se)return se.magnitude(t);throw new ue(`Function "${e}" requires a vector or number argument. Argument is ${t}.`)}function hMe(e,t){if(typeof t=="number")return 1;if(t instanceof H)return H.normalize(t,In.getCartesian2());if(t instanceof h)return h.normalize(t,In.getCartesian3());if(t instanceof se)return se.normalize(t,In.getCartesian4());throw new ue(`Function "${e}" requires a vector or number argument. Argument is ${t}.`)}function mMe(e,t,n){if(typeof t=="number"&&typeof n=="number")return Math.abs(t-n);if(t instanceof H&&n instanceof H)return H.distance(t,n);if(t instanceof h&&n instanceof h)return h.distance(t,n);if(t instanceof se&&n instanceof se)return se.distance(t,n);throw new ue(`Function "${e}" requires vector or number arguments of matching types. Arguments are ${t} and ${n}.`)}function pMe(e,t,n){if(typeof t=="number"&&typeof n=="number")return t*n;if(t instanceof H&&n instanceof H)return H.dot(t,n);if(t instanceof h&&n instanceof h)return h.dot(t,n);if(t instanceof se&&n instanceof se)return se.dot(t,n);throw new ue(`Function "${e}" requires vector or number arguments of matching types. Arguments are ${t} and ${n}.`)}function _Me(e,t,n){if(t instanceof h&&n instanceof h)return h.cross(t,n,In.getCartesian3());throw new ue(`Function "${e}" requires vec3 arguments. Arguments are ${t} and ${n}.`)}function Tt(e,t,n,i,o){this._type=e,this._value=t,this._left=n,this._right=i,this._test=o,this.evaluate=void 0,PMe(this)}function gMe(e,t){if(!c(t))return e;for(let n in t)if(t.hasOwnProperty(n)){let i=new RegExp(`\\$\\{${n}\\}`,"g"),o=`(${t[n]})`;c(o)&&(e=e.replace(i,o))}return e}function yMe(e){return e.replace(sMe,aMe)}function XU(e){return e.replace(cMe,"\\")}function bMe(e){let t=e,n="",i=t.indexOf("${");for(;i>=0;){let o=t.indexOf("'"),r=t.indexOf('"'),s;if(o>=0&&o<i)s=t.indexOf("'",o+1),n+=t.substr(0,s+1),t=t.substr(s+1),i=t.indexOf("${");else if(r>=0&&r<i)s=t.indexOf('"',r+1),n+=t.substr(0,s+1),t=t.substr(s+1),i=t.indexOf("${");else{n+=t.substr(0,i);let a=t.indexOf("}");if(a<0)throw new ue("Unmatched {.");n+=`czm_${t.substr(i+2,a-(i+2))}`,t=t.substr(a+1),i=t.indexOf("${")}}return n+=t,n}function xMe(e){let t=typeof e.value;if(e.value===null)return new Tt(gt.LITERAL_NULL,null);if(t==="boolean")return new Tt(gt.LITERAL_BOOLEAN,e.value);if(t==="number")return new Tt(gt.LITERAL_NUMBER,e.value);if(t==="string")return e.value.indexOf("${")>=0?new Tt(gt.VARIABLE_IN_STRING,e.value):new Tt(gt.LITERAL_STRING,XU(e.value))}function TMe(e,t){let n=t.arguments,i=n.length,o,r,s,a;if(t.callee.type==="MemberExpression"){o=t.callee.property.name;let l=t.callee.object;if(o==="test"||o==="exec"){if(!c(l.callee)||l.callee.name!=="regExp")throw new ue(`${o} is not a function.`);return i===0?o==="test"?new Tt(gt.LITERAL_BOOLEAN,!1):new Tt(gt.LITERAL_NULL,null):(s=_i(e,l),a=_i(e,n[0]),new Tt(gt.FUNCTION_CALL,o,s,a))}else if(o==="toString")return r=_i(e,l),new Tt(gt.FUNCTION_CALL,o,r);throw new ue(`Unexpected function call "${o}".`)}if(o=t.callee.name,o==="color"){if(i===0)return new Tt(gt.LITERAL_COLOR,o);if(r=_i(e,n[0]),c(n[1])){let l=_i(e,n[1]);return new Tt(gt.LITERAL_COLOR,o,[r,l])}return new Tt(gt.LITERAL_COLOR,o,[r])}else if(o==="rgb"||o==="hsl"){if(i<3)throw new ue(`${o} requires three arguments.`);return r=[_i(e,n[0]),_i(e,n[1]),_i(e,n[2])],new Tt(gt.LITERAL_COLOR,o,r)}else if(o==="rgba"||o==="hsla"){if(i<4)throw new ue(`${o} requires four arguments.`);return r=[_i(e,n[0]),_i(e,n[1]),_i(e,n[2]),_i(e,n[3])],new Tt(gt.LITERAL_COLOR,o,r)}else if(o==="vec2"||o==="vec3"||o==="vec4"){r=new Array(i);for(let l=0;l<i;++l)r[l]=_i(e,n[l]);return new Tt(gt.LITERAL_VECTOR,o,r)}else{if(o==="isNaN"||o==="isFinite")return i===0?o==="isNaN"?new Tt(gt.LITERAL_BOOLEAN,!0):new Tt(gt.LITERAL_BOOLEAN,!1):(r=_i(e,n[0]),new Tt(gt.UNARY,o,r));if(o==="isExactClass"||o==="isClass"){if(i<1||i>1)throw new ue(`${o} requires exactly one argument.`);return r=_i(e,n[0]),new Tt(gt.UNARY,o,r)}else if(o==="getExactClassName"){if(i>0)throw new ue(`${o} does not take any argument.`);return new Tt(gt.UNARY,o)}else if(c(hO[o])){if(i!==1)throw new ue(`${o} requires exactly one argument.`);return r=_i(e,n[0]),new Tt(gt.UNARY,o,r)}else if(c(mO[o])){if(i!==2)throw new ue(`${o} requires exactly two arguments.`);return s=_i(e,n[0]),a=_i(e,n[1]),new Tt(gt.BINARY,o,s,a)}else if(c(KU[o])){if(i!==3)throw new ue(`${o} requires exactly three arguments.`);s=_i(e,n[0]),a=_i(e,n[1]);let l=_i(e,n[2]);return new Tt(gt.TERNARY,o,s,a,l)}else{if(o==="Boolean")return i===0?new Tt(gt.LITERAL_BOOLEAN,!1):(r=_i(e,n[0]),new Tt(gt.UNARY,o,r));if(o==="Number")return i===0?new Tt(gt.LITERAL_NUMBER,0):(r=_i(e,n[0]),new Tt(gt.UNARY,o,r));if(o==="String")return i===0?new Tt(gt.LITERAL_STRING,""):(r=_i(e,n[0]),new Tt(gt.UNARY,o,r));if(o==="regExp")return AMe(e,t)}}throw new ue(`Unexpected function call "${o}".`)}function AMe(e,t){let n=t.arguments;if(n.length===0)return new Tt(gt.LITERAL_REGEX,new RegExp);let i=_i(e,n[0]),o;if(n.length>1){let r=_i(e,n[1]);if(YU(i)&&YU(r)){try{o=new RegExp(XU(String(i._value)),r._value)}catch(s){throw new ue(s)}return new Tt(gt.LITERAL_REGEX,o)}return new Tt(gt.REGEX,i,r)}if(YU(i)){try{o=new RegExp(XU(String(i._value)))}catch(r){throw new ue(r)}return new Tt(gt.LITERAL_REGEX,o)}return new Tt(gt.REGEX,i)}function CMe(e){if(vMe(e.name)){let t=DMe(e.name);return t.substr(0,8)==="tiles3d_"?new Tt(gt.BUILTIN_VARIABLE,t):new Tt(gt.VARIABLE,t)}else{if(e.name==="NaN")return new Tt(gt.LITERAL_NUMBER,NaN);if(e.name==="Infinity")return new Tt(gt.LITERAL_NUMBER,1/0);if(e.name==="undefined")return new Tt(gt.LITERAL_UNDEFINED,void 0)}throw new ue(`${e.name} is not defined.`)}function EMe(e){let t=e.property.name;if(t==="PI")return new Tt(gt.LITERAL_NUMBER,Math.PI);if(t==="E")return new Tt(gt.LITERAL_NUMBER,Math.E)}function SMe(e){if(e.property.name==="POSITIVE_INFINITY")return new Tt(gt.LITERAL_NUMBER,Number.POSITIVE_INFINITY)}function wMe(e,t){if(t.object.name==="Math")return EMe(t);if(t.object.name==="Number")return SMe(t);let n,i=_i(e,t.object);return t.computed?(n=_i(e,t.property),new Tt(gt.MEMBER,"brackets",i,n)):(n=new Tt(gt.LITERAL_STRING,t.property.name),new Tt(gt.MEMBER,"dot",i,n))}function YU(e){return e._type>=gt.LITERAL_NULL}function vMe(e){return e.substr(0,4)==="czm_"}function DMe(e){return e.substr(4)}function _i(e,t){let n,i,o,r;if(t.type==="Literal")n=xMe(t);else if(t.type==="CallExpression")n=TMe(e,t);else if(t.type==="Identifier")n=CMe(t);else if(t.type==="UnaryExpression"){i=t.operator;let s=_i(e,t.argument);if(rMe.indexOf(i)>-1)n=new Tt(gt.UNARY,i,s);else throw new ue(`Unexpected operator "${i}".`)}else if(t.type==="BinaryExpression")if(i=t.operator,o=_i(e,t.left),r=_i(e,t.right),ine.indexOf(i)>-1)n=new Tt(gt.BINARY,i,o,r);else throw new ue(`Unexpected operator "${i}".`);else if(t.type==="LogicalExpression")i=t.operator,o=_i(e,t.left),r=_i(e,t.right),ine.indexOf(i)>-1&&(n=new Tt(gt.BINARY,i,o,r));else if(t.type==="ConditionalExpression"){let s=_i(e,t.test);o=_i(e,t.consequent),r=_i(e,t.alternate),n=new Tt(gt.CONDITIONAL,"?",o,r,s)}else if(t.type==="MemberExpression")n=wMe(e,t);else if(t.type==="ArrayExpression"){let s=[];for(let a=0;a<t.elements.length;a++)s[a]=_i(e,t.elements[a]);n=new Tt(gt.ARRAY,s)}else throw t.type==="Compound"?new ue("Provide exactly one expression."):new ue("Cannot parse expression.");return n}function PMe(e){e._type===gt.CONDITIONAL?e.evaluate=e._evaluateConditional:e._type===gt.FUNCTION_CALL?e._value==="test"?e.evaluate=e._evaluateRegExpTest:e._value==="exec"?e.evaluate=e._evaluateRegExpExec:e._value==="toString"&&(e.evaluate=e._evaluateToString):e._type===gt.UNARY?e._value==="!"?e.evaluate=e._evaluateNot:e._value==="-"?e.evaluate=e._evaluateNegative:e._value==="+"?e.evaluate=e._evaluatePositive:e._value==="isNaN"?e.evaluate=e._evaluateNaN:e._value==="isFinite"?e.evaluate=e._evaluateIsFinite:e._value==="isExactClass"?e.evaluate=e._evaluateIsExactClass:e._value==="isClass"?e.evaluate=e._evaluateIsClass:e._value==="getExactClassName"?e.evaluate=e._evaluateGetExactClassName:e._value==="Boolean"?e.evaluate=e._evaluateBooleanConversion:e._value==="Number"?e.evaluate=e._evaluateNumberConversion:e._value==="String"?e.evaluate=e._evaluateStringConversion:c(hO[e._value])&&(e.evaluate=OMe(e._value)):e._type===gt.BINARY?e._value==="+"?e.evaluate=e._evaluatePlus:e._value==="-"?e.evaluate=e._evaluateMinus:e._value==="*"?e.evaluate=e._evaluateTimes:e._value==="/"?e.evaluate=e._evaluateDivide:e._value==="%"?e.evaluate=e._evaluateMod:e._value==="==="?e.evaluate=e._evaluateEqualsStrict:e._value==="!=="?e.evaluate=e._evaluateNotEqualsStrict:e._value==="<"?e.evaluate=e._evaluateLessThan:e._value==="<="?e.evaluate=e._evaluateLessThanOrEquals:e._value===">"?e.evaluate=e._evaluateGreaterThan:e._value===">="?e.evaluate=e._evaluateGreaterThanOrEquals:e._value==="&&"?e.evaluate=e._evaluateAnd:e._value==="||"?e.evaluate=e._evaluateOr:e._value==="=~"?e.evaluate=e._evaluateRegExpMatch:e._value==="!~"?e.evaluate=e._evaluateRegExpNotMatch:c(mO[e._value])&&(e.evaluate=RMe(e._value)):e._type===gt.TERNARY?e.evaluate=MMe(e._value):e._type===gt.MEMBER?e._value==="brackets"?e.evaluate=e._evaluateMemberBrackets:e.evaluate=e._evaluateMemberDot:e._type===gt.ARRAY?e.evaluate=e._evaluateArray:e._type===gt.VARIABLE?e.evaluate=e._evaluateVariable:e._type===gt.VARIABLE_IN_STRING?e.evaluate=e._evaluateVariableString:e._type===gt.LITERAL_COLOR?e.evaluate=e._evaluateLiteralColor:e._type===gt.LITERAL_VECTOR?e.evaluate=e._evaluateLiteralVector:e._type===gt.LITERAL_STRING?e.evaluate=e._evaluateLiteralString:e._type===gt.REGEX?e.evaluate=e._evaluateRegExp:e._type===gt.BUILTIN_VARIABLE?e._value==="tiles3d_tileset_time"&&(e.evaluate=IMe):e.evaluate=e._evaluateLiteral}function IMe(e){return c(e)?e.content.tileset.timeSinceLoad:0}function OMe(e){let t=hO[e];return function(n){let i=this._left.evaluate(n);return t(e,i)}}function RMe(e){let t=mO[e];return function(n){let i=this._left.evaluate(n),o=this._right.evaluate(n);return t(e,i,o)}}function MMe(e){let t=KU[e];return function(n){let i=this._left.evaluate(n),o=this._right.evaluate(n),r=this._test.evaluate(n);return t(e,i,o,r)}}function pO(e,t){if(c(e))return e.getPropertyInherited(t)}Tt.prototype._evaluateLiteral=function(){return this._value};Tt.prototype._evaluateLiteralColor=function(e){let t=dO,n=this._left;if(this._value==="color")c(n)?n.length>1?(j.fromCssColorString(n[0].evaluate(e),t),t.alpha=n[1].evaluate(e)):j.fromCssColorString(n[0].evaluate(e),t):j.fromBytes(255,255,255,255,t);else if(this._value==="rgb")j.fromBytes(n[0].evaluate(e),n[1].evaluate(e),n[2].evaluate(e),255,t);else if(this._value==="rgba"){let i=n[3].evaluate(e)*255;j.fromBytes(n[0].evaluate(e),n[1].evaluate(e),n[2].evaluate(e),i,t)}else this._value==="hsl"?j.fromHsl(n[0].evaluate(e),n[1].evaluate(e),n[2].evaluate(e),1,t):this._value==="hsla"&&j.fromHsl(n[0].evaluate(e),n[1].evaluate(e),n[2].evaluate(e),n[3].evaluate(e),t);return se.fromColor(t,In.getCartesian4())};Tt.prototype._evaluateLiteralVector=function(e){let t=In.getArray(),n=this._value,i=this._left,o=i.length;for(let a=0;a<o;++a){let l=i[a].evaluate(e);if(typeof l=="number")t.push(l);else if(l instanceof H)t.push(l.x,l.y);else if(l instanceof h)t.push(l.x,l.y,l.z);else if(l instanceof se)t.push(l.x,l.y,l.z,l.w);else throw new ue(`${n} argument must be a vector or number. Argument is ${l}.`)}let r=t.length,s=parseInt(n.charAt(3));if(r===0)throw new ue(`Invalid ${n} constructor. No valid arguments.`);if(r<s&&r>1)throw new ue(`Invalid ${n} constructor. Not enough arguments.`);if(r>s&&o>1)throw new ue(`Invalid ${n} constructor. Too many arguments.`);if(r===1){let a=t[0];t.push(a,a,a)}if(n==="vec2")return H.fromArray(t,0,In.getCartesian2());if(n==="vec3")return h.fromArray(t,0,In.getCartesian3());if(n==="vec4")return se.fromArray(t,0,In.getCartesian4())};Tt.prototype._evaluateLiteralString=function(){return this._value};Tt.prototype._evaluateVariableString=function(e){let t=this._value,n=fO.exec(t);for(;n!==null;){let i=n[0],o=n[1],r=pO(e,o);c(r)||(r=""),t=t.replace(i,r),n=fO.exec(t)}return t};Tt.prototype._evaluateVariable=function(e){return pO(e,this._value)};function s0(e){return e._value==="feature"}Tt.prototype._evaluateMemberDot=function(e){if(s0(this._left))return pO(e,this._right.evaluate(e));let t=this._left.evaluate(e);if(!c(t))return;let n=this._right.evaluate(e);if(t instanceof H||t instanceof h||t instanceof se){if(n==="r")return t.x;if(n==="g")return t.y;if(n==="b")return t.z;if(n==="a")return t.w}return t[n]};Tt.prototype._evaluateMemberBrackets=function(e){if(s0(this._left))return pO(e,this._right.evaluate(e));let t=this._left.evaluate(e);if(!c(t))return;let n=this._right.evaluate(e);if(t instanceof H||t instanceof h||t instanceof se){if(n===0||n==="r")return t.x;if(n===1||n==="g")return t.y;if(n===2||n==="b")return t.z;if(n===3||n==="a")return t.w}return t[n]};Tt.prototype._evaluateArray=function(e){let t=[];for(let n=0;n<this._value.length;n++)t[n]=this._value[n].evaluate(e);return t};Tt.prototype._evaluateNot=function(e){let t=this._left.evaluate(e);if(typeof t!="boolean")throw new ue(`Operator "!" requires a boolean argument. Argument is ${t}.`);return!t};Tt.prototype._evaluateNegative=function(e){let t=this._left.evaluate(e);if(t instanceof H)return H.negate(t,In.getCartesian2());if(t instanceof h)return h.negate(t,In.getCartesian3());if(t instanceof se)return se.negate(t,In.getCartesian4());if(typeof t=="number")return-t;throw new ue(`Operator "-" requires a vector or number argument. Argument is ${t}.`)};Tt.prototype._evaluatePositive=function(e){let t=this._left.evaluate(e);if(!(t instanceof H||t instanceof h||t instanceof se||typeof t=="number"))throw new ue(`Operator "+" requires a vector or number argument. Argument is ${t}.`);return t};Tt.prototype._evaluateLessThan=function(e){let t=this._left.evaluate(e),n=this._right.evaluate(e);if(typeof t!="number"||typeof n!="number")throw new ue(`Operator "<" requires number arguments. Arguments are ${t} and ${n}.`);return t<n};Tt.prototype._evaluateLessThanOrEquals=function(e){let t=this._left.evaluate(e),n=this._right.evaluate(e);if(typeof t!="number"||typeof n!="number")throw new ue(`Operator "<=" requires number arguments. Arguments are ${t} and ${n}.`);return t<=n};Tt.prototype._evaluateGreaterThan=function(e){let t=this._left.evaluate(e),n=this._right.evaluate(e);if(typeof t!="number"||typeof n!="number")throw new ue(`Operator ">" requires number arguments. Arguments are ${t} and ${n}.`);return t>n};Tt.prototype._evaluateGreaterThanOrEquals=function(e){let t=this._left.evaluate(e),n=this._right.evaluate(e);if(typeof t!="number"||typeof n!="number")throw new ue(`Operator ">=" requires number arguments. Arguments are ${t} and ${n}.`);return t>=n};Tt.prototype._evaluateOr=function(e){let t=this._left.evaluate(e);if(typeof t!="boolean")throw new ue(`Operator "||" requires boolean arguments. First argument is ${t}.`);if(t)return!0;let n=this._right.evaluate(e);if(typeof n!="boolean")throw new ue(`Operator "||" requires boolean arguments. Second argument is ${n}.`);return t||n};Tt.prototype._evaluateAnd=function(e){let t=this._left.evaluate(e);if(typeof t!="boolean")throw new ue(`Operator "&&" requires boolean arguments. First argument is ${t}.`);if(!t)return!1;let n=this._right.evaluate(e);if(typeof n!="boolean")throw new ue(`Operator "&&" requires boolean arguments. Second argument is ${n}.`);return t&&n};Tt.prototype._evaluatePlus=function(e){let t=this._left.evaluate(e),n=this._right.evaluate(e);if(n instanceof H&&t instanceof H)return H.add(t,n,In.getCartesian2());if(n instanceof h&&t instanceof h)return h.add(t,n,In.getCartesian3());if(n instanceof se&&t instanceof se)return se.add(t,n,In.getCartesian4());if(typeof t=="string"||typeof n=="string")return t+n;if(typeof t=="number"&&typeof n=="number")return t+n;throw new ue(`Operator "+" requires vector or number arguments of matching types, or at least one string argument. Arguments are ${t} and ${n}.`)};Tt.prototype._evaluateMinus=function(e){let t=this._left.evaluate(e),n=this._right.evaluate(e);if(n instanceof H&&t instanceof H)return H.subtract(t,n,In.getCartesian2());if(n instanceof h&&t instanceof h)return h.subtract(t,n,In.getCartesian3());if(n instanceof se&&t instanceof se)return se.subtract(t,n,In.getCartesian4());if(typeof t=="number"&&typeof n=="number")return t-n;throw new ue(`Operator "-" requires vector or number arguments of matching types. Arguments are ${t} and ${n}.`)};Tt.prototype._evaluateTimes=function(e){let t=this._left.evaluate(e),n=this._right.evaluate(e);if(n instanceof H&&t instanceof H)return H.multiplyComponents(t,n,In.getCartesian2());if(n instanceof H&&typeof t=="number")return H.multiplyByScalar(n,t,In.getCartesian2());if(t instanceof H&&typeof n=="number")return H.multiplyByScalar(t,n,In.getCartesian2());if(n instanceof h&&t instanceof h)return h.multiplyComponents(t,n,In.getCartesian3());if(n instanceof h&&typeof t=="number")return h.multiplyByScalar(n,t,In.getCartesian3());if(t instanceof h&&typeof n=="number")return h.multiplyByScalar(t,n,In.getCartesian3());if(n instanceof se&&t instanceof se)return se.multiplyComponents(t,n,In.getCartesian4());if(n instanceof se&&typeof t=="number")return se.multiplyByScalar(n,t,In.getCartesian4());if(t instanceof se&&typeof n=="number")return se.multiplyByScalar(t,n,In.getCartesian4());if(typeof t=="number"&&typeof n=="number")return t*n;throw new ue(`Operator "*" requires vector or number arguments. If both arguments are vectors they must be matching types. Arguments are ${t} and ${n}.`)};Tt.prototype._evaluateDivide=function(e){let t=this._left.evaluate(e),n=this._right.evaluate(e);if(n instanceof H&&t instanceof H)return H.divideComponents(t,n,In.getCartesian2());if(t instanceof H&&typeof n=="number")return H.divideByScalar(t,n,In.getCartesian2());if(n instanceof h&&t instanceof h)return h.divideComponents(t,n,In.getCartesian3());if(t instanceof h&&typeof n=="number")return h.divideByScalar(t,n,In.getCartesian3());if(n instanceof se&&t instanceof se)return se.divideComponents(t,n,In.getCartesian4());if(t instanceof se&&typeof n=="number")return se.divideByScalar(t,n,In.getCartesian4());if(typeof t=="number"&&typeof n=="number")return t/n;throw new ue(`Operator "/" requires vector or number arguments of matching types, or a number as the second argument. Arguments are ${t} and ${n}.`)};Tt.prototype._evaluateMod=function(e){let t=this._left.evaluate(e),n=this._right.evaluate(e);if(n instanceof H&&t instanceof H)return H.fromElements(t.x%n.x,t.y%n.y,In.getCartesian2());if(n instanceof h&&t instanceof h)return h.fromElements(t.x%n.x,t.y%n.y,t.z%n.z,In.getCartesian3());if(n instanceof se&&t instanceof se)return se.fromElements(t.x%n.x,t.y%n.y,t.z%n.z,t.w%n.w,In.getCartesian4());if(typeof t=="number"&&typeof n=="number")return t%n;throw new ue(`Operator "%" requires vector or number arguments of matching types. Arguments are ${t} and ${n}.`)};Tt.prototype._evaluateEqualsStrict=function(e){let t=this._left.evaluate(e),n=this._right.evaluate(e);return n instanceof H&&t instanceof H||n instanceof h&&t instanceof h||n instanceof se&&t instanceof se?t.equals(n):t===n};Tt.prototype._evaluateNotEqualsStrict=function(e){let t=this._left.evaluate(e),n=this._right.evaluate(e);return n instanceof H&&t instanceof H||n instanceof h&&t instanceof h||n instanceof se&&t instanceof se?!t.equals(n):t!==n};Tt.prototype._evaluateConditional=function(e){let t=this._test.evaluate(e);if(typeof t!="boolean")throw new ue(`Conditional argument of conditional expression must be a boolean. Argument is ${t}.`);return t?this._left.evaluate(e):this._right.evaluate(e)};Tt.prototype._evaluateNaN=function(e){return isNaN(this._left.evaluate(e))};Tt.prototype._evaluateIsFinite=function(e){return isFinite(this._left.evaluate(e))};Tt.prototype._evaluateIsExactClass=function(e){return c(e)?e.isExactClass(this._left.evaluate(e)):!1};Tt.prototype._evaluateIsClass=function(e){return c(e)?e.isClass(this._left.evaluate(e)):!1};Tt.prototype._evaluateGetExactClassName=function(e){if(c(e))return e.getExactClassName()};Tt.prototype._evaluateBooleanConversion=function(e){return!!this._left.evaluate(e)};Tt.prototype._evaluateNumberConversion=function(e){return Number(this._left.evaluate(e))};Tt.prototype._evaluateStringConversion=function(e){return String(this._left.evaluate(e))};Tt.prototype._evaluateRegExp=function(e){let t=this._value.evaluate(e),n="";c(this._left)&&(n=this._left.evaluate(e));let i;try{i=new RegExp(t,n)}catch(o){throw new ue(o)}return i};Tt.prototype._evaluateRegExpTest=function(e){let t=this._left.evaluate(e),n=this._right.evaluate(e);if(!(t instanceof RegExp&&typeof n=="string"))throw new ue(`RegExp.test requires the first argument to be a RegExp and the second argument to be a string. Arguments are ${t} and ${n}.`);return t.test(n)};Tt.prototype._evaluateRegExpMatch=function(e){let t=this._left.evaluate(e),n=this._right.evaluate(e);if(t instanceof RegExp&&typeof n=="string")return t.test(n);if(n instanceof RegExp&&typeof t=="string")return n.test(t);throw new ue(`Operator "=~" requires one RegExp argument and one string argument. Arguments are ${t} and ${n}.`)};Tt.prototype._evaluateRegExpNotMatch=function(e){let t=this._left.evaluate(e),n=this._right.evaluate(e);if(t instanceof RegExp&&typeof n=="string")return!t.test(n);if(n instanceof RegExp&&typeof t=="string")return!n.test(t);throw new ue(`Operator "!~" requires one RegExp argument and one string argument. Arguments are ${t} and ${n}.`)};Tt.prototype._evaluateRegExpExec=function(e){let t=this._left.evaluate(e),n=this._right.evaluate(e);if(!(t instanceof RegExp&&typeof n=="string"))throw new ue(`RegExp.exec requires the first argument to be a RegExp and the second argument to be a string. Arguments are ${t} and ${n}.`);let i=t.exec(n);return c(i)?i[1]:null};Tt.prototype._evaluateToString=function(e){let t=this._left.evaluate(e);if(t instanceof RegExp||t instanceof H||t instanceof h||t instanceof se)return String(t);throw new ue(`Unexpected function call "${this._value}".`)};function rne(e){let t=e._left,n=t.length;for(let a=0;a<n;++a)if(t[a]._type!==gt.LITERAL_NUMBER)return;let i=t[0]._value,o=t[1]._value,r=t[2]._value,s=n===4?t[3]._value:1;return j.fromHsl(i,o,r,s,dO)}function sne(e){let t=e._left,n=t.length;for(let o=0;o<n;++o)if(t[o]._type!==gt.LITERAL_NUMBER)return;let i=dO;return i.red=t[0]._value/255,i.green=t[1]._value/255,i.blue=t[2]._value/255,i.alpha=n===4?t[3]._value:1,i}function M_(e){return e%1===0?e.toFixed(1):e.toString()}function LMe(e){let t=M_(e.red),n=M_(e.green),i=M_(e.blue);return`vec3(${t}, ${n}, ${i})`}function uO(e){let t=M_(e.red),n=M_(e.green),i=M_(e.blue),o=M_(e.alpha);return`vec4(${t}, ${n}, ${i}, ${o})`}function ane(e,t,n,i){let o=e.length,r=new Array(o);for(let s=0;s<o;++s)r[s]=e[s].getShaderExpression(t,n,i);return r}function cne(e,t){return c(t[e])?t[e]:$f.NULL_SENTINEL}$f.NULL_SENTINEL="czm_infinity";Tt.prototype.getShaderExpression=function(e,t,n){let i,o,r,s,a=this._type,l=this._value;c(this._left)&&(Array.isArray(this._left)?o=ane(this._left,e,t,this):o=this._left.getShaderExpression(e,t,this)),c(this._right)&&(r=this._right.getShaderExpression(e,t,this)),c(this._test)&&(s=this._test.getShaderExpression(e,t,this)),Array.isArray(this._value)&&(l=ane(this._value,e,t,this));let u,f,d;switch(a){case gt.VARIABLE:return s0(this)?void 0:cne(l,e);case gt.UNARY:if(l==="Boolean")return`bool(${o})`;if(l==="Number")return`float(${o})`;if(l==="round")return`floor(${o} + 0.5)`;if(c(hO[l]))return`${l}(${o})`;if(l==="isNaN")return`(${o} != ${o})`;if(l==="isFinite")return`(abs(${o}) < czm_infinity)`;if(l==="String"||l==="isExactClass"||l==="isClass"||l==="getExactClassName")throw new ue(`Error generating style shader: "${l}" is not supported.`);return l+o;case gt.BINARY:return l==="%"?`mod(${o}, ${r})`:l==="==="?`(${o} == ${r})`:l==="!=="?`(${o} != ${r})`:l==="atan2"?`atan(${o}, ${r})`:c(mO[l])?`${l}(${o}, ${r})`:`(${o} ${l} ${r})`;case gt.TERNARY:if(c(KU[l]))return`${l}(${o}, ${r}, ${s})`;break;case gt.CONDITIONAL:return`(${s} ? ${o} : ${r})`;case gt.MEMBER:return s0(this._left)?cne(r,e):r==="r"||r==="x"||r==="0.0"?`${o}[0]`:r==="g"||r==="y"||r==="1.0"?`${o}[1]`:r==="b"||r==="z"||r==="2.0"?`${o}[2]`:r==="a"||r==="w"||r==="3.0"?`${o}[3]`:`${o}[int(${r})]`;case gt.FUNCTION_CALL:throw new ue(`Error generating style shader: "${l}" is not supported.`);case gt.ARRAY:if(l.length===4)return`vec4(${l[0]}, ${l[1]}, ${l[2]}, ${l[3]})`;if(l.length===3)return`vec3(${l[0]}, ${l[1]}, ${l[2]})`;if(l.length===2)return`vec2(${l[0]}, ${l[1]})`;throw new ue("Error generating style shader: Invalid array length. Array length should be 2, 3, or 4.");case gt.REGEX:throw new ue("Error generating style shader: Regular expressions are not supported.");case gt.VARIABLE_IN_STRING:throw new ue("Error generating style shader: Converting a variable to a string is not supported.");case gt.LITERAL_NULL:return $f.NULL_SENTINEL;case gt.LITERAL_BOOLEAN:return l?"true":"false";case gt.LITERAL_NUMBER:return M_(l);case gt.LITERAL_STRING:if(c(n)&&n._type===gt.MEMBER&&(l==="r"||l==="g"||l==="b"||l==="a"||l==="x"||l==="y"||l==="z"||l==="w"||s0(n._left)))return l;if(i=j.fromCssColorString(l,dO),c(i))return LMe(i);throw new ue("Error generating style shader: String literals are not supported.");case gt.LITERAL_COLOR:if(u=o,l==="color"){if(c(u)){if(u.length>1){let p=u[0],g=u[1];return g!=="1.0"&&(t.translucent=!0),`vec4(${p}, ${g})`}}else return"vec4(1.0)";return`vec4(${u[0]}, 1.0)`}else{if(l==="rgb")return i=sne(this),c(i)?uO(i):`vec4(${u[0]} / 255.0, ${u[1]} / 255.0, ${u[2]} / 255.0, 1.0)`;if(l==="rgba")return u[3]!=="1.0"&&(t.translucent=!0),i=sne(this),c(i)?uO(i):`vec4(${u[0]} / 255.0, ${u[1]} / 255.0, ${u[2]} / 255.0, ${u[3]})`;if(l==="hsl")return i=rne(this),c(i)?uO(i):`vec4(czm_HSLToRGB(vec3(${u[0]}, ${u[1]}, ${u[2]})), 1.0)`;if(l==="hsla")return i=rne(this),c(i)?(i.alpha!==1&&(t.translucent=!0),uO(i)):(u[3]!=="1.0"&&(t.translucent=!0),`vec4(czm_HSLToRGB(vec3(${u[0]}, ${u[1]}, ${u[2]})), ${u[3]})`)}break;case gt.LITERAL_VECTOR:if(!c(o))throw new E("left should always be defined for type ExpressionNodeType.LITERAL_VECTOR");f=o.length,d=`${l}(`;for(let p=0;p<f;++p)d+=o[p],p<f-1&&(d+=", ");return d+=")",d;case gt.LITERAL_REGEX:throw new ue("Error generating style shader: Regular expressions are not supported.");case gt.LITERAL_UNDEFINED:return $f.NULL_SENTINEL;case gt.BUILTIN_VARIABLE:if(l==="tiles3d_tileset_time")return l}};Tt.prototype.getVariables=function(e,t){let n,i,o,r=this._type,s=this._value;if(c(this._left))if(Array.isArray(this._left))for(n=this._left,i=n.length,o=0;o<i;++o)n[o].getVariables(e,this);else this._left.getVariables(e,this);if(c(this._right)&&this._right.getVariables(e,this),c(this._test)&&this._test.getVariables(e,this),Array.isArray(this._value))for(n=this._value,i=n.length,o=0;o<i;++o)n[o].getVariables(e,this);let a;switch(r){case gt.VARIABLE:s0(this)||e.push(s);break;case gt.VARIABLE_IN_STRING:for(a=fO.exec(s);a!==null;)e.push(a[1]),a=fO.exec(s);break;case gt.LITERAL_STRING:c(t)&&t._type===gt.MEMBER&&s0(t._left)&&e.push(s);break}};var hh=$f;function Xm(e){e=y(e,y.EMPTY_OBJECT),this._batchTable=e.batchTable,this._batchIds=e.batchIds,this._positions=e.positions,this._vertexBatchIds=e.vertexBatchIds,this._indices=e.indices,this._indexCounts=e.indexCounts,this._indexOffsets=e.indexOffsets,this._batchedIndices=e.batchedIndices,this._boundingVolume=e.boundingVolume,this._boundingVolumes=e.boundingVolumes,this._center=y(e.center,h.ZERO),this._va=void 0,this._sp=void 0,this._spStencil=void 0,this._spPick=void 0,this._uniformMap=void 0,this._vaSwap=void 0,this._rsStencilDepthPass=void 0,this._rsStencilDepthPass3DTiles=void 0,this._rsColorPass=void 0,this._rsPickPass=void 0,this._rsWireframe=void 0,this._commands=[],this._commandsIgnoreShow=[],this._pickCommands=[],this._constantColor=j.clone(j.WHITE),this._highlightColor=this._constantColor,this._batchDirty=!0,this._pickCommandsDirty=!0,this._framesSinceLastRebatch=0,this._updatingAllCommands=!1,this._trianglesLength=this._indices.length/3,this._geometryByteLength=this._indices.byteLength+this._positions.byteLength+this._vertexBatchIds.byteLength,this.debugWireframe=!1,this._debugWireframe=this.debugWireframe,this._wireframeDirty=!1,this.forceRebatch=!1,this.classificationType=y(e.classificationType,Vn.BOTH),this._vertexShaderSource=e._vertexShaderSource,this._fragmentShaderSource=e._fragmentShaderSource,this._attributeLocations=e._attributeLocations,this._uniformMap=e._uniformMap,this._pickId=e._pickId,this._modelMatrix=e._modelMatrix,this._boundingSphere=e._boundingSphere,this._batchIdLookUp={};let t=this._batchIds.length;for(let n=0;n<t;++n){let i=this._batchIds[n];this._batchIdLookUp[i]=n}}Object.defineProperties(Xm.prototype,{trianglesLength:{get:function(){return this._trianglesLength}},geometryByteLength:{get:function(){return this._geometryByteLength}}});var NMe={position:0,a_batchId:1};function FMe(e,t){if(c(e._va))return;let n=xt.createVertexBuffer({context:t,typedArray:e._positions,usage:ke.STATIC_DRAW}),i=xt.createVertexBuffer({context:t,typedArray:e._vertexBatchIds,usage:ke.STATIC_DRAW}),o=xt.createIndexBuffer({context:t,typedArray:e._indices,usage:ke.DYNAMIC_DRAW,indexDatatype:e._indices.BYTES_PER_ELEMENT===2?Fe.UNSIGNED_SHORT:Fe.UNSIGNED_INT}),r=[{index:0,vertexBuffer:n,componentDatatype:$.fromTypedArray(e._positions),componentsPerAttribute:3},{index:1,vertexBuffer:i,componentDatatype:$.fromTypedArray(e._vertexBatchIds),componentsPerAttribute:1}];e._va=new ni({context:t,attributes:r,indexBuffer:o}),t.webgl2&&(e._vaSwap=new ni({context:t,attributes:r,indexBuffer:xt.createIndexBuffer({context:t,sizeInBytes:o.sizeInBytes,usage:ke.DYNAMIC_DRAW,indexDatatype:o.indexDatatype})})),e._batchedPositions=void 0,e._transferrableBatchIds=void 0,e._vertexBatchIds=void 0}function BMe(e,t){if(c(e._sp))return;let n=e._batchTable,i=y(e._attributeLocations,NMe),o=e._pickId,r=e._vertexShaderSource,s=e._fragmentShaderSource;if(c(r)){e._sp=an.fromCache({context:t,vertexShaderSource:r,fragmentShaderSource:s,attributeLocations:i}),e._spStencil=e._sp,s=Ge.replaceMain(s,"czm_non_pick_main"),s=`${s}void main() 
{ 
    czm_non_pick_main(); 
    out_FragColor = ${o}; 
} 
`,e._spPick=an.fromCache({context:t,vertexShaderSource:r,fragmentShaderSource:s,attributeLocations:i});return}let a=n.getVertexShaderCallback(!1,"a_batchId",void 0)(cO),l=n.getFragmentShaderCallback(!1,void 0,!0)(qx);o=n.getPickId();let u=new Ge({sources:[a]}),f=new Ge({defines:["VECTOR_TILE"],sources:[l]});e._sp=an.fromCache({context:t,vertexShaderSource:u,fragmentShaderSource:f,attributeLocations:i}),u=new Ge({sources:[cO]}),f=new Ge({defines:["VECTOR_TILE"],sources:[qx]}),e._spStencil=an.fromCache({context:t,vertexShaderSource:u,fragmentShaderSource:f,attributeLocations:i}),l=Ge.replaceMain(l,"czm_non_pick_main"),l=`${l}
void main() 
{ 
    czm_non_pick_main(); 
    out_FragColor = ${o}; 
} 
`;let d=new Ge({sources:[a]}),p=new Ge({defines:["VECTOR_TILE"],sources:[l]});e._spPick=an.fromCache({context:t,vertexShaderSource:d,fragmentShaderSource:p,attributeLocations:i})}function lne(e){let t=e?Un.EQUAL:Un.ALWAYS;return{colorMask:{red:!1,green:!1,blue:!1,alpha:!1},stencilTest:{enabled:!0,frontFunction:t,frontOperation:{fail:ft.KEEP,zFail:ft.DECREMENT_WRAP,zPass:ft.KEEP},backFunction:t,backOperation:{fail:ft.KEEP,zFail:ft.INCREMENT_WRAP,zPass:ft.KEEP},reference:Ut.CESIUM_3D_TILE_MASK,mask:Ut.CESIUM_3D_TILE_MASK},stencilMask:Ut.CLASSIFICATION_MASK,depthTest:{enabled:!0,func:Kc.LESS_OR_EQUAL},depthMask:!1}}var kMe={stencilTest:{enabled:!0,frontFunction:Un.NOT_EQUAL,frontOperation:{fail:ft.ZERO,zFail:ft.ZERO,zPass:ft.ZERO},backFunction:Un.NOT_EQUAL,backOperation:{fail:ft.ZERO,zFail:ft.ZERO,zPass:ft.ZERO},reference:0,mask:Ut.CLASSIFICATION_MASK},stencilMask:Ut.CLASSIFICATION_MASK,depthTest:{enabled:!1},depthMask:!1,blending:hn.PRE_MULTIPLIED_ALPHA_BLEND},VMe={stencilTest:{enabled:!0,frontFunction:Un.NOT_EQUAL,frontOperation:{fail:ft.ZERO,zFail:ft.ZERO,zPass:ft.ZERO},backFunction:Un.NOT_EQUAL,backOperation:{fail:ft.ZERO,zFail:ft.ZERO,zPass:ft.ZERO},reference:0,mask:Ut.CLASSIFICATION_MASK},stencilMask:Ut.CLASSIFICATION_MASK,depthTest:{enabled:!1},depthMask:!1};function UMe(e){c(e._rsStencilDepthPass)||(e._rsStencilDepthPass=ze.fromCache(lne(!1)),e._rsStencilDepthPass3DTiles=ze.fromCache(lne(!0)),e._rsColorPass=ze.fromCache(kMe),e._rsPickPass=ze.fromCache(VMe))}var a0=new k,une=new h;function zMe(e,t){if(c(e._uniformMap))return;let n={u_modifiedModelViewProjection:function(){let i=t.uniformState.view,o=t.uniformState.projection;return k.clone(i,a0),k.multiplyByPoint(a0,e._center,une),k.setTranslation(a0,une,a0),k.multiply(o,a0,a0),a0},u_highlightColor:function(){return e._highlightColor}};e._uniformMap=e._batchTable.getUniformMapCallback()(n)}function $U(e,t,n,i,o,r,s){let a=e.constructor.BYTES_PER_ELEMENT,l=r.length;for(let u=0;u<l;++u){let f=r[u],d=s[f],p=i[d],g=o[d],m=new e.constructor(e.buffer,a*p,g);t.set(m,n),i[d]=n,n+=g}return n}function HMe(e,t){let n=e._indices,i=e._indexOffsets,o=e._indexCounts,r=e._batchIdLookUp,s=new n.constructor(n.length),a=t.pop(),l=[a],u=$U(n,s,0,i,o,a.batchIds,r);for(a.offset=0,a.count=u;t.length>0;){let f=t.pop();if(j.equals(f.color,a.color))u=$U(n,s,u,i,o,f.batchIds,r),a.batchIds=a.batchIds.concat(f.batchIds),a.count=u-a.offset;else{let d=u;u=$U(n,s,u,i,o,f.batchIds,r),f.offset=d,f.count=u-d,l.push(f),a=f}}e._va.indexBuffer.copyFromArrayView(s),e._indices=s,e._batchedIndices=l}function ZU(e,t,n,i,o,r,s){let a=e.bytesPerIndex,l=r.length;for(let u=0;u<l;++u){let f=r[u],d=s[f],p=i[d],g=o[d];t.copyFromBuffer(e,p*a,n*a,g*a),i[d]=n,n+=g}return n}function GMe(e,t){let n=e._indexOffsets,i=e._indexCounts,o=e._batchIdLookUp,r=t.pop(),s=[r],a=e._va.indexBuffer,l=e._vaSwap.indexBuffer,u=ZU(a,l,0,n,i,r.batchIds,o);for(r.offset=0,r.count=u;t.length>0;){let d=t.pop();if(j.equals(d.color,r.color))u=ZU(a,l,u,n,i,d.batchIds,o),r.batchIds=r.batchIds.concat(d.batchIds),r.count=u-r.offset;else{let p=u;u=ZU(a,l,u,n,i,d.batchIds,o),d.offset=p,d.count=u-p,s.push(d),r=d}}let f=e._va;e._va=e._vaSwap,e._vaSwap=f,e._batchedIndices=s}function jMe(e,t){return t.color.toRgba()-e.color.toRgba()}function WMe(e,t){if(!e._batchDirty)return!1;let n=e._batchedIndices,i=n.length,o=!1,r={};for(let s=0;s<i;++s){let l=n[s].color.toRgba();if(c(r[l])){o=!0;break}else r[l]=!0}if(!o)return e._batchDirty=!1,!1;if(o&&!e.forceRebatch&&e._framesSinceLastRebatch<120){++e._framesSinceLastRebatch;return}return n.sort(jMe),t.webgl2?GMe(e,n):HMe(e,n),e._framesSinceLastRebatch=0,e._batchDirty=!1,e._pickCommandsDirty=!0,e._wireframeDirty=!0,!0}function qMe(e,t){let n=WMe(e,t),i=e._commands,o=e._batchedIndices,r=o.length,s=r*2;if(c(i)&&!n&&i.length===s)return;i.length=s;let a=e._va,l=e._sp,u=y(e._modelMatrix,k.IDENTITY),f=e._uniformMap,d=e._boundingVolume;for(let p=0;p<r;++p){let g=o[p].offset,m=o[p].count,b=i[p*2];c(b)||(b=i[p*2]=new et({owner:e})),b.vertexArray=a,b.modelMatrix=u,b.offset=g,b.count=m,b.renderState=e._rsStencilDepthPass,b.shaderProgram=l,b.uniformMap=f,b.boundingVolume=d,b.cull=!1,b.pass=ve.TERRAIN_CLASSIFICATION;let x=et.shallowClone(b,b.derivedCommands.tileset);x.renderState=e._rsStencilDepthPass3DTiles,x.pass=ve.CESIUM_3D_TILE_CLASSIFICATION,b.derivedCommands.tileset=x;let T=i[p*2+1];c(T)||(T=i[p*2+1]=new et({owner:e})),T.vertexArray=a,T.modelMatrix=u,T.offset=g,T.count=m,T.renderState=e._rsColorPass,T.shaderProgram=l,T.uniformMap=f,T.boundingVolume=d,T.cull=!1,T.pass=ve.TERRAIN_CLASSIFICATION;let C=et.shallowClone(T,T.derivedCommands.tileset);C.pass=ve.CESIUM_3D_TILE_CLASSIFICATION,T.derivedCommands.tileset=C}e._commandsDirty=!0}function YMe(e,t){if(e.classificationType===Vn.TERRAIN||!t.invertClassification||c(e._commandsIgnoreShow)&&!e._commandsDirty)return;let n=e._commands,i=e._commandsIgnoreShow,o=e._spStencil,r=n.length,s=i.length=r/2,a=0;for(let l=0;l<s;++l){let u=i[l]=et.shallowClone(n[a],i[l]);u.shaderProgram=o,u.pass=ve.CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW,a+=2}e._commandsDirty=!1}function XMe(e){if(!e._pickCommandsDirty)return;let t=e._indexOffsets.length,n=e._pickCommands;n.length=t*2;let i=e._va,o=e._spStencil,r=e._spPick,s=y(e._modelMatrix,k.IDENTITY),a=e._uniformMap;for(let l=0;l<t;++l){let u=e._indexOffsets[l],f=e._indexCounts[l],d=c(e._boundingVolumes)?e._boundingVolumes[l]:e.boundingVolume,p=n[l*2];c(p)||(p=n[l*2]=new et({owner:e,pickOnly:!0})),p.vertexArray=i,p.modelMatrix=s,p.offset=u,p.count=f,p.renderState=e._rsStencilDepthPass,p.shaderProgram=o,p.uniformMap=a,p.boundingVolume=d,p.pass=ve.TERRAIN_CLASSIFICATION;let g=et.shallowClone(p,p.derivedCommands.tileset);g.renderState=e._rsStencilDepthPass3DTiles,g.pass=ve.CESIUM_3D_TILE_CLASSIFICATION,p.derivedCommands.tileset=g;let m=n[l*2+1];c(m)||(m=n[l*2+1]=new et({owner:e,pickOnly:!0})),m.vertexArray=i,m.modelMatrix=s,m.offset=u,m.count=f,m.renderState=e._rsPickPass,m.shaderProgram=r,m.uniformMap=a,m.boundingVolume=d,m.pass=ve.TERRAIN_CLASSIFICATION;let b=et.shallowClone(m,m.derivedCommands.tileset);b.pass=ve.CESIUM_3D_TILE_CLASSIFICATION,m.derivedCommands.tileset=b}e._pickCommandsDirty=!1}Xm.prototype.createFeatures=function(e,t){let n=this._batchIds,i=n.length;for(let o=0;o<i;++o){let r=n[o];t[r]=new Ws(e,r)}};Xm.prototype.applyDebugSettings=function(e,t){this._highlightColor=e?t:this._constantColor};function KMe(e,t){e._updatingAllCommands=!0;let n=e._batchIds,i=n.length,o;for(o=0;o<i;++o){let s=n[o],a=t[s];a.show=!0,a.color=j.WHITE}let r=e._batchedIndices;for(i=r.length,o=0;o<i;++o)r[o].color=j.clone(j.WHITE);e._updatingAllCommands=!1,e._batchDirty=!0}var $Me=new j,ZMe=j.WHITE,JMe=!0,QMe=/\$/;Xm.prototype.applyStyle=function(e,t){if(!c(e)){KMe(this,t);return}let n=e.color,i=n instanceof hh&&!QMe.test(n.expression);this._updatingAllCommands=i;let o=this._batchIds,r=o.length,s;for(s=0;s<r;++s){let a=o[s],l=t[a];l.color=c(e.color)?e.color.evaluateColor(l,$Me):ZMe,l.show=c(e.show)?e.show.evaluate(l):JMe}if(i){let a=this._batchedIndices;for(r=a.length,s=0;s<r;++s)a[s].color=j.clone(j.WHITE);this._updatingAllCommands=!1,this._batchDirty=!0}};Xm.prototype.updateCommands=function(e,t){if(this._updatingAllCommands)return;let n=this._batchIdLookUp,i=n[e];if(!c(i))return;let o=this._indexOffsets,r=this._indexCounts,s=o[i],a=r[i],l=this._batchedIndices,u=l.length,f;for(f=0;f<u;++f){let b=l[f].offset,x=l[f].count;if(s>=b&&s<b+x)break}l.push(new O_({color:j.clone(t),offset:s,count:a,batchIds:[e]}));let d=[],p=[],g=l[f].batchIds,m=g.length;for(let b=0;b<m;++b){let x=g[b];if(x===e)continue;let T=n[x];o[T]<s?d.push(x):p.push(x)}p.length!==0&&l.push(new O_({color:j.clone(l[f].color),offset:s+a,count:l[f].offset+l[f].count-(s+a),batchIds:p})),d.length!==0?(l[f].count=s-l[f].offset,l[f].batchIds=d):l.splice(f,1),this._batchDirty=!0};function fne(e,t,n,i){let o=e.classificationType,r=o!==Vn.CESIUM_3D_TILE,s=o!==Vn.TERRAIN,a=t.commandList,l=n.length,u,f;for(f=0;f<l;++f)r&&(u=n[f],u.pass=ve.TERRAIN_CLASSIFICATION,a.push(u)),s&&(u=n[f].derivedCommands.tileset,u.pass=ve.CESIUM_3D_TILE_CLASSIFICATION,a.push(u));if(!(!t.invertClassification||!c(i)))for(l=i.length,f=0;f<l;++f)a.push(i[f])}function eLe(e,t){let n=e.commandList,i=t.length;for(let o=0;o<i;o+=2){let r=t[o+1];r.pass=ve.OPAQUE,n.push(r)}}function tLe(e){let t=e.debugWireframe===e._debugWireframe;if(t=t&&!(e.debugWireframe&&e._wireframeDirty),t)return;c(e._rsWireframe)||(e._rsWireframe=ze.fromCache({}));let n,i;e.debugWireframe?(n=e._rsWireframe,i=Me.LINES):(n=e._rsColorPass,i=Me.TRIANGLES);let o=e._commands,r=o.length;for(let s=0;s<r;s+=2){let a=o[s+1];a.renderState=n,a.primitiveType=i}e._debugWireframe=e.debugWireframe,e._wireframeDirty=!1}Xm.prototype.update=function(e){let t=e.context;FMe(this,t),BMe(this,t),UMe(this),zMe(this,t);let n=e.passes;n.render&&(qMe(this,t),YMe(this,e),tLe(this),this._debugWireframe?eLe(e,this._commands):fne(this,e,this._commands,this._commandsIgnoreShow)),n.pick&&(XMe(this),fne(this,e,this._pickCommands))};Xm.prototype.isDestroyed=function(){return!1};Xm.prototype.destroy=function(){return this._va=this._va&&this._va.destroy(),this._sp=this._sp&&this._sp.destroy(),this._spPick=this._spPick&&this._spPick.destroy(),this._vaSwap=this._vaSwap&&this._vaSwap.destroy(),de(this)};var MS=Xm;function Ul(e){this._boxes=e.boxes,this._boxBatchIds=e.boxBatchIds,this._cylinders=e.cylinders,this._cylinderBatchIds=e.cylinderBatchIds,this._ellipsoids=e.ellipsoids,this._ellipsoidBatchIds=e.ellipsoidBatchIds,this._spheres=e.spheres,this._sphereBatchIds=e.sphereBatchIds,this._modelMatrix=e.modelMatrix,this._batchTable=e.batchTable,this._boundingVolume=e.boundingVolume,this._center=e.center,c(this._center)||(c(this._boundingVolume)?this._center=h.clone(this._boundingVolume.center):this._center=h.clone(h.ZERO)),this._boundingVolumes=void 0,this._batchedIndices=void 0,this._indices=void 0,this._indexOffsets=void 0,this._indexCounts=void 0,this._positions=void 0,this._vertexBatchIds=void 0,this._batchIds=void 0,this._batchTableColors=void 0,this._packedBuffer=void 0,this._ready=!1,this._promise=void 0,this._error=void 0,this._verticesPromise=void 0,this._primitive=void 0,this.debugWireframe=!1,this.forceRebatch=!1,this.classificationType=Vn.BOTH}Object.defineProperties(Ul.prototype,{trianglesLength:{get:function(){return c(this._primitive)?this._primitive.trianglesLength:0}},geometryByteLength:{get:function(){return c(this._primitive)?this._primitive.geometryByteLength:0}},ready:{get:function(){return this._ready}}});Ul.packedBoxLength=k.packedLength+h.packedLength;Ul.packedCylinderLength=k.packedLength+2;Ul.packedEllipsoidLength=k.packedLength+h.packedLength;Ul.packedSphereLength=h.packedLength+1;function nLe(e){let t=new Float64Array(k.packedLength+h.packedLength),n=0;return h.pack(e._center,t,n),n+=h.packedLength,k.pack(e._modelMatrix,t,n),t}function iLe(e,t){let n=0,i=t[n++],o=t[n++],r=e._boundingVolumes=new Array(o);for(let l=0;l<o;++l)r[l]=ce.unpack(t,n),n+=ce.packedLength;let s=t[n++],a=e._batchedIndices=new Array(s);for(let l=0;l<s;++l){let u=j.unpack(t,n);n+=j.packedLength;let f=t[n++],d=t[n++],p=t[n++],g=new Array(p);for(let m=0;m<p;++m)g[m]=t[n++];a[l]=new O_({color:u,offset:f,count:d,batchIds:g})}return i}var oLe=new Ti("createVectorTileGeometries",5),rLe=new j;function sLe(e){if(!c(e._primitive)&&!c(e._verticesPromise)){let t=e._boxes,n=e._boxBatchIds,i=e._cylinders,o=e._cylinderBatchIds,r=e._ellipsoids,s=e._ellipsoidBatchIds,a=e._spheres,l=e._sphereBatchIds,u=e._batchTableColors,f=e._packedBuffer;if(!c(u)){let m=0;c(e._boxes)&&(t=e._boxes=t.slice(),n=e._boxBatchIds=n.slice(),m+=n.length),c(e._cylinders)&&(i=e._cylinders=i.slice(),o=e._cylinderBatchIds=o.slice(),m+=o.length),c(e._ellipsoids)&&(r=e._ellipsoids=r.slice(),s=e._ellipsoidBatchIds=s.slice(),m+=s.length),c(e._spheres)&&(a=e._sphere=a.slice(),l=e._sphereBatchIds=l.slice(),m+=l.length),u=e._batchTableColors=new Uint32Array(m);let b=e._batchTable;for(let x=0;x<m;++x){let T=b.getColor(x,rLe);u[x]=T.toRgba()}f=e._packedBuffer=nLe(e)}let d=[];c(t)&&d.push(t.buffer,n.buffer),c(i)&&d.push(i.buffer,o.buffer),c(r)&&d.push(r.buffer,s.buffer),c(a)&&d.push(a.buffer,l.buffer),d.push(u.buffer,f.buffer);let p={boxes:c(t)?t.buffer:void 0,boxBatchIds:c(t)?n.buffer:void 0,cylinders:c(i)?i.buffer:void 0,cylinderBatchIds:c(i)?o.buffer:void 0,ellipsoids:c(r)?r.buffer:void 0,ellipsoidBatchIds:c(r)?s.buffer:void 0,spheres:c(a)?a.buffer:void 0,sphereBatchIds:c(a)?l.buffer:void 0,batchTableColors:u.buffer,packedBuffer:f.buffer},g=e._verticesPromise=oLe.scheduleTask(p,d);return c(g)?g.then(function(m){if(e.isDestroyed())return;let b=new Float64Array(m.packedBuffer);iLe(e,b)===2?e._indices=new Uint16Array(m.indices):e._indices=new Uint32Array(m.indices),e._indexOffsets=new Uint32Array(m.indexOffsets),e._indexCounts=new Uint32Array(m.indexCounts),e._positions=new Float32Array(m.positions),e._vertexBatchIds=new Uint16Array(m.vertexBatchIds),e._batchIds=new Uint16Array(m.batchIds),aLe(e),e._ready=!0}).catch(m=>{e.isDestroyed()||(e._error=m)}):void 0}}function aLe(e){c(e._primitive)||(e._primitive=new MS({batchTable:e._batchTable,positions:e._positions,batchIds:e._batchIds,vertexBatchIds:e._vertexBatchIds,indices:e._indices,indexOffsets:e._indexOffsets,indexCounts:e._indexCounts,batchedIndices:e._batchedIndices,boundingVolume:e._boundingVolume,boundingVolumes:e._boundingVolumes,center:e._center,pickObject:y(e._pickObject,e)}),e._boxes=void 0,e._boxBatchIds=void 0,e._cylinders=void 0,e._cylinderBatchIds=void 0,e._ellipsoids=void 0,e._ellipsoidBatchIds=void 0,e._spheres=void 0,e._sphereBatchIds=void 0,e._center=void 0,e._modelMatrix=void 0,e._batchTable=void 0,e._boundingVolume=void 0,e._boundingVolumes=void 0,e._batchedIndices=void 0,e._indices=void 0,e._indexOffsets=void 0,e._indexCounts=void 0,e._positions=void 0,e._vertexBatchIds=void 0,e._batchIds=void 0,e._batchTableColors=void 0,e._packedBuffer=void 0,e._verticesPromise=void 0)}Ul.prototype.createFeatures=function(e,t){this._primitive.createFeatures(e,t)};Ul.prototype.applyDebugSettings=function(e,t){this._primitive.applyDebugSettings(e,t)};Ul.prototype.applyStyle=function(e,t){this._primitive.applyStyle(e,t)};Ul.prototype.updateCommands=function(e,t){this._primitive.updateCommands(e,t)};Ul.prototype.update=function(e){if(!this._ready){if(c(this._promise)||(this._promise=sLe(this)),c(this._error)){let t=this._error;throw this._error=void 0,t}return}this._primitive.debugWireframe=this.debugWireframe,this._primitive.forceRebatch=this.forceRebatch,this._primitive.classificationType=this.classificationType,this._primitive.update(e)};Ul.prototype.isDestroyed=function(){return!1};Ul.prototype.destroy=function(){return this._primitive=this._primitive&&this._primitive.destroy(),de(this)};var c0=Ul;function mh(e,t,n,i,o){this._tileset=e,this._tile=t,this._resource=n,this._geometries=void 0,this._metadata=void 0,this._batchTable=void 0,this._features=void 0,this.featurePropertiesDirty=!1,this._group=void 0,this._ready=!1,uLe(this,i,o)}Object.defineProperties(mh.prototype,{featuresLength:{get:function(){return c(this._batchTable)?this._batchTable.featuresLength:0}},pointsLength:{get:function(){return 0}},trianglesLength:{get:function(){return c(this._geometries)?this._geometries.trianglesLength:0}},geometryByteLength:{get:function(){return c(this._geometries)?this._geometries.geometryByteLength:0}},texturesByteLength:{get:function(){return 0}},batchTableByteLength:{get:function(){return c(this._batchTable)?this._batchTable.batchTableByteLength:0}},innerContents:{get:function(){}},ready:{get:function(){return this._ready}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){return this._resource.getUrlComponent(!0)}},metadata:{get:function(){return this._metadata},set:function(e){this._metadata=e}},batchTable:{get:function(){return this._batchTable}},group:{get:function(){return this._group},set:function(e){this._group=e}}});function cLe(e){return function(t,n){c(e._geometries)&&e._geometries.updateCommands(t,n)}}function lLe(e,t){let n,i,o,r,s,a=y(e.BOXES_LENGTH,0),l=y(e.CYLINDERS_LENGTH,0),u=y(e.ELLIPSOIDS_LENGTH,0),f=y(e.SPHERES_LENGTH,0);if(a>0&&c(e.BOX_BATCH_IDS)){let m=t.byteOffset+e.BOX_BATCH_IDS.byteOffset;n=new Uint16Array(t.buffer,m,a)}if(l>0&&c(e.CYLINDER_BATCH_IDS)){let m=t.byteOffset+e.CYLINDER_BATCH_IDS.byteOffset;i=new Uint16Array(t.buffer,m,l)}if(u>0&&c(e.ELLIPSOID_BATCH_IDS)){let m=t.byteOffset+e.ELLIPSOID_BATCH_IDS.byteOffset;o=new Uint16Array(t.buffer,m,u)}if(f>0&&c(e.SPHERE_BATCH_IDS)){let m=t.byteOffset+e.SPHERE_BATCH_IDS.byteOffset;r=new Uint16Array(t.buffer,m,f)}let d=c(n)||c(i)||c(o)||c(r),p=a>0&&!c(n)||l>0&&!c(i)||u>0&&!c(o)||f>0&&!c(r);if(d&&p)throw new ue("If one group of batch ids is defined, then all batch ids must be defined");if(!c(n)&&!c(i)&&!c(o)&&!c(r)){let m=0;if(!c(n)&&a>0)for(n=new Uint16Array(a),s=0;s<a;++s)n[s]=m++;if(!c(i)&&l>0)for(i=new Uint16Array(l),s=0;s<l;++s)i[s]=m++;if(!c(o)&&u>0)for(o=new Uint16Array(u),s=0;s<u;++s)o[s]=m++;if(!c(r)&&f>0)for(r=new Uint16Array(f),s=0;s<f;++s)r[s]=m++}return{boxes:n,cylinders:i,ellipsoids:o,spheres:r}}var l0=Uint32Array.BYTES_PER_ELEMENT;function uLe(e,t,n){n=y(n,0);let i=new Uint8Array(t),o=new DataView(t);n+=l0;let r=o.getUint32(n,!0);if(r!==1)throw new ue(`Only Geometry tile version 1 is supported.  Version ${r} is not.`);n+=l0;let s=o.getUint32(n,!0);if(n+=l0,s===0){e._ready=!0;return}let a=o.getUint32(n,!0);if(n+=l0,a===0)throw new ue("Feature table must have a byte length greater than zero");let l=o.getUint32(n,!0);n+=l0;let u=o.getUint32(n,!0);n+=l0;let f=o.getUint32(n,!0);n+=l0;let d=Ho(i,n,a);n+=a;let p=new Uint8Array(t,n,l);n+=l;let g,m;u>0&&(g=Ho(i,n,u),n+=u,f>0&&(m=new Uint8Array(t,n,f),m=new Uint8Array(m)));let b=y(d.BOXES_LENGTH,0),x=y(d.CYLINDERS_LENGTH,0),T=y(d.ELLIPSOIDS_LENGTH,0),C=y(d.SPHERES_LENGTH,0),S=b+x+T+C,v=new r0(e,S,g,m,cLe(e));if(e._batchTable=v,S===0)return;let D=e.tile.computedTransform,I;c(d.RTC_CENTER)&&(I=h.unpack(d.RTC_CENTER),k.multiplyByPoint(D,I,I));let L=lLe(d,p);if(b>0||x>0||T>0||C>0){let M,N,B,_;if(b>0){let w=p.byteOffset+d.BOXES.byteOffset;M=new Float32Array(p.buffer,w,c0.packedBoxLength*b)}if(x>0){let w=p.byteOffset+d.CYLINDERS.byteOffset;N=new Float32Array(p.buffer,w,c0.packedCylinderLength*x)}if(T>0){let w=p.byteOffset+d.ELLIPSOIDS.byteOffset;B=new Float32Array(p.buffer,w,c0.packedEllipsoidLength*T)}if(C>0){let w=p.byteOffset+d.SPHERES.byteOffset;_=new Float32Array(p.buffer,w,c0.packedSphereLength*C)}return e._geometries=new c0({boxes:M,boxBatchIds:L.boxes,cylinders:N,cylinderBatchIds:L.cylinders,ellipsoids:B,ellipsoidBatchIds:L.ellipsoids,spheres:_,sphereBatchIds:L.spheres,center:I,modelMatrix:D,batchTable:v,boundingVolume:e.tile.boundingVolume.boundingVolume}),e}return Promise.resolve(e)}function dne(e){let t=e.featuresLength;if(!c(e._features)&&t>0){let n=new Array(t);c(e._geometries)&&e._geometries.createFeatures(e,n),e._features=n}}mh.prototype.hasProperty=function(e,t){return this._batchTable.hasProperty(e,t)};mh.prototype.getFeature=function(e){let t=this.featuresLength;if(!c(e)||e<0||e>=t)throw new E(`batchId is required and between zero and featuresLength - 1 (${t-1}).`);return dne(this),this._features[e]};mh.prototype.applyDebugSettings=function(e,t){c(this._geometries)&&this._geometries.applyDebugSettings(e,t)};mh.prototype.applyStyle=function(e){dne(this),c(this._geometries)&&this._geometries.applyStyle(e,this._features)};mh.prototype.update=function(e,t){c(this._geometries)&&(this._geometries.classificationType=this._tileset.classificationType,this._geometries.debugWireframe=this._tileset.debugWireframe,this._geometries.update(t)),c(this._batchTable)&&this._geometries.ready&&(this._batchTable.update(e,t),this._ready=!0)};mh.prototype.pick=function(e,t,n){};mh.prototype.isDestroyed=function(){return!1};mh.prototype.destroy=function(){return this._geometries=this._geometries&&this._geometries.destroy(),this._batchTable=this._batchTable&&this._batchTable.destroy(),de(this)};var JU=mh;var QU={};QU.encode2D=function(e,t,n){let i=Math.pow(2,e);if(A.typeOf.number("level",e),A.typeOf.number("x",t),A.typeOf.number("y",n),e<1)throw new E("Hilbert level cannot be less than 1.");if(t<0||t>=i||n<0||n>=i)throw new E("Invalid coordinates for given level.");let o={x:t,y:n},r,s,a,l=BigInt(0);for(a=i/2;a>0;a/=2)r=(o.x&a)>0?1:0,s=(o.y&a)>0?1:0,l+=BigInt((3*r^s)*a*a),hne(i,o,r,s);return l};QU.decode2D=function(e,t){if(A.typeOf.number("level",e),A.typeOf.bigint("index",t),e<1)throw new E("Hilbert level cannot be less than 1.");if(t<BigInt(0)||t>=BigInt(Math.pow(4,e)))throw new E("Hilbert index exceeds valid maximum for given level.");let n=Math.pow(2,e),i={x:0,y:0},o,r,s,a;for(s=1,a=t;s<n;s*=2)o=1&Number(a/BigInt(2)),r=1&Number(a^BigInt(o)),hne(s,i,o,r),i.x+=s*o,i.y+=s*r,a/=BigInt(4);return[i.x,i.y]};function hne(e,t,n,i){if(i!==0)return;n===1&&(t.x=e-1-t.x,t.y=e-1-t.y);let o=t.x;t.x=t.y,t.y=o}var _O=QU;var B_=30,fLe=1<<B_,dLe=1<<B_+1>>>0,ez=2*B_+1,L_=4,_ne=[],gne=[],hLe=[[0,1,3,2],[0,2,3,1],[3,2,0,1],[3,1,0,2]],N_=1,oT=2,gO=[N_,0,0,N_|oT];function tr(e){if(!zt.supportsBigInt())throw new ue("S2 required BigInt support");if(!c(e))throw new E("cell ID is required.");if(!tr.isValidId(e))throw new E("cell ID is invalid.");this._cellId=e,this._level=tr.getLevel(e)}tr.fromToken=function(e){if(A.typeOf.string("token",e),!tr.isValidToken(e))throw new E("token is invalid.");return new tr(tr.getIdFromToken(e))};tr.isValidId=function(e){return A.typeOf.bigint("cellId",e),!(e<=0||e>>BigInt(ez)>5||!(e&~e+BigInt(1)&BigInt("0x1555555555555555")))};tr.isValidToken=function(e){return A.typeOf.string("token",e),/^[0-9a-fA-F]{1,16}$/.test(e)?tr.isValidId(tr.getIdFromToken(e)):!1};tr.getIdFromToken=function(e){return A.typeOf.string("token",e),BigInt("0x"+e+"0".repeat(16-e.length))};tr.getTokenFromId=function(e){A.typeOf.bigint("cellId",e);let t=Math.floor(CLe(e)/4),n=e.toString(16).replace(/0*$/,"");return Array(17-t-n.length).join("0")+n};tr.getLevel=function(e){if(A.typeOf.bigint("cellId",e),!tr.isValidId(e))throw new E;let t=0;for(;e!==BigInt(0)&&!(e&BigInt(1));)t++,e=e>>BigInt(1);return B_-(t>>1)};tr.prototype.getChild=function(e){if(A.typeOf.number("index",e),e<0||e>3)throw new E("child index must be in the range [0-3].");if(this._level===30)throw new E("cannot get child of leaf cell.");let t=xne(this._cellId)>>BigInt(2),n=this._cellId+BigInt(2*e+1-4)*t;return new tr(n)};tr.prototype.getParent=function(){if(this._level===0)throw new E("cannot get parent of root cell.");let e=xne(this._cellId)<<BigInt(2);return new tr(this._cellId&~e+BigInt(1)|e)};tr.prototype.getParentAtLevel=function(e){if(this._level===0||e<0||this._level<e)throw new E("cannot get parent at invalid level.");let t=TLe(e);return new tr(this._cellId&-t|t)};tr.prototype.getCenter=function(e){e=y(e,ie.WGS84);let t=mLe(this._cellId,this._level);t=h.normalize(t,t);let n=new he.fromCartesian(t,ie.UNIT_SPHERE);return he.toCartesian(n,e,new h)};tr.prototype.getVertex=function(e,t){if(A.typeOf.number("index",e),e<0||e>3)throw new E("vertex index must be in the range [0-3].");t=y(t,ie.WGS84);let n=pLe(this._cellId,this._level,e);n=h.normalize(n,n);let i=new he.fromCartesian(n,ie.UNIT_SPHERE);return he.toCartesian(i,t,new h)};tr.fromFacePositionLevel=function(e,t,n){if(A.typeOf.bigint("position",t),e<0||e>5)throw new E("Invalid S2 Face (must be within 0-5)");if(n<0||n>B_)throw new E("Invalid level (must be within 0-30)");if(t<0||t>=Math.pow(4,n))throw new E("Invalid Hilbert position for level");let i=(e<4?"0":"")+(e<2?"0":"")+e.toString(2),o=t.toString(2),r=Array(2*n-o.length+1).join("0"),s=Array(ez-2*n).join("0"),a=BigInt(`0b${i}${r}${o}1${s}`);return new tr(a)};function mLe(e,t){let n=_Le(e,t);return gLe(n[0],n[1],n[2])}function pLe(e,t,n){let i=yne(e,t),o=yLe([i[1],i[2]],t),r=n>>1&1;return bne(i[0],o[0][r^n&1],o[1][r])}function _Le(e,t){let n=yne(e),i=n[0],o=n[1],r=n[2],s=t===30,a=!s&&(BigInt(o)^e>>BigInt(2))&BigInt(1),l=s?1:a?2:0,u=(o<<1)+l,f=(r<<1)+l;return[i,u,f]}function yne(e){_ne.length===0&&xLe();let t=Number(e>>BigInt(ez)),n=t&N_,i=(1<<L_)-1,o=0,r=0;for(let s=7;s>=0;s--){let l=(1<<2*(s===7?B_-7*L_:L_))-1;n+=Number(e>>BigInt(s*2*L_+1)&BigInt(l))<<2,n=gne[n];let u=s*L_;o+=n>>L_+2<<u,r+=(n>>2&i)<<u,n&=N_|oT}return[t,o,r]}function gLe(e,t,n){let i=mne(t),o=mne(n),r=yO(i),s=yO(o);return bne(e,r,s)}function bne(e,t,n){switch(e){case 0:return new h(1,t,n);case 1:return new h(-t,1,n);case 2:return new h(-t,-n,1);case 3:return new h(-1,-n,-t);case 4:return new h(n,-1,-t);default:return new h(n,t,-1)}}function yO(e){return e>=.5?1/3*(4*e*e-1):1/3*(1-4*(1-e)*(1-e))}function mne(e){return 1/dLe*e}function yLe(e,t){let n=[[],[]],i=bLe(t);for(let o=0;o<2;++o){let r=e[o]&-i,s=r+i;n[o][0]=yO(pne(r)),n[o][1]=yO(pne(s))}return n}function bLe(e){return 1<<B_-e>>>0}function pne(e){return 1/fLe*e}function F_(e,t,n,i,o,r){if(e===L_){let s=(t<<L_)+n;_ne[(s<<2)+i]=(o<<2)+r,gne[(o<<2)+i]=(s<<2)+r}else{e++,t<<=1,n<<=1,o<<=2;let s=hLe[r];F_(e,t+(s[0]>>1),n+(s[0]&1),i,o,r^gO[0]),F_(e,t+(s[1]>>1),n+(s[1]&1),i,o+1,r^gO[1]),F_(e,t+(s[2]>>1),n+(s[2]&1),i,o+2,r^gO[2]),F_(e,t+(s[3]>>1),n+(s[3]&1),i,o+3,r^gO[3])}}function xLe(){F_(0,0,0,0,0,0),F_(0,0,0,N_,0,N_),F_(0,0,0,oT,0,oT),F_(0,0,0,N_|oT,0,N_|oT)}function xne(e){return e&~e+BigInt(1)}function TLe(e){return BigInt(1)<<BigInt(2*(B_-e))}var ALe=[64,0,1,39,2,15,40,23,3,12,16,59,41,19,24,54,4,64,13,10,17,62,60,28,42,30,20,51,25,44,55,47,5,32,65,38,14,22,11,58,18,53,63,9,61,27,29,50,43,46,31,37,21,57,52,8,26,49,45,36,56,7,48,35,6,34,33,0];function CLe(e){return ALe[(-e&e)%BigInt(67)]}var u0=tr;function ELe(e,t){return c(e)&&c(e.extensions)&&c(e.extensions[t])}var si=ELe;function tz(e){let t=e.lengthBits,n=e.availableCount;A.typeOf.number("options.lengthBits",t);let i=e.constant,o=e.bitstream;if(c(i))n=t;else{let r=Math.ceil(t/8);if(o.length!==r)throw new ue(`Availability bitstream must be exactly ${r} bytes long to store ${t} bits. Actual bitstream was ${o.length} bytes long.`);let s=y(e.computeAvailableCountEnabled,!1);!c(n)&&s&&(n=SLe(o,t))}this._lengthBits=t,this._availableCount=n,this._constant=i,this._bitstream=o}function SLe(e,t){let n=0;for(let i=0;i<t;i++){let o=i>>3,r=i%8;n+=e[o]>>r&1}return n}Object.defineProperties(tz.prototype,{lengthBits:{get:function(){return this._lengthBits}},availableCount:{get:function(){return this._availableCount}}});tz.prototype.getBit=function(e){if(e<0||e>=this._lengthBits)throw new E("Bit index out of bounds.");if(c(this._constant))return this._constant;let t=e>>3,n=e%8;return(this._bitstream[t]>>n&1)===1};var bO=tz;function Km(e){e=y(e,y.EMPTY_OBJECT);let t=e.metadataTable,n=e.class,i=e.entityId,o=e.propertyTableJson;A.typeOf.object("options.metadataTable",t),A.typeOf.object("options.class",n),A.typeOf.number("options.entityId",i),A.typeOf.object("options.propertyTableJson",o),this._class=n,this._metadataTable=t,this._entityId=i,this._extensions=o.extensions,this._extras=o.extras}Object.defineProperties(Km.prototype,{class:{get:function(){return this._class}},extras:{get:function(){return this._extras}},extensions:{get:function(){return this._extensions}}});Km.prototype.hasProperty=function(e){return this._metadataTable.hasProperty(e)};Km.prototype.hasPropertyBySemantic=function(e){return this._metadataTable.hasPropertyBySemantic(e)};Km.prototype.getPropertyIds=function(e){return this._metadataTable.getPropertyIds(e)};Km.prototype.getProperty=function(e){return this._metadataTable.getProperty(this._entityId,e)};Km.prototype.setProperty=function(e,t){return this._metadataTable.setProperty(this._entityId,e,t)};Km.prototype.getPropertyBySemantic=function(e){return this._metadataTable.getPropertyBySemantic(this._entityId,e)};Km.prototype.setPropertyBySemantic=function(e,t){return this._metadataTable.setPropertyBySemantic(this._entityId,e,t)};var xO=Km;var TO={QUADTREE:"QUADTREE",OCTREE:"OCTREE"};TO.getBranchingFactor=function(e){switch(e){case TO.OCTREE:return 8;case TO.QUADTREE:return 4;default:throw new E("subdivisionScheme is not a valid value.")}};var _r=Object.freeze(TO);function qs(){}Object.defineProperties(qs.prototype,{class:{get:function(){E.throwInstantiationError()}}});qs.prototype.hasProperty=function(e){E.throwInstantiationError()};qs.prototype.hasPropertyBySemantic=function(e){E.throwInstantiationError()};qs.prototype.getPropertyIds=function(e){E.throwInstantiationError()};qs.prototype.getProperty=function(e){E.throwInstantiationError()};qs.prototype.setProperty=function(e,t){E.throwInstantiationError()};qs.prototype.getPropertyBySemantic=function(e){E.throwInstantiationError()};qs.prototype.setPropertyBySemantic=function(e,t){E.throwInstantiationError()};qs.hasProperty=function(e,t,n){if(A.typeOf.string("propertyId",e),A.typeOf.object("properties",t),A.typeOf.object("classDefinition",n),c(t[e]))return!0;let i=n.properties;if(!c(i))return!1;let o=i[e];return!!(c(o)&&c(o.default))};qs.hasPropertyBySemantic=function(e,t,n){A.typeOf.string("semantic",e),A.typeOf.object("properties",t),A.typeOf.object("classDefinition",n);let i=n.propertiesBySemantic;if(!c(i))return!1;let o=i[e];return c(o)};qs.getPropertyIds=function(e,t,n){A.typeOf.object("properties",e),A.typeOf.object("classDefinition",t),n=c(n)?n:[],n.length=0;for(let o in e)e.hasOwnProperty(o)&&c(e[o])&&n.push(o);let i=t.properties;if(c(i))for(let o in i)i.hasOwnProperty(o)&&!c(e[o])&&c(i[o].default)&&n.push(o);return n};qs.getProperty=function(e,t,n){if(A.typeOf.string("propertyId",e),A.typeOf.object("properties",t),A.typeOf.object("classDefinition",n),!c(n.properties[e]))throw new E(`Class definition missing property ${e}`);let i=n.properties[e],o=t[e];Array.isArray(o)&&(o=o.slice());let r=!0;if(o=i.handleNoData(o),!c(o)&&c(i.default))return o=qe(i.default,!0),i.unpackVectorAndMatrixTypes(o,r);if(c(o))return o=i.normalize(o),o=i.applyValueTransform(o),i.unpackVectorAndMatrixTypes(o,r)};qs.setProperty=function(e,t,n,i){if(A.typeOf.string("propertyId",e),A.defined("value",t),A.typeOf.object("properties",n),A.typeOf.object("classDefinition",i),!c(n[e]))return!1;Array.isArray(t)&&(t=t.slice());let o,r=i.properties;return c(r)&&(o=r[e]),c(o)&&(t=o.packVectorAndMatrixTypes(t,!0),t=o.unapplyValueTransform(t),t=o.unnormalize(t)),n[e]=t,!0};qs.getPropertyBySemantic=function(e,t,n){A.typeOf.string("semantic",e),A.typeOf.object("properties",t),A.typeOf.object("classDefinition",n);let i=n.propertiesBySemantic;if(!c(i))return;let o=i[e];if(c(o))return qs.getProperty(o.id,t,n)};qs.setPropertyBySemantic=function(e,t,n,i){A.typeOf.string("semantic",e),A.defined("value",t),A.typeOf.object("properties",n),A.typeOf.object("classDefinition",i);let o=i.propertiesBySemantic;if(!c(o))return!1;let r=i.propertiesBySemantic[e];return c(r)?qs.setProperty(r.id,t,n,i):!1};var Bn=qs;function $m(e){e=y(e,y.EMPTY_OBJECT);let t=e.subtreeMetadata,n=e.class;A.typeOf.object("options.subtreeMetadata",t),A.typeOf.object("options.class",n);let i=c(t.properties)?t.properties:{};this._class=n,this._properties=i,this._extras=t.extras,this._extensions=t.extensions}Object.defineProperties($m.prototype,{class:{get:function(){return this._class}},extras:{get:function(){return this._extras}},extensions:{get:function(){return this._extensions}}});$m.prototype.hasProperty=function(e){return Bn.hasProperty(e,this._properties,this._class)};$m.prototype.hasPropertyBySemantic=function(e){return Bn.hasPropertyBySemantic(e,this._properties,this._class)};$m.prototype.getPropertyIds=function(e){return Bn.getPropertyIds(this._properties,this._class,e)};$m.prototype.getProperty=function(e){return Bn.getProperty(e,this._properties,this._class)};$m.prototype.setProperty=function(e,t){return Bn.setProperty(e,t,this._properties,this._class)};$m.prototype.getPropertyBySemantic=function(e){return Bn.getPropertyBySemantic(e,this._properties,this._class)};$m.prototype.setPropertyBySemantic=function(e,t){return Bn.setPropertyBySemantic(e,t,this._properties,this._class)};var nz=$m;var Nt={INT8:"INT8",UINT8:"UINT8",INT16:"INT16",UINT16:"UINT16",INT32:"INT32",UINT32:"UINT32",INT64:"INT64",UINT64:"UINT64",FLOAT32:"FLOAT32",FLOAT64:"FLOAT64"};Nt.getMinimum=function(e){switch(A.typeOf.string("type",e),e){case Nt.INT8:return-128;case Nt.UINT8:return 0;case Nt.INT16:return-32768;case Nt.UINT16:return 0;case Nt.INT32:return-2147483648;case Nt.UINT32:return 0;case Nt.INT64:return zt.supportsBigInt()?BigInt("-9223372036854775808"):-Math.pow(2,63);case Nt.UINT64:return zt.supportsBigInt()?BigInt(0):0;case Nt.FLOAT32:return-34028234663852886e22;case Nt.FLOAT64:return-Number.MAX_VALUE}};Nt.getMaximum=function(e){switch(A.typeOf.string("type",e),e){case Nt.INT8:return 127;case Nt.UINT8:return 255;case Nt.INT16:return 32767;case Nt.UINT16:return 65535;case Nt.INT32:return 2147483647;case Nt.UINT32:return 4294967295;case Nt.INT64:return zt.supportsBigInt()?BigInt("9223372036854775807"):Math.pow(2,63)-1;case Nt.UINT64:return zt.supportsBigInt()?BigInt("18446744073709551615"):Math.pow(2,64)-1;case Nt.FLOAT32:return 34028234663852886e22;case Nt.FLOAT64:return Number.MAX_VALUE}};Nt.isIntegerType=function(e){switch(A.typeOf.string("type",e),e){case Nt.INT8:case Nt.UINT8:case Nt.INT16:case Nt.UINT16:case Nt.INT32:case Nt.UINT32:case Nt.INT64:case Nt.UINT64:return!0;default:return!1}};Nt.isUnsignedIntegerType=function(e){switch(A.typeOf.string("type",e),e){case Nt.UINT8:case Nt.UINT16:case Nt.UINT32:case Nt.UINT64:return!0;default:return!1}};Nt.isVectorCompatible=function(e){switch(A.typeOf.string("type",e),e){case Nt.INT8:case Nt.UINT8:case Nt.INT16:case Nt.UINT16:case Nt.INT32:case Nt.UINT32:case Nt.FLOAT32:case Nt.FLOAT64:return!0;default:return!1}};Nt.normalize=function(e,t){if(typeof e!="number"&&typeof e!="bigint")throw new E("value must be a number or a BigInt");if(!Nt.isIntegerType(t))throw new E("type must be an integer type");return Math.max(Number(e)/Number(Nt.getMaximum(t)),-1)};Nt.unnormalize=function(e,t){if(A.typeOf.number("value",e),!Nt.isIntegerType(t))throw new E("type must be an integer type");let n=Nt.getMaximum(t),i=Nt.isUnsignedIntegerType(t)?0:-n;return e=R.sign(e)*Math.round(Math.abs(e)*Number(n)),(t===Nt.INT64||t===Nt.UINT64)&&zt.supportsBigInt()&&(e=BigInt(e)),e>n?n:e<i?i:e};Nt.applyValueTransform=function(e,t,n){return n*e+t};Nt.unapplyValueTransform=function(e,t,n){return n===0?0:(e-t)/n};Nt.getSizeInBytes=function(e){switch(A.typeOf.string("type",e),e){case Nt.INT8:case Nt.UINT8:return 1;case Nt.INT16:case Nt.UINT16:return 2;case Nt.INT32:case Nt.UINT32:return 4;case Nt.INT64:case Nt.UINT64:return 8;case Nt.FLOAT32:return 4;case Nt.FLOAT64:return 8}};Nt.fromComponentDatatype=function(e){switch(A.typeOf.number("componentDatatype",e),e){case $.BYTE:return Nt.INT8;case $.UNSIGNED_BYTE:return Nt.UINT8;case $.SHORT:return Nt.INT16;case $.UNSIGNED_SHORT:return Nt.UINT16;case $.INT:return Nt.INT32;case $.UNSIGNED_INT:return Nt.UINT32;case $.FLOAT:return Nt.FLOAT32;case $.DOUBLE:return Nt.FLOAT64}};Nt.toComponentDatatype=function(e){switch(A.typeOf.string("type",e),e){case Nt.INT8:return $.BYTE;case Nt.UINT8:return $.UNSIGNED_BYTE;case Nt.INT16:return $.SHORT;case Nt.UINT16:return $.UNSIGNED_SHORT;case Nt.INT32:return $.INT;case Nt.UINT32:return $.UNSIGNED_INT;case Nt.FLOAT32:return $.FLOAT;case Nt.FLOAT64:return $.DOUBLE}};var Gt=Object.freeze(Nt);var Io={SCALAR:"SCALAR",VEC2:"VEC2",VEC3:"VEC3",VEC4:"VEC4",MAT2:"MAT2",MAT3:"MAT3",MAT4:"MAT4",BOOLEAN:"BOOLEAN",STRING:"STRING",ENUM:"ENUM"};Io.isVectorType=function(e){switch(A.typeOf.string("type",e),e){case Io.VEC2:case Io.VEC3:case Io.VEC4:return!0;default:return!1}};Io.isMatrixType=function(e){switch(A.typeOf.string("type",e),e){case Io.MAT2:case Io.MAT3:case Io.MAT4:return!0;default:return!1}};Io.getComponentCount=function(e){switch(A.typeOf.string("type",e),e){case Io.SCALAR:case Io.STRING:case Io.ENUM:case Io.BOOLEAN:return 1;case Io.VEC2:return 2;case Io.VEC3:return 3;case Io.VEC4:return 4;case Io.MAT2:return 4;case Io.MAT3:return 9;case Io.MAT4:return 16;default:throw new E(`Invalid metadata type ${e}`)}};Io.getMathType=function(e){switch(e){case Io.VEC2:return H;case Io.VEC3:return h;case Io.VEC4:return se;case Io.MAT2:return Gi;case Io.MAT3:return Q;case Io.MAT4:return k;default:return}};var Et=Object.freeze(Io);function la(e){e=y(e,y.EMPTY_OBJECT);let t=e.id,n=e.type;A.typeOf.string("options.id",t),A.typeOf.string("options.type",n);let i=e.componentType,o=e.enumType,r=c(i)&&Gt.isIntegerType(i)&&y(e.normalized,!1);this._id=t,this._name=e.name,this._description=e.description,this._semantic=e.semantic,this._isLegacyExtension=e.isLegacyExtension,this._type=n,this._componentType=i,this._enumType=o,this._valueType=c(o)?o.valueType:i,this._isArray=y(e.isArray,!1),this._isVariableLengthArray=y(e.isVariableLengthArray,!1),this._arrayLength=e.arrayLength,this._min=qe(e.min,!0),this._max=qe(e.max,!0),this._normalized=r;let s=qe(e.offset,!0),a=qe(e.scale,!0),l=c(s)||c(a),u=!0;c(s)||(s=this.expandConstant(0,u)),c(a)||(a=this.expandConstant(1,u)),this._offset=s,this._scale=a,this._hasValueTransform=l,this._noData=qe(e.noData,!0),this._default=qe(e.default,!0),this._required=y(e.required,!0),this._extras=qe(e.extras,!0),this._extensions=qe(e.extensions,!0)}la.fromJson=function(e){e=y(e,y.EMPTY_OBJECT);let t=e.id,n=e.property;A.typeOf.string("options.id",t),A.typeOf.object("options.property",n),A.typeOf.string("options.property.type",n.type);let i=wLe(n),o=vLe(n,e.enums),r;return c(i)?i?r=c(n.optional)?!n.optional:!0:r=y(n.required,!1):r=!1,new la({id:t,type:o.type,componentType:o.componentType,enumType:o.enumType,isArray:o.isArray,isVariableLengthArray:o.isVariableLengthArray,arrayLength:o.arrayLength,normalized:n.normalized,min:n.min,max:n.max,offset:n.offset,scale:n.scale,noData:n.noData,default:n.default,required:r,name:n.name,description:n.description,semantic:n.semantic,extras:n.extras,extensions:n.extensions,isLegacyExtension:i})};Object.defineProperties(la.prototype,{id:{get:function(){return this._id}},name:{get:function(){return this._name}},description:{get:function(){return this._description}},type:{get:function(){return this._type}},enumType:{get:function(){return this._enumType}},componentType:{get:function(){return this._componentType}},valueType:{get:function(){return this._valueType}},isArray:{get:function(){return this._isArray}},isVariableLengthArray:{get:function(){return this._isVariableLengthArray}},arrayLength:{get:function(){return this._arrayLength}},normalized:{get:function(){return this._normalized}},max:{get:function(){return this._max}},min:{get:function(){return this._min}},noData:{get:function(){return this._noData}},default:{get:function(){return this._default}},required:{get:function(){return this._required}},semantic:{get:function(){return this._semantic}},hasValueTransform:{get:function(){return this._hasValueTransform}},offset:{get:function(){return this._offset}},scale:{get:function(){return this._scale}},extras:{get:function(){return this._extras}},extensions:{get:function(){return this._extensions}}});function wLe(e){if(e.type==="ARRAY")return!0;let t=e.type;if(t===Et.SCALAR||Et.isMatrixType(t)||Et.isVectorType(t))return!1;if(c(Gt[t]))return!0;if(c(e.noData)||c(e.scale)||c(e.offset)||c(e.required)||c(e.count)||c(e.array)||c(e.optional))return!1}function vLe(e,t){let n=e.type,i=e.componentType,o=n==="ARRAY",r,s,a;o?(r=!0,s=e.componentCount,a=!c(s)):e.array?(r=!0,s=e.count,a=!c(e.count)):(r=!1,s=void 0,a=!1);let l;if(c(e.enumType)&&(l=t[e.enumType]),n===Et.ENUM)return{type:n,componentType:void 0,enumType:l,valueType:l.valueType,isArray:r,isVariableLengthArray:a,arrayLength:s};if(o&&i===Et.ENUM)return{type:i,componentType:void 0,enumType:l,valueType:l.valueType,isArray:r,isVariableLengthArray:a,arrayLength:s};if(n===Et.SCALAR||Et.isMatrixType(n)||Et.isVectorType(n))return{type:n,componentType:i,enumType:void 0,valueType:i,isArray:r,isVariableLengthArray:a,arrayLength:s};if(n===Et.BOOLEAN||n===Et.STRING)return{type:n,componentType:void 0,enumType:void 0,valueType:void 0,isArray:r,isVariableLengthArray:a,arrayLength:s};if(o&&(i===Et.BOOLEAN||i===Et.STRING))return{type:i,componentType:void 0,enumType:void 0,valueType:void 0,isArray:r,isVariableLengthArray:a,arrayLength:s};if(c(i)&&c(Gt[i]))return{type:Et.SCALAR,componentType:i,enumType:void 0,valueType:i,isArray:r,isVariableLengthArray:a,arrayLength:s};if(c(Gt[n]))return{type:Et.SCALAR,componentType:n,enumType:void 0,valueType:n,isArray:r,isVariableLengthArray:a,arrayLength:s};throw new E(`unknown metadata type {type: ${n}, componentType: ${i})`)}la.prototype.normalize=function(e){return this._normalized?iz(e,this._valueType,Gt.normalize):e};la.prototype.unnormalize=function(e){return this._normalized?iz(e,this._valueType,Gt.unnormalize):e};la.prototype.applyValueTransform=function(e){return!this._hasValueTransform||this._isVariableLengthArray?e:la.valueTransformInPlace(e,this._offset,this._scale,Gt.applyValueTransform)};la.prototype.unapplyValueTransform=function(e){return!this._hasValueTransform||this._isVariableLengthArray?e:la.valueTransformInPlace(e,this._offset,this._scale,Gt.unapplyValueTransform)};la.prototype.expandConstant=function(e,t){t=y(t,!1);let n=this._isArray,i=this._arrayLength,o=Et.getComponentCount(this._type),r=n&&o>1;if(!n&&o===1)return e;if(!n)return new Array(o).fill(e);if(!r)return new Array(i).fill(e);if(!t)return new Array(this._arrayLength*o).fill(e);let s=new Array(o).fill(e);return new Array(this._arrayLength).fill(s)};la.prototype.handleNoData=function(e){let t=this._noData;if(!c(t))return e;if(!Ene(e,t))return e};function Ene(e,t){if(!Array.isArray(e))return e===t;if(!Array.isArray(t)||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!Ene(e[n],t[n]))return!1;return!0}la.prototype.unpackVectorAndMatrixTypes=function(e,t){t=y(t,!1);let n=Et.getMathType(this._type),i=this._isArray,o=Et.getComponentCount(this._type),r=i&&o>1;return c(n)?t&&r?e.map(function(s){return n.unpack(s)}):i?n.unpackArray(e):n.unpack(e):e};la.prototype.packVectorAndMatrixTypes=function(e,t){t=y(t,!1);let n=Et.getMathType(this._type),i=this._isArray,o=Et.getComponentCount(this._type),r=i&&o>1;return c(n)?t&&r?e.map(function(s){return n.pack(s,[])}):i?n.packArray(e,[]):n.pack(e,[]):e};la.prototype.validate=function(e){if(!(!c(e)&&c(this._default)))return this._required&&!c(e)?"required property must have a value":this._isArray?DLe(this,e):Sne(this,e)};function DLe(e,t){if(!Array.isArray(t))return`value ${t} must be an array`;let n=t.length;if(!e._isVariableLengthArray&&n!==e._arrayLength)return"Array length does not match property.arrayLength";for(let i=0;i<n;i++){let o=Sne(e,t[i]);if(c(o))return o}}function Sne(e,t){let n=e._type,i=e._componentType,o=e._enumType,r=e._normalized;return Et.isVectorType(n)?PLe(t,n,i):Et.isMatrixType(n)?ILe(t,n,i):n===Et.STRING?OLe(t):n===Et.BOOLEAN?RLe(t):n===Et.ENUM?MLe(t,o):LLe(t,i,r)}function PLe(e,t,n){if(!Gt.isVectorCompatible(n))return`componentType ${n} is incompatible with vector type ${t}`;if(t===Et.VEC2&&!(e instanceof H))return`vector value ${e} must be a Cartesian2`;if(t===Et.VEC3&&!(e instanceof h))return`vector value ${e} must be a Cartesian3`;if(t===Et.VEC4&&!(e instanceof se))return`vector value ${e} must be a Cartesian4`}function ILe(e,t,n){if(!Gt.isVectorCompatible(n))return`componentType ${n} is incompatible with matrix type ${t}`;if(t===Et.MAT2&&!(e instanceof Gi))return`matrix value ${e} must be a Matrix2`;if(t===Et.MAT3&&!(e instanceof Q))return`matrix value ${e} must be a Matrix3`;if(t===Et.MAT4&&!(e instanceof k))return`matrix value ${e} must be a Matrix4`}function OLe(e){if(typeof e!="string")return AO(e,Et.STRING)}function RLe(e){if(typeof e!="boolean")return AO(e,Et.BOOLEAN)}function MLe(e,t){let n=typeof e;if(c(t))return n!=="string"||!c(t.valuesByName[e])?`value ${e} is not a valid enum name for ${t.id}`:void 0}function LLe(e,t,n){let i=typeof e;switch(t){case Gt.INT8:case Gt.UINT8:case Gt.INT16:case Gt.UINT16:case Gt.INT32:case Gt.UINT32:case Gt.FLOAT32:case Gt.FLOAT64:return i!=="number"?AO(e,t):isFinite(e)?Ane(e,t,n):Cne(e,t);case Gt.INT64:case Gt.UINT64:return i!=="number"&&i!=="bigint"?AO(e,t):i==="number"&&!isFinite(e)?Cne(e,t):Ane(e,t,n)}}function AO(e,t){return`value ${e} does not match type ${t}`}function Tne(e,t,n){let i=`value ${e} is out of range for type ${t}`;return n&&(i+=" (normalized)"),i}function Ane(e,t,n){if(n){let i=Gt.isUnsignedIntegerType(t)?0:-1;return e<i||e>1?Tne(e,t,n):void 0}if(e<Gt.getMinimum(t)||e>Gt.getMaximum(t))return Tne(e,t,n)}function Cne(e,t){return`value ${e} of type ${t} must be finite`}function iz(e,t,n){if(!Array.isArray(e))return n(e,t);for(let i=0;i<e.length;i++)e[i]=iz(e[i],t,n);return e}la.valueTransformInPlace=function(e,t,n,i){if(!Array.isArray(e))return i(e,t,n);for(let o=0;o<e.length;o++)e[o]=la.valueTransformInPlace(e[o],t[o],n[o],i);return e};var rT=la;function LS(e){e=y(e,y.EMPTY_OBJECT);let t=e.count,n=e.property,i=e.classProperty,o=e.bufferViews;A.typeOf.number.greaterThan("options.count",t,0),A.typeOf.object("options.property",n),A.typeOf.object("options.classProperty",i),A.typeOf.object("options.bufferViews",o);let r=i.type,s=i.isArray,a=i.isVariableLengthArray,l=i.valueType,u=i.enumType,f=r===Et.STRING,d=r===Et.BOOLEAN,p=0,g;if(a){let _=y(n.arrayOffsetType,n.offsetType);_=y(Gt[_],Gt.UINT32);let w=y(n.arrayOffsets,n.arrayOffsetBufferView);g=new oz(o[w],_,t+1),p+=g.typedArray.byteLength}let m=Et.getComponentCount(r),b;a?b=g.get(t)-g.get(0):s?b=t*i.arrayLength:b=t;let x=m*b,T;if(f){let _=y(n.stringOffsetType,n.offsetType);_=y(Gt[_],Gt.UINT32);let w=y(n.stringOffsets,n.stringOffsetBufferView);T=new oz(o[w],_,x+1),p+=T.typedArray.byteLength}(f||d)&&(l=Gt.UINT8);let C;f?C=T.get(x)-T.get(0):d?C=Math.ceil(x/8):C=x;let S=y(n.values,n.bufferView),v=new oz(o[S],l,C);p+=v.typedArray.byteLength;let D=n.offset,I=n.scale,L=i.hasValueTransform||c(D)||c(I);D=y(D,i.offset),I=y(I,i.scale),D=wne(D),I=wne(I);let M,N,B=this;f?M=function(_){return BLe(_,B._values,B._stringOffsets)}:d?(M=function(_){return kLe(_,B._values)},N=function(_,w){VLe(_,B._values,w)}):c(u)?(M=function(_){let w=B._values.get(_);return u.namesByValue[w]},N=function(_,w){let P=u.valuesByName[w];B._values.set(_,P)}):(M=function(_){return B._values.get(_)},N=function(_,w){B._values.set(_,w)}),this._arrayOffsets=g,this._stringOffsets=T,this._values=v,this._classProperty=i,this._count=t,this._vectorComponentCount=m,this._min=n.min,this._max=n.max,this._offset=D,this._scale=I,this._hasValueTransform=L,this._getValue=M,this._setValue=N,this._unpackedValues=void 0,this._extras=n.extras,this._extensions=n.extensions,this._byteLength=p}Object.defineProperties(LS.prototype,{hasValueTransform:{get:function(){return this._hasValueTransform}},offset:{get:function(){return this._offset}},scale:{get:function(){return this._scale}},extras:{get:function(){return this._extras}},extensions:{get:function(){return this._extensions}},byteLength:{get:function(){return this._byteLength}}});LS.prototype.get=function(e){vne(this,e);let t=NLe(this,e);return t=this._classProperty.handleNoData(t),c(t)?(t=this._classProperty.normalize(t),t=YLe(this,t),this._classProperty.unpackVectorAndMatrixTypes(t)):(t=this._classProperty.default,this._classProperty.unpackVectorAndMatrixTypes(t))};LS.prototype.set=function(e,t){let n=this._classProperty;A.defined("value",t),vne(this,e);let i=n.validate(t);if(c(i))throw new E(i);t=n.packVectorAndMatrixTypes(t),t=XLe(this,t),t=n.unnormalize(t),FLe(this,e,t)};LS.prototype.getTypedArray=function(){if(c(this._values))return this._values.typedArray};function wne(e){if(!Array.isArray(e))return e;let t=[];for(let n=0;n<e.length;n++){let i=e[n];Array.isArray(i)?t.push.apply(t,i):t.push(i)}return t}function vne(e,t){let n=e._count;if(!c(t)||t<0||t>=n){let i=n-1;throw new E(`index is required and between zero and count - 1. Actual value: ${i}`)}}function NLe(e,t){Pne(e)&&Ine(e);let n=e._classProperty,i=n.isArray,o=n.type,r=Et.getComponentCount(o);if(c(e._unpackedValues)){let s=e._unpackedValues[t];return i?qe(s,!0):s}return!i&&r===1?e._getValue(t):Dne(e,n,t)}function Dne(e,t,n){let i,o;if(t.isVariableLengthArray){i=e._arrayOffsets.get(n),o=e._arrayOffsets.get(n+1)-i;let s=Et.getComponentCount(t.type);i*=s,o*=s}else{let a=y(t.arrayLength,1)*e._vectorComponentCount;i=n*a,o=a}let r=new Array(o);for(let s=0;s<o;s++)r[s]=e._getValue(i+s);return r}function FLe(e,t,n){WLe(e,t,n)&&Ine(e);let i=e._classProperty,o=i.isArray,r=i.type,s=Et.getComponentCount(r);if(c(e._unpackedValues)){i.isArray&&(n=qe(n,!0)),e._unpackedValues[t]=n;return}if(!o&&s===1){e._setValue(t,n);return}let a,l;if(i.isVariableLengthArray)a=e._arrayOffsets.get(t),l=e._arrayOffsets.get(t+1)-a;else{let f=y(i.arrayLength,1)*e._vectorComponentCount;a=t*f,l=f}for(let u=0;u<l;++u)e._setValue(a+u,n[u])}function BLe(e,t,n){let i=n.get(e),o=n.get(e+1)-i;return Gu(t.typedArray,i,o)}function kLe(e,t){let n=e>>3,i=e%8;return(t.typedArray[n]>>i&1)===1}function VLe(e,t,n){let i=e>>3,o=e%8;n?t.typedArray[i]|=1<<o:t.typedArray[i]&=~(1<<o)}function ULe(e,t){let n=t.dataView,i=e*8,o=0,r=(n.getUint8(i+7)&128)>0,s=!0;for(let a=0;a<8;++a){let l=n.getUint8(i+a);r&&(s?l!==0&&(l=~(l-1)&255,s=!1):l=~l&255),o+=l*Math.pow(256,a)}return r&&(o=-o),o}function zLe(e,t){let n=t.dataView,i=e*8,o=BigInt(0),r=(n.getUint8(i+7)&128)>0,s=!0;for(let a=0;a<8;++a){let l=n.getUint8(i+a);r&&(s?l!==0&&(l=~(l-1)&255,s=!1):l=~l&255),o+=BigInt(l)*(BigInt(1)<<BigInt(a*8))}return r&&(o=-o),o}function HLe(e,t){let n=t.dataView,i=e*8,o=n.getUint32(i,!0),r=n.getUint32(i+4,!0);return o+4294967296*r}function GLe(e,t){let n=t.dataView,i=e*8,o=BigInt(n.getUint32(i,!0)),r=BigInt(n.getUint32(i+4,!0));return o+BigInt(4294967296)*r}function jLe(e){switch(e){case Gt.INT8:return $.BYTE;case Gt.UINT8:return $.UNSIGNED_BYTE;case Gt.INT16:return $.SHORT;case Gt.UINT16:return $.UNSIGNED_SHORT;case Gt.INT32:return $.INT;case Gt.UINT32:return $.UNSIGNED_INT;case Gt.FLOAT32:return $.FLOAT;case Gt.FLOAT64:return $.DOUBLE}}function Pne(e){if(c(e._unpackedValues))return!1;let t=e._classProperty,n=t.type,i=t.valueType;return n===Et.STRING||i===Gt.INT64&&!zt.supportsBigInt64Array()||i===Gt.UINT64&&!zt.supportsBigUint64Array()}function WLe(e,t,n){if(Pne(e))return!0;let i=e._arrayOffsets;if(c(i)){let o=i.get(t+1)-i.get(t),r=n.length;if(o!==r)return!0}return!1}function Ine(e){e._unpackedValues=qLe(e),e._arrayOffsets=void 0,e._stringOffsets=void 0,e._values=void 0}function qLe(e){let t=e._count,n=new Array(t),i=e._classProperty,o=i.isArray,r=i.type,s=Et.getComponentCount(r);if(!o&&s===1){for(let a=0;a<t;++a)n[a]=e._getValue(a);return n}for(let a=0;a<t;a++)n[a]=Dne(e,i,a);return n}function YLe(e,t){let i=e._classProperty.isVariableLengthArray;return!e._hasValueTransform||i?t:rT.valueTransformInPlace(t,e._offset,e._scale,Gt.applyValueTransform)}function XLe(e,t){let i=e._classProperty.isVariableLengthArray;return!e._hasValueTransform||i?t:rT.valueTransformInPlace(t,e._offset,e._scale,Gt.unapplyValueTransform)}function oz(e,t,n){let i=this,o,r,s;if(t===Gt.INT64)zt.supportsBigInt()?zt.supportsBigInt64Array()?(o=new BigInt64Array(e.buffer,e.byteOffset,n),s=function(a,l){i.typedArray[a]=BigInt(l)}):(o=new Uint8Array(e.buffer,e.byteOffset,n*8),r=function(a){return zLe(a,i)}):(_t("INT64 type is not fully supported on this platform. Values greater than 2^53 - 1 or less than -(2^53 - 1) may lose precision when read."),o=new Uint8Array(e.buffer,e.byteOffset,n*8),r=function(a){return ULe(a,i)});else if(t===Gt.UINT64)zt.supportsBigInt()?zt.supportsBigUint64Array()?(o=new BigUint64Array(e.buffer,e.byteOffset,n),s=function(a,l){i.typedArray[a]=BigInt(l)}):(o=new Uint8Array(e.buffer,e.byteOffset,n*8),r=function(a){return GLe(a,i)}):(_t("UINT64 type is not fully supported on this platform. Values greater than 2^53 - 1 may lose precision when read."),o=new Uint8Array(e.buffer,e.byteOffset,n*8),r=function(a){return HLe(a,i)});else{let a=jLe(t);o=$.createArrayBufferView(a,e.buffer,e.byteOffset,n),s=function(l,u){i.typedArray[l]=u}}c(r)||(r=function(a){return i.typedArray[a]}),this.typedArray=o,this.dataView=new DataView(o.buffer,o.byteOffset),this.get=r,this.set=s,this._componentType=t}var rz=LS;function Zf(e){e=y(e,y.EMPTY_OBJECT);let t=e.count,n=e.class;A.typeOf.number.greaterThan("options.count",t,0),A.typeOf.object("options.class",n);let i=0,o={};if(c(e.properties)){for(let r in e.properties)if(e.properties.hasOwnProperty(r)){let s=new rz({count:t,property:e.properties[r],classProperty:n.properties[r],bufferViews:e.bufferViews});o[r]=s,i+=s.byteLength}}this._count=t,this._class=n,this._properties=o,this._byteLength=i}Object.defineProperties(Zf.prototype,{count:{get:function(){return this._count}},class:{get:function(){return this._class}},byteLength:{get:function(){return this._byteLength}}});Zf.prototype.hasProperty=function(e){return Bn.hasProperty(e,this._properties,this._class)};Zf.prototype.hasPropertyBySemantic=function(e){return Bn.hasPropertyBySemantic(e,this._properties,this._class)};Zf.prototype.getPropertyIds=function(e){return Bn.getPropertyIds(this._properties,this._class,e)};Zf.prototype.getProperty=function(e,t){A.typeOf.string("propertyId",t);let n=this._properties[t],i;return c(n)?i=n.get(e):i=KLe(this._class,t),i};Zf.prototype.setProperty=function(e,t,n){A.typeOf.string("propertyId",t);let i=this._properties[t];return c(i)?(i.set(e,n),!0):!1};Zf.prototype.getPropertyBySemantic=function(e,t){A.typeOf.string("semantic",t);let n,i=this._class.propertiesBySemantic;if(c(i)&&(n=i[t]),c(n))return this.getProperty(e,n.id)};Zf.prototype.setPropertyBySemantic=function(e,t,n){A.typeOf.string("semantic",t);let i,o=this._class.propertiesBySemantic;return c(o)&&(i=o[t]),c(i)?this.setProperty(e,i.id,n):!1};Zf.prototype.getPropertyTypedArray=function(e){A.typeOf.string("propertyId",e);let t=this._properties[e];if(c(t))return t.getTypedArray()};Zf.prototype.getPropertyTypedArrayBySemantic=function(e){A.typeOf.string("semantic",e);let t,n=this._class.propertiesBySemantic;if(c(n)&&(t=n[e]),c(t))return this.getPropertyTypedArray(t.id)};function KLe(e,t){let n=e.properties;if(!c(n))return;let i=n[t];if(c(i)&&c(i.default)){let o=i.default;return i.isArray&&(o=qe(o,!0)),o=i.normalize(o),i.unpackVectorAndMatrixTypes(o)}}var qu=Zf;function k_(){}Object.defineProperties(k_.prototype,{cacheKey:{get:function(){E.throwInstantiationError()}}});k_.prototype.load=function(){E.throwInstantiationError()};k_.prototype.unload=function(){};k_.prototype.process=function(e){return!1};k_.prototype.getError=function(e,t){A.typeOf.string("errorMessage",e),c(t)&&c(t.message)&&(e+=`
${t.message}`);let n=new ue(e);return c(t)&&(n.stack=`Original stack:
${t.stack}
Handler stack:
${n.stack}`),n};k_.prototype.isDestroyed=function(){return!1};k_.prototype.destroy=function(){return this.unload(),de(this)};var Zi=k_;var $Le={UNLOADED:0,LOADING:1,LOADED:2,PROCESSING:3,READY:4,FAILED:5},yt=Object.freeze($Le);function Zm(e){e=y(e,y.EMPTY_OBJECT);let t=e.typedArray,n=e.resource,i=e.cacheKey;if(c(t)===c(n))throw new E("One of options.typedArray and options.resource must be defined.");this._typedArray=t,this._resource=n,this._cacheKey=i,this._state=yt.UNLOADED,this._promise=void 0}c(Object.create)&&(Zm.prototype=Object.create(Zi.prototype),Zm.prototype.constructor=Zm);Object.defineProperties(Zm.prototype,{cacheKey:{get:function(){return this._cacheKey}},typedArray:{get:function(){return this._typedArray}}});Zm.prototype.load=async function(){return c(this._promise)?this._promise:c(this._typedArray)?(this._promise=Promise.resolve(this),this._promise):(this._promise=ZLe(this),this._promise)};async function ZLe(e){let t=e._resource;e._state=yt.LOADING;try{let n=await Zm._fetchArrayBuffer(t);return e.isDestroyed()?void 0:(e._typedArray=new Uint8Array(n),e._state=yt.READY,e)}catch(n){if(e.isDestroyed())return;e._state=yt.FAILED;let i=`Failed to load external buffer: ${t.url}`;throw e.getError(i,n)}}Zm._fetchArrayBuffer=function(e){return e.fetchArrayBuffer()};Zm.prototype.unload=function(){this._typedArray=void 0};var NS=Zm;var Aen=function(){var e="b9H79TebbbeJq9Geueu9Geub9Gbb9Gvuuuuueu9Gduueu9Gluuuueu9Gvuuuuub9Gouuuuuub9Gluuuub9GiuuueuiKLdilevlevlooroowwvwbDDbelve9Weiiviebeoweuec:G:Qdkr;RiOo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9FW9U9J9V9KW9wWVtW949c919M9MWVbe8F9TW79O9V9Wt9FW9U9J9V9KW9wWVtW949c919M9MWV9c9V919U9KbdE9TW79O9V9Wt9FW9U9J9V9KW9wWVtW949wWV79P9V9UbiY9TW79O9V9Wt9FW9U9J9V9KW69U9KW949c919M9MWVbl8E9TW79O9V9Wt9FW9U9J9V9KW69U9KW949c919M9MWV9c9V919U9Kbv8A9TW79O9V9Wt9FW9U9J9V9KW69U9KW949wWV79P9V9UboE9TW79O9V9Wt9FW9U9J9V9KW69U9KW949tWG91W9U9JWbra9TW79O9V9Wt9FW9U9J9V9KW69U9KW949tWG91W9U9JW9c9V919U9KbwL9TW79O9V9Wt9FW9U9J9V9KWS9P2tWV9p9JtbDK9TW79O9V9Wt9FW9U9J9V9KWS9P2tWV9r919HtbqL9TW79O9V9Wt9FW9U9J9V9KWS9P2tWVT949WbkE9TW79O9V9Wt9F9V9Wt9P9T9P96W9wWVtW94J9H9J9OWbPa9TW79O9V9Wt9F9V9Wt9P9T9P96W9wWVtW94J9H9J9OW9ttV9P9Wbsa9TW79O9V9Wt9F9V9Wt9P9T9P96W9wWVtW94SWt9J9O9sW9T9H9WbzK9TW79O9V9Wt9F79W9Ht9P9H29t9VVt9sW9T9H9WbHl79IV9RbODwebcekdQXq;A9pLdbk;QqeKu8Jjjjjbcjo9Rgv8Kjjjjbcbhodnalcefae0mbabcbRbN:kjjbc:GeV86bbavcjdfcbcjdzNjjjb8AdnaiTmbavcjdfadalz:tjjjb8Akabaefhrabcefhwavalfcbcbcjdal9RalcFe0EzNjjjb8Aavavcjdfalz:tjjjbhDcj;abal9Uc;WFbGgecjdaecjd6Ehqcbhkindndnaiak9nmbaDcjlfcbcjdzNjjjb8Aaqaiak9Rakaqfai6Egxcsfgecl4cifcd4hmadakal2fhPdndndnaec9WGgsTmbcbhzaPhHawhOxekdnaxmbalheinaraw9Ram6miawcbamzNjjjbamfhwaecufgembxvkkcbhAaPhOinaDaAfRbbhCaDcjlfheaOhoaxhXinaeaoRbbgQaC9RgCcetaCcKtcK91cr4786bbaoalfhoaecefheaQhCaXcufgXmbkaraw9Ram6mdaOcefhOawcbamzNjjjbamfhwaAcefgAal9hmbxlkkindnaxTmbaDazfRbbhCaDcjlfheaHhoaxhXinaeaoRbbgQaC9RgCcetaCcKtcK91cr4786bbaoalfhoaecefheaQhCaXcufgXmbkkaraO9Ram6mearaOcbamzNjjjbgLamfgw9RcK6mecbhKaDcjlfhOinaDcjlfaKfhYcwhAczhQceheindndnaegXce9hmbcuhoaYRbbmecbhodninaogecsSmeaecefhoaOaefcefRbbTmbkkcucbaecs6EhoxekaXcethocuaXtc;:bGcFb7hCcbheinaoaCaOaefRbb9nfhoaecefgecz9hmbkkaoaQaoaQ6geEhQaXaAaeEhAaXcetheaXcl6mbkdndndndnaAcufPdiebkaLaKco4fgeaeRbbcdciaAclSEaKci4coGtV86bbaAcw9hmeawaY8Pbb83bbawcwfaYcwf8Pbb83bbawczfhwxdkaLaKco4fgeaeRbbceaKci4coGtV86bbkdncwaA9Tg8Ambinawcb86bbawcefhwxbkkcuaAtcu7hYcbhEaOh3ina3hea8AhCcbhoinaeRbbgQaYcFeGgXaQaX6EaoaAtVhoaecefheaCcufgCmbkawao86bba3a8Afh3awcefhwaEa8AfgEcz6mbkcbheindnaOaefRbbgoaX6mbawao86bbawcefhwkaecefgecz9hmbkkdnaKczfgKas9pmbaOczfhOaraw9RcL0mekkaKas6meawTmeaHcefhHawhOazcefgzalSmixbkkcbhoxikcbhoaraw9Ralcaalca0E6mddnalc8F0mbawcbcaal9RgezNjjjbaefhwkawaDcjdfalz:tjjjbalfab9RhoxdkaDaPaxcufal2falz:tjjjb8Aaxakfhkawmbkcbhokavcjof8Kjjjjbaok9heeuaecaaeca0Eabcj;abae9Uc;WFbGgdcjdadcjd6Egdfcufad9Uae2adcl4cifcd4adV2fcefkmbcbabBdN:kjjbk:zse5u8Jjjjjbc;ae9Rgl8Kjjjjbcbhvdnaici9UgocHfae0mbabcbyd:e:kjjbgrc;GeV86bbalc;abfcFecjezNjjjb8AalcUfgw9cu83ibalc8WfgD9cu83ibalcyfgq9cu83ibalcafgk9cu83ibalcKfgx9cu83ibalczfgm9cu83ibal9cu83iwal9cu83ibabaefc9WfhPabcefgsaofhednaiTmbcmcsarcb9kgzEhHcbhOcbhAcbhCcbhXcbhQindnaeaP9nmbcbhvxikaQcufhvadaCcdtfgLydbhKaLcwfydbhYaLclfydbh8AcbhEdndndninalc;abfavcsGcitfgoydlh3dndndnaoydbgoaK9hmba3a8ASmekdnaoa8A9hmba3aY9hmbaEcefhExekaoaY9hmea3aK9hmeaEcdfhEkaEc870mdaXcufhvaLaEciGcx2goc:y1jjbfydbcdtfydbh3aLaocN1jjbfydbcdtfydbh8AaLaoc:q1jjbfydbcdtfydbhKcbhodnindnalavcsGcdtfydba39hmbaohYxdkcuhYavcufhvaocefgocz9hmbkkaOa3aOSgvaYce9iaYaH9oVgoGfhOdndndncbcsavEaYaoEgvcs9hmbarce9imba3a3aAa3cefaASgvEgAcefSmecmcsavEhvkasavaEcdtc;WeGV86bbavcs9hmea3aA9Rgvcetavc8F917hvinaeavcFb0crtavcFbGV86bbaecefheavcje6hoavcr4hvaoTmbka3hAxvkcPhvasaEcdtcPV86bba3hAkavTmiavaH9omicdhocehEaQhYxlkavcufhvaEclfgEc;ab9hmbkkdnaLceaYaOSceta8AaOSEcx2gvc:q1jjbfydbcdtfydbgKTaLavcN1jjbfydbcdtfydbg8AceSGaLavc:y1jjbfydbcdtfydbg3cdSGaOcb9hGazGg5ce9hmbaw9cu83ibaD9cu83ibaq9cu83ibak9cu83ibax9cu83ibam9cu83ibal9cu83iwal9cu83ibcbhOkcbhEaXcufgvhodnindnalaocsGcdtfydba8A9hmbaEhYxdkcuhYaocufhoaEcefgEcz9hmbkkcbhodnindnalavcsGcdtfydba39hmbaohExdkcuhEavcufhvaocefgocz9hmbkkaOaKaOSg8EfhLdndnaYcm0mbaYcefhYxekcbcsa8AaLSgvEhYaLavfhLkdndnaEcm0mbaEcefhExekcbcsa3aLSgvEhEaLavfhLkc9:cua8EEh8FcbhvaEaYcltVgacFeGhodndndninavcj1jjbfRbbaoSmeavcefgvcz9hmbxdkka5aKaO9havcm0VVmbasavc;WeV86bbxekasa8F86bbaeaa86bbaecefhekdna8EmbaKaA9Rgvcetavc8F917hvinaeavcFb0gocrtavcFbGV86bbavcr4hvaecefheaombkaKhAkdnaYcs9hmba8AaA9Rgvcetavc8F917hvinaeavcFb0gocrtavcFbGV86bbavcr4hvaecefheaombka8AhAkdnaEcs9hmba3aA9Rgvcetavc8F917hvinaeavcFb0gocrtavcFbGV86bbavcr4hvaecefheaombka3hAkalaXcdtfaKBdbaXcefcsGhvdndnaYPzbeeeeeeeeeeeeeebekalavcdtfa8ABdbaXcdfcsGhvkdndnaEPzbeeeeeeeeeeeeeebekalavcdtfa3BdbavcefcsGhvkcihoalc;abfaQcitfgEaKBdlaEa8ABdbaQcefcsGhYcdhEavhXaLhOxekcdhoalaXcdtfa3BdbcehEaXcefcsGhXaQhYkalc;abfaYcitfgva8ABdlava3Bdbalc;abfaQaEfcsGcitfgva3BdlavaKBdbascefhsaQaofcsGhQaCcifgCai6mbkkcbhvaeaP0mbcbhvinaeavfavcj1jjbfRbb86bbavcefgvcz9hmbkaeab9Ravfhvkalc;aef8KjjjjbavkZeeucbhddninadcefgdc8F0meceadtae6mbkkadcrfcFeGcr9Uci2cdfabci9U2cHfkmbcbabBd:e:kjjbk:ydewu8Jjjjjbcz9Rhlcbhvdnaicvfae0mbcbhvabcbRb:e:kjjbc;qeV86bbal9cb83iwabcefhoabaefc98fhrdnaiTmbcbhwcbhDindnaoar6mbcbskadaDcdtfydbgqalcwfawaqav9Rgvavc8F91gv7av9Rc507gwcdtfgkydb9Rgvc8E91c9:Gavcdt7awVhvinaoavcFb0gecrtavcFbGV86bbavcr4hvaocefhoaembkakaqBdbaqhvaDcefgDai9hmbkkcbhvaoar0mbaocbBbbaoab9RclfhvkavkBeeucbhddninadcefgdc8F0meceadtae6mbkkadcwfcFeGcr9Uab2cvfk:bvli99dui99ludnaeTmbcuadcetcuftcu7:Yhvdndncuaicuftcu7:YgoJbbbZMgr:lJbbb9p9DTmbar:Ohwxekcjjjj94hwkcbhicbhDinalclfIdbgrJbbbbJbbjZalIdbgq:lar:lMalcwfIdbgk:lMgr:varJbbbb9BEgrNhxaqarNhrdndnakJbbbb9GTmbaxhqxekJbbjZar:l:tgqaq:maxJbbbb9GEhqJbbjZax:l:tgxax:marJbbbb9GEhrkdndnalcxfIdbgxJbbj:;axJbbj:;9GEgkJbbjZakJbbjZ9FEavNJbbbZJbbb:;axJbbbb9GEMgx:lJbbb9p9DTmbax:Ohmxekcjjjj94hmkdndnaqJbbj:;aqJbbj:;9GEgxJbbjZaxJbbjZ9FEaoNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:OhPxekcjjjj94hPkdndnarJbbj:;arJbbj:;9GEgqJbbjZaqJbbjZ9FEaoNJbbbZJbbb:;arJbbbb9GEMgr:lJbbb9p9DTmbar:Ohsxekcjjjj94hskdndnadcl9hmbabaifgzas86bbazcifam86bbazcdfaw86bbazcefaP86bbxekabaDfgzas87ebazcofam87ebazclfaw87ebazcdfaP87ebkalczfhlaiclfhiaDcwfhDaecufgembkkk;hlld99eud99eudnaeTmbdndncuaicuftcu7:YgvJbbbZMgo:lJbbb9p9DTmbao:Ohixekcjjjj94hikaic;8FiGhrinabcofcicdalclfIdb:lalIdb:l9EgialcwfIdb:lalaicdtfIdb:l9EEgialcxfIdb:lalaicdtfIdb:l9EEgiarV87ebdndnJbbj:;JbbjZalaicdtfIdbJbbbb9DEgoalaicd7cdtfIdbJ;Zl:1ZNNgwJbbj:;awJbbj:;9GEgDJbbjZaDJbbjZ9FEavNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohqxekcjjjj94hqkabcdfaq87ebdndnalaicefciGcdtfIdbJ;Zl:1ZNaoNgwJbbj:;awJbbj:;9GEgDJbbjZaDJbbjZ9FEavNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohqxekcjjjj94hqkabaq87ebdndnaoalaicufciGcdtfIdbJ;Zl:1ZNNgoJbbj:;aoJbbj:;9GEgwJbbjZawJbbjZ9FEavNJbbbZJbbb:;aoJbbbb9GEMgo:lJbbb9p9DTmbao:Ohixekcjjjj94hikabclfai87ebabcwfhbalczfhlaecufgembkkk;3viDue99eu8Jjjjjbcjd9Rgo8Kjjjjbadcd4hrdndndndnavcd9hmbadcl6meaohwarhDinawc:CuBdbawclfhwaDcufgDmbkaeTmiadcl6mdarcdthqalhkcbhxinaohwakhDarhminawawydbgPcbaDIdbgs:8cL4cFeGc:cufasJbbbb9BEgzaPaz9kEBdbaDclfhDawclfhwamcufgmmbkakaqfhkaxcefgxaeSmixbkkaeTmdxekaeTmekarcdthkavce9hhqadcl6hdcbhxindndndnaqmbadmdc:CuhDalhwarhminaDcbawIdbgs:8cL4cFeGc:cufasJbbbb9BEgPaDaP9kEhDawclfhwamcufgmmbxdkkc:CuhDdndnavPleddbdkadmdaohwalhmarhPinawcbamIdbgs:8cL4cFeGgzc;:bazc;:b9kEc:cufasJbbbb9BEBdbamclfhmawclfhwaPcufgPmbxdkkadmecbhwarhminaoawfcbalawfIdbgs:8cL4cFeGgPc8AaPc8A9kEc:cufasJbbbb9BEBdbawclfhwamcufgmmbkkadmbcbhwarhPinaDhmdnavceSmbaoawfydbhmkdndnalawfIdbgscjjj;8iamai9RcefgmcLt9R::NJbbbZJbbb:;asJbbbb9GEMgs:lJbbb9p9DTmbas:Ohzxekcjjjj94hzkabawfazcFFFrGamcKtVBdbawclfhwaPcufgPmbkkabakfhbalakfhlaxcefgxae9hmbkkaocjdf8Kjjjjbk;HqdCui998Jjjjjbc:qd9Rgv8Kjjjjbavc:Sefcbc;KbzNjjjb8AcbhodnadTmbcbhoaiTmbdnabae9hmbavcuadcdtgradcFFFFi0Ecbyd:m:kjjbHjjjjbbgeBd:SeavceBd:mdaeabarz:tjjjb8Akavc:GefcwfcbBdbav9cb83i:Geavc:Gefaeadaiavc:Sefz:njjjbavyd:Gehwadci9UgDcbyd:m:kjjbHjjjjbbhravc:Sefavyd:mdgqcdtfarBdbavaqcefgkBd:mdarcbaDzNjjjbhxavc:SefakcdtfcuaicdtaicFFFFi0Ecbyd:m:kjjbHjjjjbbgmBdbavaqcdfgPBd:mdawhramhkinakalIdbalarydbgscwascw6Ecdtfc;ebfIdbMUdbarclfhrakclfhkaicufgimbkavc:SefaPcdtfcuaDcdtadcFFFF970Ecbyd:m:kjjbHjjjjbbgPBdbdnadci6mbaehraPhkaDhiinakamarydbcdtfIdbamarclfydbcdtfIdbMamarcwfydbcdtfIdbMUdbarcxfhrakclfhkaicufgimbkkaqcifhoavc;qbfhzavhravyd:KehHavyd:OehOcbhscbhkcbhAcehCinarhXcihQaeakci2gLcdtfgrydbhdarclfydbhqabaAcx2fgicwfarcwfydbgKBdbaiclfaqBdbaiadBdbaxakfce86bbazaKBdwazaqBdlazadBdbaPakcdtfcbBdbdnasTmbcihQaXhiinazaQcdtfaiydbgrBdbaQaraK9harad9haraq9hGGfhQaiclfhiascufgsmbkkaAcefhAcbhsinaOaHaeasaLfcdtfydbcdtgifydbcdtfgKhrawaifgqydbgdhidnadTmbdninarydbakSmearclfhraicufgiTmdxbkkaraKadcdtfc98fydbBdbaqaqydbcufBdbkascefgsci9hmbkdndnaQTmbcuhkJbbbbhYcbhqavyd:KehKavyd:OehLindndnawazaqcdtfydbcdtgsfydbgrmbaqcefhqxekaqcs0hiamasfgdIdbh8AadalcbaqcefgqaiEcdtfIdbalarcwarcw6Ecdtfc;ebfIdbMgEUdbaEa8A:thEarcdthiaLaKasfydbcdtfhrinaParydbgscdtfgdaEadIdbMg8AUdba8AaYaYa8A9DgdEhYasakadEhkarclfhraic98fgimbkkaqaQ9hmbkakcu9hmekaCaD9pmdindnaxaCfRbbmbaChkxdkaDaCcefgC9hmbxikkaQczaQcz6EhsazhraXhzakcu9hmbkkaocdtavc:Seffc98fhrdninaoTmearydbcbyd1:kjjbH:bjjjbbarc98fhraocufhoxbkkavc:qdf8Kjjjjbk;IlevucuaicdtgvaicFFFFi0Egocbyd:m:kjjbHjjjjbbhralalyd9GgwcdtfarBdbalawcefBd9GabarBdbaocbyd:m:kjjbHjjjjbbhralalyd9GgocdtfarBdbalaocefBd9GabarBdlcuadcdtadcFFFFi0Ecbyd:m:kjjbHjjjjbbhralalyd9GgocdtfarBdbalaocefBd9GabarBdwabydbcbavzNjjjb8Aadci9UhDdnadTmbabydbhoaehladhrinaoalydbcdtfgvavydbcefBdbalclfhlarcufgrmbkkdnaiTmbabydbhlabydlhrcbhvaihoinaravBdbarclfhralydbavfhvalclfhlaocufgombkkdnadci6mbabydlhrabydwhvcbhlinaecwfydbhoaeclfydbhdaraeydbcdtfgwawydbgwcefBdbavawcdtfalBdbaradcdtfgdadydbgdcefBdbavadcdtfalBdbaraocdtfgoaoydbgocefBdbavaocdtfalBdbaecxfheaDalcefgl9hmbkkdnaiTmbabydlheabydbhlinaeaeydbalydb9RBdbalclfhlaeclfheaicufgimbkkkQbabaeadaic:01jjbz:mjjjbkQbabaeadaic:C:jjjbz:mjjjbk9DeeuabcFeaicdtzNjjjbhlcbhbdnadTmbindnalaeydbcdtfgiydbcu9hmbaiabBdbabcefhbkaeclfheadcufgdmbkkabk;Wkivuo99lu8Jjjjjbc;W;Gb9Rgl8Kjjjjbcbhvalcj;Gbfcbc;KbzNjjjb8AalcuadcdtadcFFFFi0Egocbyd:m:kjjbHjjjjbbgrBdj9GalceBd;G9GalcFFF;7rBdwal9cFFF;7;3FF:;Fb83dbalcFFF97Bd;S9Gal9cFFF;7FFF:;u83d;K9Gaicd4hwdndnadmbJFFuFhDJFFuuhqJFFuuhkJFFuFhxJFFuuhmJFFuFhPxekawcdthsaehzincbhiinalaifgHazaifIdbgDaHIdbgxaxaD9EEUdbalc;K;GbfaifgHaDaHIdbgxaxaD9DEUdbaiclfgicx9hmbkazasfhzavcefgvad9hmbkalIdwhqalId;S9GhDalIdlhkalId;O9GhxalIdbhmalId;K9GhPkdndnadTmbJbbbbJbbjZJbbbbaPam:tgPaPJbbbb9DEgPaxak:tgxaxaP9DEgxaDaq:tgDaDax9DEgD:vaDJbbbb9BEhDawcdthsarhHadhzindndnaDaeIdbam:tNJb;au9eNJbbbZMgx:lJbbb9p9DTmbax:Ohixekcjjjj94hikaicztaicwtcj;GiGVaicsGVc:p;G:dKGcH2c;d;H:WKGcv2c;j:KM;jbGhvdndnaDaeclfIdbak:tNJb;au9eNJbbbZMgx:lJbbb9p9DTmbax:Ohixekcjjjj94hikaicztaicwtcj;GiGVaicsGVc:p;G:dKGcH2c;d;H:WKGcq2cM;j:KMeGavVhvdndnaDaecwfIdbaq:tNJb;au9eNJbbbZMgx:lJbbb9p9DTmbax:Ohixekcjjjj94hikaHavaicztaicwtcj;GiGVaicsGVc:p;G:dKGcH2c;d;H:WKGcC2c:KM;j:KdGVBdbaeasfheaHclfhHazcufgzmbkalcbcj;GbzNjjjbhiarhHadheinaiaHydbgzcFrGcx2fgvavydbcefBdbaiazcq4cFrGcx2fgvavydlcefBdlaiazcC4cFrGcx2fgzazydwcefBdwaHclfhHaecufgembxdkkalcbcj;GbzNjjjb8AkcbhHcbhzcbhecbhvinalaHfgiydbhsaiazBdbaicwfgwydbhOawavBdbaiclfgiydbhwaiaeBdbasazfhzaOavfhvawaefheaHcxfgHcj;Gb9hmbkcbhHalaocbyd:m:kjjbHjjjjbbgiBd:e9GdnadTmbabhzinazaHBdbazclfhzadaHcefgH9hmbkabhHadhzinalaraHydbgecdtfydbcFrGcx2fgvavydbgvcefBdbaiavcdtfaeBdbaHclfhHazcufgzmbkaihHadhzinalaraHydbgecdtfydbcq4cFrGcx2fgvavydlgvcefBdlabavcdtfaeBdbaHclfhHazcufgzmbkabhHadhzinalaraHydbgecdtfydbcC4cFrGcx2fgvavydwgvcefBdwaiavcdtfaeBdbaHclfhHazcufgzmbkcbhHinabaiydbcdtfaHBdbaiclfhiadaHcefgH9hmbkkclhidninaic98Smealcj;Gbfaifydbcbyd1:kjjbH:bjjjbbaic98fhixbkkalc;W;Gbf8Kjjjjbk9teiucbcbyd:q:kjjbgeabcifc98GfgbBd:q:kjjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaik;LeeeudndnaeabVciGTmbabhixekdndnadcz9pmbabhixekabhiinaiaeydbBdbaiclfaeclfydbBdbaicwfaecwfydbBdbaicxfaecxfydbBdbaeczfheaiczfhiadc9Wfgdcs0mbkkadcl6mbinaiaeydbBdbaeclfheaiclfhiadc98fgdci0mbkkdnadTmbinaiaeRbb86bbaicefhiaecefheadcufgdmbkkabk;aeedudndnabciGTmbabhixekaecFeGc:b:c:ew2hldndnadcz9pmbabhixekabhiinaialBdbaicxfalBdbaicwfalBdbaiclfalBdbaiczfhiadc9Wfgdcs0mbkkadcl6mbinaialBdbaiclfhiadc98fgdci0mbkkdnadTmbinaiae86bbaicefhiadcufgdmbkkabk9teiucbcbyd:q:kjjbgeabcrfc94GfgbBd:q:kjjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaik9:eiuZbhedndncbyd:q:kjjbgdaecztgi9nmbcuheadai9RcFFifcz4nbcuSmekadhekcbabae9Rcifc98Gcbyd:q:kjjbfgdBd:q:kjjbdnadZbcztge9nmbadae9RcFFifcz4nb8Akkk:Iddbcjwk:edb4:h9w9N94:P:gW:j9O:ye9Pbbbbbbebbbdbbbebbbdbbbbbbbdbbbbbbbebbbbbbb:l29hZ;69:9kZ;N;76Z;rg97Z;z;o9xZ8J;B85Z;:;u9yZ;b;k9HZ:2;Z9DZ9e:l9mZ59A8KZ:r;T3Z:A:zYZ79OHZ;j4::8::Y:D9V8:bbbb9s:49:Z8R:hBZ9M9M;M8:L;z;o8:;8:PG89q;x:J878R:hQ8::M:B;e87bbbbbbjZbbjZbbjZ:E;V;N8::Y:DsZ9i;H;68:xd;R8:;h0838:;W:NoZbbbb:WV9O8:uf888:9i;H;68:9c9G;L89;n;m9m89;D8Ko8:bbbbf:8tZ9m836ZS:2AZL;zPZZ818EZ9e:lxZ;U98F8:819E;68:bc:eqkzebbbebbbdbbba:vbb",t=new Uint8Array([32,0,65,2,1,106,34,33,3,128,11,4,13,64,6,253,10,7,15,116,127,5,8,12,40,16,19,54,20,9,27,255,113,17,42,67,24,23,146,148,18,14,22,45,70,69,56,114,101,21,25,63,75,136,108,28,118,29,73,115]);if(typeof WebAssembly!="object")return{supported:!1};var n,i=WebAssembly.instantiate(o(e),{}).then(function(g){n=g.instance,n.exports.__wasm_call_ctors(),n.exports.meshopt_encodeVertexVersion(0),n.exports.meshopt_encodeIndexVersion(1)});function o(g){for(var m=new Uint8Array(g.length),b=0;b<g.length;++b){var x=g.charCodeAt(b);m[b]=x>96?x-97:x>64?x-39:x+4}for(var T=0,b=0;b<g.length;++b)m[T++]=m[b]<60?t[m[b]]:(m[b]-60)*64+m[++b];return m.buffer.slice(0,T)}function r(g){if(!g)throw new Error("Assertion failed")}function s(g){return new Uint8Array(g.buffer,g.byteOffset,g.byteLength)}function a(g,m,b,x){var T=n.exports.sbrk,C=T(m.length*4),S=T(b*4),v=new Uint8Array(n.exports.memory.buffer),D=s(m);v.set(D,C),x&&x(C,C,m.length,b);var I=g(S,C,m.length,b);v=new Uint8Array(n.exports.memory.buffer);var L=new Uint32Array(b);new Uint8Array(L.buffer).set(v.subarray(S,S+b*4)),D.set(v.subarray(C,C+m.length*4)),T(C-T(0));for(var M=0;M<m.length;++M)m[M]=L[m[M]];return[L,I]}function l(g,m,b,x){var T=n.exports.sbrk,C=T(b*4),S=T(b*x),v=new Uint8Array(n.exports.memory.buffer);v.set(s(m),S),g(C,S,b,x),v=new Uint8Array(n.exports.memory.buffer);var D=new Uint32Array(b);return new Uint8Array(D.buffer).set(v.subarray(C,C+b*4)),T(C-T(0)),D}function u(g,m,b,x,T){var C=n.exports.sbrk,S=C(m),v=C(x*T),D=new Uint8Array(n.exports.memory.buffer);D.set(s(b),v);var I=g(S,m,v,x,T),L=new Uint8Array(I);return L.set(D.subarray(S,S+I)),C(S-C(0)),L}function f(g){for(var m=0,b=0;b<g.length;++b){var x=g[b];m=m<x?x:m}return m}function d(g,m){if(r(m==2||m==4),m==4)return new Uint32Array(g.buffer,g.byteOffset,g.byteLength/4);var b=new Uint16Array(g.buffer,g.byteOffset,g.byteLength/2);return new Uint32Array(b)}function p(g,m,b,x,T,C,S){var v=n.exports.sbrk,D=v(b*x),I=v(b*C),L=new Uint8Array(n.exports.memory.buffer);L.set(s(m),I),g(D,b,x,T,I,S);var M=new Uint8Array(b*x);return M.set(L.subarray(D,D+b*x)),v(D-v(0)),M}return{ready:i,supported:!0,reorderMesh:function(g,m,b){var x=m?b?n.exports.meshopt_optimizeVertexCacheStrip:n.exports.meshopt_optimizeVertexCache:void 0;return a(n.exports.meshopt_optimizeVertexFetchRemap,g,f(g)+1,x)},reorderPoints:function(g,m){return r(g instanceof Float32Array),r(g.length%m==0),r(m>=3),l(n.exports.meshopt_spatialSortRemap,g,g.length/m,m*4)},encodeVertexBuffer:function(g,m,b){r(b>0&&b<=256),r(b%4==0);var x=n.exports.meshopt_encodeVertexBufferBound(m,b);return u(n.exports.meshopt_encodeVertexBuffer,x,g,m,b)},encodeIndexBuffer:function(g,m,b){r(b==2||b==4),r(m%3==0);var x=d(g,b),T=n.exports.meshopt_encodeIndexBufferBound(m,f(x)+1);return u(n.exports.meshopt_encodeIndexBuffer,T,x,m,4)},encodeIndexSequence:function(g,m,b){r(b==2||b==4);var x=d(g,b),T=n.exports.meshopt_encodeIndexSequenceBound(m,f(x)+1);return u(n.exports.meshopt_encodeIndexSequence,T,x,m,4)},encodeGltfBuffer:function(g,m,b,x){var T={ATTRIBUTES:this.encodeVertexBuffer,TRIANGLES:this.encodeIndexBuffer,INDICES:this.encodeIndexSequence};return r(T[x]),T[x](g,m,b)},encodeFilterOct:function(g,m,b,x){return r(b==4||b==8),r(x>=1&&x<=16),p(n.exports.meshopt_encodeFilterOct,g,m,b,x,16)},encodeFilterQuat:function(g,m,b,x){return r(b==8),r(x>=4&&x<=16),p(n.exports.meshopt_encodeFilterQuat,g,m,b,x,16)},encodeFilterExp:function(g,m,b,x,T){r(b>0&&b%4==0),r(x>=1&&x<=24);var C={Separate:0,SharedVector:1,SharedComponent:2,Clamped:3};return p(n.exports.meshopt_encodeFilterExp,g,m,b,x,b,T?C[T]:1)}}}();var One=function(){var e="b9H79Tebbbe8Fv9Gbb9Gvuuuuueu9Giuuub9Geueu9Giuuueuikqbeeedddillviebeoweuec:q:Odkr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbeY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVbdE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbiL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtblK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbol79IV9Rbrq;w8Wqdbk;esezu8Jjjjjbcj;eb9Rgv8Kjjjjbc9:hodnadcefal0mbcuhoaiRbbc:Ge9hmbavaialfgrad9Radz1jjjbhwcj;abad9Uc;WFbGgocjdaocjd6EhDaicefhocbhqdnindndndnaeaq9nmbaDaeaq9RaqaDfae6Egkcsfglcl4cifcd4hxalc9WGgmTmecbhPawcjdfhsaohzinaraz9Rax6mvarazaxfgo9RcK6mvczhlcbhHinalgic9WfgOawcj;cbffhldndndndndnazaOco4fRbbaHcoG4ciGPlbedibkal9cb83ibalcwf9cb83ibxikalaoRblaoRbbgOco4gAaAciSgAE86bbawcj;cbfaifglcGfaoclfaAfgARbbaOcl4ciGgCaCciSgCE86bbalcVfaAaCfgARbbaOcd4ciGgCaCciSgCE86bbalc7faAaCfgARbbaOciGgOaOciSgOE86bbalctfaAaOfgARbbaoRbegOco4gCaCciSgCE86bbalc91faAaCfgARbbaOcl4ciGgCaCciSgCE86bbalc4faAaCfgARbbaOcd4ciGgCaCciSgCE86bbalc93faAaCfgARbbaOciGgOaOciSgOE86bbalc94faAaOfgARbbaoRbdgOco4gCaCciSgCE86bbalc95faAaCfgARbbaOcl4ciGgCaCciSgCE86bbalc96faAaCfgARbbaOcd4ciGgCaCciSgCE86bbalc97faAaCfgARbbaOciGgOaOciSgOE86bbalc98faAaOfgORbbaoRbigoco4gAaAciSgAE86bbalc99faOaAfgORbbaocl4ciGgAaAciSgAE86bbalc9:faOaAfgORbbaocd4ciGgAaAciSgAE86bbalcufaOaAfglRbbaociGgoaociSgoE86bbalaofhoxdkalaoRbwaoRbbgOcl4gAaAcsSgAE86bbawcj;cbfaifglcGfaocwfaAfgARbbaOcsGgOaOcsSgOE86bbalcVfaAaOfgORbbaoRbegAcl4gCaCcsSgCE86bbalc7faOaCfgORbbaAcsGgAaAcsSgAE86bbalctfaOaAfgORbbaoRbdgAcl4gCaCcsSgCE86bbalc91faOaCfgORbbaAcsGgAaAcsSgAE86bbalc4faOaAfgORbbaoRbigAcl4gCaCcsSgCE86bbalc93faOaCfgORbbaAcsGgAaAcsSgAE86bbalc94faOaAfgORbbaoRblgAcl4gCaCcsSgCE86bbalc95faOaCfgORbbaAcsGgAaAcsSgAE86bbalc96faOaAfgORbbaoRbvgAcl4gCaCcsSgCE86bbalc97faOaCfgORbbaAcsGgAaAcsSgAE86bbalc98faOaAfgORbbaoRbogAcl4gCaCcsSgCE86bbalc99faOaCfgORbbaAcsGgAaAcsSgAE86bbalc9:faOaAfgORbbaoRbrgocl4gAaAcsSgAE86bbalcufaOaAfglRbbaocsGgoaocsSgoE86bbalaofhoxekalao8Pbb83bbalcwfaocwf8Pbb83bbaoczfhokdnaiam9pmbaHcdfhHaiczfhlarao9RcL0mekkaiam6mvaoTmvdnakTmbawaPfRbbhHawcj;cbfhlashiakhOinaialRbbgzce4cbazceG9R7aHfgH86bbaiadfhialcefhlaOcufgOmbkkascefhsaohzaPcefgPad9hmbxikkcbc99arao9Radcaadca0ESEhoxlkaoaxad2fhCdnakmbadhlinaoTmlarao9Rax6mlaoaxfhoalcufglmbkaChoxekcbhmawcjdfhAinarao9Rax6miawamfRbbhHawcj;cbfhlaAhiakhOinaialRbbgzce4cbazceG9R7aHfgH86bbaiadfhialcefhlaOcufgOmbkaAcefhAaoaxfhoamcefgmad9hmbkaChokabaqad2fawcjdfakad2z1jjjb8Aawawcjdfakcufad2fadz1jjjb8Aakaqfhqaombkc9:hoxekc9:hokavcj;ebf8Kjjjjbaok;cseHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgwce0mbavc;abfcFecjez:jjjjb8AavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhDaicefgqarfhidnaeTmbcmcsawceSEhkcbhxcbhmcbhPcbhwcbhlindnaiaD9nmbc9:hoxikdndnaqRbbgoc;Ve0mbavc;abfalaocu7gscl4fcsGcitfgzydlhrazydbhzdnaocsGgHak9pmbavawasfcsGcdtfydbaxaHEhoaHThsdndnadcd9hmbabaPcetfgHaz87ebaHclfao87ebaHcdfar87ebxekabaPcdtfgHazBdbaHcwfaoBdbaHclfarBdbkaxasfhxcdhHavawcdtfaoBdbawasfhwcehsalhOxdkdndnaHcsSmbaHc987aHamffcefhoxekaicefhoai8SbbgHcFeGhsdndnaHcu9mmbaohixekaicvfhiascFbGhscrhHdninao8SbbgOcFbGaHtasVhsaOcu9kmeaocefhoaHcrfgHc8J9hmbxdkkaocefhikasce4cbasceG9R7amfhokdndnadcd9hmbabaPcetfgHaz87ebaHclfao87ebaHcdfar87ebxekabaPcdtfgHazBdbaHcwfaoBdbaHclfarBdbkcdhHavawcdtfaoBdbcehsawcefhwalhOaohmxekdnaocpe0mbaxcefgHavawaDaocsGfRbbgocl49RcsGcdtfydbaocz6gzEhravawao9RcsGcdtfydbaHazfgAaocsGgHEhoaHThCdndnadcd9hmbabaPcetfgHax87ebaHclfao87ebaHcdfar87ebxekabaPcdtfgHaxBdbaHcwfaoBdbaHclfarBdbkcdhsavawcdtfaxBdbavawcefgwcsGcdtfarBdbcihHavc;abfalcitfgOaxBdlaOarBdbavawazfgwcsGcdtfaoBdbalcefcsGhOawaCfhwaxhzaAaCfhxxekaxcbaiRbbgOEgzaoc;:eSgHfhraOcsGhCaOcl4hAdndnaOcs0mbarcefhoxekarhoavawaA9RcsGcdtfydbhrkdndnaCmbaocefhxxekaohxavawaO9RcsGcdtfydbhokdndnaHTmbaicefhHxekaicdfhHai8SbegscFeGhzdnascu9kmbaicofhXazcFbGhzcrhidninaH8SbbgscFbGaitazVhzascu9kmeaHcefhHaicrfgic8J9hmbkaXhHxekaHcefhHkazce4cbazceG9R7amfgmhzkdndnaAcsSmbaHhsxekaHcefhsaH8SbbgicFeGhrdnaicu9kmbaHcvfhXarcFbGhrcrhidninas8SbbgHcFbGaitarVhraHcu9kmeascefhsaicrfgic8J9hmbkaXhsxekascefhskarce4cbarceG9R7amfgmhrkdndnaCcsSmbashixekascefhias8SbbgocFeGhHdnaocu9kmbascvfhXaHcFbGhHcrhodninai8SbbgscFbGaotaHVhHascu9kmeaicefhiaocrfgoc8J9hmbkaXhixekaicefhikaHce4cbaHceG9R7amfgmhokdndnadcd9hmbabaPcetfgHaz87ebaHclfao87ebaHcdfar87ebxekabaPcdtfgHazBdbaHcwfaoBdbaHclfarBdbkcdhsavawcdtfazBdbavawcefgwcsGcdtfarBdbcihHavc;abfalcitfgXazBdlaXarBdbavawaOcz6aAcsSVfgwcsGcdtfaoBdbawaCTaCcsSVfhwalcefcsGhOkaqcefhqavc;abfaOcitfgOarBdlaOaoBdbavc;abfalasfcsGcitfgraoBdlarazBdbawcsGhwalaHfcsGhlaPcifgPae6mbkkcbc99aiaDSEhokavc;aef8Kjjjjbaok:flevu8Jjjjjbcz9Rhvc9:hodnaecvfal0mbcuhoaiRbbc;:eGc;qe9hmbav9cb83iwaicefhraialfc98fhwdnaeTmbdnadcdSmbcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcdtfaic8Etc8F91aicd47avcwfaiceGcdtVgoydbfglBdbaoalBdbaDcefgDae9hmbxdkkcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcetfaic8Etc8F91aicd47avcwfaiceGcdtVgoydbfgl87ebaoalBdbaDcefgDae9hmbkkcbc99arawSEhokaok:Lvoeue99dud99eud99dndnadcl9hmbaeTmeindndnabcdfgd8Sbb:Yab8Sbbgi:Ygl:l:tabcefgv8Sbbgo:Ygr:l:tgwJbb;:9cawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai86bbdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad86bbdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad86bbabclfhbaecufgembxdkkaeTmbindndnabclfgd8Ueb:Yab8Uebgi:Ygl:l:tabcdfgv8Uebgo:Ygr:l:tgwJb;:FSawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai87ebdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad87ebdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad87ebabcwfhbaecufgembkkk;oiliui99iue99dnaeTmbcbhiabhlindndnJ;Zl81Zalcof8UebgvciV:Y:vgoal8Ueb:YNgrJb;:FSNJbbbZJbbb:;arJbbbb9GEMgw:lJbbb9p9DTmbaw:OhDxekcjjjj94hDkalclf8Uebhqalcdf8UebhkabaiavcefciGfcetfaD87ebdndnaoak:YNgwJb;:FSNJbbbZJbbb:;awJbbbb9GEMgx:lJbbb9p9DTmbax:OhDxekcjjjj94hDkabaiavciGfgkcd7cetfaD87ebdndnaoaq:YNgoJb;:FSNJbbbZJbbb:;aoJbbbb9GEMgx:lJbbb9p9DTmbax:OhDxekcjjjj94hDkabaiavcufciGfcetfaD87ebdndnJbbjZararN:tawawN:taoaoN:tgrJbbbbarJbbbb9GE:rJb;:FSNJbbbZMgr:lJbbb9p9DTmbar:Ohvxekcjjjj94hvkabakcetfav87ebalcwfhlaiclfhiaecufgembkkk9mbdnadcd4ae2gdTmbinababydbgecwtcw91:Yaece91cjjj98Gcjjj;8if::NUdbabclfhbadcufgdmbkkk9teiucbcbydj1jjbgeabcifc98GfgbBdj1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaik;LeeeudndnaeabVciGTmbabhixekdndnadcz9pmbabhixekabhiinaiaeydbBdbaiclfaeclfydbBdbaicwfaecwfydbBdbaicxfaecxfydbBdbaeczfheaiczfhiadc9Wfgdcs0mbkkadcl6mbinaiaeydbBdbaeclfheaiclfhiadc98fgdci0mbkkdnadTmbinaiaeRbb86bbaicefhiaecefheadcufgdmbkkabk;aeedudndnabciGTmbabhixekaecFeGc:b:c:ew2hldndnadcz9pmbabhixekabhiinaialBdbaicxfalBdbaicwfalBdbaiclfalBdbaiczfhiadc9Wfgdcs0mbkkadcl6mbinaialBdbaiclfhiadc98fgdci0mbkkdnadTmbinaiae86bbaicefhiadcufgdmbkkabkkkebcjwklzNbb",t="b9H79TebbbeKl9Gbb9Gvuuuuueu9Giuuub9Geueuikqbbebeedddilve9Weeeviebeoweuec:q:6dkr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbdY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVblE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtboK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbrL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbwl79IV9RbDq:p9sqlbzik9:evu8Jjjjjbcz9Rhbcbheincbhdcbhiinabcwfadfaicjuaead4ceGglE86bbaialfhiadcefgdcw9hmbkaec:q:yjjbfai86bbaecitc:q1jjbfab8Piw83ibaecefgecjd9hmbkk:N8JlHud97euo978Jjjjjbcj;kb9Rgv8Kjjjjbc9:hodnadcefal0mbcuhoaiRbbc:Ge9hmbavaialfgrad9Rad;8qbbcj;abad9UhlaicefhodnaeTmbadTmbalc;WFbGglcjdalcjd6EhwcbhDinawaeaD9RaDawfae6Egqcsfglc9WGgkci2hxakcethmalcl4cifcd4hPabaDad2fhsakc;ab6hzcbhHincbhOaohAdndninaraA9RaP6meavcj;cbfaOak2fhCaAaPfhocbhidnazmbarao9Rc;Gb6mbcbhlinaCalfhidndndndndnaAalco4fRbbgXciGPlbedibkaipxbbbbbbbbbbbbbbbbpklbxikaiaopbblaopbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbaoclfaYpQbfaKc:q:yjjbfRbbfhoxdkaiaopbbwaopbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbaocwfaYpQbfaKc:q:yjjbfRbbfhoxekaiaopbbbpklbaoczfhokdndndndndnaXcd4ciGPlbedibkaipxbbbbbbbbbbbbbbbbpklzxikaiaopbblaopbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklzaoclfaYpQbfaKc:q:yjjbfRbbfhoxdkaiaopbbwaopbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklzaocwfaYpQbfaKc:q:yjjbfRbbfhoxekaiaopbbbpklzaoczfhokdndndndndnaXcl4ciGPlbedibkaipxbbbbbbbbbbbbbbbbpklaxikaiaopbblaopbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklaaoclfaYpQbfaKc:q:yjjbfRbbfhoxdkaiaopbbwaopbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklaaocwfaYpQbfaKc:q:yjjbfRbbfhoxekaiaopbbbpklaaoczfhokdndndndndnaXco4Plbedibkaipxbbbbbbbbbbbbbbbbpkl8WxikaiaopbblaopbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibaXc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkl8WaoclfaYpQbfaXc:q:yjjbfRbbfhoxdkaiaopbbwaopbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibaXc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkl8WaocwfaYpQbfaXc:q:yjjbfRbbfhoxekaiaopbbbpkl8Waoczfhokalc;abfhialcjefak0meaihlarao9Rc;Fb0mbkkdnaiak9pmbaici4hlinarao9RcK6miaCaifhXdndndndndnaAaico4fRbbalcoG4ciGPlbedibkaXpxbbbbbbbbbbbbbbbbpkbbxikaXaopbblaopbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkbbaoclfaYpQbfaKc:q:yjjbfRbbfhoxdkaXaopbbwaopbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkbbaocwfaYpQbfaKc:q:yjjbfRbbfhoxekaXaopbbbpkbbaoczfhokalcdfhlaiczfgiak6mbkkaoTmeaohAaOcefgOclSmdxbkkc9:hoxlkdnakTmbavcjdfaHfhiavaHfpbdbhYcbhXinaiavcj;cbfaXfglpblbgLcep9TaLpxeeeeeeeeeeeeeeeegQp9op9Hp9rgLalakfpblbg8Acep9Ta8AaQp9op9Hp9rg8ApmbzeHdOiAlCvXoQrLgEalamfpblbg3cep9Ta3aQp9op9Hp9rg3alaxfpblbg5cep9Ta5aQp9op9Hp9rg5pmbzeHdOiAlCvXoQrLg8EpmbezHdiOAlvCXorQLgQaQpmbedibedibedibediaYp9UgYp9AdbbaiadfglaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaladfglaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaladfglaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaladfglaYaEa8EpmwDKYqk8AExm35Ps8E8FgQaQpmbedibedibedibedip9UgYp9AdbbaladfglaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaladfglaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaladfglaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaladfglaYaLa8ApmwKDYq8AkEx3m5P8Es8FgLa3a5pmwKDYq8AkEx3m5P8Es8Fg8ApmbezHdiOAlvCXorQLgQaQpmbedibedibedibedip9UgYp9AdbbaladfglaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaladfglaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaladfglaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaladfglaYaLa8ApmwDKYqk8AExm35Ps8E8FgQaQpmbedibedibedibedip9UgYp9AdbbaladfglaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaladfglaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaladfglaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaladfhiaXczfgXak6mbkkaHclfgHad6mbkasavcjdfaqad2;8qbbavavcjdfaqcufad2fad;8qbbaqaDfgDae6mbkkcbc99arao9Radcaadca0ESEhokavcj;kbf8Kjjjjbaokwbz:bjjjbk::seHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgwce0mbavc;abfcFecje;8kbavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhDaicefgqarfhidnaeTmbcmcsawceSEhkcbhxcbhmcbhPcbhwcbhlindnaiaD9nmbc9:hoxikdndnaqRbbgoc;Ve0mbavc;abfalaocu7gscl4fcsGcitfgzydlhrazydbhzdnaocsGgHak9pmbavawasfcsGcdtfydbaxaHEhoaHThsdndnadcd9hmbabaPcetfgHaz87ebaHclfao87ebaHcdfar87ebxekabaPcdtfgHazBdbaHcwfaoBdbaHclfarBdbkaxasfhxcdhHavawcdtfaoBdbawasfhwcehsalhOxdkdndnaHcsSmbaHc987aHamffcefhoxekaicefhoai8SbbgHcFeGhsdndnaHcu9mmbaohixekaicvfhiascFbGhscrhHdninao8SbbgOcFbGaHtasVhsaOcu9kmeaocefhoaHcrfgHc8J9hmbxdkkaocefhikasce4cbasceG9R7amfhokdndnadcd9hmbabaPcetfgHaz87ebaHclfao87ebaHcdfar87ebxekabaPcdtfgHazBdbaHcwfaoBdbaHclfarBdbkcdhHavawcdtfaoBdbcehsawcefhwalhOaohmxekdnaocpe0mbaxcefgHavawaDaocsGfRbbgocl49RcsGcdtfydbaocz6gzEhravawao9RcsGcdtfydbaHazfgAaocsGgHEhoaHThCdndnadcd9hmbabaPcetfgHax87ebaHclfao87ebaHcdfar87ebxekabaPcdtfgHaxBdbaHcwfaoBdbaHclfarBdbkcdhsavawcdtfaxBdbavawcefgwcsGcdtfarBdbcihHavc;abfalcitfgOaxBdlaOarBdbavawazfgwcsGcdtfaoBdbalcefcsGhOawaCfhwaxhzaAaCfhxxekaxcbaiRbbgOEgzaoc;:eSgHfhraOcsGhCaOcl4hAdndnaOcs0mbarcefhoxekarhoavawaA9RcsGcdtfydbhrkdndnaCmbaocefhxxekaohxavawaO9RcsGcdtfydbhokdndnaHTmbaicefhHxekaicdfhHai8SbegscFeGhzdnascu9kmbaicofhXazcFbGhzcrhidninaH8SbbgscFbGaitazVhzascu9kmeaHcefhHaicrfgic8J9hmbkaXhHxekaHcefhHkazce4cbazceG9R7amfgmhzkdndnaAcsSmbaHhsxekaHcefhsaH8SbbgicFeGhrdnaicu9kmbaHcvfhXarcFbGhrcrhidninas8SbbgHcFbGaitarVhraHcu9kmeascefhsaicrfgic8J9hmbkaXhsxekascefhskarce4cbarceG9R7amfgmhrkdndnaCcsSmbashixekascefhias8SbbgocFeGhHdnaocu9kmbascvfhXaHcFbGhHcrhodninai8SbbgscFbGaotaHVhHascu9kmeaicefhiaocrfgoc8J9hmbkaXhixekaicefhikaHce4cbaHceG9R7amfgmhokdndnadcd9hmbabaPcetfgHaz87ebaHclfao87ebaHcdfar87ebxekabaPcdtfgHazBdbaHcwfaoBdbaHclfarBdbkcdhsavawcdtfazBdbavawcefgwcsGcdtfarBdbcihHavc;abfalcitfgXazBdlaXarBdbavawaOcz6aAcsSVfgwcsGcdtfaoBdbawaCTaCcsSVfhwalcefcsGhOkaqcefhqavc;abfaOcitfgOarBdlaOaoBdbavc;abfalasfcsGcitfgraoBdlarazBdbawcsGhwalaHfcsGhlaPcifgPae6mbkkcbc99aiaDSEhokavc;aef8Kjjjjbaok:flevu8Jjjjjbcz9Rhvc9:hodnaecvfal0mbcuhoaiRbbc;:eGc;qe9hmbav9cb83iwaicefhraialfc98fhwdnaeTmbdnadcdSmbcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcdtfaic8Etc8F91aicd47avcwfaiceGcdtVgoydbfglBdbaoalBdbaDcefgDae9hmbxdkkcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcetfaic8Etc8F91aicd47avcwfaiceGcdtVgoydbfgl87ebaoalBdbaDcefgDae9hmbkkcbc99arawSEhokaok:wPliuo97eue978Jjjjjbca9Rhiaec98Ghldndnadcl9hmbdnalTmbcbhvabhdinadadpbbbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDpxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpkbbadczfhdavclfgval6mbkkalaeSmeaipxbbbbbbbbbbbbbbbbgqpklbaiabalcdtfgdaeciGglcdtgv;8qbbdnalTmbaiaipblbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDaqp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpklbkadaiav;8qbbskdnalTmbcbhvabhdinadczfgxaxpbbbgopxbbbbbbFFbbbbbbFFgkp9oadpbbbgDaopmbediwDqkzHOAKY8AEgwczp:Reczp:Sep;6egraDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;6eawczp:Sep;6egwp;Gearp;Gep;Kep;Legopxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegrpxb;:FSb;:FSb;:FSb;:FSararp;Meaoaop;Meawaqawamp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFFbbFFbbFFbbFFbbp9oaoawp;Meaqp;Keczp:Rep9qgoarawp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogrpmwDKYqk8AExm35Ps8E8Fp9qpkbbadaDakp9oaoarpmbezHdiOAlvCXorQLp9qpkbbadcafhdavclfgval6mbkkalaeSmbaiaeciGgvcitgdfcbcaad9R;8kbaiabalcitfglad;8qbbdnavTmbaiaipblzgopxbbbbbbFFbbbbbbFFgkp9oaipblbgDaopmbediwDqkzHOAKY8AEgwczp:Reczp:Sep;6egraDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;6eawczp:Sep;6egwp;Gearp;Gep;Kep;Legopxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegrpxb;:FSb;:FSb;:FSb;:FSararp;Meaoaop;Meawaqawamp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFFbbFFbbFFbbFFbbp9oaoawp;Meaqp;Keczp:Rep9qgoarawp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogrpmwDKYqk8AExm35Ps8E8Fp9qpklzaiaDakp9oaoarpmbezHdiOAlvCXorQLp9qpklbkalaiad;8qbbkk;4wllue97euv978Jjjjjbc8W9Rhidnaec98GglTmbcbhvabhoinaiaopbbbgraoczfgwpbbbgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklbaopxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaDakp;Mearp;Keamp9oaqakp;Mearp;Keczp:Rep9qgkpmbezHdiOAlvCXorQLgrp5baipblbpEb:T:j83ibaocwfarp5eaipblbpEe:T:j83ibawaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblbpEd:T:j83ibaocKfakp5eaipblbpEi:T:j83ibaocafhoavclfgval6mbkkdnalaeSmbaiaeciGgvcitgofcbcaao9R;8kbaiabalcitfgwao;8qbbdnavTmbaiaipblbgraipblzgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklaaipxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaDakp;Mearp;Keamp9oaqakp;Mearp;Keczp:Rep9qgkpmbezHdiOAlvCXorQLgrp5baipblapEb:T:j83ibaiarp5eaipblapEe:T:j83iwaiaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblapEd:T:j83izaiakp5eaipblapEi:T:j83iKkawaiao;8qbbkk:Pddiue978Jjjjjbc;ab9Rhidnadcd4ae2glc98GgvTmbcbheabhdinadadpbbbgocwp:Recwp:Sep;6eaocep:SepxbbjFbbjFbbjFbbjFp9opxbbjZbbjZbbjZbbjZp:Uep;Mepkbbadczfhdaeclfgeav6mbkkdnavalSmbaialciGgecdtgdVcbc;abad9R;8kbaiabavcdtfgvad;8qbbdnaeTmbaiaipblbgocwp:Recwp:Sep;6eaocep:SepxbbjFbbjFbbjFbbjFp9opxbbjZbbjZbbjZbbjZp:Uep;Mepklbkavaiad;8qbbkk9teiucbcbydj1jjbgeabcifc98GfgbBdj1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaikkkebcjwklz:Dbb",n=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),i=new Uint8Array([32,0,65,2,1,106,34,33,3,128,11,4,13,64,6,253,10,7,15,116,127,5,8,12,40,16,19,54,20,9,27,255,113,17,42,67,24,23,146,148,18,14,22,45,70,69,56,114,101,21,25,63,75,136,108,28,118,29,73,115]);if(typeof WebAssembly!="object")return{supported:!1};var o=WebAssembly.validate(n)?a(t):a(e),r,s=WebAssembly.instantiate(o,{}).then(function(T){r=T.instance,r.exports.__wasm_call_ctors()});function a(T){for(var C=new Uint8Array(T.length),S=0;S<T.length;++S){var v=T.charCodeAt(S);C[S]=v>96?v-97:v>64?v-39:v+4}for(var D=0,S=0;S<T.length;++S)C[D++]=C[S]<60?i[C[S]]:(C[S]-60)*64+C[++S];return C.buffer.slice(0,D)}function l(T,C,S,v,D,I,L){var M=T.exports.sbrk,N=v+3&-4,B=M(N*D),_=M(I.length),w=new Uint8Array(T.exports.memory.buffer);w.set(I,_);var P=C(B,v,D,_,I.length);if(P==0&&L&&L(B,N,D),S.set(w.subarray(B,B+v*D)),M(B-M(0)),P!=0)throw new Error("Malformed buffer data: "+P)}var u={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},f={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"},d=[],p=0;function g(T){var C={object:new Worker(T),pending:0,requests:{}};return C.object.onmessage=function(S){var v=S.data;C.pending-=v.count,C.requests[v.id][v.action](v.value),delete C.requests[v.id]},C}function m(T){for(var C="self.ready = WebAssembly.instantiate(new Uint8Array(["+new Uint8Array(o)+"]), {}).then(function(result) { result.instance.exports.__wasm_call_ctors(); return result.instance; });self.onmessage = "+x.name+";"+l.toString()+x.toString(),S=new Blob([C],{type:"text/javascript"}),v=URL.createObjectURL(S),D=d.length;D<T;++D)d[D]=g(v);for(var D=T;D<d.length;++D)d[D].object.postMessage({});d.length=T,URL.revokeObjectURL(v)}function b(T,C,S,v,D){for(var I=d[0],L=1;L<d.length;++L)d[L].pending<I.pending&&(I=d[L]);return new Promise(function(M,N){var B=new Uint8Array(S),_=++p;I.pending+=T,I.requests[_]={resolve:M,reject:N},I.object.postMessage({id:_,count:T,size:C,source:B,mode:v,filter:D},[B.buffer])})}function x(T){var C=T.data;if(!C.id)return self.close();self.ready.then(function(S){try{var v=new Uint8Array(C.count*C.size);l(S,S.exports[C.mode],v,C.count,C.size,C.source,S.exports[C.filter]),self.postMessage({id:C.id,count:C.count,action:"resolve",value:v},[v.buffer])}catch(D){self.postMessage({id:C.id,count:C.count,action:"reject",value:D})}})}return{ready:s,supported:!0,useWorkers:function(T){m(T)},decodeVertexBuffer:function(T,C,S,v,D){l(r,r.exports.meshopt_decodeVertexBuffer,T,C,S,v,r.exports[u[D]])},decodeIndexBuffer:function(T,C,S,v){l(r,r.exports.meshopt_decodeIndexBuffer,T,C,S,v)},decodeIndexSequence:function(T,C,S,v){l(r,r.exports.meshopt_decodeIndexSequence,T,C,S,v)},decodeGltfBuffer:function(T,C,S,v,D,I){l(r,r.exports[f[D]],T,C,S,v,r.exports[u[I]])},decodeGltfBufferAsync:function(T,C,S,v,D){return d.length>0?b(T,C,S,f[v],u[D]):s.then(function(){var I=new Uint8Array(T*C);return l(r,r.exports[f[v]],I,T,C,S,r.exports[u[D]]),I})}}}();var Sen=function(){var e="b9H79Tebbbe9Hk9Geueu9Geub9Gbb9Gsuuuuuuuuuuuu99uueu9Gvuuuuub9Gvuuuuue999Gquuuuuuu99uueu9Gwuuuuuu99ueu9Giuuue999Gluuuueu9GiuuueuizsdilvoirwDbqqbeqlve9Weiiviebeoweuecj:Pdkr:Tewo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bbz9TW79O9V9Wt9F79P9T9W29P9M95bl8E9TW79O9V9Wt9F79P9T9W29P9M959x9Pt9OcttV9P9I91tW7bvQ9TW79O9V9Wt9F79P9T9W29P9M959q9V9P9Ut7boX9TW79O9V9Wt9F79P9T9W29P9M959t9J9H2Wbra9TW79O9V9Wt9F9V9Wt9P9T9P96W9wWVtW94SWt9J9O9sW9T9H9Wbwl79IV9RbDDwebcekdmxq;UMesdbk:kfvKue99euY99Qu8Jjjjjbc;W;qb9Rgs8Kjjjjbcbhzascxfcbc;Kbz:ljjjb8AdnabaeSmbabaeadcdtz:kjjjb8AkdnamcdGTmbalcrfci4gHcbyd;S1jjbHjjjjbbheascxfasyd2gOcdtfaeBdbasaOcefBd2aecbaHz:ljjjbhAcbhlcbhednadTmbcbhlabheadhHinaAaeydbgOci4fgCaCRbbgCceaOcrGgOtV86bbaCcu7aO4ceGalfhlaeclfheaHcufgHmbkcualcdtalcFFFFi0Ehekaecbyd;S1jjbHjjjjbbhzascxfasyd2gecdtfazBdbasaecefBd2alcd4alfhOcehHinaHgecethHaeaO6mbkcbhXcuaecdtgOaecFFFFi0Ecbyd;S1jjbHjjjjbbhHascxfasyd2gCcdtfaHBdbasaCcefBd2aHcFeaOz:ljjjbhQdnadTmbaecufhCcbhLinabaXcdtfgKydbgAc:v;t;h;Ev2hOcbhedndninaQaOaCGgOcdtfgYydbgHcuSmeazaHcdtfydbaASmdaecefgeaOfhOaeaC9nmbxdkkazaLcdtfaABdbaYaLBdbaLhHaLcefhLkaKaHBdbaXcefgXad9hmbkkaQcbyd;O1jjbH:bjjjbbasasyd2cufBd2kcualcefgecdtaecFFFFi0Ecbyd;S1jjbHjjjjbbh8Aascxfasyd2gecdtfa8ABdbasa8ABdlasaecefBd2cuadcitadcFFFFe0Ecbyd;S1jjbHjjjjbbhEascxfasyd2gecdtfaEBdbasaEBdwasaecefBd2asclfabadalcbz:cjjjbcualcdtg3alcFFFFi0Eg5cbyd;S1jjbHjjjjbbhQascxfasyd2gecdtfaQBdbasaecefBd2a5cbyd;S1jjbHjjjjbbh8Eascxfasyd2gecdtfa8EBdbasaecefBd2alcd4alfhOcehHinaHgecethHaeaO6mbkcbhLcuaecdtgOaecFFFFi0Ecbyd;S1jjbHjjjjbbhHascxfasyd2gCcdtfaHBdbasaCcefBd2aHcFeaOz:ljjjbhXdnalTmbavcd4hCaecufhHinaLhednazTmbazaLcdtfydbhekaiaeaC2cdtfgeydlgOcH4aO7c:F:b:DD2aeydbgOcH4aO7c;D;O:B8J27aeydwgecH4ae7c:3F;N8N27aHGheaLcdth8FdndndndndnazTmbaza8FfhKcbhOinaXaecdtfgYydbgAcuSmlaiazaAcdtfydbaC2cdtfaiaKydbaC2cdtfcxz:ojjjbTmiaOcefgOaefaHGheaOaH9nmbxdkkaiaLaC2cdtfhKcbhOinaXaecdtfgYydbgAcuSmiaiaAaC2cdtfaKcxz:ojjjbTmdaOcefgOaefaHGheaOaH9nmbkkcbhYkaYydbgecu9hmekaYaLBdbaLhekaQa8FfaeBdbaLcefgLal9hmbkcbhea8EhHinaHaeBdbaHclfhHalaecefge9hmbkcbheaQhHa8EhOindnaeaHydbgCSmbaOa8EaCcdtfgCydbBdbaCaeBdbkaHclfhHaOclfhOalaecefge9hmbkkcbhaaXcbyd;O1jjbH:bjjjbbasasyd2cufBd2alcbyd;S1jjbHjjjjbbhXascxfasyd2gecdtfaXBdbasaecefBd2a5cbyd;S1jjbHjjjjbbheascxfasyd2gHcdtfaeBdbasaHcefBd2a5cbyd;S1jjbHjjjjbbhHascxfasyd2gOcdtfaHBdbasaOcefBd2aecFea3z:ljjjbhhaHcFea3z:ljjjbhgdnalTmbaEcwfh8Jindna8AaagOcefgacdtfydbgCa8AaOcdtgefydbgHSmbaCaH9Rh8FaEaHcitfh3agaefh8KahaefhLcbhAindndna3aAcitfydbgYaO9hmbaLaOBdba8KaOBdbxekdna8AaYcdtg8LfgeclfydbgHaeydbgeSmbaEaecitgCfydbaOSmeaHae9Rh8Maecu7aHfhKa8JaCfhHcbheinaKaeSmeaecefheaHydbhCaHcwfhHaCaO9hmbkaea8M6mekaga8LfgeaOaYaeydbcuSEBdbaLaYaOaLydbcuSEBdbkaAcefgAa8F9hmbkkaaal9hmbkaQhHa8EhOaghCahhAcbheindndnaeaHydbgY9hmbdnaeaOydbgY9hmbaAydbhYdnaCydbgKcu9hmbaYcu9hmbaXaefcb86bbxikaXaefhLdnaeaKSmbaeaYSmbaLce86bbxikaLcl86bbxdkdnaea8EaYcdtgKfydb9hmbdnaCydbgLcuSmbaeaLSmbaAydbg8FcuSmbaea8FSmbagaKfydbg3cuSmba3aYSmbahaKfydbgKcuSmbaKaYSmbdnaQaLcdtfydbgYaQaKcdtfydb9hmbaYaQa8FcdtfydbgKSmbaKaQa3cdtfydb9hmbaXaefcd86bbxlkaXaefcl86bbxikaXaefcl86bbxdkaXaefcl86bbxekaXaefaXaYfRbb86bbkaHclfhHaOclfhOaCclfhCaAclfhAalaecefge9hmbkdnaqTmbdndnazTmbazheaQhHalhOindnaqaeydbfRbbTmbaXaHydbfcl86bbkaeclfheaHclfhHaOcufgOmbxdkkaQhealhHindnaqRbbTmbaXaeydbfcl86bbkaqcefhqaeclfheaHcufgHmbkkaQhealhOaXhHindnaXaeydbfRbbcl9hmbaHcl86bbkaeclfheaHcefhHaOcufgOmbkkamceGTmbaXhealhHindnaeRbbce9hmbaecl86bbkaecefheaHcufgHmbkkcualcx2alc;v:Q;v:Qe0Ecbyd;S1jjbHjjjjbbhaascxfasyd2gecdtfaaBdbasaecefBd2aaaialavazz:djjjbh8NdndnaDmbcbhycbh8Jxekcbh8JawhecbhHindnaeIdbJbbbb9ETmbasc;Wbfa8JcdtfaHBdba8Jcefh8JkaeclfheaDaHcefgH9hmbkcua8Jal2gecdtaecFFFFi0Ecbyd;S1jjbHjjjjbbhyascxfasyd2gecdtfayBdbasaecefBd2alTmba8JTmbarcd4hLdnazTmba8JcdthicbhYayhKinaoazaYcdtfydbaL2cdtfhAasc;WbfheaKhHa8JhOinaHaAaeydbcdtgCfIdbawaCfIdbNUdbaeclfheaHclfhHaOcufgOmbkaKaifhKaYcefgYal9hmbxdkka8JcdthicbhYayhKinaoaYaL2cdtfhAasc;WbfheaKhHa8JhOinaHaAaeydbcdtgCfIdbawaCfIdbNUdbaeclfheaHclfhHaOcufgOmbkaKaifhKaYcefgYal9hmbkkcualc8S2gHalc;D;O;f8U0EgCcbyd;S1jjbHjjjjbbheascxfasyd2gOcdtfaeBdbasaOcefBd2aecbaHz:ljjjbhqdndndndna8JTmbaCcbyd;S1jjbHjjjjbbhvascxfasyd2gecdtfavBdbcehOasaecefBd2avcbaHz:ljjjb8Acua8Jal2gecltgHaecFFFFb0Ecbyd;S1jjbHjjjjbbhrascxfasyd2gecdtfarBdbasaecefBd2arcbaHz:ljjjb8AadmexikcbhvadTmecbhrkcbhAabhHindnaaaHclfydbgYcx2fgeIdbaaaHydbgKcx2fgOIdbg8P:tgIaaaHcwfydbgLcx2fgCIdlaOIdlg8R:tg8SNaCIdba8P:tgRaeIdla8R:tg8UN:tg8Va8VNa8UaCIdwaOIdwg8W:tg8XNa8SaeIdwa8W:tg8UN:tg8Sa8SNa8UaRNa8XaIN:tgIaINMM:rgRJbbbb9ETmba8VaR:vh8VaIaR:vhIa8SaR:vh8SkaqaQaKcdtfydbc8S2fgea8SaR:rgRa8SNNg8UaeIdbMUdbaeaIaRaINg8YNg8XaeIdlMUdlaea8VaRa8VNg8ZNg80aeIdwMUdwaea8Ya8SNg8YaeIdxMUdxaea8Za8SNg81aeIdzMUdzaea8ZaINg8ZaeIdCMUdCaea8SaRa8Va8WNa8Sa8PNa8RaINMM:mg8RNg8PNg8SaeIdKMUdKaeaIa8PNgIaeId3MUd3aea8Va8PNg8VaeIdaMUdaaea8Pa8RNg8PaeId8KMUd8KaeaRaeIdyMUdyaqaQaYcdtfydbc8S2fgea8UaeIdbMUdbaea8XaeIdlMUdlaea80aeIdwMUdwaea8YaeIdxMUdxaea81aeIdzMUdzaea8ZaeIdCMUdCaea8SaeIdKMUdKaeaIaeId3MUd3aea8VaeIdaMUdaaea8PaeId8KMUd8KaeaRaeIdyMUdyaqaQaLcdtfydbc8S2fgea8UaeIdbMUdbaea8XaeIdlMUdlaea80aeIdwMUdwaea8YaeIdxMUdxaea81aeIdzMUdzaea8ZaeIdCMUdCaea8SaeIdKMUdKaeaIaeId3MUd3aea8VaeIdaMUdaaea8PaeId8KMUd8KaeaRaeIdyMUdyaHcxfhHaAcifgAad6mbkcbhiabhKinabaicdtfhYcbhHinaXaYaHc:G1jjbfydbcdtfydbgOfRbbhedndnaXaKaHfydbgCfRbbgAc99fcFeGcpe0mbaeceSmbaecd9hmekdnaAcufcFeGce0mbahaCcdtfydbaO9hmekdnaecufcFeGce0mbagaOcdtfydbaC9hmekdnaAcv2aefcj1jjbfRbbTmbaQaOcdtfydbaQaCcdtfydb0mekJbbacJbbacJbbjZaeceSEaAceSEh8ZdnaaaYaHc:K1jjbfydbcdtfydbcx2fgeIdwaaaCcx2fgAIdwg8R:tg8VaaaOcx2fgLIdwa8R:tg8Sa8SNaLIdbaAIdbg8W:tgIaINaLIdlaAIdlg8U:tgRaRNMMg8PNa8Va8SNaeIdba8W:tg80aINaRaeIdla8U:tg8YNMMg8Xa8SN:tg8Va8VNa80a8PNa8XaIN:tg8Sa8SNa8Ya8PNa8XaRN:tgIaINMM:rgRJbbbb9ETmba8VaR:vh8VaIaR:vhIa8SaR:vh8SkaqaQaCcdtfydbc8S2fgea8Sa8Za8P:rNgRa8SNNg8XaeIdbMUdbaeaIaRaINg8ZNg80aeIdlMUdlaea8VaRa8VNg8PNg8YaeIdwMUdwaea8Za8SNg8ZaeIdxMUdxaea8Pa8SNg81aeIdzMUdzaea8PaINgBaeIdCMUdCaea8SaRa8Va8RNa8Sa8WNa8UaINMM:mg8RNg8PNg8SaeIdKMUdKaeaIa8PNgIaeId3MUd3aea8Va8PNg8VaeIdaMUdaaea8Pa8RNg8PaeId8KMUd8KaeaRaeIdyMUdyaqaQaOcdtfydbc8S2fgea8XaeIdbMUdbaea80aeIdlMUdlaea8YaeIdwMUdwaea8ZaeIdxMUdxaea81aeIdzMUdzaeaBaeIdCMUdCaea8SaeIdKMUdKaeaIaeId3MUd3aea8VaeIdaMUdaaea8PaeId8KMUd8KaeaRaeIdyMUdykaHclfgHcx9hmbkaKcxfhKaicifgiad6mbkdna8JTmbcbhKinJbbbbh8WaaabaKcdtfgeclfydbgLcx2fgHIdwaaaeydbgicx2fgOIdwg8Y:tgIaINaHIdbaOIdbg81:tg8Va8VNaHIdlaOIdlgB:tgRaRNMMg8Zaaaecwfydbg8Fcx2fgeIdwa8Y:tg8PNaIaIa8PNa8VaeIdba81:tg8RNaRaeIdlaB:tg8UNMMg8SN:tJbbbbJbbjZa8Za8Pa8PNa8Ra8RNa8Ua8UNMMg80Na8Sa8SN:tg8X:va8XJbbbb9BEg8XNh83a80aINa8Pa8SN:ta8XNhUa8Za8UNaRa8SN:ta8XNh85a80aRNa8Ua8SN:ta8XNh86a8Za8RNa8Va8SN:ta8XNh87a80a8VNa8Ra8SN:ta8XNh88a8Va8UNa8RaRN:tg8Sa8SNaRa8PNa8UaIN:tg8Sa8SNaIa8RNa8Pa8VN:tg8Sa8SNMM:rJbbbZNh8Sayaia8J2g3cdtfhHaya8Fa8J2gwcdtfhOayaLa8J2g8LcdtfhCa8Y:mh89aB:mh8:a81:mhZcbhAa8JhYJbbbbh8UJbbbbh8XJbbbbh8ZJbbbbh80Jbbbbh8YJbbbbh81JbbbbhBJbbbbhnJbbbbhcinasc;WbfaAfgecwfa8SaUaCIdbaHIdbg8P:tgRNa83aOIdba8P:tg8RNMgINUdbaeclfa8Sa86aRNa85a8RNMg8VNUdbaea8Sa88aRNa87a8RNMgRNUdbaecxfa8Sa89aINa8:a8VNa8PaZaRNMMMg8PNUdba8SaIa8VNNa80Mh80a8SaIaRNNa8YMh8Ya8Sa8VaRNNa81Mh81a8Sa8Pa8PNNa8WMh8Wa8SaIa8PNNa8UMh8Ua8Sa8Va8PNNa8XMh8Xa8SaRa8PNNa8ZMh8Za8SaIaINNaBMhBa8Sa8Va8VNNanMhna8SaRaRNNacMhcaHclfhHaCclfhCaOclfhOaAczfhAaYcufgYmbkavaic8S2fgeacaeIdbMUdbaeanaeIdlMUdlaeaBaeIdwMUdwaea81aeIdxMUdxaea8YaeIdzMUdzaea80aeIdCMUdCaea8ZaeIdKMUdKaea8XaeId3MUd3aea8UaeIdaMUdaaea8WaeId8KMUd8Kaea8SaeIdyMUdyavaLc8S2fgeacaeIdbMUdbaeanaeIdlMUdlaeaBaeIdwMUdwaea81aeIdxMUdxaea8YaeIdzMUdzaea80aeIdCMUdCaea8ZaeIdKMUdKaea8XaeId3MUd3aea8UaeIdaMUdaaea8WaeId8KMUd8Kaea8SaeIdyMUdyava8Fc8S2fgeacaeIdbMUdbaeanaeIdlMUdlaeaBaeIdwMUdwaea81aeIdxMUdxaea8YaeIdzMUdzaea80aeIdCMUdCaea8ZaeIdKMUdKaea8XaeId3MUd3aea8UaeIdaMUdaaea8WaeId8KMUd8Kaea8SaeIdyMUdyara3cltfhYcbhHa8JhCinaYaHfgeasc;WbfaHfgOIdbaeIdbMUdbaeclfgAaOclfIdbaAIdbMUdbaecwfgAaOcwfIdbaAIdbMUdbaecxfgeaOcxfIdbaeIdbMUdbaHczfhHaCcufgCmbkara8LcltfhYcbhHa8JhCinaYaHfgeasc;WbfaHfgOIdbaeIdbMUdbaeclfgAaOclfIdbaAIdbMUdbaecwfgAaOcwfIdbaAIdbMUdbaecxfgeaOcxfIdbaeIdbMUdbaHczfhHaCcufgCmbkarawcltfhYcbhHa8JhCinaYaHfgeasc;WbfaHfgOIdbaeIdbMUdbaeclfgAaOclfIdbaAIdbMUdbaecwfgAaOcwfIdbaAIdbMUdbaecxfgeaOcxfIdbaeIdbMUdbaHczfhHaCcufgCmbkaKcifgKad6mbkkcbhOxekcehOcbhrkcbh8FdndnamcwGg9cmbJbbbbh8ZcbhJcbhocbhCxekcbhea5cbyd;S1jjbHjjjjbbhCascxfasyd2gHcdtfaCBdbasaHcefBd2dnalTmbaChHinaHaeBdbaHclfhHalaecefge9hmbkkdnaOmbcbhiinabaicdtfhLcbhKinaQaLaKcdtgec:G1jjbfydbcdtfydbcdtfydbhHdnaCaQaLaefydbcdtfydbgOcdtfgAydbgeaOSmbinaAaCaegOcdtfgYydbgeBdbaYhAaOae9hmbkkdnaCaHcdtfgAydbgeaHSmbinaAaCaegHcdtfgYydbgeBdbaYhAaHae9hmbkkdnaOaHSmbaCaOaHaOaH0EcdtfaOaHaOaH6EBdbkaKcefgKci9hmbkaicifgiad6mbkkcbhJdnalTmbcbhYindnaQaYcdtgefydbaY9hmbaYhHdnaCaefgKydbgeaYSmbaKhOinaOaCaegHcdtfgAydbgeBdbaAhOaHae9hmbkkaKaHBdbkaYcefgYal9hmbkcbheaQhOaChHcbhJindndnaeaOydbgA9hmbdnaeaHydbgA9hmbaHaJBdbaJcefhJxdkaHaCaAcdtfydbBdbxekaHaCaAcdtfydbBdbkaOclfhOaHclfhHalaecefge9hmbkkcuaJcltgeaJcjjjjiGEcbyd;S1jjbHjjjjbbhoascxfasyd2gHcdtfaoBdbasaHcefBd2aocbaez:ljjjbhAdnalTmbaChOaahealhYinaecwfIdbh8SaeclfIdbhIaAaOydbcltfgHaeIdbaHIdbMUdbaHclfgKaIaKIdbMUdbaHcwfgKa8SaKIdbMUdbaHcxfgHaHIdbJbbjZMUdbaOclfhOaecxfheaYcufgYmbkkdnaJTmbaAheaJhHinaecxfgOIdbh8SaOcbBdbaeaeIdbJbbbbJbbjZa8S:va8SJbbbb9BEg8SNUdbaeclfgOa8SaOIdbNUdbaecwfgOa8SaOIdbNUdbaeczfheaHcufgHmbkkdnalTmbaChOaahealhYinaAaOydbcltfgHcxfgKaecwfIdbaHcwfIdb:tg8Sa8SNaeIdbaHIdb:tg8Sa8SNaeclfIdbaHclfIdb:tg8Sa8SNMMg8SaKIdbgIaIa8S9DEUdbaOclfhOaecxfheaYcufgYmbkkdnaJmbcbhJJFFuuh8ZxekaAcxfheaAhHaJhOinaHaeIdbUdbaeczfheaHclfhHaOcufgOmbkJFFuuh8ZaAheaJhHinaeIdbg8Sa8Za8Za8S9EEh8ZaeclfheaHcufgHmbkkasydlh9ednalTmba9eclfhea9eydbhAaXhHalhYcbhOincbaeydbgKaA9RaHRbbcpeGEaOfhOaHcefhHaeclfheaKhAaYcufgYmbkaOce4h8Fkcuada8F9RcifgTcx2aTc;v:Q;v:Qe0Ecbyd;S1jjbHjjjjbbhDascxfasyd2gecdtfaDBdbasaecefBd2cuaTcdtaTcFFFFi0Ecbyd;S1jjbHjjjjbbhSascxfasyd2gecdtfaSBdbasaecefBd2a5cbyd;S1jjbHjjjjbbh8Mascxfasyd2gecdtfa8MBdbasaecefBd2alcbyd;S1jjbHjjjjbbh9hascxfasyd2gecdtfa9hBdbasaecefBd2axaxNa8NJbbjZamclGEg83a83N:vhcJbbbbhndnadak9nmbdnaTci6mba8Jclth9iaDcwfh6JbbbbhBJbbbbhninasclfabadalaQz:cjjjbabh8FcbhEcbh5inaba5cdtfh3cbheindnaQa8FaefydbgOcdtgifydbgYaQa3aec:W1jjbfydbcdtfydbgHcdtgwfydbgKSmbaXaHfRbbgLcv2aXaOfRbbgAfc;a1jjbfRbbg8AaAcv2aLfg8Lc;a1jjbfRbbg8KVcFeGTmbdnaKaY9nmba8Lcj1jjbfRbbcFeGmekaAcufhYdnaAaL9hmbaYcFeGce0mbahaifydbaH9hmekdndnaAclSmbaLcl9hmekdnaYcFeGce0mbahaifydbaH9hmdkaLcufcFeGce0mbagawfydbaO9hmekaDaEcx2fgAaHaOa8KcFeGgYEBdlaAaOaHaYEBdbaAaYa8AGcb9hBdwaEcefhEkaeclfgecx9hmbkdna5cifg5ad9pmba8Fcxfh8FaEcifaT9nmekkaETmdcbhiinJbbbbJbbjZaqaQaDaicx2fgAydlgKaAydbgYaAydwgHEgLcdtfydbc8S2fgeIdyg8S:va8SJbbbb9BEaeIdwaaaYaKaHEg8Fcx2fgHIdwgRNaeIdzaHIdbg8PNaeIdaMg8Sa8SMMaRNaeIdlaHIdlg8RNaeIdCaRNaeId3Mg8Sa8SMMa8RNaeIdba8PNaeIdxa8RNaeIdKMg8Sa8SMMa8PNaeId8KMMM:lNh80JbbbbJbbjZaqaQaYcdtfydbc8S2fgeIdyg8S:va8SJbbbb9BEaeIdwaaaKcx2fgHIdwg8VNaeIdzaHIdbg8WNaeIdaMg8Sa8SMMa8VNaeIdlaHIdlg8UNaeIdCa8VNaeId3Mg8Sa8SMMa8UNaeIdba8WNaeIdxa8UNaeIdKMg8Sa8SMMa8WNaeId8KMMM:lNh8YaAcwfh3aAclfhwdna8JTmbavaYc8S2fgOIdwa8VNaOIdza8WNaOIdaMg8Sa8SMMa8VNaOIdla8UNaOIdCa8VNaOId3Mg8Sa8SMMa8UNaOIdba8WNaOIdxa8UNaOIdKMg8Sa8SMMa8WNaOId8KMMMh8SayaKa8J2cdtfhHaraYa8J2cltfheaOIdyh8Xa8JhOinaHIdbgIaIa8XNaecxfIdba8VaecwfIdbNa8WaeIdbNa8UaeclfIdbNMMMgIaIM:tNa8SMh8SaHclfhHaeczfheaOcufgOmbkavaLc8S2fgOIdwaRNaOIdza8PNaOIdaMgIaIMMaRNaOIdla8RNaOIdCaRNaOId3MgIaIMMa8RNaOIdba8PNaOIdxa8RNaOIdKMgIaIMMa8PNaOId8KMMMhIaya8Fa8J2cdtfhHaraLa8J2cltfheaOIdyh8Wa8JhOinaHIdbg8Va8Va8WNaecxfIdbaRaecwfIdbNa8PaeIdbNa8RaeclfIdbNMMMg8Va8VM:tNaIMhIaHclfhHaeczfheaOcufgOmbka80aI:lMh80a8Ya8S:lMh8YkawaKa8Fa8Ya809FgeEBdbaAaYaLaeEBdba3a8Ya80aeEUdbaicefgiaE9hmbkasc;Wbfcbcj;qbz:ljjjb8Aa6heaEhHinasc;WbfaeydbcA4cF8FGgOcFAaOcFA6EcdtfgOaOydbcefBdbaecxfheaHcufgHmbkcbhecbhHinasc;WbfaefgOydbhAaOaHBdbaAaHfhHaeclfgecj;qb9hmbkcbhea6hHinasc;WbfaHydbcA4cF8FGgOcFAaOcFA6EcdtfgOaOydbgOcefBdbaSaOcdtfaeBdbaHcxfhHaEaecefge9hmbkadak9RgOci9Uh9kdnalTmbcbhea8MhHinaHaeBdbaHclfhHalaecefge9hmbkkcbh0a9hcbalz:ljjjbh9maOcO9Uh9na9kce4h9oasydwh9pcbh8KcbhwdninaDaSawcdtfydbcx2fg3Idwg8Sac9Emea8Ka9k9pmeJFFuuhIdna9oaE9pmbaDaSa9ocdtfydbcx2fIdwJbb;aZNhIkdna8SaI9ETmba8San9ETmba8Ka9n0mdkdna9maQa3ydlgicdtg9qfydbgAfg9rRbba9maQa3ydbgLcdtg9sfydbgHfg9tRbbVmbaXaLfRbbh9udna9eaHcdtfgeclfydbgOaeydbgeSmbaOae9RhKa9paecitfheaaaAcx2fg8Lcwfh5a8Lclfh9vaaaHcx2fg8Acwfh9wa8Aclfh9xcbhHceh8Fdnindna8MaeydbcdtfydbgOaASmba8MaeclfydbcdtfydbgYaASmbaOaYSmbaaaYcx2fgYIdbaaaOcx2fgOIdbg8V:tg8Sa9xIdbaOIdlgR:tg8WNa8AIdba8V:tg8UaYIdlaR:tgIN:tg8Pa8Sa9vIdbaR:tg8XNa8LIdba8V:tg80aIN:tgRNaIa9wIdbaOIdwg8R:tg8YNa8WaYIdwa8R:tg8VN:tg8WaIa5Idba8R:tg81Na8Xa8VN:tgINa8Va8UNa8Ya8SN:tg8Ra8Va80Na81a8SN:tg8SNMMa8Pa8PNa8Wa8WNa8Ra8RNMMaRaRNaIaINa8Sa8SNMMN:rJbbj8:N9FmdkaecwfheaHcefgHaK6h8FaKaH9hmbkka8FceGTmba9ocefh9oxeka3cwfhHdndndndna9uc9:fPdebdkaLheina8MaecdtgefaiBdba8EaefydbgeaL9hmbxikkdnagahaha9sfydbaiSEa8Ea9sfydbgLcdtfydbgecu9hmba8Ea9qfydbheka8Ma9sfaiBdbaehika8MaLcdtfaiBdbka9tce86bba9rce86bbaHIdbg8Sanana8S9DEhna0cefh0cecda9uceSEa8Kfh8KkawcefgwaE9hmbkka0TmddnalTmbcbhKcbhiindna8MaicdtgefydbgOaiSmbaQaOcdtfydbh8FdnaiaQaefydb9hg3mbaqa8Fc8S2fgeaqaic8S2fgHIdbaeIdbMUdbaeaHIdlaeIdlMUdlaeaHIdwaeIdwMUdwaeaHIdxaeIdxMUdxaeaHIdzaeIdzMUdzaeaHIdCaeIdCMUdCaeaHIdKaeIdKMUdKaeaHId3aeId3MUd3aeaHIdaaeIdaMUdaaeaHId8KaeId8KMUd8KaeaHIdyaeIdyMUdyka8JTmbavaOc8S2fgeavaic8S2gwfgHIdbaeIdbMUdbaeaHIdlaeIdlMUdlaeaHIdwaeIdwMUdwaeaHIdxaeIdxMUdxaeaHIdzaeIdzMUdzaeaHIdCaeIdCMUdCaeaHIdKaeIdKMUdKaeaHId3aeId3MUd3aeaHIdaaeIdaMUdaaeaHId8KaeId8KMUd8KaeaHIdyaeIdyMUdya9iaO2hLarhHa8JhAinaHaLfgeaHaKfgOIdbaeIdbMUdbaeclfgYaOclfIdbaYIdbMUdbaecwfgYaOcwfIdbaYIdbMUdbaecxfgeaOcxfIdbaeIdbMUdbaHczfhHaAcufgAmbka3mbJbbbbJbbjZaqawfgeIdyg8S:va8SJbbbb9BEaeIdwaaa8Fcx2fgHIdwg8SNaeIdzaHIdbgINaeIdaMg8Va8VMMa8SNaeIdlaHIdlg8VNaeIdCa8SNaeId3Mg8Sa8SMMa8VNaeIdbaINaeIdxa8VNaeIdKMg8Sa8SMMaINaeId8KMMM:lNg8SaBaBa8S9DEhBkaKa9ifhKaicefgial9hmbkcbhHahheindnaeydbgOcuSmbdnaHa8MaOcdtgAfydbgO9hmbcuhOahaAfydbgAcuSmba8MaAcdtfydbhOkaeaOBdbkaeclfhealaHcefgH9hmbkcbhHagheindnaeydbgOcuSmbdnaHa8MaOcdtgAfydbgO9hmbcuhOagaAfydbgAcuSmba8MaAcdtfydbhOkaeaOBdbkaeclfhealaHcefgH9hmbkkaBana8JEhBcbhYabhecbhKindna8MaeydbcdtfydbgHa8MaeclfydbcdtfydbgOSmbaHa8MaecwfydbcdtfydbgASmbaOaASmbabaYcdtfgLaHBdbaLcwfaABdbaLclfaOBdbaYcifhYkaecxfheaKcifgKad6mbkdndna9cTmbaYak9nmba8ZaB9FTmbcbhdabhecbhHindnaoaCaeydbgOcdtfydbcdtfIdbaB9ETmbabadcdtfgAaOBdbaAclfaeclfydbBdbaAcwfaecwfydbBdbadcifhdkaecxfheaHcifgHaY6mbkJFFuuh8ZaJTmeaoheaJhHJFFuuh8SinaeIdbgIa8Sa8SaI9EEg8Va8SaIaB9EgOEh8Sa8Va8ZaOEh8ZaeclfheaHcufgHmbxdkkaYhdkadak0mbxdkkasclfabadalaQz:cjjjbkdndnadak0mbadhOxekdna9cmbadhOxekdna8Zac9FmbadhOxekina8ZJbb;aZNg8Saca8Sac9DEh8VJbbbbh8SdnaJTmbaoheaJhHinaeIdbgIa8SaIa8V9FEa8SaIa8S9EEh8SaeclfheaHcufgHmbkkcbhOabhecbhHindnaoaCaeydbgAcdtfydbcdtfIdba8V9ETmbabaOcdtfgYaABdbaYclfaeclfydbBdbaYcwfaecwfydbBdbaOcifhOkaecxfheaHcifgHad6mbkJFFuuh8ZdnaJTmbaoheaJhHJFFuuhIinaeIdbgRaIaIaR9EEg8PaIaRa8V9EgAEhIa8Pa8ZaAEh8ZaeclfheaHcufgHmbkkdnaOad9hmbadhOxdka8Sanana8S9DEhnaOak9nmeaOhda8Zac9FmbkkdnamcjjjjlGTmbazmbaOTmbcbhQabheinaXaeydbgAfRbbc3thKaecwfgLydbhHdndnahaAcdtg8FfydbaeclfgiydbgCSmbcbhYagaCcdtfydbaA9hmekcjjjj94hYkaeaKaYVaAVBdbaXaCfRbbc3thKdndnahaCcdtfydbaHSmbcbhYagaHcdtfydbaC9hmekcjjjj94hYkaiaKaYVaCVBdbaXaHfRbbc3thYdndnahaHcdtfydbaASmbcbhCaga8FfydbaH9hmekcjjjj94hCkaLaYaCVaHVBdbaecxfheaQcifgQaO6mbkkdnazTmbaOTmbaOheinabazabydbcdtfydbBdbabclfhbaecufgembkkdnaPTmbaPa83an:rNUdbkasyd2gecdtascxffc98fhHdninaeTmeaHydbcbyd;O1jjbH:bjjjbbaHc98fhHaecufhexbkkasc;W;qbf8KjjjjbaOk;Yieouabydlhvabydbclfcbaicdtz:ljjjbhoadci9UhrdnadTmbdnalTmbaehwadhDinaoalawydbcdtfydbcdtfgqaqydbcefBdbawclfhwaDcufgDmbxdkkaehwadhDinaoawydbcdtfgqaqydbcefBdbawclfhwaDcufgDmbkkdnaiTmbcbhDaohwinawydbhqawaDBdbawclfhwaqaDfhDaicufgimbkkdnadci6mbinaecwfydbhwaeclfydbhDaeydbhidnalTmbalawcdtfydbhwalaDcdtfydbhDalaicdtfydbhikavaoaicdtfgqydbcitfaDBdbavaqydbcitfawBdlaqaqydbcefBdbavaoaDcdtfgqydbcitfawBdbavaqydbcitfaiBdlaqaqydbcefBdbavaoawcdtfgwydbcitfaiBdbavawydbcitfaDBdlawawydbcefBdbaecxfhearcufgrmbkkabydbcbBdbk;Podvuv998Jjjjjbca9RgvcFFF;7rBd3av9cFFF;7;3FF:;Fb83dCavcFFF97Bdzav9cFFF;7FFF:;u83dwdnadTmbaicd4hodnabmbdnalTmbcbhrinaealarcdtfydbao2cdtfhwcbhiinavcCfaifgDawaifIdbgqaDIdbgkakaq9EEUdbavcwfaifgDaqaDIdbgkakaq9DEUdbaiclfgicx9hmbkarcefgrad9hmbxikkaocdthrcbhwincbhiinavcCfaifgDaeaifIdbgqaDIdbgkakaq9EEUdbavcwfaifgDaqaDIdbgkakaq9DEUdbaiclfgicx9hmbkaearfheawcefgwad9hmbxdkkdnalTmbcbhrinabarcx2fgiaealarcdtfydbao2cdtfgwIdbUdbaiawIdlUdlaiawIdwUdwcbhiinavcCfaifgDawaifIdbgqaDIdbgkakaq9EEUdbavcwfaifgDaqaDIdbgkakaq9DEUdbaiclfgicx9hmbkarcefgrad9hmbxdkkaocdthlcbhraehwinabarcx2fgiaearao2cdtfgDIdbUdbaiaDIdlUdlaiaDIdwUdwcbhiinavcCfaifgDawaifIdbgqaDIdbgkakaq9EEUdbavcwfaifgDaqaDIdbgkakaq9DEUdbaiclfgicx9hmbkawalfhwarcefgrad9hmbkkJbbbbavIdwavIdCgk:tgqaqJbbbb9DEgqavIdxavIdKgx:tgmamaq9DEgqavIdzavId3gm:tgPaPaq9DEhPdnabTmbadTmbJbbbbJbbjZaP:vaPJbbbb9BEhqinabaqabIdbak:tNUdbabclfgvaqavIdbax:tNUdbabcwfgvaqavIdbam:tNUdbabcxfhbadcufgdmbkkaPk8MbabaeadaialavcbcbcbcbcbaoarawaDz:bjjjbk8MbabaeadaialavaoarawaDaqakaxamaPz:bjjjbk:nCoDud99rue99lul998Jjjjjbc;Wb9Rgw8KjjjjbdndnarmbcbhDxekawcxfcbc;Kbz:ljjjb8Aawcuadcx2adc;v:Q;v:Qe0Ecbyd;S1jjbHjjjjbbgqBdxawceBd2aqaeadaicbz:djjjb8AawcuadcdtadcFFFFi0Egkcbyd;S1jjbHjjjjbbgxBdzawcdBd2adcd4adfhmceheinaegicetheaiam6mbkcbhPawcuaicdtgsaicFFFFi0Ecbyd;S1jjbHjjjjbbgzBdCawciBd2dndnar:ZgH:rJbbbZMgO:lJbbb9p9DTmbaO:Ohexekcjjjj94hekaicufhAc:bwhmcbhCadhXcbhQinaChLaeamgKcufaeaK9iEaPgDcefaeaD9kEhYdndnadTmbaYcuf:YhOaqhiaxheadhmindndnaiIdbaONJbbbZMg8A:lJbbb9p9DTmba8A:OhCxekcjjjj94hCkaCcCthCdndnaiclfIdbaONJbbbZMg8A:lJbbb9p9DTmba8A:OhExekcjjjj94hEkaEcqtaCVhCdndnaicwfIdbaONJbbbZMg8A:lJbbb9p9DTmba8A:OhExekcjjjj94hEkaeaCaEVBdbaicxfhiaeclfheamcufgmmbkazcFeasz:ljjjbh3cbh5cbh8Eindna3axa8EcdtfydbgCcm4aC7c:v;t;h;Ev2gics4ai7aAGgmcdtfgEydbgecuSmbaeaCSmbcehiina3amaifaAGgmcdtfgEydbgecuSmeaicefhiaeaC9hmbkkaEaCBdba5aecuSfh5a8Ecefg8Ead9hmbxdkkazcFeasz:ljjjb8Acbh5kaDaYa5ar0giEhPaLa5aiEhCdna5arSmbaYaKaiEgmaP9Rcd9imbdndnaQcl0mbdnaX:ZgOaL:Zg8A:taY:Yg8FaD:Y:tgaa8FaK:Y:tgha5:ZggaH:tNNNaOaH:tahNa8Aag:tNa8AaH:taaNagaO:tNM:va8FMJbbbZMgO:lJbbb9p9DTmbaO:Ohexdkcjjjj94hexekaPamfcd9Theka5aXaiEhXaQcefgQcs9hmekkdndnaCmbcihicbhDxekcbhiawakcbyd;S1jjbHjjjjbbg8EBdKawclBd2aPcuf:Yh8AdndnadTmbaqhiaxheadhmindndnaiIdba8ANJbbbZMgO:lJbbb9p9DTmbaO:OhCxekcjjjj94hCkaCcCthCdndnaiclfIdba8ANJbbbZMgO:lJbbb9p9DTmbaO:OhExekcjjjj94hEkaEcqtaCVhCdndnaicwfIdba8ANJbbbZMgO:lJbbb9p9DTmbaO:OhExekcjjjj94hEkaeaCaEVBdbaicxfhiaeclfheamcufgmmbkazcFeasz:ljjjbh3cbhDcbh5inaxa5cdtgYfydbgCcm4aC7c:v;t;h;Ev2gics4ai7hecbhidndnina3aeaAGgmcdtfgEydbgecuSmednaxaecdtgEfydbaCSmbaicefgiamfheaiaA9nmekka8EaEfydbhixekaEa5BdbaDhiaDcefhDka8EaYfaiBdba5cefg5ad9hmbkcuaDc32giaDc;j:KM;jb0EhexekazcFeasz:ljjjb8AcbhDcbhekawaecbyd;S1jjbHjjjjbbgeBd3awcvBd2aecbaiz:ljjjbhEavcd4hxdnadTmbdnalTmbaxcdth3a8EhCalheaqhmadhAinaEaCydbc32fgiamIdbaiIdbMUdbaiamclfIdbaiIdlMUdlaiamcwfIdbaiIdwMUdwaiaeIdbaiIdxMUdxaiaeclfIdbaiIdzMUdzaiaecwfIdbaiIdCMUdCaiaiIdKJbbjZMUdKaCclfhCaea3fheamcxfhmaAcufgAmbxdkka8EhmaqheadhCinaEamydbc32fgiaeIdbaiIdbMUdbaiaeclfIdbaiIdlMUdlaiaecwfIdbaiIdwMUdwaiaiIdxJbbbbMUdxaiaiIdzJbbbbMUdzaiaiIdCJbbbbMUdCaiaiIdKJbbjZMUdKamclfhmaecxfheaCcufgCmbkkdnaDTmbaEhiaDheinaiaiIdbJbbbbJbbjZaicKfIdbgO:vaOJbbbb9BEgONUdbaiclfgmaOamIdbNUdbaicwfgmaOamIdbNUdbaicxfgmaOamIdbNUdbaiczfgmaOamIdbNUdbaicCfgmaOamIdbNUdbaic3fhiaecufgembkkcbhCawcuaDcdtgYaDcFFFFi0Egicbyd;S1jjbHjjjjbbgeBdaawcoBd2awaicbyd;S1jjbHjjjjbbg3Bd8KaecFeaYz:ljjjbh5dnadTmbJbbjZJbbjZa8A:vaPceSEaoNgOaONh8Aaxcdthxalheina8Aaec;C1jjbalEgmIdwaEa8EydbgAc32fgiIdC:tgOaONamIdbaiIdx:tgOaONamIdlaiIdz:tgOaONMMNaqcwfIdbaiIdw:tgOaONaqIdbaiIdb:tgOaONaqclfIdbaiIdl:tgOaONMMMhOdndna5aAcdtgifgmydbcuSmba3aifIdbaO9ETmekamaCBdba3aifaOUdbka8Eclfh8EaeaxfheaqcxfhqadaCcefgC9hmbkkaba5aYz:kjjjb8AcrhikaicdthiinaiTmeaic98fgiawcxffydbcbyd;O1jjbH:bjjjbbxbkkawc;Wbf8KjjjjbaDk:Odieui99iu8Jjjjjbca9RgicFFF;7rBd3ai9cFFF;7;3FF:;Fb83dCaicFFF97Bdzai9cFFF;7FFF:;u83dwdndnaembJbbjFhlJbbjFhvJbbjFhoxekadcd4cdthrcbhwincbhdinaicCfadfgDabadfIdbglaDIdbgvaval9EEUdbaicwfadfgDalaDIdbgvaval9DEUdbadclfgdcx9hmbkabarfhbawcefgwae9hmbkaiIdzaiId3:thoaiIdxaiIdK:thvaiIdwaiIdC:thlkJbbbbalalJbbbb9DEglavaval9DEglaoaoal9DEk9DeeuabcFeaicdtz:ljjjbhlcbhbdnadTmbindnalaeydbcdtfgiydbcu9hmbaiabBdbabcefhbkaeclfheadcufgdmbkkabk9teiucbcbyd;W1jjbgeabcifc98GfgbBd;W1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaik;LeeeudndnaeabVciGTmbabhixekdndnadcz9pmbabhixekabhiinaiaeydbBdbaiclfaeclfydbBdbaicwfaecwfydbBdbaicxfaecxfydbBdbaeczfheaiczfhiadc9Wfgdcs0mbkkadcl6mbinaiaeydbBdbaeclfheaiclfhiadc98fgdci0mbkkdnadTmbinaiaeRbb86bbaicefhiaecefheadcufgdmbkkabk;aeedudndnabciGTmbabhixekaecFeGc:b:c:ew2hldndnadcz9pmbabhixekabhiinaialBdbaicxfalBdbaicwfalBdbaiclfalBdbaiczfhiadc9Wfgdcs0mbkkadcl6mbinaialBdbaiclfhiadc98fgdci0mbkkdnadTmbinaiae86bbaicefhiadcufgdmbkkabk9teiucbcbyd;W1jjbgeabcrfc94GfgbBd;W1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaik9:eiuZbhedndncbyd;W1jjbgdaecztgi9nmbcuheadai9RcFFifcz4nbcuSmekadhekcbabae9Rcifc98Gcbyd;W1jjbfgdBd;W1jjbdnadZbcztge9nmbadae9RcFFifcz4nb8Akk6eiucbhidnadTmbdninabRbbglaeRbbgv9hmeaecefheabcefhbadcufgdmbxdkkalav9Rhikaikk:bedbcjwk9Oeeebeebebbeeebebbbbbebebbbbbbbbbebbbdbbbbbbbebbbebbbdbbbbbbbbbbbeeeeebebbebbebebbbeebbbbbbbbbbbbbbbbbbbbbc;OwkxebbbdbbbjNbb",t=new Uint8Array([32,0,65,2,1,106,34,33,3,128,11,4,13,64,6,253,10,7,15,116,127,5,8,12,40,16,19,54,20,9,27,255,113,17,42,67,24,23,146,148,18,14,22,45,70,69,56,114,101,21,25,63,75,136,108,28,118,29,73,115]);if(typeof WebAssembly!="object")return{supported:!1};var n,i=WebAssembly.instantiate(o(e),{}).then(function(m){n=m.instance,n.exports.__wasm_call_ctors()});function o(m){for(var b=new Uint8Array(m.length),x=0;x<m.length;++x){var T=m.charCodeAt(x);b[x]=T>96?T-97:T>64?T-39:T+4}for(var C=0,x=0;x<m.length;++x)b[C++]=b[x]<60?t[b[x]]:(b[x]-60)*64+b[++x];return b.buffer.slice(0,C)}function r(m){if(!m)throw new Error("Assertion failed")}function s(m){return new Uint8Array(m.buffer,m.byteOffset,m.byteLength)}function a(m,b,x){var T=n.exports.sbrk,C=T(b.length*4),S=T(x*4),v=new Uint8Array(n.exports.memory.buffer),D=s(b);v.set(D,C);var I=m(S,C,b.length,x);v=new Uint8Array(n.exports.memory.buffer);var L=new Uint32Array(x);new Uint8Array(L.buffer).set(v.subarray(S,S+x*4)),D.set(v.subarray(C,C+b.length*4)),T(C-T(0));for(var M=0;M<b.length;++M)b[M]=L[b[M]];return[L,I]}function l(m){for(var b=0,x=0;x<m.length;++x){var T=m[x];b=b<T?T:b}return b}function u(m,b,x,T,C,S,v,D,I){var L=n.exports.sbrk,M=L(4),N=L(x*4),B=L(C*S),_=L(x*4),w=new Uint8Array(n.exports.memory.buffer);w.set(s(T),B),w.set(s(b),_);var P=m(N,_,x,B,C,S,v,D,I,M);w=new Uint8Array(n.exports.memory.buffer);var O=new Uint32Array(P);s(O).set(w.subarray(N,N+P*4));var F=new Float32Array(1);return s(F).set(w.subarray(M,M+4)),L(M-L(0)),[O,F[0]]}function f(m,b,x,T,C,S,v,D,I,L,M,N,B){var _=n.exports.sbrk,w=_(4),P=_(x*4),O=_(C*S),F=_(C*D),V=_(I.length*4),G=_(x*4),z=L?_(C):0,W=new Uint8Array(n.exports.memory.buffer);W.set(s(T),O),W.set(s(v),F),W.set(s(I),V),W.set(s(b),G),L&&W.set(s(L),z);var U=m(P,G,x,O,C,S,F,D,V,I.length,z,M,N,B,w);W=new Uint8Array(n.exports.memory.buffer);var q=new Uint32Array(U);s(q).set(W.subarray(P,P+U*4));var K=new Float32Array(1);return s(K).set(W.subarray(w,w+4)),_(w-_(0)),[q,K[0]]}function d(m,b,x,T){var C=n.exports.sbrk,S=C(x*T),v=new Uint8Array(n.exports.memory.buffer);v.set(s(b),S);var D=m(S,x,T);return C(S-C(0)),D}function p(m,b,x,T,C,S,v,D){var I=n.exports.sbrk,L=I(D*4),M=I(x*T),N=I(x*S),B=new Uint8Array(n.exports.memory.buffer);B.set(s(b),M),C&&B.set(s(C),N);var _=m(L,M,x,T,N,S,v,D);B=new Uint8Array(n.exports.memory.buffer);var w=new Uint32Array(_);return s(w).set(B.subarray(L,L+_*4)),I(L-I(0)),w}var g={LockBorder:1,Sparse:2,ErrorAbsolute:4,Prune:8,_InternalDebug:1<<30};return{ready:i,supported:!0,useExperimentalFeatures:!1,compactMesh:function(m){r(m instanceof Uint32Array||m instanceof Int32Array||m instanceof Uint16Array||m instanceof Int16Array),r(m.length%3==0);var b=m.BYTES_PER_ELEMENT==4?m:new Uint32Array(m);return a(n.exports.meshopt_optimizeVertexFetchRemap,b,l(m)+1)},simplify:function(m,b,x,T,C,S){r(m instanceof Uint32Array||m instanceof Int32Array||m instanceof Uint16Array||m instanceof Int16Array),r(m.length%3==0),r(b instanceof Float32Array),r(b.length%x==0),r(x>=3),r(T>=0&&T<=m.length),r(T%3==0),r(C>=0);for(var v=0,D=0;D<(S?S.length:0);++D)r(S[D]in g),r(this.useExperimentalFeatures||S[D]!="Prune"),v|=g[S[D]];var I=m.BYTES_PER_ELEMENT==4?m:new Uint32Array(m),L=u(n.exports.meshopt_simplify,I,m.length,b,b.length/x,x*4,T,C,v);return L[0]=m instanceof Uint32Array?L[0]:new m.constructor(L[0]),L},simplifyWithAttributes:function(m,b,x,T,C,S,v,D,I,L){r(this.useExperimentalFeatures),r(m instanceof Uint32Array||m instanceof Int32Array||m instanceof Uint16Array||m instanceof Int16Array),r(m.length%3==0),r(b instanceof Float32Array),r(b.length%x==0),r(x>=3),r(T instanceof Float32Array),r(T.length%C==0),r(C>=0),r(v==null||v instanceof Uint8Array),r(v==null||v.length==b.length/x),r(D>=0&&D<=m.length),r(D%3==0),r(I>=0),r(Array.isArray(S)),r(C>=S.length),r(S.length<=32);for(var M=0;M<S.length;++M)r(S[M]>=0);for(var N=0,M=0;M<(L?L.length:0);++M)r(L[M]in g),N|=g[L[M]];var B=m.BYTES_PER_ELEMENT==4?m:new Uint32Array(m),_=f(n.exports.meshopt_simplifyWithAttributes,B,m.length,b,b.length/x,x*4,T,C*4,new Float32Array(S),v?new Uint8Array(v):null,D,I,N);return _[0]=m instanceof Uint32Array?_[0]:new m.constructor(_[0]),_},getScale:function(m,b){return r(m instanceof Float32Array),r(m.length%b==0),r(b>=3),d(n.exports.meshopt_simplifyScale,m,m.length/b,b*4)},simplifyPoints:function(m,b,x,T,C,S){return r(this.useExperimentalFeatures),r(m instanceof Float32Array),r(m.length%b==0),r(b>=3),r(x>=0&&x<=m.length/b),T?(r(T instanceof Float32Array),r(T.length%C==0),r(C>=3),r(m.length/b==T.length/C),p(n.exports.meshopt_simplifyPoints,m,m.length/b,b*4,T,C*4,S,x)):p(n.exports.meshopt_simplifyPoints,m,m.length/b,b*4,void 0,0,0,x)}}}();var ven=function(){var e="b9H79Tebbbefx9Geueu9Geub9Gbb9Giuuueu9Gkuuuuuuuuuu99eu9Gvuuuuueu9Gkuuuuuuuuu9999eu9Gruuuuuuub9Gkuuuuuuuuuuueu9Gouuuuuub9Giuuub9GluuuubiOHdilvorwDqrkbiibeilve9Weiiviebeoweuec:q:Odkr:Yewo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9I919P29K9nW79O2Wt79c9V919U9KbeX9TW79O9V9Wt9F9I919P29K9nW79O2Wt7bd39TW79O9V9Wt9F9J9V9T9W91tWJ2917tWV9c9V919U9K7br39TW79O9V9Wt9F9J9V9T9W91tW9nW79O2Wt9c9V919U9K7bDL9TW79O9V9Wt9F9V9Wt9P9T9P96W9nW79O2Wtbql79IV9RbkDwebcekdsPq;L9kHdbkIbabaec9:fgefcufae9Ugeabci9Uadfcufad9Ugbaeab0Ek:oAlPue99eux998Jjjjjbc:We9Rgk8Kjjjjbakc;mbfcbc;Kbz:njjjb8AakcuaocdtgxaocFFFFi0Egmcbyd:e1jjbHjjjjbbgPBd9makceBd:SeakaPBdnakamcbyd:e1jjbHjjjjbbgsBd9qakcdBd:SeakasBd9eakcualcdtalcFFFFi0Ecbyd:e1jjbHjjjjbbgzBd9uakazBd9iakciBd:SeaPcbaxz:njjjbhHalci9UhOdnalTmbaihPalhAinaHaPydbcdtfgCaCydbcefBdbaPclfhPaAcufgAmbkkdnaoTmbcbhPashAaHhCaohXinaAaPBdbaAclfhAaCydbaPfhPaCclfhCaXcufgXmbkkdnalci6mbcbhPaihAinaAcwfydbhCaAclfydbhXasaAydbcdtfgQaQydbgQcefBdbazaQcdtfaPBdbasaXcdtfgXaXydbgXcefBdbazaXcdtfaPBdbasaCcdtfgCaCydbgCcefBdbazaCcdtfaPBdbaAcxfhAaOaPcefgP9hmbkkdnaoTmbaHhAashPaohCinaPaPydbaAydb9RBdbaAclfhAaPclfhPaCcufgCmbkkakamcbyd:e1jjbHjjjjbbgPBd9yakclBd:SeaPaHaxz:mjjjbhmakaOcbyd:e1jjbHjjjjbbgPBd9CakcvBd:SeaPcbaOz:njjjbhLakcuaOcK2alcjjjjd0Ecbyd:e1jjbHjjjjbbgKBd9GakcoBd:SeJbbbbhYdnalci6g8Ambarcd4hxaihAaKhPaOhrJbbbbhEinavaAclfydbax2cdtfgCIdlh3avaAydbax2cdtfgXIdlhYavaAcwfydbax2cdtfgQIdlh5aCIdwh8EaXIdwh8FaQIdwhaaPaCIdbghaXIdbggMaQIdbg8JMJbbnn:vUdbaPclfaXIdlaCIdlMaQIdlMJbbnn:vUdbaQIdwh8KaCIdwh8LaXIdwh8MaPcxfa3aY:tg3aaa8F:tgaNa5aY:tg5a8Ea8F:tg8EN:tgYJbbbbJbbjZahag:tgha5Na8Jag:tgga3N:tg8Fa8FNaYaYNa8EagNaaahN:tgYaYNMM:rgg:vagJbbbb9BEg3NUdbaPczfaYa3NUdbaPcCfa8Fa3NUdbaPcwfa8Ka8Ma8LMMJbbnn:vUdbaEagMhEaAcxfhAaPcKfhParcufgrmbkaEaO:Z:vJbbbZNhYkakcuaOcdtalcFFFF970Ecbyd:e1jjbHjjjjbbgCBd9KakcrBd:SeaYaD:ZN:rhYdna8AmbcbhPaChAinaAaPBdbaAclfhAaOaPcefgP9hmbkkaYJbbbZNh8MakcuaOcltalcFFFFd0Ecbyd:e1jjbHjjjjbbg8ABd9OakcwBd:Secba8AaKaCaOz:djjjb8Aakaocbyd:e1jjbHjjjjbbgPBd2aPcFeaoz:njjjbhrakc8Wfcwf9cb83ibak9cb83i8WcbhPJbbbbhEJbbbbh5Jbbbbh8EJbbbbhYJbbbbh8FJbbbbhgcbhlinJbbbbh3dnaPTmbJbbjZaP:Z:vh3kaka8Ea3NgaUdaaka5a3NghUd3akaEa3Ng8JUdKJbbbbh3dnagagNaYaYNa8Fa8FNMMg8KJbbbb9BmbJbbjZa8K:r:vh3kakaga3NUd8Saka8Fa3NUdyakaYa3NUd8Kdndndnakyd8WgQakydUgAakcKfaeaiakc;abfaKamara8Maqz:ejjjbgCcuSmbdnaPaD9pmbaAaraiaCcx2fgXydbfRbbcFeSfaraXclfydbfRbbcFeSfaraXcwfydbfRbbcFeSfaw9nmdkaQaAcbaeaiakc;abfaKamara8MJbbbbz:ejjjbgCcu9hmekakaaUdCakahUdzaka8JUdxakcuBdwakcFFF;7rBdla8AcbaKaLakcxfakcwfakclfz:fjjjbakydwgCcuSmekdnakc8WfaiaCcx2fgOydbgPaOclfydbgAaOcwfydbgXarabaeadalawaDz:gjjjbTmbalcefhlJbbbbhEJbbbbh5Jbbbbh8EJbbbbhYJbbbbh8FJbbbbhgkamaPcdtfgPaPydbcufBdbamaAcdtfgPaPydbcufBdbamaXcdtfgPaPydbcufBdbcbhXinazasaOaXcdtfydbcdtgAfydbcdtfgxhPaHaAfgvydbgQhAdnaQTmbdninaPydbaCSmeaPclfhPaAcufgATmdxbkkaPaxaQcdtfc98fydbBdbavavydbcufBdbkaXcefgXci9hmbkaKaCcK2fgPIdbh3aPIdlhaaPIdwhhaPIdxh8JaPIdzh8KaPIdCh8LaLaCfce86bbaga8LMhga8Fa8KMh8FaYa8JMhYa8EahMh8Ea5aaMh5aEa3MhEakyd88hPxekkdnaPTmbdnakyd80gAaPci2fgCciGTmbadaCfcbaPaAcu7fciGcefz:njjjb8AkabalcltfgPak8Pi8W83dbaPcwfakc8Wfcwf8Pib83dbalcefhlkcahPdninaPc98Smeakc;mbfaPfydbcbydj1jjbH:bjjjbbaPc98fhPxbkkakc:Wef8Kjjjjbalk;3vivuv99lu8Jjjjjbca9Rgv8Kjjjjbdndnalcw0mbaiydbhoaeabcitfgralcdtcufBdlaraoBdbdnalcd6mbaiclfhoalcufhwarcxfhrinaoydbhDarcuBdbarc98faDBdbarcwfhraoclfhoawcufgwmbkkalabfhrxekcbhDavczfcwfcbBdbav9cb83izavcwfcbBdbav9cb83ibJbbjZhqJbbjZhkinadaiaDcdtfydbcK2fhwcbhrinavczfarfgoawarfIdbgxaoIdbgm:tgPakNamMgmUdbavarfgoaPaxam:tNaoIdbMUdbarclfgrcx9hmbkJbbjZaqJbbjZMgq:vhkaDcefgDal9hmbkcbhoadcbcecdavIdlgxavIdwgm9GEgravIdbgPam9GEaraPax9GEgscdtgrfhzavczfarfIdbhxaihralhwinaiaocdtfgDydbhHaDarydbgOBdbaraHBdbarclfhraoazaOcK2fIdbax9Dfhoawcufgwmbkaeabcitfhrdndnaocv6mbaoalc98f6mekaraiydbBdbaralcdtcufBdlaiclfhoalcufhwarcxfhrinaoydbhDarcuBdbarc98faDBdbarcwfhraoclfhoawcufgwmbkalabfhrxekaraxUdbaeabcitfgrarydlc98GasVBdlabcefaeadaiaoz:djjjbhwararydlciGawabcu7fcdtVBdlawaeadaiaocdtfalao9Rz:djjjbhrkavcaf8Kjjjjbark;Bloeue99vue99Due99dndnaembcuhkxekJbbjZaq:thxaiabcdtfhmavydbhPavydlhsavydwhzcbhHJFFuuhOcvhbcuhkindnaPamaHcdtfydbcdtgvfydbgATmbazasavfydbcdtfhiindndnawalaiydbgCcx2fgvclfydbgXfRbbcFeSawavydbgQfRbbcFeSfawavcwfydbgLfRbbcFeSfgKmbcbhvxekcehvaraQcdtfydbgYceSmbcehvaraXcdtfydbg8AceSmbcehvaraLcdtfydbgEceSmbdna8AcdSaYcdSfaEcdSfcd6mbaKcefhvxekaKcdfhvkdnavab9kmbdndnadTmbaoaCcK2fgQIdwadIdw:tg3a3NaQIdbadIdb:tg3a3NaQIdladIdl:tg3a3NMM:raD:vaxNJbbjZMJ9VO:d86JbbjZaQIdCadIdCNaQIdxadIdxNaQIdzadIdzNMMaqN:tg3a3J9VO:d869DENh3xekaraQcdtfydbaraXcdtfydbfaraLcdtfydbfc99f:Zh3kaCakavab6a3aO9DVgQEhkavabaQEhba3aOaQEhOkaiclfhiaAcufgAmbkkaHcefgHae9hmbkkakk;bddlue99dndndnabaecitfgrydlgwciGgDci9hmbarclfhqxekinabcbawcd4gwalaDcdtfIdbabaecitfIdb:tgkJbbbb9FEgDaecefgefadaialavaoz:fjjjbak:laoIdb9FTmdabaDaw7aefgecitfgrydlgwciGgDci9hmbkarclfhqkabaecitfhecuhbindnaiaeydbgDfRbbmbadaDcK2fgrIdwalIdw:tgkakNarIdbalIdb:tgkakNarIdlalIdl:tgkakNMM:rgkaoIdb9DTmbaoakUdbavaDBdbaqydbhwkaecwfheabcefgbawcd46mbkkk;yleoudnaladfgkRbbcFeSalaefgxRbbgmcFeSfabydwgPfalaifgsRbbcFeSfaD0abydxaq9pVgzce9hmbavawcltfgmab8Pdb83dbamcwfabcwfgm8Pdb83dbdndnamydbmbcbhqxekcbhDaohminalamabydbcdtfydbfcFe86bbamclfhmaDcefgDabydwgq6mbkkdnabydxglci2gDabydlgmfgPciGTmbaraPfcbalamcu7fciGcefz:njjjb8Aabydxci2hDabydlhmabydwhqkab9cb83dwababydbaqfBdbabaDcifc98GamfBdlaxRbbhmcbhPkdnamcFeGcFe9hmbaxaP86bbababydwgmcefBdwaoabydbcdtfamcdtfaeBdbkdnakRbbcFe9hmbakabydw86bbababydwgmcefBdwaoabydbcdtfamcdtfadBdbkdnasRbbcFe9hmbasabydw86bbababydwgmcefBdwaoabydbcdtfamcdtfaiBdbkarabydlfabydxci2faxRbb86bbarabydlfabydxci2fcefakRbb86bbarabydlfabydxci2fcdfasRbb86bbababydxcefBdxazk;Ckovud99euv99eul998Jjjjjbc:G;ae9Rgo8KjjjjbdndnadTmbavcd4hrcbhwcbhDindnaiaeclfydbar2cdtfgvIdbaiaeydbar2cdtfgqIdbgk:tgxaiaecwfydbar2cdtfgmIdlaqIdlgP:tgsNamIdbak:tgzavIdlaP:tgPN:tgkakNaPamIdwaqIdwgH:tgONasavIdwaH:tgHN:tgPaPNaHazNaOaxN:tgxaxNMM:rgsJbbbb9Bmbaoc:G:qefawcx2fgAakas:vUdwaAaxas:vUdlaAaPas:vUdbaocafawc8K2fgAaq8Pdb83dbaAav8Pdb83dxaAam8Pdb83dKaAcwfaqcwfydbBdbaAcCfavcwfydbBdbaAcafamcwfydbBdbawcefhwkaecxfheaDcifgDad6mbkab9cb83dbabcyf9cb83dbabcaf9cb83dbabcKf9cb83dbabczf9cb83dbabcwf9cb83dbawTmeao9cb83iKao9cb83izaoczfaocafawci2z1jjjbaoIdKhCaoIdChXaoIdzhQao9cb83iwao9cb83ibaoaoc:G:qefawz1jjjbJbbjZhkaoIdwgPJbbbbJbbjZaPaPNaoIdbgPaPNaoIdlgsasNMM:rgx:vaxJbbbb9BEgzNhxasazNhsaPazNhzaoc:G:qefheawhvinaecwfIdbaxNaeIdbazNasaeclfIdbNMMgPakaPak9DEhkaecxfheavcufgvmbkabaCUdwabaXUdlabaQUdbabaoId3UdxdndnakJ;n;m;m899FmbJbbbbhPaoc:G:qefheaocafhvinaCavcwfIdb:taecwfIdbgHNaQavIdb:taeIdbgONaXavclfIdb:taeclfIdbgLNMMaxaHNazaONasaLNMM:vgHaPaHaP9EEhPavc8KfhvaecxfheawcufgwmbkabazUd3abc8KfaxUdbabcafasUdbabcKfaCaxaPN:tUdbabcCfaXasaPN:tUdbabaQazaPN:tUdzabJbbjZakakN:t:rgkUdydndnaxJbbj:;axJbbj:;9GEgPJbbjZaPJbbjZ9FEJbb;:9cNJbbbZJbbb:;axJbbbb9GEMgP:lJbbb9p9DTmbaP:Ohexekcjjjj94hekabc8Ufae86bbdndnasJbbj:;asJbbj:;9GEgPJbbjZaPJbbjZ9FEJbb;:9cNJbbbZJbbb:;asJbbbb9GEMgP:lJbbb9p9DTmbaP:Ohvxekcjjjj94hvkabcRfav86bbdndnazJbbj:;azJbbj:;9GEgPJbbjZaPJbbjZ9FEJbb;:9cNJbbbZJbbb:;azJbbbb9GEMgP:lJbbb9p9DTmbaP:Ohqxekcjjjj94hqkabaq86b8SdndnaecKtcK91:YJbb;:9c:vax:t:lavcKtcK91:YJbb;:9c:vas:t:laqcKtcK91:YJbb;:9c:vaz:t:lakMMMJbb;:9cNJbbjZMgk:lJbbb9p9DTmbak:Ohexekcjjjj94hekaecFbaecFb9iEhexekabcjjj;8iBdycFbhekabae86b8Vxekab9cb83dbabcyf9cb83dbabcaf9cb83dbabcKf9cb83dbabczf9cb83dbabcwf9cb83dbkaoc:G;aef8Kjjjjbk:mvdouq99cbhi8Jjjjjbca9RglczfcwfcbBdbal9cb83izalcwfcbBdbal9cb83ibdnadTmbcbhvinaeaifhocbhrinalczfarfgwavawydbgwaoarfIdbgDaearawcx2ffIdb9DEBdbalarfgwavawydbgwaDaearawcx2ffIdb9EEBdbarclfgrcx9hmbkaicxfhiavcefgvad9hmbkkJbbbbhDcbhrcbhicbhvinaealarfydbcx2fgwIdwaealczfarfydbcx2fgoIdw:tgqaqNawIdbaoIdb:tgqaqNawIdlaoIdl:tgqaqNMMgqaDaqaD9EgwEhDavaiawEhiarclfhravcefgvci9hmbkaealczfaicdtgvfydbcx2fgrIdwaealavfydbcx2fglIdwMJbbbZNhqarIdlalIdlMJbbbZNhkarIdbalIdbMJbbbZNhxaD:rJbbbZNhDdnadTmbindnaecwfIdbgmaq:tgPaPNaeIdbgsax:tgPaPNaeclfIdbgzak:tgPaPNMMgPaDaDN9ETmbaqaDaP:rgH:vJbbbZNJbbbZMgPNamJbbjZaP:tgONMhqakaPNazaONMhkaxaPNasaONMhxaDaHMJbbbZNhDkaecxfheadcufgdmbkkabaDUdxabaqUdwabakUdlabaxUdbkjeeiu8Jjjjjbcj8W9Rgr8Kjjjjbaici2hwdnaiTmbawceawce0EhDarhiinaiaeadRbbcdtfydbBdbadcefhdaiclfhiaDcufgDmbkkabarawaladaoz:hjjjbarcj8Wf8Kjjjjbk:Ylequ8Jjjjjbcjx9Rgl8Kjjjjbcbhvalcjqfcbaiz:njjjb8AdndnadTmbcjehoaehrincuhwarhDcuhqavhkdninawakaoalcjqfaDcefRbbfRbb9RcFeGci6aoalcjqfaDRbbfRbb9RcFeGci6faoalcjqfaDcdfRbbfRbb9RcFeGci6fgxaq9mgmEhwdnammbaxce0mdkaxaqaxaq9kEhqaDcifhDadakcefgk9hmbkkaeawci2fgDcdfRbbhqaDcefRbbhxaDRbbhkaeavci2fgDcifaDawav9Rci2z:qjjjb8Aakalcjqffaocefgo86bbaxalcjqffao86bbaDcdfaq86bbaDcefax86bbaDak86bbaqalcjqffao86bbarcifhravcefgvad9hmbkalcFeaiz:njjjbhoadci2gDceaDce0EhqcbhxindnaoaeRbbgkfgwRbbgDcFe9hmbawax86bbaocjdfaxcdtfabakcdtfydbBdbaxhDaxcefhxkaeaD86bbaecefheaqcufgqmbkaxcdthDxekcbhDkabalcjdfaDz:mjjjb8Aalcjxf8Kjjjjbk9teiucbcbyd11jjbgeabcifc98GfgbBd11jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaik;LeeeudndnaeabVciGTmbabhixekdndnadcz9pmbabhixekabhiinaiaeydbBdbaiclfaeclfydbBdbaicwfaecwfydbBdbaicxfaecxfydbBdbaeczfheaiczfhiadc9Wfgdcs0mbkkadcl6mbinaiaeydbBdbaeclfheaiclfhiadc98fgdci0mbkkdnadTmbinaiaeRbb86bbaicefhiaecefheadcufgdmbkkabk;aeedudndnabciGTmbabhixekaecFeGc:b:c:ew2hldndnadcz9pmbabhixekabhiinaialBdbaicxfalBdbaicwfalBdbaiclfalBdbaiczfhiadc9Wfgdcs0mbkkadcl6mbinaialBdbaiclfhiadc98fgdci0mbkkdnadTmbinaiae86bbaicefhiadcufgdmbkkabk9teiucbcbyd11jjbgeabcrfc94GfgbBd11jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaik9:eiuZbhedndncbyd11jjbgdaecztgi9nmbcuheadai9RcFFifcz4nbcuSmekadhekcbabae9Rcifc98Gcbyd11jjbfgdBd11jjbdnadZbcztge9nmbadae9RcFFifcz4nb8Akk:;Deludndndnadch9pmbabaeSmdaeabadfgi9Rcbadcet9R0mekabaead;8qbbxekaeab7ciGhldndndnabae9pmbdnalTmbadhvabhixikdnabciGmbadhvabhixdkadTmiabaeRbb86bbadcufhvdnabcefgiciGmbaecefhexdkavTmiabaeRbe86beadc9:fhvdnabcdfgiciGmbaecdfhexdkavTmiabaeRbd86bdadc99fhvdnabcifgiciGmbaecifhexdkavTmiabaeRbi86biabclfhiaeclfheadc98fhvxekdnalmbdnaiciGTmbadTmlabadcufgifglaeaifRbb86bbdnalciGmbaihdxekaiTmlabadc9:fgifglaeaifRbb86bbdnalciGmbaihdxekaiTmlabadc99fgifglaeaifRbb86bbdnalciGmbaihdxekaiTmlabadc98fgdfaeadfRbb86bbkadcl6mbdnadc98fgocd4cefciGgiTmbaec98fhlabc98fhvinavadfaladfydbBdbadc98fhdaicufgimbkkaocx6mbaec9Wfhvabc9WfhoinaoadfgicxfavadfglcxfydbBdbaicwfalcwfydbBdbaiclfalclfydbBdbaialydbBdbadc9Wfgdci0mbkkadTmdadhidnadciGglTmbaecufhvabcufhoadhiinaoaifavaifRbb86bbaicufhialcufglmbkkadcl6mdaec98fhlabc98fhvinavaifgecifalaifgdcifRbb86bbaecdfadcdfRbb86bbaecefadcefRbb86bbaeadRbb86bbaic98fgimbxikkavcl6mbdnavc98fglcd4cefcrGgdTmbavadcdt9RhvinaiaeydbBdbaeclfheaiclfhiadcufgdmbkkalc36mbinaiaeydbBdbaiaeydlBdlaiaeydwBdwaiaeydxBdxaiaeydzBdzaiaeydCBdCaiaeydKBdKaiaeyd3Bd3aecafheaicafhiavc9Gfgvci0mbkkavTmbdndnavcrGgdmbavhlxekavc94GhlinaiaeRbb86bbaicefhiaecefheadcufgdmbkkavcw6mbinaiaeRbb86bbaiaeRbe86beaiaeRbd86bdaiaeRbi86biaiaeRbl86blaiaeRbv86bvaiaeRbo86boaiaeRbr86braicwfhiaecwfhealc94fglmbkkabkkAebcjwkxebbbdbbbzNbb",t=new Uint8Array([32,0,65,2,1,106,34,33,3,128,11,4,13,64,6,253,10,7,15,116,127,5,8,12,40,16,19,54,20,9,27,255,113,17,42,67,24,23,146,148,18,14,22,45,70,69,56,114,101,21,25,63,75,136,108,28,118,29,73,115]);if(typeof WebAssembly!="object")return{supported:!1};var n,i=WebAssembly.instantiate(o(e),{}).then(function(m){n=m.instance,n.exports.__wasm_call_ctors()});function o(m){for(var b=new Uint8Array(m.length),x=0;x<m.length;++x){var T=m.charCodeAt(x);b[x]=T>96?T-97:T>64?T-39:T+4}for(var C=0,x=0;x<m.length;++x)b[C++]=b[x]<60?t[b[x]]:(b[x]-60)*64+b[++x];return b.buffer.slice(0,C)}function r(m){if(!m)throw new Error("Assertion failed")}function s(m){return new Uint8Array(m.buffer,m.byteOffset,m.byteLength)}var a=48,l=16;function u(m,b){var x=m.meshlets[b*4+0],T=m.meshlets[b*4+1],C=m.meshlets[b*4+2],S=m.meshlets[b*4+3];return{vertices:m.vertices.subarray(x,x+C),triangles:m.triangles.subarray(T,T+S*3)}}function f(m,b,x,T,C,S,v){var D=n.exports.sbrk,I=n.exports.meshopt_buildMeshletsBound(m.length,C,S),L=D(I*l),M=D(I*C*4),N=D(I*S*3),B=D(m.byteLength),_=D(b.byteLength),w=new Uint8Array(n.exports.memory.buffer);w.set(s(m),B),w.set(s(b),_);var P=n.exports.meshopt_buildMeshlets(L,M,N,B,m.length,_,x,T,C,S,v);w=new Uint8Array(n.exports.memory.buffer);for(var O=w.subarray(L,L+P*l),F=new Uint32Array(O.buffer,O.byteOffset,O.byteLength/4).slice(),V=0;V<P;++V){var G=F[V*4+0],z=F[V*4+1],x=F[V*4+2],W=F[V*4+3];n.exports.meshopt_optimizeMeshlet(M+G*4,N+z,W,x)}var U=F[(P-1)*4+0],q=F[(P-1)*4+1],K=F[(P-1)*4+2],te=F[(P-1)*4+3],Y=U+K,Z=q+(te*3+3&-4),ee={meshlets:F,vertices:new Uint32Array(w.buffer,M,Y).slice(),triangles:new Uint8Array(w.buffer,N,Z*3).slice(),meshletCount:P};return D(L-D(0)),ee}function d(m){var b=new Float32Array(n.exports.memory.buffer,m,a/4);return{centerX:b[0],centerY:b[1],centerZ:b[2],radius:b[3],coneApexX:b[4],coneApexY:b[5],coneApexZ:b[6],coneAxisX:b[7],coneAxisY:b[8],coneAxisZ:b[9],coneCutoff:b[10]}}function p(m,b,x,T){var C=n.exports.sbrk,S=[],v=C(b.byteLength),D=C(m.vertices.byteLength),I=C(m.triangles.byteLength),L=C(a),M=new Uint8Array(n.exports.memory.buffer);M.set(s(b),v),M.set(s(m.vertices),D),M.set(s(m.triangles),I);for(var N=0;N<m.meshletCount;++N){var B=m.meshlets[N*4+0],_=m.meshlets[N*4+0+1],w=m.meshlets[N*4+0+3];n.exports.meshopt_computeMeshletBounds(L,D+B*4,I+_,w,v,x,T),S.push(d(L))}return C(v-C(0)),S}function g(m,b,x,T){var C=n.exports.sbrk,S=C(a),v=C(m.byteLength),D=C(b.byteLength),I=new Uint8Array(n.exports.memory.buffer);I.set(s(m),v),I.set(s(b),D),n.exports.meshopt_computeClusterBounds(S,v,m.length,D,x,T);var L=d(S);return C(S-C(0)),L}return{ready:i,supported:!0,buildMeshlets:function(m,b,x,T,C,S){r(m.length%3==0),r(b instanceof Float32Array),r(b.length%x==0),r(x>=3),r(T<=255||T>0),r(C<=512),r(C%4==0),S=S||0;var v=m.BYTES_PER_ELEMENT==4?m:new Uint32Array(m);return f(v,b,b.length/x,x*4,T,C,S)},computeClusterBounds:function(m,b,x){r(m.length%3==0),r(m.length/3<=512),r(b instanceof Float32Array),r(b.length%x==0),r(x>=3);var T=m.BYTES_PER_ELEMENT==4?m:new Uint32Array(m);return g(T,b,b.length/x,x*4)},computeMeshletBounds:function(m,b,x){return r(m.meshletCount!=0),r(b instanceof Float32Array),r(b.length%x==0),r(x>=3),p(m,b,b.length/x,x*4)},extractMeshlet:function(m,b){return r(b>=0&&b<m.meshletCount),u(m,b)}}}();function f0(e){e=y(e,y.EMPTY_OBJECT);let t=e.resourceCache,n=e.gltf,i=e.bufferViewId,o=e.gltfResource,r=e.baseResource,s=e.cacheKey;A.typeOf.func("options.resourceCache",t),A.typeOf.object("options.gltf",n),A.typeOf.number("options.bufferViewId",i),A.typeOf.object("options.gltfResource",o),A.typeOf.object("options.baseResource",r);let a=n.bufferViews[i],l=a.buffer,u=a.byteOffset,f=a.byteLength,d=!1,p,g,m,b;if(si(a,"EXT_meshopt_compression")){let T=a.extensions.EXT_meshopt_compression;l=T.buffer,u=y(T.byteOffset,0),f=T.byteLength,d=!0,p=T.byteStride,g=T.count,m=T.mode,b=y(T.filter,"NONE")}let x=n.buffers[l];this._hasMeshopt=d,this._meshoptByteStride=p,this._meshoptCount=g,this._meshoptMode=m,this._meshoptFilter=b,this._resourceCache=t,this._gltfResource=o,this._baseResource=r,this._buffer=x,this._bufferId=l,this._byteOffset=u,this._byteLength=f,this._cacheKey=s,this._bufferLoader=void 0,this._typedArray=void 0,this._state=yt.UNLOADED,this._promise=void 0}c(Object.create)&&(f0.prototype=Object.create(Zi.prototype),f0.prototype.constructor=f0);Object.defineProperties(f0.prototype,{cacheKey:{get:function(){return this._cacheKey}},typedArray:{get:function(){return this._typedArray}}});async function JLe(e){try{let t=QLe(e);if(e._bufferLoader=t,await t.load(),e.isDestroyed())return;let n=t.typedArray,i=new Uint8Array(n.buffer,n.byteOffset+e._byteOffset,e._byteLength);if(e.unload(),e._typedArray=i,e._hasMeshopt){let o=e._meshoptCount,r=e._meshoptByteStride,s=new Uint8Array(o*r);One.decodeGltfBuffer(s,o,r,e._typedArray,e._meshoptMode,e._meshoptFilter),e._typedArray=s}return e._state=yt.READY,e}catch(t){if(e.isDestroyed())return;throw e.unload(),e._state=yt.FAILED,e.getError("Failed to load buffer view",t)}}f0.prototype.load=async function(){return c(this._promise)?this._promise:(this._state=yt.LOADING,this._promise=JLe(this),this._promise)};function QLe(e){let t=e._resourceCache,n=e._buffer;if(c(n.uri)){let o=e._baseResource.getDerivedResource({url:n.uri});return t.getExternalBufferLoader({resource:o})}return t.getEmbeddedBufferLoader({parentResource:e._gltfResource,bufferId:e._bufferId})}f0.prototype.unload=function(){c(this._bufferLoader)&&!this._bufferLoader.isDestroyed()&&this._resourceCache.unload(this._bufferLoader),this._bufferLoader=void 0,this._typedArray=void 0};var CO=f0;function Dr(){}Dr._maxDecodingConcurrency=Math.max(zt.hardwareConcurrency-1,1);Dr._decoderTaskProcessor=void 0;Dr._taskProcessorReady=!1;Dr._error=void 0;Dr._getDecoderTaskProcessor=function(){if(!c(Dr._decoderTaskProcessor)){let e=new Ti("decodeDraco",Dr._maxDecodingConcurrency);e.initWebAssemblyModule({wasmBinaryFile:"ThirdParty/draco_decoder.wasm"}).then(function(t){t?Dr._taskProcessorReady=!0:Dr._error=new ue("Draco decoder could not be initialized.")}).catch(t=>{Dr._error=t}),Dr._decoderTaskProcessor=e}return Dr._decoderTaskProcessor};Dr.decodePointCloud=function(e){let t=Dr._getDecoderTaskProcessor();if(c(Dr._error))throw Dr._error;if(Dr._taskProcessorReady)return t.scheduleTask(e,[e.buffer.buffer])};Dr.decodeBufferView=function(e){let t=Dr._getDecoderTaskProcessor();if(c(Dr._error))throw Dr._error;if(Dr._taskProcessorReady)return t.scheduleTask(e,[e.array.buffer])};var d0=Dr;function V_(e){e=y(e,y.EMPTY_OBJECT);let t=e.resourceCache,n=e.gltf,i=e.draco,o=e.gltfResource,r=e.baseResource,s=e.cacheKey;A.typeOf.func("options.resourceCache",t),A.typeOf.object("options.gltf",n),A.typeOf.object("options.draco",i),A.typeOf.object("options.gltfResource",o),A.typeOf.object("options.baseResource",r),this._resourceCache=t,this._gltfResource=o,this._baseResource=r,this._gltf=n,this._draco=i,this._cacheKey=s,this._bufferViewLoader=void 0,this._bufferViewTypedArray=void 0,this._decodePromise=void 0,this._decodedData=void 0,this._state=yt.UNLOADED,this._promise=void 0,this._dracoError=void 0}c(Object.create)&&(V_.prototype=Object.create(Zi.prototype),V_.prototype.constructor=V_);Object.defineProperties(V_.prototype,{cacheKey:{get:function(){return this._cacheKey}},decodedData:{get:function(){return this._decodedData}}});async function eNe(e){let t=e._resourceCache;try{let n=t.getBufferViewLoader({gltf:e._gltf,bufferViewId:e._draco.bufferView,gltfResource:e._gltfResource,baseResource:e._baseResource});return e._bufferViewLoader=n,await n.load(),e.isDestroyed()?void 0:(e._bufferViewTypedArray=n.typedArray,e._state=yt.PROCESSING,e)}catch(n){if(e.isDestroyed())return;Rne(e,n)}}V_.prototype.load=async function(){return c(this._promise)?this._promise:(this._state=yt.LOADING,this._promise=eNe(this),this._promise)};function Rne(e,t){throw e.unload(),e._state=yt.FAILED,e.getError("Failed to load Draco",t)}async function tNe(e,t){try{let n=await t;return e.isDestroyed()?void 0:(e.unload(),e._decodedData={indices:n.indexArray,vertexAttributes:n.attributeData},e._state=yt.READY,e._baseResource)}catch(n){if(e.isDestroyed())return;e._dracoError=n}}V_.prototype.process=function(e){if(A.typeOf.object("frameState",e),this._state===yt.READY)return!0;if(this._state!==yt.PROCESSING||(c(this._dracoError)&&Rne(this,this._dracoError),!c(this._bufferViewTypedArray))||c(this._decodePromise))return!1;let t=this._draco,i=this._gltf.bufferViews,o=t.bufferView,r=i[o],s=t.attributes,a={array:new Uint8Array(this._bufferViewTypedArray),bufferView:r,compressedAttributes:s,dequantizeInShader:!0},l=d0.decodeBufferView(a);if(!c(l))return!1;this._decodePromise=tNe(this,l)};V_.prototype.unload=function(){c(this._bufferViewLoader)&&this._resourceCache.unload(this._bufferViewLoader),this._bufferViewLoader=void 0,this._bufferViewTypedArray=void 0,this._decodedData=void 0,this._gltf=void 0};var EO=V_;function nNe(e){let t=e.uint8Array,n=e.format,i=e.request,o=y(e.flipY,!1),r=y(e.skipColorSpaceConversion,!1);A.typeOf.object("uint8Array",t),A.typeOf.string("format",n);let s=new Blob([t],{type:n}),a;return De.supportsImageBitmapOptions().then(function(l){return l?Promise.resolve(De.createImageBitmapFromBlob(s,{flipY:o,premultiplyAlpha:!1,skipColorSpaceConversion:r})):(a=window.URL.createObjectURL(s),new De({url:a,request:i}).fetchImage({flipY:o,skipColorSpaceConversion:r}))}).then(function(l){return c(a)&&window.URL.revokeObjectURL(a),l}).catch(function(l){return c(a)&&window.URL.revokeObjectURL(a),Promise.reject(l)})}var FS=nNe;function Jm(e){e=y(e,y.EMPTY_OBJECT);let t=e.resourceCache,n=e.gltf,i=e.imageId,o=e.gltfResource,r=e.baseResource,s=e.cacheKey;A.typeOf.func("options.resourceCache",t),A.typeOf.object("options.gltf",n),A.typeOf.number("options.imageId",i),A.typeOf.object("options.gltfResource",o),A.typeOf.object("options.baseResource",r);let a=n.images[i],l=a.bufferView,u=a.uri;this._resourceCache=t,this._gltfResource=o,this._baseResource=r,this._gltf=n,this._bufferViewId=l,this._uri=u,this._cacheKey=s,this._bufferViewLoader=void 0,this._image=void 0,this._mipLevels=void 0,this._state=yt.UNLOADED,this._promise=void 0}c(Object.create)&&(Jm.prototype=Object.create(Zi.prototype),Jm.prototype.constructor=Jm);Object.defineProperties(Jm.prototype,{cacheKey:{get:function(){return this._cacheKey}},image:{get:function(){return this._image}},mipLevels:{get:function(){return this._mipLevels}}});Jm.prototype.load=function(){return c(this._promise)?this._promise:c(this._bufferViewId)?(this._promise=iNe(this),this._promise):(this._promise=oNe(this),this._promise)};function Mne(e){let t;return Array.isArray(e)&&(t=e.slice(1,e.length).map(function(n){return n.bufferView}),e=e[0]),{image:e,mipLevels:t}}async function iNe(e){e._state=yt.LOADING;let t=e._resourceCache;try{let n=t.getBufferViewLoader({gltf:e._gltf,bufferViewId:e._bufferViewId,gltfResource:e._gltfResource,baseResource:e._baseResource});if(e._bufferViewLoader=n,await n.load(),e.isDestroyed())return;let i=n.typedArray,o=await sNe(i);if(e.isDestroyed())return;let r=Mne(o);return e.unload(),e._image=r.image,e._mipLevels=r.mipLevels,e._state=yt.READY,e}catch(n){return e.isDestroyed()?void 0:Lne(e,n,"Failed to load embedded image")}}async function oNe(e){e._state=yt.LOADING;let t=e._baseResource,n=e._uri,i=t.getDerivedResource({url:n});try{let o=await cNe(i);if(e.isDestroyed())return;let r=Mne(o);return e.unload(),e._image=r.image,e._mipLevels=r.mipLevels,e._state=yt.READY,e}catch(o){return e.isDestroyed()?void 0:Lne(e,o,`Failed to load image: ${n}`)}}function Lne(e,t,n){return e.unload(),e._state=yt.FAILED,Promise.reject(e.getError(n,t))}function rNe(e){let t=e.subarray(0,2),n=e.subarray(0,4),i=e.subarray(8,12);if(t[0]===255&&t[1]===216)return"image/jpeg";if(t[0]===137&&t[1]===80)return"image/png";if(t[0]===171&&t[1]===75)return"image/ktx2";if(n[0]===82&&n[1]===73&&n[2]===70&&n[3]===70&&i[0]===87&&i[1]===69&&i[2]===66&&i[3]===80)return"image/webp";throw new ue("Image format is not recognized")}async function sNe(e){let t=rNe(e);if(t==="image/ktx2"){let n=new Uint8Array(e);return Mu(n)}return Jm._loadImageFromTypedArray({uint8Array:e,format:t,flipY:!1,skipColorSpaceConversion:!0})}var aNe=/(^data:image\/ktx2)|(\.ktx2$)/i;function cNe(e){let t=e.getUrlComponent(!1,!0);return aNe.test(t)?Mu(e):e.fetchImage({skipColorSpaceConversion:!0,preferImageBitmap:!0})}Jm.prototype.unload=function(){c(this._bufferViewLoader)&&!this._bufferViewLoader.isDestroyed()&&this._resourceCache.unload(this._bufferViewLoader),this._bufferViewLoader=void 0,this._uri=void 0,this._image=void 0,this._mipLevels=void 0,this._gltf=void 0};Jm._loadImageFromTypedArray=FS;var SO=Jm;var lNe={TEXTURE:0,PROGRAM:1,BUFFER:2,NUMBER_OF_JOB_TYPES:3},Ha=Object.freeze(lNe);function U_(e){e=y(e,y.EMPTY_OBJECT);let t=e.resourceCache,n=e.gltf,i=e.accessorId,o=e.gltfResource,r=e.baseResource,s=e.draco,a=e.cacheKey,l=y(e.asynchronous,!0),u=y(e.loadBuffer,!1),f=y(e.loadTypedArray,!1);if(A.typeOf.func("options.resourceCache",t),A.typeOf.object("options.gltf",n),A.typeOf.number("options.accessorId",i),A.typeOf.object("options.gltfResource",o),A.typeOf.object("options.baseResource",r),!u&&!f)throw new E("At least one of loadBuffer and loadTypedArray must be true.");let d=n.accessors[i].componentType;this._resourceCache=t,this._gltfResource=o,this._baseResource=r,this._gltf=n,this._accessorId=i,this._indexDatatype=d,this._draco=s,this._cacheKey=a,this._asynchronous=l,this._loadBuffer=u,this._loadTypedArray=f,this._bufferViewLoader=void 0,this._dracoLoader=void 0,this._typedArray=void 0,this._buffer=void 0,this._state=yt.UNLOADED,this._promise=void 0}c(Object.create)&&(U_.prototype=Object.create(Zi.prototype),U_.prototype.constructor=U_);Object.defineProperties(U_.prototype,{cacheKey:{get:function(){return this._cacheKey}},buffer:{get:function(){return this._buffer}},typedArray:{get:function(){return this._typedArray}},indexDatatype:{get:function(){return this._indexDatatype}}});var uNe=new az;U_.prototype.load=async function(){return c(this._promise)?this._promise:c(this._draco)?(this._promise=fNe(this),this._promise):(this._promise=dNe(this),this._promise)};async function fNe(e){e._state=yt.LOADING;let t=e._resourceCache;try{let n=t.getDracoLoader({gltf:e._gltf,draco:e._draco,gltfResource:e._gltfResource,baseResource:e._baseResource});return e._dracoLoader=n,await n.load(),e.isDestroyed()?void 0:(e._state=yt.LOADED,e)}catch(n){if(e.isDestroyed())return;sz(e,n)}}async function dNe(e){let t=e._gltf,n=e._accessorId,o=t.accessors[n].bufferView;e._state=yt.LOADING;let r=e._resourceCache;try{let s=r.getBufferViewLoader({gltf:t,bufferViewId:o,gltfResource:e._gltfResource,baseResource:e._baseResource});if(e._bufferViewLoader=s,await s.load(),e.isDestroyed())return;let a=s.typedArray;return e._typedArray=hNe(e,a),e._state=yt.PROCESSING,e}catch(s){if(e.isDestroyed())return;sz(e,s)}}function hNe(e,t){let n=e._gltf,i=e._accessorId,o=n.accessors[i],r=o.count,s=o.componentType,a=Fe.getSizeInBytes(s),l=t.buffer,u=t.byteOffset+o.byteOffset;if(u%a!==0){let d=r*a,p=new Uint8Array(l,u,d);l=new Uint8Array(p).buffer,u=0,Ss("index-buffer-unaligned",`The index array is not aligned to a ${a}-byte boundary.`)}let f;return s===Fe.UNSIGNED_BYTE?f=new Uint8Array(l,u,r):s===Fe.UNSIGNED_SHORT?f=new Uint16Array(l,u,r):s===Fe.UNSIGNED_INT&&(f=new Uint32Array(l,u,r)),f}function sz(e,t){throw e.unload(),e._state=yt.FAILED,e.getError("Failed to load index buffer",t)}function az(){this.typedArray=void 0,this.indexDatatype=void 0,this.context=void 0,this.buffer=void 0}az.prototype.set=function(e,t,n){this.typedArray=e,this.indexDatatype=t,this.context=n};az.prototype.execute=function(){this.buffer=Nne(this.typedArray,this.indexDatatype,this.context)};function Nne(e,t,n){let i=xt.createIndexBuffer({typedArray:e,context:n,usage:ke.STATIC_DRAW,indexDatatype:t});return i.vertexArrayDestroyable=!1,i}U_.prototype.process=function(e){if(A.typeOf.object("frameState",e),this._state===yt.READY)return!0;if(this._state!==yt.LOADED&&this._state!==yt.PROCESSING)return!1;let t=this._typedArray,n=this._indexDatatype;if(c(this._dracoLoader))try{this._dracoLoader.process(e)&&(t=this._dracoLoader.decodedData.indices.typedArray,this._typedArray=t,n=$.fromTypedArray(t),this._indexDatatype=n)}catch(o){sz(this,o)}if(!c(t))return!1;let i;if(this._loadBuffer&&this._asynchronous){let o=uNe;if(o.set(t,n,e.context),!e.jobScheduler.execute(o,Ha.BUFFER))return!1;i=o.buffer}else this._loadBuffer&&(i=Nne(t,n,e.context));return this.unload(),this._buffer=i,this._typedArray=this._loadTypedArray?t:void 0,this._state=yt.READY,this._resourceCache.statistics.addGeometryLoader(this),!0};U_.prototype.unload=function(){c(this._buffer)&&this._buffer.destroy();let e=this._resourceCache;c(this._bufferViewLoader)&&!this._bufferViewLoader.isDestroyed()&&e.unload(this._bufferViewLoader),c(this._dracoLoader)&&e.unload(this._dracoLoader),this._bufferViewLoader=void 0,this._dracoLoader=void 0,this._typedArray=void 0,this._buffer=void 0,this._gltf=void 0};var wO=U_;function mNe(e,t,n){if(n=y(n,!1),n){let i=e.indexOf(t);if(i>-1)return i}return e.push(t),e.length-1}var Ys=mNe;function pNe(e,t){return c(e.extensionsUsed)&&e.extensionsUsed.indexOf(t)>=0}var Pr=pNe;function Xt(){}Xt.objectLegacy=function(e,t){if(c(e)){for(let n in e)if(Object.prototype.hasOwnProperty.call(e,n)){let i=e[n],o=t(i,n);if(c(o))return o}}};Xt.object=function(e,t){if(c(e)){let n=e.length;for(let i=0;i<n;i++){let o=e[i],r=t(o,i);if(c(r))return r}}};Xt.topLevel=function(e,t,n){let i=e[t];return c(i)&&!Array.isArray(i)?Xt.objectLegacy(i,n):Xt.object(i,n)};Xt.accessor=function(e,t){return Xt.topLevel(e,"accessors",t)};Xt.accessorWithSemantic=function(e,t,n){let i={};return Xt.mesh(e,function(o){return Xt.meshPrimitive(o,function(r){let s=Xt.meshPrimitiveAttribute(r,function(a,l){if(l.indexOf(t)===0&&!c(i[a])){i[a]=!0;let u=n(a);if(c(u))return u}});return c(s)?s:Xt.meshPrimitiveTarget(r,function(a){return Xt.meshPrimitiveTargetAttribute(a,function(l,u){if(u.indexOf(t)===0&&!c(i[l])){i[l]=!0;let f=n(l);if(c(f))return f}})})})})};Xt.accessorContainingVertexAttributeData=function(e,t){let n={};return Xt.mesh(e,function(i){return Xt.meshPrimitive(i,function(o){let r=Xt.meshPrimitiveAttribute(o,function(s){if(!c(n[s])){n[s]=!0;let a=t(s);if(c(a))return a}});return c(r)?r:Xt.meshPrimitiveTarget(o,function(s){return Xt.meshPrimitiveTargetAttribute(s,function(a){if(!c(n[a])){n[a]=!0;let l=t(a);if(c(l))return l}})})})})};Xt.accessorContainingIndexData=function(e,t){let n={};return Xt.mesh(e,function(i){return Xt.meshPrimitive(i,function(o){let r=o.indices;if(c(r)&&!c(n[r])){n[r]=!0;let s=t(r);if(c(s))return s}})})};Xt.animation=function(e,t){return Xt.topLevel(e,"animations",t)};Xt.animationChannel=function(e,t){let n=e.channels;return Xt.object(n,t)};Xt.animationSampler=function(e,t){let n=e.samplers;return Xt.object(n,t)};Xt.buffer=function(e,t){return Xt.topLevel(e,"buffers",t)};Xt.bufferView=function(e,t){return Xt.topLevel(e,"bufferViews",t)};Xt.camera=function(e,t){return Xt.topLevel(e,"cameras",t)};Xt.image=function(e,t){return Xt.topLevel(e,"images",t)};Xt.material=function(e,t){return Xt.topLevel(e,"materials",t)};Xt.materialValue=function(e,t){let n=e.values;c(e.extensions)&&c(e.extensions.KHR_techniques_webgl)&&(n=e.extensions.KHR_techniques_webgl.values);for(let i in n)if(Object.prototype.hasOwnProperty.call(n,i)){let o=t(n[i],i);if(c(o))return o}};Xt.mesh=function(e,t){return Xt.topLevel(e,"meshes",t)};Xt.meshPrimitive=function(e,t){let n=e.primitives;if(c(n)){let i=n.length;for(let o=0;o<i;o++){let r=n[o],s=t(r,o);if(c(s))return s}}};Xt.meshPrimitiveAttribute=function(e,t){let n=e.attributes;for(let i in n)if(Object.prototype.hasOwnProperty.call(n,i)){let o=t(n[i],i);if(c(o))return o}};Xt.meshPrimitiveTarget=function(e,t){let n=e.targets;if(c(n)){let i=n.length;for(let o=0;o<i;++o){let r=t(n[o],o);if(c(r))return r}}};Xt.meshPrimitiveTargetAttribute=function(e,t){for(let n in e)if(Object.prototype.hasOwnProperty.call(e,n)){let i=e[n],o=t(i,n);if(c(o))return o}};Xt.node=function(e,t){return Xt.topLevel(e,"nodes",t)};Xt.nodeInTree=function(e,t,n){let i=e.nodes;if(c(i)){let o=t.length;for(let r=0;r<o;r++){let s=t[r],a=i[s];if(c(a)){let l=n(a,s);if(c(l))return l;let u=a.children;if(c(u)&&(l=Xt.nodeInTree(e,u,n),c(l)))return l}}}};Xt.nodeInScene=function(e,t,n){let i=t.nodes;if(c(i))return Xt.nodeInTree(e,i,n)};Xt.program=function(e,t){return Pr(e,"KHR_techniques_webgl")?Xt.object(e.extensions.KHR_techniques_webgl.programs,t):Xt.topLevel(e,"programs",t)};Xt.sampler=function(e,t){return Xt.topLevel(e,"samplers",t)};Xt.scene=function(e,t){return Xt.topLevel(e,"scenes",t)};Xt.shader=function(e,t){return Pr(e,"KHR_techniques_webgl")?Xt.object(e.extensions.KHR_techniques_webgl.shaders,t):Xt.topLevel(e,"shaders",t)};Xt.skin=function(e,t){return Xt.topLevel(e,"skins",t)};Xt.skinJoint=function(e,t){let n=e.joints;if(c(n)){let i=n.length;for(let o=0;o<i;o++){let r=n[o],s=t(r);if(c(s))return s}}};Xt.techniqueAttribute=function(e,t){let n=e.attributes;for(let i in n)if(Object.prototype.hasOwnProperty.call(n,i)){let o=t(n[i],i);if(c(o))return o}};Xt.techniqueUniform=function(e,t){let n=e.uniforms;for(let i in n)if(Object.prototype.hasOwnProperty.call(n,i)){let o=t(n[i],i);if(c(o))return o}};Xt.techniqueParameter=function(e,t){let n=e.parameters;for(let i in n)if(Object.prototype.hasOwnProperty.call(n,i)){let o=t(n[i],i);if(c(o))return o}};Xt.technique=function(e,t){return Pr(e,"KHR_techniques_webgl")?Xt.object(e.extensions.KHR_techniques_webgl.techniques,t):Xt.topLevel(e,"techniques",t)};Xt.texture=function(e,t){return Xt.topLevel(e,"textures",t)};var Oe=Xt;function _Ne(e){switch(e){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}}var Jf=_Ne;function gNe(e,t){let n=t.bufferView;if(c(n)){let i=e.bufferViews[n];if(c(i.byteStride)&&i.byteStride>0)return i.byteStride}return $.getSizeInBytes(t.componentType)*Jf(t.type)}var Yu=gNe;function yNe(e){Oe.accessor(e,function(n){c(n.bufferView)&&(n.byteOffset=y(n.byteOffset,0))}),Oe.bufferView(e,function(n){c(n.buffer)&&(n.byteOffset=y(n.byteOffset,0))}),Oe.mesh(e,function(n){Oe.meshPrimitive(n,function(i){if(i.mode=y(i.mode,ne.TRIANGLES),!c(i.material)){c(e.materials)||(e.materials=[]);let o={name:"default"};i.material=Ys(e.materials,o)}})}),Oe.accessorContainingVertexAttributeData(e,function(n){let i=e.accessors[n],o=i.bufferView;if(i.normalized=y(i.normalized,!1),c(o)){let r=e.bufferViews[o];r.byteStride=Yu(e,i),r.target=ne.ARRAY_BUFFER}}),Oe.accessorContainingIndexData(e,function(n){let o=e.accessors[n].bufferView;if(c(o)){let r=e.bufferViews[o];r.target=ne.ELEMENT_ARRAY_BUFFER}}),Oe.material(e,function(n){let i=y(n.extensions,y.EMPTY_OBJECT),o=i.KHR_materials_common;if(c(o)){let l=o.technique,u=c(o.values)?o.values:{};o.values=u,u.ambient=c(u.ambient)?u.ambient:[0,0,0,1],u.emission=c(u.emission)?u.emission:[0,0,0,1],u.transparency=y(u.transparency,1),l!=="CONSTANT"&&(u.diffuse=c(u.diffuse)?u.diffuse:[0,0,0,1],l!=="LAMBERT"&&(u.specular=c(u.specular)?u.specular:[0,0,0,1],u.shininess=y(u.shininess,0))),o.transparent=y(o.transparent,!1),o.doubleSided=y(o.doubleSided,!1);return}n.emissiveFactor=y(n.emissiveFactor,[0,0,0]),n.alphaMode=y(n.alphaMode,"OPAQUE"),n.doubleSided=y(n.doubleSided,!1),n.alphaMode==="MASK"&&(n.alphaCutoff=y(n.alphaCutoff,.5));let r=i.KHR_techniques_webgl;c(r)&&Oe.materialValue(n,function(l){c(l.index)&&h0(l)}),h0(n.emissiveTexture),h0(n.normalTexture),h0(n.occlusionTexture);let s=n.pbrMetallicRoughness;c(s)&&(s.baseColorFactor=y(s.baseColorFactor,[1,1,1,1]),s.metallicFactor=y(s.metallicFactor,1),s.roughnessFactor=y(s.roughnessFactor,1),h0(s.baseColorTexture),h0(s.metallicRoughnessTexture));let a=i.KHR_materials_pbrSpecularGlossiness;c(a)&&(a.diffuseFactor=y(a.diffuseFactor,[1,1,1,1]),a.specularFactor=y(a.specularFactor,[1,1,1]),a.glossinessFactor=y(a.glossinessFactor,1),h0(a.specularGlossinessTexture))}),Oe.animation(e,function(n){Oe.animationSampler(n,function(i){i.interpolation=y(i.interpolation,"LINEAR")})});let t=bNe(e);return Oe.node(e,function(n,i){c(t[i])||c(n.translation)||c(n.rotation)||c(n.scale)?(n.translation=y(n.translation,[0,0,0]),n.rotation=y(n.rotation,[0,0,0,1]),n.scale=y(n.scale,[1,1,1])):n.matrix=y(n.matrix,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}),Oe.sampler(e,function(n){n.wrapS=y(n.wrapS,ne.REPEAT),n.wrapT=y(n.wrapT,ne.REPEAT)}),c(e.scenes)&&!c(e.scene)&&(e.scene=0),e}function bNe(e){let t={};return Oe.animation(e,function(n){Oe.animationChannel(n,function(i){let o=i.target,r=o.node,s=o.path;(s==="translation"||s==="rotation"||s==="scale")&&(t[r]=!0)})}),t}function h0(e){c(e)&&(e.texCoord=y(e.texCoord,0))}var cz=yNe;function xNe(e){return Oe.shader(e,function(t){vO(t)}),Oe.buffer(e,function(t){vO(t)}),Oe.image(e,function(t){vO(t)}),vO(e),e}function vO(e){e.extras=c(e.extras)?e.extras:{},e.extras._pipeline=c(e.extras._pipeline)?e.extras._pipeline:{}}var sT=xNe;function TNe(e,t){let n=e.extensionsRequired;if(c(n)){let i=n.indexOf(t);i>=0&&n.splice(i,1),n.length===0&&delete e.extensionsRequired}}var lz=TNe;function ANe(e,t){let n=e.extensionsUsed;if(c(n)){let i=n.indexOf(t);i>=0&&n.splice(i,1),lz(e,t),n.length===0&&delete e.extensionsUsed}}var BS=ANe;var CNe=4;function ENe(e){if(qm(e)!=="glTF")throw new ue("File is not valid binary glTF");let n=Fne(e,0,5),i=n[1];if(i!==1&&i!==2)throw new ue("Binary glTF version is not 1 or 2");return i===1?SNe(e,n):wNe(e,n)}function Fne(e,t,n){let i=new DataView(e.buffer),o=new Array(n);for(let r=0;r<n;++r)o[r]=i.getUint32(e.byteOffset+t+r*CNe,!0);return o}function SNe(e,t){let n=t[2],i=t[3];if(t[4]!==0)throw new ue("Binary glTF scene format is not JSON");let r=20,s=r+i,a=Gu(e,r,i),l=JSON.parse(a);sT(l);let u=e.subarray(s,n),f=l.buffers;if(c(f)&&Object.keys(f).length>0){let d=y(f.binary_glTF,f.KHR_binary_glTF);c(d)&&(d.extras._pipeline.source=u,delete d.uri)}return BS(l,"KHR_binary_glTF"),l}function wNe(e,t){let n=t[2],i=12,o,r;for(;i<n;){let s=Fne(e,i,2),a=s[0],l=s[1];i+=8;let u=e.subarray(i,i+a);if(i+=a,l===1313821514){let f=Gu(u);o=JSON.parse(f),sT(o)}else l===5130562&&(r=u)}if(c(o)&&c(r)){let s=o.buffers;if(c(s)&&s.length>0){let a=s[0];a.extras._pipeline.source=r}}return o}var uz=ENe;function vNe(e){return Oe.shader(e,function(t){DO(t)}),Oe.buffer(e,function(t){DO(t)}),Oe.image(e,function(t){DO(t)}),DO(e),e}function DO(e){c(e.extras)&&(c(e.extras._pipeline)&&delete e.extras._pipeline,Object.keys(e.extras).length===0&&delete e.extras)}var fz=vNe;function DNe(e,t){let n=e.extensionsUsed;c(n)||(n=[],e.extensionsUsed=n),Ys(n,t,!0)}var ph=DNe;function PNe(e){switch(e){case $.BYTE:return function(t,n,i,o,r){for(let s=0;s<i;++s)r[s]=t.getInt8(n+s*o)};case $.UNSIGNED_BYTE:return function(t,n,i,o,r){for(let s=0;s<i;++s)r[s]=t.getUint8(n+s*o)};case $.SHORT:return function(t,n,i,o,r){for(let s=0;s<i;++s)r[s]=t.getInt16(n+s*o,!0)};case $.UNSIGNED_SHORT:return function(t,n,i,o,r){for(let s=0;s<i;++s)r[s]=t.getUint16(n+s*o,!0)};case $.INT:return function(t,n,i,o,r){for(let s=0;s<i;++s)r[s]=t.getInt32(n+s*o,!0)};case $.UNSIGNED_INT:return function(t,n,i,o,r){for(let s=0;s<i;++s)r[s]=t.getUint32(n+s*o,!0)};case $.FLOAT:return function(t,n,i,o,r){for(let s=0;s<i;++s)r[s]=t.getFloat32(n+s*o,!0)};case $.DOUBLE:return function(t,n,i,o,r){for(let s=0;s<i;++s)r[s]=t.getFloat64(n+s*o,!0)}}}var m0=PNe;function INe(e,t){let n=e.bufferViews,i=e.buffers,o=t.bufferView,r=Jf(t.type);if(!c(t.bufferView))return{min:new Array(r).fill(0),max:new Array(r).fill(0)};let s=new Array(r).fill(Number.POSITIVE_INFINITY),a=new Array(r).fill(Number.NEGATIVE_INFINITY),l=n[o],u=l.buffer,d=i[u].extras._pipeline.source,p=t.count,g=Yu(e,t),m=t.byteOffset+l.byteOffset+d.byteOffset,b=t.componentType,x=$.getSizeInBytes(b),T=new DataView(d.buffer),C=new Array(r),S=m0(b);for(let v=0;v<p;v++){S(T,m,r,x,C);for(let D=0;D<r;D++){let I=C[D];s[D]=Math.min(s[D],I),a[D]=Math.max(a[D],I)}m+=g}return{min:s,max:a}}var kS=INe;var ONe=[ne.FUNC_ADD,ne.FUNC_ADD],RNe=[ne.ONE,ne.ZERO,ne.ONE,ne.ZERO];function Bne(e,t){let n=e.enable;return c(n)?n.indexOf(t)>-1:!1}var MNe=[ne.ZERO,ne.ONE,ne.SRC_COLOR,ne.ONE_MINUS_SRC_COLOR,ne.SRC_ALPHA,ne.ONE_MINUS_SRC_ALPHA,ne.DST_ALPHA,ne.ONE_MINUS_DST_ALPHA,ne.DST_COLOR,ne.ONE_MINUS_DST_COLOR];function LNe(e,t){if(!c(e))return t;for(let n=0;n<4;n++)if(MNe.indexOf(e[n])===-1)return t;return e}function NNe(e){let t={},n={},i=e.techniques;return c(i)&&(Oe.technique(e,function(o,r){let s=o.states;if(c(s)){let a=n[r]={};if(Bne(s,ne.BLEND)){a.alphaMode="BLEND";let l=s.functions;c(l)&&(c(l.blendEquationSeparate)||c(l.blendFuncSeparate))&&(t[r]={blendEquation:y(l.blendEquationSeparate,ONe),blendFactors:LNe(l.blendFuncSeparate,RNe)})}Bne(s,ne.CULL_FACE)||(a.doubleSided=!0),delete o.states}}),Object.keys(t).length>0&&(c(e.extensions)||(e.extensions={}),ph(e,"KHR_blend")),Oe.material(e,function(o){if(c(o.technique)){let r=n[o.technique];Oe.objectLegacy(r,function(a,l){o[l]=a});let s=t[o.technique];c(s)&&(c(o.extensions)||(o.extensions={}),o.extensions.KHR_blend=s)}})),e}var dz=NNe;function FNe(e,t){let n=e.extensionsRequired;c(n)||(n=[],e.extensionsRequired=n),Ys(n,t,!0),ph(e,t)}var hz=FNe;function BNe(e){let t=e.techniques,n={},i={},o={};if(c(t)){let r={programs:[],shaders:[],techniques:[]},s=e.glExtensionsUsed;delete e.glExtensionsUsed,Oe.technique(e,function(a,l){let u={name:a.name,program:void 0,attributes:{},uniforms:{}},f;if(Oe.techniqueAttribute(a,function(d,p){f=a.parameters[d],u.attributes[p]={semantic:f.semantic}}),Oe.techniqueUniform(a,function(d,p){f=a.parameters[d],u.uniforms[p]={count:f.count,node:f.node,type:f.type,semantic:f.semantic,value:f.value},c(n[l])||(n[l]={}),n[l][d]=p}),c(o[a.program]))u.program=o[a.program];else{let d=e.programs[a.program],p={name:d.name,fragmentShader:void 0,vertexShader:void 0,glExtensions:s},g=e.shaders[d.fragmentShader];p.fragmentShader=Ys(r.shaders,g,!0);let m=e.shaders[d.vertexShader];p.vertexShader=Ys(r.shaders,m,!0),u.program=Ys(r.programs,p),o[a.program]=u.program}i[l]=Ys(r.techniques,u)}),r.techniques.length>0&&(c(e.extensions)||(e.extensions={}),e.extensions.KHR_techniques_webgl=r,ph(e,"KHR_techniques_webgl"),hz(e,"KHR_techniques_webgl"))}return Oe.material(e,function(r){if(c(r.technique)){let s={technique:i[r.technique]};Oe.objectLegacy(r.values,function(a,l){c(s.values)||(s.values={});let u=n[r.technique][l];c(u)&&(s.values[u]=a)}),c(r.extensions)||(r.extensions={}),r.extensions.KHR_techniques_webgl=s}delete r.technique,delete r.values}),delete e.techniques,delete e.programs,delete e.shaders,e}var mz=BNe;function kNe(e,t){A.typeOf.object("material",e),A.defined("handler",t);let n=e.pbrMetallicRoughness;if(c(n)){if(c(n.baseColorTexture)){let r=n.baseColorTexture,s=t(r.index,r);if(c(s))return s}if(c(n.metallicRoughnessTexture)){let r=n.metallicRoughnessTexture,s=t(r.index,r);if(c(s))return s}}let{extensions:i}=e;if(c(i)){let r=i.KHR_materials_pbrSpecularGlossiness;if(c(r)){if(c(r.diffuseTexture)){let l=r.diffuseTexture,u=t(l.index,l);if(c(u))return u}if(c(r.specularGlossinessTexture)){let l=r.specularGlossinessTexture,u=t(l.index,l);if(c(u))return u}}let s=i.KHR_materials_specular;if(c(s)){let{specularTexture:l,specularColorTexture:u}=s;if(c(l)){let f=t(l.index,l);if(c(f))return f}if(c(u)){let f=t(u.index,u);if(c(f))return f}}let a=i.KHR_materials_common;if(c(a)&&c(a.values)){let{diffuse:l,ambient:u,emission:f,specular:d}=a.values;if(c(l)&&c(l.index)){let p=t(l.index,l);if(c(p))return p}if(c(u)&&c(u.index)){let p=t(u.index,u);if(c(p))return p}if(c(f)&&c(f.index)){let p=t(f.index,f);if(c(p))return p}if(c(d)&&c(d.index)){let p=t(d.index,d);if(c(p))return p}}}let o=Oe.materialValue(e,function(r){if(c(r.index)){let s=t(r.index,r);if(c(s))return s}});if(c(o))return o;if(c(e.emissiveTexture)){let r=e.emissiveTexture,s=t(r.index,r);if(c(s))return s}if(c(e.normalTexture)){let r=e.normalTexture,s=t(r.index,r);if(c(s))return s}if(c(e.occlusionTexture)){let r=e.occlusionTexture,s=t(r.index,r);if(c(s))return s}}var PO=kNe;var kne=["mesh","node","material","accessor","bufferView","buffer","texture","sampler","image"];function VNe(e,t){return t=y(t,kne),kne.forEach(function(n){t.indexOf(n)>-1&&zNe(e,n)}),e}var UNe={accessor:"accessors",buffer:"buffers",bufferView:"bufferViews",image:"images",node:"nodes",material:"materials",mesh:"meshes",sampler:"samplers",texture:"textures"};function zNe(e,t){let n=UNe[t],i=e[n];if(c(i)){let o=0,r=gh[t](e),s=i.length;for(let a=0;a<s;++a)r[a]||(_h[t](e,a-o),o++)}}function _h(){}_h.accessor=function(e,t){e.accessors.splice(t,1),Oe.mesh(e,function(i){Oe.meshPrimitive(i,function(o){Oe.meshPrimitiveAttribute(o,function(a,l){a>t&&o.attributes[l]--}),Oe.meshPrimitiveTarget(o,function(a){Oe.meshPrimitiveTargetAttribute(a,function(l,u){l>t&&a[u]--})});let r=o.indices;c(r)&&r>t&&o.indices--;let s=o.extensions;c(s)&&c(s.CESIUM_primitive_outline)&&s.CESIUM_primitive_outline.indices>t&&--s.CESIUM_primitive_outline.indices})}),Oe.skin(e,function(i){c(i.inverseBindMatrices)&&i.inverseBindMatrices>t&&i.inverseBindMatrices--}),Oe.animation(e,function(i){Oe.animationSampler(i,function(o){c(o.input)&&o.input>t&&o.input--,c(o.output)&&o.output>t&&o.output--})})};_h.buffer=function(e,t){e.buffers.splice(t,1),Oe.bufferView(e,function(i){c(i.buffer)&&i.buffer>t&&i.buffer--,c(i.extensions)&&c(i.extensions.EXT_meshopt_compression)&&i.extensions.EXT_meshopt_compression.buffer--})};_h.bufferView=function(e,t){if(e.bufferViews.splice(t,1),Oe.accessor(e,function(i){c(i.bufferView)&&i.bufferView>t&&i.bufferView--}),Oe.shader(e,function(i){c(i.bufferView)&&i.bufferView>t&&i.bufferView--}),Oe.image(e,function(i){c(i.bufferView)&&i.bufferView>t&&i.bufferView--}),Pr(e,"KHR_draco_mesh_compression")&&Oe.mesh(e,function(i){Oe.meshPrimitive(i,function(o){c(o.extensions)&&c(o.extensions.KHR_draco_mesh_compression)&&o.extensions.KHR_draco_mesh_compression.bufferView>t&&o.extensions.KHR_draco_mesh_compression.bufferView--})}),Pr(e,"EXT_feature_metadata")){let o=e.extensions.EXT_feature_metadata.featureTables;for(let r in o)if(o.hasOwnProperty(r)){let a=o[r].properties;if(c(a)){for(let l in a)if(a.hasOwnProperty(l)){let u=a[l];c(u.bufferView)&&u.bufferView>t&&u.bufferView--,c(u.arrayOffsetBufferView)&&u.arrayOffsetBufferView>t&&u.arrayOffsetBufferView--,c(u.stringOffsetBufferView)&&u.stringOffsetBufferView>t&&u.stringOffsetBufferView--}}}}if(Pr(e,"EXT_structural_metadata")){let o=e.extensions.EXT_structural_metadata.propertyTables;if(c(o)){let r=o.length;for(let s=0;s<r;++s){let l=o[s].properties;for(let u in l)if(l.hasOwnProperty(u)){let f=l[u];c(f.values)&&f.values>t&&f.values--,c(f.arrayOffsets)&&f.arrayOffsets>t&&f.arrayOffsets--,c(f.stringOffsets)&&f.stringOffsets>t&&f.stringOffsets--}}}}};_h.image=function(e,t){e.images.splice(t,1),Oe.texture(e,function(i){c(i.source)&&i.source>t&&--i.source;let o=i.extensions;c(o)&&c(o.EXT_texture_webp)&&o.EXT_texture_webp.source>t?--i.extensions.EXT_texture_webp.source:c(o)&&c(o.KHR_texture_basisu)&&o.KHR_texture_basisu.source>t&&--i.extensions.KHR_texture_basisu.source})};_h.mesh=function(e,t){e.meshes.splice(t,1),Oe.node(e,function(i){c(i.mesh)&&(i.mesh>t?i.mesh--:i.mesh===t&&delete i.mesh)})};_h.node=function(e,t){e.nodes.splice(t,1),Oe.skin(e,function(i){c(i.skeleton)&&i.skeleton>t&&i.skeleton--,i.joints=i.joints.map(function(o){return o>t?o-1:o})}),Oe.animation(e,function(i){Oe.animationChannel(i,function(o){c(o.target)&&c(o.target.node)&&o.target.node>t&&o.target.node--})}),Oe.technique(e,function(i){Oe.techniqueUniform(i,function(o){c(o.node)&&o.node>t&&o.node--})}),Oe.node(e,function(i){c(i.children)&&(i.children=i.children.filter(function(o){return o!==t}).map(function(o){return o>t?o-1:o}))}),Oe.scene(e,function(i){i.nodes=i.nodes.filter(function(o){return o!==t}).map(function(o){return o>t?o-1:o})})};_h.material=function(e,t){e.materials.splice(t,1),Oe.mesh(e,function(i){Oe.meshPrimitive(i,function(o){c(o.material)&&o.material>t&&o.material--})})};_h.sampler=function(e,t){e.samplers.splice(t,1),Oe.texture(e,function(i){c(i.sampler)&&i.sampler>t&&--i.sampler})};_h.texture=function(e,t){if(e.textures.splice(t,1),Oe.material(e,function(i){PO(i,function(o,r){r.index>t&&--r.index})}),Pr(e,"EXT_feature_metadata")){Oe.mesh(e,function(r){Oe.meshPrimitive(r,function(s){let a=s.extensions;if(c(a)&&c(a.EXT_feature_metadata)){let u=a.EXT_feature_metadata.featureIdTextures;if(c(u)){let f=u.length;for(let d=0;d<f;++d){let g=u[d].featureIds.texture;g.index>t&&--g.index}}}})});let o=e.extensions.EXT_feature_metadata.featureTextures;for(let r in o)if(o.hasOwnProperty(r)){let a=o[r].properties;if(c(a)){for(let l in a)if(a.hasOwnProperty(l)){let f=a[l].texture;f.index>t&&--f.index}}}}if(Pr(e,"EXT_mesh_features")&&Oe.mesh(e,function(i){Oe.meshPrimitive(i,function(o){let r=o.extensions;if(c(r)&&c(r.EXT_mesh_features)){let a=r.EXT_mesh_features.featureIds;if(c(a)){let l=a.length;for(let u=0;u<l;++u){let f=a[u];c(f.texture)&&f.texture.index>t&&--f.texture.index}}}})}),Pr(e,"EXT_structural_metadata")){let o=e.extensions.EXT_structural_metadata.propertyTextures;if(c(o)){let r=o.length;for(let s=0;s<r;++s){let l=o[s].properties;for(let u in l)if(l.hasOwnProperty(u)){let f=l[u];f.index>t&&--f.index}}}}};function gh(){}gh.accessor=function(e){let t={};return Oe.mesh(e,function(n){Oe.meshPrimitive(n,function(i){Oe.meshPrimitiveAttribute(i,function(r){t[r]=!0}),Oe.meshPrimitiveTarget(i,function(r){Oe.meshPrimitiveTargetAttribute(r,function(s){t[s]=!0})});let o=i.indices;c(o)&&(t[o]=!0)})}),Oe.skin(e,function(n){c(n.inverseBindMatrices)&&(t[n.inverseBindMatrices]=!0)}),Oe.animation(e,function(n){Oe.animationSampler(n,function(i){c(i.input)&&(t[i.input]=!0),c(i.output)&&(t[i.output]=!0)})}),Pr(e,"EXT_mesh_gpu_instancing")&&Oe.node(e,function(n){c(n.extensions)&&c(n.extensions.EXT_mesh_gpu_instancing)&&Object.keys(n.extensions.EXT_mesh_gpu_instancing.attributes).forEach(function(i){let o=n.extensions.EXT_mesh_gpu_instancing.attributes[i];t[o]=!0})}),Pr(e,"CESIUM_primitive_outline")&&Oe.mesh(e,function(n){Oe.meshPrimitive(n,function(i){let o=i.extensions;if(c(o)&&c(o.CESIUM_primitive_outline)){let s=o.CESIUM_primitive_outline.indices;c(s)&&(t[s]=!0)}})}),t};gh.buffer=function(e){let t={};return Oe.bufferView(e,function(n){c(n.buffer)&&(t[n.buffer]=!0),c(n.extensions)&&c(n.extensions.EXT_meshopt_compression)&&(t[n.extensions.EXT_meshopt_compression.buffer]=!0)}),t};gh.bufferView=function(e){let t={};if(Oe.accessor(e,function(n){c(n.bufferView)&&(t[n.bufferView]=!0)}),Oe.shader(e,function(n){c(n.bufferView)&&(t[n.bufferView]=!0)}),Oe.image(e,function(n){c(n.bufferView)&&(t[n.bufferView]=!0)}),Pr(e,"KHR_draco_mesh_compression")&&Oe.mesh(e,function(n){Oe.meshPrimitive(n,function(i){c(i.extensions)&&c(i.extensions.KHR_draco_mesh_compression)&&(t[i.extensions.KHR_draco_mesh_compression.bufferView]=!0)})}),Pr(e,"EXT_feature_metadata")){let i=e.extensions.EXT_feature_metadata.featureTables;for(let o in i)if(i.hasOwnProperty(o)){let s=i[o].properties;if(c(s)){for(let a in s)if(s.hasOwnProperty(a)){let l=s[a];c(l.bufferView)&&(t[l.bufferView]=!0),c(l.arrayOffsetBufferView)&&(t[l.arrayOffsetBufferView]=!0),c(l.stringOffsetBufferView)&&(t[l.stringOffsetBufferView]=!0)}}}}if(Pr(e,"EXT_structural_metadata")){let i=e.extensions.EXT_structural_metadata.propertyTables;if(c(i)){let o=i.length;for(let r=0;r<o;++r){let a=i[r].properties;for(let l in a)if(a.hasOwnProperty(l)){let u=a[l];c(u.values)&&(t[u.values]=!0),c(u.arrayOffsets)&&(t[u.arrayOffsets]=!0),c(u.stringOffsets)&&(t[u.stringOffsets]=!0)}}}}return t};gh.image=function(e){let t={};return Oe.texture(e,function(n){c(n.source)&&(t[n.source]=!0),c(n.extensions)&&c(n.extensions.EXT_texture_webp)?t[n.extensions.EXT_texture_webp.source]=!0:c(n.extensions)&&c(n.extensions.KHR_texture_basisu)&&(t[n.extensions.KHR_texture_basisu.source]=!0)}),t};gh.mesh=function(e){let t={};return Oe.node(e,function(n){if(c(n.mesh&&c(e.meshes))){let i=e.meshes[n.mesh];c(i)&&c(i.primitives)&&i.primitives.length>0&&(t[n.mesh]=!0)}}),t};function Vne(e,t,n){let i=e.nodes[t];return c(i.mesh)||c(i.camera)||c(i.skin)||c(i.weights)||c(i.extras)||c(i.extensions)&&Object.keys(i.extensions).length!==0||c(n[t])?!1:!c(i.children)||i.children.filter(function(o){return!Vne(e,o,n)}).length===0}gh.node=function(e){let t={};return Oe.skin(e,function(n){c(n.skeleton)&&(t[n.skeleton]=!0),Oe.skinJoint(n,function(i){t[i]=!0})}),Oe.animation(e,function(n){Oe.animationChannel(n,function(i){c(i.target)&&c(i.target.node)&&(t[i.target.node]=!0)})}),Oe.technique(e,function(n){Oe.techniqueUniform(n,function(i){c(i.node)&&(t[i.node]=!0)})}),Oe.node(e,function(n,i){Vne(e,i,t)||(t[i]=!0)}),t};gh.material=function(e){let t={};return Oe.mesh(e,function(n){Oe.meshPrimitive(n,function(i){c(i.material)&&(t[i.material]=!0)})}),t};gh.texture=function(e){let t={};if(Oe.material(e,function(n){PO(n,function(i){t[i]=!0})}),Pr(e,"EXT_feature_metadata")){Oe.mesh(e,function(o){Oe.meshPrimitive(o,function(r){let s=r.extensions;if(c(s)&&c(s.EXT_feature_metadata)){let l=s.EXT_feature_metadata.featureIdTextures;if(c(l)){let u=l.length;for(let f=0;f<u;++f){let p=l[f].featureIds.texture;t[p.index]=!0}}}})});let i=e.extensions.EXT_feature_metadata.featureTextures;for(let o in i)if(i.hasOwnProperty(o)){let s=i[o].properties;if(c(s)){for(let a in s)if(s.hasOwnProperty(a)){let u=s[a].texture;t[u.index]=!0}}}}if(Pr(e,"EXT_mesh_features")&&Oe.mesh(e,function(n){Oe.meshPrimitive(n,function(i){let o=i.extensions;if(c(o)&&c(o.EXT_mesh_features)){let s=o.EXT_mesh_features.featureIds;if(c(s)){let a=s.length;for(let l=0;l<a;++l){let u=s[l];c(u.texture)&&(t[u.texture.index]=!0)}}}})}),Pr(e,"EXT_structural_metadata")){let i=e.extensions.EXT_structural_metadata.propertyTextures;if(c(i)){let o=i.length;for(let r=0;r<o;++r){let a=i[r].properties;for(let l in a)if(a.hasOwnProperty(l)){let u=a[l];t[u.index]=!0}}}}return t};gh.sampler=function(e){let t={};return Oe.texture(e,function(n){c(n.sampler)&&(t[n.sampler]=!0)}),t};var pz=VNe;function HNe(e,t){let n={byteLength:t.length,extras:{_pipeline:{source:t}}},o={buffer:Ys(e.buffers,n),byteOffset:0,byteLength:t.length};return Ys(e.bufferViews,o)}var _z=HNe;function GNe(e,t){let n=Yu(e,t),i=$.getSizeInBytes(t.componentType),o=Jf(t.type),r=t.count,s=new Array(o*r);if(!c(t.bufferView))return s.fill(0);let a=e.bufferViews[t.bufferView],l=e.buffers[a.buffer].extras._pipeline.source,u=t.byteOffset+a.byteOffset+l.byteOffset,f=new DataView(l.buffer),d=new Array(o),p=m0(t.componentType);for(let g=0;g<r;++g){p(f,u,o,i,d);for(let m=0;m<o;++m)s[g*o+m]=d[m];u+=n}return s}var gz=GNe;function jNe(e){let t;return Oe.accessorWithSemantic(e,"JOINTS_0",function(n){let i=e.accessors[n];t=i.componentType,t===ne.BYTE?IO(e,i,$.UNSIGNED_BYTE):t!==ne.UNSIGNED_BYTE&&t!==ne.UNSIGNED_SHORT&&IO(e,i,$.UNSIGNED_SHORT)}),Oe.accessorWithSemantic(e,"WEIGHTS_0",function(n){let i=e.accessors[n];t=i.componentType,t===ne.BYTE?IO(e,i,$.UNSIGNED_BYTE):t===ne.SHORT&&IO(e,i,$.UNSIGNED_SHORT)}),e}function IO(e,t,n){let i=$.createTypedArray(n,gz(e,t)),o=new Uint8Array(i.buffer);t.bufferView=_z(e,o),t.componentType=n,t.byteOffset=0}var yz=jNe;function WNe(e,t){return BS(e,t),t==="CESIUM_RTC"&&qNe(e),bz(e,t)}function qNe(e){Oe.technique(e,function(t){Oe.techniqueUniform(t,function(n){n.semantic==="CESIUM_RTC_MODELVIEW"&&(n.semantic="MODELVIEW")})})}function bz(e,t){if(Array.isArray(e)){let n=e.length;for(let i=0;i<n;++i)bz(e[i],t)}else if(e!==null&&typeof e=="object"&&e.constructor===Object){let n=e.extensions,i;c(n)&&(i=n[t],c(i)&&(delete n[t],Object.keys(n).length===0&&delete e.extensions));for(let o in e)Object.prototype.hasOwnProperty.call(e,o)&&bz(e[o],t);return i}}var VS=WNe;var OO={.8:JNe,"1.0":bFe,"2.0":void 0};function YNe(e,t){t=y(t,y.EMPTY_OBJECT);let n=t.targetVersion,i=e.version;e.asset=y(e.asset,{version:"1.0"}),e.asset.version=y(e.asset.version,"1.0"),i=y(i,e.asset.version).toString(),Object.prototype.hasOwnProperty.call(OO,i)||(c(i)&&(i=i.substring(0,3)),Object.prototype.hasOwnProperty.call(OO,i)||(i="1.0"));let o=OO[i];for(;c(o)&&i!==n;)o(e,t),i=e.asset.version,o=OO[i];return t.keepLegacyExtensions||(AFe(e,t),CFe(e)),e}function Hne(e){let t=e.materials;for(let n in t)if(Object.prototype.hasOwnProperty.call(t,n)){let i=t[n],o=i.instanceTechnique;c(o)&&(i.technique=o.technique,i.values=o.values,delete i.instanceTechnique)}}function XNe(e){let t=e.meshes;for(let n in t)if(Object.prototype.hasOwnProperty.call(t,n)){let o=t[n].primitives;if(c(o)){let r=o.length;for(let s=0;s<r;++s){let a=o[s],l=y(a.primitive,ne.TRIANGLES);a.mode=y(a.mode,l),delete a.primitive}}}}function KNe(e){let t=e.nodes,n=new h,i=new Ne;for(let o in t)if(Object.prototype.hasOwnProperty.call(t,o)){let r=t[o];if(c(r.rotation)){let a=r.rotation;h.fromArray(a,0,n),Ne.fromAxisAngle(n,a[3],i),r.rotation=[i.x,i.y,i.z,i.w]}let s=r.instanceSkin;c(s)&&(r.skeletons=s.skeletons,r.skin=s.skin,r.meshes=s.meshes,delete r.instanceSkin)}}function $Ne(e){let t=e.animations,n=e.accessors,i=e.bufferViews,o=e.buffers,r={},s=new h,a=new Ne;for(let l in t)if(Object.prototype.hasOwnProperty.call(t,l)){let u=t[l],f=u.channels,d=u.parameters,p=u.samplers;if(c(f)){let g=f.length;for(let m=0;m<g;++m){let b=f[m];if(b.target.path==="rotation"){let x=d[p[b.sampler].output];if(c(r[x]))continue;r[x]=!0;let T=n[x],C=i[T.bufferView],v=o[C.buffer].extras._pipeline.source,D=v.byteOffset+C.byteOffset+T.byteOffset,I=T.componentType,L=T.count,M=Jf(T.type),N=T.count*M,B=$.createArrayBufferView(I,v.buffer,D,N);for(let _=0;_<L;_++){let w=_*M;h.unpack(B,w,s);let P=B[w+3];Ne.fromAxisAngle(s,P,a),Ne.pack(a,B,w)}}}}}}function ZNe(e){let t=e.techniques;for(let n in t)if(Object.prototype.hasOwnProperty.call(t,n)){let i=t[n],o=i.passes;if(c(o)){let r=y(i.pass,"defaultPass");if(Object.prototype.hasOwnProperty.call(o,r)){let s=o[r],a=s.instanceProgram;i.attributes=y(i.attributes,a.attributes),i.program=y(i.program,a.program),i.uniforms=y(i.uniforms,a.uniforms),i.states=y(i.states,s.states)}delete i.passes,delete i.pass}}}function JNe(e){c(e.asset)||(e.asset={});let t=e.asset;if(t.version="1.0",typeof t.profile=="string"){let n=t.profile.split(" ");t.profile={api:n[0],version:n[1]}}else t.profile={};if(c(e.version)&&delete e.version,Hne(e),XNe(e),KNe(e),$Ne(e),ZNe(e),c(e.allExtensions)&&(e.extensionsUsed=e.allExtensions,delete e.allExtensions),c(e.lights)){let n=y(e.extensions,{});e.extensions=n;let i=y(n.KHR_materials_common,{});n.KHR_materials_common=i,i.lights=e.lights,delete e.lights,ph(e,"KHR_materials_common")}}function QNe(e){let t=e.animations;for(let n in t)if(Object.prototype.hasOwnProperty.call(t,n)){let i=t[n],o=i.parameters;if(c(o)){let r=i.samplers;for(let s in r)if(Object.prototype.hasOwnProperty.call(r,s)){let a=r[s];a.input=o[a.input],a.output=o[a.output]}delete i.parameters}}}function Une(e,t){let n=[];for(let i in e)if(Object.prototype.hasOwnProperty.call(e,i)){let o=e[i];t[i]=n.length,n.push(o),c(o.name)||(o.name=i)}return n}function eFe(e){let t,n={accessors:{},animations:{},buffers:{},bufferViews:{},cameras:{},images:{},materials:{},meshes:{},nodes:{},programs:{},samplers:{},scenes:{},shaders:{},skins:{},textures:{},techniques:{}},i,o={},r=e.nodes;for(let s in r)Object.prototype.hasOwnProperty.call(r,s)&&(i=r[s].jointName,c(i)&&(o[i]=s));for(let s in e)if(Object.prototype.hasOwnProperty.call(e,s)&&c(n[s])){let a={},l=e[s];e[s]=Une(l,a),n[s]=a}for(i in o)Object.prototype.hasOwnProperty.call(o,i)&&(o[i]=n.nodes[o[i]]);c(e.scene)&&(e.scene=n.scenes[e.scene]),Oe.bufferView(e,function(s){c(s.buffer)&&(s.buffer=n.buffers[s.buffer])}),Oe.accessor(e,function(s){c(s.bufferView)&&(s.bufferView=n.bufferViews[s.bufferView])}),Oe.shader(e,function(s){let a=s.extensions;if(c(a)){let l=a.KHR_binary_glTF;c(l)&&(s.bufferView=n.bufferViews[l.bufferView],delete a.KHR_binary_glTF),Object.keys(a).length===0&&delete s.extensions}}),Oe.program(e,function(s){c(s.vertexShader)&&(s.vertexShader=n.shaders[s.vertexShader]),c(s.fragmentShader)&&(s.fragmentShader=n.shaders[s.fragmentShader])}),Oe.technique(e,function(s){c(s.program)&&(s.program=n.programs[s.program]),Oe.techniqueParameter(s,function(a){c(a.node)&&(a.node=n.nodes[a.node]);let l=a.value;typeof l=="string"&&(a.value={index:n.textures[l]})})}),Oe.mesh(e,function(s){Oe.meshPrimitive(s,function(a){c(a.indices)&&(a.indices=n.accessors[a.indices]),Oe.meshPrimitiveAttribute(a,function(l,u){a.attributes[u]=n.accessors[l]}),c(a.material)&&(a.material=n.materials[a.material])})}),Oe.node(e,function(s){let a=s.children;if(c(a)){let l=a.length;for(t=0;t<l;++t)a[t]=n.nodes[a[t]]}if(c(s.meshes)){let l=s.meshes,u=l.length;if(u>0)for(s.mesh=n.meshes[l[0]],t=1;t<u;++t){let f={mesh:n.meshes[l[t]]},d=Ys(e.nodes,f);c(a)||(a=[],s.children=a),a.push(d)}delete s.meshes}if(c(s.camera)&&(s.camera=n.cameras[s.camera]),c(s.skin)&&(s.skin=n.skins[s.skin]),c(s.skeletons)){let l=s.skeletons;if(l.length>0&&c(s.skin)){let f=e.skins[s.skin];f.skeleton=n.nodes[l[0]]}delete s.skeletons}c(s.jointName)&&delete s.jointName}),Oe.skin(e,function(s){c(s.inverseBindMatrices)&&(s.inverseBindMatrices=n.accessors[s.inverseBindMatrices]);let a=s.jointNames;if(c(a)){let l=[],u=a.length;for(t=0;t<u;++t)l[t]=o[a[t]];s.joints=l,delete s.jointNames}}),Oe.scene(e,function(s){let a=s.nodes;if(c(a)){let l=a.length;for(t=0;t<l;++t)a[t]=n.nodes[a[t]]}}),Oe.animation(e,function(s){let a={};s.samplers=Une(s.samplers,a),Oe.animationSampler(s,function(l){l.input=n.accessors[l.input],l.output=n.accessors[l.output]}),Oe.animationChannel(s,function(l){l.sampler=a[l.sampler];let u=l.target;c(u)&&(u.node=n.nodes[u.id],delete u.id)})}),Oe.material(e,function(s){c(s.technique)&&(s.technique=n.techniques[s.technique]),Oe.materialValue(s,function(l,u){typeof l=="string"&&(s.values[u]={index:n.textures[l]})});let a=s.extensions;if(c(a)){let l=a.KHR_materials_common;c(l)&&c(l.values)&&Oe.materialValue(l,function(u,f){typeof u=="string"&&(l.values[f]={index:n.textures[u]})})}}),Oe.image(e,function(s){let a=s.extensions;if(c(a)){let l=a.KHR_binary_glTF;c(l)&&(s.bufferView=n.bufferViews[l.bufferView],s.mimeType=l.mimeType,delete a.KHR_binary_glTF),Object.keys(a).length===0&&delete s.extensions}}),Oe.texture(e,function(s){c(s.sampler)&&(s.sampler=n.samplers[s.sampler]),c(s.source)&&(s.source=n.images[s.source])})}function tFe(e){Oe.animation(e,function(t){Oe.animationSampler(t,function(n){delete n.name})})}function nFe(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t)){let n=e[t];Array.isArray(n)&&n.length===0&&delete e[t]}Oe.node(e,function(t){c(t.children)&&t.children.length===0&&delete t.children})}function iFe(e){let t=e.asset;delete t.profile,delete t.premultipliedAlpha}var oFe={CESIUM_RTC:!0,KHR_materials_common:!0,WEB3D_quantized_attributes:!0};function rFe(e){let t=e.extensionsUsed;if(e.extensionsRequired=y(e.extensionsRequired,[]),c(t)){let n=t.length;for(let i=0;i<n;++i){let o=t[i];c(oFe[o])&&e.extensionsRequired.push(o)}}}function sFe(e){Oe.buffer(e,function(t){delete t.type})}function aFe(e){Oe.texture(e,function(t){delete t.format,delete t.internalFormat,delete t.target,delete t.type})}function cFe(e){Oe.mesh(e,function(t){Oe.meshPrimitive(t,function(n){Oe.meshPrimitiveAttribute(n,function(i,o){o==="TEXCOORD"?n.attributes.TEXCOORD_0=i:o==="COLOR"&&(n.attributes.COLOR_0=i)}),delete n.attributes.TEXCOORD,delete n.attributes.COLOR})}),Oe.technique(e,function(t){Oe.techniqueParameter(t,function(n){let i=n.semantic;c(i)&&(i==="TEXCOORD"?n.semantic="TEXCOORD_0":i==="COLOR"&&(n.semantic="COLOR_0"))})})}var lFe={POSITION:!0,NORMAL:!0,TANGENT:!0},uFe={COLOR:"COLOR",JOINT:"JOINTS",JOINTS:"JOINTS",TEXCOORD:"TEXCOORD",WEIGHT:"WEIGHTS",WEIGHTS:"WEIGHTS"};function fFe(e){let t={};Oe.mesh(e,function(n){Oe.meshPrimitive(n,function(i){Oe.meshPrimitiveAttribute(i,function(o,r){if(r.charAt(0)!=="_"){let s=r.search(/_[0-9]+/g),a=r,l="_0";s>=0&&(a=r.substring(0,s),l=r.substring(s));let u,f=uFe[a];c(f)?(u=f+l,t[r]=u):c(lFe[a])||(u=`_${r}`,t[r]=u)}});for(let o in t)if(Object.prototype.hasOwnProperty.call(t,o)){let r=t[o],s=i.attributes[o];c(s)&&(delete i.attributes[o],i.attributes[r]=s)}})}),Oe.technique(e,function(n){Oe.techniqueParameter(n,function(i){let o=t[i.semantic];c(o)&&(i.semantic=o)})})}function dFe(e){Oe.camera(e,function(t){let n=t.perspective;if(c(n)){let i=n.aspectRatio;c(i)&&i===0&&delete n.aspectRatio;let o=n.yfov;c(o)&&o===0&&(n.yfov=1)}})}function Tz(e,t){return c(t.byteStride)&&t.byteStride!==0?t.byteStride:Yu(e,t)}function hFe(e){Oe.buffer(e,function(t){c(t.byteLength)||(t.byteLength=t.extras._pipeline.source.length)}),Oe.accessor(e,function(t){let n=t.bufferView;if(c(n)){let i=e.bufferViews[n],o=Tz(e,t),r=t.byteOffset+t.count*o;i.byteLength=Math.max(y(i.byteLength,0),r)}})}function mFe(e){let t,n,i,o=e.bufferViews,r={};Oe.accessorContainingVertexAttributeData(e,function(a){let l=e.accessors[a];c(l.bufferView)&&(r[l.bufferView]=!0)});let s={};Oe.accessor(e,function(a){c(a.bufferView)&&(s[a.bufferView]=y(s[a.bufferView],[]),s[a.bufferView].push(a))});for(let a in s)if(Object.prototype.hasOwnProperty.call(s,a)){i=o[a];let l=s[a];l.sort(function(p,g){return p.byteOffset-g.byteOffset});let u=0,f=0,d=l.length;for(t=0;t<d;++t){let p=l[t],g=Tz(e,p),m=p.byteOffset,b=p.count*g;delete p.byteStride;let x=t<d-1,T=x?Tz(e,l[t+1]):void 0;if(g!==T){let C=qe(i,!0);r[a]&&(C.byteStride=g),C.byteOffset+=u,C.byteLength=m+b-u;let S=Ys(o,C);for(n=f;n<=t;++n)p=l[n],p.bufferView=S,p.byteOffset=p.byteOffset-u;u=x?l[t+1].byteOffset:void 0,f=t+1}}}pz(e,["accessor","bufferView","buffer"])}function pFe(e){Oe.accessorWithSemantic(e,"POSITION",function(t){let n=e.accessors[t];if(!c(n.min)||!c(n.max)){let i=kS(e,n);n.min=i.min,n.max=i.max}})}function Gne(e){return(!c(e.children)||e.children.length===0)&&(!c(e.meshes)||e.meshes.length===0)&&!c(e.camera)&&!c(e.skin)&&!c(e.skeletons)&&!c(e.jointName)&&(!c(e.translation)||h.fromArray(e.translation).equals(h.ZERO))&&(!c(e.scale)||h.fromArray(e.scale).equals(new h(1,1,1)))&&(!c(e.rotation)||se.fromArray(e.rotation).equals(new se(0,0,0,1)))&&(!c(e.matrix)||k.fromColumnMajorArray(e.matrix).equals(k.IDENTITY))&&!c(e.extensions)&&!c(e.extras)}function jne(e,t){Oe.scene(e,function(n){let i=n.nodes;if(c(i)){let o=i.length;for(let r=o;r>=0;--r)if(i[r]===t){i.splice(r,1);return}}}),Oe.node(e,function(n,i){if(c(n.children)){let o=n.children.indexOf(t);o>-1&&(n.children.splice(o,1),Gne(n)&&jne(e,i))}}),delete e.nodes[t]}function _Fe(e){return Oe.node(e,function(t,n){Gne(t)&&jne(e,n)}),e}function gFe(e){Oe.animation(e,function(t){Oe.animationSampler(t,function(n){let i=e.accessors[n.input];if(!c(i.min)||!c(i.max)){let o=kS(e,i);i.min=o.min,i.max=o.max}})})}function yFe(e){Oe.accessor(e,function(t){if(c(t.min)||c(t.max)){let n=kS(e,t);c(t.min)&&(t.min=n.min),c(t.max)&&(t.max=n.max)}})}function bFe(e){e.asset=y(e.asset,{}),e.asset.version="2.0",Hne(e),QNe(e),_Fe(e),eFe(e),tFe(e),iFe(e),rFe(e),hFe(e),mFe(e),pFe(e),gFe(e),yFe(e),sFe(e),aFe(e),cFe(e),fFe(e),yz(e),dFe(e),dz(e),mz(e),nFe(e)}var xFe=["u_tex","u_diffuse","u_emission","u_diffuse_tex"],TFe=["u_diffuse","u_diffuse_mat"];function Az(e){e.pbrMetallicRoughness=c(e.pbrMetallicRoughness)?e.pbrMetallicRoughness:{},e.pbrMetallicRoughness.roughnessFactor=1,e.pbrMetallicRoughness.metallicFactor=0}function Cz(e){return c(e.index)}function Ez(e){return Array.isArray(e)&&e.length===4}function Wne(e){let t=new Array(4);t[3]=e[3];for(let n=0;n<3;n++){let i=e[n];i<=.04045?t[n]=e[n]*.07739938080495357:t[n]=Math.pow((i+.055)*.9478672985781991,2.4)}return t}function AFe(e,t){t=y(t,y.EMPTY_OBJECT);let n=y(t.baseColorTextureNames,xFe),i=y(t.baseColorFactorNames,TFe);Oe.material(e,function(o){Oe.materialValue(o,function(r,s){n.indexOf(s)!==-1&&Cz(r)?(Az(o),o.pbrMetallicRoughness.baseColorTexture=r):i.indexOf(s)!==-1&&Ez(r)&&(Az(o),o.pbrMetallicRoughness.baseColorFactor=Wne(r))})}),VS(e,"KHR_techniques_webgl"),VS(e,"KHR_blend")}function xz(e,t){c(t)&&(Ez(t)?e.pbrMetallicRoughness.baseColorFactor=Wne(t):Cz(t)&&(e.pbrMetallicRoughness.baseColorTexture=t))}function zne(e,t){c(t)&&(Ez(t)?e.emissiveFactor=t.slice(0,3):Cz(t)&&(e.emissiveTexture=t))}function CFe(e){Oe.material(e,function(t){let n=y(t.extensions,y.EMPTY_OBJECT).KHR_materials_common;if(!c(n))return;let i=y(n.values,{}),o=i.ambient,r=i.diffuse,s=i.emission,a=i.transparency,l=n.doubleSided,u=n.transparent;Az(t),n.technique==="CONSTANT"?(ph(e,"KHR_materials_unlit"),t.extensions=c(t.extensions)?t.extensions:{},t.extensions.KHR_materials_unlit={},xz(t,s),xz(t,o)):(xz(t,r),zne(t,o),zne(t,s)),c(l)&&(t.doubleSided=l),c(a)&&(c(t.pbrMetallicRoughness.baseColorFactor)?t.pbrMetallicRoughness.baseColorFactor[3]*=a:t.pbrMetallicRoughness.baseColorFactor=[1,1,1,a]),c(u)&&(t.alphaMode=u?"BLEND":"OPAQUE")}),VS(e,"KHR_materials_common")}var Sz=YNe;var $n={POSITION:"POSITION",NORMAL:"NORMAL",TANGENT:"TANGENT",TEXCOORD:"TEXCOORD",COLOR:"COLOR",JOINTS:"JOINTS",WEIGHTS:"WEIGHTS",FEATURE_ID:"_FEATURE_ID"};function EFe(e){switch(e){case $n.POSITION:return"positionMC";case $n.NORMAL:return"normalMC";case $n.TANGENT:return"tangentMC";case $n.TEXCOORD:return"texCoord";case $n.COLOR:return"color";case $n.JOINTS:return"joints";case $n.WEIGHTS:return"weights";case $n.FEATURE_ID:return"featureId";default:throw new E("semantic is not a valid value.")}}$n.hasSetIndex=function(e){switch(A.typeOf.string("semantic",e),e){case $n.POSITION:case $n.NORMAL:case $n.TANGENT:return!1;case $n.TEXCOORD:case $n.COLOR:case $n.JOINTS:case $n.WEIGHTS:case $n.FEATURE_ID:return!0;default:throw new E("semantic is not a valid value.")}};$n.fromGltfSemantic=function(e){A.typeOf.string("gltfSemantic",e);let t=e,i=/^(\w+)_\d+$/.exec(e);switch(i!==null&&(t=i[1]),t){case"POSITION":return $n.POSITION;case"NORMAL":return $n.NORMAL;case"TANGENT":return $n.TANGENT;case"TEXCOORD":return $n.TEXCOORD;case"COLOR":return $n.COLOR;case"JOINTS":return $n.JOINTS;case"WEIGHTS":return $n.WEIGHTS;case"_FEATURE_ID":return $n.FEATURE_ID}};$n.fromPntsSemantic=function(e){switch(A.typeOf.string("pntsSemantic",e),e){case"POSITION":case"POSITION_QUANTIZED":return $n.POSITION;case"RGBA":case"RGB":case"RGB565":return $n.COLOR;case"NORMAL":case"NORMAL_OCT16P":return $n.NORMAL;case"BATCH_ID":return $n.FEATURE_ID;default:throw new E("pntsSemantic is not a valid value.")}};$n.getGlslType=function(e){switch(A.typeOf.string("semantic",e),e){case $n.POSITION:case $n.NORMAL:case $n.TANGENT:return"vec3";case $n.TEXCOORD:return"vec2";case $n.COLOR:return"vec4";case $n.JOINTS:return"ivec4";case $n.WEIGHTS:return"vec4";case $n.FEATURE_ID:return"int";default:throw new E("semantic is not a valid value.")}};$n.getVariableName=function(e,t){A.typeOf.string("semantic",e);let n=EFe(e);return c(t)&&(n+=`_${t}`),n};var Ct=Object.freeze($n);function Ga(){}Ga.getError=function(e,t,n){let i=`Failed to load ${e}: ${t}`;c(n)&&c(n.message)&&(i+=`
${n.message}`);let o=new ue(i);return c(n)&&(o.stack=`Original stack:
${n.stack}
Handler stack:
${o.stack}`),o};Ga.getNodeTransform=function(e){return c(e.matrix)?e.matrix:k.fromTranslationQuaternionRotationScale(c(e.translation)?e.translation:h.ZERO,c(e.rotation)?e.rotation:Ne.IDENTITY,c(e.scale)?e.scale:h.ONE)};Ga.getAttributeBySemantic=function(e,t,n){let i=e.attributes,o=i.length;for(let r=0;r<o;++r){let s=i[r],a=c(n)?s.setIndex===n:!0;if(s.semantic===t&&a)return s}};Ga.getAttributeByName=function(e,t){let n=e.attributes,i=n.length;for(let o=0;o<i;++o){let r=n[o];if(r.name===t)return r}};Ga.getFeatureIdsByLabel=function(e,t){for(let n=0;n<e.length;n++){let i=e[n];if(i.positionalLabel===t||i.label===t)return i}};Ga.hasQuantizedAttributes=function(e){if(!c(e))return!1;for(let t=0;t<e.length;t++){let n=e[t];if(c(n.quantization))return!0}return!1};Ga.getAttributeInfo=function(e){let t=e.semantic,n=e.setIndex,i,o=!1;c(t)?(i=Ct.getVariableName(t,n),o=!0):(i=e.name,i=i.replace(/^_/,""),i=i.toLowerCase());let r=/^color_\d+$/.test(i),s=e.type,a=cn.getGlslType(s);r&&(a="vec4");let l=c(e.quantization),u;return l&&(u=r?"vec4":cn.getGlslType(e.quantization.type)),{attribute:e,isQuantized:l,variableName:i,hasSemantic:o,glslType:a,quantizedGlslType:u}};var SFe=new h,wFe=new h;Ga.getPositionMinMax=function(e,t,n){let i=Ga.getAttributeBySemantic(e,"POSITION"),o=i.max,r=i.min;return c(n)&&c(t)&&(r=h.add(r,t,wFe),o=h.add(o,n,SFe)),{min:r,max:o}};Ga.getAxisCorrectionMatrix=function(e,t,n){return n=k.clone(k.IDENTITY,n),e===zo.Y?n=k.clone(zo.Y_UP_TO_Z_UP,n):e===zo.X&&(n=k.clone(zo.X_UP_TO_Z_UP,n)),t===zo.Z&&(n=k.multiplyTransformation(n,zo.Z_UP_TO_X_UP,n)),n};var vFe=new Q;Ga.getCullFace=function(e,t){if(!Me.isTriangles(t))return xi.BACK;let n=k.getMatrix3(e,vFe);return Q.determinant(n)<0?xi.FRONT:xi.BACK};Ga.sanitizeGlslIdentifier=function(e){let t=e.replaceAll(/[^A-Za-z0-9]+/g,"_");return t=t.replace(/^gl_/,""),/^\d/.test(t)&&(t=`_${t}`),t};Ga.supportedExtensions={AGI_articulations:!0,CESIUM_primitive_outline:!0,CESIUM_RTC:!0,EXT_feature_metadata:!0,EXT_instance_features:!0,EXT_mesh_features:!0,EXT_mesh_gpu_instancing:!0,EXT_meshopt_compression:!0,EXT_structural_metadata:!0,EXT_texture_webp:!0,KHR_blend:!0,KHR_draco_mesh_compression:!0,KHR_techniques_webgl:!0,KHR_materials_common:!0,KHR_materials_pbrSpecularGlossiness:!0,KHR_materials_specular:!0,KHR_materials_anisotropy:!0,KHR_materials_clearcoat:!0,KHR_materials_unlit:!0,KHR_mesh_quantization:!0,KHR_texture_basisu:!0,KHR_texture_transform:!0,WEB3D_quantized_attributes:!0};Ga.checkSupportedExtensions=function(e){let t=e.length;for(let n=0;n<t;n++){let i=e[n];if(!Ga.supportedExtensions[i])throw new ue(`Unsupported glTF Extension: ${i}`)}};var Zt=Ga;function z_(e){e=y(e,y.EMPTY_OBJECT);let t=e.resourceCache,n=e.gltfResource,i=e.baseResource,o=e.typedArray,r=e.gltfJson,s=e.cacheKey;A.typeOf.func("options.resourceCache",t),A.typeOf.object("options.gltfResource",n),A.typeOf.object("options.baseResource",i),this._resourceCache=t,this._gltfResource=n,this._baseResource=i,this._typedArray=o,this._gltfJson=r,this._cacheKey=s,this._gltf=void 0,this._bufferLoaders=[],this._state=yt.UNLOADED,this._promise=void 0}c(Object.create)&&(z_.prototype=Object.create(Zi.prototype),z_.prototype.constructor=z_);Object.defineProperties(z_.prototype,{cacheKey:{get:function(){return this._cacheKey}},gltf:{get:function(){return this._gltf}}});z_.prototype.load=async function(){return c(this._promise)?this._promise:(this._state=yt.LOADING,c(this._gltfJson)?(this._promise=qne(this,this._gltfJson),this._promise):c(this._typedArray)?(this._promise=Yne(this,this._typedArray),this._promise):(this._promise=DFe(this),this._promise))};async function DFe(e){let t;try{let n=await e._fetchGltf();if(e.isDestroyed())return;t=new Uint8Array(n)}catch(n){if(e.isDestroyed())return;wz(e,n)}return Yne(e,t)}function wz(e,t){e.unload(),e._state=yt.FAILED;let n=`Failed to load glTF: ${e._gltfResource.url}`;throw e.getError(n,t)}async function PFe(e,t){if(c(t.asset)&&t.asset.version==="2.0"&&!Pr(t,"KHR_techniques_webgl")&&!Pr(t,"KHR_materials_common"))return Promise.resolve();let n=[];Oe.buffer(t,function(i){if(!c(i.extras._pipeline.source)&&c(i.uri)){let o=e._baseResource.getDerivedResource({url:i.uri}),s=e._resourceCache.getExternalBufferLoader({resource:o});e._bufferLoaders.push(s),n.push(s.load().then(function(){s.isDestroyed()||(i.extras._pipeline.source=s.typedArray)}))}}),await Promise.all(n),Sz(t)}function IFe(e){let t=[];return Oe.buffer(e,function(n){let i=n.uri;!c(n.extras._pipeline.source)&&c(i)&&Oy(i)&&(delete n.uri,t.push(De.fetchArrayBuffer(i).then(function(o){n.extras._pipeline.source=new Uint8Array(o)})))}),Promise.all(t)}function OFe(e,t){let n=[];return Oe.buffer(t,function(i,o){let r=i.extras._pipeline.source;if(c(r)&&!c(i.uri)){let a=e._resourceCache.getEmbeddedBufferLoader({parentResource:e._gltfResource,bufferId:o,typedArray:r});e._bufferLoaders.push(a),n.push(a.load())}}),Promise.all(n)}async function qne(e,t){try{sT(t),await IFe(t),await PFe(e,t),cz(t),await OFe(e,t),fz(t);let n=t.asset.version;if(n!=="1.0"&&n!=="2.0")throw new ue(`Unsupported glTF version: ${n}`);let i=t.extensionsRequired;return c(i)&&Zt.checkSupportedExtensions(i),e._gltf=t,e._state=yt.READY,e}catch(n){if(e.isDestroyed())return;wz(e,n)}}async function Yne(e,t){let n;try{qm(t)==="glTF"?n=uz(t):n=Ho(t)}catch(i){if(e.isDestroyed())return;wz(e,i)}return qne(e,n)}z_.prototype.unload=function(){let e=this._bufferLoaders,t=e.length;for(let n=0;n<t;++n)e[n]=!e[n].isDestroyed()&&this._resourceCache.unload(e[n]);this._bufferLoaders.length=0,this._gltf=void 0};z_.prototype._fetchGltf=function(){return this._gltfResource.fetchArrayBuffer()};var RO=z_;var RFe={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"},H_=Object.freeze(RFe);var yo={};function MFe(){this.octEncoded=!1,this.octEncodedZXY=!1,this.normalizationRange=void 0,this.quantizedVolumeOffset=void 0,this.quantizedVolumeDimensions=void 0,this.quantizedVolumeStepSize=void 0,this.componentDatatype=void 0,this.type=void 0}function LFe(){this.name=void 0,this.semantic=void 0,this.setIndex=void 0,this.componentDatatype=void 0,this.type=void 0,this.normalized=!1,this.count=void 0,this.min=void 0,this.max=void 0,this.constant=void 0,this.quantization=void 0,this.typedArray=void 0,this.buffer=void 0,this.byteOffset=0,this.byteStride=void 0}function NFe(){this.indexDatatype=void 0,this.count=void 0,this.buffer=void 0,this.typedArray=void 0}function FFe(){this.featureCount=void 0,this.nullFeatureId=void 0,this.propertyTableId=void 0,this.setIndex=void 0,this.label=void 0,this.positionalLabel=void 0}function BFe(){this.featureCount=void 0,this.nullFeatureId=void 0,this.propertyTableId=void 0,this.offset=0,this.repeat=void 0,this.label=void 0,this.positionalLabel=void 0}function kFe(){this.featureCount=void 0,this.nullFeatureId=void 0,this.propertyTableId=void 0,this.textureReader=void 0,this.label=void 0,this.positionalLabel=void 0}function VFe(){this.attributes=[]}function UFe(){this.attributes=[],this.morphTargets=[],this.indices=void 0,this.material=void 0,this.primitiveType=void 0,this.featureIds=[],this.propertyTextureIds=[],this.propertyAttributeIds=[],this.outlineCoordinates=void 0}function zFe(){this.attributes=[],this.featureIds=[],this.transformInWorldSpace=!1}function HFe(){this.index=void 0,this.joints=[],this.inverseBindMatrices=[]}function GFe(){this.name=void 0,this.index=void 0,this.children=[],this.primitives=[],this.instances=void 0,this.skin=void 0,this.matrix=void 0,this.translation=void 0,this.rotation=void 0,this.scale=void 0,this.morphWeights=[],this.articulationName=void 0}function jFe(){this.nodes=[]}var WFe={TRANSLATION:"translation",ROTATION:"rotation",SCALE:"scale",WEIGHTS:"weights"};function qFe(){this.input=[],this.interpolation=void 0,this.output=[]}function YFe(){this.node=void 0,this.path=void 0}function XFe(){this.sampler=void 0,this.target=void 0}function KFe(){this.name=void 0,this.samplers=[],this.channels=[]}function $Fe(){this.name=void 0,this.type=void 0,this.minimumValue=void 0,this.maximumValue=void 0,this.initialValue=void 0}function ZFe(){this.name=void 0,this.stages=[]}function Xne(){this.credits=[]}function JFe(){this.asset=new Xne,this.scene=void 0,this.nodes=[],this.skins=[],this.animations=[],this.articulations=[],this.structuralMetadata=void 0,this.upAxis=void 0,this.forwardAxis=void 0,this.transform=k.clone(k.IDENTITY),this.extensions={}}function QFe(){this.texture=void 0,this.index=void 0,this.texCoord=0,this.transform=Q.clone(Q.IDENTITY),this.scale=1,this.channels=void 0}function G_(){this.baseColorTexture=void 0,this.metallicRoughnessTexture=void 0,this.baseColorFactor=se.clone(G_.DEFAULT_BASE_COLOR_FACTOR),this.metallicFactor=G_.DEFAULT_METALLIC_FACTOR,this.roughnessFactor=G_.DEFAULT_ROUGHNESS_FACTOR}G_.DEFAULT_BASE_COLOR_FACTOR=se.ONE;G_.DEFAULT_METALLIC_FACTOR=1;G_.DEFAULT_ROUGHNESS_FACTOR=1;function p0(){this.diffuseTexture=void 0,this.specularGlossinessTexture=void 0,this.diffuseFactor=se.clone(p0.DEFAULT_DIFFUSE_FACTOR),this.specularFactor=h.clone(p0.DEFAULT_SPECULAR_FACTOR),this.glossinessFactor=p0.DEFAULT_GLOSSINESS_FACTOR}p0.DEFAULT_DIFFUSE_FACTOR=se.ONE;p0.DEFAULT_SPECULAR_FACTOR=h.ONE;p0.DEFAULT_GLOSSINESS_FACTOR=1;function US(){this.specularFactor=US.DEFAULT_SPECULAR_FACTOR,this.specularTexture=void 0,this.specularColorFactor=h.clone(US.DEFAULT_SPECULAR_COLOR_FACTOR),this.specularColorTexture=void 0}US.DEFAULT_SPECULAR_FACTOR=1;US.DEFAULT_SPECULAR_COLOR_FACTOR=h.ONE;function zS(){this.anisotropyStrength=zS.DEFAULT_ANISOTROPY_STRENGTH,this.anisotropyRotation=zS.DEFAULT_ANISOTROPY_ROTATION,this.anisotropyTexture=void 0}zS.DEFAULT_ANISOTROPY_STRENGTH=0;zS.DEFAULT_ANISOTROPY_ROTATION=0;function HS(){this.clearcoatFactor=HS.DEFAULT_CLEARCOAT_FACTOR,this.clearcoatTexture=void 0,this.clearcoatRoughnessFactor=HS.DEFAULT_CLEARCOAT_ROUGHNESS_FACTOR,this.clearcoatRoughnessTexture=void 0,this.clearcoatNormalTexture=void 0}HS.DEFAULT_CLEARCOAT_FACTOR=0;HS.DEFAULT_CLEARCOAT_ROUGHNESS_FACTOR=0;function vz(){this.metallicRoughness=new G_,this.specularGlossiness=void 0,this.specular=void 0,this.anisotropy=void 0,this.clearcoat=void 0,this.emissiveTexture=void 0,this.normalTexture=void 0,this.occlusionTexture=void 0,this.emissiveFactor=h.clone(vz.DEFAULT_EMISSIVE_FACTOR),this.alphaMode=H_.OPAQUE,this.alphaCutoff=.5,this.doubleSided=!1,this.unlit=!1}vz.DEFAULT_EMISSIVE_FACTOR=h.ZERO;yo.Quantization=MFe;yo.Attribute=LFe;yo.Indices=NFe;yo.FeatureIdAttribute=FFe;yo.FeatureIdTexture=kFe;yo.FeatureIdImplicitRange=BFe;yo.MorphTarget=VFe;yo.Primitive=UFe;yo.Instances=zFe;yo.Skin=HFe;yo.Node=GFe;yo.Scene=jFe;yo.AnimatedPropertyType=Object.freeze(WFe);yo.AnimationSampler=qFe;yo.AnimationTarget=YFe;yo.AnimationChannel=XFe;yo.Animation=KFe;yo.ArticulationStage=$Fe;yo.Articulation=ZFe;yo.Asset=Xne;yo.Components=JFe;yo.TextureReader=QFe;yo.MetallicRoughness=G_;yo.SpecularGlossiness=p0;yo.Specular=US;yo.Anisotropy=zS;yo.Clearcoat=HS;yo.Material=vz;var Sn=yo;var MO={};MO.getImageIdFromTexture=function(e){e=y(e,y.EMPTY_OBJECT);let{gltf:t,textureId:n,supportedImageFormats:i}=e;A.typeOf.object("options.gltf",t),A.typeOf.number("options.textureId",n),A.typeOf.object("options.supportedImageFormats",i);let o=t.textures[n],r=o.extensions;if(c(r)){if(i.webp&&c(r.EXT_texture_webp))return r.EXT_texture_webp.source;if(i.basis&&c(r.KHR_texture_basisu))return r.KHR_texture_basisu.source}return o.source};MO.createSampler=function(e){e=y(e,y.EMPTY_OBJECT);let{gltf:t,textureInfo:n,compressedTextureNoMipmap:i=!1}=e;A.typeOf.object("options.gltf",t),A.typeOf.object("options.textureInfo",n);let o=yn.REPEAT,r=yn.REPEAT,s=$t.LINEAR,a=fi.LINEAR,l=n.index,f=t.textures[l].sampler;if(c(f)){let d=t.samplers[f];o=y(d.wrapS,o),r=y(d.wrapT,r),s=y(d.minFilter,s),a=y(d.magFilter,a)}return i&&s!==$t.LINEAR&&s!==$t.NEAREST&&(s===$t.NEAREST_MIPMAP_NEAREST||s===$t.NEAREST_MIPMAP_LINEAR?s=$t.NEAREST:s=$t.LINEAR),new Qt({wrapS:o,wrapT:r,minificationFilter:s,magnificationFilter:a})};var e2e=new H(1,1);MO.createModelTextureReader=function(e){e=y(e,y.EMPTY_OBJECT);let{textureInfo:t,channels:n,texture:i}=e;A.typeOf.object("options.textureInfo",t);let o=y(t.texCoord,0),r,s=t.extensions?.KHR_texture_transform;if(c(s)){o=y(s.texCoord,o);let l=c(s.offset)?H.unpack(s.offset):H.ZERO,u=y(s.rotation,0),f=c(s.scale)?H.unpack(s.scale):e2e;u=-u,r=new Q(Math.cos(u)*f.x,-Math.sin(u)*f.y,l.x,Math.sin(u)*f.x,Math.cos(u)*f.y,l.y,0,0,1)}let a=new Sn.TextureReader;return a.index=t.index,a.texture=i,a.texCoord=o,a.scale=t.scale,a.transform=r,a.channels=n,a};var Xu=MO;function t2e(e){let t=document.createElement("canvas");return t.width=R.nextPowerOfTwo(e.width),t.height=R.nextPowerOfTwo(e.height),t.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,t.width,t.height),t}var aT=t2e;function j_(e){e=y(e,y.EMPTY_OBJECT);let t=e.resourceCache,n=e.gltf,i=e.textureInfo,o=e.gltfResource,r=e.baseResource,s=e.supportedImageFormats,a=e.cacheKey,l=y(e.asynchronous,!0);A.typeOf.func("options.resourceCache",t),A.typeOf.object("options.gltf",n),A.typeOf.object("options.textureInfo",i),A.typeOf.object("options.gltfResource",o),A.typeOf.object("options.baseResource",r),A.typeOf.object("options.supportedImageFormats",s);let u=i.index,f=Xu.getImageIdFromTexture({gltf:n,textureId:u,supportedImageFormats:s});this._resourceCache=t,this._gltf=n,this._textureInfo=i,this._imageId=f,this._gltfResource=o,this._baseResource=r,this._cacheKey=a,this._asynchronous=l,this._imageLoader=void 0,this._image=void 0,this._mipLevels=void 0,this._texture=void 0,this._state=yt.UNLOADED,this._promise=void 0}c(Object.create)&&(j_.prototype=Object.create(Zi.prototype),j_.prototype.constructor=j_);Object.defineProperties(j_.prototype,{cacheKey:{get:function(){return this._cacheKey}},texture:{get:function(){return this._texture}}});var n2e=new Dz;async function i2e(e){let t=e._resourceCache;try{let n=t.getImageLoader({gltf:e._gltf,imageId:e._imageId,gltfResource:e._gltfResource,baseResource:e._baseResource});return e._imageLoader=n,await n.load(),e.isDestroyed()?void 0:(e._image=n.image,e._mipLevels=n.mipLevels,e._state=yt.LOADED,e)}catch(n){if(e.isDestroyed())return;throw e.unload(),e._state=yt.FAILED,e.getError("Failed to load texture",n)}}j_.prototype.load=async function(){return c(this._promise)?this._promise:(this._state=yt.LOADING,this._promise=i2e(this),this._promise)};function Dz(){this.gltf=void 0,this.textureInfo=void 0,this.image=void 0,this.context=void 0,this.texture=void 0}Dz.prototype.set=function(e,t,n,i,o){this.gltf=e,this.textureInfo=t,this.image=n,this.mipLevels=i,this.context=o};Dz.prototype.execute=function(){this.texture=Kne(this.gltf,this.textureInfo,this.image,this.mipLevels,this.context)};function Kne(e,t,n,i,o){let r=n.internalFormat,s=!1;Ve.isCompressedFormat(r)&&!c(i)&&(s=!0);let a=Xu.createSampler({gltf:e,textureInfo:t,compressedTextureNoMipmap:s}),l=a.minificationFilter,u=a.wrapS,f=a.wrapT,d=l===$t.NEAREST_MIPMAP_NEAREST||l===$t.NEAREST_MIPMAP_LINEAR||l===$t.LINEAR_MIPMAP_NEAREST||l===$t.LINEAR_MIPMAP_LINEAR,p=!c(r)&&d,g=p||u===yn.REPEAT||u===yn.MIRRORED_REPEAT||f===yn.REPEAT||f===yn.MIRRORED_REPEAT,m=!R.isPowerOfTwo(n.width)||!R.isPowerOfTwo(n.height),b=g&&m,x;return c(r)?(!o.webgl2&&Ve.isCompressedFormat(r)&&m&&g&&console.warn("Compressed texture uses REPEAT or MIRRORED_REPEAT texture wrap mode and dimensions are not powers of two. The texture may be rendered incorrectly."),x=Lt.create({context:o,source:{arrayBufferView:n.bufferView,mipLevels:i},width:n.width,height:n.height,pixelFormat:n.internalFormat,sampler:a})):(b&&(n=aT(n)),x=Lt.create({context:o,source:n,sampler:a,flipY:!1,skipColorSpaceConversion:!0})),p&&x.generateMipmap(),x}j_.prototype.process=function(e){if(A.typeOf.object("frameState",e),this._state===yt.READY)return!0;if(this._state!==yt.LOADED&&this._state!==yt.PROCESSING||c(this._texture)||!c(this._image))return!1;this._state=yt.PROCESSING;let t;if(this._asynchronous){let n=n2e;if(n.set(this._gltf,this._textureInfo,this._image,this._mipLevels,e.context),!e.jobScheduler.execute(n,Ha.TEXTURE))return;t=n.texture}else t=Kne(this._gltf,this._textureInfo,this._image,this._mipLevels,e.context);return this.unload(),this._texture=t,this._state=yt.READY,this._resourceCache.statistics.addTextureLoader(this),!0};j_.prototype.unload=function(){c(this._texture)&&this._texture.destroy(),c(this._imageLoader)&&!this._imageLoader.isDestroyed()&&this._resourceCache.unload(this._imageLoader),this._imageLoader=void 0,this._image=void 0,this._mipLevels=void 0,this._texture=void 0,this._gltf=void 0};var LO=j_;function W_(e){e=y(e,y.EMPTY_OBJECT);let t=e.resourceCache,n=e.gltf,i=e.gltfResource,o=e.baseResource,r=e.bufferViewId,s=e.draco,a=e.attributeSemantic,l=e.accessorId,u=e.cacheKey,f=y(e.asynchronous,!0),d=y(e.loadBuffer,!1),p=y(e.loadTypedArray,!1);if(A.typeOf.func("options.resourceCache",t),A.typeOf.object("options.gltf",n),A.typeOf.object("options.gltfResource",i),A.typeOf.object("options.baseResource",o),!d&&!p)throw new E("At least one of loadBuffer and loadTypedArray must be true.");let g=c(r),m=$ne(s,a),b=c(a),x=c(l);if(g===m)throw new E("One of options.bufferViewId and options.draco must be defined.");if(m&&!b)throw new E("When options.draco is defined options.attributeSemantic must also be defined.");if(m&&!x)throw new E("When options.draco is defined options.accessorId must also be defined.");m&&(A.typeOf.object("options.draco",s),A.typeOf.string("options.attributeSemantic",a),A.typeOf.number("options.accessorId",l)),this._resourceCache=t,this._gltfResource=i,this._baseResource=o,this._gltf=n,this._bufferViewId=r,this._draco=s,this._attributeSemantic=a,this._accessorId=l,this._cacheKey=u,this._asynchronous=f,this._loadBuffer=d,this._loadTypedArray=p,this._bufferViewLoader=void 0,this._dracoLoader=void 0,this._quantization=void 0,this._typedArray=void 0,this._buffer=void 0,this._state=yt.UNLOADED,this._promise=void 0}c(Object.create)&&(W_.prototype=Object.create(Zi.prototype),W_.prototype.constructor=W_);Object.defineProperties(W_.prototype,{cacheKey:{get:function(){return this._cacheKey}},buffer:{get:function(){return this._buffer}},typedArray:{get:function(){return this._typedArray}},quantization:{get:function(){return this._quantization}}});function $ne(e,t){return c(e)&&c(e.attributes)&&c(e.attributes[t])}W_.prototype.load=async function(){return c(this._promise)?this._promise:$ne(this._draco,this._attributeSemantic)?(this._promise=r2e(this),this._promise):(this._promise=a2e(this),this._promise)};function o2e(e,t,n,i){let r=(1<<e.quantizationBits)-1,s=1/r,a=new Sn.Quantization;if(a.componentDatatype=t,a.octEncoded=e.octEncoded,a.octEncodedZXY=!0,a.type=i,a.octEncoded)a.type=cn.VEC2,a.normalizationRange=r;else{let l=cn.getMathType(i);if(l===Number){let u=e.range;a.quantizedVolumeOffset=e.minValues[0],a.quantizedVolumeDimensions=u,a.normalizationRange=r,a.quantizedVolumeStepSize=u*s}else{a.quantizedVolumeOffset=l.unpack(e.minValues),a.normalizationRange=l.unpack(new Array(n).fill(r));let u=new Array(n).fill(e.range);a.quantizedVolumeDimensions=l.unpack(u);let f=u.map(function(d){return d*s});a.quantizedVolumeStepSize=l.unpack(f)}}return a}async function r2e(e){e._state=yt.LOADING;let t=e._resourceCache;try{let n=t.getDracoLoader({gltf:e._gltf,draco:e._draco,gltfResource:e._gltfResource,baseResource:e._baseResource});return e._dracoLoader=n,await n.load(),e.isDestroyed()?void 0:(e._state=yt.LOADED,e)}catch{if(e.isDestroyed())return;Pz(e)}}function s2e(e){e._state=yt.PROCESSING;let n=e._dracoLoader.decodedData.vertexAttributes,i=e._attributeSemantic,o=n[i],r=e._accessorId,a=e._gltf.accessors[r].type,l=o.array,u=o.data.quantization;c(u)&&(e._quantization=o2e(u,o.data.componentDatatype,o.data.componentsPerAttribute,a)),e._typedArray=new Uint8Array(l.buffer,l.byteOffset,l.byteLength)}async function a2e(e){e._state=yt.LOADING;let t=e._resourceCache;try{let n=t.getBufferViewLoader({gltf:e._gltf,bufferViewId:e._bufferViewId,gltfResource:e._gltfResource,baseResource:e._baseResource});return e._bufferViewLoader=n,await n.load(),e.isDestroyed()?void 0:(e._typedArray=n.typedArray,e._state=yt.PROCESSING,e)}catch(n){if(e.isDestroyed())return;Pz(e,n)}}function Pz(e,t){throw e.unload(),e._state=yt.FAILED,e.getError("Failed to load vertex buffer",t)}function Iz(){this.typedArray=void 0,this.context=void 0,this.buffer=void 0}Iz.prototype.set=function(e,t){this.typedArray=e,this.context=t};Iz.prototype.execute=function(){this.buffer=Zne(this.typedArray,this.context)};function Zne(e,t){let n=xt.createVertexBuffer({typedArray:e,context:t,usage:ke.STATIC_DRAW});return n.vertexArrayDestroyable=!1,n}var c2e=new Iz;W_.prototype.process=function(e){if(A.typeOf.object("frameState",e),this._state===yt.READY)return!0;if(this._state!==yt.LOADED&&this._state!==yt.PROCESSING)return!1;if(c(this._dracoLoader)){try{if(!this._dracoLoader.process(e))return!1}catch(i){Pz(this,i)}s2e(this)}let t,n=this._typedArray;if(this._loadBuffer&&this._asynchronous){let i=c2e;if(i.set(n,e.context),!e.jobScheduler.execute(i,Ha.BUFFER))return!1;t=i.buffer}else this._loadBuffer&&(t=Zne(n,e.context));return this.unload(),this._buffer=t,this._typedArray=this._loadTypedArray?n:void 0,this._state=yt.READY,this._resourceCache.statistics.addGeometryLoader(this),!0};W_.prototype.unload=function(){c(this._buffer)&&this._buffer.destroy();let e=this._resourceCache;c(this._bufferViewLoader)&&!this._bufferViewLoader.isDestroyed()&&e.unload(this._bufferViewLoader),c(this._dracoLoader)&&e.unload(this._dracoLoader),this._bufferViewLoader=void 0,this._dracoLoader=void 0,this._typedArray=void 0,this._buffer=void 0,this._gltf=void 0};var NO=W_;function GS(e){e=y(e,y.EMPTY_OBJECT);let t=e.id;A.typeOf.string("options.id",t);let n=y(e.properties,{}),i={};for(let o in n)if(n.hasOwnProperty(o)){let r=n[o];c(r.semantic)&&(i[r.semantic]=r)}this._id=t,this._name=e.name,this._description=e.description,this._properties=n,this._propertiesBySemantic=i,this._extras=qe(e.extras,!0),this._extensions=qe(e.extensions,!0)}GS.fromJson=function(e){e=y(e,y.EMPTY_OBJECT);let t=e.id,n=e.class;A.typeOf.string("options.id",t),A.typeOf.object("options.class",n);let i={};for(let o in n.properties)if(n.properties.hasOwnProperty(o)){let r=rT.fromJson({id:o,property:n.properties[o],enums:e.enums});i[o]=r}return new GS({id:t,name:n.name,description:n.description,properties:i,extras:n.extras,extensions:n.extensions})};Object.defineProperties(GS.prototype,{properties:{get:function(){return this._properties}},propertiesBySemantic:{get:function(){return this._propertiesBySemantic}},id:{get:function(){return this._id}},name:{get:function(){return this._name}},description:{get:function(){return this._description}},extras:{get:function(){return this._extras}},extensions:{get:function(){return this._extensions}}});GS.BATCH_TABLE_CLASS_NAME="_batchTable";var Qm=GS;function FO(e){e=y(e,y.EMPTY_OBJECT);let t=e.value,n=e.name;A.typeOf.number("options.value",t),A.typeOf.string("options.name",n),this._value=t,this._name=n,this._description=e.description,this._extras=qe(e.extras,!0),this._extensions=qe(e.extensions,!0)}FO.fromJson=function(e){return A.typeOf.object("value",e),new FO({value:e.value,name:e.name,description:e.description,extras:e.extras,extensions:e.extensions})};Object.defineProperties(FO.prototype,{value:{get:function(){return this._value}},name:{get:function(){return this._name}},description:{get:function(){return this._description}},extras:{get:function(){return this._extras}},extensions:{get:function(){return this._extensions}}});var Oz=FO;function BO(e){e=y(e,y.EMPTY_OBJECT);let t=e.id,n=e.values;A.typeOf.string("options.id",t),A.defined("options.values",n);let i={},o={},r=n.length;for(let a=0;a<r;++a){let l=n[a];i[l.value]=l.name,o[l.name]=l.value}let s=y(e.valueType,Gt.UINT16);this._values=n,this._namesByValue=i,this._valuesByName=o,this._valueType=s,this._id=t,this._name=e.name,this._description=e.description,this._extras=qe(e.extras,!0),this._extensions=qe(e.extensions,!0)}BO.fromJson=function(e){e=y(e,y.EMPTY_OBJECT);let t=e.id,n=e.enum;A.typeOf.string("options.id",t),A.typeOf.object("options.enum",n);let i=n.values.map(function(o){return Oz.fromJson(o)});return new BO({id:t,values:i,valueType:Gt[n.valueType],name:n.name,description:n.description,extras:n.extras,extensions:n.extensions})};Object.defineProperties(BO.prototype,{values:{get:function(){return this._values}},namesByValue:{get:function(){return this._namesByValue}},valuesByName:{get:function(){return this._valuesByName}},valueType:{get:function(){return this._valueType}},id:{get:function(){return this._id}},name:{get:function(){return this._name}},description:{get:function(){return this._description}},extras:{get:function(){return this._extras}},extensions:{get:function(){return this._extensions}}});var Rz=BO;function kO(e){e=y(e,y.EMPTY_OBJECT);let t=y(e.classes,{}),n=y(e.enums,{});this._classes=t,this._enums=n,this._id=e.id,this._name=e.name,this._description=e.description,this._version=e.version,this._extras=qe(e.extras,!0),this._extensions=qe(e.extensions,!0)}kO.fromJson=function(e){A.typeOf.object("schema",e);let t={};if(c(e.enums))for(let i in e.enums)e.enums.hasOwnProperty(i)&&(t[i]=Rz.fromJson({id:i,enum:e.enums[i]}));let n={};if(c(e.classes))for(let i in e.classes)e.classes.hasOwnProperty(i)&&(n[i]=Qm.fromJson({id:i,class:e.classes[i],enums:t}));return new kO({id:e.id,name:e.name,description:e.description,version:e.version,classes:n,enums:t,extras:e.extras,extensions:e.extensions})};Object.defineProperties(kO.prototype,{classes:{get:function(){return this._classes}},enums:{get:function(){return this._enums}},id:{get:function(){return this._id}},name:{get:function(){return this._name}},description:{get:function(){return this._description}},version:{get:function(){return this._version}},extras:{get:function(){return this._extras}},extensions:{get:function(){return this._extensions}}});var Qf=kO;function _0(e){e=y(e,y.EMPTY_OBJECT);let t=e.schema,n=e.resource,i=e.cacheKey;if(c(t)===c(n))throw new E("One of options.schema and options.resource must be defined.");this._schema=c(t)?Qf.fromJson(t):void 0,this._resource=n,this._cacheKey=i,this._state=yt.UNLOADED,this._promise=void 0}c(Object.create)&&(_0.prototype=Object.create(Zi.prototype),_0.prototype.constructor=_0);Object.defineProperties(_0.prototype,{cacheKey:{get:function(){return this._cacheKey}},schema:{get:function(){return this._schema}}});_0.prototype.load=async function(){return c(this._promise)?this._promise:c(this._schema)?(this._promise=Promise.resolve(this),this._promise):(this._promise=l2e(this),this._promise)};async function l2e(e){let t=e._resource;e._state=yt.LOADING;try{let n=await t.fetchJson();return e.isDestroyed()?void 0:(e._schema=Qf.fromJson(n),e._state=yt.READY,e)}catch(n){if(e.isDestroyed())return;e._state=yt.FAILED;let i=`Failed to load schema: ${t.url}`;throw e.getError(i,n)}}_0.prototype.unload=function(){this._schema=void 0};var VO=_0;var ed={};function cT(e){return m_(e.url)}function UO(e){let{byteOffset:t,byteLength:n}=e;if(si(e,"EXT_meshopt_compression")){let i=e.extensions.EXT_meshopt_compression;t=y(i.byteOffset,0),n=i.byteLength}return`${t}-${t+n}`}function u2e(e,t){let n=t.byteOffset+e.byteOffset,{componentType:i,type:o,count:r}=e;return`${n}-${i}-${o}-${r}`}function Jne(e,t){return`${cT(e)}-buffer-id-${t}`}function jS(e,t,n,i){if(c(e.uri)){let o=i.getDerivedResource({url:e.uri});return cT(o)}return Jne(n,t)}function Mz(e,t,n,i){let o=t.bufferView,r=e.bufferViews[o],s=r.buffer,a=e.buffers[s],l=jS(a,s,n,i),u=UO(r);return`${l}-range-${u}`}function Qne(e,t,n,i){let o=e.images[t],r=o.bufferView,s=o.uri;if(c(s)){let p=i.getDerivedResource({url:s});return cT(p)}let a=e.bufferViews[r],l=a.buffer,u=e.buffers[l],f=jS(u,l,n,i),d=UO(a);return`${f}-range-${d}`}function f2e(e,t){let n=Xu.createSampler({gltf:e,textureInfo:t});return`${n.wrapS}-${n.wrapT}-${n.minificationFilter}-${n.magnificationFilter}`}ed.getSchemaCacheKey=function(e){let{schema:t,resource:n}=e;if(c(t)===c(n))throw new E("One of options.schema and options.resource must be defined.");return c(t)?`embedded-schema:${JSON.stringify(t)}`:`external-schema:${cT(n)}`};ed.getExternalBufferCacheKey=function(e){e=y(e,y.EMPTY_OBJECT);let{resource:t}=e;return A.typeOf.object("options.resource",t),`external-buffer:${cT(t)}`};ed.getEmbeddedBufferCacheKey=function(e){e=y(e,y.EMPTY_OBJECT);let{parentResource:t,bufferId:n}=e;return A.typeOf.object("options.parentResource",t),A.typeOf.number("options.bufferId",n),`embedded-buffer:${Jne(t,n)}`};ed.getGltfCacheKey=function(e){e=y(e,y.EMPTY_OBJECT);let{gltfResource:t}=e;return A.typeOf.object("options.gltfResource",t),`gltf:${cT(t)}`};ed.getBufferViewCacheKey=function(e){e=y(e,y.EMPTY_OBJECT);let{gltf:t,bufferViewId:n,gltfResource:i,baseResource:o}=e;A.typeOf.object("options.gltf",t),A.typeOf.number("options.bufferViewId",n),A.typeOf.object("options.gltfResource",i),A.typeOf.object("options.baseResource",o);let r=t.bufferViews[n],s=r.buffer,a=t.buffers[s];si(r,"EXT_meshopt_compression")&&(s=r.extensions.EXT_meshopt_compression.buffer);let l=jS(a,s,i,o),u=UO(r);return`buffer-view:${l}-range-${u}`};ed.getDracoCacheKey=function(e){e=y(e,y.EMPTY_OBJECT);let{gltf:t,draco:n,gltfResource:i,baseResource:o}=e;return A.typeOf.object("options.gltf",t),A.typeOf.object("options.draco",n),A.typeOf.object("options.gltfResource",i),A.typeOf.object("options.baseResource",o),`draco:${Mz(t,n,i,o)}`};ed.getVertexBufferCacheKey=function(e){e=y(e,y.EMPTY_OBJECT);let{gltf:t,gltfResource:n,baseResource:i,frameState:o,bufferViewId:r,draco:s,attributeSemantic:a,dequantize:l=!1,loadBuffer:u=!1,loadTypedArray:f=!1}=e;A.typeOf.object("options.gltf",t),A.typeOf.object("options.gltfResource",n),A.typeOf.object("options.baseResource",i),A.typeOf.object("options.frameState",o);let d=c(r),p=d2e(s,a),g=c(a);if(d===p)throw new E("One of options.bufferViewId and options.draco must be defined.");if(p&&!g)throw new E("When options.draco is defined options.attributeSemantic must also be defined.");if(p&&(A.typeOf.object("options.draco",s),A.typeOf.string("options.attributeSemantic",a)),!u&&!f)throw new E("At least one of loadBuffer and loadTypedArray must be true.");let m="";if(l&&(m+="-dequantize"),u&&(m+="-buffer",m+=`-context-${o.context.id}`),f&&(m+="-typed-array"),c(s))return`vertex-buffer:${Mz(t,s,n,i)}-draco-${a}${m}`;let b=t.bufferViews[r],x=b.buffer,T=t.buffers[x],C=jS(T,x,n,i),S=UO(b);return`vertex-buffer:${C}-range-${S}${m}`};function d2e(e,t){return c(e)&&c(e.attributes)&&c(e.attributes[t])}ed.getIndexBufferCacheKey=function(e){e=y(e,y.EMPTY_OBJECT);let{gltf:t,accessorId:n,gltfResource:i,baseResource:o,frameState:r,draco:s,loadBuffer:a=!1,loadTypedArray:l=!1}=e;if(A.typeOf.object("options.gltf",t),A.typeOf.number("options.accessorId",n),A.typeOf.object("options.gltfResource",i),A.typeOf.object("options.baseResource",o),A.typeOf.object("options.frameState",r),!a&&!l)throw new E("At least one of loadBuffer and loadTypedArray must be true.");let u="";if(a&&(u+="-buffer",u+=`-context-${r.context.id}`),l&&(u+="-typed-array"),c(s))return`index-buffer:${Mz(t,s,i,o)}-draco${u}`;let f=t.accessors[n],d=f.bufferView,p=t.bufferViews[d],g=p.buffer,m=t.buffers[g],b=jS(m,g,i,o),x=u2e(f,p);return`index-buffer:${b}-accessor-${x}${u}`};ed.getImageCacheKey=function(e){e=y(e,y.EMPTY_OBJECT);let{gltf:t,imageId:n,gltfResource:i,baseResource:o}=e;return A.typeOf.object("options.gltf",t),A.typeOf.number("options.imageId",n),A.typeOf.object("options.gltfResource",i),A.typeOf.object("options.baseResource",o),`image:${Qne(t,n,i,o)}`};ed.getTextureCacheKey=function(e){e=y(e,y.EMPTY_OBJECT);let{gltf:t,textureInfo:n,gltfResource:i,baseResource:o,supportedImageFormats:r,frameState:s}=e;A.typeOf.object("options.gltf",t),A.typeOf.object("options.textureInfo",n),A.typeOf.object("options.gltfResource",i),A.typeOf.object("options.baseResource",o),A.typeOf.object("options.supportedImageFormats",r),A.typeOf.object("options.frameState",s);let a=n.index,l=Xu.getImageIdFromTexture({gltf:t,textureId:a,supportedImageFormats:r}),u=Qne(t,l,i,o),f=f2e(t,n);return`texture:${u}-sampler-${f}-context-${s.context.id}`};var Ku=ed;function WS(){this.geometryByteLength=0,this.texturesByteLength=0,this._geometrySizes={},this._textureSizes={}}WS.prototype.clear=function(){this.geometryByteLength=0,this.texturesByteLength=0,this._geometrySizes={},this._textureSizes={}};WS.prototype.addGeometryLoader=function(e){A.typeOf.object("loader",e);let t=e.cacheKey;if(this._geometrySizes.hasOwnProperty(t))return;this._geometrySizes[t]=0;let n=e.buffer,i=e.typedArray,o=0;c(n)&&(o+=n.sizeInBytes),c(i)&&(o+=i.byteLength),this.geometryByteLength+=o,this._geometrySizes[t]=o};WS.prototype.addTextureLoader=function(e){A.typeOf.object("loader",e);let t=e.cacheKey;if(this._textureSizes.hasOwnProperty(t))return;this._textureSizes[t]=0;let n=e.texture.sizeInBytes;this.texturesByteLength+=e.texture.sizeInBytes,this._textureSizes[t]=n};WS.prototype.removeLoader=function(e){A.typeOf.object("loader",e);let t=e.cacheKey,n=this._geometrySizes[t];delete this._geometrySizes[t],c(n)&&(this.geometryByteLength-=n);let i=this._textureSizes[t];delete this._textureSizes[t],c(i)&&(this.texturesByteLength-=i)};var Lz=WS;function Mn(){}Mn.cacheEntries={};Mn.statistics=new Lz;function h2e(e){this.referenceCount=1,this.resourceLoader=e,this._statisticsPromise=void 0}Mn.get=function(e){A.typeOf.string("cacheKey",e);let t=Mn.cacheEntries[e];if(c(t))return++t.referenceCount,t.resourceLoader};Mn.add=function(e){A.typeOf.object("resourceLoader",e);let t=e.cacheKey;if(A.typeOf.string("options.resourceLoader.cacheKey",t),c(Mn.cacheEntries[t]))throw new E(`Resource with this cacheKey is already in the cache: ${t}`);return Mn.cacheEntries[t]=new h2e(e),e};Mn.unload=function(e){A.typeOf.object("resourceLoader",e);let t=e.cacheKey,n=Mn.cacheEntries[t];if(!c(n))throw new E(`Resource is not in the cache: ${t}`);--n.referenceCount,n.referenceCount===0&&(Mn.statistics.removeLoader(e),e.destroy(),delete Mn.cacheEntries[t])};Mn.getSchemaLoader=function(e){e=y(e,y.EMPTY_OBJECT);let{schema:t,resource:n}=e;if(c(t)===c(n))throw new E("One of options.schema and options.resource must be defined.");let i=Ku.getSchemaCacheKey({schema:t,resource:n}),o=Mn.get(i);return c(o)?o:(o=new VO({schema:t,resource:n,cacheKey:i}),Mn.add(o))};Mn.getEmbeddedBufferLoader=function(e){e=y(e,y.EMPTY_OBJECT);let{parentResource:t,bufferId:n,typedArray:i}=e;A.typeOf.object("options.parentResource",t),A.typeOf.number("options.bufferId",n);let o=Ku.getEmbeddedBufferCacheKey({parentResource:t,bufferId:n}),r=Mn.get(o);return c(r)?r:(A.typeOf.object("options.typedArray",i),r=new NS({typedArray:i,cacheKey:o}),Mn.add(r))};Mn.getExternalBufferLoader=function(e){e=y(e,y.EMPTY_OBJECT);let{resource:t}=e;A.typeOf.object("options.resource",t);let n=Ku.getExternalBufferCacheKey({resource:t}),i=Mn.get(n);return c(i)?i:(i=new NS({resource:t,cacheKey:n}),Mn.add(i))};Mn.getGltfJsonLoader=function(e){e=y(e,y.EMPTY_OBJECT);let{gltfResource:t,baseResource:n,typedArray:i,gltfJson:o}=e;A.typeOf.object("options.gltfResource",t),A.typeOf.object("options.baseResource",n);let r=Ku.getGltfCacheKey({gltfResource:t}),s=Mn.get(r);return c(s)?s:(s=new RO({resourceCache:Mn,gltfResource:t,baseResource:n,typedArray:i,gltfJson:o,cacheKey:r}),Mn.add(s))};Mn.getBufferViewLoader=function(e){e=y(e,y.EMPTY_OBJECT);let{gltf:t,bufferViewId:n,gltfResource:i,baseResource:o}=e;A.typeOf.object("options.gltf",t),A.typeOf.number("options.bufferViewId",n),A.typeOf.object("options.gltfResource",i),A.typeOf.object("options.baseResource",o);let r=Ku.getBufferViewCacheKey({gltf:t,bufferViewId:n,gltfResource:i,baseResource:o}),s=Mn.get(r);return c(s)?s:(s=new CO({resourceCache:Mn,gltf:t,bufferViewId:n,gltfResource:i,baseResource:o,cacheKey:r}),Mn.add(s))};Mn.getDracoLoader=function(e){e=y(e,y.EMPTY_OBJECT);let{gltf:t,draco:n,gltfResource:i,baseResource:o}=e;A.typeOf.object("options.gltf",t),A.typeOf.object("options.draco",n),A.typeOf.object("options.gltfResource",i),A.typeOf.object("options.baseResource",o);let r=Ku.getDracoCacheKey({gltf:t,draco:n,gltfResource:i,baseResource:o}),s=Mn.get(r);return c(s)?s:(s=new EO({resourceCache:Mn,gltf:t,draco:n,gltfResource:i,baseResource:o,cacheKey:r}),Mn.add(s))};Mn.getVertexBufferLoader=function(e){e=y(e,y.EMPTY_OBJECT);let{gltf:t,gltfResource:n,baseResource:i,frameState:o,bufferViewId:r,draco:s,attributeSemantic:a,accessorId:l,asynchronous:u=!0,dequantize:f=!1,loadBuffer:d=!1,loadTypedArray:p=!1}=e;if(A.typeOf.object("options.gltf",t),A.typeOf.object("options.gltfResource",n),A.typeOf.object("options.baseResource",i),A.typeOf.object("options.frameState",o),!d&&!p)throw new E("At least one of loadBuffer and loadTypedArray must be true.");let g=c(r),m=m2e(s,a),b=c(a),x=c(l);if(g===m)throw new E("One of options.bufferViewId and options.draco must be defined.");if(m&&!b)throw new E("When options.draco is defined options.attributeSemantic must also be defined.");if(m&&!x)throw new E("When options.draco is defined options.haAccessorId must also be defined.");m&&(A.typeOf.object("options.draco",s),A.typeOf.string("options.attributeSemantic",a),A.typeOf.number("options.accessorId",l));let T=Ku.getVertexBufferCacheKey({gltf:t,gltfResource:n,baseResource:i,frameState:o,bufferViewId:r,draco:s,attributeSemantic:a,dequantize:f,loadBuffer:d,loadTypedArray:p}),C=Mn.get(T);return c(C)?C:(C=new NO({resourceCache:Mn,gltf:t,gltfResource:n,baseResource:i,bufferViewId:r,draco:s,attributeSemantic:a,accessorId:l,cacheKey:T,asynchronous:u,dequantize:f,loadBuffer:d,loadTypedArray:p}),Mn.add(C))};function m2e(e,t){return c(e)&&c(e.attributes)&&c(e.attributes[t])}Mn.getIndexBufferLoader=function(e){e=y(e,y.EMPTY_OBJECT);let{gltf:t,accessorId:n,gltfResource:i,baseResource:o,frameState:r,draco:s,asynchronous:a=!0,loadBuffer:l=!1,loadTypedArray:u=!1}=e;if(A.typeOf.object("options.gltf",t),A.typeOf.number("options.accessorId",n),A.typeOf.object("options.gltfResource",i),A.typeOf.object("options.baseResource",o),A.typeOf.object("options.frameState",r),!l&&!u)throw new E("At least one of loadBuffer and loadTypedArray must be true.");let f=Ku.getIndexBufferCacheKey({gltf:t,accessorId:n,gltfResource:i,baseResource:o,frameState:r,draco:s,loadBuffer:l,loadTypedArray:u}),d=Mn.get(f);return c(d)?d:(d=new wO({resourceCache:Mn,gltf:t,accessorId:n,gltfResource:i,baseResource:o,draco:s,cacheKey:f,asynchronous:a,loadBuffer:l,loadTypedArray:u}),Mn.add(d))};Mn.getImageLoader=function(e){e=y(e,y.EMPTY_OBJECT);let{gltf:t,imageId:n,gltfResource:i,baseResource:o}=e;A.typeOf.object("options.gltf",t),A.typeOf.number("options.imageId",n),A.typeOf.object("options.gltfResource",i),A.typeOf.object("options.baseResource",o);let r=Ku.getImageCacheKey({gltf:t,imageId:n,gltfResource:i,baseResource:o}),s=Mn.get(r);return c(s)?s:(s=new SO({resourceCache:Mn,gltf:t,imageId:n,gltfResource:i,baseResource:o,cacheKey:r}),Mn.add(s))};Mn.getTextureLoader=function(e){e=y(e,y.EMPTY_OBJECT);let{gltf:t,textureInfo:n,gltfResource:i,baseResource:o,supportedImageFormats:r,frameState:s,asynchronous:a=!0}=e;A.typeOf.object("options.gltf",t),A.typeOf.object("options.textureInfo",n),A.typeOf.object("options.gltfResource",i),A.typeOf.object("options.baseResource",o),A.typeOf.object("options.supportedImageFormats",r),A.typeOf.object("options.frameState",s);let l=Ku.getTextureCacheKey({gltf:t,textureInfo:n,gltfResource:i,baseResource:o,supportedImageFormats:r,frameState:s}),u=Mn.get(l);return c(u)?u:(u=new LO({resourceCache:Mn,gltf:t,textureInfo:n,gltfResource:i,baseResource:o,supportedImageFormats:r,cacheKey:l,asynchronous:a}),Mn.add(u))};Mn.clearForSpecs=function(){let e=[NO,wO,EO,LO,SO,CO,NS,VO,RO],t,n=Mn.cacheEntries,i=[];for(t in n)n.hasOwnProperty(t)&&i.push(n[t]);i.sort(function(r,s){let a=e.indexOf(r.resourceLoader.constructor),l=e.indexOf(s.resourceLoader.constructor);return a-l});let o=i.length;for(let r=0;r<o;++r){let s=i[r];t=s.resourceLoader.cacheKey,c(n[t])&&(s.resourceLoader.destroy(),delete n[t])}Mn.statistics.clear()};var Ci=Mn;function Xs(e,t,n){A.typeOf.object("resource",e),A.typeOf.object("implicitTileset",t),A.typeOf.object("implicitCoordinates",n),this._resource=e,this._subtreeJson=void 0,this._bufferLoader=void 0,this._tileAvailability=void 0,this._contentAvailabilityBitstreams=[],this._childSubtreeAvailability=void 0,this._implicitCoordinates=n,this._subtreeLevels=t.subtreeLevels,this._subdivisionScheme=t.subdivisionScheme,this._branchingFactor=t.branchingFactor,this._metadata=void 0,this._tileMetadataTable=void 0,this._tilePropertyTableJson=void 0,this._contentMetadataTables=[],this._contentPropertyTableJsons=[],this._tileJumpBuffer=void 0,this._contentJumpBuffers=[],this._ready=!1}Object.defineProperties(Xs.prototype,{ready:{get:function(){return this._ready}},metadata:{get:function(){return this._metadata}},tileMetadataTable:{get:function(){return this._tileMetadataTable}},tilePropertyTableJson:{get:function(){return this._tilePropertyTableJson}},contentMetadataTables:{get:function(){return this._contentMetadataTables}},contentPropertyTableJsons:{get:function(){return this._contentPropertyTableJsons}},implicitCoordinates:{get:function(){return this._implicitCoordinates}}});Xs.prototype.tileIsAvailableAtIndex=function(e){return this._tileAvailability.getBit(e)};Xs.prototype.tileIsAvailableAtCoordinates=function(e){let t=this.getTileIndex(e);return this.tileIsAvailableAtIndex(t)};Xs.prototype.contentIsAvailableAtIndex=function(e,t){if(t=y(t,0),t<0||t>=this._contentAvailabilityBitstreams.length)throw new E("contentIndex out of bounds.");return this._contentAvailabilityBitstreams[t].getBit(e)};Xs.prototype.contentIsAvailableAtCoordinates=function(e,t){let n=this.getTileIndex(e);return this.contentIsAvailableAtIndex(n,t)};Xs.prototype.childSubtreeIsAvailableAtIndex=function(e){return this._childSubtreeAvailability.getBit(e)};Xs.prototype.childSubtreeIsAvailableAtCoordinates=function(e){let t=this.getChildSubtreeIndex(e);return this.childSubtreeIsAvailableAtIndex(t)};Xs.prototype.getLevelOffset=function(e){let t=this._branchingFactor;return(Math.pow(t,e)-1)/(t-1)};Xs.prototype.getParentMortonIndex=function(e){let t=2;return this._subdivisionScheme===_r.OCTREE&&(t=3),e>>t};Xs.fromSubtreeJson=async function(e,t,n,i,o){if(A.typeOf.object("resource",e),c(t)===c(n))throw new E("One of json and subtreeView must be defined.");A.typeOf.object("implicitTileset",i),A.typeOf.object("implicitCoordinates",o);let r=new Xs(e,i,o),s;c(t)?s={json:t,binary:void 0}:s=p2e(n);let a=s.json;r._subtreeJson=a;let l;if(si(a,"3DTILES_metadata"))l=a.extensions["3DTILES_metadata"];else if(c(a.tileMetadata)){let C=a.tileMetadata;l=a.propertyTables[C]}let u=[];if(c(a.contentMetadata)){let C=a.contentMetadata.length;for(let S=0;S<C;S++){let v=a.contentMetadata[S];u.push(a.propertyTables[v])}}let f,d=i.metadataSchema,p=a.subtreeMetadata;if(c(p)){let C=p.class,S=d.classes[C];f=new nz({subtreeMetadata:p,class:S})}r._metadata=f,r._tilePropertyTableJson=l,r._contentPropertyTableJsons=u;let g={constant:0};a.contentAvailabilityHeaders=[],si(a,"3DTILES_multiple_contents")?a.contentAvailabilityHeaders=a.extensions["3DTILES_multiple_contents"].contentAvailability:Array.isArray(a.contentAvailability)?a.contentAvailabilityHeaders=a.contentAvailability:a.contentAvailabilityHeaders.push(y(a.contentAvailability,g));let m=_2e(a.buffers),b=g2e(a.bufferViews,m);y2e(a,b),c(l)&&eie(l,b);for(let C=0;C<u.length;C++){let S=u[C];eie(S,b)}let x=await b2e(r,m,s.binary),T=T2e(b,x);return A2e(r,a,i,T),c(l)&&(C2e(r,i,T),S2e(r)),E2e(r,i,T),w2e(r),r._ready=!0,r};function p2e(e){let n=new DataView(e.buffer,e.byteOffset),i=8,o=n.getUint32(i,!0);i+=8;let r=n.getUint32(i,!0);i+=8;let s=Ho(e,i,o);i+=o;let a=e.subarray(i,i+r);return{json:s,binary:a}}function _2e(e){e=c(e)?e:[];for(let t=0;t<e.length;t++){let n=e[t];n.isExternal=c(n.uri),n.isActive=!1}return e}function g2e(e,t){e=c(e)?e:[];for(let n=0;n<e.length;n++){let i=e[n],o=t[i.buffer];i.bufferHeader=o,i.isActive=!1}return e}function y2e(e,t){let n,i=e.tileAvailability;c(i.bitstream)?n=t[i.bitstream]:c(i.bufferView)&&(n=t[i.bufferView]),c(n)&&(n.isActive=!0,n.bufferHeader.isActive=!0);let o=e.contentAvailabilityHeaders;for(let s=0;s<o.length;s++)n=void 0,c(o[s].bitstream)?n=t[o[s].bitstream]:c(o[s].bufferView)&&(n=t[o[s].bufferView]),c(n)&&(n.isActive=!0,n.bufferHeader.isActive=!0);n=void 0;let r=e.childSubtreeAvailability;c(r.bitstream)?n=t[r.bitstream]:c(r.bufferView)&&(n=t[r.bufferView]),c(n)&&(n.isActive=!0,n.bufferHeader.isActive=!0)}function eie(e,t){let n=e.properties,i;for(let o in n)if(n.hasOwnProperty(o)){let r=n[o],s=y(r.values,r.bufferView);i=t[s],i.isActive=!0,i.bufferHeader.isActive=!0;let a=y(r.stringOffsets,r.stringOffsetBufferView);c(a)&&(i=t[a],i.isActive=!0,i.bufferHeader.isActive=!0);let l=y(r.arrayOffsets,r.arrayOffsetBufferView);c(l)&&(i=t[l],i.isActive=!0,i.bufferHeader.isActive=!0)}}function b2e(e,t,n){let i=[];for(let o=0;o<t.length;o++){let r=t[o];if(!r.isActive)i.push(Promise.resolve(void 0));else if(r.isExternal){let s=x2e(e,r);i.push(s)}else i.push(Promise.resolve(n))}return Promise.all(i).then(function(o){let r={};for(let s=0;s<o.length;s++){let a=o[s];c(a)&&(r[s]=a)}return r})}async function x2e(e,t){let i=e._resource.getDerivedResource({url:t.uri}),o=Ci.getExternalBufferLoader({resource:i});e._bufferLoader=o;try{await o.load()}catch(r){if(o.isDestroyed())return;throw r}return o.typedArray}function T2e(e,t){let n={};for(let i=0;i<e.length;i++){let o=e[i];if(!o.isActive)continue;let r=o.byteOffset,s=r+o.byteLength,l=t[o.buffer].subarray(r,s);n[i]=l}return n}function A2e(e,t,n,i){let o=n.branchingFactor,r=n.subtreeLevels,s=(Math.pow(o,r)-1)/(o-1),a=Math.pow(o,r),l=si(t,"3DTILES_metadata"),u=c(e._tilePropertyTableJson),f=l||u;e._tileAvailability=Nz(t.tileAvailability,i,s,f);let d=e._contentPropertyTableJsons.length>0;f=f||d;for(let p=0;p<t.contentAvailabilityHeaders.length;p++){let g=Nz(t.contentAvailabilityHeaders[p],i,s,f);e._contentAvailabilityBitstreams.push(g)}e._childSubtreeAvailability=Nz(t.childSubtreeAvailability,i,a)}function Nz(e,t,n,i){if(c(e.constant))return new bO({constant:!!e.constant,lengthBits:n,availableCount:e.availableCount});let o;return c(e.bitstream)?o=t[e.bitstream]:c(e.bufferView)&&(o=t[e.bufferView]),new bO({bitstream:o,lengthBits:n,availableCount:e.availableCount,computeAvailableCountEnabled:i})}function C2e(e,t,n){let i=e._tilePropertyTableJson,o=e._tileAvailability.availableCount,r=t.metadataSchema,s=i.class,a=r.classes[s];e._tileMetadataTable=new qu({class:a,count:o,properties:i.properties,bufferViews:n})}function E2e(e,t,n){let i=e._contentPropertyTableJsons,o=e._contentAvailabilityBitstreams,r=t.metadataSchema,s=e._contentMetadataTables;for(let a=0;a<i.length;a++){let l=i[a],f=o[a].availableCount,d=l.class,p=r.classes[d],g=new qu({class:p,count:f,properties:l.properties,bufferViews:n});s.push(g)}}function tie(e){let t=0,n=e.lengthBits,i=e.availableCount,o;i<256?o=new Uint8Array(n):i<65536?o=new Uint16Array(n):o=new Uint32Array(n);for(let r=0;r<e.lengthBits;r++)e.getBit(r)&&(o[r]=t,t++);return o}function S2e(e){let t=tie(e._tileAvailability);e._tileJumpBuffer=t}function w2e(e){let t=e._contentJumpBuffers,n=e._contentAvailabilityBitstreams;for(let i=0;i<n.length;i++){let o=n[i],r=tie(o);t.push(r)}}Xs.prototype.getTileIndex=function(e){let t=e.level-this._implicitCoordinates.level;if(t<0||this._subtreeLevels<=t)throw new ue("level is out of bounds for this subtree");return e.getSubtreeCoordinates().getOffsetCoordinates(e).tileIndex};Xs.prototype.getChildSubtreeIndex=function(e){if(e.level-this._implicitCoordinates.level!==this._implicitCoordinates.subtreeLevels)throw new ue("level is out of bounds for this subtree");return e.getParentSubtreeCoordinates().getOffsetCoordinates(e).mortonIndex};function v2e(e,t){if(!c(e._tileMetadataTable))return;let n=e.getTileIndex(t);if(e._tileAvailability.getBit(n))return e._tileJumpBuffer[n]}function D2e(e,t,n){let i=e._contentMetadataTables;if(!c(i))return;let o=i[n];if(!c(o))return;let r=e._contentAvailabilityBitstreams[n],s=e.getTileIndex(t);if(r.getBit(s))return e._contentJumpBuffers[n][s]}Xs.prototype.getTileMetadataView=function(e){let t=v2e(this,e);if(!c(t))return;let n=this._tileMetadataTable;return new xO({class:n.class,metadataTable:n,entityId:t,propertyTableJson:this._tilePropertyTableJson})};Xs.prototype.getContentMetadataView=function(e,t){let n=D2e(this,e,t);if(!c(n))return;let i=this._contentMetadataTables[t],o=this._contentPropertyTableJsons[t];return new xO({class:i.class,metadataTable:i,entityId:n,contentIndex:t,propertyTableJson:o})};Xs.prototype.isDestroyed=function(){return!1};Xs.prototype.destroy=function(){return c(this._bufferLoader)&&Ci.unload(this._bufferLoader),de(this)};var qS=Xs;var P2e={ID:"ID",NAME:"NAME",DESCRIPTION:"DESCRIPTION",TILESET_TILE_COUNT:"TILESET_TILE_COUNT",TILE_BOUNDING_BOX:"TILE_BOUNDING_BOX",TILE_BOUNDING_REGION:"TILE_BOUNDING_REGION",TILE_BOUNDING_SPHERE:"TILE_BOUNDING_SPHERE",TILE_MINIMUM_HEIGHT:"TILE_MINIMUM_HEIGHT",TILE_MAXIMUM_HEIGHT:"TILE_MAXIMUM_HEIGHT",TILE_HORIZON_OCCLUSION_POINT:"TILE_HORIZON_OCCLUSION_POINT",TILE_GEOMETRIC_ERROR:"TILE_GEOMETRIC_ERROR",CONTENT_BOUNDING_BOX:"CONTENT_BOUNDING_BOX",CONTENT_BOUNDING_REGION:"CONTENT_BOUNDING_REGION",CONTENT_BOUNDING_SPHERE:"CONTENT_BOUNDING_SPHERE",CONTENT_MINIMUM_HEIGHT:"CONTENT_MINIMUM_HEIGHT",CONTENT_MAXIMUM_HEIGHT:"CONTENT_MAXIMUM_HEIGHT",CONTENT_HORIZON_OCCLUSION_POINT:"CONTENT_HORIZON_OCCLUSION_POINT"},YS=Object.freeze(P2e);var td={};td.parseAllBoundingVolumeSemantics=function(e){return A.typeOf.object("tileMetadata",e),{tile:{boundingVolume:td.parseBoundingVolumeSemantic("TILE",e),minimumHeight:td._parseMinimumHeight("TILE",e),maximumHeight:td._parseMaximumHeight("TILE",e)},content:{boundingVolume:td.parseBoundingVolumeSemantic("CONTENT",e),minimumHeight:td._parseMinimumHeight("CONTENT",e),maximumHeight:td._parseMaximumHeight("CONTENT",e)}}};td.parseBoundingVolumeSemantic=function(e,t){if(A.typeOf.string("prefix",e),e!=="TILE"&&e!=="CONTENT")throw new E("prefix must be either 'TILE' or 'CONTENT'");A.typeOf.object("tileMetadata",t);let n=`${e}_BOUNDING_BOX`,i=t.getPropertyBySemantic(n);if(c(i))return{box:i};let o=`${e}_BOUNDING_REGION`,r=t.getPropertyBySemantic(o);if(c(r))return{region:r};let s=`${e}_BOUNDING_SPHERE`,a=t.getPropertyBySemantic(s);if(c(a))return{sphere:a}};td._parseMinimumHeight=function(e,t){if(A.typeOf.string("prefix",e),e!=="TILE"&&e!=="CONTENT")throw new E("prefix must be either 'TILE' or 'CONTENT'");A.typeOf.object("tileMetadata",t);let n=`${e}_MINIMUM_HEIGHT`;return t.getPropertyBySemantic(n)};td._parseMaximumHeight=function(e,t){if(A.typeOf.string("prefix",e),e!=="TILE"&&e!=="CONTENT")throw new E("prefix must be either 'TILE' or 'CONTENT'");A.typeOf.object("tileMetadata",t);let n=`${e}_MAXIMUM_HEIGHT`;return t.getPropertyBySemantic(n)};var XS=td;function Tc(e,t,n){A.defined("tile.implicitTileset",t.implicitTileset),A.defined("tile.implicitCoordinates",t.implicitCoordinates);let i=t.implicitTileset,o=t.implicitCoordinates;this._implicitTileset=i,this._implicitCoordinates=o,this._implicitSubtree=void 0,this._tileset=e,this._tile=t,this._resource=n,this._metadata=void 0,this.featurePropertiesDirty=!1,this._group=void 0;let r=o.getTemplateValues(),s=i.subtreeUriTemplate.getDerivedResource({templateValues:r});this._url=s.getUrlComponent(!0),this._ready=!1}Object.defineProperties(Tc.prototype,{featuresLength:{get:function(){return 0}},pointsLength:{get:function(){return 0}},trianglesLength:{get:function(){return 0}},geometryByteLength:{get:function(){return 0}},texturesByteLength:{get:function(){return 0}},batchTableByteLength:{get:function(){return 0}},innerContents:{get:function(){}},ready:{get:function(){return this._ready}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){return this._url}},metadata:{get:function(){},set:function(){throw new E("Implicit3DTileContent cannot have metadata")}},batchTable:{get:function(){}},group:{get:function(){return this._group},set:function(e){this._group=e}}});Tc.fromSubtreeJson=async function(e,t,n,i,o,r){if(A.defined("tile.implicitTileset",t.implicitTileset),A.defined("tile.implicitCoordinates",t.implicitCoordinates),c(i)===c(o))throw new E("One of json and arrayBuffer must be defined.");r=y(r,0);let s;c(o)&&(s=new Uint8Array(o,r));let a=t.implicitTileset,l=t.implicitCoordinates,u=await qS.fromSubtreeJson(n,i,s,a,l),f=new Tc(e,t,n);return f._implicitSubtree=u,I2e(f,u),f._ready=!0,f};function I2e(e,t){let n=e._tile,i=e._implicitCoordinates.childIndex,o=R2e(e,t,n,i),r=e._tileset.statistics;n.children.push(o.rootTile),r.numberOfTilesTotal++;let s=O2e(e,t,o.bottomRow);for(let a=0;a<s.length;a++){let l=s[a],u=l.tile,f=z2e(e,u,l.childIndex);u.children.push(f),r.numberOfTilesTotal++}}function O2e(e,t,n){let i=[],o=e._implicitTileset.branchingFactor;for(let r=0;r<n.length;r++){let s=n[r];if(c(s))for(let a=0;a<o;a++){let l=r*o+a;t.childSubtreeIsAvailableAtIndex(l)&&i.push({tile:s,childIndex:a})}}return i}function R2e(e,t,n,i){let s=nie(e,t,n,i,0,!0),a=e._tileset.statistics,l=[s],u=[],f=e._implicitTileset;for(let d=1;d<f.subtreeLevels;d++){let p=t.getLevelOffset(d),g=f.branchingFactor*l.length;for(let m=0;m<g;m++){let b=p+m;if(!t.tileIsAvailableAtIndex(b)){u.push(void 0);continue}let x=t.getParentMortonIndex(m),T=l[x],C=m%f.branchingFactor,S=nie(e,t,T,C,b);T.children.push(S),a.numberOfTilesTotal++,u.push(S)}l=u,u=[]}return{rootTile:s,bottomRow:l}}function iie(e,t,n){let i=YS.TILE_GEOMETRIC_ERROR;return c(e)&&e.hasPropertyBySemantic(i)?e.getPropertyBySemantic(i):t.geometricError/Math.pow(2,n.level)}function nie(e,t,n,i,o,r){let s=e._implicitTileset,a;y(r,!1)?a=n.implicitCoordinates:a=n.implicitCoordinates.getChildCoordinates(i);let l,u,f;if(c(t.tilePropertyTableJson)){l=t.getTileMetadataView(a);let I=XS.parseAllBoundingVolumeSemantics(l);u=I.tile,f=I.content}let p=t.contentPropertyTableJsons.length,g=!1;for(let I=0;I<p;I++)if(t.contentIsAvailableAtCoordinates(a,I)){g=!0;break}let m=N2e(s,a,i,r,n,u),b=[];for(let I=0;I<s.contentCount;I++){if(!t.contentIsAvailableAtIndex(o,I))continue;let N={uri:s.contentUriTemplates[I].getDerivedResource({templateValues:a.getTemplateValues()}).url},B=F2e(m,f);c(B)&&(N.boundingVolume=B),b.push(At(N,s.contentHeaders[I]))}let x=iie(l,s,a),T={boundingVolume:m,geometricError:x,refine:s.refine,contents:b},C=!0,S=qe(s.tileHeader,C);delete S.boundingVolume,delete S.transform,delete S.metadata;let v=At(T,S,C),D=cie(e,s.baseResource,v,n);return D.implicitCoordinates=a,D.implicitSubtree=t,D.metadata=l,D.hasImplicitContentMetadata=g,D}function zO(e,t){return c(e)&&c(t)&&(c(t.minimumHeight)||c(t.maximumHeight))&&(si(e,"3DTILES_bounding_volume_S2")||c(e.region))}function Bz(e,t){c(t)&&(si(e,"3DTILES_bounding_volume_S2")?L2e(e.extensions["3DTILES_bounding_volume_S2"],t.minimumHeight,t.maximumHeight):c(e.region)&&M2e(e.region,t.minimumHeight,t.maximumHeight))}function M2e(e,t,n){c(t)&&(e[4]=t),c(n)&&(e[5]=n)}function L2e(e,t,n){c(t)&&(e.minimumHeight=t),c(n)&&(e.maximumHeight=n)}function N2e(e,t,n,i,o,r){let s;return!c(r)||!c(r.boundingVolume)||!zO(r.boundingVolume,r)&&zO(e.boundingVolume,r)?s=oie(e,t,n,y(i,!1),o):s=r.boundingVolume,Bz(s,r),s}function F2e(e,t){let n;return c(t)&&(n=t.boundingVolume),zO(n,t)?Bz(n,t):zO(e,t)&&(n=qe(e,!0),Bz(n,t)),n}function oie(e,t,n,i,o){let r=e.boundingVolume;return si(r,"3DTILES_bounding_volume_S2")?rie(i,o,n,t.level,t.x,t.y,t.z):c(r.region)?{region:aie(r.region,t.level,t.x,t.y,t.z)}:{box:sie(r.box,t.level,t.x,t.y,t.z)}}function rie(e,t,n,i,o,r,s){A.typeOf.bool("parentIsPlaceholderTile",e),A.typeOf.object("parentTile",t),A.typeOf.number("childIndex",n),A.typeOf.number("level",i),A.typeOf.number("x",o),A.typeOf.number("y",r),c(s)&&A.typeOf.number("z",s);let a=t._boundingVolume;if(e)return{extensions:{"3DTILES_bounding_volume_S2":{token:u0.getTokenFromId(a.s2Cell._cellId),minimumHeight:a.minimumHeight,maximumHeight:a.maximumHeight}}};let l=Number(t._boundingVolume.s2Cell._cellId>>BigInt(61)),u=l%2===0?_O.encode2D(i,o,r):_O.encode2D(i,r,o),f=u0.fromFacePositionLevel(l,BigInt(u),i),d,p;if(c(s)){let g=(a.maximumHeight+a.minimumHeight)/2;d=n<4?a.minimumHeight:g,p=n<4?g:a.maximumHeight}else d=a.minimumHeight,p=a.maximumHeight;return{extensions:{"3DTILES_bounding_volume_S2":{token:u0.getTokenFromId(f._cellId),minimumHeight:d,maximumHeight:p}}}}var B2e=new h,k2e=new h,Fz=new h,V2e=new Q;function sie(e,t,n,i,o){if(A.typeOf.object("rootBox",e),A.typeOf.number("level",t),A.typeOf.number("x",n),A.typeOf.number("y",i),c(o)&&A.typeOf.number("z",o),t===0)return e;let r=h.unpack(e,0,k2e),s=Q.unpack(e,3,V2e),a=Math.pow(2,-t),l=-1+(2*n+1)*a,u=-1+(2*i+1)*a,f=0,d=h.fromElements(a,a,1,B2e);c(o)&&(f=-1+(2*o+1)*a,d.z=a);let p=h.fromElements(l,u,f,Fz);p=Q.multiplyByVector(s,p,Fz),p=h.add(p,r,Fz);let g=Q.clone(s);g=Q.multiplyByScale(g,d,g);let m=new Array(12);return h.pack(p,m),Q.pack(g,m,3),m}var U2e=new ae;function aie(e,t,n,i,o){if(A.typeOf.object("rootRegion",e),A.typeOf.number("level",t),A.typeOf.number("x",n),A.typeOf.number("y",i),c(o)&&A.typeOf.number("z",o),t===0)return e.slice();let r=ae.unpack(e,0,U2e),s=e[4],a=e[5],l=Math.pow(2,-t),u=l*r.width,f=R.negativePiToPi(r.west+n*u),d=R.negativePiToPi(f+u),p=l*r.height,g=R.negativePiToPi(r.south+i*p),m=R.negativePiToPi(g+p),b=s,x=a;if(c(o)){let T=l*(a-s);b+=o*T,x=b+T}return[f,g,d,m,b,x]}function z2e(e,t,n){let i=e._implicitTileset,o=t.implicitCoordinates.getChildCoordinates(n),r=oie(i,o,n,!1,t),s=iie(void 0,i,o),a=i.subtreeUriTemplate.getDerivedResource({templateValues:o.getTemplateValues()}).url,l={boundingVolume:r,geometricError:s,refine:i.refine,contents:[{uri:a}]},u=cie(e,i.baseResource,l,t);return u.implicitTileset=i,u.implicitCoordinates=o,u}function cie(e,t,n,i){let o=e._tile.constructor;return new o(e._tileset,t,n,i)}Tc.prototype.hasProperty=function(e,t){return!1};Tc.prototype.getFeature=function(e){};Tc.prototype.applyDebugSettings=function(e,t){};Tc.prototype.applyStyle=function(e){};Tc.prototype.update=function(e,t){};Tc.prototype.pick=function(e,t,n){};Tc.prototype.isDestroyed=function(){return!1};Tc.prototype.destroy=function(){return this._implicitSubtree=this._implicitSubtree&&this._implicitSubtree.destroy(),de(this)};Tc._deriveBoundingBox=sie;Tc._deriveBoundingRegion=aie;Tc._deriveBoundingVolumeS2=rie;var HO=Tc;var H2e={NONE:0,REPEAT:1,MIRRORED_REPEAT:2},$u=Object.freeze(H2e);function lT(e,t){A.typeOf.object("normal",e),A.typeOf.number("distance",t),this._distance=t,this._normal=new lie(e,this),this.onChangeCallback=void 0,this.index=-1}Object.defineProperties(lT.prototype,{distance:{get:function(){return this._distance},set:function(e){A.typeOf.number("value",e),c(this.onChangeCallback)&&e!==this._distance&&this.onChangeCallback(this.index),this._distance=e}},normal:{get:function(){return this._normal},set:function(e){A.typeOf.object("value",e),c(this.onChangeCallback)&&!h.equals(this._normal._cartesian3,e)&&this.onChangeCallback(this.index),h.clone(e,this._normal._cartesian3)}}});lT.fromPlane=function(e,t){return A.typeOf.object("plane",e),c(t)?(t.normal=e.normal,t.distance=e.distance):t=new lT(e.normal,e.distance),t};lT.clone=function(e,t){return c(t)?(t.normal=e.normal,t.distance=e.distance,t):new lT(e.normal,e.distance)};function lie(e,t){this._clippingPlane=t,this._cartesian3=h.clone(e)}Object.defineProperties(lie.prototype,{x:{get:function(){return this._cartesian3.x},set:function(e){A.typeOf.number("value",e),c(this._clippingPlane.onChangeCallback)&&e!==this._cartesian3.x&&this._clippingPlane.onChangeCallback(this._clippingPlane.index),this._cartesian3.x=e}},y:{get:function(){return this._cartesian3.y},set:function(e){A.typeOf.number("value",e),c(this._clippingPlane.onChangeCallback)&&e!==this._cartesian3.y&&this._clippingPlane.onChangeCallback(this._clippingPlane.index),this._cartesian3.y=e}},z:{get:function(){return this._cartesian3.z},set:function(e){A.typeOf.number("value",e),c(this._clippingPlane.onChangeCallback)&&e!==this._cartesian3.z&&this._clippingPlane.onChangeCallback(this._clippingPlane.index),this._cartesian3.z=e}}});var KS=lT;function ja(e){e=y(e,y.EMPTY_OBJECT),this._planes=[],this._dirtyIndex=-1,this._multipleDirtyPlanes=!1,this._enabled=y(e.enabled,!0),this.modelMatrix=k.clone(y(e.modelMatrix,k.IDENTITY)),this.edgeColor=j.clone(y(e.edgeColor,j.WHITE)),this.edgeWidth=y(e.edgeWidth,0),this.planeAdded=new pe,this.planeRemoved=new pe,this._owner=void 0;let t=y(e.unionClippingRegions,!1);this._unionClippingRegions=t,this._testIntersection=t?mie:pie,this._uint8View=void 0,this._float32View=void 0,this._clippingPlanesTexture=void 0;let n=e.planes;if(c(n)){let i=n.length;for(let o=0;o<i;++o)this.add(n[o])}}function mie(e){return e===qt.OUTSIDE}function pie(e){return e===qt.INSIDE}Object.defineProperties(ja.prototype,{length:{get:function(){return this._planes.length}},unionClippingRegions:{get:function(){return this._unionClippingRegions},set:function(e){this._unionClippingRegions!==e&&(this._unionClippingRegions=e,this._testIntersection=e?mie:pie)}},enabled:{get:function(){return this._enabled},set:function(e){this._enabled!==e&&(this._enabled=e)}},texture:{get:function(){return this._clippingPlanesTexture}},owner:{get:function(){return this._owner}},clippingPlanesState:{get:function(){return this._unionClippingRegions?this._planes.length:-this._planes.length}}});function uie(e,t){e._multipleDirtyPlanes=e._multipleDirtyPlanes||e._dirtyIndex!==-1&&e._dirtyIndex!==t,e._dirtyIndex=t}ja.prototype.add=function(e){let t=this._planes.length,n=this;e.onChangeCallback=function(i){uie(n,i)},e.index=t,uie(this,t),this._planes.push(e),this.planeAdded.raiseEvent(e,t)};ja.prototype.get=function(e){return A.typeOf.number("index",e),this._planes[e]};function _ie(e,t){let n=e.length;for(let i=0;i<n;++i)if(un.equals(e[i],t))return i;return-1}ja.prototype.contains=function(e){return _ie(this._planes,e)!==-1};ja.prototype.remove=function(e){let t=this._planes,n=_ie(t,e);if(n===-1)return!1;e instanceof KS&&(e.onChangeCallback=void 0,e.index=-1);let i=t.length-1;for(let o=n;o<i;++o){let r=t[o+1];t[o]=r,r instanceof KS&&(r.index=o)}return this._multipleDirtyPlanes=!0,t.length=i,this.planeRemoved.raiseEvent(e,n),!0};ja.prototype.removeAll=function(){let e=this._planes,t=e.length;for(let n=0;n<t;++n){let i=e[n];i instanceof KS&&(i.onChangeCallback=void 0,i.index=-1),this.planeRemoved.raiseEvent(i,n)}this._multipleDirtyPlanes=!0,this._planes=[]};var G2e=new se,j2e=new se;function fie(e,t,n){let i=e._uint8View,o=e._planes,r=0;for(let s=t;s<n;++s){let a=o[s],l=Nn.octEncodeToCartesian4(a.normal,j2e);i[r]=l.x,i[r+1]=l.y,i[r+2]=l.z,i[r+3]=l.w;let u=se.packFloat(a.distance,G2e);i[r+4]=u.x,i[r+5]=u.y,i[r+6]=u.z,i[r+7]=u.w,r+=8}}function die(e,t,n){let i=e._float32View,o=e._planes,r=0;for(let s=t;s<n;++s){let a=o[s],l=a.normal;i[r]=l.x,i[r+1]=l.y,i[r+2]=l.z,i[r+3]=a.distance,r+=4}}function gie(e,t){let n=mt.maximumTextureSize;return t.x=Math.min(e,n),t.y=Math.ceil(e/t.x),t}var W2e=new H;ja.prototype.update=function(e){let t=this._clippingPlanesTexture,n=e.context,i=ja.useFloatTexture(n),o=i?this.length:this.length*2;if(c(t)){let s=t.width*t.height;(s<o||o<.25*s)&&(t.destroy(),t=void 0,this._clippingPlanesTexture=void 0)}if(this.length===0)return;if(!c(t)){let s=gie(o,W2e);s.y*=2,i?(t=new Lt({context:n,width:s.x,height:s.y,pixelFormat:Ve.RGBA,pixelDatatype:Be.FLOAT,sampler:Qt.NEAREST,flipY:!1}),this._float32View=new Float32Array(s.x*s.y*4)):(t=new Lt({context:n,width:s.x,height:s.y,pixelFormat:Ve.RGBA,pixelDatatype:Be.UNSIGNED_BYTE,sampler:Qt.NEAREST,flipY:!1}),this._uint8View=new Uint8Array(s.x*s.y*4)),this._clippingPlanesTexture=t,this._multipleDirtyPlanes=!0}let r=this._dirtyIndex;if(!(!this._multipleDirtyPlanes&&r===-1)){if(this._multipleDirtyPlanes)i?(die(this,0,this._planes.length),t.copyFrom({source:{width:t.width,height:t.height,arrayBufferView:this._float32View}})):(fie(this,0,this._planes.length),t.copyFrom({source:{width:t.width,height:t.height,arrayBufferView:this._uint8View}}));else{let s=0,a=0;i?(a=Math.floor(r/t.width),s=Math.floor(r-a*t.width),die(this,r,r+1),t.copyFrom({source:{width:1,height:1,arrayBufferView:this._float32View},xOffset:s,yOffset:a})):(a=Math.floor(r*2/t.width),s=Math.floor(r*2-a*t.width),fie(this,r,r+1),t.copyFrom({source:{width:2,height:1,arrayBufferView:this._uint8View},xOffset:s,yOffset:a}))}this._multipleDirtyPlanes=!1,this._dirtyIndex=-1}};var q2e=new k,hie=new un(h.UNIT_X,0);ja.prototype.computeIntersectionWithBoundingVolume=function(e,t){let n=this._planes,i=n.length,o=this.modelMatrix;c(t)&&(o=k.multiply(t,o,q2e));let r=qt.INSIDE;!this.unionClippingRegions&&i>0&&(r=qt.OUTSIDE);for(let s=0;s<i;++s){let a=n[s];un.transform(a,o,hie);let l=e.intersectPlane(hie);if(l===qt.INTERSECTING)r=l;else if(this._testIntersection(l))return l}return r};ja.setOwner=function(e,t,n){if(e!==t[n]&&(t[n]=t[n]&&t[n].destroy(),c(e))){if(c(e._owner))throw new E("ClippingPlaneCollection should only be assigned to one object");e._owner=t,t[n]=e}};ja.useFloatTexture=function(e){return e.floatingPointTexture};ja.getTextureResolution=function(e,t,n){let i=e.texture;if(c(i))return n.x=i.width,n.y=i.height,n;let o=ja.useFloatTexture(t)?e.length:e.length*2,r=gie(o,n);return r.y*=2,r};ja.prototype.isDestroyed=function(){return!1};ja.prototype.destroy=function(){return this._clippingPlanesTexture=this._clippingPlanesTexture&&this._clippingPlanesTexture.destroy(),de(this)};var Ms=ja;function Uz(e,t,n=2){let i=t&&t.length,o=i?t[0]*n:e.length,r=bie(e,0,o,n,!0),s=[];if(!r||r.next===r.prev)return s;let a,l,u;if(i&&(r=Z2e(e,t,r,n)),e.length>80*n){a=1/0,l=1/0;let f=-1/0,d=-1/0;for(let p=n;p<o;p+=n){let g=e[p],m=e[p+1];g<a&&(a=g),m<l&&(l=m),g>f&&(f=g),m>d&&(d=m)}u=Math.max(f-a,d-l),u=u!==0?32767/u:0}return $S(r,s,n,a,l,u,0),s}function bie(e,t,n,i,o){let r;if(o===cBe(e,t,n,i)>0)for(let s=t;s<n;s+=i)r=yie(s/i|0,e[s],e[s+1],r);else for(let s=n-i;s>=t;s-=i)r=yie(s/i|0,e[s],e[s+1],r);return r&&WO(r,r.next)&&(JS(r),r=r.next),r}function g0(e,t){if(!e)return e;t||(t=e);let n=e,i;do if(i=!1,!n.steiner&&(WO(n,n.next)||Ir(n.prev,n,n.next)===0)){if(JS(n),n=t=n.prev,n===n.next)break;i=!0}else n=n.next;while(i||n!==t);return t}function $S(e,t,n,i,o,r,s){if(!e)return;!s&&r&&nBe(e,i,o,r);let a=e;for(;e.prev!==e.next;){let l=e.prev,u=e.next;if(r?X2e(e,i,o,r):Y2e(e)){t.push(l.i,e.i,u.i),JS(e),e=u.next,a=u.next;continue}if(e=u,e===a){s?s===1?(e=K2e(g0(e),t),$S(e,t,n,i,o,r,2)):s===2&&$2e(e,t,n,i,o,r):$S(g0(e),t,n,i,o,r,1);break}}}function Y2e(e){let t=e.prev,n=e,i=e.next;if(Ir(t,n,i)>=0)return!1;let o=t.x,r=n.x,s=i.x,a=t.y,l=n.y,u=i.y,f=o<r?o<s?o:s:r<s?r:s,d=a<l?a<u?a:u:l<u?l:u,p=o>r?o>s?o:s:r>s?r:s,g=a>l?a>u?a:u:l>u?l:u,m=i.next;for(;m!==t;){if(m.x>=f&&m.x<=p&&m.y>=d&&m.y<=g&&uT(o,a,r,l,s,u,m.x,m.y)&&Ir(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function X2e(e,t,n,i){let o=e.prev,r=e,s=e.next;if(Ir(o,r,s)>=0)return!1;let a=o.x,l=r.x,u=s.x,f=o.y,d=r.y,p=s.y,g=a<l?a<u?a:u:l<u?l:u,m=f<d?f<p?f:p:d<p?d:p,b=a>l?a>u?a:u:l>u?l:u,x=f>d?f>p?f:p:d>p?d:p,T=kz(g,m,t,n,i),C=kz(b,x,t,n,i),S=e.prevZ,v=e.nextZ;for(;S&&S.z>=T&&v&&v.z<=C;){if(S.x>=g&&S.x<=b&&S.y>=m&&S.y<=x&&S!==o&&S!==s&&uT(a,f,l,d,u,p,S.x,S.y)&&Ir(S.prev,S,S.next)>=0||(S=S.prevZ,v.x>=g&&v.x<=b&&v.y>=m&&v.y<=x&&v!==o&&v!==s&&uT(a,f,l,d,u,p,v.x,v.y)&&Ir(v.prev,v,v.next)>=0))return!1;v=v.nextZ}for(;S&&S.z>=T;){if(S.x>=g&&S.x<=b&&S.y>=m&&S.y<=x&&S!==o&&S!==s&&uT(a,f,l,d,u,p,S.x,S.y)&&Ir(S.prev,S,S.next)>=0)return!1;S=S.prevZ}for(;v&&v.z<=C;){if(v.x>=g&&v.x<=b&&v.y>=m&&v.y<=x&&v!==o&&v!==s&&uT(a,f,l,d,u,p,v.x,v.y)&&Ir(v.prev,v,v.next)>=0)return!1;v=v.nextZ}return!0}function K2e(e,t){let n=e;do{let i=n.prev,o=n.next.next;!WO(i,o)&&xie(i,n,n.next,o)&&ZS(i,o)&&ZS(o,i)&&(t.push(i.i,n.i,o.i),JS(n),JS(n.next),n=e=o),n=n.next}while(n!==e);return g0(n)}function $2e(e,t,n,i,o,r){let s=e;do{let a=s.next.next;for(;a!==s.prev;){if(s.i!==a.i&&rBe(s,a)){let l=Tie(s,a);s=g0(s,s.next),l=g0(l,l.next),$S(s,t,n,i,o,r,0),$S(l,t,n,i,o,r,0);return}a=a.next}s=s.next}while(s!==e)}function Z2e(e,t,n,i){let o=[];for(let r=0,s=t.length;r<s;r++){let a=t[r]*i,l=r<s-1?t[r+1]*i:e.length,u=bie(e,a,l,i,!1);u===u.next&&(u.steiner=!0),o.push(oBe(u))}o.sort(J2e);for(let r=0;r<o.length;r++)n=Q2e(o[r],n);return n}function J2e(e,t){return e.x-t.x}function Q2e(e,t){let n=eBe(e,t);if(!n)return t;let i=Tie(n,e);return g0(i,i.next),g0(n,n.next)}function eBe(e,t){let n=t,i=e.x,o=e.y,r=-1/0,s;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){let d=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(d<=i&&d>r&&(r=d,s=n.x<n.next.x?n:n.next,d===i))return s}n=n.next}while(n!==t);if(!s)return null;let a=s,l=s.x,u=s.y,f=1/0;n=s;do{if(i>=n.x&&n.x>=l&&i!==n.x&&uT(o<u?i:r,o,l,u,o<u?r:i,o,n.x,n.y)){let d=Math.abs(o-n.y)/(i-n.x);ZS(n,e)&&(d<f||d===f&&(n.x>s.x||n.x===s.x&&tBe(s,n)))&&(s=n,f=d)}n=n.next}while(n!==a);return s}function tBe(e,t){return Ir(e.prev,e,t.prev)<0&&Ir(t.next,e,e.next)<0}function nBe(e,t,n,i){let o=e;do o.z===0&&(o.z=kz(o.x,o.y,t,n,i)),o.prevZ=o.prev,o.nextZ=o.next,o=o.next;while(o!==e);o.prevZ.nextZ=null,o.prevZ=null,iBe(o)}function iBe(e){let t,n=1;do{let i=e,o;e=null;let r=null;for(t=0;i;){t++;let s=i,a=0;for(let u=0;u<n&&(a++,s=s.nextZ,!!s);u++);let l=n;for(;a>0||l>0&&s;)a!==0&&(l===0||!s||i.z<=s.z)?(o=i,i=i.nextZ,a--):(o=s,s=s.nextZ,l--),r?r.nextZ=o:e=o,o.prevZ=r,r=o;i=s}r.nextZ=null,n*=2}while(t>1);return e}function kz(e,t,n,i,o){return e=(e-n)*o|0,t=(t-i)*o|0,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e|t<<1}function oBe(e){let t=e,n=e;do(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next;while(t!==e);return n}function uT(e,t,n,i,o,r,s,a){return(o-s)*(t-a)>=(e-s)*(r-a)&&(e-s)*(i-a)>=(n-s)*(t-a)&&(n-s)*(r-a)>=(o-s)*(i-a)}function rBe(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!sBe(e,t)&&(ZS(e,t)&&ZS(t,e)&&aBe(e,t)&&(Ir(e.prev,e,t.prev)||Ir(e,t.prev,t))||WO(e,t)&&Ir(e.prev,e,e.next)>0&&Ir(t.prev,t,t.next)>0)}function Ir(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function WO(e,t){return e.x===t.x&&e.y===t.y}function xie(e,t,n,i){let o=jO(Ir(e,t,n)),r=jO(Ir(e,t,i)),s=jO(Ir(n,i,e)),a=jO(Ir(n,i,t));return!!(o!==r&&s!==a||o===0&&GO(e,n,t)||r===0&&GO(e,i,t)||s===0&&GO(n,e,i)||a===0&&GO(n,t,i))}function GO(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function jO(e){return e>0?1:e<0?-1:0}function sBe(e,t){let n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&xie(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}function ZS(e,t){return Ir(e.prev,e,e.next)<0?Ir(e,t,e.next)>=0&&Ir(e,e.prev,t)>=0:Ir(e,t,e.prev)<0||Ir(e,e.next,t)<0}function aBe(e,t){let n=e,i=!1,o=(e.x+t.x)/2,r=(e.y+t.y)/2;do n.y>r!=n.next.y>r&&n.next.y!==n.y&&o<(n.next.x-n.x)*(r-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next;while(n!==e);return i}function Tie(e,t){let n=Vz(e.i,e.x,e.y),i=Vz(t.i,t.x,t.y),o=e.next,r=t.prev;return e.next=t,t.prev=e,n.next=o,o.prev=n,i.next=n,n.prev=i,r.next=i,i.prev=r,i}function yie(e,t,n,i){let o=Vz(e,t,n);return i?(o.next=i.next,o.prev=i,i.next.prev=o,i.next=o):(o.prev=o,o.next=o),o}function JS(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Vz(e,t,n){return{i:e,x:t,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function cBe(e,t,n,i){let o=0;for(let r=t,s=n-i;r<n;r+=i)o+=(e[s]-e[r])*(e[r+1]+e[s+1]),s=r;return o}var lBe=new h,uBe=new h,q_={};q_.computeArea2D=function(e){A.defined("positions",e),A.typeOf.number.greaterThanOrEquals("positions.length",e.length,3);let t=e.length,n=0;for(let i=t-1,o=0;o<t;i=o++){let r=e[i],s=e[o];n+=r.x*s.y-s.x*r.y}return n*.5};q_.computeWindingOrder2D=function(e){return q_.computeArea2D(e)>0?ls.COUNTER_CLOCKWISE:ls.CLOCKWISE};q_.triangulate=function(e,t){A.defined("positions",e);let n=H.packArray(e);return Uz(n,t,2)};var Sie=new h,wie=new h,vie=new h,Aie=new h,Cie=new h,Eie=new h,ep=new h,Die=new H,Pie=new H,Iie=new H,fT=new H;q_.computeSubdivision=function(e,t,n,i,o){o=y(o,R.RADIANS_PER_DEGREE);let r=c(i);A.typeOf.object("ellipsoid",e),A.defined("positions",t),A.defined("indices",n),A.typeOf.number.greaterThanOrEquals("indices.length",n.length,3),A.typeOf.number.equals("indices.length % 3","0",n.length%3,0),A.typeOf.number.greaterThan("granularity",o,0);let s=n.slice(0),a,l=t.length,u=new Array(l*3),f=new Array(l*2),d=0,p=0;for(a=0;a<l;a++){let S=t[a];if(u[d++]=S.x,u[d++]=S.y,u[d++]=S.z,r){let v=i[a];f[p++]=v.x,f[p++]=v.y}}let g=[],m={},b=e.maximumRadius,x=R.chordLength(o,b),T=x*x;for(;s.length>0;){let S=s.pop(),v=s.pop(),D=s.pop(),I=h.fromArray(u,D*3,Sie),L=h.fromArray(u,v*3,wie),M=h.fromArray(u,S*3,vie),N,B,_;r&&(N=H.fromArray(f,D*2,Die),B=H.fromArray(f,v*2,Pie),_=H.fromArray(f,S*2,Iie));let w=h.multiplyByScalar(h.normalize(I,Aie),b,Aie),P=h.multiplyByScalar(h.normalize(L,Cie),b,Cie),O=h.multiplyByScalar(h.normalize(M,Eie),b,Eie),F=h.magnitudeSquared(h.subtract(w,P,ep)),V=h.magnitudeSquared(h.subtract(P,O,ep)),G=h.magnitudeSquared(h.subtract(O,w,ep)),z=Math.max(F,V,G),W,U,q;z>T?F===z?(W=`${Math.min(D,v)} ${Math.max(D,v)}`,a=m[W],c(a)||(U=h.add(I,L,ep),h.multiplyByScalar(U,.5,U),u.push(U.x,U.y,U.z),a=u.length/3-1,m[W]=a,r&&(q=H.add(N,B,fT),H.multiplyByScalar(q,.5,q),f.push(q.x,q.y))),s.push(D,a,S),s.push(a,v,S)):V===z?(W=`${Math.min(v,S)} ${Math.max(v,S)}`,a=m[W],c(a)||(U=h.add(L,M,ep),h.multiplyByScalar(U,.5,U),u.push(U.x,U.y,U.z),a=u.length/3-1,m[W]=a,r&&(q=H.add(B,_,fT),H.multiplyByScalar(q,.5,q),f.push(q.x,q.y))),s.push(v,a,D),s.push(a,S,D)):G===z&&(W=`${Math.min(S,D)} ${Math.max(S,D)}`,a=m[W],c(a)||(U=h.add(M,I,ep),h.multiplyByScalar(U,.5,U),u.push(U.x,U.y,U.z),a=u.length/3-1,m[W]=a,r&&(q=H.add(_,N,fT),H.multiplyByScalar(q,.5,q),f.push(q.x,q.y))),s.push(S,a,v),s.push(a,D,v)):(g.push(D),g.push(v),g.push(S))}let C={attributes:{position:new we({componentDatatype:$.DOUBLE,componentsPerAttribute:3,values:u})},indices:g,primitiveType:Me.TRIANGLES};return r&&(C.attributes.st=new we({componentDatatype:$.FLOAT,componentsPerAttribute:2,values:f})),new ut(C)};var fBe=new he,dBe=new he,hBe=new he,zz=new he;q_.computeRhumbLineSubdivision=function(e,t,n,i,o){o=y(o,R.RADIANS_PER_DEGREE);let r=c(i);A.typeOf.object("ellipsoid",e),A.defined("positions",t),A.defined("indices",n),A.typeOf.number.greaterThanOrEquals("indices.length",n.length,3),A.typeOf.number.equals("indices.length % 3","0",n.length%3,0),A.typeOf.number.greaterThan("granularity",o,0);let s=n.slice(0),a,l=t.length,u=new Array(l*3),f=new Array(l*2),d=0,p=0;for(a=0;a<l;a++){let D=t[a];if(u[d++]=D.x,u[d++]=D.y,u[d++]=D.z,r){let I=i[a];f[p++]=I.x,f[p++]=I.y}}let g=[],m={},b=e.maximumRadius,x=R.chordLength(o,b),T=new mc(void 0,void 0,e),C=new mc(void 0,void 0,e),S=new mc(void 0,void 0,e);for(;s.length>0;){let D=s.pop(),I=s.pop(),L=s.pop(),M=h.fromArray(u,L*3,Sie),N=h.fromArray(u,I*3,wie),B=h.fromArray(u,D*3,vie),_,w,P;r&&(_=H.fromArray(f,L*2,Die),w=H.fromArray(f,I*2,Pie),P=H.fromArray(f,D*2,Iie));let O=e.cartesianToCartographic(M,fBe),F=e.cartesianToCartographic(N,dBe),V=e.cartesianToCartographic(B,hBe);T.setEndPoints(O,F);let G=T.surfaceDistance;C.setEndPoints(F,V);let z=C.surfaceDistance;S.setEndPoints(V,O);let W=S.surfaceDistance,U=Math.max(G,z,W),q,K,te,Y,Z;U>x?G===U?(q=`${Math.min(L,I)} ${Math.max(L,I)}`,a=m[q],c(a)||(K=T.interpolateUsingFraction(.5,zz),te=(O.height+F.height)*.5,Y=h.fromRadians(K.longitude,K.latitude,te,e,ep),u.push(Y.x,Y.y,Y.z),a=u.length/3-1,m[q]=a,r&&(Z=H.add(_,w,fT),H.multiplyByScalar(Z,.5,Z),f.push(Z.x,Z.y))),s.push(L,a,D),s.push(a,I,D)):z===U?(q=`${Math.min(I,D)} ${Math.max(I,D)}`,a=m[q],c(a)||(K=C.interpolateUsingFraction(.5,zz),te=(F.height+V.height)*.5,Y=h.fromRadians(K.longitude,K.latitude,te,e,ep),u.push(Y.x,Y.y,Y.z),a=u.length/3-1,m[q]=a,r&&(Z=H.add(w,P,fT),H.multiplyByScalar(Z,.5,Z),f.push(Z.x,Z.y))),s.push(I,a,L),s.push(a,D,L)):W===U&&(q=`${Math.min(D,L)} ${Math.max(D,L)}`,a=m[q],c(a)||(K=S.interpolateUsingFraction(.5,zz),te=(V.height+O.height)*.5,Y=h.fromRadians(K.longitude,K.latitude,te,e,ep),u.push(Y.x,Y.y,Y.z),a=u.length/3-1,m[q]=a,r&&(Z=H.add(P,_,fT),H.multiplyByScalar(Z,.5,Z),f.push(Z.x,Z.y))),s.push(D,a,I),s.push(a,L,I)):(g.push(L),g.push(I),g.push(D))}let v={attributes:{position:new we({componentDatatype:$.DOUBLE,componentsPerAttribute:3,values:u})},indices:g,primitiveType:Me.TRIANGLES};return r&&(v.attributes.st=new we({componentDatatype:$.FLOAT,componentsPerAttribute:2,values:f})),new ut(v)};q_.scaleToGeodeticHeight=function(e,t,n,i){n=y(n,ie.default);let o=lBe,r=uBe;if(t=y(t,0),i=y(i,!0),c(e)){let s=e.length;for(let a=0;a<s;a+=3)h.fromArray(e,a,r),i&&(r=n.scaleToGeodeticSurface(r,r)),t!==0&&(o=n.geodeticSurfaceNormal(r,o),h.multiplyByScalar(o,t,o),h.add(r,o,r)),e[a]=r.x,e[a+1]=r.y,e[a+2]=r.z}return e};var ai=q_;function Y_(){this._array=[],this._offset=0,this._length=0}Object.defineProperties(Y_.prototype,{length:{get:function(){return this._length}}});Y_.prototype.enqueue=function(e){this._array.push(e),this._length++};Y_.prototype.dequeue=function(){if(this._length===0)return;let e=this._array,t=this._offset,n=e[t];return e[t]=void 0,t++,t>10&&t*2>e.length&&(this._array=e.slice(t),t=0),this._offset=t,this._length--,n};Y_.prototype.peek=function(){if(this._length!==0)return this._array[this._offset]};Y_.prototype.contains=function(e){return this._array.indexOf(e)!==-1};Y_.prototype.clear=function(){this._array.length=this._offset=this._length=0};Y_.prototype.sort=function(e){this._offset>0&&(this._array=this._array.slice(this._offset),this._offset=0),this._array.sort(e)};var dT=Y_;var Go={};Go.computeHierarchyPackedLength=function(e,t){let n=0,i=[e];for(;i.length>0;){let o=i.pop();if(!c(o))continue;n+=2;let r=o.positions,s=o.holes;if(c(r)&&r.length>0&&(n+=r.length*t.packedLength),c(s)){let a=s.length;for(let l=0;l<a;++l)i.push(s[l])}}return n};Go.packPolygonHierarchy=function(e,t,n,i){let o=[e];for(;o.length>0;){let r=o.pop();if(!c(r))continue;let s=r.positions,a=r.holes;if(t[n++]=c(s)?s.length:0,t[n++]=c(a)?a.length:0,c(s)){let l=s.length;for(let u=0;u<l;++u,n+=i.packedLength)i.pack(s[u],t,n)}if(c(a)){let l=a.length;for(let u=0;u<l;++u)o.push(a[u])}}return n};Go.unpackPolygonHierarchy=function(e,t,n){let i=e[t++],o=e[t++],r=new Array(i),s=o>0?new Array(o):void 0;for(let a=0;a<i;++a,t+=n.packedLength)r[a]=n.unpack(e,t);for(let a=0;a<o;++a)s[a]=Go.unpackPolygonHierarchy(e,t,n),t=s[a].startingIndex,delete s[a].startingIndex;return{positions:r,holes:s,startingIndex:t}};var y0=new H;function Mie(e,t,n,i){return H.subtract(t,e,y0),H.multiplyByScalar(y0,n/i,y0),H.add(e,y0,y0),[y0.x,y0.y]}var X_=new h;function mBe(e,t,n,i){return h.subtract(t,e,X_),h.multiplyByScalar(X_,n/i,X_),h.add(e,X_,X_),[X_.x,X_.y,X_.z]}Go.subdivideLineCount=function(e,t,n){let o=h.distance(e,t)/n,r=Math.max(0,Math.ceil(R.log2(o)));return Math.pow(2,r)};var YO=new he,XO=new he,pBe=new he,_Be=new h,qO=new mc;Go.subdivideRhumbLineCount=function(e,t,n,i){let o=e.cartesianToCartographic(t,YO),r=e.cartesianToCartographic(n,XO),a=new mc(o,r,e).surfaceDistance/i,l=Math.max(0,Math.ceil(R.log2(a)));return Math.pow(2,l)};Go.subdivideTexcoordLine=function(e,t,n,i,o,r){let s=Go.subdivideLineCount(n,i,o),a=H.distance(e,t),l=a/s,u=r;u.length=s*2;let f=0;for(let d=0;d<s;d++){let p=Mie(e,t,d*l,a);u[f++]=p[0],u[f++]=p[1]}return u};Go.subdivideLine=function(e,t,n,i){let o=Go.subdivideLineCount(e,t,n),r=h.distance(e,t),s=r/o;c(i)||(i=[]);let a=i;a.length=o*3;let l=0;for(let u=0;u<o;u++){let f=mBe(e,t,u*s,r);a[l++]=f[0],a[l++]=f[1],a[l++]=f[2]}return a};Go.subdivideTexcoordRhumbLine=function(e,t,n,i,o,r,s){let a=n.cartesianToCartographic(i,YO),l=n.cartesianToCartographic(o,XO);qO.setEndPoints(a,l);let u=qO.surfaceDistance/r,f=Math.max(0,Math.ceil(R.log2(u))),d=Math.pow(2,f),p=H.distance(e,t),g=p/d,m=s;m.length=d*2;let b=0;for(let x=0;x<d;x++){let T=Mie(e,t,x*g,p);m[b++]=T[0],m[b++]=T[1]}return m};Go.subdivideRhumbLine=function(e,t,n,i,o){let r=e.cartesianToCartographic(t,YO),s=e.cartesianToCartographic(n,XO),a=new mc(r,s,e),l=a.surfaceDistance/i,u=Math.max(0,Math.ceil(R.log2(l))),f=Math.pow(2,u),d=a.surfaceDistance/f;c(o)||(o=[]);let p=o;p.length=f*3;let g=0;for(let m=0;m<f;m++){let b=a.interpolateUsingSurfaceDistance(m*d,pBe),x=e.cartographicToCartesian(b,_Be);p[g++]=x.x,p[g++]=x.y,p[g++]=x.z}return p};var gBe=new h,yBe=new h,bBe=new h,xBe=new h;Go.scaleToGeodeticHeightExtruded=function(e,t,n,i,o){i=y(i,ie.default);let r=gBe,s=yBe,a=bBe,l=xBe;if(c(e)&&c(e.attributes)&&c(e.attributes.position)){let u=e.attributes.position.values,f=u.length/2;for(let d=0;d<f;d+=3)h.fromArray(u,d,a),i.geodeticSurfaceNormal(a,r),l=i.scaleToGeodeticSurface(a,l),s=h.multiplyByScalar(r,n,s),s=h.add(l,s,s),u[d+f]=s.x,u[d+1+f]=s.y,u[d+2+f]=s.z,o&&(l=h.clone(a,l)),s=h.multiplyByScalar(r,t,s),s=h.add(l,s,s),u[d]=s.x,u[d+1]=s.y,u[d+2]=s.z}return e};Go.polygonOutlinesFromHierarchy=function(e,t,n){let i=[],o=new dT;o.enqueue(e);let r,s,a;for(;o.length!==0;){let l=o.dequeue(),u=l.positions;if(t)for(a=u.length,r=0;r<a;r++)n.scaleToGeodeticSurface(u[r],u[r]);if(u=Ao(u,h.equalsEpsilon,!0),u.length<3)continue;let f=l.holes?l.holes.length:0;for(r=0;r<f;r++){let d=l.holes[r],p=d.positions;if(t)for(a=p.length,s=0;s<a;++s)n.scaleToGeodeticSurface(p[s],p[s]);if(p=Ao(p,h.equalsEpsilon,!0),p.length<3)continue;i.push(p);let g=0;for(c(d.holes)&&(g=d.holes.length),s=0;s<g;s++)o.enqueue(d.holes[s])}i.push(u)}return i};var TBe=new he;function ABe(e,t,n){let i=n.cartesianToCartographic(e,YO),o=n.cartesianToCartographic(t,XO);if(Math.sign(i.latitude)===Math.sign(o.latitude))return;qO.setEndPoints(i,o);let r=qO.findIntersectionWithLatitude(0,TBe);if(!c(r))return;let s=Math.min(i.longitude,o.longitude),a=Math.max(i.longitude,o.longitude);if(Math.abs(a-s)>R.PI){let l=s;s=a,a=l}if(!(r.longitude<s||r.longitude>a))return n.cartographicToCartesian(r)}function CBe(e,t,n,i){if(i===Yt.RHUMB)return ABe(e,t,n);let o=Qn.lineSegmentPlane(e,t,un.ORIGIN_XY_PLANE);if(c(o))return n.scaleToGeodeticSurface(o,o)}var EBe=new he;function SBe(e,t,n){let i=[],o,r,s,a,l,u=0;for(;u<e.length;){o=e[u],r=e[(u+1)%e.length],s=R.sign(o.z),a=R.sign(r.z);let f=d=>t.cartesianToCartographic(d,EBe).longitude;if(s===0)i.push({position:u,type:s,visited:!1,next:a,theta:f(o)});else if(a!==0){if(l=CBe(o,r,t,n),++u,!c(l))continue;e.splice(u,0,l),i.push({position:u,type:s,visited:!1,next:a,theta:f(l)})}++u}return i}function Lie(e,t,n,i,o,r,s){let a=[],l=r,u=d=>p=>p.position===d,f=[];do{let d=n[l];a.push(d);let p=i.findIndex(u(l)),g=i[p];if(!c(g)){++l;continue}let{visited:m,type:b,next:x}=g;if(g.visited=!0,b===0){if(x===0){let v=i[p-(s?1:-1)];if(v?.position===l+1)v.visited=!0;else{++l;continue}}if(!m&&s&&x>0||r===l&&!s&&x<0){++l;continue}}if(!(s?b>=0:b<=0)){++l;continue}m||f.push(l);let C=p+(s?1:-1),S=i[C];if(!c(S)){++l;continue}l=S.position}while(l<n.length&&l>=0&&l!==r&&a.length<n.length);e.splice(t,o,a);for(let d of f)t=Lie(e,++t,n,i,0,d,!s);return t}Go.splitPolygonsOnEquator=function(e,t,n,i){c(i)||(i=[]),i.splice(0,0,...e),i.length=e.length;let o=0;for(;o<i.length;){let r=i[o],s=r.slice();if(r.length<3){i[o]=s,++o;continue}let a=SBe(s,t,n);if(s.length===r.length||a.length<=1){i[o]=s,++o;continue}a.sort((u,f)=>u.theta-f.theta);let l=s[0].z>=0;o=Lie(i,o,s,a,1,0,l)}return i};Go.polygonsFromHierarchy=function(e,t,n,i,o,r){let s=[],a=[],l=new dT;l.enqueue(e);let u=c(r);for(;l.length!==0;){let f=l.dequeue(),d=f.positions,p=f.holes,g,m;if(i)for(m=d.length,g=0;g<m;g++)o.scaleToGeodeticSurface(d[g],d[g]);if(t||(d=Ao(d,h.equalsEpsilon,!0)),d.length<3)continue;let b=n(d);if(!c(b))continue;let x=[],T=ai.computeWindingOrder2D(b);if(T===ls.CLOCKWISE&&(b.reverse(),d=d.slice().reverse()),u){u=!1;let I=[d];if(I=r(I,I),I.length>1){for(let L of I)l.enqueue(new _c(L,p));continue}}let C=d.slice(),S=c(p)?p.length:0,v=[],D;for(g=0;g<S;g++){let I=p[g],L=I.positions;if(i)for(m=L.length,D=0;D<m;++D)o.scaleToGeodeticSurface(L[D],L[D]);if(t||(L=Ao(L,h.equalsEpsilon,!0)),L.length<3)continue;let M=n(L);if(!c(M))continue;T=ai.computeWindingOrder2D(M),T===ls.CLOCKWISE&&(M.reverse(),L=L.slice().reverse()),v.push(L),x.push(C.length),C=C.concat(L),b=b.concat(M);let N=0;for(c(I.holes)&&(N=I.holes.length),D=0;D<N;D++)l.enqueue(I.holes[D])}s.push({outerRing:d,holes:v}),a.push({positions:C,positions2D:b,holes:x})}return{hierarchy:s,polygons:a}};var wBe=new H,vBe=new h,DBe=new Ne,PBe=new Q;Go.computeBoundingRectangle=function(e,t,n,i,o){let r=Ne.fromAxisAngle(e,i,DBe),s=Q.fromQuaternion(r,PBe),a=Number.POSITIVE_INFINITY,l=Number.NEGATIVE_INFINITY,u=Number.POSITIVE_INFINITY,f=Number.NEGATIVE_INFINITY,d=n.length;for(let p=0;p<d;++p){let g=h.clone(n[p],vBe);Q.multiplyByVector(s,g,g);let m=t(g,wBe);c(m)&&(a=Math.min(a,m.x),l=Math.max(l,m.x),u=Math.min(u,m.y),f=Math.max(f,m.y))}return o.x=a,o.y=u,o.width=l-a,o.height=f-u,o};Go.createGeometryFromPositions=function(e,t,n,i,o,r,s){let a=ai.triangulate(t.positions2D,t.holes);a.length<3&&(a=[0,1,2]);let l=t.positions,u=c(n),f=u?n.positions:void 0;if(o){let d=l.length,p=new Array(d*3),g=0;for(let x=0;x<d;x++){let T=l[x];p[g++]=T.x,p[g++]=T.y,p[g++]=T.z}let m={attributes:{position:new we({componentDatatype:$.DOUBLE,componentsPerAttribute:3,values:p})},indices:a,primitiveType:Me.TRIANGLES};u&&(m.attributes.st=new we({componentDatatype:$.FLOAT,componentsPerAttribute:2,values:H.packArray(f)}));let b=new ut(m);return r.normal?Fn.computeNormal(b):b}if(s===Yt.GEODESIC)return ai.computeSubdivision(e,l,a,f,i);if(s===Yt.RHUMB)return ai.computeRhumbLineSubdivision(e,l,a,f,i)};var Oie=[],Rie=[],IBe=new h,OBe=new h;Go.computeWallGeometry=function(e,t,n,i,o,r){let s,a,l,u,f,d,p,g,m,b=e.length,x=0,T=0,C=c(t),S=C?t.positions:void 0;if(o)for(a=b*3*2,s=new Array(a*2),C&&(m=b*2*2,g=new Array(m*2)),l=0;l<b;l++)u=e[l],f=e[(l+1)%b],s[x]=s[x+a]=u.x,++x,s[x]=s[x+a]=u.y,++x,s[x]=s[x+a]=u.z,++x,s[x]=s[x+a]=f.x,++x,s[x]=s[x+a]=f.y,++x,s[x]=s[x+a]=f.z,++x,C&&(d=S[l],p=S[(l+1)%b],g[T]=g[T+m]=d.x,++T,g[T]=g[T+m]=d.y,++T,g[T]=g[T+m]=p.x,++T,g[T]=g[T+m]=p.y,++T);else{let M=R.chordLength(i,n.maximumRadius),N=0;if(r===Yt.GEODESIC)for(l=0;l<b;l++)N+=Go.subdivideLineCount(e[l],e[(l+1)%b],M);else if(r===Yt.RHUMB)for(l=0;l<b;l++)N+=Go.subdivideRhumbLineCount(n,e[l],e[(l+1)%b],M);for(a=(N+b)*3,s=new Array(a*2),C&&(m=(N+b)*2,g=new Array(m*2)),l=0;l<b;l++){u=e[l],f=e[(l+1)%b];let B,_;C&&(d=S[l],p=S[(l+1)%b]),r===Yt.GEODESIC?(B=Go.subdivideLine(u,f,M,Rie),C&&(_=Go.subdivideTexcoordLine(d,p,u,f,M,Oie))):r===Yt.RHUMB&&(B=Go.subdivideRhumbLine(n,u,f,M,Rie),C&&(_=Go.subdivideTexcoordRhumbLine(d,p,n,u,f,M,Oie)));let w=B.length;for(let P=0;P<w;++P,++x)s[x]=B[P],s[x+a]=B[P];if(s[x]=f.x,s[x+a]=f.x,++x,s[x]=f.y,s[x+a]=f.y,++x,s[x]=f.z,s[x+a]=f.z,++x,C){let P=_.length;for(let O=0;O<P;++O,++T)g[T]=_[O],g[T+m]=_[O];g[T]=p.x,g[T+m]=p.x,++T,g[T]=p.y,g[T+m]=p.y,++T}}}b=s.length;let v=Fe.createTypedArray(b/3,b-e.length*6),D=0;for(b/=6,l=0;l<b;l++){let M=l,N=M+1,B=M+b,_=B+1;u=h.fromArray(s,M*3,IBe),f=h.fromArray(s,N*3,OBe),!h.equalsEpsilon(u,f,R.EPSILON10,R.EPSILON10)&&(v[D++]=M,v[D++]=B,v[D++]=N,v[D++]=N,v[D++]=B,v[D++]=_)}let I={attributes:new pn({position:new we({componentDatatype:$.DOUBLE,componentsPerAttribute:3,values:s})}),indices:v,primitiveType:Me.TRIANGLES};return C&&(I.attributes.st=new we({componentDatatype:$.FLOAT,componentsPerAttribute:2,values:g})),new ut(I)};var zn=Go;function Or(e,t){this.position=e,c(this.position)||(this.position=new H),this.tangentPlane=t,c(this.tangentPlane)||(this.tangentPlane=Or.NORTH_POLE_TANGENT_PLANE)}Object.defineProperties(Or.prototype,{ellipsoid:{get:function(){return this.tangentPlane.ellipsoid}},x:{get:function(){return this.position.x}},y:{get:function(){return this.position.y}},conformalLatitude:{get:function(){let e=H.magnitude(this.position),t=2*this.ellipsoid.maximumRadius;return this.tangentPlane.plane.normal.z*(R.PI_OVER_TWO-2*Math.atan2(e,t))}},longitude:{get:function(){let e=R.PI_OVER_TWO+Math.atan2(this.y,this.x);return e>Math.PI&&(e-=R.TWO_PI),e}}});var hT=new he,RBe=new h;Or.prototype.getLatitude=function(e){c(e)||(e=ie.default),hT.latitude=this.conformalLatitude,hT.longitude=this.longitude,hT.height=0;let t=this.ellipsoid.cartographicToCartesian(hT,RBe);return e.cartesianToCartographic(t,hT),hT.latitude};var MBe=new _n,LBe=new h,NBe=new h;Or.fromCartesian=function(e,t){A.defined("cartesian",e);let n=R.signNotZero(e.z),i=Or.NORTH_POLE_TANGENT_PLANE,o=Or.SOUTH_POLE;n<0&&(i=Or.SOUTH_POLE_TANGENT_PLANE,o=Or.NORTH_POLE);let r=MBe;r.origin=i.ellipsoid.scaleToGeocentricSurface(e,r.origin),r.direction=h.subtract(r.origin,o,LBe),h.normalize(r.direction,r.direction);let s=Qn.rayPlane(r,i.plane,NBe),a=h.subtract(s,o,s),l=h.dot(i.xAxis,a),u=n*h.dot(i.yAxis,a);return c(t)?(t.position=new H(l,u),t.tangentPlane=i,t):new Or(new H(l,u),i)};Or.fromCartesianArray=function(e,t){A.defined("cartesians",e);let n=e.length;c(t)?t.length=n:t=new Array(n);for(let i=0;i<n;i++)t[i]=Or.fromCartesian(e[i],t[i]);return t};Or.clone=function(e,t){if(c(e))return c(t)?(t.position=e.position,t.tangentPlane=e.tangentPlane,t):new Or(e.position,e.tangentPlane)};Or.HALF_UNIT_SPHERE=Object.freeze(new ie(.5,.5,.5));Or.NORTH_POLE=Object.freeze(new h(0,0,.5));Or.SOUTH_POLE=Object.freeze(new h(0,0,-.5));Or.NORTH_POLE_TANGENT_PLANE=Object.freeze(new cs(Or.NORTH_POLE,Or.HALF_UNIT_SPHERE));Or.SOUTH_POLE_TANGENT_PLANE=Object.freeze(new cs(Or.SOUTH_POLE,Or.HALF_UNIT_SPHERE));var il=Or;var FBe=new he,Nie=new he;function BBe(e,t,n,i){let r=i.cartesianToCartographic(e,FBe).height,s=i.cartesianToCartographic(t,Nie);s.height=r,i.cartographicToCartesian(s,t);let a=i.cartesianToCartographic(n,Nie);a.height=r-100,i.cartographicToCartesian(a,n)}var Fie=new Ke,kBe=new h,VBe=new h,UBe=new h,zBe=new h,HBe=new h,GBe=new h,KO=new h,yh=new h,mT=new h,jBe=new H,WBe=new H,qBe=new h,Bie=new Ne,YBe=new Q,XBe=new Q;function Hz(e){let t=e.vertexFormat,n=e.geometry,i=e.shadowVolume,o=n.attributes.position.values,r=c(n.attributes.st)?n.attributes.st.values:void 0,s=o.length,a=e.wall,l=e.top||a,u=e.bottom||a;if(t.st||t.normal||t.tangent||t.bitangent||i){let f=e.boundingRectangle,d=e.rotationAxis,p=e.projectTo2d,g=e.ellipsoid,m=e.stRotation,b=e.perPositionHeight,x=jBe;x.x=f.x,x.y=f.y;let T=t.st?new Float32Array(2*(s/3)):void 0,C;t.normal&&(b&&l&&!a?C=n.attributes.normal.values:C=new Float32Array(s));let S=t.tangent?new Float32Array(s):void 0,v=t.bitangent?new Float32Array(s):void 0,D=i?new Float32Array(s):void 0,I=0,L=0,M=VBe,N=UBe,B=zBe,_=!0,w=YBe,P=XBe;if(m!==0){let V=Ne.fromAxisAngle(d,m,Bie);w=Q.fromQuaternion(V,w),V=Ne.fromAxisAngle(d,-m,Bie),P=Q.fromQuaternion(V,P)}else w=Q.clone(Q.IDENTITY,w),P=Q.clone(Q.IDENTITY,P);let O=0,F=0;l&&u&&(O=s/2,F=s/3,s/=2);for(let V=0;V<s;V+=3){let G=h.fromArray(o,V,qBe);if(t.st&&!c(r)){let z=Q.multiplyByVector(w,G,kBe);z=g.scaleToGeodeticSurface(z,z);let W=p([z],WBe)[0];H.subtract(W,x,W);let U=R.clamp(W.x/f.width,0,1),q=R.clamp(W.y/f.height,0,1);u&&(T[I+F]=U,T[I+1+F]=q),l&&(T[I]=U,T[I+1]=q),I+=2}if(t.normal||t.tangent||t.bitangent||i){let z=L+1,W=L+2;if(a){if(V+3<s){let U=h.fromArray(o,V+3,HBe);if(_){let q=h.fromArray(o,V+s,GBe);b&&BBe(G,U,q,g),h.subtract(U,G,U),h.subtract(q,G,q),M=h.normalize(h.cross(q,U,M),M),_=!1}h.equalsEpsilon(U,G,R.EPSILON10)&&(_=!0)}(t.tangent||t.bitangent)&&(B=g.geodeticSurfaceNormal(G,B),t.tangent&&(N=h.normalize(h.cross(B,M,N),N)))}else M=g.geodeticSurfaceNormal(G,M),(t.tangent||t.bitangent)&&(b&&(KO=h.fromArray(C,L,KO),yh=h.cross(h.UNIT_Z,KO,yh),yh=h.normalize(Q.multiplyByVector(P,yh,yh),yh),t.bitangent&&(mT=h.normalize(h.cross(KO,yh,mT),mT))),N=h.cross(h.UNIT_Z,M,N),N=h.normalize(Q.multiplyByVector(P,N,N),N),t.bitangent&&(B=h.normalize(h.cross(M,N,B),B)));t.normal&&(e.wall?(C[L+O]=M.x,C[z+O]=M.y,C[W+O]=M.z):u&&(C[L+O]=-M.x,C[z+O]=-M.y,C[W+O]=-M.z),(l&&!b||a)&&(C[L]=M.x,C[z]=M.y,C[W]=M.z)),i&&(a&&(M=g.geodeticSurfaceNormal(G,M)),D[L+O]=-M.x,D[z+O]=-M.y,D[W+O]=-M.z),t.tangent&&(e.wall?(S[L+O]=N.x,S[z+O]=N.y,S[W+O]=N.z):u&&(S[L+O]=-N.x,S[z+O]=-N.y,S[W+O]=-N.z),l&&(b?(S[L]=yh.x,S[z]=yh.y,S[W]=yh.z):(S[L]=N.x,S[z]=N.y,S[W]=N.z))),t.bitangent&&(u&&(v[L+O]=B.x,v[z+O]=B.y,v[W+O]=B.z),l&&(b?(v[L]=mT.x,v[z]=mT.y,v[W]=mT.z):(v[L]=B.x,v[z]=B.y,v[W]=B.z))),L+=3}}t.st&&!c(r)&&(n.attributes.st=new we({componentDatatype:$.FLOAT,componentsPerAttribute:2,values:T})),t.normal&&(n.attributes.normal=new we({componentDatatype:$.FLOAT,componentsPerAttribute:3,values:C})),t.tangent&&(n.attributes.tangent=new we({componentDatatype:$.FLOAT,componentsPerAttribute:3,values:S})),t.bitangent&&(n.attributes.bitangent=new we({componentDatatype:$.FLOAT,componentsPerAttribute:3,values:v})),i&&(n.attributes.extrudeDirection=new we({componentDatatype:$.FLOAT,componentsPerAttribute:3,values:D}))}if(e.extrude&&c(e.offsetAttribute)){let f=o.length/3,d=new Uint8Array(f);if(e.offsetAttribute===Jt.TOP)l&&u||a?d=d.fill(1,0,f/2):l&&(d=d.fill(1));else{let p=e.offsetAttribute===Jt.NONE?0:1;d=d.fill(p)}n.attributes.applyOffset=new we({componentDatatype:$.UNSIGNED_BYTE,componentsPerAttribute:1,values:d})}return n}var kie=[];function KBe(e,t,n,i,o,r,s,a,l,u){let f={walls:[]},d;if(s||a){let C=zn.createGeometryFromPositions(e,t,n,i,r,l,u),S=C.attributes.position.values,v=C.indices,D,I;if(s&&a){let L=S.concat(S);D=L.length/3,I=Fe.createTypedArray(D,v.length*2),I.set(v);let M=v.length,N=D/2;for(d=0;d<M;d+=3){let B=I[d]+N,_=I[d+1]+N,w=I[d+2]+N;I[d+M]=w,I[d+1+M]=_,I[d+2+M]=B}if(C.attributes.position.values=L,r&&l.normal){let B=C.attributes.normal.values;C.attributes.normal.values=new Float32Array(L.length),C.attributes.normal.values.set(B)}if(l.st&&c(n)){let B=C.attributes.st.values;C.attributes.st.values=new Float32Array(D*2),C.attributes.st.values=B.concat(B)}C.indices=I}else if(a){for(D=S.length/3,I=Fe.createTypedArray(D,v.length),d=0;d<v.length;d+=3)I[d]=v[d+2],I[d+1]=v[d+1],I[d+2]=v[d];C.indices=I}f.topAndBottom=new vt({geometry:C})}let p=o.outerRing,g=cs.fromPoints(p,e),m=g.projectPointsOntoPlane(p,kie),b=ai.computeWindingOrder2D(m);b===ls.CLOCKWISE&&(p=p.slice().reverse());let x=zn.computeWallGeometry(p,n,e,i,r,u);f.walls.push(new vt({geometry:x}));let T=o.holes;for(d=0;d<T.length;d++){let C=T[d];m=g.projectPointsOntoPlane(C,kie),b=ai.computeWindingOrder2D(m),b===ls.COUNTER_CLOCKWISE&&(C=C.slice().reverse()),x=zn.computeWallGeometry(C,n,e,i,r,u),f.walls.push(new vt({geometry:x}))}return f}function Ju(e){if(A.typeOf.object("options",e),A.typeOf.object("options.polygonHierarchy",e.polygonHierarchy),c(e.perPositionHeight)&&e.perPositionHeight&&c(e.height))throw new E("Cannot use both options.perPositionHeight and options.height");if(c(e.arcType)&&e.arcType!==Yt.GEODESIC&&e.arcType!==Yt.RHUMB)throw new E("Invalid arcType. Valid options are ArcType.GEODESIC and ArcType.RHUMB.");let t=e.polygonHierarchy,n=y(e.vertexFormat,Ie.DEFAULT),i=y(e.ellipsoid,ie.default),o=y(e.granularity,R.RADIANS_PER_DEGREE),r=y(e.stRotation,0),s=e.textureCoordinates,a=y(e.perPositionHeight,!1),l=a&&c(e.extrudedHeight),u=y(e.height,0),f=y(e.extrudedHeight,u);if(!l){let d=Math.max(u,f);f=Math.min(u,f),u=d}this._vertexFormat=Ie.clone(n),this._ellipsoid=ie.clone(i),this._granularity=o,this._stRotation=r,this._height=u,this._extrudedHeight=f,this._closeTop=y(e.closeTop,!0),this._closeBottom=y(e.closeBottom,!0),this._polygonHierarchy=t,this._perPositionHeight=a,this._perPositionHeightExtrude=l,this._shadowVolume=y(e.shadowVolume,!1),this._workerName="createPolygonGeometry",this._offsetAttribute=e.offsetAttribute,this._arcType=y(e.arcType,Yt.GEODESIC),this._rectangle=void 0,this._textureCoordinateRotationPoints=void 0,this._textureCoordinates=s,this.packedLength=zn.computeHierarchyPackedLength(t,h)+ie.packedLength+Ie.packedLength+(s?zn.computeHierarchyPackedLength(s,H):1)+12}Ju.fromPositions=function(e){e=y(e,y.EMPTY_OBJECT),A.defined("options.positions",e.positions);let t={polygonHierarchy:{positions:e.positions},height:e.height,extrudedHeight:e.extrudedHeight,vertexFormat:e.vertexFormat,stRotation:e.stRotation,ellipsoid:e.ellipsoid,granularity:e.granularity,perPositionHeight:e.perPositionHeight,closeTop:e.closeTop,closeBottom:e.closeBottom,offsetAttribute:e.offsetAttribute,arcType:e.arcType,textureCoordinates:e.textureCoordinates};return new Ju(t)};Ju.pack=function(e,t,n){return A.typeOf.object("value",e),A.defined("array",t),n=y(n,0),n=zn.packPolygonHierarchy(e._polygonHierarchy,t,n,h),ie.pack(e._ellipsoid,t,n),n+=ie.packedLength,Ie.pack(e._vertexFormat,t,n),n+=Ie.packedLength,t[n++]=e._height,t[n++]=e._extrudedHeight,t[n++]=e._granularity,t[n++]=e._stRotation,t[n++]=e._perPositionHeightExtrude?1:0,t[n++]=e._perPositionHeight?1:0,t[n++]=e._closeTop?1:0,t[n++]=e._closeBottom?1:0,t[n++]=e._shadowVolume?1:0,t[n++]=y(e._offsetAttribute,-1),t[n++]=e._arcType,c(e._textureCoordinates)?n=zn.packPolygonHierarchy(e._textureCoordinates,t,n,H):t[n++]=-1,t[n++]=e.packedLength,t};var $Be=ie.clone(ie.UNIT_SPHERE),ZBe=new Ie,JBe={polygonHierarchy:{}};Ju.unpack=function(e,t,n){A.defined("array",e),t=y(t,0);let i=zn.unpackPolygonHierarchy(e,t,h);t=i.startingIndex,delete i.startingIndex;let o=ie.unpack(e,t,$Be);t+=ie.packedLength;let r=Ie.unpack(e,t,ZBe);t+=Ie.packedLength;let s=e[t++],a=e[t++],l=e[t++],u=e[t++],f=e[t++]===1,d=e[t++]===1,p=e[t++]===1,g=e[t++]===1,m=e[t++]===1,b=e[t++],x=e[t++],T=e[t]===-1?void 0:zn.unpackPolygonHierarchy(e,t,H);c(T)?(t=T.startingIndex,delete T.startingIndex):t++;let C=e[t++];return c(n)||(n=new Ju(JBe)),n._polygonHierarchy=i,n._ellipsoid=ie.clone(o,n._ellipsoid),n._vertexFormat=Ie.clone(r,n._vertexFormat),n._height=s,n._extrudedHeight=a,n._granularity=l,n._stRotation=u,n._perPositionHeightExtrude=f,n._perPositionHeight=d,n._closeTop=p,n._closeBottom=g,n._shadowVolume=m,n._offsetAttribute=b===-1?void 0:b,n._arcType=x,n._textureCoordinates=T,n.packedLength=C,n};var QBe=new H,e3e=new H,t3e=new il;function Vie(e,t,n,i,o,r){let s=e.longitude,a=s>=0?s:s+R.TWO_PI;o.westOverIdl=Math.min(o.westOverIdl,a),o.eastOverIdl=Math.max(o.eastOverIdl,a),r.west=Math.min(r.west,s),r.east=Math.max(r.east,s);let l=e.getLatitude(n),u=l;if(r.south=Math.min(r.south,l),r.north=Math.max(r.north,l),i!==Yt.RHUMB){let p=H.subtract(t.position,e.position,QBe),g=H.dot(t.position,p)/H.dot(p,p);if(g>0&&g<1){let m=H.add(t.position,H.multiplyByScalar(p,-g,p),e3e),b=il.clone(t,t3e);b.position=m;let x=b.getLatitude(n);r.south=Math.min(r.south,x),r.north=Math.max(r.north,x),Math.abs(l)>Math.abs(x)&&(u=x)}}let f=t.x*e.y-e.x*t.y,d=Math.sign(f);d!==0&&(d*=H.angleBetween(t.position,e.position)),u>=0&&(o.northAngle+=d),u<=0&&(o.southAngle+=d)}var Uie=new il,n3e=new il,Zu={northAngle:0,southAngle:0,westOverIdl:0,eastOverIdl:0};Ju.computeRectangleFromPositions=function(e,t,n,i){if(A.defined("positions",e),c(i)||(i=new ae),e.length<3)return i;i.west=Number.POSITIVE_INFINITY,i.east=Number.NEGATIVE_INFINITY,i.south=Number.POSITIVE_INFINITY,i.north=Number.NEGATIVE_INFINITY,Zu.northAngle=0,Zu.southAngle=0,Zu.westOverIdl=Number.POSITIVE_INFINITY,Zu.eastOverIdl=Number.NEGATIVE_INFINITY;let o=e.length,r=il.fromCartesian(e[0],n3e);for(let s=1;s<o;s++){let a=il.fromCartesian(e[s],Uie);Vie(a,r,t,n,Zu,i),r=il.clone(a,r)}return Vie(il.fromCartesian(e[0],Uie),r,t,n,Zu,i),i.east-i.west>Zu.eastOverIdl-Zu.westOverIdl&&(i.west=Zu.westOverIdl,i.east=Zu.eastOverIdl,i.east>R.PI&&(i.east=i.east-R.TWO_PI),i.west>R.PI&&(i.west=i.west-R.TWO_PI)),R.equalsEpsilon(Math.abs(Zu.northAngle),R.TWO_PI,R.EPSILON10)&&(i.north=R.PI_OVER_TWO,i.east=R.PI,i.west=-R.PI),R.equalsEpsilon(Math.abs(Zu.southAngle),R.TWO_PI,R.EPSILON10)&&(i.south=-R.PI_OVER_TWO,i.east=R.PI,i.west=-R.PI),i};var i3e=new il;function o3e(e,t,n){return e.height>=R.PI||e.width>=R.PI?il.fromCartesian(t[0],i3e).tangentPlane:cs.fromPoints(t,n)}var zie=new he;function r3e(e,t,n){return(i,o)=>{if(e.height>=R.PI||e.width>=R.PI){if(e.south<0&&e.north>0){c(o)||(o=[]);for(let s=0;s<i.length;++s){let a=n.cartesianToCartographic(i[s],zie);o[s]=new H(a.longitude/R.PI,a.latitude/R.PI_OVER_TWO)}return o.length=i.length,o}return il.fromCartesianArray(i,o)}return cs.fromPoints(t,n).projectPointsOntoPlane(i,o)}}function s3e(e,t,n){if(e.height>=R.PI||e.width>=R.PI)return(o,r)=>{if(e.south<0&&e.north>0){let s=n.cartesianToCartographic(o,zie);return c(r)||(r=new H),r.x=s.longitude/R.PI,r.y=s.latitude/R.PI_OVER_TWO,r}return il.fromCartesian(o,r)};let i=cs.fromPoints(t,n);return(o,r)=>i.projectPointsOntoPlane(o,r)}function a3e(e,t,n,i){return(o,r)=>!i&&(e.height>=R.PI_OVER_TWO||e.width>=2*R.PI_OVER_THREE)?zn.splitPolygonsOnEquator(o,t,n,r):o}function c3e(e,t,n,i){if(t.height>=R.PI||t.width>=R.PI)return Ke.fromRectangle(t,void 0,Fie);let o=e,r=cs.fromPoints(o,n);return zn.computeBoundingRectangle(r.plane.normal,r.projectPointOntoPlane.bind(r),o,i,Fie)}Ju.createGeometry=function(e){let t=e._vertexFormat,n=e._ellipsoid,i=e._granularity,o=e._stRotation,r=e._polygonHierarchy,s=e._perPositionHeight,a=e._closeTop,l=e._closeBottom,u=e._arcType,f=e._textureCoordinates,d=c(f),p=r.positions;if(p.length<3)return;let g=e.rectangle,m=zn.polygonsFromHierarchy(r,d,r3e(g,p,n),!s,n,a3e(g,n,u,s)),b=m.hierarchy,x=m.polygons,T=function(O){return O},C=d?zn.polygonsFromHierarchy(f,!0,T,!1,n).polygons:void 0;if(b.length===0)return;let S=b[0].outerRing,v=c3e(S,g,n,o),D=[],I=e._height,L=e._extrudedHeight,M=e._perPositionHeightExtrude||!R.equalsEpsilon(I,L,0,R.EPSILON2),N={perPositionHeight:s,vertexFormat:t,geometry:void 0,rotationAxis:o3e(g,S,n).plane.normal,projectTo2d:s3e(g,S,n),boundingRectangle:v,ellipsoid:n,stRotation:o,textureCoordinates:void 0,bottom:!1,top:!0,wall:!1,extrude:!1,arcType:u},B;if(M)for(N.extrude=!0,N.top=a,N.bottom=l,N.shadowVolume=e._shadowVolume,N.offsetAttribute=e._offsetAttribute,B=0;B<x.length;B++){let O=KBe(n,x[B],d?C[B]:void 0,i,b[B],s,a,l,t,u),F;a&&l?(F=O.topAndBottom,N.geometry=zn.scaleToGeodeticHeightExtruded(F.geometry,I,L,n,s)):a?(F=O.topAndBottom,F.geometry.attributes.position.values=ai.scaleToGeodeticHeight(F.geometry.attributes.position.values,I,n,!s),N.geometry=F.geometry):l&&(F=O.topAndBottom,F.geometry.attributes.position.values=ai.scaleToGeodeticHeight(F.geometry.attributes.position.values,L,n,!0),N.geometry=F.geometry),(a||l)&&(N.wall=!1,F.geometry=Hz(N),D.push(F));let V=O.walls;N.wall=!0;for(let G=0;G<V.length;G++){let z=V[G];N.geometry=zn.scaleToGeodeticHeightExtruded(z.geometry,I,L,n,s),z.geometry=Hz(N),D.push(z)}}else for(B=0;B<x.length;B++){let O=new vt({geometry:zn.createGeometryFromPositions(n,x[B],d?C[B]:void 0,i,s,t,u)});if(O.geometry.attributes.position.values=ai.scaleToGeodeticHeight(O.geometry.attributes.position.values,I,n,!s),N.geometry=O.geometry,O.geometry=Hz(N),c(e._offsetAttribute)){let F=O.geometry.attributes.position.values.length,V=e._offsetAttribute===Jt.NONE?0:1,G=new Uint8Array(F/3).fill(V);O.geometry.attributes.applyOffset=new we({componentDatatype:$.UNSIGNED_BYTE,componentsPerAttribute:1,values:G})}D.push(O)}let _=Fn.combineInstances(D)[0];_.attributes.position.values=new Float64Array(_.attributes.position.values),_.indices=Fe.createTypedArray(_.attributes.position.values.length/3,_.indices);let w=_.attributes,P=ce.fromVertices(w.position.values);return t.position||delete w.position,new ut({attributes:w,indices:_.indices,primitiveType:_.primitiveType,boundingSphere:P,offsetAttribute:e._offsetAttribute})};Ju.createShadowVolume=function(e,t,n){let i=e._granularity,o=e._ellipsoid,r=t(i,o),s=n(i,o);return new Ju({polygonHierarchy:e._polygonHierarchy,ellipsoid:o,stRotation:e._stRotation,granularity:i,perPositionHeight:!1,extrudedHeight:r,height:s,vertexFormat:Ie.POSITION_ONLY,shadowVolume:!0,arcType:e._arcType})};function l3e(e){let t=-e._stRotation;if(t===0)return[0,0,0,1,1,0];let n=e._ellipsoid,i=e._polygonHierarchy.positions,o=e.rectangle;return ut._textureCoordinateRotationPoints(i,t,n,o)}Object.defineProperties(Ju.prototype,{rectangle:{get:function(){if(!c(this._rectangle)){let e=this._polygonHierarchy.positions;this._rectangle=Ju.computeRectangleFromPositions(e,this._ellipsoid,this._arcType)}return this._rectangle}},textureCoordinateRotationPoints:{get:function(){return c(this._textureCoordinateRotationPoints)||(this._textureCoordinateRotationPoints=l3e(this)),this._textureCoordinateRotationPoints}}});var b0=Ju;function x0(e){A.typeOf.object("options",e),A.typeOf.object("options.positions",e.positions),A.typeOf.number.greaterThanOrEquals("options.positions.length",e.positions.length,3),this._ellipsoid=y(e.ellipsoid,ie.default),this._positions=[...e.positions]}Object.defineProperties(x0.prototype,{length:{get:function(){return this._positions.length}},positions:{get:function(){return this._positions}},ellipsoid:{get:function(){return this._ellipsoid}}});x0.clone=function(e,t){return A.typeOf.object("polygon",e),c(t)?(t._ellipsoid=e.ellipsoid,t._positions.length=0,t._positions.push(...e.positions),t):new x0({positions:e.positions,ellipsoid:e.ellipsoid})};x0.equals=function(e,t){return A.typeOf.object("left",e),A.typeOf.object("right",t),e.ellipsoid.equals(t.ellipsoid)&&e.positions===t.positions};x0.prototype.computeRectangle=function(e){return b0.computeRectangleFromPositions(this.positions,this.ellipsoid,void 0,e)};var u3e=new ae,Hie=new h;x0.prototype.computeSphericalExtents=function(e){c(e)||(e=new ae);let t=this.computeRectangle(u3e),n=he.toCartesian(ae.southwest(t),this.ellipsoid,Hie),i=Math.sqrt(n.x*n.x+n.y*n.y),o=R.fastApproximateAtan2(i,n.z),r=R.fastApproximateAtan2(n.x,n.y);return e.south=o,e.west=r,n=he.toCartesian(ae.northeast(t),this.ellipsoid,Hie),i=Math.sqrt(n.x*n.x+n.y*n.y),o=R.fastApproximateAtan2(i,n.z),r=R.fastApproximateAtan2(n.x,n.y),e.north=o,e.east=r,e};var $O=x0;function Gie(e){e=y(e,y.EMPTY_OBJECT),this.vertexArray=e.vertexArray,this.fragmentShaderSource=e.fragmentShaderSource,this.shaderProgram=e.shaderProgram,this.uniformMap=e.uniformMap,this.outputTexture=e.outputTexture,this.preExecute=e.preExecute,this.postExecute=e.postExecute,this.canceled=e.canceled,this.persists=y(e.persists,!1),this.pass=ve.COMPUTE,this.owner=e.owner}Gie.prototype.execute=function(e){e.execute(this)};var zl=Gie;var Gz=`in vec2 v_textureCoordinates;
uniform int u_polygonsLength;
uniform int u_extentsLength;
uniform highp sampler2D u_polygonTexture;
uniform highp sampler2D u_extentsTexture;
int getPolygonIndex(float dimension, vec2 coord) {
vec2 uv = coord.xy * dimension;
return int(floor(uv.y) * dimension + floor(uv.x));
}
vec2 getLookupUv(ivec2 dimensions, int i) {
int pixY = i / dimensions.x;
int pixX = i - (pixY * dimensions.x);
float pixelWidth = 1.0 / float(dimensions.x);
float pixelHeight = 1.0 / float(dimensions.y);
float u = (float(pixX) + 0.5) * pixelWidth;
float v = (float(pixY) + 0.5) * pixelHeight;
return vec2(u, v);
}
vec4 getExtents(int i) {
return texture(u_extentsTexture, getLookupUv(textureSize(u_extentsTexture, 0), i));
}
ivec2 getPositionsLengthAndExtentsIndex(int i) {
vec2 uv = getLookupUv(textureSize(u_polygonTexture, 0), i);
vec4 value = texture(u_polygonTexture, uv);
return ivec2(int(value.x), int(value.y));
}
vec2 getPolygonPosition(int i) {
vec2 uv = getLookupUv(textureSize(u_polygonTexture, 0), i);
return texture(u_polygonTexture, uv).xy;
}
vec2 getCoordinates(vec2 textureCoordinates, vec4 extents) {
float latitude = mix(extents.x, extents.x + 1.0 / extents.z, textureCoordinates.y);
float longitude = mix(extents.y, extents.y + 1.0 / extents.w, textureCoordinates.x);
return vec2(latitude, longitude);
}
void main() {
int lastPolygonIndex = 0;
out_FragColor = vec4(1.0);
float dimension = float(u_extentsLength);
if (u_extentsLength > 2) {
dimension = ceil(log2(float(u_extentsLength)));
}
int regionIndex = getPolygonIndex(dimension, v_textureCoordinates);
for (int polygonIndex = 0; polygonIndex < u_polygonsLength; polygonIndex++) {
ivec2 positionsLengthAndExtents = getPositionsLengthAndExtentsIndex(lastPolygonIndex);
int positionsLength = positionsLengthAndExtents.x;
int polygonExtentsIndex = positionsLengthAndExtents.y;
lastPolygonIndex += 1;
if (polygonExtentsIndex == regionIndex) {
float clipAmount = czm_infinity;
vec4 extents = getExtents(polygonExtentsIndex);
vec2 textureOffset = vec2(mod(float(polygonExtentsIndex), dimension), floor(float(polygonExtentsIndex) / dimension)) / dimension;
vec2 p = getCoordinates((v_textureCoordinates - textureOffset) * dimension, extents);
float s = 1.0;
for (int i = 0, j = positionsLength - 1; i < positionsLength; j = i, i++) {
vec2 a = getPolygonPosition(lastPolygonIndex + i);
vec2 b = getPolygonPosition(lastPolygonIndex + j);
vec2 ab = b - a;
vec2 pa = p - a;
float t = dot(pa, ab) / dot(ab, ab);
t = clamp(t, 0.0, 1.0);
vec2 pq = pa - t * ab;
float d = length(pq);
bvec3 cond = bvec3(p.y >= a.y,
p.y < b.y,
ab.x * pa.y > ab.y * pa.x);
if (all(cond) || all(not(cond))) s = -s;
if (abs(d) < abs(clipAmount)) {
clipAmount = d;
}
}
vec4 result = (s * vec4(clipAmount * length(extents.zw))) / 2.0 + 0.5;
out_FragColor = min(out_FragColor, result);
}
lastPolygonIndex += positionsLength;
}
}
`;function Gr(e){e=y(e,y.EMPTY_OBJECT),this._polygons=[],this._totalPositions=0,this.enabled=y(e.enabled,!0),this.inverse=y(e.inverse,!1),this.polygonAdded=new pe,this.polygonRemoved=new pe,this._owner=void 0,this._float32View=void 0,this._extentsFloat32View=void 0,this._extentsCount=0,this._polygonsTexture=void 0,this._extentsTexture=void 0,this._signedDistanceTexture=void 0,this._signedDistanceComputeCommand=void 0;let t=e.polygons;if(c(t)){let n=t.length;for(let i=0;i<n;++i)this._polygons.push(t[i])}}Object.defineProperties(Gr.prototype,{length:{get:function(){return this._polygons.length}},totalPositions:{get:function(){return this._totalPositions}},extentsTexture:{get:function(){return this._extentsTexture}},extentsCount:{get:function(){return this._extentsCount}},pixelsNeededForExtents:{get:function(){return this.length}},pixelsNeededForPolygonPositions:{get:function(){return this.totalPositions+this.length}},clippingTexture:{get:function(){return this._signedDistanceTexture}},owner:{get:function(){return this._owner}},clippingPolygonsState:{get:function(){return this.inverse?-this.extentsCount:this.extentsCount}}});Gr.prototype.add=function(e){A.typeOf.object("polygon",e);let t=this._polygons.length;return this._polygons.push(e),this.polygonAdded.raiseEvent(e,t),e};Gr.prototype.get=function(e){return A.typeOf.number("index",e),this._polygons[e]};Gr.prototype.contains=function(e){return A.typeOf.object("polygon",e),this._polygons.some(t=>$O.equals(t,e))};Gr.prototype.remove=function(e){A.typeOf.object("polygon",e);let t=this._polygons,n=t.findIndex(i=>$O.equals(i,e));return n===-1?!1:(t.splice(n,1),this.polygonRemoved.raiseEvent(e,n),!0)};var f3e=new ae;function d3e(e){let t=[],n=[],i=e.length;for(let r=0;r<i;++r){let a=e[r].computeSphericalExtents(),l=Math.max(a.height*2.5,.001),u=Math.max(a.width*2.5,.001),f=ae.clone(a);f.south-=l,f.west-=u,f.north+=l,f.east+=u,f.south=Math.max(f.south,-Math.PI),f.west=Math.max(f.west,-Math.PI),f.north=Math.min(f.north,Math.PI),f.east=Math.min(f.east,Math.PI);let d=[r];for(let p=0;p<t.length;++p){let g=t[p];if(c(g)&&c(ae.simpleIntersection(g,f))&&!ae.equals(g,f)){let m=n[p];d.push(...m),m.reduce((b,x)=>ae.union(e[x].computeSphericalExtents(f3e),b,b),a),t[p]=void 0,n[p]=void 0,l=Math.max(a.height*2.5,.001),u=Math.max(a.width*2.5,.001),f=ae.clone(a,f),f.south-=l,f.west-=u,f.north+=l,f.east+=u,f.south=Math.max(f.south,-Math.PI),f.west=Math.max(f.west,-Math.PI),f.north=Math.min(f.north,Math.PI),f.east=Math.min(f.east,Math.PI),p=-1}}t.push(f),n.push(d)}let o=new Map;return n.filter(c).forEach((r,s)=>r.forEach(a=>o.set(a,s))),{extentsList:t.filter(c),extentsIndexByPolygon:o}}Gr.prototype.removeAll=function(){let e=this._polygons,t=e.length;for(let n=0;n<t;++n){let i=e[n];this.polygonRemoved.raiseEvent(i,n)}this._polygons=[]};function h3e(e){let t=e._float32View,n=e._extentsFloat32View,i=e._polygons,{extentsList:o,extentsIndexByPolygon:r}=d3e(i),s=0;for(let[l,u]of i.entries()){let f=u.length;t[s++]=f,t[s++]=r.get(l);for(let d=0;d<f;++d){let p=u.positions[d],g=Math.hypot(p.x,p.y),m=R.fastApproximateAtan2(g,p.z),b=R.fastApproximateAtan2(p.x,p.y);t[s++]=m,t[s++]=b}}let a=0;for(let l of o){let u=1/(l.east-l.west),f=1/(l.north-l.south);n[a++]=l.south,n[a++]=l.west,n[a++]=f,n[a++]=u}e._extentsCount=o.length}var jz=new H;Gr.prototype.update=function(e){let t=e.context;if(!Gr.isSupported(e))throw new ue("ClippingPolygonCollections are only supported for WebGL 2.");let n=this._polygons.reduce((s,a)=>s+a.length,0);if(n===this.totalPositions||(this._totalPositions=n,this.length===0))return;c(this._signedDistanceComputeCommand)&&(this._signedDistanceComputeCommand.canceled=!0,this._signedDistanceComputeCommand=void 0);let i=this._polygonsTexture,o=this._extentsTexture,r=this._signedDistanceTexture;if(c(i)){let s=i.width*i.height;(s<this.pixelsNeededForPolygonPositions||this.pixelsNeededForPolygonPositions<.25*s)&&(i.destroy(),i=void 0,this._polygonsTexture=void 0)}if(!c(i)){let s=Gr.getTextureResolution(i,this.pixelsNeededForPolygonPositions,jz);i=new Lt({context:t,width:s.x,height:s.y,pixelFormat:Ve.RG,pixelDatatype:Be.FLOAT,sampler:Qt.NEAREST,flipY:!1}),this._float32View=new Float32Array(s.x*s.y*2),this._polygonsTexture=i}if(c(o)){let s=o.width*o.height;(s<this.pixelsNeededForExtents||this.pixelsNeededForExtents<.25*s)&&(o.destroy(),o=void 0,this._extentsTexture=void 0)}if(!c(o)){let s=Gr.getTextureResolution(o,this.pixelsNeededForExtents,jz);o=new Lt({context:t,width:s.x,height:s.y,pixelFormat:Ve.RGBA,pixelDatatype:Be.FLOAT,sampler:Qt.NEAREST,flipY:!1}),this._extentsFloat32View=new Float32Array(s.x*s.y*4),this._extentsTexture=o}if(h3e(this),o.copyFrom({source:{width:o.width,height:o.height,arrayBufferView:this._extentsFloat32View}}),i.copyFrom({source:{width:i.width,height:i.height,arrayBufferView:this._float32View}}),!c(r)){let s=Gr.getClippingDistanceTextureResolution(this,jz);r=new Lt({context:t,width:s.x,height:s.y,pixelFormat:t.webgl2?Ve.RED:Ve.LUMINANCE,pixelDatatype:Be.FLOAT,sampler:new Qt({wrapS:yn.CLAMP_TO_EDGE,wrapT:yn.CLAMP_TO_EDGE,minificationFilter:$t.LINEAR,magnificationFilter:fi.LINEAR}),flipY:!1}),this._signedDistanceTexture=r}this._signedDistanceComputeCommand=m3e(this)};Gr.prototype.queueCommands=function(e){c(this._signedDistanceComputeCommand)&&e.commandList.push(this._signedDistanceComputeCommand)};function m3e(e){let t=e._polygonsTexture,n=e._extentsTexture;return new zl({fragmentShaderSource:Gz,outputTexture:e._signedDistanceTexture,uniformMap:{u_polygonsLength:function(){return e.length},u_extentsLength:function(){return e.extentsCount},u_extentsTexture:function(){return n},u_polygonTexture:function(){return t}},persists:!1,owner:e,postExecute:()=>{e._signedDistanceComputeCommand=void 0}})}var jie=new ae,p3e=new ae;Gr.prototype.computeIntersectionWithBoundingVolume=function(e,t){let n=this._polygons,i=n.length,o=qt.OUTSIDE;this.inverse&&(o=qt.INSIDE);for(let r=0;r<i;++r){let a=n[r].computeRectangle(),l=e.rectangle;if(!c(l)&&c(e.boundingVolume?.computeCorners)){let f=e.boundingVolume.computeCorners();l=ae.fromCartesianArray(f,t,jie)}c(l)||(l=ae.fromBoundingSphere(e.boundingSphere,t,jie));let u=ae.simpleIntersection(l,a,p3e);c(u)&&(o=qt.INTERSECTING)}return o};Gr.setOwner=function(e,t,n){if(e!==t[n]&&(t[n]=t[n]&&t[n].destroy(),c(e))){if(c(e._owner))throw new E("ClippingPolygonCollection should only be assigned to one object");e._owner=t,t[n]=e}};Gr.isSupported=function(e){return e?.context.webgl2};Gr.getTextureResolution=function(e,t,n){if(c(e))return n.x=e.width,n.y=e.height,n;let i=mt.maximumTextureSize;return n.x=Math.min(t,i),n.y=Math.ceil(t/n.x),n.y*=2,n};Gr.getClippingDistanceTextureResolution=function(e,t){let n=e.signedDistanceTexture;return c(n)?(t.x=n.width,t.y=n.height,t):(t.x=Math.min(mt.maximumTextureSize,4096),t.y=Math.min(mt.maximumTextureSize,4096),t)};Gr.getClippingExtentsTextureResolution=function(e,t){let n=e.extentsTexture;return c(n)?(t.x=n.width,t.y=n.height,t):Gr.getTextureResolution(n,e.pixelsNeededForExtents,t)};Gr.prototype.isDestroyed=function(){return!1};Gr.prototype.destroy=function(){return c(this._signedDistanceComputeCommand)&&(this._signedDistanceComputeCommand.canceled=!0),this._polygonsTexture=this._polygonsTexture&&this._polygonsTexture.destroy(),this._extentsTexture=this._extentsTexture&&this._extentsTexture.destroy(),this._signedDistanceTexture=this._signedDistanceTexture&&this._signedDistanceTexture.destroy(),de(this)};var tp=Gr;var QS={NONE:0,SCENE_LIGHT:1,SUNLIGHT:2};QS.fromGlobeFlags=function(e){return e.enableLighting&&e.dynamicAtmosphereLighting?e.dynamicAtmosphereLightingFromSun?QS.SUNLIGHT:QS.SCENE_LIGHT:QS.NONE};var T0=Object.freeze(QS);function Wie(){this.lightIntensity=10,this.rayleighCoefficient=new h(55e-7,13e-6,284e-7),this.mieCoefficient=new h(21e-6,21e-6,21e-6),this.rayleighScaleHeight=1e4,this.mieScaleHeight=3200,this.mieAnisotropy=.9,this.hueShift=0,this.saturationShift=0,this.brightnessShift=0,this.dynamicLighting=T0.NONE}Wie.requiresColorCorrect=function(e){return!(R.equalsEpsilon(e.hueShift,0,R.EPSILON7)&&R.equalsEpsilon(e.saturationShift,0,R.EPSILON7)&&R.equalsEpsilon(e.brightnessShift,0,R.EPSILON7))};var ew=Wie;var np=`uniform vec3 u_radiiAndDynamicAtmosphereColor;
uniform float u_atmosphereLightIntensity;
uniform float u_atmosphereRayleighScaleHeight;
uniform float u_atmosphereMieScaleHeight;
uniform float u_atmosphereMieAnisotropy;
uniform vec3 u_atmosphereRayleighCoefficient;
uniform vec3 u_atmosphereMieCoefficient;
const float ATMOSPHERE_THICKNESS = 111e3;
const int PRIMARY_STEPS_MAX = 16;
const int LIGHT_STEPS_MAX = 4;
void computeScattering(
czm_ray primaryRay,
float primaryRayLength,
vec3 lightDirection,
float atmosphereInnerRadius,
out vec3 rayleighColor,
out vec3 mieColor,
out float opacity
) {
rayleighColor = vec3(0.0);
mieColor = vec3(0.0);
opacity = 0.0;
float atmosphereOuterRadius = atmosphereInnerRadius + ATMOSPHERE_THICKNESS;
vec3 origin = vec3(0.0);
czm_raySegment primaryRayAtmosphereIntersect = czm_raySphereIntersectionInterval(primaryRay, origin, atmosphereOuterRadius);
if (primaryRayAtmosphereIntersect == czm_emptyRaySegment) {
return;
}
float x = 1e-7 * primaryRayAtmosphereIntersect.stop / length(primaryRayLength);
float w_stop_gt_lprl = 0.5 * (1.0 + czm_approximateTanh(x));
float start_0 = primaryRayAtmosphereIntersect.start;
primaryRayAtmosphereIntersect.start = max(primaryRayAtmosphereIntersect.start, 0.0);
primaryRayAtmosphereIntersect.stop = min(primaryRayAtmosphereIntersect.stop, length(primaryRayLength));
float x_o_a = start_0 - ATMOSPHERE_THICKNESS;
float w_inside_atmosphere = 1.0 - 0.5 * (1.0 + czm_approximateTanh(x_o_a));
int PRIMARY_STEPS = PRIMARY_STEPS_MAX - int(w_inside_atmosphere * 12.0);
int LIGHT_STEPS = LIGHT_STEPS_MAX - int(w_inside_atmosphere * 2.0);
float rayPositionLength = primaryRayAtmosphereIntersect.start;
float totalRayLength = primaryRayAtmosphereIntersect.stop - rayPositionLength;
float rayStepLengthIncrease = w_inside_atmosphere * ((1.0 - w_stop_gt_lprl) * totalRayLength / (float(PRIMARY_STEPS * (PRIMARY_STEPS + 1)) / 2.0));
float rayStepLength = max(1.0 - w_inside_atmosphere, w_stop_gt_lprl) * totalRayLength / max(7.0 * w_inside_atmosphere, float(PRIMARY_STEPS));
vec3 rayleighAccumulation = vec3(0.0);
vec3 mieAccumulation = vec3(0.0);
vec2 opticalDepth = vec2(0.0);
vec2 heightScale = vec2(u_atmosphereRayleighScaleHeight, u_atmosphereMieScaleHeight);
for (int i = 0; i < PRIMARY_STEPS_MAX; ++i) {
if (i >= PRIMARY_STEPS) {
break;
}
vec3 samplePosition = primaryRay.origin + primaryRay.direction * (rayPositionLength + rayStepLength);
float sampleHeight = length(samplePosition) - atmosphereInnerRadius;
vec2 sampleDensity = exp(-sampleHeight / heightScale) * rayStepLength;
opticalDepth += sampleDensity;
czm_ray lightRay = czm_ray(samplePosition, lightDirection);
czm_raySegment lightRayAtmosphereIntersect = czm_raySphereIntersectionInterval(lightRay, origin, atmosphereOuterRadius);
float lightStepLength = lightRayAtmosphereIntersect.stop / float(LIGHT_STEPS);
float lightPositionLength = 0.0;
vec2 lightOpticalDepth = vec2(0.0);
for (int j = 0; j < LIGHT_STEPS_MAX; ++j) {
if (j >= LIGHT_STEPS) {
break;
}
vec3 lightPosition = samplePosition + lightDirection * (lightPositionLength + lightStepLength * 0.5);
float lightHeight = length(lightPosition) - atmosphereInnerRadius;
lightOpticalDepth += exp(-lightHeight / heightScale) * lightStepLength;
lightPositionLength += lightStepLength;
}
vec3 attenuation = exp(-((u_atmosphereMieCoefficient * (opticalDepth.y + lightOpticalDepth.y)) + (u_atmosphereRayleighCoefficient * (opticalDepth.x + lightOpticalDepth.x))));
rayleighAccumulation += sampleDensity.x * attenuation;
mieAccumulation += sampleDensity.y * attenuation;
rayPositionLength += (rayStepLength += rayStepLengthIncrease);
}
rayleighColor = u_atmosphereRayleighCoefficient * rayleighAccumulation;
mieColor = u_atmosphereMieCoefficient * mieAccumulation;
opacity = length(exp(-((u_atmosphereMieCoefficient * opticalDepth.y) + (u_atmosphereRayleighCoefficient * opticalDepth.x))));
}
vec4 computeAtmosphereColor(
vec3 positionWC,
vec3 lightDirection,
vec3 rayleighColor,
vec3 mieColor,
float opacity
) {
vec3 cameraToPositionWC = positionWC - czm_viewerPositionWC;
vec3 cameraToPositionWCDirection = normalize(cameraToPositionWC);
float cosAngle = dot(cameraToPositionWCDirection, lightDirection);
float cosAngleSq = cosAngle * cosAngle;
float G = u_atmosphereMieAnisotropy;
float GSq = G * G;
float rayleighPhase = 3.0 / (50.2654824574) * (1.0 + cosAngleSq);
float miePhase = 3.0 / (25.1327412287) * ((1.0 - GSq) * (cosAngleSq + 1.0)) / (pow(1.0 + GSq - 2.0 * cosAngle * G, 1.5) * (2.0 + GSq));
vec3 rayleigh = rayleighPhase * rayleighColor;
vec3 mie = miePhase * mieColor;
vec3 color = (rayleigh + mie) * u_atmosphereLightIntensity;
return vec4(color, opacity);
}
`;var Wz=`uniform samplerCube u_radianceMap;
in vec2 v_textureCoordinates;
const float twoSqrtPi = 2.0 * sqrt(czm_pi);
float computeShBasis(int index, vec3 s) {
if (index == 0) {
return 1.0 / twoSqrtPi;
}
if (index == 1) {
return -sqrt(3.0) * s.y / twoSqrtPi;
}
if (index == 2) {
return sqrt(3.0) * s.z / twoSqrtPi;
}
if (index == 3) {
return -sqrt(3.0) * s.x / twoSqrtPi;
}
if (index == 4) {
return sqrt(15.0) * s.y * s.x / twoSqrtPi;
}
if (index == 5) {
return -sqrt(15.0) * s.y * s.z / twoSqrtPi;
}
if (index == 6) {
return sqrt(5.0) * (3.0 * s.z * s.z - 1.0) / 2.0 / twoSqrtPi;
}
if (index == 7) {
return -sqrt(15.0) * s.x * s.z / twoSqrtPi;
}
if (index == 8) {
return sqrt(15.0) * (s.x * s.x - s.y * s.y) / 2.0 / twoSqrtPi;
}
return 0.0;
}
float vdcRadicalInverse(int i)
{
float r;
float base = 2.0;
float value = 0.0;
float invBase = 1.0 / base;
float invBi = invBase;
for (int x = 0; x < 100; x++)
{
if (i <= 0)
{
break;
}
r = mod(float(i), base);
value += r * invBi;
invBi *= invBase;
i = int(float(i) * invBase);
}
return value;
}
vec2 hammersley2D(int i, int N)
{
return vec2(float(i) / float(N), vdcRadicalInverse(i));
}
const int samples = 256;
const float solidAngle = 1.0 / float(samples);
void main() {
vec2 uv = v_textureCoordinates.xy * 3.0;
int coefficientIndex = int(floor(uv.y) * 3.0 + floor(uv.x));
for (int i = 0; i < samples; ++i) {
vec2 xi = hammersley2D(i, samples);
float phi = czm_twoPi * xi.x;
float cosTheta = 1.0 - 2.0 * sqrt(1.0 - xi.y * xi.y);
float sinTheta = sqrt(1.0 - cosTheta * cosTheta);
vec3 direction = normalize(vec3(sinTheta * cos(phi), cosTheta, sinTheta * sin(phi)));
float Ylm = computeShBasis(coefficientIndex, direction);
vec3 lookupDirection = -direction.xyz;
lookupDirection.z = -lookupDirection.z;
vec4 color = czm_textureCube(u_radianceMap, lookupDirection, 0.0);
out_FragColor += Ylm * color * solidAngle * sinTheta;
}
}
`;var qz=`precision highp float;
in vec2 v_textureCoordinates;
uniform vec3 u_faceDirection;
uniform vec3 u_positionWC;
uniform mat4 u_enuToFixedFrame;
uniform vec4 u_brightnessSaturationGammaIntensity;
uniform vec4 u_groundColor;
vec4 getCubeMapDirection(vec2 uv, vec3 faceDir) {
vec2 scaledUV = uv * 2.0 - 1.0;
if (faceDir.x != 0.0) {
return vec4(faceDir.x,  scaledUV.x * faceDir.x, -scaledUV.y, 0.0);
} else if (faceDir.y != 0.0) {
return vec4(scaledUV.x, -scaledUV.y * faceDir.y, faceDir.y, 0.0);
} else {
return vec4(scaledUV.x * faceDir.z, -faceDir.z, -scaledUV.y, 0.0);
}
}
void main() {
float height = length(u_positionWC);
float atmosphereInnerRadius = u_radiiAndDynamicAtmosphereColor.y;
float ellipsoidHeight = max(height - atmosphereInnerRadius, 0.0);
vec3 positionWC = u_positionWC / height * (ellipsoidHeight + atmosphereInnerRadius);
float atmosphereOuterRadius = u_radiiAndDynamicAtmosphereColor.x;
float atmosphereHeight = atmosphereOuterRadius - atmosphereInnerRadius;
vec3 direction = (u_enuToFixedFrame * getCubeMapDirection(v_textureCoordinates, u_faceDirection)).xyz;
vec3 normalizedDirection = normalize(direction);
czm_ray ray = czm_ray(positionWC, normalizedDirection);
czm_raySegment intersection = czm_raySphereIntersectionInterval(ray, vec3(0.0), atmosphereInnerRadius);
if (!czm_isEmpty(intersection)) {
intersection = czm_rayEllipsoidIntersectionInterval(ray, vec3(0.0), czm_ellipsoidInverseRadii);
}
bool onEllipsoid = intersection.start >= 0.0;
float rayLength = czm_branchFreeTernary(onEllipsoid, intersection.start, atmosphereOuterRadius);
vec3 skyPositionWC = positionWC + normalizedDirection * rayLength;
float lightEnum = u_radiiAndDynamicAtmosphereColor.z;
vec3 lightDirectionWC = normalize(czm_getDynamicAtmosphereLightDirection(skyPositionWC, lightEnum));
vec3 mieColor;
vec3 rayleighColor;
float opacity;
czm_computeScattering(
ray,
rayLength,
lightDirectionWC,
atmosphereInnerRadius,
rayleighColor,
mieColor,
opacity
);
vec4 atmopshereColor = czm_computeAtmosphereColor(ray, lightDirectionWC, rayleighColor, mieColor, opacity);
#ifdef ATMOSPHERE_COLOR_CORRECT
const bool ignoreBlackPixels = true;
atmopshereColor.rgb = czm_applyHSBShift(atmopshereColor.rgb, czm_atmosphereHsbShift, ignoreBlackPixels);
#endif
vec3 lookupDirection = -normalizedDirection;
lookupDirection.x = -lookupDirection.x;
lookupDirection = -normalize(czm_temeToPseudoFixed * lookupDirection);
lookupDirection.x = -lookupDirection.x;
float skyAlpha = clamp((1.0 - ellipsoidHeight / atmosphereHeight) * atmopshereColor.a, 0.0, 1.0);
skyAlpha = czm_branchFreeTernary(length(atmopshereColor.rgb) <= czm_epsilon7, 0.0, skyAlpha);
float intensity = u_brightnessSaturationGammaIntensity.w;
vec4 sceneSkyBoxColor = czm_textureCube(czm_environmentMap, lookupDirection);
vec3 skyBackgroundColor = mix(czm_backgroundColor.rgb, sceneSkyBoxColor.rgb, sceneSkyBoxColor.a);
vec4 combinedSkyColor = vec4(mix(skyBackgroundColor, atmopshereColor.rgb * intensity, skyAlpha), 1.0);
vec3 up = normalize(positionWC);
float occlusion = max(dot(lightDirectionWC, up), 0.05);
vec4 groundColor = vec4(u_groundColor.rgb * u_groundColor.a * (vec3(intensity * occlusion) + atmopshereColor.rgb), 1.0);
vec4 blendedGroundColor = mix(groundColor, atmopshereColor, clamp(ellipsoidHeight / atmosphereHeight, 0.0, 1.0));
vec4 color = czm_branchFreeTernary(onEllipsoid, blendedGroundColor, combinedSkyColor);
float brightness = u_brightnessSaturationGammaIntensity.x;
float saturation = u_brightnessSaturationGammaIntensity.y;
float gamma = u_brightnessSaturationGammaIntensity.z;
#ifdef ENVIRONMENT_COLOR_CORRECT
color.rgb = mix(vec3(0.0), color.rgb, brightness);
color.rgb = czm_saturation(color.rgb, saturation);
#endif
color.rgb = pow(color.rgb, vec3(gamma));
color.rgb = czm_gammaCorrect(color.rgb);
out_FragColor = color;
}
`;var Yz=`precision highp float;
in vec3 v_textureCoordinates;
uniform float u_roughness;
uniform samplerCube u_radianceTexture;
uniform vec3 u_faceDirection;
float vdcRadicalInverse(int i)
{
float r;
float base = 2.0;
float value = 0.0;
float invBase = 1.0 / base;
float invBi = invBase;
for (int x = 0; x < 100; x++)
{
if (i <= 0)
{
break;
}
r = mod(float(i), base);
value += r * invBi;
invBi *= invBase;
i = int(float(i) * invBase);
}
return value;
}
vec2 hammersley2D(int i, int N)
{
return vec2(float(i) / float(N), vdcRadicalInverse(i));
}
vec3 importanceSampleGGX(vec2 xi, float alphaRoughness, vec3 N)
{
float alphaRoughnessSquared = alphaRoughness * alphaRoughness;
float phi = czm_twoPi * xi.x;
float cosTheta = sqrt((1.0 - xi.y) / (1.0 + (alphaRoughnessSquared - 1.0) * xi.y));
float sinTheta = sqrt(1.0 - cosTheta * cosTheta);
vec3 H = vec3(sinTheta * cos(phi), sinTheta * sin(phi), cosTheta);
vec3 upVector = abs(N.z) < 0.999 ? vec3(0.0, 0.0, 1.0) : vec3(1.0, 0.0, 0.0);
vec3 tangentX = normalize(cross(upVector, N));
vec3 tangentY = cross(N, tangentX);
return tangentX * H.x + tangentY * H.y + N * H.z;
}
const int samples = 128;
void main() {
vec3 normal = u_faceDirection;
vec3 V = normalize(v_textureCoordinates);
float roughness = u_roughness;
vec4 color = vec4(0.0);
float weight = 0.0;
for (int i = 0; i < samples; ++i) {
vec2 xi = hammersley2D(i, samples);
vec3 H = importanceSampleGGX(xi, roughness, V);
vec3 L = 2.0 * dot(V, H) * H - V;
float NdotL = max(dot(V, L), 0.0);
if (NdotL > 0.0) {
color += vec4(texture(u_radianceTexture, L).rgb, 1.0) * NdotL;
weight += NdotL;
}
}
out_FragColor = color / weight;
}
`;var Xz=`in vec3 position;
out vec3 v_textureCoordinates;
uniform vec3 u_faceDirection;
vec3 getCubeMapDirection(vec2 uv, vec3 faceDir) {
vec2 scaledUV = uv;
if (faceDir.x != 0.0) {
return vec3(faceDir.x, scaledUV.y, scaledUV.x * faceDir.x);
} else if (faceDir.y != 0.0) {
return vec3(scaledUV.x, -faceDir.y, -scaledUV.y * faceDir.y);
} else {
return vec3(scaledUV.x * faceDir.z, scaledUV.y, -faceDir.z);
}
}
void main()
{
v_textureCoordinates = getCubeMapDirection(position.xy, u_faceDirection);
v_textureCoordinates.y = -v_textureCoordinates.y;
v_textureCoordinates.z = -v_textureCoordinates.z;
gl_Position = vec4(position, 1.0);
}
`;function ip(e){this._position=void 0,this._radianceMapDirty=!1,this._radianceCommandsDirty=!1,this._convolutionsCommandsDirty=!1,this._irradianceCommandDirty=!1,this._irradianceTextureDirty=!1,this._sphericalHarmonicCoefficientsDirty=!1,this._shouldRegenerateShaders=!1,e=y(e,y.EMPTY_OBJECT);let t=y(e.mipmapLevels,10);this._mipmapLevels=t,this._radianceMapComputeCommands=new Array(6),this._convolutionComputeCommands=new Array((t-1)*6),this._irradianceComputeCommand=void 0,this._radianceMapFS=void 0,this._irradianceMapFS=void 0,this._convolveSP=void 0,this._va=void 0,this._radianceMapTextures=new Array(6),this._specularMapTextures=new Array((t-1)*6),this._radianceCubeMap=void 0,this._irradianceMapTexture=void 0,this._sphericalHarmonicCoefficients=new Array(9),this._lastTime=new J;let n=Math.pow(2,t-1);this._textureDimensions=new H(n,n),this._radiiAndDynamicAtmosphereColor=new h,this._sceneEnvironmentMap=void 0,this._backgroundColor=void 0,this._owner=void 0,this.enabled=y(e.enabled,!0),this.shouldUpdate=!0,this.maximumSecondsDifference=y(e.maximumSecondsDifference,60*60),this.maximumPositionEpsilon=y(e.maximumPositionEpsilon,1e3),this.atmosphereScatteringIntensity=y(e.atmosphereScatteringIntensity,2),this.gamma=y(e.gamma,1),this.brightness=y(e.brightness,1),this.saturation=y(e.saturation,1),this.groundColor=y(e.groundColor,ip.AVERAGE_EARTH_GROUND_COLOR),this.groundAlbedo=y(e.groundAlbedo,.31)}Object.defineProperties(ip.prototype,{owner:{get:function(){return this._owner}},shouldRegenerateShaders:{get:function(){return this._shouldRegenerateShaders}},position:{get:function(){return this._position},set:function(e){h.equalsEpsilon(e,this._position,0,this.maximumPositionEpsilon)||(this._position=h.clone(e,this._position),this.reset())}},radianceCubeMap:{get:function(){return this._radianceCubeMap}},maximumMipmapLevel:{get:function(){return this._mipmapLevels}},sphericalHarmonicCoefficients:{get:function(){return this._sphericalHarmonicCoefficients}}});ip.setOwner=function(e,t,n){if(e!==t[n]&&(t[n]=t[n]&&t[n].destroy(),c(e))){if(c(e._owner))throw new E("DynamicEnvironmentMapManager should only be assigned to one object");e._owner=t,t[n]=e}};ip.prototype.reset=function(){let e=this._radianceMapComputeCommands.length;for(let t=0;t<e;++t)this._radianceMapComputeCommands[t]=void 0;e=this._convolutionComputeCommands.length;for(let t=0;t<e;++t)this._convolutionComputeCommands[t]=void 0;c(this._irradianceComputeCommand)&&(this._irradianceComputeCommand=void 0),this._radianceMapDirty=!0,this._radianceCommandsDirty=!0};var _3e=new h,g3e=new h;function y3e(e,t){let n=e._position,i=t.atmosphere,o=t.mapProjection.ellipsoid,r=o.scaleToGeodeticSurface(n,g3e),s=1.025,a=_3e,l=c(r)?h.magnitude(r):o.maximumRadius;return a.x=l*s,a.y=l,a.z=i.dynamicLighting,!h.equalsEpsilon(e._radiiAndDynamicAtmosphereColor,a)||t.environmentMap!==e._sceneEnvironmentMap||t.backgroundColor!==e._backgroundColor?(h.clone(a,e._radiiAndDynamicAtmosphereColor),e._sceneEnvironmentMap=t.environmentMap,e._backgroundColor=t.backgroundColor,!0):!1}var qie=new h,b3e=new k,x3e=new se,T3e=new j;function A3e(e,t){let n=t.context,i=e._textureDimensions;if(c(e._radianceCubeMap)||(e._radianceCubeMap=new Jo({context:n,width:i.x,height:i.y,pixelDatatype:Be.UNSIGNED_BYTE,pixelFormat:Ve.RGBA})),e._radianceCommandsDirty){let o=e._radianceMapFS;c(o)||(o=new Ge({sources:[np,qz]}),e._radianceMapFS=o),ew.requiresColorCorrect(t.atmosphere)&&o.defines.push("ATMOSPHERE_COLOR_CORRECT");let r=e._position,s=e._radiiAndDynamicAtmosphereColor,a=t.mapProjection.ellipsoid,l=Ft.eastNorthUpToFixedFrame(r,a,b3e),u=x3e;u.x=e.brightness,u.y=e.saturation,u.z=e.gamma,u.w=e.atmosphereScatteringIntensity,(e.brightness!==1||e.saturation!==1||e.gamma!==1)&&o.defines.push("ENVIRONMENT_COLOR_CORRECT");let f=0;for(let d of Jo.faceNames()){let p=e._radianceMapTextures[f];c(p)&&p.destroy(),p=new Lt({context:n,width:i.x,height:i.y,pixelDatatype:Be.UNSIGNED_BYTE,pixelFormat:Ve.RGBA}),e._radianceMapTextures[f]=p;let g=f,m=new zl({fragmentShaderSource:o,outputTexture:p,uniformMap:{u_radiiAndDynamicAtmosphereColor:()=>s,u_enuToFixedFrame:()=>l,u_faceDirection:()=>Jo.getDirection(d,qie),u_positionWC:()=>r,u_brightnessSaturationGammaIntensity:()=>u,u_groundColor:()=>e.groundColor.withAlpha(e.groundAlbedo,T3e)},persists:!0,owner:e,postExecute:()=>{let b=e._radianceMapComputeCommands;if(!c(b[g]))return;b[g]=void 0;let x=new Jr({context:n,colorTextures:[e._radianceMapTextures[g]],destroyAttachments:!1});x._bind(),e._radianceCubeMap[d].copyFromFramebuffer(),x._unBind(),x.destroy(),b.some(c)||(e._convolutionsCommandsDirty=!0,e._shouldRegenerateShaders=!0)}});t.commandList.push(m),e._radianceMapComputeCommands[f]=m,f++}e._radianceCommandsDirty=!1}}function C3e(e,t){let n=e._radianceCubeMap;n.generateMipmap();let i=e._mipmapLevels,o=e._textureDimensions,r=o.x/2,s=o.y/2,a=t.context,l=0,u=(d,p,g,m)=>()=>{let b=e._convolutionComputeCommands;c(b[d])&&(b[d]=void 0,n.copyFace(t,p,g,m),l++,l===e._specularMapTextures.length&&(e._irradianceCommandDirty=!0,n.sampler=new Qt({minificationFilter:$t.LINEAR_MIPMAP_LINEAR}),e._shouldRegenerateShaders=!0))},f=0;for(let d=1;d<i;++d){for(let p of Jo.faceNames()){let g=e._specularMapTextures[f]=new Lt({context:a,width:r,height:s,pixelDatatype:Be.UNSIGNED_BYTE,pixelFormat:Ve.RGBA}),m=e._va;c(m)||(m=Jo.createVertexArray(a,p),e._va=m);let b=e._convolveSP;c(b)||(b=an.fromCache({context:a,vertexShaderSource:Xz,fragmentShaderSource:Yz,attributeLocations:{positions:0}}),e._convolveSP=b);let x=new zl({shaderProgram:b,vertexArray:m,outputTexture:g,persists:!0,owner:e,uniformMap:{u_roughness:()=>d/(i-1),u_radianceTexture:()=>n,u_faceDirection:()=>Jo.getDirection(p,qie)},postExecute:u(f,g,p,d)});e._convolutionComputeCommands[f]=x,t.commandList.push(x),++f}r/=2,s/=2}}var Yie=new H(3,3);function E3e(e,t){let n=t.context,i=Yie,o=e._irradianceMapTexture;c(o)||(o=new Lt({context:n,width:i.x,height:i.y,pixelDatatype:Be.FLOAT,pixelFormat:Ve.RGBA}),e._irradianceMapTexture=o);let r=e._irradianceMapFS;c(r)||(r=new Ge({sources:[Wz]}),e._irradianceMapFS=r);let s=new zl({fragmentShaderSource:r,outputTexture:o,uniformMap:{u_radianceMap:()=>e._radianceCubeMap},postExecute:()=>{c(e._irradianceComputeCommand)&&(e._irradianceTextureDirty=!1,e._irradianceComputeCommand=void 0,e._sphericalHarmonicCoefficientsDirty=!0)}});e._irradianceComputeCommand=s,t.commandList.push(s),e._irradianceTextureDirty=!0}function S3e(e,t){let n=t.context,i=new Jr({context:n,colorTextures:[e._irradianceMapTexture],destroyAttachments:!1}),o=Yie,r=n.readPixels({x:0,y:0,width:o.x,height:o.y,framebuffer:i});for(let s=0;s<9;++s)e._sphericalHarmonicCoefficients[s]=h.unpack(r,s*4),h.multiplyByScalar(e._sphericalHarmonicCoefficients[s],e.atmosphereScatteringIntensity,e._sphericalHarmonicCoefficients[s]);i.destroy(),e._shouldRegenerateShaders=!0}ip.prototype.update=function(e){let t=e.mode;if(!this.enabled||!this.shouldUpdate||!c(this._position)||t===oe.MORPHING){this._shouldRegenerateShaders=!1;return}let n=e.atmosphere.dynamicLighting;if((y3e(this,e)||n===T0.SUNLIGHT&&!J.equalsEpsilon(e.time,this._lastTime,this.maximumSecondsDifference))&&(this.reset(),this._lastTime=J.clone(e.time,this._lastTime)),this._radianceMapDirty&&(A3e(this,e),this._radianceMapDirty=!1),this._convolutionsCommandsDirty&&(C3e(this,e),this._convolutionsCommandsDirty=!1),this._irradianceCommandDirty&&(E3e(this,e),this._irradianceCommandDirty=!1),this._irradianceTextureDirty){this._shouldRegenerateShaders=!1;return}if(this._sphericalHarmonicCoefficientsDirty){S3e(this,e),this._sphericalHarmonicCoefficientsDirty=!1;return}this._shouldRegenerateShaders=!1};ip.prototype.isDestroyed=function(){return!1};ip.prototype.destroy=function(){let e=this._radianceMapComputeCommands.length;for(let t=0;t<e;++t)this._radianceMapComputeCommands[t]=void 0;e=this._convolutionComputeCommands.length;for(let t=0;t<e;++t)this._convolutionComputeCommands[t]=void 0;this._irradianceMapComputeCommand=void 0,e=this._radianceMapTextures.length;for(let t=0;t<e;++t)this._radianceMapTextures[t]=this._radianceMapTextures[t]&&this._radianceMapTextures[t].destroy();e=this._specularMapTextures.length;for(let t=0;t<e;++t)this._specularMapTextures[t]=this._specularMapTextures[t]&&this._specularMapTextures[t].destroy();return this._radianceCubeMap=this._radianceCubeMap&&this._radianceCubeMap.destroy(),this._irradianceMapTexture=this._irradianceMapTexture&&this._irradianceMapTexture.destroy(),de(this)};ip.AVERAGE_EARTH_GROUND_COLOR=Object.freeze(j.fromCssColorString("#717145"));var A0=ip;var tw={HIGHLIGHT:0,REPLACE:1,MIX:2};tw.getColorBlend=function(e,t){if(e===tw.HIGHLIGHT)return 0;if(e===tw.REPLACE)return 1;if(e===tw.MIX)return R.clamp(t,R.EPSILON4,1)};var ol=Object.freeze(tw);var w3e={XTRANSLATE:"xTranslate",YTRANSLATE:"yTranslate",ZTRANSLATE:"zTranslate",XROTATE:"xRotate",YROTATE:"yRotate",ZROTATE:"zRotate",XSCALE:"xScale",YSCALE:"yScale",ZSCALE:"zScale",UNIFORMSCALE:"uniformScale"},rl=Object.freeze(w3e);var v3e={STEP:0,LINEAR:1,CUBICSPLINE:2},op=Object.freeze(v3e);var Xie={};function nw(e){A.typeOf.number.greaterThan("options.count",e.count,0),A.typeOf.object("options.properties",e.properties),this._count=e.count,this._properties=qe(e.properties,!0)}nw.prototype.hasProperty=function(e){return Bn.hasProperty(e,this._properties,Xie)};nw.prototype.getPropertyIds=function(e){return Bn.getPropertyIds(this._properties,Xie,e)};nw.prototype.getProperty=function(e,t){if(A.typeOf.number("index",e),A.typeOf.string("propertyId",t),e<0||e>=this._count)throw new E(`index must be in the range [0, ${this._count})`);let n=this._properties[t];if(c(n))return qe(n[e],!0)};nw.prototype.setProperty=function(e,t,n){if(A.typeOf.number("index",e),A.typeOf.string("propertyId",t),e<0||e>=this._count)throw new E(`index must be in the range [0, ${this._count})`);let i=this._properties[t];c(i)||(i=new Array(this._count),this._properties[t]=i),i[e]=qe(n,!0)};var C0=nw;function Wa(e){e=y(e,y.EMPTY_OBJECT),A.typeOf.number("options.count",e.count),this._name=e.name,this._id=e.id,this._count=e.count,this._extras=e.extras,this._extensions=e.extensions,this._metadataTable=e.metadataTable,this._jsonMetadataTable=e.jsonMetadataTable,this._batchTableHierarchy=e.batchTableHierarchy}Object.defineProperties(Wa.prototype,{name:{get:function(){return this._name}},id:{get:function(){return this._id}},count:{get:function(){return this._count}},class:{get:function(){if(c(this._metadataTable))return this._metadataTable.class}},extras:{get:function(){return this._extras}},extensions:{get:function(){return this._extensions}},byteLength:{get:function(){let e=0;return c(this._metadataTable)&&(e+=this._metadataTable.byteLength),c(this._batchTableHierarchy)&&(e+=this._batchTableHierarchy.byteLength),e}}});Wa.prototype.hasProperty=function(e,t){return A.typeOf.number("index",e),A.typeOf.string("propertyId",t),!!(c(this._metadataTable)&&this._metadataTable.hasProperty(t)||c(this._batchTableHierarchy)&&this._batchTableHierarchy.hasProperty(e,t)||c(this._jsonMetadataTable)&&this._jsonMetadataTable.hasProperty(t))};Wa.prototype.hasPropertyBySemantic=function(e,t){return A.typeOf.number("index",e),A.typeOf.string("semantic",t),c(this._metadataTable)?this._metadataTable.hasPropertyBySemantic(t):!1};Wa.prototype.propertyExists=function(e){return A.typeOf.string("propertyId",e),!!(c(this._metadataTable)&&this._metadataTable.hasProperty(e)||c(this._batchTableHierarchy)&&this._batchTableHierarchy.propertyExists(e)||c(this._jsonMetadataTable)&&this._jsonMetadataTable.hasProperty(e))};Wa.prototype.propertyExistsBySemantic=function(e){return A.typeOf.string("semantic",e),c(this._metadataTable)?this._metadataTable.hasPropertyBySemantic(e):!1};var Kz=[];Wa.prototype.getPropertyIds=function(e,t){return t=c(t)?t:[],t.length=0,c(this._metadataTable)&&t.push.apply(t,this._metadataTable.getPropertyIds(Kz)),c(this._batchTableHierarchy)&&t.push.apply(t,this._batchTableHierarchy.getPropertyIds(e,Kz)),c(this._jsonMetadataTable)&&t.push.apply(t,this._jsonMetadataTable.getPropertyIds(Kz)),t};Wa.prototype.getProperty=function(e,t){let n;if(c(this._metadataTable)&&(n=this._metadataTable.getProperty(e,t),c(n))||c(this._batchTableHierarchy)&&(n=this._batchTableHierarchy.getProperty(e,t),c(n))||c(this._jsonMetadataTable)&&(n=this._jsonMetadataTable.getProperty(e,t),c(n)))return n};Wa.prototype.setProperty=function(e,t,n){c(this._metadataTable)&&this._metadataTable.setProperty(e,t,n)||c(this._batchTableHierarchy)&&this._batchTableHierarchy.setProperty(e,t,n)||(c(this._jsonMetadataTable)||(this._jsonMetadataTable=new C0({count:this._count,properties:{}})),this._jsonMetadataTable.setProperty(e,t,n))};Wa.prototype.getPropertyBySemantic=function(e,t){if(c(this._metadataTable))return this._metadataTable.getPropertyBySemantic(e,t)};Wa.prototype.setPropertyBySemantic=function(e,t,n){return c(this._metadataTable)?this._metadataTable.setPropertyBySemantic(e,t,n):!1};Wa.prototype.getPropertyTypedArray=function(e){if(A.typeOf.string("propertyId",e),c(this._metadataTable))return this._metadataTable.getPropertyTypedArray(e)};Wa.prototype.getPropertyTypedArrayBySemantic=function(e){if(A.typeOf.string("semantic",e),c(this._metadataTable))return this._metadataTable.getPropertyTypedArrayBySemantic(e)};function $z(e,t){if(!c(e)||e<0||e>=t)throw new E(`featureId is required and must be between zero and featuresLength - 1 (${t}`-+").")}Wa.prototype.isClass=function(e,t){$z(e,this.count),A.typeOf.string("className",t);let n=this._batchTableHierarchy;return c(n)?n.isClass(e,t):!1};Wa.prototype.isExactClass=function(e,t){return $z(e,this.count),A.typeOf.string("className",t),this.getExactClassName(e)===t};Wa.prototype.getExactClassName=function(e){$z(e,this.count);let t=this._batchTableHierarchy;if(c(t))return t.getClassName(e)};var Hl=Wa;function iw(e){e=y(e,y.EMPTY_OBJECT);let t=e.property,n=e.classProperty,i=e.textures;A.typeOf.object("options.property",t),A.typeOf.object("options.classProperty",n),A.typeOf.object("options.textures",i);let o=c(t.channels)?t.channels:[0],r=t,s=Xu.createModelTextureReader({textureInfo:r,channels:I3e(o),texture:i[r.index]});this._min=t.min,this._max=t.max;let a=t.offset,l=t.scale,u=n.hasValueTransform||c(a)||c(l);a=y(a,n.offset),l=y(l,n.scale),a=n.unpackVectorAndMatrixTypes(a),l=n.unpackVectorAndMatrixTypes(l),this._offset=a,this._scale=l,this._hasValueTransform=u,this._textureReader=s,this._classProperty=n,this._extras=t.extras,this._extensions=t.extensions}Object.defineProperties(iw.prototype,{textureReader:{get:function(){return this._textureReader}},hasValueTransform:{get:function(){return this._hasValueTransform}},offset:{get:function(){return this._offset}},scale:{get:function(){return this._scale}},classProperty:{get:function(){return this._classProperty}},extras:{get:function(){return this._extras}},extensions:{get:function(){return this._extensions}}});iw.prototype.isGpuCompatible=function(){let e=this._classProperty,t=e.type,n=e.componentType;return e.isArray?e.isVariableLengthArray?(_t(`Property texture property ${e.id} is a variable-length array, which is not supported`),!1):e.arrayLength>4?(_t(`Property texture property ${e.id} is an array of length ${e.arrayLength}, but may have at most a length of 4`),!1):t!==Et.SCALAR?(_t(`Property texture property ${e.id} is an array of type ${t}, but only SCALAR is supported`),!1):n!==Gt.UINT8?(_t(`Property texture property ${e.id} is an array with component type ${n}, but only UINT8 is supported`),!1):!0:Et.isVectorType(t)||t===Et.SCALAR?n!==Gt.UINT8?(_t(`Property texture property ${e.id} has component type ${n}, but only UINT8 is supported`),!1):!0:(_t(`Property texture property ${e.id} has an unsupported type`),!1)};var D3e=[void 0,"float","vec2","vec3","vec4"],P3e=[void 0,"int","ivec2","ivec3","ivec4"];iw.prototype.getGlslType=function(){let e=this._classProperty,t=Et.getComponentCount(e.type);return e.isArray&&(t=e.arrayLength),e.normalized?D3e[t]:P3e[t]};iw.prototype.unpackInShader=function(e){return this._classProperty.normalized?e:`${this.getGlslType()}(255.0 * ${e})`};function I3e(e){return e.map(function(t){return"rgba".charAt(t)}).join("")}var Zz=iw;function Jz(e){e=y(e,y.EMPTY_OBJECT);let t=e.propertyTexture,n=e.class,i=e.textures;A.typeOf.object("options.propertyTexture",t),A.typeOf.object("options.class",n),A.typeOf.object("options.textures",i);let o=t.extensions,r=t.extras,s={};if(c(t.properties))for(let a in t.properties)t.properties.hasOwnProperty(a)&&(s[a]=new Zz({property:t.properties[a],classProperty:n.properties[a],textures:i}));this._name=e.name,this._id=e.id,this._class=n,this._properties=s,this._extras=r,this._extensions=o}Object.defineProperties(Jz.prototype,{name:{get:function(){return this._name}},id:{get:function(){return this._id}},class:{get:function(){return this._class}},properties:{get:function(){return this._properties}},extras:{get:function(){return this._extras}},extensions:{get:function(){return this._extensions}}});Jz.prototype.getProperty=function(e){return A.typeOf.string("propertyId",e),this._properties[e]};var E0=Jz;function Kie(e){e=y(e,y.EMPTY_OBJECT);let t=e.property,n=e.classProperty;A.typeOf.object("options.property",t),A.typeOf.object("options.classProperty",n),this._attribute=t.attribute,this._classProperty=n,this._min=t.min,this._max=t.max;let i=t.offset,o=t.scale,r=n.hasValueTransform||c(i)||c(o);i=y(i,n.offset),o=y(o,n.scale),i=n.unpackVectorAndMatrixTypes(i),o=n.unpackVectorAndMatrixTypes(o),this._offset=i,this._scale=o,this._hasValueTransform=r,this._extras=t.extras,this._extensions=t.extensions}Object.defineProperties(Kie.prototype,{attribute:{get:function(){return this._attribute}},hasValueTransform:{get:function(){return this._hasValueTransform}},offset:{get:function(){return this._offset}},scale:{get:function(){return this._scale}},classProperty:{get:function(){return this._classProperty}},extras:{get:function(){return this._extras}},extensions:{get:function(){return this._extensions}}});var Qz=Kie;function e4(e){e=y(e,y.EMPTY_OBJECT);let t=e.propertyAttribute,n=e.class;A.typeOf.object("options.propertyAttribute",t),A.typeOf.object("options.class",n);let i={};if(c(t.properties))for(let o in t.properties)t.properties.hasOwnProperty(o)&&(i[o]=new Qz({property:t.properties[o],classProperty:n.properties[o]}));this._name=e.name,this._id=e.id,this._class=n,this._properties=i,this._extras=t.extras,this._extensions=t.extensions}Object.defineProperties(e4.prototype,{name:{get:function(){return this._name}},id:{get:function(){return this._id}},class:{get:function(){return this._class}},properties:{get:function(){return this._properties}},extras:{get:function(){return this._extras}},extensions:{get:function(){return this._extensions}}});e4.prototype.getProperty=function(e){return A.typeOf.string("propertyId",e),this._properties[e]};var ow=e4;function rw(e){e=y(e,y.EMPTY_OBJECT),A.typeOf.object("options.schema",e.schema),this._schema=e.schema;let t=e.propertyTables;this._propertyTableCount=c(t)?t.length:0,this._propertyTables=t,this._propertyTextures=e.propertyTextures,this._propertyAttributes=e.propertyAttributes,this._statistics=e.statistics,this._extras=e.extras,this._extensions=e.extensions}Object.defineProperties(rw.prototype,{schema:{get:function(){return this._schema}},statistics:{get:function(){return this._statistics}},extras:{get:function(){return this._extras}},extensions:{get:function(){return this._extensions}},propertyTableCount:{get:function(){return this._propertyTableCount}},propertyTables:{get:function(){return this._propertyTables}},propertyTextures:{get:function(){return this._propertyTextures}},propertyAttributes:{get:function(){return this._propertyAttributes}},propertyTablesByteLength:{get:function(){if(!c(this._propertyTables))return 0;let e=0,t=this._propertyTables.length;for(let n=0;n<t;n++)e+=this._propertyTables[n].byteLength;return e}}});rw.prototype.getPropertyTable=function(e){return A.typeOf.number("propertyTableId",e),this._propertyTables[e]};rw.prototype.getPropertyTexture=function(e){return A.typeOf.number("propertyTextureId",e),this._propertyTextures[e]};rw.prototype.getPropertyAttribute=function(e){return A.typeOf.number("propertyAttributeId",e),this._propertyAttributes[e]};var ua=rw;function O3e(e){e=y(e,y.EMPTY_OBJECT);let t=e.extension,n=e.schema;A.typeOf.object("options.extension",t),A.typeOf.object("options.schema",n);let i=[];if(c(t.propertyTables))for(let s=0;s<t.propertyTables.length;s++){let a=t.propertyTables[s],l=n.classes[a.class],u=new qu({count:a.count,properties:a.properties,class:l,bufferViews:e.bufferViews});i.push(new Hl({id:s,name:a.name,count:a.count,metadataTable:u,extras:a.extras,extensions:a.extensions}))}let o=[];if(c(t.propertyTextures))for(let s=0;s<t.propertyTextures.length;s++){let a=t.propertyTextures[s];o.push(new E0({id:s,name:a.name,propertyTexture:a,class:n.classes[a.class],textures:e.textures}))}let r=[];if(c(t.propertyAttributes))for(let s=0;s<t.propertyAttributes.length;s++){let a=t.propertyAttributes[s];r.push(new ow({id:s,name:a.name,class:n.classes[a.class],propertyAttribute:a}))}return new ua({schema:n,propertyTables:i,propertyTextures:o,propertyAttributes:r,statistics:t.statistics,extras:t.extras,extensions:t.extensions})}var t4=O3e;function R3e(e){e=y(e,y.EMPTY_OBJECT);let t=e.extension,n=e.schema;A.typeOf.object("options.extension",t),A.typeOf.object("options.schema",n);let i,o=[],r;if(c(t.featureTables))for(r=Object.keys(t.featureTables).sort(),i=0;i<r.length;i++){let a=r[i],l=t.featureTables[a],u=n.classes[l.class],f=new qu({count:l.count,properties:l.properties,class:u,bufferViews:e.bufferViews});o.push(new Hl({id:a,count:l.count,metadataTable:f,extras:l.extras,extensions:l.extensions}))}let s=[];if(c(t.featureTextures))for(r=Object.keys(t.featureTextures).sort(),i=0;i<r.length;i++){let a=r[i],l=t.featureTextures[a];s.push(new E0({id:a,propertyTexture:M3e(l),class:n.classes[l.class],textures:e.textures}))}return new ua({schema:n,propertyTables:o,propertyTextures:s,statistics:t.statistics,extras:t.extras,extensions:t.extensions})}function M3e(e){let t={class:e.class,properties:{}},n=e.properties;for(let i in n)if(n.hasOwnProperty(i)){let o=n[i],r={channels:L3e(o.channels),extras:o.extras,extensions:o.extensions};t.properties[i]=At(o.texture,r,!0)}return t}function L3e(e){let t=e.length,n=new Array(t);for(let i=0;i<t;i++)n[i]="rgba".indexOf(e[i]);return n}var n4=R3e;function K_(e){e=y(e,y.EMPTY_OBJECT);let{gltf:t,extension:n,extensionLegacy:i,gltfResource:o,baseResource:r,supportedImageFormats:s,frameState:a,cacheKey:l,asynchronous:u=!0}=e;if(A.typeOf.object("options.gltf",t),A.typeOf.object("options.gltfResource",o),A.typeOf.object("options.baseResource",r),A.typeOf.object("options.supportedImageFormats",s),A.typeOf.object("options.frameState",a),!c(e.extension)&&!c(e.extensionLegacy))throw new E("One of options.extension or options.extensionLegacy must be specified");this._gltfResource=o,this._baseResource=r,this._gltf=t,this._extension=n,this._extensionLegacy=i,this._supportedImageFormats=s,this._frameState=a,this._cacheKey=l,this._asynchronous=u,this._bufferViewLoaders=[],this._bufferViewIds=[],this._textureLoaders=[],this._textureIds=[],this._schemaLoader=void 0,this._structuralMetadata=void 0,this._state=yt.UNLOADED,this._promise=void 0}c(Object.create)&&(K_.prototype=Object.create(Zi.prototype),K_.prototype.constructor=K_);Object.defineProperties(K_.prototype,{cacheKey:{get:function(){return this._cacheKey}},structuralMetadata:{get:function(){return this._structuralMetadata}}});async function N3e(e){try{let t=U3e(e),n=W3e(e),i=q3e(e);return await Promise.all([t,n,i]),e.isDestroyed()?void 0:(e._gltf=void 0,e._state=yt.LOADED,e)}catch(t){if(e.isDestroyed())return;throw e.unload(),e._state=yt.FAILED,e.getError("Failed to load structural metadata",t)}}K_.prototype.load=function(){return c(this._promise)?this._promise:(this._state=yt.LOADING,this._promise=N3e(this),this._promise)};function F3e(e,t){for(let n in e)if(e.hasOwnProperty(n)){let i=e[n],o=i.values,r=i.arrayOffsets,s=i.stringOffsets;c(o)&&(t[o]=!0),c(r)&&(t[r]=!0),c(s)&&(t[s]=!0)}}function B3e(e,t){for(let n in e)if(e.hasOwnProperty(n)){let i=e[n],o=i.bufferView,r=i.arrayOffsetBufferView,s=i.stringOffsetBufferView;c(o)&&(t[o]=!0),c(r)&&(t[r]=!0),c(s)&&(t[s]=!0)}}function k3e(e){let t=e.propertyTables,n={};if(c(t))for(let i=0;i<t.length;i++){let o=t[i];F3e(o.properties,n)}return n}function V3e(e){let t=e.featureTables,n={};if(c(t)){for(let i in t)if(t.hasOwnProperty(i)){let r=t[i].properties;c(r)&&B3e(r,n)}}return n}async function U3e(e){let t;c(e._extension)?t=k3e(e._extension):t=V3e(e._extensionLegacy);let n=[];for(let i in t)if(t.hasOwnProperty(i)){let o=Ci.getBufferViewLoader({gltf:e._gltf,bufferViewId:parseInt(i),gltfResource:e._gltfResource,baseResource:e._baseResource});e._bufferViewLoaders.push(o),e._bufferViewIds.push(i),n.push(o.load())}return Promise.all(n)}function z3e(e){let t={},n=e.propertyTextures;if(c(n))for(let i=0;i<n.length;i++){let r=n[i].properties;c(r)&&H3e(r,t)}return t}function H3e(e,t){for(let n in e)if(e.hasOwnProperty(n)){let i=e[n];t[i.index]=i}}function G3e(e){let t={},n=e.featureTextures;if(c(n)){for(let i in n)if(n.hasOwnProperty(i)){let r=n[i].properties;c(r)&&j3e(r,t)}}return t}function j3e(e,t){for(let n in e)if(e.hasOwnProperty(n)){let o=e[n].texture;t[o.index]=o}}function W3e(e){let t;c(e._extension)?t=z3e(e._extension):t=G3e(e._extensionLegacy);let n=e._gltf,i=e._gltfResource,o=e._baseResource,r=e._supportedImageFormats,s=e._frameState,a=e._asynchronous,l=[];for(let u in t)if(t.hasOwnProperty(u)){let f=Ci.getTextureLoader({gltf:n,textureInfo:t[u],gltfResource:i,baseResource:o,supportedImageFormats:r,frameState:s,asynchronous:a});e._textureLoaders.push(f),e._textureIds.push(u),l.push(f.load())}return Promise.all(l)}async function q3e(e){let t=y(e._extension,e._extensionLegacy),n;if(c(t.schemaUri)){let i=e._baseResource.getDerivedResource({url:t.schemaUri});n=Ci.getSchemaLoader({resource:i})}else n=Ci.getSchemaLoader({schema:t.schema});if(e._schemaLoader=n,await n.load(),!n.isDestroyed())return n.schema}K_.prototype.process=function(e){if(A.typeOf.object("frameState",e),this._state===yt.READY)return!0;if(this._state!==yt.LOADED)return!1;let t=this._textureLoaders,n=t.length,i=!0;for(let a=0;a<n;++a){let u=t[a].process(e);i=i&&u}if(!i)return!1;let o=this._schemaLoader.schema,r={};for(let a=0;a<this._bufferViewIds.length;++a){let l=this._bufferViewIds[a],u=this._bufferViewLoaders[a];if(!u.isDestroyed()){let f=new Uint8Array(u.typedArray);r[l]=f}}let s={};for(let a=0;a<this._textureIds.length;++a){let l=this._textureIds[a],u=t[a];u.isDestroyed()||(s[l]=u.texture)}return c(this._extension)?this._structuralMetadata=t4({extension:this._extension,schema:o,bufferViews:r,textures:s}):this._structuralMetadata=n4({extension:this._extensionLegacy,schema:o,bufferViews:r,textures:s}),$ie(this),this._state=yt.READY,!0};function $ie(e){let t=e._bufferViewLoaders,n=t.length;for(let i=0;i<n;++i)Ci.unload(t[i]);e._bufferViewLoaders.length=0,e._bufferViewIds.length=0}function Y3e(e){let t=e._textureLoaders,n=t.length;for(let i=0;i<n;++i)Ci.unload(t[i]);e._textureLoaders.length=0,e._textureIds.length=0}K_.prototype.unload=function(){$ie(this),Y3e(this),c(this._schemaLoader)&&Ci.unload(this._schemaLoader),this._schemaLoader=void 0,this._structuralMetadata=void 0};var i4=K_;var pT={TRANSLATION:"TRANSLATION",ROTATION:"ROTATION",SCALE:"SCALE",FEATURE_ID:"_FEATURE_ID"};pT.fromGltfSemantic=function(e){A.typeOf.string("gltfSemantic",e);let t=e,i=/^(\w+)_\d+$/.exec(e);switch(i!==null&&(t=i[1]),t){case"TRANSLATION":return pT.TRANSLATION;case"ROTATION":return pT.ROTATION;case"SCALE":return pT.SCALE;case"_FEATURE_ID":return pT.FEATURE_ID}};var fs=Object.freeze(pT);var X3e=65534,K3e=255;function ZO(e){e=y(e,y.EMPTY_OBJECT);let t=e.triangleIndices,n=e.outlineIndices,i=e.originalVertexCount;A.typeOf.object("options.triangleIndices",t),A.typeOf.object("options.outlineIndices",n),A.typeOf.number("options.originalVertexCount",i),this._triangleIndices=t,this._originalVertexCount=i,this._edges=new Qie(n,i),this._outlineCoordinatesTypedArray=void 0,this._extraVertices=[],$3e(this)}Object.defineProperties(ZO.prototype,{updatedTriangleIndices:{get:function(){return this._triangleIndices}},outlineCoordinates:{get:function(){return this._outlineCoordinatesTypedArray}}});function $3e(e){let t=e._triangleIndices,n=e._edges,i=[],o=e._extraVertices,r=e._originalVertexCount,s={};for(let a=0;a<t.length;a+=3){let l=t[a],u=t[a+1],f=t[a+2],d=!1,p=d||n.hasEdge(l,u),g=d||n.hasEdge(u,f),m=d||n.hasEdge(f,l),b=Zie(i,l,u,f,p,g,m);for(;c(b);){let x=s[b];if(!c(x)){x=r+o.length;let T=b;for(;T>=r;)T=o[T-r];o.push(T),s[b]=x}x>X3e&&(t instanceof Uint16Array||t instanceof Uint8Array)?t=new Uint32Array(t):x>K3e&&t instanceof Uint8Array&&(t=new Uint16Array(t)),b===l?(l=x,t[a]=x):b===u?(u=x,t[a+1]=x):(f=x,t[a+2]=x),b=Zie(i,l,u,f,p,g,m)}}e._triangleIndices=t,e._outlineCoordinatesTypedArray=new Float32Array(i)}function Zie(e,t,n,i,o,r,s){let a=s?1:0,l=o?1:0,u=0,f=o4(e,t,a,l,u);if(f===0)return t;let d=0,p=o?1:0,g=r?1:0,m=o4(e,n,d,p,g);if(m===0)return n;let b=s?1:0,x=0,T=r?1:0,C=o4(e,i,b,x,T);if(C===0)return i;let S=f&m&C,v,D,I;if(S&1)v=0,D=1,I=2;else if(S&2)v=0,I=1,D=2;else if(S&4)D=0,v=1,I=2;else if(S&8)D=0,I=1,v=2;else if(S&16)I=0,v=1,D=2;else if(S&32)I=0,D=1,v=2;else{let B=r4(f),_=r4(m),w=r4(C);return B<_&&B<w?t:_<w?n:i}let L=t*3;e[L+v]=a,e[L+D]=l,e[L+I]=u;let M=n*3;e[M+v]=d,e[M+D]=p,e[M+I]=g;let N=i*3;e[N+v]=b,e[N+D]=x,e[N+I]=T}function o4(e,t,n,i,o){let r=t*3,s=e[r],a=e[r+1],l=e[r+2];return c(s)?(s===n&&a===i&&l===o)<<0|(s===n&&a===o&&l===i)<<1|(s===i&&a===n&&l===o)<<2|(s===i&&a===o&&l===n)<<3|(s===o&&a===n&&l===i)<<4|(s===o&&a===i&&l===n)<<5:63}function r4(e){return(e&1)+(e>>1&1)+(e>>2&1)+(e>>3&1)+(e>>4&1)+(e>>5&1)}ZO.prototype.updateAttribute=function(e){let t=this._extraVertices,n=e.length,i=n/this._originalVertexCount,o=t.length,r=e.constructor,s=new r(e.length+o*i);s.set(e);for(let a=0;a<o;a++){let l=t[a]*i,u=n+a*i;for(let f=0;f<i;f++)s[u+f]=s[l+f]}return s};ZO.createTexture=function(e){let t=e.cache.modelOutliningCache;if(c(t)||(t=e.cache.modelOutliningCache={}),c(t.outlineTexture))return t.outlineTexture;let n=Math.min(4096,mt.maximumTextureSize),i=n,o=Jie(i),r=[];for(;i>1;)i>>=1,r.push(Jie(i));let s=new Lt({context:e,source:{arrayBufferView:o,mipLevels:r},width:n,height:1,pixelFormat:Ve.LUMINANCE,sampler:new Qt({wrapS:yn.CLAMP_TO_EDGE,wrapT:yn.CLAMP_TO_EDGE,minificationFilter:$t.LINEAR_MIPMAP_LINEAR,magnificationFilter:fi.LINEAR})});return t.outlineTexture=s,s};function Jie(e){let t=new Uint8Array(e);return t[e-1]=192,e===8?t[e-1]=96:e===4?t[e-1]=48:e===2?t[e-1]=24:e===1&&(t[e-1]=12),t}function Qie(e,t){this._originalVertexCount=t,this._edges=new Set;for(let n=0;n<e.length;n+=2){let i=e[n],o=e[n+1],r=Math.min(i,o),s=Math.max(i,o),a=r*this._originalVertexCount+s;this._edges.add(a)}}Qie.prototype.hasEdge=function(e,t){let n=Math.min(e,t),i=Math.max(e,t),o=n*this._originalVertexCount+i;return this._edges.has(o)};var sw=ZO;function eoe(e){A.typeOf.object("attribute",e),this.attribute=e,this.loadBuffer=!1,this.loadTypedArray=!1}function Z3e(e){A.typeOf.object("indices",e),this.indices=e,this.loadBuffer=!1,this.loadTypedArray=!1}function JO(e){A.typeOf.object("primitive",e),this.primitive=e,this.attributePlans=[],this.indicesPlan=void 0,this.needsOutlines=!1,this.outlineIndices=void 0}JO.prototype.postProcess=function(e){this.needsOutlines&&(J3e(this),eke(this,e))};function J3e(e){let t=e.primitive,n=t.indices,i=t.attributes[0].count,o=new sw({triangleIndices:n.typedArray,outlineIndices:e.outlineIndices,originalVertexCount:i});n.typedArray=o.updatedTriangleIndices,n.indexDatatype=Fe.fromTypedArray(n.typedArray);let r=Q3e(o.outlineCoordinates),s=new eoe(r);s.loadBuffer=!0,s.loadTypedArray=!1,e.attributePlans.push(s),t.outlineCoordinates=s.attribute;let a=e.attributePlans,l=e.attributePlans.length;for(let u=0;u<l;u++){let f=a[u].attribute;f.typedArray=o.updateAttribute(f.typedArray)}}function Q3e(e){let t=new Sn.Attribute;return t.name="_OUTLINE_COORDINATES",t.typedArray=e,t.componentDatatype=$.FLOAT,t.type=cn.VEC3,t.normalized=!1,t.count=e.length/3,t}function eke(e,t){tke(e.attributePlans,t),c(e.indicesPlan)&&nke(e.indicesPlan,t)}function tke(e,t){let n=e.length;for(let i=0;i<n;i++){let o=e[i],r=o.attribute,s=r.typedArray;if(o.loadBuffer){let a=xt.createVertexBuffer({typedArray:s,context:t,usage:ke.STATIC_DRAW});a.vertexArrayDestroyable=!1,r.buffer=a}o.loadTypedArray||(r.typedArray=void 0)}}function nke(e,t){let n=e.indices;if(e.loadBuffer){let i=xt.createIndexBuffer({typedArray:n.typedArray,context:t,usage:ke.STATIC_DRAW,indexDatatype:n.indexDatatype});n.buffer=i,i.vertexArrayDestroyable=!1}e.loadTypedArray||(n.typedArray=void 0)}JO.AttributeLoadPlan=eoe;JO.IndicesLoadPlan=Z3e;var aw=JO;function ike(e){e=y(e,y.EMPTY_OBJECT),this.webp=y(e.webp,!1),this.basis=y(e.basis,!1)}var s4=ike;function toe(e){A.typeOf.object("options.position",e.position),A.typeOf.object("options.adjustmentParams",e.adjustmentParams),this._position=e.position,this._adjustmentParams=e.adjustmentParams}Object.defineProperties(toe.prototype,{position:{get:function(){return this._position}},adjustmentParams:{get:function(){return this._adjustmentParams}}});var a4=toe;function noe(e){A.typeOf.object("options.position",e.position),A.typeOf.object("options.adjustmentParams",e.adjustmentParams),A.typeOf.object("options.covarianceMatrix",e.covarianceMatrix),this._position=e.position,this._adjustmentParams=e.adjustmentParams,this._covarianceMatrix=e.covarianceMatrix}Object.defineProperties(noe.prototype,{position:{get:function(){return this._position}},adjustmentParams:{get:function(){return this._adjustmentParams}},covarianceMatrix:{get:function(){return this._covarianceMatrix}}});var c4=noe;function ioe(e){A.typeOf.object("options.groupFlags",e.groupFlags),A.typeOf.object("options.rotationThetas",e.rotationThetas),A.typeOf.object("options.params",e.params),this._groupFlags=e.groupFlags,this._rotationThetas=e.rotationThetas,this._params=e.params}Object.defineProperties(ioe.prototype,{groupFlags:{get:function(){return this._groupFlags}},rotationThetas:{get:function(){return this._rotationThetas}},params:{get:function(){return this._params}}});var l4=ioe;var oke={Direct:"Direct",Indirect:"Indirect"},$_=Object.freeze(oke);function ooe(e){if(A.typeOf.string("options.storageType",e.storageType),this._storageType=e.storageType,this._anchorPointsIndirect=e.anchorPointsIndirect,this._anchorPointsDirect=e.anchorPointsDirect,this._intraTileCorrelationGroups=e.intraTileCorrelationGroups,this._covarianceDirect=e.covarianceDirect,this.storageType===$_.Indirect){if(!c(this.anchorPointsIndirect))throw new ue("The anchorPointsIndirect are required for 'Indirect' storage");if(!c(this.intraTileCorrelationGroups))throw new ue("The intraTileCorrelationGroups are required for 'Indirect' storage");if(c(this.anchorPointsDirect))throw new ue("The anchorPointsDirect must be omitted for 'Indirect' storage");if(c(this.covarianceDirect))throw new ue("The covarianceDirect must be omitted for 'Indirect' storage")}else{if(!c(this.anchorPointsDirect))throw new ue("The anchorPointsDirect are required for 'Direct' storage");if(!c(this.covarianceDirect))throw new ue("The covarianceDirect is required for 'Direct' storage");if(c(this.anchorPointsIndirect))throw new ue("The anchorPointsIndirect must be omitted for 'Direct' storage");if(c(this.intraTileCorrelationGroups))throw new ue("The intraTileCorrelationGroups must be omitted for 'Direct' storage")}}Object.defineProperties(ooe.prototype,{storageType:{get:function(){return this._storageType}},anchorPointsIndirect:{get:function(){return this._anchorPointsIndirect}},anchorPointsDirect:{get:function(){return this._anchorPointsDirect}},intraTileCorrelationGroups:{get:function(){return this._intraTileCorrelationGroups}},covarianceDirect:{get:function(){return this._covarianceDirect}}});var QO=ooe;function roe(e){A.typeOf.number.greaterThan("options.A",e.A,0),A.typeOf.number.lessThanOrEquals("options.A",e.A,1),A.typeOf.number.greaterThanOrEquals("options.alpha",e.alpha,0),A.typeOf.number.lessThan("options.alpha",e.alpha,1),A.typeOf.number.greaterThanOrEquals("options.beta",e.beta,0),A.typeOf.number.lessThanOrEquals("options.beta",e.beta,10),A.typeOf.number.greaterThan("options.T",e.T,0),this._A=e.A,this._alpha=e.alpha,this._beta=e.beta,this._T=e.T}Object.defineProperties(roe.prototype,{A:{get:function(){return this._A}},alpha:{get:function(){return this._alpha}},beta:{get:function(){return this._beta}},T:{get:function(){return this._T}}});var u4=roe;function _T(){}function soe(e){return new Q(e[0],e[1],e[3],e[1],e[2],e[4],e[3],e[4],e[5])}function rke(e){let t=h.fromArray(e.position,0,new h),n=h.fromArray(e.adjustmentParams,0,new h);return new a4({position:t,adjustmentParams:n})}function ske(e){let t=h.fromArray(e.position,0,new h),n=h.fromArray(e.adjustmentParams,0,new h),i=soe(e.covarianceMatrix);return new c4({position:t,adjustmentParams:n,covarianceMatrix:i})}function ake(e){let t=e.groupFlags,n=h.fromArray(e.rotationThetas,0,new h),i=[];for(let r of e.params){let s=new u4({A:r.A,alpha:r.alpha,beta:r.beta,T:r.T});i.push(s)}return new l4({groupFlags:t,rotationThetas:n,params:i})}_T.load=function(e){A.typeOf.object("gltfGpmLocalJson",e);let t=e.storageType;if(t===$_.Direct)return _T.loadDirect(e);if(t===$_.Indirect)return _T.loadIndirect(e);throw new ue(`Invalid storage type in NGA_gpm_local - expected 'Direct' or 'Indirect', but found ${t}`)};_T.loadDirect=function(e){A.typeOf.object("gltfGpmLocalJson",e),A.typeOf.object("gltfGpmLocalJson.anchorPointsDirect",e.anchorPointsDirect),A.typeOf.object("gltfGpmLocalJson.covarianceDirectUpperTriangle",e.covarianceDirectUpperTriangle);let t=[],n=e.anchorPointsDirect;for(let r of n){let s=rke(r);t.push(s)}let i=soe(e.covarianceDirectUpperTriangle);return new QO({storageType:$_.Direct,anchorPointsDirect:t,covarianceDirect:i})};_T.loadIndirect=function(e){A.typeOf.object("gltfGpmLocalJson",e),A.typeOf.object("gltfGpmLocalJson.anchorPointsIndirect",e.anchorPointsIndirect),A.typeOf.object("gltfGpmLocalJson.intraTileCorrelationGroups",e.intraTileCorrelationGroups);let t=[],n=e.anchorPointsIndirect;for(let s of n){let a=ske(s);t.push(a)}let i=e.intraTileCorrelationGroups,o=[];for(let s of i){let a=ake(s);o.push(a)}return new QO({storageType:$_.Indirect,anchorPointsIndirect:t,intraTileCorrelationGroups:o})};var f4=_T;function aoe(e){A.typeOf.object("options.traits",e.traits),A.typeOf.number.greaterThanOrEquals("options.index",e.index,0),this._traits=e.traits,this._noData=e.noData,this._offset=e.offset,this._scale=e.scale,this._index=e.index,this._texCoord=e.texCoord}Object.defineProperties(aoe.prototype,{traits:{get:function(){return this._traits}},noData:{get:function(){return this._noData}},offset:{get:function(){return this._offset}},scale:{get:function(){return this._scale}},index:{get:function(){return this._index}},texCoord:{get:function(){return this._texCoord}}});var d4=aoe;function coe(e){A.typeOf.string("options.source",e.source),this._min=e.min,this._max=e.max,this._source=e.source}Object.defineProperties(coe.prototype,{min:{get:function(){return this._min}},max:{get:function(){return this._max}},source:{get:function(){return this._source}}});var h4=coe;function loe(e){this._ppeTextures=e}Object.defineProperties(loe.prototype,{ppeTextures:{get:function(){return this._ppeTextures}}});var m4=loe;function gr(e){e=y(e,y.EMPTY_OBJECT);let t=e.gltf,n=e.extension,i=e.gltfResource,o=e.baseResource,r=e.supportedImageFormats,s=e.frameState,a=e.cacheKey,l=y(e.asynchronous,!0);A.typeOf.object("options.gltf",t),A.typeOf.object("options.extension",n),A.typeOf.object("options.gltfResource",i),A.typeOf.object("options.baseResource",o),A.typeOf.object("options.supportedImageFormats",r),A.typeOf.object("options.frameState",s),this._gltfResource=i,this._baseResource=o,this._gltf=t,this._extension=n,this._supportedImageFormats=r,this._frameState=s,this._cacheKey=a,this._asynchronous=l,this._textureLoaders=[],this._textureIds=[],this._meshPrimitiveGpmLocal=void 0,this._structuralMetadata=void 0,this._state=yt.UNLOADED,this._promise=void 0}c(Object.create)&&(gr.prototype=Object.create(Zi.prototype),gr.prototype.constructor=gr);Object.defineProperties(gr.prototype,{cacheKey:{get:function(){return this._cacheKey}},meshPrimitiveGpmLocal:{get:function(){return this._meshPrimitiveGpmLocal}},structuralMetadata:{get:function(){return this._structuralMetadata}}});gr.prototype._loadResources=async function(){try{return await this._loadTextures(),this.isDestroyed()?void 0:(this._gltf=void 0,this._state=yt.LOADED,this)}catch(e){if(this.isDestroyed())return;throw this.unload(),this._state=yt.FAILED,this.getError("Failed to load GPM data",e)}};gr.prototype.load=function(){return c(this._promise)?this._promise:(this._state=yt.LOADING,this._promise=this._loadResources(this),this._promise)};function cke(e){let t={},n=e.ppeTextures;if(c(n))for(let i=0;i<n.length;i++){let o=n[i];t[o.index]=o}return t}gr.prototype._loadTextures=function(){let e;c(this._extension)&&(e=cke(this._extension));let t=this._gltf,n=this._gltfResource,i=this._baseResource,o=this._supportedImageFormats,r=this._frameState,s=this._asynchronous,a=[];for(let l in e)if(e.hasOwnProperty(l)){let u=Ci.getTextureLoader({gltf:t,textureInfo:e[l],gltfResource:n,baseResource:i,supportedImageFormats:o,frameState:r,asynchronous:s});this._textureLoaders.push(u),this._textureIds.push(l),a.push(u.load())}return Promise.all(a)};gr.ppeTexturesMetadataSchemaCache=new Map;gr._createPpeTextureClassJson=function(e,t){let n=e.traits,i=n.source;return{name:`PPE texture class ${t}`,properties:{[i]:{name:"PPE",type:"SCALAR",componentType:"UINT8",normalized:!0,min:n.min,max:n.max}}}};gr._obtainPpeTexturesMetadataSchema=function(e){let n=gr._collectPpeTexturePropertyIdentifiers(e).toString(),i=gr.ppeTexturesMetadataSchemaCache.get(n);if(c(i))return i;let r={id:`PPE_TEXTURE_SCHEMA_${gr.ppeTexturesMetadataSchemaCache.size}`,classes:{}},s=e.ppeTextures;for(let a=0;a<s.length;a++){let l=s[a],u=`ppeTexture_${a}`,f=gr._createPpeTextureClassJson(l,a);r.classes[u]=f}return i=Qf.fromJson(r),gr.ppeTexturesMetadataSchemaCache.set(n,i),i};gr._collectPpeTexturePropertyIdentifiers=function(e){let t=[],n=e.ppeTextures;for(let i=0;i<n.length;i++){let o=n[i],r=gr._createPpeTextureClassJson(o,i),s=JSON.stringify(r);t.push(s)}return t};gr._convertToStructuralMetadata=function(e,t){let n=[],i=gr._obtainPpeTexturesMetadataSchema(e),o=e.ppeTextures;for(let s=0;s<o.length;s++){let a=o[s],l=`ppeTexture_${s}`,f=a.traits.source,d=i.classes[l],p=(a.scale??1)*255,g={class:l,properties:{[f]:{index:a.index,texCoord:a.texCoord,offset:a.offset,scale:p}}};n.push(new E0({id:s,name:a.name,propertyTexture:g,class:d,textures:t}))}return new ua({schema:i,propertyTables:[],propertyTextures:n,propertyAttributes:[]})};gr.prototype.process=function(e){if(A.typeOf.object("frameState",e),this._state===yt.READY)return!0;if(this._state!==yt.LOADED)return!1;let t=this._textureLoaders,n=t.length,i=!0;for(let u=0;u<n;++u){let d=t[u].process(e);i=i&&d}if(!i)return!1;let o={};for(let u=0;u<this._textureIds.length;++u){let f=this._textureIds[u],d=t[u];d.isDestroyed()||(o[f]=d.texture)}let r=[],s=this._extension;if(c(s.ppeTextures)){let u=s.ppeTextures;for(let f of u){let d=f.traits,p=new h4({min:d.min,max:d.max,source:d.source}),g=new d4({traits:p,noData:f.noData,offset:f.offset,scale:f.scale,index:f.index,texCoord:f.texCoord});r.push(g)}}let a=new m4(r);this._meshPrimitiveGpmLocal=a;let l=gr._convertToStructuralMetadata(a,o);return this._structuralMetadata=l,this._state=yt.READY,!0};gr.prototype._unloadTextures=function(){let e=this._textureLoaders,t=e.length;for(let n=0;n<t;++n)Ci.unload(e[n]);this._textureLoaders.length=0,this._textureIds.length=0};gr.prototype.unload=function(){this._unloadTextures(),this._gltf=void 0,this._extension=void 0,this._structuralMetadata=void 0};var p4=gr;var{Attribute:lke,Indices:uke,FeatureIdAttribute:uoe,FeatureIdTexture:foe,FeatureIdImplicitRange:doe,MorphTarget:fke,Primitive:dke,Instances:hke,Skin:mke,Node:pke,AnimatedPropertyType:_ke,AnimationSampler:gke,AnimationTarget:yke,AnimationChannel:bke,Animation:xke,ArticulationStage:Tke,Articulation:Ake,Asset:Cke,Scene:Eke,Components:Ske,MetallicRoughness:wke,SpecularGlossiness:vke,Specular:Dke,Anisotropy:_4,Clearcoat:g4,Material:Pke}=Sn,Co={NOT_LOADED:0,LOADING:1,LOADED:2,PROCESSING:3,POST_PROCESSING:4,PROCESSED:5,READY:6,FAILED:7,UNLOADED:8};function nd(e){e=y(e,y.EMPTY_OBJECT);let{gltfResource:t,typedArray:n,releaseGltfJson:i=!1,asynchronous:o=!0,incrementallyLoadTextures:r=!0,upAxis:s=zo.Y,forwardAxis:a=zo.Z,loadAttributesAsTypedArray:l=!1,loadAttributesFor2D:u=!1,enablePick:f=!1,loadIndicesForWireframe:d=!1,loadPrimitiveOutline:p=!0,loadForClassification:g=!1,renameBatchIdSemantic:m=!1}=e;A.typeOf.object("options.gltfResource",t);let{baseResource:b=t.clone()}=e;this._gltfJson=e.gltfJson,this._gltfResource=t,this._baseResource=b,this._typedArray=n,this._releaseGltfJson=i,this._asynchronous=o,this._incrementallyLoadTextures=r,this._upAxis=s,this._forwardAxis=a,this._loadAttributesAsTypedArray=l,this._loadAttributesFor2D=u,this._enablePick=f,this._loadIndicesForWireframe=d,this._loadPrimitiveOutline=p,this._loadForClassification=g,this._renameBatchIdSemantic=m,this._sortedPropertyTableIds=void 0,this._sortedFeatureTextureIds=void 0,this._gltfJsonLoader=void 0,this._state=Co.NOT_LOADED,this._textureState=Co.NOT_LOADED,this._promise=void 0,this._processError=void 0,this._textureErrors=[],this._primitiveLoadPlans=[],this._loaderPromises=[],this._textureLoaders=[],this._texturesPromises=[],this._textureCallbacks=[],this._bufferViewLoaders=[],this._geometryLoaders=[],this._geometryCallbacks=[],this._structuralMetadataLoader=void 0,this._meshPrimitiveGpmLoader=void 0,this._loadResourcesPromise=void 0,this._resourcesLoaded=!1,this._texturesLoaded=!1,this._supportedImageFormats=void 0,this._postProcessBuffers=[],this._components=void 0}c(Object.create)&&(nd.prototype=Object.create(Zi.prototype),nd.prototype.constructor=nd);Object.defineProperties(nd.prototype,{cacheKey:{get:function(){}},components:{get:function(){return this._components}},gltfJson:{get:function(){return c(this._gltfJsonLoader)?this._gltfJsonLoader.gltf:this._gltfJson}},incrementallyLoadTextures:{get:function(){return this._incrementallyLoadTextures}},texturesLoaded:{get:function(){return this._texturesLoaded}}});async function Ike(e){e._state=Co.LOADING,e._textureState=Co.LOADING;try{let t=Ci.getGltfJsonLoader({gltfResource:e._gltfResource,baseResource:e._baseResource,typedArray:e._typedArray,gltfJson:e._gltfJson});return e._gltfJsonLoader=t,await t.load(),e.isDestroyed()||e.isUnloaded()||t.isDestroyed()?void 0:(e._state=Co.LOADED,e._textureState=Co.LOADED,e)}catch(t){if(e.isDestroyed())return;e._state=Co.FAILED,e._textureState=Co.FAILED,e1(e,t)}}async function Oke(e,t){zt.supportsWebP.initialized||await zt.supportsWebP.initialize(),e._supportedImageFormats=new s4({webp:zt.supportsWebP(),basis:t.context.supportsBasis});let n=LVe(e,t);return e._state=Co.PROCESSING,e._textureState=Co.PROCESSING,c(e._gltfJsonLoader)&&e._releaseGltfJson&&(Ci.unload(e._gltfJsonLoader),e._gltfJsonLoader=void 0),n}nd.prototype.load=async function(){return c(this._promise)?this._promise:(this._promise=Ike(this),this._promise)};function e1(e,t){throw e.unload(),e.getError("Failed to load glTF",t)}function Rke(e,t){let n=!0,i=e._geometryLoaders;for(let s=0;s<i.length;++s){let a=i[s].process(t);a&&c(e._geometryCallbacks[s])&&(e._geometryCallbacks[s](),e._geometryCallbacks[s]=void 0),n=n&&a}let o=e._structuralMetadataLoader;if(c(o)){let s=o.process(t);s&&(e._components.structuralMetadata=o.structuralMetadata),n=n&&s}let r=e._meshPrimitiveGpmLoader;if(c(r)){let s=r.process(t);s&&(c(e._components.structuralMetadata)&&_t("structural-metadata-gpm","The model defines both the 'EXT_structural_metadata' extension and the 'NGA_gpm_local' extension. The data from the 'EXT_structural_metadata' extension will be replaced with the data from the 'NGA_gpm_local' extension, and will no longer be available for styling and picking."),e._components.structuralMetadata=r.structuralMetadata),n=n&&s}n&&(e._state=Co.POST_PROCESSING)}function Mke(e,t){let n=e._primitiveLoadPlans;for(let i=0;i<n.length;i++){let o=n[i];o.postProcess(t),o.needsOutlines&&Lke(e,o)}}function Lke(e,t){let n=e._postProcessBuffers,i=t.primitive,o=i.outlineCoordinates;c(o)&&n.push(o.buffer);let r=i.attributes;for(let a=0;a<r.length;a++){let l=r[a];c(l.buffer)&&n.push(l.buffer)}let s=i.indices;c(s)&&c(s.buffer)&&n.push(s.buffer)}nd.prototype._process=function(e){return this._state===Co.READY?!0:(this._state===Co.PROCESSING&&Rke(this,e),this._resourcesLoaded&&this._state===Co.POST_PROCESSING&&(Mke(this,e.context),this._state=Co.PROCESSED),this._resourcesLoaded&&this._state===Co.PROCESSED?(Toe(this),this._typedArray=void 0,this._state=Co.READY,!0):!1)};nd.prototype._processTextures=function(e){if(this._textureState===Co.READY)return!0;if(this._textureState!==Co.PROCESSING)return!1;let t=!0,n=this._textureLoaders;for(let i=0;i<n.length;++i){let o=n[i].process(e);o&&c(this._textureCallbacks[i])&&(this._textureCallbacks[i](),this._textureCallbacks[i]=void 0),t=t&&o}return t?(this._textureState=Co.READY,this._texturesLoaded=!0,!0):!1};nd.prototype.process=function(e){if(A.typeOf.object("frameState",e),this._state===Co.LOADED&&!c(this._loadResourcesPromise)&&(this._loadResourcesPromise=Oke(this,e).then(()=>{this._resourcesLoaded=!0}).catch(o=>{this._processError=o})),c(this._processError)){this._state=Co.FAILED;let o=this._processError;this._processError=void 0,e1(this,o)}let t=this._textureErrors.pop();if(c(t)){let o=this.getError("Failed to load glTF texture",t);throw o.name="TextureError",o}if(this._state===Co.FAILED)return!1;let n=!1;try{n=this._process(e)}catch(o){this._state=Co.FAILED,e1(this,o)}let i=!1;try{i=this._processTextures(e)}catch(o){this._textureState=Co.FAILED,e1(this,o)}return this._incrementallyLoadTextures?n:n&&i};function Nke(e,t,n,i,o,r,s){let a=e.gltfJson,u=a.accessors[t].bufferView;return Ci.getVertexBufferLoader({gltf:a,gltfResource:e._gltfResource,baseResource:e._baseResource,frameState:s,bufferViewId:u,draco:i,attributeSemantic:n,accessorId:t,asynchronous:e._asynchronous,loadBuffer:o,loadTypedArray:r})}function Fke(e,t,n,i,o,r){return Ci.getIndexBufferLoader({gltf:e.gltfJson,accessorId:t,gltfResource:e._gltfResource,baseResource:e._baseResource,frameState:r,draco:n,asynchronous:e._asynchronous,loadBuffer:i,loadTypedArray:o})}function Bke(e,t){let n=Ci.getBufferViewLoader({gltf:e.gltfJson,bufferViewId:t,gltfResource:e._gltfResource,baseResource:e._baseResource});return e._bufferViewLoaders.push(n),n}function hoe(e,t,n){let i=t.byteOffset,o=Yu(e,t),r=t.count,s=Jf(t.type),a=t.componentType,l=$.getSizeInBytes(a),u=l*s,f=r*s;if(o===u)return n=new Uint8Array(n),$.createArrayBufferView(a,n.buffer,n.byteOffset+i,f);let d=$.createTypedArray(a,f),p=new DataView(n.buffer),g=new Array(s),m=m0(t.componentType);i=n.byteOffset+i;for(let b=0;b<r;++b){m(p,i,s,l,g);for(let x=0;x<s;++x)d[b*s+x]=g[x];i+=o}return d}function kke(e,t){let n=e.type;if(n===cn.SCALAR)return t.fill(0);let i=cn.getMathType(n);return t.fill(i.clone(i.ZERO))}function Vke(e,t,n,i){let o=e.type,r=e.count;if(o===cn.SCALAR)for(let s=0;s<r;s++)n[s]=t[s];else if(o===cn.VEC4&&i)for(let s=0;s<r;s++)n[s]=Ne.unpack(t,s*4);else{let s=cn.getMathType(o),a=cn.getNumberOfComponents(o);for(let l=0;l<r;l++)n[l]=s.unpack(t,l*a)}return n}async function Uke(e,t,n,i,o){let{gltfJson:r}=e;if(await t.load(),e.isDestroyed())return;let s=hoe(r,n,t.typedArray);i=y(i,!1),Vke(n,s,o,i)}function t1(e,t,n){let i=new Array(t.count),o=t.bufferView;if(c(o)){let r=Bke(e,o),s=Uke(e,r,t,n,i);return e._loaderPromises.push(s),i}return kke(t,i)}function Gl(e,t){if(c(t))return e===Number?t[0]:e.unpack(t)}function zke(e){return e===Number?0:new e}function Hke(e){switch(e){case $.BYTE:return 127;case $.UNSIGNED_BYTE:return 255;case $.SHORT:return 32767;case $.UNSIGNED_SHORT:return 65535;default:return 1}}var Gke={VEC2:new H(-1,-1),VEC3:new h(-1,-1,-1),VEC4:new se(-1,-1,-1,-1)};function jke(e,t){let n=Hke(e.componentDatatype),i=Gke[e.type],o=e.min;c(o)&&(o=t.divideByScalar(o,n,o),o=t.maximumByComponent(o,i,o));let r=e.max;c(r)&&(r=t.divideByScalar(r,n,r),r=t.maximumByComponent(r,i,r)),e.min=o,e.max=r}function Wke(e,t,n){let i=e.decodeMatrix,o=Gl(n,e.decodedMin),r=Gl(n,e.decodedMax);c(o)&&c(r)&&(t.min=o,t.max=r);let s=new Sn.Quantization;s.componentDatatype=t.componentDatatype,s.type=t.type,i.length===4?(s.quantizedVolumeOffset=i[2],s.quantizedVolumeStepSize=i[0]):i.length===9?(s.quantizedVolumeOffset=new H(i[6],i[7]),s.quantizedVolumeStepSize=new H(i[0],i[4])):i.length===16?(s.quantizedVolumeOffset=new h(i[12],i[13],i[14]),s.quantizedVolumeStepSize=new h(i[0],i[5],i[10])):i.length===25&&(s.quantizedVolumeOffset=new se(i[20],i[21],i[22],i[23]),s.quantizedVolumeStepSize=new se(i[0],i[6],i[12],i[18])),t.quantization=s}function qke(e,t,n,i,o){let r=e.accessors[t],s=cn.getMathType(r.type),a=y(r.normalized,!1),l=new lke;l.name=n,l.semantic=i,l.setIndex=o,l.constant=zke(s),l.componentDatatype=r.componentType,l.normalized=a,l.count=r.count,l.type=r.type,l.min=Gl(s,r.min),l.max=Gl(s,r.max),l.byteOffset=r.byteOffset,l.byteStride=Yu(e,r),si(r,"WEB3D_quantized_attributes")&&Wke(r.extensions.WEB3D_quantized_attributes,l,s);let u=l.semantic===Ct.POSITION||l.semantic===Ct.NORMAL||l.semantic===Ct.TANGENT||l.semantic===Ct.TEXCOORD;return e.extensionsRequired?.includes("KHR_mesh_quantization")&&a&&u&&jke(l,s),l}function moe(e){let n=/^\w+_(\d+)$/.exec(e);if(n!==null)return parseInt(n[1])}var Yke={gltfSemantic:void 0,renamedSemantic:void 0,modelSemantic:void 0};function y4(e,t,n){let i=n;e._renameBatchIdSemantic&&(n==="_BATCHID"||n==="BATCHID")&&(i="_FEATURE_ID_0");let o=t.fromGltfSemantic(i),r=Yke;return r.gltfSemantic=n,r.renamedSemantic=i,r.modelSemantic=o,r}function Xke(e){let t=e===Ct.POSITION,n=e===Ct.FEATURE_ID,i=e===Ct.TEXCOORD;return t||n||i}function Kke(e,t,n,i){if(e.byteOffset=0,e.byteStride=void 0,e.quantization=t.quantization,n&&(e.buffer=t.buffer),i){let o=c(t.quantization)?t.quantization.componentDatatype:e.componentDatatype;e.typedArray=$.createArrayBufferView(o,t.typedArray.buffer)}}function $ke(e,t,n,i,o,r){if(o&&(n.buffer=i.buffer),r){let s=i.typedArray;n.typedArray=hoe(e,t,s),o||(n.byteOffset=0,n.byteStride=void 0)}}function poe(e,t,n,i,o,r,s){let a=e.gltfJson,l=a.accessors[t],u=l.bufferView,f=n.gltfSemantic,d=n.renamedSemantic,p=n.modelSemantic,g=c(p)?moe(d):void 0,b=qke(a,t,f,p,g);if(!c(i)&&!c(u))return b;let x=Nke(e,t,f,i,o,r,s),T=e._geometryLoaders.length;e._geometryLoaders.push(x);let C=x.load();return e._loaderPromises.push(C),e._geometryCallbacks[T]=()=>{c(i)&&c(i.attributes)&&c(i.attributes[f])?Kke(b,x,o,r):$ke(a,l,b,x,o,r)},b}function _oe(e,t,n,i,o,r,s){let a=n.modelSemantic,l=a===Ct.POSITION,u=a===Ct.FEATURE_ID,f=l&&!o&&e._loadAttributesFor2D&&!s.scene3DOnly,d=l&&e._enablePick&&!s.context.webgl2,p=e._loadForClassification&&u,g=e._loadAttributesAsTypedArray,m=!g,b=g||f||d||p,C=poe(e,t,n,i,r?!1:m,r?!0:b,s),S=new aw.AttributeLoadPlan(C);return S.loadBuffer=m,S.loadTypedArray=b,S}function Zke(e,t,n,i,o){let r=e.gltfJson.accessors,s=c(n.ROTATION),a=c(n.TRANSLATION)&&c(r[n.TRANSLATION].min)&&c(r[n.TRANSLATION].max),l=y4(e,fs,i),u=l.modelSemantic,f=u===fs.TRANSLATION||u===fs.ROTATION||u===fs.SCALE,d=u===fs.TRANSLATION,p=e._loadAttributesAsTypedArray||s&&f||!o.context.instancedArrays,g=e._enablePick&&!o.context.webgl2,m=!p,b=e._loadAttributesFor2D&&!o.scene3DOnly;return poe(e,t,l,void 0,m,p||d&&(!a||b||g),o)}function Jke(e,t,n,i,o,r){let s=e.gltfJson.accessors[t],a=s.bufferView;if(!c(n)&&!c(a))return;let l=new uke;l.count=s.count;let u=e._loadAttributesAsTypedArray,f=(e._loadIndicesForWireframe||e._enablePick)&&!r.context.webgl2,d=e._loadForClassification&&i,g=!u,m=u||f||d,T=Fke(e,t,n,o?!1:g,o?!0:m,r),C=e._geometryLoaders.length;e._geometryLoaders.push(T);let S=T.load();e._loaderPromises.push(S),e._geometryCallbacks[C]=()=>{l.indexDatatype=T.indexDatatype,l.buffer=T.buffer,l.typedArray=T.typedArray};let v=new aw.IndicesLoadPlan(l);return v.loadBuffer=g,v.loadTypedArray=m,v}function Ac(e,t,n,i){let o=e.gltfJson,r=Xu.getImageIdFromTexture({gltf:o,textureId:t.index,supportedImageFormats:e._supportedImageFormats});if(!c(r))return;let s=Ci.getTextureLoader({gltf:o,textureInfo:t,gltfResource:e._gltfResource,baseResource:e._baseResource,supportedImageFormats:e._supportedImageFormats,frameState:n,asynchronous:e._asynchronous}),a=Xu.createModelTextureReader({textureInfo:t}),l=e._textureLoaders.length;e._textureLoaders.push(s);let u=s.load().catch(f=>{if(!e.isDestroyed()){if(!e._incrementallyLoadTextures)throw f;e._textureState=Co.FAILED,e._textureErrors.push(f)}});return e._texturesPromises.push(u),e._textureCallbacks[l]=()=>{a.texture=s.texture,c(i)&&(a.texture.sampler=i)},a}function Qke(e,t,n){let{diffuseTexture:i,specularGlossinessTexture:o,diffuseFactor:r,specularFactor:s,glossinessFactor:a}=t,l=new vke;return c(i)&&(l.diffuseTexture=Ac(e,i,n)),c(o)&&(l.specularGlossinessTexture=Ac(e,o,n)),l.diffuseFactor=Gl(se,r),l.specularFactor=Gl(h,s),l.glossinessFactor=a,l}function eVe(e,t,n){let{baseColorTexture:i,metallicRoughnessTexture:o,baseColorFactor:r,metallicFactor:s,roughnessFactor:a}=t,l=new wke;return c(i)&&(l.baseColorTexture=Ac(e,i,n)),c(o)&&(l.metallicRoughnessTexture=Ac(e,o,n)),l.baseColorFactor=Gl(se,r),l.metallicFactor=s,l.roughnessFactor=a,l}function tVe(e,t,n){let{specularFactor:i,specularTexture:o,specularColorFactor:r,specularColorTexture:s}=t,a=new Dke;return c(o)&&(a.specularTexture=Ac(e,o,n)),c(s)&&(a.specularColorTexture=Ac(e,s,n)),a.specularFactor=i,a.specularColorFactor=Gl(h,r),a}function nVe(e,t,n){let{anisotropyStrength:i=_4.DEFAULT_ANISOTROPY_STRENGTH,anisotropyRotation:o=_4.DEFAULT_ANISOTROPY_ROTATION,anisotropyTexture:r}=t,s=new _4;return c(r)&&(s.anisotropyTexture=Ac(e,r,n)),s.anisotropyStrength=i,s.anisotropyRotation=o,s}function iVe(e,t,n){let{clearcoatFactor:i=g4.DEFAULT_CLEARCOAT_FACTOR,clearcoatTexture:o,clearcoatRoughnessFactor:r=g4.DEFAULT_CLEARCOAT_ROUGHNESS_FACTOR,clearcoatRoughnessTexture:s,clearcoatNormalTexture:a}=t,l=new g4;return c(o)&&(l.clearcoatTexture=Ac(e,o,n)),c(s)&&(l.clearcoatRoughnessTexture=Ac(e,s,n)),c(a)&&(l.clearcoatNormalTexture=Ac(e,a,n)),l.clearcoatFactor=i,l.clearcoatRoughnessFactor=r,l}function oVe(e,t,n){let i=new Pke,o=y(t.extensions,y.EMPTY_OBJECT),r=o.KHR_materials_pbrSpecularGlossiness,s=o.KHR_materials_specular,a=o.KHR_materials_anisotropy,l=o.KHR_materials_clearcoat,u=t.pbrMetallicRoughness;return i.unlit=c(o.KHR_materials_unlit),c(r)?i.specularGlossiness=Qke(e,r,n):(c(u)&&(i.metallicRoughness=eVe(e,u,n)),c(s)&&!i.unlit&&(i.specular=tVe(e,s,n)),c(a)&&!i.unlit&&(i.anisotropy=nVe(e,a,n)),c(l)&&!i.unlit&&(i.clearcoat=iVe(e,l,n))),c(t.emissiveTexture)&&(i.emissiveTexture=Ac(e,t.emissiveTexture,n)),c(t.normalTexture)&&!e._loadForClassification&&(i.normalTexture=Ac(e,t.normalTexture,n)),c(t.occlusionTexture)&&(i.occlusionTexture=Ac(e,t.occlusionTexture,n)),i.emissiveFactor=Gl(h,t.emissiveFactor),i.alphaMode=t.alphaMode,i.alphaCutoff=t.alphaCutoff,i.doubleSided=t.doubleSided,i}function goe(e,t){let n=new uoe;return n.featureCount=e.featureCount,n.nullFeatureId=e.nullFeatureId,n.propertyTableId=e.propertyTable,n.setIndex=e.attribute,n.label=e.label,n.positionalLabel=t,n}function yoe(e,t,n,i){let o=new uoe,r=e.featureIds;return o.featureCount=n,o.propertyTableId=t,o.setIndex=moe(r.attribute),o.positionalLabel=i,o}function boe(e,t){let n=new doe;return n.propertyTableId=e.propertyTable,n.featureCount=e.featureCount,n.nullFeatureId=e.nullFeatureId,n.label=e.label,n.positionalLabel=t,n.offset=0,n.repeat=1,n}function xoe(e,t,n,i){let o=new doe,r=e.featureIds;o.propertyTableId=t,o.featureCount=n,o.offset=y(r.constant,0);let s=y(r.divisor,0);return o.repeat=s===0?void 0:s,o.positionalLabel=i,o}function rVe(e,t,n,i){let o=new foe;o.featureCount=t.featureCount,o.nullFeatureId=t.nullFeatureId,o.propertyTableId=t.propertyTable,o.label=t.label,o.positionalLabel=i;let r=t.texture;o.textureReader=Ac(e,r,n,Qt.NEAREST);let a=(c(r.channels)?r.channels:[0]).map(function(l){return"rgba".charAt(l)}).join("");return o.textureReader.channels=a,o}function sVe(e,t,n,i,o,r){let s=new foe,a=t.featureIds,l=a.texture;return s.featureCount=o,s.propertyTableId=n,s.textureReader=Ac(e,l,i,Qt.NEAREST),s.textureReader.channels=a.channels,s.positionalLabel=r,s}function aVe(e,t,n,i,o){let r=new fke,s=void 0,a=!1;for(let l in t){if(!t.hasOwnProperty(l))continue;let u=t[l],f=y4(e,Ct,l),d=_oe(e,u,f,s,a,n,o);r.attributes.push(d.attribute),i.attributePlans.push(d)}return r}function cVe(e,t,n,i){let o=new dke,r=new aw(o);e._primitiveLoadPlans.push(r);let s=t.material;c(s)&&(o.material=oVe(e,e.gltfJson.materials[s],i));let a=y(t.extensions,y.EMPTY_OBJECT),l=!1,u=a.CESIUM_primitive_outline;e._loadPrimitiveOutline&&c(u)&&(l=!0,r.needsOutlines=!0,r.outlineIndices=lVe(e,u,r));let f=e._loadForClassification,d=a.KHR_draco_mesh_compression,p=!1,g=t.attributes;if(c(g))for(let D in g){if(!g.hasOwnProperty(D))continue;let I=g[D],L=y4(e,Ct,D),M=L.modelSemantic;if(f&&!Xke(M))continue;M===Ct.FEATURE_ID&&(p=!0);let N=_oe(e,I,L,d,n,l,i);r.attributePlans.push(N),o.attributes.push(N.attribute)}let m=t.targets;if(c(m)&&!f)for(let D=0;D<m.length;++D)o.morphTargets.push(aVe(e,m[D],l,r,i));let b=t.indices;if(c(b)){let D=Jke(e,b,d,p,l,i);c(D)&&(r.indicesPlan=D,o.indices=D.indices)}let x=a.EXT_structural_metadata,T=a.EXT_mesh_features,C=a.EXT_feature_metadata,S=c(C);c(T)?uVe(e,o,T,i):S&&fVe(e,o,C,i),c(x)?dVe(o,x):S&&hVe(e,o,C);let v=t.mode;if(f&&v!==Me.TRIANGLES)throw new ue("Only triangle meshes can be used for classification.");return o.primitiveType=v,o}function lVe(e,t){let n=t.indices,i=e.gltfJson.accessors[n];return t1(e,i,!1)}function uVe(e,t,n,i){let o;c(n)&&c(n.featureIds)?o=n.featureIds:o=[];for(let r=0;r<o.length;r++){let s=o[r],a=`featureId_${r}`,l;c(s.texture)?l=rVe(e,s,i,a):c(s.attribute)?l=goe(s,a):l=boe(s,a),t.featureIds.push(l)}}function fVe(e,t,n,i){let{featureTables:o}=e.gltfJson.extensions.EXT_feature_metadata,r=0,s=n.featureIdAttributes;if(c(s))for(let l=0;l<s.length;++l){let u=s[l],f=u.featureTable,d=e._sortedPropertyTableIds.indexOf(f),p=o[f].count,g=`featureId_${r}`;r++;let m;c(u.featureIds.attribute)?m=yoe(u,d,p,g):m=xoe(u,d,p,g),t.featureIds.push(m)}let a=n.featureIdTextures;if(c(a))for(let l=0;l<a.length;++l){let u=a[l],f=u.featureTable,d=e._sortedPropertyTableIds.indexOf(f),p=o[f].count,g=`featureId_${r}`;r++;let m=sVe(e,u,d,i,p,g);t.featureIds.push(m)}}function dVe(e,t){c(t)&&(c(t.propertyTextures)&&(e.propertyTextureIds=t.propertyTextures),c(t.propertyAttributes)&&(e.propertyAttributeIds=t.propertyAttributes))}function hVe(e,t,n){c(n.featureTextures)&&(t.propertyTextureIds=n.featureTextures.map(function(i){return e._sortedFeatureTextureIds.indexOf(i)}))}function mVe(e,t,n){let i=t.EXT_mesh_gpu_instancing,o=new hke,r=i.attributes;if(c(r))for(let u in r){if(!r.hasOwnProperty(u))continue;let f=r[u];o.attributes.push(Zke(e,f,r,u,n))}let s=y(i.extensions,y.EMPTY_OBJECT),a=t.EXT_instance_features,l=s.EXT_feature_metadata;return c(a)?pVe(o,a):c(l)&&_Ve(e.gltfJson,o,l,e._sortedPropertyTableIds),o}function pVe(e,t){let n=t.featureIds;for(let i=0;i<n.length;i++){let o=n[i],r=`instanceFeatureId_${i}`,s;c(o.attribute)?s=goe(o,r):s=boe(o,r),e.featureIds.push(s)}}function _Ve(e,t,n,i){let o=e.extensions.EXT_feature_metadata.featureTables,r=n.featureIdAttributes;if(c(r))for(let s=0;s<r.length;++s){let a=r[s],l=a.featureTable,u=i.indexOf(l),f=o[l].count,d=`instanceFeatureId_${s}`,p;c(a.featureIds.attribute)?p=yoe(a,u,f,d):p=xoe(a,u,f,d),t.featureIds.push(p)}}function gVe(e,t,n){let i=new pke;i.name=t.name,i.matrix=Gl(k,t.matrix),i.translation=Gl(h,t.translation),i.rotation=Gl(Ne,t.rotation),i.scale=Gl(h,t.scale);let o=y(t.extensions,y.EMPTY_OBJECT),r=o.EXT_mesh_gpu_instancing,s=o.AGI_articulations;if(c(r)){if(e._loadForClassification)throw new ue("Models with the EXT_mesh_gpu_instancing extension cannot be used for classification.");i.instances=mVe(e,o,n)}c(s)&&(i.articulationName=s.articulationName);let a=t.mesh;if(c(a)){let l=e.gltfJson.meshes[a],u=l.primitives;for(let p=0;p<u.length;++p)i.primitives.push(cVe(e,u[p],c(i.instances),n));let f=y(t.weights,l.weights),d=i.primitives[0].morphTargets;i.morphWeights=c(f)?f.slice():new Array(d.length).fill(0)}return i}function yVe(e,t){let n=e.gltfJson.nodes;if(!c(n))return[];let i=n.map(function(o,r){let s=gVe(e,o,t);return s.index=r,s});for(let o=0;o<i.length;++o){let r=n[o].children;if(c(r))for(let s=0;s<r.length;++s)i[o].children.push(i[r[s]])}return i}function bVe(e,t,n){let i=new mke,o=t.joints;i.joints=o.map(s=>n[s]);let r=t.inverseBindMatrices;if(c(r)){let s=e.gltfJson.accessors[r];i.inverseBindMatrices=t1(e,s)}else i.inverseBindMatrices=new Array(o.length).fill(k.IDENTITY);return i}function xVe(e,t){let n=e.gltfJson.skins;if(e._loadForClassification||!c(n))return[];let i=n.map(function(r,s){let a=bVe(e,r,t);return a.index=s,a}),o=e.gltfJson.nodes;for(let r=0;r<t.length;++r){let s=o[r].skin;c(s)&&(t[r].skin=i[s])}return i}async function TVe(e,t,n,i){let o=new i4({gltf:e.gltfJson,extension:t,extensionLegacy:n,gltfResource:e._gltfResource,baseResource:e._baseResource,supportedImageFormats:e._supportedImageFormats,frameState:i,asynchronous:e._asynchronous});return e._structuralMetadataLoader=o,o.load()}async function AVe(e,t,n,i){let o=new p4({gltf:t,extension:n,gltfResource:e._gltfResource,baseResource:e._baseResource,supportedImageFormats:e._supportedImageFormats,frameState:i,asynchronous:e._asynchronous});return e._meshPrimitiveGpmLoader=o,o.load()}function CVe(e,t){let n=new gke,i=e.gltfJson.accessors,o=i[t.input];n.input=t1(e,o);let r=t.interpolation;n.interpolation=y(op[r],op.LINEAR);let s=i[t.output];return n.output=t1(e,s,!0),n}function EVe(e,t){let n=new yke,i=e.node;if(!c(i))return;n.node=t[i];let o=e.path.toUpperCase();return n.path=_ke[o],n}function SVe(e,t,n){let i=new bke,o=e.sampler;return i.sampler=t[o],i.target=EVe(e.target,n),i}function wVe(e,t,n){let i=new xke;i.name=t.name;let o=t.samplers.map(function(s,a){let l=CVe(e,s);return l.index=a,l}),r=t.channels.map(function(s){return SVe(s,o,n)});return i.samplers=o,i.channels=r,i}function vVe(e,t){let n=e.gltfJson.animations;return e._loadForClassification||!c(n)?[]:n.map(function(o,r){let s=wVe(e,o,t);return s.index=r,s})}function DVe(e){let t=new Tke;t.name=e.name;let n=e.type.toUpperCase();return t.type=rl[n],t.minimumValue=e.minimumValue,t.maximumValue=e.maximumValue,t.initialValue=e.initialValue,t}function PVe(e){let t=new Ake;return t.name=e.name,t.stages=e.stages.map(DVe),t}function IVe(e){let n=y(e.extensions,y.EMPTY_OBJECT).AGI_articulations?.articulations;return c(n)?n.map(PVe):[]}function OVe(e){let t;return c(e.scenes)&&c(e.scene)&&(t=e.scenes[e.scene].nodes),t=y(t,e.nodes),t=c(t)?t:[],t}function RVe(e,t){let n=new Eke,i=OVe(e);return n.nodes=i.map(function(o){return t[o]}),n}var MVe=new h;function LVe(e,t){let n=e.gltfJson,i=y(n.extensions,y.EMPTY_OBJECT),o=i.EXT_structural_metadata,r=i.EXT_feature_metadata,s=i.CESIUM_RTC;if(c(r)){let C=r.featureTables,S=r.featureTextures,v=c(C)?C:[],D=c(S)?S:[];e._sortedPropertyTableIds=Object.keys(v).sort(),e._sortedFeatureTextureIds=Object.keys(D).sort()}let a=yVe(e,t),l=xVe(e,a),u=vVe(e,a),f=IVe(n),d=RVe(n,a),p=new Ske,g=new Cke,m=n.asset.copyright;if(c(m)){let C=m.split(";").map(function(S){return new Pt(S.trim())});g.credits=C}if(p.asset=g,p.scene=d,p.nodes=a,p.skins=l,p.animations=u,p.articulations=f,p.upAxis=e._upAxis,p.forwardAxis=e._forwardAxis,c(s)){let C=h.fromArray(s.center,0,MVe);p.transform=k.fromTranslation(C,p.transform)}if(e._components=p,c(o)||c(r)){let C=TVe(e,o,r,t);e._loaderPromises.push(C)}let b=i.NGA_gpm_local;if(c(b)){let C=f4.load(b);e._components.extensions.NGA_gpm_local=C}let x=n.meshes;if(c(x))for(let C of x){let S=C.primitives;if(c(S))for(let v of S){let D=v.extensions;if(c(D)){let I=D.NGA_gpm_local;if(c(I)){let L=AVe(e,n,I,t);e._loaderPromises.push(L)}}}}let T=[];return T.push.apply(T,e._loaderPromises),e._incrementallyLoadTextures||T.push.apply(T,e._texturesPromises),Promise.all(T)}function NVe(e){let t=e._textureLoaders;for(let n=0;n<t.length;++n)t[n]=!t[n].isDestroyed()&&Ci.unload(t[n]);e._textureLoaders.length=0}function Toe(e){let t=e._bufferViewLoaders;for(let n=0;n<t.length;++n)t[n]=!t[n].isDestroyed()&&Ci.unload(t[n]);e._bufferViewLoaders.length=0}function FVe(e){let t=e._geometryLoaders;for(let n=0;n<t.length;++n)t[n]=!t[n].isDestroyed()&&Ci.unload(t[n]);e._geometryLoaders.length=0}function BVe(e){let t=e._postProcessBuffers;for(let n=0;n<t.length;n++){let i=t[n];i.isDestroyed()||i.destroy()}t.length=0}function kVe(e){c(e._structuralMetadataLoader)&&!e._structuralMetadataLoader.isDestroyed()&&(e._structuralMetadataLoader.destroy(),e._structuralMetadataLoader=void 0)}function VVe(e){c(e._meshPrimitiveGpmLoader)&&!e._meshPrimitiveGpmLoader.isDestroyed()&&(e._meshPrimitiveGpmLoader.destroy(),e._meshPrimitiveGpmLoader=void 0)}nd.prototype.isUnloaded=function(){return this._state===Co.UNLOADED};nd.prototype.unload=function(){c(this._gltfJsonLoader)&&!this._gltfJsonLoader.isDestroyed()&&Ci.unload(this._gltfJsonLoader),this._gltfJsonLoader=void 0,NVe(this),Toe(this),FVe(this),BVe(this),kVe(this),VVe(this),this._components=void 0,this._typedArray=void 0,this._state=Co.UNLOADED};var S0=nd;function gT(e){e=y(e,y.EMPTY_OBJECT);let{context:t,width:n,height:i,colorRenderbuffers:o,colorTextures:r,depthStencilRenderbuffer:s,depthStencilTexture:a,destroyAttachments:l}=e;if(A.defined("options.context",t),A.defined("options.width",n),A.defined("options.height",i),this._width=n,this._height=i,c(o)!==c(r))throw new E("Both color renderbuffer and texture attachments must be provided.");if(c(s)!==c(a))throw new E("Both depth-stencil renderbuffer and texture attachments must be provided.");this._renderFramebuffer=new Jr({context:t,colorRenderbuffers:o,depthStencilRenderbuffer:s,destroyAttachments:l}),this._colorFramebuffer=new Jr({context:t,colorTextures:r,depthStencilTexture:a,destroyAttachments:l})}gT.prototype.getRenderFramebuffer=function(){return this._renderFramebuffer};gT.prototype.getColorFramebuffer=function(){return this._colorFramebuffer};gT.prototype.blitFramebuffers=function(e,t){this._renderFramebuffer.bindRead(),this._colorFramebuffer.bindDraw();let n=e._gl,i=0;this._colorFramebuffer._colorTextures.length>0&&(i|=n.COLOR_BUFFER_BIT),c(this._colorFramebuffer.depthStencilTexture)&&(i|=n.DEPTH_BUFFER_BIT|(t?n.STENCIL_BUFFER_BIT:0)),n.blitFramebuffer(0,0,this._width,this._height,0,0,this._width,this._height,i,n.NEAREST),n.bindFramebuffer(n.READ_FRAMEBUFFER,null),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,null)};gT.prototype.isDestroyed=function(){return!1};gT.prototype.destroy=function(){return this._renderFramebuffer.destroy(),this._colorFramebuffer.destroy(),de(this)};var b4=gT;var sl={RGBA4:ne.RGBA4,RGBA8:ne.RGBA8,RGBA16F:ne.RGBA16F,RGBA32F:ne.RGBA32F,RGB5_A1:ne.RGB5_A1,RGB565:ne.RGB565,DEPTH_COMPONENT16:ne.DEPTH_COMPONENT16,STENCIL_INDEX8:ne.STENCIL_INDEX8,DEPTH_STENCIL:ne.DEPTH_STENCIL,DEPTH24_STENCIL8:ne.DEPTH24_STENCIL8,validate:function(e){return e===sl.RGBA4||e===sl.RGBA8||e===sl.RGBA16F||e===sl.RGBA32F||e===sl.RGB5_A1||e===sl.RGB565||e===sl.DEPTH_COMPONENT16||e===sl.STENCIL_INDEX8||e===sl.DEPTH_STENCIL||e===sl.DEPTH24_STENCIL8},getColorFormat:function(e){return e===ne.FLOAT?sl.RGBA32F:e===ne.HALF_FLOAT_OES?sl.RGBA16F:sl.RGBA8}},al=Object.freeze(sl);function cw(e){e=y(e,y.EMPTY_OBJECT),A.defined("options.context",e.context);let n=e.context._gl,i=mt.maximumRenderbufferSize,o=y(e.format,al.RGBA4),r=c(e.width)?e.width:n.drawingBufferWidth,s=c(e.height)?e.height:n.drawingBufferHeight,a=y(e.numSamples,1);if(!al.validate(o))throw new E("Invalid format.");if(A.typeOf.number.greaterThan("width",r,0),r>i)throw new E(`Width must be less than or equal to the maximum renderbuffer size (${i}).  Check maximumRenderbufferSize.`);if(A.typeOf.number.greaterThan("height",s,0),s>i)throw new E(`Height must be less than or equal to the maximum renderbuffer size (${i}).  Check maximumRenderbufferSize.`);this._gl=n,this._format=o,this._width=r,this._height=s,this._renderbuffer=this._gl.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,this._renderbuffer),a>1?n.renderbufferStorageMultisample(n.RENDERBUFFER,a,o,r,s):n.renderbufferStorage(n.RENDERBUFFER,o,r,s),n.bindRenderbuffer(n.RENDERBUFFER,null)}Object.defineProperties(cw.prototype,{format:{get:function(){return this._format}},width:{get:function(){return this._width}},height:{get:function(){return this._height}}});cw.prototype._getRenderbuffer=function(){return this._renderbuffer};cw.prototype.isDestroyed=function(){return!1};cw.prototype.destroy=function(){return this._gl.deleteRenderbuffer(this._renderbuffer),de(this)};var id=cw;function ds(e){if(e=y(e,y.EMPTY_OBJECT),this._numSamples=y(e.numSamples,1),this._colorAttachmentsLength=y(e.colorAttachmentsLength,1),this._color=y(e.color,!0),this._depth=y(e.depth,!1),this._depthStencil=y(e.depthStencil,!1),this._supportsDepthTexture=y(e.supportsDepthTexture,!1),!this._color&&!this._depth&&!this._depthStencil)throw new E("Must enable at least one type of framebuffer attachment.");if(this._depth&&this._depthStencil)throw new E("Cannot have both a depth and depth-stencil attachment.");this._createColorAttachments=y(e.createColorAttachments,!0),this._createDepthAttachments=y(e.createDepthAttachments,!0),this._pixelDatatype=e.pixelDatatype,this._pixelFormat=e.pixelFormat,this._width=void 0,this._height=void 0,this._framebuffer=void 0,this._multisampleFramebuffer=void 0,this._colorTextures=void 0,this._color&&(this._colorTextures=new Array(this._colorAttachmentsLength),this._colorRenderbuffers=new Array(this._colorAttachmentsLength)),this._colorRenderbuffer=void 0,this._depthStencilRenderbuffer=void 0,this._depthStencilTexture=void 0,this._depthRenderbuffer=void 0,this._depthTexture=void 0,this._attachmentsDirty=!1}Object.defineProperties(ds.prototype,{framebuffer:{get:function(){return this._numSamples>1?this._multisampleFramebuffer.getRenderFramebuffer():this._framebuffer}},numSamples:{get:function(){return this._numSamples}},status:{get:function(){return this.framebuffer.status}}});ds.prototype.isDirty=function(e,t,n,i,o){n=y(n,1);let r=this._width!==e||this._height!==t,s=this._numSamples!==n,a=c(i)&&this._pixelDatatype!==i||c(o)&&this._pixelFormat!==o,l=n===1?c(this._framebuffer):c(this._multisampleFramebuffer);return this._attachmentsDirty||r||s||a||!l||this._color&&!c(this._colorTextures[0])};ds.prototype.update=function(e,t,n,i,o,r){if(!c(t)||!c(n))throw new E("width and height must be defined.");if(i=e.msaa?y(i,1):1,o=y(o,this._color?y(this._pixelDatatype,Be.UNSIGNED_BYTE):void 0),r=y(r,this._color?y(this._pixelFormat,Ve.RGBA):void 0),this.isDirty(t,n,i,o,r)){if(this.destroy(),this._width=t,this._height=n,this._numSamples=i,this._pixelDatatype=o,this._pixelFormat=r,this._attachmentsDirty=!1,this._color&&this._createColorAttachments){for(let s=0;s<this._colorAttachmentsLength;++s)if(this._colorTextures[s]=new Lt({context:e,width:t,height:n,pixelFormat:r,pixelDatatype:o,sampler:Qt.NEAREST}),this._numSamples>1){let a=al.getColorFormat(o);this._colorRenderbuffers[s]=new id({context:e,width:t,height:n,format:a,numSamples:this._numSamples})}}this._depthStencil&&this._createDepthAttachments&&(this._supportsDepthTexture&&e.depthTexture?(this._depthStencilTexture=new Lt({context:e,width:t,height:n,pixelFormat:Ve.DEPTH_STENCIL,pixelDatatype:Be.UNSIGNED_INT_24_8,sampler:Qt.NEAREST}),this._numSamples>1&&(this._depthStencilRenderbuffer=new id({context:e,width:t,height:n,format:al.DEPTH24_STENCIL8,numSamples:this._numSamples}))):this._depthStencilRenderbuffer=new id({context:e,width:t,height:n,format:al.DEPTH_STENCIL})),this._depth&&this._createDepthAttachments&&(this._supportsDepthTexture&&e.depthTexture?this._depthTexture=new Lt({context:e,width:t,height:n,pixelFormat:Ve.DEPTH_COMPONENT,pixelDatatype:Be.UNSIGNED_INT,sampler:Qt.NEAREST}):this._depthRenderbuffer=new id({context:e,width:t,height:n,format:al.DEPTH_COMPONENT16})),this._numSamples>1?this._multisampleFramebuffer=new b4({context:e,width:this._width,height:this._height,colorTextures:this._colorTextures,colorRenderbuffers:this._colorRenderbuffers,depthStencilTexture:this._depthStencilTexture,depthStencilRenderbuffer:this._depthStencilRenderbuffer,destroyAttachments:!1}):this._framebuffer=new Jr({context:e,colorTextures:this._colorTextures,depthTexture:this._depthTexture,depthRenderbuffer:this._depthRenderbuffer,depthStencilTexture:this._depthStencilTexture,depthStencilRenderbuffer:this._depthStencilRenderbuffer,destroyAttachments:!1})}};ds.prototype.getColorTexture=function(e){if(e=y(e,0),e>=this._colorAttachmentsLength)throw new E("index must be smaller than total number of color attachments.");return this._colorTextures[e]};ds.prototype.setColorTexture=function(e,t){if(t=y(t,0),this._createColorAttachments)throw new E("createColorAttachments must be false if setColorTexture is called.");if(t>=this._colorAttachmentsLength)throw new E("index must be smaller than total number of color attachments.");this._attachmentsDirty=e!==this._colorTextures[t],this._colorTextures[t]=e};ds.prototype.getColorRenderbuffer=function(e){if(e=y(e,0),e>=this._colorAttachmentsLength)throw new E("index must be smaller than total number of color attachments.");return this._colorRenderbuffers[e]};ds.prototype.setColorRenderbuffer=function(e,t){if(t=y(t,0),this._createColorAttachments)throw new E("createColorAttachments must be false if setColorRenderbuffer is called.");if(t>=this._colorAttachmentsLength)throw new E("index must be smaller than total number of color attachments.");this._attachmentsDirty=e!==this._colorRenderbuffers[t],this._colorRenderbuffers[t]=e};ds.prototype.getDepthRenderbuffer=function(){return this._depthRenderbuffer};ds.prototype.setDepthRenderbuffer=function(e){if(this._createDepthAttachments)throw new E("createDepthAttachments must be false if setDepthRenderbuffer is called.");this._attachmentsDirty=e!==this._depthRenderbuffer,this._depthRenderbuffer=e};ds.prototype.getDepthTexture=function(){return this._depthTexture};ds.prototype.setDepthTexture=function(e){if(this._createDepthAttachments)throw new E("createDepthAttachments must be false if setDepthTexture is called.");this._attachmentsDirty=e!==this._depthTexture,this._depthTexture=e};ds.prototype.getDepthStencilRenderbuffer=function(){return this._depthStencilRenderbuffer};ds.prototype.setDepthStencilRenderbuffer=function(e){if(this._createDepthAttachments)throw new E("createDepthAttachments must be false if setDepthStencilRenderbuffer is called.");this._attachmentsDirty=e!==this._depthStencilRenderbuffer,this._depthStencilRenderbuffer=e};ds.prototype.getDepthStencilTexture=function(){return this._depthStencilTexture};ds.prototype.setDepthStencilTexture=function(e){if(this._createDepthAttachments)throw new E("createDepthAttachments must be false if setDepthStencilTexture is called.");this._attachmentsDirty=e!==this._depthStencilTexture,this._depthStencilTexture=e};ds.prototype.prepareTextures=function(e,t){this._numSamples>1&&this._multisampleFramebuffer.blitFramebuffers(e,t)};ds.prototype.clear=function(e,t,n){let i=t.framebuffer;t.framebuffer=this.framebuffer,t.execute(e,n),t.framebuffer=i};ds.prototype.destroyFramebuffer=function(){this._framebuffer=this._framebuffer&&this._framebuffer.destroy(),this._multisampleFramebuffer=this._multisampleFramebuffer&&this._multisampleFramebuffer.destroy()};ds.prototype.destroy=function(){if(this._color){let e=this._colorTextures,t=this._colorRenderbuffers;for(let n=0;n<e.length;++n){let i=e[n];this._createColorAttachments&&c(i)&&!i.isDestroyed()&&i.destroy(),c(i)&&i.isDestroyed()&&(e[n]=void 0);let o=t[n];this._createColorAttachments&&c(o)&&!o.isDestroyed()&&o.destroy(),c(o)&&o.isDestroyed()&&(t[n]=void 0)}}this._depthStencil&&(this._createDepthAttachments&&(this._depthStencilTexture=this._depthStencilTexture&&this._depthStencilTexture.destroy(),this._depthStencilRenderbuffer=this._depthStencilRenderbuffer&&this._depthStencilRenderbuffer.destroy()),c(this._depthStencilTexture)&&this._depthStencilTexture.isDestroyed()&&(this._depthStencilTexture=void 0),c(this._depthStencilRenderbuffer)&&this._depthStencilRenderbuffer.isDestroyed()&&(this._depthStencilRenderbuffer=void 0)),this._depth&&(this._createDepthAttachments&&(this._depthTexture=this._depthTexture&&this._depthTexture.destroy(),this._depthRenderbuffer=this._depthRenderbuffer&&this._depthRenderbuffer.destroy()),c(this._depthTexture)&&this._depthTexture.isDestroyed()&&(this._depthTexture=void 0),c(this._depthRenderbuffer)&&this._depthRenderbuffer.isDestroyed()&&(this._depthRenderbuffer=void 0)),this.destroyFramebuffer()};var gi=ds;var x4=`uniform sampler2D u_pointCloud_colorGBuffer;
uniform sampler2D u_pointCloud_depthGBuffer;
uniform vec2 u_distanceAndEdlStrength;
in vec2 v_textureCoordinates;
vec2 neighborContribution(float log2Depth, vec2 offset)
{
float dist = u_distanceAndEdlStrength.x;
vec2 texCoordOrig = v_textureCoordinates + offset * dist;
vec2 texCoord0 = v_textureCoordinates + offset * floor(dist);
vec2 texCoord1 = v_textureCoordinates + offset * ceil(dist);
float depthOrLogDepth0 = czm_unpackDepth(texture(u_pointCloud_depthGBuffer, texCoord0));
float depthOrLogDepth1 = czm_unpackDepth(texture(u_pointCloud_depthGBuffer, texCoord1));
if (depthOrLogDepth0 == 0.0 || depthOrLogDepth1 == 0.0) {
return vec2(0.0);
}
float depthMix = mix(depthOrLogDepth0, depthOrLogDepth1, fract(dist));
vec4 eyeCoordinate = czm_windowToEyeCoordinates(texCoordOrig, depthMix);
return vec2(max(0.0, log2Depth - log2(-eyeCoordinate.z / eyeCoordinate.w)), 1.0);
}
void main()
{
float depthOrLogDepth = czm_unpackDepth(texture(u_pointCloud_depthGBuffer, v_textureCoordinates));
vec4 eyeCoordinate = czm_windowToEyeCoordinates(gl_FragCoord.xy, depthOrLogDepth);
eyeCoordinate /= eyeCoordinate.w;
float log2Depth = log2(-eyeCoordinate.z);
if (depthOrLogDepth == 0.0)
{
discard;
}
vec4 color = texture(u_pointCloud_colorGBuffer, v_textureCoordinates);
vec2 texelSize = 1.0 / czm_viewport.zw;
vec2 responseAndCount = vec2(0.0);
responseAndCount += neighborContribution(log2Depth, vec2(-texelSize.x, 0.0));
responseAndCount += neighborContribution(log2Depth, vec2(+texelSize.x, 0.0));
responseAndCount += neighborContribution(log2Depth, vec2(0.0, -texelSize.y));
responseAndCount += neighborContribution(log2Depth, vec2(0.0, +texelSize.y));
float response = responseAndCount.x / responseAndCount.y;
float strength = u_distanceAndEdlStrength.y;
float shade = exp(-response * 300.0 * strength);
color.rgb *= shade;
out_FragColor = vec4(color);
gl_FragDepth = depthOrLogDepth;
}
`;function yT(){this._framebuffer=new gi({colorAttachmentsLength:2,depth:!0,supportsDepthTexture:!0}),this._drawCommand=void 0,this._clearCommand=void 0,this._strength=1,this._radius=1}Object.defineProperties(yT.prototype,{framebuffer:{get:function(){return this._framebuffer.framebuffer}},colorGBuffer:{get:function(){return this._framebuffer.getColorTexture(0)}},depthGBuffer:{get:function(){return this._framebuffer.getColorTexture(1)}}});function UVe(e){e._framebuffer.destroy(),e._drawCommand=void 0,e._clearCommand=void 0}var T4=new H;function zVe(e,t){let n=new Ge({defines:["LOG_DEPTH_WRITE"],sources:[x4]}),i={u_pointCloud_colorGBuffer:function(){return e.colorGBuffer},u_pointCloud_depthGBuffer:function(){return e.depthGBuffer},u_distanceAndEdlStrength:function(){return T4.x=e._radius,T4.y=e._strength,T4}},o=ze.fromCache({blending:hn.ALPHA_BLEND,depthMask:!0,depthTest:{enabled:!0},stencilTest:Ut.setCesium3DTileBit(),stencilMask:Ut.CESIUM_3D_TILE_MASK});e._drawCommand=t.createViewportQuadCommand(n,{uniformMap:i,renderState:o,pass:ve.CESIUM_3D_TILE,owner:e}),e._clearCommand=new ri({framebuffer:e.framebuffer,color:new j(0,0,0,0),depth:1,renderState:ze.fromCache(),pass:ve.CESIUM_3D_TILE,owner:e})}function HVe(e,t){let n=t.drawingBufferWidth,i=t.drawingBufferHeight;e._framebuffer.update(t,n,i),zVe(e,t)}function Aoe(e){return e.drawBuffers&&e.fragmentDepth}yT.isSupported=Aoe;function GVe(e,t){let n=e.shaderCache.getDerivedShaderProgram(t,"EC");if(!c(n)){let i=t._attributeLocations,o=t.fragmentShaderSource.clone();o.sources.splice(0,0,`layout (location = 0) out vec4 out_FragData_0;
layout (location = 1) out vec4 out_FragData_1;`),o.sources=o.sources.map(function(r){return r=Ge.replaceMain(r,"czm_point_cloud_post_process_main"),r=r.replaceAll(/out_FragColor/g,"out_FragData_0"),r}),o.sources.push(`void main() 
{ 
    czm_point_cloud_post_process_main(); 
#ifdef LOG_DEPTH
    czm_writeLogDepth();
    out_FragData_1 = czm_packDepth(gl_FragDepth); 
#else
    out_FragData_1 = czm_packDepth(gl_FragCoord.z);
#endif
}`),n=e.shaderCache.createDerivedShaderProgram(t,"EC",{vertexShaderSource:t.vertexShaderSource,fragmentShaderSource:o,attributeLocations:i})}return n}yT.prototype.update=function(e,t,n,i){if(!Aoe(e.context))return;this._strength=n.eyeDomeLightingStrength,this._radius=n.eyeDomeLightingRadius*e.pixelRatio,HVe(this,e.context);let o,r=e.commandList,s=r.length;for(o=t;o<s;++o){let u=r[o];if(u.primitiveType!==Me.POINTS||u.pass===ve.TRANSLUCENT)continue;let f,d,p=u.derivedCommands.pointCloudProcessor;c(p)&&(f=p.command,d=p.originalShaderProgram),(!c(f)||u.dirty||d!==u.shaderProgram||f.framebuffer!==this.framebuffer)&&(f=et.shallowClone(u,f),f.framebuffer=this.framebuffer,f.shaderProgram=GVe(e.context,u.shaderProgram),f.castShadows=!1,f.receiveShadows=!1,c(p)||(p={command:f,originalShaderProgram:u.shaderProgram},u.derivedCommands.pointCloudProcessor=p),p.originalShaderProgram=u.shaderProgram),r[o]=f}let a=this._clearCommand,l=this._drawCommand;l.boundingVolume=i,r.push(l),r.push(a)};yT.prototype.isDestroyed=function(){return!1};yT.prototype.destroy=function(){return UVe(this),de(this)};var w0=yT;function Coe(e){let t=y(e,{});this.attenuation=y(t.attenuation,!1),this.geometricErrorScale=y(t.geometricErrorScale,1),this.maximumAttenuation=t.maximumAttenuation,this.baseResolution=t.baseResolution,this.eyeDomeLighting=y(t.eyeDomeLighting,!0),this.eyeDomeLightingStrength=y(t.eyeDomeLightingStrength,1),this.eyeDomeLightingRadius=y(t.eyeDomeLightingRadius,1),this.backFaceCulling=y(t.backFaceCulling,!1),this.normalShading=y(t.normalShading,!0)}Coe.isSupported=function(e){return w0.isSupported(e.context)};var Z_=Coe;var fa={},jVe=new se(0,0,0,1),qa=new se,WVe=new Ke,A4=new H,C4=new H;fa.worldToWindowCoordinates=function(e,t,n){return fa.worldWithEyeOffsetToWindowCoordinates(e,t,h.ZERO,n)};var Eoe=new se,Soe=new h;function lw(e,t,n,i){let o=n.viewMatrix,r=k.multiplyByVector(o,se.fromElements(e.x,e.y,e.z,1,Eoe),Eoe),s=h.multiplyComponents(t,h.normalize(r,Soe),Soe);return r.x+=t.x+s.x,r.y+=t.y+s.y,r.z+=s.z,k.multiplyByVector(n.frustum.projectionMatrix,r,i)}var qVe=new he(Math.PI,R.PI_OVER_TWO),YVe=new h,XVe=new h;fa.worldWithEyeOffsetToWindowCoordinates=function(e,t,n,i){if(!c(e))throw new E("scene is required.");if(!c(t))throw new E("position is required.");let o=e.frameState,r=fa.computeActualEllipsoidPosition(o,t,jVe);if(!c(r))return;let s=e.canvas,a=WVe;a.x=0,a.y=0,a.width=s.clientWidth,a.height=s.clientHeight;let l=e.camera,u=!1;if(o.mode===oe.SCENE2D){let f=e.mapProjection,d=qVe,p=f.project(d,YVe),g=h.clone(l.position,XVe),m=l.frustum.clone(),b=k.computeViewportTransformation(a,0,1,new k),x=l.frustum.projectionMatrix,T=l.positionWC.y,C=h.fromElements(R.sign(T)*p.x-T,0,-l.positionWC.x),S=Ft.pointToGLWindowCoordinates(x,b,C);if(T===0||S.x<=0||S.x>=s.clientWidth)u=!0;else{if(S.x>s.clientWidth*.5){a.width=S.x,l.frustum.right=p.x-T,qa=lw(r,n,l,qa),fa.clipToGLWindowCoordinates(a,qa,A4),a.x+=S.x,l.position.x=-l.position.x;let v=l.frustum.right;l.frustum.right=-l.frustum.left,l.frustum.left=-v,qa=lw(r,n,l,qa),fa.clipToGLWindowCoordinates(a,qa,C4)}else{a.x+=S.x,a.width-=S.x,l.frustum.left=-p.x-T,qa=lw(r,n,l,qa),fa.clipToGLWindowCoordinates(a,qa,A4),a.x=a.x-a.width,l.position.x=-l.position.x;let v=l.frustum.left;l.frustum.left=-l.frustum.right,l.frustum.right=-v,qa=lw(r,n,l,qa),fa.clipToGLWindowCoordinates(a,qa,C4)}h.clone(g,l.position),l.frustum=m.clone(),i=H.clone(A4,i),(i.x<0||i.x>s.clientWidth)&&(i.x=C4.x)}}if(o.mode!==oe.SCENE2D||u){if(qa=lw(r,n,l,qa),qa.z<0&&!(l.frustum instanceof rn)&&!(l.frustum instanceof er))return;i=fa.clipToGLWindowCoordinates(a,qa,i)}return i.y=s.clientHeight-i.y,i};fa.worldToDrawingBufferCoordinates=function(e,t,n){if(n=fa.worldToWindowCoordinates(e,t,n),!!c(n))return fa.transformWindowToDrawingBuffer(e,n,n)};var rp=new h,KVe=new he;fa.computeActualEllipsoidPosition=function(e,t,n){let i=e.mode;if(i===oe.SCENE3D)return h.clone(t,n);let o=e.mapProjection,r=o.ellipsoid.cartesianToCartographic(t,KVe);if(!c(r))return;if(o.project(r,rp),i===oe.COLUMBUS_VIEW)return h.fromElements(rp.z,rp.x,rp.y,n);if(i===oe.SCENE2D)return h.fromElements(0,rp.x,rp.y,n);let s=e.morphTime;return h.fromElements(R.lerp(rp.z,t.x,s),R.lerp(rp.x,t.y,s),R.lerp(rp.y,t.z,s),n)};var woe=new h,voe=new h,Doe=new k;fa.clipToGLWindowCoordinates=function(e,t,n){return h.divideByScalar(t,t.w,woe),k.computeViewportTransformation(e,0,1,Doe),k.multiplyByPoint(Doe,woe,voe),H.fromCartesian3(voe,n)};fa.transformWindowToDrawingBuffer=function(e,t,n){let i=e.canvas,o=e.drawingBufferWidth/i.clientWidth,r=e.drawingBufferHeight/i.clientHeight;return H.fromElements(t.x*o,t.y*r,n)};var $Ve=new se,Poe=new se;fa.drawingBufferToWorldCoordinates=function(e,t,n,i){let r=e.context.uniformState,s=r.currentFrustum,a=s.x,l=s.y;if(e.frameState.useLogDepth){let g=n*r.log2FarDepthFromNearPlusOne,m=Math.pow(2,g)-1;n=l*(1-a/(m+a))/(l-a)}let u=e.view.passState.viewport,f=se.clone(se.UNIT_W,$Ve);f.x=(t.x-u.x)/u.width*2-1,f.y=(t.y-u.y)/u.height*2-1,f.z=n*2-1,f.w=1;let d,p=e.camera.frustum;if(c(p.fovy)){d=k.multiplyByVector(r.inverseViewProjection,f,Poe);let g=1/d.w;h.multiplyByScalar(d,g,d)}else{let g=p.offCenterFrustum;c(g)&&(p=g),d=Poe,d.x=(f.x*(p.right-p.left)+p.left+p.right)*.5,d.y=(f.y*(p.top-p.bottom)+p.bottom+p.top)*.5,d.z=(f.z*(a-l)-a-l)*.5,d.w=1,d=k.multiplyByVector(r.inverseView,d,d)}return h.fromCartesian4(d,i)};var Ni=fa;var bT={};bT._deprecationWarning=Ss;var sp=Uint32Array.BYTES_PER_ELEMENT;bT.parse=function(e,t){let n=y(t,0);A.defined("arrayBuffer",e),t=n;let i=new Uint8Array(e),o=new DataView(e);t+=sp;let r=o.getUint32(t,!0);if(r!==1)throw new ue(`Only Batched 3D Model version 1 is supported.  Version ${r} is not.`);t+=sp;let s=o.getUint32(t,!0);t+=sp;let a=o.getUint32(t,!0);t+=sp;let l=o.getUint32(t,!0);t+=sp;let u=o.getUint32(t,!0);t+=sp;let f=o.getUint32(t,!0);t+=sp;let d;u>=570425344?(t-=sp*2,d=a,u=l,f=0,a=0,l=0,bT._deprecationWarning("b3dm-legacy-header","This b3dm header is using the legacy format [batchLength] [batchTableByteLength]. The new format is [featureTableJsonByteLength] [featureTableBinaryByteLength] [batchTableJsonByteLength] [batchTableBinaryByteLength] from https://github.com/CesiumGS/3d-tiles/tree/main/specification/TileFormats/Batched3DModel.")):f>=570425344&&(t-=sp,d=u,u=a,f=l,a=0,l=0,bT._deprecationWarning("b3dm-legacy-header","This b3dm header is using the legacy format [batchTableJsonByteLength] [batchTableBinaryByteLength] [batchLength]. The new format is [featureTableJsonByteLength] [featureTableBinaryByteLength] [batchTableJsonByteLength] [batchTableBinaryByteLength] from https://github.com/CesiumGS/3d-tiles/tree/main/specification/TileFormats/Batched3DModel."));let p;a===0?p={BATCH_LENGTH:y(d,0)}:(p=Ho(i,t,a),t+=a);let g=new Uint8Array(e,t,l);t+=l;let m,b;u>0&&(m=Ho(i,t,u),t+=u,f>0&&(b=new Uint8Array(e,t,f),b=new Uint8Array(b),t+=f));let x=n+s-t;if(x===0)throw new ue("glTF byte length must be greater than 0.");let T;return t%4===0?T=new Uint8Array(e,t,x):(bT._deprecationWarning("b3dm-glb-unaligned","The embedded glb is not aligned to a 4-byte boundary."),T=new Uint8Array(i.subarray(t,t+x))),{batchLength:d,featureTableJson:p,featureTableBinary:g,batchTableJson:m,batchTableBinary:b,gltf:T}};var E4=bT;function uw(e,t){this.json=e,this.buffer=t,this._cachedTypedArrays={},this.featuresLength=0}function Ioe(e,t,n,i,o,r){let s=e._cachedTypedArrays,a=s[t];return c(a)||(a=$.createArrayBufferView(n,e.buffer.buffer,e.buffer.byteOffset+r,o*i),s[t]=a),a}function ZVe(e,t,n,i){let o=e._cachedTypedArrays,r=o[t];return c(r)||(r=$.createTypedArray(n,i),o[t]=r),r}uw.prototype.getGlobalProperty=function(e,t,n){let i=this.json[e];if(c(i))return c(i.byteOffset)?(t=y(t,$.UNSIGNED_INT),n=y(n,1),Ioe(this,e,t,n,1,i.byteOffset)):i};uw.prototype.hasProperty=function(e){return c(this.json[e])};uw.prototype.getPropertyArray=function(e,t,n){let i=this.json[e];if(c(i))return c(i.byteOffset)?(c(i.componentType)&&(t=$.fromName(i.componentType)),Ioe(this,e,t,n,this.featuresLength,i.byteOffset)):ZVe(this,e,t,i)};uw.prototype.getProperty=function(e,t,n,i,o){let r=this.json[e];if(!c(r))return;let s=this.getPropertyArray(e,t,n);if(n===1)return s[i];for(let a=0;a<n;++a)o[a]=s[n*i+a];return o};var ap=uw;function fw(e){A.typeOf.number("options.count",e.count),A.typeOf.object("options.batchTable",e.batchTable);let t=e.count,n=e.batchTable,i=e.binaryBody,o=y(e.parseAsPropertyAttributes,!1),r=e.customAttributeOutput;if(o&&!c(r))throw new E("customAttributeOutput is required when parsing batch table as property attributes");let s=JVe(n),a;c(s.jsonProperties)&&(a=new C0({count:t,properties:s.jsonProperties}));let l;c(s.hierarchy)&&(l=new RS({extension:s.hierarchy,binaryBody:i}));let u=Qm.BATCH_TABLE_CLASS_NAME,f=s.binaryProperties,d,p,g;if(o){let x=eUe(t,u,f,i,r);g=x.transcodedSchema,p=[new ow({propertyAttribute:x.propertyAttributeJson,class:x.transcodedClass})]}else{let x=QVe(t,u,f,i);g=x.transcodedSchema;let T=x.featureTableJson;d=new qu({count:T.count,properties:T.properties,class:x.transcodedClass,bufferViews:x.bufferViewsTypedArrays}),p=[]}let m=[];if(c(d)||c(a)||c(l)){let x=new Hl({id:0,name:"Batch Table",count:t,metadataTable:d,jsonMetadataTable:a,batchTableHierarchy:l});m.push(x)}let b={schema:g,propertyTables:m,propertyAttributes:p,extensions:s.extensions,extras:s.extras};return new ua(b)}function JVe(e){let t=e.HIERARCHY,n=e.extras,i=e.extensions,o;c(t)?(fw._deprecationWarning("batchTableHierarchyExtension","The batch table HIERARCHY property has been moved to an extension. Use extensions.3DTILES_batch_table_hierarchy instead."),o=t):c(i)&&(o=i["3DTILES_batch_table_hierarchy"]);let r,s={};for(let a in e){if(!e.hasOwnProperty(a)||a==="HIERARCHY"||a==="extensions"||a==="extras")continue;let l=e[a];Array.isArray(l)?(r=c(r)?r:{},r[a]=l):s[a]=l}return{binaryProperties:s,jsonProperties:r,hierarchy:o,extras:n,extensions:i}}function QVe(e,t,n,i){let o={},r={},s={},a=0;for(let d in n){if(!n.hasOwnProperty(d))continue;if(!c(i))throw new ue(`Property ${d} requires a batch table binary.`);let p=n[d],g=Kf(p);r[d]={bufferView:a},o[d]=Ooe(p),s[a]=g.createArrayBufferView(i.buffer,i.byteOffset+p.byteOffset,e),a++}let l={classes:{}};l.classes[t]={properties:o};let u=Qf.fromJson(l);return{featureTableJson:{class:t,count:e,properties:r},bufferViewsTypedArrays:s,transcodedSchema:u,transcodedClass:u.classes[t]}}function eUe(e,t,n,i,o){let r={},s={},a=0;for(let d in n){if(!n.hasOwnProperty(d))continue;let p=n[d];if(!c(i)&&!c(p.typedArray))throw new ue(`Property ${d} requires a batch table binary.`);let g=Zt.sanitizeGlslIdentifier(d);(g===""||r.hasOwnProperty(g))&&(g=`property_${a}`,a++);let m=Ooe(p);m.name=d,r[g]=m;let b=g.toUpperCase();b.startsWith("_")||(b=`_${b}`);let x=p.typedArray;c(x)||(x=Kf(p).createArrayBufferView(i.buffer,i.byteOffset+p.byteOffset,e));let T=new Sn.Attribute;T.name=b,T.count=e,T.type=p.type;let C=$.fromTypedArray(x);(C===$.INT||C===$.UNSIGNED_INT||C===$.DOUBLE)&&(fw._oneTimeWarning("Cast pnts property to floats",`Point cloud property "${b}" will be cast to a float array because INT, UNSIGNED_INT, and DOUBLE are not valid WebGL vertex attribute types. Some precision may be lost.`),x=new Float32Array(x)),T.componentDatatype=$.fromTypedArray(x),T.typedArray=x,o.push(T),s[g]={attribute:b}}let l={classes:{}};l.classes[t]={properties:r};let u=Qf.fromJson(l);return{class:t,propertyAttributeJson:{properties:s},transcodedSchema:u,transcodedClass:u.classes[t]}}function Ooe(e){let t=tUe(e.componentType);return{type:e.type,componentType:t}}function tUe(e){switch(e){case"BYTE":return"INT8";case"UNSIGNED_BYTE":return"UINT8";case"SHORT":return"INT16";case"UNSIGNED_SHORT":return"UINT16";case"INT":return"INT32";case"UNSIGNED_INT":return"UINT32";case"FLOAT":return"FLOAT32";case"DOUBLE":return"FLOAT64"}}fw._deprecationWarning=Ss;fw._oneTimeWarning=_t;var v0=fw;var D0={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,FAILED:4},nUe=Sn.FeatureIdAttribute;function J_(e){e=y(e,y.EMPTY_OBJECT);let t=e.b3dmResource,n=e.baseResource,i=e.arrayBuffer,o=y(e.byteOffset,0),r=y(e.releaseGltfJson,!1),s=y(e.asynchronous,!0),a=y(e.incrementallyLoadTextures,!0),l=y(e.upAxis,zo.Y),u=y(e.forwardAxis,zo.X),f=y(e.loadAttributesAsTypedArray,!1),d=y(e.loadAttributesFor2D,!1),p=y(e.enablePick,!1),g=y(e.loadIndicesForWireframe,!1),m=y(e.loadPrimitiveOutline,!0),b=y(e.loadForClassification,!1);A.typeOf.object("options.b3dmResource",t),A.typeOf.object("options.arrayBuffer",i),n=c(n)?n:t.clone(),this._b3dmResource=t,this._baseResource=n,this._arrayBuffer=i,this._byteOffset=o,this._releaseGltfJson=r,this._asynchronous=s,this._incrementallyLoadTextures=a,this._upAxis=l,this._forwardAxis=u,this._loadAttributesAsTypedArray=f,this._loadAttributesFor2D=d,this._enablePick=p,this._loadIndicesForWireframe=g,this._loadPrimitiveOutline=m,this._loadForClassification=b,this._state=D0.UNLOADED,this._promise=void 0,this._gltfLoader=void 0,this._batchLength=0,this._propertyTable=void 0,this._batchTable=void 0,this._components=void 0,this._transform=k.IDENTITY}c(Object.create)&&(J_.prototype=Object.create(Zi.prototype),J_.prototype.constructor=J_);Object.defineProperties(J_.prototype,{texturesLoaded:{get:function(){return this._gltfLoader?.texturesLoaded}},cacheKey:{get:function(){}},components:{get:function(){return this._components}}});J_.prototype.load=function(){if(c(this._promise))return this._promise;let e=E4.parse(this._arrayBuffer,this._byteOffset),t=e.batchLength,n=e.featureTableJson,i=e.featureTableBinary,o=e.batchTableJson,r=e.batchTableBinary,s=new ap(n,i);t=s.getGlobalProperty("BATCH_LENGTH"),this._batchLength=t;let a=s.getGlobalProperty("RTC_CENTER",$.FLOAT,3);c(a)&&(this._transform=k.fromTranslation(h.fromArray(a))),this._batchTable={json:o,binary:r};let l=new S0({typedArray:e.gltf,upAxis:this._upAxis,forwardAxis:this._forwardAxis,gltfResource:this._b3dmResource,baseResource:this._baseResource,releaseGltfJson:this._releaseGltfJson,incrementallyLoadTextures:this._incrementallyLoadTextures,loadAttributesAsTypedArray:this._loadAttributesAsTypedArray,loadAttributesFor2D:this._loadAttributesFor2D,enablePick:this._enablePick,loadIndicesForWireframe:this._loadIndicesForWireframe,loadPrimitiveOutline:this._loadPrimitiveOutline,loadForClassification:this._loadForClassification,renameBatchIdSemantic:!0});this._gltfLoader=l,this._state=D0.LOADING;let u=this;return this._promise=l.load().then(function(){if(!u.isDestroyed())return u._state=D0.PROCESSING,u}).catch(function(f){if(!u.isDestroyed())return iUe(u,f)}),this._promise};function iUe(e,t){return e.unload(),e._state=D0.FAILED,t=e.getError("Failed to load b3dm",t),Promise.reject(t)}J_.prototype.process=function(e){if(A.typeOf.object("frameState",e),this._state===D0.READY)return!0;if(this._state!==D0.PROCESSING||!this._gltfLoader.process(e))return!1;let n=this._gltfLoader.components;return n.transform=k.multiplyTransformation(this._transform,n.transform,n.transform),oUe(this,n),this._components=n,this._arrayBuffer=void 0,this._state=D0.READY,!0};function oUe(e,t){let n=e._batchTable,i=e._batchLength;if(i===0)return;let o;if(c(n.json))o=v0({count:i,batchTable:n.json,binaryBody:n.binary});else{let a=new Hl({name:Qm.BATCH_TABLE_CLASS_NAME,count:i});o=new ua({schema:{},propertyTables:[a]})}let r=t.scene.nodes,s=r.length;for(let a=0;a<s;a++)Roe(r[a]);t.structuralMetadata=o}function Roe(e){let t=e.children.length;for(let i=0;i<t;i++)Roe(e.children[i]);let n=e.primitives.length;for(let i=0;i<n;i++){let o=e.primitives[i],r=Zt.getAttributeBySemantic(o,Ct.FEATURE_ID);if(c(r)){r.setIndex=0;let s=new nUe;s.propertyTableId=0,s.setIndex=0,s.positionalLabel="featureId_0",o.featureIds.push(s)}}}J_.prototype.unload=function(){c(this._gltfLoader)&&!this._gltfLoader.isDestroyed()&&this._gltfLoader.unload(),this._components=void 0,this._arrayBuffer=void 0};var S4=J_;function Q_(e){e=y(e,y.EMPTY_OBJECT),A.typeOf.object("options.geoJson",e.geoJson),this._geoJson=e.geoJson,this._components=void 0}c(Object.create)&&(Q_.prototype=Object.create(Zi.prototype),Q_.prototype.constructor=Q_);Object.defineProperties(Q_.prototype,{cacheKey:{get:function(){}},components:{get:function(){return this._components}}});Q_.prototype.load=function(){return Promise.resolve(this)};Q_.prototype.process=function(e){return A.typeOf.object("frameState",e),c(this._components)||(this._components=gUe(this._geoJson,e),this._geoJson=void 0),!0};function rUe(){this.lines=void 0,this.points=void 0,this.properties=void 0}function sUe(){this.features=[]}function w4(e){let t=e[0],n=e[1],i=y(e[2],0);return new h(t,n,i)}function v4(e){let t=e.length,n=new Array(t);for(let o=0;o<t;o++)n[o]=w4(e[o]);return[n]}function aUe(e){let t=e.length,n=new Array(t);for(let i=0;i<t;i++)n[i]=v4(e[i])[0];return n}function Moe(e){let t=e.length,n=new Array(t);for(let i=0;i<t;i++)n[i]=v4(e[i])[0];return n}function cUe(e){let t=e.length,n=[];for(let i=0;i<t;i++)Array.prototype.push.apply(n,Moe(e[i]));return n}function lUe(e){return[w4(e)]}function uUe(e){let t=e.length,n=new Array(t);for(let i=0;i<t;i++)n[i]=w4(e[i]);return n}var fUe={LineString:v4,MultiLineString:aUe,MultiPolygon:cUe,Polygon:Moe,MultiPoint:uUe,Point:lUe},dUe={LineString:Me.LINES,MultiLineString:Me.LINES,MultiPolygon:Me.LINES,Polygon:Me.LINES,MultiPoint:Me.POINTS,Point:Me.POINTS};function Loe(e,t){if(!c(e.geometry))return;let n=e.geometry.type,i=fUe[n],o=dUe[n],r=e.geometry.coordinates;if(!c(i)||!c(r))return;let s=new rUe;o===Me.LINES?s.lines=i(r):o===Me.POINTS&&(s.points=i(r)),s.properties=e.properties,t.features.push(s)}function hUe(e,t){let n=e.features,i=n.length;for(let o=0;o<i;o++)Loe(n[o],t)}var mUe={FeatureCollection:hUe,Feature:Loe},n1=new h;function pUe(e,t,n){let i=0,o=0,r=e.length;for(let N=0;N<r;N++){let B=e[N];if(c(B.lines)){let _=B.lines.length;for(let w=0;w<_;w++){let P=B.lines[w];i+=P.length,o+=(P.length-1)*2}}}let s=new Float32Array(i*3),a=new Float32Array(i),l=Fe.createTypedArray(i,o),u=Fe.fromTypedArray(l),f=new h(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),d=new h(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),p=0,g=0;for(let N=0;N<r;N++){let B=e[N];if(!c(B.lines))continue;let _=B.lines.length;for(let w=0;w<_;w++){let P=B.lines[w],O=P.length;for(let F=0;F<O;F++){let V=P[F],G=h.fromDegrees(V.x,V.y,V.z,ie.WGS84,n1),z=k.multiplyByPoint(t,G,n1);h.minimumByComponent(f,z,f),h.maximumByComponent(d,z,d),h.pack(z,s,p*3),a[p]=N,F<O-1&&(l[g*2]=p,l[g*2+1]=p+1,g++),p++}}}let m=xt.createVertexBuffer({typedArray:s,context:n.context,usage:ke.STATIC_DRAW});m.vertexArrayDestroyable=!1;let b=xt.createVertexBuffer({typedArray:a,context:n.context,usage:ke.STATIC_DRAW});b.vertexArrayDestroyable=!1;let x=xt.createIndexBuffer({typedArray:l,context:n.context,usage:ke.STATIC_DRAW,indexDatatype:u});x.vertexArrayDestroyable=!1;let T=new Sn.Attribute;T.semantic=Ct.POSITION,T.componentDatatype=$.FLOAT,T.type=cn.VEC3,T.count=i,T.min=f,T.max=d,T.buffer=m;let C=new Sn.Attribute;C.semantic=Ct.FEATURE_ID,C.setIndex=0,C.componentDatatype=$.FLOAT,C.type=cn.SCALAR,C.count=i,C.buffer=b;let S=[T,C],v=new Sn.Material;v.unlit=!0;let D=new Sn.Indices;D.indexDatatype=u,D.count=l.length,D.buffer=x;let I=new Sn.FeatureIdAttribute;I.featureCount=r,I.propertyTableId=0,I.setIndex=0,I.positionalLabel="featureId_0";let L=[I],M=new Sn.Primitive;return M.attributes=S,M.indices=D,M.featureIds=L,M.primitiveType=Me.LINES,M.material=v,M}function _Ue(e,t,n){let i=0,o=e.length;for(let S=0;S<o;S++){let v=e[S];c(v.points)&&(i+=v.points.length)}let r=new Float32Array(i*3),s=new Float32Array(i),a=new h(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),l=new h(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),u=0;for(let S=0;S<o;S++){let v=e[S];if(!c(v.points))continue;let D=v.points.length;for(let I=0;I<D;I++){let L=v.points[I],M=h.fromDegrees(L.x,L.y,L.z,ie.WGS84,n1),N=k.multiplyByPoint(t,M,n1);h.minimumByComponent(a,N,a),h.maximumByComponent(l,N,l),h.pack(N,r,u*3),s[u]=S,u++}}let f=xt.createVertexBuffer({typedArray:r,context:n.context,usage:ke.STATIC_DRAW});f.vertexArrayDestroyable=!1;let d=xt.createVertexBuffer({typedArray:s,context:n.context,usage:ke.STATIC_DRAW});d.vertexArrayDestroyable=!1;let p=new Sn.Attribute;p.semantic=Ct.POSITION,p.componentDatatype=$.FLOAT,p.type=cn.VEC3,p.count=i,p.min=a,p.max=l,p.buffer=f;let g=new Sn.Attribute;g.semantic=Ct.FEATURE_ID,g.setIndex=0,g.componentDatatype=$.FLOAT,g.type=cn.SCALAR,g.count=i,g.buffer=d;let m=[p,g],b=new Sn.Material;b.unlit=!0;let x=new Sn.FeatureIdAttribute;x.featureCount=o,x.propertyTableId=0,x.setIndex=0,x.positionalLabel="featureId_0";let T=[x],C=new Sn.Primitive;return C.attributes=m,C.featureIds=T,C.primitiveType=Me.POINTS,C.material=b,C}function gUe(e,t){let n=new sUe,i=mUe[e.type];c(i)&&i(e,n);let o=n.features,r=o.length;if(r===0)throw new ue("GeoJSON must have at least one feature");let s={};for(let N=0;N<r;N++){let B=o[N],_=y(B.properties,y.EMPTY_OBJECT);for(let w in _)_.hasOwnProperty(w)&&(c(s[w])||(s[w]=new Array(r)))}for(let N=0;N<r;N++){let B=o[N];for(let _ in s)if(s.hasOwnProperty(_)){let w=y(B.properties[_],"");s[_][N]=w}}let a=new C0({count:r,properties:s}),u=[new Hl({id:0,count:r,jsonMetadataTable:a})],f=Qf.fromJson({}),d=new ua({schema:f,propertyTables:u}),p=new h(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),g=new h(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),m=!1,b=!1;for(let N=0;N<r;N++){let B=o[N];if(c(B.lines)){m=!0;let _=B.lines.length;for(let w=0;w<_;w++){let P=B.lines[w],O=P.length;for(let F=0;F<O;F++)h.minimumByComponent(p,P[F],p),h.maximumByComponent(g,P[F],g)}}if(c(B.points)){b=!0;let _=B.points.length;for(let w=0;w<_;w++){let P=B.points[w];h.minimumByComponent(p,P,p),h.maximumByComponent(g,P,g)}}}let x=h.midpoint(p,g,new h),T=h.fromDegrees(x.x,x.y,x.z,ie.WGS84,new h),C=Ft.eastNorthUpToFixedFrame(T,ie.WGS84,new k),S=k.inverseTransformation(C,new k),v=[];m&&v.push(pUe(o,S,t)),b&&v.push(_Ue(o,S,t));let D=new Sn.Node;D.index=0,D.primitives=v;let I=[D],L=new Sn.Scene;L.nodes=I;let M=new Sn.Components;return M.scene=L,M.nodes=I,M.transform=C,M.structuralMetadata=d,M}Q_.prototype.unload=function(){this._components=void 0};var D4=Q_;var i1={};i1._deprecationWarning=Ss;var eg=Uint32Array.BYTES_PER_ELEMENT;i1.parse=function(e,t){A.defined("arrayBuffer",e);let n=y(t,0);t=n;let i=new Uint8Array(e),o=new DataView(e);t+=eg;let r=o.getUint32(t,!0);if(r!==1)throw new ue(`Only Instanced 3D Model version 1 is supported. Version ${r} is not.`);t+=eg;let s=o.getUint32(t,!0);t+=eg;let a=o.getUint32(t,!0);if(a===0)throw new ue("featureTableJsonByteLength is zero, the feature table must be defined.");t+=eg;let l=o.getUint32(t,!0);t+=eg;let u=o.getUint32(t,!0);t+=eg;let f=o.getUint32(t,!0);t+=eg;let d=o.getUint32(t,!0);if(d!==1&&d!==0)throw new ue(`Only glTF format 0 (uri) or 1 (embedded) are supported. Format ${d} is not.`);t+=eg;let p=Ho(i,t,a);t+=a;let g=new Uint8Array(e,t,l);t+=l;let m,b;u>0&&(m=Ho(i,t,u),t+=u,f>0&&(b=new Uint8Array(e,t,f),b=new Uint8Array(b),t+=f));let x=n+s-t;if(x===0)throw new ue("glTF byte length must be greater than 0.");let T;return t%4===0?T=new Uint8Array(e,t,x):(i1._deprecationWarning("i3dm-glb-unaligned","The embedded glb is not aligned to a 4-byte boundary."),T=new Uint8Array(i.subarray(t,t+x))),{gltfFormat:d,featureTableJson:p,featureTableBinary:g,batchTableJson:m,batchTableBinary:b,gltf:T}};var P4=i1;var cp={NOT_LOADED:0,LOADING:1,PROCESSING:2,POST_PROCESSING:3,READY:4,FAILED:5,UNLOADED:6},o1=Sn.Attribute,yUe=Sn.FeatureIdAttribute,Foe=Sn.Instances;function lp(e){e=y(e,y.EMPTY_OBJECT);let t=e.i3dmResource,n=e.arrayBuffer,i=e.baseResource,o=y(e.byteOffset,0),r=y(e.releaseGltfJson,!1),s=y(e.asynchronous,!0),a=y(e.incrementallyLoadTextures,!0),l=y(e.upAxis,zo.Y),u=y(e.forwardAxis,zo.X),f=y(e.loadAttributesAsTypedArray,!1),d=y(e.loadIndicesForWireframe,!1),p=y(e.loadPrimitiveOutline,!0),g=y(e.enablePick,!1);A.typeOf.object("options.i3dmResource",t),A.typeOf.object("options.arrayBuffer",n),i=c(i)?i:t.clone(),this._i3dmResource=t,this._baseResource=i,this._arrayBuffer=n,this._byteOffset=o,this._releaseGltfJson=r,this._asynchronous=s,this._incrementallyLoadTextures=a,this._upAxis=l,this._forwardAxis=u,this._loadAttributesAsTypedArray=f,this._loadIndicesForWireframe=d,this._loadPrimitiveOutline=p,this._enablePick=g,this._state=cp.NOT_LOADED,this._promise=void 0,this._gltfLoader=void 0,this._buffers=[],this._components=void 0,this._transform=k.IDENTITY,this._batchTable=void 0,this._featureTable=void 0,this._instancesLength=0}c(Object.create)&&(lp.prototype=Object.create(Zi.prototype),lp.prototype.constructor=lp);Object.defineProperties(lp.prototype,{texturesLoaded:{get:function(){return this._gltfLoader?.texturesLoaded}},cacheKey:{get:function(){}},components:{get:function(){return this._components}}});lp.prototype.load=function(){if(c(this._promise))return this._promise;let e=P4.parse(this._arrayBuffer,this._byteOffset),t=e.featureTableJson,n=e.featureTableBinary,i=e.batchTableJson,o=e.batchTableBinary,r=e.gltfFormat,s=new ap(t,n);this._featureTable=s;let a=s.getGlobalProperty("INSTANCES_LENGTH");if(s.featuresLength=a,!c(a))throw new ue("Feature table global property: INSTANCES_LENGTH must be defined");this._instancesLength=a;let l=s.getGlobalProperty("RTC_CENTER",$.FLOAT,3);c(l)&&(this._transform=k.fromTranslation(h.fromArray(l))),this._batchTable={json:i,binary:o};let u={upAxis:this._upAxis,forwardAxis:this._forwardAxis,releaseGltfJson:this._releaseGltfJson,incrementallyLoadTextures:this._incrementallyLoadTextures,loadAttributesAsTypedArray:this._loadAttributesAsTypedArray,enablePick:this._enablePick,loadIndicesForWireframe:this._loadIndicesForWireframe,loadPrimitiveOutline:this._loadPrimitiveOutline};if(r===0){let d=Gu(e.gltf);d=d.replace(/[\s\0]+$/,"");let p=this._baseResource.getDerivedResource({url:d});u.gltfResource=p,u.baseResource=p}else u.gltfResource=this._i3dmResource,u.typedArray=e.gltf;let f=new S0(u);return this._gltfLoader=f,this._state=cp.LOADING,this._promise=f.load().then(()=>{if(!this.isDestroyed())return this._state=cp.PROCESSING,this}).catch(d=>{if(!this.isDestroyed())throw bUe(this,d)}),this._promise};function bUe(e,t){return e.unload(),e._state=cp.FAILED,e.getError("Failed to load i3dm",t)}lp.prototype.process=function(e){if(A.typeOf.object("frameState",e),this._state===cp.READY)return!0;let t=this._gltfLoader,n=!1;if(this._state===cp.PROCESSING&&(n=t.process(e)),!n)return!1;let i=t.components;return i.transform=k.multiplyTransformation(this._transform,i.transform,i.transform),AUe(this,i,e),xUe(this,i),this._components=i,this._arrayBuffer=void 0,this._state=cp.READY,!0};function xUe(e,t){let n=e._batchTable,i=e._instancesLength;if(i===0)return;let o;if(c(n.json))o=v0({count:i,batchTable:n.json,binaryBody:n.binary});else{let r=new Hl({name:Qm.BATCH_TABLE_CLASS_NAME,count:i});o=new ua({schema:{},propertyTables:[r]})}t.structuralMetadata=o}var r1=new h,I4=new Array(4),TUe=new k;function AUe(e,t,n){let i,o=e._featureTable,r=e._instancesLength;if(r===0)return;let s=o.getGlobalProperty("RTC_CENTER",$.FLOAT,3),a=o.getGlobalProperty("EAST_NORTH_UP"),l=o.hasProperty("NORMAL_UP")||o.hasProperty("NORMAL_UP_OCT32P")||a,u=o.hasProperty("SCALE")||o.hasProperty("SCALE_NON_UNIFORM"),f=EUe(o,r),d;l&&(d=new Float32Array(4*r));let p;u&&(p=new Float32Array(3*r));let g=new Float32Array(r),m=h.unpackArray(f),b=new h,x=new h,T=new h,C=new h,S=new Q,v=new Ne,D=new Array(4),I=new h,L=new Array(3),M=new k;if(!c(s)||h.equals(h.unpack(s),h.ZERO)){let z=ce.fromPoints(m);for(i=0;i<m.length;i++)h.subtract(m[i],z.center,r1),f[3*i+0]=r1.x,f[3*i+1]=r1.y,f[3*i+2]=r1.z;let W=k.fromTranslation(z.center,TUe);t.transform=k.multiplyTransformation(W,t.transform,t.transform)}for(i=0;i<r;i++){b=h.clone(m[i]),c(s)&&h.add(b,h.unpack(s),b),l&&(SUe(o,a,i,v,b,T,x,C,S,M),Ne.pack(v,D,0),d[4*i+0]=D[0],d[4*i+1]=D[1],d[4*i+2]=D[2],d[4*i+3]=D[3]),u&&(wUe(o,i,I),h.pack(I,L,0),p[3*i+0]=L[0],p[3*i+1]=L[1],p[3*i+2]=L[2]);let z=o.getProperty("BATCH_ID",$.UNSIGNED_SHORT,1,i);c(z)||(z=i),g[i]=z}let N=new Foe;N.transformInWorldSpace=!0;let B=e._buffers,_=new o1;if(_.name="Instance Translation",_.semantic=fs.TRANSLATION,_.componentDatatype=$.FLOAT,_.type=cn.VEC3,_.count=r,_.typedArray=f,!l){let z=xt.createVertexBuffer({context:n.context,typedArray:f,usage:ke.STATIC_DRAW});z.vertexArrayDestroyable=!1,B.push(z),_.buffer=z}if(N.attributes.push(_),l){let z=new o1;z.name="Instance Rotation",z.semantic=fs.ROTATION,z.componentDatatype=$.FLOAT,z.type=cn.VEC4,z.count=r,z.typedArray=d,N.attributes.push(z)}if(u){let z=new o1;if(z.name="Instance Scale",z.semantic=fs.SCALE,z.componentDatatype=$.FLOAT,z.type=cn.VEC3,z.count=r,l)z.typedArray=p;else{let W=xt.createVertexBuffer({context:n.context,typedArray:p,usage:ke.STATIC_DRAW});W.vertexArrayDestroyable=!1,B.push(W),z.buffer=W}N.attributes.push(z)}let w=new o1;w.name="Instance Feature ID",w.setIndex=0,w.semantic=fs.FEATURE_ID,w.componentDatatype=$.FLOAT,w.type=cn.SCALAR,w.count=r;let P=xt.createVertexBuffer({context:n.context,typedArray:g,usage:ke.STATIC_DRAW});P.vertexArrayDestroyable=!1,B.push(P),w.buffer=P,N.attributes.push(w);let O=new yUe;O.propertyTableId=0,O.setIndex=0,O.positionalLabel="instanceFeatureId_0",N.featureIds.push(O);let F=t.nodes,V=F.length,G=!1;for(i=0;i<V;i++){let z=F[i];z.primitives.length>0&&(z.instances=G?CUe(N):N,G=!0)}}function CUe(e){let t=new Foe;t.transformInWorldSpace=e.transformInWorldSpace;let n=e.attributes,i=n.length;for(let o=0;o<i;o++){let r=qe(n[o],!1);t.attributes.push(r)}return t.featureIds=e.featureIds,t}function EUe(e,t){if(e.hasProperty("POSITION"))return e.getPropertyArray("POSITION",$.FLOAT,3);if(e.hasProperty("POSITION_QUANTIZED")){let n=e.getPropertyArray("POSITION_QUANTIZED",$.UNSIGNED_SHORT,3),i=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",$.FLOAT,3);if(!c(i))throw new ue("Global property: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");let o=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",$.FLOAT,3);if(!c(o))throw new ue("Global property: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");let r=new Float32Array(n.length);for(let s=0;s<n.length/3;s++)for(let a=0;a<3;a++){let l=3*s+a;r[l]=n[l]/65535*o[a]+i[a]}return r}else throw new ue("Either POSITION or POSITION_QUANTIZED must be defined for each instance.")}var Noe=new Array(4);function SUe(e,t,n,i,o,r,s,a,l,u){let f=e.getProperty("NORMAL_UP",$.FLOAT,3,n,I4),d=e.getProperty("NORMAL_RIGHT",$.FLOAT,3,n,Noe),p=!1;if(c(f)){if(!c(d))throw new ue("To define a custom orientation, both NORMAL_UP and NORMAL_RIGHT must be defined.");h.unpack(f,0,r),h.unpack(d,0,s),p=!0}else{let g=e.getProperty("NORMAL_UP_OCT32P",$.UNSIGNED_SHORT,2,n,I4),m=e.getProperty("NORMAL_RIGHT_OCT32P",$.UNSIGNED_SHORT,2,n,Noe);if(c(g)){if(!c(m))throw new ue("To define a custom orientation with oct-encoded vectors, both NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P must be defined.");Nn.octDecodeInRange(g[0],g[1],65535,r),Nn.octDecodeInRange(m[0],m[1],65535,s),p=!0}else t?(Ft.eastNorthUpToFixedFrame(o,ie.WGS84,u),k.getMatrix3(u,l)):Q.clone(Q.IDENTITY,l)}p&&(h.cross(s,r,a),h.normalize(a,a),Q.setColumn(l,0,s,l),Q.setColumn(l,1,r,l),Q.setColumn(l,2,a,l)),Ne.fromRotationMatrix(l,i)}function wUe(e,t,n){n=h.fromElements(1,1,1,n);let i=e.getProperty("SCALE",$.FLOAT,1,t);c(i)&&h.multiplyByScalar(n,i,n);let o=e.getProperty("SCALE_NON_UNIFORM",$.FLOAT,3,t,I4);c(o)&&(n.x*=o[0],n.y*=o[1],n.z*=o[2])}function vUe(e){let t=e._buffers,n=t.length;for(let i=0;i<n;i++){let o=t[i];o.isDestroyed()||o.destroy()}t.length=0}lp.prototype.isUnloaded=function(){return this._state===cp.UNLOADED};lp.prototype.unload=function(){c(this._gltfLoader)&&!this._gltfLoader.isDestroyed()&&this._gltfLoader.unload(),vUe(this),this._components=void 0,this._arrayBuffer=void 0,this._state=cp.UNLOADED};var O4=lp;var DUe={STOPPED:0,ANIMATING:1},up=Object.freeze(DUe);function xT(){this.times=void 0,this.points=void 0,E.throwInstantiationError()}xT.getPointType=function(e){if(typeof e=="number")return Number;if(e instanceof h)return h;if(e instanceof Ne)return Ne;throw new E("point must be a Cartesian3, Quaternion, or number.")};xT.prototype.evaluate=E.throwInstantiationError;xT.prototype.findTimeInterval=function(e,t){let n=this.times,i=n.length;if(A.typeOf.number("time",e),e<n[0]||e>n[i-1])throw new E("time is out of range.");if(t=y(t,0),e>=n[t]){if(t+1<i&&e<n[t+1])return t;if(t+2<i&&e<n[t+2])return t+1}else if(t-1>=0&&e>=n[t-1])return t-1;let o;if(e>n[t])for(o=t;o<i-1&&!(e>=n[o]&&e<n[o+1]);++o);else for(o=t-1;o>=0&&!(e>=n[o]&&e<n[o+1]);--o);return o===i-1&&(o=i-2),o};xT.prototype.wrapTime=function(e){A.typeOf.number("time",e);let t=this.times,n=t[t.length-1],i=t[0],o=n-i,r;return e<i&&(r=Math.floor((i-e)/o)+1,e+=r*o),e>n&&(r=Math.floor((e-n)/o)+1,e-=r*o),e};xT.prototype.clampTime=function(e){A.typeOf.number("time",e);let t=this.times;return R.clamp(e,t[0],t[t.length-1])};var Fi=xT;function TT(e){this._value=e,this._valueType=Fi.getPointType(e)}Object.defineProperties(TT.prototype,{value:{get:function(){return this._value}}});TT.prototype.findTimeInterval=function(e){throw new E("findTimeInterval cannot be called on a ConstantSpline.")};TT.prototype.wrapTime=function(e){return A.typeOf.number("time",e),0};TT.prototype.clampTime=function(e){return A.typeOf.number("time",e),0};TT.prototype.evaluate=function(e,t){A.typeOf.number("time",e);let n=this._value,i=this._valueType;return i===Number?n:i.clone(n,t)};var R4=TT;function AT(e){e=y(e,y.EMPTY_OBJECT);let t=e.points,n=e.times;if(!c(t)||!c(n))throw new E("points and times are required.");if(t.length<2)throw new E("points.length must be greater than or equal to 2.");if(n.length!==t.length)throw new E("times.length must be equal to points.length.");this._times=n,this._points=t,this._pointType=Fi.getPointType(t[0]),this._lastTimeIndex=0}Object.defineProperties(AT.prototype,{times:{get:function(){return this._times}},points:{get:function(){return this._points}}});AT.prototype.findTimeInterval=Fi.prototype.findTimeInterval;AT.prototype.wrapTime=Fi.prototype.wrapTime;AT.prototype.clampTime=Fi.prototype.clampTime;AT.prototype.evaluate=function(e,t){let n=this.points,i=this.times,o=this._lastTimeIndex=this.findTimeInterval(e,this._lastTimeIndex),r=(e-i[o])/(i[o+1]-i[o]);return this._pointType===Number?(1-r)*n[o]+r*n[o+1]:(c(t)||(t=new h),h.lerp(n[o],n[o+1],r,t))};var CT=AT;var Boe={};Boe.solve=function(e,t,n,i){if(!c(e)||!(e instanceof Array))throw new E("The array lower is required.");if(!c(t)||!(t instanceof Array))throw new E("The array diagonal is required.");if(!c(n)||!(n instanceof Array))throw new E("The array upper is required.");if(!c(i)||!(i instanceof Array))throw new E("The array right is required.");if(t.length!==i.length)throw new E("diagonal and right must have the same lengths.");if(e.length!==n.length)throw new E("lower and upper must have the same lengths.");if(e.length!==t.length-1)throw new E("lower and upper must be one less than the length of diagonal.");let o=new Array(n.length),r=new Array(i.length),s=new Array(i.length),a;for(a=0;a<r.length;a++)r[a]=new h,s[a]=new h;o[0]=n[0]/t[0],r[0]=h.multiplyByScalar(i[0],1/t[0],r[0]);let l;for(a=1;a<o.length;++a)l=1/(t[a]-o[a-1]*e[a-1]),o[a]=n[a]*l,r[a]=h.subtract(i[a],h.multiplyByScalar(r[a-1],e[a-1],r[a]),r[a]),r[a]=h.multiplyByScalar(r[a],l,r[a]);for(l=1/(t[a]-o[a-1]*e[a-1]),r[a]=h.subtract(i[a],h.multiplyByScalar(r[a-1],e[a-1],r[a]),r[a]),r[a]=h.multiplyByScalar(r[a],l,r[a]),s[s.length-1]=r[r.length-1],a=s.length-2;a>=0;--a)s[a]=h.subtract(r[a],h.multiplyByScalar(s[a+1],o[a],s[a]),s[a]);return s};var s1=Boe;var koe=[],Voe=[],Uoe=[],zoe=[];function PUe(e,t,n){let i=koe,o=Uoe,r=Voe,s=zoe;i.length=o.length=e.length-1,r.length=s.length=e.length;let a;i[0]=r[0]=1,o[0]=0;let l=s[0];for(c(l)||(l=s[0]=new h),h.clone(t,l),a=1;a<i.length-1;++a)i[a]=o[a]=1,r[a]=4,l=s[a],c(l)||(l=s[a]=new h),h.subtract(e[a+1],e[a-1],l),h.multiplyByScalar(l,3,l);return i[a]=0,o[a]=1,r[a]=4,l=s[a],c(l)||(l=s[a]=new h),h.subtract(e[a+1],e[a-1],l),h.multiplyByScalar(l,3,l),r[a+1]=1,l=s[a+1],c(l)||(l=s[a+1]=new h),h.clone(n,l),s1.solve(i,r,o,s)}function IUe(e){let t=koe,n=Uoe,i=Voe,o=zoe;t.length=n.length=e.length-1,i.length=o.length=e.length;let r;t[0]=n[0]=1,i[0]=2;let s=o[0];for(c(s)||(s=o[0]=new h),h.subtract(e[1],e[0],s),h.multiplyByScalar(s,3,s),r=1;r<t.length;++r)t[r]=n[r]=1,i[r]=4,s=o[r],c(s)||(s=o[r]=new h),h.subtract(e[r+1],e[r-1],s),h.multiplyByScalar(s,3,s);return i[r]=2,s=o[r],c(s)||(s=o[r]=new h),h.subtract(e[r],e[r-1],s),h.multiplyByScalar(s,3,s),s1.solve(t,i,n,o)}function cl(e){e=y(e,y.EMPTY_OBJECT);let t=e.points,n=e.times,i=e.inTangents,o=e.outTangents;if(!c(t)||!c(n)||!c(i)||!c(o))throw new E("times, points, inTangents, and outTangents are required.");if(t.length<2)throw new E("points.length must be greater than or equal to 2.");if(n.length!==t.length)throw new E("times.length must be equal to points.length.");if(i.length!==o.length||i.length!==t.length-1)throw new E("inTangents and outTangents must have a length equal to points.length - 1.");if(this._times=n,this._points=t,this._pointType=Fi.getPointType(t[0]),this._pointType!==Fi.getPointType(i[0])||this._pointType!==Fi.getPointType(o[0]))throw new E("inTangents and outTangents must be of the same type as points.");this._inTangents=i,this._outTangents=o,this._lastTimeIndex=0}Object.defineProperties(cl.prototype,{times:{get:function(){return this._times}},points:{get:function(){return this._points}},inTangents:{get:function(){return this._inTangents}},outTangents:{get:function(){return this._outTangents}}});cl.createC1=function(e){e=y(e,y.EMPTY_OBJECT);let t=e.times,n=e.points,i=e.tangents;if(!c(n)||!c(t)||!c(i))throw new E("points, times and tangents are required.");if(n.length<2)throw new E("points.length must be greater than or equal to 2.");if(t.length!==n.length||t.length!==i.length)throw new E("times, points and tangents must have the same length.");let o=i.slice(0,i.length-1),r=i.slice(1,i.length);return new cl({times:t,points:n,inTangents:r,outTangents:o})};cl.createNaturalCubic=function(e){e=y(e,y.EMPTY_OBJECT);let t=e.times,n=e.points;if(!c(n)||!c(t))throw new E("points and times are required.");if(n.length<2)throw new E("points.length must be greater than or equal to 2.");if(t.length!==n.length)throw new E("times.length must be equal to points.length.");if(n.length<3)return new CT({points:n,times:t});let i=IUe(n),o=i.slice(0,i.length-1),r=i.slice(1,i.length);return new cl({times:t,points:n,inTangents:r,outTangents:o})};cl.createClampedCubic=function(e){e=y(e,y.EMPTY_OBJECT);let t=e.times,n=e.points,i=e.firstTangent,o=e.lastTangent;if(!c(n)||!c(t)||!c(i)||!c(o))throw new E("points, times, firstTangent and lastTangent are required.");if(n.length<2)throw new E("points.length must be greater than or equal to 2.");if(t.length!==n.length)throw new E("times.length must be equal to points.length.");let r=Fi.getPointType(n[0]);if(r!==Fi.getPointType(i)||r!==Fi.getPointType(o))throw new E("firstTangent and lastTangent must be of the same type as points.");if(n.length<3)return new CT({points:n,times:t});let s=PUe(n,i,o),a=s.slice(0,s.length-1),l=s.slice(1,s.length);return new cl({times:t,points:n,inTangents:l,outTangents:a})};cl.hermiteCoefficientMatrix=new k(2,-3,0,1,-2,3,0,0,1,-2,1,0,1,-1,0,0);cl.prototype.findTimeInterval=Fi.prototype.findTimeInterval;var OUe=new se,ET=new h;cl.prototype.wrapTime=Fi.prototype.wrapTime;cl.prototype.clampTime=Fi.prototype.clampTime;cl.prototype.evaluate=function(e,t){let n=this.points,i=this.times,o=this.inTangents,r=this.outTangents;this._lastTimeIndex=this.findTimeInterval(e,this._lastTimeIndex);let s=this._lastTimeIndex,a=i[s+1]-i[s],l=(e-i[s])/a,u=OUe;u.z=l,u.y=l*l,u.x=u.y*l,u.w=1;let f=k.multiplyByVector(cl.hermiteCoefficientMatrix,u,u);f.z*=a,f.w*=a;let d=this._pointType;return d===Number?n[s]*f.x+n[s+1]*f.y+r[s]*f.z+o[s]*f.w:(c(t)||(t=new d),t=d.multiplyByScalar(n[s],f.x,t),d.multiplyByScalar(n[s+1],f.y,ET),d.add(t,ET,t),d.multiplyByScalar(r[s],f.z,ET),d.add(t,ET,t),d.multiplyByScalar(o[s],f.w,ET),d.add(t,ET,t))};var ST=cl;function wT(e){e=y(e,y.EMPTY_OBJECT);let t=e.points,n=e.times;if(!c(t)||!c(n))throw new E("points and times are required.");if(t.length<2)throw new E("points.length must be greater than or equal to 2.");if(n.length!==t.length)throw new E("times.length must be equal to points.length.");this._times=n,this._points=t,this._pointType=Fi.getPointType(t[0]),this._lastTimeIndex=0}Object.defineProperties(wT.prototype,{times:{get:function(){return this._times}},points:{get:function(){return this._points}}});wT.prototype.findTimeInterval=Fi.prototype.findTimeInterval;wT.prototype.wrapTime=Fi.prototype.wrapTime;wT.prototype.clampTime=Fi.prototype.clampTime;wT.prototype.evaluate=function(e,t){let n=this.points;this._lastTimeIndex=this.findTimeInterval(e,this._lastTimeIndex);let i=this._lastTimeIndex,o=this._pointType;return o===Number?n[i]:(c(t)||(t=new o),o.clone(n[i],t))};var M4=wT;function RUe(e){let t=e.points,n=e.times;return function(i,o){c(o)||(o=new Ne);let r=e._lastTimeIndex=e.findTimeInterval(i,e._lastTimeIndex),s=(i-n[r])/(n[r+1]-n[r]),a=t[r],l=t[r+1];return Ne.fastSlerp(a,l,s,o)}}function vT(e){e=y(e,y.EMPTY_OBJECT);let t=e.points,n=e.times;if(!c(t)||!c(n))throw new E("points and times are required.");if(t.length<2)throw new E("points.length must be greater than or equal to 2.");if(n.length!==t.length)throw new E("times.length must be equal to points.length.");this._times=n,this._points=t,this._evaluateFunction=RUe(this),this._lastTimeIndex=0}Object.defineProperties(vT.prototype,{times:{get:function(){return this._times}},points:{get:function(){return this._points}}});vT.prototype.findTimeInterval=Fi.prototype.findTimeInterval;vT.prototype.wrapTime=Fi.prototype.wrapTime;vT.prototype.clampTime=Fi.prototype.clampTime;vT.prototype.evaluate=function(e,t){return this._evaluateFunction(e,t)};var L4=vT;var DT=Sn.AnimatedPropertyType;function N4(e){e=y(e,y.EMPTY_OBJECT);let t=e.channel,n=e.runtimeAnimation,i=e.runtimeNode;A.typeOf.object("options.channel",t),A.typeOf.object("options.runtimeAnimation",n),A.typeOf.object("options.runtimeNode",i),this._channel=t,this._runtimeAnimation=n,this._runtimeNode=i,this._splines=[],this._path=void 0,BUe(this)}Object.defineProperties(N4.prototype,{channel:{get:function(){return this._channel}},runtimeAnimation:{get:function(){return this._runtimeAnimation}},runtimeNode:{get:function(){return this._runtimeNode}},splines:{get:function(){return this._splines}}});function MUe(e,t){let n=[],i=[],o=[],r=t.length;for(let s=0;s<r;s+=3)i.push(t[s]),n.push(t[s+1]),o.push(t[s+2]);return i.splice(0,1),o.length=o.length-1,new ST({times:e,points:n,inTangents:i,outTangents:o})}function Hoe(e,t,n,i){if(e.length===1&&t.length===1)return new R4(t[0]);switch(n){case op.STEP:return new M4({times:e,points:t});case op.CUBICSPLINE:return MUe(e,t);case op.LINEAR:return i===DT.ROTATION?new L4({times:e,points:t}):new CT({times:e,points:t})}}function LUe(e,t,n,i,o){let r=[];if(i===DT.WEIGHTS){let a=t.length/o,l,u;for(l=0;l<o;l++){let f=new Array(a),d=l;if(n===op.CUBICSPLINE)for(u=0;u<a;u+=3)f[u]=t[d],f[u+1]=t[d+o],f[u+2]=t[d+2*o],d+=o*3;else for(u=0;u<a;u++)f[u]=t[d],d+=o;r.push(Hoe(e,f,n,i))}}else r.push(Hoe(e,t,n,i));return r}var NUe=new h,FUe=new Ne;function BUe(e){let t=e._channel,n=t.sampler,i=n.input,o=n.output,r=n.interpolation,a=t.target.path,l=e._runtimeNode,u=c(l.morphWeights)?l.morphWeights.length:1,f=LUe(i,o,r,a,u);e._splines=f,e._path=a}N4.prototype.animate=function(e){let t=this._splines,n=this._path,i=this._runtimeAnimation.model,o=this._runtimeNode;if(n===DT.WEIGHTS){let r=o.morphWeights,s=r.length;for(let a=0;a<s;a++){let l=t[a],u=i.clampAnimations?l.clampTime(e):l.wrapTime(e);r[a]=l.evaluate(u)}}else{if(o.userAnimated)return;{let r=t[0],s=i.clampAnimations?r.clampTime(e):r.wrapTime(e);n===DT.TRANSLATION||n===DT.SCALE?o[n]=r.evaluate(s,NUe):n===DT.ROTATION&&(o[n]=r.evaluate(s,FUe))}}};var F4=N4;function B4(e,t,n){this._animation=t,this._name=t.name,this._runtimeChannels=void 0,this._startTime=J.clone(n.startTime),this._delay=y(n.delay,0),this._stopTime=J.clone(n.stopTime),this.removeOnStop=y(n.removeOnStop,!1),this._multiplier=y(n.multiplier,1),this._reverse=y(n.reverse,!1),this._loop=y(n.loop,$u.NONE),this._animationTime=n.animationTime,this._prevAnimationDelta=void 0,this.start=new pe,this.update=new pe,this.stop=new pe,this._state=up.STOPPED,this._computedStartTime=void 0,this._duration=void 0;let i=this;this._raiseStartEvent=function(){i.start.raiseEvent(e,i)},this._updateEventTime=0,this._raiseUpdateEvent=function(){i.update.raiseEvent(e,i,i._updateEventTime)},this._raiseStopEvent=function(){i.stop.raiseEvent(e,i)},this._model=e,this._localStartTime=void 0,this._localStopTime=void 0,kUe(this)}Object.defineProperties(B4.prototype,{animation:{get:function(){return this._animation}},name:{get:function(){return this._name}},runtimeChannels:{get:function(){return this._runtimeChannels}},model:{get:function(){return this._model}},localStartTime:{get:function(){return this._localStartTime}},localStopTime:{get:function(){return this._localStopTime}},startTime:{get:function(){return this._startTime}},delay:{get:function(){return this._delay}},stopTime:{get:function(){return this._stopTime}},multiplier:{get:function(){return this._multiplier}},reverse:{get:function(){return this._reverse}},loop:{get:function(){return this._loop}},animationTime:{get:function(){return this._animationTime}}});function kUe(e){let t=Number.MAX_VALUE,n=-Number.MAX_VALUE,i=e._model.sceneGraph,r=e._animation.channels,s=r.length,a=[];for(let l=0;l<s;l++){let u=r[l],f=u.target;if(!c(f))continue;let d=f.node.index,p=i._runtimeNodes[d],g=new F4({channel:u,runtimeAnimation:e,runtimeNode:p}),m=u.sampler.input;t=Math.min(t,m[0]),n=Math.max(n,m[m.length-1]),a.push(g)}e._runtimeChannels=a,e._localStartTime=t,e._localStopTime=n}B4.prototype.animate=function(e){let t=this._runtimeChannels,n=t.length;for(let i=0;i<n;i++)t[i].animate(e)};var k4=B4;function fp(e){this.animationAdded=new pe,this.animationRemoved=new pe,this.animateWhilePaused=!1,this._model=e,this._runtimeAnimations=[],this._previousTime=void 0}Object.defineProperties(fp.prototype,{length:{get:function(){return this._runtimeAnimations.length}},model:{get:function(){return this._model}}});function V4(e,t,n){let i=e._model,o=new k4(i,t,n);return e._runtimeAnimations.push(o),e.animationAdded.raiseEvent(i,o),o}fp.prototype.add=function(e){e=y(e,y.EMPTY_OBJECT);let t=this._model;if(!t.ready)throw new E("Animations are not loaded.  Wait for Model.ready to be true.");let n=t.sceneGraph.components.animations;if(!c(e.name)&&!c(e.index))throw new E("Either options.name or options.index must be defined.");if(c(e.multiplier)&&e.multiplier<=0)throw new E("options.multiplier must be greater than zero.");if(c(e.index)&&(e.index>=n.length||e.index<0))throw new E("options.index must be a valid animation index.");let i=e.index;if(c(i))return V4(this,n[i],e);let o=n.length;for(let r=0;r<o;++r)if(n[r].name===e.name){i=r;break}if(!c(i))throw new E("options.name must be a valid animation name.");return V4(this,n[i],e)};fp.prototype.addAll=function(e){e=y(e,y.EMPTY_OBJECT);let t=this._model;if(!t.ready)throw new E("Animations are not loaded.  Wait for Model.ready to be true.");if(c(e.multiplier)&&e.multiplier<=0)throw new E("options.multiplier must be greater than zero.");let n=t.sceneGraph.components.animations,i=[],o=n.length;for(let r=0;r<o;++r){let s=V4(this,n[r],e);i.push(s)}return i};fp.prototype.remove=function(e){if(!c(e))return!1;let t=this._runtimeAnimations,n=t.indexOf(e);return n!==-1?(t.splice(n,1),this.animationRemoved.raiseEvent(this._model,e),!0):!1};fp.prototype.removeAll=function(){let e=this._model,t=this._runtimeAnimations,n=t.length;this._runtimeAnimations.length=0;for(let i=0;i<n;++i)this.animationRemoved.raiseEvent(e,t[i])};fp.prototype.contains=function(e){return c(e)?this._runtimeAnimations.indexOf(e)!==-1:!1};fp.prototype.get=function(e){if(!c(e))throw new E("index is required.");if(e>=this._runtimeAnimations.length||e<0)throw new E("index must be valid within the range of the collection");return this._runtimeAnimations[e]};var a1=[];function VUe(e,t,n){return function(){e.animationRemoved.raiseEvent(t,n)}}fp.prototype.update=function(e){let t=this._runtimeAnimations,n=t.length;if(n===0)return this._previousTime=void 0,!1;if(!this.animateWhilePaused&&J.equals(e.time,this._previousTime))return!1;this._previousTime=J.clone(e.time,this._previousTime);let i=!1,o=e.time,r=this._model;for(let s=0;s<n;++s){let a=t[s];c(a._computedStartTime)||(a._computedStartTime=J.addSeconds(y(a.startTime,o),a.delay,new J)),c(a._duration)||(a._duration=a.localStopTime*(1/a.multiplier));let l=a._computedStartTime,u=a._duration,f=a.stopTime,d=J.lessThanOrEquals(l,o),p=c(f)&&J.greaterThan(o,f),g=0;if(u!==0){let x=J.secondsDifference(p?f:o,l);g=c(a._animationTime)?a._animationTime(u,x):x/u}let m=a.loop===$u.REPEAT||a.loop===$u.MIRRORED_REPEAT,b=(d||m&&!c(a.startTime))&&(g<=1||m)&&!p;if(g===a._prevAnimationDelta){let x=a._state===up.STOPPED;if(b!==x)continue}if(a._prevAnimationDelta=g,b||a._state===up.ANIMATING){if(b&&a._state===up.STOPPED&&(a._state=up.ANIMATING,a.start.numberOfListeners>0&&e.afterRender.push(a._raiseStartEvent)),a.loop===$u.REPEAT)g=g-Math.floor(g);else if(a.loop===$u.MIRRORED_REPEAT){let T=Math.floor(g),C=g-T;g=T%2===1?1-C:C}a.reverse&&(g=1-g);let x=g*u*a.multiplier;x=R.clamp(x,a.localStartTime,a.localStopTime),a.animate(x),a.update.numberOfListeners>0&&(a._updateEventTime=x,e.afterRender.push(a._raiseUpdateEvent)),i=!0,b||(a._state=up.STOPPED,a.stop.numberOfListeners>0&&e.afterRender.push(a._raiseStopEvent),a.removeOnStop&&a1.push(a))}}n=a1.length;for(let s=0;s<n;++s){let a=a1[s];t.splice(t.indexOf(a),1),e.afterRender.push(VUe(this,r,a))}return a1.length=0,i};var U4=fp;function P0(e){this._model=e.model,this._featureTable=e.featureTable,this._featureId=e.featureId,this._color=void 0}Object.defineProperties(P0.prototype,{show:{get:function(){return this._featureTable.getShow(this._featureId)},set:function(e){this._featureTable.setShow(this._featureId,e)}},color:{get:function(){return c(this._color)||(this._color=new j),this._featureTable.getColor(this._featureId,this._color)},set:function(e){this._featureTable.setColor(this._featureId,e)}},primitive:{get:function(){return this._model}},featureTable:{get:function(){return this._featureTable}},featureId:{get:function(){return this._featureId}}});P0.prototype.hasProperty=function(e){return this._featureTable.hasProperty(this._featureId,e)};P0.prototype.getProperty=function(e){return this._featureTable.getProperty(this._featureId,e)};P0.prototype.getPropertyInherited=function(e){return this._featureTable.hasPropertyBySemantic(this._featureId,e)?this._featureTable.getPropertyBySemantic(this._featureId,e):this._featureTable.getProperty(this._featureId,e)};P0.prototype.getPropertyIds=function(e){return this._featureTable.getPropertyIds(e)};P0.prototype.setProperty=function(e,t){return this._featureTable.setProperty(this._featureId,e,t)};var z4=P0;var dw={ALL_OPAQUE:0,ALL_TRANSLUCENT:1,OPAQUE_AND_TRANSLUCENT:2};dw.getStyleCommandsNeeded=function(e,t){return t===0?dw.ALL_OPAQUE:t===e?dw.ALL_TRANSLUCENT:dw.OPAQUE_AND_TRANSLUCENT};var dp=Object.freeze(dw);var tg={GLTF:"GLTF",TILE_GLTF:"TILE_GLTF",TILE_B3DM:"B3DM",TILE_I3DM:"I3DM",TILE_PNTS:"PNTS",TILE_GEOJSON:"TILE_GEOJSON"};tg.is3DTiles=function(e){switch(A.typeOf.string("modelType",e),e){case tg.TILE_GLTF:case tg.TILE_B3DM:case tg.TILE_I3DM:case tg.TILE_PNTS:case tg.TILE_GEOJSON:return!0;case tg.GLTF:return!1;default:throw new E("modelType is not a valid value.")}};var Rr=Object.freeze(tg);function Mr(e){let t=e.model,n=e.propertyTable;A.typeOf.object("propertyTable",n),A.typeOf.object("model",t),this._propertyTable=n,this._model=t,this._features=void 0,this._featuresLength=0,this._batchTexture=void 0,this._styleCommandsNeededDirty=!1,this._styleCommandsNeeded=dp.ALL_OPAQUE,UUe(this)}Object.defineProperties(Mr.prototype,{batchTexture:{get:function(){return this._batchTexture}},featuresLength:{get:function(){return this._featuresLength}},batchTextureByteLength:{get:function(){return c(this._batchTexture)?this._batchTexture.byteLength:0}},styleCommandsNeededDirty:{get:function(){return this._styleCommandsNeededDirty}}});function UUe(e){let t=e._model,n=Rr.is3DTiles(t.type),i=e._propertyTable.count;if(i===0)return;let o,r=new Array(i);if(n){let s=t.content;for(o=0;o<i;o++)r[o]=new Ws(s,o)}else for(o=0;o<i;o++)r[o]=new z4({model:t,featureId:o,featureTable:e});e._features=r,e._featuresLength=i,e._batchTexture=new kl({featuresLength:i,owner:e,statistics:n?t.content.tileset.statistics:void 0})}Mr.prototype.update=function(e){this._styleCommandsNeededDirty=!1,this._batchTexture.update(void 0,e);let t=dp.getStyleCommandsNeeded(this._featuresLength,this._batchTexture.translucentFeaturesLength);this._styleCommandsNeeded!==t&&(this._styleCommandsNeededDirty=!0,this._styleCommandsNeeded=t)};Mr.prototype.setShow=function(e,t){this._batchTexture.setShow(e,t)};Mr.prototype.setAllShow=function(e){this._batchTexture.setAllShow(e)};Mr.prototype.getShow=function(e){return this._batchTexture.getShow(e)};Mr.prototype.setColor=function(e,t){this._batchTexture.setColor(e,t)};Mr.prototype.setAllColor=function(e){this._batchTexture.setAllColor(e)};Mr.prototype.getColor=function(e,t){return this._batchTexture.getColor(e,t)};Mr.prototype.getPickColor=function(e){return this._batchTexture.getPickColor(e)};Mr.prototype.getFeature=function(e){return this._features[e]};Mr.prototype.hasProperty=function(e,t){return this._propertyTable.hasProperty(e,t)};Mr.prototype.hasPropertyBySemantic=function(e,t){return this._propertyTable.hasPropertyBySemantic(e,t)};Mr.prototype.getProperty=function(e,t){return this._propertyTable.getProperty(e,t)};Mr.prototype.getPropertyBySemantic=function(e,t){return this._propertyTable.getPropertyBySemantic(e,t)};Mr.prototype.getPropertyIds=function(e){return this._propertyTable.getPropertyIds(e)};Mr.prototype.setProperty=function(e,t,n){return this._propertyTable.setProperty(e,t,n)};Mr.prototype.isClass=function(e,t){return this._propertyTable.isClass(e,t)};Mr.prototype.isExactClass=function(e,t){return this._propertyTable.isExactClass(e,t)};Mr.prototype.getExactClassName=function(e){return this._propertyTable.getExactClassName(e)};var zUe=new j;Mr.prototype.applyStyle=function(e){if(!c(e)){this.setAllColor(kl.DEFAULT_COLOR_VALUE),this.setAllShow(kl.DEFAULT_SHOW_VALUE);return}for(let t=0;t<this._featuresLength;t++){let n=this.getFeature(t),i=c(e.color)?y(e.color.evaluateColor(n,zUe),kl.DEFAULT_COLOR_VALUE):kl.DEFAULT_COLOR_VALUE,o=c(e.show)?y(e.show.evaluate(n),kl.DEFAULT_SHOW_VALUE):kl.DEFAULT_SHOW_VALUE;this.setColor(t,i),this.setShow(t,o)}};Mr.prototype.isDestroyed=function(){return!1};Mr.prototype.destroy=function(e){this._batchTexture=this._batchTexture&&this._batchTexture.destroy(),de(this)};var H4=Mr;var I0={VERTEX:0,FRAGMENT:1,BOTH:2};I0.includesVertexShader=function(e){return A.typeOf.number("destination",e),e===I0.VERTEX||e===I0.BOTH};I0.includesFragmentShader=function(e){return A.typeOf.number("destination",e),e===I0.FRAGMENT||e===I0.BOTH};var _e=Object.freeze(I0);var Goe={name:"TilesetPipelineStage"};Goe.process=function(e,t,n){if(t.hasSkipLevelOfDetail(n)){e.shaderBuilder.addDefine("POLYGON_OFFSET",void 0,_e.FRAGMENT);let r={u_polygonOffset:function(){return H.ZERO}};e.uniformMap=At(r,e.uniformMap),e.hasSkipLevelOfDetail=!0}let i=e.renderStateOptions;i.stencilTest=Ut.setCesium3DTileBit(),i.stencilMask=Ut.CESIUM_3D_TILE_MASK};var G4=Goe;var j4=`vec2 nearestPointOnEllipseFast(vec2 pos, vec2 radii) {
vec2 p = abs(pos);
vec2 inverseRadii = 1.0 / radii;
vec2 evoluteScale = (radii.x * radii.x - radii.y * radii.y) * vec2(1.0, -1.0) * inverseRadii;
vec2 tTrigs = vec2(0.70710678118);
vec2 v = radii * tTrigs;
vec2 evolute = evoluteScale * tTrigs * tTrigs * tTrigs;
vec2 q = normalize(p - evolute) * length(v - evolute);
tTrigs = (q + evolute) * inverseRadii;
tTrigs = normalize(clamp(tTrigs, 0.0, 1.0));
v = radii * tTrigs;
return v * sign(pos);
}
vec3 computeEllipsoidPositionWC(vec3 positionMC) {
vec3 positionWC = (czm_model * vec4(positionMC, 1.0)).xyz;
vec2 positionEllipse = vec2(length(positionWC.xy), positionWC.z);
vec2 nearestPoint = nearestPointOnEllipseFast(positionEllipse, czm_ellipsoidRadii.xz);
return vec3(nearestPoint.x * normalize(positionWC.xy), nearestPoint.y);
}
void applyFog(inout vec4 color, vec4 groundAtmosphereColor, vec3 lightDirection, float distanceToCamera) {
vec3 fogColor = groundAtmosphereColor.rgb;
const float NONE = 0.0;
if (czm_atmosphereDynamicLighting != NONE) {
float darken = clamp(dot(normalize(czm_viewerPositionWC), lightDirection), czm_fogMinimumBrightness, 1.0);
fogColor *= darken;
}
#ifndef HDR
fogColor.rgb = czm_pbrNeutralTonemapping(fogColor.rgb);
fogColor.rgb = czm_inverseGamma(fogColor.rgb);
#endif
vec3 withFog = czm_fog(distanceToCamera, color.rgb, fogColor, czm_fogVisualDensityScalar);
color = vec4(withFog, color.a);
}
void atmosphereStage(inout vec4 color, in ProcessedAttributes attributes) {
vec3 rayleighColor;
vec3 mieColor;
float opacity;
vec3 positionWC;
vec3 lightDirection;
if (false) {
positionWC = computeEllipsoidPositionWC(attributes.positionMC);
lightDirection = czm_getDynamicAtmosphereLightDirection(positionWC, czm_atmosphereDynamicLighting);
czm_computeGroundAtmosphereScattering(
positionWC,
lightDirection,
rayleighColor,
mieColor,
opacity
);
} else {
positionWC = attributes.positionWC;
lightDirection = czm_getDynamicAtmosphereLightDirection(positionWC, czm_atmosphereDynamicLighting);
rayleighColor = v_atmosphereRayleighColor;
mieColor = v_atmosphereMieColor;
opacity = v_atmosphereOpacity;
}
const bool ignoreBlackPixels = true;
rayleighColor = czm_applyHSBShift(rayleighColor, czm_atmosphereHsbShift, ignoreBlackPixels);
mieColor = czm_applyHSBShift(mieColor, czm_atmosphereHsbShift, ignoreBlackPixels);
vec4 groundAtmosphereColor = czm_computeAtmosphereColor(positionWC, lightDirection, rayleighColor, mieColor, opacity);
if (u_isInFog) {
float distanceToCamera = length(attributes.positionEC);
applyFog(color, groundAtmosphereColor, lightDirection, distanceToCamera);
} else {
}
}
`;var W4=`void atmosphereStage(ProcessedAttributes attributes) {
vec3 lightDirection = czm_getDynamicAtmosphereLightDirection(v_positionWC, czm_atmosphereDynamicLighting);
czm_computeGroundAtmosphereScattering(
v_positionWC,
lightDirection,
v_atmosphereRayleighColor,
v_atmosphereMieColor,
v_atmosphereOpacity
);
}
`;var joe={name:"AtmospherePipelineStage"};joe.process=function(e,t,n){let i=e.shaderBuilder;i.addDefine("HAS_ATMOSPHERE",void 0,_e.BOTH),i.addDefine("COMPUTE_POSITION_WC_ATMOSPHERE",void 0,_e.BOTH),i.addVarying("vec3","v_atmosphereRayleighColor"),i.addVarying("vec3","v_atmosphereMieColor"),i.addVarying("float","v_atmosphereOpacity"),i.addVertexLines([W4]),i.addFragmentLines([j4]),i.addUniform("bool","u_isInFog",_e.FRAGMENT),e.uniformMap.u_isInFog=function(){let o=h.distance(n.camera.positionWC,t.boundingSphere.center);return R.fog(o,n.fog.density)>R.EPSILON3}};var q4=joe;var Y4=`#ifdef DIFFUSE_IBL
vec3 sampleDiffuseEnvironment(vec3 cubeDir)
{
#ifdef CUSTOM_SPHERICAL_HARMONICS
return czm_sphericalHarmonics(cubeDir, model_sphericalHarmonicCoefficients);
#else
return czm_sphericalHarmonics(cubeDir, czm_sphericalHarmonicCoefficients);
#endif
}
#endif
#ifdef SPECULAR_IBL
vec3 sampleSpecularEnvironment(vec3 cubeDir, float roughness)
{
#ifdef CUSTOM_SPECULAR_IBL
float lod = roughness * model_specularEnvironmentMapsMaximumLOD;
return czm_textureCube(model_specularEnvironmentMaps, cubeDir, lod).rgb;
#else
float lod = roughness * czm_specularEnvironmentMapsMaximumLOD;
return czm_textureCube(czm_specularEnvironmentMaps, cubeDir, lod).rgb;
#endif
}
vec3 computeSpecularIBL(vec3 cubeDir, float NdotV, vec3 f0, float roughness)
{
vec3 f90 = max(vec3(1.0 - roughness), f0);
vec3 F = fresnelSchlick2(f0, f90, NdotV);
vec2 brdfLut = texture(czm_brdfLut, vec2(NdotV, roughness)).rg;
vec3 specularSample = sampleSpecularEnvironment(cubeDir, roughness);
return specularSample * (F * brdfLut.x + brdfLut.y);
}
#endif
#if defined(DIFFUSE_IBL) || defined(SPECULAR_IBL)
vec3 textureIBL(vec3 viewDirectionEC, vec3 normalEC, czm_modelMaterial material) {
vec3 f0 = material.specular;
float roughness = material.roughness;
float specularWeight = 1.0;
#ifdef USE_SPECULAR
specularWeight = material.specularWeight;
#endif
float NdotV = clamp(dot(normalEC, viewDirectionEC), 0.0, 1.0);
vec3 f90 = max(vec3(1.0 - roughness), f0);
vec3 singleScatterFresnel = fresnelSchlick2(f0, f90, NdotV);
vec2 brdfLut = texture(czm_brdfLut, vec2(NdotV, roughness)).rg;
vec3 FssEss = specularWeight * (singleScatterFresnel * brdfLut.x + brdfLut.y);
#ifdef DIFFUSE_IBL
vec3 normalMC = normalize(model_iblReferenceFrameMatrix * normalEC);
vec3 irradiance = sampleDiffuseEnvironment(normalMC);
vec3 averageFresnel = f0 + (1.0 - f0) / 21.0;
float Ems = specularWeight * (1.0 - brdfLut.x - brdfLut.y);
vec3 FmsEms = FssEss * averageFresnel * Ems / (1.0 - averageFresnel * Ems);
vec3 dielectricScattering = (1.0 - FssEss - FmsEms) * material.diffuse;
vec3 diffuseContribution = irradiance * (FmsEms + dielectricScattering) * model_iblFactor.x;
#else
vec3 diffuseContribution = vec3(0.0);
#endif
#ifdef USE_ANISOTROPY
vec3 anisotropyDirection = material.anisotropicB;
vec3 anisotropicTangent = cross(anisotropyDirection, viewDirectionEC);
vec3 anisotropicNormal = cross(anisotropicTangent, anisotropyDirection);
float bendFactor = 1.0 - material.anisotropyStrength * (1.0 - roughness);
float bendFactorPow4 = bendFactor * bendFactor * bendFactor * bendFactor;
vec3 bentNormal = normalize(mix(anisotropicNormal, normalEC, bendFactorPow4));
vec3 reflectEC = reflect(-viewDirectionEC, bentNormal);
#else
vec3 reflectEC = reflect(-viewDirectionEC, normalEC);
#endif
#ifdef SPECULAR_IBL
vec3 reflectMC = normalize(model_iblReferenceFrameMatrix * reflectEC);
vec3 radiance = sampleSpecularEnvironment(reflectMC, roughness);
vec3 specularContribution = radiance * FssEss * model_iblFactor.y;
#else
vec3 specularContribution = vec3(0.0);
#endif
return diffuseContribution + specularContribution;
}
#endif
`;var Woe={name:"ImageBasedLightingPipelineStage"},HUe=new H;Woe.process=function(e,t,n){let i=t.imageBasedLighting,o=t.environmentMapManager,r=e.shaderBuilder,s;c(i.specularEnvironmentMaps)||(s=o.radianceCubeMap);let a=i.sphericalHarmonicCoefficients??o.sphericalHarmonicCoefficients;r.addDefine("USE_IBL_LIGHTING",void 0,_e.FRAGMENT),r.addUniform("vec2","model_iblFactor",_e.FRAGMENT),Gm.isSupported(n.context)&&((i.useSphericalHarmonics||i.useSpecularEnvironmentMaps||i.enabled)&&r.addUniform("mat3","model_iblReferenceFrameMatrix",_e.FRAGMENT),c(s)&&r.addDefine("COMPUTE_POSITION_WC_ATMOSPHERE",void 0,_e.BOTH),c(a)&&c(a[0])?(r.addDefine("DIFFUSE_IBL",void 0,_e.FRAGMENT),r.addDefine("CUSTOM_SPHERICAL_HARMONICS",void 0,_e.FRAGMENT),r.addUniform("vec3","model_sphericalHarmonicCoefficients[9]",_e.FRAGMENT)):i.useDefaultSphericalHarmonics&&r.addDefine("DIFFUSE_IBL",void 0,_e.FRAGMENT),c(i.specularEnvironmentCubeMap)&&i.specularEnvironmentCubeMap.ready||c(s)?(r.addDefine("SPECULAR_IBL",void 0,_e.FRAGMENT),r.addDefine("CUSTOM_SPECULAR_IBL",void 0,_e.FRAGMENT),r.addUniform("samplerCube","model_specularEnvironmentMaps",_e.FRAGMENT),r.addUniform("float","model_specularEnvironmentMapsMaximumLOD",_e.FRAGMENT)):t.useDefaultSpecularMaps&&r.addDefine("SPECULAR_IBL",void 0,_e.FRAGMENT)),r.addFragmentLines(Y4);let l={model_iblFactor:function(){return H.multiplyByScalar(i.imageBasedLightingFactor,o?.intensity||1,HUe)},model_iblReferenceFrameMatrix:function(){return t._iblReferenceFrameMatrix},model_sphericalHarmonicCoefficients:function(){return a},model_specularEnvironmentMaps:function(){return i.specularEnvironmentCubeMap.texture},model_specularEnvironmentMapsMaximumLOD:function(){return i.specularEnvironmentCubeMap.maximumMipmapLevel}};c(s)&&(l.model_specularEnvironmentMaps=function(){return s},l.model_specularEnvironmentMapsMaximumLOD=function(){return o.maximumMipmapLevel}),e.uniformMap=At(l,e.uniformMap)};var X4=Woe;var GUe=R.EPSILON16;function $4(e){e=y(e,y.EMPTY_OBJECT);let t=e.stage,n=e.runtimeArticulation;A.typeOf.object("options.stage",t),A.typeOf.object("options.runtimeArticulation",n),this._stage=t,this._runtimeArticulation=n,this._name=t.name,this._type=t.type,this._minimumValue=t.minimumValue,this._maximumValue=t.maximumValue,this._currentValue=t.initialValue}Object.defineProperties($4.prototype,{stage:{get:function(){return this._stage}},runtimeArticulation:{get:function(){return this._runtimeArticulation}},name:{get:function(){return this._name}},type:{get:function(){return this._type}},minimumValue:{get:function(){return this._minimumValue}},maximumValue:{get:function(){return this._maximumValue}},currentValue:{get:function(){return this._currentValue},set:function(e){A.typeOf.number("value",e),e=R.clamp(e,this.minimumValue,this.maximumValue),R.equalsEpsilon(this._currentValue,e,GUe)||(this._currentValue=e,this.runtimeArticulation._dirty=!0)}}});var jUe=new h,K4=new Q;$4.prototype.applyStageToMatrix=function(e){A.typeOf.object("result",e);let t=this.type,n=this.currentValue,i=jUe,o;switch(t){case rl.XROTATE:o=Q.fromRotationX(R.toRadians(n),K4),e=k.multiplyByMatrix3(e,o,e);break;case rl.YROTATE:o=Q.fromRotationY(R.toRadians(n),K4),e=k.multiplyByMatrix3(e,o,e);break;case rl.ZROTATE:o=Q.fromRotationZ(R.toRadians(n),K4),e=k.multiplyByMatrix3(e,o,e);break;case rl.XTRANSLATE:i.x=n,i.y=0,i.z=0,e=k.multiplyByTranslation(e,i,e);break;case rl.YTRANSLATE:i.x=0,i.y=n,i.z=0,e=k.multiplyByTranslation(e,i,e);break;case rl.ZTRANSLATE:i.x=0,i.y=0,i.z=n,e=k.multiplyByTranslation(e,i,e);break;case rl.XSCALE:i.x=n,i.y=1,i.z=1,e=k.multiplyByScale(e,i,e);break;case rl.YSCALE:i.x=1,i.y=n,i.z=1,e=k.multiplyByScale(e,i,e);break;case rl.ZSCALE:i.x=1,i.y=1,i.z=n,e=k.multiplyByScale(e,i,e);break;case rl.UNIFORMSCALE:e=k.multiplyByUniformScale(e,n,e);break;default:break}return e};var Z4=$4;function c1(e){e=y(e,y.EMPTY_OBJECT);let t=e.articulation,n=e.sceneGraph;A.typeOf.object("options.articulation",t),A.typeOf.object("options.sceneGraph",n),this._articulation=t,this._sceneGraph=n,this._name=t.name,this._runtimeStages=[],this._runtimeStagesByName={},this._runtimeNodes=[],this._dirty=!0,WUe(this)}Object.defineProperties(c1.prototype,{articulation:{get:function(){return this._articulation}},sceneGraph:{get:function(){return this._sceneGraph}},name:{get:function(){return this._name}},runtimeStages:{get:function(){return this._runtimeStages}},runtimeNodes:{get:function(){return this._runtimeNodes}}});function WUe(e){let n=e.articulation.stages,i=n.length,o=e._runtimeStages,r=e._runtimeStagesByName;for(let s=0;s<i;s++){let a=n[s],l=new Z4({stage:a,runtimeArticulation:e});o.push(l);let u=a.name;r[u]=l}}c1.prototype.setArticulationStage=function(e,t){let n=this._runtimeStagesByName[e];c(n)&&(n.currentValue=t)};var qUe=new k,YUe=new k;c1.prototype.apply=function(){if(!this._dirty)return;this._dirty=!1;let e=k.clone(k.IDENTITY,qUe),t,n=this._runtimeStages,i=n.length;for(t=0;t<i;t++)e=n[t].applyStageToMatrix(e);let o=this._runtimeNodes,r=o.length;for(t=0;t<r;t++){let s=o[t],a=k.multiplyTransformation(s.originalTransform,e,YUe);s.transform=a}};var J4=c1;var Q4=`void modelColorStage(inout czm_modelMaterial material)
{
material.diffuse = mix(material.diffuse, model_color.rgb, model_colorBlend);
float highlight = ceil(model_colorBlend);
material.diffuse *= mix(model_color.rgb, vec3(1.0), highlight);
material.alpha *= model_color.a;
}
`;var PT={name:"ModelColorPipelineStage",COLOR_UNIFORM_NAME:"model_color",COLOR_BLEND_UNIFORM_NAME:"model_colorBlend"};PT.process=function(e,t,n){let i=e.shaderBuilder;i.addDefine("HAS_MODEL_COLOR",void 0,_e.FRAGMENT),i.addFragmentLines(Q4);let o={},r=t.color;r.alpha===0&&!t.hasSilhouette(n)&&(e.renderStateOptions.colorMask={red:!1,green:!1,blue:!1,alpha:!1}),r.alpha<1&&(e.alphaOptions.pass=ve.TRANSLUCENT),i.addUniform("vec4",PT.COLOR_UNIFORM_NAME,_e.FRAGMENT),o[PT.COLOR_UNIFORM_NAME]=function(){return t.color},i.addUniform("float",PT.COLOR_BLEND_UNIFORM_NAME,_e.FRAGMENT),o[PT.COLOR_BLEND_UNIFORM_NAME]=function(){return ol.getColorBlend(t.colorBlendMode,t.colorBlendAmount)},e.uniformMap=At(o,e.uniformMap)};var IT=PT;var e8=`#ifdef USE_CLIPPING_PLANES_FLOAT_TEXTURE
vec4 getClippingPlane(
highp sampler2D packedClippingPlanes,
int clippingPlaneNumber,
mat4 transform
) {
int pixY = clippingPlaneNumber / CLIPPING_PLANES_TEXTURE_WIDTH;
int pixX = clippingPlaneNumber - (pixY * CLIPPING_PLANES_TEXTURE_WIDTH);
float pixelWidth = 1.0 / float(CLIPPING_PLANES_TEXTURE_WIDTH);
float pixelHeight = 1.0 / float(CLIPPING_PLANES_TEXTURE_HEIGHT);
float u = (float(pixX) + 0.5) * pixelWidth;
float v = (float(pixY) + 0.5) * pixelHeight;
vec4 plane = texture(packedClippingPlanes, vec2(u, v));
return czm_transformPlane(plane, transform);
}
#else
vec4 getClippingPlane(
highp sampler2D packedClippingPlanes,
int clippingPlaneNumber,
mat4 transform
) {
int clippingPlaneStartIndex = clippingPlaneNumber * 2;
int pixY = clippingPlaneStartIndex / CLIPPING_PLANES_TEXTURE_WIDTH;
int pixX = clippingPlaneStartIndex - (pixY * CLIPPING_PLANES_TEXTURE_WIDTH);
float pixelWidth = 1.0 / float(CLIPPING_PLANES_TEXTURE_WIDTH);
float pixelHeight = 1.0 / float(CLIPPING_PLANES_TEXTURE_HEIGHT);
float u = (float(pixX) + 0.5) * pixelWidth;
float v = (float(pixY) + 0.5) * pixelHeight;
vec4 oct32 = texture(packedClippingPlanes, vec2(u, v)) * 255.0;
vec2 oct = vec2(oct32.x * 256.0 + oct32.y, oct32.z * 256.0 + oct32.w);
vec4 plane;
plane.xyz = czm_octDecode(oct, 65535.0);
plane.w = czm_unpackFloat(texture(packedClippingPlanes, vec2(u + pixelWidth, v)));
return czm_transformPlane(plane, transform);
}
#endif
float clip(vec4 fragCoord, sampler2D clippingPlanes, mat4 clippingPlanesMatrix) {
vec4 position = czm_windowToEyeCoordinates(fragCoord);
vec3 clipNormal = vec3(0.0);
vec3 clipPosition = vec3(0.0);
float pixelWidth = czm_metersPerPixel(position);
#ifdef UNION_CLIPPING_REGIONS
float clipAmount;
#else
float clipAmount = 0.0;
bool clipped = true;
#endif
for (int i = 0; i < CLIPPING_PLANES_LENGTH; ++i) {
vec4 clippingPlane = getClippingPlane(clippingPlanes, i, clippingPlanesMatrix);
clipNormal = clippingPlane.xyz;
clipPosition = -clippingPlane.w * clipNormal;
float amount = dot(clipNormal, (position.xyz - clipPosition)) / pixelWidth;
#ifdef UNION_CLIPPING_REGIONS
clipAmount = czm_branchFreeTernary(i == 0, amount, min(amount, clipAmount));
if (amount <= 0.0) {
discard;
}
#else
clipAmount = max(amount, clipAmount);
clipped = clipped && (amount <= 0.0);
#endif
}
#ifndef UNION_CLIPPING_REGIONS
if (clipped) {
discard;
}
#endif
return clipAmount;
}
void modelClippingPlanesStage(inout vec4 color)
{
float clipDistance = clip(gl_FragCoord, model_clippingPlanes, model_clippingPlanesMatrix);
vec4 clippingPlanesEdgeColor = vec4(1.0);
clippingPlanesEdgeColor.rgb = model_clippingPlanesEdgeStyle.rgb;
float clippingPlanesEdgeWidth = model_clippingPlanesEdgeStyle.a;
if (clipDistance > 0.0 && clipDistance < clippingPlanesEdgeWidth) {
color = clippingPlanesEdgeColor;
}
}
`;var qoe={name:"ModelClippingPlanesPipelineStage"},XUe=new H;qoe.process=function(e,t,n){let i=t.clippingPlanes,o=n.context,r=e.shaderBuilder;r.addDefine("HAS_CLIPPING_PLANES",void 0,_e.FRAGMENT),r.addDefine("CLIPPING_PLANES_LENGTH",i.length,_e.FRAGMENT),i.unionClippingRegions&&r.addDefine("UNION_CLIPPING_REGIONS",void 0,_e.FRAGMENT),Ms.useFloatTexture(o)&&r.addDefine("USE_CLIPPING_PLANES_FLOAT_TEXTURE",void 0,_e.FRAGMENT);let s=Ms.getTextureResolution(i,o,XUe);r.addDefine("CLIPPING_PLANES_TEXTURE_WIDTH",s.x,_e.FRAGMENT),r.addDefine("CLIPPING_PLANES_TEXTURE_HEIGHT",s.y,_e.FRAGMENT),r.addUniform("sampler2D","model_clippingPlanes",_e.FRAGMENT),r.addUniform("vec4","model_clippingPlanesEdgeStyle",_e.FRAGMENT),r.addUniform("mat4","model_clippingPlanesMatrix",_e.FRAGMENT),r.addFragmentLines(e8);let a={model_clippingPlanes:function(){return i.texture},model_clippingPlanesEdgeStyle:function(){let l=j.clone(i.edgeColor);return l.alpha=i.edgeWidth,l},model_clippingPlanesMatrix:function(){return t._clippingPlanesMatrix}};e.uniformMap=At(a,e.uniformMap)};var t8=qoe;var n8=`void modelClippingPolygonsStage(ProcessedAttributes attributes)
{
vec2 sphericalLatLong = czm_approximateSphericalCoordinates(v_positionWC);
sphericalLatLong.y = czm_branchFreeTernary(sphericalLatLong.y < czm_pi, sphericalLatLong.y, sphericalLatLong.y - czm_twoPi);
vec2 minDistance = vec2(czm_infinity);
v_regionIndex = -1;
v_clippingPosition = vec2(czm_infinity);
for (int regionIndex = 0; regionIndex < CLIPPING_POLYGON_REGIONS_LENGTH; regionIndex++) {
vec4 extents = czm_unpackClippingExtents(model_clippingExtents, regionIndex);
vec2 rectUv = (sphericalLatLong.yx - extents.yx) * extents.wz;
vec2 clamped = clamp(rectUv, vec2(0.0), vec2(1.0));
vec2 distance = abs(rectUv - clamped) * extents.wz;
if (minDistance.x > distance.x || minDistance.y > distance.y) {
minDistance = distance;
v_clippingPosition = rectUv;
}
float threshold = 0.01;
if (rectUv.x > threshold && rectUv.y > threshold && rectUv.x < 1.0 - threshold && rectUv.y < 1.0 - threshold) {
v_regionIndex = regionIndex;
}
}
}
`;var i8=`void modelClippingPolygonsStage()
{
vec2 clippingPosition = v_clippingPosition;
int regionIndex = v_regionIndex;
czm_clipPolygons(model_clippingDistance, CLIPPING_POLYGON_REGIONS_LENGTH, clippingPosition, regionIndex);
}
`;var Yoe={name:"ModelClippingPolygonsPipelineStage"};Yoe.process=function(e,t,n){let i=t.clippingPolygons,o=e.shaderBuilder;o.addDefine("ENABLE_CLIPPING_POLYGONS",void 0,_e.BOTH),i.inverse&&o.addDefine("CLIPPING_INVERSE",void 0,_e.FRAGMENT),o.addDefine("CLIPPING_POLYGON_REGIONS_LENGTH",i.extentsCount,_e.BOTH),o.addUniform("sampler2D","model_clippingDistance",_e.FRAGMENT),o.addUniform("sampler2D","model_clippingExtents",_e.VERTEX),o.addVarying("vec2","v_clippingPosition"),o.addVarying("int","v_regionIndex","flat"),o.addVertexLines(n8),o.addFragmentLines(i8);let r={model_clippingDistance:function(){return i.clippingTexture},model_clippingExtents:function(){return i.extentsTexture}};e.uniformMap=At(r,e.uniformMap)};var o8=Yoe;function Xoe(e,t){A.typeOf.object("model",e),A.typeOf.object("runtimeNode",t),this._model=e,this._runtimeNode=t}Object.defineProperties(Xoe.prototype,{name:{get:function(){return this._runtimeNode._name}},id:{get:function(){return this._runtimeNode._id}},show:{get:function(){return this._runtimeNode.show},set:function(e){this._runtimeNode.show=e}},matrix:{get:function(){return this._runtimeNode.transform},set:function(e){c(e)?(this._runtimeNode.transform=e,this._runtimeNode.userAnimated=!0,this._model._userAnimationDirty=!0):(this._runtimeNode.transform=this.originalMatrix,this._runtimeNode.userAnimated=!1)}},originalMatrix:{get:function(){return this._runtimeNode.originalTransform}}});var r8=Xoe;var s8=`mat4 getInstancingTransform()
{
mat4 instancingTransform;
#ifdef HAS_INSTANCE_MATRICES
instancingTransform = mat4(
a_instancingTransformRow0.x, a_instancingTransformRow1.x, a_instancingTransformRow2.x, 0.0,
a_instancingTransformRow0.y, a_instancingTransformRow1.y, a_instancingTransformRow2.y, 0.0,
a_instancingTransformRow0.z, a_instancingTransformRow1.z, a_instancingTransformRow2.z, 0.0,
a_instancingTransformRow0.w, a_instancingTransformRow1.w, a_instancingTransformRow2.w, 1.0
);
#else
vec3 translation = vec3(0.0, 0.0, 0.0);
vec3 scale = vec3(1.0, 1.0, 1.0);
#ifdef HAS_INSTANCE_TRANSLATION
translation = a_instanceTranslation;
#endif
#ifdef HAS_INSTANCE_SCALE
scale = a_instanceScale;
#endif
instancingTransform = mat4(
scale.x, 0.0, 0.0, 0.0,
0.0, scale.y, 0.0, 0.0,
0.0, 0.0, scale.z, 0.0,
translation.x, translation.y, translation.z, 1.0
);
#endif
return instancingTransform;
}
#ifdef USE_2D_INSTANCING
mat4 getInstancingTransform2D()
{
mat4 instancingTransform2D;
#ifdef HAS_INSTANCE_MATRICES
instancingTransform2D = mat4(
a_instancingTransform2DRow0.x, a_instancingTransform2DRow1.x, a_instancingTransform2DRow2.x, 0.0,
a_instancingTransform2DRow0.y, a_instancingTransform2DRow1.y, a_instancingTransform2DRow2.y, 0.0,
a_instancingTransform2DRow0.z, a_instancingTransform2DRow1.z, a_instancingTransform2DRow2.z, 0.0,
a_instancingTransform2DRow0.w, a_instancingTransform2DRow1.w, a_instancingTransform2DRow2.w, 1.0
);
#else
vec3 translation2D = vec3(0.0, 0.0, 0.0);
vec3 scale = vec3(1.0, 1.0, 1.0);
#ifdef HAS_INSTANCE_TRANSLATION
translation2D = a_instanceTranslation2D;
#endif
#ifdef HAS_INSTANCE_SCALE
scale = a_instanceScale;
#endif
instancingTransform2D = mat4(
scale.x, 0.0, 0.0, 0.0,
0.0, scale.y, 0.0, 0.0,
0.0, 0.0, scale.z, 0.0,
translation2D.x, translation2D.y, translation2D.z, 1.0
);
#endif
return instancingTransform2D;
}
#endif
`;var a8=`void instancingStage(inout ProcessedAttributes attributes)
{
vec3 positionMC = attributes.positionMC;
mat4 instancingTransform = getInstancingTransform();
attributes.positionMC = (instancingTransform * vec4(positionMC, 1.0)).xyz;
#ifdef HAS_NORMALS
vec3 normalMC = attributes.normalMC;
attributes.normalMC = (instancingTransform * vec4(normalMC, 0.0)).xyz;
#endif
#ifdef USE_2D_INSTANCING
mat4 instancingTransform2D = getInstancingTransform2D();
attributes.position2D = (instancingTransform2D * vec4(positionMC, 1.0)).xyz;
#endif
}
`;var c8=`void legacyInstancingStage(
inout ProcessedAttributes attributes,
out mat4 instanceModelView,
out mat3 instanceModelViewInverseTranspose)
{
vec3 positionMC = attributes.positionMC;
mat4 instancingTransform = getInstancingTransform();
mat4 instanceModel = instancingTransform * u_instance_nodeTransform;
instanceModelView = u_instance_modifiedModelView;
instanceModelViewInverseTranspose = mat3(u_instance_modifiedModelView * instanceModel);
attributes.positionMC = (instanceModel * vec4(positionMC, 1.0)).xyz;
#ifdef USE_2D_INSTANCING
mat4 instancingTransform2D = getInstancingTransform2D();
attributes.position2D = (instancingTransform2D * vec4(positionMC, 1.0)).xyz;
#endif
}
`;var l1=new k,KUe=new k,$Ue=new k,$oe={name:"InstancingPipelineStage",_getInstanceTransformsAsMatrices:tre,_transformsToTypedArray:u8};$oe.process=function(e,t,n){let i=t.instances,o=i.attributes[0].count,r=e.shaderBuilder;r.addDefine("HAS_INSTANCING"),r.addVertexLines(s8);let s=e.model,a=s.sceneGraph,l=e.runtimeNode,u=n.mode!==oe.SCENE3D&&!n.scene3DOnly&&s._projectTo2D,f=s._enablePick&&!n.context.webgl2,d=[];fze(e,n,i,d,u,f),mze(e,n,i,d);let p={};if(i.transformInWorldSpace?(r.addDefine("USE_LEGACY_INSTANCING",void 0,_e.VERTEX),r.addUniform("mat4","u_instance_modifiedModelView",_e.VERTEX),r.addUniform("mat4","u_instance_nodeTransform",_e.VERTEX),p.u_instance_modifiedModelView=function(){let g=k.multiplyTransformation(s.modelMatrix,a.components.transform,l1);return u?k.multiplyTransformation(n.context.uniformState.view3D,g,l1):(n.mode!==oe.SCENE3D&&(g=Ft.basisTo2D(n.mapProjection,g,l1)),k.multiplyTransformation(n.context.uniformState.view,g,l1))},p.u_instance_nodeTransform=function(){return k.multiplyTransformation(a.axisCorrectionMatrix,l.computedTransform,KUe)},r.addVertexLines(c8)):r.addVertexLines(a8),u){r.addDefine("USE_2D_INSTANCING",void 0,_e.VERTEX),r.addUniform("mat4","u_modelView2D",_e.VERTEX);let g=n.context,m=k.fromTranslation(l.instancingReferencePoint2D,new k);p.u_modelView2D=function(){return k.multiplyTransformation(g.uniformState.view,m,$Ue)}}e.uniformMap=At(p,e.uniformMap),e.instanceCount=o,e.attributes.push.apply(e.attributes,d)};var hw=new k,ZUe=new h;function JUe(e,t,n,i,o){let r=k.multiplyTransformation(t,e,hw);return r=k.multiplyTransformation(r,n,hw),o=Ft.basisTo2D(i.mapProjection,r,o),o}function QUe(e,t,n,i,o){let r=k.fromTranslation(e,hw),s=k.multiplyTransformation(t,r,hw);s=k.multiplyTransformation(s,n,hw);let a=k.getTranslation(s,ZUe);return o=Ni.computeActualEllipsoidPosition(i,a,o),o}function Zoe(e,t,n){let i=e.model,o=i.sceneGraph;e.runtimeNode.node.instances.transformInWorldSpace?(t=k.multiplyTransformation(i.modelMatrix,o.components.transform,t),n=k.multiplyTransformation(o.axisCorrectionMatrix,e.runtimeNode.computedTransform,n)):(t=k.clone(o.computedModelMatrix,t),t=k.multiplyTransformation(t,e.runtimeNode.computedTransform,t),n=k.clone(k.IDENTITY,n))}var Joe=new k,Qoe=new k,eze=new k,tze=new h;function nze(e,t,n,i){let o=Joe,r=Qoe;Zoe(t,o,r);let a=t.runtimeNode.instancingReferencePoint2D,l=e.length;for(let u=0;u<l;u++){let f=e[u],d=JUe(f,o,r,n,eze),p=k.getTranslation(d,tze),g=h.subtract(p,a,p);i[u]=k.setTranslation(d,g,i[u])}return i}function ize(e,t,n,i){let o=Joe,r=Qoe;Zoe(t,o,r);let a=t.runtimeNode.instancingReferencePoint2D,l=e.length;for(let u=0;u<l;u++){let f=e[u],d=QUe(f,o,r,n,f);i[u]=h.subtract(d,a,i[u])}return i}var oze=new h,rze=new h;function ere(e,t){let n=e.runtimeNode,i=e.model.sceneGraph.computedModelMatrix,o=k.multiplyByPoint(i,n.instancingTranslationMin,oze),r=Ni.computeActualEllipsoidPosition(t,o,o),s=k.multiplyByPoint(i,n.instancingTranslationMax,rze),a=Ni.computeActualEllipsoidPosition(t,s,s);n.instancingReferencePoint2D=h.lerp(r,a,.5,new h)}function u8(e){let n=e.length,i=new Float32Array(n*12);for(let o=0;o<n;o++){let r=e[o],s=12*o;i[s+0]=r[0],i[s+1]=r[4],i[s+2]=r[8],i[s+3]=r[12],i[s+4]=r[1],i[s+5]=r[5],i[s+6]=r[9],i[s+7]=r[13],i[s+8]=r[2],i[s+9]=r[6],i[s+10]=r[10],i[s+11]=r[14]}return i}function sze(e){let n=e.length,i=new Float32Array(n*3);for(let o=0;o<n;o++){let r=e[o],s=3*o;i[s+0]=r[0],i[s+1]=r[4],i[s+2]=r[8]}return i}var aze=new h,cze=new Ne,lze=new h;function tre(e,t,n){let i=new Array(t),o=Zt.getAttributeBySemantic(e,fs.TRANSLATION),r=Zt.getAttributeBySemantic(e,fs.ROTATION),s=Zt.getAttributeBySemantic(e,fs.SCALE),a=new h(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),l=new h(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),u=c(o),f=c(r),d=c(s),p=u?o.typedArray:new Float32Array(t*3),g=f?r.typedArray:new Float32Array(t*4);f&&r.normalized&&(g=Nn.dequantize(g,r.componentDatatype,r.type,t));let m;d?m=s.typedArray:(m=new Float32Array(t*3),m.fill(1));for(let x=0;x<t;x++){let T=new h(p[x*3],p[x*3+1],p[x*3+2],aze);h.maximumByComponent(a,T,a),h.minimumByComponent(l,T,l);let C=new Ne(g[x*4],g[x*4+1],g[x*4+2],f?g[x*4+3]:1,cze),S=new h(m[x*3],m[x*3+1],m[x*3+2],lze),v=k.fromTranslationQuaternionRotationScale(T,C,S,new k);i[x]=v}let b=n.runtimeNode;return b.instancingTranslationMin=l,b.instancingTranslationMax=a,u&&(o.typedArray=void 0),f&&(r.typedArray=void 0),d&&(s.typedArray=void 0),i}function uze(e,t,n){let i=new Array(t),o=e.typedArray,r=new h(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),s=new h(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let l=0;l<t;l++){let u=new h(o[l*3],o[l*3+1],o[l*3+2]);i[l]=u,h.minimumByComponent(r,u,r),h.maximumByComponent(s,u,s)}let a=n.runtimeNode;return a.instancingTranslationMin=r,a.instancingTranslationMax=s,e.typedArray=void 0,i}function f8(e,t){let n=xt.createVertexBuffer({context:t.context,typedArray:e,usage:ke.STATIC_DRAW});return n.vertexArrayDestroyable=!1,n}function fze(e,t,n,i,o,r){let s=Zt.getAttributeBySemantic(n,fs.ROTATION);c(s)?dze(e,n,i,t,o,r):hze(e,n,i,t,o)}function dze(e,t,n,i,o,r){let s=e.shaderBuilder,a=t.attributes[0].count,l=e.model,u=e.runtimeNode;s.addDefine("HAS_INSTANCE_MATRICES");let f="Transform",d,p=u.instancingTransformsBuffer;if(!c(p)){d=tre(t,a,e);let x=u8(d);p=f8(x,i),l._modelResources.push(p),r&&(u.transformsTypedArray=x),u.instancingTransformsBuffer=p}if(Koe(e,p,n,f),!o)return;let g=qe(i);g.mode=oe.COLUMBUS_VIEW,ere(e,g);let m=u.instancingTransformsBuffer2D;if(!c(m)){let x=nze(d,e,g,d),T=u8(x);m=f8(T,i),l._modelResources.push(m),u.instancingTransformsBuffer2D=m}Koe(e,m,n,"Transform2D")}function hze(e,t,n,i,o,r){let s=e.shaderBuilder,a=e.runtimeNode,l=Zt.getAttributeBySemantic(t,fs.TRANSLATION),u=Zt.getAttributeBySemantic(t,fs.SCALE);if(c(u)&&(s.addDefine("HAS_INSTANCE_SCALE"),l8(e,u.buffer,u.byteOffset,u.byteStride,n,"Scale")),!c(l))return;let f,d=l.typedArray;if(c(d)?f=uze(l,l.count,e):c(a.instancingTranslationMin)||(a.instancingTranslationMin=l.min,a.instancingTranslationMax=l.max),s.addDefine("HAS_INSTANCE_TRANSLATION"),l8(e,l.buffer,l.byteOffset,l.byteStride,n,"Translation"),!o&&!r)return;let g=qe(i);g.mode=oe.COLUMBUS_VIEW,ere(e,g);let m=a.instancingTranslationBuffer2D;if(!c(m)){let C=ize(f,e,g,f),S=sze(C);r&&(a.transformsTypedArray=S),m=f8(S,i),e.model._modelResources.push(m),a.instancingTranslationBuffer2D=m}if(!o)return;l8(e,m,0,void 0,n,"Translation2D")}function Koe(e,t,n,i){let r=$.getSizeInBytes($.FLOAT),s=r*12,a=[{index:e.attributeIndex++,vertexBuffer:t,componentsPerAttribute:4,componentDatatype:$.FLOAT,normalize:!1,offsetInBytes:0,strideInBytes:s,instanceDivisor:1},{index:e.attributeIndex++,vertexBuffer:t,componentsPerAttribute:4,componentDatatype:$.FLOAT,normalize:!1,offsetInBytes:r*4,strideInBytes:s,instanceDivisor:1},{index:e.attributeIndex++,vertexBuffer:t,componentsPerAttribute:4,componentDatatype:$.FLOAT,normalize:!1,offsetInBytes:r*8,strideInBytes:s,instanceDivisor:1}],l=e.shaderBuilder;l.addAttribute("vec4",`a_instancing${i}Row0`),l.addAttribute("vec4",`a_instancing${i}Row1`),l.addAttribute("vec4",`a_instancing${i}Row2`),n.push.apply(n,a)}function l8(e,t,n,i,o,r){o.push({index:e.attributeIndex++,vertexBuffer:t,componentsPerAttribute:3,componentDatatype:$.FLOAT,normalize:!1,offsetInBytes:n,strideInBytes:i,instanceDivisor:1}),e.shaderBuilder.addAttribute("vec3",`a_instance${r}`)}function mze(e,t,n,i){let o=n.attributes,r=e.shaderBuilder;for(let s=0;s<o.length;s++){let a=o[s];a.semantic===fs.FEATURE_ID&&(a.setIndex>=e.featureIdVertexAttributeSetIndex&&(e.featureIdVertexAttributeSetIndex=a.setIndex+1),i.push({index:e.attributeIndex++,vertexBuffer:a.buffer,componentsPerAttribute:cn.getNumberOfComponents(a.type),componentDatatype:a.componentDatatype,normalize:!1,offsetInBytes:a.byteOffset,strideInBytes:a.byteStride,instanceDivisor:1}),r.addAttribute("float",`a_instanceFeatureId_${a.setIndex}`))}}var d8=$oe;var h8={};h8.name="ModelMatrixUpdateStage";h8.update=function(e,t,n){let i=n.mode!==oe.SCENE3D;if(!(i&&t._model._projectTo2D)&&e._transformDirty){let o=i?t._computedModelMatrix2D:t._computedModelMatrix;nre(e,t,o,e.transformToRoot),e._transformDirty=!1}};function pze(e,t,n){e.modelMatrix=k.multiplyTransformation(t,n,e.modelMatrix),e.cullFace=Zt.getCullFace(e.modelMatrix,e.primitiveType)}function nre(e,t,n,i){let o;i=k.multiplyTransformation(i,e.transform,new k),e.updateComputedTransform();let r=e.runtimePrimitives.length;for(o=0;o<r;o++){let a=e.runtimePrimitives[o];pze(a.drawCommand,n,i)}let s=e.children.length;for(o=0;o<s;o++){let a=t._runtimeNodes[e.children[o]];a._transformToRoot=k.clone(i,a._transformToRoot),nre(a,t,n,i),a._transformDirty=!1}}var m8=h8;var ire={name:"NodeStatisticsPipelineStage",_countInstancingAttributes:ore,_countGeneratedBuffers:rre};ire.process=function(e,t,n){let i=e.model.statistics,o=t.instances,r=e.runtimeNode;ore(i,o),rre(i,r)};function ore(e,t){if(!c(t))return;let n=t.attributes,i=n.length;for(let o=0;o<i;o++){let r=n[o];c(r.buffer)&&e.addBuffer(r.buffer,!1)}}function rre(e,t){c(t.instancingTransformsBuffer)&&e.addBuffer(t.instancingTransformsBuffer,!1),c(t.instancingTransformsBuffer2D)&&e.addBuffer(t.instancingTransformsBuffer2D,!1),c(t.instancingTranslationBuffer2D)&&e.addBuffer(t.instancingTranslationBuffer2D,!1)}var p8=ire;function OT(e){e=y(e,y.EMPTY_OBJECT);let t=e.node,n=e.transform,i=e.transformToRoot,o=e.sceneGraph,r=e.children;A.typeOf.object("options.node",t),A.typeOf.object("options.transform",n),A.typeOf.object("options.transformToRoot",i),A.typeOf.object("options.sceneGraph",o),A.typeOf.object("options.children",r),this._node=t,this._name=t.name,this._id=t.index,this._sceneGraph=o,this._children=r,this._originalTransform=k.clone(n,this._originalTransform),this._transform=k.clone(n,this._transform),this._transformToRoot=k.clone(i,this._transformToRoot),this._computedTransform=new k,this._transformDirty=!1,this._transformParameters=void 0,this._morphWeights=[],this._runtimeSkin=void 0,this._computedJointMatrices=[],this.show=!0,this.userAnimated=!1,this.pipelineStages=[],this.runtimePrimitives=[],this.updateStages=[],this.instancingTranslationMin=void 0,this.instancingTranslationMax=void 0,this.instancingTransformsBuffer=void 0,this.instancingTransformsBuffer2D=void 0,this.instancingTranslationBuffer2D=void 0,this.instancingReferencePoint2D=void 0,_ze(this)}Object.defineProperties(OT.prototype,{node:{get:function(){return this._node}},sceneGraph:{get:function(){return this._sceneGraph}},children:{get:function(){return this._children}},transform:{get:function(){return this._transform},set:function(e){this._transformDirty=!0,this._transform=k.clone(e,this._transform)}},transformToRoot:{get:function(){return this._transformToRoot}},computedTransform:{get:function(){return this._computedTransform}},originalTransform:{get:function(){return this._originalTransform}},translation:{get:function(){return c(this._transformParameters)?this._transformParameters.translation:void 0},set:function(e){let t=this._transformParameters;if(!c(t))throw new E("The translation of a node cannot be set if it was defined using a matrix in the model.");let n=t.translation;h.equals(n,e)||(t.translation=h.clone(e,t.translation),_8(this,t))}},rotation:{get:function(){return c(this._transformParameters)?this._transformParameters.rotation:void 0},set:function(e){let t=this._transformParameters;if(!c(t))throw new E("The rotation of a node cannot be set if it was defined using a matrix in the model.");let n=t.rotation;Ne.equals(n,e)||(t.rotation=Ne.clone(e,t.rotation),_8(this,t))}},scale:{get:function(){return c(this._transformParameters)?this._transformParameters.scale:void 0},set:function(e){let t=this._transformParameters;if(!c(t))throw new E("The scale of a node cannot be set if it was defined using a matrix in the model.");let n=t.scale;h.equals(n,e)||(t.scale=h.clone(e,t.scale),_8(this,t))}},morphWeights:{get:function(){return this._morphWeights},set:function(e){let t=e.length;if(this._morphWeights.length!==t)throw new E("value must have the same length as the original weights array.");for(let n=0;n<t;n++)this._morphWeights[n]=e[n]}},runtimeSkin:{get:function(){return this._runtimeSkin}},computedJointMatrices:{get:function(){return this._computedJointMatrices}}});function _ze(e){let t=e.transform,n=e.transformToRoot,i=e._computedTransform;e._computedTransform=k.multiply(n,t,i);let o=e.node;c(o.matrix)||(e._transformParameters=new Qx(o.translation,o.rotation,o.scale)),c(o.morphWeights)&&(e._morphWeights=o.morphWeights.slice());let r=o.articulationName;if(c(r)){let l=e.sceneGraph._runtimeArticulations[r];c(l)&&l.runtimeNodes.push(e)}}function _8(e,t){e._transformDirty=!0,e._transform=k.fromTranslationRotationScale(t,e._transform)}OT.prototype.getChild=function(e){if(A.typeOf.number("index",e),e<0||e>=this.children.length)throw new E("index must be greater than or equal to 0 and less than the number of children.");return this.sceneGraph._runtimeNodes[this.children[e]]};OT.prototype.configurePipeline=function(){let e=this.node,t=this.pipelineStages;t.length=0;let n=this.updateStages;n.length=0,c(e.instances)&&t.push(d8),t.push(p8),n.push(m8)};OT.prototype.updateComputedTransform=function(){this._computedTransform=k.multiply(this._transformToRoot,this._transform,this._computedTransform)};OT.prototype.updateJointMatrices=function(){let e=this._runtimeSkin;if(!c(e))return;e.updateJointMatrices();let t=this._computedJointMatrices,n=e.jointMatrices,i=n.length;for(let o=0;o<i;o++){c(t[o])||(t[o]=new k);let r=k.multiplyTransformation(this.transformToRoot,this.transform,t[o]),s=k.inverseTransformation(r,t[o]);t[o]=k.multiplyTransformation(s,n[o],t[o])}};var g8=OT;var sre={name:"AlphaPipelineStage"};sre.process=function(e,t,n){let i=e.alphaOptions,o=e.model;i.pass=y(i.pass,o.opaquePass);let r=e.renderStateOptions;i.pass===ve.TRANSLUCENT&&(r.cull.enabled=!1,r.depthMask=!1,r.blending=hn.ALPHA_BLEND);let s=e.shaderBuilder,a=e.uniformMap;c(i.alphaCutoff)&&(s.addDefine("ALPHA_MODE_MASK",void 0,_e.FRAGMENT),s.addUniform("float","u_alphaCutoff",_e.FRAGMENT),a.u_alphaCutoff=function(){return i.alphaCutoff})};var y8=sre;var are={name:"BatchTexturePipelineStage"};are.process=function(e,t,n){let i=e.shaderBuilder,o={},r=e.model,s=r.featureTables[r.featureTableId],a=s.featuresLength;i.addUniform("int","model_featuresLength"),o.model_featuresLength=function(){return a};let l=s.batchTexture;i.addUniform("sampler2D","model_batchTexture"),o.model_batchTexture=function(){return y(l.batchTexture,l.defaultTexture)},i.addUniform("vec4","model_textureStep"),o.model_textureStep=function(){return l.textureStep},l.textureDimensions.y>1&&(i.addDefine("MULTILINE_BATCH_TEXTURE"),i.addUniform("vec2","model_textureDimensions"),o.model_textureDimensions=function(){return l.textureDimensions}),e.uniformMap=At(o,e.uniformMap)};var b8=are;var cre={name:"ClassificationPipelineStage"};cre.process=function(e,t,n){e.shaderBuilder.addDefine("HAS_CLASSIFICATION",void 0,_e.BOTH);let o=e.runtimePrimitive;c(o.batchLengths)||gze(t,o)};function gze(e,t){let n=Zt.getAttributeBySemantic(e,Ct.POSITION);if(!c(n))throw new ue("Primitives must have a position attribute to be used for classification.");let i,o=e.indices,r=c(o);r&&(i=o.typedArray,o.typedArray=void 0);let s=r?o.count:n.count,a=Zt.getAttributeBySemantic(e,Ct.FEATURE_ID,0);if(!c(a)){t.batchLengths=[s],t.batchOffsets=[0];return}let l=a.typedArray;a.typedArray=void 0;let u=[],f=[0],d=r?i[0]:0,p=l[d],g=0;for(let b=1;b<s;b++){let x=r?i[b]:b,T=l[x];if(T!==p){let C=b-g,S=b;u.push(C),f.push(S),g=S,p=T}}let m=s-g;u.push(m),t.batchLengths=u,t.batchOffsets=f}var x8=cre;var T8=`void filterByPassType(inout vec3 positionMC, vec4 featureColor)
{
bool styleTranslucent = (featureColor.a != 1.0);
if (czm_pass == czm_passTranslucent && !styleTranslucent && !model_commandTranslucent)
{
#ifdef HAS_SILHOUETTE
positionMC *= float(model_silhouettePass);
#else
positionMC *= 0.0;
#endif
}
else if (czm_pass != czm_passTranslucent && styleTranslucent)
{
positionMC *= 0.0;
}
}
void cpuStylingStage(inout vec3 positionMC, inout SelectedFeature feature)
{
float show = ceil(feature.color.a);
positionMC *= show;
#if defined(HAS_SELECTED_FEATURE_ID_ATTRIBUTE) && !defined(HAS_CLASSIFICATION)
filterByPassType(positionMC, feature.color);
#endif
}
`;var A8=`void filterByPassType(vec4 featureColor)
{
bool styleTranslucent = (featureColor.a != 1.0);
if (czm_pass == czm_passTranslucent && !styleTranslucent && !model_commandTranslucent)
{
#ifdef HAS_SILHOUETTE
if(!model_silhouettePass) {
discard;
}
#else
discard;
#endif
}
else if (czm_pass != czm_passTranslucent && styleTranslucent)
{
discard;
}
}
void cpuStylingStage(inout czm_modelMaterial material, SelectedFeature feature)
{
vec4 featureColor = feature.color;
if (featureColor.a == 0.0)
{
discard;
}
#if defined(HAS_SELECTED_FEATURE_ID_TEXTURE) && !defined(HAS_CLASSIFICATION)
filterByPassType(featureColor);
#endif
featureColor = czm_gammaCorrect(featureColor);
#ifdef HAS_CLASSIFICATION
material.diffuse = featureColor.rgb * featureColor.a;
#else
float highlight = ceil(model_colorBlend);
material.diffuse *= mix(featureColor.rgb, vec3(1.0), highlight);
#endif
material.alpha *= featureColor.a;
}
`;var lre={name:"CPUStylingPipelineStage"};lre.process=function(e,t,n){let i=e.model,o=e.shaderBuilder;o.addVertexLines(T8),o.addFragmentLines(A8),o.addDefine("USE_CPU_STYLING",void 0,_e.BOTH),c(i.color)||(o.addUniform("float",IT.COLOR_BLEND_UNIFORM_NAME,_e.FRAGMENT),e.uniformMap[IT.COLOR_BLEND_UNIFORM_NAME]=function(){return ol.getColorBlend(i.colorBlendMode,i.colorBlendAmount)}),o.addUniform("bool","model_commandTranslucent",_e.BOTH),e.uniformMap.model_commandTranslucent=function(){return e.alphaOptions.pass===ve.TRANSLUCENT}};var C8=lre;var ure={MODIFY_MATERIAL:"MODIFY_MATERIAL",REPLACE_MATERIAL:"REPLACE_MATERIAL"};ure.getDefineName=function(e){return`CUSTOM_SHADER_${e}`};var O0=Object.freeze(ure);var E8=`void customShaderStage(
inout czm_modelVertexOutput vsOutput,
inout ProcessedAttributes attributes,
FeatureIds featureIds,
Metadata metadata,
MetadataClass metadataClass,
MetadataStatistics metadataStatistics
) {
VertexInput vsInput;
initializeInputStruct(vsInput, attributes);
vsInput.featureIds = featureIds;
vsInput.metadata = metadata;
vsInput.metadataClass = metadataClass;
vsInput.metadataStatistics = metadataStatistics;
vertexMain(vsInput, vsOutput);
attributes.positionMC = vsOutput.positionMC;
}
`;var S8=`void customShaderStage(
inout czm_modelMaterial material,
ProcessedAttributes attributes,
FeatureIds featureIds,
Metadata metadata,
MetadataClass metadataClass,
MetadataStatistics metadataStatistics
) {
FragmentInput fsInput;
initializeInputStruct(fsInput, attributes);
fsInput.featureIds = featureIds;
fsInput.metadata = metadata;
fsInput.metadataClass = metadataClass;
fsInput.metadataStatistics = metadataStatistics;
fragmentMain(fsInput, material);
}
`;var w8=`void featureIdStage(out FeatureIds featureIds, ProcessedAttributes attributes) {
initializeFeatureIds(featureIds, attributes);
initializeFeatureIdAliases(featureIds);
}
`;var v8=`void featureIdStage(out FeatureIds featureIds, ProcessedAttributes attributes)
{
initializeFeatureIds(featureIds, attributes);
initializeFeatureIdAliases(featureIds);
setFeatureIdVaryings();
}
`;var Pi={name:"FeatureIdPipelineStage",STRUCT_ID_FEATURE_IDS_VS:"FeatureIdsVS",STRUCT_ID_FEATURE_IDS_FS:"FeatureIdsFS",STRUCT_NAME_FEATURE_IDS:"FeatureIds",FUNCTION_ID_INITIALIZE_FEATURE_IDS_VS:"initializeFeatureIdsVS",FUNCTION_ID_INITIALIZE_FEATURE_IDS_FS:"initializeFeatureIdsFS",FUNCTION_ID_INITIALIZE_FEATURE_ID_ALIASES_VS:"initializeFeatureIdAliasesVS",FUNCTION_ID_INITIALIZE_FEATURE_ID_ALIASES_FS:"initializeFeatureIdAliasesFS",FUNCTION_SIGNATURE_INITIALIZE_FEATURE_IDS:"void initializeFeatureIds(out FeatureIds featureIds, ProcessedAttributes attributes)",FUNCTION_SIGNATURE_INITIALIZE_FEATURE_ID_ALIASES:"void initializeFeatureIdAliases(inout FeatureIds featureIds)",FUNCTION_ID_SET_FEATURE_ID_VARYINGS:"setFeatureIdVaryings",FUNCTION_SIGNATURE_SET_FEATURE_ID_VARYINGS:"void setFeatureIdVaryings()"};Pi.process=function(e,t,n){let i=e.shaderBuilder;yze(i);let o=e.runtimeNode.node.instances;c(o)&&bze(e,o,n),xze(e,t,n),i.addVertexLines(v8),i.addFragmentLines(w8)};function yze(e){e.addStruct(Pi.STRUCT_ID_FEATURE_IDS_VS,Pi.STRUCT_NAME_FEATURE_IDS,_e.VERTEX),e.addStruct(Pi.STRUCT_ID_FEATURE_IDS_FS,Pi.STRUCT_NAME_FEATURE_IDS,_e.FRAGMENT),e.addFunction(Pi.FUNCTION_ID_INITIALIZE_FEATURE_IDS_VS,Pi.FUNCTION_SIGNATURE_INITIALIZE_FEATURE_IDS,_e.VERTEX),e.addFunction(Pi.FUNCTION_ID_INITIALIZE_FEATURE_IDS_FS,Pi.FUNCTION_SIGNATURE_INITIALIZE_FEATURE_IDS,_e.FRAGMENT),e.addFunction(Pi.FUNCTION_ID_INITIALIZE_FEATURE_ID_ALIASES_VS,Pi.FUNCTION_SIGNATURE_INITIALIZE_FEATURE_ID_ALIASES,_e.VERTEX),e.addFunction(Pi.FUNCTION_ID_INITIALIZE_FEATURE_ID_ALIASES_FS,Pi.FUNCTION_SIGNATURE_INITIALIZE_FEATURE_ID_ALIASES,_e.FRAGMENT),e.addFunction(Pi.FUNCTION_ID_SET_FEATURE_ID_VARYINGS,Pi.FUNCTION_SIGNATURE_SET_FEATURE_ID_VARYINGS,_e.VERTEX)}function bze(e,t,n){let i=t.featureIds,o=t.attributes[0].count;for(let r=0;r<i.length;r++){let s=i[r],a=s.positionalLabel;s instanceof Sn.FeatureIdAttribute?Tze(e,s,a):fre(e,s,a,o,1,n);let l=s.label;c(l)&&dre(e,a,l,_e.BOTH)}}function xze(e,t,n){let i=t.featureIds,r=Zt.getAttributeBySemantic(t,Ct.POSITION).count;for(let s=0;s<i.length;s++){let a=i[s],l=a.positionalLabel,u=_e.BOTH;a instanceof Sn.FeatureIdAttribute?Aze(e,a,l):a instanceof Sn.FeatureIdImplicitRange?fre(e,a,l,r,void 0,n):(Cze(e,a,l,s,n),u=_e.FRAGMENT);let f=a.label;c(f)&&dre(e,l,f,u)}}function Tze(e,t,n){let i=e.shaderBuilder;i.addStructField(Pi.STRUCT_ID_FEATURE_IDS_VS,"int",n),i.addStructField(Pi.STRUCT_ID_FEATURE_IDS_FS,"int",n);let o=t.setIndex,r=n.replace(/_\d+$/,"_"),s=`a_${r}${o}`,a=`v_${r}${o}`,l=`featureIds.${n} = int(czm_round(${s}));`,u=`featureIds.${n} = int(czm_round(${a}));`;i.addFunctionLines(Pi.FUNCTION_ID_INITIALIZE_FEATURE_IDS_VS,[l]),i.addFunctionLines(Pi.FUNCTION_ID_INITIALIZE_FEATURE_IDS_FS,[u]),i.addVarying("float",a),i.addFunctionLines(Pi.FUNCTION_ID_SET_FEATURE_ID_VARYINGS,[`${a} = ${s};`])}function Aze(e,t,n){let i=e.shaderBuilder;i.addStructField(Pi.STRUCT_ID_FEATURE_IDS_VS,"int",n),i.addStructField(Pi.STRUCT_ID_FEATURE_IDS_FS,"int",n);let o=t.setIndex,r=n.replace(/_\d+$/,"_"),s=[`featureIds.${n} = int(czm_round(attributes.${r}${o}));`];i.addFunctionLines(Pi.FUNCTION_ID_INITIALIZE_FEATURE_IDS_VS,s),i.addFunctionLines(Pi.FUNCTION_ID_INITIALIZE_FEATURE_IDS_FS,s)}function fre(e,t,n,i,o,r){Eze(e,t,i,o,r);let s=e.shaderBuilder,a=`a_implicit_${n}`;s.addAttribute("float",a);let l=`v_implicit_${n}`;s.addVarying("float",l),s.addStructField(Pi.STRUCT_ID_FEATURE_IDS_VS,"int",n),s.addStructField(Pi.STRUCT_ID_FEATURE_IDS_FS,"int",n),s.addFunctionLines(Pi.FUNCTION_ID_SET_FEATURE_ID_VARYINGS,[`${l} = ${a};`]),s.addFunctionLines(Pi.FUNCTION_ID_INITIALIZE_FEATURE_IDS_VS,[`featureIds.${n} = int(czm_round(${a}));`]),s.addFunctionLines(Pi.FUNCTION_ID_INITIALIZE_FEATURE_IDS_FS,[`featureIds.${n} = int(czm_round(${l}));`])}function Cze(e,t,n,i,o){let r=`u_featureIdTexture_${i}`,s=e.uniformMap,a=t.textureReader;s[r]=function(){return y(a.texture,o.context.defaultTexture)};let l=a.channels,u=e.shaderBuilder;u.addStructField(Pi.STRUCT_ID_FEATURE_IDS_FS,"int",n),u.addUniform("sampler2D",r,_e.FRAGMENT);let d=`v_texCoord_${a.texCoord}`,p=d,g=a.transform;if(c(g)&&!Q.equals(g,Q.IDENTITY)){let x=`${r}Transform`;u.addUniform("mat3",x,_e.FRAGMENT),s[x]=function(){return g},p=`vec2(${x} * vec3(${d}, 1.0))`}let m=`texture(${r}, ${p}).${l}`,b=`featureIds.${n} = czm_unpackUint(${m});`;u.addFunctionLines(Pi.FUNCTION_ID_INITIALIZE_FEATURE_IDS_FS,[b])}function dre(e,t,n,i){let o=e.shaderBuilder,r=_e.includesVertexShader(i);r&&o.addStructField(Pi.STRUCT_ID_FEATURE_IDS_VS,"int",n),o.addStructField(Pi.STRUCT_ID_FEATURE_IDS_FS,"int",n);let s=[`featureIds.${n} = featureIds.${t};`];r&&o.addFunctionLines(Pi.FUNCTION_ID_INITIALIZE_FEATURE_ID_ALIASES_VS,s),o.addFunctionLines(Pi.FUNCTION_ID_INITIALIZE_FEATURE_ID_ALIASES_FS,s)}function Eze(e,t,n,i,o){let r=e.model,s,a;if(c(t.repeat)){let u=Sze(t,n);s=xt.createVertexBuffer({context:o.context,typedArray:u,usage:ke.STATIC_DRAW}),s.vertexArrayDestroyable=!1,r._pipelineResources.push(s),r.statistics.addBuffer(s,!1)}else a=[t.offset];let l={index:e.attributeIndex++,instanceDivisor:i,value:a,vertexBuffer:s,normalize:!1,componentsPerAttribute:1,componentDatatype:$.FLOAT,strideInBytes:$.getSizeInBytes($.FLOAT),offsetInBytes:0};e.attributes.push(l)}function Sze(e,t){let n=e.offset,i=e.repeat,o=new Float32Array(t);for(let r=0;r<t;r++)o[r]=n+Math.floor(r/i);return o}var RT=Pi;var D8=`void metadataStage(
out Metadata metadata,
out MetadataClass metadataClass,
out MetadataStatistics metadataStatistics,
ProcessedAttributes attributes
)
{
initializeMetadata(metadata, metadataClass, metadataStatistics, attributes);
}
`;var P8=`void metadataStage(
out Metadata metadata,
out MetadataClass metadataClass,
out MetadataStatistics metadataStatistics,
ProcessedAttributes attributes
)
{
initializeMetadata(metadata, metadataClass, metadataStatistics, attributes);
setMetadataVaryings();
}
`;var yi={name:"MetadataPipelineStage",STRUCT_ID_METADATA_VS:"MetadataVS",STRUCT_ID_METADATA_FS:"MetadataFS",STRUCT_NAME_METADATA:"Metadata",STRUCT_ID_METADATA_CLASS_VS:"MetadataClassVS",STRUCT_ID_METADATA_CLASS_FS:"MetadataClassFS",STRUCT_NAME_METADATA_CLASS:"MetadataClass",STRUCT_ID_METADATA_STATISTICS_VS:"MetadataStatisticsVS",STRUCT_ID_METADATA_STATISTICS_FS:"MetadataStatisticsFS",STRUCT_NAME_METADATA_STATISTICS:"MetadataStatistics",FUNCTION_ID_INITIALIZE_METADATA_VS:"initializeMetadataVS",FUNCTION_ID_INITIALIZE_METADATA_FS:"initializeMetadataFS",FUNCTION_SIGNATURE_INITIALIZE_METADATA:"void initializeMetadata(out Metadata metadata, out MetadataClass metadataClass, out MetadataStatistics metadataStatistics, ProcessedAttributes attributes)",FUNCTION_ID_SET_METADATA_VARYINGS:"setMetadataVaryings",FUNCTION_SIGNATURE_SET_METADATA_VARYINGS:"void setMetadataVaryings()",METADATA_CLASS_FIELDS:[{specName:"noData",shaderName:"noData"},{specName:"default",shaderName:"defaultValue"},{specName:"min",shaderName:"minValue"},{specName:"max",shaderName:"maxValue"}],METADATA_STATISTICS_FIELDS:[{specName:"min",shaderName:"minValue"},{specName:"max",shaderName:"maxValue"},{specName:"mean",shaderName:"mean",type:"float"},{specName:"median",shaderName:"median"},{specName:"standardDeviation",shaderName:"standardDeviation",type:"float"},{specName:"variance",shaderName:"variance",type:"float"},{specName:"sum",shaderName:"sum"}]};yi.process=function(e,t,n){let{shaderBuilder:i,model:o}=e,{structuralMetadata:r={},content:s}=o,a=s?.tileset.metadataExtension?.statistics,l=wze(r.propertyAttributes,t,a),u=Dze(r.propertyTextures,a),f=l.concat(u);Ize(i,f),Mze(i),i.addVertexLines(P8),i.addFragmentLines(D8);for(let d=0;d<l.length;d++){let p=l[d];Lze(e,p)}for(let d=0;d<u.length;d++){let p=u[d];Fze(e,p)}};function wze(e,t,n){return c(e)?e.flatMap(i=>vze(i,t,n)):[]}function vze(e,t,n){let{getAttributeByName:i,getAttributeInfo:o,sanitizeGlslIdentifier:r}=Zt,s=e.class.id,a=n?.classes[s],l=Object.entries(e.properties),u=new Array(l.length);for(let f=0;f<l.length;f++){let[d,p]=l[f],g=i(t,p.attribute),{glslType:m,variableName:b}=o(g);u[f]={metadataVariable:r(d),property:p,type:p.classProperty.type,glslType:m,variableName:b,propertyStatistics:a?.properties[d],shaderDestination:_e.BOTH}}return u}function Dze(e,t){return c(e)?e.flatMap(n=>Pze(n,t)):[]}function Pze(e,t){let{sanitizeGlslIdentifier:n}=Zt,i=e.class.id,o=t?.classes[i],r=Object.entries(e.properties).filter(([a,l])=>l.isGpuCompatible()),s=new Array(r.length);for(let a=0;a<r.length;a++){let[l,u]=r[a];s[a]={metadataVariable:n(l),property:u,type:u.classProperty.type,glslType:u.getGlslType(),propertyStatistics:o?.properties[l],shaderDestination:_e.FRAGMENT}}return s}function Ize(e,t){let n=new Set,i=new Set;for(let a=0;a<t.length;a++){let{type:l,glslType:u,propertyStatistics:f}=t[a];n.add(u),c(f)&&l!==Et.ENUM&&i.add(u)}let o=yi.METADATA_CLASS_FIELDS;for(let a of n){let l=`${a}MetadataClass`;s(l,a,o)}let r=yi.METADATA_STATISTICS_FIELDS;for(let a of i){let l=`${a}MetadataStatistics`;s(l,a,r)}function s(a,l,u){e.addStruct(a,a,_e.BOTH);for(let f=0;f<u.length;f++){let{shaderName:d}=u[f],p=u[f].type==="float"?Rze(l):l;e.addStructField(a,p,d)}}}var Oze={int:"float",ivec2:"vec2",ivec3:"vec3",ivec4:"vec4"};function Rze(e){let t=Oze[e];return c(t)?t:e}function Mze(e){e.addStruct(yi.STRUCT_ID_METADATA_VS,yi.STRUCT_NAME_METADATA,_e.VERTEX),e.addStruct(yi.STRUCT_ID_METADATA_FS,yi.STRUCT_NAME_METADATA,_e.FRAGMENT),e.addStruct(yi.STRUCT_ID_METADATA_CLASS_VS,yi.STRUCT_NAME_METADATA_CLASS,_e.VERTEX),e.addStruct(yi.STRUCT_ID_METADATA_CLASS_FS,yi.STRUCT_NAME_METADATA_CLASS,_e.FRAGMENT),e.addStruct(yi.STRUCT_ID_METADATA_STATISTICS_VS,yi.STRUCT_NAME_METADATA_STATISTICS,_e.VERTEX),e.addStruct(yi.STRUCT_ID_METADATA_STATISTICS_FS,yi.STRUCT_NAME_METADATA_STATISTICS,_e.FRAGMENT),e.addFunction(yi.FUNCTION_ID_INITIALIZE_METADATA_VS,yi.FUNCTION_SIGNATURE_INITIALIZE_METADATA,_e.VERTEX),e.addFunction(yi.FUNCTION_ID_INITIALIZE_METADATA_FS,yi.FUNCTION_SIGNATURE_INITIALIZE_METADATA,_e.FRAGMENT),e.addFunction(yi.FUNCTION_ID_SET_METADATA_VARYINGS,yi.FUNCTION_SIGNATURE_SET_METADATA_VARYINGS,_e.VERTEX)}function Lze(e,t){Nze(e,t),hre(e.shaderBuilder,t),mre(e.shaderBuilder,t)}function Nze(e,t){let{shaderBuilder:n}=e,{metadataVariable:i,property:o,glslType:r}=t,s=_re({valueExpression:`attributes.${t.variableName}`,renderResources:e,glslType:r,metadataVariable:i,shaderDestination:_e.BOTH,property:o});n.addStructField(yi.STRUCT_ID_METADATA_VS,r,i),n.addStructField(yi.STRUCT_ID_METADATA_FS,r,i);let a=`metadata.${i} = ${s};`;n.addFunctionLines(yi.FUNCTION_ID_INITIALIZE_METADATA_VS,[a]),n.addFunctionLines(yi.FUNCTION_ID_INITIALIZE_METADATA_FS,[a])}function Fze(e,t){Bze(e,t),hre(e.shaderBuilder,t),mre(e.shaderBuilder,t)}function Bze(e,t){let{shaderBuilder:n,uniformMap:i}=e,{metadataVariable:o,glslType:r,property:s}=t,{texCoord:a,channels:l,index:u,texture:f,transform:d}=s.textureReader,p=`u_propertyTexture_${u}`;i.hasOwnProperty(p)||(n.addUniform("sampler2D",p,_e.FRAGMENT),i[p]=()=>f),n.addStructField(yi.STRUCT_ID_METADATA_FS,r,o);let g=`attributes.texCoord_${a}`,m=g;if(c(d)&&!Q.equals(d,Q.IDENTITY)){let S=`${p}Transform`;n.addUniform("mat3",S,_e.FRAGMENT),i[S]=function(){return d},m=`vec2(${S} * vec3(${g}, 1.0))`}let b=`texture(${p}, ${m}).${l}`,x=s.unpackInShader(b),T=_re({valueExpression:x,renderResources:e,glslType:r,metadataVariable:o,shaderDestination:_e.FRAGMENT,property:s}),C=`metadata.${o} = ${T};`;n.addFunctionLines(yi.FUNCTION_ID_INITIALIZE_METADATA_FS,[C])}function hre(e,t){let{classProperty:n}=t.property,{metadataVariable:i,glslType:o,shaderDestination:r}=t,s=pre(yi.METADATA_CLASS_FIELDS,n,`metadataClass.${i}`,o),a=`${o}MetadataClass`;e.addStructField(yi.STRUCT_ID_METADATA_CLASS_FS,a,i),e.addFunctionLines(yi.FUNCTION_ID_INITIALIZE_METADATA_FS,s),_e.includesVertexShader(r)&&(e.addStructField(yi.STRUCT_ID_METADATA_CLASS_VS,a,i),e.addFunctionLines(yi.FUNCTION_ID_INITIALIZE_METADATA_VS,s))}function mre(e,t){let{propertyStatistics:n}=t;if(!c(n))return;let{metadataVariable:i,type:o,glslType:r}=t;if(o===Et.ENUM)return;let s=yi.METADATA_STATISTICS_FIELDS,a=`metadataStatistics.${i}`,l=pre(s,n,a,r),u=`${r}MetadataStatistics`;e.addStructField(yi.STRUCT_ID_METADATA_STATISTICS_FS,u,i),e.addFunctionLines(yi.FUNCTION_ID_INITIALIZE_METADATA_FS,l),_e.includesVertexShader(t.shaderDestination)&&(e.addStructField(yi.STRUCT_ID_METADATA_STATISTICS_VS,u,i),e.addFunctionLines(yi.FUNCTION_ID_INITIALIZE_METADATA_VS,l))}function pre(e,t,n,i){function o(r){let s=t[r.specName];if(c(s))return`${n}.${r.shaderName} = ${i}(${s});`}return c(t)?e.map(o).filter(c):[]}function _re(e){let{valueExpression:t,property:n}=e;if(!n.hasValueTransform)return t;let i=e.metadataVariable,o=`u_${i}_offset`,r=`u_${i}_scale`,{shaderBuilder:s,uniformMap:a}=e.renderResources,{glslType:l,shaderDestination:u}=e;s.addUniform(l,o,u),s.addUniform(l,r,u);let{offset:f,scale:d}=n;return a[o]=()=>f,a[r]=()=>d,`czm_valueTransform(${o}, ${r}, ${t})`}var bh=yi;var kze={INHERIT:0,OPAQUE:1,TRANSLUCENT:2},MT=Object.freeze(kze);var Ks={name:"CustomShaderPipelineStage",STRUCT_ID_ATTRIBUTES_VS:"AttributesVS",STRUCT_ID_ATTRIBUTES_FS:"AttributesFS",STRUCT_NAME_ATTRIBUTES:"Attributes",STRUCT_ID_VERTEX_INPUT:"VertexInput",STRUCT_NAME_VERTEX_INPUT:"VertexInput",STRUCT_ID_FRAGMENT_INPUT:"FragmentInput",STRUCT_NAME_FRAGMENT_INPUT:"FragmentInput",FUNCTION_ID_INITIALIZE_INPUT_STRUCT_VS:"initializeInputStructVS",FUNCTION_SIGNATURE_INITIALIZE_INPUT_STRUCT_VS:"void initializeInputStruct(out VertexInput vsInput, ProcessedAttributes attributes)",FUNCTION_ID_INITIALIZE_INPUT_STRUCT_FS:"initializeInputStructFS",FUNCTION_SIGNATURE_INITIALIZE_INPUT_STRUCT_FS:"void initializeInputStruct(out FragmentInput fsInput, ProcessedAttributes attributes)",_oneTimeWarning:_t};Ks.process=function(e,t,n){let{shaderBuilder:i,model:o,alphaOptions:r}=e,{customShader:s}=o,{lightingModel:a,translucencyMode:l}=s;c(a)&&(e.lightingOptions.lightingModel=a),l===MT.TRANSLUCENT?r.pass=ve.TRANSLUCENT:l===MT.OPAQUE&&(r.pass=void 0);let u=qze(s,t);if(!u.customShaderEnabled)return;if($ze(i,s,u),u.shouldComputePositionWC&&i.addDefine("COMPUTE_POSITION_WC_CUSTOM_SHADER",void 0,_e.BOTH),c(s.vertexShaderText)&&i.addDefine("HAS_CUSTOM_VERTEX_SHADER",void 0,_e.VERTEX),c(s.fragmentShaderText)){i.addDefine("HAS_CUSTOM_FRAGMENT_SHADER",void 0,_e.FRAGMENT);let p=O0.getDefineName(s.mode);i.addDefine(p,void 0,_e.FRAGMENT)}let f=s.uniforms;for(let p in f)if(f.hasOwnProperty(p)){let g=f[p];i.addUniform(g.type,p)}let d=s.varyings;for(let p in d)if(d.hasOwnProperty(p)){let g=d[p];i.addVarying(g,p)}e.uniformMap=At(e.uniformMap,s.uniformMap)};function Vze(e){let t={};for(let n=0;n<e.length;n++){let i=Zt.getAttributeInfo(e[n]);t[i.variableName]=i}return t}var Uze={position:"vec3",normal:"vec3",tangent:"vec3",bitangent:"vec3",texCoord:"vec2",color:"vec4",joints:"ivec4",weights:"vec4"},zze={position:"vec3(0.0)",normal:"vec3(0.0, 0.0, 1.0)",tangent:"vec3(1.0, 0.0, 0.0)",bitangent:"vec3(0.0, 1.0, 0.0)",texCoord:"vec2(0.0)",color:"vec4(1.0)",joints:"ivec4(0)",weights:"vec4(0.0)"};function gre(e){let t=e.replace(/_[0-9]+$/,"");t=t.replace(/(MC|EC)$/,"");let n=Uze[t],i=zze[t];if(c(n))return{attributeField:[n,e],value:i}}function Hze(e,t){if(!c(e.vertexShaderText))return{enabled:!1};let n=e.usedVariablesVertex.attributeSet,i=yre(t,n,!1),o=bre(t,n,!1),r,s=[],a=[];for(let l in i){if(!i.hasOwnProperty(l))continue;let f=[i[l].glslType,l];s.push(f),r=`vsInput.attributes.${l} = attributes.${l};`,a.push(r)}for(let l=0;l<o.length;l++){let u=o[l],f=gre(u);if(!c(f))return Ks._oneTimeWarning("CustomShaderPipelineStage.incompatiblePrimitiveVS",`Primitive is missing attribute ${u}, disabling custom vertex shader`),{enabled:!1};s.push(f.attributeField),r=`vsInput.attributes.${u} = ${f.value};`,a.push(r)}return{enabled:!0,attributeFields:s,initializationLines:a}}function Gze(e){let t=[],n=[],i=e.usedVariablesFragment.attributeSet;return i.hasOwnProperty("positionWC")&&(t.push(["vec3","positionWC"]),n.push("fsInput.attributes.positionWC = attributes.positionWC;")),i.hasOwnProperty("positionEC")&&(t.push(["vec3","positionEC"]),n.push("fsInput.attributes.positionEC = attributes.positionEC;")),{attributeFields:t,initializationLines:n}}function jze(e,t){if(!c(e.fragmentShaderText))return{enabled:!1};let n=e.usedVariablesFragment.attributeSet,i=yre(t,n,!0),o=bre(t,n,!0),r,s=[],a=[];for(let u in i){if(!i.hasOwnProperty(u))continue;let d=[i[u].glslType,u];s.push(d),r=`fsInput.attributes.${u} = attributes.${u};`,a.push(r)}for(let u=0;u<o.length;u++){let f=o[u],d=gre(f);if(!c(d))return Ks._oneTimeWarning("CustomShaderPipelineStage.incompatiblePrimitiveFS",`Primitive is missing attribute ${f}, disabling custom fragment shader.`),{enabled:!1};s.push(d.attributeField),r=`fsInput.attributes.${f} = ${d.value};`,a.push(r)}let l=Gze(e);return{enabled:!0,attributeFields:s.concat(l.attributeFields),initializationLines:l.initializationLines.concat(a)}}var Wze={positionWC:!0,positionEC:!0};function yre(e,t,n){let i={};for(let o in e){if(!e.hasOwnProperty(o))continue;let r=e[o],s=o;n&&o==="normalMC"?s="normalEC":n&&o==="tangentMC"&&(s="tangentEC",r.glslType="vec3"),t.hasOwnProperty(s)&&(i[s]=r)}return i}function bre(e,t,n){let i=[];for(let o in t){if(!t.hasOwnProperty(o)||Wze.hasOwnProperty(o))continue;let r=o;n&&o==="normalEC"?r="normalMC":n&&o==="tangentEC"&&(r="tangentMC"),e.hasOwnProperty(r)||i.push(o)}return i}function qze(e,t){let n=Vze(t.attributes),i=Hze(e,n),o=jze(e,n),s=e.usedVariablesFragment.attributeSet.hasOwnProperty("positionWC")&&o.enabled;return{vertexLines:i,fragmentLines:o,customShaderEnabled:i.enabled||o.enabled,shouldComputePositionWC:s}}function Yze(e,t){let n=Ks.STRUCT_ID_ATTRIBUTES_VS;e.addStruct(n,Ks.STRUCT_NAME_ATTRIBUTES,_e.VERTEX);let{attributeFields:i,initializationLines:o}=t;for(let s=0;s<i.length;s++){let[a,l]=i[s];e.addStructField(n,a,l)}n=Ks.STRUCT_ID_VERTEX_INPUT,e.addStruct(n,Ks.STRUCT_NAME_VERTEX_INPUT,_e.VERTEX),e.addStructField(n,Ks.STRUCT_NAME_ATTRIBUTES,"attributes"),e.addStructField(n,RT.STRUCT_NAME_FEATURE_IDS,"featureIds"),e.addStructField(n,bh.STRUCT_NAME_METADATA,"metadata"),e.addStructField(n,bh.STRUCT_NAME_METADATA_CLASS,"metadataClass"),e.addStructField(n,bh.STRUCT_NAME_METADATA_STATISTICS,"metadataStatistics");let r=Ks.FUNCTION_ID_INITIALIZE_INPUT_STRUCT_VS;e.addFunction(r,Ks.FUNCTION_SIGNATURE_INITIALIZE_INPUT_STRUCT_VS,_e.VERTEX),e.addFunctionLines(r,o)}function Xze(e,t){let n=Ks.STRUCT_ID_ATTRIBUTES_FS;e.addStruct(n,Ks.STRUCT_NAME_ATTRIBUTES,_e.FRAGMENT);let{attributeFields:i,initializationLines:o}=t;for(let s=0;s<i.length;s++){let[a,l]=i[s];e.addStructField(n,a,l)}n=Ks.STRUCT_ID_FRAGMENT_INPUT,e.addStruct(n,Ks.STRUCT_NAME_FRAGMENT_INPUT,_e.FRAGMENT),e.addStructField(n,Ks.STRUCT_NAME_ATTRIBUTES,"attributes"),e.addStructField(n,RT.STRUCT_NAME_FEATURE_IDS,"featureIds"),e.addStructField(n,bh.STRUCT_NAME_METADATA,"metadata"),e.addStructField(n,bh.STRUCT_NAME_METADATA_CLASS,"metadataClass"),e.addStructField(n,bh.STRUCT_NAME_METADATA_STATISTICS,"metadataStatistics");let r=Ks.FUNCTION_ID_INITIALIZE_INPUT_STRUCT_FS;e.addFunction(r,Ks.FUNCTION_SIGNATURE_INITIALIZE_INPUT_STRUCT_FS,_e.FRAGMENT),e.addFunctionLines(r,o)}var Kze=[];function $ze(e,t,n){let{vertexLines:i,fragmentLines:o}=n,r=Kze;i.enabled&&(Yze(e,i),r.length=0,r.push("#line 0",t.vertexShaderText,E8),e.addVertexLines(r)),o.enabled&&(Xze(e,o),r.length=0,r.push("#line 0",t.fragmentShaderText,S8),e.addFragmentLines(r))}var I8=Ks;var mw={name:"DequantizationPipelineStage",FUNCTION_ID_DEQUANTIZATION_STAGE_VS:"dequantizationStage",FUNCTION_SIGNATURE_DEQUANTIZATION_STAGE_VS:"void dequantizationStage(inout ProcessedAttributes attributes)"};mw.process=function(e,t,n){let i=e.shaderBuilder,o=e.model,r=c(o.classificationType);i.addDefine("USE_DEQUANTIZATION",void 0,_e.VERTEX),i.addFunction(mw.FUNCTION_ID_DEQUANTIZATION_STAGE_VS,mw.FUNCTION_SIGNATURE_DEQUANTIZATION_STAGE_VS,_e.VERTEX);let s=t.attributes;for(let a=0;a<s.length;a++){let l=s[a],u=l.quantization;if(!c(u))continue;let f=l.semantic===Ct.POSITION,d=l.semantic===Ct.TEXCOORD;if(r&&!f&&!d)continue;let p=Zt.getAttributeInfo(l);Jze(i,p),Zze(e,p)}};function Zze(e,t){let n=e.shaderBuilder,i=e.uniformMap,o=t.variableName,r=t.attribute.quantization;if(r.octEncoded){let s=`model_normalizationRange_${o}`;n.addUniform("float",s,_e.VERTEX),i[s]=function(){return r.normalizationRange}}else{let s=`model_quantizedVolumeOffset_${o}`,a=`model_quantizedVolumeStepSize_${o}`,l=t.glslType;n.addUniform(l,s,_e.VERTEX),n.addUniform(l,a,_e.VERTEX);let u=r.quantizedVolumeOffset,f=r.quantizedVolumeStepSize;/^color_\d+$/.test(o)&&(u=xre(u,0),f=xre(f,1)),i[s]=function(){return u},i[a]=function(){return f}}}function xre(e,t){return e instanceof se?e:new se(e.x,e.y,e.z,t)}function Jze(e,t){let n=t.variableName,i=t.attribute.quantization,o;i.octEncoded?o=Qze(n,i):o=e4e(n),e.addFunctionLines(mw.FUNCTION_ID_DEQUANTIZATION_STAGE_VS,[o])}function Qze(e,t){let n=`attributes.${e}`,i=`a_quantized_${e}`,o=`model_normalizationRange_${e}`,r=t.octEncodedZXY?".zxy":".xyz";return`${n} = czm_octDecode(${i}, ${o})${r};`}function e4e(e){let t=`attributes.${e}`,n=`a_quantized_${e}`,i=`model_quantizedVolumeOffset_${e}`,o=`model_quantizedVolumeStepSize_${e}`;return`${t} = ${i} + ${n} * ${o};`}var O8=mw;var R8=`void geometryStage(out ProcessedAttributes attributes)
{
attributes.positionMC = v_positionMC;
attributes.positionEC = v_positionEC;
#if defined(COMPUTE_POSITION_WC_CUSTOM_SHADER) || defined(COMPUTE_POSITION_WC_STYLE) || defined(COMPUTE_POSITION_WC_ATMOSPHERE)
attributes.positionWC = v_positionWC;
#endif
#ifdef HAS_NORMALS
attributes.normalEC = normalize(v_normalEC);
#endif
#ifdef HAS_TANGENTS
attributes.tangentEC = normalize(v_tangentEC);
#endif
#ifdef HAS_BITANGENTS
attributes.bitangentEC = normalize(v_bitangentEC);
#endif
setDynamicVaryings(attributes);
}
`;var M8=`vec4 geometryStage(inout ProcessedAttributes attributes, mat4 modelView, mat3 normal)
{
vec4 computedPosition;
vec3 positionMC = attributes.positionMC;
v_positionMC = positionMC;
v_positionEC = (modelView * vec4(positionMC, 1.0)).xyz;
#if defined(USE_2D_POSITIONS) || defined(USE_2D_INSTANCING)
vec3 position2D = attributes.position2D;
vec3 positionEC = (u_modelView2D * vec4(position2D, 1.0)).xyz;
computedPosition = czm_projection * vec4(positionEC, 1.0);
#else
computedPosition = czm_projection * vec4(v_positionEC, 1.0);
#endif
#if defined(COMPUTE_POSITION_WC_CUSTOM_SHADER) || defined(COMPUTE_POSITION_WC_STYLE) || defined(COMPUTE_POSITION_WC_ATMOSPHERE) || defined(ENABLE_CLIPPING_POLYGONS)
v_positionWC = (czm_model * vec4(positionMC, 1.0)).xyz;
#endif
#ifdef HAS_NORMALS
v_normalEC = normalize(normal * attributes.normalMC);
#endif
#ifdef HAS_TANGENTS
v_tangentEC = normalize(normal * attributes.tangentMC);
#endif
#ifdef HAS_BITANGENTS
v_bitangentEC = normalize(normal * attributes.bitangentMC);
#endif
setDynamicVaryings(attributes);
return computedPosition;
}
`;var u1=`vec2 computeSt(float featureId)
{
float stepX = model_textureStep.x;
float centerX = model_textureStep.y;
#ifdef MULTILINE_BATCH_TEXTURE
float stepY = model_textureStep.z;
float centerY = model_textureStep.w;
float xId = mod(featureId, model_textureDimensions.x);
float yId = floor(featureId / model_textureDimensions.x);
return vec2(centerX + (xId * stepX), centerY + (yId * stepY));
#else
return vec2(centerX + (featureId * stepX), 0.5);
#endif
}
void selectedFeatureIdStage(out SelectedFeature feature, FeatureIds featureIds)
{
int featureId = featureIds.SELECTED_FEATURE_ID;
if (featureId < model_featuresLength)
{
vec2 featureSt = computeSt(float(featureId));
feature.id = featureId;
feature.st = featureSt;
feature.color = texture(model_batchTexture, featureSt);
}
else
{
feature.id = model_featuresLength + 1;
feature.st = vec2(0.0);
feature.color = vec4(1.0);
}
#ifdef HAS_NULL_FEATURE_ID
if (featureId == model_nullFeatureId) {
feature.id = featureId;
feature.st = vec2(0.0);
feature.color = vec4(1.0);
}
#endif
}
`;var pw={name:"SelectedFeatureIdPipelineStage",STRUCT_ID_SELECTED_FEATURE:"SelectedFeature",STRUCT_NAME_SELECTED_FEATURE:"SelectedFeature"};pw.process=function(e,t,n){let i=e.shaderBuilder;e.hasPropertyTable=!0;let o=e.model,r=e.runtimeNode.node,s=t4e(o,r,t),a=s.shaderDestination;i.addDefine("HAS_SELECTED_FEATURE_ID",void 0,a),i.addDefine("SELECTED_FEATURE_ID",s.variableName,a),i.addDefine(s.featureIdDefine,void 0,a),n4e(i);let l=s.featureIds.nullFeatureId,u=e.uniformMap;c(l)&&(i.addDefine("HAS_NULL_FEATURE_ID",void 0,a),i.addUniform("int","model_nullFeatureId",a),u.model_nullFeatureId=function(){return l}),s.shaderDestination===_e.BOTH&&i.addVertexLines(u1),i.addFragmentLines(u1)};function Tre(e){return e instanceof Sn.FeatureIdTexture?"HAS_SELECTED_FEATURE_ID_TEXTURE":"HAS_SELECTED_FEATURE_ID_ATTRIBUTE"}function Are(e){return e instanceof Sn.FeatureIdTexture?_e.FRAGMENT:_e.BOTH}function t4e(e,t,n){let i,o;return c(t.instances)&&(o=Zt.getFeatureIdsByLabel(t.instances.featureIds,e.instanceFeatureIdLabel),c(o))?(i=y(o.label,o.positionalLabel),{featureIds:o,variableName:i,shaderDestination:Are(o),featureIdDefine:Tre(o)}):(o=Zt.getFeatureIdsByLabel(n.featureIds,e.featureIdLabel),i=y(o.label,o.positionalLabel),{featureIds:o,variableName:i,shaderDestination:Are(o),featureIdDefine:Tre(o)})}function n4e(e){e.addStructField(pw.STRUCT_ID_SELECTED_FEATURE,"int","id"),e.addStructField(pw.STRUCT_ID_SELECTED_FEATURE,"vec2","st"),e.addStructField(pw.STRUCT_ID_SELECTED_FEATURE,"vec4","color")}var LT=pw;var Ls={name:"GeometryPipelineStage",STRUCT_ID_PROCESSED_ATTRIBUTES_VS:"ProcessedAttributesVS",STRUCT_ID_PROCESSED_ATTRIBUTES_FS:"ProcessedAttributesFS",STRUCT_NAME_PROCESSED_ATTRIBUTES:"ProcessedAttributes",FUNCTION_ID_INITIALIZE_ATTRIBUTES:"initializeAttributes",FUNCTION_SIGNATURE_INITIALIZE_ATTRIBUTES:"void initializeAttributes(out ProcessedAttributes attributes)",FUNCTION_ID_SET_DYNAMIC_VARYINGS_VS:"setDynamicVaryingsVS",FUNCTION_ID_SET_DYNAMIC_VARYINGS_FS:"setDynamicVaryingsFS",FUNCTION_SIGNATURE_SET_DYNAMIC_VARYINGS:"void setDynamicVaryings(inout ProcessedAttributes attributes)"};Ls.process=function(e,t,n){let{shaderBuilder:i,model:o}=e;i.addStruct(Ls.STRUCT_ID_PROCESSED_ATTRIBUTES_VS,"ProcessedAttributes",_e.VERTEX),i.addStruct(Ls.STRUCT_ID_PROCESSED_ATTRIBUTES_FS,"ProcessedAttributes",_e.FRAGMENT),i.addStruct(LT.STRUCT_ID_SELECTED_FEATURE,LT.STRUCT_NAME_SELECTED_FEATURE,_e.BOTH),i.addFunction(Ls.FUNCTION_ID_INITIALIZE_ATTRIBUTES,Ls.FUNCTION_SIGNATURE_INITIALIZE_ATTRIBUTES,_e.VERTEX),i.addVarying("vec3","v_positionWC"),i.addVarying("vec3","v_positionEC"),i.addStructField(Ls.STRUCT_ID_PROCESSED_ATTRIBUTES_FS,"vec3","positionWC"),i.addStructField(Ls.STRUCT_ID_PROCESSED_ATTRIBUTES_FS,"vec3","positionEC"),i.addFunction(Ls.FUNCTION_ID_SET_DYNAMIC_VARYINGS_VS,Ls.FUNCTION_SIGNATURE_SET_DYNAMIC_VARYINGS,_e.VERTEX),i.addFunction(Ls.FUNCTION_ID_SET_DYNAMIC_VARYINGS_FS,Ls.FUNCTION_SIGNATURE_SET_DYNAMIC_VARYINGS,_e.FRAGMENT),o.type===Rr.TILE_PNTS&&i.addDefine("HAS_SRGB_COLOR",void 0,_e.FRAGMENT);let r=n.mode!==oe.SCENE3D&&!n.scene3DOnly&&o._projectTo2D,s=c(e.runtimeNode.node.instances),a=r&&!s,l=t.attributes.length;for(let u=0;u<l;u++){let f=t.attributes[u],d=cn.getAttributeLocationCount(f.type);if(!c(f.buffer)&&!c(f.constant))throw new E("Attributes must be provided as a Buffer or constant value");let p=f.semantic===Ct.POSITION,g;d>1?(g=e.attributeIndex,e.attributeIndex+=d):p&&!a?g=0:g=e.attributeIndex++,i4e(e,f,g,d,r,s)}d4e(i,t.attributes),t.primitiveType===Me.POINTS&&i.addDefine("PRIMITIVE_TYPE_POINTS"),i.addVertexLines(M8),i.addFragmentLines(R8)};function i4e(e,t,n,i,o,r){let s=e.shaderBuilder,a=Zt.getAttributeInfo(t),l=o&&!r;i>1?s4e(e,t,n,i):r4e(e,t,n,l),c4e(s,a,l),a4e(s,a),c(t.semantic)&&o4e(s,t),l4e(s,a,o),u4e(s,a,l),f4e(s,a)}function o4e(e,t){let{semantic:n,setIndex:i}=t;switch(n){case Ct.NORMAL:e.addDefine("HAS_NORMALS");break;case Ct.TANGENT:e.addDefine("HAS_TANGENTS");break;case Ct.FEATURE_ID:e.addDefine(`HAS${n}_${i}`);break;case Ct.TEXCOORD:case Ct.COLOR:e.addDefine(`HAS_${n}_${i}`)}}function r4e(e,t,n,i){let{quantization:o,semantic:r,setIndex:s}=t,{type:a,componentDatatype:l}=c(o)?o:t;r===Ct.FEATURE_ID&&s>=e.featureIdVertexAttributeSetIndex&&(e.featureIdVertexAttributeSetIndex=s+1);let u=r===Ct.POSITION,f=u?0:n,d=cn.getNumberOfComponents(a),p={index:f,value:c(t.buffer)?void 0:t.constant,vertexBuffer:t.buffer,count:t.count,componentsPerAttribute:d,componentDatatype:l,offsetInBytes:t.byteOffset,strideInBytes:t.byteStride,normalize:t.normalized};if(e.attributes.push(p),!u||!i)return;let g=e.runtimePrimitive.positionBuffer2D,m={index:n,vertexBuffer:g,count:t.count,componentsPerAttribute:d,componentDatatype:$.FLOAT,offsetInBytes:0,strideInBytes:void 0,normalize:t.normalized};e.attributes.push(m)}function s4e(e,t,n,i){let{quantization:o,normalized:r}=t,{type:s,componentDatatype:a}=c(o)?o:t,u=cn.getNumberOfComponents(s)/i,f=$.getSizeInBytes(a),d=u*f,p=t.byteStride;for(let g=0;g<i;g++){let m=t.byteOffset+g*d,b={index:n+g,vertexBuffer:t.buffer,componentsPerAttribute:u,componentDatatype:a,offsetInBytes:m,strideInBytes:p,normalize:r};e.attributes.push(b)}}function a4e(e,t){let n=t.variableName,i=`v_${n}`,o;n==="normalMC"?(i="v_normalEC",o=t.glslType):n==="tangentMC"?(o="vec3",i="v_tangentEC"):o=t.glslType,e.addVarying(o,i)}function c4e(e,t,n){let i=t.attribute.semantic,o=t.variableName,r,s;t.isQuantized?(r=`a_quantized_${o}`,s=t.quantizedGlslType):(r=`a_${o}`,s=t.glslType);let a=i===Ct.POSITION;a?e.setPositionAttribute(s,r):e.addAttribute(s,r),a&&n&&e.addAttribute("vec3","a_position2D")}function l4e(e,t,n){let i=Ls.STRUCT_ID_PROCESSED_ATTRIBUTES_VS,o=Ls.STRUCT_ID_PROCESSED_ATTRIBUTES_FS,{variableName:r,glslType:s}=t;r==="tangentMC"?(e.addStructField(i,"vec3","tangentMC"),e.addStructField(i,"float","tangentSignMC"),e.addStructField(o,"vec3","tangentEC")):r==="normalMC"?(e.addStructField(i,"vec3","normalMC"),e.addStructField(o,"vec3","normalEC")):(e.addStructField(i,s,r),e.addStructField(o,s,r)),r==="positionMC"&&n&&e.addStructField(i,"vec3","position2D")}function u4e(e,t,n){let i=Ls.FUNCTION_ID_INITIALIZE_ATTRIBUTES,o=t.variableName;if(o==="positionMC"&&n&&e.addFunctionLines(i,["attributes.position2D = a_position2D;"]),t.isQuantized)return;let s=[];o==="tangentMC"?(s.push("attributes.tangentMC = a_tangentMC.xyz;"),s.push("attributes.tangentSignMC = a_tangentMC.w;")):s.push(`attributes.${o} = a_${o};`),e.addFunctionLines(i,s)}function f4e(e,t){let{semantic:n,setIndex:i}=t.attribute;if(c(n)&&!c(i))return;let o=Ls.FUNCTION_ID_SET_DYNAMIC_VARYINGS_VS,r=t.variableName,s=`v_${r} = attributes.${r};`;e.addFunctionLines(o,[s]),o=Ls.FUNCTION_ID_SET_DYNAMIC_VARYINGS_FS,s=`attributes.${r} = v_${r};`,e.addFunctionLines(o,[s])}function d4e(e,t){let n=!1,i=!1;for(let o=0;o<t.length;o++){let r=t[o];r.semantic===Ct.NORMAL?n=!0:r.semantic===Ct.TANGENT&&(i=!0)}!n||!i||(e.addDefine("HAS_BITANGENTS"),e.addVarying("vec3","v_bitangentEC"),e.addStructField(Ls.STRUCT_ID_PROCESSED_ATTRIBUTES_VS,"vec3","bitangentMC"),e.addStructField(Ls.STRUCT_ID_PROCESSED_ATTRIBUTES_FS,"vec3","bitangentEC"))}var L8=Ls;var N8=`#ifdef USE_IBL_LIGHTING
vec3 computeIBL(vec3 position, vec3 normal, vec3 lightDirection, vec3 lightColorHdr, czm_modelMaterial material)
{
#if defined(DIFFUSE_IBL) || defined(SPECULAR_IBL)
vec3 viewDirection = -normalize(position);
vec3 iblColor = textureIBL(viewDirection, normal, material);
return iblColor;
#endif
return vec3(0.0);
}
#endif
#ifdef USE_CLEARCOAT
vec3 addClearcoatReflection(vec3 baseLayerColor, vec3 position, vec3 lightDirection, vec3 lightColorHdr, czm_modelMaterial material)
{
vec3 viewDirection = -normalize(position);
vec3 halfwayDirection = normalize(viewDirection + lightDirection);
vec3 normal = material.clearcoatNormal;
float NdotL = clamp(dot(normal, lightDirection), 0.001, 1.0);
vec3 f0 = vec3(0.04);
vec3 f90 = vec3(1.0);
float NdotV = clamp(dot(normal, viewDirection), 0.0, 1.0);
vec3 F = fresnelSchlick2(f0, f90, NdotV);
float roughness = material.clearcoatRoughness;
float alphaRoughness = roughness * roughness;
float directStrength = computeDirectSpecularStrength(normal, lightDirection, viewDirection, halfwayDirection, alphaRoughness);
vec3 directReflection = F * directStrength * NdotL;
vec3 color = lightColorHdr * directReflection;
#ifdef SPECULAR_IBL
vec3 reflectMC = normalize(model_iblReferenceFrameMatrix * reflect(-viewDirection, normal));
vec3 iblColor = computeSpecularIBL(reflectMC, NdotV, f0, roughness);
color += iblColor * material.occlusion;
#endif
float clearcoatFactor = material.clearcoatFactor;
vec3 clearcoatColor = color * clearcoatFactor;
return baseLayerColor * (1.0 - clearcoatFactor * F) + clearcoatColor;
}
#endif
#if defined(LIGHTING_PBR) && defined(HAS_NORMALS)
vec3 computePbrLighting(in czm_modelMaterial material, in vec3 position)
{
#ifdef USE_CUSTOM_LIGHT_COLOR
vec3 lightColorHdr = model_lightColorHdr;
#else
vec3 lightColorHdr = czm_lightColorHdr;
#endif
vec3 viewDirection = -normalize(position);
vec3 normal = material.normalEC;
vec3 lightDirection = normalize(czm_lightDirectionEC);
vec3 directLighting = czm_pbrLighting(viewDirection, normal, lightDirection, material);
vec3 directColor = lightColorHdr * directLighting;
vec3 color = directColor + material.emissive;
#ifdef USE_IBL_LIGHTING
color += computeIBL(position, normal, lightDirection, lightColorHdr, material);
#endif
#ifdef USE_CLEARCOAT
color = addClearcoatReflection(color, position, lightDirection, lightColorHdr, material);
#endif
return color;
}
#endif
void lightingStage(inout czm_modelMaterial material, ProcessedAttributes attributes)
{
#ifdef LIGHTING_PBR
#ifdef HAS_NORMALS
vec3 color = computePbrLighting(material, attributes.positionEC);
#else
vec3 color = material.diffuse * material.occlusion + material.emissive;
#endif
#ifndef HDR
color = czm_pbrNeutralTonemapping(color);
#endif
#else // unlit
vec3 color = material.diffuse;
#endif
#ifdef HAS_POINT_CLOUD_COLOR_STYLE
color = czm_gammaCorrect(color);
#elif !defined(HDR)
color = czm_linearToSrgb(color);
#endif
material.diffuse = color;
}
`;var h4e={UNLIT:0,PBR:1},ng=Object.freeze(h4e);var Cre={name:"LightingPipelineStage"};Cre.process=function(e,t){let{model:n,lightingOptions:i,shaderBuilder:o}=e;if(c(n.lightColor)){o.addDefine("USE_CUSTOM_LIGHT_COLOR",void 0,_e.FRAGMENT),o.addUniform("vec3","model_lightColorHdr",_e.FRAGMENT);let s=e.uniformMap;s.model_lightColorHdr=function(){return n.lightColor}}let{lightingModel:r}=i;r===ng.PBR?o.addDefine("LIGHTING_PBR",void 0,_e.FRAGMENT):o.addDefine("LIGHTING_UNLIT",void 0,_e.FRAGMENT),o.addFragmentLines(N8)};var F8=Cre;var B8=`bool isDefaultStyleColor(vec3 color)
{
return all(greaterThan(color, vec3(1.0 - czm_epsilon3)));
}
vec3 blend(vec3 sourceColor, vec3 styleColor, float styleColorBlend)
{
vec3 blendColor = mix(sourceColor, styleColor, styleColorBlend);
vec3 color = isDefaultStyleColor(styleColor.rgb) ? sourceColor : blendColor;
return color;
}
vec2 computeTextureTransform(vec2 texCoord, mat3 textureTransform)
{
return vec2(textureTransform * vec3(texCoord, 1.0));
}
#ifdef HAS_NORMAL_TEXTURE
vec2 getNormalTexCoords()
{
vec2 texCoord = TEXCOORD_NORMAL;
#ifdef HAS_NORMAL_TEXTURE_TRANSFORM
texCoord = vec2(u_normalTextureTransform * vec3(texCoord, 1.0));
#endif
return texCoord;
}
#endif
#if defined(HAS_NORMAL_TEXTURE) || defined(HAS_CLEARCOAT_NORMAL_TEXTURE)
vec3 computeTangent(in vec3 position, in vec2 normalTexCoords)
{
vec2 tex_dx = dFdx(normalTexCoords);
vec2 tex_dy = dFdy(normalTexCoords);
float determinant = tex_dx.x * tex_dy.y - tex_dy.x * tex_dx.y;
vec3 tangent = tex_dy.t * dFdx(position) - tex_dx.t * dFdy(position);
return tangent / determinant;
}
#endif
#ifdef USE_ANISOTROPY
struct NormalInfo {
vec3 tangent;
vec3 bitangent;
vec3 normal;
vec3 geometryNormal;
};
NormalInfo getNormalInfo(ProcessedAttributes attributes)
{
vec3 geometryNormal = attributes.normalEC;
#ifdef HAS_NORMAL_TEXTURE
vec2 normalTexCoords = getNormalTexCoords();
#endif
#ifdef HAS_BITANGENTS
vec3 tangent = attributes.tangentEC;
vec3 bitangent = attributes.bitangentEC;
#else // Assume HAS_NORMAL_TEXTURE
vec3 tangent = computeTangent(attributes.positionEC, normalTexCoords);
tangent = normalize(tangent - geometryNormal * dot(geometryNormal, tangent));
vec3 bitangent = normalize(cross(geometryNormal, tangent));
#endif
#ifdef HAS_NORMAL_TEXTURE
mat3 tbn = mat3(tangent, bitangent, geometryNormal);
vec3 normalSample = texture(u_normalTexture, normalTexCoords).rgb;
normalSample = 2.0 * normalSample - 1.0;
#ifdef HAS_NORMAL_TEXTURE_SCALE
normalSample.xy *= u_normalTextureScale;
#endif
vec3 normal = normalize(tbn * normalSample);
#else
vec3 normal = geometryNormal;
#endif
#ifdef HAS_DOUBLE_SIDED_MATERIAL
if (czm_backFacing()) {
tangent *= -1.0;
bitangent *= -1.0;
normal *= -1.0;
geometryNormal *= -1.0;
}
#endif
NormalInfo normalInfo;
normalInfo.tangent = tangent;
normalInfo.bitangent = bitangent;
normalInfo.normal = normal;
normalInfo.geometryNormal = geometryNormal;
return normalInfo;
}
#endif
#if defined(HAS_NORMAL_TEXTURE) && !defined(HAS_WIREFRAME)
vec3 getNormalFromTexture(ProcessedAttributes attributes, vec3 geometryNormal)
{
vec2 normalTexCoords = getNormalTexCoords();
#ifdef HAS_BITANGENTS
vec3 t = attributes.tangentEC;
vec3 b = attributes.bitangentEC;
#else
vec3 t = computeTangent(attributes.positionEC, normalTexCoords);
t = normalize(t - geometryNormal * dot(geometryNormal, t));
vec3 b = normalize(cross(geometryNormal, t));
#endif
mat3 tbn = mat3(t, b, geometryNormal);
vec3 normalSample = texture(u_normalTexture, normalTexCoords).rgb;
normalSample = 2.0 * normalSample - 1.0;
#ifdef HAS_NORMAL_TEXTURE_SCALE
normalSample.xy *= u_normalTextureScale;
#endif
return normalize(tbn * normalSample);
}
#endif
#ifdef HAS_CLEARCOAT_NORMAL_TEXTURE
vec3 getClearcoatNormalFromTexture(ProcessedAttributes attributes, vec3 geometryNormal)
{
vec2 normalTexCoords = TEXCOORD_CLEARCOAT_NORMAL;
#ifdef HAS_CLEARCOAT_NORMAL_TEXTURE_TRANSFORM
normalTexCoords = vec2(u_clearcoatNormalTextureTransform * vec3(normalTexCoords, 1.0));
#endif
#ifdef HAS_BITANGENTS
vec3 t = attributes.tangentEC;
vec3 b = attributes.bitangentEC;
#else
vec3 t = computeTangent(attributes.positionEC, normalTexCoords);
t = normalize(t - geometryNormal * dot(geometryNormal, t));
vec3 b = normalize(cross(geometryNormal, t));
#endif
mat3 tbn = mat3(t, b, geometryNormal);
vec3 normalSample = texture(u_clearcoatNormalTexture, normalTexCoords).rgb;
normalSample = 2.0 * normalSample - 1.0;
#ifdef HAS_CLEARCOAT_NORMAL_TEXTURE_SCALE
normalSample.xy *= u_clearcoatNormalTextureScale;
#endif
return normalize(tbn * normalSample);
}
#endif
#ifdef HAS_NORMALS
vec3 computeNormal(ProcessedAttributes attributes)
{
vec3 normal = attributes.normalEC;
#if defined(HAS_NORMAL_TEXTURE) && !defined(HAS_WIREFRAME)
normal = getNormalFromTexture(attributes, normal);
#endif
#ifdef HAS_DOUBLE_SIDED_MATERIAL
if (czm_backFacing()) {
normal = -normal;
}
#endif
return normal;
}
#endif
#ifdef HAS_BASE_COLOR_TEXTURE
vec4 getBaseColorFromTexture()
{
vec2 baseColorTexCoords = TEXCOORD_BASE_COLOR;
#ifdef HAS_BASE_COLOR_TEXTURE_TRANSFORM
baseColorTexCoords = computeTextureTransform(baseColorTexCoords, u_baseColorTextureTransform);
#endif
vec4 baseColorWithAlpha = czm_srgbToLinear(texture(u_baseColorTexture, baseColorTexCoords));
#ifdef HAS_BASE_COLOR_FACTOR
baseColorWithAlpha *= u_baseColorFactor;
#endif
return baseColorWithAlpha;
}
#endif
#ifdef HAS_EMISSIVE_TEXTURE
vec3 getEmissiveFromTexture()
{
vec2 emissiveTexCoords = TEXCOORD_EMISSIVE;
#ifdef HAS_EMISSIVE_TEXTURE_TRANSFORM
emissiveTexCoords = computeTextureTransform(emissiveTexCoords, u_emissiveTextureTransform);
#endif
vec3 emissive = czm_srgbToLinear(texture(u_emissiveTexture, emissiveTexCoords).rgb);
#ifdef HAS_EMISSIVE_FACTOR
emissive *= u_emissiveFactor;
#endif
return emissive;
}
#endif
#if defined(LIGHTING_PBR) && defined(USE_SPECULAR_GLOSSINESS)
void setSpecularGlossiness(inout czm_modelMaterial material)
{
#ifdef HAS_SPECULAR_GLOSSINESS_TEXTURE
vec2 specularGlossinessTexCoords = TEXCOORD_SPECULAR_GLOSSINESS;
#ifdef HAS_SPECULAR_GLOSSINESS_TEXTURE_TRANSFORM
specularGlossinessTexCoords = computeTextureTransform(specularGlossinessTexCoords, u_specularGlossinessTextureTransform);
#endif
vec4 specularGlossiness = czm_srgbToLinear(texture(u_specularGlossinessTexture, specularGlossinessTexCoords));
vec3 specular = specularGlossiness.rgb;
float glossiness = specularGlossiness.a;
#ifdef HAS_LEGACY_SPECULAR_FACTOR
specular *= u_legacySpecularFactor;
#endif
#ifdef HAS_GLOSSINESS_FACTOR
glossiness *= u_glossinessFactor;
#endif
#else
#ifdef HAS_LEGACY_SPECULAR_FACTOR
vec3 specular = clamp(u_legacySpecularFactor, vec3(0.0), vec3(1.0));
#else
vec3 specular = vec3(1.0);
#endif
#ifdef HAS_GLOSSINESS_FACTOR
float glossiness = clamp(u_glossinessFactor, 0.0, 1.0);
#else
float glossiness = 1.0;
#endif
#endif
#ifdef HAS_DIFFUSE_TEXTURE
vec2 diffuseTexCoords = TEXCOORD_DIFFUSE;
#ifdef HAS_DIFFUSE_TEXTURE_TRANSFORM
diffuseTexCoords = computeTextureTransform(diffuseTexCoords, u_diffuseTextureTransform);
#endif
vec4 diffuse = czm_srgbToLinear(texture(u_diffuseTexture, diffuseTexCoords));
#ifdef HAS_DIFFUSE_FACTOR
diffuse *= u_diffuseFactor;
#endif
#elif defined(HAS_DIFFUSE_FACTOR)
vec4 diffuse = clamp(u_diffuseFactor, vec4(0.0), vec4(1.0));
#else
vec4 diffuse = vec4(1.0);
#endif
material.diffuse = diffuse.rgb * (1.0 - czm_maximumComponent(specular));
material.alpha = diffuse.a;
material.specular = specular;
material.roughness = 1.0 - glossiness;
}
#elif defined(LIGHTING_PBR)
float setMetallicRoughness(inout czm_modelMaterial material)
{
#ifdef HAS_METALLIC_ROUGHNESS_TEXTURE
vec2 metallicRoughnessTexCoords = TEXCOORD_METALLIC_ROUGHNESS;
#ifdef HAS_METALLIC_ROUGHNESS_TEXTURE_TRANSFORM
metallicRoughnessTexCoords = computeTextureTransform(metallicRoughnessTexCoords, u_metallicRoughnessTextureTransform);
#endif
vec3 metallicRoughness = texture(u_metallicRoughnessTexture, metallicRoughnessTexCoords).rgb;
float metalness = clamp(metallicRoughness.b, 0.0, 1.0);
float roughness = clamp(metallicRoughness.g, 0.0, 1.0);
#ifdef HAS_METALLIC_FACTOR
metalness = clamp(metalness * u_metallicFactor, 0.0, 1.0);
#endif
#ifdef HAS_ROUGHNESS_FACTOR
roughness = clamp(roughness * u_roughnessFactor, 0.0, 1.0);
#endif
#else
#ifdef HAS_METALLIC_FACTOR
float metalness = clamp(u_metallicFactor, 0.0, 1.0);
#else
float metalness = 1.0;
#endif
#ifdef HAS_ROUGHNESS_FACTOR
float roughness = clamp(u_roughnessFactor, 0.0, 1.0);
#else
float roughness = 1.0;
#endif
#endif
const vec3 REFLECTANCE_DIELECTRIC = vec3(0.04);
vec3 f0 = mix(REFLECTANCE_DIELECTRIC, material.baseColor.rgb, metalness);
material.specular = f0;
material.diffuse = mix(material.baseColor.rgb, vec3(0.0), metalness);
material.roughness = roughness;
return metalness;
}
#ifdef USE_SPECULAR
void setSpecular(inout czm_modelMaterial material, in float metalness)
{
#ifdef HAS_SPECULAR_TEXTURE
vec2 specularTexCoords = TEXCOORD_SPECULAR;
#ifdef HAS_SPECULAR_TEXTURE_TRANSFORM
specularTexCoords = computeTextureTransform(specularTexCoords, u_specularTextureTransform);
#endif
float specularWeight = texture(u_specularTexture, specularTexCoords).a;
#ifdef HAS_SPECULAR_FACTOR
specularWeight *= u_specularFactor;
#endif
#else
#ifdef HAS_SPECULAR_FACTOR
float specularWeight = u_specularFactor;
#else
float specularWeight = 1.0;
#endif
#endif
#ifdef HAS_SPECULAR_COLOR_TEXTURE
vec2 specularColorTexCoords = TEXCOORD_SPECULAR_COLOR;
#ifdef HAS_SPECULAR_COLOR_TEXTURE_TRANSFORM
specularColorTexCoords = computeTextureTransform(specularColorTexCoords, u_specularColorTextureTransform);
#endif
vec3 specularColorSample = texture(u_specularColorTexture, specularColorTexCoords).rgb;
vec3 specularColorFactor = czm_srgbToLinear(specularColorSample);
#ifdef HAS_SPECULAR_COLOR_FACTOR
specularColorFactor *= u_specularColorFactor;
#endif
#else
#ifdef HAS_SPECULAR_COLOR_FACTOR
vec3 specularColorFactor = u_specularColorFactor;
#else
vec3 specularColorFactor = vec3(1.0);
#endif
#endif
material.specularWeight = specularWeight;
vec3 f0 = material.specular;
vec3 dielectricSpecularF0 = min(f0 * specularColorFactor, vec3(1.0));
material.specular = mix(dielectricSpecularF0, material.baseColor.rgb, metalness);
}
#endif
#ifdef USE_ANISOTROPY
void setAnisotropy(inout czm_modelMaterial material, in NormalInfo normalInfo)
{
mat2 rotation = mat2(u_anisotropy.xy, -u_anisotropy.y, u_anisotropy.x);
float anisotropyStrength = u_anisotropy.z;
vec2 direction = vec2(1.0, 0.0);
#ifdef HAS_ANISOTROPY_TEXTURE
vec2 anisotropyTexCoords = TEXCOORD_ANISOTROPY;
#ifdef HAS_ANISOTROPY_TEXTURE_TRANSFORM
anisotropyTexCoords = computeTextureTransform(anisotropyTexCoords, u_anisotropyTextureTransform);
#endif
vec3 anisotropySample = texture(u_anisotropyTexture, anisotropyTexCoords).rgb;
direction = anisotropySample.rg * 2.0 - vec2(1.0);
anisotropyStrength *= anisotropySample.b;
#endif
direction = rotation * direction;
mat3 tbn = mat3(normalInfo.tangent, normalInfo.bitangent, normalInfo.normal);
vec3 anisotropicT = tbn * normalize(vec3(direction, 0.0));
vec3 anisotropicB = cross(normalInfo.geometryNormal, anisotropicT);
material.anisotropicT = anisotropicT;
material.anisotropicB = anisotropicB;
material.anisotropyStrength = anisotropyStrength;
}
#endif
#ifdef USE_CLEARCOAT
void setClearcoat(inout czm_modelMaterial material, in ProcessedAttributes attributes)
{
#ifdef HAS_CLEARCOAT_TEXTURE
vec2 clearcoatTexCoords = TEXCOORD_CLEARCOAT;
#ifdef HAS_CLEARCOAT_TEXTURE_TRANSFORM
clearcoatTexCoords = computeTextureTransform(clearcoatTexCoords, u_clearcoatTextureTransform);
#endif
float clearcoatFactor = texture(u_clearcoatTexture, clearcoatTexCoords).r;
#ifdef HAS_CLEARCOAT_FACTOR
clearcoatFactor *= u_clearcoatFactor;
#endif
#else
#ifdef HAS_CLEARCOAT_FACTOR
float clearcoatFactor = u_clearcoatFactor;
#else
float clearcoatFactor = 0.0;
#endif
#endif
#ifdef HAS_CLEARCOAT_ROUGHNESS_TEXTURE
vec2 clearcoatRoughnessTexCoords = TEXCOORD_CLEARCOAT_ROUGHNESS;
#ifdef HAS_CLEARCOAT_ROUGHNESS_TEXTURE_TRANSFORM
clearcoatRoughnessTexCoords = computeTextureTransform(clearcoatRoughnessTexCoords, u_clearcoatRoughnessTextureTransform);
#endif
float clearcoatRoughness = texture(u_clearcoatRoughnessTexture, clearcoatRoughnessTexCoords).g;
#ifdef HAS_CLEARCOAT_ROUGHNESS_FACTOR
clearcoatRoughness *= u_clearcoatRoughnessFactor;
#endif
#else
#ifdef HAS_CLEARCOAT_ROUGHNESS_FACTOR
float clearcoatRoughness = u_clearcoatRoughnessFactor;
#else
float clearcoatRoughness = 0.0;
#endif
#endif
material.clearcoatFactor = clearcoatFactor;
material.clearcoatRoughness = clearcoatRoughness;
#ifdef HAS_CLEARCOAT_NORMAL_TEXTURE
material.clearcoatNormal = getClearcoatNormalFromTexture(attributes, attributes.normalEC);
#else
material.clearcoatNormal = attributes.normalEC;
#endif
}
#endif
#endif
void materialStage(inout czm_modelMaterial material, ProcessedAttributes attributes, SelectedFeature feature)
{
#ifdef USE_ANISOTROPY
NormalInfo normalInfo = getNormalInfo(attributes);
material.normalEC = normalInfo.normal;
#elif defined(HAS_NORMALS)
material.normalEC = computeNormal(attributes);
#endif
vec4 baseColorWithAlpha = vec4(1.0);
#ifdef HAS_BASE_COLOR_TEXTURE
baseColorWithAlpha = getBaseColorFromTexture();
#elif defined(HAS_BASE_COLOR_FACTOR)
baseColorWithAlpha = u_baseColorFactor;
#endif
#ifdef HAS_POINT_CLOUD_COLOR_STYLE
baseColorWithAlpha = v_pointCloudColor;
#elif defined(HAS_COLOR_0)
vec4 color = attributes.color_0;
#ifdef HAS_SRGB_COLOR
color = czm_srgbToLinear(color);
#endif
baseColorWithAlpha *= color;
#endif
#ifdef USE_CPU_STYLING
baseColorWithAlpha.rgb = blend(baseColorWithAlpha.rgb, feature.color.rgb, model_colorBlend);
#endif
material.baseColor = baseColorWithAlpha;
material.diffuse = baseColorWithAlpha.rgb;
material.alpha = baseColorWithAlpha.a;
#ifdef HAS_OCCLUSION_TEXTURE
vec2 occlusionTexCoords = TEXCOORD_OCCLUSION;
#ifdef HAS_OCCLUSION_TEXTURE_TRANSFORM
occlusionTexCoords = computeTextureTransform(occlusionTexCoords, u_occlusionTextureTransform);
#endif
material.occlusion = texture(u_occlusionTexture, occlusionTexCoords).r;
#endif
#ifdef HAS_EMISSIVE_TEXTURE
material.emissive = getEmissiveFromTexture();
#elif defined(HAS_EMISSIVE_FACTOR)
material.emissive = u_emissiveFactor;
#endif
#if defined(LIGHTING_PBR) && defined(USE_SPECULAR_GLOSSINESS)
setSpecularGlossiness(material);
#elif defined(LIGHTING_PBR)
float metalness = setMetallicRoughness(material);
#ifdef USE_SPECULAR
setSpecular(material, metalness);
#endif
#ifdef USE_ANISOTROPY
setAnisotropy(material, normalInfo);
#endif
#ifdef USE_CLEARCOAT
setClearcoat(material, attributes);
#endif
#endif
}
`;var{Material:m4e,MetallicRoughness:k8,SpecularGlossiness:V8,Specular:Ere,Clearcoat:Sre}=Sn,wre={name:"MaterialPipelineStage",_processTexture:ll,_processTextureTransform:vre};wre.process=function(e,t,n){let i=t.material,{model:o,uniformMap:r,shaderBuilder:s}=e,a=c(o.classificationType),l=a,{defaultTexture:u,defaultNormalTexture:f,defaultEmissiveTexture:d}=n.context;_4e(i,r,s,u,f,d,l),c(i.specularGlossiness)?g4e(i.specularGlossiness,r,s,u,l):(c(i.specular)&&Zt.supportedExtensions.KHR_materials_specular&&y4e(i.specular,r,s,u,l),c(i.anisotropy)&&Zt.supportedExtensions.KHR_materials_anisotropy&&x4e(i.anisotropy,r,s,u,l),c(i.clearcoat)&&Zt.supportedExtensions.KHR_materials_clearcoat&&T4e(i.clearcoat,r,s,u,l),A4e(i.metallicRoughness,r,s,u,l));let p=Zt.getAttributeBySemantic(t,Ct.NORMAL),g=e.lightingOptions;i.unlit||!p||a?g.lightingModel=ng.UNLIT:g.lightingModel=ng.PBR;let m=o.backFaceCulling&&!i.doubleSided;e.renderStateOptions.cull.enabled=m;let b=e.alphaOptions;i.alphaMode===H_.BLEND?b.pass=ve.TRANSLUCENT:i.alphaMode===H_.MASK&&(b.alphaCutoff=i.alphaCutoff),s.addFragmentLines(B8),i.doubleSided&&s.addDefine("HAS_DOUBLE_SIDED_MATERIAL",void 0,_e.BOTH)};function vre(e,t,n,i,o){let r=`HAS_${o}_TEXTURE_TRANSFORM`;e.addDefine(r,void 0,_e.FRAGMENT);let s=`${i}Transform`;e.addUniform("mat3",s,_e.FRAGMENT),t[s]=function(){return n.transform}}function p4e(e,t,n,i,o){let r=`HAS_${o}_TEXTURE_SCALE`;e.addDefine(r,void 0,_e.FRAGMENT);let s=`${i}Scale`;e.addUniform("float",s,_e.FRAGMENT),t[s]=function(){return n.scale}}function ll(e,t,n,i,o,r){e.addUniform("sampler2D",i,_e.FRAGMENT),t[i]=function(){return y(n.texture,r)};let s=`HAS_${o}_TEXTURE`;e.addDefine(s,void 0,_e.FRAGMENT);let l=`v_texCoord_${n.texCoord}`,u=`TEXCOORD_${o}`;e.addDefine(u,l,_e.FRAGMENT);let f=n.transform;c(f)&&!Q.equals(f,Q.IDENTITY)&&vre(e,t,n,i,o);let{scale:d}=n;c(d)&&d!==1&&p4e(e,t,n,i,o)}function _4e(e,t,n,i,o,r,s){let{emissiveFactor:a,emissiveTexture:l,normalTexture:u,occlusionTexture:f}=e;c(a)&&!h.equals(a,m4e.DEFAULT_EMISSIVE_FACTOR)&&(n.addUniform("vec3","u_emissiveFactor",_e.FRAGMENT),t.u_emissiveFactor=function(){return e.emissiveFactor},n.addDefine("HAS_EMISSIVE_FACTOR",void 0,_e.FRAGMENT),c(l)&&!s&&ll(n,t,l,"u_emissiveTexture","EMISSIVE",r)),c(u)&&!s&&ll(n,t,u,"u_normalTexture","NORMAL",o),c(f)&&!s&&ll(n,t,f,"u_occlusionTexture","OCCLUSION",i)}function g4e(e,t,n,i,o){let{diffuseTexture:r,diffuseFactor:s,specularGlossinessTexture:a,specularFactor:l,glossinessFactor:u}=e;n.addDefine("USE_SPECULAR_GLOSSINESS",void 0,_e.FRAGMENT),c(r)&&!o&&ll(n,t,r,"u_diffuseTexture","DIFFUSE",i),c(s)&&!se.equals(s,V8.DEFAULT_DIFFUSE_FACTOR)&&(n.addUniform("vec4","u_diffuseFactor",_e.FRAGMENT),t.u_diffuseFactor=function(){return e.diffuseFactor},n.addDefine("HAS_DIFFUSE_FACTOR",void 0,_e.FRAGMENT)),c(a)&&!o&&ll(n,t,a,"u_specularGlossinessTexture","SPECULAR_GLOSSINESS",i),c(l)&&!h.equals(l,V8.DEFAULT_SPECULAR_FACTOR)&&(n.addUniform("vec3","u_legacySpecularFactor",_e.FRAGMENT),t.u_legacySpecularFactor=function(){return e.specularFactor},n.addDefine("HAS_LEGACY_SPECULAR_FACTOR",void 0,_e.FRAGMENT)),c(u)&&u!==V8.DEFAULT_GLOSSINESS_FACTOR&&(n.addUniform("float","u_glossinessFactor",_e.FRAGMENT),t.u_glossinessFactor=function(){return e.glossinessFactor},n.addDefine("HAS_GLOSSINESS_FACTOR",void 0,_e.FRAGMENT))}function y4e(e,t,n,i,o){let{specularTexture:r,specularFactor:s,specularColorTexture:a,specularColorFactor:l}=e;n.addDefine("USE_SPECULAR",void 0,_e.FRAGMENT),c(r)&&!o&&ll(n,t,r,"u_specularTexture","SPECULAR",i),c(s)&&s!==Ere.DEFAULT_SPECULAR_FACTOR&&(n.addUniform("float","u_specularFactor",_e.FRAGMENT),t.u_specularFactor=function(){return e.specularFactor},n.addDefine("HAS_SPECULAR_FACTOR",void 0,_e.FRAGMENT)),c(a)&&!o&&ll(n,t,a,"u_specularColorTexture","SPECULAR_COLOR",i),c(l)&&!h.equals(l,Ere.DEFAULT_SPECULAR_COLOR_FACTOR)&&(n.addUniform("vec3","u_specularColorFactor",_e.FRAGMENT),t.u_specularColorFactor=function(){return e.specularColorFactor},n.addDefine("HAS_SPECULAR_COLOR_FACTOR",void 0,_e.FRAGMENT))}var b4e=new h;function x4e(e,t,n,i,o){let{anisotropyStrength:r,anisotropyRotation:s,anisotropyTexture:a}=e;n.addDefine("USE_ANISOTROPY",void 0,_e.FRAGMENT),c(a)&&!o&&ll(n,t,a,"u_anisotropyTexture","ANISOTROPY",i);let l=Math.cos(s),u=Math.sin(s);n.addUniform("vec3","u_anisotropy",_e.FRAGMENT),t.u_anisotropy=function(){return h.fromElements(l,u,r,b4e)}}function T4e(e,t,n,i,o){let{clearcoatFactor:r,clearcoatTexture:s,clearcoatRoughnessFactor:a,clearcoatRoughnessTexture:l,clearcoatNormalTexture:u}=e;n.addDefine("USE_CLEARCOAT",void 0,_e.FRAGMENT),c(r)&&r!==Sre.DEFAULT_CLEARCOAT_FACTOR&&(n.addUniform("float","u_clearcoatFactor",_e.FRAGMENT),t.u_clearcoatFactor=function(){return e.clearcoatFactor},n.addDefine("HAS_CLEARCOAT_FACTOR",void 0,_e.FRAGMENT)),c(s)&&!o&&ll(n,t,s,"u_clearcoatTexture","CLEARCOAT",i),c(a)&&r!==Sre.DEFAULT_CLEARCOAT_ROUGHNESS_FACTOR&&(n.addUniform("float","u_clearcoatRoughnessFactor",_e.FRAGMENT),t.u_clearcoatRoughnessFactor=function(){return e.clearcoatRoughnessFactor},n.addDefine("HAS_CLEARCOAT_ROUGHNESS_FACTOR",void 0,_e.FRAGMENT)),c(l)&&!o&&ll(n,t,l,"u_clearcoatRoughnessTexture","CLEARCOAT_ROUGHNESS",i),c(u)&&!o&&ll(n,t,u,"u_clearcoatNormalTexture","CLEARCOAT_NORMAL",i)}function A4e(e,t,n,i,o){n.addDefine("USE_METALLIC_ROUGHNESS",void 0,_e.FRAGMENT);let r=e.baseColorTexture;c(r)&&!o&&ll(n,t,r,"u_baseColorTexture","BASE_COLOR",i);let s=e.baseColorFactor;c(s)&&!se.equals(s,k8.DEFAULT_BASE_COLOR_FACTOR)&&(n.addUniform("vec4","u_baseColorFactor",_e.FRAGMENT),t.u_baseColorFactor=function(){return e.baseColorFactor},n.addDefine("HAS_BASE_COLOR_FACTOR",void 0,_e.FRAGMENT));let a=e.metallicRoughnessTexture;c(a)&&!o&&ll(n,t,a,"u_metallicRoughnessTexture","METALLIC_ROUGHNESS",i);let l=e.metallicFactor;c(l)&&l!==k8.DEFAULT_METALLIC_FACTOR&&(n.addUniform("float","u_metallicFactor",_e.FRAGMENT),t.u_metallicFactor=function(){return e.metallicFactor},n.addDefine("HAS_METALLIC_FACTOR",void 0,_e.FRAGMENT));let u=e.roughnessFactor;c(u)&&u!==k8.DEFAULT_ROUGHNESS_FACTOR&&(n.addUniform("float","u_roughnessFactor",_e.FRAGMENT),t.u_roughnessFactor=function(){return e.roughnessFactor},n.addDefine("HAS_ROUGHNESS_FACTOR",void 0,_e.FRAGMENT))}var U8=wre;var Cc={name:"MetadataPickingPipelineStage",METADATA_PICKING_ENABLED:"METADATA_PICKING_ENABLED",METADATA_PICKING_VALUE_TYPE:"METADATA_PICKING_VALUE_TYPE",METADATA_PICKING_VALUE_STRING:"METADATA_PICKING_VALUE_STRING",METADATA_PICKING_VALUE_COMPONENT_X:"METADATA_PICKING_VALUE_COMPONENT_X",METADATA_PICKING_VALUE_COMPONENT_Y:"METADATA_PICKING_VALUE_COMPONENT_Y",METADATA_PICKING_VALUE_COMPONENT_Z:"METADATA_PICKING_VALUE_COMPONENT_Z",METADATA_PICKING_VALUE_COMPONENT_W:"METADATA_PICKING_VALUE_COMPONENT_W"};Cc.process=function(e,t,n){let i=e.shaderBuilder;i.addDefine(Cc.METADATA_PICKING_VALUE_TYPE,"float",_e.FRAGMENT),i.addDefine(Cc.METADATA_PICKING_VALUE_STRING,"0.0",_e.FRAGMENT),i.addDefine(Cc.METADATA_PICKING_VALUE_COMPONENT_X,"0.0",_e.FRAGMENT),i.addDefine(Cc.METADATA_PICKING_VALUE_COMPONENT_Y,"0.0",_e.FRAGMENT),i.addDefine(Cc.METADATA_PICKING_VALUE_COMPONENT_Z,"0.0",_e.FRAGMENT),i.addDefine(Cc.METADATA_PICKING_VALUE_COMPONENT_W,"0.0",_e.FRAGMENT),i.addFunction("metadataPickingStage","void metadataPickingStage(Metadata metadata, MetadataClass metadataClass, inout vec4 metadataValues)",_e.FRAGMENT),i.addFunctionLines("metadataPickingStage",[`${Cc.METADATA_PICKING_VALUE_TYPE} value = ${Cc.METADATA_PICKING_VALUE_TYPE}(${Cc.METADATA_PICKING_VALUE_STRING});`,`metadataValues.x = ${Cc.METADATA_PICKING_VALUE_COMPONENT_X};`,`metadataValues.y = ${Cc.METADATA_PICKING_VALUE_COMPONENT_Y};`,`metadataValues.z = ${Cc.METADATA_PICKING_VALUE_COMPONENT_Z};`,`metadataValues.w = ${Cc.METADATA_PICKING_VALUE_COMPONENT_W};`],_e.FRAGMENT)};var od=Cc;var z8=`void morphTargetsStage(inout ProcessedAttributes attributes)
{
vec3 positionMC = attributes.positionMC;
attributes.positionMC = getMorphedPosition(positionMC);
#ifdef HAS_NORMALS
vec3 normalMC = attributes.normalMC;
attributes.normalMC = getMorphedNormal(normalMC);
#endif
#ifdef HAS_TANGENTS
vec3 tangentMC = attributes.tangentMC;
attributes.tangentMC = getMorphedTangent(tangentMC);
#endif
}
`;var da={name:"MorphTargetsPipelineStage",FUNCTION_ID_GET_MORPHED_POSITION:"getMorphedPosition",FUNCTION_SIGNATURE_GET_MORPHED_POSITION:"vec3 getMorphedPosition(in vec3 position)",FUNCTION_ID_GET_MORPHED_NORMAL:"getMorphedNormal",FUNCTION_SIGNATURE_GET_MORPHED_NORMAL:"vec3 getMorphedNormal(in vec3 normal)",FUNCTION_ID_GET_MORPHED_TANGENT:"getMorphedTangent",FUNCTION_SIGNATURE_GET_MORPHED_TANGENT:"vec3 getMorphedTangent(in vec3 tangent)"};da.process=function(e,t){let n=e.shaderBuilder;n.addDefine("HAS_MORPH_TARGETS",void 0,_e.VERTEX),D4e(n);let i=t.morphTargets.length;for(let a=0;a<i;a++){let l=t.morphTargets[a].attributes,u=l.length;for(let f=0;f<u;f++){let d=l[f],p=d.semantic;p!==Ct.POSITION&&p!==Ct.NORMAL&&p!==Ct.TANGENT||(E4e(e,d,e.attributeIndex,a),e.attributeIndex++)}}P4e(n);let r=e.runtimeNode.morphWeights.length;n.addUniform("float",`u_morphWeights[${r}]`,_e.VERTEX),n.addVertexLines(z8);let s={u_morphWeights:function(){return e.runtimeNode.morphWeights}};e.uniformMap=At(s,e.uniformMap)};var C4e={attributeString:void 0,functionId:void 0};function E4e(e,t,n,i){let o=e.shaderBuilder;S4e(e,t,n);let r=w4e(t,C4e);v4e(o,r,i)}function S4e(e,t,n){let i={index:n,value:c(t.buffer)?void 0:t.constant,vertexBuffer:t.buffer,componentsPerAttribute:cn.getNumberOfComponents(t.type),componentDatatype:t.componentDatatype,offsetInBytes:t.byteOffset,strideInBytes:t.byteStride,normalize:t.normalized};e.attributes.push(i)}function w4e(e,t){switch(e.semantic){case Ct.POSITION:t.attributeString="Position",t.functionId=da.FUNCTION_ID_GET_MORPHED_POSITION;break;case Ct.NORMAL:t.attributeString="Normal",t.functionId=da.FUNCTION_ID_GET_MORPHED_NORMAL;break;case Ct.TANGENT:t.attributeString="Tangent",t.functionId=da.FUNCTION_ID_GET_MORPHED_TANGENT;break;default:break}return t}function v4e(e,t,n){let i=t.attributeString,o=`a_target${i}_${n}`,r=`morphed${i} += u_morphWeights[${n}] * a_target${i}_${n};`;e.addAttribute("vec3",o),e.addFunctionLines(t.functionId,[r])}function D4e(e){e.addFunction(da.FUNCTION_ID_GET_MORPHED_POSITION,da.FUNCTION_SIGNATURE_GET_MORPHED_POSITION,_e.VERTEX),e.addFunctionLines(da.FUNCTION_ID_GET_MORPHED_POSITION,["vec3 morphedPosition = position;"]),e.addFunction(da.FUNCTION_ID_GET_MORPHED_NORMAL,da.FUNCTION_SIGNATURE_GET_MORPHED_NORMAL,_e.VERTEX),e.addFunctionLines(da.FUNCTION_ID_GET_MORPHED_NORMAL,["vec3 morphedNormal = normal;"]),e.addFunction(da.FUNCTION_ID_GET_MORPHED_TANGENT,da.FUNCTION_SIGNATURE_GET_MORPHED_TANGENT,_e.VERTEX),e.addFunctionLines(da.FUNCTION_ID_GET_MORPHED_TANGENT,["vec3 morphedTangent = tangent;"])}function P4e(e){e.addFunctionLines(da.FUNCTION_ID_GET_MORPHED_POSITION,["return morphedPosition;"]),e.addFunctionLines(da.FUNCTION_ID_GET_MORPHED_NORMAL,["return morphedNormal;"]),e.addFunctionLines(da.FUNCTION_ID_GET_MORPHED_TANGENT,["return morphedTangent;"])}var H8=da;var Dre={name:"PickingPipelineStage"};Dre.process=function(e,t,n){let i=n.context,o=e.runtimeNode,r=e.shaderBuilder,s=e.model,a=o.node.instances;if(e.hasPropertyTable)I4e(e,t,a,i);else if(c(a))O4e(e,i);else{let l=Pre(e),u=i.createPickId(l);s._pipelineResources.push(u),s._pickIds.push(u),r.addUniform("vec4","czm_pickColor",_e.FRAGMENT);let f=e.uniformMap;f.czm_pickColor=function(){return u.color},e.pickId="czm_pickColor"}};function Pre(e,t){let n=e.model;if(c(n.pickObject))return n.pickObject;let i={model:n,node:e.runtimeNode,primitive:e.runtimePrimitive},o;if(Rr.is3DTiles(n.type)){let r=n.content;o={content:r,primitive:r.tileset,detail:i}}else o={primitive:n,detail:i};return o.id=n.id,c(t)&&(o.instanceId=t),o}function I4e(e,t,n){let i=e.model,o,r,s=i.featureIdLabel,a=i.instanceFeatureIdLabel;c(i.featureTableId)?o=i.featureTableId:c(n)?(r=Zt.getFeatureIdsByLabel(n.featureIds,a),o=r.propertyTableId):(r=Zt.getFeatureIdsByLabel(t.featureIds,s),o=r.propertyTableId);let l=i.featureTables[o];e.shaderBuilder.addUniform("sampler2D","model_pickTexture",_e.FRAGMENT);let f=l.batchTexture;e.uniformMap.model_pickTexture=function(){return y(f.pickTexture,f.defaultTexture)},e.pickId="((selectedFeature.id < int(model_featuresLength)) ? texture(model_pickTexture, selectedFeature.st) : vec4(0.0))"}function O4e(e,t){let n=e.instanceCount,i=new Array(n),o=new Uint8Array(n*4),r=e.model,s=r._pipelineResources;for(let d=0;d<n;d++){let p=Pre(e,d),g=t.createPickId(p);s.push(g),i[d]=g;let m=g.color;o[d*4+0]=j.floatToByte(m.red),o[d*4+1]=j.floatToByte(m.green),o[d*4+2]=j.floatToByte(m.blue),o[d*4+3]=j.floatToByte(m.alpha)}r._pickIds=i;let a=xt.createVertexBuffer({context:t,typedArray:o,usage:ke.STATIC_DRAW});a.vertexArrayDestroyable=!1,r.statistics.addBuffer(a,!1),s.push(a);let u={index:e.attributeIndex++,vertexBuffer:a,componentsPerAttribute:4,componentDatatype:$.UNSIGNED_BYTE,normalize:!0,offsetInBytes:0,strideInBytes:0,instanceDivisor:1};e.attributes.push(u);let f=e.shaderBuilder;f.addDefine("USE_PICKING",void 0,_e.BOTH),f.addAttribute("vec4","a_pickColor"),f.addVarying("vec4","v_pickColor"),e.pickId="v_pickColor"}var G8=Dre;var R4e={ADD:0,REPLACE:1},nr=Object.freeze(R4e);var j8=`float getPointSizeFromAttenuation(vec3 positionEC) {
float pointSize = model_pointCloudParameters.x;
float geometricError = model_pointCloudParameters.y;
float depthMultiplier = model_pointCloudParameters.z;
float depth = -positionEC.z;
return min((geometricError / depth) * depthMultiplier, pointSize);
}
#ifdef HAS_POINT_CLOUD_SHOW_STYLE
float pointCloudShowStylingStage(in ProcessedAttributes attributes, in Metadata metadata) {
float tiles3d_tileset_time = model_pointCloudParameters.w;
return float(getShowFromStyle(attributes, metadata, tiles3d_tileset_time));
}
#endif
#ifdef HAS_POINT_CLOUD_COLOR_STYLE
vec4 pointCloudColorStylingStage(in ProcessedAttributes attributes, in Metadata metadata) {
float tiles3d_tileset_time = model_pointCloudParameters.w;
return getColorFromStyle(attributes, metadata, tiles3d_tileset_time);
}
#endif
#ifdef HAS_POINT_CLOUD_POINT_SIZE_STYLE
float pointCloudPointSizeStylingStage(in ProcessedAttributes attributes, in Metadata metadata) {
float tiles3d_tileset_time = model_pointCloudParameters.w;
return float(getPointSizeFromStyle(attributes, metadata, tiles3d_tileset_time));
}
#elif defined(HAS_POINT_CLOUD_ATTENUATION)
float pointCloudPointSizeStylingStage(in ProcessedAttributes attributes, in Metadata metadata) {
return getPointSizeFromAttenuation(v_positionEC);
}
#endif
#ifdef HAS_POINT_CLOUD_BACK_FACE_CULLING
float pointCloudBackFaceCullingStage() {
#if defined(HAS_NORMALS) && !defined(HAS_DOUBLE_SIDED_MATERIAL)
return step(-v_normalEC.z, 0.0);
#else
return 1.0;
#endif
}
#endif
`;var M4e=new se,Ore={name:"PointCloudStylingPipelineStage"};Ore.process=function(e,t,n){let i=e.shaderBuilder,o=e.model,r=o.style,s=o.structuralMetadata,a=c(s)?s.propertyAttributes:void 0,l=c(o.featureTableId)&&o.featureTables[o.featureTableId].featuresLength>0,u=!c(a)&&l;if(c(r)&&!u){let b=B4e(a),x=k4e(r,b);V4e(i,x);let C=U4e(x).indexOf("normalMC")>=0,S=Zt.getAttributeBySemantic(t,Ct.NORMAL);if(C&&!S)throw new ue("Style references the NORMAL semantic but the point cloud does not have normals");i.addDefine("COMPUTE_POSITION_WC_STYLE",void 0,_e.VERTEX),x.styleTranslucent&&(e.alphaOptions.pass=ve.TRANSLUCENT)}let f=o.pointCloudShading;f.attenuation&&i.addDefine("HAS_POINT_CLOUD_ATTENUATION",void 0,_e.VERTEX),f.backFaceCulling&&i.addDefine("HAS_POINT_CLOUD_BACK_FACE_CULLING",void 0,_e.VERTEX);let d,p,g;Rr.is3DTiles(o.type)&&(p=!0,d=o.content,g=d.tile.refine===nr.ADD),i.addUniform("vec4","model_pointCloudParameters",_e.VERTEX),i.addVertexLines(j8);let m=e.uniformMap;m.model_pointCloudParameters=function(){let b=M4e,x=1;p&&(x=g?5:d.tileset.memoryAdjustedScreenSpaceError),b.x=y(f.maximumAttenuation,x),b.x*=n.pixelRatio;let T=L4e(e,t,f,d);b.y=T*f.geometricErrorScale;let C=n.context,S=n.camera.frustum,v;return n.mode===oe.SCENE2D||S instanceof rn?v=Number.POSITIVE_INFINITY:v=C.drawingBufferHeight/n.camera.frustum.sseDenominator,b.z=v,p&&(b.w=d.tileset.timeSinceLoad),b}};var Ire=new h;function L4e(e,t,n,i){if(c(i)){let f=i.tile.geometricError;if(f>0)return f}if(c(n.baseResolution))return n.baseResolution;let o=Zt.getAttributeBySemantic(t,Ct.POSITION),r=o.count,s=e.runtimeNode.transform,a=h.subtract(o.max,o.min,Ire);a=k.multiplyByPointAsVector(s,a,Ire);let l=a.x*a.y*a.z;return R.cbrt(l/r)}var N4e={colorStyleFunction:void 0,showStyleFunction:void 0,pointSizeStyleFunction:void 0,styleTranslucent:!1},F4e={POSITION:"attributes.positionMC",POSITION_ABSOLUTE:"v_positionWC",COLOR:"attributes.color_0",NORMAL:"attributes.normalMC"};function B4e(e){let t=qe(F4e);if(!c(e))return t;for(let n=0;n<e.length;n++){let o=e[n].properties;for(let r in o)o.hasOwnProperty(r)&&(t[r]=`metadata.${r}`)}return t}var W8="ProcessedAttributes attributes, Metadata metadata, float tiles3d_tileset_time";function k4e(e,t){let n=N4e,i={translucent:!1};return n.colorStyleFunction=e.getColorShaderFunction(`getColorFromStyle(${W8})`,t,i),n.showStyleFunction=e.getShowShaderFunction(`getShowFromStyle(${W8})`,t,i),n.pointSizeStyleFunction=e.getPointSizeShaderFunction(`getPointSizeFromStyle(${W8})`,t,i),n.styleTranslucent=c(n.colorStyleFunction)&&i.translucent,n}function V4e(e,t){let n=t.colorStyleFunction;c(n)&&(e.addDefine("HAS_POINT_CLOUD_COLOR_STYLE",void 0,_e.BOTH),e.addVertexLines(n),e.addVarying("vec4","v_pointCloudColor"));let i=t.showStyleFunction;c(i)&&(e.addDefine("HAS_POINT_CLOUD_SHOW_STYLE",void 0,_e.VERTEX),e.addVertexLines(i));let o=t.pointSizeStyleFunction;c(o)&&(e.addDefine("HAS_POINT_CLOUD_POINT_SIZE_STYLE",void 0,_e.VERTEX),e.addVertexLines(o))}function q8(e,t){let n=/attributes\.(\w+)/g,i=n.exec(e);for(;i!==null;){let o=i[1];t.indexOf(o)===-1&&t.push(o),i=n.exec(e)}}function U4e(e){let t=e.colorStyleFunction,n=e.showStyleFunction,i=e.pointSizeStyleFunction,o=[];return c(t)&&q8(t,o),c(n)&&q8(n,o),c(i)&&q8(i,o),o}var Y8=Ore;var X8=`void primitiveOutlineStage() {
v_outlineCoordinates = a_outlineCoordinates;
}
`;var K8=`void primitiveOutlineStage(inout czm_modelMaterial material) {
if (!model_showOutline) {
return;
}
float outlineX =
texture(model_outlineTexture, vec2(v_outlineCoordinates.x, 0.5)).r;
float outlineY =
texture(model_outlineTexture, vec2(v_outlineCoordinates.y, 0.5)).r;
float outlineZ =
texture(model_outlineTexture, vec2(v_outlineCoordinates.z, 0.5)).r;
float outlineness = max(outlineX, max(outlineY, outlineZ));
material.diffuse = mix(material.diffuse, model_outlineColor.rgb, model_outlineColor.a * outlineness);
}
`;var Rre={name:"PrimitiveOutlinePipelineStage"};Rre.process=function(e,t,n){let i=e.shaderBuilder,o=e.uniformMap;i.addDefine("HAS_PRIMITIVE_OUTLINE",void 0,_e.BOTH),i.addAttribute("vec3","a_outlineCoordinates"),i.addVarying("vec3","v_outlineCoordinates");let r=t.outlineCoordinates,s={index:e.attributeIndex++,vertexBuffer:r.buffer,componentsPerAttribute:cn.getNumberOfComponents(r.type),componentDatatype:r.componentDatatype,offsetInBytes:r.byteOffset,strideInBytes:r.byteStride,normalize:r.normalized};e.attributes.push(s),i.addUniform("sampler2D","model_outlineTexture",_e.FRAGMENT);let a=sw.createTexture(n.context);o.model_outlineTexture=function(){return a};let l=e.model;i.addUniform("vec4","model_outlineColor",_e.FRAGMENT),o.model_outlineColor=function(){return l.outlineColor},i.addUniform("bool","model_showOutline",_e.FRAGMENT),o.model_showOutline=function(){return l.showOutline},i.addVertexLines(X8),i.addFragmentLines(K8)};var $8=Rre;var Mre={name:"PrimitiveStatisticsPipelineStage",_countGeometry:Lre,_count2DPositions:Nre,_countMorphTargetAttributes:Fre,_countMaterialTextures:Bre,_countFeatureIdTextures:kre,_countBinaryMetadata:Vre};Mre.process=function(e,t,n){let i=e.model,o=i.statistics;Lre(o,t),Nre(o,e.runtimePrimitive),Fre(o,t),Bre(o,t.material),kre(o,t.featureIds),Vre(o,i)};function Lre(e,t){let n=c(t.indices)?t.indices.count:Zt.getAttributeBySemantic(t,"POSITION").count,i=t.primitiveType;i===Me.POINTS?e.pointsLength+=n:Me.isTriangles(i)&&(e.trianglesLength+=z4e(i,n));let o=t.attributes,r=o.length;for(let l=0;l<r;l++){let u=o[l];if(c(u.buffer)){let f=c(u.typedArray);e.addBuffer(u.buffer,f)}}let s=t.outlineCoordinates;c(s)&&c(s.buffer)&&e.addBuffer(s.buffer,!1);let a=t.indices;if(c(a)&&c(a.buffer)){let l=c(a.typedArray);e.addBuffer(a.buffer,l)}}function z4e(e,t){switch(e){case Me.TRIANGLES:return t/3;case Me.TRIANGLE_STRIP:case Me.TRIANGLE_FAN:return Math.max(t-2,0);default:return 0}}function Nre(e,t){let n=t.positionBuffer2D;c(n)&&e.addBuffer(n,!0)}function Fre(e,t){let n=t.morphTargets;if(!c(n))return;let i=!1,o=n.length;for(let r=0;r<o;r++){let s=n[r].attributes,a=s.length;for(let l=0;l<a;l++){let u=s[l];c(u.buffer)&&e.addBuffer(u.buffer,i)}}}function Bre(e,t){let n=H4e(t),i=n.length;for(let o=0;o<i;o++){let r=n[o];c(r)&&c(r.texture)&&e.addTexture(r.texture)}}function H4e(e){let t=e.metallicRoughness,n=[e.emissiveTexture,e.normalTexture,e.occlusionTexture,t.baseColorTexture,t.metallicRoughnessTexture],i=e.specularGlossiness;return c(i)&&(n.push(i.diffuseTexture),n.push(i.specularGlossinessTexture)),n}function kre(e,t){let n=t.length;for(let i=0;i<n;i++){let o=t[i];if(o instanceof Sn.FeatureIdTexture){let r=o.textureReader;c(r.texture)&&e.addTexture(r.texture)}}}function Vre(e,t){let n=t.structuralMetadata;c(n)&&(G4e(e,n),e.propertyTablesByteLength+=n.propertyTablesByteLength);let i=t.featureTables;if(!c(i))return;let o=i.length;for(let r=0;r<o;r++){let s=i[r];e.addBatchTexture(s.batchTexture)}}function G4e(e,t){let n=t.propertyTextures;if(!c(n))return;let i=n.length;for(let o=0;o<i;o++){let s=n[o].properties;for(let a in s)if(s.hasOwnProperty(a)){let u=s[a].textureReader;c(u.texture)&&e.addTexture(u.texture)}}}var Z8=Mre;var j4e=new k,W4e=new k,Ure={name:"SceneMode2DPipelineStage"};Ure.process=function(e,t,n){let i=Zt.getAttributeBySemantic(t,Ct.POSITION),o=e.shaderBuilder,r=e.model,s=r.sceneGraph.computedModelMatrix,a=e.runtimeNode.computedTransform,l=k.multiplyTransformation(s,a,j4e),u=X4e(e,l,n),f=e.runtimePrimitive;f.boundingSphere2D=u;let d=e.runtimeNode.node.instances;if(c(d))return;if(c(i.typedArray)){let b=Z4e(i,l,u,n);f.positionBuffer2D=b,r._modelResources.push(b),i.typedArray=void 0}o.addDefine("USE_2D_POSITIONS",void 0,_e.VERTEX),o.addUniform("mat4","u_modelView2D",_e.VERTEX);let p=k.fromTranslation(u.center,new k),g=n.context,m={u_modelView2D:function(){return k.multiplyTransformation(g.uniformState.view,p,W4e)}};e.uniformMap=At(m,e.uniformMap)};var q4e=new h,Y4e=new h;function X4e(e,t,n){let i=k.multiplyByPoint(t,e.positionMin,q4e),o=Ni.computeActualEllipsoidPosition(n,i,i),r=k.multiplyByPoint(t,e.positionMax,Y4e),s=Ni.computeActualEllipsoidPosition(n,r,r);return ce.fromCornerPoints(o,s,new ce)}var zre=new h;function K4e(e,t){let n=e.length,i=new Float32Array(n),o=t.quantizedVolumeOffset,r=t.quantizedVolumeStepSize;for(let s=0;s<n;s+=3){let a=h.fromArray(e,s,zre),l=h.multiplyComponents(a,r,a),u=h.add(l,o,l);i[s]=u.x,i[s+1]=u.y,i[s+2]=u.z}return i}function $4e(e,t,n,i){let o;c(e.quantization)?o=K4e(e.typedArray,e.quantization):o=e.typedArray.slice();let r=e.byteOffset/Float32Array.BYTES_PER_ELEMENT,s=o.length,a=c(e.byteStride)?e.byteStride/Float32Array.BYTES_PER_ELEMENT:3;for(let l=r;l<s;l+=a){let u=h.fromArray(o,l,zre);if(isNaN(u.x)||isNaN(u.y)||isNaN(u.z))continue;let f=k.multiplyByPoint(t,u,u),d=Ni.computeActualEllipsoidPosition(i,f,f),p=h.subtract(d,n,d);o[l]=p.x,o[l+1]=p.y,o[l+2]=p.z}return o}function Z4e(e,t,n,i){let o=qe(i);o.mode=oe.COLUMBUS_VIEW;let r=n.center,s=$4e(e,t,r,o),a=xt.createVertexBuffer({context:i.context,typedArray:s,usage:ke.STATIC_DRAW});return a.vertexArrayDestroyable=!1,a}var J8=Ure;var Q8=`void skinningStage(inout ProcessedAttributes attributes)
{
mat4 skinningMatrix = getSkinningMatrix();
mat3 skinningMatrixMat3 = mat3(skinningMatrix);
vec4 positionMC = vec4(attributes.positionMC, 1.0);
attributes.positionMC = vec3(skinningMatrix * positionMC);
#ifdef HAS_NORMALS
vec3 normalMC = attributes.normalMC;
attributes.normalMC = skinningMatrixMat3 * normalMC;
#endif
#ifdef HAS_TANGENTS
vec3 tangentMC = attributes.tangentMC;
attributes.tangentMC = skinningMatrixMat3 * tangentMC;
#endif
}
`;var R0={name:"SkinningPipelineStage",FUNCTION_ID_GET_SKINNING_MATRIX:"getSkinningMatrix",FUNCTION_SIGNATURE_GET_SKINNING_MATRIX:"mat4 getSkinningMatrix()"};R0.process=function(e,t){let n=e.shaderBuilder;n.addDefine("HAS_SKINNING",void 0,_e.VERTEX),Q4e(n,t);let i=e.runtimeNode,o=i.computedJointMatrices;n.addUniform("mat4",`u_jointMatrices[${o.length}]`,_e.VERTEX),n.addVertexLines(Q8);let r={u_jointMatrices:function(){return i.computedJointMatrices}};e.uniformMap=At(r,e.uniformMap)};function J4e(e){let t=-1,n=e.attributes,i=n.length;for(let o=0;o<i;o++){let r=n[o];(r.semantic===Ct.JOINTS||r.semantic===Ct.WEIGHTS)&&(t=Math.max(t,r.setIndex))}return t}function Q4e(e,t){e.addFunction(R0.FUNCTION_ID_GET_SKINNING_MATRIX,R0.FUNCTION_SIGNATURE_GET_SKINNING_MATRIX,_e.VERTEX),e.addFunctionLines(R0.FUNCTION_ID_GET_SKINNING_MATRIX,["mat4 skinnedMatrix = mat4(0);"]);let i,o,r=["x","y","z","w"],s=J4e(t);for(i=0;i<=s;i++)for(o=0;o<=3;o++){let l=r[o],u=`skinnedMatrix += a_weights_${i}.${l} * u_jointMatrices[int(a_joints_${i}.${l})];`;e.addFunctionLines(R0.FUNCTION_ID_GET_SKINNING_MATRIX,[u])}e.addFunctionLines(R0.FUNCTION_ID_GET_SKINNING_MATRIX,["return skinnedMatrix;"])}var eH=R0;var tH=`void verticalExaggerationStage(
inout ProcessedAttributes attributes
) {
vec4 vertexPositionENU = czm_modelToEnu * vec4(attributes.positionMC, 1.0);
vec2 vertexAzimuth = normalize(vertexPositionENU.xy);
float azimuthalCurvature = dot(vertexAzimuth * vertexAzimuth, czm_eyeEllipsoidCurvature);
float eyeToCenter = 1.0 / azimuthalCurvature + czm_eyeHeight;
vec3 vertexPositionEC = (czm_modelView * vec4(attributes.positionMC, 1.0)).xyz;
vec3 centerToVertex = eyeToCenter * czm_eyeEllipsoidNormalEC + vertexPositionEC;
vec3 vertexNormal = normalize(centerToVertex);
float verticalDistance = dot(vertexPositionEC, czm_eyeEllipsoidNormalEC);
float horizontalDistance = length(vertexPositionEC - verticalDistance * czm_eyeEllipsoidNormalEC);
float sinTheta = horizontalDistance / (eyeToCenter + verticalDistance);
bool isSmallAngle = clamp(sinTheta, 0.0, 0.05) == sinTheta;
float exactVersine = 1.0 - dot(czm_eyeEllipsoidNormalEC, vertexNormal);
float smallAngleVersine = 0.5 * sinTheta * sinTheta;
float versine = isSmallAngle ? smallAngleVersine : exactVersine;
float dHeight = dot(vertexPositionEC, vertexNormal) - eyeToCenter * versine;
float vertexHeight = czm_eyeHeight + dHeight;
vec3 vertexNormalMC = (czm_inverseModelView * vec4(vertexNormal, 0.0)).xyz;
vertexNormalMC = normalize(vertexNormalMC);
float stretch = u_verticalExaggerationAndRelativeHeight.x;
float shift = u_verticalExaggerationAndRelativeHeight.y;
float exaggeration = (vertexHeight - shift) * (stretch - 1.0);
attributes.positionMC += exaggeration * vertexNormalMC;
}
`;var Hre={name:"VerticalExaggerationPipelineStage"},e8e=new H;Hre.process=function(e,t,n){let{shaderBuilder:i,uniformMap:o}=e;i.addVertexLines(tH),i.addDefine("HAS_VERTICAL_EXAGGERATION",void 0,_e.VERTEX),i.addUniform("vec2","u_verticalExaggerationAndRelativeHeight",_e.VERTEX),o.u_verticalExaggerationAndRelativeHeight=function(){return H.fromElements(n.verticalExaggeration,n.verticalExaggerationRelativeHeight,e8e)}};var nH=Hre;var iH={};function t8e(e){let t=Fe.createTypedArray(e,e*2),n=e,i=0;for(let o=0;o<n;o+=3)t[i++]=o,t[i++]=o+1,t[i++]=o+1,t[i++]=o+2,t[i++]=o+2,t[i++]=o;return t}function n8e(e,t){let n=t.length,i=Fe.createTypedArray(e,n*2),o=0;for(let r=0;r<n;r+=3){let s=t[r],a=t[r+1],l=t[r+2];i[o++]=s,i[o++]=a,i[o++]=a,i[o++]=l,i[o++]=l,i[o++]=s}return i}function i8e(e){let t=e-2,n=2+t*4,i=Fe.createTypedArray(e,n),o=0;i[o++]=0,i[o++]=1;for(let r=0;r<t;r++)i[o++]=r+1,i[o++]=r+2,i[o++]=r+2,i[o++]=r;return i}function o8e(e,t){let i=t.length-2,o=2+i*4,r=Fe.createTypedArray(e,o),s=0;r[s++]=t[0],r[s++]=t[1];for(let a=0;a<i;a++){let l=t[a],u=t[a+1],f=t[a+2];r[s++]=u,r[s++]=f,r[s++]=f,r[s++]=l}return r}function r8e(e){let t=e-2,n=2+t*4,i=Fe.createTypedArray(e,n),o=0;i[o++]=0,i[o++]=1;for(let r=0;r<t;r++)i[o++]=r+1,i[o++]=r+2,i[o++]=r+2,i[o++]=0;return i}function s8e(e,t){let i=t.length-2,o=2+i*4,r=Fe.createTypedArray(e,o),s=0,a=t[0];r[s++]=a,r[s++]=t[1];for(let l=0;l<i;l++){let u=t[l+1],f=t[l+2];r[s++]=u,r[s++]=f,r[s++]=f,r[s++]=a}return r}iH.createWireframeIndices=function(e,t,n){let i=c(n);if(e===Me.TRIANGLES)return i?n8e(t,n):t8e(t);if(e===Me.TRIANGLE_STRIP)return i?o8e(t,n):i8e(t);if(e===Me.TRIANGLE_FAN)return i?s8e(t,n):r8e(t)};iH.getWireframeIndicesCount=function(e,t){return e===Me.TRIANGLES?t*2:e===Me.TRIANGLE_STRIP||e===Me.TRIANGLE_FAN?2+(t-2)*4:t};var f1=iH;var Gre={name:"WireframePipelineStage"};Gre.process=function(e,t,n){e.shaderBuilder.addDefine("HAS_WIREFRAME",void 0,_e.FRAGMENT);let o=e.model,r=a8e(t,e.indices,n);o._pipelineResources.push(r),e.wireframeIndexBuffer=r,o.statistics.addBuffer(r,!1);let a=e.primitiveType,l=e.count;e.primitiveType=Me.LINES,e.count=f1.getWireframeIndicesCount(a,l)};function a8e(e,t,n){let o=Zt.getAttributeBySemantic(e,Ct.POSITION).count,r=n.context.webgl2,s;if(c(t)){let f=t.buffer,d=t.count;c(f)&&r?(s=f.sizeInBytes===d?new Uint8Array(d):Fe.createTypedArray(o,d),f.getBufferData(s)):s=t.typedArray}let a=e.primitiveType,l=f1.createWireframeIndices(a,o,s),u=Fe.fromSizeInBytes(l.BYTES_PER_ELEMENT);return xt.createIndexBuffer({context:n.context,typedArray:l,usage:ke.STATIC_DRAW,indexDatatype:u})}var oH=Gre;function jre(e){e=y(e,y.EMPTY_OBJECT);let t=e.primitive,n=e.node,i=e.model;A.typeOf.object("options.primitive",t),A.typeOf.object("options.node",n),A.typeOf.object("options.model",i),this.primitive=t,this.node=n,this.model=i,this.pipelineStages=[],this.drawCommand=void 0,this.boundingSphere=void 0,this.boundingSphere2D=void 0,this.positionBuffer2D=void 0,this.batchLengths=void 0,this.batchOffsets=void 0,this.updateStages=[]}jre.prototype.configurePipeline=function(e){let t=this.pipelineStages;t.length=0;let n=this.primitive,i=this.node,o=this.model,r=o.customShader,s=o.style,a=e.context.webgl2,u=e.mode!==oe.SCENE3D&&!e.scene3DOnly&&o._projectTo2D,f=e.verticalExaggeration!==1&&o.hasVerticalExaggeration,d=c(n.morphTargets)&&n.morphTargets.length>0,p=c(i.skin),g=c(r),b=!(g&&c(r.fragmentShaderText))||r.mode!==O0.REPLACE_MATERIAL,x=Zt.hasQuantizedAttributes(n.attributes),T=o.debugWireframe&&Me.isTriangles(n.primitiveType)&&(o._enableDebugWireframe||a),C=o.pointCloudShading,S=c(C)&&C.attenuation,v=c(C)&&C.backFaceCulling,D=n.primitiveType===Me.POINTS&&(c(s)||S||v),I=o._enableShowOutline&&c(n.outlineCoordinates),L=c8e(o,i,n),M=c(o.classificationType);u&&t.push(J8),t.push(L8),T&&t.push(oH),M&&t.push(x8),d&&t.push(H8),p&&t.push(eH),D&&t.push(Y8),x&&t.push(O8),b&&t.push(U8),t.push(RT),t.push(bh),t.push(od),L.hasPropertyTable&&(t.push(LT),t.push(b8),t.push(C8)),f&&t.push(nH),g&&t.push(I8),t.push(F8),o.allowPicking&&t.push(G8),I&&t.push($8),t.push(y8),t.push(Z8)};function c8e(e,t,n){let i;return c(t.instances)&&(i=Zt.getFeatureIdsByLabel(t.instances.featureIds,e.instanceFeatureIdLabel),c(i))?{hasFeatureIds:!0,hasPropertyTable:c(i.propertyTableId)}:(i=Zt.getFeatureIdsByLabel(n.featureIds,e.featureIdLabel),c(i)?{hasFeatureIds:!0,hasPropertyTable:c(i.propertyTableId)}:{hasFeatureIds:!1,hasPropertyTable:!1})}var rH=jre;function sH(e){e=y(e,y.EMPTY_OBJECT),A.typeOf.object("options.skin",e.skin),A.typeOf.object("options.sceneGraph",e.sceneGraph),this._sceneGraph=e.sceneGraph;let t=e.skin;this._skin=t,this._inverseBindMatrices=void 0,this._joints=[],this._jointMatrices=[],l8e(this)}Object.defineProperties(sH.prototype,{skin:{get:function(){return this._skin}},sceneGraph:{get:function(){return this._sceneGraph}},inverseBindMatrices:{get:function(){return this._inverseBindMatrices}},joints:{get:function(){return this._joints}},jointMatrices:{get:function(){return this._jointMatrices}}});function l8e(e){let t=e.skin,n=t.inverseBindMatrices;e._inverseBindMatrices=n;let i=t.joints,o=i.length,r=e.sceneGraph._runtimeNodes,s=e.joints,a=e._jointMatrices;for(let l=0;l<o;l++){let u=i[l].index,f=r[u];s.push(f);let d=n[l],p=Wre(f,d,new k);a.push(p)}}function Wre(e,t,n){let i=k.multiplyTransformation(e.transformToRoot,e.transform,n);return n=k.multiplyTransformation(i,t,n),n}sH.prototype.updateJointMatrices=function(){let e=this._jointMatrices,t=e.length;for(let n=0;n<t;n++){let i=this.joints[n],o=this.inverseBindMatrices[n];e[n]=Wre(i,o,e[n])}};var aH=sH;function u8e(){this.pass=void 0,this.alphaCutoff=void 0}var cH=u8e;function lH(e){this.name=e,this.fields=[]}lH.prototype.addField=function(e,t){let n=`    ${e} ${t};`;this.fields.push(n)};lH.prototype.generateGlslLines=function(){let e=this.fields;return e.length===0&&(e=["    float _empty;"]),[].concat(`struct ${this.name}`,"{",e,"};")};var uH=lH;function fH(e){this.signature=e,this.body=[]}fH.prototype.addLines=function(e){if(typeof e!="string"&&!Array.isArray(e))throw new E(`Expected lines to be a string or an array of strings, actual value was ${e}`);let t=this.body;if(Array.isArray(e)){let n=e.length;for(let i=0;i<n;i++)t.push(`    ${e[i]}`)}else t.push(`    ${e}`)};fH.prototype.generateGlslLines=function(){return[].concat(this.signature,"{",this.body,"}")};var dH=fH;function Ec(){this._positionAttributeLine=void 0,this._nextAttributeLocation=1,this._attributeLocations={},this._attributeLines=[],this._structs={},this._functions={},this._vertexShaderParts={defineLines:[],uniformLines:[],shaderLines:[],varyingLines:[],structIds:[],functionIds:[]},this._fragmentShaderParts={defineLines:[],uniformLines:[],shaderLines:[],varyingLines:[],structIds:[],functionIds:[]}}Object.defineProperties(Ec.prototype,{attributeLocations:{get:function(){return this._attributeLocations}}});Ec.prototype.addDefine=function(e,t,n){A.typeOf.string("identifier",e),n=y(n,_e.BOTH);let i=e;c(t)&&(i+=` ${t.toString()}`),_e.includesVertexShader(n)&&this._vertexShaderParts.defineLines.push(i),_e.includesFragmentShader(n)&&this._fragmentShaderParts.defineLines.push(i)};Ec.prototype.addStruct=function(e,t,n){A.typeOf.string("structId",e),A.typeOf.string("structName",t),A.typeOf.number("destination",n),this._structs[e]=new uH(t),_e.includesVertexShader(n)&&this._vertexShaderParts.structIds.push(e),_e.includesFragmentShader(n)&&this._fragmentShaderParts.structIds.push(e)};Ec.prototype.addStructField=function(e,t,n){A.typeOf.string("structId",e),A.typeOf.string("type",t),A.typeOf.string("identifier",n),this._structs[e].addField(t,n)};Ec.prototype.addFunction=function(e,t,n){A.typeOf.string("functionName",e),A.typeOf.string("signature",t),A.typeOf.number("destination",n),this._functions[e]=new dH(t),_e.includesVertexShader(n)&&this._vertexShaderParts.functionIds.push(e),_e.includesFragmentShader(n)&&this._fragmentShaderParts.functionIds.push(e)};Ec.prototype.addFunctionLines=function(e,t){if(A.typeOf.string("functionName",e),typeof t!="string"&&!Array.isArray(t))throw new E(`Expected lines to be a string or an array of strings, actual value was ${t}`);this._functions[e].addLines(t)};Ec.prototype.addUniform=function(e,t,n){A.typeOf.string("type",e),A.typeOf.string("identifier",t),n=y(n,_e.BOTH);let i=`uniform ${e} ${t};`;_e.includesVertexShader(n)&&this._vertexShaderParts.uniformLines.push(i),_e.includesFragmentShader(n)&&this._fragmentShaderParts.uniformLines.push(i)};Ec.prototype.setPositionAttribute=function(e,t){if(A.typeOf.string("type",e),A.typeOf.string("identifier",t),c(this._positionAttributeLine))throw new E("setPositionAttribute() must be called exactly once for the attribute used for gl_Position. For other attributes, use addAttribute()");return this._positionAttributeLine=`in ${e} ${t};`,this._attributeLocations[t]=0,0};Ec.prototype.addAttribute=function(e,t){A.typeOf.string("type",e),A.typeOf.string("identifier",t);let n=`in ${e} ${t};`;this._attributeLines.push(n);let i=this._nextAttributeLocation;return this._attributeLocations[t]=i,this._nextAttributeLocation+=d8e(e),i};Ec.prototype.addVarying=function(e,t,n){A.typeOf.string("type",e),A.typeOf.string("identifier",t),n=c(n)?`${n} `:"";let i=`${e} ${t};`;this._vertexShaderParts.varyingLines.push(`${n}out ${i}`),this._fragmentShaderParts.varyingLines.push(`${n}in ${i}`)};Ec.prototype.addVertexLines=function(e){if(typeof e!="string"&&!Array.isArray(e))throw new E(`Expected lines to be a string or an array of strings, actual value was ${e}`);let t=this._vertexShaderParts.shaderLines;Array.isArray(e)?t.push.apply(t,e):t.push(e)};Ec.prototype.addFragmentLines=function(e){if(typeof e!="string"&&!Array.isArray(e))throw new E(`Expected lines to be a string or an array of strings, actual value was ${e}`);let t=this._fragmentShaderParts.shaderLines;Array.isArray(e)?t.push.apply(t,e):t.push(e)};Ec.prototype.buildShaderProgram=function(e){A.typeOf.object("context",e);let t=c(this._positionAttributeLine)?[this._positionAttributeLine]:[],n=f8e(this),i=h8e(this),o=t.concat(this._attributeLines,this._vertexShaderParts.uniformLines,this._vertexShaderParts.varyingLines,n.vertexLines,i.vertexLines,this._vertexShaderParts.shaderLines).join(`
`),r=new Ge({defines:this._vertexShaderParts.defineLines,sources:[o]}),s=this._fragmentShaderParts.uniformLines.concat(this._fragmentShaderParts.varyingLines,n.fragmentLines,i.fragmentLines,this._fragmentShaderParts.shaderLines).join(`
`),a=new Ge({defines:this._fragmentShaderParts.defineLines,sources:[s]});return an.fromCache({context:e,vertexShaderSource:r,fragmentShaderSource:a,attributeLocations:this._attributeLocations})};Ec.prototype.clone=function(){return qe(this,!0)};function f8e(e){let t=[],n=[],i,o=e._vertexShaderParts.structIds,r,s,a;for(i=0;i<o.length;i++)r=o[i],s=e._structs[r],a=s.generateGlslLines(),t.push.apply(t,a);for(o=e._fragmentShaderParts.structIds,i=0;i<o.length;i++)r=o[i],s=e._structs[r],a=s.generateGlslLines(),n.push.apply(n,a);return{vertexLines:t,fragmentLines:n}}function d8e(e){switch(e){case"mat2":return 2;case"mat3":return 3;case"mat4":return 4;default:return 1}}function h8e(e){let t=[],n=[],i,o=e._vertexShaderParts.functionIds,r,s,a;for(i=0;i<o.length;i++)r=o[i],s=e._functions[r],a=s.generateGlslLines(),t.push.apply(t,a);for(o=e._fragmentShaderParts.functionIds,i=0;i<o.length;i++)r=o[i],s=e._functions[r],a=s.generateGlslLines(),n.push.apply(n,a);return{vertexLines:t,fragmentLines:n}}var _w=Ec;function m8e(e){A.typeOf.object("model",e),this.shaderBuilder=new _w,this.model=e,this.uniformMap={},this.alphaOptions=new cH,this.renderStateOptions=ze.getState(ze.fromCache({depthTest:{enabled:!0,func:Kc.LESS_OR_EQUAL}})),this.hasSilhouette=!1,this.hasSkipLevelOfDetail=!1}var hH=m8e;var mH=`void silhouetteStage(inout vec4 color) {
if(model_silhouettePass) {
color = czm_gammaCorrect(model_silhouetteColor);
}
}
`;var pH=`void silhouetteStage(in ProcessedAttributes attributes, inout vec4 positionClip) {
#ifdef HAS_NORMALS
if(model_silhouettePass) {
vec3 normal = normalize(czm_normal3D * attributes.normalMC);
normal.x *= czm_projection[0][0];
normal.y *= czm_projection[1][1];
positionClip.xy += normal.xy * positionClip.w * model_silhouetteSize * czm_pixelRatio / czm_viewport.z;
}
#endif
}
`;var d1={name:"ModelSilhouettePipelineStage"};d1.silhouettesLength=0;d1.process=function(e,t,n){c(t._silhouetteId)||(t._silhouetteId=++d1.silhouettesLength);let i=e.shaderBuilder;i.addDefine("HAS_SILHOUETTE",void 0,_e.BOTH),i.addVertexLines(pH),i.addFragmentLines(mH),i.addUniform("vec4","model_silhouetteColor",_e.FRAGMENT),i.addUniform("float","model_silhouetteSize",_e.VERTEX),i.addUniform("bool","model_silhouettePass",_e.BOTH);let o={model_silhouetteColor:function(){return t.silhouetteColor},model_silhouetteSize:function(){return t.silhouetteSize},model_silhouettePass:function(){return!1}};e.uniformMap=At(o,e.uniformMap),e.hasSilhouette=!0};var _H=d1;var gH=`void modelSplitterStage()
{
#ifndef SHADOW_MAP
if (model_splitDirection < 0.0 && gl_FragCoord.x > czm_splitPosition) discard;
if (model_splitDirection > 0.0 && gl_FragCoord.x < czm_splitPosition) discard;
#endif
}
`;var h1={name:"ModelSplitterPipelineStage",SPLIT_DIRECTION_UNIFORM_NAME:"model_splitDirection"};h1.process=function(e,t,n){let i=e.shaderBuilder;i.addDefine("HAS_MODEL_SPLITTER",void 0,_e.FRAGMENT),i.addFragmentLines(gH);let o={};i.addUniform("float",h1.SPLIT_DIRECTION_UNIFORM_NAME,_e.FRAGMENT),o[h1.SPLIT_DIRECTION_UNIFORM_NAME]=function(){return t.splitDirection},e.uniformMap=At(o,e.uniformMap)};var yH=h1;function p8e(e,t){A.typeOf.object("modelRenderResources",e),A.typeOf.object("runtimeNode",t),this.model=e.model,this.shaderBuilder=e.shaderBuilder.clone(),this.uniformMap=qe(e.uniformMap),this.alphaOptions=qe(e.alphaOptions),this.renderStateOptions=qe(e.renderStateOptions,!0),this.hasSilhouette=e.hasSilhouette,this.hasSkipLevelOfDetail=e.hasSkipLevelOfDetail,this.runtimeNode=t,this.attributes=[],this.attributeIndex=1,this.featureIdVertexAttributeSetIndex=0,this.instanceCount=0}var bH=p8e;function _8e(e){e=y(e,y.EMPTY_OBJECT),this.lightingModel=y(e.lightingModel,ng.UNLIT)}var xH=_8e;function g8e(e,t){A.typeOf.object("nodeRenderResources",e),A.typeOf.object("runtimePrimitive",t),this.model=e.model,this.runtimeNode=e.runtimeNode,this.attributes=e.attributes.slice(),this.attributeIndex=e.attributeIndex,this.featureIdVertexAttributeSetIndex=e.featureIdVertexAttributeSetIndex,this.uniformMap=qe(e.uniformMap),this.alphaOptions=qe(e.alphaOptions),this.renderStateOptions=qe(e.renderStateOptions,!0),this.hasSilhouette=e.hasSilhouette,this.hasSkipLevelOfDetail=e.hasSkipLevelOfDetail,this.shaderBuilder=e.shaderBuilder.clone(),this.instanceCount=e.instanceCount,this.runtimePrimitive=t;let n=t.primitive;this.count=c(n.indices)?n.indices.count:Zt.getAttributeBySemantic(n,"POSITION").count,this.hasPropertyTable=!1,this.indices=n.indices,this.wireframeIndexBuffer=void 0,this.primitiveType=n.primitiveType;let i=Zt.getPositionMinMax(n,this.runtimeNode.instancingTranslationMin,this.runtimeNode.instancingTranslationMax);this.positionMin=h.clone(i.min,new h),this.positionMax=h.clone(i.max,new h),this.boundingSphere=ce.fromCornerPoints(this.positionMin,this.positionMax,new ce),this.lightingOptions=new xH,this.pickId=void 0}var TH=g8e;function CH(e){e=y(e,y.EMPTY_OBJECT);let t=e.command,n=e.primitiveRenderResources;A.typeOf.object("options.command",t),A.typeOf.object("options.primitiveRenderResources",n);let i=n.model;this._command=t,this._model=i,this._runtimePrimitive=n.runtimePrimitive,this._modelMatrix=t.modelMatrix,this._boundingVolume=t.boundingVolume,this._cullFace=t.renderState.cull.face;let o=i.classificationType;this._classificationType=o,this._classifiesTerrain=o!==Vn.CESIUM_3D_TILE,this._classifies3DTiles=o!==Vn.TERRAIN,this._useDebugWireframe=i._enableDebugWireframe&&i.debugWireframe,this._pickId=n.pickId,this._commandListTerrain=[],this._commandList3DTiles=[],this._commandListIgnoreShow=[],this._commandListDebugWireframe=[],this._commandListTerrainPicking=[],this._commandList3DTilesPicking=[],T8e(this)}function y8e(e){return{colorMask:{red:!1,green:!1,blue:!1,alpha:!1},stencilTest:{enabled:!0,frontFunction:e,frontOperation:{fail:ft.KEEP,zFail:ft.DECREMENT_WRAP,zPass:ft.KEEP},backFunction:e,backOperation:{fail:ft.KEEP,zFail:ft.INCREMENT_WRAP,zPass:ft.KEEP},reference:Ut.CESIUM_3D_TILE_MASK,mask:Ut.CESIUM_3D_TILE_MASK},stencilMask:Ut.CLASSIFICATION_MASK,depthTest:{enabled:!0,func:Kc.LESS_OR_EQUAL},depthMask:!1}}var b8e={stencilTest:{enabled:!0,frontFunction:Un.NOT_EQUAL,frontOperation:{fail:ft.ZERO,zFail:ft.ZERO,zPass:ft.ZERO},backFunction:Un.NOT_EQUAL,backOperation:{fail:ft.ZERO,zFail:ft.ZERO,zPass:ft.ZERO},reference:0,mask:Ut.CLASSIFICATION_MASK},stencilMask:Ut.CLASSIFICATION_MASK,depthTest:{enabled:!1},depthMask:!1,blending:hn.PRE_MULTIPLIED_ALPHA_BLEND},x8e={stencilTest:{enabled:!0,frontFunction:Un.NOT_EQUAL,frontOperation:{fail:ft.ZERO,zFail:ft.ZERO,zPass:ft.ZERO},backFunction:Un.NOT_EQUAL,backOperation:{fail:ft.ZERO,zFail:ft.ZERO,zPass:ft.ZERO},reference:0,mask:Ut.CLASSIFICATION_MASK},stencilMask:Ut.CLASSIFICATION_MASK,depthTest:{enabled:!1},depthMask:!1},Xre=[];function T8e(e){let t=e._command,n=Xre;if(e._useDebugWireframe){t.pass=ve.OPAQUE,n.length=0,n.push(t),e._commandListDebugWireframe=gw(e,n,e._commandListDebugWireframe);let r=e._commandListDebugWireframe,s=r.length;for(let a=0;a<s;a++){let l=r[a];l.count*=2,l.offset*=2}return}let o=e.model.allowPicking;if(e._classifiesTerrain){let r=ve.TERRAIN_CLASSIFICATION,s=AH(t,r),a=qre(t,r);n.length=0,n.push(s,a),e._commandListTerrain=gw(e,n,e._commandListTerrain),o&&(e._commandListTerrainPicking=Yre(e,n,e._commandListTerrainPicking))}if(e._classifies3DTiles){let r=ve.CESIUM_3D_TILE_CLASSIFICATION,s=AH(t,r),a=qre(t,r);n.length=0,n.push(s,a),e._commandList3DTiles=gw(e,n,e._commandList3DTiles),o&&(e._commandList3DTilesPicking=Yre(e,n,e._commandList3DTilesPicking))}}function gw(e,t,n){let i=e._runtimePrimitive,o=i.batchLengths,r=i.batchOffsets,s=o.length,a=t.length;for(let l=0;l<s;l++){let u=o[l],f=r[l];for(let d=0;d<a;d++){let p=t[d],g=et.shallowClone(p);g.count=u,g.offset=f,n.push(g)}}return n}function AH(e,t){let n=et.shallowClone(e);n.cull=!1,n.pass=t;let i=t===ve.TERRAIN_CLASSIFICATION?Un.ALWAYS:Un.EQUAL,o=y8e(i);return n.renderState=ze.fromCache(o),n}function qre(e,t){let n=et.shallowClone(e);return n.cull=!1,n.pass=t,n.renderState=ze.fromCache(b8e),n}var A8e=[];function Yre(e,t,n){let i=ze.fromCache(x8e),o=t[0],r=t[1],s=et.shallowClone(o);s.cull=!0,s.pickOnly=!0;let a=et.shallowClone(r);a.cull=!0,a.pickOnly=!0,a.renderState=i,a.pickId=e._pickId;let l=A8e;return l.length=0,l.push(s,a),gw(e,l,n)}Object.defineProperties(CH.prototype,{command:{get:function(){return this._command}},runtimePrimitive:{get:function(){return this._runtimePrimitive}},batchLengths:{get:function(){return this._runtimePrimitive.batchLengths}},batchOffsets:{get:function(){return this._runtimePrimitive.batchOffsets}},model:{get:function(){return this._model}},classificationType:{get:function(){return this._classificationType}},modelMatrix:{get:function(){return this._modelMatrix},set:function(e){this._modelMatrix=k.clone(e,this._modelMatrix);let t=this._runtimePrimitive.boundingSphere;this._boundingVolume=ce.transform(t,this._modelMatrix,this._boundingVolume)}},boundingVolume:{get:function(){return this._boundingVolume}},cullFace:{get:function(){return this._cullFace},set:function(e){this._cullFace=e}}});CH.prototype.pushCommands=function(e,t){let n=e.passes;if(n.render){if(this._useDebugWireframe){t.push.apply(t,this._commandListDebugWireframe);return}if(this._classifiesTerrain&&t.push.apply(t,this._commandListTerrain),this._classifies3DTiles&&t.push.apply(t,this._commandList3DTiles),e.invertClassification&&this._classifies3DTiles){if(this._commandListIgnoreShow.length===0){let o=ve.CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW,r=AH(this._command,o),s=Xre;s.length=0,s.push(r),this._commandListIgnoreShow=gw(this,s,this._commandListIgnoreShow)}t.push.apply(t,this._commandListIgnoreShow)}}return n.pick&&(this._classifiesTerrain&&t.push.apply(t,this._commandListTerrainPicking),this._classifies3DTiles&&t.push.apply(t,this._commandList3DTilesPicking)),t};var EH=CH;function m1(e){e=y(e,y.EMPTY_OBJECT);let t=e.command,n=e.primitiveRenderResources;A.typeOf.object("options.command",t),A.typeOf.object("options.primitiveRenderResources",n);let i=n.model;this._model=i;let o=n.runtimePrimitive;this._runtimePrimitive=o;let r=t.pass===ve.TRANSLUCENT,a=!o.primitive.material.doubleSided&&!r,l=n.hasSilhouette,u=!r&&!l,f=n.hasSkipLevelOfDetail&&!r,d=l;this._command=t,this._modelMatrix=k.clone(t.modelMatrix),this._boundingVolume=ce.clone(t.boundingVolume),this._modelMatrix2D=new k,this._boundingVolume2D=new ce,this._modelMatrix2DDirty=!1,this._backFaceCulling=t.renderState.cull.enabled,this._cullFace=t.renderState.cull.face,this._shadows=i.shadows,this._debugShowBoundingVolume=t.debugShowBoundingVolume,this._usesBackFaceCulling=a,this._needsTranslucentCommand=u,this._needsSkipLevelOfDetailCommands=f,this._needsSilhouetteCommands=d,this._originalCommand=void 0,this._translucentCommand=void 0,this._skipLodBackfaceCommand=void 0,this._skipLodStencilCommand=void 0,this._silhouetteModelCommand=void 0,this._silhouetteColorCommand=void 0,this._derivedCommands=[],this._has2DCommands=!1,C8e(this)}function hp(e){this.command=e.command,this.updateShadows=e.updateShadows,this.updateBackFaceCulling=e.updateBackFaceCulling,this.updateCullFace=e.updateCullFace,this.updateDebugShowBoundingVolume=e.updateDebugShowBoundingVolume,this.is2D=y(e.is2D,!1),this.derivedCommand2D=void 0}hp.clone=function(e){return new hp({command:e.command,updateShadows:e.updateShadows,updateBackFaceCulling:e.updateBackFaceCulling,updateCullFace:e.updateCullFace,updateDebugShowBoundingVolume:e.updateDebugShowBoundingVolume,is2D:e.is2D,derivedCommand2D:e.derivedCommand2D})};function C8e(e){let t=e._command;t.modelMatrix=e._modelMatrix,t.boundingVolume=e._boundingVolume;let n=e._model,i=e._usesBackFaceCulling,o=e._derivedCommands;e._originalCommand=new hp({command:t,updateShadows:!0,updateBackFaceCulling:i,updateCullFace:i,updateDebugShowBoundingVolume:!0,is2D:!1}),o.push(e._originalCommand),e._needsTranslucentCommand&&(e._translucentCommand=new hp({command:I8e(t),updateShadows:!0,updateBackFaceCulling:!1,updateCullFace:!1,updateDebugShowBoundingVolume:!0}),o.push(e._translucentCommand)),e._needsSkipLevelOfDetailCommands&&(e._skipLodBackfaceCommand=new hp({command:F8e(t),updateShadows:!1,updateBackFaceCulling:!1,updateCullFace:i,updateDebugShowBoundingVolume:!1}),e._skipLodStencilCommand=new hp({command:B8e(t,n),updateShadows:!0,updateBackFaceCulling:i,updateCullFace:i,updateDebugShowBoundingVolume:!0}),o.push(e._skipLodBackfaceCommand),o.push(e._skipLodStencilCommand)),e._needsSilhouetteCommands&&(e._silhouetteModelCommand=new hp({command:O8e(t,n),updateShadows:!0,updateBackFaceCulling:i,updateCullFace:i,updateDebugShowBoundingVolume:!0}),e._silhouetteColorCommand=new hp({command:R8e(t,n),updateShadows:!1,updateBackFaceCulling:!1,updateCullFace:!1,updateDebugShowBoundingVolume:!1}),o.push(e._silhouetteModelCommand),o.push(e._silhouetteColorCommand))}Object.defineProperties(m1.prototype,{command:{get:function(){return this._command}},runtimePrimitive:{get:function(){return this._runtimePrimitive}},model:{get:function(){return this._model}},primitiveType:{get:function(){return this._command.primitiveType}},modelMatrix:{get:function(){return this._modelMatrix},set:function(e){this._modelMatrix=k.clone(e,this._modelMatrix),this._modelMatrix2DDirty=!0,this._boundingVolume=ce.transform(this.runtimePrimitive.boundingSphere,this._modelMatrix,this._boundingVolume)}},boundingVolume:{get:function(){return this._boundingVolume}},shadows:{get:function(){return this._shadows},set:function(e){this._shadows=e,S8e(this)}},backFaceCulling:{get:function(){return this._backFaceCulling},set:function(e){this._backFaceCulling!==e&&(this._backFaceCulling=e,w8e(this))}},cullFace:{get:function(){return this._cullFace},set:function(e){this._cullFace!==e&&(this._cullFace=e,v8e(this))}},debugShowBoundingVolume:{get:function(){return this._debugShowBoundingVolume},set:function(e){this._debugShowBoundingVolume!==e&&(this._debugShowBoundingVolume=e,D8e(this))}}});function E8e(e,t){let n=e._modelMatrix;e._modelMatrix2D=k.clone(n,e._modelMatrix2D),e._modelMatrix2D[13]-=R.sign(n[13])*2*R.PI*t.mapProjection.ellipsoid.maximumRadius,e._boundingVolume2D=ce.transform(e.runtimePrimitive.boundingSphere,e._modelMatrix2D,e._boundingVolume2D)}function S8e(e){let t=e.shadows,n=En.castShadows(t),i=En.receiveShadows(t),o=e._derivedCommands;for(let r=0;r<o.length;++r){let s=o[r];if(s.updateShadows){let a=s.command;a.castShadows=n,a.receiveShadows=i}}}function w8e(e){let t=e.backFaceCulling,n=e._derivedCommands;for(let i=0;i<n.length;++i){let o=n[i];if(o.updateBackFaceCulling){let r=o.command,s=qe(r.renderState,!0);s.cull.enabled=t,r.renderState=ze.fromCache(s)}}}function v8e(e){let t=e.cullFace,n=e._derivedCommands;for(let i=0;i<n.length;++i){let o=n[i];if(o.updateCullFace){let r=o.command,s=qe(r.renderState,!0);s.cull.face=t,r.renderState=ze.fromCache(s)}}}function D8e(e){let t=e.debugShowBoundingVolume,n=e._derivedCommands;for(let i=0;i<n.length;++i){let o=n[i];if(o.updateDebugShowBoundingVolume){let r=o.command;r.debugShowBoundingVolume=t}}}m1.prototype.pushCommands=function(e,t){let n=Kre(this,e);n&&!this._has2DCommands&&(P8e(this),this._has2DCommands=!0,this._modelMatrix2DDirty=!0),this._modelMatrix2DDirty&&(E8e(this,e),this._modelMatrix2DDirty=!1);let i=this.model.styleCommandsNeeded;if(!(this._needsTranslucentCommand&&c(i)&&(i!==dp.ALL_OPAQUE&&FT(t,this._translucentCommand,n),i===dp.ALL_TRANSLUCENT))){if(this._needsSkipLevelOfDetailCommands){let{tileset:o,tile:r}=this._model.content;if(o.hasMixedContent){r._finalResolution||FT(o._backfaceCommands,this._skipLodBackfaceCommand,n),M8e(this,r,n),FT(t,this._skipLodStencilCommand,n);return}}if(this._needsSilhouetteCommands){FT(t,this._silhouetteModelCommand,n);return}return FT(t,this._originalCommand,n),t}};m1.prototype.pushSilhouetteCommands=function(e,t){let n=Kre(this,e);return FT(t,this._silhouetteColorCommand,n),t};function FT(e,t,n){e.push(t.command),n&&e.push(t.derivedCommand2D.command)}function Kre(e,t){if(t.mode!==oe.SCENE2D||e.model._projectTo2D)return!1;let i=e.model.sceneGraph._boundingSphere2D,o=i.center.y-i.radius,r=i.center.y+i.radius,s=t.mapProjection.ellipsoid.maximumRadius*R.PI;return o<s&&r>s||o<-s&&r>-s}function NT(e,t){if(!c(t))return;let n=hp.clone(t),i=et.shallowClone(t.command);return i.modelMatrix=e._modelMatrix2D,i.boundingVolume=e._boundingVolume2D,n.command=i,n.updateShadows=!1,n.is2D=!0,t.derivedCommand2D=n,e._derivedCommands.push(n),n}function P8e(e){NT(e,e._originalCommand),NT(e,e._translucentCommand),NT(e,e._skipLodBackfaceCommand),NT(e,e._skipLodStencilCommand),NT(e,e._silhouetteModelCommand),NT(e,e._silhouetteColorCommand)}function I8e(e){let t=et.shallowClone(e);t.pass=ve.TRANSLUCENT;let n=qe(e.renderState,!0);return n.cull.enabled=!1,n.depthMask=!1,n.blending=hn.ALPHA_BLEND,t.renderState=ze.fromCache(n),t}function O8e(e,t){let n=t._silhouetteId%255,i=et.shallowClone(e),o=qe(e.renderState,!0);return o.stencilTest={enabled:!0,frontFunction:ne.ALWAYS,backFunction:ne.ALWAYS,reference:n,mask:-1,frontOperation:{fail:ne.KEEP,zFail:ne.KEEP,zPass:ne.REPLACE},backOperation:{fail:ne.KEEP,zFail:ne.KEEP,zPass:ne.REPLACE}},t.isInvisible()&&(o.colorMask={red:!1,green:!1,blue:!1,alpha:!1}),i.renderState=ze.fromCache(o),i}function R8e(e,t){let n=t._silhouetteId%255,i=et.shallowClone(e),o=qe(e.renderState,!0);o.cull.enabled=!1,(e.pass===ve.TRANSLUCENT||t.silhouetteColor.alpha<1)&&(i.pass=ve.TRANSLUCENT,o.depthMask=!1,o.blending=hn.ALPHA_BLEND),o.stencilTest={enabled:!0,frontFunction:ne.NOTEQUAL,backFunction:ne.NOTEQUAL,reference:n,mask:-1,frontOperation:{fail:ne.KEEP,zFail:ne.KEEP,zPass:ne.KEEP},backOperation:{fail:ne.KEEP,zFail:ne.KEEP,zPass:ne.KEEP}};let s=qe(e.uniformMap);return s.model_silhouettePass=function(){return!0},i.renderState=ze.fromCache(o),i.uniformMap=s,i.castShadows=!1,i.receiveShadows=!1,i}function M8e(e,t,n){let i=e._skipLodStencilCommand,o=i.command,r=t._selectionDepth,s=L8e(o);if(r!==s){let a=N8e(r),l=qe(o.renderState,!0);l.stencilTest.reference=a,o.renderState=ze.fromCache(l),n&&(i.derivedCommand2D.renderState=l)}}function L8e(e){return(e.renderState.stencilTest.reference&Ut.SKIP_LOD_MASK)>>>Ut.SKIP_LOD_BIT_SHIFT}function N8e(e){return Ut.CESIUM_3D_TILE_MASK|e<<Ut.SKIP_LOD_BIT_SHIFT}function F8e(e){let t=et.shallowClone(e),n=qe(e.renderState,!0);n.cull.enabled=!0,n.cull.face=xi.FRONT,n.colorMask={red:!1,green:!1,blue:!1,alpha:!1},n.polygonOffset={enabled:!0,factor:5,units:5};let i=qe(t.uniformMap),o=new H(5,5);return i.u_polygonOffset=function(){return o},t.renderState=ze.fromCache(n),t.uniformMap=i,t.castShadows=!1,t.receiveShadows=!1,t}function B8e(e){let t=et.shallowClone(e),n=qe(e.renderState,!0),{stencilTest:i}=n;return i.enabled=!0,i.mask=Ut.SKIP_LOD_MASK,i.reference=Ut.CESIUM_3D_TILE_MASK,i.frontFunction=Un.GREATER_OR_EQUAL,i.frontOperation.zPass=ft.REPLACE,i.backFunction=Un.GREATER_OR_EQUAL,i.backOperation.zPass=ft.REPLACE,n.stencilMask=Ut.CESIUM_3D_TILE_MASK|Ut.SKIP_LOD_MASK,t.renderState=ze.fromCache(n),t}var SH=m1;var wH=`precision highp float;
czm_modelVertexOutput defaultVertexOutput(vec3 positionMC) {
czm_modelVertexOutput vsOutput;
vsOutput.positionMC = positionMC;
vsOutput.pointSize = 1.0;
return vsOutput;
}
void main()
{
ProcessedAttributes attributes;
initializeAttributes(attributes);
#ifdef USE_DEQUANTIZATION
dequantizationStage(attributes);
#endif
#ifdef HAS_MORPH_TARGETS
morphTargetsStage(attributes);
#endif
#ifdef HAS_SKINNING
skinningStage(attributes);
#endif
#ifdef HAS_PRIMITIVE_OUTLINE
primitiveOutlineStage();
#endif
#ifdef HAS_BITANGENTS
attributes.bitangentMC = normalize(cross(attributes.normalMC, attributes.tangentMC) * attributes.tangentSignMC);
#endif
FeatureIds featureIds;
featureIdStage(featureIds, attributes);
#ifdef HAS_SELECTED_FEATURE_ID
SelectedFeature feature;
selectedFeatureIdStage(feature, featureIds);
cpuStylingStage(attributes.positionMC, feature);
#endif
#if defined(USE_2D_POSITIONS) || defined(USE_2D_INSTANCING)
mat4 modelView = czm_modelView3D;
mat3 normal = czm_normal3D;
#else
mat4 modelView = czm_modelView;
mat3 normal = czm_normal;
#endif
#ifdef HAS_INSTANCING
#ifdef USE_LEGACY_INSTANCING
mat4 instanceModelView;
mat3 instanceModelViewInverseTranspose;
legacyInstancingStage(attributes, instanceModelView, instanceModelViewInverseTranspose);
modelView = instanceModelView;
normal = instanceModelViewInverseTranspose;
#else
instancingStage(attributes);
#endif
#ifdef USE_PICKING
v_pickColor = a_pickColor;
#endif
#endif
Metadata metadata;
MetadataClass metadataClass;
MetadataStatistics metadataStatistics;
metadataStage(metadata, metadataClass, metadataStatistics, attributes);
#ifdef HAS_VERTICAL_EXAGGERATION
verticalExaggerationStage(attributes);
#endif
#ifdef HAS_CUSTOM_VERTEX_SHADER
czm_modelVertexOutput vsOutput = defaultVertexOutput(attributes.positionMC);
customShaderStage(vsOutput, attributes, featureIds, metadata, metadataClass, metadataStatistics);
#endif
vec4 positionClip = geometryStage(attributes, modelView, normal);
#ifdef HAS_ATMOSPHERE
atmosphereStage(attributes);
#endif
#ifdef ENABLE_CLIPPING_POLYGONS
modelClippingPolygonsStage(attributes);
#endif
#ifdef HAS_SILHOUETTE
silhouetteStage(attributes, positionClip);
#endif
#ifdef HAS_POINT_CLOUD_SHOW_STYLE
float show = pointCloudShowStylingStage(attributes, metadata);
#else
float show = 1.0;
#endif
#ifdef HAS_POINT_CLOUD_BACK_FACE_CULLING
show *= pointCloudBackFaceCullingStage();
#endif
#ifdef HAS_POINT_CLOUD_COLOR_STYLE
v_pointCloudColor = pointCloudColorStylingStage(attributes, metadata);
#endif
#ifdef PRIMITIVE_TYPE_POINTS
#ifdef HAS_CUSTOM_VERTEX_SHADER
gl_PointSize = vsOutput.pointSize;
#elif defined(HAS_POINT_CLOUD_POINT_SIZE_STYLE) || defined(HAS_POINT_CLOUD_ATTENUATION)
gl_PointSize = pointCloudPointSizeStylingStage(attributes, metadata);
#else
gl_PointSize = 1.0;
#endif
gl_PointSize *= show;
#endif
gl_Position = show * positionClip;
}
`;var vH=`precision highp float;
czm_modelMaterial defaultModelMaterial()
{
czm_modelMaterial material;
material.diffuse = vec3(0.0);
material.specular = vec3(1.0);
material.roughness = 1.0;
material.occlusion = 1.0;
material.normalEC = vec3(0.0, 0.0, 1.0);
material.emissive = vec3(0.0);
material.alpha = 1.0;
return material;
}
vec4 handleAlpha(vec3 color, float alpha)
{
#ifdef ALPHA_MODE_MASK
if (alpha < u_alphaCutoff) {
discard;
}
#endif
return vec4(color, alpha);
}
SelectedFeature selectedFeature;
void main()
{
#ifdef HAS_MODEL_SPLITTER
modelSplitterStage();
#endif
czm_modelMaterial material = defaultModelMaterial();
ProcessedAttributes attributes;
geometryStage(attributes);
FeatureIds featureIds;
featureIdStage(featureIds, attributes);
Metadata metadata;
MetadataClass metadataClass;
MetadataStatistics metadataStatistics;
metadataStage(metadata, metadataClass, metadataStatistics, attributes);
#ifndef METADATA_PICKING_ENABLED
#ifdef HAS_SELECTED_FEATURE_ID
selectedFeatureIdStage(selectedFeature, featureIds);
#endif
#ifndef CUSTOM_SHADER_REPLACE_MATERIAL
materialStage(material, attributes, selectedFeature);
#endif
#ifdef HAS_CUSTOM_FRAGMENT_SHADER
customShaderStage(material, attributes, featureIds, metadata, metadataClass, metadataStatistics);
#endif
lightingStage(material, attributes);
#ifdef HAS_SELECTED_FEATURE_ID
cpuStylingStage(material, selectedFeature);
#endif
#ifdef HAS_MODEL_COLOR
modelColorStage(material);
#endif
#ifdef HAS_PRIMITIVE_OUTLINE
primitiveOutlineStage(material);
#endif
vec4 color = handleAlpha(material.diffuse, material.alpha);
#else
vec4 metadataValues = vec4(0.0, 0.0, 0.0, 0.0);
metadataPickingStage(metadata, metadataClass, metadataValues);
vec4 color = metadataValues;
#endif
#ifdef HAS_CLIPPING_PLANES
modelClippingPlanesStage(color);
#endif
#ifdef ENABLE_CLIPPING_POLYGONS
modelClippingPolygonsStage();
#endif
#ifndef METADATA_PICKING_ENABLED
#if defined(HAS_SILHOUETTE) && defined(HAS_NORMALS)
silhouetteStage(color);
#endif
#ifdef HAS_ATMOSPHERE
atmosphereStage(color, attributes);
#endif
#endif
out_FragColor = color;
}
`;function $re(){}$re.buildModelDrawCommand=function(e,t){let n=e.shaderBuilder,i=k8e(e,n,t),o=V8e(e,i,t),r=e.model;return c(r.classificationType)?new EH({primitiveRenderResources:e,command:o}):new SH({primitiveRenderResources:e,command:o})};function k8e(e,t,n){t.addVertexLines(wH),t.addFragmentLines(vH);let i=e.model,o=t.buildShaderProgram(n.context);return i._pipelineResources.push(o),o}function V8e(e,t,n){let i=U8e(e),o=new ni({context:n.context,indexBuffer:i,attributes:e.attributes}),r=e.model;r._pipelineResources.push(o);let s=e.alphaOptions.pass,a=r.sceneGraph,l=n.mode===oe.SCENE3D,u,f;if(!l&&!n.scene3DOnly&&r._projectTo2D)u=k.multiplyTransformation(a._computedModelMatrix,e.runtimeNode.computedTransform,new k),f=e.runtimePrimitive.boundingSphere2D;else{let T=l?a._computedModelMatrix:a._computedModelMatrix2D;u=k.multiplyTransformation(T,e.runtimeNode.computedTransform,new k),f=ce.transform(e.boundingSphere,u)}let d=qe(ze.fromCache(e.renderStateOptions),!0);d.cull.face=Zt.getCullFace(u,e.primitiveType),d=ze.fromCache(d);let p=c(r.classificationType),g=p?!1:En.castShadows(r.shadows),m=p?!1:En.receiveShadows(r.shadows),b=p?void 0:e.pickId;return new et({boundingVolume:f,modelMatrix:u,uniformMap:e.uniformMap,renderState:d,vertexArray:o,shaderProgram:t,cull:r.cull,pass:s,count:e.count,owner:r,pickId:b,pickMetadataAllowed:!0,instanceCount:e.instanceCount,primitiveType:e.primitiveType,debugShowBoundingVolume:r.debugShowBoundingVolume,castShadows:g,receiveShadows:m})}function U8e(e){let t=e.wireframeIndexBuffer;if(c(t))return t;let n=e.indices;if(c(n)){if(!c(n.buffer))throw new E("Indices must be provided as a Buffer");return n.buffer}}var DH=$re;function jl(e){e=y(e,y.EMPTY_OBJECT);let t=e.modelComponents;A.typeOf.object("options.model",e.model),A.typeOf.object("options.modelComponents",t),this._model=e.model,this._components=t,this._pipelineStages=[],this._updateStages=[],this._runtimeNodes=[],this._rootNodes=[],this._skinnedNodes=[],this._runtimeSkins=[],this.modelPipelineStages=[],this._boundingSphere=void 0,this._boundingSphere2D=void 0,this._computedModelMatrix=k.clone(k.IDENTITY),this._computedModelMatrix2D=k.clone(k.IDENTITY),this._axisCorrectionMatrix=Zt.getAxisCorrectionMatrix(t.upAxis,t.forwardAxis,new k),this._runtimeArticulations={},z8e(this)}Object.defineProperties(jl.prototype,{components:{get:function(){return this._components}},computedModelMatrix:{get:function(){return this._computedModelMatrix}},axisCorrectionMatrix:{get:function(){return this._axisCorrectionMatrix}},boundingSphere:{get:function(){return this._boundingSphere}}});function z8e(e){let t=e._components,n=t.scene,o=e._model.modelMatrix;Zre(e,o);let r=t.articulations,s=r.length,a=e._runtimeArticulations;for(let C=0;C<s;C++){let S=r[C],v=new J4({articulation:S,sceneGraph:e}),D=v.name;a[D]=v}let l=t.nodes,u=l.length;e._runtimeNodes=new Array(u);let d=n.nodes.length,p=k.IDENTITY;for(let C=0;C<d;C++){let S=n.nodes[C],v=Jre(e,S,p);e._rootNodes.push(v)}let g=t.skins,m=e._runtimeSkins,b=g.length;for(let C=0;C<b;C++){let S=g[C];m.push(new aH({skin:S,sceneGraph:e}))}let x=e._skinnedNodes,T=x.length;for(let C=0;C<T;C++){let S=x[C],v=e._runtimeNodes[S],I=l[S].skin.index;v._runtimeSkin=m[I],v.updateJointMatrices()}e.applyArticulations()}function Zre(e,t){let n=e._components,i=e._model;e._computedModelMatrix=k.multiplyTransformation(t,n.transform,e._computedModelMatrix),e._computedModelMatrix=k.multiplyTransformation(e._computedModelMatrix,e._axisCorrectionMatrix,e._computedModelMatrix),e._computedModelMatrix=k.multiplyByUniformScale(e._computedModelMatrix,i.computedScale,e._computedModelMatrix)}var H8e=new h;function G8e(e,t){let n=e._computedModelMatrix,i=k.getTranslation(n,H8e);if(!h.equals(i,h.ZERO))e._computedModelMatrix2D=Ft.basisTo2D(t.mapProjection,n,e._computedModelMatrix2D);else{let o=e.boundingSphere.center,r=Ft.ellipsoidTo2DModelMatrix(t.mapProjection,o,e._computedModelMatrix2D);e._computedModelMatrix2D=k.multiply(r,n,e._computedModelMatrix2D)}e._boundingSphere2D=ce.transform(e._boundingSphere,e._computedModelMatrix2D,e._boundingSphere2D)}function Jre(e,t,n){let i=[],o=Zt.getNodeTransform(t),r=t.children.length;for(let f=0;f<r;f++){let d=t.children[f],p=k.multiplyTransformation(n,o,new k),g=Jre(e,d,p);i.push(g)}let s=new g8({node:t,transform:o,transformToRoot:n,children:i,sceneGraph:e}),a=t.primitives.length;for(let f=0;f<a;f++)s.runtimePrimitives.push(new rH({primitive:t.primitives[f],node:t,model:e._model}));let l=t.index;e._runtimeNodes[l]=s,c(t.skin)&&e._skinnedNodes.push(l);let u=t.name;if(c(u)){let f=e._model,d=new r8(f,s);f._nodesByName[u]=d}return l}var j8e=new h,W8e=new h,q8e=new h,Y8e=new h;jl.prototype.buildDrawCommands=function(e){let t=this._model,n=new hH(t);t.statistics.clear(),this.configurePipeline(e);let i=this.modelPipelineStages,o,r,s;for(o=0;o<i.length;o++)i[o].process(n,t,e);let a=h.fromElements(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,j8e),l=h.fromElements(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,W8e);for(o=0;o<this._runtimeNodes.length;o++){let u=this._runtimeNodes[o];if(!c(u))continue;u.configurePipeline();let f=u.pipelineStages,d=new bH(n,u);for(r=0;r<f.length;r++)f[r].process(d,u.node,e);let p=u.computedTransform;for(r=0;r<u.runtimePrimitives.length;r++){let g=u.runtimePrimitives[r];g.configurePipeline(e);let m=g.pipelineStages,b=new TH(d,g);for(s=0;s<m.length;s++)m[s].process(b,g.primitive,e);g.boundingSphere=ce.clone(b.boundingSphere,new ce);let x=k.multiplyByPoint(p,b.positionMin,q8e),T=k.multiplyByPoint(p,b.positionMax,Y8e);h.minimumByComponent(a,x,a),h.maximumByComponent(l,T,l);let C=DH.buildModelDrawCommand(b,e);g.drawCommand=C}}this._boundingSphere=ce.fromCornerPoints(a,l,new ce),this._boundingSphere=ce.transformWithoutScale(this._boundingSphere,this._axisCorrectionMatrix,this._boundingSphere),this._boundingSphere=ce.transform(this._boundingSphere,this._components.transform,this._boundingSphere),t._boundingSphere=ce.transform(this._boundingSphere,t.modelMatrix,t._boundingSphere),t._initialRadius=t._boundingSphere.radius,t._boundingSphere.radius*=t._clampedScale};jl.prototype.configurePipeline=function(e){let t=this.modelPipelineStages;t.length=0;let n=this._model,i=e.fog.enabled&&e.fog.renderable;c(n.color)&&t.push(IT),!c(n.classificationType)&&(n.imageBasedLighting.enabled&&t.push(X4),n.isClippingEnabled()&&t.push(t8),n.isClippingPolygonsEnabled()&&t.push(o8),n.hasSilhouette(e)&&t.push(_H),c(n.splitDirection)&&n.splitDirection!==$r.NONE&&t.push(yH),Rr.is3DTiles(n.type)&&t.push(G4),i&&t.push(q4))};jl.prototype.update=function(e,t){let n,i,o;for(n=0;n<this._runtimeNodes.length;n++){let r=this._runtimeNodes[n];if(!c(r))continue;for(i=0;i<r.updateStages.length;i++)r.updateStages[i].update(r,this,e);let s=e.mode!==oe.SCENE3D&&this._model._projectTo2D;for(t&&!s&&this.updateJointMatrices(),i=0;i<r.runtimePrimitives.length;i++){let a=r.runtimePrimitives[i];for(o=0;o<a.updateStages.length;o++)a.updateStages[o].update(a,this)}}};jl.prototype.updateModelMatrix=function(e,t){Zre(this,e),t.mode!==oe.SCENE3D&&G8e(this,t);let n=this._rootNodes;for(let i=0;i<n.length;i++){let o=this._runtimeNodes[n[i]];o._transformDirty=!0}};jl.prototype.updateJointMatrices=function(){let e=this._skinnedNodes,t=e.length;for(let n=0;n<t;n++){let i=e[n];this._runtimeNodes[i].updateJointMatrices()}};function Qre(e,t,n,i,o){if(n&&!t.show)return;let r=t.children.length;for(let l=0;l<r;l++){let u=t.getChild(l);Qre(e,u,n,i,o)}let s=t.runtimePrimitives,a=s.length;for(let l=0;l<a;l++){let u=s[l];i(u,o)}}function p1(e,t,n,i){let o=e._rootNodes,r=o.length;for(let s=0;s<r;s++){let a=o[s],l=e._runtimeNodes[a];Qre(e,l,t,n,i)}}var X8e={backFaceCulling:void 0};jl.prototype.updateBackFaceCulling=function(e){let t=X8e;t.backFaceCulling=e,p1(this,!1,K8e,t)};function K8e(e,t){let n=e.drawCommand;n.backFaceCulling=t.backFaceCulling}var $8e={shadowMode:void 0};jl.prototype.updateShadows=function(e){let t=$8e;t.shadowMode=e,p1(this,!1,Z8e,t)};function Z8e(e,t){let n=e.drawCommand;n.shadows=t.shadowMode}var J8e={debugShowBoundingVolume:void 0};jl.prototype.updateShowBoundingVolume=function(e){let t=J8e;t.debugShowBoundingVolume=e,p1(this,!1,Q8e,t)};function Q8e(e,t){let n=e.drawCommand;n.debugShowBoundingVolume=t.debugShowBoundingVolume}var ese=[],eHe={frameState:void 0,hasSilhouette:void 0};jl.prototype.pushDrawCommands=function(e){let t=ese;t.length=0;let n=eHe;n.hasSilhouette=this._model.hasSilhouette(e),n.frameState=e,p1(this,!0,tHe,n),e.commandList.push.apply(e.commandList,t)};function tHe(e,t){let n=t.frameState,i=t.hasSilhouette,o=n.passes,r=ese,s=e.drawCommand;s.pushCommands(n,n.commandList),i&&!o.pick&&s.pushSilhouetteCommands(n,r)}jl.prototype.setArticulationStage=function(e,t){let n=e.split(" ");if(n.length!==2)return;let i=n[0],o=n[1],r=this._runtimeArticulations[i];c(r)&&r.setArticulationStage(o,t)};jl.prototype.applyArticulations=function(){let e=this._runtimeArticulations;for(let t in e)e.hasOwnProperty(t)&&e[t].apply()};var PH=jl;function BT(){this.pointsLength=0,this.trianglesLength=0,this.geometryByteLength=0,this.texturesByteLength=0,this.propertyTablesByteLength=0,this._bufferIdSet={},this._textureIdSet={},this._batchTextureIdMap=new St}Object.defineProperties(BT.prototype,{batchTexturesByteLength:{get:function(){let e=this._batchTextureIdMap.length,t=this._batchTextureIdMap.values,n=0;for(let i=0;i<e;i++)n+=t[i].byteLength;return n}}});BT.prototype.clear=function(){this.pointsLength=0,this.trianglesLength=0,this.geometryByteLength=0,this.texturesByteLength=0,this.propertyTablesByteLength=0,this._bufferIdSet={},this._textureIdSet={},this._batchTextureIdMap.removeAll()};BT.prototype.addBuffer=function(e,t){if(A.typeOf.object("buffer",e),A.typeOf.bool("hasCpuCopy",t),!this._bufferIdSet.hasOwnProperty(e._id)){let n=t?2:1;this.geometryByteLength+=e.sizeInBytes*n}this._bufferIdSet[e._id]=!0};BT.prototype.addTexture=function(e){A.typeOf.object("texture",e),this._textureIdSet.hasOwnProperty(e._id)||(this.texturesByteLength+=e.sizeInBytes),this._textureIdSet[e._id]=!0};BT.prototype.addBatchTexture=function(e){A.typeOf.object("batchTexture",e),this._batchTextureIdMap.contains(e._id)||this._batchTextureIdMap.set(e._id,e)};var IH=BT;var ose=Ur(UP(),1);var tse={},M0=Uint32Array.BYTES_PER_ELEMENT;tse.parse=function(e,t){t=y(t,0),A.defined("arrayBuffer",e);let n=new Uint8Array(e),i=new DataView(e);t+=M0;let o=i.getUint32(t,!0);if(o!==1)throw new ue(`Only Point Cloud tile version 1 is supported.  Version ${o} is not.`);t+=M0,t+=M0;let r=i.getUint32(t,!0);if(r===0)throw new ue("Feature table must have a byte length greater than zero");t+=M0;let s=i.getUint32(t,!0);t+=M0;let a=i.getUint32(t,!0);t+=M0;let l=i.getUint32(t,!0);t+=M0;let u=Ho(n,t,r);t+=r;let f=new Uint8Array(e,t,s);t+=s;let d,p;a>0&&(d=Ho(n,t,a),t+=a,l>0&&(p=new Uint8Array(e,t,l),t+=l));let g=new ap(u,f),m=g.getGlobalProperty("POINTS_LENGTH");if(g.featuresLength=m,!c(m))throw new ue("Feature table global property: POINTS_LENGTH must be defined");let b=g.getGlobalProperty("RTC_CENTER",$.FLOAT,3);c(b)&&(b=h.unpack(b));let x=nHe(g,d);if(x.rtcCenter=b,x.pointsLength=m,!x.hasPositions){let T=iHe(g);x.positions=T,x.hasPositions=x.hasPositions||c(T)}if(!x.hasPositions)throw new ue("Either POSITION or POSITION_QUANTIZED must be defined.");if(!x.hasNormals){let T=rHe(g);x.normals=T,x.hasNormals=x.hasNormals||c(T)}if(!x.hasColors){let T=oHe(g);x.colors=T,x.hasColors=x.hasColors||c(T),x.hasConstantColor=c(x.constantColor),x.isTranslucent=c(T)&&T.isTranslucent}if(!x.hasBatchIds){let T=sHe(g);x.batchIds=T,x.hasBatchIds=x.hasBatchIds||c(T)}if(x.hasBatchIds){let T=g.getGlobalProperty("BATCH_LENGTH");if(!c(T))throw new ue("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");x.batchLength=T}return c(p)&&(p=new Uint8Array(p),x.batchTableJson=d,x.batchTableBinary=p),x};function nHe(e,t){let n=e.json,i,o,r,s=c(n.extensions)?n.extensions["3DTILES_draco_point_compression"]:void 0,a=c(t)&&c(t.extensions)?t.extensions["3DTILES_draco_point_compression"]:void 0;c(a)&&(r=a.properties);let l,u,f,d,p;if(c(s)){o=s.properties;let m=s.byteOffset,b=s.byteLength;if(!c(o)||!c(m)||!c(b))throw new ue("Draco properties, byteOffset, and byteLength must be defined");i=e.buffer.slice(m,m+b),l=c(o.POSITION),u=c(o.RGB)||c(o.RGBA),f=c(o.NORMAL),d=c(o.BATCH_ID),p=c(o.RGBA)}let g;return c(i)&&(g={buffer:i,featureTableProperties:o,batchTableProperties:r,properties:At(o,r),dequantizeInShader:!0}),{draco:g,hasPositions:l,hasColors:u,isTranslucent:p,hasNormals:f,hasBatchIds:d}}function iHe(e){let t=e.json,n;if(c(t.POSITION))return n=e.getPropertyArray("POSITION",$.FLOAT,3),{name:Ct.POSITION,semantic:Ct.POSITION,typedArray:n,isQuantized:!1,componentDatatype:$.FLOAT,type:cn.VEC3};if(c(t.POSITION_QUANTIZED)){n=e.getPropertyArray("POSITION_QUANTIZED",$.UNSIGNED_SHORT,3);let i=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",$.FLOAT,3);if(!c(i))throw new ue("Global property: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");let o=65535,r=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",$.FLOAT,3);if(!c(r))throw new ue("Global property: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");return{name:Ct.POSITION,semantic:Ct.POSITION,typedArray:n,isQuantized:!0,componentDatatype:$.FLOAT,type:cn.VEC3,quantizedRange:o,quantizedVolumeOffset:h.unpack(r),quantizedVolumeScale:h.unpack(i),quantizedComponentDatatype:$.UNSIGNED_SHORT,quantizedType:cn.VEC3}}}function oHe(e){let t=e.json,n;if(c(t.RGBA))return n=e.getPropertyArray("RGBA",$.UNSIGNED_BYTE,4),{name:Ct.COLOR,semantic:Ct.COLOR,setIndex:0,typedArray:n,componentDatatype:$.UNSIGNED_BYTE,type:cn.VEC4,normalized:!0,isRGB565:!1,isTranslucent:!0};if(c(t.RGB))return n=e.getPropertyArray("RGB",$.UNSIGNED_BYTE,3),{name:"COLOR",semantic:Ct.COLOR,setIndex:0,typedArray:n,componentDatatype:$.UNSIGNED_BYTE,type:cn.VEC3,normalized:!0,isRGB565:!1,isTranslucent:!1};if(c(t.RGB565))return n=e.getPropertyArray("RGB565",$.UNSIGNED_SHORT,1),{name:"COLOR",semantic:Ct.COLOR,setIndex:0,typedArray:n,componentDatatype:$.FLOAT,type:cn.VEC3,normalized:!1,isRGB565:!0,isTranslucent:!1};if(c(t.CONSTANT_RGBA)){let i=e.getGlobalProperty("CONSTANT_RGBA",$.UNSIGNED_BYTE,4),o=i[3],r=j.fromBytes(i[0],i[1],i[2],o),s=o<255;return{name:Ct.COLOR,semantic:Ct.COLOR,setIndex:0,constantColor:r,componentDatatype:$.FLOAT,type:cn.VEC4,isQuantized:!1,isTranslucent:s}}}function rHe(e){let t=e.json,n;if(c(t.NORMAL))return n=e.getPropertyArray("NORMAL",$.FLOAT,3),{name:Ct.NORMAL,semantic:Ct.NORMAL,typedArray:n,octEncoded:!1,octEncodedZXY:!1,componentDatatype:$.FLOAT,type:cn.VEC3};if(c(t.NORMAL_OCT16P))return n=e.getPropertyArray("NORMAL_OCT16P",$.UNSIGNED_BYTE,2),{name:Ct.NORMAL,semantic:Ct.NORMAL,typedArray:n,octEncoded:!0,octEncodedZXY:!1,quantizedRange:(1<<8)-1,quantizedType:cn.VEC2,quantizedComponentDatatype:$.UNSIGNED_BYTE,componentDatatype:$.FLOAT,type:cn.VEC3}}function sHe(e){let t=e.json;if(c(t.BATCH_ID)){let n=e.getPropertyArray("BATCH_ID",$.UNSIGNED_SHORT,1);return{name:Ct.FEATURE_ID,semantic:Ct.FEATURE_ID,setIndex:0,typedArray:n,componentDatatype:$.fromTypedArray(n),type:cn.SCALAR}}}var yw=tse;var aHe=Sn.Components,cHe=Sn.Scene,lHe=Sn.Node,uHe=Sn.Primitive,fHe=Sn.Attribute,nse=Sn.Quantization,dHe=Sn.FeatureIdAttribute,hHe=Sn.Material,mHe=Sn.MetallicRoughness;function ig(e){e=y(e,y.EMPTY_OBJECT);let t=e.arrayBuffer,n=y(e.byteOffset,0);A.typeOf.object("options.arrayBuffer",t),this._arrayBuffer=t,this._byteOffset=n,this._loadAttributesFor2D=y(e.loadAttributesFor2D,!1),this._parsedContent=void 0,this._decodePromise=void 0,this._decodedAttributes=void 0,this._promise=void 0,this._error=void 0,this._state=yt.UNLOADED,this._buffers=[],this._components=void 0,this._transform=k.IDENTITY}c(Object.create)&&(ig.prototype=Object.create(Zi.prototype),ig.prototype.constructor=ig);Object.defineProperties(ig.prototype,{cacheKey:{get:function(){}},components:{get:function(){return this._components}},transform:{get:function(){return this._transform}}});ig.prototype.load=function(){if(c(this._promise))return this._promise;this._parsedContent=yw.parse(this._arrayBuffer,this._byteOffset),this._state=yt.PROCESSING,this._promise=Promise.resolve(this)};ig.prototype.process=function(e){if(c(this._error)){let t=this._error;throw this._error=void 0,t}if(this._state===yt.READY)return!0;if(this._state===yt.PROCESSING){if(c(this._decodePromise))return!1;this._decodePromise=pHe(this,e.context)}return!1};function pHe(e,t){let i=e._parsedContent.draco,o;if(c(i)?o=d0.decodePointCloud(i,t):o=Promise.resolve(),!!c(o))return e._decodePromise=o,o.then(function(r){if(!e.isDestroyed())return c(r)&&_He(e,i,r),vHe(e,t),e._state=yt.READY,e}).catch(function(r){e.unload(),e._state=yt.FAILED;let s="Failed to load Draco pnts";e._error=e.getError(s,r)})}function _He(e,t,n){e._state=yt.READY;let i=e._parsedContent,o;if(c(n.POSITION)){if(o={name:"POSITION",semantic:Ct.POSITION,typedArray:n.POSITION.array,componentDatatype:$.FLOAT,type:cn.VEC3,isQuantized:!1},c(n.POSITION.data.quantization)){let a=n.POSITION.data.quantization,l=a.range,u=h.fromElements(l,l,l),f=h.unpack(a.minValues),d=(1<<a.quantizationBits)-1;o.isQuantized=!0,o.quantizedRange=d,o.quantizedVolumeOffset=f,o.quantizedVolumeScale=u,o.quantizedComponentDatatype=d<=255?$.UNSIGNED_BYTE:$.UNSIGNED_SHORT,o.quantizedType=cn.VEC3}i.positions=o}if(c(n.NORMAL)){if(o={name:"NORMAL",semantic:Ct.NORMAL,typedArray:n.NORMAL.array,componentDatatype:$.FLOAT,type:cn.VEC3,isQuantized:!1,octEncoded:!1,octEncodedZXY:!1},c(n.NORMAL.data.quantization)){let a=(1<<n.NORMAL.data.quantization.quantizationBits)-1;o.quantizedRange=a,o.octEncoded=!0,o.octEncodedZXY=!0,o.quantizedComponentDatatype=$.UNSIGNED_BYTE,o.quantizedType=cn.VEC2}i.normals=o}if(c(n.RGBA)?i.colors={name:"COLOR",semantic:Ct.COLOR,setIndex:0,typedArray:n.RGBA.array,componentDatatype:$.UNSIGNED_BYTE,type:cn.VEC4,normalized:!0,isTranslucent:!0}:c(n.RGB)&&(i.colors={name:"COLOR",semantic:Ct.COLOR,setIndex:0,typedArray:n.RGB.array,componentDatatype:$.UNSIGNED_BYTE,type:cn.VEC3,normalized:!0,isTranslucent:!1}),c(n.BATCH_ID)){let a=n.BATCH_ID.array;i.batchIds={name:"_FEATURE_ID",semantic:Ct.FEATURE_ID,setIndex:0,typedArray:a,componentDatatype:$.fromTypedArray(a),type:cn.SCALAR}}let r=i.batchTableJson,s=t.batchTableProperties;for(let a in s)if(s.hasOwnProperty(a)){let l=n[a];c(r)||(r={}),i.hasDracoBatchTable=!0;let u=l.data;r[a]={byteOffset:u.byteOffset,type:gHe(u.componentsPerAttribute),componentType:yHe(u.componentDatatype),typedArray:l.array}}i.batchTableJson=r}function gHe(e){switch(e){case 1:return"SCALAR";case 2:return"VEC2";case 3:return"VEC3";case 4:return"VEC4";default:throw new E("componentsPerAttribute must be a number from 1-4")}}function yHe(e){switch(e){case ne.BYTE:return"BYTE";case ne.UNSIGNED_BYTE:return"UNSIGNED_BYTE";case ne.SHORT:return"SHORT";case ne.UNSIGNED_SHORT:return"UNSIGNED_SHORT";case ne.INT:return"INT";case ne.UNSIGNED_INT:return"UNSIGNED_INT";case ne.DOUBLE:return"DOUBLE";case ne.FLOAT:return"FLOAT";default:throw new E("value is not a valid WebGL constant")}}function bw(e,t,n){let i=t.typedArray,o;if(t.octEncoded&&(o=new nse,o.octEncoded=t.octEncoded,o.octEncodedZXY=t.octEncodedZXY,o.normalizationRange=t.quantizedRange,o.type=t.quantizedType,o.componentDatatype=t.quantizedComponentDatatype),t.isQuantized){o=new nse;let a=t.quantizedRange;o.normalizationRange=a,o.quantizedVolumeOffset=h.ZERO;let l=t.quantizedVolumeScale;o.quantizedVolumeDimensions=l,o.quantizedVolumeStepSize=h.divideByScalar(l,a,new h),o.componentDatatype=t.quantizedComponentDatatype,o.type=t.quantizedType}let r=new fHe;if(r.name=t.name,r.semantic=t.semantic,r.setIndex=t.setIndex,r.componentDatatype=t.componentDatatype,r.type=t.type,r.normalized=y(t.normalized,!1),r.min=t.min,r.max=t.max,r.quantization=o,t.isRGB565&&(i=Nn.decodeRGB565(i)),c(t.constantColor)){let a=new Array(4);r.constant=j.pack(t.constantColor,a)}else{let a=xt.createVertexBuffer({typedArray:i,context:n,usage:ke.STATIC_DRAW});a.vertexArrayDestroyable=!1,e._buffers.push(a),r.buffer=a}let s=e._loadAttributesFor2D;return r.semantic===Ct.POSITION&&s&&(r.typedArray=i),r}var ise,_1;function bHe(e){if(!c(_1)){ise=new ose.default(0),_1=new Array(e);for(let t=0;t<e;++t)_1[t]=ise.random()}return _1}var xHe=new h,THe=new h,AHe=new h;function CHe(e){let t=e.typedArray,n=20,i=t.length/3,o=Math.min(i,n),r=bHe(n),s=Number.MAX_VALUE,a=-Number.MAX_VALUE,l=h.fromElements(s,s,s,xHe),u=h.fromElements(a,a,a,THe),f,d,p;if(e.isQuantized)l=h.ZERO,u=e.quantizedVolumeScale;else for(f=0;f<o;++f)d=Math.floor(r[f]*i),p=h.unpack(t,d*3,AHe),h.minimumByComponent(l,p,l),h.maximumByComponent(u,p,u);e.min=h.clone(l),e.max=h.clone(u)}var EHe={name:Ct.COLOR,semantic:Ct.COLOR,setIndex:0,constantColor:j.DARKGRAY,componentDatatype:$.FLOAT,type:cn.VEC4,isQuantized:!1,isTranslucent:!1};function SHe(e,t,n){let i=[],o,r=t.positions;return c(r)&&(CHe(r),o=bw(e,r,n),o.count=t.pointsLength,i.push(o)),c(t.normals)&&(o=bw(e,t.normals,n),i.push(o)),c(t.colors)?(o=bw(e,t.colors,n),i.push(o)):(o=bw(e,EHe,n),i.push(o)),c(t.batchIds)&&(o=bw(e,t.batchIds,n),i.push(o)),i}function wHe(e,t){let n=e.batchLength,i=e.pointsLength,o=e.batchTableBinary,r=!c(e.batchIds);if(c(o)||e.hasDracoBatchTable){let s=y(n,i);return v0({count:s,batchTable:e.batchTableJson,binaryBody:o,parseAsPropertyAttributes:r,customAttributeOutput:t})}return new ua({schema:{},propertyTables:[]})}function vHe(e,t){let n=e._parsedContent,i=new mHe;i.metallicFactor=0,i.roughnessFactor=.9;let o=new hHe;o.metallicRoughness=i;let r=n.colors;c(r)&&r.isTranslucent&&(o.alphaMode=H_.BLEND);let s=!c(n.normals);o.unlit=s;let a=new uHe;if(a.attributes=SHe(e,n,t),a.primitiveType=Me.POINTS,a.material=o,c(n.batchIds)){let g=new dHe;g.propertyTableId=0,g.setIndex=0,g.positionalLabel="featureId_0",a.featureIds.push(g)}let l=new lHe;l.index=0,l.primitives=[a];let u=new cHe;u.nodes=[l],u.upAxis=zo.Z,u.forwardAxis=zo.X;let f=new aHe;f.scene=u,f.nodes=[l];let d=[];f.structuralMetadata=wHe(n,d),d.length>0&&DHe(e,a,d,t),c(n.rtcCenter)&&(f.transform=k.multiplyByTranslation(f.transform,n.rtcCenter,f.transform));let p=n.positions;c(p)&&p.isQuantized&&(f.transform=k.multiplyByTranslation(f.transform,p.quantizedVolumeOffset,f.transform)),e._components=f,e._parsedContent=void 0,e._arrayBuffer=void 0}function DHe(e,t,n,i){let o=t.attributes,r=n.length;for(let s=0;s<r;s++){let a=n[s],l=xt.createVertexBuffer({typedArray:a.typedArray,context:i,usage:ke.STATIC_DRAW});l.vertexArrayDestroyable=!1,e._buffers.push(l),a.buffer=l,a.typedArray=void 0,o.push(a)}t.propertyAttributeIds=[0]}ig.prototype.unload=function(){let e=this._buffers;for(let t=0;t<e.length;t++)e[t].destroy();e.length=0,this._components=void 0,this._parsedContent=void 0,this._arrayBuffer=void 0};var OH=ig;var PHe=new h,IHe=new h,OHe=new h,RHe=new k,MHe=new k,LHe=new k,NHe=new he,FHe=new ce;function g1(e,t,n,i,o,r,s){if(A.typeOf.object("model",e),A.typeOf.object("ray",t),A.typeOf.object("frameState",n),!e._ready||n.mode===oe.MORPHING)return;let a=Number.MAX_VALUE,l=e.sceneGraph,u=l._runtimeNodes;for(let f=0;f<u.length;f++){let d=u[f],p=d.node,g=k.clone(d.computedTransform,RHe),m=k.clone(l.computedModelMatrix,MHe),b=p.instances;c(b)&&b.transformInWorldSpace&&(m=k.multiplyTransformation(e.modelMatrix,l.components.transform,m),g=k.multiplyTransformation(l.axisCorrectionMatrix,d.computedTransform,g));let x=k.multiplyTransformation(m,g,LHe);n.mode!==oe.SCENE3D&&(x=Ft.basisTo2D(n.mapProjection,x,x));let T=[];if(c(b)){let S=b.attributes[0].count,v=b.attributes[0].componentDatatype,D=12,I=d.transformsTypedArray;if(!c(I)){let L=d.instancingTransformsBuffer;c(L)&&n.context.webgl2&&(I=$.createTypedArray(v,S*D),L.getBufferData(I))}if(c(I))for(let L=0;L<S;L++){let M=L*D,N=new k(I[M],I[M+1],I[M+2],I[M+3],I[M+4],I[M+5],I[M+6],I[M+7],I[M+8],I[M+9],I[M+10],I[M+11],0,0,0,1);b.transformInWorldSpace?(k.multiplyTransformation(N,g,N),k.multiplyTransformation(m,N,N)):k.multiplyTransformation(N,x,N),T.push(N)}}T.length===0&&T.push(x);let C=d.runtimePrimitives.length;for(let S=0;S<C;S++){let v=d.runtimePrimitives[S],D=v.primitive;if(c(v.boundingSphere)&&!c(b)){let K=ce.transform(v.boundingSphere,x,FHe),te=Qn.raySphere(t,K);if(!c(te))continue}let I=Zt.getAttributeBySemantic(D,Ct.POSITION),L=I.byteOffset,M=I.byteStride,N=I.count;if(!c(D.indices))continue;let B=D.indices.typedArray;if(!c(B)){let K=D.indices.buffer,te=D.indices.count,Y=D.indices.indexDatatype;c(K)&&n.context.webgl2&&(Y===Fe.UNSIGNED_BYTE?B=new Uint8Array(te):Y===Fe.UNSIGNED_SHORT?B=new Uint16Array(te):Y===Fe.UNSIGNED_INT&&(B=new Uint32Array(te)),K.getBufferData(B))}let _=I.typedArray,w=I.componentDatatype,P=I.type,O=I.quantization;c(O)&&(w=I.quantization.componentDatatype,P=I.quantization.type);let F=cn.getNumberOfComponents(P),V=$.getSizeInBytes(w),G=!c(_)&&c(M)&&M!==F*V,z=F,W=0;G&&(z=M/V,W=L/V);let U=N*z;if(!c(_)){let K=I.buffer;c(K)&&n.context.webgl2&&(_=$.createTypedArray(w,U),K.getBufferData(_,G?0:L,0,U)),O&&I.normalized&&(_=Nn.dequantize(_,w,P,N))}if(!c(B)||!c(_))return;r=y(r,ie.default),i=y(i,1),o=y(o,0);let q=B.length;for(let K=0;K<q;K+=3){let te=B[K],Y=B[K+1],Z=B[K+2];for(let ee of T){let me=RH(_,te,W,z,O,ee,i,o,r,PHe),be=RH(_,Y,W,z,O,ee,i,o,r,IHe),le=RH(_,Z,W,z,O,ee,i,o,r,OHe),ge=Qn.rayTriangleParametric(t,me,be,le,y(e.backFaceCulling,!0));c(ge)&&ge<a&&ge>=0&&(a=ge)}}}}if(a!==Number.MAX_VALUE){if(s=_n.getPoint(t,a,s),n.mode!==oe.SCENE3D){h.fromElements(s.y,s.z,s.x,s);let f=n.mapProjection,d=f.ellipsoid,p=f.unproject(s,NHe);d.cartographicToCartesian(p,s)}return s}}function RH(e,t,n,i,o,r,s,a,l,u){let f=n+t*i;if(u.x=e[f],u.y=e[f+1],u.z=e[f+2],c(o))if(o.octEncoded){if(u=Nn.octDecodeInRange(u,o.normalizationRange,u),o.octEncodedZXY){let d=u.x;u.x=u.z,u.z=u.y,u.y=d}}else u=h.multiplyComponents(u,o.quantizedVolumeStepSize,u),u=h.add(u,o.quantizedVolumeOffset,u);return u=k.multiplyByPoint(r,u,u),s!==1&&zr.getPosition(u,l,s,a,u),u}function eo(e){e=y(e,y.EMPTY_OBJECT),A.typeOf.object("options.loader",e.loader),A.typeOf.object("options.resource",e.resource),this._loader=e.loader,this._resource=e.resource,this.type=y(e.type,Rr.GLTF),this.modelMatrix=k.clone(y(e.modelMatrix,k.IDENTITY)),this._modelMatrix=k.clone(this.modelMatrix),this._scale=y(e.scale,1),this._minimumPixelSize=y(e.minimumPixelSize,0),this._maximumScale=e.maximumScale,this._clampedScale=c(this._maximumScale)?Math.min(this._scale,this._maximumScale):this._scale,this._computedScale=this._clampedScale,this._updateModelMatrix=!1,this.referenceMatrix=void 0,this._iblReferenceFrameMatrix=Q.clone(Q.IDENTITY),this._resourcesLoaded=!1,this._drawCommandsBuilt=!1,this._ready=!1,this._customShader=e.customShader,this._content=e.content,this._texturesLoaded=!1,this._defaultTexture=void 0,this._activeAnimations=new U4(this),this._clampAnimations=y(e.clampAnimations,!0),this._userAnimationDirty=!1,this._id=e.id,this._idDirty=!1,this._color=j.clone(e.color),this._colorBlendMode=y(e.colorBlendMode,ol.HIGHLIGHT),this._colorBlendAmount=y(e.colorBlendAmount,.5);let t=y(e.silhouetteColor,j.RED);this._silhouetteColor=j.clone(t),this._silhouetteSize=y(e.silhouetteSize,0),this._silhouetteDirty=!1,this._silhouetteId=void 0,this._cull=y(e.cull,!0),this._opaquePass=y(e.opaquePass,ve.OPAQUE),this._allowPicking=y(e.allowPicking,!0),this._show=y(e.show,!0),this._style=void 0,this._styleDirty=!1,this._styleCommandsNeeded=void 0;let n=y(e.featureIdLabel,"featureId_0");typeof n=="number"&&(n=`featureId_${n}`),this._featureIdLabel=n;let i=y(e.instanceFeatureIdLabel,"instanceFeatureId_0");typeof i=="number"&&(i=`instanceFeatureId_${i}`),this._instanceFeatureIdLabel=i,this._featureTables=[],this._featureTableId=void 0,this._featureTableIdDirty=!0,this._pipelineResources=[],this._modelResources=[],this._pickIds=[],this._boundingSphere=new ce,this._initialRadius=void 0,this._heightReference=y(e.heightReference,$e.NONE),this._heightDirty=this._heightReference!==$e.NONE,this._removeUpdateHeightCallback=void 0,this._enableVerticalExaggeration=y(e.enableVerticalExaggeration,!0),this._hasVerticalExaggeration=!1,this._clampedModelMatrix=void 0;let o=e.scene;c(o)&&c(o.terrainProviderChanged)&&(this._terrainProviderChangedCallback=o.terrainProviderChanged.addEventListener(()=>{this._heightDirty=!0})),this._scene=o,this._distanceDisplayCondition=e.distanceDisplayCondition;let r=new Z_(e.pointCloudShading);this._pointCloudShading=r,this._attenuation=r.attenuation,this._pointCloudBackFaceCulling=r.backFaceCulling;let s=e.clippingPlanes;c(s)&&s.owner===void 0?Ms.setOwner(s,this,"_clippingPlanes"):this._clippingPlanes=s,this._clippingPlanesState=0,this._clippingPlanesMatrix=k.clone(k.IDENTITY);let a=e.clippingPolygons;c(a)&&a.owner===void 0?tp.setOwner(a,this,"_clippingPolygons"):this._clippingPolygons=a,this._clippingPolygonsState=0,this._lightColor=h.clone(e.lightColor),this._imageBasedLighting=c(e.imageBasedLighting)?e.imageBasedLighting:new SS,this._shouldDestroyImageBasedLighting=!c(e.imageBasedLighting),this._environmentMapManager=void 0;let l=new A0(e.environmentMapOptions);A0.setOwner(l,this,"_environmentMapManager"),this._backFaceCulling=y(e.backFaceCulling,!0),this._backFaceCullingDirty=!1,this._shadows=y(e.shadows,En.ENABLED),this._shadowsDirty=!1,this._debugShowBoundingVolumeDirty=!1,this._debugShowBoundingVolume=y(e.debugShowBoundingVolume,!1),this._enableDebugWireframe=y(e.enableDebugWireframe,!1),this._enableShowOutline=y(e.enableShowOutline,!0),this._debugWireframe=y(e.debugWireframe,!1),this._debugWireframe===!0&&this._enableDebugWireframe===!1&&this.type===Rr.GLTF&&_t("model-debug-wireframe-ignored","enableDebugWireframe must be set to true in Model.fromGltf, otherwise debugWireframe will be ignored.");let u=e.credit;typeof u=="string"&&(u=new Pt(u)),this._credits=[],this._credit=u,this._resourceCredits=[],this._gltfCredits=[],this._showCreditsOnScreen=y(e.showCreditsOnScreen,!1),this._showCreditsOnScreenDirty=!0,this._splitDirection=y(e.splitDirection,$r.NONE),this._enableShowOutline=y(e.enableShowOutline,!0),this.showOutline=y(e.showOutline,!0),this.outlineColor=y(e.outlineColor,j.BLACK),this._classificationType=e.classificationType,this._statistics=new IH,this._sceneMode=void 0,this._projectTo2D=y(e.projectTo2D,!1),this._enablePick=y(e.enablePick,!1),this._fogRenderable=void 0,this._skipLevelOfDetail=!1,this._ignoreCommands=y(e.ignoreCommands,!1),this._errorEvent=new pe,this._readyEvent=new pe,this._texturesReadyEvent=new pe,this._sceneGraph=void 0,this._nodesByName={},this.pickObject=e.pickObject}function MH(e,t){if(e._errorEvent.numberOfListeners>0){e._errorEvent.raiseEvent(t);return}console.log(t)}function BHe(e,t){let n=e._featureTables,i=t.propertyTables,o=i.length;for(let r=0;r<o;r++){let s=i[r],a=new H4({model:e,propertyTable:s});n.push(a)}return n}function kHe(e,t){let n=t._featureIdLabel,i=t._instanceFeatureIdLabel,o,r,s,a;for(o=0;o<e.nodes.length;o++)if(a=e.nodes[o],c(a.instances)&&(s=Zt.getFeatureIdsByLabel(a.instances.featureIds,i),c(s)&&c(s.propertyTableId)))return s.propertyTableId;for(o=0;o<e.nodes.length;o++)for(a=e.nodes[o],r=0;r<a.primitives.length;r++){let l=a.primitives[r],u=Zt.getFeatureIdsByLabel(l.featureIds,n);if(c(u))return u.propertyTableId}if(t._featureTables.length===1)return 0}function FH(e,t){if(!c(e)&&!c(t))return!1;if(c(e)!==c(t))return!0;let n=e.alpha,i=t.alpha;return Math.floor(n)!==Math.floor(i)||Math.ceil(n)!==Math.ceil(i)}Object.defineProperties(eo.prototype,{ready:{get:function(){return this._ready}},errorEvent:{get:function(){return this._errorEvent}},readyEvent:{get:function(){return this._readyEvent}},incrementallyLoadTextures:{get:function(){return y(this._loader.incrementallyLoadTextures,!1)}},texturesReadyEvent:{get:function(){return this._texturesReadyEvent}},loader:{get:function(){return this._loader}},statistics:{get:function(){return this._statistics}},activeAnimations:{get:function(){return this._activeAnimations}},clampAnimations:{get:function(){return this._clampAnimations},set:function(e){this._clampAnimations=e}},cull:{get:function(){return this._cull}},opaquePass:{get:function(){return this._opaquePass}},pointCloudShading:{get:function(){return this._pointCloudShading},set:function(e){A.defined("pointCloudShading",e),e!==this._pointCloudShading&&this.resetDrawCommands(),this._pointCloudShading=e}},customShader:{get:function(){return this._customShader},set:function(e){e!==this._customShader&&this.resetDrawCommands(),this._customShader=e}},sceneGraph:{get:function(){return this._sceneGraph}},content:{get:function(){return this._content}},heightReference:{get:function(){return this._heightReference},set:function(e){e!==this._heightReference&&(this._heightDirty=!0),this._heightReference=e}},distanceDisplayCondition:{get:function(){return this._distanceDisplayCondition},set:function(e){if(c(e)&&e.far<=e.near)throw new E("far must be greater than near");this._distanceDisplayCondition=Bt.clone(e,this._distanceDisplayCondition)}},structuralMetadata:{get:function(){return this._sceneGraph.components.structuralMetadata}},featureTableId:{get:function(){return this._featureTableId},set:function(e){this._featureTableId=e}},featureTables:{get:function(){return this._featureTables},set:function(e){this._featureTables=e}},id:{get:function(){return this._id},set:function(e){e!==this._id&&(this._idDirty=!0),this._id=e}},allowPicking:{get:function(){return this._allowPicking}},style:{get:function(){return this._style},set:function(e){this._style=e,this._styleDirty=!0}},color:{get:function(){return this._color},set:function(e){FH(e,this._color)&&this.resetDrawCommands(),this._color=j.clone(e,this._color)}},colorBlendMode:{get:function(){return this._colorBlendMode},set:function(e){this._colorBlendMode=e}},colorBlendAmount:{get:function(){return this._colorBlendAmount},set:function(e){this._colorBlendAmount=e}},silhouetteColor:{get:function(){return this._silhouetteColor},set:function(e){if(!j.equals(e,this._silhouetteColor)){let t=FH(e,this._silhouetteColor);this._silhouetteDirty=this._silhouetteDirty||t}this._silhouetteColor=j.clone(e,this._silhouetteColor)}},silhouetteSize:{get:function(){return this._silhouetteSize},set:function(e){if(e!==this._silhouetteSize){let t=this._silhouetteSize,n=e>0&&t===0||e===0&&t>0;this._silhouetteDirty=this._silhouetteDirty||n,this._backFaceCullingDirty=this._backFaceCullingDirty||n}this._silhouetteSize=e}},boundingSphere:{get:function(){if(!this._ready)throw new E("The model is not loaded. Use Model.readyEvent or wait for Model.ready to be true.");let e=c(this._clampedModelMatrix)?this._clampedModelMatrix:this.modelMatrix;return ase(this,e),this._boundingSphere}},debugShowBoundingVolume:{get:function(){return this._debugShowBoundingVolume},set:function(e){this._debugShowBoundingVolume!==e&&(this._debugShowBoundingVolumeDirty=!0),this._debugShowBoundingVolume=e}},debugWireframe:{get:function(){return this._debugWireframe},set:function(e){this._debugWireframe!==e&&this.resetDrawCommands(),this._debugWireframe=e,this._debugWireframe===!0&&this._enableDebugWireframe===!1&&this.type===Rr.GLTF&&_t("model-debug-wireframe-ignored","enableDebugWireframe must be set to true in Model.fromGltfAsync, otherwise debugWireframe will be ignored.")}},show:{get:function(){return this._show},set:function(e){this._show=e}},featureIdLabel:{get:function(){return this._featureIdLabel},set:function(e){typeof e=="number"&&(e=`featureId_${e}`),A.typeOf.string("value",e),e!==this._featureIdLabel&&(this._featureTableIdDirty=!0),this._featureIdLabel=e}},instanceFeatureIdLabel:{get:function(){return this._instanceFeatureIdLabel},set:function(e){typeof e=="number"&&(e=`instanceFeatureId_${e}`),A.typeOf.string("value",e),e!==this._instanceFeatureIdLabel&&(this._featureTableIdDirty=!0),this._instanceFeatureIdLabel=e}},clippingPlanes:{get:function(){return this._clippingPlanes},set:function(e){e!==this._clippingPlanes&&(Ms.setOwner(e,this,"_clippingPlanes"),this.resetDrawCommands())}},clippingPolygons:{get:function(){return this._clippingPolygons},set:function(e){e!==this._clippingPolygons&&(tp.setOwner(e,this,"_clippingPolygons"),this.resetDrawCommands())}},enableVerticalExaggeration:{get:function(){return this._enableVerticalExaggeration},set:function(e){e!==this._enableVerticalExaggeration&&this.resetDrawCommands(),this._enableVerticalExaggeration=e}},hasVerticalExaggeration:{get:function(){return this._hasVerticalExaggeration}},lightColor:{get:function(){return this._lightColor},set:function(e){c(e)!==c(this._lightColor)&&this.resetDrawCommands(),this._lightColor=h.clone(e,this._lightColor)}},imageBasedLighting:{get:function(){return this._imageBasedLighting},set:function(e){A.typeOf.object("imageBasedLighting",e),e!==this._imageBasedLighting&&(this._shouldDestroyImageBasedLighting&&!this._imageBasedLighting.isDestroyed()&&this._imageBasedLighting.destroy(),this._imageBasedLighting=e,this._shouldDestroyImageBasedLighting=!1,this.resetDrawCommands())}},environmentMapManager:{get:function(){return this._environmentMapManager},set:function(e){A.typeOf.object("environmentMapManager",e),e!==this.environmentMapManager&&(A0.setOwner(e,this,"_environmentMapManager"),this.resetDrawCommands())}},backFaceCulling:{get:function(){return this._backFaceCulling},set:function(e){e!==this._backFaceCulling&&(this._backFaceCullingDirty=!0),this._backFaceCulling=e}},scale:{get:function(){return this._scale},set:function(e){e!==this._scale&&(this._updateModelMatrix=!0),this._scale=e}},computedScale:{get:function(){return this._computedScale}},minimumPixelSize:{get:function(){return this._minimumPixelSize},set:function(e){e!==this._minimumPixelSize&&(this._updateModelMatrix=!0),this._minimumPixelSize=e}},maximumScale:{get:function(){return this._maximumScale},set:function(e){e!==this._maximumScale&&(this._updateModelMatrix=!0),this._maximumScale=e}},shadows:{get:function(){return this._shadows},set:function(e){e!==this._shadows&&(this._shadowsDirty=!0),this._shadows=e}},credit:{get:function(){return this._credit}},showCreditsOnScreen:{get:function(){return this._showCreditsOnScreen},set:function(e){this._showCreditsOnScreen!==e&&(this._showCreditsOnScreenDirty=!0),this._showCreditsOnScreen=e}},splitDirection:{get:function(){return this._splitDirection},set:function(e){this._splitDirection!==e&&this.resetDrawCommands(),this._splitDirection=e}},classificationType:{get:function(){return this._classificationType}},pickIds:{get:function(){return this._pickIds}},styleCommandsNeeded:{get:function(){return this._styleCommandsNeeded}}});eo.prototype.getNode=function(e){if(!this._ready)throw new E("The model is not loaded. Use Model.readyEvent or wait for Model.ready to be true.");return A.typeOf.string("name",e),this._nodesByName[e]};eo.prototype.setArticulationStage=function(e,t){if(A.typeOf.number("value",t),!this._ready)throw new E("The model is not loaded. Use Model.readyEvent or wait for Model.ready to be true.");this._sceneGraph.setArticulationStage(e,t)};eo.prototype.applyArticulations=function(){if(!this._ready)throw new E("The model is not loaded. Use Model.readyEvent or wait for Model.ready to be true.");this._sceneGraph.applyArticulations()};eo.prototype.getExtension=function(e){if(A.typeOf.string("extensionName",e),!this._ready)throw new E("The model is not loaded. Use Model.readyEvent or wait for Model.ready to be true.");return this._loader.components.extensions[e]};eo.prototype.makeStyleDirty=function(){this._styleDirty=!0};eo.prototype.resetDrawCommands=function(){this._drawCommandsBuilt=!1};var VHe=new k,UHe=new Q,zHe=new k;eo.prototype.update=function(e){let t=!1;try{t=HHe(this,e)}catch(n){if(!this._loader.incrementallyLoadTextures&&n.name==="TextureError")MH(this,n);else{let i=Zt.getError("model",this._resource,n);MH(this,i)}}if(GHe(this,e),jHe(this,e),WHe(this,e),!this._resourcesLoaded&&t){this._resourcesLoaded=!0;let n=this._loader.components;if(!c(n)){if(this._loader.isUnloaded())return;let r=Zt.getError("model",this._resource,new ue("Failed to load model."));MH(r),this._rejectLoad=this._rejectLoad&&this._rejectLoad(r)}let i=n.structuralMetadata;c(i)&&i.propertyTableCount>0&&BHe(this,i);let o=new PH({model:this,modelComponents:n});this._sceneGraph=o,this._gltfCredits=o.components.asset.credits}if(!(!this._resourcesLoaded||e.mode===oe.MORPHING)){if(qHe(this),YHe(this),XHe(this,e),KHe(this),$He(this,e),ZHe(this,e),JHe(this,e),QHe(this,e),eGe(this,e),tGe(this,e),nGe(this,e),this._defaultTexture=e.context.defaultTexture,iGe(this,e),oGe(this,e),rGe(this),sGe(this,e),uGe(this,e),!this._ready){e.afterRender.push(()=>{this._ready=!0,this._readyEvent.raiseEvent(this)});return}this._loader.incrementallyLoadTextures&&!this._texturesLoaded&&this._loader.texturesLoaded&&(this.resetDrawCommands(),this._texturesLoaded=!0,this._texturesReadyEvent.raiseEvent(this)),cGe(this),fGe(this,e),dGe(this),hGe(this,e)}};function HHe(e,t){return!e._resourcesLoaded||e._loader.incrementallyLoadTextures&&!e._texturesLoaded?(t.afterRender.push(()=>!0),e._loader.process(t)):!0}function GHe(e,t){c(e._customShader)&&e._customShader.update(t)}function jHe(e,t){let n=e._environmentMapManager,i=t.passes.pick||t.passes.pickVoxel;e._ready&&n.owner===e&&!i&&(n.position=e._boundingSphere.center,n.shouldUpdate=!c(e._imageBasedLighting.sphericalHarmonicCoefficients)||!c(e._imageBasedLighting.specularEnvironmentMaps),n.update(t),n.shouldRegenerateShaders&&e.resetDrawCommands())}function WHe(e,t){e._imageBasedLighting.update(t),e._imageBasedLighting.shouldRegenerateShaders&&e.resetDrawCommands()}function qHe(e){if(!e._featureTableIdDirty)return;e._featureTableIdDirty=!1;let t=e._sceneGraph.components,n=t.structuralMetadata;c(n)&&n.propertyTableCount>0&&(e.featureTableId=kHe(t,e),e._styleDirty=!0,e.resetDrawCommands())}function YHe(e){e._styleDirty&&(e.applyStyle(e._style),e._styleDirty=!1)}function XHe(e,t){let n=e._featureTables,i=n.length,o=!1;for(let r=0;r<i;r++)n[r].update(t),n[r].styleCommandsNeededDirty&&(o=!0);o&&sse(e)}function sse(e){let t=e.featureTables[e.featureTableId];e._styleCommandsNeeded=dp.getStyleCommandsNeeded(t.featuresLength,t.batchTexture.translucentFeaturesLength)}function KHe(e){let t=e.pointCloudShading;t.attenuation!==e._attenuation&&(e.resetDrawCommands(),e._attenuation=t.attenuation),t.backFaceCulling!==e._pointCloudBackFaceCulling&&(e.resetDrawCommands(),e._pointCloudBackFaceCulling=t.backFaceCulling)}function $He(e,t){e._silhouetteDirty&&(cse(t)&&e.resetDrawCommands(),e._silhouetteDirty=!1)}function ZHe(e,t){let n=e.hasSkipLevelOfDetail(t);n!==e._skipLevelOfDetail&&(e.resetDrawCommands(),e._skipLevelOfDetail=n)}function JHe(e,t){let n=0;e.isClippingEnabled()&&(e._clippingPlanes.owner===e&&e._clippingPlanes.update(t),n=e._clippingPlanes.clippingPlanesState),n!==e._clippingPlanesState&&(e.resetDrawCommands(),e._clippingPlanesState=n)}function QHe(e,t){let n=0;e.isClippingPolygonsEnabled()&&(e._clippingPolygons.owner===e&&(e._clippingPolygons.update(t),e._clippingPolygons.queueCommands(t)),n=e._clippingPolygons.clippingPolygonsState),n!==e._clippingPolygonsState&&(e.resetDrawCommands(),e._clippingPolygonsState=n)}function eGe(e,t){t.mode!==e._sceneMode&&(e._projectTo2D?e.resetDrawCommands():e._updateModelMatrix=!0,e._sceneMode=t.mode)}function tGe(e,t){let n=t.fog.enabled&&t.fog.renderable;n!==e._fogRenderable&&(e.resetDrawCommands(),e._fogRenderable=n)}function nGe(e,t){if(e.enableVerticalExaggeration){let n=t.verticalExaggeration!==1;e.hasVerticalExaggeration!==n&&(e.resetDrawCommands(),e._hasVerticalExaggeration=n)}else e.hasVerticalExaggeration&&(e.resetDrawCommands(),e._hasVerticalExaggeration=!1)}function iGe(e,t){e._drawCommandsBuilt||(e.destroyPipelineResources(),e._sceneGraph.buildDrawCommands(t),e._drawCommandsBuilt=!0)}function oGe(e,t){if(!k.equals(e.modelMatrix,e._modelMatrix)){if(t.mode!==oe.SCENE3D&&e._projectTo2D)throw new E("Model.modelMatrix cannot be changed in 2D or Columbus View if projectTo2D is true.");e._updateModelMatrix=!0,e._modelMatrix=k.clone(e.modelMatrix,e._modelMatrix)}}var og=new h,LH=new he;function rGe(e){if(!e._updateModelMatrix&&!e._heightDirty&&e._minimumPixelSize===0)return;c(e._removeUpdateHeightCallback)&&(e._removeUpdateHeightCallback(),e._removeUpdateHeightCallback=void 0);let t=e._scene;if(!c(t)||e.heightReference===$e.NONE){if(e.heightReference!==$e.NONE)throw new E("Height reference is not supported without a scene.");e._clampedModelMatrix=void 0;return}let n=y(t.ellipsoid,ie.default),i=e.modelMatrix;og.x=i[12],og.y=i[13],og.z=i[14];let o=n.cartesianToCartographic(og);c(e._clampedModelMatrix)||(e._clampedModelMatrix=k.clone(i,new k)),e._removeUpdateHeightCallback=t.updateHeight(o,rse(e,n,o),e.heightReference);let r=t.getHeight(o,e.heightReference);if(c(r)){let s=rse(e,n,o);he.clone(o,LH),LH.height=r,s(LH)}e._heightDirty=!1,e._updateModelMatrix=!0}function sGe(e,t){if(!e._updateModelMatrix&&e._minimumPixelSize===0)return;let n=c(e._clampedModelMatrix)?e._clampedModelMatrix:e.modelMatrix;ase(e,n),aGe(e,n,t)}function ase(e,t){e._clampedScale=c(e._maximumScale)?Math.min(e._scale,e._maximumScale):e._scale,e._boundingSphere.center=h.multiplyByScalar(e._sceneGraph.boundingSphere.center,e._clampedScale,e._boundingSphere.center),e._boundingSphere.radius=e._initialRadius*e._clampedScale,e._boundingSphere=ce.transform(e._boundingSphere,t,e._boundingSphere)}function aGe(e,t,n){let i=e.scale;if(e.minimumPixelSize!==0&&!e._projectTo2D){let o=n.context,r=Math.max(o.drawingBufferWidth,o.drawingBufferHeight);k.getTranslation(t,og),e._sceneMode!==oe.SCENE3D&&Ni.computeActualEllipsoidPosition(n,og,og);let s=e._boundingSphere.radius,a=mGe(og,s,n),l=1/a;Math.min(l*(2*s),r)<e.minimumPixelSize&&(i=e.minimumPixelSize*a/(2*e._initialRadius))}e._computedScale=c(e.maximumScale)?Math.min(e.maximumScale,i):i}function cGe(e){if(!e._idDirty)return;e._idDirty=!1;let t=e._id,n=e._pickIds,i=n.length;for(let o=0;o<i;++o)n[o].object.id=t}var lGe=new Q(1,0,0,0,0,1,0,-1,0);function uGe(e,t){let n=c(e._clampedModelMatrix)?e._clampedModelMatrix:e.modelMatrix,i=y(e.referenceMatrix,n),o=t.context,r=UHe,s=VHe;if(s=k.multiply(o.uniformState.view3D,i,s),r=k.getRotation(s,r),r=Q.transpose(r,r),e._iblReferenceFrameMatrix=Q.multiply(lGe,r,e._iblReferenceFrameMatrix),e.isClippingEnabled()){let a=zHe;a=k.multiply(o.uniformState.view3D,i,a),a=k.multiply(a,e._clippingPlanes.modelMatrix,a),e._clippingPlanesMatrix=k.inverseTranspose(a,e._clippingPlanesMatrix)}}function fGe(e,t){let n=e._sceneGraph;if(e._updateModelMatrix||e._minimumPixelSize!==0){let o=c(e._clampedModelMatrix)?e._clampedModelMatrix:e.modelMatrix;n.updateModelMatrix(o,t),e._updateModelMatrix=!1}e._backFaceCullingDirty&&(n.updateBackFaceCulling(e._backFaceCulling),e._backFaceCullingDirty=!1),e._shadowsDirty&&(n.updateShadows(e._shadows),e._shadowsDirty=!1),e._debugShowBoundingVolumeDirty&&(n.updateShowBoundingVolume(e._debugShowBoundingVolume),e._debugShowBoundingVolumeDirty=!1);let i=!1;c(e.classificationType)||(i=e._userAnimationDirty||e._activeAnimations.update(t)),n.update(t,i),e._userAnimationDirty=!1}function dGe(e){if(!e._showCreditsOnScreenDirty)return;e._showCreditsOnScreenDirty=!1,e._credits.length=0;let t=e._showCreditsOnScreen;if(c(e._credit)){let s=Pt.clone(e._credit);s.showOnScreen=s.showOnScreen||t,e._credits.push(s)}let n=e._resourceCredits,i=n.length;for(let s=0;s<i;s++){let a=Pt.clone(n[s]);a.showOnScreen=a.showOnScreen||t,e._credits.push(a)}let o=e._gltfCredits,r=o.length;for(let s=0;s<r;s++){let a=Pt.clone(o[s]);a.showOnScreen=a.showOnScreen||t,e._credits.push(a)}}function hGe(e,t){let n=_Ge(e,t),i=e.isInvisible(),o=e.hasSilhouette(t),r=e._show&&e._computedScale!==0&&n&&(!i||o),s=t.passes,a=s.render||s.pick&&e.allowPicking;r&&!e._ignoreCommands&&a&&(gGe(e,t),e._sceneGraph.pushDrawCommands(t))}var NH=new ce;function mGe(e,t,n){return NH.center=e,NH.radius=t,n.camera.getPixelSize(NH,n.context.drawingBufferWidth,n.context.drawingBufferHeight)}var y1=new h;function rse(e,t,n){return function(i){Lx(e.heightReference)&&(i.height+=n.height),t.cartographicToCartesian(i,y1);let o=e._clampedModelMatrix;k.clone(e.modelMatrix,o),o[12]=y1.x,o[13]=y1.y,o[14]=y1.z,e._heightDirty=!0}}var pGe=new h;function _Ge(e,t){let n=e.distanceDisplayCondition;if(!c(n))return!0;let i=n.near*n.near,o=n.far*n.far,r;if(t.mode===oe.SCENE2D){let a=(t.camera.frustum.right-t.camera.frustum.left)*.5;r=a*a}else{let s=k.getTranslation(e.modelMatrix,pGe);Ni.computeActualEllipsoidPosition(t,s,s),r=h.distanceSquared(s,t.camera.positionWC)}return r>=i&&r<=o}function gGe(e,t){let n=t.creditDisplay,i=e._credits,o=i.length;for(let r=0;r<o;r++)n.addCreditToNextFrame(i[r])}eo.prototype.isTranslucent=function(){let e=this.color;return c(e)&&e.alpha>0&&e.alpha<1};eo.prototype.isInvisible=function(){let e=this.color;return c(e)&&e.alpha===0};function cse(e){return e.context.stencilBuffer}eo.prototype.hasSilhouette=function(e){return cse(e)&&this._silhouetteSize>0&&this._silhouetteColor.alpha>0&&!c(this._classificationType)};eo.prototype.hasSkipLevelOfDetail=function(e){if(!Rr.is3DTiles(this.type))return!1;let t=e.context.stencilBuffer,n=this._content.tileset;return t&&n.isSkippingLevelOfDetail};eo.prototype.isClippingEnabled=function(){let e=this._clippingPlanes;return c(e)&&e.enabled&&e.length!==0};eo.prototype.pick=function(e,t,n,i,o){return g1(this,e,t,n,i,o)};eo.prototype.isClippingPolygonsEnabled=function(){let e=this._clippingPolygons;return c(e)&&e.enabled&&e.length!==0};eo.prototype.isDestroyed=function(){return!1};eo.prototype.destroy=function(){let e=this._loader;c(e)&&e.destroy();let t=this._featureTables;if(c(t)){let r=t.length;for(let s=0;s<r;s++)t[s].destroy()}this.destroyPipelineResources(),this.destroyModelResources(),c(this._removeUpdateHeightCallback)&&(this._removeUpdateHeightCallback(),this._removeUpdateHeightCallback=void 0),c(this._terrainProviderChangedCallback)&&(this._terrainProviderChangedCallback(),this._terrainProviderChangedCallback=void 0);let n=this._clippingPlanes;c(n)&&!n.isDestroyed()&&n.owner===this&&n.destroy(),this._clippingPlanes=void 0;let i=this._clippingPolygons;c(i)&&!i.isDestroyed()&&i.owner===this&&i.destroy(),this._clippingPolygons=void 0,this._shouldDestroyImageBasedLighting&&!this._imageBasedLighting.isDestroyed()&&this._imageBasedLighting.destroy(),this._imageBasedLighting=void 0;let o=this._environmentMapManager;!o.isDestroyed()&&o.owner===this&&o.destroy(),this._environmentMapManager=void 0,de(this)};eo.prototype.destroyPipelineResources=function(){let e=this._pipelineResources;for(let t=0;t<e.length;t++)e[t].destroy();this._pipelineResources.length=0,this._pickIds.length=0};eo.prototype.destroyModelResources=function(){let e=this._modelResources;for(let t=0;t<e.length;t++)e[t].destroy();this._modelResources.length=0};eo.fromGltfAsync=async function(e){if(e=y(e,y.EMPTY_OBJECT),!c(e.url)&&!c(e.gltf))throw new E("options.url is required.");let t=y(e.url,e.gltf),n={releaseGltfJson:e.releaseGltfJson,asynchronous:e.asynchronous,incrementallyLoadTextures:e.incrementallyLoadTextures,upAxis:e.upAxis,forwardAxis:e.forwardAxis,loadAttributesFor2D:e.projectTo2D,enablePick:e.enablePick,loadIndicesForWireframe:e.enableDebugWireframe,loadPrimitiveOutline:e.enableShowOutline,loadForClassification:c(e.classificationType)},i=y(e.basePath,""),o=De.createIfNeeded(i);c(t.asset)?(n.gltfJson=t,n.baseResource=o,n.gltfResource=o):t instanceof Uint8Array?(n.typedArray=t,n.baseResource=o,n.gltfResource=o):n.gltfResource=De.createIfNeeded(t);let r=new S0(n),a=c(e.content)?Rr.TILE_GLTF:Rr.GLTF,l=n.gltfResource,u=xw(r,a,e);u.resource=l,u.environmentMapOptions=e.environmentMapOptions;try{await r.load()}catch(g){throw r.destroy(),Zt.getError("model",l,g)}let f=e.gltfCallback;c(f)&&(A.typeOf.func("options.gltfCallback",f),f(r.gltfJson));let d=new eo(u),p=d._resource.credits;if(c(p)){let g=p.length;for(let m=0;m<g;m++)d._resourceCredits.push(Pt.clone(p[m]))}return d};eo.fromB3dm=async function(e){let t={b3dmResource:e.resource,arrayBuffer:e.arrayBuffer,byteOffset:e.byteOffset,releaseGltfJson:e.releaseGltfJson,asynchronous:e.asynchronous,incrementallyLoadTextures:e.incrementallyLoadTextures,upAxis:e.upAxis,forwardAxis:e.forwardAxis,loadAttributesFor2D:e.projectTo2D,enablePick:e.enablePick,loadIndicesForWireframe:e.enableDebugWireframe,loadPrimitiveOutline:e.enableShowOutline,loadForClassification:c(e.classificationType)},n=new new S4(t);try{await n.load();let i=xw(n,Rr.TILE_B3DM,e);return new eo(i)}catch(i){throw n.destroy(),i}};eo.fromPnts=async function(e){let t={arrayBuffer:e.arrayBuffer,byteOffset:e.byteOffset,loadAttributesFor2D:e.projectTo2D},n=new OH(t);try{await n.load();let i=xw(n,Rr.TILE_PNTS,e);return new eo(i)}catch(i){throw n.destroy(),i}};eo.fromI3dm=async function(e){let t={i3dmResource:e.resource,arrayBuffer:e.arrayBuffer,byteOffset:e.byteOffset,releaseGltfJson:e.releaseGltfJson,asynchronous:e.asynchronous,incrementallyLoadTextures:e.incrementallyLoadTextures,upAxis:e.upAxis,forwardAxis:e.forwardAxis,loadAttributesFor2D:e.projectTo2D,enablePick:e.enablePick,loadIndicesForWireframe:e.enableDebugWireframe,loadPrimitiveOutline:e.enableShowOutline},n=new O4(t);try{await n.load();let i=xw(n,Rr.TILE_I3DM,e);return new eo(i)}catch(i){throw n.destroy(),i}};eo.fromGeoJson=async function(e){let t={geoJson:e.geoJson},n=new D4(t),i=xw(n,Rr.TILE_GEOJSON,e);return new eo(i)};var yGe=new j;eo.prototype.applyColorAndShow=function(e){let t=j.clone(this._color,yGe),n=c(e)&&c(e.color),i=c(e)&&c(e.show);this._color=n?e.color.evaluateColor(void 0,this._color):j.clone(j.WHITE,this._color),this._show=i?e.show.evaluate(void 0):!0,FH(t,this._color)&&this.resetDrawCommands()};eo.prototype.applyStyle=function(e){let t=this.type===Rr.TILE_PNTS,n=c(this.featureTableId)&&this.featureTables[this.featureTableId].featuresLength>0,i=c(this.structuralMetadata)?this.structuralMetadata.propertyAttributes:void 0,o=c(i)&&c(i[0]);if(t&&(!n||o)){this.resetDrawCommands();return}n?(this.featureTables[this.featureTableId].applyStyle(e),sse(this,e)):(this.applyColorAndShow(e),this._styleCommandsNeeded=void 0)};function xw(e,t,n){return{loader:e,type:t,resource:n.resource,show:n.show,modelMatrix:n.modelMatrix,scale:n.scale,enableVerticalExaggeration:n.enableVerticalExaggeration,minimumPixelSize:n.minimumPixelSize,maximumScale:n.maximumScale,id:n.id,allowPicking:n.allowPicking,clampAnimations:n.clampAnimations,shadows:n.shadows,debugShowBoundingVolume:n.debugShowBoundingVolume,enableDebugWireframe:n.enableDebugWireframe,debugWireframe:n.debugWireframe,cull:n.cull,opaquePass:n.opaquePass,customShader:n.customShader,content:n.content,heightReference:n.heightReference,scene:n.scene,distanceDisplayCondition:n.distanceDisplayCondition,color:n.color,colorBlendAmount:n.colorBlendAmount,colorBlendMode:n.colorBlendMode,silhouetteColor:n.silhouetteColor,silhouetteSize:n.silhouetteSize,enableShowOutline:n.enableShowOutline,showOutline:n.showOutline,outlineColor:n.outlineColor,clippingPlanes:n.clippingPlanes,clippingPolygons:n.clippingPolygons,lightColor:n.lightColor,imageBasedLighting:n.imageBasedLighting,backFaceCulling:n.backFaceCulling,credit:n.credit,showCreditsOnScreen:n.showCreditsOnScreen,splitDirection:n.splitDirection,projectTo2D:n.projectTo2D,enablePick:n.enablePick,featureIdLabel:n.featureIdLabel,instanceFeatureIdLabel:n.instanceFeatureIdLabel,pointCloudShading:n.pointCloudShading,classificationType:n.classificationType,pickObject:n.pickObject}}var mp=eo;function Qr(e,t,n){this._tileset=e,this._tile=t,this._resource=n,this._model=void 0,this._metadata=void 0,this._group=void 0,this._ready=!1}Object.defineProperties(Qr.prototype,{featuresLength:{get:function(){let e=this._model,t=e.featureTables,n=e.featureTableId;return c(t)&&c(t[n])?t[n].featuresLength:0}},pointsLength:{get:function(){return this._model.statistics.pointsLength}},trianglesLength:{get:function(){return this._model.statistics.trianglesLength}},geometryByteLength:{get:function(){return this._model.statistics.geometryByteLength}},texturesByteLength:{get:function(){return this._model.statistics.texturesByteLength}},batchTableByteLength:{get:function(){let e=this._model.statistics;return e.propertyTablesByteLength+e.batchTexturesByteLength}},innerContents:{get:function(){}},ready:{get:function(){return this._ready}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){return this._resource.getUrlComponent(!0)}},batchTable:{get:function(){let e=this._model,t=e.featureTables,n=e.featureTableId;if(c(t)&&c(t[n]))return t[n]}},metadata:{get:function(){return this._metadata},set:function(e){this._metadata=e}},group:{get:function(){return this._group},set:function(e){this._group=e}}});Qr.prototype.getExtension=function(e){return this._model.getExtension(e)};Qr.prototype.getFeature=function(e){let t=this._model,n=t.featureTableId;if(!c(n))throw new E("No feature ID set is selected. Make sure Cesium3DTileset.featureIdLabel or Cesium3DTileset.instanceFeatureIdLabel is defined");let i=t.featureTables[n];if(!c(i))throw new E("No feature table found for the selected feature ID set");let o=i.featuresLength;if(!c(e)||e<0||e>=o)throw new E(`featureId is required and must be between 0 and featuresLength - 1 (${o-1}).`);return i.getFeature(e)};Qr.prototype.hasProperty=function(e,t){let n=this._model,i=n.featureTableId;return c(i)?n.featureTables[i].hasProperty(e,t):!1};Qr.prototype.applyDebugSettings=function(e,t){t=e?t:j.WHITE,this.featuresLength===0?this._model.color=t:c(this.batchTable)&&this.batchTable.setAllColor(t)};Qr.prototype.applyStyle=function(e){this._model.style=e};Qr.prototype.update=function(e,t){let n=this._model,i=this._tile;n.colorBlendAmount=e.colorBlendAmount,n.colorBlendMode=e.colorBlendMode,n.modelMatrix=i.computedTransform,n.customShader=e.customShader,n.featureIdLabel=e.featureIdLabel,n.instanceFeatureIdLabel=e.instanceFeatureIdLabel,n.lightColor=e.lightColor,n.imageBasedLighting=e.imageBasedLighting,n.backFaceCulling=e.backFaceCulling,n.shadows=e.shadows,n.showCreditsOnScreen=e.showCreditsOnScreen,n.splitDirection=e.splitDirection,n.debugWireframe=e.debugWireframe,n.showOutline=e.showOutline,n.outlineColor=e.outlineColor,n.pointCloudShading=e.pointCloudShading;let o=e.clippingPlanes;n.referenceMatrix=e.clippingPlanesOriginMatrix,c(o)&&i.clippingPlanesDirty&&(n._clippingPlanes=o.enabled&&i._isClipped?o:void 0);let r=e.environmentMapManager;n.environmentMapManager!==o&&(n._environmentMapManager=r),c(o)&&c(n._clippingPlanes)&&n._clippingPlanes!==o&&(n._clippingPlanes=o,n._clippingPlanesState=0);let s=e.clippingPolygons;c(s)&&i.clippingPolygonsDirty&&(n._clippingPolygons=s.enabled&&i._isClippedByPolygon?s:void 0),c(s)&&c(n._clippingPolygons)&&n._clippingPolygons!==s&&(n._clippingPolygons=s,n._clippingPolygonsState=0),n.update(t),!this._ready&&n.ready&&(n.activeAnimations.addAll({loop:$u.REPEAT}),this._ready=!0)};Qr.prototype.isDestroyed=function(){return!1};Qr.prototype.destroy=function(){return this._model=this._model&&this._model.destroy(),de(this)};Qr.fromGltf=async function(e,t,n,i){let o=new Qr(e,t,n),s=Tw(e,t,o,{gltf:i,basePath:n}),a=e.vectorClassificationOnly?void 0:e.classificationType;s.classificationType=a;let l=await mp.fromGltfAsync(s);return o._model=l,o};Qr.fromB3dm=async function(e,t,n,i,o){let r=new Qr(e,t,n),a=Tw(e,t,r,{arrayBuffer:i,byteOffset:o,resource:n}),l=e.vectorClassificationOnly?void 0:e.classificationType;a.classificationType=l;let u=await mp.fromB3dm(a);return r._model=u,r};Qr.fromI3dm=async function(e,t,n,i,o){let r=new Qr(e,t,n),a=Tw(e,t,r,{arrayBuffer:i,byteOffset:o,resource:n}),l=await mp.fromI3dm(a);return r._model=l,r};Qr.fromPnts=async function(e,t,n,i,o){let r=new Qr(e,t,n),a=Tw(e,t,r,{arrayBuffer:i,byteOffset:o,resource:n}),l=await mp.fromPnts(a);return r._model=l,r};Qr.fromGeoJson=async function(e,t,n,i){let o=new Qr(e,t,n),s=Tw(e,t,o,{geoJson:i,resource:n}),a=await mp.fromGeoJson(s);return o._model=a,o};Qr.prototype.pick=function(e,t,n){if(!c(this._model)||!this._ready)return;let i=t.verticalExaggeration,o=t.verticalExaggerationRelativeHeight;return this._model.pick(e,t,i,o,ie.WGS84,n)};function Tw(e,t,n,i){let o={cull:!1,releaseGltfJson:!0,opaquePass:ve.CESIUM_3D_TILE,modelMatrix:t.computedTransform,upAxis:e._modelUpAxis,forwardAxis:e._modelForwardAxis,incrementallyLoadTextures:!1,customShader:e.customShader,content:n,colorBlendMode:e.colorBlendMode,colorBlendAmount:e.colorBlendAmount,lightColor:e.lightColor,imageBasedLighting:e.imageBasedLighting,featureIdLabel:e.featureIdLabel,instanceFeatureIdLabel:e.instanceFeatureIdLabel,pointCloudShading:e.pointCloudShading,clippingPlanes:e.clippingPlanes,backFaceCulling:e.backFaceCulling,shadows:e.shadows,showCreditsOnScreen:e.showCreditsOnScreen,splitDirection:e.splitDirection,enableDebugWireframe:e._enableDebugWireframe,debugWireframe:e.debugWireframe,projectTo2D:e._projectTo2D,enablePick:e._enablePick,enableShowOutline:e._enableShowOutline,showOutline:e.showOutline,outlineColor:e.outlineColor};return At(i,o)}var rg=Qr;function Qu(e,t,n){this._tileset=e,this._tile=t,this._resource=n,this.featurePropertiesDirty=!1,this._metadata=void 0,this._group=void 0,this._ready=!1}Object.defineProperties(Qu.prototype,{featuresLength:{get:function(){return 0}},pointsLength:{get:function(){return 0}},trianglesLength:{get:function(){return 0}},geometryByteLength:{get:function(){return 0}},texturesByteLength:{get:function(){return 0}},batchTableByteLength:{get:function(){return 0}},innerContents:{get:function(){}},ready:{get:function(){return this._ready}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){return this._resource.getUrlComponent(!0)}},batchTable:{get:function(){}},metadata:{get:function(){return this._metadata},set:function(e){this._metadata=e}},group:{get:function(){return this._group},set:function(e){this._group=e}}});Qu.fromJson=function(e,t,n,i){let o=new Qu(e,t,n);return o._tileset.loadTileset(o._resource,i,o._tile),o._ready=!0,o};Qu.prototype.hasProperty=function(e,t){return!1};Qu.prototype.getFeature=function(e){};Qu.prototype.applyDebugSettings=function(e,t){};Qu.prototype.applyStyle=function(e){};Qu.prototype.update=function(e,t){};Qu.prototype.pick=function(e,t,n){};Qu.prototype.isDestroyed=function(){return!1};Qu.prototype.destroy=function(){return de(this)};var BH=Qu;function Ns(e,t,n,i){if(A.defined("context",e),!t||t.length===0)throw new E("At least one attribute is required.");let o=Ns._verifyAttributes(t);n=y(n,0);let r=[],s={},a,l,u=o.length;for(let d=0;d<u;++d){let p=o[d];if(p.vertexBuffer){r.push(p);continue}l=p.usage,a=s[l],c(a)||(a=s[l]=[]),a.push(p)}function f(d,p){return $.getSizeInBytes(p.componentDatatype)-$.getSizeInBytes(d.componentDatatype)}this._allBuffers=[];for(l in s)if(s.hasOwnProperty(l)){a=s[l],a.sort(f);let d=Ns._vertexSizeInBytes(a),p=a[0].usage,g={vertexSizeInBytes:d,vertexBuffer:void 0,usage:p,needsCommit:!1,arrayBuffer:void 0,arrayViews:Ns._createArrayViews(a,d)};this._allBuffers.push(g)}this._size=0,this._instanced=y(i,!1),this._precreated=r,this._context=e,this.writers=void 0,this.va=void 0,this.resize(n)}Ns._verifyAttributes=function(e){let t=[];for(let i=0;i<e.length;++i){let o=e[i],r={index:y(o.index,i),enabled:y(o.enabled,!0),componentsPerAttribute:o.componentsPerAttribute,componentDatatype:y(o.componentDatatype,$.FLOAT),normalize:y(o.normalize,!1),vertexBuffer:o.vertexBuffer,usage:y(o.usage,ke.STATIC_DRAW)};if(t.push(r),r.componentsPerAttribute!==1&&r.componentsPerAttribute!==2&&r.componentsPerAttribute!==3&&r.componentsPerAttribute!==4)throw new E("attribute.componentsPerAttribute must be in the range [1, 4].");let s=r.componentDatatype;if(!$.validate(s))throw new E("Attribute must have a valid componentDatatype or not specify it.");if(!ke.validate(r.usage))throw new E("Attribute must have a valid usage or not specify it.")}let n=new Array(t.length);for(let i=0;i<t.length;++i){let r=t[i].index;if(n[r])throw new E(`Index ${r} is used by more than one attribute.`);n[r]=!0}return t};Ns._vertexSizeInBytes=function(e){let t=0,n=e.length;for(let s=0;s<n;++s){let a=e[s];t+=a.componentsPerAttribute*$.getSizeInBytes(a.componentDatatype)}let i=n>0?$.getSizeInBytes(e[0].componentDatatype):0,o=i>0?t%i:0,r=o===0?0:i-o;return t+=r,t};Ns._createArrayViews=function(e,t){let n=[],i=0,o=e.length;for(let r=0;r<o;++r){let s=e[r],a=s.componentDatatype;n.push({index:s.index,enabled:s.enabled,componentsPerAttribute:s.componentsPerAttribute,componentDatatype:a,normalize:s.normalize,offsetInBytes:i,vertexSizeInComponentType:t/$.getSizeInBytes(a),view:void 0}),i+=s.componentsPerAttribute*$.getSizeInBytes(a)}return n};Ns.prototype.resize=function(e){this._size=e;let t=this._allBuffers;this.writers=[];for(let n=0,i=t.length;n<i;++n){let o=t[n];Ns._resize(o,this._size),Ns._appendWriters(this.writers,o)}kH(this)};Ns._resize=function(e,t){if(e.vertexSizeInBytes>0){let n=new ArrayBuffer(t*e.vertexSizeInBytes);if(c(e.arrayBuffer)){let r=new Uint8Array(n),s=new Uint8Array(e.arrayBuffer),a=s.length;for(let l=0;l<a;++l)r[l]=s[l]}let i=e.arrayViews,o=i.length;for(let r=0;r<o;++r){let s=i[r];s.view=$.createArrayBufferView(s.componentDatatype,n,s.offsetInBytes)}e.arrayBuffer=n}};var bGe=[function(e,t,n){return function(i,o){t[i*n]=o,e.needsCommit=!0}},function(e,t,n){return function(i,o,r){let s=i*n;t[s]=o,t[s+1]=r,e.needsCommit=!0}},function(e,t,n){return function(i,o,r,s){let a=i*n;t[a]=o,t[a+1]=r,t[a+2]=s,e.needsCommit=!0}},function(e,t,n){return function(i,o,r,s,a){let l=i*n;t[l]=o,t[l+1]=r,t[l+2]=s,t[l+3]=a,e.needsCommit=!0}}];Ns._appendWriters=function(e,t){let n=t.arrayViews,i=n.length;for(let o=0;o<i;++o){let r=n[o];e[r.index]=bGe[r.componentsPerAttribute-1](t,r.view,r.vertexSizeInComponentType)}};Ns.prototype.commit=function(e){let t=!1,n=this._allBuffers,i,o,r;for(o=0,r=n.length;o<r;++o)i=n[o],t=xGe(this,i)||t;if(t||!c(this.va)){kH(this);let s=this.va=[],a=R.SIXTY_FOUR_KILOBYTES-4,l=c(e)&&!this._instanced?Math.ceil(this._size/a):1;for(let u=0;u<l;++u){let f=[];for(o=0,r=n.length;o<r;++o){i=n[o];let d=u*(i.vertexSizeInBytes*a);Ns._appendAttributes(f,i,d,this._instanced)}f=f.concat(this._precreated),s.push({va:new ni({context:this._context,attributes:f,indexBuffer:e}),indicesCount:1.5*(u!==l-1?a:this._size%a)})}}};function xGe(e,t){if(t.needsCommit&&t.vertexSizeInBytes>0){t.needsCommit=!1;let n=t.vertexBuffer,i=e._size*t.vertexSizeInBytes,o=c(n);if(!o||n.sizeInBytes<i)return o&&n.destroy(),t.vertexBuffer=xt.createVertexBuffer({context:e._context,typedArray:t.arrayBuffer,usage:t.usage}),t.vertexBuffer.vertexArrayDestroyable=!1,!0;t.vertexBuffer.copyFromArrayView(t.arrayBuffer)}return!1}Ns._appendAttributes=function(e,t,n,i){let o=t.arrayViews,r=o.length;for(let s=0;s<r;++s){let a=o[s];e.push({index:a.index,enabled:a.enabled,componentsPerAttribute:a.componentsPerAttribute,componentDatatype:a.componentDatatype,normalize:a.normalize,vertexBuffer:t.vertexBuffer,offsetInBytes:n+a.offsetInBytes,strideInBytes:t.vertexSizeInBytes,instanceDivisor:i?1:0})}};Ns.prototype.subCommit=function(e,t){if(e<0||e>=this._size)throw new E("offsetInVertices must be greater than or equal to zero and less than the vertex array size.");if(e+t>this._size)throw new E("offsetInVertices + lengthInVertices cannot exceed the vertex array size.");let n=this._allBuffers;for(let i=0,o=n.length;i<o;++i)TGe(n[i],e,t)};function TGe(e,t,n){if(e.needsCommit&&e.vertexSizeInBytes>0){let i=e.vertexSizeInBytes*t,o=e.vertexSizeInBytes*n;e.vertexBuffer.copyFromArrayView(new Uint8Array(e.arrayBuffer,i,o),i)}}Ns.prototype.endSubCommits=function(){let e=this._allBuffers;for(let t=0,n=e.length;t<n;++t)e[t].needsCommit=!1};function kH(e){let t=e.va;if(!c(t))return;let n=t.length;for(let i=0;i<n;++i)t[i].va.destroy();e.va=void 0}Ns.prototype.isDestroyed=function(){return!1};Ns.prototype.destroy=function(){let e=this._allBuffers;for(let t=0,n=e.length;t<n;++t){let i=e[t];i.vertexBuffer=i.vertexBuffer&&i.vertexBuffer.destroy()}return kH(this),de(this)};var L0=Ns;var VH=`uniform sampler2D u_atlas;
#ifdef VECTOR_TILE
uniform vec4 u_highlightColor;
#endif
in vec2 v_textureCoordinates;
in vec4 v_pickColor;
in vec4 v_color;
in float v_splitDirection;
#ifdef SDF
in vec4 v_outlineColor;
in float v_outlineWidth;
#endif
#ifdef FRAGMENT_DEPTH_CHECK
in vec4 v_textureCoordinateBounds;
in vec4 v_originTextureCoordinateAndTranslate;
in vec4 v_compressed;
in mat2 v_rotationMatrix;
const float SHIFT_LEFT12 = 4096.0;
const float SHIFT_LEFT1 = 2.0;
const float SHIFT_RIGHT12 = 1.0 / 4096.0;
const float SHIFT_RIGHT1 = 1.0 / 2.0;
float getGlobeDepth(vec2 adjustedST, vec2 depthLookupST, bool applyTranslate, vec2 dimensions, vec2 imageSize)
{
vec2 lookupVector = imageSize * (depthLookupST - adjustedST);
lookupVector = v_rotationMatrix * lookupVector;
vec2 labelOffset = (dimensions - imageSize) * (depthLookupST - vec2(0.0, v_originTextureCoordinateAndTranslate.y));
vec2 translation = v_originTextureCoordinateAndTranslate.zw;
if (applyTranslate)
{
translation += (dimensions * v_originTextureCoordinateAndTranslate.xy * vec2(1.0, 0.0));
}
vec2 st = ((lookupVector - translation + labelOffset) + gl_FragCoord.xy) / czm_viewport.zw;
float logDepthOrDepth = czm_unpackDepth(texture(czm_globeDepthTexture, st));
if (logDepthOrDepth == 0.0)
{
return 0.0;
}
vec4 eyeCoordinate = czm_windowToEyeCoordinates(gl_FragCoord.xy, logDepthOrDepth);
return eyeCoordinate.z / eyeCoordinate.w;
}
#endif
#ifdef SDF
float getDistance(vec2 position)
{
return texture(u_atlas, position).r;
}
vec4 getSDFColor(vec2 position, float outlineWidth, vec4 outlineColor, float smoothing)
{
float distance = getDistance(position);
if (outlineWidth > 0.0)
{
float outlineEdge = clamp(SDF_EDGE - outlineWidth, 0.0, SDF_EDGE);
float outlineFactor = smoothstep(SDF_EDGE - smoothing, SDF_EDGE + smoothing, distance);
vec4 sdfColor = mix(outlineColor, v_color, outlineFactor);
float alpha = smoothstep(outlineEdge - smoothing, outlineEdge + smoothing, distance);
return vec4(sdfColor.rgb, sdfColor.a * alpha);
}
else
{
float alpha = smoothstep(SDF_EDGE - smoothing, SDF_EDGE + smoothing, distance);
return vec4(v_color.rgb, v_color.a * alpha);
}
}
#endif
void main()
{
if (v_splitDirection < 0.0 && gl_FragCoord.x > czm_splitPosition) discard;
if (v_splitDirection > 0.0 && gl_FragCoord.x < czm_splitPosition) discard;
vec4 color = texture(u_atlas, v_textureCoordinates);
#ifdef SDF
float outlineWidth = v_outlineWidth;
vec4 outlineColor = v_outlineColor;
float distance = getDistance(v_textureCoordinates);
#if (__VERSION__ == 300 || defined(GL_OES_standard_derivatives))
float smoothing = fwidth(distance);
vec2 sampleOffset = 0.354 * vec2(dFdx(v_textureCoordinates) + dFdy(v_textureCoordinates));
vec4 center = getSDFColor(v_textureCoordinates, outlineWidth, outlineColor, smoothing);
vec4 color1 = getSDFColor(v_textureCoordinates + vec2(sampleOffset.x, sampleOffset.y), outlineWidth, outlineColor, smoothing);
vec4 color2 = getSDFColor(v_textureCoordinates + vec2(-sampleOffset.x, sampleOffset.y), outlineWidth, outlineColor, smoothing);
vec4 color3 = getSDFColor(v_textureCoordinates + vec2(-sampleOffset.x, -sampleOffset.y), outlineWidth, outlineColor, smoothing);
vec4 color4 = getSDFColor(v_textureCoordinates + vec2(sampleOffset.x, -sampleOffset.y), outlineWidth, outlineColor, smoothing);
color = (center + color1 + color2 + color3 + color4)/5.0;
#else
float smoothing = 1.0/32.0;
color = getSDFColor(v_textureCoordinates, outlineWidth, outlineColor, smoothing);
#endif
color = czm_gammaCorrect(color);
#else
color = czm_gammaCorrect(color);
color *= czm_gammaCorrect(v_color);
#endif
#if !defined(OPAQUE) && !defined(TRANSLUCENT)
if (color.a < 0.005)
{
discard;
}
#else
#ifdef OPAQUE
if (color.a < 0.995)
{
discard;
}
#else
if (color.a >= 0.995)
{
discard;
}
#endif
#endif
#ifdef VECTOR_TILE
color *= u_highlightColor;
#endif
out_FragColor = color;
#ifdef LOG_DEPTH
czm_writeLogDepth();
#endif
#ifdef FRAGMENT_DEPTH_CHECK
float temp = v_compressed.y;
temp = temp * SHIFT_RIGHT1;
float temp2 = (temp - floor(temp)) * SHIFT_LEFT1;
bool enableDepthTest = temp2 != 0.0;
bool applyTranslate = floor(temp) != 0.0;
if (enableDepthTest) {
temp = v_compressed.z;
temp = temp * SHIFT_RIGHT12;
vec2 dimensions;
dimensions.y = (temp - floor(temp)) * SHIFT_LEFT12;
dimensions.x = floor(temp);
temp = v_compressed.w;
temp = temp * SHIFT_RIGHT12;
vec2 imageSize;
imageSize.y = (temp - floor(temp)) * SHIFT_LEFT12;
imageSize.x = floor(temp);
vec2 adjustedST = v_textureCoordinates - v_textureCoordinateBounds.xy;
adjustedST = adjustedST / vec2(v_textureCoordinateBounds.z - v_textureCoordinateBounds.x, v_textureCoordinateBounds.w - v_textureCoordinateBounds.y);
float epsilonEyeDepth = v_compressed.x + czm_epsilon1;
float globeDepth1 = getGlobeDepth(adjustedST, v_originTextureCoordinateAndTranslate.xy, applyTranslate, dimensions, imageSize);
if (globeDepth1 != 0.0 && globeDepth1 > epsilonEyeDepth)
{
float globeDepth2 = getGlobeDepth(adjustedST, vec2(0.0, 1.0), applyTranslate, dimensions, imageSize);
if (globeDepth2 != 0.0 && globeDepth2 > epsilonEyeDepth)
{
float globeDepth3 = getGlobeDepth(adjustedST, vec2(1.0, 1.0), applyTranslate, dimensions, imageSize);
if (globeDepth3 != 0.0 && globeDepth3 > epsilonEyeDepth)
{
discard;
}
}
}
}
#endif
}
`;var UH=`#ifdef INSTANCED
in vec2 direction;
#endif
in vec4 positionHighAndScale;
in vec4 positionLowAndRotation;
in vec4 compressedAttribute0;
in vec4 compressedAttribute1;
in vec4 compressedAttribute2;
in vec4 eyeOffset;
in vec4 scaleByDistance;
in vec4 pixelOffsetScaleByDistance;
in vec4 compressedAttribute3;
in vec2 sdf;
in float splitDirection;
#if defined(VERTEX_DEPTH_CHECK) || defined(FRAGMENT_DEPTH_CHECK)
in vec4 textureCoordinateBoundsOrLabelTranslate;
#endif
#ifdef VECTOR_TILE
in float a_batchId;
#endif
out vec2 v_textureCoordinates;
#ifdef FRAGMENT_DEPTH_CHECK
out vec4 v_textureCoordinateBounds;
out vec4 v_originTextureCoordinateAndTranslate;
out vec4 v_compressed;
out mat2 v_rotationMatrix;
#endif
out vec4 v_pickColor;
out vec4 v_color;
out float v_splitDirection;
#ifdef SDF
out vec4 v_outlineColor;
out float v_outlineWidth;
#endif
const float UPPER_BOUND = 32768.0;
const float SHIFT_LEFT16 = 65536.0;
const float SHIFT_LEFT12 = 4096.0;
const float SHIFT_LEFT8 = 256.0;
const float SHIFT_LEFT7 = 128.0;
const float SHIFT_LEFT5 = 32.0;
const float SHIFT_LEFT3 = 8.0;
const float SHIFT_LEFT2 = 4.0;
const float SHIFT_LEFT1 = 2.0;
const float SHIFT_RIGHT12 = 1.0 / 4096.0;
const float SHIFT_RIGHT8 = 1.0 / 256.0;
const float SHIFT_RIGHT7 = 1.0 / 128.0;
const float SHIFT_RIGHT5 = 1.0 / 32.0;
const float SHIFT_RIGHT3 = 1.0 / 8.0;
const float SHIFT_RIGHT2 = 1.0 / 4.0;
const float SHIFT_RIGHT1 = 1.0 / 2.0;
vec4 addScreenSpaceOffset(vec4 positionEC, vec2 imageSize, float scale, vec2 direction, vec2 origin, vec2 translate, vec2 pixelOffset, vec3 alignedAxis, bool validAlignedAxis, float rotation, bool sizeInMeters, out mat2 rotationMatrix, out float mpp)
{
vec2 halfSize = imageSize * scale * 0.5;
halfSize *= ((direction * 2.0) - 1.0);
vec2 originTranslate = origin * abs(halfSize);
#if defined(ROTATION) || defined(ALIGNED_AXIS)
if (validAlignedAxis || rotation != 0.0)
{
float angle = rotation;
if (validAlignedAxis)
{
vec4 projectedAlignedAxis = czm_modelView3D * vec4(alignedAxis, 0.0);
angle += sign(-projectedAlignedAxis.x) * acos(sign(projectedAlignedAxis.y) * (projectedAlignedAxis.y * projectedAlignedAxis.y) /
(projectedAlignedAxis.x * projectedAlignedAxis.x + projectedAlignedAxis.y * projectedAlignedAxis.y));
}
float cosTheta = cos(angle);
float sinTheta = sin(angle);
rotationMatrix = mat2(cosTheta, sinTheta, -sinTheta, cosTheta);
halfSize = rotationMatrix * halfSize;
}
else
{
rotationMatrix = mat2(1.0, 0.0, 0.0, 1.0);
}
#endif
mpp = czm_metersPerPixel(positionEC);
positionEC.xy += (originTranslate + halfSize) * czm_branchFreeTernary(sizeInMeters, 1.0, mpp);
positionEC.xy += (translate + pixelOffset) * mpp;
return positionEC;
}
#ifdef VERTEX_DEPTH_CHECK
float getGlobeDepth(vec4 positionEC)
{
vec4 posWC = czm_eyeToWindowCoordinates(positionEC);
float globeDepth = czm_unpackDepth(texture(czm_globeDepthTexture, posWC.xy / czm_viewport.zw));
if (globeDepth == 0.0)
{
return 0.0;
}
vec4 eyeCoordinate = czm_windowToEyeCoordinates(posWC.xy, globeDepth);
return eyeCoordinate.z / eyeCoordinate.w;
}
#endif
void main()
{
vec3 positionHigh = positionHighAndScale.xyz;
vec3 positionLow = positionLowAndRotation.xyz;
float scale = positionHighAndScale.w;
#if defined(ROTATION) || defined(ALIGNED_AXIS)
float rotation = positionLowAndRotation.w;
#else
float rotation = 0.0;
#endif
float compressed = compressedAttribute0.x;
vec2 pixelOffset;
pixelOffset.x = floor(compressed * SHIFT_RIGHT7);
compressed -= pixelOffset.x * SHIFT_LEFT7;
pixelOffset.x -= UPPER_BOUND;
vec2 origin;
origin.x = floor(compressed * SHIFT_RIGHT5);
compressed -= origin.x * SHIFT_LEFT5;
origin.y = floor(compressed * SHIFT_RIGHT3);
compressed -= origin.y * SHIFT_LEFT3;
#ifdef FRAGMENT_DEPTH_CHECK
vec2 depthOrigin = origin.xy;
#endif
origin -= vec2(1.0);
float show = floor(compressed * SHIFT_RIGHT2);
compressed -= show * SHIFT_LEFT2;
#ifdef INSTANCED
vec2 textureCoordinatesBottomLeft = czm_decompressTextureCoordinates(compressedAttribute0.w);
vec2 textureCoordinatesRange = czm_decompressTextureCoordinates(eyeOffset.w);
vec2 textureCoordinates = textureCoordinatesBottomLeft + direction * textureCoordinatesRange;
#else
vec2 direction;
direction.x = floor(compressed * SHIFT_RIGHT1);
direction.y = compressed - direction.x * SHIFT_LEFT1;
vec2 textureCoordinates = czm_decompressTextureCoordinates(compressedAttribute0.w);
#endif
float temp = compressedAttribute0.y  * SHIFT_RIGHT8;
pixelOffset.y = -(floor(temp) - UPPER_BOUND);
vec2 translate;
translate.y = (temp - floor(temp)) * SHIFT_LEFT16;
temp = compressedAttribute0.z * SHIFT_RIGHT8;
translate.x = floor(temp) - UPPER_BOUND;
translate.y += (temp - floor(temp)) * SHIFT_LEFT8;
translate.y -= UPPER_BOUND;
temp = compressedAttribute1.x * SHIFT_RIGHT8;
float temp2 = floor(compressedAttribute2.w * SHIFT_RIGHT2);
vec2 imageSize = vec2(floor(temp), temp2);
#ifdef FRAGMENT_DEPTH_CHECK
float labelHorizontalOrigin = floor(compressedAttribute2.w - (temp2 * SHIFT_LEFT2));
float applyTranslate = 0.0;
if (labelHorizontalOrigin != 0.0)
{
applyTranslate = 1.0;
labelHorizontalOrigin -= 2.0;
depthOrigin.x = labelHorizontalOrigin + 1.0;
}
depthOrigin = vec2(1.0) - (depthOrigin * 0.5);
#endif
#ifdef EYE_DISTANCE_TRANSLUCENCY
vec4 translucencyByDistance;
translucencyByDistance.x = compressedAttribute1.z;
translucencyByDistance.z = compressedAttribute1.w;
translucencyByDistance.y = ((temp - floor(temp)) * SHIFT_LEFT8) / 255.0;
temp = compressedAttribute1.y * SHIFT_RIGHT8;
translucencyByDistance.w = ((temp - floor(temp)) * SHIFT_LEFT8) / 255.0;
#endif
#if defined(VERTEX_DEPTH_CHECK) || defined(FRAGMENT_DEPTH_CHECK)
temp = compressedAttribute3.w;
temp = temp * SHIFT_RIGHT12;
vec2 dimensions;
dimensions.y = (temp - floor(temp)) * SHIFT_LEFT12;
dimensions.x = floor(temp);
#endif
#ifdef ALIGNED_AXIS
vec3 alignedAxis = czm_octDecode(floor(compressedAttribute1.y * SHIFT_RIGHT8));
temp = compressedAttribute2.z * SHIFT_RIGHT5;
bool validAlignedAxis = (temp - floor(temp)) * SHIFT_LEFT1 > 0.0;
#else
vec3 alignedAxis = vec3(0.0);
bool validAlignedAxis = false;
#endif
vec4 pickColor;
vec4 color;
temp = compressedAttribute2.y;
temp = temp * SHIFT_RIGHT8;
pickColor.b = (temp - floor(temp)) * SHIFT_LEFT8;
temp = floor(temp) * SHIFT_RIGHT8;
pickColor.g = (temp - floor(temp)) * SHIFT_LEFT8;
pickColor.r = floor(temp);
temp = compressedAttribute2.x;
temp = temp * SHIFT_RIGHT8;
color.b = (temp - floor(temp)) * SHIFT_LEFT8;
temp = floor(temp) * SHIFT_RIGHT8;
color.g = (temp - floor(temp)) * SHIFT_LEFT8;
color.r = floor(temp);
temp = compressedAttribute2.z * SHIFT_RIGHT8;
bool sizeInMeters = floor((temp - floor(temp)) * SHIFT_LEFT7) > 0.0;
temp = floor(temp) * SHIFT_RIGHT8;
pickColor.a = (temp - floor(temp)) * SHIFT_LEFT8;
pickColor /= 255.0;
color.a = floor(temp);
color /= 255.0;
vec4 p = czm_translateRelativeToEye(positionHigh, positionLow);
vec4 positionEC = czm_modelViewRelativeToEye * p;
#if defined(FRAGMENT_DEPTH_CHECK) || defined(VERTEX_DEPTH_CHECK)
float eyeDepth = positionEC.z;
#endif
positionEC = czm_eyeOffset(positionEC, eyeOffset.xyz);
positionEC.xyz *= show;
#if defined(EYE_DISTANCE_SCALING) || defined(EYE_DISTANCE_TRANSLUCENCY) || defined(EYE_DISTANCE_PIXEL_OFFSET) || defined(DISTANCE_DISPLAY_CONDITION) || defined(DISABLE_DEPTH_DISTANCE)
float lengthSq;
if (czm_sceneMode == czm_sceneMode2D)
{
lengthSq = czm_eyeHeight2D.y;
}
else
{
lengthSq = dot(positionEC.xyz, positionEC.xyz);
}
#endif
#ifdef EYE_DISTANCE_SCALING
float distanceScale = czm_nearFarScalar(scaleByDistance, lengthSq);
scale *= distanceScale;
translate *= distanceScale;
if (scale == 0.0)
{
positionEC.xyz = vec3(0.0);
}
#endif
float translucency = 1.0;
#ifdef EYE_DISTANCE_TRANSLUCENCY
translucency = czm_nearFarScalar(translucencyByDistance, lengthSq);
if (translucency == 0.0)
{
positionEC.xyz = vec3(0.0);
}
#endif
#ifdef EYE_DISTANCE_PIXEL_OFFSET
float pixelOffsetScale = czm_nearFarScalar(pixelOffsetScaleByDistance, lengthSq);
pixelOffset *= pixelOffsetScale;
#endif
#ifdef DISTANCE_DISPLAY_CONDITION
float nearSq = compressedAttribute3.x;
float farSq = compressedAttribute3.y;
if (lengthSq < nearSq || lengthSq > farSq)
{
positionEC.xyz = vec3(0.0);
}
#endif
mat2 rotationMatrix;
float mpp;
#ifdef DISABLE_DEPTH_DISTANCE
float disableDepthTestDistance = compressedAttribute3.z;
#endif
#ifdef VERTEX_DEPTH_CHECK
if (lengthSq < disableDepthTestDistance) {
float depthsilon = 10.0;
vec2 labelTranslate = textureCoordinateBoundsOrLabelTranslate.xy;
vec4 pEC1 = addScreenSpaceOffset(positionEC, dimensions, scale, vec2(0.0), origin, labelTranslate, pixelOffset, alignedAxis, validAlignedAxis, rotation, sizeInMeters, rotationMatrix, mpp);
float globeDepth1 = getGlobeDepth(pEC1);
if (globeDepth1 != 0.0 && pEC1.z + depthsilon < globeDepth1)
{
vec4 pEC2 = addScreenSpaceOffset(positionEC, dimensions, scale, vec2(0.0, 1.0), origin, labelTranslate, pixelOffset, alignedAxis, validAlignedAxis, rotation, sizeInMeters, rotationMatrix, mpp);
float globeDepth2 = getGlobeDepth(pEC2);
if (globeDepth2 != 0.0 && pEC2.z + depthsilon < globeDepth2)
{
vec4 pEC3 = addScreenSpaceOffset(positionEC, dimensions, scale, vec2(1.0), origin, labelTranslate, pixelOffset, alignedAxis, validAlignedAxis, rotation, sizeInMeters, rotationMatrix, mpp);
float globeDepth3 = getGlobeDepth(pEC3);
if (globeDepth3 != 0.0 && pEC3.z + depthsilon < globeDepth3)
{
positionEC.xyz = vec3(0.0);
}
}
}
}
#endif
positionEC = addScreenSpaceOffset(positionEC, imageSize, scale, direction, origin, translate, pixelOffset, alignedAxis, validAlignedAxis, rotation, sizeInMeters, rotationMatrix, mpp);
gl_Position = czm_projection * positionEC;
v_textureCoordinates = textureCoordinates;
#ifdef LOG_DEPTH
czm_vertexLogDepth();
#endif
#ifdef DISABLE_DEPTH_DISTANCE
if (disableDepthTestDistance == 0.0 && czm_minimumDisableDepthTestDistance != 0.0)
{
disableDepthTestDistance = czm_minimumDisableDepthTestDistance;
}
if (disableDepthTestDistance != 0.0)
{
float zclip = gl_Position.z / gl_Position.w;
bool clipped = (zclip < -1.0 || zclip > 1.0);
if (!clipped && (disableDepthTestDistance < 0.0 || (lengthSq > 0.0 && lengthSq < disableDepthTestDistance)))
{
gl_Position.z = -gl_Position.w;
#ifdef LOG_DEPTH
v_depthFromNearPlusOne = 1.0;
#endif
}
}
#endif
#ifdef FRAGMENT_DEPTH_CHECK
if (sizeInMeters) {
translate /= mpp;
dimensions /= mpp;
imageSize /= mpp;
}
#if defined(ROTATION) || defined(ALIGNED_AXIS)
v_rotationMatrix = rotationMatrix;
#else
v_rotationMatrix = mat2(1.0, 0.0, 0.0, 1.0);
#endif
float enableDepthCheck = 0.0;
if (lengthSq < disableDepthTestDistance)
{
enableDepthCheck = 1.0;
}
float dw = floor(clamp(dimensions.x, 0.0, SHIFT_LEFT12));
float dh = floor(clamp(dimensions.y, 0.0, SHIFT_LEFT12));
float iw = floor(clamp(imageSize.x, 0.0, SHIFT_LEFT12));
float ih = floor(clamp(imageSize.y, 0.0, SHIFT_LEFT12));
v_compressed.x = eyeDepth;
v_compressed.y = applyTranslate * SHIFT_LEFT1 + enableDepthCheck;
v_compressed.z = dw * SHIFT_LEFT12 + dh;
v_compressed.w = iw * SHIFT_LEFT12 + ih;
v_originTextureCoordinateAndTranslate.xy = depthOrigin;
v_originTextureCoordinateAndTranslate.zw = translate;
v_textureCoordinateBounds = textureCoordinateBoundsOrLabelTranslate;
#endif
#ifdef SDF
vec4 outlineColor;
float outlineWidth;
temp = sdf.x;
temp = temp * SHIFT_RIGHT8;
outlineColor.b = (temp - floor(temp)) * SHIFT_LEFT8;
temp = floor(temp) * SHIFT_RIGHT8;
outlineColor.g = (temp - floor(temp)) * SHIFT_LEFT8;
outlineColor.r = floor(temp);
temp = sdf.y;
temp = temp * SHIFT_RIGHT8;
float temp3 = (temp - floor(temp)) * SHIFT_LEFT8;
temp = floor(temp) * SHIFT_RIGHT8;
outlineWidth = (temp - floor(temp)) * SHIFT_LEFT8;
outlineColor.a = floor(temp);
outlineColor /= 255.0;
v_outlineWidth = outlineWidth / 255.0;
v_outlineColor = outlineColor;
v_outlineColor.a *= translucency;
#endif
v_pickColor = pickColor;
v_color = color;
v_color.a *= translucency;
v_splitDirection = splitDirection;
}
`;function hi(e,t){if(e=y(e,y.EMPTY_OBJECT),c(e.disableDepthTestDistance)&&e.disableDepthTestDistance<0)throw new E("disableDepthTestDistance must be greater than or equal to 0.0.");let n=e.translucencyByDistance,i=e.pixelOffsetScaleByDistance,o=e.scaleByDistance,r=e.distanceDisplayCondition;if(c(n)){if(n.far<=n.near)throw new E("translucencyByDistance.far must be greater than translucencyByDistance.near.");n=Vt.clone(n)}if(c(i)){if(i.far<=i.near)throw new E("pixelOffsetScaleByDistance.far must be greater than pixelOffsetScaleByDistance.near.");i=Vt.clone(i)}if(c(o)){if(o.far<=o.near)throw new E("scaleByDistance.far must be greater than scaleByDistance.near.");o=Vt.clone(o)}if(c(r)){if(r.far<=r.near)throw new E("distanceDisplayCondition.far must be greater than distanceDisplayCondition.near.");r=Bt.clone(r)}this._show=y(e.show,!0),this._position=h.clone(y(e.position,h.ZERO)),this._actualPosition=h.clone(this._position),this._pixelOffset=H.clone(y(e.pixelOffset,H.ZERO)),this._translate=new H(0,0),this._eyeOffset=h.clone(y(e.eyeOffset,h.ZERO)),this._heightReference=y(e.heightReference,$e.NONE),this._verticalOrigin=y(e.verticalOrigin,Ln.CENTER),this._horizontalOrigin=y(e.horizontalOrigin,bi.CENTER),this._scale=y(e.scale,1),this._color=j.clone(y(e.color,j.WHITE)),this._rotation=y(e.rotation,0),this._alignedAxis=h.clone(y(e.alignedAxis,h.ZERO)),this._width=e.width,this._height=e.height,this._scaleByDistance=o,this._translucencyByDistance=n,this._pixelOffsetScaleByDistance=i,this._sizeInMeters=y(e.sizeInMeters,!1),this._distanceDisplayCondition=r,this._disableDepthTestDistance=e.disableDepthTestDistance,this._id=e.id,this._collection=y(e.collection,t),this._pickId=void 0,this._pickPrimitive=y(e._pickPrimitive,this),this._billboardCollection=t,this._dirty=!1,this._index=-1,this._batchIndex=void 0,this._imageIndex=-1,this._imageIndexPromise=void 0,this._imageId=void 0,this._image=void 0,this._imageSubRegion=void 0,this._imageWidth=void 0,this._imageHeight=void 0,this._labelDimensions=void 0,this._labelHorizontalOrigin=void 0,this._labelTranslate=void 0;let s=e.image,a=e.imageId;c(s)&&(c(a)||(typeof s=="string"?a=s:c(s.src)?a=s.src:a=Hn()),this._imageId=a,this._image=s),c(e.imageSubRegion)&&(this._imageId=a,this._imageSubRegion=e.imageSubRegion),c(this._billboardCollection._textureAtlas)&&this._loadImage(),this._actualClampedPosition=void 0,this._removeCallbackFunc=void 0,this._mode=oe.SCENE3D,this._clusterShow=!0,this._outlineColor=j.clone(y(e.outlineColor,j.BLACK)),this._outlineWidth=y(e.outlineWidth,0),this._updateClamping(),this._splitDirection=y(e.splitDirection,$r.NONE)}var lse=hi.SHOW_INDEX=0,x1=hi.POSITION_INDEX=1,hse=hi.PIXEL_OFFSET_INDEX=2,AGe=hi.EYE_OFFSET_INDEX=3,CGe=hi.HORIZONTAL_ORIGIN_INDEX=4,EGe=hi.VERTICAL_ORIGIN_INDEX=5,SGe=hi.SCALE_INDEX=6,T1=hi.IMAGE_INDEX_INDEX=7,use=hi.COLOR_INDEX=8,wGe=hi.ROTATION_INDEX=9,vGe=hi.ALIGNED_AXIS_INDEX=10,DGe=hi.SCALE_BY_DISTANCE_INDEX=11,PGe=hi.TRANSLUCENCY_BY_DISTANCE_INDEX=12,IGe=hi.PIXEL_OFFSET_SCALE_BY_DISTANCE_INDEX=13,OGe=hi.DISTANCE_DISPLAY_CONDITION=14,RGe=hi.DISABLE_DEPTH_DISTANCE=15;hi.TEXTURE_COORDINATE_BOUNDS=16;var fse=hi.SDF_INDEX=17,MGe=hi.SPLIT_DIRECTION_INDEX=18;hi.NUMBER_OF_PROPERTIES=19;function Eo(e,t){let n=e._billboardCollection;c(n)&&(n._updateBillboard(e,t),e._dirty=!0)}Object.defineProperties(hi.prototype,{show:{get:function(){return this._show},set:function(e){A.typeOf.bool("value",e),this._show!==e&&(this._show=e,Eo(this,lse))}},position:{get:function(){return this._position},set:function(e){A.typeOf.object("value",e);let t=this._position;h.equals(t,e)||(h.clone(e,t),h.clone(e,this._actualPosition),this._updateClamping(),Eo(this,x1))}},heightReference:{get:function(){return this._heightReference},set:function(e){A.typeOf.number("value",e);let t=this._heightReference;e!==t&&(this._heightReference=e,this._updateClamping(),Eo(this,x1))}},pixelOffset:{get:function(){return this._pixelOffset},set:function(e){A.typeOf.object("value",e);let t=this._pixelOffset;H.equals(t,e)||(H.clone(e,t),Eo(this,hse))}},scaleByDistance:{get:function(){return this._scaleByDistance},set:function(e){if(c(e)&&(A.typeOf.object("value",e),e.far<=e.near))throw new E("far distance must be greater than near distance.");let t=this._scaleByDistance;Vt.equals(t,e)||(this._scaleByDistance=Vt.clone(e,t),Eo(this,DGe))}},translucencyByDistance:{get:function(){return this._translucencyByDistance},set:function(e){if(c(e)&&(A.typeOf.object("value",e),e.far<=e.near))throw new E("far distance must be greater than near distance.");let t=this._translucencyByDistance;Vt.equals(t,e)||(this._translucencyByDistance=Vt.clone(e,t),Eo(this,PGe))}},pixelOffsetScaleByDistance:{get:function(){return this._pixelOffsetScaleByDistance},set:function(e){if(c(e)&&(A.typeOf.object("value",e),e.far<=e.near))throw new E("far distance must be greater than near distance.");let t=this._pixelOffsetScaleByDistance;Vt.equals(t,e)||(this._pixelOffsetScaleByDistance=Vt.clone(e,t),Eo(this,IGe))}},eyeOffset:{get:function(){return this._eyeOffset},set:function(e){A.typeOf.object("value",e);let t=this._eyeOffset;h.equals(t,e)||(h.clone(e,t),Eo(this,AGe))}},horizontalOrigin:{get:function(){return this._horizontalOrigin},set:function(e){A.typeOf.number("value",e),this._horizontalOrigin!==e&&(this._horizontalOrigin=e,Eo(this,CGe))}},verticalOrigin:{get:function(){return this._verticalOrigin},set:function(e){A.typeOf.number("value",e),this._verticalOrigin!==e&&(this._verticalOrigin=e,Eo(this,EGe))}},scale:{get:function(){return this._scale},set:function(e){A.typeOf.number("value",e),this._scale!==e&&(this._scale=e,Eo(this,SGe))}},color:{get:function(){return this._color},set:function(e){A.typeOf.object("value",e);let t=this._color;j.equals(t,e)||(j.clone(e,t),Eo(this,use))}},rotation:{get:function(){return this._rotation},set:function(e){A.typeOf.number("value",e),this._rotation!==e&&(this._rotation=e,Eo(this,wGe))}},alignedAxis:{get:function(){return this._alignedAxis},set:function(e){A.typeOf.object("value",e);let t=this._alignedAxis;h.equals(t,e)||(h.clone(e,t),Eo(this,vGe))}},width:{get:function(){return y(this._width,this._imageWidth)},set:function(e){c(e)&&A.typeOf.number("value",e),this._width!==e&&(this._width=e,Eo(this,T1))}},height:{get:function(){return y(this._height,this._imageHeight)},set:function(e){c(e)&&A.typeOf.number("value",e),this._height!==e&&(this._height=e,Eo(this,T1))}},sizeInMeters:{get:function(){return this._sizeInMeters},set:function(e){A.typeOf.bool("value",e),this._sizeInMeters!==e&&(this._sizeInMeters=e,Eo(this,use))}},distanceDisplayCondition:{get:function(){return this._distanceDisplayCondition},set:function(e){if(!Bt.equals(e,this._distanceDisplayCondition)){if(c(e)&&(A.typeOf.object("value",e),e.far<=e.near))throw new E("far distance must be greater than near distance.");this._distanceDisplayCondition=Bt.clone(e,this._distanceDisplayCondition),Eo(this,OGe)}}},disableDepthTestDistance:{get:function(){return this._disableDepthTestDistance},set:function(e){if(c(e)&&(A.typeOf.number("value",e),e<0))throw new E("disableDepthTestDistance must be greater than or equal to 0.0.");this._disableDepthTestDistance!==e&&(this._disableDepthTestDistance=e,Eo(this,RGe))}},id:{get:function(){return this._id},set:function(e){this._id=e,c(this._pickId)&&(this._pickId.object.id=e)}},pickPrimitive:{get:function(){return this._pickPrimitive},set:function(e){this._pickPrimitive=e,c(this._pickId)&&(this._pickId.object.primitive=e)}},pickId:{get:function(){return this._pickId}},image:{get:function(){return this._imageId},set:function(e){c(e)?typeof e=="string"?this.setImage(e,e):e instanceof De?this.setImage(e.url,e):c(e.src)?this.setImage(e.src,e):this.setImage(Hn(),e):(this._imageIndex=-1,this._imageSubRegion=void 0,this._imageId=void 0,this._image=void 0,this._imageIndexPromise=void 0,Eo(this,T1))}},ready:{get:function(){return this._imageIndex!==-1}},_clampedPosition:{get:function(){return this._actualClampedPosition},set:function(e){this._actualClampedPosition=h.clone(e,this._actualClampedPosition),Eo(this,x1)}},clusterShow:{get:function(){return this._clusterShow},set:function(e){this._clusterShow!==e&&(this._clusterShow=e,Eo(this,lse))}},outlineColor:{get:function(){return this._outlineColor},set:function(e){if(!c(e))throw new E("value is required.");let t=this._outlineColor;j.equals(t,e)||(j.clone(e,t),Eo(this,fse))}},outlineWidth:{get:function(){return this._outlineWidth},set:function(e){this._outlineWidth!==e&&(this._outlineWidth=e,Eo(this,fse))}},splitDirection:{get:function(){return this._splitDirection},set:function(e){this._splitDirection!==e&&(this._splitDirection=e,Eo(this,MGe))}}});hi.prototype.getPickId=function(e){return c(this._pickId)||(this._pickId=e.createPickId({primitive:this._pickPrimitive,collection:this._collection,id:this._id})),this._pickId};hi.prototype._updateClamping=function(){hi._updateClamping(this._billboardCollection,this)};var A1=new he;hi._updateClamping=function(e,t){let n=e._scene;if(!c(n)){if(t._heightReference!==$e.NONE)throw new E("Height reference is not supported without a scene.");return}let i=y(n.ellipsoid,ie.default),o=n.frameState.mode,r=o!==t._mode;if(t._mode=o,(t._heightReference===$e.NONE||r)&&c(t._removeCallbackFunc)&&(t._removeCallbackFunc(),t._removeCallbackFunc=void 0,t._clampedPosition=void 0),t._heightReference===$e.NONE||!c(t._position))return;c(t._removeCallbackFunc)&&t._removeCallbackFunc();let s=i.cartesianToCartographic(t._position);if(!c(s)){t._actualClampedPosition=void 0;return}function a(u){let f=i.cartographicToCartesian(u,t._clampedPosition);Lx(t._heightReference)&&(t._mode===oe.SCENE3D?(u.height+=s.height,i.cartographicToCartesian(u,f)):f.x+=s.height),t._clampedPosition=f}t._removeCallbackFunc=n.updateHeight(s,a,t._heightReference),he.clone(s,A1);let l=n.getHeight(s,t._heightReference);c(l)&&(A1.height=l),a(A1)};hi.prototype._loadImage=function(){let e=this._billboardCollection._textureAtlas,t=this._imageId,n=this._image,i=this._imageSubRegion,o,r=this;function s(l){if(r._imageId!==t||r._image!==n||!Ke.equals(r._imageSubRegion,i))return;let u=e.textureCoordinates[l];r._imageWidth=e.texture.width*u.width,r._imageHeight=e.texture.height*u.height,r._imageIndex=l,r._ready=!0,r._image=void 0,r._imageIndexPromise=void 0,Eo(r,T1);let f=r._billboardCollection._scene;c(f)&&f.frameState.afterRender.push(()=>!0)}if(c(n)&&(o=e.addImage(t,n)),c(i)&&(o=e.addSubRegion(t,i)),this._imageIndexPromise=o,!c(o))return;let a=e.getImageIndex(t);if(c(a)&&!c(i)){s(a);return}o.then(s).catch(function(l){console.error(`Error loading image for billboard: ${l}`),r._imageIndexPromise=void 0})};hi.prototype.setImage=function(e,t){if(!c(e))throw new E("id is required.");if(!c(t))throw new E("image is required.");this._imageId!==e&&(this._imageIndex=-1,this._imageSubRegion=void 0,this._imageId=e,this._image=t,c(this._billboardCollection._textureAtlas)&&this._loadImage())};hi.prototype.setImageSubRegion=function(e,t){if(!c(e))throw new E("id is required.");if(!c(t))throw new E("subRegion is required.");this._imageId===e&&Ke.equals(this._imageSubRegion,t)||(this._imageIndex=-1,this._imageId=e,this._imageSubRegion=Ke.clone(t),c(this._billboardCollection._textureAtlas)&&this._loadImage())};hi.prototype._setTranslate=function(e){if(!c(e))throw new E("value is required.");let t=this._translate;H.equals(t,e)||(H.clone(e,t),Eo(this,hse))};hi.prototype._getActualPosition=function(){return c(this._clampedPosition)?this._clampedPosition:this._actualPosition};hi.prototype._setActualPosition=function(e){c(this._clampedPosition)||h.clone(e,this._actualPosition),Eo(this,x1)};var dse=new se;hi._computeActualPosition=function(e,t,n,i){return c(e._clampedPosition)?(n.mode!==e._mode&&e._updateClamping(),e._clampedPosition):n.mode===oe.SCENE3D?t:(k.multiplyByPoint(i,t,dse),Ni.computeActualEllipsoidPosition(n,dse))};var mse=new h;hi._computeScreenSpacePosition=function(e,t,n,i,o,r){let s=k.multiplyByPoint(e,t,mse),a=Ni.worldWithEyeOffsetToWindowCoordinates(o,s,n,r);if(c(a))return H.add(a,i,a),a};var b1=new H(0,0);hi.prototype.computeScreenSpacePosition=function(e,t){let n=this._billboardCollection;if(c(t)||(t=new H),!c(n))throw new E("Billboard must be in a collection.  Was it removed?");if(!c(e))throw new E("scene is required.");H.clone(this._pixelOffset,b1),H.add(b1,this._translate,b1);let i=n.modelMatrix,o=this._position;if(c(this._clampedPosition)&&(o=this._clampedPosition,e.mode!==oe.SCENE3D)){let s=e.mapProjection,a=s.ellipsoid,l=s.unproject(o,A1);o=a.cartographicToCartesian(l,mse),i=k.IDENTITY}return hi._computeScreenSpacePosition(i,o,this._eyeOffset,b1,e,t)};hi.getScreenSpaceBoundingBox=function(e,t,n){let i=e.width,o=e.height,r=e.scale;i*=r,o*=r;let s=t.x;e.horizontalOrigin===bi.RIGHT?s-=i:e.horizontalOrigin===bi.CENTER&&(s-=i*.5);let a=t.y;return e.verticalOrigin===Ln.BOTTOM||e.verticalOrigin===Ln.BASELINE?a-=o:e.verticalOrigin===Ln.CENTER&&(a-=o*.5),c(n)||(n=new Ke),n.x=s,n.y=a,n.width=i,n.height=o,n};hi.prototype.equals=function(e){return this===e||c(e)&&this._id===e._id&&h.equals(this._position,e._position)&&this._imageId===e._imageId&&this._show===e._show&&this._scale===e._scale&&this._verticalOrigin===e._verticalOrigin&&this._horizontalOrigin===e._horizontalOrigin&&this._heightReference===e._heightReference&&Ke.equals(this._imageSubRegion,e._imageSubRegion)&&j.equals(this._color,e._color)&&H.equals(this._pixelOffset,e._pixelOffset)&&H.equals(this._translate,e._translate)&&h.equals(this._eyeOffset,e._eyeOffset)&&Vt.equals(this._scaleByDistance,e._scaleByDistance)&&Vt.equals(this._translucencyByDistance,e._translucencyByDistance)&&Vt.equals(this._pixelOffsetScaleByDistance,e._pixelOffsetScaleByDistance)&&Bt.equals(this._distanceDisplayCondition,e._distanceDisplayCondition)&&this._disableDepthTestDistance===e._disableDepthTestDistance&&this._splitDirection===e._splitDirection};hi.prototype._destroy=function(){c(this._customData)&&(this._billboardCollection._scene.globe._surface.removeTileCustomData(this._customData),this._customData=void 0),c(this._removeCallbackFunc)&&(this._removeCallbackFunc(),this._removeCallbackFunc=void 0),this.image=void 0,this._pickId=this._pickId&&this._pickId.destroy(),this._billboardCollection=void 0};var fo=hi;var LGe={OPAQUE:0,TRANSLUCENT:1,OPAQUE_AND_TRANSLUCENT:2},Oo=Object.freeze(LGe);var NGe={FONT_SIZE:48,PADDING:10,RADIUS:8,CUTOFF:.25},ha=Object.freeze(NGe);function pp(e,t,n,i,o){this.bottomLeft=y(e,H.ZERO),this.topRight=y(t,H.ZERO),this.childNode1=n,this.childNode2=i,this.imageIndex=o}var FGe=new H(16,16);function sg(e){e=y(e,y.EMPTY_OBJECT);let t=y(e.borderWidthInPixels,1),n=y(e.initialSize,FGe);if(!c(e.context))throw new E("context is required.");if(t<0)throw new E("borderWidthInPixels must be greater than or equal to zero.");if(n.x<1||n.y<1)throw new E("initialSize must be greater than zero.");this._context=e.context,this._pixelFormat=y(e.pixelFormat,Ve.RGBA),this._borderWidthInPixels=t,this._textureCoordinates=[],this._guid=Hn(),this._idHash={},this._indexHash={},this._initialSize=n,this._root=void 0}Object.defineProperties(sg.prototype,{borderWidthInPixels:{get:function(){return this._borderWidthInPixels}},textureCoordinates:{get:function(){return this._textureCoordinates}},texture:{get:function(){return c(this._texture)||(this._texture=new Lt({context:this._context,width:this._initialSize.x,height:this._initialSize.y,pixelFormat:this._pixelFormat})),this._texture}},numberOfImages:{get:function(){return this._textureCoordinates.length}},guid:{get:function(){return this._guid}}});function BGe(e,t){let n=e._context,i=e.numberOfImages,o=2,r=e._borderWidthInPixels;if(i>0){let s=e._texture.width,a=e._texture.height,l=o*(s+t.width+r),u=o*(a+t.height+r),f=s/l,d=a/u,p=new pp(new H(s+r,r),new H(l,a)),g=new pp(new H,new H(l,a),e._root,p),m=new pp(new H(r,a+r),new H(l,u)),b=new pp(new H,new H(l,u),g,m);for(let C=0;C<e._textureCoordinates.length;C++){let S=e._textureCoordinates[C];c(S)&&(S.x*=f,S.y*=d,S.width*=f,S.height*=d)}let x=new Lt({context:e._context,width:l,height:u,pixelFormat:e._pixelFormat}),T=new Jr({context:n,colorTextures:[e._texture],destroyAttachments:!1});T._bind(),x.copyFromFramebuffer(0,0,0,0,l,u),T._unBind(),T.destroy(),e._texture=e._texture&&e._texture.destroy(),e._texture=x,e._root=b}else{let s=o*(t.width+2*r),a=o*(t.height+2*r);s<e._initialSize.x&&(s=e._initialSize.x),a<e._initialSize.y&&(a=e._initialSize.y),e._texture=e._texture&&e._texture.destroy(),e._texture=new Lt({context:e._context,width:s,height:a,pixelFormat:e._pixelFormat}),e._root=new pp(new H(r,r),new H(s,a))}}function C1(e,t,n){if(c(t)){if(!c(t.childNode1)&&!c(t.childNode2)){if(c(t.imageIndex))return;let i=t.topRight.x-t.bottomLeft.x,o=t.topRight.y-t.bottomLeft.y,r=i-n.width,s=o-n.height;if(r<0||s<0)return;if(r===0&&s===0)return t;if(r>s){t.childNode1=new pp(new H(t.bottomLeft.x,t.bottomLeft.y),new H(t.bottomLeft.x+n.width,t.topRight.y));let a=t.bottomLeft.x+n.width+e._borderWidthInPixels;a<t.topRight.x&&(t.childNode2=new pp(new H(a,t.bottomLeft.y),new H(t.topRight.x,t.topRight.y)))}else{t.childNode1=new pp(new H(t.bottomLeft.x,t.bottomLeft.y),new H(t.topRight.x,t.bottomLeft.y+n.height));let a=t.bottomLeft.y+n.height+e._borderWidthInPixels;a<t.topRight.y&&(t.childNode2=new pp(new H(t.bottomLeft.x,a),new H(t.topRight.x,t.topRight.y)))}return C1(e,t.childNode1,n)}return C1(e,t.childNode1,n)||C1(e,t.childNode2,n)}}function pse(e,t,n){let i=C1(e,e._root,t);if(c(i)){i.imageIndex=n;let o=e._texture.width,r=e._texture.height,s=i.topRight.x-i.bottomLeft.x,a=i.topRight.y-i.bottomLeft.y,l=i.bottomLeft.x/o,u=i.bottomLeft.y/r,f=s/o,d=a/r;e._textureCoordinates[n]=new Ke(l,u,f,d),e._texture.copyFrom({source:t,xOffset:i.bottomLeft.x,yOffset:i.bottomLeft.y})}else BGe(e,t),pse(e,t,n);e._guid=Hn()}function _se(e,t){if(!c(e)||e.isDestroyed())return-1;let n=e.numberOfImages;return pse(e,t,n),n}sg.prototype.getImageIndex=function(e){if(!c(e))throw new E("id is required.");return this._indexHash[e]};sg.prototype.addImageSync=function(e,t){if(!c(e))throw new E("id is required.");if(!c(t))throw new E("image is required.");let n=this._indexHash[e];return c(n)||(n=_se(this,t),this._idHash[e]=Promise.resolve(n),this._indexHash[e]=n),n};sg.prototype.addImage=function(e,t){if(!c(e))throw new E("id is required.");if(!c(t))throw new E("image is required.");let n=this._idHash[e];if(c(n))return n;if(typeof t=="function"){if(t=t(e),!c(t))throw new E("image is required.")}else(typeof t=="string"||t instanceof De)&&(t=De.createIfNeeded(t).fetchImage());let i=this;return n=Promise.resolve(t).then(function(o){let r=_se(i,o);return i._indexHash[e]=r,r}),this._idHash[e]=n,n};sg.prototype.addSubRegion=function(e,t){if(!c(e))throw new E("id is required.");if(!c(t))throw new E("subRegion is required.");let n=this._idHash[e];if(!c(n))throw new ue(`image with id "${e}" not found in the atlas.`);let i=this;return Promise.resolve(n).then(function(o){if(o===-1)return-1;let r=i._texture.width,s=i._texture.height,a=i._textureCoordinates[o],l=a.x+t.x/r,u=a.y+t.y/s,f=t.width/r,d=t.height/s,p=i._textureCoordinates.push(new Ke(l,u,f,d))-1;return i._indexHash[e]=p,i._guid=Hn(),p})};sg.prototype.isDestroyed=function(){return!1};sg.prototype.destroy=function(){return this._texture=this._texture&&this._texture.destroy(),de(this)};var kT=sg;var kGe=fo.SHOW_INDEX,Cw=fo.POSITION_INDEX,gse=fo.PIXEL_OFFSET_INDEX,yse=fo.EYE_OFFSET_INDEX,VGe=fo.HORIZONTAL_ORIGIN_INDEX,UGe=fo.VERTICAL_ORIGIN_INDEX,zGe=fo.SCALE_INDEX,Aw=fo.IMAGE_INDEX_INDEX,bse=fo.COLOR_INDEX,HGe=fo.ROTATION_INDEX,GGe=fo.ALIGNED_AXIS_INDEX,xse=fo.SCALE_BY_DISTANCE_INDEX,Tse=fo.TRANSLUCENCY_BY_DISTANCE_INDEX,Ase=fo.PIXEL_OFFSET_SCALE_BY_DISTANCE_INDEX,Cse=fo.DISTANCE_DISPLAY_CONDITION,jGe=fo.DISABLE_DEPTH_DISTANCE,WGe=fo.TEXTURE_COORDINATE_BOUNDS,Ese=fo.SDF_INDEX,Sse=fo.SPLIT_DIRECTION_INDEX,YH=fo.NUMBER_OF_PROPERTIES,to,qGe={positionHighAndScale:0,positionLowAndRotation:1,compressedAttribute0:2,compressedAttribute1:3,compressedAttribute2:4,eyeOffset:5,scaleByDistance:6,pixelOffsetScaleByDistance:7,compressedAttribute3:8,textureCoordinateBoundsOrLabelTranslate:9,a_batchId:10,sdf:11,splitDirection:12},YGe={direction:0,positionHighAndScale:1,positionLowAndRotation:2,compressedAttribute0:3,compressedAttribute1:4,compressedAttribute2:5,eyeOffset:6,scaleByDistance:7,pixelOffsetScaleByDistance:8,compressedAttribute3:9,textureCoordinateBoundsOrLabelTranslate:10,a_batchId:11,sdf:12,splitDirection:13};function nf(e){e=y(e,y.EMPTY_OBJECT),this._scene=e.scene,this._batchTable=e.batchTable,this._textureAtlas=void 0,this._textureAtlasGUID=void 0,this._destroyTextureAtlas=!0,this._sp=void 0,this._spTranslucent=void 0,this._rsOpaque=void 0,this._rsTranslucent=void 0,this._vaf=void 0,this._billboards=[],this._billboardsToUpdate=[],this._billboardsToUpdateIndex=0,this._billboardsRemoved=!1,this._createVertexArray=!1,this._shaderRotation=!1,this._compiledShaderRotation=!1,this._shaderAlignedAxis=!1,this._compiledShaderAlignedAxis=!1,this._shaderScaleByDistance=!1,this._compiledShaderScaleByDistance=!1,this._shaderTranslucencyByDistance=!1,this._compiledShaderTranslucencyByDistance=!1,this._shaderPixelOffsetScaleByDistance=!1,this._compiledShaderPixelOffsetScaleByDistance=!1,this._shaderDistanceDisplayCondition=!1,this._compiledShaderDistanceDisplayCondition=!1,this._shaderDisableDepthDistance=!1,this._compiledShaderDisableDepthDistance=!1,this._shaderClampToGround=!1,this._compiledShaderClampToGround=!1,this._propertiesChanged=new Uint32Array(YH),this._maxSize=0,this._maxEyeOffset=0,this._maxScale=1,this._maxPixelOffset=0,this._allHorizontalCenter=!0,this._allVerticalCenter=!0,this._allSizedInMeters=!0,this._baseVolume=new ce,this._baseVolumeWC=new ce,this._baseVolume2D=new ce,this._boundingVolume=new ce,this._boundingVolumeDirty=!1,this._colorCommands=[],this.show=y(e.show,!0),this.modelMatrix=k.clone(y(e.modelMatrix,k.IDENTITY)),this._modelMatrix=k.clone(k.IDENTITY),this.debugShowBoundingVolume=y(e.debugShowBoundingVolume,!1),this.debugShowTextureAtlas=y(e.debugShowTextureAtlas,!1),this.blendOption=y(e.blendOption,Oo.OPAQUE_AND_TRANSLUCENT),this._blendOption=void 0,this._mode=oe.SCENE3D,this._buffersUsage=[ke.STATIC_DRAW,ke.STATIC_DRAW,ke.STATIC_DRAW,ke.STATIC_DRAW,ke.STATIC_DRAW,ke.STATIC_DRAW,ke.STATIC_DRAW,ke.STATIC_DRAW,ke.STATIC_DRAW,ke.STATIC_DRAW,ke.STATIC_DRAW,ke.STATIC_DRAW,ke.STATIC_DRAW,ke.STATIC_DRAW,ke.STATIC_DRAW,ke.STATIC_DRAW,ke.STATIC_DRAW],this._highlightColor=j.clone(j.WHITE);let t=this;this._uniforms={u_atlas:function(){return t._textureAtlas.texture},u_highlightColor:function(){return t._highlightColor}};let n=this._scene;c(n)&&c(n.terrainProviderChanged)&&(this._removeCallbackFunc=n.terrainProviderChanged.addEventListener(function(){let i=this._billboards,o=i.length;for(let r=0;r<o;++r)c(i[r])&&i[r]._updateClamping()},this))}Object.defineProperties(nf.prototype,{length:{get:function(){return XH(this),this._billboards.length}},textureAtlas:{get:function(){return this._textureAtlas},set:function(e){this._textureAtlas!==e&&(this._textureAtlas=this._destroyTextureAtlas&&this._textureAtlas&&this._textureAtlas.destroy(),this._textureAtlas=e,this._createVertexArray=!0)}},destroyTextureAtlas:{get:function(){return this._destroyTextureAtlas},set:function(e){this._destroyTextureAtlas=e}}});function wse(e){let t=e.length;for(let n=0;n<t;++n)e[n]&&e[n]._destroy()}nf.prototype.add=function(e){let t=new fo(e,this);return t._index=this._billboards.length,this._billboards.push(t),this._createVertexArray=!0,t};nf.prototype.remove=function(e){return this.contains(e)?(this._billboards[e._index]=void 0,this._billboardsRemoved=!0,this._createVertexArray=!0,e._destroy(),!0):!1};nf.prototype.removeAll=function(){wse(this._billboards),this._billboards=[],this._billboardsToUpdate=[],this._billboardsToUpdateIndex=0,this._billboardsRemoved=!1,this._createVertexArray=!0};function XH(e){if(e._billboardsRemoved){e._billboardsRemoved=!1;let t=[],n=e._billboards,i=n.length;for(let o=0,r=0;o<i;++o){let s=n[o];c(s)&&(s._index=r++,t.push(s))}e._billboards=t}}nf.prototype._updateBillboard=function(e,t){e._dirty||(this._billboardsToUpdate[this._billboardsToUpdateIndex++]=e),++this._propertiesChanged[t]};nf.prototype.contains=function(e){return c(e)&&e._billboardCollection===this};nf.prototype.get=function(e){return A.typeOf.number("index",e),XH(this),this._billboards[e]};var zH;function XGe(e){let n=e.cache.billboardCollection_indexBufferBatched;if(c(n))return n;let i=16384*6-6,o=new Uint16Array(i);for(let r=0,s=0;r<i;r+=6,s+=4)o[r]=s,o[r+1]=s+1,o[r+2]=s+2,o[r+3]=s+0,o[r+4]=s+2,o[r+5]=s+3;return n=xt.createIndexBuffer({context:e,typedArray:o,usage:ke.STATIC_DRAW,indexDatatype:Fe.UNSIGNED_SHORT}),n.vertexArrayDestroyable=!1,e.cache.billboardCollection_indexBufferBatched=n,n}function KGe(e){let t=e.cache.billboardCollection_indexBufferInstanced;return c(t)||(t=xt.createIndexBuffer({context:e,typedArray:new Uint16Array([0,1,2,0,2,3]),usage:ke.STATIC_DRAW,indexDatatype:Fe.UNSIGNED_SHORT}),t.vertexArrayDestroyable=!1,e.cache.billboardCollection_indexBufferInstanced=t),t}function $Ge(e){let t=e.cache.billboardCollection_vertexBufferInstanced;return c(t)||(t=xt.createVertexBuffer({context:e,typedArray:new Float32Array([0,0,1,0,1,1,0,1]),usage:ke.STATIC_DRAW}),t.vertexArrayDestroyable=!1,e.cache.billboardCollection_vertexBufferInstanced=t),t}nf.prototype.computeNewBuffersUsage=function(){let e=this._buffersUsage,t=!1,n=this._propertiesChanged;for(let i=0;i<YH;++i){let o=n[i]===0?ke.STATIC_DRAW:ke.STREAM_DRAW;t=t||e[i]!==o,e[i]=o}return t};function ZGe(e,t,n,i,o,r){let s=[{index:to.positionHighAndScale,componentsPerAttribute:4,componentDatatype:$.FLOAT,usage:n[Cw]},{index:to.positionLowAndRotation,componentsPerAttribute:4,componentDatatype:$.FLOAT,usage:n[Cw]},{index:to.compressedAttribute0,componentsPerAttribute:4,componentDatatype:$.FLOAT,usage:n[gse]},{index:to.compressedAttribute1,componentsPerAttribute:4,componentDatatype:$.FLOAT,usage:n[Tse]},{index:to.compressedAttribute2,componentsPerAttribute:4,componentDatatype:$.FLOAT,usage:n[bse]},{index:to.eyeOffset,componentsPerAttribute:4,componentDatatype:$.FLOAT,usage:n[yse]},{index:to.scaleByDistance,componentsPerAttribute:4,componentDatatype:$.FLOAT,usage:n[xse]},{index:to.pixelOffsetScaleByDistance,componentsPerAttribute:4,componentDatatype:$.FLOAT,usage:n[Ase]},{index:to.compressedAttribute3,componentsPerAttribute:4,componentDatatype:$.FLOAT,usage:n[Cse]},{index:to.textureCoordinateBoundsOrLabelTranslate,componentsPerAttribute:4,componentDatatype:$.FLOAT,usage:n[WGe]},{index:to.splitDirection,componentsPerAttribute:1,componentDatatype:$.FLOAT,usage:n[Sse]}];i&&s.push({index:to.direction,componentsPerAttribute:2,componentDatatype:$.FLOAT,vertexBuffer:$Ge(e)}),c(o)&&s.push({index:to.a_batchId,componentsPerAttribute:1,componentDatatype:$.FLOAT,bufferUsage:ke.STATIC_DRAW}),r&&s.push({index:to.sdf,componentsPerAttribute:2,componentDatatype:$.FLOAT,usage:n[Ese]});let a=i?t:4*t;return new L0(e,s,a,i)}var HH=new Gn;function vse(e,t,n,i,o){let r,s=i[to.positionHighAndScale],a=i[to.positionLowAndRotation],l=o._getActualPosition();e._mode===oe.SCENE3D&&(ce.expand(e._baseVolume,l,e._baseVolume),e._boundingVolumeDirty=!0),Gn.fromCartesian(l,HH);let u=o.scale,f=o.rotation;f!==0&&(e._shaderRotation=!0),e._maxScale=Math.max(e._maxScale,u);let d=HH.high,p=HH.low;e._instanced?(r=o._index,s(r,d.x,d.y,d.z,u),a(r,p.x,p.y,p.z,f)):(r=o._index*4,s(r+0,d.x,d.y,d.z,u),s(r+1,d.x,d.y,d.z,u),s(r+2,d.x,d.y,d.z,u),s(r+3,d.x,d.y,d.z,u),a(r+0,p.x,p.y,p.z,f),a(r+1,p.x,p.y,p.z,f),a(r+2,p.x,p.y,p.z,f),a(r+3,p.x,p.y,p.z,f))}var tf=new H,ef=32768,VT=65536,GH=4096,xh=256,JGe=128,QGe=32,e5e=8,Dse=4,t5e=1/256,Pse=0,Ise=2,Ose=3,Rse=1;function Mse(e,t,n,i,o){let r,s=i[to.compressedAttribute0],a=o.pixelOffset,l=a.x,u=a.y,f=o._translate,d=f.x,p=f.y;e._maxPixelOffset=Math.max(e._maxPixelOffset,Math.abs(l+d),Math.abs(-u+p));let g=o.horizontalOrigin,m=o._verticalOrigin,b=o.show&&o.clusterShow;o.color.alpha===0&&(b=!1),m===Ln.BASELINE&&(m=Ln.BOTTOM),e._allHorizontalCenter=e._allHorizontalCenter&&g===bi.CENTER,e._allVerticalCenter=e._allVerticalCenter&&m===Ln.CENTER;let x=0,T=0,C=0,S=0,v=o._imageIndex;if(v!==-1){let G=n[v];if(!c(G))throw new E(`Invalid billboard image index: ${v}`);x=G.x,T=G.y,C=G.width,S=G.height}let D=x+C,I=T+S,L=Math.floor(R.clamp(l,-ef,ef)+ef)*JGe;L+=(g+1)*QGe,L+=(m+1)*e5e,L+=(b?1:0)*Dse;let M=Math.floor(R.clamp(u,-ef,ef)+ef)*xh,N=Math.floor(R.clamp(d,-ef,ef)+ef)*xh,B=(R.clamp(p,-ef,ef)+ef)*t5e,_=Math.floor(B),w=Math.floor((B-_)*xh);M+=_,N+=w,tf.x=x,tf.y=T;let P=Nn.compressTextureCoordinates(tf);tf.x=D;let O=Nn.compressTextureCoordinates(tf);tf.y=I;let F=Nn.compressTextureCoordinates(tf);tf.x=x;let V=Nn.compressTextureCoordinates(tf);e._instanced?(r=o._index,s(r,L,M,N,P)):(r=o._index*4,s(r+0,L+Pse,M,N,P),s(r+1,L+Ise,M,N,O),s(r+2,L+Ose,M,N,F),s(r+3,L+Rse,M,N,V))}function Lse(e,t,n,i,o){let r,s=i[to.compressedAttribute1],a=o.alignedAxis;h.equals(a,h.ZERO)||(e._shaderAlignedAxis=!0);let l=0,u=1,f=1,d=1,p=o.translucencyByDistance;c(p)&&(l=p.near,u=p.nearValue,f=p.far,d=p.farValue,(u!==1||d!==1)&&(e._shaderTranslucencyByDistance=!0));let g=0,m=o._imageIndex;if(m!==-1){let S=n[m];if(!c(S))throw new E(`Invalid billboard image index: ${m}`);g=S.width}let b=e._textureAtlas.texture.width,x=Math.round(y(o.width,b*g));e._maxSize=Math.max(e._maxSize,x);let T=R.clamp(x,0,VT),C=0;Math.abs(h.magnitudeSquared(a)-1)<R.EPSILON6&&(C=Nn.octEncodeFloat(a)),u=R.clamp(u,0,1),u=u===1?255:u*255|0,T=T*xh+u,d=R.clamp(d,0,1),d=d===1?255:d*255|0,C=C*xh+d,e._instanced?(r=o._index,s(r,T,C,l,f)):(r=o._index*4,s(r+0,T,C,l,f),s(r+1,T,C,l,f),s(r+2,T,C,l,f),s(r+3,T,C,l,f))}function WH(e,t,n,i,o){let r,s=i[to.compressedAttribute2],a=o.color,l=c(e._batchTable)?j.WHITE:o.getPickId(t.context).color,u=o.sizeInMeters?1:0,f=Math.abs(h.magnitudeSquared(o.alignedAxis)-1)<R.EPSILON6?1:0;e._allSizedInMeters=e._allSizedInMeters&&u===1;let d=0,p=o._imageIndex;if(p!==-1){let L=n[p];if(!c(L))throw new E(`Invalid billboard image index: ${p}`);d=L.height}let g=e._textureAtlas.texture.dimensions,m=Math.round(y(o.height,g.y*d));e._maxSize=Math.max(e._maxSize,m);let b=y(o._labelHorizontalOrigin,-2);b+=2;let x=m*Dse+b,T=j.floatToByte(a.red),C=j.floatToByte(a.green),S=j.floatToByte(a.blue),v=T*VT+C*xh+S;T=j.floatToByte(l.red),C=j.floatToByte(l.green),S=j.floatToByte(l.blue);let D=T*VT+C*xh+S,I=j.floatToByte(a.alpha)*VT+j.floatToByte(l.alpha)*xh;I+=u*2+f,e._instanced?(r=o._index,s(r,v,D,I,x)):(r=o._index*4,s(r+0,v,D,I,x),s(r+1,v,D,I,x),s(r+2,v,D,I,x),s(r+3,v,D,I,x))}function qH(e,t,n,i,o){let r,s=i[to.eyeOffset],a=o.eyeOffset,l=a.z;if(o._heightReference!==$e.NONE&&(l*=1.005),e._maxEyeOffset=Math.max(e._maxEyeOffset,Math.abs(a.x),Math.abs(a.y),Math.abs(l)),e._instanced){let u=0,f=0,d=o._imageIndex;if(d!==-1){let g=n[d];if(!c(g))throw new E(`Invalid billboard image index: ${d}`);u=g.width,f=g.height}tf.x=u,tf.y=f;let p=Nn.compressTextureCoordinates(tf);r=o._index,s(r,a.x,a.y,l,p)}else r=o._index*4,s(r+0,a.x,a.y,l,0),s(r+1,a.x,a.y,l,0),s(r+2,a.x,a.y,l,0),s(r+3,a.x,a.y,l,0)}function Nse(e,t,n,i,o){let r,s=i[to.scaleByDistance],a=0,l=1,u=1,f=1,d=o.scaleByDistance;c(d)&&(a=d.near,l=d.nearValue,u=d.far,f=d.farValue,(l!==1||f!==1)&&(e._shaderScaleByDistance=!0)),e._instanced?(r=o._index,s(r,a,l,u,f)):(r=o._index*4,s(r+0,a,l,u,f),s(r+1,a,l,u,f),s(r+2,a,l,u,f),s(r+3,a,l,u,f))}function Fse(e,t,n,i,o){let r,s=i[to.pixelOffsetScaleByDistance],a=0,l=1,u=1,f=1,d=o.pixelOffsetScaleByDistance;c(d)&&(a=d.near,l=d.nearValue,u=d.far,f=d.farValue,(l!==1||f!==1)&&(e._shaderPixelOffsetScaleByDistance=!0)),e._instanced?(r=o._index,s(r,a,l,u,f)):(r=o._index*4,s(r+0,a,l,u,f),s(r+1,a,l,u,f),s(r+2,a,l,u,f),s(r+3,a,l,u,f))}function Bse(e,t,n,i,o){let r,s=i[to.compressedAttribute3],a=0,l=Number.MAX_VALUE,u=o.distanceDisplayCondition;c(u)&&(a=u.near,l=u.far,a*=a,l*=l,e._shaderDistanceDisplayCondition=!0);let f=o.disableDepthTestDistance,d=Ru(o.heightReference)&&t.context.depthTexture;c(f)||(f=d?5e3:0),f*=f,(d||f>0)&&(e._shaderDisableDepthDistance=!0,f===Number.POSITIVE_INFINITY&&(f=-1));let p,g;if(c(o._labelDimensions))g=o._labelDimensions.x,p=o._labelDimensions.y;else{let T=0,C=0,S=o._imageIndex;if(S!==-1){let D=n[S];if(!c(D))throw new E(`Invalid billboard image index: ${S}`);T=D.height,C=D.width}p=Math.round(y(o.height,e._textureAtlas.texture.dimensions.y*T));let v=e._textureAtlas.texture.width;g=Math.round(y(o.width,v*C))}let m=Math.floor(R.clamp(g,0,GH)),b=Math.floor(R.clamp(p,0,GH)),x=m*GH+b;e._instanced?(r=o._index,s(r,a,l,f,x)):(r=o._index*4,s(r+0,a,l,f,x),s(r+1,a,l,f,x),s(r+2,a,l,f,x),s(r+3,a,l,f,x))}function kse(e,t,n,i,o){if(Ru(o.heightReference)){let m=e._scene,b=t.context,x=t.globeTranslucencyState.translucent,T=c(m.globe)&&m.globe.depthTestAgainstTerrain;e._shaderClampToGround=b.depthTexture&&!x&&T}let r,s=i[to.textureCoordinateBoundsOrLabelTranslate];if(mt.maximumVertexTextureImageUnits>0){let m=0,b=0;c(o._labelTranslate)&&(m=o._labelTranslate.x,b=o._labelTranslate.y),e._instanced?(r=o._index,s(r,m,b,0,0)):(r=o._index*4,s(r+0,m,b,0,0),s(r+1,m,b,0,0),s(r+2,m,b,0,0),s(r+3,m,b,0,0));return}let a=0,l=0,u=0,f=0,d=o._imageIndex;if(d!==-1){let m=n[d];if(!c(m))throw new E(`Invalid billboard image index: ${d}`);a=m.x,l=m.y,u=m.width,f=m.height}let p=a+u,g=l+f;e._instanced?(r=o._index,s(r,a,l,p,g)):(r=o._index*4,s(r+0,a,l,p,g),s(r+1,a,l,p,g),s(r+2,a,l,p,g),s(r+3,a,l,p,g))}function n5e(e,t,n,i,o){if(!c(e._batchTable))return;let r=i[to.a_batchId],s=o._batchIndex,a;e._instanced?(a=o._index,r(a,s)):(a=o._index*4,r(a+0,s),r(a+1,s),r(a+2,s),r(a+3,s))}function Vse(e,t,n,i,o){if(!e._sdf)return;let r,s=i[to.sdf],a=o.outlineColor,l=o.outlineWidth,u=j.floatToByte(a.red),f=j.floatToByte(a.green),d=j.floatToByte(a.blue),p=u*VT+f*xh+d,g=l/ha.RADIUS,m=j.floatToByte(a.alpha)*VT+j.floatToByte(g)*xh;e._instanced?(r=o._index,s(r,p,m)):(r=o._index*4,s(r+0,p+Pse,m),s(r+1,p+Ise,m),s(r+2,p+Ose,m),s(r+3,p+Rse,m))}function Use(e,t,n,i,o){let r=i[to.splitDirection],s=0,a=o.splitDirection;c(a)&&(s=a);let l;e._instanced?(l=o._index,r(l,s)):(l=o._index*4,r(l+0,s),r(l+1,s),r(l+2,s),r(l+3,s))}function i5e(e,t,n,i,o){vse(e,t,n,i,o),Mse(e,t,n,i,o),Lse(e,t,n,i,o),WH(e,t,n,i,o),qH(e,t,n,i,o),Nse(e,t,n,i,o),Fse(e,t,n,i,o),Bse(e,t,n,i,o),kse(e,t,n,i,o),n5e(e,t,n,i,o),Vse(e,t,n,i,o),Use(e,t,n,i,o)}function jH(e,t,n,i,o,r){let s;i.mode===oe.SCENE3D?(s=e._baseVolume,e._boundingVolumeDirty=!0):s=e._baseVolume2D;let a=[];for(let l=0;l<n;++l){let u=t[l],f=u.position,d=fo._computeActualPosition(u,f,i,o);c(d)&&(u._setActualPosition(d),r?a.push(d):ce.expand(s,d,s))}r&&ce.fromPoints(a,s)}function o5e(e,t){let n=t.mode,i=e._billboards,o=e._billboardsToUpdate,r=e._modelMatrix;e._createVertexArray||e._mode!==n||n!==oe.SCENE3D&&!k.equals(r,e.modelMatrix)?(e._mode=n,k.clone(e.modelMatrix,r),e._createVertexArray=!0,(n===oe.SCENE3D||n===oe.SCENE2D||n===oe.COLUMBUS_VIEW)&&jH(e,i,i.length,t,r,!0)):n===oe.MORPHING?jH(e,i,i.length,t,r,!0):(n===oe.SCENE2D||n===oe.COLUMBUS_VIEW)&&jH(e,o,e._billboardsToUpdateIndex,t,r,!1)}function r5e(e,t,n){let i=1;(!e._allSizedInMeters||e._maxPixelOffset!==0)&&(i=t.camera.getPixelSize(n,t.context.drawingBufferWidth,t.context.drawingBufferHeight));let o=i*e._maxScale*e._maxSize*2;e._allHorizontalCenter&&e._allVerticalCenter&&(o*=.5);let r=i*e._maxPixelOffset+e._maxEyeOffset;n.radius+=o+r}function s5e(e,t){let i=t.createViewportQuadCommand(`uniform sampler2D billboard_texture; 
in vec2 v_textureCoordinates; 
void main() 
{ 
    out_FragColor = texture(billboard_texture, v_textureCoordinates); 
} 
`,{uniformMap:{billboard_texture:function(){return e._textureAtlas.texture}}});return i.pass=ve.OVERLAY,i}var a5e=[];nf.prototype.update=function(e){if(XH(this),!this.show)return;let t=this._billboards,n=t.length,i=e.context;this._instanced=i.instancedArrays,to=this._instanced?YGe:qGe,zH=this._instanced?KGe:XGe;let o=this._textureAtlas;if(!c(o)){o=this._textureAtlas=new kT({context:i});for(let M=0;M<n;++M)t[M]._loadImage()}let r=o.textureCoordinates;if(r.length===0)return;o5e(this,e),t=this._billboards,n=t.length;let s=this._billboardsToUpdate,a=this._billboardsToUpdateIndex,l=this._propertiesChanged,u=o.guid,f=this._createVertexArray||this._textureAtlasGUID!==u;this._textureAtlasGUID=u;let d,p=e.passes,g=p.pick;if(f||!g&&this.computeNewBuffersUsage()){this._createVertexArray=!1;for(let M=0;M<YH;++M)l[M]=0;if(this._vaf=this._vaf&&this._vaf.destroy(),n>0){this._vaf=ZGe(i,n,this._buffersUsage,this._instanced,this._batchTable,this._sdf),d=this._vaf.writers;for(let M=0;M<n;++M){let N=this._billboards[M];N._dirty=!1,i5e(this,e,r,d,N)}this._vaf.commit(zH(i))}this._billboardsToUpdateIndex=0}else if(a>0){let M=a5e;M.length=0,(l[Cw]||l[HGe]||l[zGe])&&M.push(vse),(l[Aw]||l[gse]||l[VGe]||l[UGe]||l[kGe])&&(M.push(Mse),this._instanced&&M.push(qH)),(l[Aw]||l[GGe]||l[Tse])&&(M.push(Lse),M.push(WH)),(l[Aw]||l[bse])&&M.push(WH),l[yse]&&M.push(qH),l[xse]&&M.push(Nse),l[Ase]&&M.push(Fse),(l[Cse]||l[jGe]||l[Aw]||l[Cw])&&M.push(Bse),(l[Aw]||l[Cw])&&M.push(kse),l[Ese]&&M.push(Vse),l[Sse]&&M.push(Use);let N=M.length;if(d=this._vaf.writers,a/n>.1){for(let B=0;B<a;++B){let _=s[B];_._dirty=!1;for(let w=0;w<N;++w)M[w](this,e,r,d,_)}this._vaf.commit(zH(i))}else{for(let B=0;B<a;++B){let _=s[B];_._dirty=!1;for(let w=0;w<N;++w)M[w](this,e,r,d,_);this._instanced?this._vaf.subCommit(_._index,1):this._vaf.subCommit(_._index*4,4)}this._vaf.endSubCommits()}this._billboardsToUpdateIndex=0}if(a>n*1.5&&(s.length=n),!c(this._vaf)||!c(this._vaf.va))return;this._boundingVolumeDirty&&(this._boundingVolumeDirty=!1,ce.transform(this._baseVolume,this.modelMatrix,this._baseVolumeWC));let m,b=k.IDENTITY;e.mode===oe.SCENE3D?(b=this.modelMatrix,m=ce.clone(this._baseVolumeWC,this._boundingVolume)):m=ce.clone(this._baseVolume2D,this._boundingVolume),r5e(this,e,m);let x=this._blendOption!==this.blendOption;if(this._blendOption=this.blendOption,x){this._blendOption===Oo.OPAQUE||this._blendOption===Oo.OPAQUE_AND_TRANSLUCENT?this._rsOpaque=ze.fromCache({depthTest:{enabled:!0,func:ne.LESS},depthMask:!0}):this._rsOpaque=void 0;let M=this._blendOption===Oo.TRANSLUCENT;this._blendOption===Oo.TRANSLUCENT||this._blendOption===Oo.OPAQUE_AND_TRANSLUCENT?this._rsTranslucent=ze.fromCache({depthTest:{enabled:!0,func:M?ne.LEQUAL:ne.LESS},depthMask:M,blending:hn.ALPHA_BLEND}):this._rsTranslucent=void 0}this._shaderDisableDepthDistance=this._shaderDisableDepthDistance||e.minimumDisableDepthTestDistance!==0;let T,C,S,v,D,I=mt.maximumVertexTextureImageUnits>0;if(x||this._shaderRotation!==this._compiledShaderRotation||this._shaderAlignedAxis!==this._compiledShaderAlignedAxis||this._shaderScaleByDistance!==this._compiledShaderScaleByDistance||this._shaderTranslucencyByDistance!==this._compiledShaderTranslucencyByDistance||this._shaderPixelOffsetScaleByDistance!==this._compiledShaderPixelOffsetScaleByDistance||this._shaderDistanceDisplayCondition!==this._compiledShaderDistanceDisplayCondition||this._shaderDisableDepthDistance!==this._compiledShaderDisableDepthDistance||this._shaderClampToGround!==this._compiledShaderClampToGround||this._sdf!==this._compiledSDF){T=UH,C=VH,D=[],c(this._batchTable)&&(D.push("VECTOR_TILE"),T=this._batchTable.getVertexShaderCallback(!1,"a_batchId",void 0)(T),C=this._batchTable.getFragmentShaderCallback(!1,void 0)(C)),S=new Ge({defines:D,sources:[T]}),this._instanced&&S.defines.push("INSTANCED"),this._shaderRotation&&S.defines.push("ROTATION"),this._shaderAlignedAxis&&S.defines.push("ALIGNED_AXIS"),this._shaderScaleByDistance&&S.defines.push("EYE_DISTANCE_SCALING"),this._shaderTranslucencyByDistance&&S.defines.push("EYE_DISTANCE_TRANSLUCENCY"),this._shaderPixelOffsetScaleByDistance&&S.defines.push("EYE_DISTANCE_PIXEL_OFFSET"),this._shaderDistanceDisplayCondition&&S.defines.push("DISTANCE_DISPLAY_CONDITION"),this._shaderDisableDepthDistance&&S.defines.push("DISABLE_DEPTH_DISTANCE"),this._shaderClampToGround&&(I?S.defines.push("VERTEX_DEPTH_CHECK"):S.defines.push("FRAGMENT_DEPTH_CHECK"));let M=1-ha.CUTOFF;this._sdf&&S.defines.push("SDF");let N=c(this._batchTable)?"VECTOR_TILE":"";this._blendOption===Oo.OPAQUE_AND_TRANSLUCENT&&(v=new Ge({defines:["OPAQUE",N],sources:[C]}),this._shaderClampToGround&&(I?v.defines.push("VERTEX_DEPTH_CHECK"):v.defines.push("FRAGMENT_DEPTH_CHECK")),this._sdf&&(v.defines.push("SDF"),v.defines.push(`SDF_EDGE ${M}`)),this._sp=an.replaceCache({context:i,shaderProgram:this._sp,vertexShaderSource:S,fragmentShaderSource:v,attributeLocations:to}),v=new Ge({defines:["TRANSLUCENT",N],sources:[C]}),this._shaderClampToGround&&(I?v.defines.push("VERTEX_DEPTH_CHECK"):v.defines.push("FRAGMENT_DEPTH_CHECK")),this._sdf&&(v.defines.push("SDF"),v.defines.push(`SDF_EDGE ${M}`)),this._spTranslucent=an.replaceCache({context:i,shaderProgram:this._spTranslucent,vertexShaderSource:S,fragmentShaderSource:v,attributeLocations:to})),this._blendOption===Oo.OPAQUE&&(v=new Ge({defines:[N],sources:[C]}),this._shaderClampToGround&&(I?v.defines.push("VERTEX_DEPTH_CHECK"):v.defines.push("FRAGMENT_DEPTH_CHECK")),this._sdf&&(v.defines.push("SDF"),v.defines.push(`SDF_EDGE ${M}`)),this._sp=an.replaceCache({context:i,shaderProgram:this._sp,vertexShaderSource:S,fragmentShaderSource:v,attributeLocations:to})),this._blendOption===Oo.TRANSLUCENT&&(v=new Ge({defines:[N],sources:[C]}),this._shaderClampToGround&&(I?v.defines.push("VERTEX_DEPTH_CHECK"):v.defines.push("FRAGMENT_DEPTH_CHECK")),this._sdf&&(v.defines.push("SDF"),v.defines.push(`SDF_EDGE ${M}`)),this._spTranslucent=an.replaceCache({context:i,shaderProgram:this._spTranslucent,vertexShaderSource:S,fragmentShaderSource:v,attributeLocations:to})),this._compiledShaderRotation=this._shaderRotation,this._compiledShaderAlignedAxis=this._shaderAlignedAxis,this._compiledShaderScaleByDistance=this._shaderScaleByDistance,this._compiledShaderTranslucencyByDistance=this._shaderTranslucencyByDistance,this._compiledShaderPixelOffsetScaleByDistance=this._shaderPixelOffsetScaleByDistance,this._compiledShaderDistanceDisplayCondition=this._shaderDistanceDisplayCondition,this._compiledShaderDisableDepthDistance=this._shaderDisableDepthDistance,this._compiledShaderClampToGround=this._shaderClampToGround,this._compiledSDF=this._sdf}let L=e.commandList;if(p.render||p.pick){let M=this._colorCommands,N=this._blendOption===Oo.OPAQUE,B=this._blendOption===Oo.OPAQUE_AND_TRANSLUCENT,_=this._vaf.va,w=_.length,P=this._uniforms,O;c(this._batchTable)?(P=this._batchTable.getUniformMapCallback()(P),O=this._batchTable.getPickId()):O="v_pickColor",M.length=w;let F=B?w*2:w;for(let V=0;V<F;++V){let G=M[V];c(G)||(G=M[V]=new et);let z=N||B&&V%2===0;G.pass=z||!B?ve.OPAQUE:ve.TRANSLUCENT,G.owner=this;let W=B?Math.floor(V/2):V;G.boundingVolume=m,G.modelMatrix=b,G.count=_[W].indicesCount,G.shaderProgram=z?this._sp:this._spTranslucent,G.uniformMap=P,G.vertexArray=_[W].va,G.renderState=z?this._rsOpaque:this._rsTranslucent,G.debugShowBoundingVolume=this.debugShowBoundingVolume,G.pickId=O,this._instanced&&(G.count=6,G.instanceCount=n),L.push(G)}this.debugShowTextureAtlas&&(c(this.debugCommand)||(this.debugCommand=s5e(this,e.context)),L.push(this.debugCommand))}};nf.prototype.isDestroyed=function(){return!1};nf.prototype.destroy=function(){return c(this._removeCallbackFunc)&&(this._removeCallbackFunc(),this._removeCallbackFunc=void 0),this._textureAtlas=this._destroyTextureAtlas&&this._textureAtlas&&this._textureAtlas.destroy(),this._sp=this._sp&&this._sp.destroy(),this._spTranslucent=this._spTranslucent&&this._spTranslucent.destroy(),this._vaf=this._vaf&&this._vaf.destroy(),wse(this._billboards),de(this)};var rd=nf;function c5e(e,t,n,i,o){return function(){let r=document.createElement("canvas"),s=o+2*i;r.height=r.width=s;let a=r.getContext("2d");return a.clearRect(0,0,s,s),i!==0&&(a.beginPath(),a.arc(s/2,s/2,s/2,0,2*Math.PI,!0),a.closePath(),a.fillStyle=n,a.fill(),e<1&&(a.save(),a.globalCompositeOperation="destination-out",a.beginPath(),a.arc(s/2,s/2,o/2,0,2*Math.PI,!0),a.closePath(),a.fillStyle="black",a.fill(),a.restore())),a.beginPath(),a.arc(s/2,s/2,o/2,0,2*Math.PI,!0),a.closePath(),a.fillStyle=t,a.fill(),r}}var Ew=c5e;function $s(e,t,n,i,o){this._content=e,this._billboard=n,this._label=i,this._polyline=o,this._batchId=t,this._billboardImage=void 0,this._billboardColor=void 0,this._billboardOutlineColor=void 0,this._billboardOutlineWidth=void 0,this._billboardSize=void 0,this._pointSize=void 0,this._color=void 0,this._pointSize=void 0,this._pointOutlineColor=void 0,this._pointOutlineWidth=void 0,this._heightOffset=void 0,this._pickIds=new Array(3),UT(this)}var l5e=new he;Object.defineProperties($s.prototype,{show:{get:function(){return this._label.show},set:function(e){this._label.show=e,this._billboard.show=e,this._polyline.show=e}},color:{get:function(){return this._color},set:function(e){this._color=j.clone(e,this._color),UT(this)}},pointSize:{get:function(){return this._pointSize},set:function(e){this._pointSize=e,UT(this)}},pointOutlineColor:{get:function(){return this._pointOutlineColor},set:function(e){this._pointOutlineColor=j.clone(e,this._pointOutlineColor),UT(this)}},pointOutlineWidth:{get:function(){return this._pointOutlineWidth},set:function(e){this._pointOutlineWidth=e,UT(this)}},labelColor:{get:function(){return this._label.fillColor},set:function(e){this._label.fillColor=e,this._polyline.show=this._label.show&&e.alpha>0}},labelOutlineColor:{get:function(){return this._label.outlineColor},set:function(e){this._label.outlineColor=e}},labelOutlineWidth:{get:function(){return this._label.outlineWidth},set:function(e){this._label.outlineWidth=e}},font:{get:function(){return this._label.font},set:function(e){this._label.font=e}},labelStyle:{get:function(){return this._label.style},set:function(e){this._label.style=e}},labelText:{get:function(){return this._label.text},set:function(e){c(e)||(e=""),this._label.text=e}},backgroundColor:{get:function(){return this._label.backgroundColor},set:function(e){this._label.backgroundColor=e}},backgroundPadding:{get:function(){return this._label.backgroundPadding},set:function(e){this._label.backgroundPadding=e}},backgroundEnabled:{get:function(){return this._label.showBackground},set:function(e){this._label.showBackground=e}},scaleByDistance:{get:function(){return this._label.scaleByDistance},set:function(e){this._label.scaleByDistance=e,this._billboard.scaleByDistance=e}},translucencyByDistance:{get:function(){return this._label.translucencyByDistance},set:function(e){this._label.translucencyByDistance=e,this._billboard.translucencyByDistance=e}},distanceDisplayCondition:{get:function(){return this._label.distanceDisplayCondition},set:function(e){this._label.distanceDisplayCondition=e,this._polyline.distanceDisplayCondition=e,this._billboard.distanceDisplayCondition=e}},heightOffset:{get:function(){return this._heightOffset},set:function(e){let t=y(this._heightOffset,0),n=this._content.tileset.ellipsoid,i=n.cartesianToCartographic(this._billboard.position,l5e);i.height=i.height-t+e;let o=n.cartographicToCartesian(i);this._billboard.position=o,this._label.position=this._billboard.position,this._polyline.positions=[this._polyline.positions[0],o],this._heightOffset=e}},anchorLineEnabled:{get:function(){return this._polyline.show},set:function(e){this._polyline.show=e}},anchorLineColor:{get:function(){return this._polyline.material.uniforms.color},set:function(e){this._polyline.material.uniforms.color=j.clone(e,this._polyline.material.uniforms.color)}},image:{get:function(){return this._billboardImage},set:function(e){let t=this._billboardImage!==e;this._billboardImage=e,t&&UT(this)}},disableDepthTestDistance:{get:function(){return this._label.disableDepthTestDistance},set:function(e){this._label.disableDepthTestDistance=e,this._billboard.disableDepthTestDistance=e}},horizontalOrigin:{get:function(){return this._billboard.horizontalOrigin},set:function(e){this._billboard.horizontalOrigin=e}},verticalOrigin:{get:function(){return this._billboard.verticalOrigin},set:function(e){this._billboard.verticalOrigin=e}},labelHorizontalOrigin:{get:function(){return this._label.horizontalOrigin},set:function(e){this._label.horizontalOrigin=e}},labelVerticalOrigin:{get:function(){return this._label.verticalOrigin},set:function(e){this._label.verticalOrigin=e}},content:{get:function(){return this._content}},tileset:{get:function(){return this._content.tileset}},primitive:{get:function(){return this._content.tileset}},pickIds:{get:function(){let e=this._pickIds;return e[0]=this._billboard.pickId,e[1]=this._label.pickId,e[2]=this._polyline.pickId,e}}});$s.defaultColor=j.WHITE;$s.defaultPointOutlineColor=j.BLACK;$s.defaultPointOutlineWidth=0;$s.defaultPointSize=8;function UT(e){let t=e._billboard;if(c(e._billboardImage)&&e._billboardImage!==t.image){t.image=e._billboardImage;return}if(c(e._billboardImage))return;let n=y(e._color,$s.defaultColor),i=y(e._pointOutlineColor,$s.defaultPointOutlineColor),o=y(e._pointOutlineWidth,$s.defaultPointOutlineWidth),r=y(e._pointSize,$s.defaultPointSize),s=e._billboardColor,a=e._billboardOutlineColor,l=e._billboardOutlineWidth,u=e._billboardSize;if(j.equals(n,s)&&j.equals(i,a)&&o===l&&r===u)return;e._billboardColor=j.clone(n,e._billboardColor),e._billboardOutlineColor=j.clone(i,e._billboardOutlineColor),e._billboardOutlineWidth=o,e._billboardSize=r;let f=n.alpha,d=n.toCssColorString(),p=i.toCssColorString(),g=JSON.stringify([d,r,p,o]);t.setImage(g,Ew(f,d,p,o,r))}$s.prototype.hasProperty=function(e){return this._content.batchTable.hasProperty(this._batchId,e)};$s.prototype.getPropertyIds=function(e){return this._content.batchTable.getPropertyIds(this._batchId,e)};$s.prototype.getProperty=function(e){return this._content.batchTable.getProperty(this._batchId,e)};$s.prototype.getPropertyInherited=function(e){return Ws.getPropertyInherited(this._content,this._batchId,e)};$s.prototype.setProperty=function(e,t){this._content.batchTable.setProperty(this._batchId,e,t),this._content.featurePropertiesDirty=!0};$s.prototype.isExactClass=function(e){return this._content.batchTable.isExactClass(this._batchId,e)};$s.prototype.isClass=function(e){return this._content.batchTable.isClass(this._batchId,e)};$s.prototype.getExactClassName=function(){return this._content.batchTable.getExactClassName(this._batchId)};var N0=$s;function u5e(e,t,n,i,o){let r=e.measureText(t);if(!!/\S/.test(t)){let a=document.defaultView.getComputedStyle(e.canvas).getPropertyValue("font-size").replace("px",""),l=document.createElement("canvas"),u=100,f=r.width+u|0,d=3*a,p=d/2;l.width=f,l.height=d;let g=l.getContext("2d");g.font=n,g.fillStyle="white",g.fillRect(0,0,l.width+1,l.height+1),i&&(g.strokeStyle="black",g.lineWidth=e.lineWidth,g.strokeText(t,u/2,p)),o&&(g.fillStyle="black",g.fillText(t,u/2,p));let m=g.getImageData(0,0,f,d).data,b=m.length,x=f*4,T,C,S,v;for(T=0;T<b;++T)if(m[T]!==255){S=T/x|0;break}for(T=b-1;T>=0;--T)if(m[T]!==255){v=T/x|0;break}let D=-1;for(T=0;T<f&&D===-1;++T)for(C=0;C<d;++C){let I=T*4+C*x;if(m[I]!==255||m[I+1]!==255||m[I+2]!==255||m[I+3]!==255){D=T;break}}return{width:r.width,height:v-S,ascent:p-S,descent:v-p,minx:D-u/2}}return{width:r.width,height:0,ascent:0,descent:0,minx:0}}var F0;function f5e(e,t){if(!c(e))throw new E("text is required.");if(e==="")return;t=y(t,y.EMPTY_OBJECT);let n=y(t.font,"10px sans-serif"),i=y(t.stroke,!1),o=y(t.fill,!0),r=y(t.strokeWidth,1),s=y(t.backgroundColor,j.TRANSPARENT),a=y(t.padding,0),l=a*2,u=document.createElement("canvas");u.width=1,u.height=1,u.style.font=n;let f=u.getContext("2d",{willReadFrequently:!0});c(F0)||(c(f.imageSmoothingEnabled)?F0="imageSmoothingEnabled":c(f.mozImageSmoothingEnabled)?F0="mozImageSmoothingEnabled":c(f.webkitImageSmoothingEnabled)?F0="webkitImageSmoothingEnabled":c(f.msImageSmoothingEnabled)&&(F0="msImageSmoothingEnabled")),f.font=n,f.lineJoin="round",f.lineWidth=r,f[F0]=!1,u.style.visibility="hidden",document.body.appendChild(u);let d=u5e(f,e,n,i,o);u.dimensions=d,document.body.removeChild(u),u.style.visibility="";let p=-d.minx,g=Math.ceil(d.width)+p+l,m=d.height+l,b=m-d.ascent+a,x=m-b+l;if(u.width=g,u.height=m,f.font=n,f.lineJoin="round",f.lineWidth=r,f[F0]=!1,s!==j.TRANSPARENT&&(f.fillStyle=s.toCssColorString(),f.fillRect(0,0,u.width,u.height)),i){let T=y(t.strokeColor,j.BLACK);f.strokeStyle=T.toCssColorString(),f.strokeText(e,p+a,x)}if(o){let T=y(t.fillColor,j.WHITE);f.fillStyle=T.toCssColorString(),f.fillText(e,p+a,x)}return u}var Sw=f5e;var Zse=Ur(jse(),1);var h5e={FILL:0,OUTLINE:1,FILL_AND_OUTLINE:2},ir=Object.freeze(h5e);var Wse={},qse=0,m5e=256,p5e=new j(.165,.165,.165,.8),_5e=new H(7,5),es=Object.freeze({LTR:0,RTL:1,WEAK:2,BRACKETS:3});function B0(e){!e._rebindAllGlyphs&&!e._repositionAllGlyphs&&e._labelCollection._labelsToUpdate.push(e),e._rebindAllGlyphs=!0}function vw(e){!e._rebindAllGlyphs&&!e._repositionAllGlyphs&&e._labelCollection._labelsToUpdate.push(e),e._repositionAllGlyphs=!0}function Dw(e,t){return document.defaultView.getComputedStyle(e,null).getPropertyValue(t)}function Xse(e){let t=Wse[e._font];if(!c(t)){let n=document.createElement("div");n.style.position="absolute",n.style.opacity=0,n.style.font=e._font,document.body.appendChild(n);let i=parseFloat(Dw(n,"line-height"));isNaN(i)&&(i=void 0),t={family:Dw(n,"font-family"),size:Dw(n,"font-size").replace("px",""),style:Dw(n,"font-style"),weight:Dw(n,"font-weight"),lineHeight:i},document.body.removeChild(n),qse<m5e&&(Wse[e._font]=t,qse++)}e._fontFamily=t.family,e._fontSize=t.size,e._fontStyle=t.style,e._fontWeight=t.weight,e._lineHeight=t.lineHeight}function _p(e,t){if(e=y(e,y.EMPTY_OBJECT),c(e.disableDepthTestDistance)&&e.disableDepthTestDistance<0)throw new E("disableDepthTestDistance must be greater than 0.0.");let n=e.translucencyByDistance,i=e.pixelOffsetScaleByDistance,o=e.scaleByDistance,r=e.distanceDisplayCondition;if(c(n)){if(n.far<=n.near)throw new E("translucencyByDistance.far must be greater than translucencyByDistance.near.");n=Vt.clone(n)}if(c(i)){if(i.far<=i.near)throw new E("pixelOffsetScaleByDistance.far must be greater than pixelOffsetScaleByDistance.near.");i=Vt.clone(i)}if(c(o)){if(o.far<=o.near)throw new E("scaleByDistance.far must be greater than scaleByDistance.near.");o=Vt.clone(o)}if(c(r)){if(r.far<=r.near)throw new E("distanceDisplayCondition.far must be greater than distanceDisplayCondition.near.");r=Bt.clone(r)}this._renderedText=void 0,this._text=void 0,this._show=y(e.show,!0),this._font=y(e.font,"30px sans-serif"),this._fillColor=j.clone(y(e.fillColor,j.WHITE)),this._outlineColor=j.clone(y(e.outlineColor,j.BLACK)),this._outlineWidth=y(e.outlineWidth,1),this._showBackground=y(e.showBackground,!1),this._backgroundColor=j.clone(y(e.backgroundColor,p5e)),this._backgroundPadding=H.clone(y(e.backgroundPadding,_5e)),this._style=y(e.style,ir.FILL),this._verticalOrigin=y(e.verticalOrigin,Ln.BASELINE),this._horizontalOrigin=y(e.horizontalOrigin,bi.LEFT),this._pixelOffset=H.clone(y(e.pixelOffset,H.ZERO)),this._eyeOffset=h.clone(y(e.eyeOffset,h.ZERO)),this._position=h.clone(y(e.position,h.ZERO)),this._scale=y(e.scale,1),this._id=e.id,this._translucencyByDistance=n,this._pixelOffsetScaleByDistance=i,this._scaleByDistance=o,this._heightReference=y(e.heightReference,$e.NONE),this._distanceDisplayCondition=r,this._disableDepthTestDistance=e.disableDepthTestDistance,this._labelCollection=t,this._glyphs=[],this._backgroundBillboard=void 0,this._batchIndex=void 0,this._rebindAllGlyphs=!0,this._repositionAllGlyphs=!0,this._actualClampedPosition=void 0,this._removeCallbackFunc=void 0,this._mode=void 0,this._clusterShow=!0,this.text=y(e.text,""),this._relativeSize=1,Xse(this),this._updateClamping()}Object.defineProperties(_p.prototype,{show:{get:function(){return this._show},set:function(e){if(!c(e))throw new E("value is required.");if(this._show!==e){this._show=e;let t=this._glyphs;for(let i=0,o=t.length;i<o;i++){let r=t[i].billboard;c(r)&&(r.show=e)}let n=this._backgroundBillboard;c(n)&&(n.show=e)}}},position:{get:function(){return this._position},set:function(e){if(!c(e))throw new E("value is required.");let t=this._position;if(!h.equals(t,e)){h.clone(e,t);let n=this._glyphs;for(let o=0,r=n.length;o<r;o++){let s=n[o].billboard;c(s)&&(s.position=e)}let i=this._backgroundBillboard;c(i)&&(i.position=e),this._updateClamping()}}},heightReference:{get:function(){return this._heightReference},set:function(e){if(!c(e))throw new E("value is required.");if(e!==this._heightReference){this._heightReference=e;let t=this._glyphs;for(let i=0,o=t.length;i<o;i++){let r=t[i].billboard;c(r)&&(r.heightReference=e)}let n=this._backgroundBillboard;c(n)&&(n.heightReference=e),vw(this),this._updateClamping()}}},text:{get:function(){return this._text},set:function(e){if(!c(e))throw new E("value is required.");if(this._text!==e){this._text=e;let t=e.replace(/\u00ad/g,"");this._renderedText=_p.enableRightToLeftDetection?A5e(t):t,B0(this)}}},font:{get:function(){return this._font},set:function(e){if(!c(e))throw new E("value is required.");this._font!==e&&(this._font=e,B0(this),Xse(this))}},fillColor:{get:function(){return this._fillColor},set:function(e){if(!c(e))throw new E("value is required.");let t=this._fillColor;j.equals(t,e)||(j.clone(e,t),B0(this))}},outlineColor:{get:function(){return this._outlineColor},set:function(e){if(!c(e))throw new E("value is required.");let t=this._outlineColor;j.equals(t,e)||(j.clone(e,t),B0(this))}},outlineWidth:{get:function(){return this._outlineWidth},set:function(e){if(!c(e))throw new E("value is required.");this._outlineWidth!==e&&(this._outlineWidth=e,B0(this))}},showBackground:{get:function(){return this._showBackground},set:function(e){if(!c(e))throw new E("value is required.");this._showBackground!==e&&(this._showBackground=e,B0(this))}},backgroundColor:{get:function(){return this._backgroundColor},set:function(e){if(!c(e))throw new E("value is required.");let t=this._backgroundColor;if(!j.equals(t,e)){j.clone(e,t);let n=this._backgroundBillboard;c(n)&&(n.color=t)}}},backgroundPadding:{get:function(){return this._backgroundPadding},set:function(e){if(!c(e))throw new E("value is required.");let t=this._backgroundPadding;H.equals(t,e)||(H.clone(e,t),vw(this))}},style:{get:function(){return this._style},set:function(e){if(!c(e))throw new E("value is required.");this._style!==e&&(this._style=e,B0(this))}},pixelOffset:{get:function(){return this._pixelOffset},set:function(e){if(!c(e))throw new E("value is required.");let t=this._pixelOffset;if(!H.equals(t,e)){H.clone(e,t);let n=this._glyphs;for(let o=0,r=n.length;o<r;o++){let s=n[o];c(s.billboard)&&(s.billboard.pixelOffset=e)}let i=this._backgroundBillboard;c(i)&&(i.pixelOffset=e)}}},translucencyByDistance:{get:function(){return this._translucencyByDistance},set:function(e){if(c(e)&&e.far<=e.near)throw new E("far distance must be greater than near distance.");let t=this._translucencyByDistance;if(!Vt.equals(t,e)){this._translucencyByDistance=Vt.clone(e,t);let n=this._glyphs;for(let o=0,r=n.length;o<r;o++){let s=n[o];c(s.billboard)&&(s.billboard.translucencyByDistance=e)}let i=this._backgroundBillboard;c(i)&&(i.translucencyByDistance=e)}}},pixelOffsetScaleByDistance:{get:function(){return this._pixelOffsetScaleByDistance},set:function(e){if(c(e)&&e.far<=e.near)throw new E("far distance must be greater than near distance.");let t=this._pixelOffsetScaleByDistance;if(!Vt.equals(t,e)){this._pixelOffsetScaleByDistance=Vt.clone(e,t);let n=this._glyphs;for(let o=0,r=n.length;o<r;o++){let s=n[o];c(s.billboard)&&(s.billboard.pixelOffsetScaleByDistance=e)}let i=this._backgroundBillboard;c(i)&&(i.pixelOffsetScaleByDistance=e)}}},scaleByDistance:{get:function(){return this._scaleByDistance},set:function(e){if(c(e)&&e.far<=e.near)throw new E("far distance must be greater than near distance.");let t=this._scaleByDistance;if(!Vt.equals(t,e)){this._scaleByDistance=Vt.clone(e,t);let n=this._glyphs;for(let o=0,r=n.length;o<r;o++){let s=n[o];c(s.billboard)&&(s.billboard.scaleByDistance=e)}let i=this._backgroundBillboard;c(i)&&(i.scaleByDistance=e)}}},eyeOffset:{get:function(){return this._eyeOffset},set:function(e){if(!c(e))throw new E("value is required.");let t=this._eyeOffset;if(!h.equals(t,e)){h.clone(e,t);let n=this._glyphs;for(let o=0,r=n.length;o<r;o++){let s=n[o];c(s.billboard)&&(s.billboard.eyeOffset=e)}let i=this._backgroundBillboard;c(i)&&(i.eyeOffset=e)}}},horizontalOrigin:{get:function(){return this._horizontalOrigin},set:function(e){if(!c(e))throw new E("value is required.");this._horizontalOrigin!==e&&(this._horizontalOrigin=e,vw(this))}},verticalOrigin:{get:function(){return this._verticalOrigin},set:function(e){if(!c(e))throw new E("value is required.");if(this._verticalOrigin!==e){this._verticalOrigin=e;let t=this._glyphs;for(let i=0,o=t.length;i<o;i++){let r=t[i];c(r.billboard)&&(r.billboard.verticalOrigin=e)}let n=this._backgroundBillboard;c(n)&&(n.verticalOrigin=e),vw(this)}}},scale:{get:function(){return this._scale},set:function(e){if(!c(e))throw new E("value is required.");if(this._scale!==e){this._scale=e;let t=this._glyphs;for(let i=0,o=t.length;i<o;i++){let r=t[i];c(r.billboard)&&(r.billboard.scale=e*this._relativeSize)}let n=this._backgroundBillboard;c(n)&&(n.scale=e*this._relativeSize),vw(this)}}},totalScale:{get:function(){return this._scale*this._relativeSize}},distanceDisplayCondition:{get:function(){return this._distanceDisplayCondition},set:function(e){if(c(e)&&e.far<=e.near)throw new E("far must be greater than near");if(!Bt.equals(e,this._distanceDisplayCondition)){this._distanceDisplayCondition=Bt.clone(e,this._distanceDisplayCondition);let t=this._glyphs;for(let i=0,o=t.length;i<o;i++){let r=t[i];c(r.billboard)&&(r.billboard.distanceDisplayCondition=e)}let n=this._backgroundBillboard;c(n)&&(n.distanceDisplayCondition=e)}}},disableDepthTestDistance:{get:function(){return this._disableDepthTestDistance},set:function(e){if(this._disableDepthTestDistance!==e){if(c(e)&&e<0)throw new E("disableDepthTestDistance must be greater than 0.0.");this._disableDepthTestDistance=e;let t=this._glyphs;for(let i=0,o=t.length;i<o;i++){let r=t[i];c(r.billboard)&&(r.billboard.disableDepthTestDistance=e)}let n=this._backgroundBillboard;c(n)&&(n.disableDepthTestDistance=e)}}},id:{get:function(){return this._id},set:function(e){if(this._id!==e){this._id=e;let t=this._glyphs;for(let i=0,o=t.length;i<o;i++){let r=t[i];c(r.billboard)&&(r.billboard.id=e)}let n=this._backgroundBillboard;c(n)&&(n.id=e)}}},pickId:{get:function(){if(!(this._glyphs.length===0||!c(this._glyphs[0].billboard)))return this._glyphs[0].billboard.pickId}},_clampedPosition:{get:function(){return this._actualClampedPosition},set:function(e){this._actualClampedPosition=h.clone(e,this._actualClampedPosition);let t=this._glyphs;for(let i=0,o=t.length;i<o;i++){let r=t[i];c(r.billboard)&&(r.billboard._clampedPosition=e)}let n=this._backgroundBillboard;c(n)&&(n._clampedPosition=e)}},clusterShow:{get:function(){return this._clusterShow},set:function(e){if(this._clusterShow!==e){this._clusterShow=e;let t=this._glyphs;for(let i=0,o=t.length;i<o;i++){let r=t[i];c(r.billboard)&&(r.billboard.clusterShow=e)}let n=this._backgroundBillboard;c(n)&&(n.clusterShow=e)}}}});_p.prototype._updateClamping=function(){fo._updateClamping(this._labelCollection,this)};_p.prototype.computeScreenSpacePosition=function(e,t){if(!c(e))throw new E("scene is required.");c(t)||(t=new H);let i=this._labelCollection.modelMatrix,o=c(this._actualClampedPosition)?this._actualClampedPosition:this._position;return fo._computeScreenSpacePosition(i,o,this._eyeOffset,this._pixelOffset,e,t)};_p.getScreenSpaceBoundingBox=function(e,t,n){let i=0,o=0,r=0,s=0,a=e.totalScale,l=e._backgroundBillboard;if(c(l))i=t.x+l._translate.x,o=t.y-l._translate.y,r=l.width*a,s=l.height*a,e.verticalOrigin===Ln.BOTTOM||e.verticalOrigin===Ln.BASELINE?o-=s:e.verticalOrigin===Ln.CENTER&&(o-=s*.5);else{i=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY;let u=0,f=0,d=e._glyphs,p=d.length;for(let g=0;g<p;++g){let m=d[g],b=m.billboard;if(!c(b))continue;let x=t.x+b._translate.x,T=t.y-b._translate.y,C=m.dimensions.width*a,S=m.dimensions.height*a;e.verticalOrigin===Ln.BOTTOM||e.verticalOrigin===Ln.BASELINE?T-=S:e.verticalOrigin===Ln.CENTER&&(T-=S*.5),e._verticalOrigin===Ln.TOP?T+=ha.PADDING*a:(e._verticalOrigin===Ln.BOTTOM||e._verticalOrigin===Ln.BASELINE)&&(T-=ha.PADDING*a),i=Math.min(i,x),o=Math.min(o,T),u=Math.max(u,x+C),f=Math.max(f,T+S)}r=u-i,s=f-o}return c(n)||(n=new Ke),n.x=i,n.y=o,n.width=r,n.height=s,n};_p.prototype.equals=function(e){return this===e||c(e)&&this._show===e._show&&this._scale===e._scale&&this._outlineWidth===e._outlineWidth&&this._showBackground===e._showBackground&&this._style===e._style&&this._verticalOrigin===e._verticalOrigin&&this._horizontalOrigin===e._horizontalOrigin&&this._heightReference===e._heightReference&&this._renderedText===e._renderedText&&this._font===e._font&&h.equals(this._position,e._position)&&j.equals(this._fillColor,e._fillColor)&&j.equals(this._outlineColor,e._outlineColor)&&j.equals(this._backgroundColor,e._backgroundColor)&&H.equals(this._backgroundPadding,e._backgroundPadding)&&H.equals(this._pixelOffset,e._pixelOffset)&&h.equals(this._eyeOffset,e._eyeOffset)&&Vt.equals(this._translucencyByDistance,e._translucencyByDistance)&&Vt.equals(this._pixelOffsetScaleByDistance,e._pixelOffsetScaleByDistance)&&Vt.equals(this._scaleByDistance,e._scaleByDistance)&&Bt.equals(this._distanceDisplayCondition,e._distanceDisplayCondition)&&this._disableDepthTestDistance===e._disableDepthTestDistance&&this._id===e._id};_p.prototype.isDestroyed=function(){return!1};_p.enableRightToLeftDetection=!1;function g5e(e,t){let n=/[a-zA-Z0-9]/,i=/[()[\]{}<>]/,o=[],r="",s=es.LTR,a="",l=e.length;for(let u=0;u<l;++u){let f=e.charAt(u);t.test(f)?a=es.RTL:n.test(f)?a=es.LTR:i.test(f)?a=es.BRACKETS:a=es.WEAK,u===0&&(s=a),s===a&&a!==es.BRACKETS?r+=f:(r!==""&&o.push({Type:s,Word:r}),s=a,r=f)}return o.push({Type:a,Word:r}),o}function y5e(e){return e.split("").reverse().join("")}function Pw(e,t,n){return e.slice(0,t)+n+e.slice(t)}function b5e(e){switch(e){case"(":return")";case")":return"(";case"[":return"]";case"]":return"[";case"{":return"}";case"}":return"{";case"<":return">";case">":return"<"}}var x5e="\u05D0-\u05EA",T5e="\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF",Yse=new RegExp(`[${x5e}${T5e}]`);function A5e(e){let t=e.split(`
`),n="";for(let i=0;i<t.length;i++){let o=t[i],r=Yse.test(o.charAt(0)),s=g5e(o,Yse),a=0,l="";for(let u=0;u<s.length;++u){let f=s[u],d=f.Type===es.BRACKETS?b5e(f.Word):y5e(f.Word);r?f.Type===es.RTL?(l=d+l,a=0):f.Type===es.LTR?(l=Pw(l,a,f.Word),a+=f.Word.length):(f.Type===es.WEAK||f.Type===es.BRACKETS)&&(f.Type===es.WEAK&&s[u-1].Type===es.BRACKETS?l=d+l:s[u-1].Type===es.RTL?(l=d+l,a=0):s.length>u+1?s[u+1].Type===es.RTL?(l=d+l,a=0):(l=Pw(l,a,f.Word),a+=f.Word.length):l=Pw(l,0,d)):f.Type===es.RTL?l=Pw(l,a,d):f.Type===es.LTR?(l+=f.Word,a=l.length):(f.Type===es.WEAK||f.Type===es.BRACKETS)&&(u>0&&s[u-1].Type===es.RTL?s.length>u+1?s[u+1].Type===es.RTL?l=Pw(l,a,d):(l+=f.Word,a=l.length):l+=f.Word:(l+=f.Word,a=l.length))}n+=l,i<t.length-1&&(n+=`
`)}return n}var zT=_p;var Jse=Ur(Kse(),1);function E5e(){this.textureInfo=void 0,this.dimensions=void 0,this.billboard=void 0}function S5e(e,t,n){this.labelCollection=e,this.index=t,this.dimensions=n}var w5e=1.2,Qse="ID_WHITE_PIXEL",KH=new H(4,4),v5e=new Ke(1,1,1,1);function D5e(e){let t=document.createElement("canvas");t.width=KH.x,t.height=KH.y;let n=t.getContext("2d");return n.fillStyle="#fff",n.fillRect(0,0,t.width,t.height),e.addImage(Qse,t)}var of={};function P5e(e,t,n,i,o,r,s){return of.font=t,of.fillColor=n,of.strokeColor=i,of.strokeWidth=o,of.padding=ha.PADDING,s===Ln.CENTER?of.textBaseline="middle":s===Ln.TOP?of.textBaseline="top":of.textBaseline="bottom",of.fill=r===ir.FILL||r===ir.FILL_AND_OUTLINE,of.stroke=r===ir.OUTLINE||r===ir.FILL_AND_OUTLINE,of.backgroundColor=j.BLACK,Sw(e,of)}function $H(e,t){t.textureInfo=void 0,t.dimensions=void 0;let n=t.billboard;c(n)&&(n.show=!1,n.image=void 0,c(n._removeCallbackFunc)&&(n._removeCallbackFunc(),n._removeCallbackFunc=void 0),e._spareBillboards.push(n),t.billboard=void 0)}function I5e(e,t,n,i){i.index=e.addImageSync(t,n)}var O5e=new Jse.default;function R5e(e,t){let n=t._renderedText,i=O5e.splitGraphemes(n),o=i.length,r=t._glyphs,s=r.length,a,l,u;if(t._relativeSize=t._fontSize/ha.FONT_SIZE,o<s)for(l=o;l<s;++l)$H(e,r[l]);r.length=o;let f=t.show&&t._showBackground&&n.split(`
`).join("").length>0,d=t._backgroundBillboard,p=e._backgroundBillboardCollection;f?(c(d)||(d=p.add({collection:e,image:Qse,imageSubRegion:v5e}),t._backgroundBillboard=d),d.color=t._backgroundColor,d.show=t._show,d.position=t._position,d.eyeOffset=t._eyeOffset,d.pixelOffset=t._pixelOffset,d.horizontalOrigin=bi.LEFT,d.verticalOrigin=t._verticalOrigin,d.heightReference=t._heightReference,d.scale=t.totalScale,d.pickPrimitive=t,d.id=t._id,d.translucencyByDistance=t._translucencyByDistance,d.pixelOffsetScaleByDistance=t._pixelOffsetScaleByDistance,d.scaleByDistance=t._scaleByDistance,d.distanceDisplayCondition=t._distanceDisplayCondition,d.disableDepthTestDistance=t._disableDepthTestDistance,d.clusterShow=t.clusterShow):c(d)&&(p.remove(d),t._backgroundBillboard=d=void 0);let g=e._glyphTextureCache;for(u=0;u<o;++u){let m=i[u],b=t._verticalOrigin,x=JSON.stringify([m,t._fontFamily,t._fontStyle,t._fontWeight,+b]),T=g[x];if(!c(T)){let C=`${t._fontStyle} ${t._fontWeight} ${ha.FONT_SIZE}px ${t._fontFamily}`,S=P5e(m,C,j.WHITE,j.WHITE,0,ir.FILL,b);if(T=new S5e(e,-1,S.dimensions),g[x]=T,S.width>0&&S.height>0){let v=(0,Zse.default)(S,{cutoff:ha.CUTOFF,radius:ha.RADIUS}),D=S.getContext("2d"),I=S.width,L=S.height,M=D.getImageData(0,0,I,L);for(let N=0;N<I;N++)for(let B=0;B<L;B++){let _=B*I+N,w=v[_]*255,P=_*4;M.data[P+0]=w,M.data[P+1]=w,M.data[P+2]=w,M.data[P+3]=w}D.putImageData(M,0,0),m!==" "&&I5e(e._textureAtlas,x,S,T)}}if(a=r[u],c(a)?T.index===-1?$H(e,a):c(a.textureInfo)&&(a.textureInfo=void 0):(a=new E5e,r[u]=a),a.textureInfo=T,a.dimensions=T.dimensions,T.index!==-1){let C=a.billboard,S=e._spareBillboards;c(C)||(S.length>0?C=S.pop():(C=e._billboardCollection.add({collection:e}),C._labelDimensions=new H,C._labelTranslate=new H),a.billboard=C),C.show=t._show,C.position=t._position,C.eyeOffset=t._eyeOffset,C.pixelOffset=t._pixelOffset,C.horizontalOrigin=bi.LEFT,C.verticalOrigin=t._verticalOrigin,C.heightReference=t._heightReference,C.scale=t.totalScale,C.pickPrimitive=t,C.id=t._id,C.image=x,C.translucencyByDistance=t._translucencyByDistance,C.pixelOffsetScaleByDistance=t._pixelOffsetScaleByDistance,C.scaleByDistance=t._scaleByDistance,C.distanceDisplayCondition=t._distanceDisplayCondition,C.disableDepthTestDistance=t._disableDepthTestDistance,C._batchIndex=t._batchIndex,C.outlineColor=t.outlineColor,t.style===ir.FILL_AND_OUTLINE?(C.color=t._fillColor,C.outlineWidth=t.outlineWidth):t.style===ir.FILL?(C.color=t._fillColor,C.outlineWidth=0):t.style===ir.OUTLINE&&(C.color=j.TRANSPARENT,C.outlineWidth=t.outlineWidth)}}t._repositionAllGlyphs=!0}function $se(e,t,n){return t===bi.CENTER?-e/2:t===bi.RIGHT?-(e+n.x):n.x}var or=new H,M5e=new H;function L5e(e){let t=e._glyphs,n=e._renderedText,i,o,r=0,s=0,a=[],l=Number.NEGATIVE_INFINITY,u=0,f=1,d,p=t.length,g=e._backgroundBillboard,m=H.clone(c(g)?e._backgroundPadding:H.ZERO,M5e);for(m.x/=e._relativeSize,m.y/=e._relativeSize,d=0;d<p;++d)n.charAt(d)===`
`?(a.push(r),++f,r=0):(i=t[d],o=i.dimensions,u=Math.max(u,o.height-o.descent),l=Math.max(l,o.descent),r+=o.width-o.minx,d<p-1&&(r+=t[d+1].dimensions.minx),s=Math.max(s,r));a.push(r);let b=u+l,x=e.totalScale,T=e._horizontalOrigin,C=e._verticalOrigin,S=0,v=a[S],D=$se(v,T,m),I=(c(e._lineHeight)?e._lineHeight:w5e*e._fontSize)/e._relativeSize,L=I*(f-1),M=s,N=b+L;c(g)&&(M+=m.x*2,N+=m.y*2,g._labelHorizontalOrigin=T),or.x=D*x,or.y=0;let B=!0,_=0;for(d=0;d<p;++d)if(n.charAt(d)===`
`)++S,_+=I,v=a[S],D=$se(v,T,m),or.x=D*x,B=!0;else if(i=t[d],o=i.dimensions,C===Ln.TOP?(or.y=o.height-u-m.y,or.y+=ha.PADDING):C===Ln.CENTER?or.y=(L+o.height-u)/2:C===Ln.BASELINE?(or.y=L,or.y-=ha.PADDING):(or.y=L+l+m.y,or.y-=ha.PADDING),or.y=(or.y-o.descent-_)*x,B&&(or.x-=ha.PADDING*x,B=!1),c(i.billboard)&&(i.billboard._setTranslate(or),i.billboard._labelDimensions.x=M,i.billboard._labelDimensions.y=N,i.billboard._labelHorizontalOrigin=T),d<p-1){let w=t[d+1];or.x+=(o.width-o.minx+w.dimensions.minx)*x}if(c(g)&&n.split(`
`).join("").length>0&&(T===bi.CENTER?D=-s/2-m.x:T===bi.RIGHT?D=-(s+m.x*2):D=0,or.x=D*x,C===Ln.TOP?or.y=b-u-l:C===Ln.CENTER?or.y=(b-u)/2-l:C===Ln.BASELINE?or.y=-m.y-l:or.y=0,or.y=or.y*x,g.width=M,g.height=N,g._setTranslate(or),g._labelTranslate=H.clone(or,g._labelTranslate)),Ru(e.heightReference))for(d=0;d<p;++d){i=t[d];let w=i.billboard;c(w)&&(w._labelTranslate=H.clone(or,w._labelTranslate))}}function eae(e,t){let n=t._glyphs;for(let i=0,o=n.length;i<o;++i)$H(e,n[i]);c(t._backgroundBillboard)&&(e._backgroundBillboardCollection.remove(t._backgroundBillboard),t._backgroundBillboard=void 0),t._labelCollection=void 0,c(t._removeCallbackFunc)&&t._removeCallbackFunc(),de(t)}function Th(e){e=y(e,y.EMPTY_OBJECT),this._scene=e.scene,this._batchTable=e.batchTable,this._textureAtlas=void 0,this._backgroundTextureAtlas=void 0,this._backgroundBillboardCollection=new rd({scene:this._scene}),this._backgroundBillboardCollection.destroyTextureAtlas=!1,this._billboardCollection=new rd({scene:this._scene,batchTable:this._batchTable}),this._billboardCollection.destroyTextureAtlas=!1,this._billboardCollection._sdf=!0,this._spareBillboards=[],this._glyphTextureCache={},this._labels=[],this._labelsToUpdate=[],this._totalGlyphCount=0,this._highlightColor=j.clone(j.WHITE),this.show=y(e.show,!0),this.modelMatrix=k.clone(y(e.modelMatrix,k.IDENTITY)),this.debugShowBoundingVolume=y(e.debugShowBoundingVolume,!1),this.blendOption=y(e.blendOption,Oo.OPAQUE_AND_TRANSLUCENT)}Object.defineProperties(Th.prototype,{length:{get:function(){return this._labels.length}}});Th.prototype.add=function(e){let t=new zT(e,this);return this._labels.push(t),this._labelsToUpdate.push(t),t};Th.prototype.remove=function(e){if(c(e)&&e._labelCollection===this){let t=this._labels.indexOf(e);if(t!==-1)return this._labels.splice(t,1),eae(this,e),!0}return!1};Th.prototype.removeAll=function(){let e=this._labels;for(let t=0,n=e.length;t<n;++t)eae(this,e[t]);e.length=0};Th.prototype.contains=function(e){return c(e)&&e._labelCollection===this};Th.prototype.get=function(e){if(!c(e))throw new E("index is required.");return this._labels[e]};Th.prototype.update=function(e){if(!this.show)return;let t=this._billboardCollection,n=this._backgroundBillboardCollection;t.modelMatrix=this.modelMatrix,t.debugShowBoundingVolume=this.debugShowBoundingVolume,n.modelMatrix=this.modelMatrix,n.debugShowBoundingVolume=this.debugShowBoundingVolume;let i=e.context;c(this._textureAtlas)||(this._textureAtlas=new kT({context:i}),t.textureAtlas=this._textureAtlas),c(this._backgroundTextureAtlas)||(this._backgroundTextureAtlas=new kT({context:i,initialSize:KH}),n.textureAtlas=this._backgroundTextureAtlas,D5e(this._backgroundTextureAtlas));let o=this._labelsToUpdate.length;for(let s=0;s<o;++s){let a=this._labelsToUpdate[s];if(a.isDestroyed())continue;let l=a._glyphs.length;a._rebindAllGlyphs&&(R5e(this,a),a._rebindAllGlyphs=!1),a._repositionAllGlyphs&&(L5e(a),a._repositionAllGlyphs=!1);let u=a._glyphs.length-l;this._totalGlyphCount+=u}let r=n.length>0?Oo.TRANSLUCENT:this.blendOption;t.blendOption=r,n.blendOption=r,t._highlightColor=this._highlightColor,n._highlightColor=this._highlightColor,this._labelsToUpdate.length=0,n.update(e),t.update(e)};Th.prototype.isDestroyed=function(){return!1};Th.prototype.destroy=function(){return this.removeAll(),this._billboardCollection=this._billboardCollection.destroy(),this._textureAtlas=this._textureAtlas&&this._textureAtlas.destroy(),this._backgroundBillboardCollection=this._backgroundBillboardCollection.destroy(),this._backgroundTextureAtlas=this._backgroundTextureAtlas&&this._backgroundTextureAtlas.destroy(),de(this)};var ag=Th;var ZH=`in vec3 position3DHigh;
in vec3 position3DLow;
in vec3 position2DHigh;
in vec3 position2DLow;
in vec3 prevPosition3DHigh;
in vec3 prevPosition3DLow;
in vec3 prevPosition2DHigh;
in vec3 prevPosition2DLow;
in vec3 nextPosition3DHigh;
in vec3 nextPosition3DLow;
in vec3 nextPosition2DHigh;
in vec3 nextPosition2DLow;
in vec4 texCoordExpandAndBatchIndex;
out vec2  v_st;
out float v_width;
out vec4 v_pickColor;
out float v_polylineAngle;
void main()
{
float texCoord = texCoordExpandAndBatchIndex.x;
float expandDir = texCoordExpandAndBatchIndex.y;
bool usePrev = texCoordExpandAndBatchIndex.z < 0.0;
float batchTableIndex = texCoordExpandAndBatchIndex.w;
vec2 widthAndShow = batchTable_getWidthAndShow(batchTableIndex);
float width = widthAndShow.x + 0.5;
float show = widthAndShow.y;
if (width < 1.0)
{
show = 0.0;
}
vec4 pickColor = batchTable_getPickColor(batchTableIndex);
vec4 p, prev, next;
if (czm_morphTime == 1.0)
{
p = czm_translateRelativeToEye(position3DHigh.xyz, position3DLow.xyz);
prev = czm_translateRelativeToEye(prevPosition3DHigh.xyz, prevPosition3DLow.xyz);
next = czm_translateRelativeToEye(nextPosition3DHigh.xyz, nextPosition3DLow.xyz);
}
else if (czm_morphTime == 0.0)
{
p = czm_translateRelativeToEye(position2DHigh.zxy, position2DLow.zxy);
prev = czm_translateRelativeToEye(prevPosition2DHigh.zxy, prevPosition2DLow.zxy);
next = czm_translateRelativeToEye(nextPosition2DHigh.zxy, nextPosition2DLow.zxy);
}
else
{
p = czm_columbusViewMorph(
czm_translateRelativeToEye(position2DHigh.zxy, position2DLow.zxy),
czm_translateRelativeToEye(position3DHigh.xyz, position3DLow.xyz),
czm_morphTime);
prev = czm_columbusViewMorph(
czm_translateRelativeToEye(prevPosition2DHigh.zxy, prevPosition2DLow.zxy),
czm_translateRelativeToEye(prevPosition3DHigh.xyz, prevPosition3DLow.xyz),
czm_morphTime);
next = czm_columbusViewMorph(
czm_translateRelativeToEye(nextPosition2DHigh.zxy, nextPosition2DLow.zxy),
czm_translateRelativeToEye(nextPosition3DHigh.xyz, nextPosition3DLow.xyz),
czm_morphTime);
}
#ifdef DISTANCE_DISPLAY_CONDITION
vec3 centerHigh = batchTable_getCenterHigh(batchTableIndex);
vec4 centerLowAndRadius = batchTable_getCenterLowAndRadius(batchTableIndex);
vec3 centerLow = centerLowAndRadius.xyz;
float radius = centerLowAndRadius.w;
vec2 distanceDisplayCondition = batchTable_getDistanceDisplayCondition(batchTableIndex);
float lengthSq;
if (czm_sceneMode == czm_sceneMode2D)
{
lengthSq = czm_eyeHeight2D.y;
}
else
{
vec4 center = czm_translateRelativeToEye(centerHigh.xyz, centerLow.xyz);
lengthSq = max(0.0, dot(center.xyz, center.xyz) - radius * radius);
}
float nearSq = distanceDisplayCondition.x * distanceDisplayCondition.x;
float farSq = distanceDisplayCondition.y * distanceDisplayCondition.y;
if (lengthSq < nearSq || lengthSq > farSq)
{
show = 0.0;
}
#endif
float polylineAngle;
vec4 positionWC = getPolylineWindowCoordinates(p, prev, next, expandDir, width, usePrev, polylineAngle);
gl_Position = czm_viewportOrthographic * positionWC * show;
v_st.s = texCoord;
v_st.t = czm_writeNonPerspective(clamp(expandDir, 0.0, 1.0), gl_Position.w);
v_width = width;
v_pickColor = pickColor;
v_polylineAngle = polylineAngle;
}
`;var Sc={};Sc.numberOfPoints=function(e,t,n){let i=h.distance(e,t);return Math.ceil(i/n)};Sc.numberOfPointsRhumbLine=function(e,t,n){let i=Math.pow(e.longitude-t.longitude,2)+Math.pow(e.latitude-t.latitude,2);return Math.max(1,Math.ceil(Math.sqrt(i/(n*n))))};var N5e=new he;Sc.extractHeights=function(e,t){let n=e.length,i=new Array(n);for(let o=0;o<n;o++){let r=e[o];i[o]=t.cartesianToCartographic(r,N5e).height}return i};var F5e=new k,B5e=new h,tae=new h,k5e=new un(h.UNIT_X,0),nae=new h,V5e=new un(h.UNIT_X,0),U5e=new h,z5e=new h,QH=[];function oae(e,t,n){let i=QH;i.length=e;let o;if(t===n){for(o=0;o<e;o++)i[o]=t;return i}let s=(n-t)/e;for(o=0;o<e;o++){let a=t+o*s;i[o]=a}return i}var w1=new he,S1=new he,cg=new h,eG=new h,H5e=new h,JH=new Xy,Iw=new mc;function G5e(e,t,n,i,o,r,s,a){let l=i.scaleToGeodeticSurface(e,eG),u=i.scaleToGeodeticSurface(t,H5e),f=Sc.numberOfPoints(e,t,n),d=i.cartesianToCartographic(l,w1),p=i.cartesianToCartographic(u,S1),g=oae(f,o,r);JH.setEndPoints(d,p);let m=JH.surfaceDistance/f,b=a;d.height=o;let x=i.cartographicToCartesian(d,cg);h.pack(x,s,b),b+=3;for(let T=1;T<f;T++){let C=JH.interpolateUsingSurfaceDistance(T*m,S1);C.height=g[T],x=i.cartographicToCartesian(C,cg),h.pack(x,s,b),b+=3}return b}function j5e(e,t,n,i,o,r,s,a){let l=i.cartesianToCartographic(e,w1),u=i.cartesianToCartographic(t,S1),f=Sc.numberOfPointsRhumbLine(l,u,n);l.height=0,u.height=0;let d=oae(f,o,r);Iw.ellipsoid.equals(i)||(Iw=new mc(void 0,void 0,i)),Iw.setEndPoints(l,u);let p=Iw.surfaceDistance/f,g=a;l.height=o;let m=i.cartographicToCartesian(l,cg);h.pack(m,s,g),g+=3;for(let b=1;b<f;b++){let x=Iw.interpolateUsingSurfaceDistance(b*p,S1);x.height=d[b],m=i.cartographicToCartesian(x,cg),h.pack(m,s,g),g+=3}return g}Sc.wrapLongitude=function(e,t){let n=[],i=[];if(c(e)&&e.length>0){t=y(t,k.IDENTITY);let o=k.inverseTransformation(t,F5e),r=k.multiplyByPoint(o,h.ZERO,B5e),s=h.normalize(k.multiplyByPointAsVector(o,h.UNIT_Y,tae),tae),a=un.fromPointNormal(r,s,k5e),l=h.normalize(k.multiplyByPointAsVector(o,h.UNIT_X,nae),nae),u=un.fromPointNormal(r,l,V5e),f=1;n.push(h.clone(e[0]));let d=n[0],p=e.length;for(let g=1;g<p;++g){let m=e[g];if(un.getPointDistance(u,d)<0||un.getPointDistance(u,m)<0){let b=Qn.lineSegmentPlane(d,m,a,U5e);if(c(b)){let x=h.multiplyByScalar(s,5e-9,z5e);un.getPointDistance(a,d)<0&&h.negate(x,x),n.push(h.add(b,x,new h)),i.push(f+1),h.negate(x,x),n.push(h.add(b,x,new h)),f=1}}n.push(h.clone(e[g])),f++,d=m}i.push(f)}return{positions:n,lengths:i}};Sc.generateArc=function(e){c(e)||(e={});let t=e.positions;if(!c(t))throw new E("options.positions is required.");let n=t.length,i=y(e.ellipsoid,ie.default),o=y(e.height,0),r=Array.isArray(o);if(n<1)return[];if(n===1){let b=i.scaleToGeodeticSurface(t[0],eG);if(o=r?o[0]:o,o!==0){let x=i.geodeticSurfaceNormal(b,cg);h.multiplyByScalar(x,o,x),h.add(b,x,b)}return[b.x,b.y,b.z]}let s=e.minDistance;if(!c(s)){let b=y(e.granularity,R.RADIANS_PER_DEGREE);s=R.chordLength(b,i.maximumRadius)}let a=0,l;for(l=0;l<n-1;l++)a+=Sc.numberOfPoints(t[l],t[l+1],s);let u=(a+1)*3,f=new Array(u),d=0;for(l=0;l<n-1;l++){let b=t[l],x=t[l+1],T=r?o[l]:o,C=r?o[l+1]:o;d=G5e(b,x,s,i,T,C,f,d)}QH.length=0;let p=t[n-1],g=i.cartesianToCartographic(p,w1);g.height=r?o[n-1]:o;let m=i.cartographicToCartesian(g,cg);return h.pack(m,f,u-3),f};var iae=new he,W5e=new he;Sc.generateRhumbArc=function(e){c(e)||(e={});let t=e.positions;if(!c(t))throw new E("options.positions is required.");let n=t.length,i=y(e.ellipsoid,ie.default),o=y(e.height,0),r=Array.isArray(o);if(n<1)return[];if(n===1){let T=i.scaleToGeodeticSurface(t[0],eG);if(o=r?o[0]:o,o!==0){let C=i.geodeticSurfaceNormal(T,cg);h.multiplyByScalar(C,o,C),h.add(T,C,T)}return[T.x,T.y,T.z]}let s=y(e.granularity,R.RADIANS_PER_DEGREE),a=0,l,u=i.cartesianToCartographic(t[0],iae),f;for(l=0;l<n-1;l++)f=i.cartesianToCartographic(t[l+1],W5e),a+=Sc.numberOfPointsRhumbLine(u,f,s),u=he.clone(f,iae);let d=(a+1)*3,p=new Array(d),g=0;for(l=0;l<n-1;l++){let T=t[l],C=t[l+1],S=r?o[l]:o,v=r?o[l+1]:o;g=j5e(T,C,s,i,S,v,p,g)}QH.length=0;let m=t[n-1],b=i.cartesianToCartographic(m,w1);b.height=r?o[n-1]:o;let x=i.cartographicToCartesian(b,cg);return h.pack(x,p,d-3),p};Sc.generateCartesianArc=function(e){let t=Sc.generateArc(e),n=t.length/3,i=new Array(n);for(let o=0;o<n;o++)i[o]=h.unpack(t,o*3);return i};Sc.generateCartesianRhumbArc=function(e){let t=Sc.generateRhumbArc(e),n=t.length/3,i=new Array(n);for(let o=0;o<n;o++)i[o]=h.unpack(t,o*3);return i};var Bi=Sc;function Wl(e,t){e=y(e,y.EMPTY_OBJECT),this._show=y(e.show,!0),this._width=y(e.width,1),this._loop=y(e.loop,!1),this._distanceDisplayCondition=e.distanceDisplayCondition,this._material=e.material,c(this._material)||(this._material=Ki.fromType(Ki.ColorType,{color:new j(1,1,1,1)}));let n=e.positions;c(n)||(n=[]),this._positions=n,this._actualPositions=Ao(n,h.equalsEpsilon),this._loop&&this._actualPositions.length>2&&(this._actualPositions===this._positions&&(this._actualPositions=n.slice()),this._actualPositions.push(h.clone(this._actualPositions[0]))),this._length=this._actualPositions.length,this._id=e.id;let i;c(t)&&(i=k.clone(t.modelMatrix)),this._modelMatrix=i,this._segments=Bi.wrapLongitude(this._actualPositions,i),this._actualLength=void 0,this._propertiesChanged=new Uint32Array(sae),this._polylineCollection=t,this._dirty=!1,this._pickId=void 0,this._boundingVolume=ce.fromPoints(this._actualPositions),this._boundingVolumeWC=ce.transform(this._boundingVolume,this._modelMatrix),this._boundingVolume2D=new ce}var rae=Wl.POSITION_INDEX=0,q5e=Wl.SHOW_INDEX=1,Y5e=Wl.WIDTH_INDEX=2,X5e=Wl.MATERIAL_INDEX=3,Ow=Wl.POSITION_SIZE_INDEX=4,K5e=Wl.DISTANCE_DISPLAY_CONDITION=5,sae=Wl.NUMBER_OF_PROPERTIES=6;function gp(e,t){++e._propertiesChanged[t];let n=e._polylineCollection;c(n)&&(n._updatePolyline(e,t),e._dirty=!0)}Object.defineProperties(Wl.prototype,{show:{get:function(){return this._show},set:function(e){if(!c(e))throw new E("value is required.");e!==this._show&&(this._show=e,gp(this,q5e))}},positions:{get:function(){return this._positions},set:function(e){if(!c(e))throw new E("value is required.");let t=Ao(e,h.equalsEpsilon);this._loop&&t.length>2&&(t===e&&(t=e.slice()),t.push(h.clone(t[0]))),(this._actualPositions.length!==t.length||this._actualPositions.length!==this._length)&&gp(this,Ow),this._positions=e,this._actualPositions=t,this._length=t.length,this._boundingVolume=ce.fromPoints(this._actualPositions,this._boundingVolume),this._boundingVolumeWC=ce.transform(this._boundingVolume,this._modelMatrix,this._boundingVolumeWC),gp(this,rae),this.update()}},material:{get:function(){return this._material},set:function(e){if(!c(e))throw new E("material is required.");this._material!==e&&(this._material=e,gp(this,X5e))}},width:{get:function(){return this._width},set:function(e){if(!c(e))throw new E("value is required.");let t=this._width;e!==t&&(this._width=e,gp(this,Y5e))}},loop:{get:function(){return this._loop},set:function(e){if(!c(e))throw new E("value is required.");if(e!==this._loop){let t=this._actualPositions;e?t.length>2&&!h.equals(t[0],t[t.length-1])&&(t.length===this._positions.length&&(this._actualPositions=t=this._positions.slice()),t.push(h.clone(t[0]))):t.length>2&&h.equals(t[0],t[t.length-1])&&(t.length-1===this._positions.length?this._actualPositions=this._positions:t.pop()),this._loop=e,gp(this,Ow)}}},id:{get:function(){return this._id},set:function(e){this._id=e,c(this._pickId)&&(this._pickId.object.id=e)}},pickId:{get:function(){return this._pickId}},isDestroyed:{get:function(){return!c(this._polylineCollection)}},distanceDisplayCondition:{get:function(){return this._distanceDisplayCondition},set:function(e){if(c(e)&&e.far<=e.near)throw new E("far distance must be greater than near distance.");Bt.equals(e,this._distanceDisplayCondition)||(this._distanceDisplayCondition=Bt.clone(e,this._distanceDisplayCondition),gp(this,K5e))}}});Wl.prototype.update=function(){let e=k.IDENTITY;c(this._polylineCollection)&&(e=this._polylineCollection.modelMatrix);let t=this._segments.positions.length,n=this._segments.lengths,i=this._propertiesChanged[rae]>0||this._propertiesChanged[Ow]>0;if((!k.equals(e,this._modelMatrix)||i)&&(this._segments=Bi.wrapLongitude(this._actualPositions,e),this._boundingVolumeWC=ce.transform(this._boundingVolume,e,this._boundingVolumeWC)),this._modelMatrix=k.clone(e,this._modelMatrix),this._segments.positions.length!==t)gp(this,Ow);else{let o=n.length;for(let r=0;r<o;++r)if(n[r]!==this._segments.lengths[r]){gp(this,Ow);break}}};Wl.prototype.getPickId=function(e){return c(this._pickId)||(this._pickId=e.createPickId({primitive:this,collection:this._polylineCollection,id:this._id})),this._pickId};Wl.prototype._clean=function(){this._dirty=!1;let e=this._propertiesChanged;for(let t=0;t<sae-1;++t)e[t]=0};Wl.prototype._destroy=function(){this._pickId=this._pickId&&this._pickId.destroy(),this._material=this._material&&this._material.destroy(),this._polylineCollection=void 0};var Ah=Wl;var $5e=Ah.SHOW_INDEX,Z5e=Ah.WIDTH_INDEX,nG=Ah.POSITION_INDEX,J5e=Ah.MATERIAL_INDEX,aae=Ah.POSITION_SIZE_INDEX,Q5e=Ah.DISTANCE_DISPLAY_CONDITION,mae=Ah.NUMBER_OF_PROPERTIES,ul={texCoordExpandAndBatchIndex:0,position3DHigh:1,position3DLow:2,position2DHigh:3,position2DLow:4,prevPosition3DHigh:5,prevPosition3DLow:6,prevPosition2DHigh:7,prevPosition2DLow:8,nextPosition3DHigh:9,nextPosition3DLow:10,nextPosition2DHigh:11,nextPosition2DLow:12};function sd(e){e=y(e,y.EMPTY_OBJECT),this.show=y(e.show,!0),this.modelMatrix=k.clone(y(e.modelMatrix,k.IDENTITY)),this._modelMatrix=k.clone(k.IDENTITY),this.debugShowBoundingVolume=y(e.debugShowBoundingVolume,!1),this._opaqueRS=void 0,this._translucentRS=void 0,this._colorCommands=[],this._polylinesUpdated=!1,this._polylinesRemoved=!1,this._createVertexArray=!1,this._propertiesChanged=new Uint32Array(mae),this._polylines=[],this._polylineBuckets={},this._positionBufferUsage={bufferUsage:ke.STATIC_DRAW,frameCount:0},this._mode=void 0,this._polylinesToUpdate=[],this._vertexArrays=[],this._positionBuffer=void 0,this._texCoordExpandAndBatchIndexBuffer=void 0,this._batchTable=void 0,this._createBatchTable=!1,this._useHighlightColor=!1,this._highlightColor=j.clone(j.WHITE);let t=this;this._uniformMap={u_highlightColor:function(){return t._highlightColor}}}Object.defineProperties(sd.prototype,{length:{get:function(){return iG(this),this._polylines.length}}});sd.prototype.add=function(e){let t=new Ah(e,this);return t._index=this._polylines.length,this._polylines.push(t),this._createVertexArray=!0,this._createBatchTable=!0,t};sd.prototype.remove=function(e){if(this.contains(e)){if(this._polylinesRemoved=!0,this._createVertexArray=!0,this._createBatchTable=!0,c(e._bucket)){let t=e._bucket;t.shaderProgram=t.shaderProgram&&t.shaderProgram.destroy()}return e._destroy(),!0}return!1};sd.prototype.removeAll=function(){oG(this),bae(this),this._polylineBuckets={},this._polylinesRemoved=!1,this._polylines.length=0,this._polylinesToUpdate.length=0,this._createVertexArray=!0};sd.prototype.contains=function(e){return c(e)&&e._polylineCollection===this};sd.prototype.get=function(e){if(!c(e))throw new E("index is required.");return iG(this),this._polylines[e]};function e6e(e,t){c(e._batchTable)&&e._batchTable.destroy();let n=[{functionName:"batchTable_getWidthAndShow",componentDatatype:$.UNSIGNED_BYTE,componentsPerAttribute:2},{functionName:"batchTable_getPickColor",componentDatatype:$.UNSIGNED_BYTE,componentsPerAttribute:4,normalize:!0},{functionName:"batchTable_getCenterHigh",componentDatatype:$.FLOAT,componentsPerAttribute:3},{functionName:"batchTable_getCenterLowAndRadius",componentDatatype:$.FLOAT,componentsPerAttribute:4},{functionName:"batchTable_getDistanceDisplayCondition",componentDatatype:$.FLOAT,componentsPerAttribute:2}];e._batchTable=new kE(t,n,e._polylines.length)}var pae=new Gn,_ae=new se,gae=new H;sd.prototype.update=function(e){if(iG(this),this._polylines.length===0||!this.show)return;s6e(this,e);let t=e.context,n=e.mapProjection,i,o=this._propertiesChanged;if(this._createBatchTable){if(mt.maximumVertexTextureImageUnits===0)throw new ue("Vertex texture fetch support is required to render polylines. The maximum number of vertex texture image units must be greater than zero.");e6e(this,t),this._createBatchTable=!1}if(this._createVertexArray||n6e(this))uae(this,t,n);else if(this._polylinesUpdated){let l=this._polylinesToUpdate;if(this._mode!==oe.SCENE3D){let u=l.length;for(let f=0;f<u;++f)i=l[f],i.update()}if(o[aae]||o[J5e])uae(this,t,n);else{let u=l.length,f=this._polylineBuckets;for(let d=0;d<u;++d){i=l[d],o=i._propertiesChanged;let p=i._bucket,g=0;for(let m in f)if(f.hasOwnProperty(m)){if(f[m]===p){o[nG]&&p.writeUpdate(g,i,this._positionBuffer,n);break}g+=f[m].lengthOfPositions}if((o[$5e]||o[Z5e])&&this._batchTable.setBatchedAttribute(i._index,0,new H(i._width,i._show)),this._batchTable.attributes.length>2){if(o[nG]||o[aae]){let m=e.mode===oe.SCENE2D?i._boundingVolume2D:i._boundingVolumeWC,b=Gn.fromCartesian(m.center,pae),x=se.fromElements(b.low.x,b.low.y,b.low.z,m.radius,_ae);this._batchTable.setBatchedAttribute(i._index,2,b.high),this._batchTable.setBatchedAttribute(i._index,3,x)}if(o[Q5e]){let m=gae;m.x=0,m.y=Number.MAX_VALUE;let b=i.distanceDisplayCondition;c(b)&&(m.x=b.near,m.y=b.far),this._batchTable.setBatchedAttribute(i._index,4,m)}}i._clean()}}l.length=0,this._polylinesUpdated=!1}o=this._propertiesChanged;for(let l=0;l<mae;++l)o[l]=0;let r=k.IDENTITY;e.mode===oe.SCENE3D&&(r=this.modelMatrix);let s=e.passes,a=e.morphTime!==0;if((!c(this._opaqueRS)||this._opaqueRS.depthTest.enabled!==a)&&(this._opaqueRS=ze.fromCache({depthMask:a,depthTest:{enabled:a}})),(!c(this._translucentRS)||this._translucentRS.depthTest.enabled!==a)&&(this._translucentRS=ze.fromCache({blending:hn.ALPHA_BLEND,depthMask:!a,depthTest:{enabled:a}})),this._batchTable.update(e),s.render||s.pick){let l=this._colorCommands;t6e(this,e,l,r)}};var Rw=new ce,cae=new ce;function t6e(e,t,n,i){let o=t.context,r=t.commandList,s=n.length,a=0,l=!0,u=e._vertexArrays,f=e.debugShowBoundingVolume,p=e._batchTable.getUniformMapCallback(),g=u.length;for(let m=0;m<g;++m){let b=u[m],x=b.buckets,T=x.length;for(let C=0;C<T;++C){let S=x[C],v=S.offset,D=S.bucket.shaderProgram,I=S.bucket.polylines,L=I.length,M,N,B=0,_,w;for(let P=0;P<L;++P){let O=I[P],F=o6e(O._material);if(F!==M){if(c(M)&&B>0){let W=N.isTranslucent();a>=s?(_=new et({owner:e}),n.push(_)):_=n[a],++a,w=At(p(N._uniforms),e._uniformMap),_.boundingVolume=ce.clone(Rw,_.boundingVolume),_.modelMatrix=i,_.shaderProgram=D,_.vertexArray=b.va,_.renderState=W?e._translucentRS:e._opaqueRS,_.pass=W?ve.TRANSLUCENT:ve.OPAQUE,_.debugShowBoundingVolume=f,_.pickId="v_pickColor",_.uniformMap=w,_.count=B,_.offset=v,v+=B,B=0,l=!0,r.push(_)}N=O._material,N.update(o),M=F}let V=O._locatorBuckets,G=V.length;for(let W=0;W<G;++W){let U=V[W];U.locator===S&&(B+=U.count)}let z;t.mode===oe.SCENE3D?z=O._boundingVolumeWC:t.mode===oe.COLUMBUS_VIEW?z=O._boundingVolume2D:t.mode===oe.SCENE2D?c(O._boundingVolume2D)&&(z=ce.clone(O._boundingVolume2D,cae),z.center.x=0):c(O._boundingVolumeWC)&&c(O._boundingVolume2D)&&(z=ce.union(O._boundingVolumeWC,O._boundingVolume2D,cae)),l?(l=!1,ce.clone(z,Rw)):ce.union(z,Rw,Rw)}c(M)&&B>0&&(a>=s?(_=new et({owner:e}),n.push(_)):_=n[a],++a,w=At(p(N._uniforms),e._uniformMap),_.boundingVolume=ce.clone(Rw,_.boundingVolume),_.modelMatrix=i,_.shaderProgram=D,_.vertexArray=b.va,_.renderState=N.isTranslucent()?e._translucentRS:e._opaqueRS,_.pass=N.isTranslucent()?ve.TRANSLUCENT:ve.OPAQUE,_.debugShowBoundingVolume=f,_.pickId="v_pickColor",_.uniformMap=w,_.count=B,_.offset=v,l=!0,r.push(_)),M=void 0}}n.length=a}sd.prototype.isDestroyed=function(){return!1};sd.prototype.destroy=function(){return yae(this),oG(this),bae(this),this._batchTable=this._batchTable&&this._batchTable.destroy(),de(this)};function n6e(e){let t=!1,n=e._propertiesChanged,i=e._positionBufferUsage;return n[nG]?(i.bufferUsage!==ke.STREAM_DRAW&&(t=!0,i.bufferUsage=ke.STREAM_DRAW),i.frameCount=100):i.bufferUsage!==ke.STATIC_DRAW&&(i.frameCount===0?(t=!0,i.bufferUsage=ke.STATIC_DRAW):i.frameCount--),t}var lae=[0,0,0];function uae(e,t,n){e._createVertexArray=!1,oG(e),yae(e),r6e(e);let i=[[]],o=i[0],r=e._batchTable,s=e._useHighlightColor,a=[0],l=0,u=[[]],f=0,d=e._polylineBuckets,p,g;for(p in d)d.hasOwnProperty(p)&&(g=d[p],g.updateShader(t,r,s),f+=g.lengthOfPositions);if(f>0){let m=e._mode,b=new Float32Array(6*f*3),x=new Float32Array(f*4),T,C=0,S=0,v=0;for(p in d)if(d.hasOwnProperty(p)){g=d[p],g.write(b,x,C,S,v,r,t,n),m===oe.MORPHING&&(c(T)||(T=new Float32Array(6*f*3)),g.writeForMorph(T,C));let w=g.lengthOfPositions;C+=6*w*3,S+=w*4,v+=w*4,l=g.updateIndices(i,a,u,l)}let D=e._positionBufferUsage.bufferUsage,I=ke.STATIC_DRAW;e._positionBuffer=xt.createVertexBuffer({context:t,typedArray:b,usage:D});let L;c(T)&&(L=xt.createVertexBuffer({context:t,typedArray:T,usage:D})),e._texCoordExpandAndBatchIndexBuffer=xt.createVertexBuffer({context:t,typedArray:x,usage:I});let M=3*Float32Array.BYTES_PER_ELEMENT,N=4*Float32Array.BYTES_PER_ELEMENT,B=0,_=i.length;for(let w=0;w<_;++w)if(o=i[w],o.length>0){let P=new Uint16Array(o),O=xt.createIndexBuffer({context:t,typedArray:P,usage:ke.STATIC_DRAW,indexDatatype:Fe.UNSIGNED_SHORT});B+=a[w];let F=6*(w*(M*R.SIXTY_FOUR_KILOBYTES)-B*M),V=M+F,G=M+V,z=M+G,W=M+z,U=M+W,q=w*(N*R.SIXTY_FOUR_KILOBYTES)-B*N,K=[{index:ul.position3DHigh,componentsPerAttribute:3,componentDatatype:$.FLOAT,offsetInBytes:F,strideInBytes:6*M},{index:ul.position3DLow,componentsPerAttribute:3,componentDatatype:$.FLOAT,offsetInBytes:V,strideInBytes:6*M},{index:ul.position2DHigh,componentsPerAttribute:3,componentDatatype:$.FLOAT,offsetInBytes:F,strideInBytes:6*M},{index:ul.position2DLow,componentsPerAttribute:3,componentDatatype:$.FLOAT,offsetInBytes:V,strideInBytes:6*M},{index:ul.prevPosition3DHigh,componentsPerAttribute:3,componentDatatype:$.FLOAT,offsetInBytes:G,strideInBytes:6*M},{index:ul.prevPosition3DLow,componentsPerAttribute:3,componentDatatype:$.FLOAT,offsetInBytes:z,strideInBytes:6*M},{index:ul.prevPosition2DHigh,componentsPerAttribute:3,componentDatatype:$.FLOAT,offsetInBytes:G,strideInBytes:6*M},{index:ul.prevPosition2DLow,componentsPerAttribute:3,componentDatatype:$.FLOAT,offsetInBytes:z,strideInBytes:6*M},{index:ul.nextPosition3DHigh,componentsPerAttribute:3,componentDatatype:$.FLOAT,offsetInBytes:W,strideInBytes:6*M},{index:ul.nextPosition3DLow,componentsPerAttribute:3,componentDatatype:$.FLOAT,offsetInBytes:U,strideInBytes:6*M},{index:ul.nextPosition2DHigh,componentsPerAttribute:3,componentDatatype:$.FLOAT,offsetInBytes:W,strideInBytes:6*M},{index:ul.nextPosition2DLow,componentsPerAttribute:3,componentDatatype:$.FLOAT,offsetInBytes:U,strideInBytes:6*M},{index:ul.texCoordExpandAndBatchIndex,componentsPerAttribute:4,componentDatatype:$.FLOAT,vertexBuffer:e._texCoordExpandAndBatchIndexBuffer,offsetInBytes:q}],te,Y,Z,ee;m===oe.SCENE3D?(Y=e._positionBuffer,te="vertexBuffer",Z=lae,ee="value"):m===oe.SCENE2D||m===oe.COLUMBUS_VIEW?(Y=lae,te="value",Z=e._positionBuffer,ee="vertexBuffer"):(Y=L,te="vertexBuffer",Z=e._positionBuffer,ee="vertexBuffer"),K[0][te]=Y,K[1][te]=Y,K[2][ee]=Z,K[3][ee]=Z,K[4][te]=Y,K[5][te]=Y,K[6][ee]=Z,K[7][ee]=Z,K[8][te]=Y,K[9][te]=Y,K[10][ee]=Z,K[11][ee]=Z;let me=new ni({context:t,attributes:K,indexBuffer:O});e._vertexArrays.push({va:me,buckets:u[w]})}}}function i6e(e,t){return t instanceof Lt?t.id:t}var v1=[];function o6e(e){let t=Ki._uniformList[e.type],n=t.length;v1.length=2*n;let i=0;for(let o=0;o<n;++o){let r=t[o];v1[i]=r,v1[i+1]=e._uniforms[r](),i+=2}return`${e.type}:${JSON.stringify(v1,i6e)}`}function r6e(e){let t=e._mode,n=e._modelMatrix,i=e._polylineBuckets={},o=e._polylines,r=o.length;for(let s=0;s<r;++s){let a=o[s];if(a._actualPositions.length>1){a.update();let l=a.material,u=i[l.type];c(u)||(u=i[l.type]=new Ch(l,t,n)),u.addPolyline(a)}}}function s6e(e,t){let n=t.mode;(e._mode!==n||!k.equals(e._modelMatrix,e.modelMatrix))&&(e._mode=n,e._modelMatrix=k.clone(e.modelMatrix),e._createVertexArray=!0)}function iG(e){if(e._polylinesRemoved){e._polylinesRemoved=!1;let t=[],n=[],i=0,o,r=e._polylines.length;for(let s=0;s<r;++s)o=e._polylines[s],o.isDestroyed||(o._index=i++,n.push(o),t.push(o));e._polylines=t,e._polylinesToUpdate=n}}function oG(e){let t=e._polylines,n=t.length;for(let i=0;i<n;++i)if(!t[i].isDestroyed){let o=t[i]._bucket;c(o)&&(o.shaderProgram=o.shaderProgram&&o.shaderProgram.destroy())}}function yae(e){let t=e._vertexArrays.length;for(let n=0;n<t;++n)e._vertexArrays[n].va.destroy();e._vertexArrays.length=0}sd.prototype._updatePolyline=function(e,t){this._polylinesUpdated=!0,e._dirty||this._polylinesToUpdate.push(e),++this._propertiesChanged[t]};function bae(e){let t=e._polylines,n=t.length;for(let i=0;i<n;++i)t[i].isDestroyed||t[i]._destroy()}function tG(e,t,n){this.count=e,this.offset=t,this.bucket=n}function Ch(e,t,n){this.polylines=[],this.lengthOfPositions=0,this.material=e,this.shaderProgram=void 0,this.mode=t,this.modelMatrix=n}Ch.prototype.addPolyline=function(e){this.polylines.push(e),e._actualLength=this.getPolylinePositionsLength(e),this.lengthOfPositions+=e._actualLength,e._bucket=this};Ch.prototype.updateShader=function(e,t,n){if(c(this.shaderProgram))return;let i=["DISTANCE_DISPLAY_CONDITION"];n&&i.push("VECTOR_TILE"),this.material.shaderSource.search(/in\s+float\s+v_polylineAngle;/g)!==-1&&i.push("POLYLINE_DASH"),zt.isInternetExplorer()||i.push("CLIP_POLYLINE");let o=new Ge({defines:i,sources:[`in vec4 v_pickColor;
`,this.material.shaderSource,WE]}),r=t.getVertexShaderCallback()(ZH),s=new Ge({defines:i,sources:[qf,r]});this.shaderProgram=an.fromCache({context:e,vertexShaderSource:s,fragmentShaderSource:o,attributeLocations:ul})};function xae(e){return h.dot(h.UNIT_X,e._boundingVolume.center)<0||e._boundingVolume.intersectPlane(un.ORIGIN_ZX_PLANE)===qt.INTERSECTING}Ch.prototype.getPolylinePositionsLength=function(e){let t;if(this.mode===oe.SCENE3D||!xae(e))return t=e._actualPositions.length,t*4-4;let n=0,i=e._segments.lengths;t=i.length;for(let o=0;o<t;++o)n+=i[o]*4-4;return n};var hs=new h,rf=new h,sf=new h,D1=new h,a6e=new se,c6e=new H;Ch.prototype.write=function(e,t,n,i,o,r,s,a){let l=this.mode,u=a.ellipsoid.maximumRadius*R.PI,f=this.polylines,d=f.length;for(let p=0;p<d;++p){let g=f[p],m=g.width,b=g.show&&m>0,x=g._index,T=this.getSegments(g,a),C=T.positions,S=T.lengths,v=C.length,D=g.getPickId(s).color,I=0,L=0,M;for(let G=0;G<v;++G){G===0?g._loop?M=C[v-2]:(M=D1,h.subtract(C[0],C[1],M),h.add(C[0],M,M)):M=C[G-1],h.clone(M,rf),h.clone(C[G],hs),G===v-1?g._loop?M=C[1]:(M=D1,h.subtract(C[v-1],C[v-2],M),h.add(C[v-1],M,M)):M=C[G+1],h.clone(M,sf);let z=S[I];G===L+z&&(L+=z,++I);let W=G-L===0,U=G===L+S[I]-1;l===oe.SCENE2D&&(rf.z=0,hs.z=0,sf.z=0),(l===oe.SCENE2D||l===oe.MORPHING)&&(W||U)&&u-Math.abs(hs.x)<1&&((hs.x<0&&rf.x>0||hs.x>0&&rf.x<0)&&h.clone(hs,rf),(hs.x<0&&sf.x>0||hs.x>0&&sf.x<0)&&h.clone(hs,sf));let q=W?2:0,K=U?2:4;for(let te=q;te<K;++te){Gn.writeElements(hs,e,n),Gn.writeElements(rf,e,n+6),Gn.writeElements(sf,e,n+12);let Y=te-2<0?-1:1;t[o]=G/(v-1),t[o+1]=2*(te%2)-1,t[o+2]=Y,t[o+3]=x,n+=6*3,o+=4}}let N=a6e;N.x=j.floatToByte(D.red),N.y=j.floatToByte(D.green),N.z=j.floatToByte(D.blue),N.w=j.floatToByte(D.alpha);let B=c6e;B.x=m,B.y=b?1:0;let _=l===oe.SCENE2D?g._boundingVolume2D:g._boundingVolumeWC,w=Gn.fromCartesian(_.center,pae),P=w.high,O=se.fromElements(w.low.x,w.low.y,w.low.z,_.radius,_ae),F=gae;F.x=0,F.y=Number.MAX_VALUE;let V=g.distanceDisplayCondition;c(V)&&(F.x=V.near,F.y=V.far),r.setBatchedAttribute(x,0,B),r.setBatchedAttribute(x,1,N),r.attributes.length>2&&(r.setBatchedAttribute(x,2,P),r.setBatchedAttribute(x,3,O),r.setBatchedAttribute(x,4,F))}};var l6e=new h,u6e=new h,f6e=new h,fae=new h;Ch.prototype.writeForMorph=function(e,t){let n=this.modelMatrix,i=this.polylines,o=i.length;for(let r=0;r<o;++r){let s=i[r],a=s._segments.positions,l=s._segments.lengths,u=a.length,f=0,d=0;for(let p=0;p<u;++p){let g;p===0?s._loop?g=a[u-2]:(g=fae,h.subtract(a[0],a[1],g),h.add(a[0],g,g)):g=a[p-1],g=k.multiplyByPoint(n,g,u6e);let m=k.multiplyByPoint(n,a[p],l6e),b;p===u-1?s._loop?b=a[1]:(b=fae,h.subtract(a[u-1],a[u-2],b),h.add(a[u-1],b,b)):b=a[p+1],b=k.multiplyByPoint(n,b,f6e);let x=l[f];p===d+x&&(d+=x,++f);let T=p-d===0,C=p===d+l[f]-1,S=T?2:0,v=C?2:4;for(let D=S;D<v;++D)Gn.writeElements(m,e,t),Gn.writeElements(g,e,t+6),Gn.writeElements(b,e,t+12),t+=6*3}}};var d6e=new Array(1);Ch.prototype.updateIndices=function(e,t,n,i){let o=n.length-1,r=new tG(0,i,this);n[o].push(r);let s=0,a=e[e.length-1],l=0;a.length>0&&(l=a[a.length-1]+1);let u=this.polylines,f=u.length;for(let d=0;d<f;++d){let p=u[d];p._locatorBuckets=[];let g;if(this.mode===oe.SCENE3D){g=d6e;let b=p._actualPositions.length;if(b>0)g[0]=b;else continue}else g=p._segments.lengths;let m=g.length;if(m>0){let b=0;for(let x=0;x<m;++x){let T=g[x]-1;for(let C=0;C<T;++C)l+4>R.SIXTY_FOUR_KILOBYTES&&(p._locatorBuckets.push({locator:r,count:b}),b=0,t.push(4),a=[],e.push(a),l=0,r.count=s,s=0,i=0,r=new tG(0,0,this),n[++o]=[r]),a.push(l,l+2,l+1),a.push(l+1,l+2,l+3),b+=6,s+=6,i+=6,l+=4}p._locatorBuckets.push({locator:r,count:b}),l+4>R.SIXTY_FOUR_KILOBYTES&&(t.push(0),a=[],e.push(a),l=0,r.count=s,i=0,s=0,r=new tG(0,0,this),n[++o]=[r])}p._clean()}return r.count=s,i};Ch.prototype.getPolylineStartIndex=function(e){let t=this.polylines,n=0,i=t.length;for(let o=0;o<i;++o){let r=t[o];if(r===e)break;n+=r._actualLength}return n};var HT={positions:void 0,lengths:void 0},dae=new Array(1),h6e=new h,m6e=new he;Ch.prototype.getSegments=function(e,t){let n=e._actualPositions;if(this.mode===oe.SCENE3D)return dae[0]=n.length,HT.positions=n,HT.lengths=dae,HT;xae(e)&&(n=e._segments.positions);let i=t.ellipsoid,o=[],r=this.modelMatrix,s=n.length,a,l=h6e;for(let u=0;u<s;++u)a=n[u],l=k.multiplyByPoint(r,a,l),o.push(t.project(i.cartesianToCartographic(l,m6e)));if(o.length>0){e._boundingVolume2D=ce.fromPoints(o,e._boundingVolume2D);let u=e._boundingVolume2D.center;e._boundingVolume2D.center=new h(u.z,u.x,u.y)}return HT.positions=o,HT.lengths=e._segments.lengths,HT};var hae;Ch.prototype.writeUpdate=function(e,t,n,i){let o=this.mode,r=i.ellipsoid.maximumRadius*R.PI,s=t._actualLength;if(s){e+=this.getPolylineStartIndex(t);let a=hae,l=6*s*3;!c(a)||a.length<l?a=hae=new Float32Array(l):a.length>l&&(a=new Float32Array(a.buffer,0,l));let u=this.getSegments(t,i),f=u.positions,d=u.lengths,p=0,g=0,m=0,b;s=f.length;for(let x=0;x<s;++x){x===0?t._loop?b=f[s-2]:(b=D1,h.subtract(f[0],f[1],b),h.add(f[0],b,b)):b=f[x-1],h.clone(b,rf),h.clone(f[x],hs),x===s-1?t._loop?b=f[1]:(b=D1,h.subtract(f[s-1],f[s-2],b),h.add(f[s-1],b,b)):b=f[x+1],h.clone(b,sf);let T=d[g];x===m+T&&(m+=T,++g);let C=x-m===0,S=x===m+d[g]-1;o===oe.SCENE2D&&(rf.z=0,hs.z=0,sf.z=0),(o===oe.SCENE2D||o===oe.MORPHING)&&(C||S)&&r-Math.abs(hs.x)<1&&((hs.x<0&&rf.x>0||hs.x>0&&rf.x<0)&&h.clone(hs,rf),(hs.x<0&&sf.x>0||hs.x>0&&sf.x<0)&&h.clone(hs,sf));let v=C?2:0,D=S?2:4;for(let I=v;I<D;++I)Gn.writeElements(hs,a,p),Gn.writeElements(rf,a,p+6),Gn.writeElements(sf,a,p+12),p+=6*3}n.copyFromArrayView(a,6*3*Float32Array.BYTES_PER_ELEMENT*e)}};var yp=sd;function lg(e){this._positions=e.positions,this._batchTable=e.batchTable,this._batchIds=e.batchIds,this._rectangle=e.rectangle,this._minHeight=e.minimumHeight,this._maxHeight=e.maximumHeight,this._billboardCollection=new rd({batchTable:e.batchTable}),this._labelCollection=new ag({batchTable:e.batchTable}),this._polylineCollection=new yp,this._polylineCollection._useHighlightColor=!0,this._packedBuffer=void 0,this._ready=!1,this._promise=void 0,this._error=void 0}Object.defineProperties(lg.prototype,{ready:{get:function(){return this._ready}},pointsLength:{get:function(){return this._billboardCollection.length}},texturesByteLength:{get:function(){let e=this._billboardCollection.textureAtlas.texture.sizeInBytes,t=this._labelCollection._textureAtlas.texture.sizeInBytes;return e+t}}});function p6e(e,t){let n=e._rectangle,i=e._minHeight,o=e._maxHeight,r=2+ae.packedLength+ie.packedLength,s=new Float64Array(r),a=0;return s[a++]=i,s[a++]=o,ae.pack(n,s,a),a+=ae.packedLength,ie.pack(t,s,a),s}var _6e=new Ti("createVectorTilePoints",5),g6e=new h;function y6e(e,t){let n=e._positions,i=e._packedBuffer;c(i)||(n=e._positions=n.slice(),e._batchIds=e._batchIds.slice(),i=e._packedBuffer=p6e(e,t));let o=[n.buffer,i.buffer],r={positions:n.buffer,packedBuffer:i.buffer},s=_6e.scheduleTask(r,o);if(c(s))return s.then(a=>{if(e.isDestroyed())return;e._positions=new Float64Array(a.positions);let l=e._billboardCollection,u=e._labelCollection,f=e._polylineCollection;n=e._positions;let d=e._batchIds,p=n.length/3;for(let g=0;g<p;++g){let m=d[g],b=h.unpack(n,g*3,g6e),x=l.add();x.position=b,x._batchIndex=m;let T=u.add();T.text=" ",T.position=b,T._batchIndex=m;let C=f.add();C.positions=[h.clone(b),h.clone(b)]}e._positions=void 0,e._packedBuffer=void 0,e._ready=!0}).catch(a=>{e.isDestroyed()||(e._error=a)})}lg.prototype.createFeatures=function(e,t){let n=this._billboardCollection,i=this._labelCollection,o=this._polylineCollection,r=this._batchIds,s=r.length;for(let a=0;a<s;++a){let l=r[a],u=n.get(a),f=i.get(a),d=o.get(a);t[l]=new N0(e,l,u,f,d)}};lg.prototype.applyDebugSettings=function(e,t){e?(j.clone(t,this._billboardCollection._highlightColor),j.clone(t,this._labelCollection._highlightColor),j.clone(t,this._polylineCollection._highlightColor)):(j.clone(j.WHITE,this._billboardCollection._highlightColor),j.clone(j.WHITE,this._labelCollection._highlightColor),j.clone(j.WHITE,this._polylineCollection._highlightColor))};function b6e(e,t){let n=e._batchIds,i=n.length;for(let o=0;o<i;++o){let r=n[o],s=t[r];s.show=!0,s.pointSize=N0.defaultPointSize,s.color=N0.defaultColor,s.pointOutlineColor=N0.defaultPointOutlineColor,s.pointOutlineWidth=N0.defaultPointOutlineWidth,s.labelColor=j.WHITE,s.labelOutlineColor=j.WHITE,s.labelOutlineWidth=1,s.font="30px sans-serif",s.labelStyle=ir.FILL,s.labelText=void 0,s.backgroundColor=new j(.165,.165,.165,.8),s.backgroundPadding=new H(7,5),s.backgroundEnabled=!1,s.scaleByDistance=void 0,s.translucencyByDistance=void 0,s.distanceDisplayCondition=void 0,s.heightOffset=0,s.anchorLineEnabled=!1,s.anchorLineColor=j.WHITE,s.image=void 0,s.disableDepthTestDistance=0,s.horizontalOrigin=bi.CENTER,s.verticalOrigin=Ln.CENTER,s.labelHorizontalOrigin=bi.RIGHT,s.labelVerticalOrigin=Ln.BASELINE}}var x6e=new j,T6e=new j,A6e=new j,C6e=new j,E6e=new j,S6e=new j,Mw=new Vt,Lw=new Vt,rG=new Bt;lg.prototype.applyStyle=function(e,t){if(!c(e)){b6e(this,t);return}let n=this._batchIds,i=n.length;for(let o=0;o<i;++o){let r=n[o],s=t[r];if(c(e.show)&&(s.show=e.show.evaluate(s)),c(e.pointSize)&&(s.pointSize=e.pointSize.evaluate(s)),c(e.color)&&(s.color=e.color.evaluateColor(s,x6e)),c(e.pointOutlineColor)&&(s.pointOutlineColor=e.pointOutlineColor.evaluateColor(s,T6e)),c(e.pointOutlineWidth)&&(s.pointOutlineWidth=e.pointOutlineWidth.evaluate(s)),c(e.labelColor)&&(s.labelColor=e.labelColor.evaluateColor(s,A6e)),c(e.labelOutlineColor)&&(s.labelOutlineColor=e.labelOutlineColor.evaluateColor(s,C6e)),c(e.labelOutlineWidth)&&(s.labelOutlineWidth=e.labelOutlineWidth.evaluate(s)),c(e.font)&&(s.font=e.font.evaluate(s)),c(e.labelStyle)&&(s.labelStyle=e.labelStyle.evaluate(s)),c(e.labelText)?s.labelText=e.labelText.evaluate(s):s.labelText=void 0,c(e.backgroundColor)&&(s.backgroundColor=e.backgroundColor.evaluateColor(s,E6e)),c(e.backgroundPadding)&&(s.backgroundPadding=e.backgroundPadding.evaluate(s)),c(e.backgroundEnabled)&&(s.backgroundEnabled=e.backgroundEnabled.evaluate(s)),c(e.scaleByDistance)){let a=e.scaleByDistance.evaluate(s);c(a)?(Mw.near=a.x,Mw.nearValue=a.y,Mw.far=a.z,Mw.farValue=a.w,s.scaleByDistance=Mw):s.scaleByDistance=void 0}else s.scaleByDistance=void 0;if(c(e.translucencyByDistance)){let a=e.translucencyByDistance.evaluate(s);c(a)?(Lw.near=a.x,Lw.nearValue=a.y,Lw.far=a.z,Lw.farValue=a.w,s.translucencyByDistance=Lw):s.translucencyByDistance=void 0}else s.translucencyByDistance=void 0;if(c(e.distanceDisplayCondition)){let a=e.distanceDisplayCondition.evaluate(s);c(a)?(rG.near=a.x,rG.far=a.y,s.distanceDisplayCondition=rG):s.distanceDisplayCondition=void 0}else s.distanceDisplayCondition=void 0;c(e.heightOffset)&&(s.heightOffset=e.heightOffset.evaluate(s)),c(e.anchorLineEnabled)&&(s.anchorLineEnabled=e.anchorLineEnabled.evaluate(s)),c(e.anchorLineColor)&&(s.anchorLineColor=e.anchorLineColor.evaluateColor(s,S6e)),c(e.image)?s.image=e.image.evaluate(s):s.image=void 0,c(e.disableDepthTestDistance)&&(s.disableDepthTestDistance=e.disableDepthTestDistance.evaluate(s)),c(e.horizontalOrigin)&&(s.horizontalOrigin=e.horizontalOrigin.evaluate(s)),c(e.verticalOrigin)&&(s.verticalOrigin=e.verticalOrigin.evaluate(s)),c(e.labelHorizontalOrigin)&&(s.labelHorizontalOrigin=e.labelHorizontalOrigin.evaluate(s)),c(e.labelVerticalOrigin)&&(s.labelVerticalOrigin=e.labelVerticalOrigin.evaluate(s))}};lg.prototype.update=function(e){if(!this._ready){if(c(this._promise)||(this._promise=y6e(this,e.mapProjection.ellipsoid)),c(this._error)){let t=this._error;throw this._error=void 0,t}return}this._polylineCollection.update(e),this._billboardCollection.update(e),this._labelCollection.update(e)};lg.prototype.isDestroyed=function(){return!1};lg.prototype.destroy=function(){return this._billboardCollection=this._billboardCollection&&this._billboardCollection.destroy(),this._labelCollection=this._labelCollection&&this._labelCollection.destroy(),this._polylineCollection=this._polylineCollection&&this._polylineCollection.destroy(),de(this)};var sG=lg;function bp(e){this._batchTable=e.batchTable,this._batchIds=e.batchIds,this._positions=e.positions,this._counts=e.counts,this._indices=e.indices,this._indexCounts=e.indexCounts,this._indexOffsets=void 0,this._batchTableColors=void 0,this._packedBuffer=void 0,this._batchedPositions=void 0,this._transferrableBatchIds=void 0,this._vertexBatchIds=void 0,this._ellipsoid=y(e.ellipsoid,ie.WGS84),this._minimumHeight=e.minimumHeight,this._maximumHeight=e.maximumHeight,this._polygonMinimumHeights=e.polygonMinimumHeights,this._polygonMaximumHeights=e.polygonMaximumHeights,this._center=y(e.center,h.ZERO),this._rectangle=e.rectangle,this._center=void 0,this._boundingVolume=e.boundingVolume,this._boundingVolumes=void 0,this._batchedIndices=void 0,this._ready=!1,this._promise=void 0,this._error=void 0,this._primitive=void 0,this.debugWireframe=!1,this.forceRebatch=!1,this.classificationType=Vn.BOTH}Object.defineProperties(bp.prototype,{trianglesLength:{get:function(){return c(this._primitive)?this._primitive.trianglesLength:0}},geometryByteLength:{get:function(){return c(this._primitive)?this._primitive.geometryByteLength:0}},ready:{get:function(){return this._ready}}});function w6e(e){let t=new Float64Array(3+h.packedLength+ie.packedLength+ae.packedLength),n=0;return t[n++]=e._indices.BYTES_PER_ELEMENT,t[n++]=e._minimumHeight,t[n++]=e._maximumHeight,h.pack(e._center,t,n),n+=h.packedLength,ie.pack(e._ellipsoid,t,n),n+=ie.packedLength,ae.pack(e._rectangle,t,n),t}function v6e(e,t){let n=1,i=t[n++],o=e._boundingVolumes=new Array(i);for(let a=0;a<i;++a)o[a]=Pn.unpack(t,n),n+=Pn.packedLength;let r=t[n++],s=e._batchedIndices=new Array(r);for(let a=0;a<r;++a){let l=j.unpack(t,n);n+=j.packedLength;let u=t[n++],f=t[n++],d=t[n++],p=new Array(d);for(let g=0;g<d;++g)p[g]=t[n++];s[a]=new O_({color:l,offset:u,count:f,batchIds:p})}}var D6e=new Ti("createVectorTilePolygons",5),P6e=new j;function I6e(e){if(c(e._primitive))return;let t=e._positions,n=e._counts,i=e._indexCounts,o=e._indices,r=e._transferrableBatchIds,s=e._batchTableColors,a=e._packedBuffer;if(!c(s)){t=e._positions=e._positions.slice(),n=e._counts=e._counts.slice(),i=e._indexCounts=e._indexCounts.slice(),o=e._indices=e._indices.slice(),e._center=e._ellipsoid.cartographicToCartesian(ae.center(e._rectangle)),r=e._transferrableBatchIds=new Uint32Array(e._batchIds),s=e._batchTableColors=new Uint32Array(r.length);let g=e._batchTable,m=s.length;for(let b=0;b<m;++b){let x=g.getColor(b,P6e);s[b]=x.toRgba()}a=e._packedBuffer=w6e(e)}let l=[t.buffer,n.buffer,i.buffer,o.buffer,r.buffer,s.buffer,a.buffer],u={packedBuffer:a.buffer,positions:t.buffer,counts:n.buffer,indexCounts:i.buffer,indices:o.buffer,batchIds:r.buffer,batchTableColors:s.buffer},f=e._polygonMinimumHeights,d=e._polygonMaximumHeights;c(f)&&c(d)&&(f=f.slice(),d=d.slice(),l.push(f.buffer,d.buffer),u.minimumHeights=f,u.maximumHeights=d);let p=D6e.scheduleTask(u,l);if(c(p))return p.then(g=>{if(e.isDestroyed())return;e._positions=void 0,e._counts=void 0,e._polygonMinimumHeights=void 0,e._polygonMaximumHeights=void 0;let m=new Float64Array(g.packedBuffer),b=m[0];v6e(e,m),e._indices=Fe.getSizeInBytes(b)===2?new Uint16Array(g.indices):new Uint32Array(g.indices),e._indexOffsets=new Uint32Array(g.indexOffsets),e._indexCounts=new Uint32Array(g.indexCounts),e._batchedPositions=new Float32Array(g.positions),e._vertexBatchIds=new Uint16Array(g.batchIds),O6e(e),e._ready=!0}).catch(g=>{e.isDestroyed()||(e._error=g)})}function O6e(e){c(e._primitive)||(e._primitive=new MS({batchTable:e._batchTable,positions:e._batchedPositions,batchIds:e._batchIds,vertexBatchIds:e._vertexBatchIds,indices:e._indices,indexOffsets:e._indexOffsets,indexCounts:e._indexCounts,batchedIndices:e._batchedIndices,boundingVolume:e._boundingVolume,boundingVolumes:e._boundingVolumes,center:e._center}),e._batchTable=void 0,e._batchIds=void 0,e._positions=void 0,e._counts=void 0,e._indices=void 0,e._indexCounts=void 0,e._indexOffsets=void 0,e._batchTableColors=void 0,e._packedBuffer=void 0,e._batchedPositions=void 0,e._transferrableBatchIds=void 0,e._vertexBatchIds=void 0,e._ellipsoid=void 0,e._minimumHeight=void 0,e._maximumHeight=void 0,e._polygonMinimumHeights=void 0,e._polygonMaximumHeights=void 0,e._center=void 0,e._rectangle=void 0,e._boundingVolume=void 0,e._boundingVolumes=void 0,e._batchedIndices=void 0)}bp.prototype.createFeatures=function(e,t){this._primitive.createFeatures(e,t)};bp.prototype.applyDebugSettings=function(e,t){this._primitive.applyDebugSettings(e,t)};bp.prototype.applyStyle=function(e,t){this._primitive.applyStyle(e,t)};bp.prototype.updateCommands=function(e,t){this._primitive.updateCommands(e,t)};bp.prototype.update=function(e){if(!this._ready){if(c(this._promise)||(this._promise=I6e(this)),c(this._error)){let t=this._error;throw this._error=void 0,t}return}this._primitive.debugWireframe=this.debugWireframe,this._primitive.forceRebatch=this.forceRebatch,this._primitive.classificationType=this.classificationType,this._primitive.update(e)};bp.prototype.isDestroyed=function(){return!1};bp.prototype.destroy=function(){return this._primitive=this._primitive&&this._primitive.destroy(),de(this)};var aG=bp;var cG=`in vec4 currentPosition;
in vec4 previousPosition;
in vec4 nextPosition;
in vec2 expandAndWidth;
in float a_batchId;
uniform mat4 u_modifiedModelView;
void main()
{
float expandDir = expandAndWidth.x;
float width = abs(expandAndWidth.y) + 0.5;
bool usePrev = expandAndWidth.y < 0.0;
vec4 p = u_modifiedModelView * currentPosition;
vec4 prev = u_modifiedModelView * previousPosition;
vec4 next = u_modifiedModelView * nextPosition;
float angle;
vec4 positionWC = getPolylineWindowCoordinatesEC(p, prev, next, expandDir, width, usePrev, angle);
gl_Position = czm_viewportOrthographic * positionWC;
}
`;function ad(e){this._positions=e.positions,this._widths=e.widths,this._counts=e.counts,this._batchIds=e.batchIds,this._ellipsoid=y(e.ellipsoid,ie.WGS84),this._minimumHeight=e.minimumHeight,this._maximumHeight=e.maximumHeight,this._center=e.center,this._rectangle=e.rectangle,this._boundingVolume=e.boundingVolume,this._batchTable=e.batchTable,this._va=void 0,this._sp=void 0,this._rs=void 0,this._uniformMap=void 0,this._command=void 0,this._transferrableBatchIds=void 0,this._packedBuffer=void 0,this._keepDecodedPositions=e.keepDecodedPositions,this._decodedPositions=void 0,this._decodedPositionOffsets=void 0,this._currentPositions=void 0,this._previousPositions=void 0,this._nextPositions=void 0,this._expandAndWidth=void 0,this._vertexBatchIds=void 0,this._indices=void 0,this._constantColor=j.clone(j.WHITE),this._highlightColor=this._constantColor,this._trianglesLength=0,this._geometryByteLength=0,this._ready=!1,this._promise=void 0,this._error=void 0}Object.defineProperties(ad.prototype,{trianglesLength:{get:function(){return this._trianglesLength}},geometryByteLength:{get:function(){return this._geometryByteLength}},ready:{get:function(){return this._ready}}});function R6e(e){let t=e._rectangle,n=e._minimumHeight,i=e._maximumHeight,o=e._ellipsoid,r=e._center,s=2+ae.packedLength+ie.packedLength+h.packedLength,a=new Float64Array(s),l=0;return a[l++]=n,a[l++]=i,ae.pack(t,a,l),l+=ae.packedLength,ie.pack(o,a,l),l+=ie.packedLength,h.pack(r,a,l),a}var M6e=new Ti("createVectorTilePolylines",5),GT={previousPosition:0,currentPosition:1,nextPosition:2,expandAndWidth:3,a_batchId:4};function L6e(e,t){if(c(e._va))return;let n=e._positions,i=e._widths,o=e._counts,r=e._transferrableBatchIds,s=e._packedBuffer;c(s)||(n=e._positions=n.slice(),i=e._widths=i.slice(),o=e._counts=o.slice(),r=e._transferrableBatchIds=e._batchIds.slice(),s=e._packedBuffer=R6e(e));let a=[n.buffer,i.buffer,o.buffer,r.buffer,s.buffer],l={positions:n.buffer,widths:i.buffer,counts:o.buffer,batchIds:r.buffer,packedBuffer:s.buffer,keepDecodedPositions:e._keepDecodedPositions},u=M6e.scheduleTask(l,a);if(c(u))return u.then(function(f){if(e.isDestroyed())return;e._keepDecodedPositions&&(e._decodedPositions=new Float64Array(f.decodedPositions),e._decodedPositionOffsets=new Uint32Array(f.decodedPositionOffsets)),e._currentPositions=new Float32Array(f.currentPositions),e._previousPositions=new Float32Array(f.previousPositions),e._nextPositions=new Float32Array(f.nextPositions),e._expandAndWidth=new Float32Array(f.expandAndWidth),e._vertexBatchIds=new Uint16Array(f.batchIds);let d=f.indexDatatype;e._indices=d===Fe.UNSIGNED_SHORT?new Uint16Array(f.indices):new Uint32Array(f.indices),N6e(e,t),e._ready=!0}).catch(f=>{e.isDestroyed()||(e._error=f)})}function N6e(e,t){if(!c(e._va)){let n=e._currentPositions,i=e._previousPositions,o=e._nextPositions,r=e._expandAndWidth,s=e._vertexBatchIds,a=e._indices,l=i.byteLength+n.byteLength+o.byteLength;l+=r.byteLength+s.byteLength+a.byteLength,e._trianglesLength=a.length/3,e._geometryByteLength=l;let u=xt.createVertexBuffer({context:t,typedArray:i,usage:ke.STATIC_DRAW}),f=xt.createVertexBuffer({context:t,typedArray:n,usage:ke.STATIC_DRAW}),d=xt.createVertexBuffer({context:t,typedArray:o,usage:ke.STATIC_DRAW}),p=xt.createVertexBuffer({context:t,typedArray:r,usage:ke.STATIC_DRAW}),g=xt.createVertexBuffer({context:t,typedArray:s,usage:ke.STATIC_DRAW}),m=xt.createIndexBuffer({context:t,typedArray:a,usage:ke.STATIC_DRAW,indexDatatype:a.BYTES_PER_ELEMENT===2?Fe.UNSIGNED_SHORT:Fe.UNSIGNED_INT}),b=[{index:GT.previousPosition,vertexBuffer:u,componentDatatype:$.FLOAT,componentsPerAttribute:3},{index:GT.currentPosition,vertexBuffer:f,componentDatatype:$.FLOAT,componentsPerAttribute:3},{index:GT.nextPosition,vertexBuffer:d,componentDatatype:$.FLOAT,componentsPerAttribute:3},{index:GT.expandAndWidth,vertexBuffer:p,componentDatatype:$.FLOAT,componentsPerAttribute:2},{index:GT.a_batchId,vertexBuffer:g,componentDatatype:$.UNSIGNED_SHORT,componentsPerAttribute:1}];e._va=new ni({context:t,attributes:b,indexBuffer:m}),e._positions=void 0,e._widths=void 0,e._counts=void 0,e._ellipsoid=void 0,e._minimumHeight=void 0,e._maximumHeight=void 0,e._rectangle=void 0,e._transferrableBatchIds=void 0,e._packedBuffer=void 0,e._currentPositions=void 0,e._previousPositions=void 0,e._nextPositions=void 0,e._expandAndWidth=void 0,e._vertexBatchIds=void 0,e._indices=void 0}}var Nw=new k,Tae=new h;function F6e(e,t){c(e._uniformMap)||(e._uniformMap={u_modifiedModelView:function(){let n=t.uniformState.view;return k.clone(n,Nw),k.multiplyByPoint(Nw,e._center,Tae),k.setTranslation(Nw,Tae,Nw),Nw},u_highlightColor:function(){return e._highlightColor}})}function B6e(e){if(c(e._rs))return;let t={enabled:!0,factor:-5,units:-5};e._rs=ze.fromCache({blending:hn.ALPHA_BLEND,depthMask:!1,depthTest:{enabled:!0},polygonOffset:t})}var k6e=`uniform vec4 u_highlightColor; 
void main()
{
    out_FragColor = u_highlightColor;
}
`;function V6e(e,t){if(c(e._sp))return;let n=e._batchTable,i=n.getVertexShaderCallback(!1,"a_batchId",void 0)(cG),o=n.getFragmentShaderCallback(!1,void 0,!1)(k6e),r=new Ge({defines:["VECTOR_TILE",zt.isInternetExplorer()?"":"CLIP_POLYLINE"],sources:[qf,i]}),s=new Ge({defines:["VECTOR_TILE"],sources:[o]});e._sp=an.fromCache({context:t,vertexShaderSource:r,fragmentShaderSource:s,attributeLocations:GT})}function U6e(e,t){if(!c(e._command)){let n=e._batchTable.getUniformMapCallback()(e._uniformMap);e._command=new et({owner:e,vertexArray:e._va,renderState:e._rs,shaderProgram:e._sp,uniformMap:n,boundingVolume:e._boundingVolume,pass:ve.TRANSLUCENT,pickId:e._batchTable.getPickId()})}t.commandList.push(e._command)}ad.getPolylinePositions=function(e,t){let n=e._batchIds,i=e._decodedPositions,o=e._decodedPositionOffsets;if(!c(n)||!c(i))return;let r,s,a=n.length,l=0,u=0;for(r=0;r<a;++r)n[r]===t&&(l+=o[r+1]-o[r]);if(l===0)return;let f=new Float64Array(l*3);for(r=0;r<a;++r)if(n[r]===t){let d=o[r],p=o[r+1]-d;for(s=0;s<p;++s){let g=(d+s)*3;f[u++]=i[g],f[u++]=i[g+1],f[u++]=i[g+2]}}return f};ad.prototype.getPositions=function(e){return ad.getPolylinePositions(this,e)};ad.prototype.createFeatures=function(e,t){let n=this._batchIds,i=n.length;for(let o=0;o<i;++o){let r=n[o];t[r]=new Ws(e,r)}};ad.prototype.applyDebugSettings=function(e,t){this._highlightColor=e?t:this._constantColor};function z6e(e,t){let n=e._batchIds,i=n.length;for(let o=0;o<i;++o){let r=n[o],s=t[r];s.show=!0,s.color=j.WHITE}}var H6e=new j,G6e=j.WHITE,j6e=!0;ad.prototype.applyStyle=function(e,t){if(!c(e)){z6e(this,t);return}let n=this._batchIds,i=n.length;for(let o=0;o<i;++o){let r=n[o],s=t[r];s.color=c(e.color)?e.color.evaluateColor(s,H6e):G6e,s.show=c(e.show)?e.show.evaluate(s):j6e}};ad.prototype.update=function(e){let t=e.context;if(!this._ready){if(c(this._promise)||(this._promise=L6e(this,t)),c(this._error)){let i=this._error;throw this._error=void 0,i}return}F6e(this,t),V6e(this,t),B6e(this);let n=e.passes;(n.render||n.pick)&&U6e(this,e)};ad.prototype.isDestroyed=function(){return!1};ad.prototype.destroy=function(){return this._va=this._va&&this._va.destroy(),this._sp=this._sp&&this._sp.destroy(),de(this)};var Fw=ad;var lG=`in vec3 startEllipsoidNormal;
in vec3 endEllipsoidNormal;
in vec4 startPositionAndHeight;
in vec4 endPositionAndHeight;
in vec4 startFaceNormalAndVertexCorner;
in vec4 endFaceNormalAndHalfWidth;
in float a_batchId;
uniform mat4 u_modifiedModelView;
uniform vec2 u_minimumMaximumVectorHeights;
out vec4 v_startPlaneEC;
out vec4 v_endPlaneEC;
out vec4 v_rightPlaneEC;
out float v_halfWidth;
out vec3 v_volumeUpEC;
void main()
{
float isEnd = floor(startFaceNormalAndVertexCorner.w * 0.251);
float isTop = floor(startFaceNormalAndVertexCorner.w * mix(0.51, 0.19, isEnd));
vec3 forward = endPositionAndHeight.xyz - startPositionAndHeight.xyz;
vec3 right = normalize(cross(forward, startEllipsoidNormal));
vec4 position = vec4(startPositionAndHeight.xyz, 1.0);
position.xyz += forward * isEnd;
v_volumeUpEC = czm_normal * normalize(cross(right, forward));
float offset;
vec3 ellipsoidNormal = mix(startEllipsoidNormal, endEllipsoidNormal, isEnd);
offset = mix(startPositionAndHeight.w, endPositionAndHeight.w, isEnd);
offset = mix(u_minimumMaximumVectorHeights.y, u_minimumMaximumVectorHeights.x, isTop) - offset;
position.xyz += offset * ellipsoidNormal;
position = u_modifiedModelView * position;
right = czm_normal * right;
vec3 scratchNormal = mix(-startFaceNormalAndVertexCorner.xyz, endFaceNormalAndHalfWidth.xyz, isEnd);
scratchNormal = cross(scratchNormal, mix(startEllipsoidNormal, endEllipsoidNormal, isEnd));
vec3 miterPushNormal = czm_normal * normalize(scratchNormal);
offset = 2.0 * endFaceNormalAndHalfWidth.w * max(0.0, czm_metersPerPixel(position));
offset = offset / dot(miterPushNormal, right);
position.xyz += miterPushNormal * (offset * sign(0.5 - mod(startFaceNormalAndVertexCorner.w, 2.0)));
gl_Position = czm_depthClamp(czm_projection * position);
position = u_modifiedModelView * vec4(startPositionAndHeight.xyz, 1.0);
vec3 startNormalEC = czm_normal * startFaceNormalAndVertexCorner.xyz;
v_startPlaneEC = vec4(startNormalEC, -dot(startNormalEC, position.xyz));
v_rightPlaneEC = vec4(right, -dot(right, position.xyz));
position = u_modifiedModelView * vec4(endPositionAndHeight.xyz, 1.0);
vec3 endNormalEC = czm_normal * endFaceNormalAndHalfWidth.xyz;
v_endPlaneEC = vec4(endNormalEC, -dot(endNormalEC, position.xyz));
v_halfWidth = endFaceNormalAndHalfWidth.w;
}
`;var uG=`in vec4 v_startPlaneEC;
in vec4 v_endPlaneEC;
in vec4 v_rightPlaneEC;
in float v_halfWidth;
in vec3 v_volumeUpEC;
uniform vec4 u_highlightColor;
void main()
{
float logDepthOrDepth = czm_branchFreeTernary(czm_sceneMode == czm_sceneMode2D, gl_FragCoord.z, czm_unpackDepth(texture(czm_globeDepthTexture, gl_FragCoord.xy / czm_viewport.zw)));
if (logDepthOrDepth == 0.0) {
#ifdef DEBUG_SHOW_VOLUME
out_FragColor = vec4(0.0, 0.0, 1.0, 0.5);
return;
#else // DEBUG_SHOW_VOLUME
discard;
#endif // DEBUG_SHOW_VOLUME
}
vec4 eyeCoordinate = czm_windowToEyeCoordinates(gl_FragCoord.xy, logDepthOrDepth);
eyeCoordinate /= eyeCoordinate.w;
float halfMaxWidth = v_halfWidth * czm_metersPerPixel(eyeCoordinate);
halfMaxWidth += halfMaxWidth * (1.0 - dot(-normalize(eyeCoordinate.xyz), v_volumeUpEC));
float widthwiseDistance = czm_planeDistance(v_rightPlaneEC, eyeCoordinate.xyz);
float distanceFromStart = czm_planeDistance(v_startPlaneEC, eyeCoordinate.xyz);
float distanceFromEnd = czm_planeDistance(v_endPlaneEC, eyeCoordinate.xyz);
if (abs(widthwiseDistance) > halfMaxWidth || distanceFromStart < 0.0 || distanceFromEnd < 0.0) {
#ifdef DEBUG_SHOW_VOLUME
out_FragColor = vec4(logDepthOrDepth, 0.0, 0.0, 0.5);
return;
#else // DEBUG_SHOW_VOLUME
discard;
#endif // DEBUG_SHOW_VOLUME
}
out_FragColor = u_highlightColor;
czm_writeDepthClamp();
}
`;function xp(e){this._positions=e.positions,this._widths=e.widths,this._counts=e.counts,this._batchIds=e.batchIds,this._ellipsoid=y(e.ellipsoid,ie.WGS84),this._minimumHeight=e.minimumHeight,this._maximumHeight=e.maximumHeight,this._center=e.center,this._rectangle=e.rectangle,this._batchTable=e.batchTable,this._va=void 0,this._sp=void 0,this._rs=void 0,this._uniformMap=void 0,this._command=void 0,this._transferrableBatchIds=void 0,this._packedBuffer=void 0,this._minimumMaximumVectorHeights=new H(di._defaultMinTerrainHeight,di._defaultMaxTerrainHeight),this._boundingVolume=Pn.fromRectangle(e.rectangle,di._defaultMinTerrainHeight,di._defaultMaxTerrainHeight,this._ellipsoid),this._classificationType=e.classificationType,this._keepDecodedPositions=e.keepDecodedPositions,this._decodedPositions=void 0,this._decodedPositionOffsets=void 0,this._startEllipsoidNormals=void 0,this._endEllipsoidNormals=void 0,this._startPositionAndHeights=void 0,this._startFaceNormalAndVertexCornerIds=void 0,this._endPositionAndHeights=void 0,this._endFaceNormalAndHalfWidths=void 0,this._vertexBatchIds=void 0,this._indices=void 0,this._constantColor=j.clone(j.WHITE),this._highlightColor=this._constantColor,this._trianglesLength=0,this._geometryByteLength=0,this._ready=!1,this._promise=void 0,this._error=void 0}Object.defineProperties(xp.prototype,{trianglesLength:{get:function(){return this._trianglesLength}},geometryByteLength:{get:function(){return this._geometryByteLength}},ready:{get:function(){return this._ready}}});function W6e(e,t,n){let i=di.getMinimumMaximumHeights(t,n),o=i.minimumTerrainHeight,r=i.maximumTerrainHeight,s=e._minimumMaximumVectorHeights;s.x=o,s.y=r;let a=e._boundingVolume,l=e._rectangle;Pn.fromRectangle(l,o,r,n,a)}function q6e(e){let t=e._rectangle,n=e._minimumHeight,i=e._maximumHeight,o=e._ellipsoid,r=e._center,s=2+ae.packedLength+ie.packedLength+h.packedLength,a=new Float64Array(s),l=0;return a[l++]=n,a[l++]=i,ae.pack(t,a,l),l+=ae.packedLength,ie.pack(o,a,l),l+=ie.packedLength,h.pack(r,a,l),a}var Y6e=new Ti("createVectorTileClampedPolylines"),ug={startEllipsoidNormal:0,endEllipsoidNormal:1,startPositionAndHeight:2,endPositionAndHeight:3,startFaceNormalAndVertexCorner:4,endFaceNormalAndHalfWidth:5,a_batchId:6};function X6e(e,t){if(c(e._va))return;let n=e._positions,i=e._widths,o=e._counts,r=e._transferrableBatchIds,s=e._packedBuffer;c(s)||(n=e._positions=n.slice(),i=e._widths=i.slice(),o=e._counts=o.slice(),r=e._transferrableBatchIds=e._batchIds.slice(),s=e._packedBuffer=q6e(e));let a=[n.buffer,i.buffer,o.buffer,r.buffer,s.buffer],l={positions:n.buffer,widths:i.buffer,counts:o.buffer,batchIds:r.buffer,packedBuffer:s.buffer,keepDecodedPositions:e._keepDecodedPositions},u=Y6e.scheduleTask(l,a);if(c(u))return u.then(function(f){if(e.isDestroyed())return;e._keepDecodedPositions&&(e._decodedPositions=new Float64Array(f.decodedPositions),e._decodedPositionOffsets=new Uint32Array(f.decodedPositionOffsets)),e._startEllipsoidNormals=new Float32Array(f.startEllipsoidNormals),e._endEllipsoidNormals=new Float32Array(f.endEllipsoidNormals),e._startPositionAndHeights=new Float32Array(f.startPositionAndHeights),e._startFaceNormalAndVertexCornerIds=new Float32Array(f.startFaceNormalAndVertexCornerIds),e._endPositionAndHeights=new Float32Array(f.endPositionAndHeights),e._endFaceNormalAndHalfWidths=new Float32Array(f.endFaceNormalAndHalfWidths),e._vertexBatchIds=new Uint16Array(f.vertexBatchIds);let d=f.indexDatatype;e._indices=d===Fe.UNSIGNED_SHORT?new Uint16Array(f.indices):new Uint32Array(f.indices),K6e(e,t),e._ready=!0}).catch(f=>{e.isDestroyed()||(e._error=f)})}function K6e(e,t){if(!c(e._va)){let n=e._startEllipsoidNormals,i=e._endEllipsoidNormals,o=e._startPositionAndHeights,r=e._endPositionAndHeights,s=e._startFaceNormalAndVertexCornerIds,a=e._endFaceNormalAndHalfWidths,l=e._vertexBatchIds,u=e._indices,f=n.byteLength+i.byteLength;f+=o.byteLength+r.byteLength,f+=s.byteLength+a.byteLength,f+=l.byteLength+u.byteLength,e._trianglesLength=u.length/3,e._geometryByteLength=f;let d=xt.createVertexBuffer({context:t,typedArray:n,usage:ke.STATIC_DRAW}),p=xt.createVertexBuffer({context:t,typedArray:i,usage:ke.STATIC_DRAW}),g=xt.createVertexBuffer({context:t,typedArray:o,usage:ke.STATIC_DRAW}),m=xt.createVertexBuffer({context:t,typedArray:r,usage:ke.STATIC_DRAW}),b=xt.createVertexBuffer({context:t,typedArray:s,usage:ke.STATIC_DRAW}),x=xt.createVertexBuffer({context:t,typedArray:a,usage:ke.STATIC_DRAW}),T=xt.createVertexBuffer({context:t,typedArray:l,usage:ke.STATIC_DRAW}),C=xt.createIndexBuffer({context:t,typedArray:u,usage:ke.STATIC_DRAW,indexDatatype:u.BYTES_PER_ELEMENT===2?Fe.UNSIGNED_SHORT:Fe.UNSIGNED_INT}),S=[{index:ug.startEllipsoidNormal,vertexBuffer:d,componentDatatype:$.FLOAT,componentsPerAttribute:3},{index:ug.endEllipsoidNormal,vertexBuffer:p,componentDatatype:$.FLOAT,componentsPerAttribute:3},{index:ug.startPositionAndHeight,vertexBuffer:g,componentDatatype:$.FLOAT,componentsPerAttribute:4},{index:ug.endPositionAndHeight,vertexBuffer:m,componentDatatype:$.FLOAT,componentsPerAttribute:4},{index:ug.startFaceNormalAndVertexCorner,vertexBuffer:b,componentDatatype:$.FLOAT,componentsPerAttribute:4},{index:ug.endFaceNormalAndHalfWidth,vertexBuffer:x,componentDatatype:$.FLOAT,componentsPerAttribute:4},{index:ug.a_batchId,vertexBuffer:T,componentDatatype:$.UNSIGNED_SHORT,componentsPerAttribute:1}];e._va=new ni({context:t,attributes:S,indexBuffer:C}),e._positions=void 0,e._widths=void 0,e._counts=void 0,e._ellipsoid=void 0,e._minimumHeight=void 0,e._maximumHeight=void 0,e._rectangle=void 0,e._transferrableBatchIds=void 0,e._packedBuffer=void 0,e._startEllipsoidNormals=void 0,e._endEllipsoidNormals=void 0,e._startPositionAndHeights=void 0,e._startFaceNormalAndVertexCornerIds=void 0,e._endPositionAndHeights=void 0,e._endFaceNormalAndHalfWidths=void 0,e._vertexBatchIds=void 0,e._indices=void 0}}var Bw=new k,Aae=new h;function $6e(e,t){c(e._uniformMap)||(e._uniformMap={u_modifiedModelView:function(){let n=t.uniformState.view;return k.clone(n,Bw),k.multiplyByPoint(Bw,e._center,Aae),k.setTranslation(Bw,Aae,Bw),Bw},u_highlightColor:function(){return e._highlightColor},u_minimumMaximumVectorHeights:function(){return e._minimumMaximumVectorHeights}})}function Cae(e){return ze.fromCache({cull:{enabled:!0,face:xi.FRONT},blending:hn.PRE_MULTIPLIED_ALPHA_BLEND,depthMask:!1,stencilTest:{enabled:e,frontFunction:Un.EQUAL,frontOperation:{fail:ft.KEEP,zFail:ft.KEEP,zPass:ft.KEEP},backFunction:Un.EQUAL,backOperation:{fail:ft.KEEP,zFail:ft.KEEP,zPass:ft.KEEP},reference:Ut.CESIUM_3D_TILE_MASK,mask:Ut.CESIUM_3D_TILE_MASK}})}function Z6e(e){c(e._rs)||(e._rs=Cae(!1),e._rs3DTiles=Cae(!0))}function J6e(e,t){if(c(e._sp))return;let n=e._batchTable,i=n.getVertexShaderCallback(!1,"a_batchId",void 0)(lG),o=n.getFragmentShaderCallback(!1,void 0,!0)(uG),r=new Ge({defines:["VECTOR_TILE",zt.isInternetExplorer()?"":"CLIP_POLYLINE"],sources:[qf,i]}),s=new Ge({defines:["VECTOR_TILE"],sources:[o]});e._sp=an.fromCache({context:t,vertexShaderSource:r,fragmentShaderSource:s,attributeLocations:ug})}function Q6e(e,t){let n=e._command;if(!c(e._command)){let o=e._batchTable.getUniformMapCallback()(e._uniformMap);n=e._command=new et({owner:e,vertexArray:e._va,renderState:e._rs,shaderProgram:e._sp,uniformMap:o,boundingVolume:e._boundingVolume,pass:ve.TERRAIN_CLASSIFICATION,pickId:e._batchTable.getPickId()});let r=et.shallowClone(n,n.derivedCommands.tileset);r.renderState=e._rs3DTiles,r.pass=ve.CESIUM_3D_TILE_CLASSIFICATION,n.derivedCommands.tileset=r}let i=e._classificationType;(i===Vn.TERRAIN||i===Vn.BOTH)&&t.commandList.push(n),(i===Vn.CESIUM_3D_TILE||i===Vn.BOTH)&&t.commandList.push(n.derivedCommands.tileset)}xp.prototype.getPositions=function(e){return Fw.getPolylinePositions(this,e)};xp.prototype.createFeatures=function(e,t){let n=this._batchIds,i=n.length;for(let o=0;o<i;++o){let r=n[o];t[r]=new Ws(e,r)}};xp.prototype.applyDebugSettings=function(e,t){this._highlightColor=e?t:this._constantColor};function eje(e,t){let n=e._batchIds,i=n.length;for(let o=0;o<i;++o){let r=n[o],s=t[r];s.show=!0,s.color=j.WHITE}}var tje=new j,nje=j.WHITE,ije=!0;xp.prototype.applyStyle=function(e,t){if(!c(e)){eje(this,t);return}let n=this._batchIds,i=n.length;for(let o=0;o<i;++o){let r=n[o],s=t[r];s.color=c(e.color)?e.color.evaluateColor(s,tje):nje,s.show=c(e.show)?e.show.evaluate(s):ije}};function oje(e){return di.initialize().then(function(){W6e(e,e._rectangle,e._ellipsoid)}).catch(t=>{e.isDestroyed()||(e._error=t)})}xp.prototype.update=function(e){let t=e.context;if(!this._ready){if(c(this._promise)||(this._promise=oje(this).then(X6e(this,t))),c(this._error)){let i=this._error;throw this._error=void 0,i}return}$6e(this,t),J6e(this,t),Z6e(this);let n=e.passes;(n.render||n.pick)&&Q6e(this,e)};xp.prototype.isDestroyed=function(){return!1};xp.prototype.destroy=function(){return this._va=this._va&&this._va.destroy(),this._sp=this._sp&&this._sp.destroy(),de(this)};var fG=xp;var dG=32767,rje=new he,sje=new h;function aje(e,t,n,i,o){let r=e.length/3,s=e.subarray(0,r),a=e.subarray(r,2*r),l=e.subarray(2*r,3*r);Nn.zigZagDeltaDecode(s,a,l);let u=new Float64Array(e.length);for(let f=0;f<r;++f){let d=s[f],p=a[f],g=l[f],m=R.lerp(t.west,t.east,d/dG),b=R.lerp(t.south,t.north,p/dG),x=R.lerp(n,i,g/dG),T=he.fromRadians(m,b,x,rje),C=o.cartographicToCartesian(T,sje);h.pack(C,u,f*3)}return u}var hG=aje;function ld(e,t,n,i,o){this._tileset=e,this._tile=t,this._resource=n,this._polygons=void 0,this._polylines=void 0,this._points=void 0,this._metadata=void 0,this._batchTable=void 0,this._features=void 0,this.featurePropertiesDirty=!1,this._group=void 0,this._ready=!1,dje(this,i,o)}Object.defineProperties(ld.prototype,{featuresLength:{get:function(){return c(this._batchTable)?this._batchTable.featuresLength:0}},pointsLength:{get:function(){return c(this._points)?this._points.pointsLength:0}},trianglesLength:{get:function(){let e=0;return c(this._polygons)&&(e+=this._polygons.trianglesLength),c(this._polylines)&&(e+=this._polylines.trianglesLength),e}},geometryByteLength:{get:function(){let e=0;return c(this._polygons)&&(e+=this._polygons.geometryByteLength),c(this._polylines)&&(e+=this._polylines.geometryByteLength),e}},texturesByteLength:{get:function(){return c(this._points)?this._points.texturesByteLength:0}},batchTableByteLength:{get:function(){return c(this._batchTable)?this._batchTable.batchTableByteLength:0}},innerContents:{get:function(){}},ready:{get:function(){return this._ready}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){return this._resource.getUrlComponent(!0)}},metadata:{get:function(){return this._metadata},set:function(e){this._metadata=e}},batchTable:{get:function(){return this._batchTable}},group:{get:function(){return this._group},set:function(e){this._group=e}}});function cje(e){return function(t,n){c(e._polygons)&&e._polygons.updateCommands(t,n)}}function lje(e,t){let n,i,o,r,s=y(e.POLYGONS_LENGTH,0),a=y(e.POLYLINES_LENGTH,0),l=y(e.POINTS_LENGTH,0);if(s>0&&c(e.POLYGON_BATCH_IDS)){let p=t.byteOffset+e.POLYGON_BATCH_IDS.byteOffset;n=new Uint16Array(t.buffer,p,s)}if(a>0&&c(e.POLYLINE_BATCH_IDS)){let p=t.byteOffset+e.POLYLINE_BATCH_IDS.byteOffset;i=new Uint16Array(t.buffer,p,a)}if(l>0&&c(e.POINT_BATCH_IDS)){let p=t.byteOffset+e.POINT_BATCH_IDS.byteOffset;o=new Uint16Array(t.buffer,p,l)}let u=c(n)||c(i)||c(o),f=s>0&&!c(n)||a>0&&!c(i)||l>0&&!c(o);if(u&&f)throw new ue("If one group of batch ids is defined, then all batch ids must be defined");if(!c(n)&&!c(i)&&!c(o)){let p=0;if(!c(n)&&s>0)for(n=new Uint16Array(s),r=0;r<s;++r)n[r]=p++;if(!c(i)&&a>0)for(i=new Uint16Array(a),r=0;r<a;++r)i[r]=p++;if(!c(o)&&l>0)for(o=new Uint16Array(l),r=0;r<l;++r)o[r]=p++}return{polygons:n,polylines:i,points:o}}var cd=Uint32Array.BYTES_PER_ELEMENT;function uje(e){return new Fw(e)}function fje(e){return new fG(e)}function dje(e,t,n){n=y(n,0);let i=new Uint8Array(t),o=new DataView(t);n+=cd;let r=o.getUint32(n,!0);if(r!==1)throw new ue(`Only Vector tile version 1 is supported.  Version ${r} is not.`);n+=cd;let s=o.getUint32(n,!0);if(n+=cd,s===0){e._ready=!0;return}let a=o.getUint32(n,!0);if(n+=cd,a===0)throw new ue("Feature table must have a byte length greater than zero");let l=o.getUint32(n,!0);n+=cd;let u=o.getUint32(n,!0);n+=cd;let f=o.getUint32(n,!0);n+=cd;let d=o.getUint32(n,!0);n+=cd;let p=o.getUint32(n,!0);n+=cd;let g=o.getUint32(n,!0);n+=cd;let m=o.getUint32(n,!0);n+=cd;let b=Ho(i,n,a);n+=a;let x=new Uint8Array(t,n,l);n+=l;let T,C;u>0&&(T=Ho(i,n,u),n+=u,f>0&&(C=new Uint8Array(t,n,f),C=new Uint8Array(C),n+=f));let S=y(b.POLYGONS_LENGTH,0),v=y(b.POLYLINES_LENGTH,0),D=y(b.POINTS_LENGTH,0),I=S+v+D,L=new r0(e,I,T,C,cje(e));if(e._batchTable=L,I===0)return;let M=new ap(b,x),N=M.getGlobalProperty("REGION");if(!c(N))throw new ue("Feature table global property: REGION must be defined");let B=ae.unpack(N),_=N[4],w=N[5],P=e._tile.computedTransform,O=M.getGlobalProperty("RTC_CENTER",$.FLOAT,3);c(O)?(O=h.unpack(O),k.multiplyByPoint(P,O,O)):(O=ae.center(B),O.height=R.lerp(_,w,.5),O=ie.WGS84.cartographicToCartesian(O));let F=lje(b,x);if(n+=(4-n%4)%4,S>0){M.featuresLength=S;let V=y(M.getPropertyArray("POLYGON_COUNTS",$.UNSIGNED_INT,1),M.getPropertyArray("POLYGON_COUNT",$.UNSIGNED_INT,1));if(!c(V))throw new ue("Feature table property: POLYGON_COUNTS must be defined when POLYGONS_LENGTH is greater than 0");let G=y(M.getPropertyArray("POLYGON_INDEX_COUNTS",$.UNSIGNED_INT,1),M.getPropertyArray("POLYGON_INDEX_COUNT",$.UNSIGNED_INT,1));if(!c(G))throw new ue("Feature table property: POLYGON_INDEX_COUNTS must be defined when POLYGONS_LENGTH is greater than 0");let z=V.reduce(function(Y,Z){return Y+Z*2},0),W=G.reduce(function(Y,Z){return Y+Z},0),U=new Uint32Array(t,n,W);n+=d;let q=new Uint16Array(t,n,z);n+=p;let K,te;c(b.POLYGON_MINIMUM_HEIGHTS)&&c(b.POLYGON_MAXIMUM_HEIGHTS)&&(K=M.getPropertyArray("POLYGON_MINIMUM_HEIGHTS",$.FLOAT,1),te=M.getPropertyArray("POLYGON_MAXIMUM_HEIGHTS",$.FLOAT,1)),e._polygons=new aG({positions:q,counts:V,indexCounts:G,indices:U,minimumHeight:_,maximumHeight:w,polygonMinimumHeights:K,polygonMaximumHeights:te,center:O,rectangle:B,boundingVolume:e.tile.boundingVolume.boundingVolume,batchTable:L,batchIds:F.polygons,modelMatrix:P})}if(v>0){M.featuresLength=v;let V=y(M.getPropertyArray("POLYLINE_COUNTS",$.UNSIGNED_INT,1),M.getPropertyArray("POLYLINE_COUNT",$.UNSIGNED_INT,1));if(!c(V))throw new ue("Feature table property: POLYLINE_COUNTS must be defined when POLYLINES_LENGTH is greater than 0");let G=M.getPropertyArray("POLYLINE_WIDTHS",$.UNSIGNED_SHORT,1);if(!c(G)){G=new Uint16Array(v);for(let te=0;te<v;++te)G[te]=2}let z=V.reduce(function(te,Y){return te+Y*3},0),W=new Uint16Array(t,n,z);n+=g;let U=e._tileset,q=U.examineVectorLinesFunction;if(c(q)){let te=hG(new Uint16Array(W),B,_,w,ie.WGS84);hje(te,V,F.polylines,L,e.url,q)}let K=uje;c(U.classificationType)&&(K=fje),e._polylines=K({positions:W,widths:G,counts:V,batchIds:F.polylines,minimumHeight:_,maximumHeight:w,center:O,rectangle:B,boundingVolume:e.tile.boundingVolume.boundingVolume,batchTable:L,classificationType:U.classificationType,keepDecodedPositions:U.vectorKeepDecodedPositions})}if(D>0){let V=new Uint16Array(t,n,D*3);n+=m,e._points=new sG({positions:V,batchIds:F.points,minimumHeight:_,maximumHeight:w,rectangle:B,batchTable:L})}}function mG(e){let t=e.featuresLength;if(!c(e._features)&&t>0){let n=new Array(t);c(e._polygons)&&e._polygons.createFeatures(e,n),c(e._polylines)&&e._polylines.createFeatures(e,n),c(e._points)&&e._points.createFeatures(e,n),e._features=n}}ld.prototype.hasProperty=function(e,t){return this._batchTable.hasProperty(e,t)};ld.prototype.getFeature=function(e){let t=this.featuresLength;if(!c(e)||e<0||e>=t)throw new E(`batchId is required and between zero and featuresLength - 1 (${t-1}).`);return c(this._features)||mG(this),this._features[e]};ld.prototype.applyDebugSettings=function(e,t){c(this._polygons)&&this._polygons.applyDebugSettings(e,t),c(this._polylines)&&this._polylines.applyDebugSettings(e,t),c(this._points)&&this._points.applyDebugSettings(e,t)};ld.prototype.applyStyle=function(e){c(this._features)||mG(this),c(this._polygons)&&this._polygons.applyStyle(e,this._features),c(this._polylines)&&this._polylines.applyStyle(e,this._features),c(this._points)&&this._points.applyStyle(e,this._features)};ld.prototype.update=function(e,t){let n=!0;c(this._polygons)&&(this._polygons.classificationType=this._tileset.classificationType,this._polygons.debugWireframe=this._tileset.debugWireframe,this._polygons.update(t),n=n&&this._polygons.ready),c(this._polylines)&&(this._polylines.update(t),n=n&&this._polylines.ready),c(this._points)&&(this._points.update(t),n=n&&this._points.ready),c(this._batchTable)&&n&&(c(this._features)||mG(this),this._batchTable.update(e,t),this._ready=!0)};ld.prototype.pick=function(e,t,n){};ld.prototype.getPolylinePositions=function(e){let t=this._polylines;if(c(t))return t.getPositions(e)};ld.prototype.isDestroyed=function(){return!1};ld.prototype.destroy=function(){return this._polygons=this._polygons&&this._polygons.destroy(),this._polylines=this._polylines&&this._polylines.destroy(),this._points=this._points&&this._points.destroy(),this._batchTable=this._batchTable&&this._batchTable.destroy(),de(this)};function hje(e,t,n,i,o,r){let s=t.length,a=0;for(let l=0;l<s;l++){let u=t[l]*3,f=e.slice(a,a+u);a+=u,r(f,n[l],o,i)}}var pG=ld;var Eae={b3dm:function(e,t,n,i,o){return rg.fromB3dm(e,t,n,i,o)},pnts:function(e,t,n,i,o){return rg.fromPnts(e,t,n,i,o)},i3dm:function(e,t,n,i,o){return rg.fromI3dm(e,t,n,i,o)},cmpt:function(e,t,n,i,o){return HU.fromTileType(e,t,n,i,o,Eae)},externalTileset:function(e,t,n,i){return BH.fromJson(e,t,n,i)},geom:function(e,t,n,i,o){return new JU(e,t,n,i,o)},vctr:function(e,t,n,i,o){return new pG(e,t,n,i,o)},subt:function(e,t,n,i,o){return HO.fromSubtreeJson(e,t,n,void 0,i,o)},subtreeJson:function(e,t,n,i){return HO.fromSubtreeJson(e,t,n,i)},glb:function(e,t,n,i,o){if(i.byteLength<12)throw new ue("Invalid glb content");let a=new DataView(i,o).getUint32(8,!0),l=new Uint8Array(i,o,a);return rg.fromGltf(e,t,n,l)},gltf:function(e,t,n,i){return rg.fromGltf(e,t,n,i)},geoJson:function(e,t,n,i){return rg.fromGeoJson(e,t,n,i)}},kw=Eae;var mje={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5},rr=Object.freeze(mje);var ud={BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",COMPOSITE:"cmpt",POINT_CLOUD:"pnts",VECTOR:"vctr",GEOMETRY:"geom",GLTF:"gltf",GLTF_BINARY:"glb",IMPLICIT_SUBTREE:"subt",IMPLICIT_SUBTREE_JSON:"subtreeJson",EXTERNAL_TILESET:"externalTileset",MULTIPLE_CONTENT:"multipleContent",GEOJSON:"geoJson",VOXEL_BINARY:"voxl",VOXEL_JSON:"voxelJson"};ud.isBinaryFormat=function(e){switch(e){case ud.BATCHED_3D_MODEL:case ud.INSTANCED_3D_MODEL:case ud.COMPOSITE:case ud.POINT_CLOUD:case ud.VECTOR:case ud.GEOMETRY:case ud.IMPLICIT_SUBTREE:case ud.VOXEL_BINARY:case ud.GLTF_BINARY:return!0;default:return!1}};var Zs=Object.freeze(ud);var pje={NOT_COMPUTED:-1,USE_OPTIMIZATION:1,SKIP_OPTIMIZATION:0},Eh=Object.freeze(pje);var Fs={RENDER:0,PICK:1,SHADOW:2,PRELOAD:3,PRELOAD_FLIGHT:4,REQUEST_RENDER_MODE_DEFER_CHECK:5,MOST_DETAILED_PRELOAD:6,MOST_DETAILED_PICK:7,NUMBER_OF_PASSES:8},Tp=new Array(Fs.NUMBER_OF_PASSES);Tp[Fs.RENDER]=Object.freeze({pass:Fs.RENDER,isRender:!0,requestTiles:!0,ignoreCommands:!1});Tp[Fs.PICK]=Object.freeze({pass:Fs.PICK,isRender:!1,requestTiles:!1,ignoreCommands:!1});Tp[Fs.SHADOW]=Object.freeze({pass:Fs.SHADOW,isRender:!1,requestTiles:!0,ignoreCommands:!1});Tp[Fs.PRELOAD]=Object.freeze({pass:Fs.PRELOAD,isRender:!1,requestTiles:!0,ignoreCommands:!0});Tp[Fs.PRELOAD_FLIGHT]=Object.freeze({pass:Fs.PRELOAD_FLIGHT,isRender:!1,requestTiles:!0,ignoreCommands:!0});Tp[Fs.REQUEST_RENDER_MODE_DEFER_CHECK]=Object.freeze({pass:Fs.REQUEST_RENDER_MODE_DEFER_CHECK,isRender:!1,requestTiles:!0,ignoreCommands:!0});Tp[Fs.MOST_DETAILED_PRELOAD]=Object.freeze({pass:Fs.MOST_DETAILED_PRELOAD,isRender:!1,requestTiles:!0,ignoreCommands:!0});Tp[Fs.MOST_DETAILED_PICK]=Object.freeze({pass:Fs.MOST_DETAILED_PICK,isRender:!1,requestTiles:!1,ignoreCommands:!1});Fs.getPassOptions=function(e){return Tp[e]};var Ro=Object.freeze(Fs);function Sh(e,t){this._tileset=e,this._tile=t,this.featurePropertiesDirty=!1}Object.defineProperties(Sh.prototype,{featuresLength:{get:function(){return 0}},pointsLength:{get:function(){return 0}},trianglesLength:{get:function(){return 0}},geometryByteLength:{get:function(){return 0}},texturesByteLength:{get:function(){return 0}},batchTableByteLength:{get:function(){return 0}},innerContents:{get:function(){}},ready:{get:function(){return!0}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){}},metadata:{get:function(){},set:function(e){throw new E("Empty3DTileContent cannot have content metadata")}},batchTable:{get:function(){}},group:{get:function(){},set:function(e){throw new E("Empty3DTileContent cannot have group metadata")}}});Sh.prototype.hasProperty=function(e,t){return!1};Sh.prototype.getFeature=function(e){};Sh.prototype.applyDebugSettings=function(e,t){};Sh.prototype.applyStyle=function(e){};Sh.prototype.update=function(e,t){};Sh.prototype.pick=function(e,t,n){};Sh.prototype.isDestroyed=function(){return!1};Sh.prototype.destroy=function(){return de(this)};var P1=Sh;function Ap(e){e=y(e,y.EMPTY_OBJECT);let t=e.content,n=e.class;A.typeOf.object("options.content",t),A.typeOf.object("options.class",n),this._class=n,this._properties=t.properties,this._extensions=t.extensions,this._extras=t.extras}Object.defineProperties(Ap.prototype,{class:{get:function(){return this._class}},extras:{get:function(){return this._extras}},extensions:{get:function(){return this._extensions}}});Ap.prototype.hasProperty=function(e){return Bn.hasProperty(e,this._properties,this._class)};Ap.prototype.hasPropertyBySemantic=function(e){return Bn.hasPropertyBySemantic(e,this._properties,this._class)};Ap.prototype.getPropertyIds=function(e){return Bn.getPropertyIds(this._properties,this._class,e)};Ap.prototype.getProperty=function(e){return Bn.getProperty(e,this._properties,this._class)};Ap.prototype.setProperty=function(e,t){return Bn.setProperty(e,t,this._properties,this._class)};Ap.prototype.getPropertyBySemantic=function(e){return Bn.getPropertyBySemantic(e,this._properties,this._class)};Ap.prototype.setPropertyBySemantic=function(e,t){return Bn.setPropertyBySemantic(e,t,this._properties,this._class)};var _G=Ap;function gG(e,t){let n=si(t,"3DTILES_metadata")?t.extensions["3DTILES_metadata"]:t.metadata;if(!c(n))return;if(!c(e.schema)){gG._oneTimeWarning("findContentMetadata-missing-root-schema","Could not find a metadata schema for content metadata. For tilesets that contain external tilesets, make sure the schema is added to the root tileset.json.");return}let i=y(e.schema.classes,y.EMPTY_OBJECT);if(c(n.class)){let o=i[n.class];return new _G({content:n,class:o})}}gG._oneTimeWarning=_t;var Vw=gG;function _je(e,t){let n=e.metadataExtension;if(!c(n))return;let i=n.groups,o=si(t,"3DTILES_metadata")?t.extensions["3DTILES_metadata"].group:t.group;if(typeof o=="number")return i[o];let r=n.groupIds.findIndex(function(s){return s===o});return r>=0?i[r]:void 0}var Uw=_je;function Cp(e){e=y(e,y.EMPTY_OBJECT);let t=e.tile,n=e.class;A.typeOf.object("options.tile",t),A.typeOf.object("options.class",n),this._class=n,this._properties=t.properties,this._extensions=t.extensions,this._extras=t.extras}Object.defineProperties(Cp.prototype,{class:{get:function(){return this._class}},extras:{get:function(){return this._extras}},extensions:{get:function(){return this._extensions}}});Cp.prototype.hasProperty=function(e){return Bn.hasProperty(e,this._properties,this._class)};Cp.prototype.hasPropertyBySemantic=function(e){return Bn.hasPropertyBySemantic(e,this._properties,this._class)};Cp.prototype.getPropertyIds=function(e){return Bn.getPropertyIds(this._properties,this._class,e)};Cp.prototype.getProperty=function(e){return Bn.getProperty(e,this._properties,this._class)};Cp.prototype.setProperty=function(e,t){return Bn.setProperty(e,t,this._properties,this._class)};Cp.prototype.getPropertyBySemantic=function(e){return Bn.getPropertyBySemantic(e,this._properties,this._class)};Cp.prototype.setPropertyBySemantic=function(e,t){return Bn.setPropertyBySemantic(e,t,this._properties,this._class)};var yG=Cp;function bG(e,t){let n=si(t,"3DTILES_metadata")?t.extensions["3DTILES_metadata"]:t.metadata;if(!c(n))return;if(!c(e.schema)){bG._oneTimeWarning("findTileMetadata-missing-root-schema","Could not find a metadata schema for tile metadata. For tilesets that contain external tilesets, make sure the schema is added to the root tileset.json.");return}let i=y(e.schema.classes,y.EMPTY_OBJECT);if(c(n.class)){let o=i[n.class];return new yG({tile:n,class:o})}}bG._oneTimeWarning=_t;var xG=bG;function gje(e){let t=new Uint8Array(e),n=qm(t);if(n==="glTF"&&(n="glb"),Zs.isBinaryFormat(n))return{contentType:n,binaryPayload:t};let i=yje(t);if(c(i.root))return{contentType:Zs.EXTERNAL_TILESET,jsonPayload:i};if(c(i.asset))return{contentType:Zs.GLTF,jsonPayload:i};if(c(i.tileAvailability))return{contentType:Zs.IMPLICIT_SUBTREE_JSON,jsonPayload:i};if(c(i.type))return{contentType:Zs.GEOJSON,jsonPayload:i};if(c(i.voxelTable))return{contentType:Zs.VOXEL_JSON,jsonPayload:i};throw new ue("Invalid tile content.")}function yje(e){let t;try{t=Ho(e)}catch{throw new ue("Invalid tile content.")}return t}var fg=gje;function af(e,t,n,i){this._tileset=e,this._tile=t,this._tilesetResource=n,this._contents=[],this._contentsCreated=!1;let o=c(i.contents)?i.contents:i.content;this._innerContentHeaders=o,this._requestsInFlight=0,this._cancelCount=0;let r=this._innerContentHeaders.length;this._arrayFetchPromises=new Array(r),this._requests=new Array(r),this._ready=!1,this._innerContentResources=new Array(r),this._serverKeys=new Array(r);for(let s=0;s<r;s++){let a=n.getDerivedResource({url:o[s].uri}),l=qc.getServerKey(a.getUrlComponent());this._innerContentResources[s]=a,this._serverKeys[s]=l}}Object.defineProperties(af.prototype,{featurePropertiesDirty:{get:function(){let e=this._contents,t=e.length;for(let n=0;n<t;++n)if(e[n].featurePropertiesDirty)return!0;return!1},set:function(e){let t=this._contents,n=t.length;for(let i=0;i<n;++i)t[i].featurePropertiesDirty=e}},featuresLength:{get:function(){return 0}},pointsLength:{get:function(){return 0}},trianglesLength:{get:function(){return 0}},geometryByteLength:{get:function(){return 0}},texturesByteLength:{get:function(){return 0}},batchTableByteLength:{get:function(){return 0}},innerContents:{get:function(){return this._contents}},ready:{get:function(){return this._contentsCreated?this._ready:!1}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){}},metadata:{get:function(){},set:function(){throw new E("Multiple3DTileContent cannot have metadata")}},batchTable:{get:function(){}},group:{get:function(){},set:function(){throw new E("Multiple3DTileContent cannot have group metadata")}},innerContentUrls:{get:function(){return this._innerContentHeaders.map(function(e){return e.uri})}}});function TG(e,t){e._requestsInFlight+=t,e.tileset.statistics.numberOfPendingRequests+=t}function Sae(e,t){e._cancelCount++,e._tile._contentState=t;let n=e.tileset.statistics;n.numberOfPendingRequests-=e._requestsInFlight,n.numberOfAttemptedRequests+=e._requestsInFlight,e._requestsInFlight=0;let i=e._innerContentHeaders.length;e._arrayFetchPromises=new Array(i)}af.prototype.requestInnerContents=function(){if(!bje(this._serverKeys)){this.tileset.statistics.numberOfAttemptedRequests+=this._serverKeys.length;return}let e=this._innerContentHeaders;TG(this,e.length);let t=this._cancelCount;for(let n=0;n<e.length;n++)this._arrayFetchPromises[n]=xje(this,n,t,this._tile._contentState);return Tje(this)};function bje(e){let t={};for(let n=0;n<e.length;n++){let i=e[n];c(t[i])?t[i]++:t[i]=1}for(let n in t)if(t.hasOwnProperty(n)&&!qc.serverHasOpenSlots(n,t[n]))return!1;return qc.heapHasOpenSlots(e.length)}function xje(e,t,n,i){let o=e._innerContentResources[t].clone(),r=e.tile,s=function(){return r._priority},a=e._serverKeys[t],l=new ur({throttle:!0,throttleByServer:!0,type:Es.TILES3D,priorityFunction:s,serverKey:a});o.request=l,e._requests[t]=l;let u=o.fetchArrayBuffer();if(c(u))return u.then(function(f){if(!(n<e._cancelCount)){if(o.request.cancelled||o.request.state===Jn.CANCELLED){Sae(e,i);return}return TG(e,-1),f}}).catch(function(f){if(!(n<e._cancelCount)){if(o.request.cancelled||o.request.state===Jn.CANCELLED){Sae(e,i);return}TG(e,-1),wae(e,t,f)}})}async function Tje(e){let t=e._cancelCount,n=await Promise.all(e._arrayFetchPromises);if(t<e._cancelCount)return;let i=n.map((r,s)=>Aje(e,r,s)),o=await Promise.all(i);return e._contentsCreated=!0,e._contents=o.filter(c),o}async function Aje(e,t,n){if(c(t))try{let i=fg(t);if(i.contentType===Zs.EXTERNAL_TILESET)throw new ue("External tilesets are disallowed inside multiple contents");e._disableSkipLevelOfDetail=e._disableSkipLevelOfDetail||i.contentType===Zs.GEOMETRY||i.contentType===Zs.VECTOR;let o=e._tileset,r=e._innerContentResources[n],s=e._tile,a,l=kw[i.contentType];c(i.binaryPayload)?a=await Promise.resolve(l(o,s,r,i.binaryPayload.buffer,0)):a=await Promise.resolve(l(o,s,r,i.jsonPayload));let u=e._innerContentHeaders[n];if(s.hasImplicitContentMetadata){let d=s.implicitSubtree,p=s.implicitCoordinates;a.metadata=d.getContentMetadataView(p,n)}else s.hasImplicitContent||(a.metadata=Vw(o,u));let f=Uw(o,u);return c(f)&&(a.group=new vS({metadata:f})),a}catch(i){wae(e,n,i)}}function wae(e,t,n){let i=e._tileset,o=e._innerContentResources[t].url,r=c(n.message)?n.message:n.toString();i.tileFailed.numberOfListeners>0?i.tileFailed.raiseEvent({url:o,message:r}):(console.log(`A content failed to load: ${o}`),console.log(`Error: ${r}`))}af.prototype.cancelRequests=function(){for(let e=0;e<this._requests.length;e++){let t=this._requests[e];c(t)&&t.cancel()}};af.prototype.hasProperty=function(e,t){return!1};af.prototype.getFeature=function(e){};af.prototype.applyDebugSettings=function(e,t){let n=this._contents,i=n.length;for(let o=0;o<i;++o)n[o].applyDebugSettings(e,t)};af.prototype.applyStyle=function(e){let t=this._contents,n=t.length;for(let i=0;i<n;++i)t[i].applyStyle(e)};af.prototype.update=function(e,t){let n=this._contents,i=n.length,o=!0;for(let r=0;r<i;++r)n[r].update(e,t),o=o&&n[r].ready;!this._ready&&o&&(this._ready=!0)};af.prototype.pick=function(e,t,n){if(!this._ready)return;let i,o=Number.POSITIVE_INFINITY,r=this._contents,s=r.length;for(let a=0;a<s;++a){let l=r[a].pick(e,t,n);if(!c(l))continue;let u=h.distance(e.origin,l);u<o&&(i=l,o=u)}if(c(i))return n};af.prototype.isDestroyed=function(){return!1};af.prototype.destroy=function(){let e=this._contents,t=e.length;for(let n=0;n<t;++n)e[n].destroy();return de(this)};var AG=af;var vae=Math.cos,Dae=Math.sin,Cje=Math.sqrt,CG={};CG.computePosition=function(e,t,n,i,o,r,s){let a=t.radiiSquared,l=e.nwCorner,u=e.boundingRectangle,f=l.latitude-e.granYCos*i+o*e.granXSin,d=vae(f),p=Dae(f),g=a.z*p,m=l.longitude+i*e.granYSin+o*e.granXCos,b=d*vae(m),x=d*Dae(m),T=a.x*b,C=a.y*x,S=Cje(T*b+C*x+g*p);if(r.x=T/S,r.y=C/S,r.z=g/S,n){let v=e.stNwCorner;c(v)?(f=v.latitude-e.stGranYCos*i+o*e.stGranXSin,m=v.longitude+i*e.stGranYSin+o*e.stGranXCos,s.x=(m-e.stWest)*e.lonScalar,s.y=(f-e.stSouth)*e.latScalar):(s.x=(m-u.west)*e.lonScalar,s.y=(f-u.south)*e.latScalar)}};var Eje=new Gi,cf=new h,Sje=new he,I1=new h,zw=new Mi;function Pae(e,t,n,i,o,r,s){let a=Math.cos(t),l=i*a,u=n*a,f=Math.sin(t),d=i*f,p=n*f;zw._ellipsoid=ie.default,cf=zw.project(e,cf),cf=h.subtract(cf,I1,cf);let g=Gi.fromRotation(t,Eje);cf=Gi.multiplyByVector(g,cf,cf),cf=h.add(cf,I1,cf),e=zw.unproject(cf,e),r-=1,s-=1;let m=e.latitude,b=m+r*p,x=m-l*s,T=m-l*s+r*p,C=Math.max(m,b,x,T),S=Math.min(m,b,x,T),v=e.longitude,D=v+r*u,I=v+s*d,L=v+s*d+r*u,M=Math.max(v,D,I,L),N=Math.min(v,D,I,L);return{north:C,south:S,east:M,west:N,granYCos:l,granYSin:d,granXCos:u,granXSin:p,nwCorner:e}}CG.computeOptions=function(e,t,n,i,o,r,s){let a=e.east,l=e.west,u=e.north,f=e.south,d=!1,p=!1;u===R.PI_OVER_TWO&&(d=!0),f===-R.PI_OVER_TWO&&(p=!0);let g,m=u-f;l>a?g=R.TWO_PI-l+a:g=a-l;let b=Math.ceil(g/t)+1,x=Math.ceil(m/t)+1,T=g/(b-1),C=m/(x-1),S=ae.northwest(e,r),v=ae.center(e,Sje);(n!==0||i!==0)&&(v.longitude<S.longitude&&(v.longitude+=R.TWO_PI),zw._ellipsoid=ie.default,I1=zw.project(v,I1));let D=C,I=T,L=0,M=0,N=ae.clone(e,o),B={granYCos:D,granYSin:L,granXCos:I,granXSin:M,nwCorner:S,boundingRectangle:N,width:b,height:x,northCap:d,southCap:p};if(n!==0){let _=Pae(S,n,T,C,v,b,x);if(u=_.north,f=_.south,a=_.east,l=_.west,u<-R.PI_OVER_TWO||u>R.PI_OVER_TWO||f<-R.PI_OVER_TWO||f>R.PI_OVER_TWO)throw new E("Rotated rectangle is invalid.  It crosses over either the north or south pole.");B.granYCos=_.granYCos,B.granYSin=_.granYSin,B.granXCos=_.granXCos,B.granXSin=_.granXSin,N.north=u,N.south=f,N.east=a,N.west=l}if(i!==0){n=n-i;let _=ae.northwest(N,s),w=Pae(_,n,T,C,v,b,x);B.stGranYCos=w.granYCos,B.stGranXCos=w.granXCos,B.stGranYSin=w.granYSin,B.stGranXSin=w.granXSin,B.stNwCorner=_,B.stWest=w.west,B.stSouth=w.south}return B};var Js=CG;var wje=new ce,vje=new ce,Dje=new h,Pje=new ae;function Iae(e,t){let n=e._ellipsoid,i=t.height,o=t.width,r=t.northCap,s=t.southCap,a=i,l=2,u=0,f=4;r&&(l-=1,a-=1,u+=1,f-=2),s&&(l-=1,a-=1,u+=1,f-=2),u+=l*o+2*a-f;let d=new Float64Array(u*3),p=0,g=0,m,b=Dje;if(r)Js.computePosition(t,n,!1,g,0,b),d[p++]=b.x,d[p++]=b.y,d[p++]=b.z;else for(m=0;m<o;m++)Js.computePosition(t,n,!1,g,m,b),d[p++]=b.x,d[p++]=b.y,d[p++]=b.z;for(m=o-1,g=1;g<i;g++)Js.computePosition(t,n,!1,g,m,b),d[p++]=b.x,d[p++]=b.y,d[p++]=b.z;if(g=i-1,!s)for(m=o-2;m>=0;m--)Js.computePosition(t,n,!1,g,m,b),d[p++]=b.x,d[p++]=b.y,d[p++]=b.z;for(m=0,g=i-2;g>0;g--)Js.computePosition(t,n,!1,g,m,b),d[p++]=b.x,d[p++]=b.y,d[p++]=b.z;let x=d.length/3*2,T=Fe.createTypedArray(d.length/3,x),C=0;for(let v=0;v<d.length/3-1;v++)T[C++]=v,T[C++]=v+1;T[C++]=d.length/3-1,T[C++]=0;let S=new ut({attributes:new pn,primitiveType:Me.LINES});return S.attributes.position=new we({componentDatatype:$.DOUBLE,componentsPerAttribute:3,values:d}),S.indices=T,S}function Ije(e,t){let n=e._surfaceHeight,i=e._extrudedHeight,o=e._ellipsoid,r=Iae(e,t),s=t.height,a=t.width,l=ai.scaleToGeodeticHeight(r.attributes.position.values,n,o,!1),u=l.length,f=new Float64Array(u*2);f.set(l);let d=ai.scaleToGeodeticHeight(r.attributes.position.values,i,o);f.set(d,u),r.attributes.position.values=f;let p=t.northCap,g=t.southCap,m=4;p&&(m-=1),g&&(m-=1);let b=(f.length/3+m)*2,x=Fe.createTypedArray(f.length/3,b);u=f.length/6;let T=0;for(let S=0;S<u-1;S++)x[T++]=S,x[T++]=S+1,x[T++]=S+u,x[T++]=S+u+1;x[T++]=u-1,x[T++]=0,x[T++]=u+u-1,x[T++]=u,x[T++]=0,x[T++]=u;let C;if(p)C=s-1;else{let S=a-1;x[T++]=S,x[T++]=S+u,C=a+s-2}if(x[T++]=C,x[T++]=C+u,!g){let S=a+C-1;x[T++]=S,x[T]=S+u}return r.indices=x,r}function WT(e){e=y(e,y.EMPTY_OBJECT);let t=e.rectangle,n=y(e.granularity,R.RADIANS_PER_DEGREE),i=y(e.ellipsoid,ie.default),o=y(e.rotation,0);if(!c(t))throw new E("rectangle is required.");if(ae._validate(t),t.north<t.south)throw new E("options.rectangle.north must be greater than options.rectangle.south");let r=y(e.height,0),s=y(e.extrudedHeight,r);this._rectangle=ae.clone(t),this._granularity=n,this._ellipsoid=i,this._surfaceHeight=Math.max(r,s),this._rotation=o,this._extrudedHeight=Math.min(r,s),this._offsetAttribute=e.offsetAttribute,this._workerName="createRectangleOutlineGeometry"}WT.packedLength=ae.packedLength+ie.packedLength+5;WT.pack=function(e,t,n){if(!c(e))throw new E("value is required");if(!c(t))throw new E("array is required");return n=y(n,0),ae.pack(e._rectangle,t,n),n+=ae.packedLength,ie.pack(e._ellipsoid,t,n),n+=ie.packedLength,t[n++]=e._granularity,t[n++]=e._surfaceHeight,t[n++]=e._rotation,t[n++]=e._extrudedHeight,t[n]=y(e._offsetAttribute,-1),t};var Oae=new ae,Rae=ie.clone(ie.UNIT_SPHERE),jT={rectangle:Oae,ellipsoid:Rae,granularity:void 0,height:void 0,rotation:void 0,extrudedHeight:void 0,offsetAttribute:void 0};WT.unpack=function(e,t,n){if(!c(e))throw new E("array is required");t=y(t,0);let i=ae.unpack(e,t,Oae);t+=ae.packedLength;let o=ie.unpack(e,t,Rae);t+=ie.packedLength;let r=e[t++],s=e[t++],a=e[t++],l=e[t++],u=e[t];return c(n)?(n._rectangle=ae.clone(i,n._rectangle),n._ellipsoid=ie.clone(o,n._ellipsoid),n._surfaceHeight=s,n._rotation=a,n._extrudedHeight=l,n._offsetAttribute=u===-1?void 0:u,n):(jT.granularity=r,jT.height=s,jT.rotation=a,jT.extrudedHeight=l,jT.offsetAttribute=u===-1?void 0:u,new WT(jT))};var Oje=new he;WT.createGeometry=function(e){let t=e._rectangle,n=e._ellipsoid,i=Js.computeOptions(t,e._granularity,e._rotation,0,Pje,Oje),o,r;if(R.equalsEpsilon(t.north,t.south,R.EPSILON10)||R.equalsEpsilon(t.east,t.west,R.EPSILON10))return;let s=e._surfaceHeight,a=e._extrudedHeight,l=!R.equalsEpsilon(s,a,0,R.EPSILON2),u;if(l){if(o=Ije(e,i),c(e._offsetAttribute)){let p=o.attributes.position.values.length/3,g=new Uint8Array(p);e._offsetAttribute===Jt.TOP?g=g.fill(1,0,p/2):(u=e._offsetAttribute===Jt.NONE?0:1,g=g.fill(u)),o.attributes.applyOffset=new we({componentDatatype:$.UNSIGNED_BYTE,componentsPerAttribute:1,values:g})}let f=ce.fromRectangle3D(t,n,s,vje),d=ce.fromRectangle3D(t,n,a,wje);r=ce.union(f,d)}else{if(o=Iae(e,i),o.attributes.position.values=ai.scaleToGeodeticHeight(o.attributes.position.values,s,n,!1),c(e._offsetAttribute)){let f=o.attributes.position.values.length;u=e._offsetAttribute===Jt.NONE?0:1;let d=new Uint8Array(f/3).fill(u);o.attributes.applyOffset=new we({componentDatatype:$.UNSIGNED_BYTE,componentsPerAttribute:1,values:d})}r=ce.fromRectangle3D(t,n,s)}return new ut({attributes:o.attributes,indices:o.indices,primitiveType:Me.LINES,boundingSphere:r,offsetAttribute:e._offsetAttribute})};var Hw=WT;function YT(e){A.typeOf.object("options",e),A.typeOf.object("options.rectangle",e.rectangle),this.rectangle=ae.clone(e.rectangle),this.minimumHeight=y(e.minimumHeight,0),this.maximumHeight=y(e.maximumHeight,0),this.southwestCornerCartesian=new h,this.northeastCornerCartesian=new h,this.westNormal=new h,this.southNormal=new h,this.eastNormal=new h,this.northNormal=new h;let t=y(e.ellipsoid,ie.WGS84);Fje(this,e.rectangle,t),this._orientedBoundingBox=void 0,this._boundingSphere=void 0,y(e.computeBoundingVolumes,!0)&&this.computeBoundingVolumes(t)}Object.defineProperties(YT.prototype,{boundingVolume:{get:function(){return this._orientedBoundingBox}},boundingSphere:{get:function(){return this._boundingSphere}}});YT.prototype.computeBoundingVolumes=function(e){this._orientedBoundingBox=Pn.fromRectangle(this.rectangle,this.minimumHeight,this.maximumHeight,e),this._boundingSphere=ce.fromOrientedBoundingBox(this._orientedBoundingBox)};var Mae=new h,O1=new h,Lae=new h,Rje=new h,Mje=new h,Lje=new h,Nje=new h,lf=new he,Nae=new un(h.UNIT_X,0),qT=new _n;function Fje(e,t,n){n.cartographicToCartesian(ae.southwest(t),e.southwestCornerCartesian),n.cartographicToCartesian(ae.northeast(t),e.northeastCornerCartesian),lf.longitude=t.west,lf.latitude=(t.south+t.north)*.5,lf.height=0;let i=n.cartographicToCartesian(lf,Lje),o=h.cross(i,h.UNIT_Z,Rje);h.normalize(o,e.westNormal),lf.longitude=t.east;let r=n.cartographicToCartesian(lf,Nje),s=h.cross(h.UNIT_Z,r,Mae);h.normalize(s,e.eastNormal);let a=h.subtract(i,r,Mae);h.magnitude(a)===0&&(a=h.clone(o,a));let l=h.normalize(a,Mje),u=t.south,f;if(u>0){lf.longitude=(t.west+t.east)*.5,lf.latitude=u;let b=n.cartographicToCartesian(lf,qT.origin);h.clone(l,qT.direction);let x=un.fromPointNormal(e.southwestCornerCartesian,e.westNormal,Nae);Qn.rayPlane(qT,x,e.southwestCornerCartesian),f=n.geodeticSurfaceNormal(b,O1)}else f=n.geodeticSurfaceNormalCartographic(ae.southeast(t),O1);let d=h.cross(f,a,Lae);h.normalize(d,e.southNormal);let p=t.north,g;if(p<0){lf.longitude=(t.west+t.east)*.5,lf.latitude=p;let b=n.cartographicToCartesian(lf,qT.origin);h.negate(l,qT.direction);let x=un.fromPointNormal(e.northeastCornerCartesian,e.eastNormal,Nae);Qn.rayPlane(qT,x,e.northeastCornerCartesian),g=n.geodeticSurfaceNormal(b,O1)}else g=n.geodeticSurfaceNormalCartographic(ae.northwest(t),O1);let m=h.cross(a,g,Lae);h.normalize(m,e.northNormal)}var Bje=new h,kje=new h,Vje=new h(0,-1,0),Uje=new h(0,0,-1),Fae=new h;function zje(e,t){let n=t.camera,i=n.positionWC,o=n.positionCartographic,r=0;if(!ae.contains(e.rectangle,o)){let u=e.southwestCornerCartesian,f=e.northeastCornerCartesian,d=e.westNormal,p=e.southNormal,g=e.eastNormal,m=e.northNormal;t.mode!==oe.SCENE3D&&(u=t.mapProjection.project(ae.southwest(e.rectangle),Bje),u.z=u.y,u.y=u.x,u.x=0,f=t.mapProjection.project(ae.northeast(e.rectangle),kje),f.z=f.y,f.y=f.x,f.x=0,d=Vje,g=h.UNIT_Y,p=Uje,m=h.UNIT_Z);let b=h.subtract(i,u,Fae),x=h.dot(b,d),T=h.dot(b,p),C=h.subtract(i,f,Fae),S=h.dot(C,g),v=h.dot(C,m);x>0?r+=x*x:S>0&&(r+=S*S),T>0?r+=T*T:v>0&&(r+=v*v)}let s,a,l;if(t.mode===oe.SCENE3D?(s=o.height,a=e.minimumHeight,l=e.maximumHeight):(s=i.x,a=0,l=0),s>l){let u=s-l;r+=u*u}else if(s<a){let u=a-s;r+=u*u}return Math.sqrt(r)}YT.prototype.distanceToCamera=function(e){A.defined("frameState",e);let t=zje(this,e);if(e.mode===oe.SCENE3D&&c(this._orientedBoundingBox)){let n=Math.sqrt(this._orientedBoundingBox.distanceSquaredTo(e.camera.positionWC));return Math.max(t,n)}return t};YT.prototype.intersectPlane=function(e){return A.defined("plane",e),this._orientedBoundingBox.intersectPlane(e)};YT.prototype.createDebugVolume=function(e){A.defined("color",e);let t=new k.clone(k.IDENTITY),n=new Hw({rectangle:this.rectangle,height:this.minimumHeight,extrudedHeight:this.maximumHeight}),i=new vt({geometry:n,id:"outline",modelMatrix:t,attributes:{color:Wt.fromColor(e)}});return new Rn({geometryInstances:i,appearance:new ln({translucent:!1,flat:!0}),asynchronous:!1})};var wh=YT;var Gw={},Hje=new h,Bae=new h,kae=new h,Vae=new h,Uae=new Pn;Gw.validOutline=function(e){A.defined("positions",e);let n=Pn.fromPoints(e,Uae).halfAxes,i=Q.getColumn(n,0,Bae),o=Q.getColumn(n,1,kae),r=Q.getColumn(n,2,Vae),s=h.magnitude(i),a=h.magnitude(o),l=h.magnitude(r);return!(s===0&&(a===0||l===0)||a===0&&l===0)};Gw.computeProjectTo2DArguments=function(e,t,n,i){A.defined("positions",e),A.defined("centerResult",t),A.defined("planeAxis1Result",n),A.defined("planeAxis2Result",i);let o=Pn.fromPoints(e,Uae),r=o.halfAxes,s=Q.getColumn(r,0,Bae),a=Q.getColumn(r,1,kae),l=Q.getColumn(r,2,Vae),u=h.magnitude(s),f=h.magnitude(a),d=h.magnitude(l),p=Math.min(u,f,d);if(u===0&&(f===0||d===0)||f===0&&d===0)return!1;let g,m;return(p===f||p===d)&&(g=s),p===u?g=a:p===d&&(m=a),(p===u||p===f)&&(m=l),h.normalize(g,n),h.normalize(m,i),h.clone(o.center,t),!0};function zae(e,t,n,i,o){let r=h.subtract(e,t,Hje),s=h.dot(n,r),a=h.dot(i,r);return H.fromElements(s,a,o)}Gw.createProjectPointsTo2DFunction=function(e,t,n){return function(i){let o=new Array(i.length);for(let r=0;r<i.length;r++)o[r]=zae(i[r],e,t,n);return o}};Gw.createProjectPointTo2DFunction=function(e,t,n){return function(i,o){return zae(i,e,t,n,o)}};var k0=Gw;function Gje(e){let t=e.length,n=new Float64Array(t*3),i=Fe.createTypedArray(t,t*2),o=0,r=0;for(let a=0;a<t;a++){let l=e[a];n[o++]=l.x,n[o++]=l.y,n[o++]=l.z,i[r++]=a,i[r++]=(a+1)%t}let s=new pn({position:new we({componentDatatype:$.DOUBLE,componentsPerAttribute:3,values:n})});return new ut({attributes:s,indices:i,primitiveType:Me.LINES})}function V0(e){e=y(e,y.EMPTY_OBJECT);let t=e.polygonHierarchy;A.defined("options.polygonHierarchy",t),this._polygonHierarchy=t,this._workerName="createCoplanarPolygonOutlineGeometry",this.packedLength=zn.computeHierarchyPackedLength(t,h)+1}V0.fromPositions=function(e){e=y(e,y.EMPTY_OBJECT),A.defined("options.positions",e.positions);let t={polygonHierarchy:{positions:e.positions}};return new V0(t)};V0.pack=function(e,t,n){return A.typeOf.object("value",e),A.defined("array",t),n=y(n,0),n=zn.packPolygonHierarchy(e._polygonHierarchy,t,n,h),t[n]=e.packedLength,t};var jje={polygonHierarchy:{}};V0.unpack=function(e,t,n){A.defined("array",e),t=y(t,0);let i=zn.unpackPolygonHierarchy(e,t,h);t=i.startingIndex,delete i.startingIndex;let o=e[t];return c(n)||(n=new V0(jje)),n._polygonHierarchy=i,n.packedLength=o,n};V0.createGeometry=function(e){let t=e._polygonHierarchy,n=t.positions;if(n=Ao(n,h.equalsEpsilon,!0),n.length<3||!k0.validOutline(n))return;let o=zn.polygonOutlinesFromHierarchy(t,!1);if(o.length===0)return;let r=[];for(let l=0;l<o.length;l++){let u=new vt({geometry:Gje(o[l])});r.push(u)}let s=Fn.combineInstances(r)[0],a=ce.fromPoints(t.positions);return new ut({attributes:s.attributes,indices:s.indices,primitiveType:s.primitiveType,boundingSphere:a})};var vh=V0;var R1=new he;function jw(e){A.typeOf.object("options",e),A.typeOf.string("options.token",e.token);let t=u0.fromToken(e.token),n=y(e.minimumHeight,0),i=y(e.maximumHeight,0),o=y(e.ellipsoid,ie.WGS84);this.s2Cell=t,this.minimumHeight=n,this.maximumHeight=i,this.ellipsoid=o;let r=Qje(t,n,i,o);this._boundingPlanes=r;let s=i9e(r);this._vertices=s,this._edgeNormals=new Array(6),this._edgeNormals[0]=OG(r[0],s.slice(0,4));let a;for(a=0;a<4;a++)this._edgeNormals[0][a]=h.negate(this._edgeNormals[0][a],this._edgeNormals[0][a]);for(this._edgeNormals[1]=OG(r[1],s.slice(4,8)),a=0;a<4;a++)this._edgeNormals[2+a]=OG(r[2+a],[s[a%4],s[(a+1)%4],s[4+(a+1)%4],s[4+a]]);for(this._planeVertices=[this._vertices.slice(0,4),this._vertices.slice(4,8)],a=0;a<4;a++)this._planeVertices.push([this._vertices[a%4],this._vertices[(a+1)%4],this._vertices[4+(a+1)%4],this._vertices[4+a]]);let l=t.getCenter();R1=o.cartesianToCartographic(l,R1),R1.height=(i+n)/2,this.center=o.cartographicToCartesian(R1,l),this._boundingSphere=ce.fromPoints(s)}var Wje=new h,qje=new he,Yje=new h,Xje=new he,Kje=new h,$je=new h,Zje=new h,Jje=new h;function Qje(e,t,n,i){let o=new Array(6),r=e.getCenter(),s=i.geodeticSurfaceNormal(r,Wje),a=i.cartesianToCartographic(r,qje);a.height=n;let l=i.cartographicToCartesian(a,Yje),u=un.fromPointNormal(l,s);o[0]=u;let f=0,d,p=[],g,m;for(d=0;d<4;d++){g=e.getVertex(d),p[d]=g,m=i.cartesianToCartographic(g,Xje),m.height=t;let x=un.getPointDistance(u,i.cartographicToCartesian(m,Kje));x<f&&(f=x)}let b=un.clone(u);for(b.normal=h.negate(b.normal,b.normal),b.distance=b.distance*-1+f,o[1]=b,d=0;d<4;d++){g=p[d];let x=p[(d+1)%4],T=i.geodeticSurfaceNormal(g,$je),C=h.subtract(x,g,Jje),S=h.cross(C,T,Zje);S=h.normalize(S,S),o[2+d]=un.fromPointNormal(g,S)}return o}var U0=new h,z0=new h,H0=new h,EG=new h,SG=new h,wG=new h,e9e=new h,t9e=new h,n9e=new h,vG=new h,DG=new h,PG=new h,dg=new h,Dh=new Q;function Hae(e,t,n){U0=e.normal,z0=t.normal,H0=n.normal,EG=h.multiplyByScalar(e.normal,-e.distance,EG),SG=h.multiplyByScalar(t.normal,-t.distance,SG),wG=h.multiplyByScalar(n.normal,-n.distance,wG),vG=h.multiplyByScalar(h.cross(z0,H0,e9e),h.dot(EG,U0),vG),DG=h.multiplyByScalar(h.cross(H0,U0,t9e),h.dot(SG,z0),DG),PG=h.multiplyByScalar(h.cross(U0,z0,n9e),h.dot(wG,H0),PG),Dh[0]=U0.x,Dh[1]=z0.x,Dh[2]=H0.x,Dh[3]=U0.y,Dh[4]=z0.y,Dh[5]=H0.y,Dh[6]=U0.z,Dh[7]=z0.z,Dh[8]=H0.z;let i=Q.determinant(Dh);return dg=h.add(vG,DG,dg),dg=h.add(dg,PG,dg),new h(dg.x/i,dg.y/i,dg.z/i)}function i9e(e){let t=new Array(8);for(let n=0;n<4;n++)t[n]=Hae(e[0],e[2+(n+3)%4],e[2+n%4]),t[n+4]=Hae(e[1],e[2+(n+3)%4],e[2+n%4]);return t}var IG=new h,XT=new h;function OG(e,t){let n=[];for(let i=0;i<4;i++)IG=h.subtract(t[(i+1)%4],t[i],IG),XT=h.cross(e.normal,IG,XT),XT=h.normalize(XT,XT),n[i]=h.clone(XT);return n}Object.defineProperties(jw.prototype,{boundingVolume:{get:function(){return this}},boundingSphere:{get:function(){return this._boundingSphere}}});var RG=new h;jw.prototype.distanceToCamera=function(e){A.defined("frameState",e);let t=e.camera.positionWC,n=[],i=[],o;un.getPointDistance(this._boundingPlanes[0],t)>0?(n.push(0),i.push(this._planeVertices[0]),o=this._edgeNormals[0]):un.getPointDistance(this._boundingPlanes[1],t)>0&&(n.push(1),i.push(this._planeVertices[1]),o=this._edgeNormals[1]);let r,s;for(r=0;r<4;r++)s=2+r,un.getPointDistance(this._boundingPlanes[s],t)>0&&(n.push(s),i.push(this._planeVertices[s]),o=this._edgeNormals[s]);if(n.length===0)return 0;let a,l;if(n.length===1)return l=this._boundingPlanes[n[0]],a=MG(un.projectPointOntoPlane(l,t,RG),i[0],l,o),h.distance(a,t);if(n.length===2){if(n[0]===0){let p=[this._vertices[4*n[0]+(n[1]-2)],this._vertices[4*n[0]+(n[1]-2+1)%4]];return a=Gae(t,p[0],p[1]),h.distance(a,t)}let f=Number.MAX_VALUE,d;for(r=0;r<2;r++)l=this._boundingPlanes[n[r]],a=MG(un.projectPointOntoPlane(l,t,RG),i[r],l,this._edgeNormals[n[r]]),d=h.distanceSquared(a,t),d<f&&(f=d);return Math.sqrt(f)}else if(n.length>3)return a=MG(un.projectPointOntoPlane(this._boundingPlanes[1],t,RG),this._planeVertices[1],this._boundingPlanes[1],this._edgeNormals[1]),h.distance(a,t);let u=n[1]===2&&n[2]===5?0:1;return n[0]===0?h.distance(t,this._vertices[(n[1]-2+u)%4]):h.distance(t,this._vertices[4+(n[1]-2+u)%4])};var o9e=new h,r9e=new h;function Gae(e,t,n){let i=h.subtract(n,t,o9e),o=h.subtract(e,t,r9e),r=h.dot(i,o);if(r<=0)return t;let s=h.dot(i,i);return r>=s?n:(r=r/s,new h((1-r)*t.x+r*n.x,(1-r)*t.y+r*n.y,(1-r)*t.z+r*n.z))}var s9e=new un(h.UNIT_X,0);function MG(e,t,n,i){let o=Number.MAX_VALUE,r,s,a;for(let l=0;l<t.length;l++){let u=un.fromPointNormal(t[l],i[l],s9e);un.getPointDistance(u,e)<0||(a=Gae(e,t[l],t[(l+1)%4]),r=h.distance(e,a),r<o&&(o=r,s=a))}return c(s)?s:e}jw.prototype.intersectPlane=function(e){A.defined("plane",e);let t=0,n=0;for(let i=0;i<this._vertices.length;i++)h.dot(e.normal,this._vertices[i])+e.distance<0?n++:t++;return t===this._vertices.length?qt.INSIDE:n===this._vertices.length?qt.OUTSIDE:qt.INTERSECTING};jw.prototype.createDebugVolume=function(e){A.defined("color",e);let t=new k.clone(k.IDENTITY),n=new vh({polygonHierarchy:{positions:this._planeVertices[0]}}),i=vh.createGeometry(n),o=new vt({geometry:i,id:"outline",modelMatrix:t,attributes:{color:Wt.fromColor(e)}}),r=new vh({polygonHierarchy:{positions:this._planeVertices[1]}}),s=vh.createGeometry(r),a=new vt({geometry:s,id:"outline",modelMatrix:t,attributes:{color:Wt.fromColor(e)}}),l=[];for(let u=0;u<4;u++){let f=new vh({polygonHierarchy:{positions:this._planeVertices[2+u]}}),d=vh.createGeometry(f);l[u]=new vt({geometry:d,id:"outline",modelMatrix:t,attributes:{color:Wt.fromColor(e)}})}return new Rn({geometryInstances:[l[0],l[1],l[2],l[3],a,o],appearance:new ln({translucent:!1,flat:!0}),asynchronous:!1})};var LG=jw;var a9e=new h(1,1,1),M1=Math.cos,L1=Math.sin;function KT(e){e=y(e,y.EMPTY_OBJECT);let t=y(e.radii,a9e),n=y(e.innerRadii,t),i=y(e.minimumClock,0),o=y(e.maximumClock,R.TWO_PI),r=y(e.minimumCone,0),s=y(e.maximumCone,R.PI),a=Math.round(y(e.stackPartitions,10)),l=Math.round(y(e.slicePartitions,8)),u=Math.round(y(e.subdivisions,128));if(a<1)throw new E("options.stackPartitions cannot be less than 1");if(l<0)throw new E("options.slicePartitions cannot be less than 0");if(u<0)throw new E("options.subdivisions must be greater than or equal to zero.");if(c(e.offsetAttribute)&&e.offsetAttribute===Jt.TOP)throw new E("GeometryOffsetAttribute.TOP is not a supported options.offsetAttribute for this geometry.");this._radii=h.clone(t),this._innerRadii=h.clone(n),this._minimumClock=i,this._maximumClock=o,this._minimumCone=r,this._maximumCone=s,this._stackPartitions=a,this._slicePartitions=l,this._subdivisions=u,this._offsetAttribute=e.offsetAttribute,this._workerName="createEllipsoidOutlineGeometry"}KT.packedLength=2*h.packedLength+8;KT.pack=function(e,t,n){if(!c(e))throw new E("value is required");if(!c(t))throw new E("array is required");return n=y(n,0),h.pack(e._radii,t,n),n+=h.packedLength,h.pack(e._innerRadii,t,n),n+=h.packedLength,t[n++]=e._minimumClock,t[n++]=e._maximumClock,t[n++]=e._minimumCone,t[n++]=e._maximumCone,t[n++]=e._stackPartitions,t[n++]=e._slicePartitions,t[n++]=e._subdivisions,t[n]=y(e._offsetAttribute,-1),t};var jae=new h,Wae=new h,Ep={radii:jae,innerRadii:Wae,minimumClock:void 0,maximumClock:void 0,minimumCone:void 0,maximumCone:void 0,stackPartitions:void 0,slicePartitions:void 0,subdivisions:void 0,offsetAttribute:void 0};KT.unpack=function(e,t,n){if(!c(e))throw new E("array is required");t=y(t,0);let i=h.unpack(e,t,jae);t+=h.packedLength;let o=h.unpack(e,t,Wae);t+=h.packedLength;let r=e[t++],s=e[t++],a=e[t++],l=e[t++],u=e[t++],f=e[t++],d=e[t++],p=e[t];return c(n)?(n._radii=h.clone(i,n._radii),n._innerRadii=h.clone(o,n._innerRadii),n._minimumClock=r,n._maximumClock=s,n._minimumCone=a,n._maximumCone=l,n._stackPartitions=u,n._slicePartitions=f,n._subdivisions=d,n._offsetAttribute=p===-1?void 0:p,n):(Ep.minimumClock=r,Ep.maximumClock=s,Ep.minimumCone=a,Ep.maximumCone=l,Ep.stackPartitions=u,Ep.slicePartitions=f,Ep.subdivisions=d,Ep.offsetAttribute=p===-1?void 0:p,new KT(Ep))};KT.createGeometry=function(e){let t=e._radii;if(t.x<=0||t.y<=0||t.z<=0)return;let n=e._innerRadii;if(n.x<=0||n.y<=0||n.z<=0)return;let i=e._minimumClock,o=e._maximumClock,r=e._minimumCone,s=e._maximumCone,a=e._subdivisions,l=ie.fromCartesian3(t),u=e._slicePartitions+1,f=e._stackPartitions+1;u=Math.round(u*Math.abs(o-i)/R.TWO_PI),f=Math.round(f*Math.abs(s-r)/R.PI),u<2&&(u=2),f<2&&(f=2);let d=0,p=1,g=n.x!==t.x||n.y!==t.y||n.z!==t.z,m=!1,b=!1;g&&(p=2,r>0&&(m=!0,d+=u),s<Math.PI&&(b=!0,d+=u));let x=a*p*(f+u),T=new Float64Array(x*3),C=2*(x+d-(u+f)*p),S=Fe.createTypedArray(x,C),v,D,I,L,M=0,N=new Array(f),B=new Array(f);for(v=0;v<f;v++)L=r+v*(s-r)/(f-1),N[v]=L1(L),B[v]=M1(L);let _=new Array(a),w=new Array(a);for(v=0;v<a;v++)I=i+v*(o-i)/(a-1),_[v]=L1(I),w[v]=M1(I);for(v=0;v<f;v++)for(D=0;D<a;D++)T[M++]=t.x*N[v]*w[D],T[M++]=t.y*N[v]*_[D],T[M++]=t.z*B[v];if(g)for(v=0;v<f;v++)for(D=0;D<a;D++)T[M++]=n.x*N[v]*w[D],T[M++]=n.y*N[v]*_[D],T[M++]=n.z*B[v];for(N.length=a,B.length=a,v=0;v<a;v++)L=r+v*(s-r)/(a-1),N[v]=L1(L),B[v]=M1(L);for(_.length=u,w.length=u,v=0;v<u;v++)I=i+v*(o-i)/(u-1),_[v]=L1(I),w[v]=M1(I);for(v=0;v<a;v++)for(D=0;D<u;D++)T[M++]=t.x*N[v]*w[D],T[M++]=t.y*N[v]*_[D],T[M++]=t.z*B[v];if(g)for(v=0;v<a;v++)for(D=0;D<u;D++)T[M++]=n.x*N[v]*w[D],T[M++]=n.y*N[v]*_[D],T[M++]=n.z*B[v];for(M=0,v=0;v<f*p;v++){let F=v*a;for(D=0;D<a-1;D++)S[M++]=F+D,S[M++]=F+D+1}let P=f*a*p;for(v=0;v<u;v++)for(D=0;D<a-1;D++)S[M++]=P+v+D*u,S[M++]=P+v+(D+1)*u;if(g)for(P=f*a*p+u*a,v=0;v<u;v++)for(D=0;D<a-1;D++)S[M++]=P+v+D*u,S[M++]=P+v+(D+1)*u;if(g){let F=f*a*p,V=F+a*u;if(m)for(v=0;v<u;v++)S[M++]=F+v,S[M++]=V+v;if(b)for(F+=a*u-u,V+=a*u-u,v=0;v<u;v++)S[M++]=F+v,S[M++]=V+v}let O=new pn({position:new we({componentDatatype:$.DOUBLE,componentsPerAttribute:3,values:T})});if(c(e._offsetAttribute)){let F=T.length,V=e._offsetAttribute===Jt.NONE?0:1,G=new Uint8Array(F/3).fill(V);O.applyOffset=new we({componentDatatype:$.UNSIGNED_BYTE,componentsPerAttribute:1,values:G})}return new ut({attributes:O,indices:S,primitiveType:Me.LINES,boundingSphere:ce.fromEllipsoid(l),offsetAttribute:e._offsetAttribute})};var fd=KT;function $T(e){let t=y(e.radius,1),i={radii:new h(t,t,t),stackPartitions:e.stackPartitions,slicePartitions:e.slicePartitions,subdivisions:e.subdivisions};this._ellipsoidGeometry=new fd(i),this._workerName="createSphereOutlineGeometry"}$T.packedLength=fd.packedLength;$T.pack=function(e,t,n){return A.typeOf.object("value",e),fd.pack(e._ellipsoidGeometry,t,n)};var c9e=new fd,G0={radius:void 0,radii:new h,stackPartitions:void 0,slicePartitions:void 0,subdivisions:void 0};$T.unpack=function(e,t,n){let i=fd.unpack(e,t,c9e);return G0.stackPartitions=i._stackPartitions,G0.slicePartitions=i._slicePartitions,G0.subdivisions=i._subdivisions,c(n)?(h.clone(i._radii,G0.radii),n._ellipsoidGeometry=new fd(G0),n):(G0.radius=i._radii.x,new $T(G0))};$T.createGeometry=function(e){return fd.createGeometry(e._ellipsoidGeometry)};var j0=$T;function ZT(e,t){t===0&&(t=R.EPSILON7),this._boundingSphere=new ce(e,t)}Object.defineProperties(ZT.prototype,{center:{get:function(){return this._boundingSphere.center}},radius:{get:function(){return this._boundingSphere.radius}},boundingVolume:{get:function(){return this._boundingSphere}},boundingSphere:{get:function(){return this._boundingSphere}}});ZT.prototype.distanceToCamera=function(e){A.defined("frameState",e);let t=this._boundingSphere;return Math.max(0,h.distance(t.center,e.camera.positionWC)-t.radius)};ZT.prototype.intersectPlane=function(e){return A.defined("plane",e),ce.intersectPlane(this._boundingSphere,e)};ZT.prototype.update=function(e,t){h.clone(e,this._boundingSphere.center),this._boundingSphere.radius=t};ZT.prototype.createDebugVolume=function(e){A.defined("color",e);let t=new j0({radius:this.radius}),n=k.fromTranslation(this.center,new k.clone(k.IDENTITY)),i=new vt({geometry:t,id:"outline",modelMatrix:n,attributes:{color:Wt.fromColor(e)}});return new Rn({geometryInstances:i,appearance:new ln({translucent:!1,flat:!0}),asynchronous:!1})};var W0=ZT;var l9e=new h,u9e=new h,f9e=new h,d9e=new h;function q0(e,t,n){n=h.cross(e,t,n);let i=h.magnitude(n);return h.multiplyByScalar(n,R.EPSILON7/i,n)}function NG(e,t){let n=h.normalize(e,d9e),i=h.equalsEpsilon(n,h.UNIT_X,R.EPSILON6)?h.UNIT_Y:h.UNIT_X;return q0(e,i,t)}function qae(e){let t=Q.getColumn(e,0,l9e),n=Q.getColumn(e,1,u9e),i=Q.getColumn(e,2,f9e),o=h.equals(t,h.ZERO),r=h.equals(n,h.ZERO),s=h.equals(i,h.ZERO);return!o&&!r&&!s?e:o&&r&&s?(e[0]=R.EPSILON7,e[4]=R.EPSILON7,e[8]=R.EPSILON7,e):(o&&!r&&!s?t=q0(n,i,t):!o&&r&&!s?n=q0(t,i,n):!o&&!r&&s?i=q0(n,t,i):o?r?s||(t=NG(i,t),n=q0(i,t,n)):(t=NG(n,t),i=q0(n,t,i)):(n=NG(t,n),i=q0(n,t,i)),Q.setColumn(e,0,t,e),Q.setColumn(e,1,n,e),Q.setColumn(e,2,i,e),e)}function JT(e,t){t=qae(t),this._orientedBoundingBox=new Pn(e,t),this._boundingSphere=ce.fromOrientedBoundingBox(this._orientedBoundingBox)}Object.defineProperties(JT.prototype,{boundingVolume:{get:function(){return this._orientedBoundingBox}},boundingSphere:{get:function(){return this._boundingSphere}}});JT.prototype.distanceToCamera=function(e){return A.defined("frameState",e),Math.sqrt(this._orientedBoundingBox.distanceSquaredTo(e.camera.positionWC))};JT.prototype.intersectPlane=function(e){return A.defined("plane",e),this._orientedBoundingBox.intersectPlane(e)};JT.prototype.update=function(e,t){h.clone(e,this._orientedBoundingBox.center),t=qae(t),Q.clone(t,this._orientedBoundingBox.halfAxes),ce.fromOrientedBoundingBox(this._orientedBoundingBox,this._boundingSphere)};JT.prototype.createDebugVolume=function(e){A.defined("color",e);let t=new Sm({minimum:new h(-1,-1,-1),maximum:new h(1,1,1)}),n=k.fromRotationTranslation(this.boundingVolume.halfAxes,this.boundingVolume.center),i=new vt({geometry:t,id:"outline",modelMatrix:n,attributes:{color:Wt.fromColor(e)}});return new Rn({geometryInstances:i,appearance:new ln({translucent:!1,flat:!0}),asynchronous:!1})};var dd=JT;function jo(e,t,n,i){this._tileset=e,this._header=n;let o=c(n.contents),r=o&&n.contents.length>1||si(n,"3DTILES_multiple_contents"),s=o&&!r?n.contents[0]:n.content;this._contentHeader=s,this.transform=c(n.transform)?k.unpack(n.transform):k.clone(k.IDENTITY);let a=c(i)?i.computedTransform:e.modelMatrix,l=k.multiply(a,this.transform,new k),u=c(i)?i._initialTransform:k.IDENTITY;this._initialTransform=k.multiply(u,this.transform,new k),this.computedTransform=l,this.metadata=xG(e,n),this._verticalExaggeration=1,this._verticalExaggerationRelativeHeight=0,this._boundingVolume=this.createBoundingVolume(n.boundingVolume,l),this._boundingVolume2D=void 0;let f;c(s)&&c(s.boundingVolume)&&(f=this.createBoundingVolume(s.boundingVolume,l)),this._contentBoundingVolume=f,this._contentBoundingVolume2D=void 0;let d;c(n.viewerRequestVolume)&&(d=this.createBoundingVolume(n.viewerRequestVolume,l)),this._viewerRequestVolume=d,this.geometricError=n.geometricError,this._geometricError=n.geometricError,c(this._geometricError)||(this._geometricError=c(i)?i._geometricError:e._geometricError,jo._deprecationWarning("geometricErrorUndefined","Required property geometricError is undefined for this tile. Using parent's geometric error instead.")),this.updateGeometricErrorScale();let p;c(n.refine)?((n.refine==="replace"||n.refine==="add")&&jo._deprecationWarning("lowercase-refine",`This tile uses a lowercase refine "${n.refine}". Instead use "${n.refine.toUpperCase()}".`),p=n.refine.toUpperCase()==="REPLACE"?nr.REPLACE:nr.ADD):c(i)?p=i.refine:p=nr.REPLACE,this.refine=p,this.children=[],this.parent=i;let g,m=!1,b,x,T;if(t=De.createIfNeeded(t),r)b=rr.UNLOADED,x=t.clone();else if(c(s)){let D=s.uri;c(s.url)&&(jo._deprecationWarning("contentUrl",'This tileset JSON uses the "content.url" property which has been deprecated. Use "content.uri" instead.'),D=s.url),D===""?(jo._deprecationWarning("contentUriEmpty","content.uri property is an empty string, which creates a circular dependency, making this tileset invalid. Omit the content property instead"),g=new P1(e,this),m=!0,b=rr.READY):(b=rr.UNLOADED,x=t.getDerivedResource({url:D}),T=qc.getServerKey(x.getUrlComponent()))}else g=new P1(e,this),m=!0,b=rr.READY;this._content=g,this._contentResource=x,this._contentState=b,this._expiredContent=void 0,this._serverKey=T,this.hasEmptyContent=m,this.hasTilesetContent=!1,this.hasImplicitContent=!1,this.hasImplicitContentMetadata=!1,this.hasMultipleContents=r,this.cacheNode=void 0;let C=n.expire,S,v;c(C)&&(S=C.duration,c(C.date)&&(v=J.fromIso8601(C.date))),this.expireDuration=S,this.expireDate=v,this.lastStyleTime=0,this._optimChildrenWithinParent=Eh.NOT_COMPUTED,this.clippingPlanesDirty=!1,this.clippingPolygonsDirty=!1,this.priorityDeferred=!1,this.implicitTileset=void 0,this.implicitCoordinates=void 0,this.implicitSubtree=void 0,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._screenSpaceErrorProgressiveResolution=0,this._visibilityPlaneMask=0,this._visible=!1,this._inRequestVolume=!1,this._finalResolution=!0,this._depth=0,this._stackLength=0,this._selectionDepth=0,this._updatedVisibilityFrame=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._wasSelectedLastFrame=!1,this._requestedFrame=0,this._ancestorWithContent=void 0,this._ancestorWithContentAvailable=void 0,this._refines=!1,this._shouldSelect=!1,this._isClipped=!0,this._isClippedByPolygon=!1,this._clippingPlanesState=0,this._clippingPolygonsState=0,this._debugBoundingVolume=void 0,this._debugContentBoundingVolume=void 0,this._debugViewerRequestVolume=void 0,this._debugColor=j.fromRandom({alpha:1}),this._debugColorizeTiles=!1,this._priority=0,this._priorityHolder=this,this._priorityProgressiveResolution=!1,this._priorityProgressiveResolutionScreenSpaceErrorLeaf=!1,this._priorityReverseScreenSpaceError=0,this._foveatedFactor=0,this._wasMinPriorityChild=!1,this._loadTimestamp=new J,this._commandsLength=0,this._color=void 0,this._colorDirty=!1,this._request=void 0}jo._deprecationWarning=Ss;Object.defineProperties(jo.prototype,{tileset:{get:function(){return this._tileset}},content:{get:function(){return this._content}},boundingVolume:{get:function(){return this._boundingVolume}},contentBoundingVolume:{get:function(){return y(this._contentBoundingVolume,this._boundingVolume)}},boundingSphere:{get:function(){return this._boundingVolume.boundingSphere}},isVisible:{get:function(){return this._visible&&this._inRequestVolume}},extras:{get:function(){return this._header.extras}},color:{get:function(){return c(this._color)||(this._color=new j),j.clone(this._color)},set:function(e){this._color=j.clone(e,this._color),this._colorDirty=!0}},hasRenderableContent:{get:function(){return!this.hasEmptyContent&&!this.hasTilesetContent&&!this.hasImplicitContent}},contentAvailable:{get:function(){return this.contentReady&&this.hasRenderableContent||c(this._expiredContent)&&!this.contentFailed}},contentReady:{get:function(){return this._contentState===rr.READY}},contentUnloaded:{get:function(){return this._contentState===rr.UNLOADED}},hasUnloadedRenderableContent:{get:function(){return this.hasRenderableContent&&this.contentUnloaded}},contentExpired:{get:function(){return this._contentState===rr.EXPIRED}},contentFailed:{get:function(){return this._contentState===rr.FAILED}},commandsLength:{get:function(){return this._commandsLength}}});var hg=new h;function h9e(e,t){let{tileset:n,boundingSphere:i}=e,{radius:o,center:r}=i,{camera:s}=t,a=h.multiplyByScalar(s.directionWC,e._centerZDepth,hg),l=h.add(s.positionWC,a,hg),u=h.subtract(l,r,hg);if(h.magnitude(u)>o){let v=h.normalize(u,hg),D=h.multiplyByScalar(v,o,hg),I=h.add(r,D,hg),L=h.subtract(I,s.positionWC,hg),M=h.normalize(L,hg);e._foveatedFactor=1-Math.abs(h.dot(s.directionWC,M))}else e._foveatedFactor=0;let p=e.refine===nr.REPLACE,g=n.isSkippingLevelOfDetail;if(p&&!g||!n.foveatedScreenSpaceError||n.foveatedConeSize===1||e._priorityProgressiveResolution&&p&&g||n._pass===Ro.PRELOAD_FLIGHT||n._pass===Ro.PRELOAD)return!1;let m=1-Math.cos(s.frustum.fov*.5),b=n.foveatedConeSize*m;if(e._foveatedFactor<=b)return!1;let x=m-b,T=R.clamp((e._foveatedFactor-b)/x,0,1),C=n.foveatedInterpolationCallback(n.foveatedMinimumScreenSpaceErrorRelaxation,n.memoryAdjustedScreenSpaceError,T),S=e._screenSpaceError===0&&c(e.parent)?e.parent._screenSpaceError*.5:e._screenSpaceError;return n.memoryAdjustedScreenSpaceError-C<=S}var $ae=new J;jo.prototype.getScreenSpaceError=function(e,t,n){let i=this._tileset,o=y(n,1),r=c(this.parent)?this.parent.geometricError:i._scaledGeometricError,s=t?r:this.geometricError;if(s===0)return 0;let{camera:a,context:l}=e,u=a.frustum,f=l.drawingBufferWidth,d=l.drawingBufferHeight*o,p;if(e.mode===oe.SCENE2D||u instanceof rn){let g=u.offCenterFrustum;c(g)&&(u=g);let m=Math.max(u.top-u.bottom,u.right-u.left)/Math.max(f,d);p=s/m}else{let g=Math.max(this._distanceToCamera,R.EPSILON7),m=u.sseDenominator;if(p=s*d/(g*m),i.dynamicScreenSpaceError){let b=i._dynamicScreenSpaceErrorComputedDensity,x=i.dynamicScreenSpaceErrorFactor,T=R.fog(g,b)*x;p-=T}}return p/=e.pixelRatio,p};function m9e(e,t){if(e.progressiveResolutionHeightFraction<=0||e.progressiveResolutionHeightFraction>.5)return!1;let n=e.memoryAdjustedScreenSpaceError,i=t._screenSpaceErrorProgressiveResolution>n;t._priorityProgressiveResolutionScreenSpaceErrorLeaf=!1;let o=t.parent,r=t._screenSpaceErrorProgressiveResolution<=n,s=c(o)&&o._screenSpaceErrorProgressiveResolution>n;return r&&s&&(t._priorityProgressiveResolutionScreenSpaceErrorLeaf=!0,i=!0),i}function p9e(e,t){let n=t.parent,o=c(n)&&(!e.isSkippingLevelOfDetail||t._screenSpaceError===0||n.hasTilesetContent||n.hasImplicitContent)?n._screenSpaceError:t._screenSpaceError;return e.root._screenSpaceError-o}jo.prototype.updateVisibility=function(e){let{parent:t,tileset:n}=this;if(this._updatedVisibilityFrame===n._updatedVisibilityFrame)return;let i=c(t)?t.computedTransform:n.modelMatrix,o=c(t)?t._visibilityPlaneMask:Os.MASK_INDETERMINATE;this.updateTransform(i,e),this._distanceToCamera=this.distanceToTile(e),this._centerZDepth=this.distanceToTileCenter(e),this._screenSpaceError=this.getScreenSpaceError(e,!1),this._screenSpaceErrorProgressiveResolution=this.getScreenSpaceError(e,!1,n.progressiveResolutionHeightFraction),this._visibilityPlaneMask=this.visibility(e,o),this._visible=this._visibilityPlaneMask!==Os.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(e),this._priorityReverseScreenSpaceError=p9e(n,this),this._priorityProgressiveResolution=m9e(n,this),this.priorityDeferred=h9e(this,e),this._updatedVisibilityFrame=n._updatedVisibilityFrame};jo.prototype.updateExpiration=function(){if(c(this.expireDate)&&this.contentReady&&!this.hasEmptyContent&&!this.hasMultipleContents){let e=J.now($ae);J.lessThan(this.expireDate,e)&&(this._contentState=rr.EXPIRED,this._expiredContent=this._content)}};function _9e(e){if(!c(e.expireDuration))return;let t=J.now($ae);J.addSeconds(t,e.expireDuration,t),c(e.expireDate)?J.lessThan(e.expireDate,t)&&J.clone(t,e.expireDate):e.expireDate=J.clone(t)}function g9e(e){return function(){return e._priority}}jo.prototype.requestContent=function(){if(!this.hasEmptyContent)return this.hasMultipleContents?y9e(this):x9e(this)};function y9e(e){let t=e._content,n=e._tileset;if(!c(t)){let o=si(e._header,"3DTILES_multiple_contents")?e._header.extensions["3DTILES_multiple_contents"]:e._header;t=new AG(n,e,e._contentResource.clone(),o),e._content=t}let i=t.requestInnerContents();if(c(i))return e._contentState=rr.LOADING,i.then(o=>{if(!e.isDestroyed()&&c(o))return e._contentState=rr.PROCESSING,t}).catch(o=>{if(!e.isDestroyed())throw e._contentState=rr.FAILED,o})}async function b9e(e,t,n,i,o){let r=e._contentState;e._contentState=rr.LOADING,++t.statistics.numberOfPendingRequests;let s;try{s=await o}catch(a){if(--t.statistics.numberOfPendingRequests,e.isDestroyed())return;if(n.cancelled||n.state===Jn.CANCELLED){e._contentState=r,++t.statistics.numberOfAttemptedRequests;return}throw e._contentState=rr.FAILED,a}if(e.isDestroyed()){--t.statistics.numberOfPendingRequests;return}if(n.cancelled||n.state===Jn.CANCELLED){e._contentState=r,--t.statistics.numberOfPendingRequests,++t.statistics.numberOfAttemptedRequests;return}try{let a=await T9e(e,s);return--t.statistics.numberOfPendingRequests,e.isDestroyed()?void 0:(i&&(e.expireDate=void 0),e._content=a,e._contentState=rr.PROCESSING,a)}catch(a){if(--t.statistics.numberOfPendingRequests,e.isDestroyed())return;throw e._contentState=rr.FAILED,a}}function x9e(e){let t=e._contentResource.clone(),n=e.contentExpired;n&&t.setQueryParameters({expired:e.expireDate.toString()});let i=new ur({throttle:!0,throttleByServer:!0,type:Es.TILES3D,priorityFunction:g9e(e),serverKey:e._serverKey});e._request=i,t.request=i;let o=e._tileset,r=t.fetchArrayBuffer();if(!c(r)){++o.statistics.numberOfAttemptedRequests;return}return b9e(e,o,i,n,r)}async function T9e(e,t){let n=fg(t),i=e._tileset;i._disableSkipLevelOfDetail=i._disableSkipLevelOfDetail||n.contentType===Zs.GEOMETRY||n.contentType===Zs.VECTOR,(n.contentType===Zs.IMPLICIT_SUBTREE||n.contentType===Zs.IMPLICIT_SUBTREE_JSON)&&(e.hasImplicitContent=!0),n.contentType===Zs.EXTERNAL_TILESET&&(e.hasTilesetContent=!0);let o,r=kw[n.contentType];if(e.isDestroyed())return;c(n.binaryPayload)?o=await Promise.resolve(r(i,e,e._contentResource,n.binaryPayload.buffer,0)):o=await Promise.resolve(r(i,e,e._contentResource,n.jsonPayload));let s=e._contentHeader;if(e.hasImplicitContentMetadata){let l=e.implicitSubtree,u=e.implicitCoordinates;o.metadata=l.getContentMetadataView(u,0)}else e.hasImplicitContent||(o.metadata=Vw(i,s));let a=Uw(i,s);return c(a)&&(o.group=new vS({metadata:a})),o}jo.prototype.cancelRequests=function(){this.hasMultipleContents?this._content.cancelRequests():this._request.cancel()};jo.prototype.unloadContent=function(){this.hasRenderableContent&&(this._content=this._content&&this._content.destroy(),this._contentState=rr.UNLOADED,this.lastStyleTime=0,this.clippingPlanesDirty=this._clippingPlanesState===0,this._clippingPlanesState=0,this.clippingPolygonsDirty=this._clippingPolygonsState===0,this._clippingPolygonsState=0,this._debugColorizeTiles=!1,this._debugBoundingVolume=this._debugBoundingVolume&&this._debugBoundingVolume.destroy(),this._debugContentBoundingVolume=this._debugContentBoundingVolume&&this._debugContentBoundingVolume.destroy(),this._debugViewerRequestVolume=this._debugViewerRequestVolume&&this._debugViewerRequestVolume.destroy())};var Zae=new ce;function BG(e,t){if(t.mode!==oe.SCENE3D&&!c(e._boundingVolume2D)){let n=e._boundingVolume.boundingSphere,i=ce.projectTo2D(n,t.mapProjection,Zae);e._boundingVolume2D=new W0(i.center,i.radius)}return t.mode!==oe.SCENE3D?e._boundingVolume2D:e._boundingVolume}function A9e(e,t){if(t.mode!==oe.SCENE3D&&!c(e._contentBoundingVolume2D)){let n=e._contentBoundingVolume.boundingSphere,i=ce.projectTo2D(n,t.mapProjection,Zae);e._contentBoundingVolume2D=new W0(i.center,i.radius)}return t.mode!==oe.SCENE3D?e._contentBoundingVolume2D:e._contentBoundingVolume}jo.prototype.visibility=function(e,t){let n=e.cullingVolume,i=BG(this,e),o=this._tileset,r=o.clippingPlanes;if(c(r)&&r.enabled){let a=r.computeIntersectionWithBoundingVolume(i,o.clippingPlanesOriginMatrix);if(this._isClipped=a!==qt.INSIDE,a===qt.OUTSIDE)return Os.MASK_OUTSIDE}let s=o.clippingPolygons;if(c(s)&&s.enabled){let a=s.computeIntersectionWithBoundingVolume(i);this._isClippedByPolygon=a!==qt.OUTSIDE}return n.computeVisibilityWithPlaneMask(i,t)};jo.prototype.contentVisibility=function(e){if(!c(this._contentBoundingVolume))return qt.INSIDE;if(this._visibilityPlaneMask===Os.MASK_INSIDE)return qt.INSIDE;let t=e.cullingVolume,n=A9e(this,e),i=this._tileset,o=i.clippingPlanes;if(c(o)&&o.enabled){let s=o.computeIntersectionWithBoundingVolume(n,i.clippingPlanesOriginMatrix);if(this._isClipped=s!==qt.INSIDE,s===qt.OUTSIDE)return qt.OUTSIDE}let r=i.clippingPolygons;if(c(r)&&r.enabled){let s=r.computeIntersectionWithBoundingVolume(n);if(this._isClippedByPolygon=s!==qt.OUTSIDE,s===qt.INSIDE)return qt.OUTSIDE}return t.computeVisibility(n)};jo.prototype.distanceToTile=function(e){return BG(this,e).distanceToCamera(e)};var C9e=new h;jo.prototype.distanceToTileCenter=function(e){let n=BG(this,e).boundingVolume,i=h.subtract(n.center,e.camera.positionWC,C9e);return h.dot(e.camera.directionWC,i)};jo.prototype.insideViewerRequestVolume=function(e){let t=this._viewerRequestVolume;return!c(t)||t.distanceToCamera(e)===0};var Jae=new Q,Qae=new h,E9e=new Q,kG=new h,ece=new ae,tce=new Pn,FG=new k;function S9e(e,t,n){let i=h.fromElements(e[0],e[1],e[2],kG),o=Q.fromArray(e,3,E9e);i=k.multiplyByPoint(t,i,i);let r=k.getMatrix3(t,Jae);return o=Q.multiply(r,o,o),c(n)?(n.update(i,o),n):new dd(i,o)}function w9e(e,t,n,i){let o=ae.unpack(e,0,ece),r=e[4],s=e[5],a=Pn.fromRectangle(o,r,s,ie.WGS84,tce),l=a.center,u=a.halfAxes;t=k.multiplyTransformation(t,k.inverseTransformation(n,FG),FG),l=k.multiplyByPoint(t,l,l);let f=k.getMatrix3(t,Jae);return u=Q.multiply(f,u,u),c(i)&&i instanceof dd?(i.update(l,u),i):new dd(l,u)}function v9e(e,t,n,i){if(!k.equalsEpsilon(t,n,R.EPSILON8))return w9e(e,t,n,i);let o=ae.unpack(e,0,ece);return c(i)?(i.rectangle=ae.clone(o,i.rectangle),i.minimumHeight=e[4],i.maximumHeight=e[5],i.computeBoundingVolumes(ie.WGS84),i):new wh({rectangle:o,minimumHeight:e[4],maximumHeight:e[5]})}function D9e(e,t,n){let i=h.fromElements(e[0],e[1],e[2],kG),o=e[3];i=k.multiplyByPoint(t,i,i);let r=k.getScale(t,Qae),s=h.maximumComponent(r);return o*=s,c(n)?(n.update(i,o),n):new W0(i,o)}jo.prototype.createBoundingVolume=function(e,t,n){let i=this.metadata,o;if(c(i)&&(o=XS.parseBoundingVolumeSemantic("TILE",i)),c(o)&&(e=o),!c(e))throw new ue("boundingVolume must be defined");if(si(e,"3DTILES_bounding_volume_S2"))return new LG(e.extensions["3DTILES_bounding_volume_S2"]);let{box:r,region:s,sphere:a}=e;if(c(r)){let l=S9e(r,t,n);return this._verticalExaggeration!==1&&Yae(l,this._verticalExaggeration,this._verticalExaggerationRelativeHeight),l}if(c(s)){let l=v9e(s,t,this._initialTransform,n);return this._verticalExaggeration===1||(l instanceof dd?Yae(l,this._verticalExaggeration,this._verticalExaggerationRelativeHeight):(l.minimumHeight=zr.getHeight(l.minimumHeight,this._verticalExaggeration,this._verticalExaggerationRelativeHeight),l.maximumHeight=zr.getHeight(l.maximumHeight,this._verticalExaggeration,this._verticalExaggerationRelativeHeight),l.computeBoundingVolumes(ie.WGS84))),l}if(c(a)){let l=D9e(a,t,n);if(this._verticalExaggeration!==1){let u=zr.getPosition(l.center,ie.WGS84,this._verticalExaggeration,this._verticalExaggerationRelativeHeight,kG),f=l.radius*this._verticalExaggeration;l.update(u,f)}return l}throw new ue("boundingVolume must contain a sphere, region, or box")};var P9e=h.unpackArray(new Array(8*3).fill(0));function Yae(e,t,n){let i=e.boundingVolume.computeCorners(P9e).map(r=>zr.getPosition(r,ie.WGS84,t,n,r)),o=Pn.fromPoints(i,tce);e.update(o.center,o.halfAxes)}jo.prototype.updateTransform=function(e,t){e=y(e,k.IDENTITY);let n=k.multiplyTransformation(e,this.transform,FG),i=!k.equals(n,this.computedTransform),o=c(t)&&(this._verticalExaggeration!==t.verticalExaggeration||this._verticalExaggerationRelativeHeight!==t.verticalExaggerationRelativeHeight);if(!i&&!o)return;i&&k.clone(n,this.computedTransform),o&&(this._verticalExaggeration=t.verticalExaggeration,this._verticalExaggerationRelativeHeight=t.verticalExaggerationRelativeHeight);let r=this._header,s=this._contentHeader;this._boundingVolume=this.createBoundingVolume(r.boundingVolume,this.computedTransform,this._boundingVolume),c(this._contentBoundingVolume)&&(this._contentBoundingVolume=this.createBoundingVolume(s.boundingVolume,this.computedTransform,this._contentBoundingVolume)),c(this._viewerRequestVolume)&&(this._viewerRequestVolume=this.createBoundingVolume(r.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)),this.updateGeometricErrorScale(),this._debugBoundingVolume=this._debugBoundingVolume&&this._debugBoundingVolume.destroy(),this._debugContentBoundingVolume=this._debugContentBoundingVolume&&this._debugContentBoundingVolume.destroy(),this._debugViewerRequestVolume=this._debugViewerRequestVolume&&this._debugViewerRequestVolume.destroy()};jo.prototype.updateGeometricErrorScale=function(){let e=k.getScale(this.computedTransform,Qae),t=h.maximumComponent(e);if(this.geometricError=this._geometricError*t,!c(this.parent)){let n=this._tileset;n._scaledGeometricError=n._geometricError*t}};function I9e(e,t,n,i){if(!i.isRender)return;let o=c(e._contentHeader)&&c(e._contentHeader.boundingVolume),r=t.debugShowBoundingVolume||t.debugShowContentBoundingVolume&&!o;if(r){let l;e._finalResolution?e.hasRenderableContent?l=j.WHITE:l=j.DARKGRAY:l=j.YELLOW,c(e._debugBoundingVolume)||(e._debugBoundingVolume=e._boundingVolume.createDebugVolume(l)),e._debugBoundingVolume.update(n);let u=e._debugBoundingVolume.getGeometryInstanceAttributes("outline");u.color=Wt.toValue(l,u.color)}else!r&&c(e._debugBoundingVolume)&&(e._debugBoundingVolume=e._debugBoundingVolume.destroy());t.debugShowContentBoundingVolume&&o?(c(e._debugContentBoundingVolume)||(e._debugContentBoundingVolume=e._contentBoundingVolume.createDebugVolume(j.BLUE)),e._debugContentBoundingVolume.update(n)):!t.debugShowContentBoundingVolume&&c(e._debugContentBoundingVolume)&&(e._debugContentBoundingVolume=e._debugContentBoundingVolume.destroy()),t.debugShowViewerRequestVolume&&c(e._viewerRequestVolume)?(c(e._debugViewerRequestVolume)||(e._debugViewerRequestVolume=e._viewerRequestVolume.createDebugVolume(j.YELLOW)),e._debugViewerRequestVolume.update(n)):!t.debugShowViewerRequestVolume&&c(e._debugViewerRequestVolume)&&(e._debugViewerRequestVolume=e._debugViewerRequestVolume.destroy());let s=t.debugColorizeTiles&&!e._debugColorizeTiles||c(t._heatmap.tilePropertyName),a=!t.debugColorizeTiles&&e._debugColorizeTiles;s?(t._heatmap.colorize(e,n),e._debugColorizeTiles=!0,e.color=e._debugColor):a&&(e._debugColorizeTiles=!1,e.color=j.WHITE),e._colorDirty&&(e._colorDirty=!1,e._content.applyDebugSettings(!0,e._color)),a&&t.makeStyleDirty()}function O9e(e,t,n){let i=e._expiredContent;if(!e.hasMultipleContents&&c(i)){if(!e.contentReady){try{i.update(t,n)}catch{}return}e._expiredContent.destroy(),e._expiredContent=void 0}if(c(e.content))try{e.content.update(t,n)}catch(o){throw e._contentState=rr.FAILED,o}}function R9e(e,t){let n=t.clippingPlanes,i=0;c(n)&&e._isClipped&&n.enabled&&(i=n.clippingPlanesState),i!==e._clippingPlanesState&&(e._clippingPlanesState=i,e.clippingPlanesDirty=!0)}function M9e(e,t){let n=t.clippingPolygons,i=0;c(n)&&e._isClippedByPolygon&&n.enabled&&(i=n.clippingPolygonsState),i!==e._clippingPolygonsState&&(e._clippingPolygonsState=i,e.clippingPolygonsDirty=!0)}jo.prototype.update=function(e,t,n){let{commandList:i}=t,o=i.length;R9e(this,e),M9e(this,e),I9e(this,e,t,n),O9e(this,e,t);let r=i.length;this._commandsLength=r-o;for(let s=o;s<r;++s){let a=i[s],l=a.pass===ve.TRANSLUCENT;a.depthForTranslucentClassification=l}this.clippingPlanesDirty=!1,this.clippingPolygonsDirty=!1};var Xae=[];jo.prototype.process=function(e,t){!this.contentExpired&&!this.contentReady&&this._content.ready&&(_9e(this),this._selectedFrame=0,this.lastStyleTime=0,J.now(this._loadTimestamp),this._contentState=rr.READY,!this.hasTilesetContent&&!this.hasImplicitContent&&(e._statistics.incrementLoadCounts(this.content),++e._statistics.numberOfTilesWithContentReady,++e._statistics.numberOfLoadedTilesTotal,e._cache.add(this)));let n=t.commandList;t.commandList=Xae;try{this._content.update(e,t)}catch(i){throw this._contentState=rr.FAILED,i}Xae.length=0,t.commandList=n};function Kae(e,t,n){let i=e*Math.pow(10,t);return parseInt(i)*Math.pow(10,n)}function N1(e,t,n){return Math.max(R.normalize(e,t,n)-R.EPSILON7,0)}jo.prototype.updatePriority=function(){let e=this.tileset,t=e.preferLeaves,n=e._minimumPriority,i=e._maximumPriority,o=4,r=1,s=0,a=o,l=s+a,u=o,f=l+u,d=r,p=Math.pow(10,f),g=f+d,m=r,b=Math.pow(10,g),x=g+m,T=Math.pow(10,x),C=N1(this._depth,n.depth,i.depth);C=t?1-C:C;let v=!e.isSkippingLevelOfDetail&&this.refine===nr.REPLACE?N1(this._priorityHolder._distanceToCamera,n.distance,i.distance):N1(this._priorityReverseScreenSpaceError,n.reverseScreenSpaceError,i.reverseScreenSpaceError),D=Kae(v,a,s),I=this._priorityProgressiveResolution?0:p,L=N1(this._priorityHolder._foveatedFactor,n.foveatedFactor,i.foveatedFactor),M=Kae(L,u,l),N=this.priorityDeferred?b:0,B=e._pass===Ro.PRELOAD_FLIGHT?0:T;this._priority=C+D+I+M+N+B};jo.prototype.isDestroyed=function(){return!1};jo.prototype.destroy=function(){return this._content=this._content&&this._content.destroy(),this._expiredContent=this._expiredContent&&!this._expiredContent.isDestroyed()&&this._expiredContent.destroy(),this._debugBoundingVolume=this._debugBoundingVolume&&this._debugBoundingVolume.destroy(),this._debugContentBoundingVolume=this._debugContentBoundingVolume&&this._debugContentBoundingVolume.destroy(),this._debugViewerRequestVolume=this._debugViewerRequestVolume&&this._debugViewerRequestVolume.destroy(),de(this)};var Ph=jo;function Sp(e){e=y(e,y.EMPTY_OBJECT);let t=e.id,n=e.group,i=e.class;A.typeOf.object("options.group",n),A.typeOf.object("options.class",i);let o=c(n.properties)?n.properties:{};this._class=i,this._properties=o,this._id=t,this._extras=n.extras,this._extensions=n.extensions}Object.defineProperties(Sp.prototype,{class:{get:function(){return this._class}},id:{get:function(){return this._id}},extras:{get:function(){return this._extras}},extensions:{get:function(){return this._extensions}}});Sp.prototype.hasProperty=function(e){return Bn.hasProperty(e,this._properties,this._class)};Sp.prototype.hasPropertyBySemantic=function(e){return Bn.hasPropertyBySemantic(e,this._properties,this._class)};Sp.prototype.getPropertyIds=function(e){return Bn.getPropertyIds(this._properties,this._class,e)};Sp.prototype.getProperty=function(e){return Bn.getProperty(e,this._properties,this._class)};Sp.prototype.setProperty=function(e,t){return Bn.setProperty(e,t,this._properties,this._class)};Sp.prototype.getPropertyBySemantic=function(e){return Bn.getPropertyBySemantic(e,this._properties,this._class)};Sp.prototype.setPropertyBySemantic=function(e,t){return Bn.setPropertyBySemantic(e,t,this._properties,this._class)};var F1=Sp;function wp(e){e=y(e,y.EMPTY_OBJECT);let t=e.tileset,n=e.class;A.typeOf.object("options.tileset",t),A.typeOf.object("options.class",n);let i=c(t.properties)?t.properties:{};this._class=n,this._properties=i,this._extras=t.extras,this._extensions=t.extensions}Object.defineProperties(wp.prototype,{class:{get:function(){return this._class}},extras:{get:function(){return this._extras}},extensions:{get:function(){return this._extensions}}});wp.prototype.hasProperty=function(e){return Bn.hasProperty(e,this._properties,this._class)};wp.prototype.hasPropertyBySemantic=function(e){return Bn.hasPropertyBySemantic(e,this._properties,this._class)};wp.prototype.getPropertyIds=function(e){return Bn.getPropertyIds(this._properties,this._class,e)};wp.prototype.getProperty=function(e){return Bn.getProperty(e,this._properties,this._class)};wp.prototype.setProperty=function(e,t){return Bn.setProperty(e,t,this._properties,this._class)};wp.prototype.getPropertyBySemantic=function(e){return Bn.getPropertyBySemantic(e,this._properties,this._class)};wp.prototype.setPropertyBySemantic=function(e,t){return Bn.setPropertyBySemantic(e,t,this._properties,this._class)};var VG=wp;function nce(e){e=y(e,y.EMPTY_OBJECT);let t=e.metadataJson,n=e.schema;A.typeOf.object("options.metadataJson",t),A.typeOf.object("options.schema",n);let i=y(t.metadata,t.tileset),o;c(i)&&(o=new VG({tileset:i,class:n.classes[i.class]}));let r=[],s=[],a=t.groups;if(Array.isArray(a)){let l=a.length;for(let u=0;u<l;u++){let f=a[u];s.push(new F1({group:f,class:n.classes[f.class]}))}}else if(c(a)){r=Object.keys(a).sort();let l=r.length;for(let u=0;u<l;u++){let f=r[u];if(a.hasOwnProperty(f)){let d=a[f];s.push(new F1({id:f,group:a[f],class:n.classes[d.class]}))}}}this._schema=n,this._groups=s,this._groupIds=r,this._tileset=o,this._statistics=t.statistics,this._extras=t.extras,this._extensions=t.extensions}Object.defineProperties(nce.prototype,{schema:{get:function(){return this._schema}},groups:{get:function(){return this._groups}},groupIds:{get:function(){return this._groupIds}},tileset:{get:function(){return this._tileset}},statistics:{get:function(){return this._statistics}},extras:{get:function(){return this._extras}},extensions:{get:function(){return this._extensions}}});var Ww=nce;var ice={},L9e=new h;ice.checkChildrenWithinParent=function(e){A.typeOf.object("tile",e);let t=e.children,n=t.length,i=e.boundingVolume;if(i instanceof dd||i instanceof wh){let o=i._orientedBoundingBox;e._optimChildrenWithinParent=Eh.USE_OPTIMIZATION;for(let r=0;r<n;++r){let a=t[r].boundingVolume;if(!(a instanceof dd||a instanceof wh)){e._optimChildrenWithinParent=Eh.SKIP_OPTIMIZATION;break}let l=a._orientedBoundingBox,u=h.subtract(l.center,o.center,L9e),f=h.magnitude(u);h.divideByScalar(u,f,u);let d=Math.abs(o.halfAxes[0]*u.x)+Math.abs(o.halfAxes[1]*u.y)+Math.abs(o.halfAxes[2]*u.z)+Math.abs(o.halfAxes[3]*u.x)+Math.abs(o.halfAxes[4]*u.y)+Math.abs(o.halfAxes[5]*u.z)+Math.abs(o.halfAxes[6]*u.x)+Math.abs(o.halfAxes[7]*u.y)+Math.abs(o.halfAxes[8]*u.z),p=Math.abs(l.halfAxes[0]*u.x)+Math.abs(l.halfAxes[1]*u.y)+Math.abs(l.halfAxes[2]*u.z)+Math.abs(l.halfAxes[3]*u.x)+Math.abs(l.halfAxes[4]*u.y)+Math.abs(l.halfAxes[5]*u.z)+Math.abs(l.halfAxes[6]*u.x)+Math.abs(l.halfAxes[7]*u.y)+Math.abs(l.halfAxes[8]*u.z);if(d<=p+f){e._optimChildrenWithinParent=Eh.SKIP_OPTIMIZATION;break}}}return e._optimChildrenWithinParent===Eh.USE_OPTIMIZATION};var UG=ice;function qw(){this.head=void 0,this.tail=void 0,this._length=0}Object.defineProperties(qw.prototype,{length:{get:function(){return this._length}}});function N9e(e,t,n){this.item=e,this.previous=t,this.next=n}qw.prototype.add=function(e){let t=new N9e(e,this.tail,void 0);return c(this.tail)?(this.tail.next=t,this.tail=t):(this.head=t,this.tail=t),++this._length,t};function oce(e,t){c(t.previous)&&c(t.next)?(t.previous.next=t.next,t.next.previous=t.previous):c(t.previous)?(t.previous.next=void 0,e.tail=t.previous):c(t.next)?(t.next.previous=void 0,e.head=t.next):(e.head=void 0,e.tail=void 0),t.next=void 0,t.previous=void 0}qw.prototype.remove=function(e){c(e)&&(oce(this,e),--this._length)};qw.prototype.splice=function(e,t){if(e===t)return;oce(this,t);let n=e.next;e.next=t,this.tail===e?this.tail=t:n.previous=t,t.next=n,t.previous=e};var zG=qw;function Y0(){this._list=new zG,this._sentinel=this._list.add(),this._trimTiles=!1}Y0.prototype.reset=function(){this._list.splice(this._list.tail,this._sentinel)};Y0.prototype.touch=function(e){let t=e.cacheNode;c(t)&&this._list.splice(this._sentinel,t)};Y0.prototype.add=function(e){c(e.cacheNode)||(e.cacheNode=this._list.add(e))};Y0.prototype.unloadTile=function(e,t,n){let i=t.cacheNode;c(i)&&(this._list.remove(i),t.cacheNode=void 0,n(e,t))};Y0.prototype.unloadTiles=function(e,t){let n=this._trimTiles;this._trimTiles=!1;let i=this._list,o=this._sentinel,r=i.head;for(;r!==o&&(e.totalMemoryUsageInBytes>e.cacheBytes||n);){let s=r.item;r=r.next,this.unloadTile(e,s,t)}};Y0.prototype.trim=function(){this._trimTiles=!0};var HG=Y0;function B1(e){this.tilePropertyName=e,this._minimum=Number.MAX_VALUE,this._maximum=-Number.MAX_VALUE,this._previousMinimum=Number.MAX_VALUE,this._previousMaximum=-Number.MAX_VALUE,this._referenceMinimum={},this._referenceMaximum={}}function jG(e,t){let n;return t==="_loadTimestamp"?n=J.toDate(e).getTime():n=e,n}B1.prototype.setReferenceMinimumMaximum=function(e,t,n){this._referenceMinimum[n]=jG(e,n),this._referenceMaximum[n]=jG(t,n)};function F9e(e,t){let n=e.tilePropertyName;if(c(n)){let i=jG(t[n],n);return c(i)?(e._maximum=Math.max(i,e._maximum),e._minimum=Math.min(i,e._minimum),i):(e.tilePropertyName=void 0,i)}}var GG=[new j(.1,.1,.1,1),new j(.153,.278,.878,1),new j(.827,.231,.49,1),new j(.827,.188,.22,1),new j(1,.592,.259,1),new j(1,.843,0,1)];B1.prototype.colorize=function(e,t){let n=this.tilePropertyName;if(!c(n)||!e.contentAvailable||e._selectedFrame!==t.frameNumber)return;let i=F9e(this,e),o=this._previousMinimum,r=this._previousMaximum;if(o===Number.MAX_VALUE||r===-Number.MAX_VALUE)return;let s=r-o+R.EPSILON7,l=R.clamp(i-o,0,s)/s,u=GG.length-1,f=l*u,d=Math.floor(f),p=Math.ceil(f),g=f-d,m=GG[d],b=GG[p],x=j.clone(j.WHITE);x.red=R.lerp(m.red,b.red,g),x.green=R.lerp(m.green,b.green,g),x.blue=R.lerp(m.blue,b.blue,g),e._debugColor=x};B1.prototype.resetMinimumMaximum=function(){let e=this.tilePropertyName;if(c(e)){let t=this._referenceMinimum[e],n=this._referenceMaximum[e],i=c(t)&&c(n);this._previousMinimum=i?t:this._minimum,this._previousMaximum=i?n:this._maximum,this._minimum=Number.MAX_VALUE,this._maximum=-Number.MAX_VALUE}};var WG=B1;function QT(){this.selected=0,this.visited=0,this.numberOfCommands=0,this.numberOfAttemptedRequests=0,this.numberOfPendingRequests=0,this.numberOfTilesProcessing=0,this.numberOfTilesWithContentReady=0,this.numberOfTilesTotal=0,this.numberOfLoadedTilesTotal=0,this.numberOfFeaturesSelected=0,this.numberOfFeaturesLoaded=0,this.numberOfPointsSelected=0,this.numberOfPointsLoaded=0,this.numberOfTrianglesSelected=0,this.numberOfTilesStyled=0,this.numberOfFeaturesStyled=0,this.numberOfTilesCulledWithChildrenUnion=0,this.geometryByteLength=0,this.texturesByteLength=0,this.batchTableByteLength=0}QT.prototype.clear=function(){this.selected=0,this.visited=0,this.numberOfCommands=0,this.numberOfAttemptedRequests=0,this.numberOfFeaturesSelected=0,this.numberOfPointsSelected=0,this.numberOfTrianglesSelected=0,this.numberOfTilesStyled=0,this.numberOfFeaturesStyled=0,this.numberOfTilesCulledWithChildrenUnion=0};function k1(e,t,n,i){let o=t.innerContents,r=t.pointsLength,s=t.trianglesLength,a=t.featuresLength,l=t.geometryByteLength,u=t.texturesByteLength,f=t.batchTableByteLength;if(i?(e.numberOfFeaturesLoaded+=n?-a:a,e.numberOfPointsLoaded+=n?-r:r,e.geometryByteLength+=n?-l:l,e.texturesByteLength+=n?-u:u,e.batchTableByteLength+=n?-f:f):(e.numberOfFeaturesSelected+=n?-a:a,e.numberOfPointsSelected+=n?-r:r,e.numberOfTrianglesSelected+=n?-s:s),c(o)){let d=o.length;for(let p=0;p<d;++p)k1(e,o[p],n,i)}}QT.prototype.incrementSelectionCounts=function(e){k1(this,e,!1,!1)};QT.prototype.incrementLoadCounts=function(e){k1(this,e,!1,!0)};QT.prototype.decrementLoadCounts=function(e){k1(this,e,!0,!0)};QT.clone=function(e,t){t.selected=e.selected,t.visited=e.visited,t.numberOfCommands=e.numberOfCommands,t.selected=e.selected,t.numberOfAttemptedRequests=e.numberOfAttemptedRequests,t.numberOfPendingRequests=e.numberOfPendingRequests,t.numberOfTilesProcessing=e.numberOfTilesProcessing,t.numberOfTilesWithContentReady=e.numberOfTilesWithContentReady,t.numberOfTilesTotal=e.numberOfTilesTotal,t.numberOfFeaturesSelected=e.numberOfFeaturesSelected,t.numberOfFeaturesLoaded=e.numberOfFeaturesLoaded,t.numberOfPointsSelected=e.numberOfPointsSelected,t.numberOfPointsLoaded=e.numberOfPointsLoaded,t.numberOfTrianglesSelected=e.numberOfTrianglesSelected,t.numberOfTilesStyled=e.numberOfTilesStyled,t.numberOfFeaturesStyled=e.numberOfFeaturesStyled,t.numberOfTilesCulledWithChildrenUnion=e.numberOfTilesCulledWithChildrenUnion,t.geometryByteLength=e.geometryByteLength,t.texturesByteLength=e.texturesByteLength,t.batchTableByteLength=e.batchTableByteLength};var X0=QT;function Yw(){this._style=void 0,this._styleDirty=!1,this._lastStyleTime=0}Object.defineProperties(Yw.prototype,{style:{get:function(){return this._style},set:function(e){e!==this._style&&(this._style=e,this._styleDirty=!0)}}});Yw.prototype.makeDirty=function(){this._styleDirty=!0};Yw.prototype.resetDirty=function(){this._styleDirty=!1};Yw.prototype.applyStyle=function(e){if(!c(e.root)||c(this._style)&&!this._style._ready)return;let t=this._styleDirty;t&&++this._lastStyleTime;let n=this._lastStyleTime,i=e._statistics,o=t?e._selectedTiles:e._selectedTilesToStyle,r=o.length;for(let s=0;s<r;++s){let a=o[s];if(a.lastStyleTime!==n){let l=a.content;a.lastStyleTime=n,l.applyStyle(this._style),i.numberOfFeaturesStyled+=l.featuresLength,++i.numberOfTilesStyled}}};var qG=Yw;function B9e(e,t,n){let i=si(t,"3DTILES_implicit_tiling")?t.extensions["3DTILES_implicit_tiling"]:t.implicitTiling;A.typeOf.object("implicitTiling",i),this.baseResource=e,this.geometricError=t.geometricError,this.metadataSchema=n;let o=t.boundingVolume;if(!c(o.box)&&!c(o.region)&&!si(o,"3DTILES_bounding_volume_S2")&&!si(o,"3DTILES_bounding_volume_cylinder"))throw new ue("Only box, region, 3DTILES_bounding_volume_S2, and 3DTILES_bounding_volume_cylinder are supported for implicit tiling");this.boundingVolume=o,this.refine=t.refine,this.subtreeUriTemplate=new De({url:i.subtrees.uri}),this.contentUriTemplates=[],this.contentHeaders=[];let r=k9e(t);for(let s=0;s<r.length;s++){let a=r[s];this.contentHeaders.push(qe(a,!0));let l=new De({url:a.uri});this.contentUriTemplates.push(l)}this.contentCount=this.contentHeaders.length,this.tileHeader=V9e(t),this.subdivisionScheme=_r[i.subdivisionScheme],this.branchingFactor=_r.getBranchingFactor(this.subdivisionScheme),this.subtreeLevels=i.subtreeLevels,c(i.availableLevels)?this.availableLevels=i.availableLevels:this.availableLevels=i.maximumLevel+1}function k9e(e){if(si(e,"3DTILES_multiple_contents")){let t=e.extensions["3DTILES_multiple_contents"];return c(t.contents)?t.contents:t.content}return c(e.contents)?e.contents:c(e.content)?[e.content]:[]}function V9e(e){let t=qe(e,!0);return c(t.extensions)&&(delete t.extensions["3DTILES_implicit_tiling"],delete t.extensions["3DTILES_multiple_contents"],Object.keys(t.extensions).length===0&&delete t.extensions),delete t.implicitTiling,delete t.contents,delete t.content,t}var Xw=B9e;var Kw={};function rce(e){return e=(e^e<<8)&16711935,e=(e^e<<4)&252645135,e=(e^e<<2)&858993459,e=(e^e<<1)&1431655765,e}function YG(e){return e=(e^e<<16)&50331903,e=(e^e<<8)&50393103,e=(e^e<<4)&51130563,e=(e^e<<2)&153391689,e}function sce(e){return e&=1431655765,e=(e^e>>1)&858993459,e=(e^e>>2)&252645135,e=(e^e>>4)&16711935,e=(e^e>>8)&65535,e}function XG(e){return e&=153391689,e=(e^e>>2)&51130563,e=(e^e>>4)&50393103,e=(e^e>>8)&4278190335,e=(e^e>>16)&1023,e}Kw.encode2D=function(e,t){if(A.typeOf.number("x",e),A.typeOf.number("y",t),e<0||e>65535||t<0||t>65535)throw new E("inputs must be 16-bit unsigned integers");return(rce(e)|rce(t)<<1)>>>0};Kw.decode2D=function(e,t){if(A.typeOf.number("mortonIndex",e),e<0||e>4294967295)throw new E("input must be a 32-bit unsigned integer");return c(t)||(t=new Array(2)),t[0]=sce(e),t[1]=sce(e>>1),t};Kw.encode3D=function(e,t,n){if(A.typeOf.number("x",e),A.typeOf.number("y",t),A.typeOf.number("z",n),e<0||e>1023||t<0||t>1023||n<0||n>1023)throw new E("inputs must be 10-bit unsigned integers");return YG(e)|YG(t)<<1|YG(n)<<2};Kw.decode3D=function(e,t){if(A.typeOf.number("mortonIndex",e),e<0||e>1073741823)throw new E("input must be a 30-bit unsigned integer");return c(t)||(t=new Array(3)),t[0]=XG(e),t[1]=XG(e>>1),t[2]=XG(e>>2),t};var eA=Kw;function Mo(e){if(A.typeOf.string("options.subdivisionScheme",e.subdivisionScheme),A.typeOf.number("options.subtreeLevels",e.subtreeLevels),A.typeOf.number("options.level",e.level),A.typeOf.number("options.x",e.x),A.typeOf.number("options.y",e.y),e.subdivisionScheme===_r.OCTREE&&A.typeOf.number("options.z",e.z),e.level<0)throw new E("level must be non-negative");if(e.x<0)throw new E("x must be non-negative");if(e.y<0)throw new E("y must be non-negative");if(e.subdivisionScheme===_r.OCTREE&&e.z<0)throw new E("z must be non-negative");let t=1<<e.level;if(e.x>=t)throw new E("x is out of range");if(e.y>=t)throw new E("y is out of range");if(e.subdivisionScheme===_r.OCTREE&&e.z>=t)throw new E("z is out of range");this.subdivisionScheme=e.subdivisionScheme,this.subtreeLevels=e.subtreeLevels,this.level=e.level,this.x=e.x,this.y=e.y,this.z=void 0,e.subdivisionScheme===_r.OCTREE&&(this.z=e.z)}Object.defineProperties(Mo.prototype,{childIndex:{get:function(){let e=0;return e|=this.x&1,e|=(this.y&1)<<1,this.subdivisionScheme===_r.OCTREE&&(e|=(this.z&1)<<2),e}},mortonIndex:{get:function(){return this.subdivisionScheme===_r.OCTREE?eA.encode3D(this.x,this.y,this.z):eA.encode2D(this.x,this.y)}},tileIndex:{get:function(){let e=this.subdivisionScheme===_r.OCTREE?((1<<3*this.level)-1)/7:((1<<2*this.level)-1)/3,t=this.mortonIndex;return e+t}}});function KG(e,t){if(e.subdivisionScheme!==t.subdivisionScheme)throw new E("coordinates must have same subdivisionScheme");if(e.subtreeLevels!==t.subtreeLevels)throw new E("coordinates must have same subtreeLevels")}Mo.prototype.getDescendantCoordinates=function(e){A.typeOf.object("offsetCoordinates",e),KG(this,e);let t=this.level+e.level,n=(this.x<<e.level)+e.x,i=(this.y<<e.level)+e.y;if(this.subdivisionScheme===_r.OCTREE){let o=(this.z<<e.level)+e.z;return new Mo({subdivisionScheme:this.subdivisionScheme,subtreeLevels:this.subtreeLevels,level:t,x:n,y:i,z:o})}return new Mo({subdivisionScheme:this.subdivisionScheme,subtreeLevels:this.subtreeLevels,level:t,x:n,y:i})};Mo.prototype.getAncestorCoordinates=function(e){if(A.typeOf.number("offsetLevels",e),e<0)throw new E("offsetLevels must be non-negative");if(e>this.level)throw new E("ancestor cannot be above the tileset root");let t=1<<e,n=this.level-e,i=Math.floor(this.x/t),o=Math.floor(this.y/t);if(this.subdivisionScheme===_r.OCTREE){let r=Math.floor(this.z/t);return new Mo({subdivisionScheme:this.subdivisionScheme,subtreeLevels:this.subtreeLevels,level:n,x:i,y:o,z:r})}return new Mo({subdivisionScheme:this.subdivisionScheme,subtreeLevels:this.subtreeLevels,level:n,x:i,y:o})};Mo.prototype.getOffsetCoordinates=function(e){if(A.typeOf.object("descendantCoordinates",e),!this.isEqual(e)&&!this.isAncestor(e))throw new E("this is not an ancestor of descendant");KG(this,e);let t=e.level-this.level,n=1<<t,i=e.x%n,o=e.y%n;if(this.subdivisionScheme===_r.OCTREE){let r=e.z%n;return new Mo({subdivisionScheme:this.subdivisionScheme,subtreeLevels:this.subtreeLevels,level:t,x:i,y:o,z:r})}return new Mo({subdivisionScheme:this.subdivisionScheme,subtreeLevels:this.subtreeLevels,level:t,x:i,y:o})};Mo.prototype.getChildCoordinates=function(e){A.typeOf.number("childIndex",e);let t=_r.getBranchingFactor(this.subdivisionScheme);if(e<0||t<=e)throw new E(`childIndex must be at least 0 and less than ${t}`);let n=this.level+1,i=2*this.x+e%2,o=2*this.y+Math.floor(e/2)%2;if(this.subdivisionScheme===_r.OCTREE){let r=2*this.z+Math.floor(e/4)%2;return new Mo({subdivisionScheme:this.subdivisionScheme,subtreeLevels:this.subtreeLevels,level:n,x:i,y:o,z:r})}return new Mo({subdivisionScheme:this.subdivisionScheme,subtreeLevels:this.subtreeLevels,level:n,x:i,y:o})};Mo.prototype.getSubtreeCoordinates=function(){return this.getAncestorCoordinates(this.level%this.subtreeLevels)};Mo.prototype.getParentSubtreeCoordinates=function(){return this.getAncestorCoordinates(this.level%this.subtreeLevels+this.subtreeLevels)};Mo.prototype.isAncestor=function(e){A.typeOf.object("descendantCoordinates",e),KG(this,e);let t=e.level-this.level;if(t<=0)return!1;let n=e.x>>t,i=e.y>>t,o=this.x===n,r=this.y===i;if(this.subdivisionScheme===_r.OCTREE){let s=e.z>>t,a=this.z===s;return o&&r&&a}return o&&r};Mo.prototype.isEqual=function(e){return A.typeOf.object("otherCoordinates",e),this.subdivisionScheme===e.subdivisionScheme&&this.subtreeLevels===e.subtreeLevels&&this.level===e.level&&this.x===e.x&&this.y===e.y&&(this.subdivisionScheme===_r.OCTREE?this.z===e.z:!0)};Mo.prototype.isImplicitTilesetRoot=function(){return this.level===0};Mo.prototype.isSubtreeRoot=function(){return this.level%this.subtreeLevels===0};Mo.prototype.isBottomOfSubtree=function(){return this.level%this.subtreeLevels===this.subtreeLevels-1};Mo.prototype.getTemplateValues=function(){let e={level:this.level,x:this.x,y:this.y};return this.subdivisionScheme===_r.OCTREE&&(e.z=this.z),e};var ace=[0,0,0];Mo.fromMortonIndex=function(e,t,n,i){let o;return e===_r.OCTREE?(o=eA.decode3D(i,ace),new Mo({subdivisionScheme:e,subtreeLevels:t,level:n,x:o[0],y:o[1],z:o[2]})):(o=eA.decode2D(i,ace),new Mo({subdivisionScheme:e,subtreeLevels:t,level:n,x:o[0],y:o[1]}))};Mo.fromTileIndex=function(e,t,n){let i,o,r;return e===_r.OCTREE?(i=Math.floor(R.log2(7*n+1)/3),o=((1<<3*i)-1)/7,r=n-o):(i=Math.floor(R.log2(3*n+1)/2),o=((1<<2*i)-1)/3,r=n-o),Mo.fromMortonIndex(e,t,i,r)};var $w=Mo;function vp(){}vp.selectTiles=function(e,t){E.throwInstantiationError()};vp.sortChildrenByDistanceToCamera=function(e,t){return t._distanceToCamera===0&&e._distanceToCamera===0?t._centerZDepth-e._centerZDepth:t._distanceToCamera-e._distanceToCamera};vp.canTraverse=function(e){return e.children.length===0?!1:e.hasTilesetContent||e.hasImplicitContent?!e.contentExpired:e._screenSpaceError>e.tileset.memoryAdjustedScreenSpaceError};vp.selectTile=function(e,t){if(e.contentVisibility(t)===qt.OUTSIDE)return;e._wasSelectedLastFrame=!0;let{content:n,tileset:i}=e;n.featurePropertiesDirty?(n.featurePropertiesDirty=!1,e.lastStyleTime=0,i._selectedTilesToStyle.push(e)):e._selectedFrame<t.frameNumber-1&&(i._selectedTilesToStyle.push(e),e._wasSelectedLastFrame=!1),e._selectedFrame=t.frameNumber,i._selectedTiles.push(e)};vp.visitTile=function(e,t){++e.tileset._statistics.visited,e._visitedFrame=t.frameNumber};vp.touchTile=function(e,t){e._touchedFrame!==t.frameNumber&&(e.tileset._cache.touch(e),e._touchedFrame=t.frameNumber)};vp.loadTile=function(e,t){let{tileset:n}=e;if(e._requestedFrame===t.frameNumber||!e.hasUnloadedRenderableContent&&!e.contentExpired||!U9e(e,t))return;let i=t.camera.timeSinceMoved<n.foveatedTimeDelay;e.priorityDeferred&&i||(e._requestedFrame=t.frameNumber,n._requestedTiles.push(e))};function U9e(e,t){let{tileset:n}=e;if(!n._cullRequestsWhileMoving)return!0;let{positionWCDeltaMagnitude:i,positionWCDeltaMagnitudeLastFrame:o}=t.camera,r=i!==0?i:o,s=Math.max(e.boundingSphere.radius*2,1);return n.cullRequestsWhileMovingMultiplier*r/s<1}vp.updateTile=function(e,t){cce(e,t),e.updateExpiration(),e._wasMinPriorityChild=!1,e._priorityHolder=e,G9e(e),e._shouldSelect=!1,e._finalResolution=!0};function cce(e,t){if(e.updateVisibility(t),!e.isVisible)return;let n=e.children.length>0;if((e.hasTilesetContent||e.hasImplicitContent)&&n){let r=e.children[0];cce(r,t),e._visible=r._visible;return}if(z9e(e,t)){e._visible=!1;return}let i=e.refine===nr.REPLACE,o=e._optimChildrenWithinParent===Eh.USE_OPTIMIZATION;if(i&&o&&n&&!H9e(e,t)){++e.tileset._statistics.numberOfTilesCulledWithChildrenUnion,e._visible=!1;return}}function z9e(e,t){let{parent:n,tileset:i}=e;return!c(n)||n.hasTilesetContent||n.hasImplicitContent||n.refine!==nr.ADD?!1:e.getScreenSpaceError(t,!0)<=i.memoryAdjustedScreenSpaceError}function H9e(e,t){let n=!1,i=e.children;for(let o=0;o<i.length;++o){let r=i[o];r.updateVisibility(t),n=n||r.isVisible}return n}function G9e(e){let t=e.tileset._minimumPriority,n=e.tileset._maximumPriority,i=e._priorityHolder;n.distance=Math.max(i._distanceToCamera,n.distance),t.distance=Math.min(i._distanceToCamera,t.distance),n.depth=Math.max(e._depth,n.depth),t.depth=Math.min(e._depth,t.depth),n.foveatedFactor=Math.max(i._foveatedFactor,n.foveatedFactor),t.foveatedFactor=Math.min(i._foveatedFactor,t.foveatedFactor),n.reverseScreenSpaceError=Math.max(e._priorityReverseScreenSpaceError,n.reverseScreenSpaceError),t.reverseScreenSpaceError=Math.min(e._priorityReverseScreenSpaceError,t.reverseScreenSpaceError)}var ma=vp;function lce(){}var Zw={stack:new Bl,stackMaximumLength:0};lce.selectTiles=function(e,t){e._selectedTiles.length=0,e._requestedTiles.length=0,e.hasMixedContent=!1;let n=!0,i=e.root;if(i.updateVisibility(t),!i.isVisible)return n;let{touchTile:o,visitTile:r}=ma,s=Zw.stack;for(s.push(i);s.length>0;){Zw.stackMaximumLength=Math.max(Zw.stackMaximumLength,s.length);let a=s.pop(),l=a.refine===nr.ADD,u=a.refine===nr.REPLACE,f=j9e(a);f&&W9e(a,s,t),(l||u&&!f)&&(q9e(e,a),o(a,t),Y9e(a,t),a.hasRenderableContent&&!a.contentAvailable&&(n=!1)),r(a,t)}return Zw.stack.trim(Zw.stackMaximumLength),n};function j9e(e){return e.children.length===0?!1:e.hasTilesetContent||e.hasImplicitContent?!e.contentExpired:(e.hasEmptyContent,!0)}function W9e(e,t,n){let{children:i}=e;for(let o=0;o<i.length;++o){let r=i[o];r.updateVisibility(n),r.isVisible&&t.push(r)}}function q9e(e,t){(t.hasUnloadedRenderableContent||t.contentExpired)&&(t._priority=0,e._requestedTiles.push(t))}function Y9e(e,t){e.contentAvailable&&e.contentVisibility(t)!==qt.OUTSIDE&&e.tileset._selectedTiles.push(e)}var $G=lce;function uce(){}var Jw={stack:new Bl,stackMaximumLength:0},Qw={stack:new Bl,stackMaximumLength:0};uce.selectTiles=function(e,t){if(e._requestedTiles.length=0,e.debugFreezeFrame)return;e._selectedTiles.length=0,e._selectedTilesToStyle.length=0,e._emptyTiles.length=0,e.hasMixedContent=!1;let n=e.root;if(ma.updateTile(n,t),!n.isVisible||n.getScreenSpaceError(t,!0)<=e.memoryAdjustedScreenSpaceError)return;K9e(n,t),Jw.stack.trim(Jw.stackMaximumLength),Qw.stack.trim(Qw.stackMaximumLength);let i=e._requestedTiles;for(let o=0;o<i.length;++o)i[o].updatePriority()};function ZG(e,t){e.contentAvailable&&ma.selectTile(e,t)}function X9e(e,t,n){let i=e.refine===nr.REPLACE,{tileset:o,children:r}=e,{updateTile:s,loadTile:a,touchTile:l}=ma;for(let m=0;m<r.length;++m)s(r[m],n);r.sort(ma.sortChildrenByDistanceToCamera);let u=i&&e.hasRenderableContent,f=!0,d=!1,p=-1,g=Number.MAX_VALUE;for(let m=0;m<r.length;++m){let b=r[m];if(b.isVisible?(t.push(b),b._foveatedFactor<g&&(p=m,g=b._foveatedFactor),d=!0):(u||o.loadSiblings)&&(b._foveatedFactor<g&&(p=m,g=b._foveatedFactor),a(b,n),l(b,n)),u){let x;b._inRequestVolume?b.hasRenderableContent?x=b.contentAvailable:x=$9e(b,n):x=!1,f=f&&x}}if(d||(f=!1),p!==-1&&i){let m=r[p];m._wasMinPriorityChild=!0;let b=(e._wasMinPriorityChild||e===o.root)&&g<=e._priorityHolder._foveatedFactor?e._priorityHolder:e;b._foveatedFactor=Math.min(m._foveatedFactor,b._foveatedFactor),b._distanceToCamera=Math.min(m._distanceToCamera,b._distanceToCamera);for(let x=0;x<r.length;++x)r[x]._priorityHolder=b}return f}function K9e(e,t){let{tileset:n}=e,{canTraverse:i,loadTile:o,visitTile:r,touchTile:s}=ma,a=Jw.stack;for(a.push(e);a.length>0;){Jw.stackMaximumLength=Math.max(Jw.stackMaximumLength,a.length);let l=a.pop(),u=l.parent,f=!c(u)||u._refines;l._refines=i(l)?X9e(l,a,t)&&f:!1;let d=!l._refines&&f;l.hasRenderableContent?l.refine===nr.ADD?(ZG(l,t),o(l,t)):l.refine===nr.REPLACE&&(o(l,t),d&&ZG(l,t)):(n._emptyTiles.push(l),o(l,t),d&&ZG(l,t)),r(l,t),s(l,t)}}function $9e(e,t){let{canTraverse:n,updateTile:i,loadTile:o,touchTile:r}=ma,s=!0,a=Qw.stack;for(a.push(e);a.length>0;){Qw.stackMaximumLength=Math.max(Qw.stackMaximumLength,a.length);let l=a.pop(),u=l.children,f=u.length,d=!l.hasRenderableContent&&n(l);if(!d&&!l.contentAvailable&&(s=!1),i(l,t),l.isVisible||(o(l,t),r(l,t)),d)for(let p=0;p<f;++p){let g=u[p];a.push(g)}}return e.hasEmptyContent||s}var JG=uce;function fce(){}var ev={stack:new Bl,stackMaximumLength:0},tv={stack:new Bl,stackMaximumLength:0},Dp={stack:new Bl,stackMaximumLength:0,ancestorStack:new Bl,ancestorStackMaximumLength:0},Z9e=2;fce.selectTiles=function(e,t){if(e._requestedTiles.length=0,e.debugFreezeFrame)return;e._selectedTiles.length=0,e._selectedTilesToStyle.length=0,e._emptyTiles.length=0,e.hasMixedContent=!1;let n=e.root;if(ma.updateTile(n,t),!n.isVisible||n.getScreenSpaceError(t,!0)<=e.memoryAdjustedScreenSpaceError)return;iWe(n,t),oWe(n,t),ev.stack.trim(ev.stackMaximumLength),tv.stack.trim(tv.stackMaximumLength),Dp.stack.trim(Dp.stackMaximumLength),Dp.ancestorStack.trim(Dp.ancestorStackMaximumLength);let i=e._requestedTiles;for(let o=0;o<i.length;++o)i[o].updatePriority()};function J9e(e,t){let{updateTile:n,touchTile:i,selectTile:o}=ma,r=tv.stack;for(r.push(e);r.length>0;){tv.stackMaximumLength=Math.max(tv.stackMaximumLength,r.length);let a=r.pop().children;for(let l=0;l<a.length;++l){let u=a[l];u.isVisible&&(u.contentAvailable?(n(u,t),i(u,t),o(u,t)):u._depth-e._depth<Z9e&&r.push(u))}}}function V1(e,t){let n=e.contentAvailable?e:e._ancestorWithContentAvailable;c(n)?n._shouldSelect=!0:J9e(e,t)}function Q9e(e,t){e._ancestorWithContent=void 0,e._ancestorWithContentAvailable=void 0;let{parent:n}=e;if(!c(n))return;let i=!n.hasUnloadedRenderableContent||n._requestedFrame===t.frameNumber;e._ancestorWithContent=i?n:n._ancestorWithContent,e._ancestorWithContentAvailable=n.contentAvailable?n:n._ancestorWithContentAvailable}function eWe(e,t){let n=t._ancestorWithContent;return!e.immediatelyLoadDesiredLevelOfDetail&&(t._priorityProgressiveResolutionScreenSpaceErrorLeaf||c(n)&&t._screenSpaceError<n._screenSpaceError/e.skipScreenSpaceErrorFactor&&t._depth>n._depth+e.skipLevels)}function tWe(e,t,n){let{tileset:i,children:o}=e,{updateTile:r,loadTile:s,touchTile:a}=ma;for(let u=0;u<o.length;++u)r(o[u],n);o.sort(ma.sortChildrenByDistanceToCamera);let l=!1;for(let u=0;u<o.length;++u){let f=o[u];f.isVisible?(t.push(f),l=!0):i.loadSiblings&&(s(f,n),a(f,n))}return l}function nWe(e,t){let{tileset:n}=e;return n.immediatelyLoadDesiredLevelOfDetail?!1:c(e._ancestorWithContent)?e._screenSpaceError===0?e.parent._screenSpaceError>t:e._screenSpaceError>t:!0}function iWe(e,t){let{tileset:n}=e,i=n.immediatelyLoadDesiredLevelOfDetail?Number.MAX_VALUE:Math.max(n.baseScreenSpaceError,n.memoryAdjustedScreenSpaceError),{canTraverse:o,loadTile:r,visitTile:s,touchTile:a}=ma,l=ev.stack;for(l.push(e);l.length>0;){ev.stackMaximumLength=Math.max(ev.stackMaximumLength,l.length);let u=l.pop();Q9e(u,t);let f=u.parent,d=!c(f)||f._refines;u._refines=o(u)?tWe(u,l,t)&&d:!1;let p=!u._refines&&d;u.hasRenderableContent?u.refine===nr.ADD?(V1(u,t),r(u,t)):u.refine===nr.REPLACE&&(nWe(u,i)?(r(u,t),p&&V1(u,t)):p?(V1(u,t),r(u,t)):eWe(n,u)&&r(u,t)):(n._emptyTiles.push(u),r(u,t),p&&V1(u,t)),s(u,t),a(u,t)}}function oWe(e,t){let{selectTile:n,canTraverse:i}=ma,{stack:o,ancestorStack:r}=Dp,s;for(o.push(e);o.length>0||r.length>0;){if(Dp.stackMaximumLength=Math.max(Dp.stackMaximumLength,o.length),Dp.ancestorStackMaximumLength=Math.max(Dp.ancestorStackMaximumLength,r.length),r.length>0){let u=r.peek();if(u._stackLength===o.length){r.pop(),u!==s&&(u._finalResolution=!1),n(u,t);continue}}let a=o.pop();if(!c(a))continue;let l=i(a);if(a._shouldSelect)if(a.refine===nr.ADD)n(a,t);else{if(a._selectionDepth=r.length,a._selectionDepth>0&&(a.tileset.hasMixedContent=!0),s=a,!l){n(a,t);continue}r.push(a),a._stackLength=o.length}if(l){let u=a.children;for(let f=0;f<u.length;++f){let d=u[f];d.isVisible&&o.push(d)}}}}var QG=fce;function Wo(e){e=y(e,y.EMPTY_OBJECT),this._url=void 0,this._basePath=void 0,this._root=void 0,this._resource=void 0,this._asset=void 0,this._properties=void 0,this._geometricError=void 0,this._scaledGeometricError=void 0,this._extensionsUsed=void 0,this._extensions=void 0,this._modelUpAxis=void 0,this._modelForwardAxis=void 0,this._cache=new HG,this._processingQueue=[],this._selectedTiles=[],this._emptyTiles=[],this._requestedTiles=[],this._selectedTilesToStyle=[],this._loadTimestamp=void 0,this._timeSinceLoad=0,this._updatedVisibilityFrame=0,this._updatedModelMatrixFrame=0,this._modelMatrixChanged=!1,this._previousModelMatrix=void 0,this._extras=void 0,this._credits=void 0,this._showCreditsOnScreen=y(e.showCreditsOnScreen,!1),this._cullWithChildrenBounds=y(e.cullWithChildrenBounds,!0),this._allTilesAdditive=!0,this._hasMixedContent=!1,this._stencilClearCommand=void 0,this._backfaceCommands=new Bl,this._maximumScreenSpaceError=y(e.maximumScreenSpaceError,16),this._memoryAdjustedScreenSpaceError=this._maximumScreenSpaceError,this._cacheBytes=y(e.cacheBytes,512*1024*1024),A.typeOf.number.greaterThanOrEquals("cacheBytes",this._cacheBytes,0);let t=y(e.maximumCacheOverflowBytes,512*1024*1024);A.typeOf.number.greaterThanOrEquals("maximumCacheOverflowBytes",t,0),this._maximumCacheOverflowBytes=t,this._styleEngine=new qG,this._styleApplied=!1,this._modelMatrix=c(e.modelMatrix)?k.clone(e.modelMatrix):k.clone(k.IDENTITY),this._addHeightCallbacks=[],this._statistics=new X0,this._statisticsLast=new X0,this._statisticsPerPass=new Array(Ro.NUMBER_OF_PASSES);for(let o=0;o<Ro.NUMBER_OF_PASSES;++o)this._statisticsPerPass[o]=new X0;this._requestedTilesInFlight=[],this._maximumPriority={foveatedFactor:-Number.MAX_VALUE,depth:-Number.MAX_VALUE,distance:-Number.MAX_VALUE,reverseScreenSpaceError:-Number.MAX_VALUE},this._minimumPriority={foveatedFactor:Number.MAX_VALUE,depth:Number.MAX_VALUE,distance:Number.MAX_VALUE,reverseScreenSpaceError:Number.MAX_VALUE},this._heatmap=new WG(e.debugHeatmapTilePropertyName),this.cullRequestsWhileMoving=y(e.cullRequestsWhileMoving,!0),this._cullRequestsWhileMoving=!1,this.cullRequestsWhileMovingMultiplier=y(e.cullRequestsWhileMovingMultiplier,60),this.progressiveResolutionHeightFraction=R.clamp(y(e.progressiveResolutionHeightFraction,.3),0,.5),this.preferLeaves=y(e.preferLeaves,!1),this._tilesLoaded=!1,this._initialTilesLoaded=!1,this._tileDebugLabels=void 0,this._classificationType=e.classificationType,this._ellipsoid=y(e.ellipsoid,ie.WGS84),this._initialClippingPlanesOriginMatrix=k.IDENTITY,this._clippingPlanesOriginMatrix=void 0,this._clippingPlanesOriginMatrixDirty=!0,this._vectorClassificationOnly=y(e.vectorClassificationOnly,!1),this._vectorKeepDecodedPositions=y(e.vectorKeepDecodedPositions,!1),this.preloadWhenHidden=y(e.preloadWhenHidden,!1),this.preloadFlightDestinations=y(e.preloadFlightDestinations,!0),this._pass=void 0,this.dynamicScreenSpaceError=y(e.dynamicScreenSpaceError,!0),this.foveatedScreenSpaceError=y(e.foveatedScreenSpaceError,!0),this._foveatedConeSize=y(e.foveatedConeSize,.1),this._foveatedMinimumScreenSpaceErrorRelaxation=y(e.foveatedMinimumScreenSpaceErrorRelaxation,0),this.foveatedInterpolationCallback=y(e.foveatedInterpolationCallback,R.lerp),this.foveatedTimeDelay=y(e.foveatedTimeDelay,.2),this.dynamicScreenSpaceErrorDensity=y(e.dynamicScreenSpaceErrorDensity,2e-4),this.dynamicScreenSpaceErrorFactor=y(e.dynamicScreenSpaceErrorFactor,24),this.dynamicScreenSpaceErrorHeightFalloff=y(e.dynamicScreenSpaceErrorHeightFalloff,.25),this._dynamicScreenSpaceErrorComputedDensity=0,this.shadows=y(e.shadows,En.ENABLED),this.show=y(e.show,!0),this.colorBlendMode=Vl.HIGHLIGHT,this.colorBlendAmount=.5,this._pointCloudShading=new Z_(e.pointCloudShading),this._pointCloudEyeDomeLighting=new w0,this.loadProgress=new pe,this.allTilesLoaded=new pe,this.initialTilesLoaded=new pe,this.tileLoad=new pe,this.tileUnload=new pe,this.tileFailed=new pe,this.tileVisible=new pe,this.skipLevelOfDetail=y(e.skipLevelOfDetail,!1),this._disableSkipLevelOfDetail=!1,this.baseScreenSpaceError=y(e.baseScreenSpaceError,1024),this.skipScreenSpaceErrorFactor=y(e.skipScreenSpaceErrorFactor,16),this.skipLevels=y(e.skipLevels,1),this.immediatelyLoadDesiredLevelOfDetail=y(e.immediatelyLoadDesiredLevelOfDetail,!1),this.loadSiblings=y(e.loadSiblings,!1),this._clippingPlanes=void 0,c(e.clippingPlanes)&&Ms.setOwner(e.clippingPlanes,this,"_clippingPlanes"),this._clippingPolygons=void 0,c(e.clippingPolygons)&&tp.setOwner(e.clippingPolygons,this,"_clippingPolygons"),c(e.imageBasedLighting)?(this._imageBasedLighting=e.imageBasedLighting,this._shouldDestroyImageBasedLighting=!1):(this._imageBasedLighting=new SS,this._shouldDestroyImageBasedLighting=!0),this._environmentMapManager=new A0(e.environmentMapOptions),this.lightColor=e.lightColor,this.backFaceCulling=y(e.backFaceCulling,!0),this._enableShowOutline=y(e.enableShowOutline,!0),this.showOutline=y(e.showOutline,!0),this.outlineColor=y(e.outlineColor,j.BLACK),this.splitDirection=y(e.splitDirection,$r.NONE),this.enableCollision=y(e.enableCollision,!1),this._projectTo2D=y(e.projectTo2D,!1),this._enablePick=y(e.enablePick,!1),this.debugFreezeFrame=y(e.debugFreezeFrame,!1),this.debugColorizeTiles=y(e.debugColorizeTiles,!1),this._enableDebugWireframe=y(e.enableDebugWireframe,!1),this.debugWireframe=y(e.debugWireframe,!1),this.debugWireframe===!0&&this._enableDebugWireframe===!1&&_t("tileset-debug-wireframe-ignored","enableDebugWireframe must be set to true in the Cesium3DTileset constructor, otherwise debugWireframe will be ignored."),this.debugShowBoundingVolume=y(e.debugShowBoundingVolume,!1),this.debugShowContentBoundingVolume=y(e.debugShowContentBoundingVolume,!1),this.debugShowViewerRequestVolume=y(e.debugShowViewerRequestVolume,!1),this._tileDebugLabels=void 0,this.debugPickedTileLabelOnly=!1,this.debugPickedTile=void 0,this.debugPickPosition=void 0,this.debugShowGeometricError=y(e.debugShowGeometricError,!1),this.debugShowRenderingStatistics=y(e.debugShowRenderingStatistics,!1),this.debugShowMemoryUsage=y(e.debugShowMemoryUsage,!1),this.debugShowUrl=y(e.debugShowUrl,!1),this.examineVectorLinesFunction=void 0,this._metadataExtension=void 0,this._customShader=e.customShader;let n=y(e.featureIdLabel,"featureId_0");typeof n=="number"&&(n=`featureId_${n}`),this._featureIdLabel=n;let i=y(e.instanceFeatureIdLabel,"instanceFeatureId_0");typeof i=="number"&&(i=`instanceFeatureId_${i}`),this._instanceFeatureIdLabel=i}Object.defineProperties(Wo.prototype,{isCesium3DTileset:{get:function(){return!0}},asset:{get:function(){return this._asset}},extensions:{get:function(){return this._extensions}},clippingPlanes:{get:function(){return this._clippingPlanes},set:function(e){Ms.setOwner(e,this,"_clippingPlanes")}},clippingPolygons:{get:function(){return this._clippingPolygons},set:function(e){tp.setOwner(e,this,"_clippingPolygons")}},properties:{get:function(){return this._properties}},tilesLoaded:{get:function(){return this._tilesLoaded}},resource:{get:function(){return this._resource}},basePath:{get:function(){return Ss("Cesium3DTileset.basePath","Cesium3DTileset.basePath has been deprecated. All tiles are relative to the url of the tileset JSON file that contains them. Use the url property instead."),this._basePath}},style:{get:function(){return this._styleEngine.style},set:function(e){this._styleEngine.style=e}},customShader:{get:function(){return this._customShader},set:function(e){this._customShader=e}},hasMixedContent:{get:function(){return this._hasMixedContent},set:function(e){A.typeOf.bool("value",e),this._hasMixedContent=e}},isSkippingLevelOfDetail:{get:function(){return this.skipLevelOfDetail&&!c(this._classificationType)&&!this._disableSkipLevelOfDetail&&!this._allTilesAdditive}},metadataExtension:{get:function(){return this._metadataExtension}},metadata:{get:function(){if(c(this._metadataExtension))return this._metadataExtension.tileset}},schema:{get:function(){if(c(this._metadataExtension))return this._metadataExtension.schema}},maximumScreenSpaceError:{get:function(){return this._maximumScreenSpaceError},set:function(e){A.typeOf.number.greaterThanOrEquals("maximumScreenSpaceError",e,0),this._maximumScreenSpaceError=e,this._memoryAdjustedScreenSpaceError=e}},cacheBytes:{get:function(){return this._cacheBytes},set:function(e){A.typeOf.number.greaterThanOrEquals("value",e,0),this._cacheBytes=e}},maximumCacheOverflowBytes:{get:function(){return this._maximumCacheOverflowBytes},set:function(e){A.typeOf.number.greaterThanOrEquals("value",e,0),this._maximumCacheOverflowBytes=e}},memoryAdjustedScreenSpaceError:{get:function(){return this._memoryAdjustedScreenSpaceError}},pointCloudShading:{get:function(){return this._pointCloudShading},set:function(e){A.defined("pointCloudShading",e),this._pointCloudShading=e}},root:{get:function(){return this._root}},boundingSphere:{get:function(){return this._root.updateTransform(this._modelMatrix),this._root.boundingSphere}},modelMatrix:{get:function(){return this._modelMatrix},set:function(e){this._modelMatrix=k.clone(e,this._modelMatrix)}},timeSinceLoad:{get:function(){return this._timeSinceLoad}},totalMemoryUsageInBytes:{get:function(){let e=this._statistics;return e.texturesByteLength+e.geometryByteLength+e.batchTableByteLength}},clippingPlanesOriginMatrix:{get:function(){return c(this._clippingPlanesOriginMatrix)?(this._clippingPlanesOriginMatrixDirty&&(k.multiply(this.root.computedTransform,this._initialClippingPlanesOriginMatrix,this._clippingPlanesOriginMatrix),this._clippingPlanesOriginMatrixDirty=!1),this._clippingPlanesOriginMatrix):k.IDENTITY}},styleEngine:{get:function(){return this._styleEngine}},statistics:{get:function(){return this._statistics}},classificationType:{get:function(){return this._classificationType}},ellipsoid:{get:function(){return this._ellipsoid}},foveatedConeSize:{get:function(){return this._foveatedConeSize},set:function(e){A.typeOf.number.greaterThanOrEquals("foveatedConeSize",e,0),A.typeOf.number.lessThanOrEquals("foveatedConeSize",e,1),this._foveatedConeSize=e}},foveatedMinimumScreenSpaceErrorRelaxation:{get:function(){return this._foveatedMinimumScreenSpaceErrorRelaxation},set:function(e){A.typeOf.number.greaterThanOrEquals("foveatedMinimumScreenSpaceErrorRelaxation",e,0),A.typeOf.number.lessThanOrEquals("foveatedMinimumScreenSpaceErrorRelaxation",e,this.maximumScreenSpaceError),this._foveatedMinimumScreenSpaceErrorRelaxation=e}},extras:{get:function(){return this._extras}},imageBasedLighting:{get:function(){return this._imageBasedLighting},set:function(e){A.typeOf.object("imageBasedLighting",this._imageBasedLighting),e!==this._imageBasedLighting&&(this._shouldDestroyImageBasedLighting&&!this._imageBasedLighting.isDestroyed()&&this._imageBasedLighting.destroy(),this._imageBasedLighting=e,this._shouldDestroyImageBasedLighting=!1)}},environmentMapManager:{get:function(){return this._environmentMapManager}},vectorClassificationOnly:{get:function(){return this._vectorClassificationOnly}},vectorKeepDecodedPositions:{get:function(){return this._vectorKeepDecodedPositions}},showCreditsOnScreen:{get:function(){return this._showCreditsOnScreen},set:function(e){this._showCreditsOnScreen=e,bce(this)}},featureIdLabel:{get:function(){return this._featureIdLabel},set:function(e){typeof e=="number"&&(e=`featureId_${e}`),A.typeOf.string("value",e),this._featureIdLabel=e}},instanceFeatureIdLabel:{get:function(){return this._instanceFeatureIdLabel},set:function(e){typeof e=="number"&&(e=`instanceFeatureId_${e}`),A.typeOf.string("value",e),this._instanceFeatureIdLabel=e}}});Wo.fromIonAssetId=async function(e,t){A.defined("assetId",e);let n=await Xf.fromAssetId(e);return Wo.fromUrl(n,t)};Wo.fromUrl=async function(e,t){A.defined("url",e),t=y(t,y.EMPTY_OBJECT);let n=De.createIfNeeded(e),i;n.extension==="json"?i=n.getBaseUri(!0):n.isDataUri&&(i="");let o=await Wo.loadJson(n),r=await rWe(n,o),s=new Wo(t);s._resource=n,s._url=n.url,s._basePath=i,s._metadataExtension=r,s._geometricError=o.geometricError,s._scaledGeometricError=o.geometricError;let a=o.asset;s._asset=a,s._extras=o.extras,bce(s);let l=c(o.asset.gltfUpAxis)?zo.fromName(o.asset.gltfUpAxis):zo.Y,u=y(t.modelUpAxis,l),f=y(t.modelForwardAxis,zo.X);s._properties=o.properties,s._extensionsUsed=o.extensionsUsed,s._extensions=o.extensions,s._modelUpAxis=u,s._modelForwardAxis=f,s._root=s.loadTileset(n,o);let p=s._root.createBoundingVolume(o.root.boundingVolume,k.IDENTITY).boundingSphere.center,g=s._ellipsoid.cartesianToCartographic(p);return c(g)&&g.height>di._defaultMinTerrainHeight&&(s._initialClippingPlanesOriginMatrix=Ft.eastNorthUpToFixedFrame(p)),s._clippingPlanesOriginMatrix=k.clone(s._initialClippingPlanesOriginMatrix),s};Wo.loadJson=function(e){return De.createIfNeeded(e).fetchJson()};Wo.prototype.makeStyleDirty=function(){this._styleEngine.makeDirty()};Wo.prototype.loadTileset=function(e,t,n){let i=t.asset;if(!c(i))throw new ue("Tileset must have an asset property.");if(i.version!=="0.0"&&i.version!=="1.0"&&i.version!=="1.1")throw new ue("The tileset must be 3D Tiles version 0.0, 1.0, or 1.1");c(t.extensionsRequired)&&Wo.checkSupportedExtensions(t.extensionsRequired);let o=this._statistics,r=i.tilesetVersion;c(r)&&(this._basePath+=`?v=${r}`,e=e.clone(),e.setQueryParameters({v:r}));let s=dce(this,e,t.root,n);c(n)&&(n.children.push(s),s._depth=n._depth+1);let a=[];for(a.push(s);a.length>0;){let l=a.pop();++o.numberOfTilesTotal,this._allTilesAdditive=this._allTilesAdditive&&l.refine===nr.ADD;let u=l._header.children;if(c(u))for(let f=0;f<u.length;++f){let d=u[f],p=dce(this,e,d,l);l.children.push(p),p._depth=l._depth+1,a.push(p)}this._cullWithChildrenBounds&&UG.checkChildrenWithinParent(l)}return s};function dce(e,t,n,i){if(!(c(n.implicitTiling)||si(n,"3DTILES_implicit_tiling")))return new Ph(e,t,n,i);let r=e.schema,s=new Xw(t,n,r),a=new $w({subdivisionScheme:s.subdivisionScheme,subtreeLevels:s.subtreeLevels,level:0,x:0,y:0,z:0}),l=s.subtreeUriTemplate.getDerivedResource({templateValues:a.getTemplateValues()}).url,f=qe(n,!0);f.contents=[{uri:l}],delete f.content,delete f.extensions;let d=new Ph(e,t,f,i);return d.implicitTileset=s,d.implicitCoordinates=a,d}async function rWe(e,t){let n=si(t,"3DTILES_metadata")?t.extensions["3DTILES_metadata"]:t,i;if(c(n.schemaUri))e=e.getDerivedResource({url:n.schemaUri}),i=Ci.getSchemaLoader({resource:e});else if(c(n.schema))i=Ci.getSchemaLoader({schema:n.schema});else return;await i.load();let o=new Ww({schema:i.schema,metadataJson:n});return Ci.unload(i),o}var hce=new h,sWe=new he,aWe=new k,cWe=new h,lWe=new h,uWe=new h,fWe=new h;function dWe(e,t){let n,i,o,r,s,a=t.camera,l=e._root,u=l.contentBoundingVolume;if(u instanceof wh)n=h.normalize(a.positionWC,hce),i=a.directionWC,o=a.positionCartographic.height,r=u.minimumHeight,s=u.maximumHeight;else{let b=k.inverseTransformation(l.computedTransform,aWe),x=t.mapProjection.ellipsoid,T=u.boundingVolume,C=k.multiplyByPoint(b,T.center,cWe);if(h.magnitude(C)>x.minimumRadius){let S=he.fromCartesian(C,x,sWe);n=h.normalize(a.positionWC,hce),i=a.directionWC,o=a.positionCartographic.height,r=0,s=S.height*2}else{let S=k.multiplyByPoint(b,a.positionWC,lWe);if(n=h.UNIT_Z,i=k.multiplyByPointAsVector(b,a.directionWC,uWe),i=h.normalize(i,i),o=S.z,u instanceof dd){let v=Q.getColumn(T.halfAxes,2,fWe),D=h.magnitude(v);r=C.z-D,s=C.z+D}else if(u instanceof W0){let v=T.radius;r=C.z-v,s=C.z+v}}}let f=e.dynamicScreenSpaceErrorHeightFalloff,d=r+(s-r)*f,p=s,g=R.clamp((o-d)/(p-d),0,1),m=1-Math.abs(h.dot(i,n));m=m*(1-g),e._dynamicScreenSpaceErrorComputedDensity=e.dynamicScreenSpaceErrorDensity*m}function hWe(e,t){if(t.hasEmptyContent)return;let{statistics:n}=e,i=t.contentExpired,o=t.requestContent();c(o)&&(o.then(r=>{!c(r)||t.isDestroyed()||e.isDestroyed()||(e._processingQueue.push(t),++n.numberOfTilesProcessing)}).catch(r=>{_ce(r,e,t)}),i&&(t.hasTilesetContent||t.hasImplicitContent?vWe(e,t):(n.decrementLoadCounts(t.content),--n.numberOfTilesWithContentReady)),e._requestedTilesInFlight.push(t))}function pce(e,t){return e._priority-t._priority}Wo.prototype.postPassesUpdate=function(e){c(this._root)&&(mWe(this,e),PWe(this,e),this._cache.unloadTiles(this,yce),this._styleApplied&&this._styleEngine.resetDirty(),this._styleApplied=!1)};Wo.prototype.prePassesUpdate=function(e){if(!c(this._root))return;TWe(this,e);let t=this._clippingPlanes;this._clippingPlanesOriginMatrixDirty=!0,c(t)&&t.enabled&&t.update(e);let n=this._clippingPolygons;c(n)&&n.enabled&&n.update(e),c(this._loadTimestamp)||(this._loadTimestamp=J.clone(e.time)),this._timeSinceLoad=Math.max(J.secondsDifference(e.time,this._loadTimestamp)*1e3,0),this.dynamicScreenSpaceError&&dWe(this,e),e.newFrame&&this._cache.reset()};function mWe(e,t){let n=e._requestedTilesInFlight,i=0;for(let o=0;o<n.length;++o){let r=n[o],s=t.frameNumber-r._touchedFrame>=1;if(r._contentState!==rr.LOADING){++i;continue}else if(s){r.cancelRequests(),++i;continue}i>0&&(n[o-i]=r)}n.length-=i}function pWe(e){let t=e._requestedTiles;t.sort(pce);for(let n=0;n<t.length;++n)hWe(e,t[n])}function _ce(e,t,n){if(t.isDestroyed())return;let i;n.isDestroyed()||(i=n._contentResource.url);let o=c(e.message)?e.message:e.toString();t.tileFailed.numberOfListeners>0?t.tileFailed.raiseEvent({url:i,message:o}):(console.log(`A 3D tile failed to load: ${i}`),console.log(`Error: ${o}`),console.log(e.stack))}function _We(e){let t=e._processingQueue,n=0;for(let i=0;i<t.length;++i){let o=t[i];if(o.isDestroyed()||o._contentState!==rr.PROCESSING){++n;continue}n>0&&(t[i-n]=o)}t.length-=n}var gWe=new he,yWe=new he,bWe=new h;function xWe(e,t,n){if(!e.enableCollision||!e.show)return;let i=e._addHeightCallbacks,o=t.boundingSphere;for(let r of i){if(r.invoked||t._wasSelectedLastFrame)continue;let s=r.ellipsoid,a=he.clone(r.positionCartographic,gWe),l=he.fromCartesian(o.center,s,yWe);c(l)&&(a.height=l.height);let u=he.toCartesian(a,s,bWe);h.distance(u,o.center)<=o.radius&&n.afterRender.push(()=>{c(r.callback)&&r.callback(a),r.invoked=!1})}}function TWe(e,t){_We(e);let n=e._processingQueue,{cacheBytes:i,maximumCacheOverflowBytes:o,statistics:r}=e,s=i+o,a=!1;for(let l=0;l<n.length;++l){if(e.totalMemoryUsageInBytes>s){a=!0;break}let u=n[l];try{u.process(e,t),u.contentReady&&(--r.numberOfTilesProcessing,e.tileLoad.raiseEvent(u))}catch(f){--r.numberOfTilesProcessing,_ce(f,e,u)}}e.totalMemoryUsageInBytes<i?CWe(e):a&&n.length>0&&AWe(e)}function AWe(e){_t("increase-screenSpaceError",`The tiles needed to meet maximumScreenSpaceError would use more memory than allocated for this tileset.
    The tileset will be rendered with a larger screen space error (see memoryAdjustedScreenSpaceError).
    Consider using larger values for cacheBytes and maximumCacheOverflowBytes.`),e._memoryAdjustedScreenSpaceError*=1.02;let t=e._processingQueue;for(let n=0;n<t.length;++n)t[n].updatePriority();t.sort(pce)}function CWe(e){e._memoryAdjustedScreenSpaceError=Math.max(e.memoryAdjustedScreenSpaceError/1.02,e.maximumScreenSpaceError)}var U1=new h,EWe={maximumFractionDigits:3};function mce(e){let t=e/1048576;return t<1?t.toLocaleString(void 0,EWe):Math.round(t).toLocaleString()}function e5(e){let{halfAxes:t,radius:n,center:i}=e.boundingVolume.boundingVolume,o=h.clone(i,U1);if(c(t))o.x+=.75*(t[0]+t[3]+t[6]),o.y+=.75*(t[1]+t[4]+t[7]),o.z+=.75*(t[2]+t[5]+t[8]);else if(c(n)){let r=h.normalize(i,U1);r=h.multiplyByScalar(r,.75*n,U1),o=h.add(r,i,U1)}return o}function t5(e,t,n){let i="",o=0;if(t.debugShowGeometricError&&(i+=`
Geometric error: ${e.geometricError}`,o++),t.debugShowRenderingStatistics&&(i+=`
Commands: ${e.commandsLength}`,o++,e.content.pointsLength>0&&(i+=`
Points: ${e.content.pointsLength}`,o++),e.content.trianglesLength>0&&(i+=`
Triangles: ${e.content.trianglesLength}`,o++),i+=`
Features: ${e.content.featuresLength}`,o++),t.debugShowMemoryUsage&&(i+=`
Texture Memory: ${mce(e.content.texturesByteLength)}`,i+=`
Geometry Memory: ${mce(e.content.geometryByteLength)}`,o+=2),t.debugShowUrl)if(e.hasMultipleContents){i+=`
Urls:`;let s=e.content.innerContentUrls;for(let a=0;a<s.length;a++)i+=`
- ${s[a]}`;o+=s.length}else i+=`
Url: ${e._contentHeader.uri}`,o++;let r={text:i.substring(1),position:n,font:`${19-o}px sans-serif`,showBackground:!0,disableDepthTestDistance:Number.POSITIVE_INFINITY};return t._tileDebugLabels.add(r)}function SWe(e,t){let n=e._selectedTiles,i=n.length,o=e._emptyTiles,r=o.length;if(e._tileDebugLabels.removeAll(),e.debugPickedTileLabelOnly){if(c(e.debugPickedTile)){let s=c(e.debugPickPosition)?e.debugPickPosition:e5(e.debugPickedTile),a=t5(e.debugPickedTile,e,s);a.pixelOffset=new H(15,-15)}}else{for(let s=0;s<i;++s){let a=n[s];t5(a,e,e5(a))}for(let s=0;s<r;++s){let a=o[s];(a.hasTilesetContent||a.hasImplicitContent)&&t5(a,e,e5(a))}}e._tileDebugLabels.update(t)}function wWe(e,t,n){e._styleEngine.applyStyle(e),e._styleApplied=!0;let{commandList:i,context:o}=t,r=i.length,s=e._selectedTiles,a=e.isSkippingLevelOfDetail&&e._hasMixedContent&&o.stencilBuffer&&s.length>0;e._backfaceCommands.length=0,a&&(c(e._stencilClearCommand)||(e._stencilClearCommand=new ri({stencil:0,pass:ve.CESIUM_3D_TILE,renderState:ze.fromCache({stencilMask:Ut.SKIP_LOD_MASK})})),i.push(e._stencilClearCommand));let{statistics:l,tileVisible:u}=e,f=n.isRender,d=i.length;for(let m=0;m<s.length;++m){let b=s[m];f&&u.raiseEvent(b),xWe(e,b,t),b.update(e,t,n),l.incrementSelectionCounts(b.content),++l.selected}let p=e._emptyTiles;for(let m=0;m<p.length;++m)p[m].update(e,t,n);let g=i.length-d;if(e._backfaceCommands.trim(),a){let m=e._backfaceCommands.values,b=m.length;i.length+=b;for(let x=g-1;x>=0;--x)i[d+b+x]=i[d+x];for(let x=0;x<b;++x)i[d+x]=m[x]}g=i.length-r,l.numberOfCommands=g,f&&(e.pointCloudShading.attenuation&&e.pointCloudShading.eyeDomeLighting&&g>0&&e._pointCloudEyeDomeLighting.update(t,r,e.pointCloudShading,e.boundingSphere),e.debugShowGeometricError||e.debugShowRenderingStatistics||e.debugShowMemoryUsage||e.debugShowUrl?(c(e._tileDebugLabels)||(e._tileDebugLabels=new ag),SWe(e,t)):e._tileDebugLabels=e._tileDebugLabels&&e._tileDebugLabels.destroy())}var gce=[];function vWe(e,t){let n=t,i=gce;for(i.push(t);i.length>0;){t=i.pop();let o=t.children;for(let r=0;r<o.length;++r)i.push(o[r]);t!==n&&(DWe(e,t),--e._statistics.numberOfTilesTotal)}n.children=[]}function yce(e,t){e.tileUnload.raiseEvent(t),e._statistics.decrementLoadCounts(t.content),--e._statistics.numberOfTilesWithContentReady,t.unloadContent()}function DWe(e,t){e._cache.unloadTile(e,t,yce),t.destroy()}Wo.prototype.trimLoadedTiles=function(){this._cache.trim()};function PWe(e,t){let n=e._statistics,i=e._statisticsLast,o=n.numberOfPendingRequests,r=n.numberOfTilesProcessing,s=i.numberOfPendingRequests,a=i.numberOfTilesProcessing;X0.clone(n,i);let l=o!==s||r!==a;l&&t.afterRender.push(function(){return e.loadProgress.raiseEvent(o,r),!0}),e._tilesLoaded=n.numberOfPendingRequests===0&&n.numberOfTilesProcessing===0&&n.numberOfAttemptedRequests===0,l&&e._tilesLoaded&&(t.afterRender.push(function(){return e.allTilesLoaded.raiseEvent(),!0}),e._initialTilesLoaded||(e._initialTilesLoaded=!0,t.afterRender.push(function(){return e.initialTilesLoaded.raiseEvent(),!0})))}function IWe(e){e._heatmap.resetMinimumMaximum(),e._minimumPriority.depth=Number.MAX_VALUE,e._maximumPriority.depth=-Number.MAX_VALUE,e._minimumPriority.foveatedFactor=Number.MAX_VALUE,e._maximumPriority.foveatedFactor=-Number.MAX_VALUE,e._minimumPriority.distance=Number.MAX_VALUE,e._maximumPriority.distance=-Number.MAX_VALUE,e._minimumPriority.reverseScreenSpaceError=Number.MAX_VALUE,e._maximumPriority.reverseScreenSpaceError=-Number.MAX_VALUE}function OWe(e,t){t.frameNumber===e._updatedModelMatrixFrame&&c(e._previousModelMatrix)||(e._updatedModelMatrixFrame=t.frameNumber,e._modelMatrixChanged=!k.equals(e.modelMatrix,e._previousModelMatrix),e._modelMatrixChanged&&(e._previousModelMatrix=k.clone(e.modelMatrix,e._previousModelMatrix)))}function RWe(e,t,n,i){if(t.mode===oe.MORPHING||!c(e._root))return!1;let o=e._statistics;o.clear(),++e._updatedVisibilityFrame,IWe(e),OWe(e,t),e._cullRequestsWhileMoving=e.cullRequestsWhileMoving&&!e._modelMatrixChanged;let r=e.getTraversal(i).selectTiles(e,t);if(i.requestTiles&&pWe(e),wWe(e,t,i),X0.clone(o,n),i.isRender){let s=e._credits;if(c(s)&&o.selected!==0)for(let a=0;a<s.length;++a){let l=s[a];t.creditDisplay.addCreditToNextFrame(l)}}return r}function bce(e){let t=e._credits;c(t)||(t=[]),t.length=0,c(e.resource.credits)&&e.resource.credits.forEach(i=>{t.push(Pt.clone(i))});let n=e.asset.extras;if(c(n)&&c(n.cesium)&&c(n.cesium.credits)){let i=n.cesium.credits;for(let o=0;o<i.length;++o){let r=i[o];t.push(new Pt(r.html))}}t.forEach(i=>i.showOnScreen=i.showOnScreen||e._showCreditsOnScreen),e._credits=t}Wo.prototype.getTraversal=function(e){let{pass:t}=e;return t===Ro.MOST_DETAILED_PRELOAD||t===Ro.MOST_DETAILED_PICK?$G:this.isSkippingLevelOfDetail?QG:JG};Wo.prototype.update=function(e){this.updateForPass(e,e.tilesetPassState)};Wo.prototype.updateForPass=function(e,t){A.typeOf.object("frameState",e),A.typeOf.object("tilesetPassState",t);let n=t.pass;if(n===Ro.PRELOAD&&(!this.preloadWhenHidden||this.show)||n===Ro.PRELOAD_FLIGHT&&(!this.preloadFlightDestinations||!this.show&&!this.preloadWhenHidden)||n===Ro.REQUEST_RENDER_MODE_DEFER_CHECK&&(!this._cullRequestsWhileMoving&&this.foveatedTimeDelay<=0||!this.show))return;let i=e.commandList,o=e.camera,r=e.cullingVolume;t.ready=!1;let s=Ro.getPassOptions(n),a=s.ignoreCommands,l=y(t.commandList,i),u=l.length;if(e.commandList=l,e.camera=y(t.camera,o),e.cullingVolume=y(t.cullingVolume,r),s.isRender){let p=this._environmentMapManager;c(this._root)&&(p.position=this.boundingSphere.center),p.update(e)}let f=this._clippingPolygons;c(f)&&f.enabled&&f.queueCommands(e);let d=this._statisticsPerPass[n];(this.show||a)&&(this._pass=n,t.ready=RWe(this,e,d,s)),a&&(l.length=u),e.commandList=i,e.camera=o,e.cullingVolume=r};Wo.prototype.hasExtension=function(e){return c(this._extensionsUsed)?this._extensionsUsed.indexOf(e)>-1:!1};Wo.prototype.isDestroyed=function(){return!1};Wo.prototype.destroy=function(){if(this._tileDebugLabels=this._tileDebugLabels&&this._tileDebugLabels.destroy(),this._clippingPlanes=this._clippingPlanes&&this._clippingPlanes.destroy(),this._clippingPolygons=this._clippingPolygons&&this._clippingPolygons.destroy(),c(this._root)){let e=gce;for(e.push(this._root);e.length>0;){let t=e.pop();t.destroy();let n=t.children;for(let i=0;i<n.length;++i)e.push(n[i])}}return this._root=void 0,this._shouldDestroyImageBasedLighting&&!this._imageBasedLighting.isDestroyed()&&this._imageBasedLighting.destroy(),this._imageBasedLighting=void 0,this._environmentMapManager.isDestroyed()||this._environmentMapManager.destroy(),this._environmentMapManager=void 0,de(this)};Wo.supportedExtensions={"3DTILES_metadata":!0,"3DTILES_implicit_tiling":!0,"3DTILES_content_gltf":!0,"3DTILES_multiple_contents":!0,"3DTILES_bounding_volume_S2":!0,"3DTILES_batch_table_hierarchy":!0,"3DTILES_draco_point_compression":!0,MAXAR_content_geojson:!0};Wo.checkSupportedExtensions=function(e){for(let t=0;t<e.length;t++)if(!Wo.supportedExtensions[e[t]])throw new ue(`Unsupported 3D Tiles Extension: ${e[t]}`)};var MWe=new _n,LWe=new h,NWe=new he;Wo.prototype.getHeight=function(e,t){A.typeOf.object("cartographic",e),A.typeOf.object("scene",t);let n=t.ellipsoid;c(n)||(n=ie.WGS84);let i=MWe,o=n.cartographicToCartesian(e,i.direction);h.normalize(i.direction,i.direction),i.direction=h.normalize(o,i.direction),i.direction=h.negate(o,i.direction),i.origin=h.multiplyByScalar(i.direction,-2*n.maximumRadius,i.origin);let r=this.pick(i,t.frameState,LWe);if(c(r))return n.cartesianToCartographic(r,NWe)?.height};Wo.prototype.updateHeight=function(e,t,n){n=y(n,ie.WGS84);let i={positionCartographic:e,ellipsoid:n,callback:t,invoked:!1},o=()=>{let r=this._addHeightCallbacks,s=r.length;for(let a=0;a<s;++a)if(r[a]===i){r.splice(a,1);break}i.callback&&(i.callback=void 0)};return this._addHeightCallbacks.push(i),o};var FWe=new lc,BWe=new h;Wo.prototype.pick=function(e,t,n){if(!t.context.webgl2&&!this._enablePick)return;let i=this._selectedTiles,o=i.length,r=[];for(let l=0;l<o;++l){let u=i[l],f=Qn.raySphere(e,u.contentBoundingVolume.boundingSphere,FWe);!c(f)||!c(u.content)||r.push(u)}let s=r.length;r.sort((l,u)=>{let f=ce.distanceSquaredTo(l.contentBoundingVolume.boundingSphere,e.origin),d=ce.distanceSquaredTo(u.contentBoundingVolume.boundingSphere,e.origin);return f-d});let a;for(let l=0;l<s;++l){let f=r[l].content.pick(e,t,BWe);if(c(f))return a=h.clone(f,n),a}};var pa=Wo;var kWe=new k;function mg(e,t){if(!c(e))throw new E("scene is required.");if(!c(t))throw new E("entityCollection is required.");t.collectionChanged.addEventListener(mg.prototype._onCollectionChanged,this),this._scene=e,this._primitives=e.primitives,this._entityCollection=t,this._tilesetHash={},this._entitiesToVisualize=new St,this._onCollectionChanged(t,t.values,[],[])}mg.prototype.update=function(e){if(!c(e))throw new E("time is required.");let t=this._entitiesToVisualize.values,n=this._tilesetHash,i=this._primitives;for(let o=0,r=t.length;o<r;o++){let s=t[o],a=s._tileset,l,u=n[s.id],f=s.isShowing&&s.isAvailable(e)&&X.getValueOrDefault(a._show,e,!0),d;f&&(d=s.computeModelMatrix(e,kWe),l=De.createIfNeeded(X.getValueOrUndefined(a._uri,e)));let p=c(u)?u.tilesetPrimitive:void 0;if(!f){c(p)&&(p.show=!1);continue}(!c(u)||l.url!==u.url)&&(c(p)&&i.removeAndDestroy(p),delete n[s.id],VWe(l,n,s,i)),c(p)&&(p.show=!0,c(d)&&(p.modelMatrix=d),p.maximumScreenSpaceError=X.getValueOrDefault(a.maximumScreenSpaceError,e,p.maximumScreenSpaceError))}return!0};mg.prototype.isDestroyed=function(){return!1};mg.prototype.destroy=function(){this._entityCollection.collectionChanged.removeEventListener(mg.prototype._onCollectionChanged,this);let e=this._entitiesToVisualize.values,t=this._tilesetHash,n=this._primitives;for(let i=e.length-1;i>-1;i--)n5(this,e[i],t,n);return de(this)};mg.prototype.getBoundingSphere=function(e,t){if(!c(e))throw new E("entity is required.");if(!c(t))throw new E("result is required.");let n=this._tilesetHash[e.id];if(!c(n)||n.loadFail)return ct.FAILED;let i=n.tilesetPrimitive;return c(i)?i.show?(ce.clone(i.boundingSphere,t),ct.DONE):ct.FAILED:ct.PENDING};mg.prototype._onCollectionChanged=function(e,t,n,i){let o,r,s=this._entitiesToVisualize,a=this._tilesetHash,l=this._primitives;for(o=t.length-1;o>-1;o--)r=t[o],c(r._tileset)&&s.set(r.id,r);for(o=i.length-1;o>-1;o--)r=i[o],c(r._tileset)?s.set(r.id,r):(n5(this,r,a,l),s.remove(r.id));for(o=n.length-1;o>-1;o--)r=n[o],n5(this,r,a,l),s.remove(r.id)};function n5(e,t,n,i){let o=n[t.id];c(o)&&(c(o.tilesetPrimitive)&&i.removeAndDestroy(o.tilesetPrimitive),delete n[t.id])}async function VWe(e,t,n,i){t[n.id]={url:e.url,loadFail:!1};try{let o=await pa.fromUrl(e);if(o.id=n,i.add(o),!c(t[n.id]))return;t[n.id].tilesetPrimitive=o}catch(o){console.error(o),t[n.id].loadFail=!0}}var i5=mg;var UWe=j.WHITE,zWe=j.BLACK,HWe=new H(2,2);function tA(e){e=y(e,y.EMPTY_OBJECT),this._definitionChanged=new pe,this._evenColor=void 0,this._evenColorSubscription=void 0,this._oddColor=void 0,this._oddColorSubscription=void 0,this._repeat=void 0,this._repeatSubscription=void 0,this.evenColor=e.evenColor,this.oddColor=e.oddColor,this.repeat=e.repeat}Object.defineProperties(tA.prototype,{isConstant:{get:function(){return X.isConstant(this._evenColor)&&X.isConstant(this._oddColor)&&X.isConstant(this._repeat)}},definitionChanged:{get:function(){return this._definitionChanged}},evenColor:fe("evenColor"),oddColor:fe("oddColor"),repeat:fe("repeat")});tA.prototype.getType=function(e){return"Checkerboard"};var GWe=new J;tA.prototype.getValue=function(e,t){return c(e)||(e=J.now(GWe)),c(t)||(t={}),t.lightColor=X.getValueOrClonedDefault(this._evenColor,e,UWe,t.lightColor),t.darkColor=X.getValueOrClonedDefault(this._oddColor,e,zWe,t.darkColor),t.repeat=X.getValueOrDefault(this._repeat,e,HWe),t};tA.prototype.equals=function(e){return this===e||e instanceof tA&&X.equals(this._evenColor,e._evenColor)&&X.equals(this._oddColor,e._oddColor)&&X.equals(this._repeat,e._repeat)};var z1=tA;var xce={id:void 0};function nv(e){if(e._firing){e._refire=!0;return}if(e._suspendCount===0){let t=e._addedEntities,n=e._removedEntities,i=e._changedEntities;if(i.length!==0||t.length!==0||n.length!==0){e._firing=!0;do{e._refire=!1;let o=t.values.slice(0),r=n.values.slice(0),s=i.values.slice(0);t.removeAll(),n.removeAll(),i.removeAll(),e._collectionChanged.raiseEvent(e,o,r,s)}while(e._refire);e._firing=!1}}}function Ya(e){this._owner=e,this._entities=new St,this._addedEntities=new St,this._removedEntities=new St,this._changedEntities=new St,this._suspendCount=0,this._collectionChanged=new pe,this._id=Hn(),this._show=!0,this._firing=!1,this._refire=!1}Ya.prototype.suspendEvents=function(){this._suspendCount++};Ya.prototype.resumeEvents=function(){if(this._suspendCount===0)throw new E("resumeEvents can not be called before suspendEvents.");this._suspendCount--,nv(this)};Object.defineProperties(Ya.prototype,{collectionChanged:{get:function(){return this._collectionChanged}},id:{get:function(){return this._id}},values:{get:function(){return this._entities.values}},show:{get:function(){return this._show},set:function(e){if(!c(e))throw new E("value is required.");if(e===this._show)return;this.suspendEvents();let t,n=[],i=this._entities.values,o=i.length;for(t=0;t<o;t++)n.push(i[t].isShowing);for(this._show=e,t=0;t<o;t++){let r=n[t],s=i[t];r!==s.isShowing&&s.definitionChanged.raiseEvent(s,"isShowing",s.isShowing,r)}this.resumeEvents()}},owner:{get:function(){return this._owner}}});Ya.prototype.computeAvailability=function(){let e=je.MAXIMUM_VALUE,t=je.MINIMUM_VALUE,n=this._entities.values;for(let i=0,o=n.length;i<o;i++){let s=n[i].availability;if(c(s)){let a=s.start,l=s.stop;J.lessThan(a,e)&&!a.equals(je.MINIMUM_VALUE)&&(e=a),J.greaterThan(l,t)&&!l.equals(je.MAXIMUM_VALUE)&&(t=l)}}return je.MAXIMUM_VALUE.equals(e)&&(e=je.MINIMUM_VALUE),je.MINIMUM_VALUE.equals(t)&&(t=je.MAXIMUM_VALUE),new wn({start:e,stop:t})};Ya.prototype.add=function(e){if(!c(e))throw new E("entity is required.");e instanceof Qo||(e=new Qo(e));let t=e.id,n=this._entities;if(n.contains(t))throw new E(`An entity with id ${t} already exists in this collection.`);return e.entityCollection=this,n.set(t,e),this._removedEntities.remove(t)||this._addedEntities.set(t,e),e.definitionChanged.addEventListener(Ya.prototype._onEntityDefinitionChanged,this),nv(this),e};Ya.prototype.remove=function(e){return c(e)?this.removeById(e.id):!1};Ya.prototype.contains=function(e){if(!c(e))throw new E("entity is required");return this._entities.get(e.id)===e};Ya.prototype.removeById=function(e){if(!c(e))return!1;let n=this._entities.get(e);return this._entities.remove(e)?(this._addedEntities.remove(e)||(this._removedEntities.set(e,n),this._changedEntities.remove(e)),this._entities.remove(e),n.definitionChanged.removeEventListener(Ya.prototype._onEntityDefinitionChanged,this),nv(this),!0):!1};Ya.prototype.removeAll=function(){let e=this._entities,t=e.length,n=e.values,i=this._addedEntities,o=this._removedEntities;for(let r=0;r<t;r++){let s=n[r],a=s.id,l=i.get(a);c(l)||(s.definitionChanged.removeEventListener(Ya.prototype._onEntityDefinitionChanged,this),o.set(a,s))}e.removeAll(),i.removeAll(),this._changedEntities.removeAll(),nv(this)};Ya.prototype.getById=function(e){if(!c(e))throw new E("id is required.");return this._entities.get(e)};Ya.prototype.getOrCreateEntity=function(e){if(!c(e))throw new E("id is required.");let t=this._entities.get(e);return c(t)||(xce.id=e,t=new Qo(xce),this.add(t)),t};Ya.prototype._onEntityDefinitionChanged=function(e){let t=e.id;this._addedEntities.contains(t)||this._changedEntities.set(t,e),nv(this)};var _a=Ya;var H1={id:void 0},nA=new Array(2);function o5(e){let t=e.propertyNames,n=t.length;for(let i=0;i<n;i++)e[t[i]]=void 0;e._name=void 0,e._availability=void 0}function Tce(e,t,n,i){nA[0]=n,nA[1]=i.id,t[JSON.stringify(nA)]=i.definitionChanged.addEventListener(Lr.prototype._onDefinitionChanged,e)}function Ace(e,t,n,i){nA[0]=n,nA[1]=i.id;let o=JSON.stringify(nA);t[o](),t[o]=void 0}function pg(e){if(e._shouldRecomposite=!0,e._suspendCount!==0)return;let t=e._collections,n=t.length,i=e._collectionsCopy,o=i.length,r,s,a,l,u,f=e._composite,d=new _a(e),p=e._eventHash,g;for(r=0;r<o;r++)for(u=i[r],u.collectionChanged.removeEventListener(Lr.prototype._onCollectionChanged,e),a=u.values,g=u.id,l=a.length-1;l>-1;l--)s=a[l],Ace(e,p,g,s);for(r=n-1;r>=0;r--)for(u=t[r],u.collectionChanged.addEventListener(Lr.prototype._onCollectionChanged,e),a=u.values,g=u.id,l=a.length-1;l>-1;l--){s=a[l],Tce(e,p,g,s);let b=d.getById(s.id);c(b)||(b=f.getById(s.id),c(b)?o5(b):(H1.id=s.id,b=new Qo(H1)),d.add(b)),b.merge(s)}e._collectionsCopy=t.slice(0),f.suspendEvents(),f.removeAll();let m=d.values;for(r=0;r<m.length;r++)f.add(m[r]);f.resumeEvents()}function Lr(e,t){this._owner=t,this._composite=new _a(this),this._suspendCount=0,this._collections=c(e)?e.slice():[],this._collectionsCopy=[],this._id=Hn(),this._eventHash={},pg(this),this._shouldRecomposite=!1}Object.defineProperties(Lr.prototype,{collectionChanged:{get:function(){return this._composite._collectionChanged}},id:{get:function(){return this._id}},values:{get:function(){return this._composite.values}},owner:{get:function(){return this._owner}}});Lr.prototype.addCollection=function(e,t){let n=c(t);if(!c(e))throw new E("collection is required.");if(n){if(t<0)throw new E("index must be greater than or equal to zero.");if(t>this._collections.length)throw new E("index must be less than or equal to the number of collections.")}n?this._collections.splice(t,0,e):(t=this._collections.length,this._collections.push(e)),pg(this)};Lr.prototype.removeCollection=function(e){let t=this._collections.indexOf(e);return t!==-1?(this._collections.splice(t,1),pg(this),!0):!1};Lr.prototype.removeAllCollections=function(){this._collections.length=0,pg(this)};Lr.prototype.containsCollection=function(e){return this._collections.indexOf(e)!==-1};Lr.prototype.contains=function(e){return this._composite.contains(e)};Lr.prototype.indexOfCollection=function(e){return this._collections.indexOf(e)};Lr.prototype.getCollection=function(e){if(!c(e))throw new E("index is required.","index");return this._collections[e]};Lr.prototype.getCollectionsLength=function(){return this._collections.length};function G1(e,t){if(!c(t))throw new E("collection is required.");let n=e.indexOf(t);if(n===-1)throw new E("collection is not in this composite.");return n}function Cce(e,t,n){let i=e._collections;if(t=R.clamp(t,0,i.length-1),n=R.clamp(n,0,i.length-1),t===n)return;let o=i[t];i[t]=i[n],i[n]=o,pg(e)}Lr.prototype.raiseCollection=function(e){let t=G1(this._collections,e);Cce(this,t,t+1)};Lr.prototype.lowerCollection=function(e){let t=G1(this._collections,e);Cce(this,t,t-1)};Lr.prototype.raiseCollectionToTop=function(e){let t=G1(this._collections,e);t!==this._collections.length-1&&(this._collections.splice(t,1),this._collections.push(e),pg(this))};Lr.prototype.lowerCollectionToBottom=function(e){let t=G1(this._collections,e);t!==0&&(this._collections.splice(t,1),this._collections.splice(0,0,e),pg(this))};Lr.prototype.suspendEvents=function(){this._suspendCount++,this._composite.suspendEvents()};Lr.prototype.resumeEvents=function(){if(this._suspendCount===0)throw new E("resumeEvents can not be called before suspendEvents.");this._suspendCount--,this._shouldRecomposite&&this._suspendCount===0&&(pg(this),this._shouldRecomposite=!1),this._composite.resumeEvents()};Lr.prototype.computeAvailability=function(){return this._composite.computeAvailability()};Lr.prototype.getById=function(e){return this._composite.getById(e)};Lr.prototype._onCollectionChanged=function(e,t,n){let i=this._collectionsCopy,o=i.length,r=this._composite;r.suspendEvents();let s,a,l,u,f=n.length,d=this._eventHash,p=e.id;for(s=0;s<f;s++){let m=n[s];Ace(this,d,p,m);let b=m.id;for(a=o-1;a>=0;a--)l=i[a].getById(b),c(l)&&(c(u)||(u=r.getById(b),o5(u)),u.merge(l));c(u)||r.removeById(b),u=void 0}let g=t.length;for(s=0;s<g;s++){let m=t[s];Tce(this,d,p,m);let b=m.id;for(a=o-1;a>=0;a--)l=i[a].getById(b),c(l)&&(c(u)||(u=r.getById(b),c(u)?o5(u):(H1.id=b,u=new Qo(H1),r.add(u))),u.merge(l));u=void 0}r.resumeEvents()};Lr.prototype._onDefinitionChanged=function(e,t,n,i){let o=this._collections,r=this._composite,s=o.length,a=e.id,l=r.getById(a),u=l[t],f=!c(u),d=!0;for(let p=s-1;p>=0;p--){let g=o[p].getById(e.id);if(c(g)){let m=g[t];if(c(m)){if(d)if(d=!1,c(m.merge)&&c(m.clone))u=m.clone(u);else{u=m;break}u.merge(m)}}}f&&l.propertyNames.indexOf(t)===-1&&l.addProperty(t),l[t]=u};var jWe=Lr;function r5(){this._removalFunctions=[]}r5.prototype.add=function(e,t,n){if(!c(e))throw new E("event is required");let i=e.addEventListener(t,n);this._removalFunctions.push(i);let o=this;return function(){i();let r=o._removalFunctions;r.splice(r.indexOf(i),1)}};r5.prototype.removeAll=function(){let e=this._removalFunctions;for(let t=0,n=e.length;t<n;++t)e[t]();e.length=0};var yr=r5;function c5(e,t){return J.compare(e.start,t.start)}function Nr(e){if(this._intervals=[],this._changedEvent=new pe,c(e)){let t=e.length;for(let n=0;n<t;n++)this.addInterval(e[n])}}Object.defineProperties(Nr.prototype,{changedEvent:{get:function(){return this._changedEvent}},start:{get:function(){let e=this._intervals;return e.length===0?void 0:e[0].start}},isStartIncluded:{get:function(){let e=this._intervals;return e.length===0?!1:e[0].isStartIncluded}},stop:{get:function(){let e=this._intervals,t=e.length;return t===0?void 0:e[t-1].stop}},isStopIncluded:{get:function(){let e=this._intervals,t=e.length;return t===0?!1:e[t-1].isStopIncluded}},length:{get:function(){return this._intervals.length}},isEmpty:{get:function(){return this._intervals.length===0}}});Nr.prototype.equals=function(e,t){if(this===e)return!0;if(!(e instanceof Nr))return!1;let n=this._intervals,i=e._intervals,o=n.length;if(o!==i.length)return!1;for(let r=0;r<o;r++)if(!wn.equals(n[r],i[r],t))return!1;return!0};Nr.prototype.get=function(e){if(!c(e))throw new E("index is required.");return this._intervals[e]};Nr.prototype.removeAll=function(){this._intervals.length>0&&(this._intervals.length=0,this._changedEvent.raiseEvent(this))};Nr.prototype.findIntervalContainingDate=function(e){let t=this.indexOf(e);return t>=0?this._intervals[t]:void 0};Nr.prototype.findDataForIntervalContainingDate=function(e){let t=this.indexOf(e);return t>=0?this._intervals[t].data:void 0};Nr.prototype.contains=function(e){return this.indexOf(e)>=0};var s5=new wn;Nr.prototype.indexOf=function(e){if(!c(e))throw new E("date is required");let t=this._intervals;s5.start=e,s5.stop=e;let n=vo(t,s5,c5);return n>=0?t[n].isStartIncluded?n:n>0&&t[n-1].stop.equals(e)&&t[n-1].isStopIncluded?n-1:~n:(n=~n,n>0&&n-1<t.length&&wn.contains(t[n-1],e)?n-1:~n)};Nr.prototype.findInterval=function(e){e=y(e,y.EMPTY_OBJECT);let t=e.start,n=e.stop,i=e.isStartIncluded,o=e.isStopIncluded,r=this._intervals;for(let s=0,a=r.length;s<a;s++){let l=r[s];if((!c(t)||l.start.equals(t))&&(!c(n)||l.stop.equals(n))&&(!c(i)||l.isStartIncluded===i)&&(!c(o)||l.isStopIncluded===o))return r[s]}};Nr.prototype.addInterval=function(e,t){if(!c(e))throw new E("interval is required");if(e.isEmpty)return;let n=this._intervals;if(n.length===0||J.greaterThan(e.start,n[n.length-1].stop)){n.push(e),this._changedEvent.raiseEvent(this);return}let i=vo(n,e,c5);i<0?i=~i:i>0&&e.isStartIncluded&&n[i-1].isStartIncluded&&n[i-1].start.equals(e.start)?--i:i<n.length&&!e.isStartIncluded&&n[i].isStartIncluded&&n[i].start.equals(e.start)&&++i;let o;for(i>0&&(o=J.compare(n[i-1].stop,e.start),(o>0||o===0&&(n[i-1].isStopIncluded||e.isStartIncluded))&&((c(t)?t(n[i-1].data,e.data):n[i-1].data===e.data)?(J.greaterThan(e.stop,n[i-1].stop)?e=new wn({start:n[i-1].start,stop:e.stop,isStartIncluded:n[i-1].isStartIncluded,isStopIncluded:e.isStopIncluded,data:e.data}):e=new wn({start:n[i-1].start,stop:n[i-1].stop,isStartIncluded:n[i-1].isStartIncluded,isStopIncluded:n[i-1].isStopIncluded||e.stop.equals(n[i-1].stop)&&e.isStopIncluded,data:e.data}),n.splice(i-1,1),--i):(o=J.compare(n[i-1].stop,e.stop),(o>0||o===0&&n[i-1].isStopIncluded&&!e.isStopIncluded)&&n.splice(i,0,new wn({start:e.stop,stop:n[i-1].stop,isStartIncluded:!e.isStopIncluded,isStopIncluded:n[i-1].isStopIncluded,data:n[i-1].data})),n[i-1]=new wn({start:n[i-1].start,stop:e.start,isStartIncluded:n[i-1].isStartIncluded,isStopIncluded:!e.isStartIncluded,data:n[i-1].data}))));i<n.length&&(o=J.compare(e.stop,n[i].start),o>0||o===0&&(e.isStopIncluded||n[i].isStartIncluded));)if(c(t)?t(n[i].data,e.data):n[i].data===e.data)e=new wn({start:e.start,stop:J.greaterThan(n[i].stop,e.stop)?n[i].stop:e.stop,isStartIncluded:e.isStartIncluded,isStopIncluded:J.greaterThan(n[i].stop,e.stop)?n[i].isStopIncluded:e.isStopIncluded,data:e.data}),n.splice(i,1);else if(n[i]=new wn({start:e.stop,stop:n[i].stop,isStartIncluded:!e.isStopIncluded,isStopIncluded:n[i].isStopIncluded,data:n[i].data}),n[i].isEmpty)n.splice(i,1);else break;n.splice(i,0,e),this._changedEvent.raiseEvent(this)};Nr.prototype.removeInterval=function(e){if(!c(e))throw new E("interval is required");if(e.isEmpty)return!1;let t=this._intervals,n=vo(t,e,c5);n<0&&(n=~n);let i=!1;for(n>0&&(J.greaterThan(t[n-1].stop,e.start)||t[n-1].stop.equals(e.start)&&t[n-1].isStopIncluded&&e.isStartIncluded)&&(i=!0,(J.greaterThan(t[n-1].stop,e.stop)||t[n-1].isStopIncluded&&!e.isStopIncluded&&t[n-1].stop.equals(e.stop))&&t.splice(n,0,new wn({start:e.stop,stop:t[n-1].stop,isStartIncluded:!e.isStopIncluded,isStopIncluded:t[n-1].isStopIncluded,data:t[n-1].data})),t[n-1]=new wn({start:t[n-1].start,stop:e.start,isStartIncluded:t[n-1].isStartIncluded,isStopIncluded:!e.isStartIncluded,data:t[n-1].data})),n<t.length&&!e.isStartIncluded&&t[n].isStartIncluded&&e.start.equals(t[n].start)&&(i=!0,t.splice(n,0,new wn({start:t[n].start,stop:t[n].start,isStartIncluded:!0,isStopIncluded:!0,data:t[n].data})),++n);n<t.length&&J.greaterThan(e.stop,t[n].stop);)i=!0,t.splice(n,1);return n<t.length&&e.stop.equals(t[n].stop)&&(i=!0,!e.isStopIncluded&&t[n].isStopIncluded?n+1<t.length&&t[n+1].start.equals(e.stop)&&t[n].data===t[n+1].data?(t.splice(n,1),t[n]=new wn({start:t[n].start,stop:t[n].stop,isStartIncluded:!0,isStopIncluded:t[n].isStopIncluded,data:t[n].data})):t[n]=new wn({start:e.stop,stop:e.stop,isStartIncluded:!0,isStopIncluded:!0,data:t[n].data}):t.splice(n,1)),n<t.length&&(J.greaterThan(e.stop,t[n].start)||e.stop.equals(t[n].start)&&e.isStopIncluded&&t[n].isStartIncluded)&&(i=!0,t[n]=new wn({start:e.stop,stop:t[n].stop,isStartIncluded:!e.isStopIncluded,isStopIncluded:t[n].isStopIncluded,data:t[n].data})),i&&this._changedEvent.raiseEvent(this),i};Nr.prototype.intersect=function(e,t,n){if(!c(e))throw new E("other is required.");let i=new Nr,o=0,r=0,s=this._intervals,a=e._intervals;for(;o<s.length&&r<a.length;){let l=s[o],u=a[r];if(J.lessThan(l.stop,u.start))++o;else if(J.lessThan(u.stop,l.start))++r;else{if(c(n)||c(t)&&t(l.data,u.data)||!c(t)&&u.data===l.data){let f=wn.intersect(l,u,new wn,n);f.isEmpty||i.addInterval(f,t)}J.lessThan(l.stop,u.stop)||l.stop.equals(u.stop)&&!l.isStopIncluded&&u.isStopIncluded?++o:++r}}return i};Nr.fromJulianDateArray=function(e,t){if(!c(e))throw new E("options is required.");if(!c(e.julianDates))throw new E("options.iso8601Array is required.");c(t)||(t=new Nr);let n=e.julianDates,i=n.length,o=e.dataCallback,r=y(e.isStartIncluded,!0),s=y(e.isStopIncluded,!0),a=y(e.leadingInterval,!1),l=y(e.trailingInterval,!1),u,f=0;a&&(++f,u=new wn({start:je.MINIMUM_VALUE,stop:n[0],isStartIncluded:!0,isStopIncluded:!r}),u.data=c(o)?o(u,t.length):t.length,t.addInterval(u));for(let d=0;d<i-1;++d){let p=n[d],g=n[d+1];u=new wn({start:p,stop:g,isStartIncluded:t.length===f?r:!0,isStopIncluded:d===i-2?s:!1}),u.data=c(o)?o(u,t.length):t.length,t.addInterval(u),p=g}return l&&(u=new wn({start:n[i-1],stop:je.MAXIMUM_VALUE,isStartIncluded:!s,isStopIncluded:!0}),u.data=c(o)?o(u,t.length):t.length,t.addInterval(u)),t};var Xa=new d_,iv=[0,31,28,31,30,31,30,31,31,30,31,30,31];function a5(e,t,n){c(n)||(n=new J),J.toGregorianDate(e,Xa);let i=Xa.millisecond+t.millisecond,o=Xa.second+t.second,r=Xa.minute+t.minute,s=Xa.hour+t.hour,a=Xa.day+t.day,l=Xa.month+t.month,u=Xa.year+t.year;for(i>=1e3&&(o+=Math.floor(i/1e3),i=i%1e3),o>=60&&(r+=Math.floor(o/60),o=o%60),r>=60&&(s+=Math.floor(r/60),r=r%60),s>=24&&(a+=Math.floor(s/24),s=s%24),iv[2]=bm(u)?29:28;a>iv[l]||l>=13;)a>iv[l]&&(a-=iv[l],++l),l>=13&&(--l,u+=Math.floor(l/12),l=l%12,++l),iv[2]=bm(u)?29:28;return Xa.millisecond=i,Xa.second=o,Xa.minute=r,Xa.hour=s,Xa.day=a,Xa.month=l,Xa.year=u,J.fromGregorianDate(Xa,n)}var WWe=new J,qWe=/P(?:([\d.,]+)Y)?(?:([\d.,]+)M)?(?:([\d.,]+)W)?(?:([\d.,]+)D)?(?:T(?:([\d.,]+)H)?(?:([\d.,]+)M)?(?:([\d.,]+)S)?)?/;function Ece(e,t){if(!c(e)||e.length===0)return!1;if(t.year=0,t.month=0,t.day=0,t.hour=0,t.minute=0,t.second=0,t.millisecond=0,e[0]==="P"){let n=e.match(qWe);if(!c(n))return!1;if(c(n[1])&&(t.year=Number(n[1].replace(",","."))),c(n[2])&&(t.month=Number(n[2].replace(",","."))),c(n[3])&&(t.day=Number(n[3].replace(",","."))*7),c(n[4])&&(t.day+=Number(n[4].replace(",","."))),c(n[5])&&(t.hour=Number(n[5].replace(",","."))),c(n[6])&&(t.minute=Number(n[6].replace(",","."))),c(n[7])){let i=Number(n[7].replace(",","."));t.second=Math.floor(i),t.millisecond=i%1*1e3}}else e[e.length-1]!=="Z"&&(e+="Z"),J.toGregorianDate(J.fromIso8601(e,WWe),t);return t.year||t.month||t.day||t.hour||t.minute||t.second||t.millisecond}var ov=new d_;Nr.fromIso8601=function(e,t){if(!c(e))throw new E("options is required.");if(!c(e.iso8601))throw new E("options.iso8601 is required.");let n=e.iso8601.split("/"),i=J.fromIso8601(n[0]),o=J.fromIso8601(n[1]),r=[];if(!Ece(n[2],ov))r.push(i,o);else{let s=J.clone(i);for(r.push(s);J.compare(s,o)<0;)s=a5(s,ov),J.compare(o,s)<=0&&J.clone(o,s),r.push(s)}return Nr.fromJulianDateArray({julianDates:r,isStartIncluded:e.isStartIncluded,isStopIncluded:e.isStopIncluded,leadingInterval:e.leadingInterval,trailingInterval:e.trailingInterval,dataCallback:e.dataCallback},t)};Nr.fromIso8601DateArray=function(e,t){if(!c(e))throw new E("options is required.");if(!c(e.iso8601Dates))throw new E("options.iso8601Dates is required.");return Nr.fromJulianDateArray({julianDates:e.iso8601Dates.map(function(n){return J.fromIso8601(n)}),isStartIncluded:e.isStartIncluded,isStopIncluded:e.isStopIncluded,leadingInterval:e.leadingInterval,trailingInterval:e.trailingInterval,dataCallback:e.dataCallback},t)};Nr.fromIso8601DurationArray=function(e,t){if(!c(e))throw new E("options is required.");if(!c(e.epoch))throw new E("options.epoch is required.");if(!c(e.iso8601Durations))throw new E("options.iso8601Durations is required.");let n=e.epoch,i=e.iso8601Durations,o=y(e.relativeToPrevious,!1),r=[],s,a,l=i.length;for(let u=0;u<l;++u)(Ece(i[u],ov)||u===0)&&(o&&c(a)?s=a5(a,ov):s=a5(n,ov),r.push(s),a=s);return Nr.fromJulianDateArray({julianDates:r,isStartIncluded:e.isStartIncluded,isStopIncluded:e.isStopIncluded,leadingInterval:e.leadingInterval,trailingInterval:e.trailingInterval,dataCallback:e.dataCallback},t)};var ts=Nr;function YWe(e,t,n,i){function o(){n.raiseEvent(e)}let r=[];t.removeAll();let s=i.length;for(let a=0;a<s;a++){let l=i.get(a);c(l.data)&&r.indexOf(l.data)===-1&&t.add(l.data.definitionChanged,o)}}function K0(){this._eventHelper=new yr,this._definitionChanged=new pe,this._intervals=new ts,this._intervals.changedEvent.addEventListener(K0.prototype._intervalsChanged,this)}Object.defineProperties(K0.prototype,{isConstant:{get:function(){return this._intervals.isEmpty}},definitionChanged:{get:function(){return this._definitionChanged}},intervals:{get:function(){return this._intervals}}});var XWe=new J;K0.prototype.getValue=function(e,t){c(e)||(e=J.now(XWe));let n=this._intervals.findDataForIntervalContainingDate(e);if(c(n))return n.getValue(e,t)};K0.prototype.equals=function(e){return this===e||e instanceof K0&&this._intervals.equals(e._intervals,X.equals)};K0.prototype._intervalsChanged=function(){YWe(this,this._eventHelper,this._definitionChanged,this._intervals),this._definitionChanged.raiseEvent(this)};var fl=K0;function _g(){this._definitionChanged=new pe,this._composite=new fl,this._composite.definitionChanged.addEventListener(_g.prototype._raiseDefinitionChanged,this)}Object.defineProperties(_g.prototype,{isConstant:{get:function(){return this._composite.isConstant}},definitionChanged:{get:function(){return this._definitionChanged}},intervals:{get:function(){return this._composite._intervals}}});_g.prototype.getType=function(e){if(!c(e))throw new E("time is required");let t=this._composite._intervals.findDataForIntervalContainingDate(e);if(c(t))return t.getType(e)};var KWe=new J;_g.prototype.getValue=function(e,t){c(e)||(e=J.now(KWe));let n=this._composite._intervals.findDataForIntervalContainingDate(e);if(c(n))return n.getValue(e,t)};_g.prototype.equals=function(e){return this===e||e instanceof _g&&this._composite.equals(e._composite,X.equals)};_g.prototype._raiseDefinitionChanged=function(){this._definitionChanged.raiseEvent(this)};var j1=_g;function gg(e){this._referenceFrame=y(e,ji.FIXED),this._definitionChanged=new pe,this._composite=new fl,this._composite.definitionChanged.addEventListener(gg.prototype._raiseDefinitionChanged,this)}Object.defineProperties(gg.prototype,{isConstant:{get:function(){return this._composite.isConstant}},definitionChanged:{get:function(){return this._definitionChanged}},intervals:{get:function(){return this._composite.intervals}},referenceFrame:{get:function(){return this._referenceFrame},set:function(e){this._referenceFrame=e}}});var $We=new J;gg.prototype.getValue=function(e,t){return c(e)||(e=J.now($We)),this.getValueInReferenceFrame(e,ji.FIXED,t)};gg.prototype.getValueInReferenceFrame=function(e,t,n){if(!c(e))throw new E("time is required.");if(!c(t))throw new E("referenceFrame is required.");let i=this._composite._intervals.findDataForIntervalContainingDate(e);if(c(i))return i.getValueInReferenceFrame(e,t,n)};gg.prototype.equals=function(e){return this===e||e instanceof gg&&this._referenceFrame===e._referenceFrame&&this._composite.equals(e._composite,X.equals)};gg.prototype._raiseDefinitionChanged=function(){this._definitionChanged.raiseEvent(this)};var Ka=gg;var ZWe={ROUNDED:0,MITERED:1,BEVELED:2},ki=Object.freeze(ZWe);var Qs=[new h,new h],JWe=new h,QWe=new h,eqe=new h,tqe=new h,nqe=new h,iqe=new h,oqe=new h,rqe=new h,sqe=new h,iA=new h,W1=new h,rv={},l5=new he;function aqe(e,t){let n=new Array(e.length);for(let i=0;i<e.length;i++){let o=e[i];l5=t.cartesianToCartographic(o,l5),n[i]=l5.height,e[i]=t.scaleToGeodeticSurface(o,o)}return n}function u5(e,t,n,i){let o=e[0],r=e[1],s=h.angleBetween(o,r),a=Math.ceil(s/i),l=new Array(a),u;if(t===n){for(u=0;u<a;u++)l[u]=t;return l.push(n),l}let d=(n-t)/a;for(u=1;u<a;u++){let p=t+u*d;l[u]=p}return l[0]=t,l.push(n),l}var q1=new h,Y1=new h;function cqe(e,t,n,i){let o=new cs(n,i),r=o.projectPointOntoPlane(h.add(n,e,q1),q1),s=o.projectPointOntoPlane(h.add(n,t,Y1),Y1),a=H.angleBetween(r,s);return s.x*r.y-s.y*r.x>=0?-a:a}var lqe=new h(-1,0,0),$0=new k,uqe=new k,f5=new Q,fqe=Q.IDENTITY.clone(),dqe=new h,hqe=new se,Sce=new h;function Pp(e,t,n,i,o,r,s,a){let l=dqe,u=hqe;$0=Ft.eastNorthUpToFixedFrame(e,o,$0),l=k.multiplyByPointAsVector($0,lqe,l),l=h.normalize(l,l);let f=cqe(l,t,e,o);f5=Q.fromRotationZ(f,f5),Sce.z=r,$0=k.multiplyTransformation($0,k.fromRotationTranslation(f5,Sce,uqe),$0);let d=fqe;d[0]=s;for(let p=0;p<a;p++)for(let g=0;g<n.length;g+=3)u=h.fromArray(n,g,u),u=Q.multiplyByVector(d,u,u),u=k.multiplyByPoint($0,u,u),i.push(u.x,u.y,u.z);return i}var mqe=new h;function d5(e,t,n,i,o,r,s){for(let a=0;a<e.length;a+=3){let l=h.fromArray(e,a,mqe);i=Pp(l,t,n,i,o,r[a/3],s,1)}return i}function pqe(e,t){let n=e.length,i=new Array(n*6),o=0,r=t.x+t.width/2,s=t.y+t.height/2,a=e[0];i[o++]=a.x-r,i[o++]=0,i[o++]=a.y-s;for(let l=1;l<n;l++){a=e[l];let u=a.x-r,f=a.y-s;i[o++]=u,i[o++]=0,i[o++]=f,i[o++]=u,i[o++]=0,i[o++]=f}return a=e[0],i[o++]=a.x-r,i[o++]=0,i[o++]=a.y-s,i}function wce(e,t){let n=e.length,i=new Array(n*3),o=0,r=t.x+t.width/2,s=t.y+t.height/2;for(let a=0;a<n;a++)i[o++]=e[a].x-r,i[o++]=0,i[o++]=e[a].y-s;return i}var vce=new Ne,Dce=new h,Pce=new Q;function Ice(e,t,n,i,o,r,s,a,l,u){let f=h.angleBetween(h.subtract(t,e,iA),h.subtract(n,e,W1)),d=i===ki.BEVELED?0:Math.ceil(f/R.toRadians(5)),p;o?p=Q.fromQuaternion(Ne.fromAxisAngle(h.negate(e,iA),f/(d+1),vce),Pce):p=Q.fromQuaternion(Ne.fromAxisAngle(e,f/(d+1),vce),Pce);let g,m;if(t=h.clone(t,Dce),d>0){let b=u?2:1;for(let x=0;x<d;x++)t=Q.multiplyByVector(p,t,t),g=h.subtract(t,e,iA),g=h.normalize(g,g),o||(g=h.negate(g,g)),m=r.scaleToGeodeticSurface(t,W1),s=Pp(m,g,a,s,r,l,1,b)}else g=h.subtract(t,e,iA),g=h.normalize(g,g),o||(g=h.negate(g,g)),m=r.scaleToGeodeticSurface(t,W1),s=Pp(m,g,a,s,r,l,1,1),n=h.clone(n,Dce),g=h.subtract(n,e,iA),g=h.normalize(g,g),o||(g=h.negate(g,g)),m=r.scaleToGeodeticSurface(n,W1),s=Pp(m,g,a,s,r,l,1,1);return s}rv.removeDuplicatesFromShape=function(e){let t=e.length,n=[];for(let i=t-1,o=0;o<t;i=o++){let r=e[i],s=e[o];H.equals(r,s)||n.push(s)}return n};rv.angleIsGreaterThanPi=function(e,t,n,i){let o=new cs(n,i),r=o.projectPointOntoPlane(h.add(n,e,q1),q1),s=o.projectPointOntoPlane(h.add(n,t,Y1),Y1);return s.x*r.y-s.y*r.x>=0};var _qe=new h,gqe=new h;rv.computePositions=function(e,t,n,i,o){let r=i._ellipsoid,s=aqe(e,r),a=i._granularity,l=i._cornerType,u=o?pqe(t,n):wce(t,n),f=o?wce(t,n):void 0,d=n.height/2,p=n.width/2,g=e.length,m=[],b=o?[]:void 0,x=JWe,T=QWe,C=eqe,S=tqe,v=nqe,D=iqe,I=oqe,L=rqe,M=sqe,N=e[0],B=e[1];S=r.geodeticSurfaceNormal(N,S),x=h.subtract(B,N,x),x=h.normalize(x,x),L=h.cross(S,x,L),L=h.normalize(L,L);let _=s[0],w=s[1];o&&(b=Pp(N,L,f,b,r,_+d,1,1)),M=h.clone(N,M),N=B,T=h.negate(x,T);let P,O;for(let G=1;G<g-1;G++){let z=o?2:1;if(B=e[G+1],N.equals(B)){_t("Positions are too close and are considered equivalent with rounding error.");continue}x=h.subtract(B,N,x),x=h.normalize(x,x),S=r.geodeticSurfaceNormal(N,S);let W=h.multiplyByScalar(S,h.dot(x,S),_qe);h.subtract(x,W,W),h.normalize(W,W);let U=h.multiplyByScalar(S,h.dot(T,S),gqe);if(h.subtract(T,U,U),h.normalize(U,U),!R.equalsEpsilon(Math.abs(h.dot(W,U)),1,R.EPSILON7)){C=h.add(x,T,C),C=h.normalize(C,C),C=h.cross(C,S,C),C=h.cross(S,C,C),C=h.normalize(C,C);let K=1/Math.max(.25,h.magnitude(h.cross(C,T,iA))),te=rv.angleIsGreaterThanPi(x,T,N,r);te?(v=h.add(N,h.multiplyByScalar(C,K*p,C),v),D=h.add(v,h.multiplyByScalar(L,p,D),D),Qs[0]=h.clone(M,Qs[0]),Qs[1]=h.clone(D,Qs[1]),P=u5(Qs,_+d,w+d,a),O=Bi.generateArc({positions:Qs,granularity:a,ellipsoid:r}),m=d5(O,L,u,m,r,P,1),L=h.cross(S,x,L),L=h.normalize(L,L),I=h.add(v,h.multiplyByScalar(L,p,I),I),l===ki.ROUNDED||l===ki.BEVELED?Ice(v,D,I,l,te,r,m,u,w+d,o):(C=h.negate(C,C),m=Pp(N,C,u,m,r,w+d,K,z)),M=h.clone(I,M)):(v=h.add(N,h.multiplyByScalar(C,K*p,C),v),D=h.add(v,h.multiplyByScalar(L,-p,D),D),Qs[0]=h.clone(M,Qs[0]),Qs[1]=h.clone(D,Qs[1]),P=u5(Qs,_+d,w+d,a),O=Bi.generateArc({positions:Qs,granularity:a,ellipsoid:r}),m=d5(O,L,u,m,r,P,1),L=h.cross(S,x,L),L=h.normalize(L,L),I=h.add(v,h.multiplyByScalar(L,-p,I),I),l===ki.ROUNDED||l===ki.BEVELED?Ice(v,D,I,l,te,r,m,u,w+d,o):m=Pp(N,C,u,m,r,w+d,K,z),M=h.clone(I,M)),T=h.negate(x,T)}else m=Pp(M,L,u,m,r,_+d,1,1),M=N;_=w,w=s[G+1],N=B}Qs[0]=h.clone(M,Qs[0]),Qs[1]=h.clone(N,Qs[1]),P=u5(Qs,_+d,w+d,a),O=Bi.generateArc({positions:Qs,granularity:a,ellipsoid:r}),m=d5(O,L,u,m,r,P,1),o&&(b=Pp(N,L,f,b,r,w+d,1,1)),g=m.length;let F=o?g+b.length:g,V=new Float64Array(F);return V.set(m),o&&V.set(b,g),V};var Ip=rv;var m5={},oA=new h,Nce=new h,yqe=new h,Oce=new h,wc=[new h,new h],Fce=new h,Bce=new h,kce=new h,bqe=new h,xqe=new h,Tqe=new h,Aqe=new h,Cqe=new h,Eqe=new h,Sqe=new h,Rce=new Ne,Mce=new Q;function X1(e,t,n,i,o){let r=h.angleBetween(h.subtract(t,e,oA),h.subtract(n,e,Nce)),s=i===ki.BEVELED?1:Math.ceil(r/R.toRadians(5))+1,a=s*3,l=new Array(a);l[a-3]=n.x,l[a-2]=n.y,l[a-1]=n.z;let u;o?u=Q.fromQuaternion(Ne.fromAxisAngle(h.negate(e,oA),r/s,Rce),Mce):u=Q.fromQuaternion(Ne.fromAxisAngle(e,r/s,Rce),Mce);let f=0;t=h.clone(t,oA);for(let d=0;d<s;d++)t=Q.multiplyByVector(u,t,t),l[f++]=t.x,l[f++]=t.y,l[f++]=t.z;return l}function wqe(e){let t=Fce,n=Bce,i=kce,o=e[1];n=h.fromArray(e[1],o.length-3,n),i=h.fromArray(e[0],0,i),t=h.midpoint(n,i,t);let r=X1(t,n,i,ki.ROUNDED,!1),s=e.length-1,a=e[s-1];o=e[s],n=h.fromArray(a,a.length-3,n),i=h.fromArray(o,0,i),t=h.midpoint(n,i,t);let l=X1(t,n,i,ki.ROUNDED,!1);return[r,l]}function Lce(e,t,n,i){let o=oA;return i?o=h.add(e,t,o):(t=h.negate(t,t),o=h.add(e,t,o)),[o.x,o.y,o.z,n.x,n.y,n.z]}function h5(e,t,n,i){let o=new Array(e.length),r=new Array(e.length),s=h.multiplyByScalar(t,n,oA),a=h.negate(s,Nce),l=0,u=e.length-1;for(let f=0;f<e.length;f+=3){let d=h.fromArray(e,f,yqe),p=h.add(d,a,Oce);o[l++]=p.x,o[l++]=p.y,o[l++]=p.z;let g=h.add(d,s,Oce);r[u--]=g.z,r[u--]=g.y,r[u--]=g.x}return i.push(o,r),i}m5.addAttribute=function(e,t,n,i){let o=t.x,r=t.y,s=t.z;c(n)&&(e[n]=o,e[n+1]=r,e[n+2]=s),c(i)&&(e[i]=s,e[i-1]=r,e[i-2]=o)};var vqe=new h,Dqe=new h;m5.computePositions=function(e){let t=e.granularity,n=e.positions,i=e.ellipsoid,o=e.width/2,r=e.cornerType,s=e.saveAttributes,a=Fce,l=Bce,u=kce,f=bqe,d=xqe,p=Tqe,g=Aqe,m=Cqe,b=Eqe,x=Sqe,T=[],C=s?[]:void 0,S=s?[]:void 0,v=n[0],D=n[1];l=h.normalize(h.subtract(D,v,l),l),a=i.geodeticSurfaceNormal(v,a),f=h.normalize(h.cross(a,l,f),f),s&&(C.push(f.x,f.y,f.z),S.push(a.x,a.y,a.z)),g=h.clone(v,g),v=D,u=h.negate(l,u);let I,L=[],M,N=n.length;for(M=1;M<N-1;M++){a=i.geodeticSurfaceNormal(v,a),D=n[M+1],l=h.normalize(h.subtract(D,v,l),l);let _=h.multiplyByScalar(a,h.dot(l,a),vqe);h.subtract(l,_,_),h.normalize(_,_);let w=h.multiplyByScalar(a,h.dot(u,a),Dqe);if(h.subtract(u,w,w),h.normalize(w,w),!R.equalsEpsilon(Math.abs(h.dot(_,w)),1,R.EPSILON7)){d=h.normalize(h.add(l,u,d),d),d=h.cross(d,a,d),d=h.cross(a,d,d),d=h.normalize(d,d);let O=o/Math.max(.25,h.magnitude(h.cross(d,u,oA))),F=Ip.angleIsGreaterThanPi(l,u,v,i);d=h.multiplyByScalar(d,O,d),F?(m=h.add(v,d,m),x=h.add(m,h.multiplyByScalar(f,o,x),x),b=h.add(m,h.multiplyByScalar(f,o*2,b),b),wc[0]=h.clone(g,wc[0]),wc[1]=h.clone(x,wc[1]),I=Bi.generateArc({positions:wc,granularity:t,ellipsoid:i}),T=h5(I,f,o,T),s&&(C.push(f.x,f.y,f.z),S.push(a.x,a.y,a.z)),p=h.clone(b,p),f=h.normalize(h.cross(a,l,f),f),b=h.add(m,h.multiplyByScalar(f,o*2,b),b),g=h.add(m,h.multiplyByScalar(f,o,g),g),r===ki.ROUNDED||r===ki.BEVELED?L.push({leftPositions:X1(m,p,b,r,F)}):L.push({leftPositions:Lce(v,h.negate(d,d),b,F)})):(b=h.add(v,d,b),x=h.add(b,h.negate(h.multiplyByScalar(f,o,x),x),x),m=h.add(b,h.negate(h.multiplyByScalar(f,o*2,m),m),m),wc[0]=h.clone(g,wc[0]),wc[1]=h.clone(x,wc[1]),I=Bi.generateArc({positions:wc,granularity:t,ellipsoid:i}),T=h5(I,f,o,T),s&&(C.push(f.x,f.y,f.z),S.push(a.x,a.y,a.z)),p=h.clone(m,p),f=h.normalize(h.cross(a,l,f),f),m=h.add(b,h.negate(h.multiplyByScalar(f,o*2,m),m),m),g=h.add(b,h.negate(h.multiplyByScalar(f,o,g),g),g),r===ki.ROUNDED||r===ki.BEVELED?L.push({rightPositions:X1(b,p,m,r,F)}):L.push({rightPositions:Lce(v,d,m,F)})),u=h.negate(l,u)}v=D}a=i.geodeticSurfaceNormal(v,a),wc[0]=h.clone(g,wc[0]),wc[1]=h.clone(v,wc[1]),I=Bi.generateArc({positions:wc,granularity:t,ellipsoid:i}),T=h5(I,f,o,T),s&&(C.push(f.x,f.y,f.z),S.push(a.x,a.y,a.z));let B;return r===ki.ROUNDED&&(B=wqe(T)),{positions:T,corners:L,lefts:C,normals:S,endPositions:B}};var Wi=m5;var zce=new h,Hce=new h,K1=new h,$1=new h,Pqe=new h,Gce=new h,yg=new h,rA=new h;function jce(e,t){for(let n=0;n<e.length;n++)e[n]=t.scaleToGeodeticSurface(e[n],e[n]);return e}function hd(e,t,n,i,o,r){let s=e.normals,a=e.tangents,l=e.bitangents,u=h.normalize(h.cross(n,t,yg),yg);r.normal&&Wi.addAttribute(s,t,i,o),r.tangent&&Wi.addAttribute(a,u,i,o),r.bitangent&&Wi.addAttribute(l,n,i,o)}function Wce(e,t,n){let i=e.positions,o=e.corners,r=e.endPositions,s=e.lefts,a=e.normals,l=new pn,u,f=0,d=0,p,g=0,m;for(p=0;p<i.length;p+=2)m=i[p].length-3,f+=m,g+=m*2,d+=i[p+1].length-3;for(f+=3,d+=3,p=0;p<o.length;p++){u=o[p];let ee=o[p].leftPositions;c(ee)?(m=ee.length,f+=m,g+=m):(m=o[p].rightPositions.length,d+=m,g+=m)}let b=c(r),x;b&&(x=r[0].length-3,f+=x,d+=x,x/=3,g+=x*6);let T=f+d,C=new Float64Array(T),S=t.normal?new Float32Array(T):void 0,v=t.tangent?new Float32Array(T):void 0,D=t.bitangent?new Float32Array(T):void 0,I={normals:S,tangents:v,bitangents:D},L=0,M=T-1,N,B,_,w,P=zce,O=Hce,F,V,G=x/2,z=Fe.createTypedArray(T/3,g),W=0;if(b){V=K1,F=$1;let ee=r[0];for(P=h.fromArray(a,0,P),O=h.fromArray(s,0,O),p=0;p<G;p++)V=h.fromArray(ee,(G-1-p)*3,V),F=h.fromArray(ee,(G+p)*3,F),Wi.addAttribute(C,F,L),Wi.addAttribute(C,V,void 0,M),hd(I,P,O,L,M,t),B=L/3,w=B+1,N=(M-2)/3,_=N-1,z[W++]=N,z[W++]=B,z[W++]=_,z[W++]=_,z[W++]=B,z[W++]=w,L+=3,M-=3}let U=0,q=0,K=i[U++],te=i[U++];C.set(K,L),C.set(te,M-te.length+1),O=h.fromArray(s,q,O);let Y,Z;for(m=te.length-3,p=0;p<m;p+=3)Y=n.geodeticSurfaceNormal(h.fromArray(K,p,yg),yg),Z=n.geodeticSurfaceNormal(h.fromArray(te,m-p,rA),rA),P=h.normalize(h.add(Y,Z,P),P),hd(I,P,O,L,M,t),B=L/3,w=B+1,N=(M-2)/3,_=N-1,z[W++]=N,z[W++]=B,z[W++]=_,z[W++]=_,z[W++]=B,z[W++]=w,L+=3,M-=3;for(Y=n.geodeticSurfaceNormal(h.fromArray(K,m,yg),yg),Z=n.geodeticSurfaceNormal(h.fromArray(te,m,rA),rA),P=h.normalize(h.add(Y,Z,P),P),q+=3,p=0;p<o.length;p++){let ee;u=o[p];let me=u.leftPositions,be=u.rightPositions,le,ge,xe=Gce,Pe=K1,Ee=$1;if(P=h.fromArray(a,q,P),c(me)){for(hd(I,P,O,void 0,M,t),M-=3,le=w,ge=_,ee=0;ee<me.length/3;ee++)xe=h.fromArray(me,ee*3,xe),z[W++]=le,z[W++]=ge-ee-1,z[W++]=ge-ee,Wi.addAttribute(C,xe,void 0,M),Pe=h.fromArray(C,(ge-ee-1)*3,Pe),Ee=h.fromArray(C,le*3,Ee),O=h.normalize(h.subtract(Pe,Ee,O),O),hd(I,P,O,void 0,M,t),M-=3;xe=h.fromArray(C,le*3,xe),Pe=h.subtract(h.fromArray(C,ge*3,Pe),xe,Pe),Ee=h.subtract(h.fromArray(C,(ge-ee)*3,Ee),xe,Ee),O=h.normalize(h.add(Pe,Ee,O),O),hd(I,P,O,L,void 0,t),L+=3}else{for(hd(I,P,O,L,void 0,t),L+=3,le=_,ge=w,ee=0;ee<be.length/3;ee++)xe=h.fromArray(be,ee*3,xe),z[W++]=le,z[W++]=ge+ee,z[W++]=ge+ee+1,Wi.addAttribute(C,xe,L),Pe=h.fromArray(C,le*3,Pe),Ee=h.fromArray(C,(ge+ee)*3,Ee),O=h.normalize(h.subtract(Pe,Ee,O),O),hd(I,P,O,L,void 0,t),L+=3;xe=h.fromArray(C,le*3,xe),Pe=h.subtract(h.fromArray(C,(ge+ee)*3,Pe),xe,Pe),Ee=h.subtract(h.fromArray(C,ge*3,Ee),xe,Ee),O=h.normalize(h.negate(h.add(Ee,Pe,O),O),O),hd(I,P,O,void 0,M,t),M-=3}for(K=i[U++],te=i[U++],K.splice(0,3),te.splice(te.length-3,3),C.set(K,L),C.set(te,M-te.length+1),m=te.length-3,q+=3,O=h.fromArray(s,q,O),ee=0;ee<te.length;ee+=3)Y=n.geodeticSurfaceNormal(h.fromArray(K,ee,yg),yg),Z=n.geodeticSurfaceNormal(h.fromArray(te,m-ee,rA),rA),P=h.normalize(h.add(Y,Z,P),P),hd(I,P,O,L,M,t),w=L/3,B=w-1,_=(M-2)/3,N=_+1,z[W++]=N,z[W++]=B,z[W++]=_,z[W++]=_,z[W++]=B,z[W++]=w,L+=3,M-=3;L-=3,M+=3}if(P=h.fromArray(a,a.length-3,P),hd(I,P,O,L,M,t),b){L+=3,M-=3,V=K1,F=$1;let ee=r[1];for(p=0;p<G;p++)V=h.fromArray(ee,(x-p-1)*3,V),F=h.fromArray(ee,p*3,F),Wi.addAttribute(C,V,void 0,M),Wi.addAttribute(C,F,L),hd(I,P,O,L,M,t),w=L/3,B=w-1,_=(M-2)/3,N=_+1,z[W++]=N,z[W++]=B,z[W++]=_,z[W++]=_,z[W++]=B,z[W++]=w,L+=3,M-=3}if(l.position=new we({componentDatatype:$.DOUBLE,componentsPerAttribute:3,values:C}),t.st){let ee=new Float32Array(T/3*2),me,be,le=0;if(b){f/=3,d/=3;let ge=Math.PI/(x+1);be=1/(f-x+1),me=1/(d-x+1);let xe,Pe=x/2;for(p=Pe+1;p<x+1;p++)xe=R.PI_OVER_TWO+ge*p,ee[le++]=me*(1+Math.cos(xe)),ee[le++]=.5*(1+Math.sin(xe));for(p=1;p<d-x+1;p++)ee[le++]=p*me,ee[le++]=0;for(p=x;p>Pe;p--)xe=R.PI_OVER_TWO-p*ge,ee[le++]=1-me*(1+Math.cos(xe)),ee[le++]=.5*(1+Math.sin(xe));for(p=Pe;p>0;p--)xe=R.PI_OVER_TWO-ge*p,ee[le++]=1-be*(1+Math.cos(xe)),ee[le++]=.5*(1+Math.sin(xe));for(p=f-x;p>0;p--)ee[le++]=p*be,ee[le++]=1;for(p=1;p<Pe+1;p++)xe=R.PI_OVER_TWO+ge*p,ee[le++]=be*(1+Math.cos(xe)),ee[le++]=.5*(1+Math.sin(xe))}else{for(f/=3,d/=3,be=1/(f-1),me=1/(d-1),p=0;p<d;p++)ee[le++]=p*me,ee[le++]=0;for(p=f;p>0;p--)ee[le++]=(p-1)*be,ee[le++]=1}l.st=new we({componentDatatype:$.FLOAT,componentsPerAttribute:2,values:ee})}return t.normal&&(l.normal=new we({componentDatatype:$.FLOAT,componentsPerAttribute:3,values:I.normals})),t.tangent&&(l.tangent=new we({componentDatatype:$.FLOAT,componentsPerAttribute:3,values:I.tangents})),t.bitangent&&(l.bitangent=new we({componentDatatype:$.FLOAT,componentsPerAttribute:3,values:I.bitangents})),{attributes:l,indices:z}}function Iqe(e,t){if(!t.normal&&!t.tangent&&!t.bitangent&&!t.st)return e;let n=e.position.values,i,o;(t.normal||t.bitangent)&&(i=e.normal.values,o=e.bitangent.values);let r=e.position.values.length/18,s=r*3,a=r*2,l=s*2,u;if(t.normal||t.bitangent||t.tangent){let f=t.normal?new Float32Array(s*6):void 0,d=t.tangent?new Float32Array(s*6):void 0,p=t.bitangent?new Float32Array(s*6):void 0,g=zce,m=Hce,b=K1,x=$1,T=Pqe,C=Gce,S=l;for(u=0;u<s;u+=3){let v=S+l;g=h.fromArray(n,u,g),m=h.fromArray(n,u+s,m),b=h.fromArray(n,(u+3)%s,b),m=h.subtract(m,g,m),b=h.subtract(b,g,b),x=h.normalize(h.cross(m,b,x),x),t.normal&&(Wi.addAttribute(f,x,v),Wi.addAttribute(f,x,v+3),Wi.addAttribute(f,x,S),Wi.addAttribute(f,x,S+3)),(t.tangent||t.bitangent)&&(C=h.fromArray(i,u,C),t.bitangent&&(Wi.addAttribute(p,C,v),Wi.addAttribute(p,C,v+3),Wi.addAttribute(p,C,S),Wi.addAttribute(p,C,S+3)),t.tangent&&(T=h.normalize(h.cross(C,x,T),T),Wi.addAttribute(d,T,v),Wi.addAttribute(d,T,v+3),Wi.addAttribute(d,T,S),Wi.addAttribute(d,T,S+3))),S+=6}if(t.normal){for(f.set(i),u=0;u<s;u+=3)f[u+s]=-i[u],f[u+s+1]=-i[u+1],f[u+s+2]=-i[u+2];e.normal.values=f}else e.normal=void 0;if(t.bitangent?(p.set(o),p.set(o,s),e.bitangent.values=p):e.bitangent=void 0,t.tangent){let v=e.tangent.values;d.set(v),d.set(v,s),e.tangent.values=d}}if(t.st){let f=e.st.values,d=new Float32Array(a*6);d.set(f),d.set(f,a);let p=a*2;for(let g=0;g<2;g++){for(d[p++]=f[0],d[p++]=f[1],u=2;u<a;u+=2){let m=f[u],b=f[u+1];d[p++]=m,d[p++]=b,d[p++]=m,d[p++]=b}d[p++]=f[0],d[p++]=f[1]}e.st.values=d}return e}function p5(e,t,n){n[t++]=e[0],n[t++]=e[1],n[t++]=e[2];for(let i=3;i<e.length;i+=3){let o=e[i],r=e[i+1],s=e[i+2];n[t++]=o,n[t++]=r,n[t++]=s,n[t++]=o,n[t++]=r,n[t++]=s}return n[t++]=e[0],n[t++]=e[1],n[t++]=e[2],n}function Oqe(e,t){let n=new Ie({position:t.position,normal:t.normal||t.bitangent||e.shadowVolume,tangent:t.tangent,bitangent:t.normal||t.bitangent,st:t.st}),i=e.ellipsoid,o=Wi.computePositions(e),r=Wce(o,n,i),s=e.height,a=e.extrudedHeight,l=r.attributes,u=r.indices,f=l.position.values,d=f.length,p=new Float64Array(d*6),g=new Float64Array(d);g.set(f);let m=new Float64Array(d*4);f=ai.scaleToGeodeticHeight(f,s,i),m=p5(f,0,m),g=ai.scaleToGeodeticHeight(g,a,i),m=p5(g,d*2,m),p.set(f),p.set(g,d),p.set(m,d*2),l.position.values=p,l=Iqe(l,t);let b,x=d/3;if(e.shadowVolume){let N=l.normal.values;d=N.length;let B=new Float32Array(d*6);for(b=0;b<d;b++)N[b]=-N[b];B.set(N,d),B=p5(N,d*4,B),l.extrudeDirection=new we({componentDatatype:$.FLOAT,componentsPerAttribute:3,values:B}),t.normal||(l.normal=void 0)}if(c(e.offsetAttribute)){let N=new Uint8Array(x*6);if(e.offsetAttribute===Jt.TOP)N=N.fill(1,0,x).fill(1,x*2,x*4);else{let B=e.offsetAttribute===Jt.NONE?0:1;N=N.fill(B)}l.applyOffset=new we({componentDatatype:$.UNSIGNED_BYTE,componentsPerAttribute:1,values:N})}let T=u.length,C=x+x,S=Fe.createTypedArray(p.length/3,T*2+C*3);S.set(u);let v=T;for(b=0;b<T;b+=3){let N=u[b],B=u[b+1],_=u[b+2];S[v++]=_+x,S[v++]=B+x,S[v++]=N+x}let D,I,L,M;for(b=0;b<C;b+=2)D=b+C,I=D+C,L=D+1,M=I+1,S[v++]=D,S[v++]=I,S[v++]=L,S[v++]=L,S[v++]=I,S[v++]=M;return{attributes:l,indices:S}}var Vce=new h,sv=new h,ff=new he;function Uce(e,t,n,i,o,r){let s=h.subtract(t,e,Vce);h.normalize(s,s);let a=n.geodeticSurfaceNormal(e,sv),l=h.cross(s,a,Vce);h.multiplyByScalar(l,i,l);let u=o.latitude,f=o.longitude,d=r.latitude,p=r.longitude;h.add(e,l,sv),n.cartesianToCartographic(sv,ff);let g=ff.latitude,m=ff.longitude;u=Math.min(u,g),f=Math.min(f,m),d=Math.max(d,g),p=Math.max(p,m),h.subtract(e,l,sv),n.cartesianToCartographic(sv,ff),g=ff.latitude,m=ff.longitude,u=Math.min(u,g),f=Math.min(f,m),d=Math.max(d,g),p=Math.max(p,m),o.latitude=u,o.longitude=f,r.latitude=d,r.longitude=p}var uf=new h,av=new h,dl=new he,hl=new he;function qce(e,t,n,i,o){e=jce(e,t);let r=Ao(e,h.equalsEpsilon),s=r.length;if(s<2||n<=0)return new ae;let a=n*.5;dl.latitude=Number.POSITIVE_INFINITY,dl.longitude=Number.POSITIVE_INFINITY,hl.latitude=Number.NEGATIVE_INFINITY,hl.longitude=Number.NEGATIVE_INFINITY;let l,u;if(i===ki.ROUNDED){let p=r[0];h.subtract(p,r[1],uf),h.normalize(uf,uf),h.multiplyByScalar(uf,a,uf),h.add(p,uf,av),t.cartesianToCartographic(av,ff),l=ff.latitude,u=ff.longitude,dl.latitude=Math.min(dl.latitude,l),dl.longitude=Math.min(dl.longitude,u),hl.latitude=Math.max(hl.latitude,l),hl.longitude=Math.max(hl.longitude,u)}for(let p=0;p<s-1;++p)Uce(r[p],r[p+1],t,a,dl,hl);let f=r[s-1];h.subtract(f,r[s-2],uf),h.normalize(uf,uf),h.multiplyByScalar(uf,a,uf),h.add(f,uf,av),Uce(f,av,t,a,dl,hl),i===ki.ROUNDED&&(t.cartesianToCartographic(av,ff),l=ff.latitude,u=ff.longitude,dl.latitude=Math.min(dl.latitude,l),dl.longitude=Math.min(dl.longitude,u),hl.latitude=Math.max(hl.latitude,l),hl.longitude=Math.max(hl.longitude,u));let d=c(o)?o:new ae;return d.north=hl.latitude,d.south=dl.latitude,d.east=hl.longitude,d.west=dl.longitude,d}function Rp(e){e=y(e,y.EMPTY_OBJECT);let t=e.positions,n=e.width;A.defined("options.positions",t),A.defined("options.width",n);let i=y(e.height,0),o=y(e.extrudedHeight,i);this._positions=t,this._ellipsoid=ie.clone(y(e.ellipsoid,ie.default)),this._vertexFormat=Ie.clone(y(e.vertexFormat,Ie.DEFAULT)),this._width=n,this._height=Math.max(i,o),this._extrudedHeight=Math.min(i,o),this._cornerType=y(e.cornerType,ki.ROUNDED),this._granularity=y(e.granularity,R.RADIANS_PER_DEGREE),this._shadowVolume=y(e.shadowVolume,!1),this._workerName="createCorridorGeometry",this._offsetAttribute=e.offsetAttribute,this._rectangle=void 0,this.packedLength=1+t.length*h.packedLength+ie.packedLength+Ie.packedLength+7}Rp.pack=function(e,t,n){A.defined("value",e),A.defined("array",t),n=y(n,0);let i=e._positions,o=i.length;t[n++]=o;for(let r=0;r<o;++r,n+=h.packedLength)h.pack(i[r],t,n);return ie.pack(e._ellipsoid,t,n),n+=ie.packedLength,Ie.pack(e._vertexFormat,t,n),n+=Ie.packedLength,t[n++]=e._width,t[n++]=e._height,t[n++]=e._extrudedHeight,t[n++]=e._cornerType,t[n++]=e._granularity,t[n++]=e._shadowVolume?1:0,t[n]=y(e._offsetAttribute,-1),t};var Yce=ie.clone(ie.UNIT_SPHERE),Xce=new Ie,Op={positions:void 0,ellipsoid:Yce,vertexFormat:Xce,width:void 0,height:void 0,extrudedHeight:void 0,cornerType:void 0,granularity:void 0,shadowVolume:void 0,offsetAttribute:void 0};Rp.unpack=function(e,t,n){A.defined("array",e),t=y(t,0);let i=e[t++],o=new Array(i);for(let m=0;m<i;++m,t+=h.packedLength)o[m]=h.unpack(e,t);let r=ie.unpack(e,t,Yce);t+=ie.packedLength;let s=Ie.unpack(e,t,Xce);t+=Ie.packedLength;let a=e[t++],l=e[t++],u=e[t++],f=e[t++],d=e[t++],p=e[t++]===1,g=e[t];return c(n)?(n._positions=o,n._ellipsoid=ie.clone(r,n._ellipsoid),n._vertexFormat=Ie.clone(s,n._vertexFormat),n._width=a,n._height=l,n._extrudedHeight=u,n._cornerType=f,n._granularity=d,n._shadowVolume=p,n._offsetAttribute=g===-1?void 0:g,n):(Op.positions=o,Op.width=a,Op.height=l,Op.extrudedHeight=u,Op.cornerType=f,Op.granularity=d,Op.shadowVolume=p,Op.offsetAttribute=g===-1?void 0:g,new Rp(Op))};Rp.computeRectangle=function(e,t){e=y(e,y.EMPTY_OBJECT);let n=e.positions,i=e.width;A.defined("options.positions",n),A.defined("options.width",i);let o=y(e.ellipsoid,ie.default),r=y(e.cornerType,ki.ROUNDED);return qce(n,o,i,r,t)};Rp.createGeometry=function(e){let t=e._positions,n=e._width,i=e._ellipsoid;t=jce(t,i);let o=Ao(t,h.equalsEpsilon);if(o.length<2||n<=0)return;let r=e._height,s=e._extrudedHeight,a=!R.equalsEpsilon(r,s,0,R.EPSILON2),l=e._vertexFormat,u={ellipsoid:i,positions:o,width:n,cornerType:e._cornerType,granularity:e._granularity,saveAttributes:!0},f;if(a)u.height=r,u.extrudedHeight=s,u.shadowVolume=e._shadowVolume,u.offsetAttribute=e._offsetAttribute,f=Oqe(u,l);else{let g=Wi.computePositions(u);if(f=Wce(g,l,i),f.attributes.position.values=ai.scaleToGeodeticHeight(f.attributes.position.values,r,i),c(e._offsetAttribute)){let m=e._offsetAttribute===Jt.NONE?0:1,b=f.attributes.position.values.length,x=new Uint8Array(b/3).fill(m);f.attributes.applyOffset=new we({componentDatatype:$.UNSIGNED_BYTE,componentsPerAttribute:1,values:x})}}let d=f.attributes,p=ce.fromVertices(d.position.values,void 0,3);return l.position||(f.attributes.position.values=void 0),new ut({attributes:d,indices:f.indices,primitiveType:Me.TRIANGLES,boundingSphere:p,offsetAttribute:e._offsetAttribute})};Rp.createShadowVolume=function(e,t,n){let i=e._granularity,o=e._ellipsoid,r=t(i,o),s=n(i,o);return new Rp({positions:e._positions,width:e._width,cornerType:e._cornerType,ellipsoid:o,granularity:i,extrudedHeight:r,height:s,vertexFormat:Ie.POSITION_ONLY,shadowVolume:!0})};Object.defineProperties(Rp.prototype,{rectangle:{get:function(){return c(this._rectangle)||(this._rectangle=qce(this._positions,this._ellipsoid,this._width,this._cornerType)),this._rectangle}},textureCoordinateRotationPoints:{get:function(){return[0,0,0,1,1,0]}}});var cv=Rp;var Kce=new h,$ce=new h,Rqe=new h;function Mqe(e,t){for(let n=0;n<e.length;n++)e[n]=t.scaleToGeodeticSurface(e[n],e[n]);return e}function Zce(e,t){let n=[],i=e.positions,o=e.corners,r=e.endPositions,s=new pn,a,l=0,u=0,f,d=0,p;for(f=0;f<i.length;f+=2)p=i[f].length-3,l+=p,d+=p/3*4,u+=i[f+1].length-3;for(l+=3,u+=3,f=0;f<o.length;f++){a=o[f];let F=o[f].leftPositions;c(F)?(p=F.length,l+=p,d+=p/3*2):(p=o[f].rightPositions.length,u+=p,d+=p/3*2)}let g=c(r),m;g&&(m=r[0].length-3,l+=m,u+=m,m/=3,d+=m*4);let b=l+u,x=new Float64Array(b),T=0,C=b-1,S,v,D,I,L,M,N=m/2,B=Fe.createTypedArray(b/3,d+4),_=0;if(B[_++]=T/3,B[_++]=(C-2)/3,g){n.push(T/3),M=Kce,L=$ce;let F=r[0];for(f=0;f<N;f++)M=h.fromArray(F,(N-1-f)*3,M),L=h.fromArray(F,(N+f)*3,L),Wi.addAttribute(x,L,T),Wi.addAttribute(x,M,void 0,C),v=T/3,I=v+1,S=(C-2)/3,D=S-1,B[_++]=S,B[_++]=D,B[_++]=v,B[_++]=I,T+=3,C-=3}let w=0,P=i[w++],O=i[w++];for(x.set(P,T),x.set(O,C-O.length+1),p=O.length-3,n.push(T/3,(C-2)/3),f=0;f<p;f+=3)v=T/3,I=v+1,S=(C-2)/3,D=S-1,B[_++]=S,B[_++]=D,B[_++]=v,B[_++]=I,T+=3,C-=3;for(f=0;f<o.length;f++){let F;a=o[f];let V=a.leftPositions,G=a.rightPositions,z,W=Rqe;if(c(V)){for(C-=3,z=D,n.push(I),F=0;F<V.length/3;F++)W=h.fromArray(V,F*3,W),B[_++]=z-F-1,B[_++]=z-F,Wi.addAttribute(x,W,void 0,C),C-=3;n.push(z-Math.floor(V.length/6)),t===ki.BEVELED&&n.push((C-2)/3+1),T+=3}else{for(T+=3,z=I,n.push(D),F=0;F<G.length/3;F++)W=h.fromArray(G,F*3,W),B[_++]=z+F,B[_++]=z+F+1,Wi.addAttribute(x,W,T),T+=3;n.push(z+Math.floor(G.length/6)),t===ki.BEVELED&&n.push(T/3-1),C-=3}for(P=i[w++],O=i[w++],P.splice(0,3),O.splice(O.length-3,3),x.set(P,T),x.set(O,C-O.length+1),p=O.length-3,F=0;F<O.length;F+=3)I=T/3,v=I-1,D=(C-2)/3,S=D+1,B[_++]=S,B[_++]=D,B[_++]=v,B[_++]=I,T+=3,C-=3;T-=3,C+=3,n.push(T/3,(C-2)/3)}if(g){T+=3,C-=3,M=Kce,L=$ce;let F=r[1];for(f=0;f<N;f++)M=h.fromArray(F,(m-f-1)*3,M),L=h.fromArray(F,f*3,L),Wi.addAttribute(x,M,void 0,C),Wi.addAttribute(x,L,T),I=T/3,v=I-1,D=(C-2)/3,S=D+1,B[_++]=S,B[_++]=D,B[_++]=v,B[_++]=I,T+=3,C-=3;n.push(T/3)}else n.push(T/3,(C-2)/3);return B[_++]=T/3,B[_++]=(C-2)/3,s.position=new we({componentDatatype:$.DOUBLE,componentsPerAttribute:3,values:x}),{attributes:s,indices:B,wallIndices:n}}function Lqe(e){let t=e.ellipsoid,n=Wi.computePositions(e),i=Zce(n,e.cornerType),o=i.wallIndices,r=e.height,s=e.extrudedHeight,a=i.attributes,l=i.indices,u=a.position.values,f=u.length,d=new Float64Array(f);d.set(u);let p=new Float64Array(f*2);if(u=ai.scaleToGeodeticHeight(u,r,t),d=ai.scaleToGeodeticHeight(d,s,t),p.set(u),p.set(d,f),a.position.values=p,f/=3,c(e.offsetAttribute)){let S=new Uint8Array(f*2);if(e.offsetAttribute===Jt.TOP)S=S.fill(1,0,f);else{let v=e.offsetAttribute===Jt.NONE?0:1;S=S.fill(v)}a.applyOffset=new we({componentDatatype:$.UNSIGNED_BYTE,componentsPerAttribute:1,values:S})}let g,m=l.length,b=Fe.createTypedArray(p.length/3,(m+o.length)*2);b.set(l);let x=m;for(g=0;g<m;g+=2){let S=l[g],v=l[g+1];b[x++]=S+f,b[x++]=v+f}let T,C;for(g=0;g<o.length;g++)T=o[g],C=T+f,b[x++]=T,b[x++]=C;return{attributes:a,indices:b}}function lv(e){e=y(e,y.EMPTY_OBJECT);let t=e.positions,n=e.width;A.typeOf.object("options.positions",t),A.typeOf.number("options.width",n);let i=y(e.height,0),o=y(e.extrudedHeight,i);this._positions=t,this._ellipsoid=ie.clone(y(e.ellipsoid,ie.default)),this._width=n,this._height=Math.max(i,o),this._extrudedHeight=Math.min(i,o),this._cornerType=y(e.cornerType,ki.ROUNDED),this._granularity=y(e.granularity,R.RADIANS_PER_DEGREE),this._offsetAttribute=e.offsetAttribute,this._workerName="createCorridorOutlineGeometry",this.packedLength=1+t.length*h.packedLength+ie.packedLength+6}lv.pack=function(e,t,n){A.typeOf.object("value",e),A.typeOf.object("array",t),n=y(n,0);let i=e._positions,o=i.length;t[n++]=o;for(let r=0;r<o;++r,n+=h.packedLength)h.pack(i[r],t,n);return ie.pack(e._ellipsoid,t,n),n+=ie.packedLength,t[n++]=e._width,t[n++]=e._height,t[n++]=e._extrudedHeight,t[n++]=e._cornerType,t[n++]=e._granularity,t[n]=y(e._offsetAttribute,-1),t};var Jce=ie.clone(ie.UNIT_SPHERE),bg={positions:void 0,ellipsoid:Jce,width:void 0,height:void 0,extrudedHeight:void 0,cornerType:void 0,granularity:void 0,offsetAttribute:void 0};lv.unpack=function(e,t,n){A.typeOf.object("array",e),t=y(t,0);let i=e[t++],o=new Array(i);for(let p=0;p<i;++p,t+=h.packedLength)o[p]=h.unpack(e,t);let r=ie.unpack(e,t,Jce);t+=ie.packedLength;let s=e[t++],a=e[t++],l=e[t++],u=e[t++],f=e[t++],d=e[t];return c(n)?(n._positions=o,n._ellipsoid=ie.clone(r,n._ellipsoid),n._width=s,n._height=a,n._extrudedHeight=l,n._cornerType=u,n._granularity=f,n._offsetAttribute=d===-1?void 0:d,n):(bg.positions=o,bg.width=s,bg.height=a,bg.extrudedHeight=l,bg.cornerType=u,bg.granularity=f,bg.offsetAttribute=d===-1?void 0:d,new lv(bg))};lv.createGeometry=function(e){let t=e._positions,n=e._width,i=e._ellipsoid;t=Mqe(t,i);let o=Ao(t,h.equalsEpsilon);if(o.length<2||n<=0)return;let r=e._height,s=e._extrudedHeight,a=!R.equalsEpsilon(r,s,0,R.EPSILON2),l={ellipsoid:i,positions:o,width:n,cornerType:e._cornerType,granularity:e._granularity,saveAttributes:!1},u;if(a)l.height=r,l.extrudedHeight=s,l.offsetAttribute=e._offsetAttribute,u=Lqe(l);else{let p=Wi.computePositions(l);if(u=Zce(p,l.cornerType),u.attributes.position.values=ai.scaleToGeodeticHeight(u.attributes.position.values,r,i),c(e._offsetAttribute)){let g=u.attributes.position.values.length,m=e._offsetAttribute===Jt.NONE?0:1,b=new Uint8Array(g/3).fill(m);u.attributes.applyOffset=new we({componentDatatype:$.UNSIGNED_BYTE,componentsPerAttribute:1,values:b})}}let f=u.attributes,d=ce.fromVertices(f.position.values,void 0,3);return new ut({attributes:f,indices:u.indices,primitiveType:Me.LINES,boundingSphere:d,offsetAttribute:e._offsetAttribute})};var _5=lv;var Nqe=new Kn(0);function vc(e){oi.call(this,e),this._zIndex=0,this._terrainOffsetProperty=void 0}c(Object.create)&&(vc.prototype=Object.create(oi.prototype),vc.prototype.constructor=vc);Object.defineProperties(vc.prototype,{zIndex:{get:function(){return this._zIndex}},terrainOffsetProperty:{get:function(){return this._terrainOffsetProperty}}});vc.prototype._isOnTerrain=function(e,t){return this._fillEnabled&&!c(t.height)&&!c(t.extrudedHeight)&&Ll.isSupported(this._scene)};vc.prototype._getIsClosed=function(e){let t=e.height,n=e.extrudedHeight;return t===0||c(n)&&n!==t};vc.prototype._computeCenter=E.throwInstantiationError;vc.prototype._onEntityPropertyChanged=function(e,t,n,i){if(oi.prototype._onEntityPropertyChanged.call(this,e,t,n,i),this._observedPropertyNames.indexOf(t)===-1)return;let o=this._entity[this._geometryPropertyName];if(!c(o))return;c(o.zIndex)&&(c(o.height)||c(o.extrudedHeight))&&_t(_t.geometryZIndex),this._zIndex=y(o.zIndex,Nqe),c(this._terrainOffsetProperty)&&(this._terrainOffsetProperty.destroy(),this._terrainOffsetProperty=void 0);let r=o.heightReference,s=o.extrudedHeightReference;if(c(r)||c(s)){let a=new Hm(this._computeCenter.bind(this),!this._dynamic);this._terrainOffsetProperty=new yS(this._scene,a,r,s)}};vc.prototype.destroy=function(){c(this._terrainOffsetProperty)&&(this._terrainOffsetProperty.destroy(),this._terrainOffsetProperty=void 0),oi.prototype.destroy.call(this)};vc.getGeometryHeight=function(e,t){if(A.defined("heightReference",t),!c(e)){t!==$e.NONE&&_t(_t.geometryHeightReference);return}return Ru(t)?0:e};vc.getGeometryExtrudedHeight=function(e,t){if(A.defined("extrudedHeightReference",t),!c(e)){t!==$e.NONE&&_t(_t.geometryExtrudedHeightReference);return}return Ru(t)?vc.CLAMP_TO_GROUND:e};vc.CLAMP_TO_GROUND="clamp";vc.computeGeometryOffsetAttribute=function(e,t,n,i){(!c(e)||!c(t))&&(t=$e.NONE),(!c(n)||!c(i))&&(i=$e.NONE);let o=0;if(t!==$e.NONE&&o++,i===$e.RELATIVE_TO_GROUND&&o++,o===2)return Jt.ALL;if(o===1)return Jt.TOP};var jn=vc;var Qce=new j,ele=h.ZERO,tle=new h,nle=new ae;function Fqe(e){this.id=e,this.vertexFormat=void 0,this.positions=void 0,this.width=void 0,this.cornerType=void 0,this.height=void 0,this.extrudedHeight=void 0,this.granularity=void 0,this.offsetAttribute=void 0}function md(e,t){jn.call(this,{entity:e,scene:t,geometryOptions:new Fqe(e),geometryPropertyName:"corridor",observedPropertyNames:["availability","corridor"]}),this._onEntityPropertyChanged(e,"corridor",e.corridor,void 0)}c(Object.create)&&(md.prototype=Object.create(jn.prototype),md.prototype.constructor=md);md.prototype.createFillGeometryInstance=function(e){if(A.defined("time",e),!this._fillEnabled)throw new E("This instance does not represent a filled geometry.");let t=this._entity,n=t.isAvailable(e),i={show:new Cn(n&&t.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),distanceDisplayCondition:kn.fromDistanceDisplayCondition(this._distanceDisplayConditionProperty.getValue(e)),offset:void 0,color:void 0};if(this._materialProperty instanceof Ht){let o;c(this._materialProperty.color)&&(this._materialProperty.color.isConstant||n)&&(o=this._materialProperty.color.getValue(e,Qce)),c(o)||(o=j.WHITE),i.color=Wt.fromColor(o)}return c(this._options.offsetAttribute)&&(i.offset=Qi.fromCartesian3(X.getValueOrDefault(this._terrainOffsetProperty,e,ele,tle))),new vt({id:t,geometry:new cv(this._options),attributes:i})};md.prototype.createOutlineGeometryInstance=function(e){if(A.defined("time",e),!this._outlineEnabled)throw new E("This instance does not represent an outlined geometry.");let t=this._entity,n=t.isAvailable(e),i=X.getValueOrDefault(this._outlineColorProperty,e,j.BLACK,Qce),o={show:new Cn(n&&t.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:Wt.fromColor(i),distanceDisplayCondition:kn.fromDistanceDisplayCondition(this._distanceDisplayConditionProperty.getValue(e)),offset:void 0};return c(this._options.offsetAttribute)&&(o.offset=Qi.fromCartesian3(X.getValueOrDefault(this._terrainOffsetProperty,e,ele,tle))),new vt({id:t,geometry:new _5(this._options),attributes:o})};md.prototype._computeCenter=function(e,t){let n=X.getValueOrUndefined(this._entity.corridor.positions,e);if(!(!c(n)||n.length===0))return h.clone(n[Math.floor(n.length/2)],t)};md.prototype._isHidden=function(e,t){return!c(t.positions)||!c(t.width)||oi.prototype._isHidden.call(this,e,t)};md.prototype._isDynamic=function(e,t){return!t.positions.isConstant||!X.isConstant(t.height)||!X.isConstant(t.extrudedHeight)||!X.isConstant(t.granularity)||!X.isConstant(t.width)||!X.isConstant(t.outlineWidth)||!X.isConstant(t.cornerType)||!X.isConstant(t.zIndex)||this._onTerrain&&!X.isConstant(this._materialProperty)&&!(this._materialProperty instanceof Ht)};md.prototype._setStaticOptions=function(e,t){let n=X.getValueOrUndefined(t.height,je.MINIMUM_VALUE),i=X.getValueOrDefault(t.heightReference,je.MINIMUM_VALUE,$e.NONE),o=X.getValueOrUndefined(t.extrudedHeight,je.MINIMUM_VALUE),r=X.getValueOrDefault(t.extrudedHeightReference,je.MINIMUM_VALUE,$e.NONE);c(o)&&!c(n)&&(n=0);let s=this._options;s.vertexFormat=this._materialProperty instanceof Ht?ln.VERTEX_FORMAT:uo.MaterialSupport.TEXTURED.vertexFormat,s.positions=t.positions.getValue(je.MINIMUM_VALUE,s.positions),s.width=t.width.getValue(je.MINIMUM_VALUE),s.granularity=X.getValueOrUndefined(t.granularity,je.MINIMUM_VALUE),s.cornerType=X.getValueOrUndefined(t.cornerType,je.MINIMUM_VALUE),s.offsetAttribute=jn.computeGeometryOffsetAttribute(n,i,o,r),s.height=jn.getGeometryHeight(n,i),o=jn.getGeometryExtrudedHeight(o,r),o===jn.CLAMP_TO_GROUND&&(o=di.getMinimumMaximumHeights(cv.computeRectangle(s,nle)).minimumTerrainHeight),s.extrudedHeight=o};md.DynamicGeometryUpdater=sA;function sA(e,t,n){ii.call(this,e,t,n)}c(Object.create)&&(sA.prototype=Object.create(ii.prototype),sA.prototype.constructor=sA);sA.prototype._isHidden=function(e,t,n){let i=this._options;return!c(i.positions)||!c(i.width)||ii.prototype._isHidden.call(this,e,t,n)};sA.prototype._setOptions=function(e,t,n){let i=this._options,o=X.getValueOrUndefined(t.height,n),r=X.getValueOrDefault(t.heightReference,n,$e.NONE),s=X.getValueOrUndefined(t.extrudedHeight,n),a=X.getValueOrDefault(t.extrudedHeightReference,n,$e.NONE);c(s)&&!c(o)&&(o=0),i.positions=X.getValueOrUndefined(t.positions,n),i.width=X.getValueOrUndefined(t.width,n),i.granularity=X.getValueOrUndefined(t.granularity,n),i.cornerType=X.getValueOrUndefined(t.cornerType,n),i.offsetAttribute=jn.computeGeometryOffsetAttribute(o,r,s,a),i.height=jn.getGeometryHeight(o,r),s=jn.getGeometryExtrudedHeight(s,a),s===jn.CLAMP_TO_GROUND&&(s=di.getMinimumMaximumHeights(cv.computeRectangle(i,nle)).minimumTerrainHeight),i.extrudedHeight=s};var g5=md;function Z1(){E.throwInstantiationError()}Object.defineProperties(Z1.prototype,{name:{get:E.throwInstantiationError},clock:{get:E.throwInstantiationError},entities:{get:E.throwInstantiationError},isLoading:{get:E.throwInstantiationError},changedEvent:{get:E.throwInstantiationError},errorEvent:{get:E.throwInstantiationError},loadingEvent:{get:E.throwInstantiationError},show:{get:E.throwInstantiationError},clustering:{get:E.throwInstantiationError}});Z1.prototype.update=function(e){E.throwInstantiationError()};Z1.setLoading=function(e,t){e._isLoading!==t&&(t?e._entityCollection.suspendEvents():e._entityCollection.resumeEvents(),e._isLoading=t,e._loading.raiseEvent(e,t))};var ns=Z1;function Ih(e,t){A.typeOf.object("ellipsoid",e),this._ellipsoid=e,this._cameraPosition=new h,this._cameraPositionInScaledSpace=new h,this._distanceToLimbInScaledSpaceSquared=0,c(t)&&(this.cameraPosition=t)}Object.defineProperties(Ih.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},cameraPosition:{get:function(){return this._cameraPosition},set:function(e){let n=this._ellipsoid.transformPositionToScaledSpace(e,this._cameraPositionInScaledSpace),i=h.magnitudeSquared(n)-1;h.clone(e,this._cameraPosition),this._cameraPositionInScaledSpace=n,this._distanceToLimbInScaledSpaceSquared=i}}});var ile=new h;Ih.prototype.isPointVisible=function(e){let n=this._ellipsoid.transformPositionToScaledSpace(e,ile);return b5(n,this._cameraPositionInScaledSpace,this._distanceToLimbInScaledSpaceSquared)};Ih.prototype.isScaledSpacePointVisible=function(e){return b5(e,this._cameraPositionInScaledSpace,this._distanceToLimbInScaledSpaceSquared)};var Bqe=new h;Ih.prototype.isScaledSpacePointVisiblePossiblyUnderEllipsoid=function(e,t){let n=this._ellipsoid,i,o;return c(t)&&t<0&&n.minimumRadius>-t?(o=Bqe,o.x=this._cameraPosition.x/(n.radii.x+t),o.y=this._cameraPosition.y/(n.radii.y+t),o.z=this._cameraPosition.z/(n.radii.z+t),i=o.x*o.x+o.y*o.y+o.z*o.z-1):(o=this._cameraPositionInScaledSpace,i=this._distanceToLimbInScaledSpaceSquared),b5(e,o,i)};Ih.prototype.computeHorizonCullingPoint=function(e,t,n){return sle(this._ellipsoid,e,t,n)};var ole=ie.clone(ie.UNIT_SPHERE);Ih.prototype.computeHorizonCullingPointPossiblyUnderEllipsoid=function(e,t,n,i){let o=rle(this._ellipsoid,n,ole);return sle(o,e,t,i)};Ih.prototype.computeHorizonCullingPointFromVertices=function(e,t,n,i,o){return ale(this._ellipsoid,e,t,n,i,o)};Ih.prototype.computeHorizonCullingPointFromVerticesPossiblyUnderEllipsoid=function(e,t,n,i,o,r){let s=rle(this._ellipsoid,o,ole);return ale(s,e,t,n,i,r)};var kqe=[];Ih.prototype.computeHorizonCullingPointFromRectangle=function(e,t,n){A.typeOf.object("rectangle",e);let i=ae.subsample(e,t,0,kqe),o=ce.fromPoints(i);if(!(h.magnitude(o.center)<.1*t.minimumRadius))return this.computeHorizonCullingPoint(o.center,i,n)};var Vqe=new h;function rle(e,t,n){if(c(t)&&t<0&&e.minimumRadius>-t){let i=h.fromElements(e.radii.x+t,e.radii.y+t,e.radii.z+t,Vqe);e=ie.fromCartesian3(i,n)}return e}function sle(e,t,n,i){A.typeOf.object("directionToPoint",t),A.defined("positions",n),c(i)||(i=new h);let o=ule(e,t),r=0;for(let s=0,a=n.length;s<a;++s){let l=n[s],u=cle(e,l,o);if(u<0)return;r=Math.max(r,u)}return lle(o,r,i)}var J1=new h;function ale(e,t,n,i,o,r){A.typeOf.object("directionToPoint",t),A.defined("vertices",n),A.typeOf.number("stride",i),c(r)||(r=new h),i=y(i,3),o=y(o,h.ZERO);let s=ule(e,t),a=0;for(let l=0,u=n.length;l<u;l+=i){J1.x=n[l]+o.x,J1.y=n[l+1]+o.y,J1.z=n[l+2]+o.z;let f=cle(e,J1,s);if(f<0)return;a=Math.max(a,f)}return lle(s,a,r)}function b5(e,t,n){let i=t,o=n,r=h.subtract(e,i,ile),s=-h.dot(r,i);return!(o<0?s>0:s>o&&s*s/h.magnitudeSquared(r)>o)}var Uqe=new h,zqe=new h;function cle(e,t,n){let i=e.transformPositionToScaledSpace(t,Uqe),o=h.magnitudeSquared(i),r=Math.sqrt(o),s=h.divideByScalar(i,r,zqe);o=Math.max(1,o),r=Math.max(1,r);let a=h.dot(s,n),l=h.magnitude(h.cross(s,n,s)),u=1/r,f=Math.sqrt(o-1)*u;return 1/(a*u-l*f)}function lle(e,t,n){if(!(t<=0||t===1/0||t!==t))return h.multiplyByScalar(e,t,n)}var y5=new h;function ule(e,t){return h.equals(t,h.ZERO)?t:(e.transformPositionToScaledSpace(t,y5),h.normalize(y5,y5))}var Z0=Ih;function br(e,t){if(e=y(e,y.EMPTY_OBJECT),c(e.disableDepthTestDistance)&&e.disableDepthTestDistance<0)throw new E("disableDepthTestDistance must be greater than or equal to 0.0.");let n=e.translucencyByDistance,i=e.scaleByDistance,o=e.distanceDisplayCondition;if(c(n)){if(n.far<=n.near)throw new E("translucencyByDistance.far must be greater than translucencyByDistance.near.");n=Vt.clone(n)}if(c(i)){if(i.far<=i.near)throw new E("scaleByDistance.far must be greater than scaleByDistance.near.");i=Vt.clone(i)}if(c(o)){if(o.far<=o.near)throw new E("distanceDisplayCondition.far must be greater than distanceDisplayCondition.near.");o=Bt.clone(o)}this._show=y(e.show,!0),this._position=h.clone(y(e.position,h.ZERO)),this._actualPosition=h.clone(this._position),this._color=j.clone(y(e.color,j.WHITE)),this._outlineColor=j.clone(y(e.outlineColor,j.TRANSPARENT)),this._outlineWidth=y(e.outlineWidth,0),this._pixelSize=y(e.pixelSize,10),this._scaleByDistance=i,this._translucencyByDistance=n,this._distanceDisplayCondition=o,this._disableDepthTestDistance=y(e.disableDepthTestDistance,0),this._id=e.id,this._collection=y(e.collection,t),this._clusterShow=!0,this._pickId=void 0,this._pointPrimitiveCollection=t,this._dirty=!1,this._index=-1,this._splitDirection=y(e.splitDirection,$r.NONE)}var fle=br.SHOW_INDEX=0,mle=br.POSITION_INDEX=1,Hqe=br.COLOR_INDEX=2,Gqe=br.OUTLINE_COLOR_INDEX=3,jqe=br.OUTLINE_WIDTH_INDEX=4,Wqe=br.PIXEL_SIZE_INDEX=5,qqe=br.SCALE_BY_DISTANCE_INDEX=6,Yqe=br.TRANSLUCENCY_BY_DISTANCE_INDEX=7,Xqe=br.DISTANCE_DISPLAY_CONDITION_INDEX=8,Kqe=br.DISABLE_DEPTH_DISTANCE_INDEX=9,$qe=br.SPLIT_DIRECTION_INDEX=10;br.NUMBER_OF_PROPERTIES=11;function ql(e,t){let n=e._pointPrimitiveCollection;c(n)&&(n._updatePointPrimitive(e,t),e._dirty=!0)}Object.defineProperties(br.prototype,{show:{get:function(){return this._show},set:function(e){if(!c(e))throw new E("value is required.");this._show!==e&&(this._show=e,ql(this,fle))}},position:{get:function(){return this._position},set:function(e){if(!c(e))throw new E("value is required.");let t=this._position;h.equals(t,e)||(h.clone(e,t),h.clone(e,this._actualPosition),ql(this,mle))}},scaleByDistance:{get:function(){return this._scaleByDistance},set:function(e){if(c(e)&&e.far<=e.near)throw new E("far distance must be greater than near distance.");let t=this._scaleByDistance;Vt.equals(t,e)||(this._scaleByDistance=Vt.clone(e,t),ql(this,qqe))}},translucencyByDistance:{get:function(){return this._translucencyByDistance},set:function(e){if(c(e)&&e.far<=e.near)throw new E("far distance must be greater than near distance.");let t=this._translucencyByDistance;Vt.equals(t,e)||(this._translucencyByDistance=Vt.clone(e,t),ql(this,Yqe))}},pixelSize:{get:function(){return this._pixelSize},set:function(e){if(!c(e))throw new E("value is required.");this._pixelSize!==e&&(this._pixelSize=e,ql(this,Wqe))}},color:{get:function(){return this._color},set:function(e){if(!c(e))throw new E("value is required.");let t=this._color;j.equals(t,e)||(j.clone(e,t),ql(this,Hqe))}},outlineColor:{get:function(){return this._outlineColor},set:function(e){if(!c(e))throw new E("value is required.");let t=this._outlineColor;j.equals(t,e)||(j.clone(e,t),ql(this,Gqe))}},outlineWidth:{get:function(){return this._outlineWidth},set:function(e){if(!c(e))throw new E("value is required.");this._outlineWidth!==e&&(this._outlineWidth=e,ql(this,jqe))}},distanceDisplayCondition:{get:function(){return this._distanceDisplayCondition},set:function(e){if(c(e)&&e.far<=e.near)throw new E("far must be greater than near");Bt.equals(this._distanceDisplayCondition,e)||(this._distanceDisplayCondition=Bt.clone(e,this._distanceDisplayCondition),ql(this,Xqe))}},disableDepthTestDistance:{get:function(){return this._disableDepthTestDistance},set:function(e){if(this._disableDepthTestDistance!==e){if(!c(e)||e<0)throw new E("disableDepthTestDistance must be greater than or equal to 0.0.");this._disableDepthTestDistance=e,ql(this,Kqe)}}},id:{get:function(){return this._id},set:function(e){this._id=e,c(this._pickId)&&(this._pickId.object.id=e)}},pickId:{get:function(){return this._pickId}},clusterShow:{get:function(){return this._clusterShow},set:function(e){this._clusterShow!==e&&(this._clusterShow=e,ql(this,fle))}},splitDirection:{get:function(){return this._splitDirection},set:function(e){this._splitDirection!==e&&(this._splitDirection=e,ql(this,$qe))}}});br.prototype.getPickId=function(e){return c(this._pickId)||(this._pickId=e.createPickId({primitive:this,collection:this._collection,id:this._id})),this._pickId};br.prototype._getActualPosition=function(){return this._actualPosition};br.prototype._setActualPosition=function(e){h.clone(e,this._actualPosition),ql(this,mle)};var dle=new se;br._computeActualPosition=function(e,t,n){return t.mode===oe.SCENE3D?e:(k.multiplyByPoint(n,e,dle),Ni.computeActualEllipsoidPosition(t,dle))};var hle=new se;br._computeScreenSpacePosition=function(e,t,n,i){let o=k.multiplyByVector(e,se.fromElements(t.x,t.y,t.z,1,hle),hle);return Ni.worldToWindowCoordinates(n,o,i)};br.prototype.computeScreenSpacePosition=function(e,t){let n=this._pointPrimitiveCollection;if(c(t)||(t=new H),!c(n))throw new E("PointPrimitive must be in a collection.");if(!c(e))throw new E("scene is required.");let i=n.modelMatrix,o=br._computeScreenSpacePosition(i,this._actualPosition,e,t);if(c(o))return o.y=e.canvas.clientHeight-o.y,o};br.getScreenSpaceBoundingBox=function(e,t,n){let i=e.pixelSize,o=i*.5,r=t.x-o,s=t.y-o,a=i,l=i;return c(n)||(n=new Ke),n.x=r,n.y=s,n.width=a,n.height=l,n};br.prototype.equals=function(e){return this===e||c(e)&&this._id===e._id&&h.equals(this._position,e._position)&&j.equals(this._color,e._color)&&this._pixelSize===e._pixelSize&&this._outlineWidth===e._outlineWidth&&this._show===e._show&&j.equals(this._outlineColor,e._outlineColor)&&Vt.equals(this._scaleByDistance,e._scaleByDistance)&&Vt.equals(this._translucencyByDistance,e._translucencyByDistance)&&Bt.equals(this._distanceDisplayCondition,e._distanceDisplayCondition)&&this._disableDepthTestDistance===e._disableDepthTestDistance&&this._splitDirection===e._splitDirection};br.prototype._destroy=function(){this._pickId=this._pickId&&this._pickId.destroy(),this._pointPrimitiveCollection=void 0};var ea=br;var aA=`in vec4 v_color;
in vec4 v_outlineColor;
in float v_innerPercent;
in float v_pixelDistance;
in vec4 v_pickColor;
in float v_splitDirection;
void main()
{
if (v_splitDirection < 0.0 && gl_FragCoord.x > czm_splitPosition) discard;
if (v_splitDirection > 0.0 && gl_FragCoord.x < czm_splitPosition) discard;
float distanceToCenter = length(gl_PointCoord - vec2(0.5));
float maxDistance = max(0.0, 0.5 - v_pixelDistance);
float wholeAlpha = 1.0 - smoothstep(maxDistance, 0.5, distanceToCenter);
float innerAlpha = 1.0 - smoothstep(maxDistance * v_innerPercent, 0.5 * v_innerPercent, distanceToCenter);
vec4 color = mix(v_outlineColor, v_color, innerAlpha);
color.a *= wholeAlpha;
#if !defined(OPAQUE) && !defined(TRANSLUCENT)
if (color.a < 0.005)
{
discard;
}
#else
#ifdef OPAQUE
if (color.a < 0.995)
{
discard;
}
#else
if (color.a >= 0.995)
{
discard;
}
#endif
#endif
out_FragColor = czm_gammaCorrect(color);
czm_writeLogDepth();
}
`;var x5=`uniform float u_maxTotalPointSize;
in vec4 positionHighAndSize;
in vec4 positionLowAndOutline;
in vec4 compressedAttribute0;
in vec4 compressedAttribute1;
in vec4 scaleByDistance;
in vec4 distanceDisplayConditionAndDisableDepthAndSplitDirection;
out vec4 v_color;
out vec4 v_outlineColor;
out float v_innerPercent;
out float v_pixelDistance;
out vec4 v_pickColor;
out float v_splitDirection;
const float SHIFT_LEFT8 = 256.0;
const float SHIFT_RIGHT8 = 1.0 / 256.0;
void main()
{
vec3 positionHigh = positionHighAndSize.xyz;
vec3 positionLow = positionLowAndOutline.xyz;
float outlineWidthBothSides = 2.0 * positionLowAndOutline.w;
float totalSize = positionHighAndSize.w + outlineWidthBothSides;
float outlinePercent = outlineWidthBothSides / totalSize;
totalSize *= czm_pixelRatio;
float temp = compressedAttribute1.x * SHIFT_RIGHT8;
float show = floor(temp);
#ifdef EYE_DISTANCE_TRANSLUCENCY
vec4 translucencyByDistance;
translucencyByDistance.x = compressedAttribute1.z;
translucencyByDistance.z = compressedAttribute1.w;
translucencyByDistance.y = ((temp - floor(temp)) * SHIFT_LEFT8) / 255.0;
temp = compressedAttribute1.y * SHIFT_RIGHT8;
translucencyByDistance.w = ((temp - floor(temp)) * SHIFT_LEFT8) / 255.0;
#endif
vec4 color;
vec4 outlineColor;
vec4 pickColor;
temp = compressedAttribute0.z * SHIFT_RIGHT8;
pickColor.b = (temp - floor(temp)) * SHIFT_LEFT8;
temp = floor(temp) * SHIFT_RIGHT8;
pickColor.g = (temp - floor(temp)) * SHIFT_LEFT8;
pickColor.r = floor(temp);
temp = compressedAttribute0.x * SHIFT_RIGHT8;
color.b = (temp - floor(temp)) * SHIFT_LEFT8;
temp = floor(temp) * SHIFT_RIGHT8;
color.g = (temp - floor(temp)) * SHIFT_LEFT8;
color.r = floor(temp);
temp = compressedAttribute0.y * SHIFT_RIGHT8;
outlineColor.b = (temp - floor(temp)) * SHIFT_LEFT8;
temp = floor(temp) * SHIFT_RIGHT8;
outlineColor.g = (temp - floor(temp)) * SHIFT_LEFT8;
outlineColor.r = floor(temp);
temp = compressedAttribute0.w * SHIFT_RIGHT8;
pickColor.a = (temp - floor(temp)) * SHIFT_LEFT8;
pickColor = pickColor / 255.0;
temp = floor(temp) * SHIFT_RIGHT8;
outlineColor.a = (temp - floor(temp)) * SHIFT_LEFT8;
outlineColor /= 255.0;
color.a = floor(temp);
color /= 255.0;
vec4 p = czm_translateRelativeToEye(positionHigh, positionLow);
vec4 positionEC = czm_modelViewRelativeToEye * p;
#if defined(EYE_DISTANCE_SCALING) || defined(EYE_DISTANCE_TRANSLUCENCY) || defined(DISTANCE_DISPLAY_CONDITION) || defined(DISABLE_DEPTH_DISTANCE)
float lengthSq;
if (czm_sceneMode == czm_sceneMode2D)
{
lengthSq = czm_eyeHeight2D.y;
}
else
{
lengthSq = dot(positionEC.xyz, positionEC.xyz);
}
#endif
#ifdef EYE_DISTANCE_SCALING
totalSize *= czm_nearFarScalar(scaleByDistance, lengthSq);
#endif
if (totalSize > 0.0) {
totalSize += 3.0;
}
totalSize = min(totalSize, u_maxTotalPointSize);
if (totalSize < 1.0)
{
positionEC.xyz = vec3(0.0);
totalSize = 1.0;
}
float translucency = 1.0;
#ifdef EYE_DISTANCE_TRANSLUCENCY
translucency = czm_nearFarScalar(translucencyByDistance, lengthSq);
if (translucency < 0.004)
{
positionEC.xyz = vec3(0.0);
}
#endif
#ifdef DISTANCE_DISPLAY_CONDITION
float nearSq = distanceDisplayConditionAndDisableDepthAndSplitDirection.x;
float farSq = distanceDisplayConditionAndDisableDepthAndSplitDirection.y;
if (lengthSq < nearSq || lengthSq > farSq) {
positionEC.xyz = vec3(0.0, 0.0, 1.0);
}
#endif
gl_Position = czm_projection * positionEC;
czm_vertexLogDepth();
#ifdef DISABLE_DEPTH_DISTANCE
float disableDepthTestDistance = distanceDisplayConditionAndDisableDepthAndSplitDirection.z;
if (disableDepthTestDistance == 0.0 && czm_minimumDisableDepthTestDistance != 0.0)
{
disableDepthTestDistance = czm_minimumDisableDepthTestDistance;
}
if (disableDepthTestDistance != 0.0)
{
float zclip = gl_Position.z / gl_Position.w;
bool clipped = (zclip < -1.0 || zclip > 1.0);
if (!clipped && (disableDepthTestDistance < 0.0 || (lengthSq > 0.0 && lengthSq < disableDepthTestDistance)))
{
gl_Position.z = -gl_Position.w;
#ifdef LOG_DEPTH
czm_vertexLogDepth(vec4(czm_currentFrustum.x));
#endif
}
}
#endif
v_color = color;
v_color.a *= translucency * show;
v_outlineColor = outlineColor;
v_outlineColor.a *= translucency * show;
v_innerPercent = 1.0 - outlinePercent;
v_pixelDistance = 2.0 / totalSize;
gl_PointSize = totalSize * show;
gl_Position *= show;
v_pickColor = pickColor;
v_splitDirection = distanceDisplayConditionAndDisableDepthAndSplitDirection.w;
}
`;var Zqe=ea.SHOW_INDEX,C5=ea.POSITION_INDEX,ple=ea.COLOR_INDEX,Jqe=ea.OUTLINE_COLOR_INDEX,Qqe=ea.OUTLINE_WIDTH_INDEX,e7e=ea.PIXEL_SIZE_INDEX,_le=ea.SCALE_BY_DISTANCE_INDEX,gle=ea.TRANSLUCENCY_BY_DISTANCE_INDEX,yle=ea.DISTANCE_DISPLAY_CONDITION_INDEX,t7e=ea.DISABLE_DEPTH_DISTANCE_INDEX,n7e=ea.SPLIT_DIRECTION_INDEX,E5=ea.NUMBER_OF_PROPERTIES,$a={positionHighAndSize:0,positionLowAndOutline:1,compressedAttribute0:2,compressedAttribute1:3,scaleByDistance:4,distanceDisplayConditionAndDisableDepthAndSplitDirection:5};function df(e){e=y(e,y.EMPTY_OBJECT),this._sp=void 0,this._spTranslucent=void 0,this._rsOpaque=void 0,this._rsTranslucent=void 0,this._vaf=void 0,this._pointPrimitives=[],this._pointPrimitivesToUpdate=[],this._pointPrimitivesToUpdateIndex=0,this._pointPrimitivesRemoved=!1,this._createVertexArray=!1,this._shaderScaleByDistance=!1,this._compiledShaderScaleByDistance=!1,this._shaderTranslucencyByDistance=!1,this._compiledShaderTranslucencyByDistance=!1,this._shaderDistanceDisplayCondition=!1,this._compiledShaderDistanceDisplayCondition=!1,this._shaderDisableDepthDistance=!1,this._compiledShaderDisableDepthDistance=!1,this._propertiesChanged=new Uint32Array(E5),this._maxPixelSize=1,this._baseVolume=new ce,this._baseVolumeWC=new ce,this._baseVolume2D=new ce,this._boundingVolume=new ce,this._boundingVolumeDirty=!1,this._colorCommands=[],this.show=y(e.show,!0),this.modelMatrix=k.clone(y(e.modelMatrix,k.IDENTITY)),this._modelMatrix=k.clone(k.IDENTITY),this.debugShowBoundingVolume=y(e.debugShowBoundingVolume,!1),this.blendOption=y(e.blendOption,Oo.OPAQUE_AND_TRANSLUCENT),this._blendOption=void 0,this._mode=oe.SCENE3D,this._maxTotalPointSize=1,this._buffersUsage=[ke.STATIC_DRAW,ke.STATIC_DRAW,ke.STATIC_DRAW,ke.STATIC_DRAW,ke.STATIC_DRAW,ke.STATIC_DRAW,ke.STATIC_DRAW,ke.STATIC_DRAW,ke.STATIC_DRAW];let t=this;this._uniforms={u_maxTotalPointSize:function(){return t._maxTotalPointSize}}}Object.defineProperties(df.prototype,{length:{get:function(){return S5(this),this._pointPrimitives.length}}});function ble(e){let t=e.length;for(let n=0;n<t;++n)e[n]&&e[n]._destroy()}df.prototype.add=function(e){let t=new ea(e,this);return t._index=this._pointPrimitives.length,this._pointPrimitives.push(t),this._createVertexArray=!0,t};df.prototype.remove=function(e){return this.contains(e)?(this._pointPrimitives[e._index]=null,this._pointPrimitivesRemoved=!0,this._createVertexArray=!0,e._destroy(),!0):!1};df.prototype.removeAll=function(){ble(this._pointPrimitives),this._pointPrimitives=[],this._pointPrimitivesToUpdate=[],this._pointPrimitivesToUpdateIndex=0,this._pointPrimitivesRemoved=!1,this._createVertexArray=!0};function S5(e){if(e._pointPrimitivesRemoved){e._pointPrimitivesRemoved=!1;let t=[],n=e._pointPrimitives,i=n.length;for(let o=0,r=0;o<i;++o){let s=n[o];s&&(s._index=r++,t.push(s))}e._pointPrimitives=t}}df.prototype._updatePointPrimitive=function(e,t){e._dirty||(this._pointPrimitivesToUpdate[this._pointPrimitivesToUpdateIndex++]=e),++this._propertiesChanged[t]};df.prototype.contains=function(e){return c(e)&&e._pointPrimitiveCollection===this};df.prototype.get=function(e){if(!c(e))throw new E("index is required.");return S5(this),this._pointPrimitives[e]};df.prototype.computeNewBuffersUsage=function(){let e=this._buffersUsage,t=!1,n=this._propertiesChanged;for(let i=0;i<E5;++i){let o=n[i]===0?ke.STATIC_DRAW:ke.STREAM_DRAW;t=t||e[i]!==o,e[i]=o}return t};function i7e(e,t,n){return new L0(e,[{index:$a.positionHighAndSize,componentsPerAttribute:4,componentDatatype:$.FLOAT,usage:n[C5]},{index:$a.positionLowAndShow,componentsPerAttribute:4,componentDatatype:$.FLOAT,usage:n[C5]},{index:$a.compressedAttribute0,componentsPerAttribute:4,componentDatatype:$.FLOAT,usage:n[ple]},{index:$a.compressedAttribute1,componentsPerAttribute:4,componentDatatype:$.FLOAT,usage:n[gle]},{index:$a.scaleByDistance,componentsPerAttribute:4,componentDatatype:$.FLOAT,usage:n[_le]},{index:$a.distanceDisplayConditionAndDisableDepthAndSplitDirection,componentsPerAttribute:4,componentDatatype:$.FLOAT,usage:n[yle]}],t)}var T5=new Gn;function xle(e,t,n,i){let o=i._index,r=i._getActualPosition();e._mode===oe.SCENE3D&&(ce.expand(e._baseVolume,r,e._baseVolume),e._boundingVolumeDirty=!0),Gn.fromCartesian(r,T5);let s=i.pixelSize,a=i.outlineWidth;e._maxPixelSize=Math.max(e._maxPixelSize,s+a);let l=n[$a.positionHighAndSize],u=T5.high;l(o,u.x,u.y,u.z,s);let f=n[$a.positionLowAndOutline],d=T5.low;f(o,d.x,d.y,d.z,a)}var Q1=65536,uv=256;function Tle(e,t,n,i){let o=i._index,r=i.color,s=i.getPickId(t).color,a=i.outlineColor,l=j.floatToByte(r.red),u=j.floatToByte(r.green),f=j.floatToByte(r.blue),d=l*Q1+u*uv+f;l=j.floatToByte(a.red),u=j.floatToByte(a.green),f=j.floatToByte(a.blue);let p=l*Q1+u*uv+f;l=j.floatToByte(s.red),u=j.floatToByte(s.green),f=j.floatToByte(s.blue);let g=l*Q1+u*uv+f,m=j.floatToByte(r.alpha)*Q1+j.floatToByte(a.alpha)*uv+j.floatToByte(s.alpha),b=n[$a.compressedAttribute0];b(o,d,p,g,m)}function Ale(e,t,n,i){let o=i._index,r=0,s=1,a=1,l=1,u=i.translucencyByDistance;c(u)&&(r=u.near,s=u.nearValue,a=u.far,l=u.farValue,(s!==1||l!==1)&&(e._shaderTranslucencyByDistance=!0));let f=i.show&&i.clusterShow;i.color.alpha===0&&i.outlineColor.alpha===0&&(f=!1),s=R.clamp(s,0,1),s=s===1?255:s*255|0;let d=(f?1:0)*uv+s;l=R.clamp(l,0,1),l=l===1?255:l*255|0;let p=l,g=n[$a.compressedAttribute1];g(o,d,p,r,a)}function Cle(e,t,n,i){let o=i._index,r=n[$a.scaleByDistance],s=0,a=1,l=1,u=1,f=i.scaleByDistance;c(f)&&(s=f.near,a=f.nearValue,l=f.far,u=f.farValue,(a!==1||u!==1)&&(e._shaderScaleByDistance=!0)),r(o,s,a,l,u)}function Ele(e,t,n,i){let o=i._index,r=n[$a.distanceDisplayConditionAndDisableDepthAndSplitDirection],s=0,a=Number.MAX_VALUE,l=i.distanceDisplayCondition;c(l)&&(s=l.near,a=l.far,s*=s,a*=a,e._shaderDistanceDisplayCondition=!0);let u=i.disableDepthTestDistance;u*=u,u>0&&(e._shaderDisableDepthDistance=!0,u===Number.POSITIVE_INFINITY&&(u=-1));let f=0,d=i.splitDirection;c(d)&&(f=d),r(o,s,a,u,f)}function o7e(e,t,n,i){xle(e,t,n,i),Tle(e,t,n,i),Ale(e,t,n,i),Cle(e,t,n,i),Ele(e,t,n,i)}function A5(e,t,n,i,o,r){let s;i.mode===oe.SCENE3D?(s=e._baseVolume,e._boundingVolumeDirty=!0):s=e._baseVolume2D;let a=[];for(let l=0;l<n;++l){let u=t[l],f=u.position,d=ea._computeActualPosition(f,i,o);c(d)&&(u._setActualPosition(d),r?a.push(d):ce.expand(s,d,s))}r&&ce.fromPoints(a,s)}function r7e(e,t){let n=t.mode,i=e._pointPrimitives,o=e._pointPrimitivesToUpdate,r=e._modelMatrix;e._createVertexArray||e._mode!==n||n!==oe.SCENE3D&&!k.equals(r,e.modelMatrix)?(e._mode=n,k.clone(e.modelMatrix,r),e._createVertexArray=!0,(n===oe.SCENE3D||n===oe.SCENE2D||n===oe.COLUMBUS_VIEW)&&A5(e,i,i.length,t,r,!0)):n===oe.MORPHING?A5(e,i,i.length,t,r,!0):(n===oe.SCENE2D||n===oe.COLUMBUS_VIEW)&&A5(e,o,e._pointPrimitivesToUpdateIndex,t,r,!1)}function s7e(e,t,n){let o=t.camera.getPixelSize(n,t.context.drawingBufferWidth,t.context.drawingBufferHeight)*e._maxPixelSize;n.radius+=o}var a7e=[];df.prototype.update=function(e){if(S5(this),!this.show)return;this._maxTotalPointSize=mt.maximumAliasedPointSize,r7e(this,e);let n=this._pointPrimitives.length,i=this._pointPrimitivesToUpdate,o=this._pointPrimitivesToUpdateIndex,r=this._propertiesChanged,s=this._createVertexArray,a,l=e.context,u=e.passes,f=u.pick;if(s||!f&&this.computeNewBuffersUsage()){this._createVertexArray=!1;for(let D=0;D<E5;++D)r[D]=0;if(this._vaf=this._vaf&&this._vaf.destroy(),n>0){this._vaf=i7e(l,n,this._buffersUsage),a=this._vaf.writers;for(let D=0;D<n;++D){let I=this._pointPrimitives[D];I._dirty=!1,o7e(this,l,a,I)}this._vaf.commit()}this._pointPrimitivesToUpdateIndex=0}else if(o>0){let D=a7e;D.length=0,(r[C5]||r[Qqe]||r[e7e])&&D.push(xle),(r[ple]||r[Jqe])&&D.push(Tle),(r[Zqe]||r[gle])&&D.push(Ale),r[_le]&&D.push(Cle),(r[yle]||r[t7e]||r[n7e])&&D.push(Ele);let I=D.length;if(a=this._vaf.writers,o/n>.1){for(let L=0;L<o;++L){let M=i[L];M._dirty=!1;for(let N=0;N<I;++N)D[N](this,l,a,M)}this._vaf.commit()}else{for(let L=0;L<o;++L){let M=i[L];M._dirty=!1;for(let N=0;N<I;++N)D[N](this,l,a,M);this._vaf.subCommit(M._index,1)}this._vaf.endSubCommits()}this._pointPrimitivesToUpdateIndex=0}if(o>n*1.5&&(i.length=n),!c(this._vaf)||!c(this._vaf.va))return;this._boundingVolumeDirty&&(this._boundingVolumeDirty=!1,ce.transform(this._baseVolume,this.modelMatrix,this._baseVolumeWC));let d,p=k.IDENTITY;e.mode===oe.SCENE3D?(p=this.modelMatrix,d=ce.clone(this._baseVolumeWC,this._boundingVolume)):d=ce.clone(this._baseVolume2D,this._boundingVolume),s7e(this,e,d);let g=this._blendOption!==this.blendOption;this._blendOption=this.blendOption,g&&(this._blendOption===Oo.OPAQUE||this._blendOption===Oo.OPAQUE_AND_TRANSLUCENT?this._rsOpaque=ze.fromCache({depthTest:{enabled:!0,func:ne.LEQUAL},depthMask:!0}):this._rsOpaque=void 0,this._blendOption===Oo.TRANSLUCENT||this._blendOption===Oo.OPAQUE_AND_TRANSLUCENT?this._rsTranslucent=ze.fromCache({depthTest:{enabled:!0,func:ne.LEQUAL},depthMask:!1,blending:hn.ALPHA_BLEND}):this._rsTranslucent=void 0),this._shaderDisableDepthDistance=this._shaderDisableDepthDistance||e.minimumDisableDepthTestDistance!==0;let m,b;(g||this._shaderScaleByDistance&&!this._compiledShaderScaleByDistance||this._shaderTranslucencyByDistance&&!this._compiledShaderTranslucencyByDistance||this._shaderDistanceDisplayCondition&&!this._compiledShaderDistanceDisplayCondition||this._shaderDisableDepthDistance!==this._compiledShaderDisableDepthDistance)&&(m=new Ge({sources:[x5]}),this._shaderScaleByDistance&&m.defines.push("EYE_DISTANCE_SCALING"),this._shaderTranslucencyByDistance&&m.defines.push("EYE_DISTANCE_TRANSLUCENCY"),this._shaderDistanceDisplayCondition&&m.defines.push("DISTANCE_DISPLAY_CONDITION"),this._shaderDisableDepthDistance&&m.defines.push("DISABLE_DEPTH_DISTANCE"),this._blendOption===Oo.OPAQUE_AND_TRANSLUCENT&&(b=new Ge({defines:["OPAQUE"],sources:[aA]}),this._sp=an.replaceCache({context:l,shaderProgram:this._sp,vertexShaderSource:m,fragmentShaderSource:b,attributeLocations:$a}),b=new Ge({defines:["TRANSLUCENT"],sources:[aA]}),this._spTranslucent=an.replaceCache({context:l,shaderProgram:this._spTranslucent,vertexShaderSource:m,fragmentShaderSource:b,attributeLocations:$a})),this._blendOption===Oo.OPAQUE&&(b=new Ge({sources:[aA]}),this._sp=an.replaceCache({context:l,shaderProgram:this._sp,vertexShaderSource:m,fragmentShaderSource:b,attributeLocations:$a})),this._blendOption===Oo.TRANSLUCENT&&(b=new Ge({sources:[aA]}),this._spTranslucent=an.replaceCache({context:l,shaderProgram:this._spTranslucent,vertexShaderSource:m,fragmentShaderSource:b,attributeLocations:$a})),this._compiledShaderScaleByDistance=this._shaderScaleByDistance,this._compiledShaderTranslucencyByDistance=this._shaderTranslucencyByDistance,this._compiledShaderDistanceDisplayCondition=this._shaderDistanceDisplayCondition,this._compiledShaderDisableDepthDistance=this._shaderDisableDepthDistance);let x,T,C,S,v=e.commandList;if(u.render||f){let D=this._colorCommands,I=this._blendOption===Oo.OPAQUE,L=this._blendOption===Oo.OPAQUE_AND_TRANSLUCENT;x=this._vaf.va,T=x.length,D.length=T;let M=L?T*2:T;for(S=0;S<M;++S){let N=I||L&&S%2===0;C=D[S],c(C)||(C=D[S]=new et),C.primitiveType=Me.POINTS,C.pass=N||!L?ve.OPAQUE:ve.TRANSLUCENT,C.owner=this;let B=L?Math.floor(S/2):S;C.boundingVolume=d,C.modelMatrix=p,C.shaderProgram=N?this._sp:this._spTranslucent,C.uniformMap=this._uniforms,C.vertexArray=x[B].va,C.renderState=N?this._rsOpaque:this._rsTranslucent,C.debugShowBoundingVolume=this.debugShowBoundingVolume,C.pickId="v_pickColor",v.push(C)}}};df.prototype.isDestroyed=function(){return!1};df.prototype.destroy=function(){return this._sp=this._sp&&this._sp.destroy(),this._spTranslucent=this._spTranslucent&&this._spTranslucent.destroy(),this._spPick=this._spPick&&this._spPick.destroy(),this._vaf=this._vaf&&this._vaf.destroy(),ble(this._pointPrimitives),de(this)};var eR=df;var Sle=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],w5=1,fv=8,hv=class e{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[n,i]=new Uint8Array(t,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");let o=i>>4;if(o!==w5)throw new Error(`Got v${o} data when expected v${w5}.`);let r=Sle[i&15];if(!r)throw new Error("Unrecognized array type.");let[s]=new Uint16Array(t,2,1),[a]=new Uint32Array(t,4,1);return new e(a,s,r,t)}constructor(t,n=64,i=Float64Array,o){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=i,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;let r=Sle.indexOf(this.ArrayType),s=t*2*this.ArrayType.BYTES_PER_ELEMENT,a=t*this.IndexArrayType.BYTES_PER_ELEMENT,l=(8-a%8)%8;if(r<0)throw new Error(`Unexpected typed array class: ${i}.`);o&&o instanceof ArrayBuffer?(this.data=o,this.ids=new this.IndexArrayType(this.data,fv,t),this.coords=new this.ArrayType(this.data,fv+a+l,t*2),this._pos=t*2,this._finished=!0):(this.data=new ArrayBuffer(fv+s+a+l),this.ids=new this.IndexArrayType(this.data,fv,t),this.coords=new this.ArrayType(this.data,fv+a+l,t*2),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,(w5<<4)+r]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=t)}add(t,n){let i=this._pos>>1;return this.ids[i]=i,this.coords[this._pos++]=t,this.coords[this._pos++]=n,i}finish(){let t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return D5(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,n,i,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:r,coords:s,nodeSize:a}=this,l=[0,r.length-1,0],u=[];for(;l.length;){let f=l.pop()||0,d=l.pop()||0,p=l.pop()||0;if(d-p<=a){for(let x=p;x<=d;x++){let T=s[2*x],C=s[2*x+1];T>=t&&T<=i&&C>=n&&C<=o&&u.push(r[x])}continue}let g=p+d>>1,m=s[2*g],b=s[2*g+1];m>=t&&m<=i&&b>=n&&b<=o&&u.push(r[g]),(f===0?t<=m:n<=b)&&(l.push(p),l.push(g-1),l.push(1-f)),(f===0?i>=m:o>=b)&&(l.push(g+1),l.push(d),l.push(1-f))}return u}within(t,n,i){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:o,coords:r,nodeSize:s}=this,a=[0,o.length-1,0],l=[],u=i*i;for(;a.length;){let f=a.pop()||0,d=a.pop()||0,p=a.pop()||0;if(d-p<=s){for(let x=p;x<=d;x++)wle(r[2*x],r[2*x+1],t,n)<=u&&l.push(o[x]);continue}let g=p+d>>1,m=r[2*g],b=r[2*g+1];wle(m,b,t,n)<=u&&l.push(o[g]),(f===0?t-i<=m:n-i<=b)&&(a.push(p),a.push(g-1),a.push(1-f)),(f===0?t+i>=m:n+i>=b)&&(a.push(g+1),a.push(d),a.push(1-f))}return l}};function D5(e,t,n,i,o,r){if(o-i<=n)return;let s=i+o>>1;vle(e,t,s,i,o,r),D5(e,t,n,i,s-1,1-r),D5(e,t,n,s+1,o,1-r)}function vle(e,t,n,i,o,r){for(;o>i;){if(o-i>600){let u=o-i+1,f=n-i+1,d=Math.log(u),p=.5*Math.exp(2*d/3),g=.5*Math.sqrt(d*p*(u-p)/u)*(f-u/2<0?-1:1),m=Math.max(i,Math.floor(n-f*p/u+g)),b=Math.min(o,Math.floor(n+(u-f)*p/u+g));vle(e,t,n,m,b,r)}let s=t[2*n+r],a=i,l=o;for(dv(e,t,i,n),t[2*o+r]>s&&dv(e,t,i,o);a<l;){for(dv(e,t,a,l),a++,l--;t[2*a+r]<s;)a++;for(;t[2*l+r]>s;)l--}t[2*i+r]===s?dv(e,t,i,l):(l++,dv(e,t,l,o)),l<=n&&(i=l+1),n<=l&&(o=l-1)}}function dv(e,t,n,i){v5(e,n,i),v5(t,2*n,2*i),v5(t,2*n+1,2*i+1)}function v5(e,t,n){let i=e[t];e[t]=e[n],e[n]=i}function wle(e,t,n,i){let o=e-n,r=t-i;return o*o+r*r}function pd(e){e=y(e,y.EMPTY_OBJECT),this._enabled=y(e.enabled,!1),this._pixelRange=y(e.pixelRange,80),this._minimumClusterSize=y(e.minimumClusterSize,2),this._clusterBillboards=y(e.clusterBillboards,!0),this._clusterLabels=y(e.clusterLabels,!0),this._clusterPoints=y(e.clusterPoints,!0),this._labelCollection=void 0,this._billboardCollection=void 0,this._pointCollection=void 0,this._clusterBillboardCollection=void 0,this._clusterLabelCollection=void 0,this._clusterPointCollection=void 0,this._collectionIndicesByEntity={},this._unusedLabelIndices=[],this._unusedBillboardIndices=[],this._unusedPointIndices=[],this._previousClusters=[],this._previousHeight=void 0,this._enabledDirty=!1,this._clusterDirty=!1,this._cluster=void 0,this._removeEventListener=void 0,this._clusterEvent=new pe,this.show=y(e.show,!0)}function Dle(e,t){e.x-=t,e.y-=t,e.width+=t*2,e.height+=t*2}var c7e=new Ke;function Ple(e,t,n,i,o){if(c(e._labelCollection)&&i._clusterLabels?o=zT.getScreenSpaceBoundingBox(e,t,o):c(e._billboardCollection)&&i._clusterBillboards?o=fo.getScreenSpaceBoundingBox(e,t,o):c(e._pointPrimitiveCollection)&&i._clusterPoints&&(o=ea.getScreenSpaceBoundingBox(e,t,o)),Dle(o,n),i._clusterLabels&&!c(e._labelCollection)&&c(e.id)&&Ole(i,e.id.id)&&c(e.id._label)){let r=i._collectionIndicesByEntity[e.id.id].labelIndex,s=i._labelCollection.get(r),a=zT.getScreenSpaceBoundingBox(s,t,c7e);Dle(a,n),o=Ke.union(o,a,o)}return o}function l7e(e,t){if(e.clusterShow=!0,!c(e._labelCollection)&&c(e.id)&&Ole(t,e.id.id)&&c(e.id._label)){let n=t._collectionIndicesByEntity[e.id.id].labelIndex,i=t._labelCollection.get(n);i.clusterShow=!0}}function Ile(e,t,n,i){let o={billboard:i._clusterBillboardCollection.add(),label:i._clusterLabelCollection.add(),point:i._clusterPointCollection.add()};o.billboard.show=!1,o.point.show=!1,o.label.show=!0,o.label.text=t.toLocaleString(),o.label.id=n,o.billboard.position=o.label.position=o.point.position=e,i._clusterEvent.raiseEvent(n,o)}function Ole(e,t){return c(e)&&c(e._collectionIndicesByEntity[t])&&c(e._collectionIndicesByEntity[t].labelIndex)}function P5(e,t,n,i,o){if(!c(e))return;let r=e.length;for(let s=0;s<r;++s){let a=e.get(s);if(a.clusterShow=!1,!a.show||o._scene.mode===oe.SCENE3D&&!i.isPointVisible(a.position))continue;let l=o._clusterLabels&&c(a._labelCollection),u=o._clusterBillboards&&c(a.id._billboard),f=o._clusterPoints&&c(a.id._point);if(l&&(f||u))continue;let d=a.computeScreenSpacePosition(n);c(d)&&t.push({index:s,collection:e,clustered:!1,coord:d})}}var u7e=new Ke,f7e=new Ke,d7e=new Ke;function h7e(e){return function(t){if(c(t)&&t<.05||!e.enabled)return;let n=e._scene,i=e._labelCollection,o=e._billboardCollection,r=e._pointCollection;if(!c(i)&&!c(o)&&!c(r)||!e._clusterBillboards&&!e._clusterLabels&&!e._clusterPoints)return;let s=e._clusterLabelCollection,a=e._clusterBillboardCollection,l=e._clusterPointCollection;c(s)?s.removeAll():s=e._clusterLabelCollection=new ag({scene:n}),c(a)?a.removeAll():a=e._clusterBillboardCollection=new rd({scene:n}),c(l)?l.removeAll():l=e._clusterPointCollection=new eR;let u=e._pixelRange,f=e._minimumClusterSize,d=e._previousClusters,p=[],g=e._previousHeight,m=n.camera.positionCartographic.height,b=n.ellipsoid,x=n.camera.positionWC,T=new Z0(b,x),C=[];e._clusterLabels&&P5(i,C,n,T,e),e._clusterBillboards&&P5(o,C,n,T,e),e._clusterPoints&&P5(r,C,n,T,e);let S,v,D,I,L,M,N,B,_,w,P,O;if(C.length>0){let F=new hv(C.length,64,Uint32Array);for(let V=0;V<C.length;++V)F.add(C[V].coord.x,C[V].coord.y);if(F.finish(),m<g)for(D=d.length,S=0;S<D;++S){let V=d[S];if(!T.isPointVisible(V.position))continue;let G=fo._computeScreenSpacePosition(k.IDENTITY,V.position,h.ZERO,H.ZERO,n);if(!c(G))continue;let z=1-m/g,W=V.width=V.width*z,U=V.height=V.height*z;W=Math.max(W,V.minimumWidth),U=Math.max(U,V.minimumHeight);let q=G.x-W*.5,K=G.y-U*.5,te=G.x+W,Y=G.y+U;for(L=F.range(q,K,te,Y),M=L.length,w=0,_=[],v=0;v<M;++v)N=L[v],B=C[N],B.clustered||(++w,P=B.collection,O=B.index,_.push(P.get(O).id));if(w>=f)for(Ile(V.position,w,_,e),p.push(V),v=0;v<M;++v)C[L[v]].clustered=!0}for(D=C.length,S=0;S<D;++S){let V=C[S];if(V.clustered)continue;V.clustered=!0,P=V.collection,O=V.index;let G=P.get(O);I=Ple(G,V.coord,u,e,u7e);let z=Ke.clone(I,f7e);L=F.range(I.x,I.y,I.x+I.width,I.y+I.height),M=L.length;let W=h.clone(G.position);for(w=1,_=[G.id],v=0;v<M;++v)if(N=L[v],B=C[N],!B.clustered){let U=B.collection.get(B.index),q=Ple(U,B.coord,u,e,d7e);h.add(U.position,W,W),Ke.union(z,q,z),++w,_.push(U.id)}if(w>=f){let U=h.multiplyByScalar(W,1/w,W);for(Ile(U,w,_,e),p.push({position:U,width:z.width,height:z.height,minimumWidth:I.width,minimumHeight:I.height}),v=0;v<M;++v)C[L[v]].clustered=!0}else l7e(G,e)}}s.length===0&&(s.destroy(),e._clusterLabelCollection=void 0),a.length===0&&(a.destroy(),e._clusterBillboardCollection=void 0),l.length===0&&(l.destroy(),e._clusterPointCollection=void 0),e._previousClusters=p,e._previousHeight=m}}pd.prototype._initialize=function(e){this._scene=e;let t=h7e(this);this._cluster=t,this._removeEventListener=e.camera.changed.addEventListener(t)};Object.defineProperties(pd.prototype,{enabled:{get:function(){return this._enabled},set:function(e){this._enabledDirty=e!==this._enabled,this._enabled=e}},pixelRange:{get:function(){return this._pixelRange},set:function(e){this._clusterDirty=this._clusterDirty||e!==this._pixelRange,this._pixelRange=e}},minimumClusterSize:{get:function(){return this._minimumClusterSize},set:function(e){this._clusterDirty=this._clusterDirty||e!==this._minimumClusterSize,this._minimumClusterSize=e}},clusterEvent:{get:function(){return this._clusterEvent}},clusterBillboards:{get:function(){return this._clusterBillboards},set:function(e){this._clusterDirty=this._clusterDirty||e!==this._clusterBillboards,this._clusterBillboards=e}},clusterLabels:{get:function(){return this._clusterLabels},set:function(e){this._clusterDirty=this._clusterDirty||e!==this._clusterLabels,this._clusterLabels=e}},clusterPoints:{get:function(){return this._clusterPoints},set:function(e){this._clusterDirty=this._clusterDirty||e!==this._clusterPoints,this._clusterPoints=e}}});function O5(e,t,n,i){return function(o){let r=this[e];c(this._collectionIndicesByEntity)||(this._collectionIndicesByEntity={});let s=this._collectionIndicesByEntity[o.id];if(c(s)||(s=this._collectionIndicesByEntity[o.id]={billboardIndex:void 0,labelIndex:void 0,pointIndex:void 0}),c(r)&&c(s[i]))return r.get(s[i]);c(r)||(r=this[e]=new t({scene:this._scene}));let a,l,u=this[n];u.length>0?(a=u.shift(),l=r.get(a)):(l=r.add(),a=r.length-1),s[i]=a;let f=this;return Promise.resolve().then(function(){f._clusterDirty=!0}),l}}function R5(e,t){let n=e._collectionIndicesByEntity[t];!c(n.billboardIndex)&&!c(n.labelIndex)&&!c(n.pointIndex)&&delete e._collectionIndicesByEntity[t]}pd.prototype.getLabel=O5("_labelCollection",ag,"_unusedLabelIndices","labelIndex");pd.prototype.removeLabel=function(e){let t=this._collectionIndicesByEntity&&this._collectionIndicesByEntity[e.id];if(!c(this._labelCollection)||!c(t)||!c(t.labelIndex))return;let n=t.labelIndex;t.labelIndex=void 0,R5(this,e.id);let i=this._labelCollection.get(n);i.show=!1,i.text="",i.id=void 0,this._unusedLabelIndices.push(n),this._clusterDirty=!0};pd.prototype.getBillboard=O5("_billboardCollection",rd,"_unusedBillboardIndices","billboardIndex");pd.prototype.removeBillboard=function(e){let t=this._collectionIndicesByEntity&&this._collectionIndicesByEntity[e.id];if(!c(this._billboardCollection)||!c(t)||!c(t.billboardIndex))return;let n=t.billboardIndex;t.billboardIndex=void 0,R5(this,e.id);let i=this._billboardCollection.get(n);i.id=void 0,i.show=!1,i.image=void 0,this._unusedBillboardIndices.push(n),this._clusterDirty=!0};pd.prototype.getPoint=O5("_pointCollection",eR,"_unusedPointIndices","pointIndex");pd.prototype.removePoint=function(e){let t=this._collectionIndicesByEntity&&this._collectionIndicesByEntity[e.id];if(!c(this._pointCollection)||!c(t)||!c(t.pointIndex))return;let n=t.pointIndex;t.pointIndex=void 0,R5(this,e.id);let i=this._pointCollection.get(n);i.show=!1,i.id=void 0,this._unusedPointIndices.push(n),this._clusterDirty=!0};function I5(e){if(!c(e))return;let t=e.length;for(let n=0;n<t;++n)e.get(n).clusterShow=!0}function m7e(e){e.enabled||(c(e._clusterLabelCollection)&&e._clusterLabelCollection.destroy(),c(e._clusterBillboardCollection)&&e._clusterBillboardCollection.destroy(),c(e._clusterPointCollection)&&e._clusterPointCollection.destroy(),e._clusterLabelCollection=void 0,e._clusterBillboardCollection=void 0,e._clusterPointCollection=void 0,I5(e._labelCollection),I5(e._billboardCollection),I5(e._pointCollection))}pd.prototype.update=function(e){if(!this.show)return;let t;c(this._labelCollection)&&this._labelCollection.length>0&&this._labelCollection.get(0)._glyphs.length===0&&(t=e.commandList,e.commandList=[],this._labelCollection.update(e),e.commandList=t),c(this._billboardCollection)&&this._billboardCollection.length>0&&!c(this._billboardCollection.get(0).width)&&(t=e.commandList,e.commandList=[],this._billboardCollection.update(e),e.commandList=t),this._enabledDirty&&(this._enabledDirty=!1,m7e(this),this._clusterDirty=!0),this._clusterDirty&&(this._clusterDirty=!1,this._cluster()),c(this._clusterLabelCollection)&&this._clusterLabelCollection.update(e),c(this._clusterBillboardCollection)&&this._clusterBillboardCollection.update(e),c(this._clusterPointCollection)&&this._clusterPointCollection.update(e),c(this._labelCollection)&&this._labelCollection.update(e),c(this._billboardCollection)&&this._billboardCollection.update(e),c(this._pointCollection)&&this._pointCollection.update(e)};pd.prototype.destroy=function(){this._labelCollection=this._labelCollection&&this._labelCollection.destroy(),this._billboardCollection=this._billboardCollection&&this._billboardCollection.destroy(),this._pointCollection=this._pointCollection&&this._pointCollection.destroy(),this._clusterLabelCollection=this._clusterLabelCollection&&this._clusterLabelCollection.destroy(),this._clusterBillboardCollection=this._clusterBillboardCollection&&this._clusterBillboardCollection.destroy(),this._clusterPointCollection=this._clusterPointCollection&&this._clusterPointCollection.destroy(),c(this._removeEventListener)&&(this._removeEventListener(),this._removeEventListener=void 0),this._labelCollection=void 0,this._billboardCollection=void 0,this._pointCollection=void 0,this._clusterBillboardCollection=void 0,this._clusterLabelCollection=void 0,this._clusterPointCollection=void 0,this._collectionIndicesByEntity=void 0,this._unusedLabelIndices=[],this._unusedBillboardIndices=[],this._unusedPointIndices=[],this._previousClusters=[],this._previousHeight=void 0,this._enabledDirty=!1,this._pixelRangeDirty=!1,this._minimumClusterSizeDirty=!1};var _d=pd;function M5(e){this._name=e,this._clock=void 0,this._changed=new pe,this._error=new pe,this._isLoading=!1,this._loading=new pe,this._entityCollection=new _a(this),this._entityCluster=new _d}Object.defineProperties(M5.prototype,{name:{get:function(){return this._name},set:function(e){this._name!==e&&(this._name=e,this._changed.raiseEvent(this))}},clock:{get:function(){return this._clock},set:function(e){this._clock!==e&&(this._clock=e,this._changed.raiseEvent(this))}},entities:{get:function(){return this._entityCollection}},isLoading:{get:function(){return this._isLoading},set:function(e){ns.setLoading(this,e)}},changedEvent:{get:function(){return this._changed}},errorEvent:{get:function(){return this._error}},loadingEvent:{get:function(){return this._loading}},show:{get:function(){return this._entityCollection.show},set:function(e){this._entityCollection.show=e}},clustering:{get:function(){return this._entityCluster},set:function(e){if(!c(e))throw new E("value must be defined.");this._entityCluster=e}}});M5.prototype.update=function(e){return!0};var L5=M5;var Rle={};Rle.computePositions=function(e,t,n,i,o){let r=e*.5,s=-r,a=i+i,l=o?2*a:a,u=new Float64Array(l*3),f,d=0,p=0,g=o?a*3:0,m=o?(a+i)*3:i*3;for(f=0;f<i;f++){let b=f/i*R.TWO_PI,x=Math.cos(b),T=Math.sin(b),C=x*n,S=T*n,v=x*t,D=T*t;u[p+g]=C,u[p+g+1]=S,u[p+g+2]=s,u[p+m]=v,u[p+m+1]=D,u[p+m+2]=r,p+=3,o&&(u[d++]=C,u[d++]=S,u[d++]=s,u[d++]=v,u[d++]=D,u[d++]=r)}return u};var mv=Rle;var N5=new H,p7e=new h,_7e=new h,g7e=new h,y7e=new h;function Mp(e){e=y(e,y.EMPTY_OBJECT);let t=e.length,n=e.topRadius,i=e.bottomRadius,o=y(e.vertexFormat,Ie.DEFAULT),r=y(e.slices,128);if(!c(t))throw new E("options.length must be defined.");if(!c(n))throw new E("options.topRadius must be defined.");if(!c(i))throw new E("options.bottomRadius must be defined.");if(r<3)throw new E("options.slices must be greater than or equal to 3.");if(c(e.offsetAttribute)&&e.offsetAttribute===Jt.TOP)throw new E("GeometryOffsetAttribute.TOP is not a supported options.offsetAttribute for this geometry.");this._length=t,this._topRadius=n,this._bottomRadius=i,this._vertexFormat=Ie.clone(o),this._slices=r,this._offsetAttribute=e.offsetAttribute,this._workerName="createCylinderGeometry"}Mp.packedLength=Ie.packedLength+5;Mp.pack=function(e,t,n){if(!c(e))throw new E("value is required");if(!c(t))throw new E("array is required");return n=y(n,0),Ie.pack(e._vertexFormat,t,n),n+=Ie.packedLength,t[n++]=e._length,t[n++]=e._topRadius,t[n++]=e._bottomRadius,t[n++]=e._slices,t[n]=y(e._offsetAttribute,-1),t};var Mle=new Ie,cA={vertexFormat:Mle,length:void 0,topRadius:void 0,bottomRadius:void 0,slices:void 0,offsetAttribute:void 0};Mp.unpack=function(e,t,n){if(!c(e))throw new E("array is required");t=y(t,0);let i=Ie.unpack(e,t,Mle);t+=Ie.packedLength;let o=e[t++],r=e[t++],s=e[t++],a=e[t++],l=e[t];return c(n)?(n._vertexFormat=Ie.clone(i,n._vertexFormat),n._length=o,n._topRadius=r,n._bottomRadius=s,n._slices=a,n._offsetAttribute=l===-1?void 0:l,n):(cA.length=o,cA.topRadius=r,cA.bottomRadius=s,cA.slices=a,cA.offsetAttribute=l===-1?void 0:l,new Mp(cA))};Mp.createGeometry=function(e){let t=e._length,n=e._topRadius,i=e._bottomRadius,o=e._vertexFormat,r=e._slices;if(t<=0||n<0||i<0||n===0&&i===0)return;let s=r+r,a=r+s,l=s+s,u=mv.computePositions(t,n,i,r,!0),f=o.st?new Float32Array(l*2):void 0,d=o.normal?new Float32Array(l*3):void 0,p=o.tangent?new Float32Array(l*3):void 0,g=o.bitangent?new Float32Array(l*3):void 0,m,b=o.normal||o.tangent||o.bitangent;if(b){let L=o.tangent||o.bitangent,M=0,N=0,B=0,_=Math.atan2(i-n,t),w=p7e;w.z=Math.sin(_);let P=Math.cos(_),O=g7e,F=_7e;for(m=0;m<r;m++){let V=m/r*R.TWO_PI,G=P*Math.cos(V),z=P*Math.sin(V);b&&(w.x=G,w.y=z,L&&(O=h.normalize(h.cross(h.UNIT_Z,w,O),O)),o.normal&&(d[M++]=w.x,d[M++]=w.y,d[M++]=w.z,d[M++]=w.x,d[M++]=w.y,d[M++]=w.z),o.tangent&&(p[N++]=O.x,p[N++]=O.y,p[N++]=O.z,p[N++]=O.x,p[N++]=O.y,p[N++]=O.z),o.bitangent&&(F=h.normalize(h.cross(w,O,F),F),g[B++]=F.x,g[B++]=F.y,g[B++]=F.z,g[B++]=F.x,g[B++]=F.y,g[B++]=F.z))}for(m=0;m<r;m++)o.normal&&(d[M++]=0,d[M++]=0,d[M++]=-1),o.tangent&&(p[N++]=1,p[N++]=0,p[N++]=0),o.bitangent&&(g[B++]=0,g[B++]=-1,g[B++]=0);for(m=0;m<r;m++)o.normal&&(d[M++]=0,d[M++]=0,d[M++]=1),o.tangent&&(p[N++]=1,p[N++]=0,p[N++]=0),o.bitangent&&(g[B++]=0,g[B++]=1,g[B++]=0)}let x=12*r-12,T=Fe.createTypedArray(l,x),C=0,S=0;for(m=0;m<r-1;m++)T[C++]=S,T[C++]=S+2,T[C++]=S+3,T[C++]=S,T[C++]=S+3,T[C++]=S+1,S+=2;for(T[C++]=s-2,T[C++]=0,T[C++]=1,T[C++]=s-2,T[C++]=1,T[C++]=s-1,m=1;m<r-1;m++)T[C++]=s+m+1,T[C++]=s+m,T[C++]=s;for(m=1;m<r-1;m++)T[C++]=a,T[C++]=a+m,T[C++]=a+m+1;let v=0;if(o.st){let L=Math.max(n,i);for(m=0;m<l;m++){let M=h.fromArray(u,m*3,y7e);f[v++]=(M.x+L)/(2*L),f[v++]=(M.y+L)/(2*L)}}let D=new pn;o.position&&(D.position=new we({componentDatatype:$.DOUBLE,componentsPerAttribute:3,values:u})),o.normal&&(D.normal=new we({componentDatatype:$.FLOAT,componentsPerAttribute:3,values:d})),o.tangent&&(D.tangent=new we({componentDatatype:$.FLOAT,componentsPerAttribute:3,values:p})),o.bitangent&&(D.bitangent=new we({componentDatatype:$.FLOAT,componentsPerAttribute:3,values:g})),o.st&&(D.st=new we({componentDatatype:$.FLOAT,componentsPerAttribute:2,values:f})),N5.x=t*.5,N5.y=Math.max(i,n);let I=new ce(h.ZERO,H.magnitude(N5));if(c(e._offsetAttribute)){t=u.length;let L=e._offsetAttribute===Jt.NONE?0:1,M=new Uint8Array(t/3).fill(L);D.applyOffset=new we({componentDatatype:$.UNSIGNED_BYTE,componentsPerAttribute:1,values:M})}return new ut({attributes:D,indices:T,primitiveType:Me.TRIANGLES,boundingSphere:I,offsetAttribute:e._offsetAttribute})};var F5;Mp.getUnitCylinder=function(){return c(F5)||(F5=Mp.createGeometry(new Mp({topRadius:1,bottomRadius:1,length:1,vertexFormat:Ie.POSITION_ONLY}))),F5};var B5=Mp;var k5=new H;function lA(e){e=y(e,y.EMPTY_OBJECT);let t=e.length,n=e.topRadius,i=e.bottomRadius,o=y(e.slices,128),r=Math.max(y(e.numberOfVerticalLines,16),0);if(A.typeOf.number("options.positions",t),A.typeOf.number("options.topRadius",n),A.typeOf.number("options.bottomRadius",i),A.typeOf.number.greaterThanOrEquals("options.slices",o,3),c(e.offsetAttribute)&&e.offsetAttribute===Jt.TOP)throw new E("GeometryOffsetAttribute.TOP is not a supported options.offsetAttribute for this geometry.");this._length=t,this._topRadius=n,this._bottomRadius=i,this._slices=o,this._numberOfVerticalLines=r,this._offsetAttribute=e.offsetAttribute,this._workerName="createCylinderOutlineGeometry"}lA.packedLength=6;lA.pack=function(e,t,n){return A.typeOf.object("value",e),A.defined("array",t),n=y(n,0),t[n++]=e._length,t[n++]=e._topRadius,t[n++]=e._bottomRadius,t[n++]=e._slices,t[n++]=e._numberOfVerticalLines,t[n]=y(e._offsetAttribute,-1),t};var J0={length:void 0,topRadius:void 0,bottomRadius:void 0,slices:void 0,numberOfVerticalLines:void 0,offsetAttribute:void 0};lA.unpack=function(e,t,n){A.defined("array",e),t=y(t,0);let i=e[t++],o=e[t++],r=e[t++],s=e[t++],a=e[t++],l=e[t];return c(n)?(n._length=i,n._topRadius=o,n._bottomRadius=r,n._slices=s,n._numberOfVerticalLines=a,n._offsetAttribute=l===-1?void 0:l,n):(J0.length=i,J0.topRadius=o,J0.bottomRadius=r,J0.slices=s,J0.numberOfVerticalLines=a,J0.offsetAttribute=l===-1?void 0:l,new lA(J0))};lA.createGeometry=function(e){let t=e._length,n=e._topRadius,i=e._bottomRadius,o=e._slices,r=e._numberOfVerticalLines;if(t<=0||n<0||i<0||n===0&&i===0)return;let s=o*2,a=mv.computePositions(t,n,i,o,!1),l=o*2,u;if(r>0){let b=Math.min(r,o);u=Math.round(o/b),l+=b}let f=Fe.createTypedArray(s,l*2),d=0,p;for(p=0;p<o-1;p++)f[d++]=p,f[d++]=p+1,f[d++]=p+o,f[d++]=p+1+o;if(f[d++]=o-1,f[d++]=0,f[d++]=o+o-1,f[d++]=o,r>0)for(p=0;p<o;p+=u)f[d++]=p,f[d++]=p+o;let g=new pn;g.position=new we({componentDatatype:$.DOUBLE,componentsPerAttribute:3,values:a}),k5.x=t*.5,k5.y=Math.max(i,n);let m=new ce(h.ZERO,H.magnitude(k5));if(c(e._offsetAttribute)){t=a.length;let b=e._offsetAttribute===Jt.NONE?0:1,x=new Uint8Array(t/3).fill(b);g.applyOffset=new we({componentDatatype:$.UNSIGNED_BYTE,componentsPerAttribute:1,values:x})}return new ut({attributes:g,indices:f,primitiveType:Me.LINES,boundingSphere:m,offsetAttribute:e._offsetAttribute})};var V5=lA;var Lle=h.ZERO,Nle=new h,b7e=new h,Fle=new j;function x7e(e){this.id=e,this.vertexFormat=void 0,this.length=void 0,this.topRadius=void 0,this.bottomRadius=void 0,this.slices=void 0,this.numberOfVerticalLines=void 0,this.offsetAttribute=void 0}function Yl(e,t){oi.call(this,{entity:e,scene:t,geometryOptions:new x7e(e),geometryPropertyName:"cylinder",observedPropertyNames:["availability","position","orientation","cylinder"]}),this._onEntityPropertyChanged(e,"cylinder",e.cylinder,void 0)}c(Object.create)&&(Yl.prototype=Object.create(oi.prototype),Yl.prototype.constructor=Yl);Object.defineProperties(Yl.prototype,{terrainOffsetProperty:{get:function(){return this._terrainOffsetProperty}}});Yl.prototype.createFillGeometryInstance=function(e){if(A.defined("time",e),!this._fillEnabled)throw new E("This instance does not represent a filled geometry.");let t=this._entity,n=t.isAvailable(e),i=new Cn(n&&t.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),o=this._distanceDisplayConditionProperty.getValue(e),r=kn.fromDistanceDisplayCondition(o),s={show:i,distanceDisplayCondition:r,color:void 0,offset:void 0};if(this._materialProperty instanceof Ht){let a;c(this._materialProperty.color)&&(this._materialProperty.color.isConstant||n)&&(a=this._materialProperty.color.getValue(e,Fle)),c(a)||(a=j.WHITE),s.color=Wt.fromColor(a)}return c(this._options.offsetAttribute)&&(s.offset=Qi.fromCartesian3(X.getValueOrDefault(this._terrainOffsetProperty,e,Lle,Nle))),new vt({id:t,geometry:new B5(this._options),modelMatrix:t.computeModelMatrixForHeightReference(e,t.cylinder.heightReference,this._options.length*.5,this._scene.ellipsoid),attributes:s})};Yl.prototype.createOutlineGeometryInstance=function(e){if(A.defined("time",e),!this._outlineEnabled)throw new E("This instance does not represent an outlined geometry.");let t=this._entity,n=t.isAvailable(e),i=X.getValueOrDefault(this._outlineColorProperty,e,j.BLACK,Fle),o=this._distanceDisplayConditionProperty.getValue(e),r={show:new Cn(n&&t.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:Wt.fromColor(i),distanceDisplayCondition:kn.fromDistanceDisplayCondition(o),offset:void 0};return c(this._options.offsetAttribute)&&(r.offset=Qi.fromCartesian3(X.getValueOrDefault(this._terrainOffsetProperty,e,Lle,Nle))),new vt({id:t,geometry:new V5(this._options),modelMatrix:t.computeModelMatrixForHeightReference(e,t.cylinder.heightReference,this._options.length*.5,this._scene.ellipsoid),attributes:r})};Yl.prototype._computeCenter=function(e,t){return X.getValueOrUndefined(this._entity.position,e,t)};Yl.prototype._isHidden=function(e,t){return!c(e.position)||!c(t.length)||!c(t.topRadius)||!c(t.bottomRadius)||oi.prototype._isHidden.call(this,e,t)};Yl.prototype._isDynamic=function(e,t){return!e.position.isConstant||!X.isConstant(e.orientation)||!t.length.isConstant||!t.topRadius.isConstant||!t.bottomRadius.isConstant||!X.isConstant(t.slices)||!X.isConstant(t.outlineWidth)||!X.isConstant(t.numberOfVerticalLines)};Yl.prototype._setStaticOptions=function(e,t){let n=X.getValueOrDefault(t.heightReference,je.MINIMUM_VALUE,$e.NONE),i=this._options;i.vertexFormat=this._materialProperty instanceof Ht?ln.VERTEX_FORMAT:uo.MaterialSupport.TEXTURED.vertexFormat,i.length=t.length.getValue(je.MINIMUM_VALUE),i.topRadius=t.topRadius.getValue(je.MINIMUM_VALUE),i.bottomRadius=t.bottomRadius.getValue(je.MINIMUM_VALUE),i.slices=X.getValueOrUndefined(t.slices,je.MINIMUM_VALUE),i.numberOfVerticalLines=X.getValueOrUndefined(t.numberOfVerticalLines,je.MINIMUM_VALUE),i.offsetAttribute=n!==$e.NONE?Jt.ALL:void 0};Yl.prototype._onEntityPropertyChanged=t0;Yl.DynamicGeometryUpdater=uA;function uA(e,t,n){ii.call(this,e,t,n)}c(Object.create)&&(uA.prototype=Object.create(ii.prototype),uA.prototype.constructor=uA);uA.prototype._isHidden=function(e,t,n){let i=this._options,o=X.getValueOrUndefined(e.position,n,b7e);return!c(o)||!c(i.length)||!c(i.topRadius)||!c(i.bottomRadius)||ii.prototype._isHidden.call(this,e,t,n)};uA.prototype._setOptions=function(e,t,n){let i=X.getValueOrDefault(t.heightReference,n,$e.NONE),o=this._options;o.length=X.getValueOrUndefined(t.length,n),o.topRadius=X.getValueOrUndefined(t.topRadius,n),o.bottomRadius=X.getValueOrUndefined(t.bottomRadius,n),o.slices=X.getValueOrUndefined(t.slices,n),o.numberOfVerticalLines=X.getValueOrUndefined(t.numberOfVerticalLines,n),o.offsetAttribute=i!==$e.NONE?Jt.ALL:void 0};var U5=Yl;var T7e={UNBOUNDED:0,CLAMPED:1,LOOP_STOP:2},jr=Object.freeze(T7e);var A7e={TICK_DEPENDENT:0,SYSTEM_CLOCK_MULTIPLIER:1,SYSTEM_CLOCK:2},ho=Object.freeze(A7e);var C7e={NONE:0,HOLD:1,EXTRAPOLATE:2},gd=Object.freeze(C7e);var Ble=Ur(Pl(),1);function E7e(e){if(!c(e))throw new E("uri is required.");let t=new Ble.default(e);t.normalize();let n=t.path(),i=n.lastIndexOf("/");return i!==-1&&(n=n.substr(i+1)),n}var Q0=E7e;var S7e=R.factorial;function z5(e,t,n,i,o,r){let s=0,a,l,u;if(i>0){for(l=0;l<o;l++){for(a=!1,u=0;u<r.length&&!a;u++)l===r[u]&&(a=!0);a||(r.push(l),s+=z5(e,t,n,i-1,o,r),r.splice(r.length-1,1))}return s}for(s=1,l=0;l<o;l++){for(a=!1,u=0;u<r.length&&!a;u++)l===r[u]&&(a=!0);a||(s*=e-n[t[l]])}return s}var tR={type:"Hermite"};tR.getRequiredDataPoints=function(e,t){if(t=y(t,0),!c(e))throw new E("degree is required.");if(e<0)throw new E("degree must be 0 or greater.");if(t<0)throw new E("inputOrder must be 0 or greater.");return Math.max(Math.floor((e+1)/(t+1)),2)};tR.interpolateOrderZero=function(e,t,n,i,o){c(o)||(o=new Array(i));let r,s,a,l,u,f,d=t.length,p=new Array(i);for(r=0;r<i;r++){o[r]=0;let x=new Array(d);for(p[r]=x,s=0;s<d;s++)x[s]=[]}let g=d,m=new Array(g);for(r=0;r<g;r++)m[r]=r;let b=d-1;for(l=0;l<i;l++){for(s=0;s<g;s++)f=m[s]*i+l,p[l][0].push(n[f]);for(r=1;r<g;r++){let x=!1;for(s=0;s<g-r;s++){let T=t[m[s]],C=t[m[s+r]],S;C-T<=0?(f=m[s]*i+i*r+l,S=n[f],p[l][r].push(S/S7e(r))):(S=p[l][r-1][s+1]-p[l][r-1][s],p[l][r].push(S/(C-T))),x=x||S!==0}x||(b=r-1)}}for(a=0,u=0;a<=u;a++)for(r=a;r<=b;r++){let x=z5(e,m,t,a,r,[]);for(l=0;l<i;l++){let T=p[l][r][0];o[l+a*i]+=T*x}}return o};var w7e=[];tR.interpolate=function(e,t,n,i,o,r,s){let a=i*(r+1);c(s)||(s=new Array(a));for(let T=0;T<a;T++)s[T]=0;let l=t.length,u=new Array(l*(o+1)),f;for(f=0;f<l;f++)for(let T=0;T<o+1;T++)u[f*(o+1)+T]=f;let d=u.length,p=w7e,g=v7e(p,u,t,n,i,o),m=[],b=d*(d+1)/2,x=Math.min(g,r);for(let T=0;T<=x;T++)for(f=T;f<=g;f++){m.length=0;let C=z5(e,u,t,T,f,m),S=Math.floor(f*(1-f)/2)+d*f;for(let v=0;v<i;v++){let D=Math.floor(v*b),I=p[D+S];s[v+T*i]+=I*C}}return s};function v7e(e,t,n,i,o,r){let s,a,l=-1,u=t.length,f=u*(u+1)/2;for(let d=0;d<o;d++){let p=Math.floor(d*f);for(s=0;s<u;s++)a=t[s]*o*(r+1)+d,e[p+s]=i[a];for(let g=1;g<u;g++){let m=0,b=Math.floor(g*(1-g)/2)+u*g,x=!1;for(s=0;s<u-g;s++){let T=n[t[s]],C=n[t[s+g]],S,v;if(C-T<=0)a=t[s]*o*(r+1)+o*g+d,S=i[a],v=S/R.factorial(g),e[p+b+m]=v,m++;else{let D=Math.floor((g-1)*(2-g)/2)+u*(g-1);S=e[p+D+s+1]-e[p+D+s],v=S/(C-T),e[p+b+m]=v,m++}x=x||S!==0}x&&(l=Math.max(l,g))}}return l}var H5=tR;var G5={type:"Lagrange"};G5.getRequiredDataPoints=function(e){return Math.max(e+1,2)};G5.interpolateOrderZero=function(e,t,n,i,o){c(o)||(o=new Array(i));let r,s,a=t.length;for(r=0;r<i;r++)o[r]=0;for(r=0;r<a;r++){let l=1;for(s=0;s<a;s++)if(s!==r){let u=t[r]-t[s];l*=(e-t[s])/u}for(s=0;s<i;s++)o[s]+=l*n[r*i+s]}return o};var j5=G5;var W5={type:"Linear"};W5.getRequiredDataPoints=function(e){return 2};W5.interpolateOrderZero=function(e,t,n,i,o){if(t.length!==2)throw new E("The xTable provided to the linear interpolator must have exactly two elements.");if(i<=0)throw new E("There must be at least 1 dependent variable for each independent variable.");c(o)||(o=new Array(i));let r,s,a,l=t[0],u=t[1];if(l===u)throw new E("Divide by zero error: xTable[0] and xTable[1] are equal");for(r=0;r<i;r++)s=n[r],a=n[r+i],o[r]=((a-s)*e+u*s-l*a)/(u-l);return o};var pv=W5;function Za(e,t,n){this.clock=y(e,0),this.cone=y(t,0),this.magnitude=y(n,1)}Za.fromCartesian3=function(e,t){A.typeOf.object("cartesian3",e);let n=e.x,i=e.y,o=e.z,r=n*n+i*i;return c(t)||(t=new Za),t.clock=Math.atan2(i,n),t.cone=Math.atan2(Math.sqrt(r),o),t.magnitude=Math.sqrt(r+o*o),t};Za.clone=function(e,t){if(c(e))return c(t)?(t.clock=e.clock,t.cone=e.cone,t.magnitude=e.magnitude,t):new Za(e.clock,e.cone,e.magnitude)};Za.normalize=function(e,t){return A.typeOf.object("spherical",e),c(t)?(t.clock=e.clock,t.cone=e.cone,t.magnitude=1,t):new Za(e.clock,e.cone,1)};Za.equals=function(e,t){return e===t||c(e)&&c(t)&&e.clock===t.clock&&e.cone===t.cone&&e.magnitude===t.magnitude};Za.equalsEpsilon=function(e,t,n){return n=y(n,0),e===t||c(e)&&c(t)&&Math.abs(e.clock-t.clock)<=n&&Math.abs(e.cone-t.cone)<=n&&Math.abs(e.magnitude-t.magnitude)<=n};Za.prototype.equals=function(e){return Za.equals(this,e)};Za.prototype.clone=function(e){return Za.clone(this,e)};Za.prototype.equalsEpsilon=function(e,t){return Za.equalsEpsilon(this,e,t)};Za.prototype.toString=function(){return`(${this.clock}, ${this.cone}, ${this.magnitude})`};var q5=Za;var xv=Ur(Pl(),1);var Y5;typeof performance<"u"&&typeof performance.now=="function"&&isFinite(performance.now())?Y5=function(){return performance.now()}:Y5=function(){return Date.now()};var Ei=Y5;function X5(e){e=y(e,y.EMPTY_OBJECT);let t=e.currentTime,n=e.startTime,i=e.stopTime;if(c(t)?t=J.clone(t):c(n)?t=J.clone(n):c(i)?t=J.addDays(i,-1,new J):t=J.now(),c(n)?n=J.clone(n):n=J.clone(t),c(i)?i=J.clone(i):i=J.addDays(n,1,new J),J.greaterThan(n,i))throw new E("startTime must come before stopTime.");this.startTime=n,this.stopTime=i,this.clockRange=y(e.clockRange,jr.UNBOUNDED),this.canAnimate=y(e.canAnimate,!0),this.onTick=new pe,this.onStop=new pe,this._currentTime=void 0,this._multiplier=void 0,this._clockStep=void 0,this._shouldAnimate=void 0,this._lastSystemTime=Ei(),this.currentTime=t,this.multiplier=y(e.multiplier,1),this.shouldAnimate=y(e.shouldAnimate,!1),this.clockStep=y(e.clockStep,ho.SYSTEM_CLOCK_MULTIPLIER)}Object.defineProperties(X5.prototype,{currentTime:{get:function(){return this._currentTime},set:function(e){J.equals(this._currentTime,e)||(this._clockStep===ho.SYSTEM_CLOCK&&(this._clockStep=ho.SYSTEM_CLOCK_MULTIPLIER),this._currentTime=e)}},multiplier:{get:function(){return this._multiplier},set:function(e){this._multiplier!==e&&(this._clockStep===ho.SYSTEM_CLOCK&&(this._clockStep=ho.SYSTEM_CLOCK_MULTIPLIER),this._multiplier=e)}},clockStep:{get:function(){return this._clockStep},set:function(e){e===ho.SYSTEM_CLOCK&&(this._multiplier=1,this._shouldAnimate=!0,this._currentTime=J.now()),this._clockStep=e}},shouldAnimate:{get:function(){return this._shouldAnimate},set:function(e){this._shouldAnimate!==e&&(this._clockStep===ho.SYSTEM_CLOCK&&(this._clockStep=ho.SYSTEM_CLOCK_MULTIPLIER),this._shouldAnimate=e)}}});X5.prototype.tick=function(){let e=Ei(),t=J.clone(this._currentTime);if(this.canAnimate&&this._shouldAnimate){let n=this._clockStep;if(n===ho.SYSTEM_CLOCK)t=J.now(t);else{let i=this._multiplier;if(n===ho.TICK_DEPENDENT)t=J.addSeconds(t,i,t);else{let a=e-this._lastSystemTime;t=J.addSeconds(t,i*(a/1e3),t)}let o=this.clockRange,r=this.startTime,s=this.stopTime;if(o===jr.CLAMPED)J.lessThan(t,r)?t=J.clone(r,t):J.greaterThan(t,s)&&(t=J.clone(s,t),this.onStop.raiseEvent(this));else if(o===jr.LOOP_STOP)for(J.lessThan(t,r)&&(t=J.clone(r,t));J.greaterThan(t,s);)t=J.addSeconds(r,J.secondsDifference(t,s),t),this.onStop.raiseEvent(this)}}return this._currentTime=t,this._lastSystemTime=e,this.onTick.raiseEvent(this),t};var Oh=X5;function eb(){this._definitionChanged=new pe,this._startTime=void 0,this._stopTime=void 0,this._currentTime=void 0,this._clockRange=void 0,this._clockStep=void 0,this._multiplier=void 0}Object.defineProperties(eb.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},startTime:ku("startTime"),stopTime:ku("stopTime"),currentTime:ku("currentTime"),clockRange:ku("clockRange"),clockStep:ku("clockStep"),multiplier:ku("multiplier")});eb.prototype.clone=function(e){return c(e)||(e=new eb),e.startTime=this.startTime,e.stopTime=this.stopTime,e.currentTime=this.currentTime,e.clockRange=this.clockRange,e.clockStep=this.clockStep,e.multiplier=this.multiplier,e};eb.prototype.equals=function(e){return this===e||c(e)&&J.equals(this.startTime,e.startTime)&&J.equals(this.stopTime,e.stopTime)&&J.equals(this.currentTime,e.currentTime)&&this.clockRange===e.clockRange&&this.clockStep===e.clockStep&&this.multiplier===e.multiplier};eb.prototype.merge=function(e){if(!c(e))throw new E("source is required.");this.startTime=y(this.startTime,e.startTime),this.stopTime=y(this.stopTime,e.stopTime),this.currentTime=y(this.currentTime,e.currentTime),this.clockRange=y(this.clockRange,e.clockRange),this.clockStep=y(this.clockStep,e.clockStep),this.multiplier=y(this.multiplier,e.multiplier)};eb.prototype.getValue=function(e){return c(e)||(e=new Oh),e.startTime=y(this.startTime,e.startTime),e.stopTime=y(this.stopTime,e.stopTime),e.currentTime=y(this.currentTime,e.currentTime),e.clockRange=y(this.clockRange,e.clockRange),e.multiplier=y(this.multiplier,e.multiplier),e.clockStep=y(this.clockStep,e.clockStep),e};var Lp=eb;var D7e=j.WHITE,P7e=.1,I7e=new H(8,8),O7e=new H(0,0),R7e=new H(1,1);function fA(e){e=y(e,y.EMPTY_OBJECT),this._definitionChanged=new pe,this._color=void 0,this._colorSubscription=void 0,this._cellAlpha=void 0,this._cellAlphaSubscription=void 0,this._lineCount=void 0,this._lineCountSubscription=void 0,this._lineThickness=void 0,this._lineThicknessSubscription=void 0,this._lineOffset=void 0,this._lineOffsetSubscription=void 0,this.color=e.color,this.cellAlpha=e.cellAlpha,this.lineCount=e.lineCount,this.lineThickness=e.lineThickness,this.lineOffset=e.lineOffset}Object.defineProperties(fA.prototype,{isConstant:{get:function(){return X.isConstant(this._color)&&X.isConstant(this._cellAlpha)&&X.isConstant(this._lineCount)&&X.isConstant(this._lineThickness)&&X.isConstant(this._lineOffset)}},definitionChanged:{get:function(){return this._definitionChanged}},color:fe("color"),cellAlpha:fe("cellAlpha"),lineCount:fe("lineCount"),lineThickness:fe("lineThickness"),lineOffset:fe("lineOffset")});fA.prototype.getType=function(e){return"Grid"};var M7e=new J;fA.prototype.getValue=function(e,t){return c(e)||(e=J.now(M7e)),c(t)||(t={}),t.color=X.getValueOrClonedDefault(this._color,e,D7e,t.color),t.cellAlpha=X.getValueOrDefault(this._cellAlpha,e,P7e),t.lineCount=X.getValueOrClonedDefault(this._lineCount,e,I7e,t.lineCount),t.lineThickness=X.getValueOrClonedDefault(this._lineThickness,e,R7e,t.lineThickness),t.lineOffset=X.getValueOrClonedDefault(this._lineOffset,e,O7e,t.lineOffset),t};fA.prototype.equals=function(e){return this===e||e instanceof fA&&X.equals(this._color,e._color)&&X.equals(this._cellAlpha,e._cellAlpha)&&X.equals(this._lineCount,e._lineCount)&&X.equals(this._lineThickness,e._lineThickness)&&X.equals(this._lineOffset,e._lineOffset)};var nR=fA;function dA(e){this._definitionChanged=new pe,this._color=void 0,this._colorSubscription=void 0,this.color=e}Object.defineProperties(dA.prototype,{isConstant:{get:function(){return X.isConstant(this._color)}},definitionChanged:{get:function(){return this._definitionChanged}},color:fe("color")});dA.prototype.getType=function(e){return"PolylineArrow"};var L7e=new J;dA.prototype.getValue=function(e,t){return c(e)||(e=J.now(L7e)),c(t)||(t={}),t.color=X.getValueOrClonedDefault(this._color,e,j.WHITE,t.color),t};dA.prototype.equals=function(e){return this===e||e instanceof dA&&X.equals(this._color,e._color)};var iR=dA;var N7e=j.WHITE,F7e=j.TRANSPARENT,B7e=16,k7e=255;function hA(e){e=y(e,y.EMPTY_OBJECT),this._definitionChanged=new pe,this._color=void 0,this._colorSubscription=void 0,this._gapColor=void 0,this._gapColorSubscription=void 0,this._dashLength=void 0,this._dashLengthSubscription=void 0,this._dashPattern=void 0,this._dashPatternSubscription=void 0,this.color=e.color,this.gapColor=e.gapColor,this.dashLength=e.dashLength,this.dashPattern=e.dashPattern}Object.defineProperties(hA.prototype,{isConstant:{get:function(){return X.isConstant(this._color)&&X.isConstant(this._gapColor)&&X.isConstant(this._dashLength)&&X.isConstant(this._dashPattern)}},definitionChanged:{get:function(){return this._definitionChanged}},color:fe("color"),gapColor:fe("gapColor"),dashLength:fe("dashLength"),dashPattern:fe("dashPattern")});hA.prototype.getType=function(e){return"PolylineDash"};var V7e=new J;hA.prototype.getValue=function(e,t){return c(e)||(e=J.now(V7e)),c(t)||(t={}),t.color=X.getValueOrClonedDefault(this._color,e,N7e,t.color),t.gapColor=X.getValueOrClonedDefault(this._gapColor,e,F7e,t.gapColor),t.dashLength=X.getValueOrDefault(this._dashLength,e,B7e,t.dashLength),t.dashPattern=X.getValueOrDefault(this._dashPattern,e,k7e,t.dashPattern),t};hA.prototype.equals=function(e){return this===e||e instanceof hA&&X.equals(this._color,e._color)&&X.equals(this._gapColor,e._gapColor)&&X.equals(this._dashLength,e._dashLength)&&X.equals(this._dashPattern,e._dashPattern)};var oR=hA;var U7e=j.WHITE,z7e=.25,H7e=1;function mA(e){e=y(e,y.EMPTY_OBJECT),this._definitionChanged=new pe,this._color=void 0,this._colorSubscription=void 0,this._glowPower=void 0,this._glowPowerSubscription=void 0,this._taperPower=void 0,this._taperPowerSubscription=void 0,this.color=e.color,this.glowPower=e.glowPower,this.taperPower=e.taperPower}Object.defineProperties(mA.prototype,{isConstant:{get:function(){return X.isConstant(this._color)&&X.isConstant(this._glow)}},definitionChanged:{get:function(){return this._definitionChanged}},color:fe("color"),glowPower:fe("glowPower"),taperPower:fe("taperPower")});mA.prototype.getType=function(e){return"PolylineGlow"};var G7e=new J;mA.prototype.getValue=function(e,t){return c(e)||(e=J.now(G7e)),c(t)||(t={}),t.color=X.getValueOrClonedDefault(this._color,e,U7e,t.color),t.glowPower=X.getValueOrDefault(this._glowPower,e,z7e,t.glowPower),t.taperPower=X.getValueOrDefault(this._taperPower,e,H7e,t.taperPower),t};mA.prototype.equals=function(e){return this===e||e instanceof mA&&X.equals(this._color,e._color)&&X.equals(this._glowPower,e._glowPower)&&X.equals(this._taperPower,e._taperPower)};var rR=mA;var j7e=j.WHITE,W7e=j.BLACK,q7e=1;function pA(e){e=y(e,y.EMPTY_OBJECT),this._definitionChanged=new pe,this._color=void 0,this._colorSubscription=void 0,this._outlineColor=void 0,this._outlineColorSubscription=void 0,this._outlineWidth=void 0,this._outlineWidthSubscription=void 0,this.color=e.color,this.outlineColor=e.outlineColor,this.outlineWidth=e.outlineWidth}Object.defineProperties(pA.prototype,{isConstant:{get:function(){return X.isConstant(this._color)&&X.isConstant(this._outlineColor)&&X.isConstant(this._outlineWidth)}},definitionChanged:{get:function(){return this._definitionChanged}},color:fe("color"),outlineColor:fe("outlineColor"),outlineWidth:fe("outlineWidth")});pA.prototype.getType=function(e){return"PolylineOutline"};var Y7e=new J;pA.prototype.getValue=function(e,t){return c(e)||(e=J.now(Y7e)),c(t)||(t={}),t.color=X.getValueOrClonedDefault(this._color,e,j7e,t.color),t.outlineColor=X.getValueOrClonedDefault(this._outlineColor,e,W7e,t.outlineColor),t.outlineWidth=X.getValueOrDefault(this._outlineWidth,e,q7e),t};pA.prototype.equals=function(e){return this===e||e instanceof pA&&X.equals(this._color,e._color)&&X.equals(this._outlineColor,e._outlineColor)&&X.equals(this._outlineWidth,e._outlineWidth)};var _A=pA;function Np(e,t){this._value=void 0,this._definitionChanged=new pe,this._eventHelper=new yr,this._referenceFrame=y(t,ji.FIXED),this.setValue(e)}Object.defineProperties(Np.prototype,{isConstant:{get:function(){let e=this._value;if(!c(e))return!0;let t=e.length;for(let n=0;n<t;n++)if(!X.isConstant(e[n]))return!1;return!0}},definitionChanged:{get:function(){return this._definitionChanged}},referenceFrame:{get:function(){return this._referenceFrame}}});var X7e=new J;Np.prototype.getValue=function(e,t){return c(e)||(e=J.now(X7e)),this.getValueInReferenceFrame(e,ji.FIXED,t)};Np.prototype.getValueInReferenceFrame=function(e,t,n){if(!c(e))throw new E("time is required.");if(!c(t))throw new E("referenceFrame is required.");let i=this._value;if(!c(i))return;let o=i.length;c(n)||(n=new Array(o));let r=0,s=0;for(;r<o;){let l=i[r].getValueInReferenceFrame(e,t,n[r]);c(l)&&(n[s]=l,s++),r++}return n.length=s,n};Np.prototype.setValue=function(e){let t=this._eventHelper;if(t.removeAll(),c(e)){this._value=e.slice();let n=e.length;for(let i=0;i<n;i++){let o=e[i];c(o)&&t.add(o.definitionChanged,Np.prototype._raiseDefinitionChanged,this)}}else this._value=void 0;this._definitionChanged.raiseEvent(this)};Np.prototype.equals=function(e){return this===e||e instanceof Np&&this._referenceFrame===e._referenceFrame&&X.arrayEquals(this._value,e._value)};Np.prototype._raiseDefinitionChanged=function(){this._definitionChanged.raiseEvent(this)};var tb=Np;function xg(e){this._value=void 0,this._definitionChanged=new pe,this._eventHelper=new yr,this.setValue(e)}Object.defineProperties(xg.prototype,{isConstant:{get:function(){let e=this._value;if(!c(e))return!0;let t=e.length;for(let n=0;n<t;n++)if(!X.isConstant(e[n]))return!1;return!0}},definitionChanged:{get:function(){return this._definitionChanged}}});var K7e=new J;xg.prototype.getValue=function(e,t){c(e)||(e=J.now(K7e));let n=this._value;if(!c(n))return;let i=n.length;c(t)||(t=new Array(i));let o=0,r=0;for(;o<i;){let a=this._value[o].getValue(e,t[o]);c(a)&&(t[r]=a,r++),o++}return t.length=r,t};xg.prototype.setValue=function(e){let t=this._eventHelper;if(t.removeAll(),c(e)){this._value=e.slice();let n=e.length;for(let i=0;i<n;i++){let o=e[i];c(o)&&t.add(o.definitionChanged,xg.prototype._raiseDefinitionChanged,this)}}else this._value=void 0;this._definitionChanged.raiseEvent(this)};xg.prototype.equals=function(e){return this===e||e instanceof xg&&X.arrayEquals(this._value,e._value)};xg.prototype._raiseDefinitionChanged=function(){this._definitionChanged.raiseEvent(this)};var sR=xg;function nb(e){let t=e._targetProperty;if(!c(t)){let n=e._targetEntity;if(!c(n)){if(n=e._targetCollection.getById(e._targetId),!c(n)){e._targetEntity=e._targetProperty=void 0;return}n.definitionChanged.addEventListener(Xl.prototype._onTargetEntityDefinitionChanged,e),e._targetEntity=n}let i=e._targetPropertyNames;t=e._targetEntity;for(let o=0,r=i.length;o<r&&c(t);++o)t=t[i[o]];e._targetProperty=t}return t}function Xl(e,t,n){if(!c(e))throw new E("targetCollection is required.");if(!c(t)||t==="")throw new E("targetId is required.");if(!c(n)||n.length===0)throw new E("targetPropertyNames is required.");for(let i=0;i<n.length;i++){let o=n[i];if(!c(o)||o==="")throw new E("reference contains invalid properties.")}this._targetCollection=e,this._targetId=t,this._targetPropertyNames=n,this._targetProperty=void 0,this._targetEntity=void 0,this._definitionChanged=new pe,e.collectionChanged.addEventListener(Xl.prototype._onCollectionChanged,this)}Object.defineProperties(Xl.prototype,{isConstant:{get:function(){return X.isConstant(nb(this))}},definitionChanged:{get:function(){return this._definitionChanged}},referenceFrame:{get:function(){let e=nb(this);return c(e)?e.referenceFrame:void 0}},targetId:{get:function(){return this._targetId}},targetCollection:{get:function(){return this._targetCollection}},targetPropertyNames:{get:function(){return this._targetPropertyNames}},resolvedProperty:{get:function(){return nb(this)}}});Xl.fromString=function(e,t){if(!c(e))throw new E("targetCollection is required.");if(!c(t))throw new E("referenceString is required.");let n,i=[],o=!0,r=!1,s="";for(let a=0;a<t.length;++a){let l=t.charAt(a);r?(s+=l,r=!1):l==="\\"?r=!0:o&&l==="#"?(n=s,o=!1,s=""):!o&&l==="."?(i.push(s),s=""):s+=l}return i.push(s),new Xl(e,n,i)};var $7e=new J;Xl.prototype.getValue=function(e,t){let n=nb(this);return c(e)||(e=J.now($7e)),c(n)?n.getValue(e,t):void 0};Xl.prototype.getValueInReferenceFrame=function(e,t,n){let i=nb(this);return c(i)?i.getValueInReferenceFrame(e,t,n):void 0};Xl.prototype.getType=function(e){let t=nb(this);return c(t)?t.getType(e):void 0};Xl.prototype.equals=function(e){if(this===e)return!0;let t=this._targetPropertyNames,n=e._targetPropertyNames;if(this._targetCollection!==e._targetCollection||this._targetId!==e._targetId||t.length!==n.length)return!1;let i=this._targetPropertyNames.length;for(let o=0;o<i;o++)if(t[o]!==n[o])return!1;return!0};Xl.prototype._onTargetEntityDefinitionChanged=function(e,t,n,i){c(this._targetProperty)&&this._targetPropertyNames[0]===t&&(this._targetProperty=void 0,this._definitionChanged.raiseEvent(this))};Xl.prototype._onCollectionChanged=function(e,t,n){let i=this._targetEntity;c(i)&&n.indexOf(i)!==-1?(i.definitionChanged.removeEventListener(Xl.prototype._onTargetEntityDefinitionChanged,this),this._targetEntity=this._targetProperty=void 0):c(i)||(i=nb(this),c(i)&&this._definitionChanged.raiseEvent(this))};var ib=Xl;var Z7e={packedLength:1,pack:function(e,t,n){if(!c(e))throw new E("value is required");if(!c(t))throw new E("array is required");return n=y(n,0),t[n]=e,t},unpack:function(e,t,n){if(!c(e))throw new E("array is required");return t=y(t,0),e[t]},convertPackedArrayForInterpolation:function(e,t,n,i){if(!c(e))throw new E("packedArray is required");c(i)||(i=[]),t=y(t,0),n=y(n,e.length);let o;for(let r=0,s=n-t+1;r<s;r++){let a=e[t+r];r===0||Math.abs(o-a)<Math.PI?i[r]=a:i[r]=a-R.TWO_PI,o=a}},unpackInterpolationResult:function(e,t,n,i,o){if(!c(e))throw new E("array is required");if(!c(t))throw new E("sourceArray is required");return o=e[0],o<0?o+R.TWO_PI:o}},Rh=Z7e;var kle={packedLength:1,pack:function(e,t,n){n=y(n,0),t[n]=e},unpack:function(e,t,n){return t=y(t,0),e[t]}};function Vle(e,t,n){let i,o=e.length,r=n.length,s=o+r;if(e.length=s,o!==t){let a=o-1;for(i=s-1;i>=t;i--)e[i]=e[a--]}for(i=0;i<r;i++)e[t++]=n[i]}function Ule(e,t){return e instanceof J?e:typeof e=="string"?J.fromIso8601(e):J.addSeconds(t,e,new J)}var K5=[],$5=[];function aR(e,t,n,i,o){let r=0,s,a,l,u,f,d;for(;r<i.length;){f=Ule(i[r],e),l=vo(t,f,J.compare);let p=0,g=0;if(l<0){for(l=~l,u=l*o,a=void 0,d=t[l];r<i.length&&(f=Ule(i[r],e),!(c(a)&&J.compare(a,f)>=0||c(d)&&J.compare(f,d)>=0));){for(K5[p++]=f,r=r+1,s=0;s<o;s++)$5[g++]=i[r],r=r+1;a=f}p>0&&($5.length=g,Vle(n,u,$5),K5.length=p,Vle(t,l,K5))}else{for(s=0;s<o;s++)r++,n[l*o+s]=i[r];r++}}}function yd(e,t){A.defined("type",e);let n=e;n===Number&&(n=kle);let i=n.packedLength,o=y(n.packedInterpolationLength,i),r=0,s;if(c(t)){let a=t.length;s=new Array(a);for(let l=0;l<a;l++){let u=t[l];u===Number&&(u=kle);let f=u.packedLength;i+=f,o+=y(u.packedInterpolationLength,f),s[l]=u}r=a}this._type=e,this._innerType=n,this._interpolationDegree=1,this._interpolationAlgorithm=pv,this._numberOfPoints=0,this._times=[],this._values=[],this._xTable=[],this._yTable=[],this._packedLength=i,this._packedInterpolationLength=o,this._updateTableLength=!0,this._interpolationResult=new Array(o),this._definitionChanged=new pe,this._derivativeTypes=t,this._innerDerivativeTypes=s,this._inputOrder=r,this._forwardExtrapolationType=gd.NONE,this._forwardExtrapolationDuration=0,this._backwardExtrapolationType=gd.NONE,this._backwardExtrapolationDuration=0}Object.defineProperties(yd.prototype,{isConstant:{get:function(){return this._values.length===0}},definitionChanged:{get:function(){return this._definitionChanged}},type:{get:function(){return this._type}},derivativeTypes:{get:function(){return this._derivativeTypes}},interpolationDegree:{get:function(){return this._interpolationDegree}},interpolationAlgorithm:{get:function(){return this._interpolationAlgorithm}},forwardExtrapolationType:{get:function(){return this._forwardExtrapolationType},set:function(e){this._forwardExtrapolationType!==e&&(this._forwardExtrapolationType=e,this._definitionChanged.raiseEvent(this))}},forwardExtrapolationDuration:{get:function(){return this._forwardExtrapolationDuration},set:function(e){this._forwardExtrapolationDuration!==e&&(this._forwardExtrapolationDuration=e,this._definitionChanged.raiseEvent(this))}},backwardExtrapolationType:{get:function(){return this._backwardExtrapolationType},set:function(e){this._backwardExtrapolationType!==e&&(this._backwardExtrapolationType=e,this._definitionChanged.raiseEvent(this))}},backwardExtrapolationDuration:{get:function(){return this._backwardExtrapolationDuration},set:function(e){this._backwardExtrapolationDuration!==e&&(this._backwardExtrapolationDuration=e,this._definitionChanged.raiseEvent(this))}}});var J7e=new J;yd.prototype.getValue=function(e,t){c(e)||(e=J.now(J7e));let n=this._times,i=n.length;if(i===0)return;let o,r=this._innerType,s=this._values,a=vo(n,e,J.compare);if(a<0){if(a=~a,a===0){let v=n[a];if(o=this._backwardExtrapolationDuration,this._backwardExtrapolationType===gd.NONE||o!==0&&J.secondsDifference(v,e)>o)return;if(this._backwardExtrapolationType===gd.HOLD)return r.unpack(s,0,t)}if(a>=i){a=i-1;let v=n[a];if(o=this._forwardExtrapolationDuration,this._forwardExtrapolationType===gd.NONE||o!==0&&J.secondsDifference(e,v)>o)return;if(this._forwardExtrapolationType===gd.HOLD)return a=i-1,r.unpack(s,a*r.packedLength,t)}let l=this._xTable,u=this._yTable,f=this._interpolationAlgorithm,d=this._packedInterpolationLength,p=this._inputOrder;if(this._updateTableLength){this._updateTableLength=!1;let v=Math.min(f.getRequiredDataPoints(this._interpolationDegree,p),i);v!==this._numberOfPoints&&(this._numberOfPoints=v,l.length=v,u.length=v*d)}let g=this._numberOfPoints-1;if(g<1)return;let m=0,b=i-1;if(b-m+1>=g+1){let v=a-(g/2|0)-1;v<m&&(v=m);let D=v+g;D>b&&(D=b,v=D-g,v<m&&(v=m)),m=v,b=D}let T=b-m+1;for(let v=0;v<T;++v)l[v]=J.secondsDifference(n[m+v],n[b]);if(c(r.convertPackedArrayForInterpolation))r.convertPackedArrayForInterpolation(s,m,b,u);else{let v=0,D=this._packedLength,I=m*D,L=(b+1)*D;for(;I<L;)u[v]=s[I],I++,v++}let C=J.secondsDifference(e,n[b]),S;if(p===0||!c(f.interpolate))S=f.interpolateOrderZero(C,l,u,d,this._interpolationResult);else{let v=Math.floor(d/(p+1));S=f.interpolate(C,l,u,v,p,p,this._interpolationResult)}return c(r.unpackInterpolationResult)?r.unpackInterpolationResult(S,s,m,b,t):r.unpack(S,0,t)}return r.unpack(s,a*this._packedLength,t)};yd.prototype.setInterpolationOptions=function(e){if(!c(e))return;let t=!1,n=e.interpolationAlgorithm,i=e.interpolationDegree;c(n)&&this._interpolationAlgorithm!==n&&(this._interpolationAlgorithm=n,t=!0),c(i)&&this._interpolationDegree!==i&&(this._interpolationDegree=i,t=!0),t&&(this._updateTableLength=!0,this._definitionChanged.raiseEvent(this))};yd.prototype.addSample=function(e,t,n){let i=this._innerDerivativeTypes,o=c(i);A.defined("time",e),A.defined("value",t),o&&A.defined("derivatives",n);let r=this._innerType,s=[];if(s.push(e),r.pack(t,s,s.length),o){let a=i.length;for(let l=0;l<a;l++)i[l].pack(n[l],s,s.length)}aR(void 0,this._times,this._values,s,this._packedLength),this._updateTableLength=!0,this._definitionChanged.raiseEvent(this)};yd.prototype.addSamples=function(e,t,n){let i=this._innerDerivativeTypes,o=c(i);if(A.defined("times",e),A.defined("values",t),e.length!==t.length)throw new E("times and values must be the same length.");if(o&&(!c(n)||n.length!==e.length))throw new E("times and derivativeValues must be the same length.");let r=this._innerType,s=e.length,a=[];for(let l=0;l<s;l++)if(a.push(e[l]),r.pack(t[l],a,a.length),o){let u=n[l],f=i.length;for(let d=0;d<f;d++)i[d].pack(u[d],a,a.length)}aR(void 0,this._times,this._values,a,this._packedLength),this._updateTableLength=!0,this._definitionChanged.raiseEvent(this)};yd.prototype.addSamplesPackedArray=function(e,t){A.defined("packedSamples",e),aR(t,this._times,this._values,e,this._packedLength),this._updateTableLength=!0,this._definitionChanged.raiseEvent(this)};yd.prototype.removeSample=function(e){A.defined("time",e);let t=vo(this._times,e,J.compare);return t<0?!1:(zle(this,t,1),!0)};function zle(e,t,n){let i=e._packedLength;e._times.splice(t,n),e._values.splice(t*i,n*i),e._updateTableLength=!0,e._definitionChanged.raiseEvent(e)}yd.prototype.removeSamples=function(e){A.defined("timeInterval",e);let t=this._times,n=vo(t,e.start,J.compare);n<0?n=~n:e.isStartIncluded||++n;let i=vo(t,e.stop,J.compare);i<0?i=~i:e.isStopIncluded&&++i,zle(this,n,i-n)};yd.prototype.equals=function(e){if(this===e)return!0;if(!c(e)||this._type!==e._type||this._interpolationDegree!==e._interpolationDegree||this._interpolationAlgorithm!==e._interpolationAlgorithm)return!1;let t=this._derivativeTypes,n=c(t),i=e._derivativeTypes,o=c(i);if(n!==o)return!1;let r,s;if(n){if(s=t.length,s!==i.length)return!1;for(r=0;r<s;r++)if(t[r]!==i[r])return!1}let a=this._times,l=e._times;if(s=a.length,s!==l.length)return!1;for(r=0;r<s;r++)if(!J.equals(a[r],l[r]))return!1;let u=this._values,f=e._values;for(s=u.length,r=0;r<s;r++)if(u[r]!==f[r])return!1;return!0};yd._mergeNewSamples=aR;var bd=yd;function hf(e,t){t=y(t,0);let n;if(t>0){n=new Array(t);for(let i=0;i<t;i++)n[i]=h}this._numberOfDerivatives=t,this._property=new bd(h,n),this._definitionChanged=new pe,this._referenceFrame=y(e,ji.FIXED),this._property._definitionChanged.addEventListener(function(){this._definitionChanged.raiseEvent(this)},this)}Object.defineProperties(hf.prototype,{isConstant:{get:function(){return this._property.isConstant}},definitionChanged:{get:function(){return this._definitionChanged}},referenceFrame:{get:function(){return this._referenceFrame}},interpolationDegree:{get:function(){return this._property.interpolationDegree}},interpolationAlgorithm:{get:function(){return this._property.interpolationAlgorithm}},numberOfDerivatives:{get:function(){return this._numberOfDerivatives}},forwardExtrapolationType:{get:function(){return this._property.forwardExtrapolationType},set:function(e){this._property.forwardExtrapolationType=e}},forwardExtrapolationDuration:{get:function(){return this._property.forwardExtrapolationDuration},set:function(e){this._property.forwardExtrapolationDuration=e}},backwardExtrapolationType:{get:function(){return this._property.backwardExtrapolationType},set:function(e){this._property.backwardExtrapolationType=e}},backwardExtrapolationDuration:{get:function(){return this._property.backwardExtrapolationDuration},set:function(e){this._property.backwardExtrapolationDuration=e}}});var Q7e=new J;hf.prototype.getValue=function(e,t){return c(e)||(e=J.now(Q7e)),this.getValueInReferenceFrame(e,ji.FIXED,t)};hf.prototype.getValueInReferenceFrame=function(e,t,n){if(A.defined("time",e),A.defined("referenceFrame",t),n=this._property.getValue(e,n),c(n))return Bm.convertToReferenceFrame(e,n,this._referenceFrame,t,n)};hf.prototype.setInterpolationOptions=function(e){this._property.setInterpolationOptions(e)};hf.prototype.addSample=function(e,t,n){let i=this._numberOfDerivatives;if(i>0&&(!c(n)||n.length!==i))throw new E("derivatives length must be equal to the number of derivatives.");this._property.addSample(e,t,n)};hf.prototype.addSamples=function(e,t,n){this._property.addSamples(e,t,n)};hf.prototype.addSamplesPackedArray=function(e,t){this._property.addSamplesPackedArray(e,t)};hf.prototype.removeSample=function(e){return this._property.removeSample(e)};hf.prototype.removeSamples=function(e){this._property.removeSamples(e)};hf.prototype.equals=function(e){return this===e||e instanceof hf&&X.equals(this._property,e._property)&&this._referenceFrame===e._referenceFrame};var Ja=hf;var eYe={HORIZONTAL:0,VERTICAL:1},Fp=Object.freeze(eYe);var tYe=Fp.HORIZONTAL,nYe=j.WHITE,iYe=j.BLACK,oYe=0,rYe=1;function gA(e){e=y(e,y.EMPTY_OBJECT),this._definitionChanged=new pe,this._orientation=void 0,this._orientationSubscription=void 0,this._evenColor=void 0,this._evenColorSubscription=void 0,this._oddColor=void 0,this._oddColorSubscription=void 0,this._offset=void 0,this._offsetSubscription=void 0,this._repeat=void 0,this._repeatSubscription=void 0,this.orientation=e.orientation,this.evenColor=e.evenColor,this.oddColor=e.oddColor,this.offset=e.offset,this.repeat=e.repeat}Object.defineProperties(gA.prototype,{isConstant:{get:function(){return X.isConstant(this._orientation)&&X.isConstant(this._evenColor)&&X.isConstant(this._oddColor)&&X.isConstant(this._offset)&&X.isConstant(this._repeat)}},definitionChanged:{get:function(){return this._definitionChanged}},orientation:fe("orientation"),evenColor:fe("evenColor"),oddColor:fe("oddColor"),offset:fe("offset"),repeat:fe("repeat")});gA.prototype.getType=function(e){return"Stripe"};var sYe=new J;gA.prototype.getValue=function(e,t){return c(e)||(e=J.now(sYe)),c(t)||(t={}),t.horizontal=X.getValueOrDefault(this._orientation,e,tYe)===Fp.HORIZONTAL,t.evenColor=X.getValueOrClonedDefault(this._evenColor,e,nYe,t.evenColor),t.oddColor=X.getValueOrClonedDefault(this._oddColor,e,iYe,t.oddColor),t.offset=X.getValueOrDefault(this._offset,e,oYe),t.repeat=X.getValueOrDefault(this._repeat,e,rYe),t};gA.prototype.equals=function(e){return this===e||e instanceof gA&&X.equals(this._orientation,e._orientation)&&X.equals(this._evenColor,e._evenColor)&&X.equals(this._oddColor,e._oddColor)&&X.equals(this._offset,e._offset)&&X.equals(this._repeat,e._repeat)};var cR=gA;function Tg(e){this._definitionChanged=new pe,this._intervals=new ts,this._intervals.changedEvent.addEventListener(Tg.prototype._intervalsChanged,this),this._referenceFrame=y(e,ji.FIXED)}Object.defineProperties(Tg.prototype,{isConstant:{get:function(){return this._intervals.isEmpty}},definitionChanged:{get:function(){return this._definitionChanged}},intervals:{get:function(){return this._intervals}},referenceFrame:{get:function(){return this._referenceFrame}}});var aYe=new J;Tg.prototype.getValue=function(e,t){return c(e)||(e=J.now(aYe)),this.getValueInReferenceFrame(e,ji.FIXED,t)};Tg.prototype.getValueInReferenceFrame=function(e,t,n){if(!c(e))throw new E("time is required.");if(!c(t))throw new E("referenceFrame is required.");let i=this._intervals.findDataForIntervalContainingDate(e);if(c(i))return Bm.convertToReferenceFrame(e,i,this._referenceFrame,t,n)};Tg.prototype.equals=function(e){return this===e||e instanceof Tg&&this._intervals.equals(e._intervals,X.equals)&&this._referenceFrame===e._referenceFrame};Tg.prototype._intervalsChanged=function(){this._definitionChanged.raiseEvent(this)};var ob=Tg;function rb(){this._definitionChanged=new pe,this._intervals=new ts,this._intervals.changedEvent.addEventListener(rb.prototype._intervalsChanged,this)}Object.defineProperties(rb.prototype,{isConstant:{get:function(){return this._intervals.isEmpty}},definitionChanged:{get:function(){return this._definitionChanged}},intervals:{get:function(){return this._intervals}}});var cYe=new J;rb.prototype.getValue=function(e,t){c(e)||(e=J.now(cYe));let n=this._intervals.findDataForIntervalContainingDate(e);return c(n)&&typeof n.clone=="function"?n.clone(t):n};rb.prototype.equals=function(e){return this===e||e instanceof rb&&this._intervals.equals(e._intervals,X.equals)};rb.prototype._intervalsChanged=function(){this._definitionChanged.raiseEvent(this)};var sb=rb;function yA(e,t){this._position=void 0,this._subscription=void 0,this._definitionChanged=new pe,this._normalize=y(t,!0),this.position=e}Object.defineProperties(yA.prototype,{isConstant:{get:function(){return X.isConstant(this._position)}},definitionChanged:{get:function(){return this._definitionChanged}},position:{get:function(){return this._position},set:function(e){let t=this._position;t!==e&&(c(t)&&this._subscription(),this._position=e,c(e)&&(this._subscription=e._definitionChanged.addEventListener(function(){this._definitionChanged.raiseEvent(this)},this)),this._definitionChanged.raiseEvent(this))}},normalize:{get:function(){return this._normalize},set:function(e){this._normalize!==e&&(this._normalize=e,this._definitionChanged.raiseEvent(this))}}});var lYe=new h,Hle=new h,Gle=new J,uYe=new J,Z5=1/60;yA.prototype.getValue=function(e,t){return this._getValue(e,t)};yA.prototype._getValue=function(e,t,n){c(e)||(e=J.now(uYe)),c(t)||(t=new h);let i=this._position;if(X.isConstant(i))return this._normalize?void 0:h.clone(h.ZERO,t);let o=i.getValue(e,lYe),r=i.getValue(J.addSeconds(e,Z5,Gle),Hle);if(!c(o)||!c(r)&&(r=o,o=i.getValue(J.addSeconds(e,-Z5,Gle),Hle),!c(o)))return;if(h.equals(o,r))return this._normalize?void 0:h.clone(h.ZERO,t);c(n)&&o.clone(n);let s=h.subtract(r,o,t);return this._normalize?h.normalize(s,t):h.divideByScalar(s,Z5,t)};yA.prototype.equals=function(e){return this===e||e instanceof yA&&X.equals(this._position,e._position)};var _v=yA;function gv(e,t){this._velocityVectorProperty=new _v(e,!0),this._subscription=void 0,this._ellipsoid=void 0,this._definitionChanged=new pe,this.ellipsoid=y(t,ie.default);let n=this;this._velocityVectorProperty.definitionChanged.addEventListener(function(){n._definitionChanged.raiseEvent(n)})}Object.defineProperties(gv.prototype,{isConstant:{get:function(){return X.isConstant(this._velocityVectorProperty)}},definitionChanged:{get:function(){return this._definitionChanged}},position:{get:function(){return this._velocityVectorProperty.position},set:function(e){this._velocityVectorProperty.position=e}},ellipsoid:{get:function(){return this._ellipsoid},set:function(e){this._ellipsoid!==e&&(this._ellipsoid=e,this._definitionChanged.raiseEvent(this))}}});var jle=new h,fYe=new h,Wle=new Q,dYe=new J;gv.prototype.getValue=function(e,t){c(e)||(e=J.now(dYe));let n=this._velocityVectorProperty._getValue(e,fYe,jle);if(c(n))return Ft.rotationMatrixFromPositionVelocity(jle,n,this._ellipsoid,Wle),Ne.fromRotationMatrix(Wle,t)};gv.prototype.equals=function(e){return this===e||e instanceof gv&&X.equals(this._velocityVectorProperty,e._velocityVectorProperty)&&(this._ellipsoid===e._ellipsoid||this._ellipsoid.equals(e._ellipsoid))};var J5=gv;var Bp={COMPLETE:0,BELOW_ELLIPSOID_HORIZON:1,ABOVE_ELLIPSOID_HORIZON:2};Bp.validate=function(e){return e===Bp.COMPLETE||e===Bp.BELOW_ELLIPSOID_HORIZON||e===Bp.ABOVE_ELLIPSOID_HORIZON};Bp.toString=function(e){switch(e){case Bp.COMPLETE:return"COMPLETE";case Bp.BELOW_ELLIPSOID_HORIZON:return"BELOW_ELLIPSOID_HORIZON";case Bp.ABOVE_ELLIPSOID_HORIZON:return"ABOVE_ELLIPSOID_HORIZON";default:throw new E("SensorVolumePortionToDisplay value is not valid and cannot be converted to a String.")}};var lR=Bp;function Ag(){}Ag.packedLength=h.packedLength;Ag.unpack=h.unpack;Ag.pack=h.pack;var Q5;function yv(e,t){return t[0]==="#"&&(t=Q5+t),ib.fromString(e,t)}function qle(e,t,n){if(c(n.reference))return yv(t,n.reference);if(c(n.velocityReference)){let i=yv(t,n.velocityReference);switch(e){case h:case Ag:return new _v(i,e===Ag);case Ne:return new J5(i)}}throw new ue(`${JSON.stringify(n)} is not valid CZML.`)}function hYe(e,t){return new Hm(function(n,i){return t(e.getValue(n,i))},e.isConstant)}var Ii=new h,Dc=new q5,Qa=new he,ab=new wn,uR=new Ne;function mYe(e){let t=e.rgbaf;if(c(t))return t;let n=e.rgba;if(!c(n))return;let i=n.length;if(i===j.packedLength)return[j.byteToFloat(n[0]),j.byteToFloat(n[1]),j.byteToFloat(n[2]),j.byteToFloat(n[3])];t=new Array(i);for(let o=0;o<i;o+=5)t[o]=n[o],t[o+1]=j.byteToFloat(n[o+1]),t[o+2]=j.byteToFloat(n[o+2]),t[o+3]=j.byteToFloat(n[o+3]),t[o+4]=j.byteToFloat(n[o+4]);return t}function Yle(e,t){let n=y(e.uri,e);return c(t)?t.getDerivedResource({url:n}):De.createIfNeeded(n)}function pYe(e){let t=e.wsen;if(c(t))return t;let n=e.wsenDegrees;if(!c(n))return;let i=n.length;if(i===ae.packedLength)return[R.toRadians(n[0]),R.toRadians(n[1]),R.toRadians(n[2]),R.toRadians(n[3])];t=new Array(i);for(let o=0;o<i;o+=5)t[o]=n[o],t[o+1]=R.toRadians(n[o+1]),t[o+2]=R.toRadians(n[o+2]),t[o+3]=R.toRadians(n[o+3]),t[o+4]=R.toRadians(n[o+4]);return t}function _Ye(e){let t=e.length;if(Dc.magnitude=1,t===2)return Dc.clock=e[0],Dc.cone=e[1],h.fromSpherical(Dc,Ii),[Ii.x,Ii.y,Ii.z];let n=new Array(t/3*4);for(let i=0,o=0;i<t;i+=3,o+=4)n[o]=e[i],Dc.clock=e[i+1],Dc.cone=e[i+2],h.fromSpherical(Dc,Ii),n[o+1]=Ii.x,n[o+2]=Ii.y,n[o+3]=Ii.z;return n}function gYe(e){let t=e.length;if(t===3)return Dc.clock=e[0],Dc.cone=e[1],Dc.magnitude=e[2],h.fromSpherical(Dc,Ii),[Ii.x,Ii.y,Ii.z];let n=new Array(t);for(let i=0;i<t;i+=4)n[i]=e[i],Dc.clock=e[i+1],Dc.cone=e[i+2],Dc.magnitude=e[i+3],h.fromSpherical(Dc,Ii),n[i+1]=Ii.x,n[i+2]=Ii.y,n[i+3]=Ii.z;return n}function yYe(e){let t=e.length;if(t===3)return Qa.longitude=e[0],Qa.latitude=e[1],Qa.height=e[2],ie.default.cartographicToCartesian(Qa,Ii),[Ii.x,Ii.y,Ii.z];let n=new Array(t);for(let i=0;i<t;i+=4)n[i]=e[i],Qa.longitude=e[i+1],Qa.latitude=e[i+2],Qa.height=e[i+3],ie.default.cartographicToCartesian(Qa,Ii),n[i+1]=Ii.x,n[i+2]=Ii.y,n[i+3]=Ii.z;return n}function bYe(e){let t=e.length;if(t===3)return Qa.longitude=R.toRadians(e[0]),Qa.latitude=R.toRadians(e[1]),Qa.height=e[2],ie.default.cartographicToCartesian(Qa,Ii),[Ii.x,Ii.y,Ii.z];let n=new Array(t);for(let i=0;i<t;i+=4)n[i]=e[i],Qa.longitude=R.toRadians(e[i+1]),Qa.latitude=R.toRadians(e[i+2]),Qa.height=e[i+3],ie.default.cartographicToCartesian(Qa,Ii),n[i+1]=Ii.x,n[i+2]=Ii.y,n[i+3]=Ii.z;return n}function e6(e){let t=e.cartesian;if(c(t))return t;let n=e.cartesianVelocity;if(c(n))return n;let i=e.unitCartesian;if(c(i))return i;let o=e.unitSpherical;if(c(o))return _Ye(o);let r=e.spherical;if(c(r))return gYe(r);let s=e.cartographicRadians;if(c(s))return yYe(s);let a=e.cartographicDegrees;if(c(a))return bYe(a);throw new ue(`${JSON.stringify(e)} is not a valid CZML interval.`)}function Xle(e,t){h.unpack(e,t,Ii),h.normalize(Ii,Ii),h.pack(Ii,e,t)}function xYe(e){let t=e6(e);if(t.length===3)return Xle(t,0),t;for(let n=1;n<t.length;n+=4)Xle(t,n);return t}function Kle(e,t){Ne.unpack(e,t,uR),Ne.normalize(uR,uR),Ne.pack(uR,e,t)}function TYe(e){let t=e.unitQuaternion;if(c(t)){if(t.length===4)return Kle(t,0),t;for(let n=1;n<t.length;n+=5)Kle(t,n)}return t}function $le(e){return typeof e=="boolean"?Boolean:typeof e=="number"?Number:typeof e=="string"?String:e.hasOwnProperty("array")?Array:e.hasOwnProperty("boolean")?Boolean:e.hasOwnProperty("boundingRectangle")?Ke:e.hasOwnProperty("cartesian2")?H:e.hasOwnProperty("cartesian")||e.hasOwnProperty("spherical")||e.hasOwnProperty("cartographicRadians")||e.hasOwnProperty("cartographicDegrees")?h:e.hasOwnProperty("unitCartesian")||e.hasOwnProperty("unitSpherical")?Ag:e.hasOwnProperty("rgba")||e.hasOwnProperty("rgbaf")?j:e.hasOwnProperty("arcType")?Yt:e.hasOwnProperty("classificationType")?Vn:e.hasOwnProperty("colorBlendMode")?ol:e.hasOwnProperty("cornerType")?ki:e.hasOwnProperty("heightReference")?$e:e.hasOwnProperty("horizontalOrigin")?bi:e.hasOwnProperty("date")?J:e.hasOwnProperty("labelStyle")?ir:e.hasOwnProperty("number")?Number:e.hasOwnProperty("nearFarScalar")?Vt:e.hasOwnProperty("distanceDisplayCondition")?Bt:e.hasOwnProperty("object")||e.hasOwnProperty("value")?Object:e.hasOwnProperty("unitQuaternion")?Ne:e.hasOwnProperty("shadowMode")?En:e.hasOwnProperty("string")?String:e.hasOwnProperty("stripeOrientation")?Fp:e.hasOwnProperty("wsen")||e.hasOwnProperty("wsenDegrees")?ae:e.hasOwnProperty("uri")?xv.default:e.hasOwnProperty("verticalOrigin")?Ln:Object}function AYe(e,t,n){switch(e){case Yt:return Yt[y(t.arcType,t)];case Array:return t.array;case Boolean:return y(t.boolean,t);case Ke:return t.boundingRectangle;case H:return t.cartesian2;case h:return e6(t);case Ag:return xYe(t);case j:return mYe(t);case Vn:return Vn[y(t.classificationType,t)];case ol:return ol[y(t.colorBlendMode,t)];case ki:return ki[y(t.cornerType,t)];case $e:return $e[y(t.heightReference,t)];case bi:return bi[y(t.horizontalOrigin,t)];case Image:return Yle(t,n);case J:return J.fromIso8601(y(t.date,t));case ir:return ir[y(t.labelStyle,t)];case Number:return y(t.number,t);case Vt:return t.nearFarScalar;case Bt:return t.distanceDisplayCondition;case Object:return y(y(t.object,t.value),t);case Ne:return TYe(t);case Rh:return y(t.number,t);case lR:return lR[y(t.portionToDisplay,t)];case En:return En[y(y(t.shadowMode,t.shadows),t)];case String:return y(t.string,t);case Fp:return Fp[y(t.stripeOrientation,t)];case ae:return pYe(t);case xv.default:return Yle(t,n);case Ln:return Ln[y(t.verticalOrigin,t)];default:throw new ue(`Unknown CzmlDataSource interval type: ${e}`)}}var CYe={HERMITE:H5,LAGRANGE:j5,LINEAR:pv};function fR(e,t){let n=e.interpolationAlgorithm,i=e.interpolationDegree;(c(n)||c(i))&&t.setInterpolationOptions({interpolationAlgorithm:CYe[n],interpolationDegree:i});let o=e.forwardExtrapolationType;c(o)&&(t.forwardExtrapolationType=gd[o]);let r=e.forwardExtrapolationDuration;c(r)&&(t.forwardExtrapolationDuration=r);let s=e.backwardExtrapolationType;c(s)&&(t.backwardExtrapolationType=gd[s]);let a=e.backwardExtrapolationDuration;c(a)&&(t.backwardExtrapolationDuration=a)}var Zle={iso8601:void 0};function sr(e){if(c(e))return Zle.iso8601=e,wn.fromIso8601(Zle)}function t6(e){let t=je.MAXIMUM_INTERVAL.clone();return t.data=e,t}function Jle(e){let t=new fl;return t.intervals.addInterval(t6(e)),t}function Qle(e){let t=new Ka(e.referenceFrame);return t.intervals.addInterval(t6(e)),t}function dR(e,t,n,i,o,r,s){let a=sr(i.interval);c(o)&&(c(a)?a=wn.intersect(a,o,ab):a=o);let l,u,f,d=!c(i.reference)&&!c(i.velocityReference),p=c(a)&&!a.equals(je.MAXIMUM_INTERVAL);if(i.delete===!0){if(!p){t[n]=void 0;return}return uue(t[n],a)}let g=!1;if(d){if(u=AYe(e,i,r),!c(u))return;l=y(e.packedLength,1),f=y(u.length,1),g=!c(i.array)&&typeof u!="string"&&f>l&&e!==Object}let m=typeof e.unpack=="function"&&e!==Rh;if(!g&&!p){d?t[n]=new Kn(m?e.unpack(u,0):u):t[n]=qle(e,s,i);return}let b=t[n],x,T=i.epoch;if(c(T)&&(x=J.fromIso8601(T)),g&&!p){b instanceof bd||(t[n]=b=new bd(e)),b.addSamplesPackedArray(u,x),fR(i,b);return}let C;if(!g&&p){a=a.clone(),d?a.data=m?e.unpack(u,0):u:a.data=qle(e,s,i),c(b)||(t[n]=b=d?new sb:new fl),d&&b instanceof sb?b.intervals.addInterval(a):b instanceof fl?(d&&(a.data=new Kn(a.data)),b.intervals.addInterval(a)):(t[n]=b=Jle(b),d&&(a.data=new Kn(a.data)),b.intervals.addInterval(a));return}c(b)||(t[n]=b=new fl),b instanceof fl||(t[n]=b=Jle(b));let S=b.intervals;C=S.findInterval(a),(!c(C)||!(C.data instanceof bd))&&(C=a.clone(),C.data=new bd(e),S.addInterval(C)),C.data.addSamplesPackedArray(u,x),fR(i,C.data)}function uue(e,t){if(e instanceof bd){e.removeSamples(t);return}else if(e instanceof sb){e.intervals.removeInterval(t);return}else if(e instanceof fl){let n=e.intervals;for(let i=0;i<n.length;++i){let o=wn.intersect(n.get(i),t,ab);o.isEmpty||uue(o.data,t)}n.removeInterval(t);return}}function ye(e,t,n,i,o,r,s){if(c(i))if(Array.isArray(i))for(let a=0,l=i.length;a<l;++a)dR(e,t,n,i[a],o,r,s);else dR(e,t,n,i,o,r,s)}function eue(e,t,n,i,o,r){let s=sr(n.interval);c(i)&&(c(s)?s=wn.intersect(s,i,ab):s=i);let a=c(n.cartesianVelocity)?1:0,l=h.packedLength*(a+1),u,f,d=!c(n.reference),p=c(s)&&!s.equals(je.MAXIMUM_INTERVAL);if(n.delete===!0){if(!p){e[t]=void 0;return}return fue(e[t],s)}let g,m=!1;if(d&&(c(n.referenceFrame)&&(g=ji[n.referenceFrame]),g=y(g,ji.FIXED),u=e6(n),f=y(u.length,1),m=f>l),!m&&!p){d?e[t]=new Qc(h.unpack(u),g):e[t]=yv(r,n.reference);return}let b=e[t],x,T=n.epoch;if(c(T)&&(x=J.fromIso8601(T)),m&&!p){(!(b instanceof Ja)||c(g)&&b.referenceFrame!==g)&&(e[t]=b=new Ja(g,a)),b.addSamplesPackedArray(u,x),fR(n,b);return}let C;if(!m&&p){s=s.clone(),d?s.data=h.unpack(u):s.data=yv(r,n.reference),c(b)||(d?b=new ob(g):b=new Ka(g),e[t]=b),d&&b instanceof ob&&c(g)&&b.referenceFrame===g?b.intervals.addInterval(s):b instanceof Ka?(d&&(s.data=new Qc(s.data,g)),b.intervals.addInterval(s)):(e[t]=b=Qle(b),d&&(s.data=new Qc(s.data,g)),b.intervals.addInterval(s));return}c(b)?b instanceof Ka||(e[t]=b=Qle(b)):e[t]=b=new Ka(g);let S=b.intervals;C=S.findInterval(s),(!c(C)||!(C.data instanceof Ja)||c(g)&&C.data.referenceFrame!==g)&&(C=s.clone(),C.data=new Ja(g,a),S.addInterval(C)),C.data.addSamplesPackedArray(u,x),fR(n,C.data)}function fue(e,t){if(e instanceof Ja){e.removeSamples(t);return}else if(e instanceof ob){e.intervals.removeInterval(t);return}else if(e instanceof Ka){let n=e.intervals;for(let i=0;i<n.length;++i){let o=wn.intersect(n.get(i),t,ab);o.isEmpty||fue(o.data,t)}n.removeInterval(t);return}}function due(e,t,n,i,o,r){if(c(n))if(Array.isArray(n))for(let s=0,a=n.length;s<a;++s)eue(e,t,n[s],i,o,r);else eue(e,t,n,i,o,r)}function tue(e,t,n,i){c(n.references)?hR(e,t,n.references,n.interval,i,sR,fl):(c(n.cartesian2)?n.array=H.unpackArray(n.cartesian2):c(n.cartesian)&&(n.array=H.unpackArray(n.cartesian)),c(n.array)&&ye(Array,e,t,n,void 0,void 0,i))}function nue(e,t,n,i,o,r){let s=sr(n.interval);c(i)&&(c(s)?s=wn.intersect(s,i,ab):s=i);let a=e[t],l,u;if(c(s)){a instanceof j1||(a=new j1,e[t]=a);let d=a.intervals;u=d.findInterval({start:s.start,stop:s.stop}),c(u)?l=u.data:(u=s.clone(),d.addInterval(u))}else l=a;let f;c(n.solidColor)?(l instanceof Ht||(l=new Ht),f=n.solidColor,ye(j,l,"color",f.color,void 0,void 0,r)):c(n.grid)?(l instanceof nR||(l=new nR),f=n.grid,ye(j,l,"color",f.color,void 0,o,r),ye(Number,l,"cellAlpha",f.cellAlpha,void 0,o,r),ye(H,l,"lineCount",f.lineCount,void 0,o,r),ye(H,l,"lineThickness",f.lineThickness,void 0,o,r),ye(H,l,"lineOffset",f.lineOffset,void 0,o,r)):c(n.image)?(l instanceof Zx||(l=new Zx),f=n.image,ye(Image,l,"image",f.image,void 0,o,r),ye(H,l,"repeat",f.repeat,void 0,o,r),ye(j,l,"color",f.color,void 0,o,r),ye(Boolean,l,"transparent",f.transparent,void 0,o,r)):c(n.stripe)?(l instanceof cR||(l=new cR),f=n.stripe,ye(Fp,l,"orientation",f.orientation,void 0,o,r),ye(j,l,"evenColor",f.evenColor,void 0,o,r),ye(j,l,"oddColor",f.oddColor,void 0,o,r),ye(Number,l,"offset",f.offset,void 0,o,r),ye(Number,l,"repeat",f.repeat,void 0,o,r)):c(n.polylineOutline)?(l instanceof _A||(l=new _A),f=n.polylineOutline,ye(j,l,"color",f.color,void 0,o,r),ye(j,l,"outlineColor",f.outlineColor,void 0,o,r),ye(Number,l,"outlineWidth",f.outlineWidth,void 0,o,r)):c(n.polylineGlow)?(l instanceof rR||(l=new rR),f=n.polylineGlow,ye(j,l,"color",f.color,void 0,o,r),ye(Number,l,"glowPower",f.glowPower,void 0,o,r),ye(Number,l,"taperPower",f.taperPower,void 0,o,r)):c(n.polylineArrow)?(l instanceof iR||(l=new iR),f=n.polylineArrow,ye(j,l,"color",f.color,void 0,void 0,r)):c(n.polylineDash)?(l instanceof oR||(l=new oR),f=n.polylineDash,ye(j,l,"color",f.color,void 0,void 0,r),ye(j,l,"gapColor",f.gapColor,void 0,void 0,r),ye(Number,l,"dashLength",f.dashLength,void 0,o,r),ye(Number,l,"dashPattern",f.dashPattern,void 0,o,r)):c(n.checkerboard)&&(l instanceof z1||(l=new z1),f=n.checkerboard,ye(j,l,"evenColor",f.evenColor,void 0,o,r),ye(j,l,"oddColor",f.oddColor,void 0,o,r),ye(H,l,"repeat",f.repeat,void 0,o,r)),c(u)?u.data=l:e[t]=l}function Kl(e,t,n,i,o,r){if(c(n))if(Array.isArray(n))for(let s=0,a=n.length;s<a;++s)nue(e,t,n[s],i,o,r);else nue(e,t,n,i,o,r)}function EYe(e,t,n,i){let o=t.name;c(o)&&(e.name=t.name)}function SYe(e,t,n,i){let o=t.description;c(o)&&ye(String,e,"description",o,void 0,i,n)}function wYe(e,t,n,i){let o=t.position;c(o)&&due(e,"position",o,void 0,i,n)}function vYe(e,t,n,i){let o=t.viewFrom;c(o)&&ye(h,e,"viewFrom",o,void 0,i,n)}function DYe(e,t,n,i){let o=t.orientation;c(o)&&ye(Ne,e,"orientation",o,void 0,i,n)}function PYe(e,t,n,i){let o=t.properties;if(c(o)){c(e.properties)||(e.properties=new Vu);for(let r in o)if(o.hasOwnProperty(r)){e.properties.hasProperty(r)||e.properties.addProperty(r);let s=o[r];if(Array.isArray(s))for(let a=0,l=s.length;a<l;++a)dR($le(s[a]),e.properties,r,s[a],void 0,i,n);else dR($le(s),e.properties,r,s,void 0,i,n)}}}function hR(e,t,n,i,o,r,s){let a=n.map(function(l){return yv(o,l)});if(c(i)){i=sr(i);let l=e[t];if(!(l instanceof s)){let u=new s;u.intervals.addInterval(t6(l)),e[t]=l=u}i.data=new r(a),l.intervals.addInterval(i)}else e[t]=new r(a)}function iue(e,t,n,i){let o=n.references;c(o)?hR(e,t,o,n.interval,i,sR,fl):ye(Array,e,t,n,void 0,void 0,i)}function oue(e,t,n,i){if(c(n))if(Array.isArray(n))for(let o=0,r=n.length;o<r;++o)iue(e,t,n[o],i);else iue(e,t,n,i)}function rue(e,t,n,i){let o=n.references;c(o)?hR(e,t,o,n.interval,i,tb,Ka):(c(n.cartesian)?n.array=h.unpackArray(n.cartesian):c(n.cartographicRadians)?n.array=h.fromRadiansArrayHeights(n.cartographicRadians,ie.default):c(n.cartographicDegrees)&&(n.array=h.fromDegreesArrayHeights(n.cartographicDegrees,ie.default)),c(n.array)&&ye(Array,e,t,n,void 0,void 0,i))}function Tv(e,t,n,i){if(c(n))if(Array.isArray(n))for(let o=0,r=n.length;o<r;++o)rue(e,t,n[o],i);else rue(e,t,n,i)}function IYe(e){return h.unpackArray(e)}function OYe(e){return h.fromRadiansArrayHeights(e,ie.default)}function RYe(e){return h.fromDegreesArrayHeights(e,ie.default)}function sue(e,t,n,i){let o=n.references;if(c(o)){let r=o.map(function(s){let a={};return hR(a,"positions",s,n.interval,i,tb,Ka),a.positions});e[t]=new tb(r)}else c(n.cartesian)?n.array=n.cartesian.map(IYe):c(n.cartographicRadians)?n.array=n.cartographicRadians.map(OYe):c(n.cartographicDegrees)&&(n.array=n.cartographicDegrees.map(RYe)),c(n.array)&&ye(Array,e,t,n,void 0,void 0,i)}function MYe(e,t,n,i){if(c(n))if(Array.isArray(n))for(let o=0,r=n.length;o<r;++o)sue(e,t,n[o],i);else sue(e,t,n,i)}function LYe(e,t,n,i){if(c(n))if(Array.isArray(n))for(let o=0,r=n.length;o<r;o++)tue(e,t,n[o],i);else tue(e,t,n,i)}function NYe(e,t,n,i){let o=t.availability;if(!c(o))return;let r;if(Array.isArray(o))for(let s=0,a=o.length;s<a;++s)c(r)||(r=new ts),r.addInterval(sr(o[s]));else r=new ts,r.addInterval(sr(o));e.availability=r}function FYe(e,t,n,i,o){c(t)&&ye(Ag,e,"alignedAxis",t,n,i,o)}function BYe(e,t,n,i){let o=t.billboard;if(!c(o))return;let r=sr(o.interval),s=e.billboard;c(s)||(e.billboard=s=new Wc),ye(Boolean,s,"show",o.show,r,i,n),ye(Image,s,"image",o.image,r,i,n),ye(Number,s,"scale",o.scale,r,i,n),ye(H,s,"pixelOffset",o.pixelOffset,r,i,n),ye(h,s,"eyeOffset",o.eyeOffset,r,i,n),ye(bi,s,"horizontalOrigin",o.horizontalOrigin,r,i,n),ye(Ln,s,"verticalOrigin",o.verticalOrigin,r,i,n),ye($e,s,"heightReference",o.heightReference,r,i,n),ye(j,s,"color",o.color,r,i,n),ye(Rh,s,"rotation",o.rotation,r,i,n),FYe(s,o.alignedAxis,r,i,n),ye(Boolean,s,"sizeInMeters",o.sizeInMeters,r,i,n),ye(Number,s,"width",o.width,r,i,n),ye(Number,s,"height",o.height,r,i,n),ye(Vt,s,"scaleByDistance",o.scaleByDistance,r,i,n),ye(Vt,s,"translucencyByDistance",o.translucencyByDistance,r,i,n),ye(Vt,s,"pixelOffsetScaleByDistance",o.pixelOffsetScaleByDistance,r,i,n),ye(Ke,s,"imageSubRegion",o.imageSubRegion,r,i,n),ye(Bt,s,"distanceDisplayCondition",o.distanceDisplayCondition,r,i,n),ye(Number,s,"disableDepthTestDistance",o.disableDepthTestDistance,r,i,n)}function kYe(e,t,n,i){let o=t.box;if(!c(o))return;let r=sr(o.interval),s=e.box;c(s)||(e.box=s=new YE),ye(Boolean,s,"show",o.show,r,i,n),ye(h,s,"dimensions",o.dimensions,r,i,n),ye($e,s,"heightReference",o.heightReference,r,i,n),ye(Boolean,s,"fill",o.fill,r,i,n),Kl(s,"material",o.material,r,i,n),ye(Boolean,s,"outline",o.outline,r,i,n),ye(j,s,"outlineColor",o.outlineColor,r,i,n),ye(Number,s,"outlineWidth",o.outlineWidth,r,i,n),ye(En,s,"shadows",o.shadows,r,i,n),ye(Bt,s,"distanceDisplayCondition",o.distanceDisplayCondition,r,i,n)}function VYe(e,t,n,i){let o=t.corridor;if(!c(o))return;let r=sr(o.interval),s=e.corridor;c(s)||(e.corridor=s=new KE),ye(Boolean,s,"show",o.show,r,i,n),Tv(s,"positions",o.positions,n),ye(Number,s,"width",o.width,r,i,n),ye(Number,s,"height",o.height,r,i,n),ye($e,s,"heightReference",o.heightReference,r,i,n),ye(Number,s,"extrudedHeight",o.extrudedHeight,r,i,n),ye($e,s,"extrudedHeightReference",o.extrudedHeightReference,r,i,n),ye(ki,s,"cornerType",o.cornerType,r,i,n),ye(Number,s,"granularity",o.granularity,r,i,n),ye(Boolean,s,"fill",o.fill,r,i,n),Kl(s,"material",o.material,r,i,n),ye(Boolean,s,"outline",o.outline,r,i,n),ye(j,s,"outlineColor",o.outlineColor,r,i,n),ye(Number,s,"outlineWidth",o.outlineWidth,r,i,n),ye(En,s,"shadows",o.shadows,r,i,n),ye(Bt,s,"distanceDisplayCondition",o.distanceDisplayCondition,r,i,n),ye(Vn,s,"classificationType",o.classificationType,r,i,n),ye(Number,s,"zIndex",o.zIndex,r,i,n)}function UYe(e,t,n,i){let o=t.cylinder;if(!c(o))return;let r=sr(o.interval),s=e.cylinder;c(s)||(e.cylinder=s=new ZE),ye(Boolean,s,"show",o.show,r,i,n),ye(Number,s,"length",o.length,r,i,n),ye(Number,s,"topRadius",o.topRadius,r,i,n),ye(Number,s,"bottomRadius",o.bottomRadius,r,i,n),ye($e,s,"heightReference",o.heightReference,r,i,n),ye(Boolean,s,"fill",o.fill,r,i,n),Kl(s,"material",o.material,r,i,n),ye(Boolean,s,"outline",o.outline,r,i,n),ye(j,s,"outlineColor",o.outlineColor,r,i,n),ye(Number,s,"outlineWidth",o.outlineWidth,r,i,n),ye(Number,s,"numberOfVerticalLines",o.numberOfVerticalLines,r,i,n),ye(Number,s,"slices",o.slices,r,i,n),ye(En,s,"shadows",o.shadows,r,i,n),ye(Bt,s,"distanceDisplayCondition",o.distanceDisplayCondition,r,i,n)}function zYe(e,t){let n=e.version;if(c(n)&&typeof n=="string"){let r=n.split(".");if(r.length===2){if(r[0]!=="1")throw new ue("Cesium only supports CZML version 1.");t._version=n}}if(!c(t._version))throw new ue("CZML version information invalid.  It is expected to be a property on the document object in the <Major>.<Minor> version format.");let i=t._documentPacket;c(e.name)&&(i.name=e.name);let o=e.clock;if(c(o)){let r=i.clock;c(r)?(r.interval=y(o.interval,r.interval),r.currentTime=y(o.currentTime,r.currentTime),r.range=y(o.range,r.range),r.step=y(o.step,r.step),r.multiplier=y(o.multiplier,r.multiplier)):i.clock={interval:o.interval,currentTime:o.currentTime,range:o.range,step:o.step,multiplier:o.multiplier}}}function HYe(e,t,n,i){let o=t.ellipse;if(!c(o))return;let r=sr(o.interval),s=e.ellipse;c(s)||(e.ellipse=s=new QE),ye(Boolean,s,"show",o.show,r,i,n),ye(Number,s,"semiMajorAxis",o.semiMajorAxis,r,i,n),ye(Number,s,"semiMinorAxis",o.semiMinorAxis,r,i,n),ye(Number,s,"height",o.height,r,i,n),ye($e,s,"heightReference",o.heightReference,r,i,n),ye(Number,s,"extrudedHeight",o.extrudedHeight,r,i,n),ye($e,s,"extrudedHeightReference",o.extrudedHeightReference,r,i,n),ye(Rh,s,"rotation",o.rotation,r,i,n),ye(Rh,s,"stRotation",o.stRotation,r,i,n),ye(Number,s,"granularity",o.granularity,r,i,n),ye(Boolean,s,"fill",o.fill,r,i,n),Kl(s,"material",o.material,r,i,n),ye(Boolean,s,"outline",o.outline,r,i,n),ye(j,s,"outlineColor",o.outlineColor,r,i,n),ye(Number,s,"outlineWidth",o.outlineWidth,r,i,n),ye(Number,s,"numberOfVerticalLines",o.numberOfVerticalLines,r,i,n),ye(En,s,"shadows",o.shadows,r,i,n),ye(Bt,s,"distanceDisplayCondition",o.distanceDisplayCondition,r,i,n),ye(Vn,s,"classificationType",o.classificationType,r,i,n),ye(Number,s,"zIndex",o.zIndex,r,i,n)}function GYe(e,t,n,i){let o=t.ellipsoid;if(!c(o))return;let r=sr(o.interval),s=e.ellipsoid;c(s)||(e.ellipsoid=s=new tS),ye(Boolean,s,"show",o.show,r,i,n),ye(h,s,"radii",o.radii,r,i,n),ye(h,s,"innerRadii",o.innerRadii,r,i,n),ye(Number,s,"minimumClock",o.minimumClock,r,i,n),ye(Number,s,"maximumClock",o.maximumClock,r,i,n),ye(Number,s,"minimumCone",o.minimumCone,r,i,n),ye(Number,s,"maximumCone",o.maximumCone,r,i,n),ye($e,s,"heightReference",o.heightReference,r,i,n),ye(Boolean,s,"fill",o.fill,r,i,n),Kl(s,"material",o.material,r,i,n),ye(Boolean,s,"outline",o.outline,r,i,n),ye(j,s,"outlineColor",o.outlineColor,r,i,n),ye(Number,s,"outlineWidth",o.outlineWidth,r,i,n),ye(Number,s,"stackPartitions",o.stackPartitions,r,i,n),ye(Number,s,"slicePartitions",o.slicePartitions,r,i,n),ye(Number,s,"subdivisions",o.subdivisions,r,i,n),ye(En,s,"shadows",o.shadows,r,i,n),ye(Bt,s,"distanceDisplayCondition",o.distanceDisplayCondition,r,i,n)}function jYe(e,t,n,i){let o=t.label;if(!c(o))return;let r=sr(o.interval),s=e.label;c(s)||(e.label=s=new km),ye(Boolean,s,"show",o.show,r,i,n),ye(String,s,"text",o.text,r,i,n),ye(String,s,"font",o.font,r,i,n),ye(ir,s,"style",o.style,r,i,n),ye(Number,s,"scale",o.scale,r,i,n),ye(Boolean,s,"showBackground",o.showBackground,r,i,n),ye(j,s,"backgroundColor",o.backgroundColor,r,i,n),ye(H,s,"backgroundPadding",o.backgroundPadding,r,i,n),ye(H,s,"pixelOffset",o.pixelOffset,r,i,n),ye(h,s,"eyeOffset",o.eyeOffset,r,i,n),ye(bi,s,"horizontalOrigin",o.horizontalOrigin,r,i,n),ye(Ln,s,"verticalOrigin",o.verticalOrigin,r,i,n),ye($e,s,"heightReference",o.heightReference,r,i,n),ye(j,s,"fillColor",o.fillColor,r,i,n),ye(j,s,"outlineColor",o.outlineColor,r,i,n),ye(Number,s,"outlineWidth",o.outlineWidth,r,i,n),ye(Vt,s,"translucencyByDistance",o.translucencyByDistance,r,i,n),ye(Vt,s,"pixelOffsetScaleByDistance",o.pixelOffsetScaleByDistance,r,i,n),ye(Vt,s,"scaleByDistance",o.scaleByDistance,r,i,n),ye(Bt,s,"distanceDisplayCondition",o.distanceDisplayCondition,r,i,n),ye(Number,s,"disableDepthTestDistance",o.disableDepthTestDistance,r,i,n)}function WYe(e,t,n,i){let o=t.model;if(!c(o))return;let r=sr(o.interval),s=e.model;c(s)||(e.model=s=new Jy),ye(Boolean,s,"show",o.show,r,i,n),ye(xv.default,s,"uri",o.gltf,r,i,n),ye(Number,s,"scale",o.scale,r,i,n),ye(Number,s,"minimumPixelSize",o.minimumPixelSize,r,i,n),ye(Number,s,"maximumScale",o.maximumScale,r,i,n),ye(Boolean,s,"incrementallyLoadTextures",o.incrementallyLoadTextures,r,i,n),ye(Boolean,s,"runAnimations",o.runAnimations,r,i,n),ye(Boolean,s,"clampAnimations",o.clampAnimations,r,i,n),ye(En,s,"shadows",o.shadows,r,i,n),ye($e,s,"heightReference",o.heightReference,r,i,n),ye(j,s,"silhouetteColor",o.silhouetteColor,r,i,n),ye(Number,s,"silhouetteSize",o.silhouetteSize,r,i,n),ye(j,s,"color",o.color,r,i,n),ye(ol,s,"colorBlendMode",o.colorBlendMode,r,i,n),ye(Number,s,"colorBlendAmount",o.colorBlendAmount,r,i,n),ye(Bt,s,"distanceDisplayCondition",o.distanceDisplayCondition,r,i,n);let a,l,u=o.nodeTransformations;if(c(u))if(Array.isArray(u))for(a=0,l=u.length;a<l;++a)aue(s,u[a],r,i,n);else aue(s,u,r,i,n);let f=o.articulations;if(c(f))if(Array.isArray(f))for(a=0,l=f.length;a<l;++a)cue(s,f[a],r,i,n);else cue(s,f,r,i,n)}function aue(e,t,n,i,o){let r=sr(t.interval);c(n)&&(c(r)?r=wn.intersect(r,n,ab):r=n);let s=e.nodeTransformations,a=Object.keys(t);for(let l=0,u=a.length;l<u;++l){let f=a[l];if(f==="interval")continue;let d=t[f];if(!c(d))continue;c(s)||(e.nodeTransformations=s=new Vu),s.hasProperty(f)||s.addProperty(f);let p=s[f];c(p)||(s[f]=p=new oS),ye(h,p,"translation",d.translation,r,i,o),ye(Ne,p,"rotation",d.rotation,r,i,o),ye(h,p,"scale",d.scale,r,i,o)}}function cue(e,t,n,i,o){let r=sr(t.interval);c(n)&&(c(r)?r=wn.intersect(r,n,ab):r=n);let s=e.articulations,a=Object.keys(t);for(let l=0,u=a.length;l<u;++l){let f=a[l];if(f==="interval")continue;let d=t[f];c(d)&&(c(s)||(e.articulations=s=new Vu),s.hasProperty(f)||s.addProperty(f),ye(Number,s,f,d,r,i,o))}}function qYe(e,t,n,i){let o=t.path;if(!c(o))return;let r=sr(o.interval),s=e.path;c(s)||(e.path=s=new Qy),ye(Boolean,s,"show",o.show,r,i,n),ye(Number,s,"leadTime",o.leadTime,r,i,n),ye(Number,s,"trailTime",o.trailTime,r,i,n),ye(Number,s,"width",o.width,r,i,n),ye(Number,s,"resolution",o.resolution,r,i,n),Kl(s,"material",o.material,r,i,n),ye(Bt,s,"distanceDisplayCondition",o.distanceDisplayCondition,r,i,n)}function YYe(e,t,n,i){let o=t.point;if(!c(o))return;let r=sr(o.interval),s=e.point;c(s)||(e.point=s=new fS),ye(Boolean,s,"show",o.show,r,i,n),ye(Number,s,"pixelSize",o.pixelSize,r,i,n),ye($e,s,"heightReference",o.heightReference,r,i,n),ye(j,s,"color",o.color,r,i,n),ye(j,s,"outlineColor",o.outlineColor,r,i,n),ye(Number,s,"outlineWidth",o.outlineWidth,r,i,n),ye(Vt,s,"scaleByDistance",o.scaleByDistance,r,i,n),ye(Vt,s,"translucencyByDistance",o.translucencyByDistance,r,i,n),ye(Bt,s,"distanceDisplayCondition",o.distanceDisplayCondition,r,i,n),ye(Number,s,"disableDepthTestDistance",o.disableDepthTestDistance,r,i,n)}function bv(e){this.polygon=e,this._definitionChanged=new pe}Object.defineProperties(bv.prototype,{isConstant:{get:function(){let e=this.polygon._positions,t=this.polygon._holes;return(!c(e)||e.isConstant)&&(!c(t)||t.isConstant)}},definitionChanged:{get:function(){return this._definitionChanged}}});bv.prototype.getValue=function(e,t){let n;c(this.polygon._positions)&&(n=this.polygon._positions.getValue(e));let i;return c(this.polygon._holes)&&(i=this.polygon._holes.getValue(e),c(i)&&(i=i.map(function(o){return new _c(o)}))),c(t)?(t.positions=n,t.holes=i,t):new _c(n,i)};bv.prototype.equals=function(e){return this===e||e instanceof bv&&X.equals(this.polygon._positions,e.polygon._positions)&&X.equals(this.polygon._holes,e.polygon._holes)};function XYe(e,t,n,i){let o=t.polygon;if(!c(o))return;let r=sr(o.interval),s=e.polygon;c(s)||(e.polygon=s=new Um),ye(Boolean,s,"show",o.show,r,i,n),Tv(s,"_positions",o.positions,n),MYe(s,"_holes",o.holes,n),(c(s._positions)||c(s._holes))&&(s.hierarchy=new bv(s)),ye(Number,s,"height",o.height,r,i,n),ye($e,s,"heightReference",o.heightReference,r,i,n),ye(Number,s,"extrudedHeight",o.extrudedHeight,r,i,n),ye($e,s,"extrudedHeightReference",o.extrudedHeightReference,r,i,n),ye(Rh,s,"stRotation",o.stRotation,r,i,n),ye(Number,s,"granularity",o.granularity,r,i,n),ye(Boolean,s,"fill",o.fill,r,i,n),Kl(s,"material",o.material,r,i,n),ye(Boolean,s,"outline",o.outline,r,i,n),ye(j,s,"outlineColor",o.outlineColor,r,i,n),ye(Number,s,"outlineWidth",o.outlineWidth,r,i,n),ye(Boolean,s,"perPositionHeight",o.perPositionHeight,r,i,n),ye(Boolean,s,"closeTop",o.closeTop,r,i,n),ye(Boolean,s,"closeBottom",o.closeBottom,r,i,n),ye(Yt,s,"arcType",o.arcType,r,i,n),ye(En,s,"shadows",o.shadows,r,i,n),ye(Bt,s,"distanceDisplayCondition",o.distanceDisplayCondition,r,i,n),ye(Vn,s,"classificationType",o.classificationType,r,i,n),ye(Number,s,"zIndex",o.zIndex,r,i,n)}function KYe(e){return e?Yt.GEODESIC:Yt.NONE}function $Ye(e,t,n,i){let o=t.polyline;if(!c(o))return;let r=sr(o.interval),s=e.polyline;if(c(s)||(e.polyline=s=new el),ye(Boolean,s,"show",o.show,r,i,n),Tv(s,"positions",o.positions,n),ye(Number,s,"width",o.width,r,i,n),ye(Number,s,"granularity",o.granularity,r,i,n),Kl(s,"material",o.material,r,i,n),Kl(s,"depthFailMaterial",o.depthFailMaterial,r,i,n),ye(Yt,s,"arcType",o.arcType,r,i,n),ye(Boolean,s,"clampToGround",o.clampToGround,r,i,n),ye(En,s,"shadows",o.shadows,r,i,n),ye(Bt,s,"distanceDisplayCondition",o.distanceDisplayCondition,r,i,n),ye(Vn,s,"classificationType",o.classificationType,r,i,n),ye(Number,s,"zIndex",o.zIndex,r,i,n),c(o.followSurface)&&!c(o.arcType)){let a={};ye(Boolean,a,"followSurface",o.followSurface,r,i,n),s.arcType=hYe(a.followSurface,KYe)}}function ZYe(e,t,n,i){let o=t.polylineVolume;if(!c(o))return;let r=sr(o.interval),s=e.polylineVolume;c(s)||(e.polylineVolume=s=new pS),Tv(s,"positions",o.positions,n),LYe(s,"shape",o.shape,n),ye(Boolean,s,"show",o.show,r,i,n),ye(ki,s,"cornerType",o.cornerType,r,i,n),ye(Boolean,s,"fill",o.fill,r,i,n),Kl(s,"material",o.material,r,i,n),ye(Boolean,s,"outline",o.outline,r,i,n),ye(j,s,"outlineColor",o.outlineColor,r,i,n),ye(Number,s,"outlineWidth",o.outlineWidth,r,i,n),ye(Number,s,"granularity",o.granularity,r,i,n),ye(En,s,"shadows",o.shadows,r,i,n),ye(Bt,s,"distanceDisplayCondition",o.distanceDisplayCondition,r,i,n)}function JYe(e,t,n,i){let o=t.rectangle;if(!c(o))return;let r=sr(o.interval),s=e.rectangle;c(s)||(e.rectangle=s=new zm),ye(Boolean,s,"show",o.show,r,i,n),ye(ae,s,"coordinates",o.coordinates,r,i,n),ye(Number,s,"height",o.height,r,i,n),ye($e,s,"heightReference",o.heightReference,r,i,n),ye(Number,s,"extrudedHeight",o.extrudedHeight,r,i,n),ye($e,s,"extrudedHeightReference",o.extrudedHeightReference,r,i,n),ye(Rh,s,"rotation",o.rotation,r,i,n),ye(Rh,s,"stRotation",o.stRotation,r,i,n),ye(Number,s,"granularity",o.granularity,r,i,n),ye(Boolean,s,"fill",o.fill,r,i,n),Kl(s,"material",o.material,r,i,n),ye(Boolean,s,"outline",o.outline,r,i,n),ye(j,s,"outlineColor",o.outlineColor,r,i,n),ye(Number,s,"outlineWidth",o.outlineWidth,r,i,n),ye(En,s,"shadows",o.shadows,r,i,n),ye(Bt,s,"distanceDisplayCondition",o.distanceDisplayCondition,r,i,n),ye(Vn,s,"classificationType",o.classificationType,r,i,n),ye(Number,s,"zIndex",o.zIndex,r,i,n)}function QYe(e,t,n,i){let o=t.tileset;if(!c(o))return;let r=sr(o.interval),s=e.tileset;c(s)||(e.tileset=s=new aS),ye(Boolean,s,"show",o.show,r,i,n),ye(xv.default,s,"uri",o.uri,r,i,n),ye(Number,s,"maximumScreenSpaceError",o.maximumScreenSpaceError,r,i,n)}function eXe(e,t,n,i){let o=t.wall;if(!c(o))return;let r=sr(o.interval),s=e.wall;c(s)||(e.wall=s=new e0),ye(Boolean,s,"show",o.show,r,i,n),Tv(s,"positions",o.positions,n),oue(s,"minimumHeights",o.minimumHeights,n),oue(s,"maximumHeights",o.maximumHeights,n),ye(Number,s,"granularity",o.granularity,r,i,n),ye(Boolean,s,"fill",o.fill,r,i,n),Kl(s,"material",o.material,r,i,n),ye(Boolean,s,"outline",o.outline,r,i,n),ye(j,s,"outlineColor",o.outlineColor,r,i,n),ye(Number,s,"outlineWidth",o.outlineWidth,r,i,n),ye(En,s,"shadows",o.shadows,r,i,n),ye(Bt,s,"distanceDisplayCondition",o.distanceDisplayCondition,r,i,n)}function lue(e,t,n,i,o){let r=e.id;if(c(r)||(r=Hn()),Q5=r,!c(o._version)&&r!=="document")throw new ue("The first CZML packet is required to be the document object.");if(e.delete===!0)t.removeById(r);else if(r==="document")zYe(e,o);else{let s=t.getOrCreateEntity(r),a=e.parent;c(a)&&(s.parent=t.getOrCreateEntity(a));for(let l=n.length-1;l>-1;l--)n[l](s,e,t,i)}Q5=void 0}function tXe(e){let t,n=e._documentPacket.clock;if(!c(n)){if(!c(e._clock)){let o=e._entityCollection.computeAvailability();if(!o.start.equals(je.MINIMUM_VALUE)){let r=o.start,s=o.stop,a=J.secondsDifference(s,r),l=Math.round(a/120);return t=new Lp,t.startTime=J.clone(r),t.stopTime=J.clone(s),t.clockRange=jr.LOOP_STOP,t.multiplier=l,t.currentTime=J.clone(r),t.clockStep=ho.SYSTEM_CLOCK_MULTIPLIER,e._clock=t,!0}}return!1}c(e._clock)?t=e._clock.clone():(t=new Lp,t.startTime=je.MINIMUM_VALUE.clone(),t.stopTime=je.MAXIMUM_VALUE.clone(),t.currentTime=je.MINIMUM_VALUE.clone(),t.clockRange=jr.LOOP_STOP,t.clockStep=ho.SYSTEM_CLOCK_MULTIPLIER,t.multiplier=1);let i=sr(n.interval);return c(i)&&(t.startTime=i.start,t.stopTime=i.stop),c(n.currentTime)&&(t.currentTime=J.fromIso8601(n.currentTime)),c(n.range)&&(t.clockRange=y(jr[n.range],jr.LOOP_STOP)),c(n.step)&&(t.clockStep=y(ho[n.step],ho.SYSTEM_CLOCK_MULTIPLIER)),c(n.multiplier)&&(t.multiplier=n.multiplier),t.equals(e._clock)?!1:(e._clock=t.clone(e._clock),!0)}function hue(e,t,n,i){if(!c(t))throw new E("czml is required.");n=y(n,y.EMPTY_OBJECT);let o=t,r=n.sourceUri,s=n.credit;if(typeof s=="string"&&(s=new Pt(s)),e._credit=s,typeof t=="string"||t instanceof De){t=De.createIfNeeded(t),o=t.fetchJson(),r=y(r,t.clone());let a=e._resourceCredits,l=t.credits;if(c(l)){let u=l.length;for(let f=0;f<u;f++)a.push(l[f])}}return r=De.createIfNeeded(r),ns.setLoading(e,!0),Promise.resolve(o).then(function(a){return nXe(e,a,r,i)}).catch(function(a){return ns.setLoading(e,!1),e._error.raiseEvent(e,a),console.log(a),Promise.reject(a)})}function nXe(e,t,n,i){ns.setLoading(e,!0);let o=e._entityCollection;i&&(e._version=void 0,e._documentPacket=new mue,o.removeAll()),is._processCzml(t,o,n,void 0,e);let r=tXe(e),s=e._documentPacket;return c(s.name)&&e._name!==s.name?(e._name=s.name,r=!0):!c(e._name)&&c(n)&&(e._name=Q0(n.getUrlComponent()),r=!0),ns.setLoading(e,!1),r&&e._changed.raiseEvent(e),e}function mue(){this.name=void 0,this.clock=void 0}function is(e){this._name=e,this._changed=new pe,this._error=new pe,this._isLoading=!1,this._loading=new pe,this._clock=void 0,this._documentPacket=new mue,this._version=void 0,this._entityCollection=new _a(this),this._entityCluster=new _d,this._credit=void 0,this._resourceCredits=[]}is.load=function(e,t){return new is().load(e,t)};Object.defineProperties(is.prototype,{name:{get:function(){return this._name}},clock:{get:function(){return this._clock}},entities:{get:function(){return this._entityCollection}},isLoading:{get:function(){return this._isLoading}},changedEvent:{get:function(){return this._changed}},errorEvent:{get:function(){return this._error}},loadingEvent:{get:function(){return this._loading}},show:{get:function(){return this._entityCollection.show},set:function(e){this._entityCollection.show=e}},clustering:{get:function(){return this._entityCluster},set:function(e){if(!c(e))throw new E("value must be defined.");this._entityCluster=e}},credit:{get:function(){return this._credit}}});is.updaters=[BYe,kYe,VYe,UYe,HYe,GYe,jYe,WYe,EYe,SYe,qYe,YYe,XYe,$Ye,ZYe,PYe,JYe,wYe,QYe,vYe,eXe,DYe,NYe];is.registerUpdater=function(e){is.updaters.includes(e)||is.updaters.push(e)};is.unregisterUpdater=function(e){if(is.updaters.includes(e)){let t=is.updaters.indexOf(e);is.updaters.splice(t,1)}};is.prototype.process=function(e,t){return hue(this,e,t,!1)};is.prototype.load=function(e,t){return hue(this,e,t,!0)};is.prototype.update=function(e){return!0};is.processPacketData=ye;is.processPositionPacketData=due;is.processMaterialPacketData=Kl;is._processCzml=function(e,t,n,i,o){if(i=y(i,is.updaters),Array.isArray(e))for(let r=0,s=e.length;r<s;++r)lue(e[r],t,i,n,o);else lue(e,t,i,n,o)};var mR=is;function Pc(){this._dataSources=[],this._dataSourceAdded=new pe,this._dataSourceRemoved=new pe,this._dataSourceMoved=new pe}Object.defineProperties(Pc.prototype,{length:{get:function(){return this._dataSources.length}},dataSourceAdded:{get:function(){return this._dataSourceAdded}},dataSourceRemoved:{get:function(){return this._dataSourceRemoved}},dataSourceMoved:{get:function(){return this._dataSourceMoved}}});Pc.prototype.add=function(e){if(!c(e))throw new E("dataSource is required.");let t=this,n=this._dataSources;return Promise.resolve(e).then(function(i){return n===t._dataSources&&(t._dataSources.push(i),t._dataSourceAdded.raiseEvent(t,i)),i})};Pc.prototype.remove=function(e,t){t=y(t,!1);let n=this._dataSources.indexOf(e);return n!==-1?(this._dataSources.splice(n,1),this._dataSourceRemoved.raiseEvent(this,e),t&&typeof e.destroy=="function"&&e.destroy(),!0):!1};Pc.prototype.removeAll=function(e){e=y(e,!1);let t=this._dataSources;for(let n=0,i=t.length;n<i;++n){let o=t[n];this._dataSourceRemoved.raiseEvent(this,o),e&&typeof o.destroy=="function"&&o.destroy()}this._dataSources=[]};Pc.prototype.contains=function(e){return this.indexOf(e)!==-1};Pc.prototype.indexOf=function(e){return this._dataSources.indexOf(e)};Pc.prototype.get=function(e){if(!c(e))throw new E("index is required.");return this._dataSources[e]};Pc.prototype.getByName=function(e){if(!c(e))throw new E("name is required.");return this._dataSources.filter(function(t){return t.name===e})};function pR(e,t){if(!c(t))throw new E("dataSource is required.");let n=e.indexOf(t);if(n===-1)throw new E("dataSource is not in this collection.");return n}function pue(e,t,n){let i=e._dataSources,o=i.length-1;if(t=R.clamp(t,0,o),n=R.clamp(n,0,o),t===n)return;let r=i[t];i[t]=i[n],i[n]=r,e.dataSourceMoved.raiseEvent(r,n,t)}Pc.prototype.raise=function(e){let t=pR(this._dataSources,e);pue(this,t,t+1)};Pc.prototype.lower=function(e){let t=pR(this._dataSources,e);pue(this,t,t-1)};Pc.prototype.raiseToTop=function(e){let t=pR(this._dataSources,e);t!==this._dataSources.length-1&&(this._dataSources.splice(t,1),this._dataSources.push(e),this.dataSourceMoved.raiseEvent(e,this._dataSources.length-1,t))};Pc.prototype.lowerToBottom=function(e){let t=pR(this._dataSources,e);t!==0&&(this._dataSources.splice(t,1),this._dataSources.splice(0,0,e),this.dataSourceMoved.raiseEvent(e,0,t))};Pc.prototype.isDestroyed=function(){return!1};Pc.prototype.destroy=function(){return this.removeAll(!0),de(this)};var n6=Pc;function ta(e){e=y(e,y.EMPTY_OBJECT),this._primitives=[],this._guid=Hn(),this._primitiveAdded=new pe,this._primitiveRemoved=new pe,this._zIndex=void 0,this.show=y(e.show,!0),this.destroyPrimitives=y(e.destroyPrimitives,!0)}Object.defineProperties(ta.prototype,{length:{get:function(){return this._primitives.length}},primitiveAdded:{get:function(){return this._primitiveAdded}},primitiveRemoved:{get:function(){return this._primitiveRemoved}}});ta.prototype.add=function(e,t){let n=c(t);if(!c(e))throw new E("primitive is required.");if(n){if(t<0)throw new E("index must be greater than or equal to zero.");if(t>this._primitives.length)throw new E("index must be less than or equal to the number of primitives.")}let i=e._external=e._external||{},o=i._composites=i._composites||{};return o[this._guid]={collection:this},n?this._primitives.splice(t,0,e):this._primitives.push(e),this._primitiveAdded.raiseEvent(e),e};ta.prototype.remove=function(e){if(this.contains(e)){let t=this._primitives.indexOf(e);if(t!==-1)return this._primitives.splice(t,1),delete e._external._composites[this._guid],this.destroyPrimitives&&e.destroy(),this._primitiveRemoved.raiseEvent(e),!0}return!1};ta.prototype.removeAndDestroy=function(e){let t=this.remove(e);return t&&!this.destroyPrimitives&&e.destroy(),t};ta.prototype.removeAll=function(){let e=this._primitives,t=e.length;for(let n=0;n<t;++n)delete e[n]._external._composites[this._guid],this.destroyPrimitives&&e[n].destroy(),this._primitiveRemoved.raiseEvent(e[n]);this._primitives=[]};ta.prototype.contains=function(e){return!!(c(e)&&e._external&&e._external._composites&&e._external._composites[this._guid])};function _R(e,t){if(!e.contains(t))throw new E("primitive is not in this collection.");return e._primitives.indexOf(t)}ta.prototype.raise=function(e){if(c(e)){let t=_R(this,e),n=this._primitives;if(t!==n.length-1){let i=n[t];n[t]=n[t+1],n[t+1]=i}}};ta.prototype.raiseToTop=function(e){if(c(e)){let t=_R(this,e),n=this._primitives;t!==n.length-1&&(n.splice(t,1),n.push(e))}};ta.prototype.lower=function(e){if(c(e)){let t=_R(this,e),n=this._primitives;if(t!==0){let i=n[t];n[t]=n[t-1],n[t-1]=i}}};ta.prototype.lowerToBottom=function(e){if(c(e)){let t=_R(this,e),n=this._primitives;t!==0&&(n.splice(t,1),n.unshift(e))}};ta.prototype.get=function(e){if(!c(e))throw new E("index is required.");return this._primitives[e]};ta.prototype.update=function(e){if(!this.show)return;let t=this._primitives;for(let n=0;n<t.length;++n)t[n].update(e)};ta.prototype.prePassesUpdate=function(e){let t=this._primitives;for(let n=0;n<t.length;++n){let i=t[n];c(i.prePassesUpdate)&&i.prePassesUpdate(e)}};ta.prototype.updateForPass=function(e,t){let n=this._primitives;for(let i=0;i<n.length;++i){let o=n[i];c(o.updateForPass)&&o.updateForPass(e,t)}};ta.prototype.postPassesUpdate=function(e){let t=this._primitives;for(let n=0;n<t.length;++n){let i=t[n];c(i.postPassesUpdate)&&i.postPassesUpdate(e)}};ta.prototype.isDestroyed=function(){return!1};ta.prototype.destroy=function(){return this.removeAll(),de(this)};var mf=ta;function Mh(){this._length=0,this._collections={},this._collectionsArray=[],this.show=!0}Object.defineProperties(Mh.prototype,{length:{get:function(){return this._length}}});Mh.prototype.add=function(e,t){A.defined("primitive",e),c(t)&&A.typeOf.number("zIndex",t),t=y(t,0);let n=this._collections[t];if(!c(n)){n=new mf({destroyPrimitives:!1}),n._zIndex=t,this._collections[t]=n;let i=this._collectionsArray,o=0;for(;o<i.length&&i[o]._zIndex<t;)o++;i.splice(o,0,n)}return n.add(e),this._length++,e._zIndex=t,e};Mh.prototype.set=function(e,t){return A.defined("primitive",e),A.typeOf.number("zIndex",t),t===e._zIndex||(this.remove(e,!0),this.add(e,t)),e};Mh.prototype.remove=function(e,t){if(this.contains(e)){let n=e._zIndex,i=this._collections[n],o;return t?o=i.remove(e):o=i.removeAndDestroy(e),o&&this._length--,i.length===0&&(this._collectionsArray.splice(this._collectionsArray.indexOf(i),1),this._collections[n]=void 0,i.destroy()),o}return!1};Mh.prototype.removeAll=function(){let e=this._collectionsArray;for(let t=0;t<e.length;t++){let n=e[t];n.destroyPrimitives=!0,n.destroy()}this._collections={},this._collectionsArray=[],this._length=0};Mh.prototype.contains=function(e){if(!c(e))return!1;let t=this._collections[e._zIndex];return c(t)&&t.contains(e)};Mh.prototype.update=function(e){if(!this.show)return;let t=this._collectionsArray;for(let n=0;n<t.length;n++)t[n].update(e)};Mh.prototype.isDestroyed=function(){return!1};Mh.prototype.destroy=function(){return this.removeAll(),de(this)};var i6=Mh;function bA(e,t){this._primitives=e,this._orderedGroundPrimitives=t,this._dynamicUpdaters=new St}bA.prototype.add=function(e,t){this._dynamicUpdaters.set(t.id,t.createDynamicUpdater(this._primitives,this._orderedGroundPrimitives))};bA.prototype.remove=function(e){let t=e.id,n=this._dynamicUpdaters.get(t);c(n)&&(this._dynamicUpdaters.remove(t),n.destroy())};bA.prototype.update=function(e){let t=this._dynamicUpdaters.values;for(let n=0,i=t.length;n<i;n++)t[n].update(e);return!0};bA.prototype.removeAllPrimitives=function(){let e=this._dynamicUpdaters.values;for(let t=0,n=e.length;t<n;t++)e[t].destroy();this._dynamicUpdaters.removeAll()};bA.prototype.getBoundingSphere=function(e,t){return e=this._dynamicUpdaters.get(e.id),c(e)&&c(e.getBoundingSphere)?e.getBoundingSphere(t):ct.FAILED};var Av=bA;var r6={},gR=new h,_ue=new h,gue=new Ne,yue=new Q;function xA(e,t,n,i,o,r,s,a,l,u){let f=e+t;h.multiplyByScalar(i,Math.cos(f),gR),h.multiplyByScalar(n,Math.sin(f),_ue),h.add(gR,_ue,gR);let d=Math.cos(e);d=d*d;let p=Math.sin(e);p=p*p;let m=r/Math.sqrt(s*d+o*p)/a;return Ne.fromAxisAngle(gR,m,gue),Q.fromQuaternion(gue,yue),Q.multiplyByVector(yue,l,u),h.normalize(u,u),h.multiplyByScalar(u,a,u),u}var bue=new h,xue=new h,o6=new h,iXe=new h;r6.raisePositionsToHeight=function(e,t,n){let i=t.ellipsoid,o=t.height,r=t.extrudedHeight,s=n?e.length/3*2:e.length/3,a=new Float64Array(s*3),l=e.length,u=n?l:0;for(let f=0;f<l;f+=3){let d=f+1,p=f+2,g=h.fromArray(e,f,bue);i.scaleToGeodeticSurface(g,g);let m=h.clone(g,xue),b=i.geodeticSurfaceNormal(g,iXe),x=h.multiplyByScalar(b,o,o6);h.add(g,x,g),n&&(h.multiplyByScalar(b,r,x),h.add(m,x,m),a[f+u]=m.x,a[d+u]=m.y,a[p+u]=m.z),a[f]=g.x,a[d]=g.y,a[p]=g.z}return a};var oXe=new h,rXe=new h,sXe=new h;r6.computeEllipsePositions=function(e,t,n){let i=e.semiMinorAxis,o=e.semiMajorAxis,r=e.rotation,s=e.center,a=e.granularity*8,l=i*i,u=o*o,f=o*i,d=h.magnitude(s),p=h.normalize(s,oXe),g=h.cross(h.UNIT_Z,s,rXe);g=h.normalize(g,g);let m=h.cross(p,g,sXe),b=1+Math.ceil(R.PI_OVER_TWO/a),x=R.PI_OVER_TWO/(b-1),T=R.PI_OVER_TWO-b*x;T<0&&(b-=Math.ceil(Math.abs(T)/x));let C=2*(b*(b+2)),S=t?new Array(C*3):void 0,v=0,D=bue,I=xue,L=b*4*3,M=L-1,N=0,B=n?new Array(L):void 0,_,w,P,O,F;for(T=R.PI_OVER_TWO,D=xA(T,r,m,g,l,f,u,d,p,D),t&&(S[v++]=D.x,S[v++]=D.y,S[v++]=D.z),n&&(B[M--]=D.z,B[M--]=D.y,B[M--]=D.x),T=R.PI_OVER_TWO-x,_=1;_<b+1;++_){if(D=xA(T,r,m,g,l,f,u,d,p,D),I=xA(Math.PI-T,r,m,g,l,f,u,d,p,I),t){for(S[v++]=D.x,S[v++]=D.y,S[v++]=D.z,P=2*_+2,w=1;w<P-1;++w)O=w/(P-1),F=h.lerp(D,I,O,o6),S[v++]=F.x,S[v++]=F.y,S[v++]=F.z;S[v++]=I.x,S[v++]=I.y,S[v++]=I.z}n&&(B[M--]=D.z,B[M--]=D.y,B[M--]=D.x,B[N++]=I.x,B[N++]=I.y,B[N++]=I.z),T=R.PI_OVER_TWO-(_+1)*x}for(_=b;_>1;--_){if(T=R.PI_OVER_TWO-(_-1)*x,D=xA(-T,r,m,g,l,f,u,d,p,D),I=xA(T+Math.PI,r,m,g,l,f,u,d,p,I),t){for(S[v++]=D.x,S[v++]=D.y,S[v++]=D.z,P=2*(_-1)+2,w=1;w<P-1;++w)O=w/(P-1),F=h.lerp(D,I,O,o6),S[v++]=F.x,S[v++]=F.y,S[v++]=F.z;S[v++]=I.x,S[v++]=I.y,S[v++]=I.z}n&&(B[M--]=D.z,B[M--]=D.y,B[M--]=D.x,B[N++]=I.x,B[N++]=I.y,B[N++]=I.z)}T=R.PI_OVER_TWO,D=xA(-T,r,m,g,l,f,u,d,p,D);let V={};return t&&(S[v++]=D.x,S[v++]=D.y,S[v++]=D.z,V.positions=S,V.numPts=b),n&&(B[M--]=D.z,B[M--]=D.y,B[M--]=D.x,V.outerPositions=B),V};var pf=r6;var TA=new h,s6=new h,a6=new h,Tue=new h,ms=new H,Aue=new Q,aXe=new Q,c6=new Ne,Cue=new h,Eue=new h,Sue=new h,xR=new he,wue=new h,vue=new H,Due=new H;function Pue(e,t,n){let i=t.vertexFormat,o=t.center,r=t.semiMajorAxis,s=t.semiMinorAxis,a=t.ellipsoid,l=t.stRotation,u=n?e.length/3*2:e.length/3,f=t.shadowVolume,d=i.st?new Float32Array(u*2):void 0,p=i.normal?new Float32Array(u*3):void 0,g=i.tangent?new Float32Array(u*3):void 0,m=i.bitangent?new Float32Array(u*3):void 0,b=f?new Float32Array(u*3):void 0,x=0,T=Cue,C=Eue,S=Sue,v=new Mi(a),D=v.project(a.cartesianToCartographic(o,xR),wue),I=a.scaleToGeodeticSurface(o,TA);a.geodeticSurfaceNormal(I,I);let L=Aue,M=aXe;if(l!==0){let F=Ne.fromAxisAngle(I,l,c6);L=Q.fromQuaternion(F,L),F=Ne.fromAxisAngle(I,-l,c6),M=Q.fromQuaternion(F,M)}else L=Q.clone(Q.IDENTITY,L),M=Q.clone(Q.IDENTITY,M);let N=H.fromElements(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,vue),B=H.fromElements(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Due),_=e.length,w=n?_:0,P=w/3*2;for(let F=0;F<_;F+=3){let V=F+1,G=F+2,z=h.fromArray(e,F,TA);if(i.st){let W=Q.multiplyByVector(L,z,s6),U=v.project(a.cartesianToCartographic(W,xR),a6);h.subtract(U,D,U),ms.x=(U.x+r)/(2*r),ms.y=(U.y+s)/(2*s),N.x=Math.min(ms.x,N.x),N.y=Math.min(ms.y,N.y),B.x=Math.max(ms.x,B.x),B.y=Math.max(ms.y,B.y),n&&(d[x+P]=ms.x,d[x+1+P]=ms.y),d[x++]=ms.x,d[x++]=ms.y}(i.normal||i.tangent||i.bitangent||f)&&(T=a.geodeticSurfaceNormal(z,T),f&&(b[F+w]=-T.x,b[V+w]=-T.y,b[G+w]=-T.z),(i.normal||i.tangent||i.bitangent)&&((i.tangent||i.bitangent)&&(C=h.normalize(h.cross(h.UNIT_Z,T,C),C),Q.multiplyByVector(M,C,C)),i.normal&&(p[F]=T.x,p[V]=T.y,p[G]=T.z,n&&(p[F+w]=-T.x,p[V+w]=-T.y,p[G+w]=-T.z)),i.tangent&&(g[F]=C.x,g[V]=C.y,g[G]=C.z,n&&(g[F+w]=-C.x,g[V+w]=-C.y,g[G+w]=-C.z)),i.bitangent&&(S=h.normalize(h.cross(T,C,S),S),m[F]=S.x,m[V]=S.y,m[G]=S.z,n&&(m[F+w]=S.x,m[V+w]=S.y,m[G+w]=S.z))))}if(i.st){_=d.length;for(let F=0;F<_;F+=2)d[F]=(d[F]-N.x)/(B.x-N.x),d[F+1]=(d[F+1]-N.y)/(B.y-N.y)}let O=new pn;if(i.position){let F=pf.raisePositionsToHeight(e,t,n);O.position=new we({componentDatatype:$.DOUBLE,componentsPerAttribute:3,values:F})}if(i.st&&(O.st=new we({componentDatatype:$.FLOAT,componentsPerAttribute:2,values:d})),i.normal&&(O.normal=new we({componentDatatype:$.FLOAT,componentsPerAttribute:3,values:p})),i.tangent&&(O.tangent=new we({componentDatatype:$.FLOAT,componentsPerAttribute:3,values:g})),i.bitangent&&(O.bitangent=new we({componentDatatype:$.FLOAT,componentsPerAttribute:3,values:m})),f&&(O.extrudeDirection=new we({componentDatatype:$.FLOAT,componentsPerAttribute:3,values:b})),n&&c(t.offsetAttribute)){let F=new Uint8Array(u);if(t.offsetAttribute===Jt.TOP)F=F.fill(1,0,u/2);else{let V=t.offsetAttribute===Jt.NONE?0:1;F=F.fill(V)}O.applyOffset=new we({componentDatatype:$.UNSIGNED_BYTE,componentsPerAttribute:1,values:F})}return O}function Iue(e){let t=new Array(12*(e*(e+1))-6),n=0,i,o,r,s,a;for(i=0,r=1,s=0;s<3;s++)t[n++]=r++,t[n++]=i,t[n++]=r;for(s=2;s<e+1;++s){for(r=s*(s+1)-1,i=(s-1)*s-1,t[n++]=r++,t[n++]=i,t[n++]=r,o=2*s,a=0;a<o-1;++a)t[n++]=r,t[n++]=i++,t[n++]=i,t[n++]=r++,t[n++]=i,t[n++]=r;t[n++]=r++,t[n++]=i,t[n++]=r}for(o=e*2,++r,++i,s=0;s<o-1;++s)t[n++]=r,t[n++]=i++,t[n++]=i,t[n++]=r++,t[n++]=i,t[n++]=r;for(t[n++]=r,t[n++]=i++,t[n++]=i,t[n++]=r++,t[n++]=i++,t[n++]=i,++i,s=e-1;s>1;--s){for(t[n++]=i++,t[n++]=i,t[n++]=r,o=2*s,a=0;a<o-1;++a)t[n++]=r,t[n++]=i++,t[n++]=i,t[n++]=r++,t[n++]=i,t[n++]=r;t[n++]=i++,t[n++]=i++,t[n++]=r++}for(s=0;s<3;s++)t[n++]=i++,t[n++]=i,t[n++]=r;return t}var cb=new h;function cXe(e){let t=e.center;cb=h.multiplyByScalar(e.ellipsoid.geodeticSurfaceNormal(t,cb),e.height,cb),cb=h.add(t,cb,cb);let n=new ce(cb,e.semiMajorAxis),i=pf.computeEllipsePositions(e,!0,!1),o=i.positions,r=i.numPts,s=Pue(o,e,!1),a=Iue(r);return a=Fe.createTypedArray(o.length/3,a),{boundingSphere:n,attributes:s,indices:a}}function lXe(e,t){let n=t.vertexFormat,i=t.center,o=t.semiMajorAxis,r=t.semiMinorAxis,s=t.ellipsoid,a=t.height,l=t.extrudedHeight,u=t.stRotation,f=e.length/3*2,d=new Float64Array(f*3),p=n.st?new Float32Array(f*2):void 0,g=n.normal?new Float32Array(f*3):void 0,m=n.tangent?new Float32Array(f*3):void 0,b=n.bitangent?new Float32Array(f*3):void 0,x=t.shadowVolume,T=x?new Float32Array(f*3):void 0,C=0,S=Cue,v=Eue,D=Sue,I=new Mi(s),L=I.project(s.cartesianToCartographic(i,xR),wue),M=s.scaleToGeodeticSurface(i,TA);s.geodeticSurfaceNormal(M,M);let N=Ne.fromAxisAngle(M,u,c6),B=Q.fromQuaternion(N,Aue),_=H.fromElements(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,vue),w=H.fromElements(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Due),P=e.length,O=P/3*2;for(let V=0;V<P;V+=3){let G=V+1,z=V+2,W=h.fromArray(e,V,TA),U;if(n.st){let K=Q.multiplyByVector(B,W,s6),te=I.project(s.cartesianToCartographic(K,xR),a6);h.subtract(te,L,te),ms.x=(te.x+o)/(2*o),ms.y=(te.y+r)/(2*r),_.x=Math.min(ms.x,_.x),_.y=Math.min(ms.y,_.y),w.x=Math.max(ms.x,w.x),w.y=Math.max(ms.y,w.y),p[C+O]=ms.x,p[C+1+O]=ms.y,p[C++]=ms.x,p[C++]=ms.y}W=s.scaleToGeodeticSurface(W,W),U=h.clone(W,s6),S=s.geodeticSurfaceNormal(W,S),x&&(T[V+P]=-S.x,T[G+P]=-S.y,T[z+P]=-S.z);let q=h.multiplyByScalar(S,a,Tue);if(W=h.add(W,q,W),q=h.multiplyByScalar(S,l,q),U=h.add(U,q,U),n.position&&(d[V+P]=U.x,d[G+P]=U.y,d[z+P]=U.z,d[V]=W.x,d[G]=W.y,d[z]=W.z),n.normal||n.tangent||n.bitangent){D=h.clone(S,D);let K=h.fromArray(e,(V+3)%P,Tue);h.subtract(K,W,K);let te=h.subtract(U,W,a6);S=h.normalize(h.cross(te,K,S),S),n.normal&&(g[V]=S.x,g[G]=S.y,g[z]=S.z,g[V+P]=S.x,g[G+P]=S.y,g[z+P]=S.z),n.tangent&&(v=h.normalize(h.cross(D,S,v),v),m[V]=v.x,m[G]=v.y,m[z]=v.z,m[V+P]=v.x,m[V+1+P]=v.y,m[V+2+P]=v.z),n.bitangent&&(b[V]=D.x,b[G]=D.y,b[z]=D.z,b[V+P]=D.x,b[G+P]=D.y,b[z+P]=D.z)}}if(n.st){P=p.length;for(let V=0;V<P;V+=2)p[V]=(p[V]-_.x)/(w.x-_.x),p[V+1]=(p[V+1]-_.y)/(w.y-_.y)}let F=new pn;if(n.position&&(F.position=new we({componentDatatype:$.DOUBLE,componentsPerAttribute:3,values:d})),n.st&&(F.st=new we({componentDatatype:$.FLOAT,componentsPerAttribute:2,values:p})),n.normal&&(F.normal=new we({componentDatatype:$.FLOAT,componentsPerAttribute:3,values:g})),n.tangent&&(F.tangent=new we({componentDatatype:$.FLOAT,componentsPerAttribute:3,values:m})),n.bitangent&&(F.bitangent=new we({componentDatatype:$.FLOAT,componentsPerAttribute:3,values:b})),x&&(F.extrudeDirection=new we({componentDatatype:$.FLOAT,componentsPerAttribute:3,values:T})),c(t.offsetAttribute)){let V=new Uint8Array(f);if(t.offsetAttribute===Jt.TOP)V=V.fill(1,0,f/2);else{let G=t.offsetAttribute===Jt.NONE?0:1;V=V.fill(G)}F.applyOffset=new we({componentDatatype:$.UNSIGNED_BYTE,componentsPerAttribute:1,values:V})}return F}function uXe(e){let t=e.length/3,n=Fe.createTypedArray(t,t*6),i=0;for(let o=0;o<t;o++){let r=o,s=o+t,a=(r+1)%t,l=a+t;n[i++]=r,n[i++]=s,n[i++]=a,n[i++]=a,n[i++]=s,n[i++]=l}return n}var yR=new ce,bR=new ce;function fXe(e){let t=e.center,n=e.ellipsoid,i=e.semiMajorAxis,o=h.multiplyByScalar(n.geodeticSurfaceNormal(t,TA),e.height,TA);yR.center=h.add(t,o,yR.center),yR.radius=i,o=h.multiplyByScalar(n.geodeticSurfaceNormal(t,o),e.extrudedHeight,o),bR.center=h.add(t,o,bR.center),bR.radius=i;let r=pf.computeEllipsePositions(e,!0,!0),s=r.positions,a=r.numPts,l=r.outerPositions,u=ce.union(yR,bR),f=Pue(s,e,!0),d=Iue(a),p=d.length;d.length=p*2;let g=s.length/3;for(let v=0;v<p;v+=3)d[v+p]=d[v+2]+g,d[v+1+p]=d[v+1]+g,d[v+2+p]=d[v]+g;let m=Fe.createTypedArray(g*2/3,d),b=new ut({attributes:f,indices:m,primitiveType:Me.TRIANGLES}),x=lXe(l,e);d=uXe(l);let T=Fe.createTypedArray(l.length*2/3,d),C=new ut({attributes:x,indices:T,primitiveType:Me.TRIANGLES}),S=Fn.combineInstances([new vt({geometry:b}),new vt({geometry:C})]);return{boundingSphere:u,attributes:S[0].attributes,indices:S[0].indices}}function Oue(e,t,n,i,o,r,s){let l=pf.computeEllipsePositions({center:e,semiMajorAxis:t,semiMinorAxis:n,rotation:i,granularity:o},!1,!0).outerPositions,u=l.length/3,f=new Array(u);for(let p=0;p<u;++p)f[p]=h.fromArray(l,p*3);let d=ae.fromCartesianArray(f,r,s);return d.width>R.PI&&(d.north=d.north>0?R.PI_OVER_TWO-R.EPSILON7:d.north,d.south=d.south<0?R.EPSILON7-R.PI_OVER_TWO:d.south,d.east=R.PI,d.west=-R.PI),d}function Nh(e){e=y(e,y.EMPTY_OBJECT);let t=e.center,n=y(e.ellipsoid,ie.default),i=e.semiMajorAxis,o=e.semiMinorAxis,r=y(e.granularity,R.RADIANS_PER_DEGREE),s=y(e.vertexFormat,Ie.DEFAULT);if(A.defined("options.center",t),A.typeOf.number("options.semiMajorAxis",i),A.typeOf.number("options.semiMinorAxis",o),i<o)throw new E("semiMajorAxis must be greater than or equal to the semiMinorAxis.");if(r<=0)throw new E("granularity must be greater than zero.");let a=y(e.height,0),l=y(e.extrudedHeight,a);this._center=h.clone(t),this._semiMajorAxis=i,this._semiMinorAxis=o,this._ellipsoid=ie.clone(n),this._rotation=y(e.rotation,0),this._stRotation=y(e.stRotation,0),this._height=Math.max(l,a),this._granularity=r,this._vertexFormat=Ie.clone(s),this._extrudedHeight=Math.min(l,a),this._shadowVolume=y(e.shadowVolume,!1),this._workerName="createEllipseGeometry",this._offsetAttribute=e.offsetAttribute,this._rectangle=void 0,this._textureCoordinateRotationPoints=void 0}Nh.packedLength=h.packedLength+ie.packedLength+Ie.packedLength+9;Nh.pack=function(e,t,n){return A.defined("value",e),A.defined("array",t),n=y(n,0),h.pack(e._center,t,n),n+=h.packedLength,ie.pack(e._ellipsoid,t,n),n+=ie.packedLength,Ie.pack(e._vertexFormat,t,n),n+=Ie.packedLength,t[n++]=e._semiMajorAxis,t[n++]=e._semiMinorAxis,t[n++]=e._rotation,t[n++]=e._stRotation,t[n++]=e._height,t[n++]=e._granularity,t[n++]=e._extrudedHeight,t[n++]=e._shadowVolume?1:0,t[n]=y(e._offsetAttribute,-1),t};var Rue=new h,Mue=new ie,Lue=new Ie,Lh={center:Rue,ellipsoid:Mue,vertexFormat:Lue,semiMajorAxis:void 0,semiMinorAxis:void 0,rotation:void 0,stRotation:void 0,height:void 0,granularity:void 0,extrudedHeight:void 0,shadowVolume:void 0,offsetAttribute:void 0};Nh.unpack=function(e,t,n){A.defined("array",e),t=y(t,0);let i=h.unpack(e,t,Rue);t+=h.packedLength;let o=ie.unpack(e,t,Mue);t+=ie.packedLength;let r=Ie.unpack(e,t,Lue);t+=Ie.packedLength;let s=e[t++],a=e[t++],l=e[t++],u=e[t++],f=e[t++],d=e[t++],p=e[t++],g=e[t++]===1,m=e[t];return c(n)?(n._center=h.clone(i,n._center),n._ellipsoid=ie.clone(o,n._ellipsoid),n._vertexFormat=Ie.clone(r,n._vertexFormat),n._semiMajorAxis=s,n._semiMinorAxis=a,n._rotation=l,n._stRotation=u,n._height=f,n._granularity=d,n._extrudedHeight=p,n._shadowVolume=g,n._offsetAttribute=m===-1?void 0:m,n):(Lh.height=f,Lh.extrudedHeight=p,Lh.granularity=d,Lh.stRotation=u,Lh.rotation=l,Lh.semiMajorAxis=s,Lh.semiMinorAxis=a,Lh.shadowVolume=g,Lh.offsetAttribute=m===-1?void 0:m,new Nh(Lh))};Nh.computeRectangle=function(e,t){e=y(e,y.EMPTY_OBJECT);let n=e.center,i=y(e.ellipsoid,ie.default),o=e.semiMajorAxis,r=e.semiMinorAxis,s=y(e.granularity,R.RADIANS_PER_DEGREE),a=y(e.rotation,0);if(A.defined("options.center",n),A.typeOf.number("options.semiMajorAxis",o),A.typeOf.number("options.semiMinorAxis",r),o<r)throw new E("semiMajorAxis must be greater than or equal to the semiMinorAxis.");if(s<=0)throw new E("granularity must be greater than zero.");return Oue(n,o,r,a,s,i,t)};Nh.createGeometry=function(e){if(e._semiMajorAxis<=0||e._semiMinorAxis<=0)return;let t=e._height,n=e._extrudedHeight,i=!R.equalsEpsilon(t,n,0,R.EPSILON2);e._center=e._ellipsoid.scaleToGeodeticSurface(e._center,e._center);let o={center:e._center,semiMajorAxis:e._semiMajorAxis,semiMinorAxis:e._semiMinorAxis,ellipsoid:e._ellipsoid,rotation:e._rotation,height:t,granularity:e._granularity,vertexFormat:e._vertexFormat,stRotation:e._stRotation},r;if(i)o.extrudedHeight=n,o.shadowVolume=e._shadowVolume,o.offsetAttribute=e._offsetAttribute,r=fXe(o);else if(r=cXe(o),c(e._offsetAttribute)){let s=r.attributes.position.values.length,a=e._offsetAttribute===Jt.NONE?0:1,l=new Uint8Array(s/3).fill(a);r.attributes.applyOffset=new we({componentDatatype:$.UNSIGNED_BYTE,componentsPerAttribute:1,values:l})}return new ut({attributes:r.attributes,indices:r.indices,primitiveType:Me.TRIANGLES,boundingSphere:r.boundingSphere,offsetAttribute:e._offsetAttribute})};Nh.createShadowVolume=function(e,t,n){let i=e._granularity,o=e._ellipsoid,r=t(i,o),s=n(i,o);return new Nh({center:e._center,semiMajorAxis:e._semiMajorAxis,semiMinorAxis:e._semiMinorAxis,ellipsoid:o,rotation:e._rotation,stRotation:e._stRotation,granularity:i,extrudedHeight:r,height:s,vertexFormat:Ie.POSITION_ONLY,shadowVolume:!0})};function dXe(e){let t=-e._stRotation;if(t===0)return[0,0,0,1,1,0];let i=pf.computeEllipsePositions({center:e._center,semiMajorAxis:e._semiMajorAxis,semiMinorAxis:e._semiMinorAxis,rotation:e._rotation,granularity:e._granularity},!1,!0).outerPositions,o=i.length/3,r=new Array(o);for(let l=0;l<o;++l)r[l]=h.fromArray(i,l*3);let s=e._ellipsoid,a=e.rectangle;return ut._textureCoordinateRotationPoints(r,t,s,a)}Object.defineProperties(Nh.prototype,{rectangle:{get:function(){return c(this._rectangle)||(this._rectangle=Oue(this._center,this._semiMajorAxis,this._semiMinorAxis,this._rotation,this._granularity,this._ellipsoid)),this._rectangle}},textureCoordinateRotationPoints:{get:function(){return c(this._textureCoordinateRotationPoints)||(this._textureCoordinateRotationPoints=dXe(this)),this._textureCoordinateRotationPoints}}});var $l=Nh;var Nue=new h,lb=new h;function hXe(e){let t=e.center;lb=h.multiplyByScalar(e.ellipsoid.geodeticSurfaceNormal(t,lb),e.height,lb),lb=h.add(t,lb,lb);let n=new ce(lb,e.semiMajorAxis),i=pf.computeEllipsePositions(e,!1,!0).outerPositions,o=new pn({position:new we({componentDatatype:$.DOUBLE,componentsPerAttribute:3,values:pf.raisePositionsToHeight(i,e,!1)})}),r=i.length/3,s=Fe.createTypedArray(r,r*2),a=0;for(let l=0;l<r;++l)s[a++]=l,s[a++]=(l+1)%r;return{boundingSphere:n,attributes:o,indices:s}}var TR=new ce,AR=new ce;function mXe(e){let t=e.center,n=e.ellipsoid,i=e.semiMajorAxis,o=h.multiplyByScalar(n.geodeticSurfaceNormal(t,Nue),e.height,Nue);TR.center=h.add(t,o,TR.center),TR.radius=i,o=h.multiplyByScalar(n.geodeticSurfaceNormal(t,o),e.extrudedHeight,o),AR.center=h.add(t,o,AR.center),AR.radius=i;let r=pf.computeEllipsePositions(e,!1,!0).outerPositions,s=new pn({position:new we({componentDatatype:$.DOUBLE,componentsPerAttribute:3,values:pf.raisePositionsToHeight(r,e,!0)})});r=s.position.values;let a=ce.union(TR,AR),l=r.length/3;if(c(e.offsetAttribute)){let m=new Uint8Array(l);if(e.offsetAttribute===Jt.TOP)m=m.fill(1,0,l/2);else{let b=e.offsetAttribute===Jt.NONE?0:1;m=m.fill(b)}s.applyOffset=new we({componentDatatype:$.UNSIGNED_BYTE,componentsPerAttribute:1,values:m})}let u=y(e.numberOfVerticalLines,16);u=R.clamp(u,0,l/2);let f=Fe.createTypedArray(l,l*2+u*2);l/=2;let d=0,p;for(p=0;p<l;++p)f[d++]=p,f[d++]=(p+1)%l,f[d++]=p+l,f[d++]=(p+1)%l+l;let g;if(u>0){let m=Math.min(u,l);g=Math.round(l/m);let b=Math.min(g*u,l);for(p=0;p<b;p+=g)f[d++]=p,f[d++]=p+l}return{boundingSphere:a,attributes:s,indices:f}}function AA(e){e=y(e,y.EMPTY_OBJECT);let t=e.center,n=y(e.ellipsoid,ie.default),i=e.semiMajorAxis,o=e.semiMinorAxis,r=y(e.granularity,R.RADIANS_PER_DEGREE);if(!c(t))throw new E("center is required.");if(!c(i))throw new E("semiMajorAxis is required.");if(!c(o))throw new E("semiMinorAxis is required.");if(i<o)throw new E("semiMajorAxis must be greater than or equal to the semiMinorAxis.");if(r<=0)throw new E("granularity must be greater than zero.");let s=y(e.height,0),a=y(e.extrudedHeight,s);this._center=h.clone(t),this._semiMajorAxis=i,this._semiMinorAxis=o,this._ellipsoid=ie.clone(n),this._rotation=y(e.rotation,0),this._height=Math.max(a,s),this._granularity=r,this._extrudedHeight=Math.min(a,s),this._numberOfVerticalLines=Math.max(y(e.numberOfVerticalLines,16),0),this._offsetAttribute=e.offsetAttribute,this._workerName="createEllipseOutlineGeometry"}AA.packedLength=h.packedLength+ie.packedLength+8;AA.pack=function(e,t,n){if(!c(e))throw new E("value is required");if(!c(t))throw new E("array is required");return n=y(n,0),h.pack(e._center,t,n),n+=h.packedLength,ie.pack(e._ellipsoid,t,n),n+=ie.packedLength,t[n++]=e._semiMajorAxis,t[n++]=e._semiMinorAxis,t[n++]=e._rotation,t[n++]=e._height,t[n++]=e._granularity,t[n++]=e._extrudedHeight,t[n++]=e._numberOfVerticalLines,t[n]=y(e._offsetAttribute,-1),t};var Fue=new h,Bue=new ie,kp={center:Fue,ellipsoid:Bue,semiMajorAxis:void 0,semiMinorAxis:void 0,rotation:void 0,height:void 0,granularity:void 0,extrudedHeight:void 0,numberOfVerticalLines:void 0,offsetAttribute:void 0};AA.unpack=function(e,t,n){if(!c(e))throw new E("array is required");t=y(t,0);let i=h.unpack(e,t,Fue);t+=h.packedLength;let o=ie.unpack(e,t,Bue);t+=ie.packedLength;let r=e[t++],s=e[t++],a=e[t++],l=e[t++],u=e[t++],f=e[t++],d=e[t++],p=e[t];return c(n)?(n._center=h.clone(i,n._center),n._ellipsoid=ie.clone(o,n._ellipsoid),n._semiMajorAxis=r,n._semiMinorAxis=s,n._rotation=a,n._height=l,n._granularity=u,n._extrudedHeight=f,n._numberOfVerticalLines=d,n._offsetAttribute=p===-1?void 0:p,n):(kp.height=l,kp.extrudedHeight=f,kp.granularity=u,kp.rotation=a,kp.semiMajorAxis=r,kp.semiMinorAxis=s,kp.numberOfVerticalLines=d,kp.offsetAttribute=p===-1?void 0:p,new AA(kp))};AA.createGeometry=function(e){if(e._semiMajorAxis<=0||e._semiMinorAxis<=0)return;let t=e._height,n=e._extrudedHeight,i=!R.equalsEpsilon(t,n,0,R.EPSILON2);e._center=e._ellipsoid.scaleToGeodeticSurface(e._center,e._center);let o={center:e._center,semiMajorAxis:e._semiMajorAxis,semiMinorAxis:e._semiMinorAxis,ellipsoid:e._ellipsoid,rotation:e._rotation,height:t,granularity:e._granularity,numberOfVerticalLines:e._numberOfVerticalLines},r;if(i)o.extrudedHeight=n,o.offsetAttribute=e._offsetAttribute,r=mXe(o);else if(r=hXe(o),c(e._offsetAttribute)){let s=r.attributes.position.values.length,a=e._offsetAttribute===Jt.NONE?0:1,l=new Uint8Array(s/3).fill(a);r.attributes.applyOffset=new we({componentDatatype:$.UNSIGNED_BYTE,componentsPerAttribute:1,values:l})}return new ut({attributes:r.attributes,indices:r.indices,primitiveType:Me.LINES,boundingSphere:r.boundingSphere,offsetAttribute:e._offsetAttribute})};var xd=AA;var kue=new j,Vue=h.ZERO,Uue=new h,zue=new ae;function pXe(e){this.id=e,this.vertexFormat=void 0,this.center=void 0,this.semiMajorAxis=void 0,this.semiMinorAxis=void 0,this.rotation=void 0,this.height=void 0,this.extrudedHeight=void 0,this.granularity=void 0,this.stRotation=void 0,this.numberOfVerticalLines=void 0,this.offsetAttribute=void 0}function Td(e,t){jn.call(this,{entity:e,scene:t,geometryOptions:new pXe(e),geometryPropertyName:"ellipse",observedPropertyNames:["availability","position","ellipse"]}),this._onEntityPropertyChanged(e,"ellipse",e.ellipse,void 0)}c(Object.create)&&(Td.prototype=Object.create(jn.prototype),Td.prototype.constructor=Td);Td.prototype.createFillGeometryInstance=function(e){if(A.defined("time",e),!this._fillEnabled)throw new E("This instance does not represent a filled geometry.");let t=this._entity,n=t.isAvailable(e),i={show:new Cn(n&&t.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),distanceDisplayCondition:kn.fromDistanceDisplayCondition(this._distanceDisplayConditionProperty.getValue(e)),offset:void 0,color:void 0};if(this._materialProperty instanceof Ht){let o;c(this._materialProperty.color)&&(this._materialProperty.color.isConstant||n)&&(o=this._materialProperty.color.getValue(e,kue)),c(o)||(o=j.WHITE),i.color=Wt.fromColor(o)}return c(this._options.offsetAttribute)&&(i.offset=Qi.fromCartesian3(X.getValueOrDefault(this._terrainOffsetProperty,e,Vue,Uue))),new vt({id:t,geometry:new $l(this._options),attributes:i})};Td.prototype.createOutlineGeometryInstance=function(e){if(A.defined("time",e),!this._outlineEnabled)throw new E("This instance does not represent an outlined geometry.");let t=this._entity,n=t.isAvailable(e),i=X.getValueOrDefault(this._outlineColorProperty,e,j.BLACK,kue),o=this._distanceDisplayConditionProperty.getValue(e),r={show:new Cn(n&&t.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:Wt.fromColor(i),distanceDisplayCondition:kn.fromDistanceDisplayCondition(o),offset:void 0};return c(this._options.offsetAttribute)&&(r.offset=Qi.fromCartesian3(X.getValueOrDefault(this._terrainOffsetProperty,e,Vue,Uue))),new vt({id:t,geometry:new xd(this._options),attributes:r})};Td.prototype._computeCenter=function(e,t){return X.getValueOrUndefined(this._entity.position,e,t)};Td.prototype._isHidden=function(e,t){let n=e.position;return!c(n)||!c(t.semiMajorAxis)||!c(t.semiMinorAxis)||oi.prototype._isHidden.call(this,e,t)};Td.prototype._isDynamic=function(e,t){return!e.position.isConstant||!t.semiMajorAxis.isConstant||!t.semiMinorAxis.isConstant||!X.isConstant(t.rotation)||!X.isConstant(t.height)||!X.isConstant(t.extrudedHeight)||!X.isConstant(t.granularity)||!X.isConstant(t.stRotation)||!X.isConstant(t.outlineWidth)||!X.isConstant(t.numberOfVerticalLines)||!X.isConstant(t.zIndex)||this._onTerrain&&!X.isConstant(this._materialProperty)&&!(this._materialProperty instanceof Ht)};Td.prototype._setStaticOptions=function(e,t){let n=X.getValueOrUndefined(t.height,je.MINIMUM_VALUE),i=X.getValueOrDefault(t.heightReference,je.MINIMUM_VALUE,$e.NONE),o=X.getValueOrUndefined(t.extrudedHeight,je.MINIMUM_VALUE),r=X.getValueOrDefault(t.extrudedHeightReference,je.MINIMUM_VALUE,$e.NONE);c(o)&&!c(n)&&(n=0);let s=this._options;s.vertexFormat=this._materialProperty instanceof Ht?ln.VERTEX_FORMAT:uo.MaterialSupport.TEXTURED.vertexFormat,s.center=e.position.getValue(je.MINIMUM_VALUE,s.center),s.semiMajorAxis=t.semiMajorAxis.getValue(je.MINIMUM_VALUE,s.semiMajorAxis),s.semiMinorAxis=t.semiMinorAxis.getValue(je.MINIMUM_VALUE,s.semiMinorAxis),s.rotation=X.getValueOrUndefined(t.rotation,je.MINIMUM_VALUE),s.granularity=X.getValueOrUndefined(t.granularity,je.MINIMUM_VALUE),s.stRotation=X.getValueOrUndefined(t.stRotation,je.MINIMUM_VALUE),s.numberOfVerticalLines=X.getValueOrUndefined(t.numberOfVerticalLines,je.MINIMUM_VALUE),s.offsetAttribute=jn.computeGeometryOffsetAttribute(n,i,o,r),s.height=jn.getGeometryHeight(n,i),o=jn.getGeometryExtrudedHeight(o,r),o===jn.CLAMP_TO_GROUND&&(o=di.getMinimumMaximumHeights($l.computeRectangle(s,zue)).minimumTerrainHeight),s.extrudedHeight=o};Td.DynamicGeometryUpdater=CA;function CA(e,t,n){ii.call(this,e,t,n)}c(Object.create)&&(CA.prototype=Object.create(ii.prototype),CA.prototype.constructor=CA);CA.prototype._isHidden=function(e,t,n){let i=this._options;return!c(i.center)||!c(i.semiMajorAxis)||!c(i.semiMinorAxis)||ii.prototype._isHidden.call(this,e,t,n)};CA.prototype._setOptions=function(e,t,n){let i=this._options,o=X.getValueOrUndefined(t.height,n),r=X.getValueOrDefault(t.heightReference,n,$e.NONE),s=X.getValueOrUndefined(t.extrudedHeight,n),a=X.getValueOrDefault(t.extrudedHeightReference,n,$e.NONE);c(s)&&!c(o)&&(o=0),i.center=X.getValueOrUndefined(e.position,n,i.center),i.semiMajorAxis=X.getValueOrUndefined(t.semiMajorAxis,n),i.semiMinorAxis=X.getValueOrUndefined(t.semiMinorAxis,n),i.rotation=X.getValueOrUndefined(t.rotation,n),i.granularity=X.getValueOrUndefined(t.granularity,n),i.stRotation=X.getValueOrUndefined(t.stRotation,n),i.numberOfVerticalLines=X.getValueOrUndefined(t.numberOfVerticalLines,n),i.offsetAttribute=jn.computeGeometryOffsetAttribute(o,r,s,a),i.height=jn.getGeometryHeight(o,r),s=jn.getGeometryExtrudedHeight(s,a),s===jn.CLAMP_TO_GROUND&&(s=di.getMinimumMaximumHeights($l.computeRectangle(i,zue)).minimumTerrainHeight),i.extrudedHeight=s};var l6=Td;var _Xe=new h,gXe=new h,yXe=new h,bXe=new h,xXe=new h,TXe=new h(1,1,1),Hue=Math.cos,Gue=Math.sin;function Vp(e){e=y(e,y.EMPTY_OBJECT);let t=y(e.radii,TXe),n=y(e.innerRadii,t),i=y(e.minimumClock,0),o=y(e.maximumClock,R.TWO_PI),r=y(e.minimumCone,0),s=y(e.maximumCone,R.PI),a=Math.round(y(e.stackPartitions,64)),l=Math.round(y(e.slicePartitions,64)),u=y(e.vertexFormat,Ie.DEFAULT);if(l<3)throw new E("options.slicePartitions cannot be less than three.");if(a<3)throw new E("options.stackPartitions cannot be less than three.");this._radii=h.clone(t),this._innerRadii=h.clone(n),this._minimumClock=i,this._maximumClock=o,this._minimumCone=r,this._maximumCone=s,this._stackPartitions=a,this._slicePartitions=l,this._vertexFormat=Ie.clone(u),this._offsetAttribute=e.offsetAttribute,this._workerName="createEllipsoidGeometry"}Vp.packedLength=2*h.packedLength+Ie.packedLength+7;Vp.pack=function(e,t,n){if(!c(e))throw new E("value is required");if(!c(t))throw new E("array is required");return n=y(n,0),h.pack(e._radii,t,n),n+=h.packedLength,h.pack(e._innerRadii,t,n),n+=h.packedLength,Ie.pack(e._vertexFormat,t,n),n+=Ie.packedLength,t[n++]=e._minimumClock,t[n++]=e._maximumClock,t[n++]=e._minimumCone,t[n++]=e._maximumCone,t[n++]=e._stackPartitions,t[n++]=e._slicePartitions,t[n]=y(e._offsetAttribute,-1),t};var jue=new h,Wue=new h,que=new Ie,Cg={radii:jue,innerRadii:Wue,vertexFormat:que,minimumClock:void 0,maximumClock:void 0,minimumCone:void 0,maximumCone:void 0,stackPartitions:void 0,slicePartitions:void 0,offsetAttribute:void 0};Vp.unpack=function(e,t,n){if(!c(e))throw new E("array is required");t=y(t,0);let i=h.unpack(e,t,jue);t+=h.packedLength;let o=h.unpack(e,t,Wue);t+=h.packedLength;let r=Ie.unpack(e,t,que);t+=Ie.packedLength;let s=e[t++],a=e[t++],l=e[t++],u=e[t++],f=e[t++],d=e[t++],p=e[t];return c(n)?(n._radii=h.clone(i,n._radii),n._innerRadii=h.clone(o,n._innerRadii),n._vertexFormat=Ie.clone(r,n._vertexFormat),n._minimumClock=s,n._maximumClock=a,n._minimumCone=l,n._maximumCone=u,n._stackPartitions=f,n._slicePartitions=d,n._offsetAttribute=p===-1?void 0:p,n):(Cg.minimumClock=s,Cg.maximumClock=a,Cg.minimumCone=l,Cg.maximumCone=u,Cg.stackPartitions=f,Cg.slicePartitions=d,Cg.offsetAttribute=p===-1?void 0:p,new Vp(Cg))};Vp.createGeometry=function(e){let t=e._radii;if(t.x<=0||t.y<=0||t.z<=0)return;let n=e._innerRadii;if(n.x<=0||n.y<=0||n.z<=0)return;let i=e._minimumClock,o=e._maximumClock,r=e._minimumCone,s=e._maximumCone,a=e._vertexFormat,l=e._slicePartitions+1,u=e._stackPartitions+1;l=Math.round(l*Math.abs(o-i)/R.TWO_PI),u=Math.round(u*Math.abs(s-r)/R.PI),l<2&&(l=2),u<2&&(u=2);let f,d,p=0,g=[r],m=[i];for(f=0;f<u;f++)g.push(r+f*(s-r)/(u-1));for(g.push(s),d=0;d<l;d++)m.push(i+d*(o-i)/(l-1));m.push(o);let b=g.length,x=m.length,T=0,C=1,S=n.x!==t.x||n.y!==t.y||n.z!==t.z,v=!1,D=!1,I=!1;S&&(C=2,r>0&&(v=!0,T+=l-1),s<Math.PI&&(D=!0,T+=l-1),(o-i)%R.TWO_PI?(I=!0,T+=(u-1)*2+1):T+=1);let L=x*b*C,M=new Float64Array(L*3),N=new Array(L).fill(!1),B=new Array(L).fill(!1),_=l*u*C,w=6*(_+T+1-(l+u)*C),P=Fe.createTypedArray(_,w),O=a.normal?new Float32Array(L*3):void 0,F=a.tangent?new Float32Array(L*3):void 0,V=a.bitangent?new Float32Array(L*3):void 0,G=a.st?new Float32Array(L*2):void 0,z=new Array(b),W=new Array(b);for(f=0;f<b;f++)z[f]=Gue(g[f]),W[f]=Hue(g[f]);let U=new Array(x),q=new Array(x);for(d=0;d<x;d++)q[d]=Hue(m[d]),U[d]=Gue(m[d]);for(f=0;f<b;f++)for(d=0;d<x;d++)M[p++]=t.x*z[f]*q[d],M[p++]=t.y*z[f]*U[d],M[p++]=t.z*W[f];let K=L/2;if(S)for(f=0;f<b;f++)for(d=0;d<x;d++)M[p++]=n.x*z[f]*q[d],M[p++]=n.y*z[f]*U[d],M[p++]=n.z*W[f],N[K]=!0,f>0&&f!==b-1&&d!==0&&d!==x-1&&(B[K]=!0),K++;p=0;let te,Y;for(f=1;f<b-2;f++)for(te=f*x,Y=(f+1)*x,d=1;d<x-2;d++)P[p++]=Y+d,P[p++]=Y+d+1,P[p++]=te+d+1,P[p++]=Y+d,P[p++]=te+d+1,P[p++]=te+d;if(S){let it=b*x;for(f=1;f<b-2;f++)for(te=it+f*x,Y=it+(f+1)*x,d=1;d<x-2;d++)P[p++]=Y+d,P[p++]=te+d,P[p++]=te+d+1,P[p++]=Y+d,P[p++]=te+d+1,P[p++]=Y+d+1}let Z,ee;if(S){if(v)for(ee=b*x,f=1;f<x-2;f++)P[p++]=f,P[p++]=f+1,P[p++]=ee+f+1,P[p++]=f,P[p++]=ee+f+1,P[p++]=ee+f;if(D)for(Z=b*x-x,ee=b*x*C-x,f=1;f<x-2;f++)P[p++]=Z+f+1,P[p++]=Z+f,P[p++]=ee+f,P[p++]=Z+f+1,P[p++]=ee+f,P[p++]=ee+f+1}if(I){for(f=1;f<b-2;f++)ee=x*b+x*f,Z=x*f,P[p++]=ee,P[p++]=Z+x,P[p++]=Z,P[p++]=ee,P[p++]=ee+x,P[p++]=Z+x;for(f=1;f<b-2;f++)ee=x*b+x*(f+1)-1,Z=x*(f+1)-1,P[p++]=Z+x,P[p++]=ee,P[p++]=Z,P[p++]=Z+x,P[p++]=ee+x,P[p++]=ee}let me=new pn;a.position&&(me.position=new we({componentDatatype:$.DOUBLE,componentsPerAttribute:3,values:M}));let be=0,le=0,ge=0,xe=0,Pe=L/2,Ee,Ue=ie.fromCartesian3(t),Ye=ie.fromCartesian3(n);if(a.st||a.normal||a.tangent||a.bitangent){for(f=0;f<L;f++){Ee=N[f]?Ye:Ue;let it=h.fromArray(M,f*3,_Xe),It=Ee.geodeticSurfaceNormal(it,gXe);if(B[f]&&h.negate(It,It),a.st){let Ot=H.negate(It,xXe);G[be++]=Math.atan2(Ot.y,Ot.x)/R.TWO_PI+.5,G[be++]=Math.asin(It.z)/Math.PI+.5}if(a.normal&&(O[le++]=It.x,O[le++]=It.y,O[le++]=It.z),a.tangent||a.bitangent){let Ot=yXe,He=0,tn;if(N[f]&&(He=Pe),!v&&f>=He&&f<He+x*2?tn=h.UNIT_X:tn=h.UNIT_Z,h.cross(tn,It,Ot),h.normalize(Ot,Ot),a.tangent&&(F[ge++]=Ot.x,F[ge++]=Ot.y,F[ge++]=Ot.z),a.bitangent){let dt=h.cross(It,Ot,bXe);h.normalize(dt,dt),V[xe++]=dt.x,V[xe++]=dt.y,V[xe++]=dt.z}}}a.st&&(me.st=new we({componentDatatype:$.FLOAT,componentsPerAttribute:2,values:G})),a.normal&&(me.normal=new we({componentDatatype:$.FLOAT,componentsPerAttribute:3,values:O})),a.tangent&&(me.tangent=new we({componentDatatype:$.FLOAT,componentsPerAttribute:3,values:F})),a.bitangent&&(me.bitangent=new we({componentDatatype:$.FLOAT,componentsPerAttribute:3,values:V}))}if(c(e._offsetAttribute)){let it=M.length,It=e._offsetAttribute===Jt.NONE?0:1,Ot=new Uint8Array(it/3).fill(It);me.applyOffset=new we({componentDatatype:$.UNSIGNED_BYTE,componentsPerAttribute:1,values:Ot})}return new ut({attributes:me,indices:P,primitiveType:Me.TRIANGLES,boundingSphere:ce.fromEllipsoid(Ue),offsetAttribute:e._offsetAttribute})};var u6;Vp.getUnitEllipsoid=function(){return c(u6)||(u6=Vp.createGeometry(new Vp({radii:new h(1,1,1),vertexFormat:Ie.POSITION_ONLY}))),u6};var ga=Vp;var AXe=new Ht(j.WHITE),f6=h.ZERO,d6=new h,CXe=new h,EXe=new h,h6=new j,SXe=new h(1,1,1);function wXe(e){this.id=e,this.vertexFormat=void 0,this.radii=void 0,this.innerRadii=void 0,this.minimumClock=void 0,this.maximumClock=void 0,this.minimumCone=void 0,this.maximumCone=void 0,this.stackPartitions=void 0,this.slicePartitions=void 0,this.subdivisions=void 0,this.offsetAttribute=void 0}function Zl(e,t){oi.call(this,{entity:e,scene:t,geometryOptions:new wXe(e),geometryPropertyName:"ellipsoid",observedPropertyNames:["availability","position","orientation","ellipsoid"]}),this._onEntityPropertyChanged(e,"ellipsoid",e.ellipsoid,void 0)}c(Object.create)&&(Zl.prototype=Object.create(oi.prototype),Zl.prototype.constructor=Zl);Object.defineProperties(Zl.prototype,{terrainOffsetProperty:{get:function(){return this._terrainOffsetProperty}}});Zl.prototype.createFillGeometryInstance=function(e,t,n){A.defined("time",e);let i=this._entity,o=i.isAvailable(e),r,s=new Cn(o&&i.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),a=this._distanceDisplayConditionProperty.getValue(e),l=kn.fromDistanceDisplayCondition(a),u={show:s,distanceDisplayCondition:l,color:void 0,offset:void 0};if(this._materialProperty instanceof Ht){let f;c(this._materialProperty.color)&&(this._materialProperty.color.isConstant||o)&&(f=this._materialProperty.color.getValue(e,h6)),c(f)||(f=j.WHITE),r=Wt.fromColor(f),u.color=r}return c(this._options.offsetAttribute)&&(u.offset=Qi.fromCartesian3(X.getValueOrDefault(this._terrainOffsetProperty,e,f6,d6))),new vt({id:i,geometry:new ga(this._options),modelMatrix:t?void 0:i.computeModelMatrixForHeightReference(e,i.ellipsoid.heightReference,this._options.radii.z*.5,this._scene.ellipsoid,n),attributes:u})};Zl.prototype.createOutlineGeometryInstance=function(e,t,n){A.defined("time",e);let i=this._entity,o=i.isAvailable(e),r=X.getValueOrDefault(this._outlineColorProperty,e,j.BLACK,h6),s=this._distanceDisplayConditionProperty.getValue(e),a={show:new Cn(o&&i.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:Wt.fromColor(r),distanceDisplayCondition:kn.fromDistanceDisplayCondition(s),offset:void 0};return c(this._options.offsetAttribute)&&(a.offset=Qi.fromCartesian3(X.getValueOrDefault(this._terrainOffsetProperty,e,f6,d6))),new vt({id:i,geometry:new fd(this._options),modelMatrix:t?void 0:i.computeModelMatrixForHeightReference(e,i.ellipsoid.heightReference,this._options.radii.z*.5,this._scene.ellipsoid,n),attributes:a})};Zl.prototype._computeCenter=function(e,t){return X.getValueOrUndefined(this._entity.position,e,t)};Zl.prototype._isHidden=function(e,t){return!c(e.position)||!c(t.radii)||oi.prototype._isHidden.call(this,e,t)};Zl.prototype._isDynamic=function(e,t){return!e.position.isConstant||!X.isConstant(e.orientation)||!t.radii.isConstant||!X.isConstant(t.innerRadii)||!X.isConstant(t.stackPartitions)||!X.isConstant(t.slicePartitions)||!X.isConstant(t.outlineWidth)||!X.isConstant(t.minimumClock)||!X.isConstant(t.maximumClock)||!X.isConstant(t.minimumCone)||!X.isConstant(t.maximumCone)||!X.isConstant(t.subdivisions)};Zl.prototype._setStaticOptions=function(e,t){let n=X.getValueOrDefault(t.heightReference,je.MINIMUM_VALUE,$e.NONE),i=this._options;i.vertexFormat=this._materialProperty instanceof Ht?ln.VERTEX_FORMAT:uo.MaterialSupport.TEXTURED.vertexFormat,i.radii=t.radii.getValue(je.MINIMUM_VALUE,i.radii),i.innerRadii=X.getValueOrUndefined(t.innerRadii,i.radii),i.minimumClock=X.getValueOrUndefined(t.minimumClock,je.MINIMUM_VALUE),i.maximumClock=X.getValueOrUndefined(t.maximumClock,je.MINIMUM_VALUE),i.minimumCone=X.getValueOrUndefined(t.minimumCone,je.MINIMUM_VALUE),i.maximumCone=X.getValueOrUndefined(t.maximumCone,je.MINIMUM_VALUE),i.stackPartitions=X.getValueOrUndefined(t.stackPartitions,je.MINIMUM_VALUE),i.slicePartitions=X.getValueOrUndefined(t.slicePartitions,je.MINIMUM_VALUE),i.subdivisions=X.getValueOrUndefined(t.subdivisions,je.MINIMUM_VALUE),i.offsetAttribute=n!==$e.NONE?Jt.ALL:void 0};Zl.prototype._onEntityPropertyChanged=t0;Zl.DynamicGeometryUpdater=Cv;function Cv(e,t,n){ii.call(this,e,t,n),this._scene=e._scene,this._modelMatrix=new k,this._attributes=void 0,this._outlineAttributes=void 0,this._lastSceneMode=void 0,this._lastShow=void 0,this._lastOutlineShow=void 0,this._lastOutlineWidth=void 0,this._lastOutlineColor=void 0,this._lastOffset=new h,this._material={}}c(Object.create)&&(Cv.prototype=Object.create(ii.prototype),Cv.prototype.constructor=Cv);Cv.prototype.update=function(e){A.defined("time",e);let t=this._entity,n=t.ellipsoid;if(!t.isShowing||!t.isAvailable(e)||!X.getValueOrDefault(n.show,e,!0)){c(this._primitive)&&(this._primitive.show=!1),c(this._outlinePrimitive)&&(this._outlinePrimitive.show=!1);return}let i=X.getValueOrUndefined(n.radii,e,CXe),o=c(i)?t.computeModelMatrixForHeightReference(e,n.heightReference,i.z*.5,this._scene.ellipsoid,this._modelMatrix):void 0;if(!c(o)||!c(i)){c(this._primitive)&&(this._primitive.show=!1),c(this._outlinePrimitive)&&(this._outlinePrimitive.show=!1);return}let r=X.getValueOrDefault(n.fill,e,!0),s=X.getValueOrDefault(n.outline,e,!1),a=X.getValueOrClonedDefault(n.outlineColor,e,j.BLACK,h6),l=pr.getValue(e,y(n.material,AXe),this._material),u=X.getValueOrUndefined(n.innerRadii,e,EXe),f=X.getValueOrUndefined(n.minimumClock,e),d=X.getValueOrUndefined(n.maximumClock,e),p=X.getValueOrUndefined(n.minimumCone,e),g=X.getValueOrUndefined(n.maximumCone,e),m=X.getValueOrUndefined(n.stackPartitions,e),b=X.getValueOrUndefined(n.slicePartitions,e),x=X.getValueOrUndefined(n.subdivisions,e),T=X.getValueOrDefault(n.outlineWidth,e,1),C=X.getValueOrDefault(n.heightReference,e,$e.NONE),S=C!==$e.NONE?Jt.ALL:void 0,v=this._scene.mode,D=v===oe.SCENE3D&&C===$e.NONE,I=this._options,L=this._geometryUpdater.shadowsProperty.getValue(e),N=this._geometryUpdater.distanceDisplayConditionProperty.getValue(e),B=X.getValueOrDefault(this._geometryUpdater.terrainOffsetProperty,e,f6,d6);if(!D||this._lastSceneMode!==v||!c(this._primitive)||I.stackPartitions!==m||I.slicePartitions!==b||c(u)&&!h.equals(I.innerRadii!==u)||I.minimumClock!==f||I.maximumClock!==d||I.minimumCone!==p||I.maximumCone!==g||I.subdivisions!==x||this._lastOutlineWidth!==T||I.offsetAttribute!==S){let w=this._primitives;w.removeAndDestroy(this._primitive),w.removeAndDestroy(this._outlinePrimitive),this._primitive=void 0,this._outlinePrimitive=void 0,this._lastSceneMode=v,this._lastOutlineWidth=T,I.stackPartitions=m,I.slicePartitions=b,I.subdivisions=x,I.offsetAttribute=S,I.radii=h.clone(D?SXe:i,I.radii),c(u)?D?I.innerRadii=h.fromElements(u.x/i.x,u.y/i.y,u.z/i.z,I.innerRadii):I.innerRadii=h.clone(u,I.innerRadii):I.innerRadii=void 0,I.minimumClock=f,I.maximumClock=d,I.minimumCone=p,I.maximumCone=g;let P=new uo({material:l,translucent:l.isTranslucent(),closed:!0});I.vertexFormat=P.vertexFormat;let O=this._geometryUpdater.createFillGeometryInstance(e,D,this._modelMatrix);this._primitive=w.add(new Rn({geometryInstances:O,appearance:P,asynchronous:!1,shadows:L}));let F=this._geometryUpdater.createOutlineGeometryInstance(e,D,this._modelMatrix);this._outlinePrimitive=w.add(new Rn({geometryInstances:F,appearance:new ln({flat:!0,translucent:F.attributes.color.value[3]!==255,renderState:{lineWidth:this._geometryUpdater._scene.clampLineWidth(T)}}),asynchronous:!1,shadows:L})),this._lastShow=r,this._lastOutlineShow=s,this._lastOutlineColor=j.clone(a,this._lastOutlineColor),this._lastDistanceDisplayCondition=N,this._lastOffset=h.clone(B,this._lastOffset)}else if(this._primitive.ready){let w=this._primitive,P=this._outlinePrimitive;w.show=!0,P.show=!0,w.appearance.material=l;let O=this._attributes;c(O)||(O=w.getGeometryInstanceAttributes(t),this._attributes=O),r!==this._lastShow&&(O.show=Cn.toValue(r,O.show),this._lastShow=r);let F=this._outlineAttributes;c(F)||(F=P.getGeometryInstanceAttributes(t),this._outlineAttributes=F),s!==this._lastOutlineShow&&(F.show=Cn.toValue(s,F.show),this._lastOutlineShow=s),j.equals(a,this._lastOutlineColor)||(F.color=Wt.toValue(a,F.color),j.clone(a,this._lastOutlineColor)),Bt.equals(N,this._lastDistanceDisplayCondition)||(O.distanceDisplayCondition=kn.toValue(N,O.distanceDisplayCondition),F.distanceDisplayCondition=kn.toValue(N,F.distanceDisplayCondition),Bt.clone(N,this._lastDistanceDisplayCondition)),h.equals(B,this._lastOffset)||(O.offset=Qi.toValue(B,O.offset),F.offset=Qi.toValue(B,O.offset),h.clone(B,this._lastOffset))}D&&(i.x=Math.max(i.x,.001),i.y=Math.max(i.y,.001),i.z=Math.max(i.z,.001),o=k.multiplyByScale(o,i,o),this._primitive.modelMatrix=o,this._outlinePrimitive.modelMatrix=o)};var m6=Zl;function EA(e){e=y(e,y.EMPTY_OBJECT);let t=y(e.vertexFormat,Ie.DEFAULT);this._vertexFormat=t,this._workerName="createPlaneGeometry"}EA.packedLength=Ie.packedLength;EA.pack=function(e,t,n){return A.typeOf.object("value",e),A.defined("array",t),n=y(n,0),Ie.pack(e._vertexFormat,t,n),t};var Yue=new Ie,vXe={vertexFormat:Yue};EA.unpack=function(e,t,n){A.defined("array",e),t=y(t,0);let i=Ie.unpack(e,t,Yue);return c(n)?(n._vertexFormat=Ie.clone(i,n._vertexFormat),n):new EA(vXe)};var CR=new h(-.5,-.5,0),ER=new h(.5,.5,0);EA.createGeometry=function(e){let t=e._vertexFormat,n=new pn,i,o;if(t.position){if(o=new Float64Array(4*3),o[0]=CR.x,o[1]=CR.y,o[2]=0,o[3]=ER.x,o[4]=CR.y,o[5]=0,o[6]=ER.x,o[7]=ER.y,o[8]=0,o[9]=CR.x,o[10]=ER.y,o[11]=0,n.position=new we({componentDatatype:$.DOUBLE,componentsPerAttribute:3,values:o}),t.normal){let r=new Float32Array(12);r[0]=0,r[1]=0,r[2]=1,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=1,r[9]=0,r[10]=0,r[11]=1,n.normal=new we({componentDatatype:$.FLOAT,componentsPerAttribute:3,values:r})}if(t.st){let r=new Float32Array(8);r[0]=0,r[1]=0,r[2]=1,r[3]=0,r[4]=1,r[5]=1,r[6]=0,r[7]=1,n.st=new we({componentDatatype:$.FLOAT,componentsPerAttribute:2,values:r})}if(t.tangent){let r=new Float32Array(12);r[0]=1,r[1]=0,r[2]=0,r[3]=1,r[4]=0,r[5]=0,r[6]=1,r[7]=0,r[8]=0,r[9]=1,r[10]=0,r[11]=0,n.tangent=new we({componentDatatype:$.FLOAT,componentsPerAttribute:3,values:r})}if(t.bitangent){let r=new Float32Array(12);r[0]=0,r[1]=1,r[2]=0,r[3]=0,r[4]=1,r[5]=0,r[6]=0,r[7]=1,r[8]=0,r[9]=0,r[10]=1,r[11]=0,n.bitangent=new we({componentDatatype:$.FLOAT,componentsPerAttribute:3,values:r})}i=new Uint16Array(2*3),i[0]=0,i[1]=1,i[2]=2,i[3]=0,i[4]=2,i[5]=3}return new ut({attributes:n,indices:i,primitiveType:Me.TRIANGLES,boundingSphere:new ce(h.ZERO,Math.sqrt(2))})};var p6=EA;function SA(){this._workerName="createPlaneOutlineGeometry"}SA.packedLength=0;SA.pack=function(e,t){return A.defined("value",e),A.defined("array",t),t};SA.unpack=function(e,t,n){return A.defined("array",e),c(n)?n:new SA};var Eg=new h(-.5,-.5,0),SR=new h(.5,.5,0);SA.createGeometry=function(){let e=new pn,t=new Uint16Array(4*2),n=new Float64Array(4*3);return n[0]=Eg.x,n[1]=Eg.y,n[2]=Eg.z,n[3]=SR.x,n[4]=Eg.y,n[5]=Eg.z,n[6]=SR.x,n[7]=SR.y,n[8]=Eg.z,n[9]=Eg.x,n[10]=SR.y,n[11]=Eg.z,e.position=new we({componentDatatype:$.DOUBLE,componentsPerAttribute:3,values:n}),t[0]=0,t[1]=1,t[2]=1,t[3]=2,t[4]=2,t[5]=3,t[6]=3,t[7]=0,new ut({attributes:e,indices:t,primitiveType:Me.LINES,boundingSphere:new ce(h.ZERO,Math.sqrt(2))})};var _6=SA;var DXe=new h,Xue=new j;function PXe(e){this.id=e,this.vertexFormat=void 0,this.plane=void 0,this.dimensions=void 0}function _f(e,t){oi.call(this,{entity:e,scene:t,geometryOptions:new PXe(e),geometryPropertyName:"plane",observedPropertyNames:["availability","position","orientation","plane"]}),this._onEntityPropertyChanged(e,"plane",e.plane,void 0)}c(Object.create)&&(_f.prototype=Object.create(oi.prototype),_f.prototype.constructor=_f);_f.prototype.createFillGeometryInstance=function(e){if(A.defined("time",e),!this._fillEnabled)throw new E("This instance does not represent a filled geometry.");let t=this._entity,n=t.isAvailable(e),i,o,r=new Cn(n&&t.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),s=this._distanceDisplayConditionProperty.getValue(e),a=kn.fromDistanceDisplayCondition(s);if(this._materialProperty instanceof Ht){let g;c(this._materialProperty.color)&&(this._materialProperty.color.isConstant||n)&&(g=this._materialProperty.color.getValue(e,Xue)),c(g)||(g=j.WHITE),o=Wt.fromColor(g),i={show:r,distanceDisplayCondition:a,color:o}}else i={show:r,distanceDisplayCondition:a};let l=t.plane,u=this._options,f=t.computeModelMatrix(e),d=X.getValueOrDefault(l.plane,e,u.plane),p=X.getValueOrUndefined(l.dimensions,e,u.dimensions);return u.plane=d,u.dimensions=p,f=g6(d,p,f,f),new vt({id:t,geometry:new p6(this._options),modelMatrix:f,attributes:i})};_f.prototype.createOutlineGeometryInstance=function(e){if(A.defined("time",e),!this._outlineEnabled)throw new E("This instance does not represent an outlined geometry.");let t=this._entity,n=t.isAvailable(e),i=X.getValueOrDefault(this._outlineColorProperty,e,j.BLACK,Xue),o=this._distanceDisplayConditionProperty.getValue(e),r=t.plane,s=this._options,a=t.computeModelMatrix(e),l=X.getValueOrDefault(r.plane,e,s.plane),u=X.getValueOrUndefined(r.dimensions,e,s.dimensions);return s.plane=l,s.dimensions=u,a=g6(l,u,a,a),new vt({id:t,geometry:new _6,modelMatrix:a,attributes:{show:new Cn(n&&t.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:Wt.fromColor(i),distanceDisplayCondition:kn.fromDistanceDisplayCondition(o)}})};_f.prototype._isHidden=function(e,t){return!c(t.plane)||!c(t.dimensions)||!c(e.position)||oi.prototype._isHidden.call(this,e,t)};_f.prototype._getIsClosed=function(e){return!1};_f.prototype._isDynamic=function(e,t){return!e.position.isConstant||!X.isConstant(e.orientation)||!t.plane.isConstant||!t.dimensions.isConstant||!X.isConstant(t.outlineWidth)};_f.prototype._setStaticOptions=function(e,t){let n=this._materialProperty instanceof Ht,i=this._options;i.vertexFormat=n?ln.VERTEX_FORMAT:uo.MaterialSupport.TEXTURED.vertexFormat,i.plane=t.plane.getValue(je.MINIMUM_VALUE,i.plane),i.dimensions=t.dimensions.getValue(je.MINIMUM_VALUE,i.dimensions)};_f.DynamicGeometryUpdater=wA;function wA(e,t,n){ii.call(this,e,t,n)}c(Object.create)&&(wA.prototype=Object.create(ii.prototype),wA.prototype.constructor=wA);wA.prototype._isHidden=function(e,t,n){let i=this._options,o=X.getValueOrUndefined(e.position,n,DXe);return!c(o)||!c(i.plane)||!c(i.dimensions)||ii.prototype._isHidden.call(this,e,t,n)};wA.prototype._setOptions=function(e,t,n){let i=this._options;i.plane=X.getValueOrDefault(t.plane,n,i.plane),i.dimensions=X.getValueOrUndefined(t.dimensions,n,i.dimensions)};var IXe=new h,OXe=new h,RXe=new h,MXe=new h,LXe=new Q,NXe=new Q,FXe=new k;function g6(e,t,n,i){let o=e.normal,r=e.distance,s=h.multiplyByScalar(o,-r,RXe),a=h.clone(h.UNIT_Z,OXe);R.equalsEpsilon(Math.abs(h.dot(a,o)),1,R.EPSILON8)&&(a=h.clone(h.UNIT_Y,a));let l=h.cross(a,o,IXe);a=h.cross(o,l,a),h.normalize(l,l),h.normalize(a,a);let u=LXe;Q.setColumn(u,0,l,u),Q.setColumn(u,1,a,u),Q.setColumn(u,2,o,u);let f=h.fromElements(t.x,t.y,1,MXe),d=Q.multiplyByScale(u,f,NXe),p=k.fromRotationTranslation(d,s,FXe);return k.multiplyTransformation(n,p,i)}_f.createPrimitiveMatrix=g6;var y6=_f;var BXe=new h,kXe=new Ke,VXe=new H,UXe=new H,zXe=new h,HXe=new h,GXe=new h,Ev=new h,jXe=new h,WXe=new h,Kue=new Ne,qXe=new Q,YXe=new Q,XXe=new h;function KXe(e,t,n,i,o,r,s,a,l){let u=e.positions,f=ai.triangulate(e.positions2D,e.holes);f.length<3&&(f=[0,1,2]);let d=Fe.createTypedArray(u.length,f.length);d.set(f);let p=qXe;if(i!==0){let _=Ne.fromAxisAngle(s,i,Kue);if(p=Q.fromQuaternion(_,p),t.tangent||t.bitangent){_=Ne.fromAxisAngle(s,-i,Kue);let w=Q.fromQuaternion(_,YXe);a=h.normalize(Q.multiplyByVector(w,a,a),a),t.bitangent&&(l=h.normalize(h.cross(s,a,l),l))}}else p=Q.clone(Q.IDENTITY,p);let g=UXe;t.st&&(g.x=n.x,g.y=n.y);let m=u.length,b=m*3,x=new Float64Array(b),T=t.normal?new Float32Array(b):void 0,C=t.tangent?new Float32Array(b):void 0,S=t.bitangent?new Float32Array(b):void 0,v=t.st?new Float32Array(m*2):void 0,D=0,I=0,L=0,M=0,N=0;for(let _=0;_<m;_++){let w=u[_];if(x[D++]=w.x,x[D++]=w.y,x[D++]=w.z,t.st)if(c(o)&&o.positions.length===m)v[N++]=o.positions[_].x,v[N++]=o.positions[_].y;else{let P=Q.multiplyByVector(p,w,BXe),O=r(P,VXe);H.subtract(O,g,O);let F=R.clamp(O.x/n.width,0,1),V=R.clamp(O.y/n.height,0,1);v[N++]=F,v[N++]=V}t.normal&&(T[I++]=s.x,T[I++]=s.y,T[I++]=s.z),t.tangent&&(C[M++]=a.x,C[M++]=a.y,C[M++]=a.z),t.bitangent&&(S[L++]=l.x,S[L++]=l.y,S[L++]=l.z)}let B=new pn;return t.position&&(B.position=new we({componentDatatype:$.DOUBLE,componentsPerAttribute:3,values:x})),t.normal&&(B.normal=new we({componentDatatype:$.FLOAT,componentsPerAttribute:3,values:T})),t.tangent&&(B.tangent=new we({componentDatatype:$.FLOAT,componentsPerAttribute:3,values:C})),t.bitangent&&(B.bitangent=new we({componentDatatype:$.FLOAT,componentsPerAttribute:3,values:S})),t.st&&(B.st=new we({componentDatatype:$.FLOAT,componentsPerAttribute:2,values:v})),new ut({attributes:B,indices:d,primitiveType:Me.TRIANGLES})}function ub(e){e=y(e,y.EMPTY_OBJECT);let t=e.polygonHierarchy,n=e.textureCoordinates;A.defined("options.polygonHierarchy",t);let i=y(e.vertexFormat,Ie.DEFAULT);this._vertexFormat=Ie.clone(i),this._polygonHierarchy=t,this._stRotation=y(e.stRotation,0),this._ellipsoid=ie.clone(y(e.ellipsoid,ie.default)),this._workerName="createCoplanarPolygonGeometry",this._textureCoordinates=n,this.packedLength=zn.computeHierarchyPackedLength(t,h)+Ie.packedLength+ie.packedLength+(c(n)?zn.computeHierarchyPackedLength(n,H):1)+2}ub.fromPositions=function(e){e=y(e,y.EMPTY_OBJECT),A.defined("options.positions",e.positions);let t={polygonHierarchy:{positions:e.positions},vertexFormat:e.vertexFormat,stRotation:e.stRotation,ellipsoid:e.ellipsoid,textureCoordinates:e.textureCoordinates};return new ub(t)};ub.pack=function(e,t,n){return A.typeOf.object("value",e),A.defined("array",t),n=y(n,0),n=zn.packPolygonHierarchy(e._polygonHierarchy,t,n,h),ie.pack(e._ellipsoid,t,n),n+=ie.packedLength,Ie.pack(e._vertexFormat,t,n),n+=Ie.packedLength,t[n++]=e._stRotation,c(e._textureCoordinates)?n=zn.packPolygonHierarchy(e._textureCoordinates,t,n,H):t[n++]=-1,t[n++]=e.packedLength,t};var $Xe=ie.clone(ie.UNIT_SPHERE),ZXe=new Ie,JXe={polygonHierarchy:{}};ub.unpack=function(e,t,n){A.defined("array",e),t=y(t,0);let i=zn.unpackPolygonHierarchy(e,t,h);t=i.startingIndex,delete i.startingIndex;let o=ie.unpack(e,t,$Xe);t+=ie.packedLength;let r=Ie.unpack(e,t,ZXe);t+=Ie.packedLength;let s=e[t++],a=e[t]===-1?void 0:zn.unpackPolygonHierarchy(e,t,H);c(a)?(t=a.startingIndex,delete a.startingIndex):t++;let l=e[t++];return c(n)||(n=new ub(JXe)),n._polygonHierarchy=i,n._ellipsoid=ie.clone(o,n._ellipsoid),n._vertexFormat=Ie.clone(r,n._vertexFormat),n._stRotation=s,n._textureCoordinates=a,n.packedLength=l,n};ub.createGeometry=function(e){let t=e._vertexFormat,n=e._polygonHierarchy,i=e._stRotation,o=e._textureCoordinates,r=c(o),s=n.positions;if(s=Ao(s,h.equalsEpsilon,!0),s.length<3)return;let a=zXe,l=HXe,u=GXe,f=jXe,d=WXe;if(!k0.computeProjectTo2DArguments(s,Ev,f,d))return;if(a=h.cross(f,d,a),a=h.normalize(a,a),!h.equalsEpsilon(Ev,h.ZERO,R.EPSILON6)){let N=e._ellipsoid.geodeticSurfaceNormal(Ev,XXe);h.dot(a,N)<0&&(a=h.negate(a,a),f=h.negate(f,f))}let g=k0.createProjectPointsTo2DFunction(Ev,f,d),m=k0.createProjectPointTo2DFunction(Ev,f,d);t.tangent&&(l=h.clone(f,l)),t.bitangent&&(u=h.clone(d,u));let b=zn.polygonsFromHierarchy(n,r,g,!1),x=b.hierarchy,T=b.polygons,C=function(N){return N},S=r?zn.polygonsFromHierarchy(o,!0,C,!1).polygons:void 0;if(x.length===0)return;s=x[0].outerRing;let v=ce.fromPoints(s),D=zn.computeBoundingRectangle(a,m,s,i,kXe),I=[];for(let N=0;N<T.length;N++){let B=new vt({geometry:KXe(T[N],t,D,i,r?S[N]:void 0,m,a,l,u)});I.push(B)}let L=Fn.combineInstances(I)[0];L.attributes.position.values=new Float64Array(L.attributes.position.values),L.indices=Fe.createTypedArray(L.attributes.position.values.length/3,L.indices);let M=L.attributes;return t.position||delete M.position,new ut({attributes:M,indices:L.indices,primitiveType:L.primitiveType,boundingSphere:v})};var b6=ub;var $ue=[],wR=[];function QXe(e,t,n,i,o){let s=cs.fromPoints(t,e).projectPointsOntoPlane(t,$ue);ai.computeWindingOrder2D(s)===ls.CLOCKWISE&&(s.reverse(),t=t.slice().reverse());let l,u,f=t.length,d=0;if(i)for(l=new Float64Array(f*2*3),u=0;u<f;u++){let m=t[u],b=t[(u+1)%f];l[d++]=m.x,l[d++]=m.y,l[d++]=m.z,l[d++]=b.x,l[d++]=b.y,l[d++]=b.z}else{let m=0;if(o===Yt.GEODESIC)for(u=0;u<f;u++)m+=zn.subdivideLineCount(t[u],t[(u+1)%f],n);else if(o===Yt.RHUMB)for(u=0;u<f;u++)m+=zn.subdivideRhumbLineCount(e,t[u],t[(u+1)%f],n);for(l=new Float64Array(m*3),u=0;u<f;u++){let b;o===Yt.GEODESIC?b=zn.subdivideLine(t[u],t[(u+1)%f],n,wR):o===Yt.RHUMB&&(b=zn.subdivideRhumbLine(e,t[u],t[(u+1)%f],n,wR));let x=b.length;for(let T=0;T<x;++T)l[d++]=b[T]}}f=l.length/3;let p=f*2,g=Fe.createTypedArray(f,p);for(d=0,u=0;u<f-1;u++)g[d++]=u,g[d++]=u+1;return g[d++]=f-1,g[d++]=0,new vt({geometry:new ut({attributes:new pn({position:new we({componentDatatype:$.DOUBLE,componentsPerAttribute:3,values:l})}),indices:g,primitiveType:Me.LINES})})}function eKe(e,t,n,i,o){let s=cs.fromPoints(t,e).projectPointsOntoPlane(t,$ue);ai.computeWindingOrder2D(s)===ls.CLOCKWISE&&(s.reverse(),t=t.slice().reverse());let l,u,f=t.length,d=new Array(f),p=0;if(i)for(l=new Float64Array(f*2*3*2),u=0;u<f;++u){d[u]=p/3;let x=t[u],T=t[(u+1)%f];l[p++]=x.x,l[p++]=x.y,l[p++]=x.z,l[p++]=T.x,l[p++]=T.y,l[p++]=T.z}else{let x=0;if(o===Yt.GEODESIC)for(u=0;u<f;u++)x+=zn.subdivideLineCount(t[u],t[(u+1)%f],n);else if(o===Yt.RHUMB)for(u=0;u<f;u++)x+=zn.subdivideRhumbLineCount(e,t[u],t[(u+1)%f],n);for(l=new Float64Array(x*3*2),u=0;u<f;++u){d[u]=p/3;let T;o===Yt.GEODESIC?T=zn.subdivideLine(t[u],t[(u+1)%f],n,wR):o===Yt.RHUMB&&(T=zn.subdivideRhumbLine(e,t[u],t[(u+1)%f],n,wR));let C=T.length;for(let S=0;S<C;++S)l[p++]=T[S]}}f=l.length/(3*2);let g=d.length,m=(f*2+g)*2,b=Fe.createTypedArray(f+g,m);for(p=0,u=0;u<f;++u)b[p++]=u,b[p++]=(u+1)%f,b[p++]=u+f,b[p++]=(u+1)%f+f;for(u=0;u<g;u++){let x=d[u];b[p++]=x,b[p++]=x+f}return new vt({geometry:new ut({attributes:new pn({position:new we({componentDatatype:$.DOUBLE,componentsPerAttribute:3,values:l})}),indices:b,primitiveType:Me.LINES})})}function fb(e){if(A.typeOf.object("options",e),A.typeOf.object("options.polygonHierarchy",e.polygonHierarchy),e.perPositionHeight&&c(e.height))throw new E("Cannot use both options.perPositionHeight and options.height");if(c(e.arcType)&&e.arcType!==Yt.GEODESIC&&e.arcType!==Yt.RHUMB)throw new E("Invalid arcType. Valid options are ArcType.GEODESIC and ArcType.RHUMB.");let t=e.polygonHierarchy,n=y(e.ellipsoid,ie.default),i=y(e.granularity,R.RADIANS_PER_DEGREE),o=y(e.perPositionHeight,!1),r=o&&c(e.extrudedHeight),s=y(e.arcType,Yt.GEODESIC),a=y(e.height,0),l=y(e.extrudedHeight,a);if(!r){let u=Math.max(a,l);l=Math.min(a,l),a=u}this._ellipsoid=ie.clone(n),this._granularity=i,this._height=a,this._extrudedHeight=l,this._arcType=s,this._polygonHierarchy=t,this._perPositionHeight=o,this._perPositionHeightExtrude=r,this._offsetAttribute=e.offsetAttribute,this._workerName="createPolygonOutlineGeometry",this.packedLength=zn.computeHierarchyPackedLength(t,h)+ie.packedLength+8}fb.pack=function(e,t,n){return A.typeOf.object("value",e),A.defined("array",t),n=y(n,0),n=zn.packPolygonHierarchy(e._polygonHierarchy,t,n,h),ie.pack(e._ellipsoid,t,n),n+=ie.packedLength,t[n++]=e._height,t[n++]=e._extrudedHeight,t[n++]=e._granularity,t[n++]=e._perPositionHeightExtrude?1:0,t[n++]=e._perPositionHeight?1:0,t[n++]=e._arcType,t[n++]=y(e._offsetAttribute,-1),t[n]=e.packedLength,t};var tKe=ie.clone(ie.UNIT_SPHERE),nKe={polygonHierarchy:{}};fb.unpack=function(e,t,n){A.defined("array",e),t=y(t,0);let i=zn.unpackPolygonHierarchy(e,t,h);t=i.startingIndex,delete i.startingIndex;let o=ie.unpack(e,t,tKe);t+=ie.packedLength;let r=e[t++],s=e[t++],a=e[t++],l=e[t++]===1,u=e[t++]===1,f=e[t++],d=e[t++],p=e[t];return c(n)||(n=new fb(nKe)),n._polygonHierarchy=i,n._ellipsoid=ie.clone(o,n._ellipsoid),n._height=r,n._extrudedHeight=s,n._granularity=a,n._perPositionHeight=u,n._perPositionHeightExtrude=l,n._arcType=f,n._offsetAttribute=d===-1?void 0:d,n.packedLength=p,n};fb.fromPositions=function(e){e=y(e,y.EMPTY_OBJECT),A.defined("options.positions",e.positions);let t={polygonHierarchy:{positions:e.positions},height:e.height,extrudedHeight:e.extrudedHeight,ellipsoid:e.ellipsoid,granularity:e.granularity,perPositionHeight:e.perPositionHeight,arcType:e.arcType,offsetAttribute:e.offsetAttribute};return new fb(t)};fb.createGeometry=function(e){let t=e._ellipsoid,n=e._granularity,i=e._polygonHierarchy,o=e._perPositionHeight,r=e._arcType,s=zn.polygonOutlinesFromHierarchy(i,!o,t);if(s.length===0)return;let a,l=[],u=R.chordLength(n,t.maximumRadius),f=e._height,d=e._extrudedHeight,p=e._perPositionHeightExtrude||!R.equalsEpsilon(f,d,0,R.EPSILON2),g,m;if(p)for(m=0;m<s.length;m++){if(a=eKe(t,s[m],u,o,r),a.geometry=zn.scaleToGeodeticHeightExtruded(a.geometry,f,d,t,o),c(e._offsetAttribute)){let T=a.geometry.attributes.position.values.length/3,C=new Uint8Array(T);e._offsetAttribute===Jt.TOP?C=C.fill(1,0,T/2):(g=e._offsetAttribute===Jt.NONE?0:1,C=C.fill(g)),a.geometry.attributes.applyOffset=new we({componentDatatype:$.UNSIGNED_BYTE,componentsPerAttribute:1,values:C})}l.push(a)}else for(m=0;m<s.length;m++){if(a=QXe(t,s[m],u,o,r),a.geometry.attributes.position.values=ai.scaleToGeodeticHeight(a.geometry.attributes.position.values,f,t,!o),c(e._offsetAttribute)){let T=a.geometry.attributes.position.values.length;g=e._offsetAttribute===Jt.NONE?0:1;let C=new Uint8Array(T/3).fill(g);a.geometry.attributes.applyOffset=new we({componentDatatype:$.UNSIGNED_BYTE,componentsPerAttribute:1,values:C})}l.push(a)}let b=Fn.combineInstances(l)[0],x=ce.fromVertices(b.attributes.position.values);return new ut({attributes:b.attributes,indices:b.indices,primitiveType:b.primitiveType,boundingSphere:x,offsetAttribute:e._offsetAttribute})};var x6=fb;var Zue="Entity polygons cannot have both height and perPositionHeight.  height will be ignored",Jue="heightReference is not supported for entity polygons with perPositionHeight. heightReference will be ignored",Que=new j,efe=h.ZERO,tfe=new h,nfe=new ae,iKe=[],oKe=new H;function rKe(e){this.id=e,this.vertexFormat=void 0,this.polygonHierarchy=void 0,this.perPositionHeight=void 0,this.closeTop=void 0,this.closeBottom=void 0,this.height=void 0,this.extrudedHeight=void 0,this.granularity=void 0,this.stRotation=void 0,this.offsetAttribute=void 0,this.arcType=void 0,this.textureCoordinates=void 0}function Jl(e,t){jn.call(this,{entity:e,scene:t,geometryOptions:new rKe(e),geometryPropertyName:"polygon",observedPropertyNames:["availability","polygon"]}),this._onEntityPropertyChanged(e,"polygon",e.polygon,void 0)}c(Object.create)&&(Jl.prototype=Object.create(jn.prototype),Jl.prototype.constructor=Jl);Jl.prototype.createFillGeometryInstance=function(e){if(A.defined("time",e),!this._fillEnabled)throw new E("This instance does not represent a filled geometry.");let t=this._entity,n=t.isAvailable(e),i=this._options,o={show:new Cn(n&&t.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),distanceDisplayCondition:kn.fromDistanceDisplayCondition(this._distanceDisplayConditionProperty.getValue(e)),offset:void 0,color:void 0};if(this._materialProperty instanceof Ht){let s;c(this._materialProperty.color)&&(this._materialProperty.color.isConstant||n)&&(s=this._materialProperty.color.getValue(e,Que)),c(s)||(s=j.WHITE),o.color=Wt.fromColor(s)}c(i.offsetAttribute)&&(o.offset=Qi.fromCartesian3(X.getValueOrDefault(this._terrainOffsetProperty,e,efe,tfe)));let r;return i.perPositionHeight&&!c(i.extrudedHeight)?r=new b6(i):r=new b0(i),new vt({id:t,geometry:r,attributes:o})};Jl.prototype.createOutlineGeometryInstance=function(e){if(A.defined("time",e),!this._outlineEnabled)throw new E("This instance does not represent an outlined geometry.");let t=this._entity,n=t.isAvailable(e),i=this._options,o=X.getValueOrDefault(this._outlineColorProperty,e,j.BLACK,Que),r=this._distanceDisplayConditionProperty.getValue(e),s={show:new Cn(n&&t.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:Wt.fromColor(o),distanceDisplayCondition:kn.fromDistanceDisplayCondition(r),offset:void 0};c(i.offsetAttribute)&&(s.offset=Qi.fromCartesian3(X.getValueOrDefault(this._terrainOffsetProperty,e,efe,tfe)));let a;return i.perPositionHeight&&!c(i.extrudedHeight)?a=new vh(i):a=new x6(i),new vt({id:t,geometry:a,attributes:s})};Jl.prototype._computeCenter=function(e,t){let n=X.getValueOrUndefined(this._entity.polygon.hierarchy,e);if(!c(n))return;let i=n.positions;if(i.length===0)return;let o=this._scene.ellipsoid,r=cs.fromPoints(i,o),s=r.projectPointsOntoPlane(i,iKe),a=s.length,l=0,u=a-1,f=new H;for(let p=0;p<a;u=p++){let g=s[p],m=s[u],b=g.x*m.y-m.x*g.y,x=H.add(g,m,oKe);x=H.multiplyByScalar(x,b,x),f=H.add(f,x,f),l+=b}let d=1/(l*3);return f=H.multiplyByScalar(f,d,f),r.projectPointOntoEllipsoid(f,t)};Jl.prototype._isHidden=function(e,t){return!c(t.hierarchy)||oi.prototype._isHidden.call(this,e,t)};Jl.prototype._isOnTerrain=function(e,t){let n=jn.prototype._isOnTerrain.call(this,e,t),i=t.perPositionHeight,o=c(i)&&(i.isConstant?i.getValue(je.MINIMUM_VALUE):!0);return n&&!o};Jl.prototype._isDynamic=function(e,t){return!t.hierarchy.isConstant||!X.isConstant(t.height)||!X.isConstant(t.extrudedHeight)||!X.isConstant(t.granularity)||!X.isConstant(t.stRotation)||!X.isConstant(t.textureCoordinates)||!X.isConstant(t.outlineWidth)||!X.isConstant(t.perPositionHeight)||!X.isConstant(t.closeTop)||!X.isConstant(t.closeBottom)||!X.isConstant(t.zIndex)||!X.isConstant(t.arcType)||this._onTerrain&&!X.isConstant(this._materialProperty)&&!(this._materialProperty instanceof Ht)};Jl.prototype._setStaticOptions=function(e,t){let n=this._materialProperty instanceof Ht,i=this._options;i.vertexFormat=n?ln.VERTEX_FORMAT:uo.MaterialSupport.TEXTURED.vertexFormat;let o=t.hierarchy.getValue(je.MINIMUM_VALUE),r=X.getValueOrUndefined(t.height,je.MINIMUM_VALUE),s=X.getValueOrDefault(t.heightReference,je.MINIMUM_VALUE,$e.NONE),a=X.getValueOrUndefined(t.extrudedHeight,je.MINIMUM_VALUE),l=X.getValueOrDefault(t.extrudedHeightReference,je.MINIMUM_VALUE,$e.NONE),u=X.getValueOrDefault(t.perPositionHeight,je.MINIMUM_VALUE,!1);r=jn.getGeometryHeight(r,s);let f;if(u?(c(r)&&(r=void 0,_t(Zue)),s!==$e.NONE&&u&&(r=void 0,_t(Jue))):(c(a)&&!c(r)&&(r=0),f=jn.computeGeometryOffsetAttribute(r,s,a,l)),i.polygonHierarchy=o,i.granularity=X.getValueOrUndefined(t.granularity,je.MINIMUM_VALUE),i.stRotation=X.getValueOrUndefined(t.stRotation,je.MINIMUM_VALUE),i.perPositionHeight=u,i.closeTop=X.getValueOrDefault(t.closeTop,je.MINIMUM_VALUE,!0),i.closeBottom=X.getValueOrDefault(t.closeBottom,je.MINIMUM_VALUE,!0),i.offsetAttribute=f,i.height=r,i.arcType=X.getValueOrDefault(t.arcType,je.MINIMUM_VALUE,Yt.GEODESIC),i.textureCoordinates=X.getValueOrUndefined(t.textureCoordinates,je.MINIMUM_VALUE),a=jn.getGeometryExtrudedHeight(a,l),a===jn.CLAMP_TO_GROUND){let d=b0.computeRectangleFromPositions(i.polygonHierarchy.positions,i.ellipsoid,i.arcType,nfe);a=di.getMinimumMaximumHeights(d).minimumTerrainHeight}i.extrudedHeight=a};Jl.prototype._getIsClosed=function(e){let t=e.height,n=e.extrudedHeight,i=c(n)&&n!==t;return!e.perPositionHeight&&(!i&&t===0||i&&e.closeTop&&e.closeBottom)};Jl.DynamicGeometryUpdater=vA;function vA(e,t,n){ii.call(this,e,t,n)}c(Object.create)&&(vA.prototype=Object.create(ii.prototype),vA.prototype.constructor=vA);vA.prototype._isHidden=function(e,t,n){return!c(this._options.polygonHierarchy)||ii.prototype._isHidden.call(this,e,t,n)};vA.prototype._setOptions=function(e,t,n){let i=this._options;i.polygonHierarchy=X.getValueOrUndefined(t.hierarchy,n);let o=X.getValueOrUndefined(t.height,n),r=X.getValueOrDefault(t.heightReference,n,$e.NONE),s=X.getValueOrDefault(t.extrudedHeightReference,n,$e.NONE),a=X.getValueOrUndefined(t.extrudedHeight,n),l=X.getValueOrUndefined(t.perPositionHeight,n);o=jn.getGeometryHeight(o,s);let u;if(l?(c(o)&&(o=void 0,_t(Zue)),r!==$e.NONE&&l&&(o=void 0,_t(Jue))):(c(a)&&!c(o)&&(o=0),u=jn.computeGeometryOffsetAttribute(o,r,a,s)),i.granularity=X.getValueOrUndefined(t.granularity,n),i.stRotation=X.getValueOrUndefined(t.stRotation,n),i.textureCoordinates=X.getValueOrUndefined(t.textureCoordinates,n),i.perPositionHeight=X.getValueOrUndefined(t.perPositionHeight,n),i.closeTop=X.getValueOrDefault(t.closeTop,n,!0),i.closeBottom=X.getValueOrDefault(t.closeBottom,n,!0),i.offsetAttribute=u,i.height=o,i.arcType=X.getValueOrDefault(t.arcType,n,Yt.GEODESIC),a=jn.getGeometryExtrudedHeight(a,s),a===jn.CLAMP_TO_GROUND){let f=b0.computeRectangleFromPositions(i.polygonHierarchy.positions,i.ellipsoid,i.arcType,nfe);a=di.getMinimumMaximumHeights(f).minimumTerrainHeight}i.extrudedHeight=a};var T6=Jl;function sKe(e,t,n,i){let o=new pn;i.position&&(o.position=new we({componentDatatype:$.DOUBLE,componentsPerAttribute:3,values:e}));let r=t.length,s=e.length/3,a=(s-r*2)/(r*2),l=ai.triangulate(t),u=(a-1)*r*6+l.length*2,f=Fe.createTypedArray(s,u),d,p,g,m,b,x,T=r*2,C=0;for(d=0;d<a-1;d++){for(p=0;p<r-1;p++)g=p*2+d*r*2,x=g+T,m=g+1,b=m+T,f[C++]=m,f[C++]=g,f[C++]=b,f[C++]=b,f[C++]=g,f[C++]=x;g=r*2-2+d*r*2,m=g+1,b=m+T,x=g+T,f[C++]=m,f[C++]=g,f[C++]=b,f[C++]=b,f[C++]=g,f[C++]=x}if(i.st||i.tangent||i.bitangent){let D=new Float32Array(s*2),I=1/(a-1),L=1/n.height,M=n.height/2,N,B,_=0;for(d=0;d<a;d++){for(N=d*I,B=L*(t[0].y+M),D[_++]=N,D[_++]=B,p=1;p<r;p++)B=L*(t[p].y+M),D[_++]=N,D[_++]=B,D[_++]=N,D[_++]=B;B=L*(t[0].y+M),D[_++]=N,D[_++]=B}for(p=0;p<r;p++)N=0,B=L*(t[p].y+M),D[_++]=N,D[_++]=B;for(p=0;p<r;p++)N=(a-1)*I,B=L*(t[p].y+M),D[_++]=N,D[_++]=B;o.st=new we({componentDatatype:$.FLOAT,componentsPerAttribute:2,values:new Float32Array(D)})}let S=s-r*2;for(d=0;d<l.length;d+=3){let D=l[d]+S,I=l[d+1]+S,L=l[d+2]+S;f[C++]=D,f[C++]=I,f[C++]=L,f[C++]=L+r,f[C++]=I+r,f[C++]=D+r}let v=new ut({attributes:o,indices:f,boundingSphere:ce.fromVertices(e),primitiveType:Me.TRIANGLES});if(i.normal&&(v=Fn.computeNormal(v)),i.tangent||i.bitangent){try{v=Fn.computeTangentAndBitangent(v)}catch{_t("polyline-volume-tangent-bitangent","Unable to compute tangents and bitangents for polyline volume geometry")}i.tangent||(v.attributes.tangent=void 0),i.bitangent||(v.attributes.bitangent=void 0),i.st||(v.attributes.st=void 0)}return v}function wv(e){e=y(e,y.EMPTY_OBJECT);let t=e.polylinePositions,n=e.shapePositions;if(!c(t))throw new E("options.polylinePositions is required.");if(!c(n))throw new E("options.shapePositions is required.");this._positions=t,this._shape=n,this._ellipsoid=ie.clone(y(e.ellipsoid,ie.default)),this._cornerType=y(e.cornerType,ki.ROUNDED),this._vertexFormat=Ie.clone(y(e.vertexFormat,Ie.DEFAULT)),this._granularity=y(e.granularity,R.RADIANS_PER_DEGREE),this._workerName="createPolylineVolumeGeometry";let i=1+t.length*h.packedLength;i+=1+n.length*H.packedLength,this.packedLength=i+ie.packedLength+Ie.packedLength+2}wv.pack=function(e,t,n){if(!c(e))throw new E("value is required");if(!c(t))throw new E("array is required");n=y(n,0);let i,o=e._positions,r=o.length;for(t[n++]=r,i=0;i<r;++i,n+=h.packedLength)h.pack(o[i],t,n);let s=e._shape;for(r=s.length,t[n++]=r,i=0;i<r;++i,n+=H.packedLength)H.pack(s[i],t,n);return ie.pack(e._ellipsoid,t,n),n+=ie.packedLength,Ie.pack(e._vertexFormat,t,n),n+=Ie.packedLength,t[n++]=e._cornerType,t[n]=e._granularity,t};var ife=ie.clone(ie.UNIT_SPHERE),ofe=new Ie,Sv={polylinePositions:void 0,shapePositions:void 0,ellipsoid:ife,vertexFormat:ofe,cornerType:void 0,granularity:void 0};wv.unpack=function(e,t,n){if(!c(e))throw new E("array is required");t=y(t,0);let i,o=e[t++],r=new Array(o);for(i=0;i<o;++i,t+=h.packedLength)r[i]=h.unpack(e,t);o=e[t++];let s=new Array(o);for(i=0;i<o;++i,t+=H.packedLength)s[i]=H.unpack(e,t);let a=ie.unpack(e,t,ife);t+=ie.packedLength;let l=Ie.unpack(e,t,ofe);t+=Ie.packedLength;let u=e[t++],f=e[t];return c(n)?(n._positions=r,n._shape=s,n._ellipsoid=ie.clone(a,n._ellipsoid),n._vertexFormat=Ie.clone(l,n._vertexFormat),n._cornerType=u,n._granularity=f,n):(Sv.polylinePositions=r,Sv.shapePositions=s,Sv.cornerType=u,Sv.granularity=f,new wv(Sv))};var aKe=new Ke;wv.createGeometry=function(e){let t=e._positions,n=Ao(t,h.equalsEpsilon),i=e._shape;if(i=Ip.removeDuplicatesFromShape(i),n.length<2||i.length<3)return;ai.computeWindingOrder2D(i)===ls.CLOCKWISE&&i.reverse();let o=Ke.fromPoints(i,aKe),r=Ip.computePositions(n,i,o,e,!0);return sKe(r,i,o,e._vertexFormat)};var A6=wv;function cKe(e,t){let n=new pn;n.position=new we({componentDatatype:$.DOUBLE,componentsPerAttribute:3,values:e});let i=t.length,o=n.position.values.length/3,s=e.length/3/i,a=Fe.createTypedArray(o,2*i*(s+1)),l,u,f=0;l=0;let d=l*i;for(u=0;u<i-1;u++)a[f++]=u+d,a[f++]=u+d+1;for(a[f++]=i-1+d,a[f++]=d,l=s-1,d=l*i,u=0;u<i-1;u++)a[f++]=u+d,a[f++]=u+d+1;for(a[f++]=i-1+d,a[f++]=d,l=0;l<s-1;l++){let g=i*l,m=g+i;for(u=0;u<i;u++)a[f++]=u+g,a[f++]=u+m}return new ut({attributes:n,indices:Fe.createTypedArray(o,a),boundingSphere:ce.fromVertices(e),primitiveType:Me.LINES})}function Dv(e){e=y(e,y.EMPTY_OBJECT);let t=e.polylinePositions,n=e.shapePositions;if(!c(t))throw new E("options.polylinePositions is required.");if(!c(n))throw new E("options.shapePositions is required.");this._positions=t,this._shape=n,this._ellipsoid=ie.clone(y(e.ellipsoid,ie.default)),this._cornerType=y(e.cornerType,ki.ROUNDED),this._granularity=y(e.granularity,R.RADIANS_PER_DEGREE),this._workerName="createPolylineVolumeOutlineGeometry";let i=1+t.length*h.packedLength;i+=1+n.length*H.packedLength,this.packedLength=i+ie.packedLength+2}Dv.pack=function(e,t,n){if(!c(e))throw new E("value is required");if(!c(t))throw new E("array is required");n=y(n,0);let i,o=e._positions,r=o.length;for(t[n++]=r,i=0;i<r;++i,n+=h.packedLength)h.pack(o[i],t,n);let s=e._shape;for(r=s.length,t[n++]=r,i=0;i<r;++i,n+=H.packedLength)H.pack(s[i],t,n);return ie.pack(e._ellipsoid,t,n),n+=ie.packedLength,t[n++]=e._cornerType,t[n]=e._granularity,t};var rfe=ie.clone(ie.UNIT_SPHERE),vv={polylinePositions:void 0,shapePositions:void 0,ellipsoid:rfe,height:void 0,cornerType:void 0,granularity:void 0};Dv.unpack=function(e,t,n){if(!c(e))throw new E("array is required");t=y(t,0);let i,o=e[t++],r=new Array(o);for(i=0;i<o;++i,t+=h.packedLength)r[i]=h.unpack(e,t);o=e[t++];let s=new Array(o);for(i=0;i<o;++i,t+=H.packedLength)s[i]=H.unpack(e,t);let a=ie.unpack(e,t,rfe);t+=ie.packedLength;let l=e[t++],u=e[t];return c(n)?(n._positions=r,n._shape=s,n._ellipsoid=ie.clone(a,n._ellipsoid),n._cornerType=l,n._granularity=u,n):(vv.polylinePositions=r,vv.shapePositions=s,vv.cornerType=l,vv.granularity=u,new Dv(vv))};var lKe=new Ke;Dv.createGeometry=function(e){let t=e._positions,n=Ao(t,h.equalsEpsilon),i=e._shape;if(i=Ip.removeDuplicatesFromShape(i),n.length<2||i.length<3)return;ai.computeWindingOrder2D(i)===ls.CLOCKWISE&&i.reverse();let o=Ke.fromPoints(i,lKe),r=Ip.computePositions(n,i,o,e,!1);return cKe(r,i)};var C6=Dv;var sfe=new j;function uKe(e){this.id=e,this.vertexFormat=void 0,this.polylinePositions=void 0,this.shapePositions=void 0,this.cornerType=void 0,this.granularity=void 0}function Fh(e,t){oi.call(this,{entity:e,scene:t,geometryOptions:new uKe(e),geometryPropertyName:"polylineVolume",observedPropertyNames:["availability","polylineVolume"]}),this._onEntityPropertyChanged(e,"polylineVolume",e.polylineVolume,void 0)}c(Object.create)&&(Fh.prototype=Object.create(oi.prototype),Fh.prototype.constructor=Fh);Fh.prototype.createFillGeometryInstance=function(e){if(A.defined("time",e),!this._fillEnabled)throw new E("This instance does not represent a filled geometry.");let t=this._entity,n=t.isAvailable(e),i,o,r=new Cn(n&&t.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),s=this._distanceDisplayConditionProperty.getValue(e),a=kn.fromDistanceDisplayCondition(s);if(this._materialProperty instanceof Ht){let l;c(this._materialProperty.color)&&(this._materialProperty.color.isConstant||n)&&(l=this._materialProperty.color.getValue(e,sfe)),c(l)||(l=j.WHITE),o=Wt.fromColor(l),i={show:r,distanceDisplayCondition:a,color:o}}else i={show:r,distanceDisplayCondition:a};return new vt({id:t,geometry:new A6(this._options),attributes:i})};Fh.prototype.createOutlineGeometryInstance=function(e){if(A.defined("time",e),!this._outlineEnabled)throw new E("This instance does not represent an outlined geometry.");let t=this._entity,n=t.isAvailable(e),i=X.getValueOrDefault(this._outlineColorProperty,e,j.BLACK,sfe),o=this._distanceDisplayConditionProperty.getValue(e);return new vt({id:t,geometry:new C6(this._options),attributes:{show:new Cn(n&&t.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:Wt.fromColor(i),distanceDisplayCondition:kn.fromDistanceDisplayCondition(o)}})};Fh.prototype._isHidden=function(e,t){return!c(t.positions)||!c(t.shape)||oi.prototype._isHidden.call(this,e,t)};Fh.prototype._isDynamic=function(e,t){return!t.positions.isConstant||!t.shape.isConstant||!X.isConstant(t.granularity)||!X.isConstant(t.outlineWidth)||!X.isConstant(t.cornerType)};Fh.prototype._setStaticOptions=function(e,t){let n=t.granularity,i=t.cornerType,o=this._options,r=this._materialProperty instanceof Ht;o.vertexFormat=r?ln.VERTEX_FORMAT:uo.MaterialSupport.TEXTURED.vertexFormat,o.polylinePositions=t.positions.getValue(je.MINIMUM_VALUE,o.polylinePositions),o.shapePositions=t.shape.getValue(je.MINIMUM_VALUE,o.shape),o.granularity=c(n)?n.getValue(je.MINIMUM_VALUE):void 0,o.cornerType=c(i)?i.getValue(je.MINIMUM_VALUE):void 0};Fh.DynamicGeometryUpdater=DA;function DA(e,t,n){ii.call(this,e,t,n)}c(Object.create)&&(DA.prototype=Object.create(ii.prototype),DA.prototype.constructor=DA);DA.prototype._isHidden=function(e,t,n){let i=this._options;return!c(i.polylinePositions)||!c(i.shapePositions)||ii.prototype._isHidden.call(this,e,t,n)};DA.prototype._setOptions=function(e,t,n){let i=this._options;i.polylinePositions=X.getValueOrUndefined(t.positions,n,i.polylinePositions),i.shapePositions=X.getValueOrUndefined(t.shape,n),i.granularity=X.getValueOrUndefined(t.granularity,n),i.cornerType=X.getValueOrUndefined(t.cornerType,n)};var E6=Fh;var S6=new h,lfe=new h,ufe=new h,ffe=new h,dfe=new ae,fKe=new H,dKe=new ce,hKe=new ce;function hfe(e,t){let n=new ut({attributes:new pn,primitiveType:Me.TRIANGLES});return n.attributes.position=new we({componentDatatype:$.DOUBLE,componentsPerAttribute:3,values:t.positions}),e.normal&&(n.attributes.normal=new we({componentDatatype:$.FLOAT,componentsPerAttribute:3,values:t.normals})),e.tangent&&(n.attributes.tangent=new we({componentDatatype:$.FLOAT,componentsPerAttribute:3,values:t.tangents})),e.bitangent&&(n.attributes.bitangent=new we({componentDatatype:$.FLOAT,componentsPerAttribute:3,values:t.bitangents})),n}function mKe(e,t,n,i){let o=e.length,r=t.normal?new Float32Array(o):void 0,s=t.tangent?new Float32Array(o):void 0,a=t.bitangent?new Float32Array(o):void 0,l=0,u=ffe,f=ufe,d=lfe;if(t.normal||t.tangent||t.bitangent)for(let p=0;p<o;p+=3){let g=h.fromArray(e,p,S6),m=l+1,b=l+2;d=n.geodeticSurfaceNormal(g,d),(t.tangent||t.bitangent)&&(h.cross(h.UNIT_Z,d,f),Q.multiplyByVector(i,f,f),h.normalize(f,f),t.bitangent&&h.normalize(h.cross(d,f,u),u)),t.normal&&(r[l]=d.x,r[m]=d.y,r[b]=d.z),t.tangent&&(s[l]=f.x,s[m]=f.y,s[b]=f.z),t.bitangent&&(a[l]=u.x,a[m]=u.y,a[b]=u.z),l+=3}return hfe(t,{positions:e,normals:r,tangents:s,bitangents:a})}var w6=new h,mfe=new h;function pKe(e,t,n){let i=e.length,o=t.normal?new Float32Array(i):void 0,r=t.tangent?new Float32Array(i):void 0,s=t.bitangent?new Float32Array(i):void 0,a=0,l=0,u=0,f=!0,d=ffe,p=ufe,g=lfe;if(t.normal||t.tangent||t.bitangent)for(let m=0;m<i;m+=6){let b=h.fromArray(e,m,S6),x=h.fromArray(e,(m+6)%i,w6);if(f){let T=h.fromArray(e,(m+3)%i,mfe);h.subtract(x,b,x),h.subtract(T,b,T),g=h.normalize(h.cross(T,x,g),g),f=!1}h.equalsEpsilon(x,b,R.EPSILON10)&&(f=!0),(t.tangent||t.bitangent)&&(d=n.geodeticSurfaceNormal(b,d),t.tangent&&(p=h.normalize(h.cross(d,g,p),p))),t.normal&&(o[a++]=g.x,o[a++]=g.y,o[a++]=g.z,o[a++]=g.x,o[a++]=g.y,o[a++]=g.z),t.tangent&&(r[l++]=p.x,r[l++]=p.y,r[l++]=p.z,r[l++]=p.x,r[l++]=p.y,r[l++]=p.z),t.bitangent&&(s[u++]=d.x,s[u++]=d.y,s[u++]=d.z,s[u++]=d.x,s[u++]=d.y,s[u++]=d.z)}return hfe(t,{positions:e,normals:o,tangents:r,bitangents:s})}function pfe(e,t){let n=e._vertexFormat,i=e._ellipsoid,o=t.height,r=t.width,s=t.northCap,a=t.southCap,l=0,u=o,f=o,d=0;s&&(l=1,f-=1,d+=1),a&&(u-=1,f-=1,d+=1),d+=r*f;let p=n.position?new Float64Array(d*3):void 0,g=n.st?new Float32Array(d*2):void 0,m=0,b=0,x=S6,T=fKe,C=Number.MAX_VALUE,S=Number.MAX_VALUE,v=-Number.MAX_VALUE,D=-Number.MAX_VALUE;for(let w=l;w<u;++w)for(let P=0;P<r;++P)Js.computePosition(t,i,n.st,w,P,x,T),p[m++]=x.x,p[m++]=x.y,p[m++]=x.z,n.st&&(g[b++]=T.x,g[b++]=T.y,C=Math.min(C,T.x),S=Math.min(S,T.y),v=Math.max(v,T.x),D=Math.max(D,T.y));if(s&&(Js.computePosition(t,i,n.st,0,0,x,T),p[m++]=x.x,p[m++]=x.y,p[m++]=x.z,n.st&&(g[b++]=T.x,g[b++]=T.y,C=T.x,S=T.y,v=T.x,D=T.y)),a&&(Js.computePosition(t,i,n.st,o-1,0,x,T),p[m++]=x.x,p[m++]=x.y,p[m]=x.z,n.st&&(g[b++]=T.x,g[b]=T.y,C=Math.min(C,T.x),S=Math.min(S,T.y),v=Math.max(v,T.x),D=Math.max(D,T.y))),n.st&&(C<0||S<0||v>1||D>1))for(let w=0;w<g.length;w+=2)g[w]=(g[w]-C)/(v-C),g[w+1]=(g[w+1]-S)/(D-S);let I=mKe(p,n,i,t.tangentRotationMatrix),L=6*(r-1)*(f-1);s&&(L+=3*(r-1)),a&&(L+=3*(r-1));let M=Fe.createTypedArray(d,L),N=0,B=0,_;for(_=0;_<f-1;++_){for(let w=0;w<r-1;++w){let P=N,O=P+r,F=O+1,V=P+1;M[B++]=P,M[B++]=O,M[B++]=V,M[B++]=V,M[B++]=O,M[B++]=F,++N}++N}if(s||a){let w=d-1,P=d-1;s&&a&&(w=d-2);let O,F;if(N=0,s)for(_=0;_<r-1;_++)O=N,F=O+1,M[B++]=w,M[B++]=O,M[B++]=F,++N;if(a)for(N=(f-1)*r,_=0;_<r-1;_++)O=N,F=O+1,M[B++]=O,M[B++]=P,M[B++]=F,++N}return I.indices=M,n.st&&(I.attributes.st=new we({componentDatatype:$.FLOAT,componentsPerAttribute:2,values:g})),I}function PA(e,t,n,i,o){return e[t++]=i[n],e[t++]=i[n+1],e[t++]=i[n+2],e[t++]=o[n],e[t++]=o[n+1],e[t]=o[n+2],e}function IA(e,t,n,i){return e[t++]=i[n],e[t++]=i[n+1],e[t++]=i[n],e[t]=i[n+1],e}var v6=new Ie;function _Ke(e,t){let n=e._shadowVolume,i=e._offsetAttribute,o=e._vertexFormat,r=e._extrudedHeight,s=e._surfaceHeight,a=e._ellipsoid,l=t.height,u=t.width,f;if(n){let He=Ie.clone(o,v6);He.normal=!0,e._vertexFormat=He}let d=pfe(e,t);n&&(e._vertexFormat=o);let p=ai.scaleToGeodeticHeight(d.attributes.position.values,s,a,!1);p=new Float64Array(p);let g=p.length,m=g*2,b=new Float64Array(m);b.set(p);let x=ai.scaleToGeodeticHeight(d.attributes.position.values,r,a);b.set(x,g),d.attributes.position.values=b;let T=o.normal?new Float32Array(m):void 0,C=o.tangent?new Float32Array(m):void 0,S=o.bitangent?new Float32Array(m):void 0,v=o.st?new Float32Array(m/3*2):void 0,D,I;if(o.normal){for(I=d.attributes.normal.values,T.set(I),f=0;f<g;f++)I[f]=-I[f];T.set(I,g),d.attributes.normal.values=T}if(n){I=d.attributes.normal.values,o.normal||(d.attributes.normal=void 0);let He=new Float32Array(m);for(f=0;f<g;f++)I[f]=-I[f];He.set(I,g),d.attributes.extrudeDirection=new we({componentDatatype:$.FLOAT,componentsPerAttribute:3,values:He})}let L,M=c(i);if(M){let He=g/3*2,tn=new Uint8Array(He);i===Jt.TOP?tn=tn.fill(1,0,He/2):(L=i===Jt.NONE?0:1,tn=tn.fill(L)),d.attributes.applyOffset=new we({componentDatatype:$.UNSIGNED_BYTE,componentsPerAttribute:1,values:tn})}if(o.tangent){let He=d.attributes.tangent.values;for(C.set(He),f=0;f<g;f++)He[f]=-He[f];C.set(He,g),d.attributes.tangent.values=C}if(o.bitangent){let He=d.attributes.bitangent.values;S.set(He),S.set(He,g),d.attributes.bitangent.values=S}o.st&&(D=d.attributes.st.values,v.set(D),v.set(D,g/3*2),d.attributes.st.values=v);let N=d.indices,B=N.length,_=g/3,w=Fe.createTypedArray(m/3,B*2);for(w.set(N),f=0;f<B;f+=3)w[f+B]=N[f+2]+_,w[f+1+B]=N[f+1]+_,w[f+2+B]=N[f]+_;d.indices=w;let P=t.northCap,O=t.southCap,F=l,V=2,G=0,z=4,W=4;P&&(V-=1,F-=1,G+=1,z-=2,W-=1),O&&(V-=1,F-=1,G+=1,z-=2,W-=1),G+=V*u+2*F-z;let U=(G+W)*2,q=new Float64Array(U*3),K=n?new Float32Array(U*3):void 0,te=M?new Uint8Array(U):void 0,Y=o.st?new Float32Array(U*2):void 0,Z=i===Jt.TOP;M&&!Z&&(L=i===Jt.ALL?1:0,te=te.fill(L));let ee=0,me=0,be=0,le=0,ge=u*F,xe;for(f=0;f<ge;f+=u)xe=f*3,q=PA(q,ee,xe,p,x),ee+=6,o.st&&(Y=IA(Y,me,f*2,D),me+=4),n&&(be+=3,K[be++]=I[xe],K[be++]=I[xe+1],K[be++]=I[xe+2]),Z&&(te[le++]=1,le+=1);if(O){let He=P?ge+1:ge;for(xe=He*3,f=0;f<2;f++)q=PA(q,ee,xe,p,x),ee+=6,o.st&&(Y=IA(Y,me,He*2,D),me+=4),n&&(be+=3,K[be++]=I[xe],K[be++]=I[xe+1],K[be++]=I[xe+2]),Z&&(te[le++]=1,le+=1)}else for(f=ge-u;f<ge;f++)xe=f*3,q=PA(q,ee,xe,p,x),ee+=6,o.st&&(Y=IA(Y,me,f*2,D),me+=4),n&&(be+=3,K[be++]=I[xe],K[be++]=I[xe+1],K[be++]=I[xe+2]),Z&&(te[le++]=1,le+=1);for(f=ge-1;f>0;f-=u)xe=f*3,q=PA(q,ee,xe,p,x),ee+=6,o.st&&(Y=IA(Y,me,f*2,D),me+=4),n&&(be+=3,K[be++]=I[xe],K[be++]=I[xe+1],K[be++]=I[xe+2]),Z&&(te[le++]=1,le+=1);if(P){let He=ge;for(xe=He*3,f=0;f<2;f++)q=PA(q,ee,xe,p,x),ee+=6,o.st&&(Y=IA(Y,me,He*2,D),me+=4),n&&(be+=3,K[be++]=I[xe],K[be++]=I[xe+1],K[be++]=I[xe+2]),Z&&(te[le++]=1,le+=1)}else for(f=u-1;f>=0;f--)xe=f*3,q=PA(q,ee,xe,p,x),ee+=6,o.st&&(Y=IA(Y,me,f*2,D),me+=4),n&&(be+=3,K[be++]=I[xe],K[be++]=I[xe+1],K[be++]=I[xe+2]),Z&&(te[le++]=1,le+=1);let Pe=pKe(q,o,a);o.st&&(Pe.attributes.st=new we({componentDatatype:$.FLOAT,componentsPerAttribute:2,values:Y})),n&&(Pe.attributes.extrudeDirection=new we({componentDatatype:$.FLOAT,componentsPerAttribute:3,values:K})),M&&(Pe.attributes.applyOffset=new we({componentDatatype:$.UNSIGNED_BYTE,componentsPerAttribute:1,values:te}));let Ee=Fe.createTypedArray(U,G*6),Ue,Ye,it,It;g=q.length/3;let Ot=0;for(f=0;f<g-1;f+=2){Ue=f,It=(Ue+2)%g;let He=h.fromArray(q,Ue*3,w6),tn=h.fromArray(q,It*3,mfe);h.equalsEpsilon(He,tn,R.EPSILON10)||(Ye=(Ue+1)%g,it=(Ye+2)%g,Ee[Ot++]=Ue,Ee[Ot++]=Ye,Ee[Ot++]=It,Ee[Ot++]=It,Ee[Ot++]=Ye,Ee[Ot++]=it)}return Pe.indices=Ee,Pe=Fn.combineInstances([new vt({geometry:d}),new vt({geometry:Pe})]),Pe[0]}var gKe=[new h,new h,new h,new h],_fe=new he,yKe=new he;function D6(e,t,n,i,o){if(n===0)return ae.clone(e,o);let r=Js.computeOptions(e,t,n,0,dfe,_fe),s=r.height,a=r.width,l=gKe;return Js.computePosition(r,i,!1,0,0,l[0]),Js.computePosition(r,i,!1,0,a-1,l[1]),Js.computePosition(r,i,!1,s-1,0,l[2]),Js.computePosition(r,i,!1,s-1,a-1,l[3]),ae.fromCartesianArray(l,i,o)}function Bh(e){e=y(e,y.EMPTY_OBJECT);let t=e.rectangle;if(A.typeOf.object("rectangle",t),ae._validate(t),t.north<t.south)throw new E("options.rectangle.north must be greater than or equal to options.rectangle.south");let n=y(e.height,0),i=y(e.extrudedHeight,n);this._rectangle=ae.clone(t),this._granularity=y(e.granularity,R.RADIANS_PER_DEGREE),this._ellipsoid=ie.clone(y(e.ellipsoid,ie.default)),this._surfaceHeight=Math.max(n,i),this._rotation=y(e.rotation,0),this._stRotation=y(e.stRotation,0),this._vertexFormat=Ie.clone(y(e.vertexFormat,Ie.DEFAULT)),this._extrudedHeight=Math.min(n,i),this._shadowVolume=y(e.shadowVolume,!1),this._workerName="createRectangleGeometry",this._offsetAttribute=e.offsetAttribute,this._rotatedRectangle=void 0,this._textureCoordinateRotationPoints=void 0}Bh.packedLength=ae.packedLength+ie.packedLength+Ie.packedLength+7;Bh.pack=function(e,t,n){return A.typeOf.object("value",e),A.defined("array",t),n=y(n,0),ae.pack(e._rectangle,t,n),n+=ae.packedLength,ie.pack(e._ellipsoid,t,n),n+=ie.packedLength,Ie.pack(e._vertexFormat,t,n),n+=Ie.packedLength,t[n++]=e._granularity,t[n++]=e._surfaceHeight,t[n++]=e._rotation,t[n++]=e._stRotation,t[n++]=e._extrudedHeight,t[n++]=e._shadowVolume?1:0,t[n]=y(e._offsetAttribute,-1),t};var gfe=new ae,yfe=ie.clone(ie.UNIT_SPHERE),Sg={rectangle:gfe,ellipsoid:yfe,vertexFormat:v6,granularity:void 0,height:void 0,rotation:void 0,stRotation:void 0,extrudedHeight:void 0,shadowVolume:void 0,offsetAttribute:void 0};Bh.unpack=function(e,t,n){A.defined("array",e),t=y(t,0);let i=ae.unpack(e,t,gfe);t+=ae.packedLength;let o=ie.unpack(e,t,yfe);t+=ie.packedLength;let r=Ie.unpack(e,t,v6);t+=Ie.packedLength;let s=e[t++],a=e[t++],l=e[t++],u=e[t++],f=e[t++],d=e[t++]===1,p=e[t];return c(n)?(n._rectangle=ae.clone(i,n._rectangle),n._ellipsoid=ie.clone(o,n._ellipsoid),n._vertexFormat=Ie.clone(r,n._vertexFormat),n._granularity=s,n._surfaceHeight=a,n._rotation=l,n._stRotation=u,n._extrudedHeight=f,n._shadowVolume=d,n._offsetAttribute=p===-1?void 0:p,n):(Sg.granularity=s,Sg.height=a,Sg.rotation=l,Sg.stRotation=u,Sg.extrudedHeight=f,Sg.shadowVolume=d,Sg.offsetAttribute=p===-1?void 0:p,new Bh(Sg))};Bh.computeRectangle=function(e,t){e=y(e,y.EMPTY_OBJECT);let n=e.rectangle;if(A.typeOf.object("rectangle",n),ae._validate(n),n.north<n.south)throw new E("options.rectangle.north must be greater than or equal to options.rectangle.south");let i=y(e.granularity,R.RADIANS_PER_DEGREE),o=y(e.ellipsoid,ie.default),r=y(e.rotation,0);return D6(n,i,r,o,t)};var bKe=new Q,afe=new Ne,xKe=new he;Bh.createGeometry=function(e){if(R.equalsEpsilon(e._rectangle.north,e._rectangle.south,R.EPSILON10)||R.equalsEpsilon(e._rectangle.east,e._rectangle.west,R.EPSILON10))return;let t=e._rectangle,n=e._ellipsoid,i=e._rotation,o=e._stRotation,r=e._vertexFormat,s=Js.computeOptions(t,e._granularity,i,o,dfe,_fe,yKe),a=bKe;if(o!==0||i!==0){let g=ae.center(t,xKe),m=n.geodeticSurfaceNormalCartographic(g,w6);Ne.fromAxisAngle(m,-o,afe),Q.fromQuaternion(afe,a)}else Q.clone(Q.IDENTITY,a);let l=e._surfaceHeight,u=e._extrudedHeight,f=!R.equalsEpsilon(l,u,0,R.EPSILON2);s.lonScalar=1/e._rectangle.width,s.latScalar=1/e._rectangle.height,s.tangentRotationMatrix=a;let d,p;if(t=e._rectangle,f){d=_Ke(e,s);let g=ce.fromRectangle3D(t,n,l,hKe),m=ce.fromRectangle3D(t,n,u,dKe);p=ce.union(g,m)}else{if(d=pfe(e,s),d.attributes.position.values=ai.scaleToGeodeticHeight(d.attributes.position.values,l,n,!1),c(e._offsetAttribute)){let g=d.attributes.position.values.length,m=e._offsetAttribute===Jt.NONE?0:1,b=new Uint8Array(g/3).fill(m);d.attributes.applyOffset=new we({componentDatatype:$.UNSIGNED_BYTE,componentsPerAttribute:1,values:b})}p=ce.fromRectangle3D(t,n,l)}return r.position||delete d.attributes.position,new ut({attributes:d.attributes,indices:d.indices,primitiveType:d.primitiveType,boundingSphere:p,offsetAttribute:e._offsetAttribute})};Bh.createShadowVolume=function(e,t,n){let i=e._granularity,o=e._ellipsoid,r=t(i,o),s=n(i,o);return new Bh({rectangle:e._rectangle,rotation:e._rotation,ellipsoid:o,stRotation:e._stRotation,granularity:i,extrudedHeight:s,height:r,vertexFormat:Ie.POSITION_ONLY,shadowVolume:!0})};var cfe=new ae,TKe=[new H,new H,new H],AKe=new Gi,CKe=new he;function EKe(e){if(e._stRotation===0)return[0,0,0,1,1,0];let t=ae.clone(e._rectangle,cfe),n=e._granularity,i=e._ellipsoid,o=e._rotation-e._stRotation,r=D6(t,n,o,i,cfe),s=TKe;s[0].x=r.west,s[0].y=r.south,s[1].x=r.west,s[1].y=r.north,s[2].x=r.east,s[2].y=r.south;let a=e.rectangle,l=Gi.fromRotation(e._stRotation,AKe),u=ae.center(a,CKe);for(let m=0;m<3;++m){let b=s[m];b.x-=u.longitude,b.y-=u.latitude,Gi.multiplyByVector(l,b,b),b.x+=u.longitude,b.y+=u.latitude,b.x=(b.x-a.west)/a.width,b.y=(b.y-a.south)/a.height}let f=s[0],d=s[1],p=s[2],g=new Array(6);return H.pack(f,g),H.pack(d,g,2),H.pack(p,g,4),g}Object.defineProperties(Bh.prototype,{rectangle:{get:function(){return c(this._rotatedRectangle)||(this._rotatedRectangle=D6(this._rectangle,this._granularity,this._rotation,this._ellipsoid)),this._rotatedRectangle}},textureCoordinateRotationPoints:{get:function(){return c(this._textureCoordinateRotationPoints)||(this._textureCoordinateRotationPoints=EKe(this)),this._textureCoordinateRotationPoints}}});var Pv=Bh;var bfe=new j,xfe=h.ZERO,Tfe=new h,Afe=new ae,SKe=new ae,wKe=new he;function vKe(e){this.id=e,this.vertexFormat=void 0,this.rectangle=void 0,this.height=void 0,this.extrudedHeight=void 0,this.granularity=void 0,this.stRotation=void 0,this.rotation=void 0,this.offsetAttribute=void 0}function Ad(e,t){jn.call(this,{entity:e,scene:t,geometryOptions:new vKe(e),geometryPropertyName:"rectangle",observedPropertyNames:["availability","rectangle"]}),this._onEntityPropertyChanged(e,"rectangle",e.rectangle,void 0)}c(Object.create)&&(Ad.prototype=Object.create(jn.prototype),Ad.prototype.constructor=Ad);Ad.prototype.createFillGeometryInstance=function(e){if(A.defined("time",e),!this._fillEnabled)throw new E("This instance does not represent a filled geometry.");let t=this._entity,n=t.isAvailable(e),i={show:new Cn(n&&t.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),distanceDisplayCondition:kn.fromDistanceDisplayCondition(this._distanceDisplayConditionProperty.getValue(e)),offset:void 0,color:void 0};if(this._materialProperty instanceof Ht){let o;c(this._materialProperty.color)&&(this._materialProperty.color.isConstant||n)&&(o=this._materialProperty.color.getValue(e,bfe)),c(o)||(o=j.WHITE),i.color=Wt.fromColor(o)}return c(this._options.offsetAttribute)&&(i.offset=Qi.fromCartesian3(X.getValueOrDefault(this._terrainOffsetProperty,e,xfe,Tfe))),new vt({id:t,geometry:new Pv(this._options),attributes:i})};Ad.prototype.createOutlineGeometryInstance=function(e){if(A.defined("time",e),!this._outlineEnabled)throw new E("This instance does not represent an outlined geometry.");let t=this._entity,n=t.isAvailable(e),i=X.getValueOrDefault(this._outlineColorProperty,e,j.BLACK,bfe),o=this._distanceDisplayConditionProperty.getValue(e),r={show:new Cn(n&&t.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:Wt.fromColor(i),distanceDisplayCondition:kn.fromDistanceDisplayCondition(o),offset:void 0};return c(this._options.offsetAttribute)&&(r.offset=Qi.fromCartesian3(X.getValueOrDefault(this._terrainOffsetProperty,e,xfe,Tfe))),new vt({id:t,geometry:new Hw(this._options),attributes:r})};Ad.prototype._computeCenter=function(e,t){let n=X.getValueOrUndefined(this._entity.rectangle.coordinates,e,SKe);if(!c(n))return;let i=ae.center(n,wKe);return he.toCartesian(i,ie.default,t)};Ad.prototype._isHidden=function(e,t){return!c(t.coordinates)||oi.prototype._isHidden.call(this,e,t)};Ad.prototype._isDynamic=function(e,t){return!t.coordinates.isConstant||!X.isConstant(t.height)||!X.isConstant(t.extrudedHeight)||!X.isConstant(t.granularity)||!X.isConstant(t.stRotation)||!X.isConstant(t.rotation)||!X.isConstant(t.outlineWidth)||!X.isConstant(t.zIndex)||this._onTerrain&&!X.isConstant(this._materialProperty)&&!(this._materialProperty instanceof Ht)};Ad.prototype._setStaticOptions=function(e,t){let n=this._materialProperty instanceof Ht,i=X.getValueOrUndefined(t.height,je.MINIMUM_VALUE),o=X.getValueOrDefault(t.heightReference,je.MINIMUM_VALUE,$e.NONE),r=X.getValueOrUndefined(t.extrudedHeight,je.MINIMUM_VALUE),s=X.getValueOrDefault(t.extrudedHeightReference,je.MINIMUM_VALUE,$e.NONE);c(r)&&!c(i)&&(i=0);let a=this._options;a.vertexFormat=n?ln.VERTEX_FORMAT:uo.MaterialSupport.TEXTURED.vertexFormat,a.rectangle=t.coordinates.getValue(je.MINIMUM_VALUE,a.rectangle),a.granularity=X.getValueOrUndefined(t.granularity,je.MINIMUM_VALUE),a.stRotation=X.getValueOrUndefined(t.stRotation,je.MINIMUM_VALUE),a.rotation=X.getValueOrUndefined(t.rotation,je.MINIMUM_VALUE),a.offsetAttribute=jn.computeGeometryOffsetAttribute(i,o,r,s),a.height=jn.getGeometryHeight(i,o),r=jn.getGeometryExtrudedHeight(r,s),r===jn.CLAMP_TO_GROUND&&(r=di.getMinimumMaximumHeights(Pv.computeRectangle(a,Afe)).minimumTerrainHeight),a.extrudedHeight=r};Ad.DynamicGeometryUpdater=OA;function OA(e,t,n){ii.call(this,e,t,n)}c(Object.create)&&(OA.prototype=Object.create(ii.prototype),OA.prototype.constructor=OA);OA.prototype._isHidden=function(e,t,n){return!c(this._options.rectangle)||ii.prototype._isHidden.call(this,e,t,n)};OA.prototype._setOptions=function(e,t,n){let i=this._options,o=X.getValueOrUndefined(t.height,n),r=X.getValueOrDefault(t.heightReference,n,$e.NONE),s=X.getValueOrUndefined(t.extrudedHeight,n),a=X.getValueOrDefault(t.extrudedHeightReference,n,$e.NONE);c(s)&&!c(o)&&(o=0),i.rectangle=X.getValueOrUndefined(t.coordinates,n,i.rectangle),i.granularity=X.getValueOrUndefined(t.granularity,n),i.stRotation=X.getValueOrUndefined(t.stRotation,n),i.rotation=X.getValueOrUndefined(t.rotation,n),i.offsetAttribute=jn.computeGeometryOffsetAttribute(o,r,s,a),i.height=jn.getGeometryHeight(o,r),s=jn.getGeometryExtrudedHeight(s,a),s===jn.CLAMP_TO_GROUND&&(s=di.getMinimumMaximumHeights(Pv.computeRectangle(i,Afe)).minimumTerrainHeight),i.extrudedHeight=s};var P6=Ad;var Cfe={};function DKe(e,t){return R.equalsEpsilon(e.latitude,t.latitude,R.EPSILON10)&&R.equalsEpsilon(e.longitude,t.longitude,R.EPSILON10)}var PKe=new he,IKe=new he;function OKe(e,t,n,i){t=Ao(t,h.equalsEpsilon);let o=t.length;if(o<2)return;let r=c(i),s=c(n),a=new Array(o),l=new Array(o),u=new Array(o),f=t[0];a[0]=f;let d=e.cartesianToCartographic(f,PKe);s&&(d.height=n[0]),l[0]=d.height,r?u[0]=i[0]:u[0]=0;let p=l[0],g=u[0],m=p===g,b=1;for(let x=1;x<o;++x){let T=t[x],C=e.cartesianToCartographic(T,IKe);s&&(C.height=n[x]),m=m&&C.height===0,DKe(d,C)?d.height<C.height&&(l[b-1]=C.height):(a[b]=T,l[b]=C.height,r?u[b]=i[x]:u[b]=0,m=m&&l[b]===u[b],he.clone(C,d),++b)}if(!(m||b<2))return a.length=b,l.length=b,u.length=b,{positions:a,topHeights:l,bottomHeights:u}}var RKe=new Array(2),MKe=new Array(2),LKe={positions:void 0,height:void 0,granularity:void 0,ellipsoid:void 0};Cfe.computePositions=function(e,t,n,i,o,r){let s=OKe(e,t,n,i);if(!c(s))return;t=s.positions,n=s.topHeights,i=s.bottomHeights;let a=t.length,l=a-2,u,f,d=R.chordLength(o,e.maximumRadius),p=LKe;if(p.minDistance=d,p.ellipsoid=e,r){let g=0,m;for(m=0;m<a-1;m++)g+=Bi.numberOfPoints(t[m],t[m+1],d)+1;u=new Float64Array(g*3),f=new Float64Array(g*3);let b=RKe,x=MKe;p.positions=b,p.height=x;let T=0;for(m=0;m<a-1;m++){b[0]=t[m],b[1]=t[m+1],x[0]=n[m],x[1]=n[m+1];let C=Bi.generateArc(p);u.set(C,T),x[0]=i[m],x[1]=i[m+1],f.set(Bi.generateArc(p),T),T+=C.length}}else p.positions=t,p.height=n,u=new Float64Array(Bi.generateArc(p)),p.height=i,f=new Float64Array(Bi.generateArc(p));return{bottomPositions:f,topPositions:u,numCorners:l}};var Iv=Cfe;var I6=new h,vR=new h,NKe=new h,Efe=new h,FKe=new h,BKe=new h,kKe=new h;function db(e){e=y(e,y.EMPTY_OBJECT);let t=e.positions,n=e.maximumHeights,i=e.minimumHeights;if(!c(t))throw new E("options.positions is required.");if(c(n)&&n.length!==t.length)throw new E("options.positions and options.maximumHeights must have the same length.");if(c(i)&&i.length!==t.length)throw new E("options.positions and options.minimumHeights must have the same length.");let o=y(e.vertexFormat,Ie.DEFAULT),r=y(e.granularity,R.RADIANS_PER_DEGREE),s=y(e.ellipsoid,ie.default);this._positions=t,this._minimumHeights=i,this._maximumHeights=n,this._vertexFormat=Ie.clone(o),this._granularity=r,this._ellipsoid=ie.clone(s),this._workerName="createWallGeometry";let a=1+t.length*h.packedLength+2;c(i)&&(a+=i.length),c(n)&&(a+=n.length),this.packedLength=a+ie.packedLength+Ie.packedLength+1}db.pack=function(e,t,n){if(!c(e))throw new E("value is required");if(!c(t))throw new E("array is required");n=y(n,0);let i,o=e._positions,r=o.length;for(t[n++]=r,i=0;i<r;++i,n+=h.packedLength)h.pack(o[i],t,n);let s=e._minimumHeights;if(r=c(s)?s.length:0,t[n++]=r,c(s))for(i=0;i<r;++i)t[n++]=s[i];let a=e._maximumHeights;if(r=c(a)?a.length:0,t[n++]=r,c(a))for(i=0;i<r;++i)t[n++]=a[i];return ie.pack(e._ellipsoid,t,n),n+=ie.packedLength,Ie.pack(e._vertexFormat,t,n),n+=Ie.packedLength,t[n]=e._granularity,t};var Sfe=ie.clone(ie.UNIT_SPHERE),wfe=new Ie,Ov={positions:void 0,minimumHeights:void 0,maximumHeights:void 0,ellipsoid:Sfe,vertexFormat:wfe,granularity:void 0};db.unpack=function(e,t,n){if(!c(e))throw new E("array is required");t=y(t,0);let i,o=e[t++],r=new Array(o);for(i=0;i<o;++i,t+=h.packedLength)r[i]=h.unpack(e,t);o=e[t++];let s;if(o>0)for(s=new Array(o),i=0;i<o;++i)s[i]=e[t++];o=e[t++];let a;if(o>0)for(a=new Array(o),i=0;i<o;++i)a[i]=e[t++];let l=ie.unpack(e,t,Sfe);t+=ie.packedLength;let u=Ie.unpack(e,t,wfe);t+=Ie.packedLength;let f=e[t];return c(n)?(n._positions=r,n._minimumHeights=s,n._maximumHeights=a,n._ellipsoid=ie.clone(l,n._ellipsoid),n._vertexFormat=Ie.clone(u,n._vertexFormat),n._granularity=f,n):(Ov.positions=r,Ov.minimumHeights=s,Ov.maximumHeights=a,Ov.granularity=f,new db(Ov))};db.fromConstantHeights=function(e){e=y(e,y.EMPTY_OBJECT);let t=e.positions;if(!c(t))throw new E("options.positions is required.");let n,i,o=e.minimumHeight,r=e.maximumHeight,s=c(o),a=c(r);if(s||a){let u=t.length;n=s?new Array(u):void 0,i=a?new Array(u):void 0;for(let f=0;f<u;++f)s&&(n[f]=o),a&&(i[f]=r)}let l={positions:t,maximumHeights:i,minimumHeights:n,ellipsoid:e.ellipsoid,vertexFormat:e.vertexFormat};return new db(l)};db.createGeometry=function(e){let t=e._positions,n=e._minimumHeights,i=e._maximumHeights,o=e._vertexFormat,r=e._granularity,s=e._ellipsoid,a=Iv.computePositions(s,t,i,n,r,!0);if(!c(a))return;let l=a.bottomPositions,u=a.topPositions,f=a.numCorners,d=u.length,p=d*2,g=o.position?new Float64Array(p):void 0,m=o.normal?new Float32Array(p):void 0,b=o.tangent?new Float32Array(p):void 0,x=o.bitangent?new Float32Array(p):void 0,T=o.st?new Float32Array(p/3*2):void 0,C=0,S=0,v=0,D=0,I=0,L=kKe,M=BKe,N=FKe,B=!0;d/=3;let _,w=0,P=1/(d-f-1);for(_=0;_<d;++_){let z=_*3,W=h.fromArray(u,z,I6),U=h.fromArray(l,z,vR);if(o.position&&(g[C++]=U.x,g[C++]=U.y,g[C++]=U.z,g[C++]=W.x,g[C++]=W.y,g[C++]=W.z),o.st&&(T[I++]=w,T[I++]=0,T[I++]=w,T[I++]=1),o.normal||o.tangent||o.bitangent){let q=h.clone(h.ZERO,Efe),K=h.subtract(W,s.geodeticSurfaceNormal(W,vR),vR);if(_+1<d&&(q=h.fromArray(u,z+3,Efe)),B){let te=h.subtract(q,W,NKe),Y=h.subtract(K,W,I6);L=h.normalize(h.cross(Y,te,L),L),B=!1}h.equalsEpsilon(W,q,R.EPSILON10)?B=!0:(w+=P,o.tangent&&(M=h.normalize(h.subtract(q,W,M),M)),o.bitangent&&(N=h.normalize(h.cross(L,M,N),N))),o.normal&&(m[S++]=L.x,m[S++]=L.y,m[S++]=L.z,m[S++]=L.x,m[S++]=L.y,m[S++]=L.z),o.tangent&&(b[D++]=M.x,b[D++]=M.y,b[D++]=M.z,b[D++]=M.x,b[D++]=M.y,b[D++]=M.z),o.bitangent&&(x[v++]=N.x,x[v++]=N.y,x[v++]=N.z,x[v++]=N.x,x[v++]=N.y,x[v++]=N.z)}}let O=new pn;o.position&&(O.position=new we({componentDatatype:$.DOUBLE,componentsPerAttribute:3,values:g})),o.normal&&(O.normal=new we({componentDatatype:$.FLOAT,componentsPerAttribute:3,values:m})),o.tangent&&(O.tangent=new we({componentDatatype:$.FLOAT,componentsPerAttribute:3,values:b})),o.bitangent&&(O.bitangent=new we({componentDatatype:$.FLOAT,componentsPerAttribute:3,values:x})),o.st&&(O.st=new we({componentDatatype:$.FLOAT,componentsPerAttribute:2,values:T}));let F=p/3;p-=6*(f+1);let V=Fe.createTypedArray(F,p),G=0;for(_=0;_<F-2;_+=2){let z=_,W=_+2,U=h.fromArray(g,z*3,I6),q=h.fromArray(g,W*3,vR);if(h.equalsEpsilon(U,q,R.EPSILON10))continue;let K=_+1,te=_+3;V[G++]=K,V[G++]=z,V[G++]=te,V[G++]=te,V[G++]=z,V[G++]=W}return new ut({attributes:O,indices:V,primitiveType:Me.TRIANGLES,boundingSphere:new ce.fromVertices(g)})};var O6=db;var vfe=new h,Dfe=new h;function hb(e){e=y(e,y.EMPTY_OBJECT);let t=e.positions,n=e.maximumHeights,i=e.minimumHeights;if(!c(t))throw new E("options.positions is required.");if(c(n)&&n.length!==t.length)throw new E("options.positions and options.maximumHeights must have the same length.");if(c(i)&&i.length!==t.length)throw new E("options.positions and options.minimumHeights must have the same length.");let o=y(e.granularity,R.RADIANS_PER_DEGREE),r=y(e.ellipsoid,ie.default);this._positions=t,this._minimumHeights=i,this._maximumHeights=n,this._granularity=o,this._ellipsoid=ie.clone(r),this._workerName="createWallOutlineGeometry";let s=1+t.length*h.packedLength+2;c(i)&&(s+=i.length),c(n)&&(s+=n.length),this.packedLength=s+ie.packedLength+1}hb.pack=function(e,t,n){if(!c(e))throw new E("value is required");if(!c(t))throw new E("array is required");n=y(n,0);let i,o=e._positions,r=o.length;for(t[n++]=r,i=0;i<r;++i,n+=h.packedLength)h.pack(o[i],t,n);let s=e._minimumHeights;if(r=c(s)?s.length:0,t[n++]=r,c(s))for(i=0;i<r;++i)t[n++]=s[i];let a=e._maximumHeights;if(r=c(a)?a.length:0,t[n++]=r,c(a))for(i=0;i<r;++i)t[n++]=a[i];return ie.pack(e._ellipsoid,t,n),n+=ie.packedLength,t[n]=e._granularity,t};var Pfe=ie.clone(ie.UNIT_SPHERE),Rv={positions:void 0,minimumHeights:void 0,maximumHeights:void 0,ellipsoid:Pfe,granularity:void 0};hb.unpack=function(e,t,n){if(!c(e))throw new E("array is required");t=y(t,0);let i,o=e[t++],r=new Array(o);for(i=0;i<o;++i,t+=h.packedLength)r[i]=h.unpack(e,t);o=e[t++];let s;if(o>0)for(s=new Array(o),i=0;i<o;++i)s[i]=e[t++];o=e[t++];let a;if(o>0)for(a=new Array(o),i=0;i<o;++i)a[i]=e[t++];let l=ie.unpack(e,t,Pfe);t+=ie.packedLength;let u=e[t];return c(n)?(n._positions=r,n._minimumHeights=s,n._maximumHeights=a,n._ellipsoid=ie.clone(l,n._ellipsoid),n._granularity=u,n):(Rv.positions=r,Rv.minimumHeights=s,Rv.maximumHeights=a,Rv.granularity=u,new hb(Rv))};hb.fromConstantHeights=function(e){e=y(e,y.EMPTY_OBJECT);let t=e.positions;if(!c(t))throw new E("options.positions is required.");let n,i,o=e.minimumHeight,r=e.maximumHeight,s=c(o),a=c(r);if(s||a){let u=t.length;n=s?new Array(u):void 0,i=a?new Array(u):void 0;for(let f=0;f<u;++f)s&&(n[f]=o),a&&(i[f]=r)}let l={positions:t,maximumHeights:i,minimumHeights:n,ellipsoid:e.ellipsoid};return new hb(l)};hb.createGeometry=function(e){let t=e._positions,n=e._minimumHeights,i=e._maximumHeights,o=e._granularity,r=e._ellipsoid,s=Iv.computePositions(r,t,i,n,o,!1);if(!c(s))return;let a=s.bottomPositions,l=s.topPositions,u=l.length,f=u*2,d=new Float64Array(f),p=0;u/=3;let g;for(g=0;g<u;++g){let C=g*3,S=h.fromArray(l,C,vfe),v=h.fromArray(a,C,Dfe);d[p++]=v.x,d[p++]=v.y,d[p++]=v.z,d[p++]=S.x,d[p++]=S.y,d[p++]=S.z}let m=new pn({position:new we({componentDatatype:$.DOUBLE,componentsPerAttribute:3,values:d})}),b=f/3;f=2*b-4+b;let x=Fe.createTypedArray(b,f),T=0;for(g=0;g<b-2;g+=2){let C=g,S=g+2,v=h.fromArray(d,C*3,vfe),D=h.fromArray(d,S*3,Dfe);if(h.equalsEpsilon(v,D,R.EPSILON10))continue;let I=g+1,L=g+3;x[T++]=I,x[T++]=C,x[T++]=I,x[T++]=L,x[T++]=C,x[T++]=S}return x[T++]=b-2,x[T++]=b-1,new ut({attributes:m,indices:x,primitiveType:Me.LINES,boundingSphere:new ce.fromVertices(d)})};var R6=hb;var Ife=new j;function VKe(e){this.id=e,this.vertexFormat=void 0,this.positions=void 0,this.minimumHeights=void 0,this.maximumHeights=void 0,this.granularity=void 0}function Cd(e,t){oi.call(this,{entity:e,scene:t,geometryOptions:new VKe(e),geometryPropertyName:"wall",observedPropertyNames:["availability","wall"]}),this._onEntityPropertyChanged(e,"wall",e.wall,void 0)}c(Object.create)&&(Cd.prototype=Object.create(oi.prototype),Cd.prototype.constructor=Cd);Cd.prototype.createFillGeometryInstance=function(e){if(A.defined("time",e),!this._fillEnabled)throw new E("This instance does not represent a filled geometry.");let t=this._entity,n=t.isAvailable(e),i,o,r=new Cn(n&&t.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),s=this._distanceDisplayConditionProperty.getValue(e),a=kn.fromDistanceDisplayCondition(s);if(this._materialProperty instanceof Ht){let l;c(this._materialProperty.color)&&(this._materialProperty.color.isConstant||n)&&(l=this._materialProperty.color.getValue(e,Ife)),c(l)||(l=j.WHITE),o=Wt.fromColor(l),i={show:r,distanceDisplayCondition:a,color:o}}else i={show:r,distanceDisplayCondition:a};return new vt({id:t,geometry:new O6(this._options),attributes:i})};Cd.prototype.createOutlineGeometryInstance=function(e){if(A.defined("time",e),!this._outlineEnabled)throw new E("This instance does not represent an outlined geometry.");let t=this._entity,n=t.isAvailable(e),i=X.getValueOrDefault(this._outlineColorProperty,e,j.BLACK,Ife),o=this._distanceDisplayConditionProperty.getValue(e);return new vt({id:t,geometry:new R6(this._options),attributes:{show:new Cn(n&&t.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:Wt.fromColor(i),distanceDisplayCondition:kn.fromDistanceDisplayCondition(o)}})};Cd.prototype._isHidden=function(e,t){return!c(t.positions)||oi.prototype._isHidden.call(this,e,t)};Cd.prototype._getIsClosed=function(e){return!1};Cd.prototype._isDynamic=function(e,t){return!t.positions.isConstant||!X.isConstant(t.minimumHeights)||!X.isConstant(t.maximumHeights)||!X.isConstant(t.outlineWidth)||!X.isConstant(t.granularity)};Cd.prototype._setStaticOptions=function(e,t){let n=t.minimumHeights,i=t.maximumHeights,o=t.granularity,r=this._materialProperty instanceof Ht,s=this._options;s.vertexFormat=r?ln.VERTEX_FORMAT:uo.MaterialSupport.TEXTURED.vertexFormat,s.positions=t.positions.getValue(je.MINIMUM_VALUE,s.positions),s.minimumHeights=c(n)?n.getValue(je.MINIMUM_VALUE,s.minimumHeights):void 0,s.maximumHeights=c(i)?i.getValue(je.MINIMUM_VALUE,s.maximumHeights):void 0,s.granularity=c(o)?o.getValue(je.MINIMUM_VALUE):void 0};Cd.DynamicGeometryUpdater=RA;function RA(e,t,n){ii.call(this,e,t,n)}c(Object.create)&&(RA.prototype=Object.create(ii.prototype),RA.prototype.constructor=RA);RA.prototype._isHidden=function(e,t,n){return!c(this._options.positions)||ii.prototype._isHidden.call(this,e,t,n)};RA.prototype._setOptions=function(e,t,n){let i=this._options;i.positions=X.getValueOrUndefined(t.positions,n,i.positions),i.minimumHeights=X.getValueOrUndefined(t.minimumHeights,n,i.minimumHeights),i.maximumHeights=X.getValueOrUndefined(t.maximumHeights,n,i.maximumHeights),i.granularity=X.getValueOrUndefined(t.granularity,n)};var M6=Cd;var mb=[DU,U5,g5,l6,m6,y6,T6,E6,P6,M6];function pb(e,t){this.entity=e,this.scene=t;let n=new Array(mb.length),i=new pe,o=new yr;for(let r=0;r<n.length;r++){let s=new mb[r](e,t);o.add(s.geometryChanged,a=>{i.raiseEvent(a)}),n[r]=s}this.updaters=n,this.geometryChanged=i,this.eventHelper=o,this._removeEntitySubscription=e.definitionChanged.addEventListener(pb.prototype._onEntityPropertyChanged,this)}pb.prototype._onEntityPropertyChanged=function(e,t,n,i){let o=this.updaters;for(let r=0;r<o.length;r++)o[r]._onEntityPropertyChanged(e,t,n,i)};pb.prototype.forEach=function(e){let t=this.updaters;for(let n=0;n<t.length;n++)e(t[n])};pb.prototype.destroy=function(){this.eventHelper.removeAll();let e=this.updaters;for(let t=0;t<e.length;t++)e[t].destroy();this._removeEntitySubscription(),de(this)};pb.registerUpdater=function(e){mb.includes(e)||mb.push(e)};pb.unregisterUpdater=function(e){if(mb.includes(e)){let t=mb.indexOf(e);mb.splice(t,1)}};var Mv=pb;var Ofe=new j,UKe=new Bt,zKe=new Bt,HKe=h.ZERO,GKe=new h;function Ed(e,t,n,i,o,r,s){this.translucent=t,this.appearanceType=n,this.depthFailAppearanceType=i,this.depthFailMaterialProperty=o,this.depthFailMaterial=void 0,this.closed=r,this.shadows=s,this.primitives=e,this.createPrimitive=!1,this.waitingOnCreate=!1,this.primitive=void 0,this.oldPrimitive=void 0,this.geometry=new St,this.updaters=new St,this.updatersWithAttributes=new St,this.attributes=new St,this.subscriptions=new St,this.showsUpdated=new St,this.itemsToRemove=[],this.invalidated=!1;let a;c(o)&&(a=o.definitionChanged.addEventListener(Ed.prototype.onMaterialChanged,this)),this.removeMaterialSubscription=a}Ed.prototype.onMaterialChanged=function(){this.invalidated=!0};Ed.prototype.isMaterial=function(e){let t=this.depthFailMaterialProperty,n=e.depthFailMaterialProperty;return n===t?!0:c(t)?t.equals(n):!1};Ed.prototype.add=function(e,t){let n=e.id;if(this.createPrimitive=!0,this.geometry.set(n,t),this.updaters.set(n,e),!e.hasConstantFill||!e.fillMaterialProperty.isConstant||!X.isConstant(e.distanceDisplayConditionProperty)||!X.isConstant(e.terrainOffsetProperty))this.updatersWithAttributes.set(n,e);else{let i=this;this.subscriptions.set(n,e.entity.definitionChanged.addEventListener(function(o,r,s,a){r==="isShowing"&&i.showsUpdated.set(e.id,e)}))}};Ed.prototype.remove=function(e){let t=e.id;if(this.createPrimitive=this.geometry.remove(t)||this.createPrimitive,this.updaters.remove(t)){this.updatersWithAttributes.remove(t);let n=this.subscriptions.get(t);return c(n)&&(n(),this.subscriptions.remove(t),this.showsUpdated.remove(t)),!0}return!1};Ed.prototype.update=function(e){let t=!0,n=0,i=this.primitive,o=this.primitives,r;if(this.createPrimitive){let s=this.geometry.values;if(s.length>0){c(i)&&(c(this.oldPrimitive)?o.remove(i):this.oldPrimitive=i);let l;c(this.depthFailAppearanceType)&&(c(this.depthFailMaterialProperty)&&(this.depthFailMaterial=pr.getValue(e,this.depthFailMaterialProperty,this.depthFailMaterial)),l=new this.depthFailAppearanceType({material:this.depthFailMaterial,translucent:this.translucent,closed:this.closed})),i=new Rn({show:!1,asynchronous:!0,geometryInstances:s.slice(),appearance:new this.appearanceType({translucent:this.translucent,closed:this.closed}),depthFailAppearance:l,shadows:this.shadows}),o.add(i),t=!1}else{c(i)&&(o.remove(i),i=void 0);let l=this.oldPrimitive;c(l)&&(o.remove(l),this.oldPrimitive=void 0)}this.attributes.removeAll(),this.primitive=i,this.createPrimitive=!1,this.waitingOnCreate=!0}else if(c(i)&&i.ready){i.show=!0,c(this.oldPrimitive)&&(o.remove(this.oldPrimitive),this.oldPrimitive=void 0),c(this.depthFailAppearanceType)&&!(this.depthFailMaterialProperty instanceof Ht)&&(this.depthFailMaterial=pr.getValue(e,this.depthFailMaterialProperty,this.depthFailMaterial),this.primitive.depthFailAppearance.material=this.depthFailMaterial);let s=this.updatersWithAttributes.values,a=s.length,l=this.waitingOnCreate;for(r=0;r<a;r++){let u=s[r],f=this.geometry.get(u.id),d=this.attributes.get(f.id.id);if(c(d)||(d=i.getGeometryInstanceAttributes(f.id),this.attributes.set(f.id.id,d)),!u.fillMaterialProperty.isConstant||l){let x=u.fillMaterialProperty.color,T=X.getValueOrDefault(x,e,j.WHITE,Ofe);j.equals(d._lastColor,T)||(d._lastColor=j.clone(T,d._lastColor),d.color=Wt.toValue(T,d.color),(this.translucent&&d.color[3]===255||!this.translucent&&d.color[3]!==255)&&(this.itemsToRemove[n++]=u))}if(c(this.depthFailAppearanceType)&&u.depthFailMaterialProperty instanceof Ht&&(!u.depthFailMaterialProperty.isConstant||l)){let x=u.depthFailMaterialProperty.color,T=X.getValueOrDefault(x,e,j.WHITE,Ofe);j.equals(d._lastDepthFailColor,T)||(d._lastDepthFailColor=j.clone(T,d._lastDepthFailColor),d.depthFailColor=Wt.toValue(T,d.depthFailColor))}let p=u.entity.isShowing&&(u.hasConstantFill||u.isFilled(e)),g=d.show[0]===1;p!==g&&(d.show=Cn.toValue(p,d.show));let m=u.distanceDisplayConditionProperty;if(!X.isConstant(m)){let x=X.getValueOrDefault(m,e,zKe,UKe);Bt.equals(x,d._lastDistanceDisplayCondition)||(d._lastDistanceDisplayCondition=Bt.clone(x,d._lastDistanceDisplayCondition),d.distanceDisplayCondition=kn.toValue(x,d.distanceDisplayCondition))}let b=u.terrainOffsetProperty;if(!X.isConstant(b)){let x=X.getValueOrDefault(b,e,HKe,GKe);h.equals(x,d._lastOffset)||(d._lastOffset=h.clone(x,d._lastOffset),d.offset=Qi.toValue(x,d.offset))}}this.updateShows(i),this.waitingOnCreate=!1}else c(i)&&!i.ready&&(t=!1);return this.itemsToRemove.length=n,t};Ed.prototype.updateShows=function(e){let t=this.showsUpdated.values,n=t.length;for(let i=0;i<n;i++){let o=t[i],r=this.geometry.get(o.id),s=this.attributes.get(r.id.id);c(s)||(s=e.getGeometryInstanceAttributes(r.id),this.attributes.set(r.id.id,s));let a=o.entity.isShowing,l=s.show[0]===1;a!==l&&(s.show=Cn.toValue(a,s.show),r.attributes.show.value[0]=s.show[0])}this.showsUpdated.removeAll()};Ed.prototype.contains=function(e){return this.updaters.contains(e.id)};Ed.prototype.getBoundingSphere=function(e,t){let n=this.primitive;if(!n.ready)return ct.PENDING;let i=n.getGeometryInstanceAttributes(e.entity);return!c(i)||!c(i.boundingSphere)||c(i.show)&&i.show[0]===0?ct.FAILED:(i.boundingSphere.clone(t),ct.DONE)};Ed.prototype.destroy=function(){let e=this.primitive,t=this.primitives;c(e)&&t.remove(e);let n=this.oldPrimitive;c(n)&&t.remove(n),c(this.removeMaterialSubscription)&&this.removeMaterialSubscription()};function MA(e,t,n,i,o){this._solidItems=[],this._translucentItems=[],this._primitives=e,this._appearanceType=t,this._depthFailAppearanceType=n,this._closed=i,this._shadows=o}MA.prototype.add=function(e,t){let n,i,o=t.createFillGeometryInstance(e);o.attributes.color.value[3]===255?(n=this._solidItems,i=!1):(n=this._translucentItems,i=!0);let r=n.length;for(let a=0;a<r;a++){let l=n[a];if(l.isMaterial(t)){l.add(t,o);return}}let s=new Ed(this._primitives,i,this._appearanceType,this._depthFailAppearanceType,t.depthFailMaterialProperty,this._closed,this._shadows);s.add(t,o),n.push(s)};function Rfe(e,t){let n=e.length;for(let i=n-1;i>=0;i--){let o=e[i];if(o.remove(t))return o.updaters.length===0&&(e.splice(i,1),o.destroy()),!0}return!1}MA.prototype.remove=function(e){Rfe(this._solidItems,e)||Rfe(this._translucentItems,e)};function Mfe(e,t,n){let i=!1,o=t.length;for(let r=0;r<o;++r){let s=t[r],a=s.itemsToRemove,l=a.length;if(l>0)for(r=0;r<l;r++){let u=a[r];s.remove(u),e.add(n,u),i=!0}}return i}function DR(e,t,n,i){let o=t.length,r;for(r=o-1;r>=0;r--){let s=t[r];if(s.invalidated){t.splice(r,1);let a=s.updaters.values,l=a.length;for(let u=0;u<l;u++)e.add(n,a[u]);s.destroy()}}for(o=t.length,r=0;r<o;++r)i=t[r].update(n)&&i;return i}MA.prototype.update=function(e){let t=DR(this,this._solidItems,e,!0);t=DR(this,this._translucentItems,e,t)&&t;let n=Mfe(this,this._solidItems,e),i=Mfe(this,this._translucentItems,e);return(n||i)&&(t=DR(this,this._solidItems,e,t)&&t,t=DR(this,this._translucentItems,e,t)&&t),t};function Lfe(e,t,n){let i=e.length;for(let o=0;o<i;o++){let r=e[o];if(r.contains(t))return r.getBoundingSphere(t,n)}return ct.FAILED}MA.prototype.getBoundingSphere=function(e,t){let n=Lfe(this._solidItems,e,t);return n===ct.FAILED?Lfe(this._translucentItems,e,t):n};function Nfe(e){let t=e.length;for(let n=0;n<t;n++)e[n].destroy();e.length=0}MA.prototype.removeAllPrimitives=function(){Nfe(this._solidItems),Nfe(this._translucentItems)};var kh=MA;var jKe=new Bt,WKe=new Bt,qKe=h.ZERO,YKe=new h;function Sd(e,t,n,i,o,r,s){this.primitives=e,this.appearanceType=t,this.materialProperty=n,this.depthFailAppearanceType=i,this.depthFailMaterialProperty=o,this.closed=r,this.shadows=s,this.updaters=new St,this.createPrimitive=!0,this.primitive=void 0,this.oldPrimitive=void 0,this.geometry=new St,this.material=void 0,this.depthFailMaterial=void 0,this.updatersWithAttributes=new St,this.attributes=new St,this.invalidated=!1,this.removeMaterialSubscription=n.definitionChanged.addEventListener(Sd.prototype.onMaterialChanged,this),this.subscriptions=new St,this.showsUpdated=new St}Sd.prototype.onMaterialChanged=function(){this.invalidated=!0};Sd.prototype.isMaterial=function(e){let t=this.materialProperty,n=e.fillMaterialProperty,i=this.depthFailMaterialProperty,o=e.depthFailMaterialProperty;if(n===t&&o===i)return!0;let r=c(t)&&t.equals(n);return r=(!c(i)&&!c(o)||c(i)&&i.equals(o))&&r,r};Sd.prototype.add=function(e,t){let n=t.id;if(this.updaters.set(n,t),this.geometry.set(n,t.createFillGeometryInstance(e)),!t.hasConstantFill||!t.fillMaterialProperty.isConstant||!X.isConstant(t.distanceDisplayConditionProperty)||!X.isConstant(t.terrainOffsetProperty))this.updatersWithAttributes.set(n,t);else{let i=this;this.subscriptions.set(n,t.entity.definitionChanged.addEventListener(function(o,r,s,a){r==="isShowing"&&i.showsUpdated.set(t.id,t)}))}this.createPrimitive=!0};Sd.prototype.remove=function(e){let t=e.id;if(this.createPrimitive=this.geometry.remove(t)||this.createPrimitive,this.updaters.remove(t)){this.updatersWithAttributes.remove(t);let n=this.subscriptions.get(t);return c(n)&&(n(),this.subscriptions.remove(t),this.showsUpdated.remove(t)),!0}return!1};var XKe=new j;Sd.prototype.update=function(e){let t=!0,n=this.primitive,i=this.primitives,o=this.geometry.values,r;if(this.createPrimitive){if(o.length>0){c(n)&&(c(this.oldPrimitive)?i.remove(n):this.oldPrimitive=n),this.material=pr.getValue(e,this.materialProperty,this.material);let a;c(this.depthFailMaterialProperty)&&(this.depthFailMaterial=pr.getValue(e,this.depthFailMaterialProperty,this.depthFailMaterial),a=new this.depthFailAppearanceType({material:this.depthFailMaterial,translucent:this.depthFailMaterial.isTranslucent(),closed:this.closed})),n=new Rn({show:!1,asynchronous:!0,geometryInstances:o.slice(),appearance:new this.appearanceType({material:this.material,translucent:this.material.isTranslucent(),closed:this.closed}),depthFailAppearance:a,shadows:this.shadows}),i.add(n),t=!1}else{c(n)&&(i.remove(n),n=void 0);let a=this.oldPrimitive;c(a)&&(i.remove(a),this.oldPrimitive=void 0)}this.attributes.removeAll(),this.primitive=n,this.createPrimitive=!1}else if(c(n)&&n.ready){n.show=!0,c(this.oldPrimitive)&&(i.remove(this.oldPrimitive),this.oldPrimitive=void 0),this.material=pr.getValue(e,this.materialProperty,this.material),this.primitive.appearance.material=this.material,c(this.depthFailAppearanceType)&&!(this.depthFailMaterialProperty instanceof Ht)&&(this.depthFailMaterial=pr.getValue(e,this.depthFailMaterialProperty,this.depthFailMaterial),this.primitive.depthFailAppearance.material=this.depthFailMaterial);let s=this.updatersWithAttributes.values,a=s.length;for(r=0;r<a;r++){let l=s[r],u=l.entity,f=this.geometry.get(l.id),d=this.attributes.get(f.id.id);if(c(d)||(d=n.getGeometryInstanceAttributes(f.id),this.attributes.set(f.id.id,d)),c(this.depthFailAppearanceType)&&this.depthFailMaterialProperty instanceof Ht&&!l.depthFailMaterialProperty.isConstant){let x=l.depthFailMaterialProperty.color,T=X.getValueOrDefault(x,e,j.WHITE,XKe);j.equals(d._lastDepthFailColor,T)||(d._lastDepthFailColor=j.clone(T,d._lastDepthFailColor),d.depthFailColor=Wt.toValue(T,d.depthFailColor))}let p=u.isShowing&&(l.hasConstantFill||l.isFilled(e)),g=d.show[0]===1;p!==g&&(d.show=Cn.toValue(p,d.show));let m=l.distanceDisplayConditionProperty;if(!X.isConstant(m)){let x=X.getValueOrDefault(m,e,WKe,jKe);Bt.equals(x,d._lastDistanceDisplayCondition)||(d._lastDistanceDisplayCondition=Bt.clone(x,d._lastDistanceDisplayCondition),d.distanceDisplayCondition=kn.toValue(x,d.distanceDisplayCondition))}let b=l.terrainOffsetProperty;if(!X.isConstant(b)){let x=X.getValueOrDefault(b,e,qKe,YKe);h.equals(x,d._lastOffset)||(d._lastOffset=h.clone(x,d._lastOffset),d.offset=Qi.toValue(x,d.offset))}}this.updateShows(n)}else c(n)&&!n.ready&&(t=!1);return t};Sd.prototype.updateShows=function(e){let t=this.showsUpdated.values,n=t.length;for(let i=0;i<n;i++){let o=t[i],r=o.entity,s=this.geometry.get(o.id),a=this.attributes.get(s.id.id);c(a)||(a=e.getGeometryInstanceAttributes(s.id),this.attributes.set(s.id.id,a));let l=r.isShowing,u=a.show[0]===1;l!==u&&(a.show=Cn.toValue(l,a.show),s.attributes.show.value[0]=a.show[0])}this.showsUpdated.removeAll()};Sd.prototype.contains=function(e){return this.updaters.contains(e.id)};Sd.prototype.getBoundingSphere=function(e,t){let n=this.primitive;if(!n.ready)return ct.PENDING;let i=n.getGeometryInstanceAttributes(e.entity);return!c(i)||!c(i.boundingSphere)||c(i.show)&&i.show[0]===0?ct.FAILED:(i.boundingSphere.clone(t),ct.DONE)};Sd.prototype.destroy=function(){let e=this.primitive,t=this.primitives;c(e)&&t.remove(e);let n=this.oldPrimitive;c(n)&&t.remove(n),this.removeMaterialSubscription()};function LA(e,t,n,i,o){this._items=[],this._primitives=e,this._appearanceType=t,this._depthFailAppearanceType=n,this._closed=i,this._shadows=o}LA.prototype.add=function(e,t){let n=this._items,i=n.length;for(let r=0;r<i;r++){let s=n[r];if(s.isMaterial(t)){s.add(e,t);return}}let o=new Sd(this._primitives,this._appearanceType,t.fillMaterialProperty,this._depthFailAppearanceType,t.depthFailMaterialProperty,this._closed,this._shadows);o.add(e,t),n.push(o)};LA.prototype.remove=function(e){let t=this._items,n=t.length;for(let i=n-1;i>=0;i--){let o=t[i];if(o.remove(e)){o.updaters.length===0&&(t.splice(i,1),o.destroy());break}}};LA.prototype.update=function(e){let t,n=this._items,i=n.length;for(t=i-1;t>=0;t--){let r=n[t];if(r.invalidated){n.splice(t,1);let s=r.updaters.values,a=s.length;for(let l=0;l<a;l++)this.add(e,s[l]);r.destroy()}}let o=!0;for(t=0;t<n.length;t++)o=n[t].update(e)&&o;return o};LA.prototype.getBoundingSphere=function(e,t){let n=this._items,i=n.length;for(let o=0;o<i;o++){let r=n[o];if(r.contains(e))return r.getBoundingSphere(e,t)}return ct.FAILED};LA.prototype.removeAllPrimitives=function(){let e=this._items,t=e.length;for(let n=0;n<t;n++)e[n].destroy();this._items.length=0};var Vh=LA;var Bfe=Ur(Ffe(),1);function PR(){this._tree=new Bfe.default}function _b(){this.minX=0,this.minY=0,this.maxX=0,this.maxY=0,this.id=""}_b.fromRectangleAndId=function(e,t,n){return n.minX=t.west,n.minY=t.south,n.maxX=t.east,n.maxY=t.north,n.id=e,n};PR.prototype.insert=function(e,t){A.typeOf.string("id",e),A.typeOf.object("rectangle",t);let n=_b.fromRectangleAndId(e,t,new _b);this._tree.insert(n)};function KKe(e,t){return e.id===t.id}var $Ke=new _b;PR.prototype.remove=function(e,t){A.typeOf.string("id",e),A.typeOf.object("rectangle",t);let n=_b.fromRectangleAndId(e,t,$Ke);this._tree.remove(n,KKe)};var ZKe=new _b;PR.prototype.collides=function(e){A.typeOf.object("rectangle",e);let t=_b.fromRectangleAndId("",e,ZKe);return this._tree.collides(t)};var Lv=PR;var JKe=new j,QKe=new Bt,e$e=new Bt;function Up(e,t,n,i){this.primitives=e,this.zIndex=i,this.classificationType=t,this.color=n,this.createPrimitive=!1,this.waitingOnCreate=!1,this.primitive=void 0,this.oldPrimitive=void 0,this.geometry=new St,this.updaters=new St,this.updatersWithAttributes=new St,this.attributes=new St,this.subscriptions=new St,this.showsUpdated=new St,this.itemsToRemove=[],this.isDirty=!1,this.rectangleCollisionCheck=new Lv}Up.prototype.overlapping=function(e){return this.rectangleCollisionCheck.collides(e)};Up.prototype.add=function(e,t){let n=e.id;if(this.createPrimitive=!0,this.geometry.set(n,t),this.updaters.set(n,e),this.rectangleCollisionCheck.insert(n,t.geometry.rectangle),!e.hasConstantFill||!e.fillMaterialProperty.isConstant||!X.isConstant(e.distanceDisplayConditionProperty))this.updatersWithAttributes.set(n,e);else{let i=this;this.subscriptions.set(n,e.entity.definitionChanged.addEventListener(function(o,r,s,a){r==="isShowing"&&i.showsUpdated.set(e.id,e)}))}};Up.prototype.remove=function(e){let t=e.id,n=this.geometry.get(t);if(this.createPrimitive=this.geometry.remove(t)||this.createPrimitive,this.updaters.remove(t)){this.rectangleCollisionCheck.remove(t,n.geometry.rectangle),this.updatersWithAttributes.remove(t);let i=this.subscriptions.get(t);return c(i)&&(i(),this.subscriptions.remove(t),this.showsUpdated.remove(t)),!0}return!1};Up.prototype.update=function(e){let t=!0,n=0,i=this.primitive,o=this.primitives,r;if(this.createPrimitive){let s=this.geometry.values;if(s.length>0)c(i)&&(c(this.oldPrimitive)?o.remove(i):this.oldPrimitive=i),i=new Ll({show:!1,asynchronous:!0,geometryInstances:s.slice(),classificationType:this.classificationType}),o.add(i,this.zIndex),t=!1;else{c(i)&&(o.remove(i),i=void 0);let l=this.oldPrimitive;c(l)&&(o.remove(l),this.oldPrimitive=void 0)}this.attributes.removeAll(),this.primitive=i,this.createPrimitive=!1,this.waitingOnCreate=!0}else if(c(i)&&i.ready){i.show=!0,c(this.oldPrimitive)&&(o.remove(this.oldPrimitive),this.oldPrimitive=void 0);let s=this.updatersWithAttributes.values,a=s.length,l=this.waitingOnCreate;for(r=0;r<a;r++){let u=s[r],f=this.geometry.get(u.id),d=this.attributes.get(f.id.id);if(c(d)||(d=i.getGeometryInstanceAttributes(f.id),this.attributes.set(f.id.id,d)),!u.fillMaterialProperty.isConstant||l){let b=u.fillMaterialProperty.color,x=X.getValueOrDefault(b,e,j.WHITE,JKe);j.equals(d._lastColor,x)||(d._lastColor=j.clone(x,d._lastColor),d.color=Wt.toValue(x,d.color))}let p=u.entity.isShowing&&(u.hasConstantFill||u.isFilled(e)),g=d.show[0]===1;p!==g&&(d.show=Cn.toValue(p,d.show));let m=u.distanceDisplayConditionProperty;if(!X.isConstant(m)){let b=X.getValueOrDefault(m,e,e$e,QKe);Bt.equals(b,d._lastDistanceDisplayCondition)||(d._lastDistanceDisplayCondition=Bt.clone(b,d._lastDistanceDisplayCondition),d.distanceDisplayCondition=kn.toValue(b,d.distanceDisplayCondition))}}this.updateShows(i),this.waitingOnCreate=!1}else c(i)&&!i.ready&&(t=!1);return this.itemsToRemove.length=n,t};Up.prototype.updateShows=function(e){let t=this.showsUpdated.values,n=t.length;for(let i=0;i<n;i++){let o=t[i],r=this.geometry.get(o.id),s=this.attributes.get(r.id.id);c(s)||(s=e.getGeometryInstanceAttributes(r.id),this.attributes.set(r.id.id,s));let a=o.entity.isShowing,l=s.show[0]===1;a!==l&&(s.show=Cn.toValue(a,s.show),r.attributes.show.value[0]=s.show[0])}this.showsUpdated.removeAll()};Up.prototype.contains=function(e){return this.updaters.contains(e.id)};Up.prototype.getBoundingSphere=function(e,t){let n=this.primitive;if(!n.ready)return ct.PENDING;let i=n.getBoundingSphere(e.entity);return c(i)?(i.clone(t),ct.DONE):ct.FAILED};Up.prototype.removeAllPrimitives=function(){let e=this.primitives,t=this.primitive;c(t)&&(e.remove(t),this.primitive=void 0,this.geometry.removeAll(),this.updaters.removeAll());let n=this.oldPrimitive;c(n)&&(e.remove(n),this.oldPrimitive=void 0)};function NA(e,t){this._batches=[],this._primitives=e,this._classificationType=t}NA.prototype.add=function(e,t){let n=t.createFillGeometryInstance(e),i=this._batches,o=X.getValueOrDefault(t.zIndex,0),r,s=i.length;for(let a=0;a<s;++a){let l=i[a];if(l.zIndex===o&&!l.overlapping(n.geometry.rectangle)){r=l;break}}return c(r)||(r=new Up(this._primitives,this._classificationType,n.attributes.color.value,o),i.push(r)),r.add(t,n),r};NA.prototype.remove=function(e){let t=this._batches,n=t.length;for(let i=0;i<n;++i)if(t[i].remove(e))return};NA.prototype.update=function(e){let t,n,i=!0,o=this._batches,r=o.length;for(t=0;t<r;++t)i=o[t].update(e)&&i;for(t=0;t<r;++t){let s=o[t],a=s.itemsToRemove,l=a.length;for(let u=0;u<l;u++){n=a[u],s.remove(n);let f=this.add(e,n);s.isDirty=!0,f.isDirty=!0}}for(t=r-1;t>=0;--t){let s=o[t];s.isDirty&&(i=o[t].update(e)&&i,s.isDirty=!1),s.geometry.length===0&&o.splice(t,1)}return i};NA.prototype.getBoundingSphere=function(e,t){let n=this._batches,i=n.length;for(let o=0;o<i;++o){let r=n[o];if(r.contains(e))return r.getBoundingSphere(e,t)}return ct.FAILED};NA.prototype.removeAllPrimitives=function(){let e=this._batches,t=e.length;for(let n=0;n<t;++n)e[n].removeAllPrimitives()};var IR=NA;var t$e=new Bt,n$e=new Bt;function gf(e,t,n,i,o,r){this.primitives=e,this.classificationType=t,this.appearanceType=n,this.materialProperty=i,this.updaters=new St,this.createPrimitive=!0,this.primitive=void 0,this.oldPrimitive=void 0,this.geometry=new St,this.material=void 0,this.updatersWithAttributes=new St,this.attributes=new St,this.invalidated=!1,this.removeMaterialSubscription=i.definitionChanged.addEventListener(gf.prototype.onMaterialChanged,this),this.subscriptions=new St,this.showsUpdated=new St,this.usingSphericalTextureCoordinates=o,this.zIndex=r,this.rectangleCollisionCheck=new Lv}gf.prototype.onMaterialChanged=function(){this.invalidated=!0};gf.prototype.overlapping=function(e){return this.rectangleCollisionCheck.collides(e)};gf.prototype.isMaterial=function(e){let t=this.materialProperty,n=e.fillMaterialProperty;return n===t||n instanceof Ht&&t instanceof Ht?!0:c(t)&&t.equals(n)};gf.prototype.add=function(e,t,n){let i=t.id;if(this.updaters.set(i,t),this.geometry.set(i,n),this.rectangleCollisionCheck.insert(i,n.geometry.rectangle),!t.hasConstantFill||!t.fillMaterialProperty.isConstant||!X.isConstant(t.distanceDisplayConditionProperty))this.updatersWithAttributes.set(i,t);else{let o=this;this.subscriptions.set(i,t.entity.definitionChanged.addEventListener(function(r,s,a,l){s==="isShowing"&&o.showsUpdated.set(t.id,t)}))}this.createPrimitive=!0};gf.prototype.remove=function(e){let t=e.id,n=this.geometry.get(t);if(this.createPrimitive=this.geometry.remove(t)||this.createPrimitive,this.updaters.remove(t)){this.rectangleCollisionCheck.remove(t,n.geometry.rectangle),this.updatersWithAttributes.remove(t);let i=this.subscriptions.get(t);return c(i)&&(i(),this.subscriptions.remove(t)),!0}return!1};gf.prototype.update=function(e){let t=!0,n=this.primitive,i=this.primitives,o=this.geometry.values,r;if(this.createPrimitive){if(o.length>0)c(n)&&(c(this.oldPrimitive)?i.remove(n):this.oldPrimitive=n),this.material=pr.getValue(e,this.materialProperty,this.material),n=new Ll({show:!1,asynchronous:!0,geometryInstances:o.slice(),appearance:new this.appearanceType({material:this.material}),classificationType:this.classificationType}),i.add(n,this.zIndex),t=!1;else{c(n)&&(i.remove(n),n=void 0);let a=this.oldPrimitive;c(a)&&(i.remove(a),this.oldPrimitive=void 0)}this.attributes.removeAll(),this.primitive=n,this.createPrimitive=!1}else if(c(n)&&n.ready){n.show=!0,c(this.oldPrimitive)&&(i.remove(this.oldPrimitive),this.oldPrimitive=void 0),this.material=pr.getValue(e,this.materialProperty,this.material),this.primitive.appearance.material=this.material;let s=this.updatersWithAttributes.values,a=s.length;for(r=0;r<a;r++){let l=s[r],u=l.entity,f=this.geometry.get(l.id),d=this.attributes.get(f.id.id);c(d)||(d=n.getGeometryInstanceAttributes(f.id),this.attributes.set(f.id.id,d));let p=u.isShowing&&(l.hasConstantFill||l.isFilled(e)),g=d.show[0]===1;p!==g&&(d.show=Cn.toValue(p,d.show));let m=l.distanceDisplayConditionProperty;if(!X.isConstant(m)){let b=X.getValueOrDefault(m,e,n$e,t$e);Bt.equals(b,d._lastDistanceDisplayCondition)||(d._lastDistanceDisplayCondition=Bt.clone(b,d._lastDistanceDisplayCondition),d.distanceDisplayCondition=kn.toValue(b,d.distanceDisplayCondition))}}this.updateShows(n)}else c(n)&&!n.ready&&(t=!1);return t};gf.prototype.updateShows=function(e){let t=this.showsUpdated.values,n=t.length;for(let i=0;i<n;i++){let o=t[i],r=o.entity,s=this.geometry.get(o.id),a=this.attributes.get(s.id.id);c(a)||(a=e.getGeometryInstanceAttributes(s.id),this.attributes.set(s.id.id,a));let l=r.isShowing,u=a.show[0]===1;l!==u&&(a.show=Cn.toValue(l,a.show),s.attributes.show.value[0]=a.show[0])}this.showsUpdated.removeAll()};gf.prototype.contains=function(e){return this.updaters.contains(e.id)};gf.prototype.getBoundingSphere=function(e,t){let n=this.primitive;if(!n.ready)return ct.PENDING;let i=n.getGeometryInstanceAttributes(e.entity);return!c(i)||!c(i.boundingSphere)||c(i.show)&&i.show[0]===0?ct.FAILED:(i.boundingSphere.clone(t),ct.DONE)};gf.prototype.destroy=function(){let e=this.primitive,t=this.primitives;c(e)&&t.remove(e);let n=this.oldPrimitive;c(n)&&t.remove(n),this.removeMaterialSubscription()};function FA(e,t,n){this._items=[],this._primitives=e,this._classificationType=t,this._appearanceType=n}FA.prototype.add=function(e,t){let n=this._items,i=n.length,o=t.createFillGeometryInstance(e),r=Wf.shouldUseSphericalCoordinates(o.geometry.rectangle),s=X.getValueOrDefault(t.zIndex,0);for(let l=0;l<i;++l){let u=n[l];if(u.isMaterial(t)&&u.usingSphericalTextureCoordinates===r&&u.zIndex===s&&!u.overlapping(o.geometry.rectangle)){u.add(e,t,o);return}}let a=new gf(this._primitives,this._classificationType,this._appearanceType,t.fillMaterialProperty,r,s);a.add(e,t,o),n.push(a)};FA.prototype.remove=function(e){let t=this._items,n=t.length;for(let i=n-1;i>=0;i--){let o=t[i];if(o.remove(e)){o.updaters.length===0&&(t.splice(i,1),o.destroy());break}}};FA.prototype.update=function(e){let t,n=this._items,i=n.length;for(t=i-1;t>=0;t--){let r=n[t];if(r.invalidated){n.splice(t,1);let s=r.updaters.values,a=s.length;for(let l=0;l<a;l++)this.add(e,s[l]);r.destroy()}}let o=!0;for(t=0;t<n.length;t++)o=n[t].update(e)&&o;return o};FA.prototype.getBoundingSphere=function(e,t){let n=this._items,i=n.length;for(let o=0;o<i;o++){let r=n[o];if(r.contains(e))return r.getBoundingSphere(e,t)}return ct.FAILED};FA.prototype.removeAllPrimitives=function(){let e=this._items,t=e.length;for(let n=0;n<t;n++)e[n].destroy();this._items.length=0};var F6=FA;var i$e=new j,o$e=new Bt,r$e=new Bt,s$e=h.ZERO,a$e=new h;function zp(e,t,n,i){this.translucent=t,this.width=n,this.shadows=i,this.primitives=e,this.createPrimitive=!1,this.waitingOnCreate=!1,this.primitive=void 0,this.oldPrimitive=void 0,this.geometry=new St,this.updaters=new St,this.updatersWithAttributes=new St,this.attributes=new St,this.itemsToRemove=[],this.subscriptions=new St,this.showsUpdated=new St}zp.prototype.add=function(e,t){let n=e.id;if(this.createPrimitive=!0,this.geometry.set(n,t),this.updaters.set(n,e),!e.hasConstantOutline||!e.outlineColorProperty.isConstant||!X.isConstant(e.distanceDisplayConditionProperty)||!X.isConstant(e.terrainOffsetProperty))this.updatersWithAttributes.set(n,e);else{let i=this;this.subscriptions.set(n,e.entity.definitionChanged.addEventListener(function(o,r,s,a){r==="isShowing"&&i.showsUpdated.set(e.id,e)}))}};zp.prototype.remove=function(e){let t=e.id;if(this.createPrimitive=this.geometry.remove(t)||this.createPrimitive,this.updaters.remove(t)){this.updatersWithAttributes.remove(t);let n=this.subscriptions.get(t);return c(n)&&(n(),this.subscriptions.remove(t),this.showsUpdated.remove(t)),!0}return!1};zp.prototype.update=function(e){let t=!0,n=0,i=this.primitive,o=this.primitives,r;if(this.createPrimitive){let s=this.geometry.values;if(s.length>0)c(i)&&(c(this.oldPrimitive)?o.remove(i):this.oldPrimitive=i),i=new Rn({show:!1,asynchronous:!0,geometryInstances:s.slice(),appearance:new ln({flat:!0,translucent:this.translucent,renderState:{lineWidth:this.width}}),shadows:this.shadows}),o.add(i),t=!1;else{c(i)&&(o.remove(i),i=void 0);let l=this.oldPrimitive;c(l)&&(o.remove(l),this.oldPrimitive=void 0)}this.attributes.removeAll(),this.primitive=i,this.createPrimitive=!1,this.waitingOnCreate=!0}else if(c(i)&&i.ready){i.show=!0,c(this.oldPrimitive)&&(o.remove(this.oldPrimitive),this.oldPrimitive=void 0);let s=this.updatersWithAttributes.values,a=s.length,l=this.waitingOnCreate;for(r=0;r<a;r++){let u=s[r],f=this.geometry.get(u.id),d=this.attributes.get(f.id.id);if(c(d)||(d=i.getGeometryInstanceAttributes(f.id),this.attributes.set(f.id.id,d)),!u.outlineColorProperty.isConstant||l){let x=u.outlineColorProperty,T=X.getValueOrDefault(x,e,j.WHITE,i$e);j.equals(d._lastColor,T)||(d._lastColor=j.clone(T,d._lastColor),d.color=Wt.toValue(T,d.color),(this.translucent&&d.color[3]===255||!this.translucent&&d.color[3]!==255)&&(this.itemsToRemove[n++]=u))}let p=u.entity.isShowing&&(u.hasConstantOutline||u.isOutlineVisible(e)),g=d.show[0]===1;p!==g&&(d.show=Cn.toValue(p,d.show));let m=u.distanceDisplayConditionProperty;if(!X.isConstant(m)){let x=X.getValueOrDefault(m,e,r$e,o$e);Bt.equals(x,d._lastDistanceDisplayCondition)||(d._lastDistanceDisplayCondition=Bt.clone(x,d._lastDistanceDisplayCondition),d.distanceDisplayCondition=kn.toValue(x,d.distanceDisplayCondition))}let b=u.terrainOffsetProperty;if(!X.isConstant(b)){let x=X.getValueOrDefault(b,e,s$e,a$e);h.equals(x,d._lastOffset)||(d._lastOffset=h.clone(x,d._lastOffset),d.offset=Qi.toValue(x,d.offset))}}this.updateShows(i),this.waitingOnCreate=!1}else c(i)&&!i.ready&&(t=!1);return this.itemsToRemove.length=n,t};zp.prototype.updateShows=function(e){let t=this.showsUpdated.values,n=t.length;for(let i=0;i<n;i++){let o=t[i],r=this.geometry.get(o.id),s=this.attributes.get(r.id.id);c(s)||(s=e.getGeometryInstanceAttributes(r.id),this.attributes.set(r.id.id,s));let a=o.entity.isShowing,l=s.show[0]===1;a!==l&&(s.show=Cn.toValue(a,s.show),r.attributes.show.value[0]=s.show[0])}this.showsUpdated.removeAll()};zp.prototype.contains=function(e){return this.updaters.contains(e.id)};zp.prototype.getBoundingSphere=function(e,t){let n=this.primitive;if(!n.ready)return ct.PENDING;let i=n.getGeometryInstanceAttributes(e.entity);return!c(i)||!c(i.boundingSphere)||c(i.show)&&i.show[0]===0?ct.FAILED:(i.boundingSphere.clone(t),ct.DONE)};zp.prototype.removeAllPrimitives=function(){let e=this.primitives,t=this.primitive;c(t)&&(e.remove(t),this.primitive=void 0,this.geometry.removeAll(),this.updaters.removeAll());let n=this.oldPrimitive;c(n)&&(e.remove(n),this.oldPrimitive=void 0)};function BA(e,t,n){this._primitives=e,this._scene=t,this._shadows=n,this._solidBatches=new St,this._translucentBatches=new St}BA.prototype.add=function(e,t){let n=t.createOutlineGeometryInstance(e),i=this._scene.clampLineWidth(t.outlineWidth),o,r;n.attributes.color.value[3]===255?(o=this._solidBatches,r=o.get(i),c(r)||(r=new zp(this._primitives,!1,i,this._shadows),o.set(i,r)),r.add(t,n)):(o=this._translucentBatches,r=o.get(i),c(r)||(r=new zp(this._primitives,!0,i,this._shadows),o.set(i,r)),r.add(t,n))};BA.prototype.remove=function(e){let t,n=this._solidBatches.values,i=n.length;for(t=0;t<i;t++)if(n[t].remove(e))return;let o=this._translucentBatches.values,r=o.length;for(t=0;t<r;t++)if(o[t].remove(e))return};BA.prototype.update=function(e){let t,n,i,o,r=this._solidBatches.values,s=r.length,a=this._translucentBatches.values,l=a.length,u,f=!0,d=!1;do{for(d=!1,n=0;n<s;n++){o=r[n],f=o.update(e),u=o.itemsToRemove;let p=u.length;if(p>0)for(d=!0,t=0;t<p;t++)i=u[t],o.remove(i),this.add(e,i)}for(n=0;n<l;n++){o=a[n],f=o.update(e),u=o.itemsToRemove;let p=u.length;if(p>0)for(d=!0,t=0;t<p;t++)i=u[t],o.remove(i),this.add(e,i)}}while(d);return f};BA.prototype.getBoundingSphere=function(e,t){let n,i=this._solidBatches.values,o=i.length;for(n=0;n<o;n++){let a=i[n];if(a.contains(e))return a.getBoundingSphere(e,t)}let r=this._translucentBatches.values,s=r.length;for(n=0;n<s;n++){let a=r[n];if(a.contains(e))return a.getBoundingSphere(e,t)}return ct.FAILED};BA.prototype.removeAllPrimitives=function(){let e,t=this._solidBatches.values,n=t.length;for(e=0;e<n;e++)t[e].removeAllPrimitives();let i=this._translucentBatches.values,o=i.length;for(e=0;e<o;e++)i[e].removeAllPrimitives()};var OR=BA;var c$e=[];function ml(e,t,n,i){A.defined("scene",e),A.defined("entityCollection",t),n=y(n,e.primitives),i=y(i,e.groundPrimitives),this._scene=e,this._primitives=n,this._groundPrimitives=i,this._entityCollection=void 0,this._addedObjects=new St,this._removedObjects=new St,this._changedObjects=new St;let o=En.NUMBER_OF_SHADOW_MODES;this._outlineBatches=new Array(o*2),this._closedColorBatches=new Array(o*2),this._closedMaterialBatches=new Array(o*2),this._openColorBatches=new Array(o*2),this._openMaterialBatches=new Array(o*2);let r=Qo.supportsMaterialsforEntitiesOnTerrain(e);this._supportsMaterialsforEntitiesOnTerrain=r;let s;for(s=0;s<o;++s)this._outlineBatches[s]=new OR(n,e,s,!1),this._outlineBatches[o+s]=new OR(n,e,s,!0),this._closedColorBatches[s]=new kh(n,ln,void 0,!0,s,!0),this._closedColorBatches[o+s]=new kh(n,ln,void 0,!0,s,!1),this._closedMaterialBatches[s]=new Vh(n,uo,void 0,!0,s,!0),this._closedMaterialBatches[o+s]=new Vh(n,uo,void 0,!0,s,!1),this._openColorBatches[s]=new kh(n,ln,void 0,!1,s,!0),this._openColorBatches[o+s]=new kh(n,ln,void 0,!1,s,!1),this._openMaterialBatches[s]=new Vh(n,uo,void 0,!1,s,!0),this._openMaterialBatches[o+s]=new Vh(n,uo,void 0,!1,s,!1);let a=Vn.NUMBER_OF_CLASSIFICATION_TYPES,l=new Array(a),u=[];if(r)for(s=0;s<a;++s)u.push(new F6(i,s,uo)),l[s]=new IR(i,s);else for(s=0;s<a;++s)l[s]=new IR(i,s);this._groundColorBatches=l,this._groundMaterialBatches=u,this._dynamicBatch=new Av(n,i),this._batches=this._outlineBatches.concat(this._closedColorBatches,this._closedMaterialBatches,this._openColorBatches,this._openMaterialBatches,this._groundColorBatches,this._groundMaterialBatches,this._dynamicBatch),this._subscriptions=new St,this._updaterSets=new St,this._entityCollection=t,t.collectionChanged.addEventListener(ml.prototype._onCollectionChanged,this),this._onCollectionChanged(t,t.values,c$e)}ml.registerUpdater=function(e){Mv.registerUpdater(e)};ml.unregisterUpdater=function(e){Mv.unregisterUpdater(e)};ml.prototype.update=function(e){A.defined("time",e);let t=this._addedObjects,n=t.values,i=this._removedObjects,o=i.values,r=this._changedObjects,s=r.values,a,l,u,f,d=this;for(a=s.length-1;a>-1;a--)l=s[a],u=l.id,f=this._updaterSets.get(u),f.entity===l?f.forEach(function(b){d._removeUpdater(b),d._insertUpdaterIntoBatch(e,b)}):(o.push(l),n.push(l));for(a=o.length-1;a>-1;a--)l=o[a],u=l.id,f=this._updaterSets.get(u),f.forEach(this._removeUpdater.bind(this)),f.destroy(),this._updaterSets.remove(u),this._subscriptions.get(u)(),this._subscriptions.remove(u);for(a=n.length-1;a>-1;a--)l=n[a],u=l.id,f=new Mv(l,this._scene),this._updaterSets.set(u,f),f.forEach(function(b){d._insertUpdaterIntoBatch(e,b)}),this._subscriptions.set(u,f.geometryChanged.addEventListener(ml._onGeometryChanged,this));t.removeAll(),i.removeAll(),r.removeAll();let p=!0,g=this._batches,m=g.length;for(a=0;a<m;a++)p=g[a].update(e)&&p;return p};var l$e=[],u$e=new ce;ml.prototype.getBoundingSphere=function(e,t){A.defined("entity",e),A.defined("result",t);let n=l$e,i=u$e,o=0,r=ct.DONE,s=this._batches,a=s.length,l=e.id,u=this._updaterSets.get(l).updaters;for(let f=0;f<u.length;f++){let d=u[f];for(let p=0;p<a;p++){if(r=s[p].getBoundingSphere(d,i),r===ct.PENDING)return ct.PENDING;r===ct.DONE&&(n[o]=ce.clone(i,n[o]),o++)}}return o===0?ct.FAILED:(n.length=o,ce.fromBoundingSpheres(n,t),ct.DONE)};ml.prototype.isDestroyed=function(){return!1};ml.prototype.destroy=function(){this._entityCollection.collectionChanged.removeEventListener(ml.prototype._onCollectionChanged,this),this._addedObjects.removeAll(),this._removedObjects.removeAll();let e,t=this._batches,n=t.length;for(e=0;e<n;e++)t[e].removeAllPrimitives();let i=this._subscriptions.values;for(n=i.length,e=0;e<n;e++)i[e]();this._subscriptions.removeAll();let o=this._updaterSets.values;for(n=o.length,e=0;e<n;e++)o[e].destroy();return this._updaterSets.removeAll(),de(this)};ml.prototype._removeUpdater=function(e){let t=this._batches,n=t.length;for(let i=0;i<n;i++)t[i].remove(e)};ml.prototype._insertUpdaterIntoBatch=function(e,t){if(t.isDynamic){this._dynamicBatch.add(e,t);return}let n;(t.outlineEnabled||t.fillEnabled)&&(n=t.shadowsProperty.getValue(e));let i=En.NUMBER_OF_SHADOW_MODES;if(t.outlineEnabled&&(c(t.terrainOffsetProperty)?this._outlineBatches[i+n].add(e,t):this._outlineBatches[n].add(e,t)),t.fillEnabled)if(t.onTerrain){let o=t.classificationTypeProperty.getValue(e);t.fillMaterialProperty instanceof Ht?this._groundColorBatches[o].add(e,t):this._groundMaterialBatches[o].add(e,t)}else t.isClosed?t.fillMaterialProperty instanceof Ht?c(t.terrainOffsetProperty)?this._closedColorBatches[i+n].add(e,t):this._closedColorBatches[n].add(e,t):c(t.terrainOffsetProperty)?this._closedMaterialBatches[i+n].add(e,t):this._closedMaterialBatches[n].add(e,t):t.fillMaterialProperty instanceof Ht?c(t.terrainOffsetProperty)?this._openColorBatches[i+n].add(e,t):this._openColorBatches[n].add(e,t):c(t.terrainOffsetProperty)?this._openMaterialBatches[i+n].add(e,t):this._openMaterialBatches[n].add(e,t)};ml._onGeometryChanged=function(e){let t=this._removedObjects,n=this._changedObjects,i=e.entity,o=i.id;!c(t.get(o))&&!c(n.get(o))&&n.set(o,i)};ml.prototype._onCollectionChanged=function(e,t,n){let i=this._addedObjects,o=this._removedObjects,r=this._changedObjects,s,a,l;for(s=n.length-1;s>-1;s--)l=n[s],a=l.id,i.remove(a)||(o.set(a,l),r.remove(a));for(s=t.length-1;s>-1;s--)l=t[s],a=l.id,o.remove(a)?r.set(a,l):i.set(a,l)};var B6=ml;var f$e=1,d$e="30px sans-serif",h$e=ir.FILL,m$e=j.WHITE,p$e=j.BLACK,_$e=1,g$e=!1,y$e=new j(.165,.165,.165,.8),b$e=new H(7,5),x$e=H.ZERO,T$e=h.ZERO,A$e=$e.NONE,C$e=bi.CENTER,E$e=Ln.CENTER,S$e=new h,w$e=new j,v$e=new j,D$e=new j,P$e=new H,I$e=new h,O$e=new H,R$e=new Vt,M$e=new Vt,L$e=new Vt,N$e=new Bt;function kfe(e){this.entity=e,this.label=void 0,this.index=void 0}function wg(e,t){if(!c(e))throw new E("entityCluster is required.");if(!c(t))throw new E("entityCollection is required.");t.collectionChanged.addEventListener(wg.prototype._onCollectionChanged,this),this._cluster=e,this._entityCollection=t,this._items=new St,this._onCollectionChanged(t,t.values,[],[])}wg.prototype.update=function(e){if(!c(e))throw new E("time is required.");let t=this._items.values,n=this._cluster;for(let i=0,o=t.length;i<o;i++){let r=t[i],s=r.entity,a=s._label,l,u=r.label,f=s.isShowing&&s.isAvailable(e)&&X.getValueOrDefault(a._show,e,!0),d;if(f&&(d=X.getValueOrUndefined(s._position,e,S$e),l=X.getValueOrUndefined(a._text,e),f=c(d)&&c(l)),!f){k6(r,s,n);continue}X.isConstant(s._position)||(n._clusterDirty=!0);let p=!1,g=X.getValueOrDefault(a._heightReference,e,A$e);c(u)||(u=n.getLabel(s),u.id=s,r.label=u,p=h.equals(u.position,d)&&u.heightReference===g),u.show=!0,u.position=d,u.text=l,u.scale=X.getValueOrDefault(a._scale,e,f$e),u.font=X.getValueOrDefault(a._font,e,d$e),u.style=X.getValueOrDefault(a._style,e,h$e),u.fillColor=X.getValueOrDefault(a._fillColor,e,m$e,w$e),u.outlineColor=X.getValueOrDefault(a._outlineColor,e,p$e,v$e),u.outlineWidth=X.getValueOrDefault(a._outlineWidth,e,_$e),u.showBackground=X.getValueOrDefault(a._showBackground,e,g$e),u.backgroundColor=X.getValueOrDefault(a._backgroundColor,e,y$e,D$e),u.backgroundPadding=X.getValueOrDefault(a._backgroundPadding,e,b$e,P$e),u.pixelOffset=X.getValueOrDefault(a._pixelOffset,e,x$e,O$e),u.eyeOffset=X.getValueOrDefault(a._eyeOffset,e,T$e,I$e),u.heightReference=g,u.horizontalOrigin=X.getValueOrDefault(a._horizontalOrigin,e,C$e),u.verticalOrigin=X.getValueOrDefault(a._verticalOrigin,e,E$e),u.translucencyByDistance=X.getValueOrUndefined(a._translucencyByDistance,e,R$e),u.pixelOffsetScaleByDistance=X.getValueOrUndefined(a._pixelOffsetScaleByDistance,e,M$e),u.scaleByDistance=X.getValueOrUndefined(a._scaleByDistance,e,L$e),u.distanceDisplayCondition=X.getValueOrUndefined(a._distanceDisplayCondition,e,N$e),u.disableDepthTestDistance=X.getValueOrUndefined(a._disableDepthTestDistance,e),p&&u._updateClamping()}return!0};wg.prototype.getBoundingSphere=function(e,t){if(!c(e))throw new E("entity is required.");if(!c(t))throw new E("result is required.");let n=this._items.get(e.id);if(!c(n)||!c(n.label))return ct.FAILED;let i=n.label;return t.center=h.clone(y(i._clampedPosition,i.position),t.center),t.radius=0,ct.DONE};wg.prototype.isDestroyed=function(){return!1};wg.prototype.destroy=function(){this._entityCollection.collectionChanged.removeEventListener(wg.prototype._onCollectionChanged,this);let e=this._entityCollection.values;for(let t=0;t<e.length;t++)this._cluster.removeLabel(e[t]);return de(this)};wg.prototype._onCollectionChanged=function(e,t,n,i){let o,r,s=this._items,a=this._cluster;for(o=t.length-1;o>-1;o--)r=t[o],c(r._label)&&c(r._position)&&s.set(r.id,new kfe(r));for(o=i.length-1;o>-1;o--)r=i[o],c(r._label)&&c(r._position)?s.contains(r.id)||s.set(r.id,new kfe(r)):(k6(s.get(r.id),r,a),s.remove(r.id));for(o=n.length-1;o>-1;o--)r=n[o],k6(s.get(r.id),r,a),s.remove(r.id)};function k6(e,t,n){c(e)&&(e.label=void 0,n.removeLabel(t))}var V6=wg;var F$e=1,B$e=!0,k$e=0,V$e=!0,U$e=!0,z$e=En.ENABLED,H$e=$e.NONE,G$e=j.RED,j$e=0,W$e=j.WHITE,q$e=ol.HIGHLIGHT,Y$e=.5,X$e=new H(1,1),K$e=new k,$$e=new k,Vfe=new j,Ufe=new Array(4),Z$e=new h;function vg(e,t){A.typeOf.object("scene",e),A.typeOf.object("entityCollection",t),t.collectionChanged.addEventListener(vg.prototype._onCollectionChanged,this),this._scene=e,this._primitives=e.primitives,this._entityCollection=t,this._modelHash={},this._entitiesToVisualize=new St,this._onCollectionChanged(t,t.values,[],[])}async function J$e(e,t,n,i){let o=e._primitives,r=e._modelHash;try{let s=await mp.fromGltfAsync({url:n,incrementallyLoadTextures:i,scene:e._scene});if(e.isDestroyed()||!c(r[t.id]))return;s.id=t,o.add(s),r[t.id].modelPrimitive=s,s.errorEvent.addEventListener(a=>{c(r[t.id])&&(console.log(a),a.name!=="TextureError"&&s.incrementallyLoadTextures&&(r[t.id].loadFailed=!0))})}catch(s){if(e.isDestroyed()||!c(r[t.id]))return;console.log(s),r[t.id].loadFailed=!0}}vg.prototype.update=function(e){if(!c(e))throw new E("time is required.");let t=this._entitiesToVisualize.values,n=this._modelHash,i=this._primitives;for(let o=0,r=t.length;o<r;o++){let s=t[o],a=s._model,l,u=n[s.id],f=s.isShowing&&s.isAvailable(e)&&X.getValueOrDefault(a._show,e,!0),d;if(f&&(d=s.computeModelMatrix(e,K$e),l=De.createIfNeeded(X.getValueOrUndefined(a._uri,e)),f=c(d)&&c(l)),!f){c(u)&&u.modelPrimitive&&(u.modelPrimitive.show=!1);continue}if(!c(u)||l.url!==u.url){c(u?.modelPrimitive)&&(i.removeAndDestroy(u.modelPrimitive),delete n[s.id]),u={modelPrimitive:void 0,url:l.url,animationsRunning:!1,nodeTransformationsScratch:{},articulationsScratch:{},loadFailed:!1,modelUpdated:!1},n[s.id]=u;let m=X.getValueOrDefault(a._incrementallyLoadTextures,e,V$e);J$e(this,s,l,m)}let p=u.modelPrimitive;if(!c(p))continue;p.show=!0,p.scale=X.getValueOrDefault(a._scale,e,F$e),p.enableVerticalExaggeration=X.getValueOrDefault(a._enableVerticalExaggeration,e,B$e),p.minimumPixelSize=X.getValueOrDefault(a._minimumPixelSize,e,k$e),p.maximumScale=X.getValueOrUndefined(a._maximumScale,e),p.modelMatrix=k.clone(d,p.modelMatrix),p.shadows=X.getValueOrDefault(a._shadows,e,z$e),p.heightReference=X.getValueOrDefault(a._heightReference,e,H$e),p.distanceDisplayCondition=X.getValueOrUndefined(a._distanceDisplayCondition,e),p.silhouetteColor=X.getValueOrDefault(a._silhouetteColor,e,G$e,Vfe),p.silhouetteSize=X.getValueOrDefault(a._silhouetteSize,e,j$e),p.color=X.getValueOrDefault(a._color,e,W$e,Vfe),p.colorBlendMode=X.getValueOrDefault(a._colorBlendMode,e,q$e),p.colorBlendAmount=X.getValueOrDefault(a._colorBlendAmount,e,Y$e),p.clippingPlanes=X.getValueOrUndefined(a._clippingPlanes,e),p.clampAnimations=X.getValueOrDefault(a._clampAnimations,e,U$e),p.imageBasedLighting.imageBasedLightingFactor=X.getValueOrDefault(a._imageBasedLightingFactor,e,X$e);let g=X.getValueOrUndefined(a._lightColor,e);if(c(g)&&(j.pack(g,Ufe,0),g=h.unpack(Ufe,0,Z$e)),p.lightColor=g,p.customShader=X.getValueOrUndefined(a._customShader,e),n[s.id].modelUpdated=!0,p.ready){let m=X.getValueOrDefault(a._runAnimations,e,!0);u.animationsRunning!==m&&(m?p.activeAnimations.addAll({loop:$u.REPEAT}):p.activeAnimations.removeAll(),u.animationsRunning=m);let b=X.getValueOrUndefined(a._nodeTransformations,e,u.nodeTransformationsScratch);if(c(b)){let C=Object.keys(b);for(let S=0,v=C.length;S<v;++S){let D=C[S],I=b[D];if(!c(I))continue;let L=p.getNode(D);if(!c(L))continue;let M=k.fromTranslationRotationScale(I,$$e);L.matrix=k.multiply(L.originalMatrix,M,M)}}let x=!1,T=X.getValueOrUndefined(a._articulations,e,u.articulationsScratch);if(c(T)){let C=Object.keys(T);for(let S=0,v=C.length;S<v;++S){let D=C[S],I=T[D];c(I)&&(x=!0,p.setArticulationStage(D,I))}}x&&p.applyArticulations()}}return!0};vg.prototype.isDestroyed=function(){return!1};vg.prototype.destroy=function(){this._entityCollection.collectionChanged.removeEventListener(vg.prototype._onCollectionChanged,this);let e=this._entitiesToVisualize.values,t=this._modelHash,n=this._primitives;for(let i=e.length-1;i>-1;i--)U6(this,e[i],t,n);return de(this)};var RR=new h,Q$e=new he;vg.prototype.getBoundingSphere=function(e,t){if(!c(e))throw new E("entity is required.");if(!c(t))throw new E("result is required.");let n=this._modelHash[e.id];if(!c(n))return ct.FAILED;if(n.loadFailed)return ct.FAILED;let i=n.modelPrimitive;if(!c(i)||!i.show)return ct.PENDING;if(!i.ready||!n.modelUpdated)return ct.PENDING;let o=this._scene,r=y(o.ellipsoid,ie.default);if(i.heightReference!==$e.NONE){let a=i.modelMatrix;RR.x=a[12],RR.y=a[13],RR.z=a[14];let l=r.cartesianToCartographic(RR,Q$e),u=o.getHeight(l,i.heightReference);return c(u)&&(Ru(i.heightReference)?l.height=u:l.height+=u),ce.clone(i.boundingSphere,t),t.center=r.cartographicToCartesian(l),ct.DONE}return ce.clone(i.boundingSphere,t),ct.DONE};vg.prototype._onCollectionChanged=function(e,t,n,i){let o,r,s=this._entitiesToVisualize,a=this._modelHash,l=this._primitives;for(o=t.length-1;o>-1;o--)r=t[o],c(r._model)&&c(r._position)&&s.set(r.id,r);for(o=i.length-1;o>-1;o--)r=i[o],c(r._model)&&c(r._position)?(eZe(r,a),s.set(r.id,r)):(U6(this,r,a,l),s.remove(r.id));for(o=n.length-1;o>-1;o--)r=n[o],U6(this,r,a,l),s.remove(r.id)};function U6(e,t,n,i){let o=n[t.id];c(o)&&(i.removeAndDestroy(o.modelPrimitive),delete n[t.id])}function eZe(e,t){let n=t[e.id];c(n)&&(n.nodeTransformationsScratch={},n.articulationsScratch={})}var z6=vg;function Dg(e){this._definitionChanged=new pe,this._value=void 0,this._removeSubscription=void 0,this.setValue(e)}Object.defineProperties(Dg.prototype,{isConstant:{get:function(){return X.isConstant(this._value)}},definitionChanged:{get:function(){return this._definitionChanged}},referenceFrame:{get:function(){return c(this._value)?this._value.referenceFrame:ji.FIXED}}});var tZe=new J;Dg.prototype.getValue=function(e,t){return c(e)||(e=J.now(tZe)),this.getValueInReferenceFrame(e,ji.FIXED,t)};Dg.prototype.setValue=function(e){this._value!==e&&(this._value=e,c(this._removeSubscription)&&(this._removeSubscription(),this._removeSubscription=void 0),c(e)&&(this._removeSubscription=e.definitionChanged.addEventListener(this._raiseDefinitionChanged,this)),this._definitionChanged.raiseEvent(this))};Dg.prototype.getValueInReferenceFrame=function(e,t,n){if(!c(e))throw new E("time is required.");if(!c(t))throw new E("referenceFrame is required.");if(c(this._value))return n=this._value.getValueInReferenceFrame(e,t,n),c(n)?ie.default.scaleToGeodeticSurface(n,n):void 0};Dg.prototype.equals=function(e){return this===e||e instanceof Dg&&this._value===e._value};Dg.prototype._raiseDefinitionChanged=function(){this._definitionChanged.raiseEvent(this)};var Pg=Dg;var nZe=60,iZe=1,Hfe=new wn,H6=new wn,G6=new wn;function zfe(e){this.entity=e,this.polyline=void 0,this.index=void 0,this.updater=void 0}function oZe(e,t,n,i,o,r,s,a,l){let u=a,f;f=e.getValueInReferenceFrame(t,r,l[u]),c(f)&&(l[u++]=f);let d=!c(o)||J.lessThanOrEquals(o,t)||J.greaterThanOrEquals(o,n),p=0,g=i.length,m=i[p],b=n,x=!1,T,C,S;for(;p<g;){if(!d&&J.greaterThanOrEquals(m,o)&&(f=e.getValueInReferenceFrame(o,r,l[u]),c(f)&&(l[u++]=f),d=!0),J.greaterThan(m,t)&&J.lessThan(m,b)&&!m.equals(o)&&(f=e.getValueInReferenceFrame(m,r,l[u]),c(f)&&(l[u++]=f)),p<g-1){if(s>0&&!x){let v=i[p+1],D=J.secondsDifference(v,m);x=D>s,x&&(T=Math.ceil(D/s),C=0,S=D/Math.max(T,2),T=Math.max(T-1,1))}if(x&&C<T){m=J.addSeconds(m,S,new J),C++;continue}}x=!1,p++,m=i[p]}return f=e.getValueInReferenceFrame(n,r,l[u]),c(f)&&(l[u++]=f),u}function rZe(e,t,n,i,o,r,s,a){let l,u=0,f=s,d=t,p=!c(i)||J.lessThanOrEquals(i,t)||J.greaterThanOrEquals(i,n);for(;J.lessThan(d,n);)!p&&J.greaterThanOrEquals(d,i)&&(p=!0,l=e.getValueInReferenceFrame(i,o,a[f]),c(l)&&(a[f]=l,f++)),l=e.getValueInReferenceFrame(d,o,a[f]),c(l)&&(a[f]=l,f++),u++,d=J.addSeconds(t,r*u,new J);return l=e.getValueInReferenceFrame(n,o,a[f]),c(l)&&(a[f]=l,f++),f}function sZe(e,t,n,i,o,r,s,a){let l,u=0,f=s,d=t,p=Math.max(r,60),g=!c(i)||J.lessThanOrEquals(i,t)||J.greaterThanOrEquals(i,n);for(;J.lessThan(d,n);)!g&&J.greaterThanOrEquals(d,i)&&(g=!0,l=e.getValueInReferenceFrame(i,o,a[f]),c(l)&&(a[f]=l,f++)),l=e.getValueInReferenceFrame(d,o,a[f]),c(l)&&(a[f]=l,f++),u++,d=J.addSeconds(t,p*u,new J);return l=e.getValueInReferenceFrame(n,o,a[f]),c(l)&&(a[f]=l,f++),f}function aZe(e,t,n,i,o,r,s,a){G6.start=t,G6.stop=n;let l=s,u=e.intervals;for(let f=0;f<u.length;f++){let d=u.get(f);if(!wn.intersect(d,G6,Hfe).isEmpty){let p=d.start;d.isStartIncluded||(d.isStopIncluded?p=d.stop:p=J.addSeconds(d.start,J.secondsDifference(d.stop,d.start)/2,new J));let g=e.getValueInReferenceFrame(p,o,a[l]);c(g)&&(a[l]=g,l++)}}return l}function cZe(e,t,n,i,o,r,s,a){let l=e.getValueInReferenceFrame(t,o,a[s]);return c(l)&&(a[s++]=l),s}function lZe(e,t,n,i,o,r,s,a){H6.start=t,H6.stop=n;let l=s,u=e.intervals;for(let f=0;f<u.length;f++){let d=u.get(f);if(!wn.intersect(d,H6,Hfe).isEmpty){let p=d.start,g=d.stop,m=t;J.greaterThan(p,m)&&(m=p);let b=n;J.lessThan(g,b)&&(b=g),l=Gfe(d.data,m,b,i,o,r,l,a)}}return l}function Gfe(e,t,n,i,o,r,s,a){for(;e instanceof ib;)e=e.resolvedProperty;if(e instanceof Ja){let l=e._property._times;s=oZe(e,t,n,l,i,o,r,s,a)}else e instanceof PU?s=rZe(e,t,n,i,o,r,s,a):e instanceof Ka?s=lZe(e,t,n,i,o,r,s,a):e instanceof ob?s=aZe(e,t,n,i,o,r,s,a):e instanceof Qc||e instanceof Pg&&X.isConstant(e)?s=cZe(e,t,n,i,o,r,s,a):s=sZe(e,t,n,i,o,r,s,a);return s}function jfe(e,t,n,i,o,r,s){c(s)||(s=[]);let a=Gfe(e,t,n,i,o,r,0,s);return s.length=a,s}var uZe=new Q;function Nv(e,t){this._unusedIndexes=[],this._polylineCollection=new yp,this._scene=e,this._referenceFrame=t,e.primitives.add(this._polylineCollection)}Nv.prototype.update=function(e){if(this._referenceFrame===ji.INERTIAL){let t=Ft.computeIcrfToCentralBodyFixedMatrix(e,uZe);k.fromRotationTranslation(t,h.ZERO,this._polylineCollection.modelMatrix)}};Nv.prototype.updateObject=function(e,t){let n=t.entity,i=n._path,o=n._position,r,s,a=i._show,l=t.polyline,u=n.isShowing&&n.isAvailable(e)&&(!c(a)||a.getValue(e));if(u){let d=X.getValueOrUndefined(i._leadTime,e),p=X.getValueOrUndefined(i._trailTime,e),g=n._availability,m=c(g),b=c(d),x=c(p);if(u=m||b&&x,u){if(x&&(r=J.addSeconds(e,-p,new J)),b&&(s=J.addSeconds(e,d,new J)),m){let T=g.start,C=g.stop;(!x||J.greaterThan(T,r))&&(r=T),(!b||J.lessThan(C,s))&&(s=C)}u=J.lessThan(r,s)}}if(!u){c(l)&&(this._unusedIndexes.push(t.index),t.polyline=void 0,l.show=!1,t.index=void 0);return}if(!c(l)){let d=this._unusedIndexes;if(d.length>0){let g=d.pop();l=this._polylineCollection.get(g),t.index=g}else t.index=this._polylineCollection.length,l=this._polylineCollection.add();l.id=n,t.polyline=l}let f=X.getValueOrDefault(i._resolution,e,nZe);l.show=!0,l.positions=jfe(o,r,s,e,this._referenceFrame,f,l.positions.slice()),l.material=pr.getValue(e,i._material,l.material),l.width=X.getValueOrDefault(i._width,e,iZe),l.distanceDisplayCondition=X.getValueOrUndefined(i._distanceDisplayCondition,e,l.distanceDisplayCondition)};Nv.prototype.removeObject=function(e){let t=e.polyline;c(t)&&(this._unusedIndexes.push(e.index),e.polyline=void 0,t.show=!1,t.id=void 0,e.index=void 0)};Nv.prototype.destroy=function(){return this._scene.primitives.remove(this._polylineCollection),de(this)};function Ig(e,t){if(!c(e))throw new E("scene is required.");if(!c(t))throw new E("entityCollection is required.");t.collectionChanged.addEventListener(Ig.prototype._onCollectionChanged,this),this._scene=e,this._updaters={},this._entityCollection=t,this._items=new St,this._onCollectionChanged(t,t.values,[],[])}Ig.prototype.update=function(e){if(!c(e))throw new E("time is required.");let t=this._updaters;for(let i in t)t.hasOwnProperty(i)&&t[i].update(e);let n=this._items.values;if(n.length===0&&c(this._updaters)&&Object.keys(this._updaters).length>0){for(let i in t)t.hasOwnProperty(i)&&t[i].destroy();this._updaters={}}for(let i=0,o=n.length;i<o;i++){let r=n[i],a=r.entity._position,l=r.updater,u=ji.FIXED;this._scene.mode===oe.SCENE3D&&(u=a.referenceFrame);let f=this._updaters[u];if(l===f&&c(f)){f.updateObject(e,r);continue}c(l)&&l.removeObject(r),c(f)||(f=new Nv(this._scene,u),f.update(e),this._updaters[u]=f),r.updater=f,c(f)&&f.updateObject(e,r)}return!0};Ig.prototype.isDestroyed=function(){return!1};Ig.prototype.destroy=function(){this._entityCollection.collectionChanged.removeEventListener(Ig.prototype._onCollectionChanged,this);let e=this._updaters;for(let t in e)e.hasOwnProperty(t)&&e[t].destroy();return de(this)};Ig.prototype._onCollectionChanged=function(e,t,n,i){let o,r,s,a=this._items;for(o=t.length-1;o>-1;o--)r=t[o],c(r._path)&&c(r._position)&&a.set(r.id,new zfe(r));for(o=i.length-1;o>-1;o--)r=i[o],c(r._path)&&c(r._position)?a.contains(r.id)||a.set(r.id,new zfe(r)):(s=a.get(r.id),c(s)&&(c(s.updater)&&s.updater.removeObject(s),a.remove(r.id)));for(o=n.length-1;o>-1;o--)r=n[o],s=a.get(r.id),c(s)&&(c(s.updater)&&s.updater.removeObject(s),a.remove(r.id))};Ig._subSample=jfe;var j6=Ig;var Wfe=j.WHITE,qfe=j.BLACK,Yfe=0,Xfe=1,Kfe=0,$fe=$r.NONE,Zfe=new j,fZe=new h,Jfe=new j,Qfe=new Vt,ede=new Vt,tde=new Bt;function nde(e){this.entity=e,this.pointPrimitive=void 0,this.billboard=void 0,this.color=void 0,this.outlineColor=void 0,this.pixelSize=void 0,this.outlineWidth=void 0}function Og(e,t){if(!c(e))throw new E("entityCluster is required.");if(!c(t))throw new E("entityCollection is required.");t.collectionChanged.addEventListener(Og.prototype._onCollectionChanged,this),this._cluster=e,this._entityCollection=t,this._items=new St,this._onCollectionChanged(t,t.values,[],[])}Og.prototype.update=function(e){if(!c(e))throw new E("time is required.");let t=this._items.values,n=this._cluster;for(let i=0,o=t.length;i<o;i++){let r=t[i],s=r.entity,a=s._point,l=r.pointPrimitive,u=r.billboard,f=X.getValueOrDefault(a._heightReference,e,$e.NONE),d=s.isShowing&&s.isAvailable(e)&&X.getValueOrDefault(a._show,e,!0),p;if(d&&(p=X.getValueOrUndefined(s._position,e,fZe),d=c(p)),!d){Fv(r,s,n);continue}X.isConstant(s._position)||(n._clusterDirty=!0);let g=!1,m=!1;if(f!==$e.NONE&&!c(u)?(c(l)&&(Fv(r,s,n),l=void 0),u=n.getBillboard(s),u.id=s,u.image=void 0,r.billboard=u,g=!0,m=h.equals(u.position,p)&&u.heightReference===f):f===$e.NONE&&!c(l)&&(c(u)&&(Fv(r,s,n),u=void 0),l=n.getPoint(s),l.id=s,r.pointPrimitive=l),c(l))l.show=!0,l.position=p,l.scaleByDistance=X.getValueOrUndefined(a._scaleByDistance,e,Qfe),l.translucencyByDistance=X.getValueOrUndefined(a._translucencyByDistance,e,ede),l.color=X.getValueOrDefault(a._color,e,Wfe,Zfe),l.outlineColor=X.getValueOrDefault(a._outlineColor,e,qfe,Jfe),l.outlineWidth=X.getValueOrDefault(a._outlineWidth,e,Yfe),l.pixelSize=X.getValueOrDefault(a._pixelSize,e,Xfe),l.distanceDisplayCondition=X.getValueOrUndefined(a._distanceDisplayCondition,e,tde),l.disableDepthTestDistance=X.getValueOrDefault(a._disableDepthTestDistance,e,Kfe),l.splitDirection=X.getValueOrDefault(a._splitDirection,e,$fe);else if(c(u)){u.show=!0,u.position=p,u.scaleByDistance=X.getValueOrUndefined(a._scaleByDistance,e,Qfe),u.translucencyByDistance=X.getValueOrUndefined(a._translucencyByDistance,e,ede),u.distanceDisplayCondition=X.getValueOrUndefined(a._distanceDisplayCondition,e,tde),u.disableDepthTestDistance=X.getValueOrDefault(a._disableDepthTestDistance,e,Kfe),u.splitDirection=X.getValueOrDefault(a._splitDirection,e,$fe),u.heightReference=f;let b=X.getValueOrDefault(a._color,e,Wfe,Zfe),x=X.getValueOrDefault(a._outlineColor,e,qfe,Jfe),T=Math.round(X.getValueOrDefault(a._outlineWidth,e,Yfe)),C=Math.max(1,Math.round(X.getValueOrDefault(a._pixelSize,e,Xfe)));if(T>0?(u.scale=1,g=g||T!==r.outlineWidth||C!==r.pixelSize||!j.equals(b,r.color)||!j.equals(x,r.outlineColor)):(u.scale=C/50,C=50,g=g||T!==r.outlineWidth||!j.equals(b,r.color)||!j.equals(x,r.outlineColor)),g){r.color=j.clone(b,r.color),r.outlineColor=j.clone(x,r.outlineColor),r.pixelSize=C,r.outlineWidth=T;let S=b.alpha,v=b.toCssColorString(),D=x.toCssColorString(),I=JSON.stringify([v,C,D,T]);u.setImage(I,Ew(S,v,D,T,C))}m&&u._updateClamping()}}return!0};Og.prototype.getBoundingSphere=function(e,t){if(!c(e))throw new E("entity is required.");if(!c(t))throw new E("result is required.");let n=this._items.get(e.id);if(!c(n)||!(c(n.pointPrimitive)||c(n.billboard)))return ct.FAILED;if(c(n.pointPrimitive))t.center=h.clone(n.pointPrimitive.position,t.center);else{let i=n.billboard;if(!c(i._clampedPosition))return ct.PENDING;t.center=h.clone(i._clampedPosition,t.center)}return t.radius=0,ct.DONE};Og.prototype.isDestroyed=function(){return!1};Og.prototype.destroy=function(){this._entityCollection.collectionChanged.removeEventListener(Og.prototype._onCollectionChanged,this);let e=this._entityCollection.values;for(let t=0;t<e.length;t++)this._cluster.removePoint(e[t]);return de(this)};Og.prototype._onCollectionChanged=function(e,t,n,i){let o,r,s=this._items,a=this._cluster;for(o=t.length-1;o>-1;o--)r=t[o],c(r._point)&&c(r._position)&&s.set(r.id,new nde(r));for(o=i.length-1;o>-1;o--)r=i[o],c(r._point)&&c(r._position)?s.contains(r.id)||s.set(r.id,new nde(r)):(Fv(s.get(r.id),r,a),s.remove(r.id));for(o=n.length-1;o>-1;o--)r=n[o],Fv(s.get(r.id),r,a),s.remove(r.id)};function Fv(e,t,n){if(c(e)){let i=e.pointPrimitive;if(c(i)){e.pointPrimitive=void 0,n.removePoint(t);return}let o=e.billboard;c(o)&&(e.billboard=void 0,n.removeBillboard(t))}}var W6=Og;var ade=[];function dZe(e,t,n,i,o){let r=ade;r.length=o;let s,a=n.red,l=n.green,u=n.blue,f=n.alpha,d=i.red,p=i.green,g=i.blue,m=i.alpha;if(j.equals(n,i)){for(s=0;s<o;s++)r[s]=j.clone(n);return r}let b=(d-a)/o,x=(p-l)/o,T=(g-u)/o,C=(m-f)/o;for(s=0;s<o;s++)r[s]=new j(a+s*b,l+s*x,u+s*T,f+s*C);return r}function Bv(e){e=y(e,y.EMPTY_OBJECT);let t=e.positions,n=e.colors,i=y(e.width,1),o=y(e.colorsPerVertex,!1);if(!c(t)||t.length<2)throw new E("At least two positions are required.");if(typeof i!="number")throw new E("width must be a number");if(c(n)&&(o&&n.length<t.length||!o&&n.length<t.length-1))throw new E("colors has an invalid length.");this._positions=t,this._colors=n,this._width=i,this._colorsPerVertex=o,this._vertexFormat=Ie.clone(y(e.vertexFormat,Ie.DEFAULT)),this._arcType=y(e.arcType,Yt.GEODESIC),this._granularity=y(e.granularity,R.RADIANS_PER_DEGREE),this._ellipsoid=ie.clone(y(e.ellipsoid,ie.default)),this._workerName="createPolylineGeometry";let r=1+t.length*h.packedLength;r+=c(n)?1+n.length*j.packedLength:1,this.packedLength=r+ie.packedLength+Ie.packedLength+4}Bv.pack=function(e,t,n){if(!c(e))throw new E("value is required");if(!c(t))throw new E("array is required");n=y(n,0);let i,o=e._positions,r=o.length;for(t[n++]=r,i=0;i<r;++i,n+=h.packedLength)h.pack(o[i],t,n);let s=e._colors;for(r=c(s)?s.length:0,t[n++]=r,i=0;i<r;++i,n+=j.packedLength)j.pack(s[i],t,n);return ie.pack(e._ellipsoid,t,n),n+=ie.packedLength,Ie.pack(e._vertexFormat,t,n),n+=Ie.packedLength,t[n++]=e._width,t[n++]=e._colorsPerVertex?1:0,t[n++]=e._arcType,t[n]=e._granularity,t};var cde=ie.clone(ie.UNIT_SPHERE),lde=new Ie,gb={positions:void 0,colors:void 0,ellipsoid:cde,vertexFormat:lde,width:void 0,colorsPerVertex:void 0,arcType:void 0,granularity:void 0};Bv.unpack=function(e,t,n){if(!c(e))throw new E("array is required");t=y(t,0);let i,o=e[t++],r=new Array(o);for(i=0;i<o;++i,t+=h.packedLength)r[i]=h.unpack(e,t);o=e[t++];let s=o>0?new Array(o):void 0;for(i=0;i<o;++i,t+=j.packedLength)s[i]=j.unpack(e,t);let a=ie.unpack(e,t,cde);t+=ie.packedLength;let l=Ie.unpack(e,t,lde);t+=Ie.packedLength;let u=e[t++],f=e[t++]===1,d=e[t++],p=e[t];return c(n)?(n._positions=r,n._colors=s,n._ellipsoid=ie.clone(a,n._ellipsoid),n._vertexFormat=Ie.clone(l,n._vertexFormat),n._width=u,n._colorsPerVertex=f,n._arcType=d,n._granularity=p,n):(gb.positions=r,gb.colors=s,gb.width=u,gb.colorsPerVertex=f,gb.arcType=d,gb.granularity=p,new Bv(gb))};var ide=new h,ode=new h,rde=new h,sde=new h;Bv.createGeometry=function(e){let t=e._width,n=e._vertexFormat,i=e._colors,o=e._colorsPerVertex,r=e._arcType,s=e._granularity,a=e._ellipsoid,l,u,f,d=[],p=Ao(e._positions,h.equalsEpsilon,!1,d);if(c(i)&&d.length>0){let F=0,V=d[0];i=i.filter(function(G,z){let W=!1;return o?W=z===V||z===0&&V===1:W=z+1===V,W?(F++,V=d[F],!1):!0})}let g=p.length;if(g<2||t<=0)return;if(r===Yt.GEODESIC||r===Yt.RHUMB){let F,V;r===Yt.GEODESIC?(F=R.chordLength(s,a.maximumRadius),V=Bi.numberOfPoints):(F=s,V=Bi.numberOfPointsRhumbLine);let G=Bi.extractHeights(p,a);if(c(i)){let z=1;for(l=0;l<g-1;++l)z+=V(p[l],p[l+1],F);let W=new Array(z),U=0;for(l=0;l<g-1;++l){let q=p[l],K=p[l+1],te=i[l],Y=V(q,K,F);if(o&&l<z){let Z=i[l+1],ee=dZe(q,K,te,Z,Y),me=ee.length;for(u=0;u<me;++u)W[U++]=ee[u]}else for(u=0;u<Y;++u)W[U++]=j.clone(te)}W[U]=j.clone(i[i.length-1]),i=W,ade.length=0}r===Yt.GEODESIC?p=Bi.generateCartesianArc({positions:p,minDistance:F,ellipsoid:a,height:G}):p=Bi.generateCartesianRhumbArc({positions:p,granularity:F,ellipsoid:a,height:G})}g=p.length;let m=g*4-4,b=new Float64Array(m*3),x=new Float64Array(m*3),T=new Float64Array(m*3),C=new Float32Array(m*2),S=n.st?new Float32Array(m*2):void 0,v=c(i)?new Uint8Array(m*4):void 0,D=0,I=0,L=0,M=0,N;for(u=0;u<g;++u){u===0?(N=ide,h.subtract(p[0],p[1],N),h.add(p[0],N,N)):N=p[u-1],h.clone(N,rde),h.clone(p[u],ode),u===g-1?(N=ide,h.subtract(p[g-1],p[g-2],N),h.add(p[g-1],N,N)):N=p[u+1],h.clone(N,sde);let F,V;c(v)&&(u!==0&&!o?F=i[u-1]:F=i[u],u!==g-1&&(V=i[u]));let G=u===0?2:0,z=u===g-1?2:4;for(f=G;f<z;++f){h.pack(ode,b,D),h.pack(rde,x,D),h.pack(sde,T,D),D+=3;let W=f-2<0?-1:1;if(C[I++]=2*(f%2)-1,C[I++]=W*t,n.st&&(S[L++]=u/(g-1),S[L++]=Math.max(C[I-2],0)),c(v)){let U=f<2?F:V;v[M++]=j.floatToByte(U.red),v[M++]=j.floatToByte(U.green),v[M++]=j.floatToByte(U.blue),v[M++]=j.floatToByte(U.alpha)}}}let B=new pn;B.position=new we({componentDatatype:$.DOUBLE,componentsPerAttribute:3,values:b}),B.prevPosition=new we({componentDatatype:$.DOUBLE,componentsPerAttribute:3,values:x}),B.nextPosition=new we({componentDatatype:$.DOUBLE,componentsPerAttribute:3,values:T}),B.expandAndWidth=new we({componentDatatype:$.FLOAT,componentsPerAttribute:2,values:C}),n.st&&(B.st=new we({componentDatatype:$.FLOAT,componentsPerAttribute:2,values:S})),c(v)&&(B.color=new we({componentDatatype:$.UNSIGNED_BYTE,componentsPerAttribute:4,values:v,normalize:!0}));let _=Fe.createTypedArray(m,g*6-6),w=0,P=0,O=g-1;for(u=0;u<O;++u)_[P++]=w,_[P++]=w+2,_[P++]=w+1,_[P++]=w+1,_[P++]=w+2,_[P++]=w+3,w+=4;return new ut({attributes:B,indices:_,primitiveType:Me.TRIANGLES,boundingSphere:ce.fromPoints(p),geometryType:th.POLYLINES})};var yb=Bv;var hZe=new Kn(0),MR={},ude=new j,mZe=new Ht(j.WHITE),pZe=new Kn(!0),_Ze=new Kn(En.DISABLED),gZe=new Kn(new Bt),yZe=new Kn(Vn.BOTH);function bZe(){this.vertexFormat=void 0,this.positions=void 0,this.width=void 0,this.arcType=void 0,this.granularity=void 0}function xZe(){this.positions=void 0,this.width=void 0,this.arcType=void 0,this.granularity=void 0}function wd(e,t){if(!c(e))throw new E("entity is required");if(!c(t))throw new E("scene is required");this._entity=e,this._scene=t,this._entitySubscription=e.definitionChanged.addEventListener(wd.prototype._onEntityPropertyChanged,this),this._fillEnabled=!1,this._dynamic=!1,this._geometryChanged=new pe,this._showProperty=void 0,this._materialProperty=void 0,this._shadowsProperty=void 0,this._distanceDisplayConditionProperty=void 0,this._classificationTypeProperty=void 0,this._depthFailMaterialProperty=void 0,this._geometryOptions=new bZe,this._groundGeometryOptions=new xZe,this._id=`polyline-${e.id}`,this._clampToGround=!1,this._supportsPolylinesOnTerrain=Qo.supportsPolylinesOnTerrain(t),this._zIndex=0,this._onEntityPropertyChanged(e,"polyline",e.polyline,void 0)}Object.defineProperties(wd.prototype,{id:{get:function(){return this._id}},entity:{get:function(){return this._entity}},fillEnabled:{get:function(){return this._fillEnabled}},hasConstantFill:{get:function(){return!this._fillEnabled||!c(this._entity.availability)&&X.isConstant(this._showProperty)}},fillMaterialProperty:{get:function(){return this._materialProperty}},depthFailMaterialProperty:{get:function(){return this._depthFailMaterialProperty}},outlineEnabled:{value:!1},hasConstantOutline:{value:!0},outlineColorProperty:{value:void 0},shadowsProperty:{get:function(){return this._shadowsProperty}},distanceDisplayConditionProperty:{get:function(){return this._distanceDisplayConditionProperty}},classificationTypeProperty:{get:function(){return this._classificationTypeProperty}},isDynamic:{get:function(){return this._dynamic}},isClosed:{value:!1},geometryChanged:{get:function(){return this._geometryChanged}},arcType:{get:function(){return this._arcType}},clampToGround:{get:function(){return this._clampToGround&&this._supportsPolylinesOnTerrain}},zIndex:{get:function(){return this._zIndex}}});wd.prototype.isOutlineVisible=function(e){return!1};wd.prototype.isFilled=function(e){let t=this._entity,n=this._fillEnabled&&t.isAvailable(e)&&this._showProperty.getValue(e);return y(n,!1)};wd.prototype.createFillGeometryInstance=function(e){if(!c(e))throw new E("time is required.");if(!this._fillEnabled)throw new E("This instance does not represent a filled geometry.");let t=this._entity,n=t.isAvailable(e),i=new Cn(n&&t.isShowing&&this._showProperty.getValue(e)),o=this._distanceDisplayConditionProperty.getValue(e),r=kn.fromDistanceDisplayCondition(o),s={show:i,distanceDisplayCondition:r},a;return this._materialProperty instanceof Ht&&(c(this._materialProperty.color)&&(this._materialProperty.color.isConstant||n)&&(a=this._materialProperty.color.getValue(e,ude)),c(a)||(a=j.WHITE),s.color=Wt.fromColor(a)),this.clampToGround?new vt({id:t,geometry:new jE(this._groundGeometryOptions),attributes:s}):(c(this._depthFailMaterialProperty)&&this._depthFailMaterialProperty instanceof Ht&&(c(this._depthFailMaterialProperty.color)&&(this._depthFailMaterialProperty.color.isConstant||n)&&(a=this._depthFailMaterialProperty.color.getValue(e,ude)),c(a)||(a=j.WHITE),s.depthFailColor=Wt.fromColor(a)),new vt({id:t,geometry:new yb(this._geometryOptions),attributes:s}))};wd.prototype.createOutlineGeometryInstance=function(e){throw new E("This instance does not represent an outlined geometry.")};wd.prototype.isDestroyed=function(){return!1};wd.prototype.destroy=function(){this._entitySubscription(),de(this)};wd.prototype._onEntityPropertyChanged=function(e,t,n,i){if(!(t==="availability"||t==="polyline"))return;let o=this._entity.polyline;if(!c(o)){this._fillEnabled&&(this._fillEnabled=!1,this._geometryChanged.raiseEvent(this));return}let r=o.positions,s=o.show;if(c(s)&&s.isConstant&&!s.getValue(je.MINIMUM_VALUE)||!c(r)){this._fillEnabled&&(this._fillEnabled=!1,this._geometryChanged.raiseEvent(this));return}let a=o.zIndex,l=y(o.material,mZe),u=l instanceof Ht;this._materialProperty=l,this._depthFailMaterialProperty=o.depthFailMaterial,this._showProperty=y(s,pZe),this._shadowsProperty=y(o.shadows,_Ze),this._distanceDisplayConditionProperty=y(o.distanceDisplayCondition,gZe),this._classificationTypeProperty=y(o.classificationType,yZe),this._fillEnabled=!0,this._zIndex=y(a,hZe);let f=o.width,d=o.arcType,p=o.clampToGround,g=o.granularity;if(!r.isConstant||!X.isConstant(f)||!X.isConstant(d)||!X.isConstant(g)||!X.isConstant(p)||!X.isConstant(a))this._dynamic||(this._dynamic=!0,this._geometryChanged.raiseEvent(this));else{let m=this._geometryOptions,b=r.getValue(je.MINIMUM_VALUE,m.positions);if(!c(b)||b.length<2){this._fillEnabled&&(this._fillEnabled=!1,this._geometryChanged.raiseEvent(this));return}let x;u&&(!c(this._depthFailMaterialProperty)||this._depthFailMaterialProperty instanceof Ht)?x=us.VERTEX_FORMAT:x=Ua.VERTEX_FORMAT,m.vertexFormat=x,m.positions=b,m.width=c(f)?f.getValue(je.MINIMUM_VALUE):void 0,m.arcType=c(d)?d.getValue(je.MINIMUM_VALUE):void 0,m.granularity=c(g)?g.getValue(je.MINIMUM_VALUE):void 0;let T=this._groundGeometryOptions;T.positions=b,T.width=m.width,T.arcType=m.arcType,T.granularity=m.granularity,this._clampToGround=c(p)?p.getValue(je.MINIMUM_VALUE):!1,!this._clampToGround&&c(a)&&_t("Entity polylines must have clampToGround: true when using zIndex.  zIndex will be ignored."),this._dynamic=!1,this._geometryChanged.raiseEvent(this)}};wd.prototype.createDynamicUpdater=function(e,t){if(A.defined("primitives",e),A.defined("groundPrimitives",t),!this._dynamic)throw new E("This instance does not represent dynamic geometry.");return new kv(e,t,this)};var kA={positions:void 0,granularity:void 0,height:void 0,ellipsoid:void 0};function kv(e,t,n){this._line=void 0,this._primitives=e,this._groundPrimitives=t,this._groundPolylinePrimitive=void 0,this._material=void 0,this._geometryUpdater=n,this._positions=[]}function fde(e){if(c(e._line))return e._line;let t=e._primitives,n=e._geometryUpdater._scene.id+t._guid,i=MR[n];!c(i)||i.isDestroyed()?(i=new yp,MR[n]=i,t.add(i)):t.contains(i)||t.add(i);let o=i.add();return o.id=e._geometryUpdater._entity,e._line=o,o}kv.prototype.update=function(e){let t=this._geometryUpdater,n=t._entity,i=n.polyline,o=i.positions,r=X.getValueOrUndefined(o,e,this._positions);t._clampToGround=X.getValueOrDefault(i._clampToGround,e,!1),t._groundGeometryOptions.positions=r,t._groundGeometryOptions.width=X.getValueOrDefault(i._width,e,1),t._groundGeometryOptions.arcType=X.getValueOrDefault(i._arcType,e,Yt.GEODESIC),t._groundGeometryOptions.granularity=X.getValueOrDefault(i._granularity,e,9999);let s=this._groundPrimitives;if(c(this._groundPolylinePrimitive)&&(s.remove(this._groundPolylinePrimitive),this._groundPolylinePrimitive=void 0),t.clampToGround){if(!n.isShowing||!n.isAvailable(e)||!X.getValueOrDefault(i._show,e,!0)||!c(r)||r.length<2)return;let d=t.fillMaterialProperty,p;if(d instanceof Ht)p=new us;else{let g=pr.getValue(e,d,this._material);p=new Ua({material:g,translucent:g.isTranslucent()}),this._material=g}this._groundPolylinePrimitive=s.add(new Fm({geometryInstances:t.createFillGeometryInstance(e),appearance:p,classificationType:t.classificationTypeProperty.getValue(e),asynchronous:!1}),X.getValueOrUndefined(t.zIndex,e)),c(this._line)&&(this._line.show=!1);return}let a=fde(this);if(!n.isShowing||!n.isAvailable(e)||!X.getValueOrDefault(i._show,e,!0)){a.show=!1;return}if(!c(r)||r.length<2){a.show=!1;return}let l=Yt.GEODESIC;l=X.getValueOrDefault(i._arcType,e,l);let u=t._scene.globe,f=t._scene.ellipsoid;l!==Yt.NONE&&c(u)&&(kA.ellipsoid=f,kA.positions=r,kA.granularity=X.getValueOrUndefined(i._granularity,e),kA.height=Bi.extractHeights(r,f),l===Yt.GEODESIC?r=Bi.generateCartesianArc(kA):r=Bi.generateCartesianRhumbArc(kA)),a.show=!0,a.positions=r.slice(),a.material=pr.getValue(e,t.fillMaterialProperty,a.material),a.width=X.getValueOrDefault(i._width,e,1),a.distanceDisplayCondition=X.getValueOrUndefined(i._distanceDisplayCondition,e,a.distanceDisplayCondition)};kv.prototype.getBoundingSphere=function(e){if(A.defined("result",e),this._geometryUpdater.clampToGround){let t=this._groundPolylinePrimitive;if(c(t)&&t.show&&t.ready){let n=t.getGeometryInstanceAttributes(this._geometryUpdater._entity);if(c(n)&&c(n.boundingSphere))return ce.clone(n.boundingSphere,e),ct.DONE}return c(t)&&!t.ready?ct.PENDING:ct.DONE}else{let t=fde(this);if(t.show&&t.positions.length>0)return ce.fromPoints(t.positions,e),ct.DONE}return ct.FAILED};kv.prototype.isDestroyed=function(){return!1};kv.prototype.destroy=function(){let t=this._geometryUpdater._scene.id+this._primitives._guid,n=MR[t];c(n)&&(n.remove(this._line),n.length===0&&(this._primitives.removeAndDestroy(n),delete MR[t])),c(this._groundPolylinePrimitive)&&this._groundPrimitives.remove(this._groundPolylinePrimitive),de(this)};var q6=wd;var TZe=new j,AZe=new Bt,CZe=new Bt;function vd(e,t,n,i,o){let r;n instanceof Ht?r=us:r=Ua,this.orderedGroundPrimitives=e,this.classificationType=t,this.appearanceType=r,this.materialProperty=n,this.updaters=new St,this.createPrimitive=!0,this.primitive=void 0,this.oldPrimitive=void 0,this.geometry=new St,this.material=void 0,this.updatersWithAttributes=new St,this.attributes=new St,this.invalidated=!1,this.removeMaterialSubscription=n.definitionChanged.addEventListener(vd.prototype.onMaterialChanged,this),this.subscriptions=new St,this.showsUpdated=new St,this.zIndex=i,this._asynchronous=o}vd.prototype.onMaterialChanged=function(){this.invalidated=!0};vd.prototype.isMaterial=function(e){let t=this.materialProperty,n=e.fillMaterialProperty;return n===t||n instanceof Ht&&t instanceof Ht?!0:c(t)&&t.equals(n)};vd.prototype.add=function(e,t,n){let i=t.id;if(this.updaters.set(i,t),this.geometry.set(i,n),!t.hasConstantFill||!t.fillMaterialProperty.isConstant||!X.isConstant(t.distanceDisplayConditionProperty))this.updatersWithAttributes.set(i,t);else{let o=this;this.subscriptions.set(i,t.entity.definitionChanged.addEventListener(function(r,s,a,l){s==="isShowing"&&o.showsUpdated.set(t.id,t)}))}this.createPrimitive=!0};vd.prototype.remove=function(e){let t=e.id;if(this.createPrimitive=this.geometry.remove(t)||this.createPrimitive,this.updaters.remove(t)){this.updatersWithAttributes.remove(t);let n=this.subscriptions.get(t);return c(n)&&(n(),this.subscriptions.remove(t)),!0}return!1};vd.prototype.update=function(e){let t=!0,n=this.primitive,i=this.orderedGroundPrimitives,o=this.geometry.values,r;if(this.createPrimitive){if(o.length>0)c(n)&&(c(this.oldPrimitive)?i.remove(n):this.oldPrimitive=n),n=new Fm({show:!1,asynchronous:this._asynchronous,geometryInstances:o.slice(),appearance:new this.appearanceType,classificationType:this.classificationType}),this.appearanceType===Ua&&(this.material=pr.getValue(e,this.materialProperty,this.material),n.appearance.material=this.material),i.add(n,this.zIndex),t=!1;else{c(n)&&(i.remove(n),n=void 0);let a=this.oldPrimitive;c(a)&&(i.remove(a),this.oldPrimitive=void 0)}this.attributes.removeAll(),this.primitive=n,this.createPrimitive=!1}else if(c(n)&&n.ready){n.show=!0,c(this.oldPrimitive)&&(i.remove(this.oldPrimitive),this.oldPrimitive=void 0),this.appearanceType===Ua&&(this.material=pr.getValue(e,this.materialProperty,this.material),this.primitive.appearance.material=this.material);let s=this.updatersWithAttributes.values,a=s.length;for(r=0;r<a;r++){let l=s[r],u=l.entity,f=this.geometry.get(l.id),d=this.attributes.get(f.id.id);if(c(d)||(d=n.getGeometryInstanceAttributes(f.id),this.attributes.set(f.id.id,d)),!l.fillMaterialProperty.isConstant){let b=l.fillMaterialProperty.color,x=X.getValueOrDefault(b,e,j.WHITE,TZe);j.equals(d._lastColor,x)||(d._lastColor=j.clone(x,d._lastColor),d.color=Wt.toValue(x,d.color))}let p=u.isShowing&&(l.hasConstantFill||l.isFilled(e)),g=d.show[0]===1;p!==g&&(d.show=Cn.toValue(p,d.show));let m=l.distanceDisplayConditionProperty;if(!X.isConstant(m)){let b=X.getValueOrDefault(m,e,CZe,AZe);Bt.equals(b,d._lastDistanceDisplayCondition)||(d._lastDistanceDisplayCondition=Bt.clone(b,d._lastDistanceDisplayCondition),d.distanceDisplayCondition=kn.toValue(b,d.distanceDisplayCondition))}}this.updateShows(n)}else c(n)&&!n.ready&&(t=!1);return t};vd.prototype.updateShows=function(e){let t=this.showsUpdated.values,n=t.length;for(let i=0;i<n;i++){let o=t[i],r=o.entity,s=this.geometry.get(o.id),a=this.attributes.get(s.id.id);c(a)||(a=e.getGeometryInstanceAttributes(s.id),this.attributes.set(s.id.id,a));let l=r.isShowing,u=a.show[0]===1;l!==u&&(a.show=Cn.toValue(l,a.show),s.attributes.show.value[0]=a.show[0])}this.showsUpdated.removeAll()};vd.prototype.contains=function(e){return this.updaters.contains(e.id)};vd.prototype.getBoundingSphere=function(e,t){let n=this.primitive;if(!n.ready)return ct.PENDING;let i=n.getGeometryInstanceAttributes(e.entity);return!c(i)||!c(i.boundingSphere)||c(i.show)&&i.show[0]===0?ct.FAILED:(i.boundingSphere.clone(t),ct.DONE)};vd.prototype.destroy=function(){let e=this.primitive,t=this.orderedGroundPrimitives;c(e)&&t.remove(e);let n=this.oldPrimitive;c(n)&&t.remove(n),this.removeMaterialSubscription()};function VA(e,t,n){this._items=[],this._orderedGroundPrimitives=e,this._classificationType=t,this._asynchronous=y(n,!0)}VA.prototype.add=function(e,t){let n=this._items,i=n.length,o=t.createFillGeometryInstance(e),r=X.getValueOrDefault(t.zIndex,0);for(let a=0;a<i;++a){let l=n[a];if(l.isMaterial(t)&&l.zIndex===r){l.add(e,t,o);return}}let s=new vd(this._orderedGroundPrimitives,this._classificationType,t.fillMaterialProperty,r,this._asynchronous);s.add(e,t,o),n.push(s)};VA.prototype.remove=function(e){let t=this._items,n=t.length;for(let i=n-1;i>=0;i--){let o=t[i];if(o.remove(e)){o.updaters.length===0&&(t.splice(i,1),o.destroy());break}}};VA.prototype.update=function(e){let t,n=this._items,i=n.length;for(t=i-1;t>=0;t--){let r=n[t];if(r.invalidated){n.splice(t,1);let s=r.updaters.values,a=s.length;for(let l=0;l<a;l++)this.add(e,s[l]);r.destroy()}}let o=!0;for(t=0;t<n.length;t++)o=n[t].update(e)&&o;return o};VA.prototype.getBoundingSphere=function(e,t){let n=this._items,i=n.length;for(let o=0;o<i;o++){let r=n[o];if(r.contains(e))return r.getBoundingSphere(e,t)}return ct.FAILED};VA.prototype.removeAllPrimitives=function(){let e=this._items,t=e.length;for(let n=0;n<t;n++)e[n].destroy();this._items.length=0};var Y6=VA;var EZe=[];function dde(e,t){let n=e._batches,i=n.length;for(let o=0;o<i;o++)n[o].remove(t)}function hde(e,t,n){if(n.isDynamic){e._dynamicBatch.add(t,n);return}if(n.clampToGround&&n.fillEnabled){let s=n.classificationTypeProperty.getValue(t);e._groundBatches[s].add(t,n);return}let i;n.fillEnabled&&(i=n.shadowsProperty.getValue(t));let o=0;c(n.depthFailMaterialProperty)&&(o=n.depthFailMaterialProperty instanceof Ht?1:2);let r;c(i)&&(r=i+o*En.NUMBER_OF_SHADOW_MODES),n.fillEnabled&&(n.fillMaterialProperty instanceof Ht?e._colorBatches[r].add(t,n):e._materialBatches[r].add(t,n))}function Uh(e,t,n,i){A.defined("scene",e),A.defined("entityCollection",t),i=y(i,e.groundPrimitives),n=y(n,e.primitives),this._scene=e,this._primitives=n,this._entityCollection=void 0,this._addedObjects=new St,this._removedObjects=new St,this._changedObjects=new St;let o,r=En.NUMBER_OF_SHADOW_MODES;for(this._colorBatches=new Array(r*3),this._materialBatches=new Array(r*3),o=0;o<r;++o)this._colorBatches[o]=new kh(n,us,void 0,!1,o),this._materialBatches[o]=new Vh(n,Ua,void 0,!1,o),this._colorBatches[o+r]=new kh(n,us,us,!1,o),this._materialBatches[o+r]=new Vh(n,Ua,us,!1,o),this._colorBatches[o+r*2]=new kh(n,us,Ua,!1,o),this._materialBatches[o+r*2]=new Vh(n,Ua,Ua,!1,o);this._dynamicBatch=new Av(n,i);let s=Vn.NUMBER_OF_CLASSIFICATION_TYPES;for(this._groundBatches=new Array(s),o=0;o<s;++o)this._groundBatches[o]=new Y6(i,o);this._batches=this._colorBatches.concat(this._materialBatches,this._dynamicBatch,this._groundBatches),this._subscriptions=new St,this._updaters=new St,this._entityCollection=t,t.collectionChanged.addEventListener(Uh.prototype._onCollectionChanged,this),this._onCollectionChanged(t,t.values,EZe)}Uh.prototype.update=function(e){A.defined("time",e);let t=this._addedObjects,n=t.values,i=this._removedObjects,o=i.values,r=this._changedObjects,s=r.values,a,l,u,f;for(a=s.length-1;a>-1;a--)l=s[a],u=l.id,f=this._updaters.get(u),f.entity===l?(dde(this,f),hde(this,e,f)):(o.push(l),n.push(l));for(a=o.length-1;a>-1;a--)l=o[a],u=l.id,f=this._updaters.get(u),dde(this,f),f.destroy(),this._updaters.remove(u),this._subscriptions.get(u)(),this._subscriptions.remove(u);for(a=n.length-1;a>-1;a--)l=n[a],u=l.id,f=new q6(l,this._scene),this._updaters.set(u,f),hde(this,e,f),this._subscriptions.set(u,f.geometryChanged.addEventListener(Uh._onGeometryChanged,this));t.removeAll(),i.removeAll(),r.removeAll();let d=!0,p=this._batches,g=p.length;for(a=0;a<g;a++)d=p[a].update(e)&&d;return d};var SZe=[],wZe=new ce;Uh.prototype.getBoundingSphere=function(e,t){A.defined("entity",e),A.defined("result",t);let n=SZe,i=wZe,o=0,r=ct.DONE,s=this._batches,a=s.length,l=this._updaters.get(e.id);for(let u=0;u<a;u++){if(r=s[u].getBoundingSphere(l,i),r===ct.PENDING)return ct.PENDING;r===ct.DONE&&(n[o]=ce.clone(i,n[o]),o++)}return o===0?ct.FAILED:(n.length=o,ce.fromBoundingSpheres(n,t),ct.DONE)};Uh.prototype.isDestroyed=function(){return!1};Uh.prototype.destroy=function(){this._entityCollection.collectionChanged.removeEventListener(Uh.prototype._onCollectionChanged,this),this._addedObjects.removeAll(),this._removedObjects.removeAll();let e,t=this._batches,n=t.length;for(e=0;e<n;e++)t[e].removeAllPrimitives();let i=this._subscriptions.values;for(n=i.length,e=0;e<n;e++)i[e]();return this._subscriptions.removeAll(),de(this)};Uh._onGeometryChanged=function(e){let t=this._removedObjects,n=this._changedObjects,i=e.entity,o=i.id;!c(t.get(o))&&!c(n.get(o))&&n.set(o,i)};Uh.prototype._onCollectionChanged=function(e,t,n){let i=this._addedObjects,o=this._removedObjects,r=this._changedObjects,s,a,l;for(s=n.length-1;s>-1;s--)l=n[s],a=l.id,i.remove(a)||(o.set(a,l),r.remove(a));for(s=t.length-1;s>-1;s--)l=t[s],a=l.id,o.remove(a)?r.set(a,l):i.set(a,l)};var X6=Uh;function pl(e){A.typeOf.object("options",e),A.typeOf.object("options.scene",e.scene),A.typeOf.object("options.dataSourceCollection",e.dataSourceCollection),Ll.initializeTerrainHeights(),Fm.initializeTerrainHeights();let t=e.scene,n=e.dataSourceCollection;this._eventHelper=new yr,this._eventHelper.add(n.dataSourceAdded,this._onDataSourceAdded,this),this._eventHelper.add(n.dataSourceRemoved,this._onDataSourceRemoved,this),this._eventHelper.add(n.dataSourceMoved,this._onDataSourceMoved,this),this._eventHelper.add(t.postRender,this._postRender,this),this._dataSourceCollection=n,this._scene=t,this._visualizersCallback=y(e.visualizersCallback,pl.defaultVisualizersCallback);let i=!1,o=new mf,r=new mf;n.length>0&&(t.primitives.add(o),t.groundPrimitives.add(r),i=!0),this._primitives=o,this._groundPrimitives=r;for(let u=0,f=n.length;u<f;u++)this._onDataSourceAdded(n,n.get(u));let s=new L5;this._onDataSourceAdded(void 0,s),this._defaultDataSource=s;let a,l;if(!i){let u=this,f=function(){t.primitives.add(o),t.groundPrimitives.add(r),a(),l(),u._removeDefaultDataSourceListener=void 0,u._removeDataSourceCollectionListener=void 0};a=s.entities.collectionChanged.addEventListener(f),l=n.dataSourceAdded.addEventListener(f)}this._removeDefaultDataSourceListener=a,this._removeDataSourceCollectionListener=l,this._ready=!1}var UA=[];pl.registerVisualizer=function(e){UA.includes(e)||UA.push(e)};pl.unregisterVisualizer=function(e){if(UA.includes(e)){let t=UA.indexOf(e);UA.splice(t,1)}};pl.defaultVisualizersCallback=function(e,t,n){let i=n.entities;return[new q2(t,i),new B6(e,i,n._primitives,n._groundPrimitives),new V6(t,i),new z6(e,i),new i5(e,i),new W6(t,i),new j6(e,i),new X6(e,i,n._primitives,n._groundPrimitives),...UA.map(o=>new o(e,i))]};Object.defineProperties(pl.prototype,{scene:{get:function(){return this._scene}},dataSources:{get:function(){return this._dataSourceCollection}},defaultDataSource:{get:function(){return this._defaultDataSource}},ready:{get:function(){return this._ready}}});pl.prototype.isDestroyed=function(){return!1};pl.prototype.destroy=function(){this._eventHelper.removeAll();let e=this._dataSourceCollection;for(let t=0,n=e.length;t<n;++t)this._onDataSourceRemoved(this._dataSourceCollection,e.get(t));return this._onDataSourceRemoved(void 0,this._defaultDataSource),c(this._removeDefaultDataSourceListener)?(this._removeDefaultDataSourceListener(),this._removeDataSourceCollectionListener()):(this._scene.primitives.remove(this._primitives),this._scene.groundPrimitives.remove(this._groundPrimitives)),de(this)};pl.prototype.update=function(e){if(A.defined("time",e),!di.initialized)return this._ready=!1,!1;let t=!0,n,i,o,r,s=this._dataSourceCollection,a=s.length;for(n=0;n<a;n++){let l=s.get(n);for(c(l.update)&&(t=l.update(e)&&t),o=l._visualizers,r=o.length,i=0;i<r;i++)t=o[i].update(e)&&t}for(o=this._defaultDataSource._visualizers,r=o.length,i=0;i<r;i++)t=o[i].update(e)&&t;return!this._ready&&t&&this._scene.requestRender(),this._ready=t,t};pl.prototype._postRender=function(){let e=this._scene.frameState,t=this._dataSourceCollection,n=t.length;for(let i=0;i<n;i++){let o=t.get(i),r=o.credit;c(r)&&e.creditDisplay.addCreditToNextFrame(r);let s=o._resourceCredits;if(c(s)){let a=s.length;for(let l=0;l<a;l++)e.creditDisplay.addCreditToNextFrame(s[l])}}};var vZe=[],DZe=new ce;pl.prototype.getBoundingSphere=function(e,t,n){if(A.defined("entity",e),A.typeOf.bool("allowPartial",t),A.defined("result",n),!this._ready&&!t)return ct.PENDING;let i,o,r=this._defaultDataSource;if(!r.entities.contains(e)){r=void 0;let p=this._dataSourceCollection;for(o=p.length,i=0;i<o;i++){let g=p.get(i);if(g.entities.contains(e)){r=g;break}}}if(!c(r))return ct.FAILED;let s=vZe,a=DZe,l=0,u=ct.DONE,f=r._visualizers,d=f.length;for(i=0;i<d;i++){let p=f[i];if(c(p.getBoundingSphere)){if(u=f[i].getBoundingSphere(e,a),!t&&u===ct.PENDING)return ct.PENDING;u===ct.DONE&&(s[l]=ce.clone(a,s[l]),l++)}}return l===0?ct.FAILED:(s.length=l,ce.fromBoundingSpheres(s,n),ct.DONE)};pl.prototype._onDataSourceAdded=function(e,t){let n=this._scene,i=this._primitives,o=this._groundPrimitives,r=i.add(new mf),s=o.add(new i6);t._primitives=r,t._groundPrimitives=s;let a=t.clustering;a._initialize(n),r.add(a),t._visualizers=this._visualizersCallback(n,a,t)};pl.prototype._onDataSourceRemoved=function(e,t){let n=this._primitives,i=this._groundPrimitives,o=t._primitives,r=t._groundPrimitives,s=t.clustering;o.remove(s);let a=t._visualizers,l=a.length;for(let u=0;u<l;u++)a[u].destroy();n.remove(o),i.remove(r),t._visualizers=void 0};pl.prototype._onDataSourceMoved=function(e,t,n){let i=this._primitives,o=this._groundPrimitives,r=e._primitives,s=e._groundPrimitives;t===n+1?(i.raise(r),o.raise(s)):t===n-1?(i.lower(r),o.lower(s)):t===0?(i.lowerToBottom(r),o.lowerToBottom(s),i.raise(r),o.raise(s)):(i.raiseToTop(r),o.raiseToTop(s))};var K6=pl;function $6(e,t,n){this.heading=y(e,0),this.pitch=y(t,0),this.range=y(n,0)}$6.clone=function(e,t){if(c(e))return c(t)||(t=new $6),t.heading=e.heading,t.pitch=e.pitch,t.range=e.range,t};var zh=$6;var mde=new Q,pde=new Q,_de=new Q,PZe=new k,LR=new h,gde=new h,Z6=new h,J6=new h,yde=new h,bde=new h,zA=new J,IZe=1.25;function OZe(e,t,n,i,o,r,s){let a=e.scene.mode,l=o.getValue(r,e._lastCartesian);if(c(l)){let u=!1,f=!1,d,p,g;if(a===oe.SCENE3D){J.addSeconds(r,.001,zA);let C=o.getValue(zA,LR);if(c(C)||(J.addSeconds(r,-.001,zA),C=o.getValue(zA,LR),f=!0),c(C)){let S=Ft.computeFixedToIcrfMatrix(r,mde),v=Ft.computeFixedToIcrfMatrix(zA,pde),D;!c(S)||!c(v)?(D=Ft.computeTemeToPseudoFixedMatrix(r,_de),S=Q.transpose(D,mde),v=Ft.computeTemeToPseudoFixedMatrix(zA,pde),Q.transpose(v,v)):D=Q.transpose(S,_de);let I=Q.multiplyByVector(S,l,yde),L=Q.multiplyByVector(v,C,bde);h.subtract(I,L,J6);let M=h.magnitude(J6)*1e3,N=R.GRAVITATIONALPARAMETER,B=-N/(M*M-2*N/h.magnitude(I));B<0||B>IZe*s.maximumRadius?(d=gde,h.normalize(l,d),h.negate(d,d),g=h.clone(h.UNIT_Z,Z6),p=h.cross(g,d,LR),h.magnitude(p)>R.EPSILON7&&(h.normalize(d,d),h.normalize(p,p),g=h.cross(d,p,Z6),h.normalize(g,g),u=!0)):h.equalsEpsilon(l,C,R.EPSILON7)||(g=gde,h.normalize(I,g),h.normalize(L,L),p=h.cross(g,L,Z6),f&&(p=h.multiplyByScalar(p,-1,p)),h.equalsEpsilon(p,h.ZERO,R.EPSILON7)||(d=h.cross(p,g,LR),Q.multiplyByVector(D,d,d),Q.multiplyByVector(D,p,p),Q.multiplyByVector(D,g,g),h.normalize(d,d),h.normalize(p,p),h.normalize(g,g),u=!0))}}c(e.boundingSphere)&&(l=e.boundingSphere.center);let m,b,x;i&&(m=h.clone(t.position,J6),b=h.clone(t.direction,yde),x=h.clone(t.up,bde));let T=PZe;u?(T[0]=d.x,T[1]=d.y,T[2]=d.z,T[3]=0,T[4]=p.x,T[5]=p.y,T[6]=p.z,T[7]=0,T[8]=g.x,T[9]=g.y,T[10]=g.z,T[11]=0,T[12]=l.x,T[13]=l.y,T[14]=l.z,T[15]=0):Ft.eastNorthUpToFixedFrame(l,s,T),t._setTransform(T),i&&(h.clone(m,t.position),h.clone(b,t.direction),h.clone(x,t.up),h.cross(b,x,t.right))}if(n){let u=a===oe.SCENE2D||h.equals(e._offset3D,h.ZERO)?void 0:e._offset3D;t.lookAtTransform(t.transform,u)}}function Vv(e,t,n){A.defined("entity",e),A.defined("scene",t),this.entity=e,this.scene=t,this.ellipsoid=y(n,ie.default),this.boundingSphere=void 0,this._lastEntity=void 0,this._mode=void 0,this._lastCartesian=new h,this._defaultOffset3D=void 0,this._offset3D=new h}Object.defineProperties(Vv,{defaultOffset3D:{get:function(){return this._defaultOffset3D},set:function(e){this._defaultOffset3D=h.clone(e,new h)}}});Vv.defaultOffset3D=new h(-14e3,3500,3500);var NR=new zh,RZe=new h;Vv.prototype.update=function(e,t){A.defined("time",e);let n=this.scene,i=this.ellipsoid,o=n.mode;if(o===oe.MORPHING)return;let r=this.entity,s=r.position;if(!c(s))return;let a=r!==this._lastEntity,l=o!==this._mode,u=n.camera,f=a||l,d=!0;if(a){let p=r.viewFrom,g=c(p);if(!g&&c(t)){NR.pitch=-R.PI_OVER_FOUR,NR.range=0;let m=s.getValue(e,RZe);if(c(m)){let b=2-1/Math.max(1,h.magnitude(m)/i.maximumRadius);NR.pitch*=b}u.viewBoundingSphere(t,NR),this.boundingSphere=t,f=!1,d=!1}else(!g||!c(p.getValue(e,this._offset3D)))&&h.clone(Vv._defaultOffset3D,this._offset3D)}else!l&&this._mode!==oe.SCENE2D&&h.clone(u.position,this._offset3D);this._lastEntity=r,this._mode=o,OZe(this,u,f,d,s,e,i)};var Q6=Vv;function HR(e){return GR(e.map(([t,n])=>new Array(t).fill(n,0,t)))}function GR(e){return e.reduce((t,n)=>t.concat(Array.isArray(n)?GR(n):n),[])}var xde=[0,1,2,3].concat(...HR([[2,4],[2,5],[4,6],[4,7],[8,8],[8,9],[16,10],[16,11],[32,12],[32,13],[64,14],[64,15],[2,0],[1,16],[1,17],[2,18],[2,19],[4,20],[4,21],[8,22],[8,23],[16,24],[16,25],[32,26],[32,27],[64,28],[64,29]]));function ar(){let e=this;function t(o){let r=e.dyn_tree,s=e.stat_desc.static_tree,a=e.stat_desc.extra_bits,l=e.stat_desc.extra_base,u=e.stat_desc.max_length,f,d,p,g,m,b,x=0;for(g=0;g<=15;g++)o.bl_count[g]=0;for(r[o.heap[o.heap_max]*2+1]=0,f=o.heap_max+1;f<573;f++)d=o.heap[f],g=r[r[d*2+1]*2+1]+1,g>u&&(g=u,x++),r[d*2+1]=g,!(d>e.max_code)&&(o.bl_count[g]++,m=0,d>=l&&(m=a[d-l]),b=r[d*2],o.opt_len+=b*(g+m),s&&(o.static_len+=b*(s[d*2+1]+m)));if(x!==0){do{for(g=u-1;o.bl_count[g]===0;)g--;o.bl_count[g]--,o.bl_count[g+1]+=2,o.bl_count[u]--,x-=2}while(x>0);for(g=u;g!==0;g--)for(d=o.bl_count[g];d!==0;)p=o.heap[--f],!(p>e.max_code)&&(r[p*2+1]!=g&&(o.opt_len+=(g-r[p*2+1])*r[p*2],r[p*2+1]=g),d--)}}function n(o,r){let s=0;do s|=o&1,o>>>=1,s<<=1;while(--r>0);return s>>>1}function i(o,r,s){let a=[],l=0,u,f,d;for(u=1;u<=15;u++)a[u]=l=l+s[u-1]<<1;for(f=0;f<=r;f++)d=o[f*2+1],d!==0&&(o[f*2]=n(a[d]++,d))}e.build_tree=function(o){let r=e.dyn_tree,s=e.stat_desc.static_tree,a=e.stat_desc.elems,l,u,f=-1,d;for(o.heap_len=0,o.heap_max=573,l=0;l<a;l++)r[l*2]!==0?(o.heap[++o.heap_len]=f=l,o.depth[l]=0):r[l*2+1]=0;for(;o.heap_len<2;)d=o.heap[++o.heap_len]=f<2?++f:0,r[d*2]=1,o.depth[d]=0,o.opt_len--,s&&(o.static_len-=s[d*2+1]);for(e.max_code=f,l=Math.floor(o.heap_len/2);l>=1;l--)o.pqdownheap(r,l);d=a;do l=o.heap[1],o.heap[1]=o.heap[o.heap_len--],o.pqdownheap(r,1),u=o.heap[1],o.heap[--o.heap_max]=l,o.heap[--o.heap_max]=u,r[d*2]=r[l*2]+r[u*2],o.depth[d]=Math.max(o.depth[l],o.depth[u])+1,r[l*2+1]=r[u*2+1]=d,o.heap[1]=d++,o.pqdownheap(r,1);while(o.heap_len>=2);o.heap[--o.heap_max]=o.heap[1],t(o),i(r,e.max_code,o.bl_count)}}ar._length_code=[0,1,2,3,4,5,6,7].concat(...HR([[2,8],[2,9],[2,10],[2,11],[4,12],[4,13],[4,14],[4,15],[8,16],[8,17],[8,18],[8,19],[16,20],[16,21],[16,22],[16,23],[32,24],[32,25],[32,26],[31,27],[1,28]]));ar.base_length=[0,1,2,3,4,5,6,7,8,10,12,14,16,20,24,28,32,40,48,56,64,80,96,112,128,160,192,224,0];ar.base_dist=[0,1,2,3,4,6,8,12,16,24,32,48,64,96,128,192,256,384,512,768,1024,1536,2048,3072,4096,6144,8192,12288,16384,24576];ar.d_code=function(e){return e<256?xde[e]:xde[256+(e>>>7)]};ar.extra_lbits=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0];ar.extra_dbits=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];ar.extra_blbits=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7];ar.bl_order=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];function ya(e,t,n,i,o){let r=this;r.static_tree=e,r.extra_bits=t,r.extra_base=n,r.elems=i,r.max_length=o}var MZe=[12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254,1,129,65,193,33,161,97,225,17,145,81,209,49,177,113,241,9,137,73,201,41,169,105,233,25,153,89,217,57,185,121,249,5,133,69,197,37,165,101,229,21,149,85,213,53,181,117,245,13,141,77,205,45,173,109,237,29,157,93,221,61,189,125,253,19,275,147,403,83,339,211,467,51,307,179,435,115,371,243,499,11,267,139,395,75,331,203,459,43,299,171,427,107,363,235,491,27,283,155,411,91,347,219,475,59,315,187,443,123,379,251,507,7,263,135,391,71,327,199,455,39,295,167,423,103,359,231,487,23,279,151,407,87,343,215,471,55,311,183,439,119,375,247,503,15,271,143,399,79,335,207,463,47,303,175,431,111,367,239,495,31,287,159,415,95,351,223,479,63,319,191,447,127,383,255,511,0,64,32,96,16,80,48,112,8,72,40,104,24,88,56,120,4,68,36,100,20,84,52,116,3,131,67,195,35,163,99,227],LZe=HR([[144,8],[112,9],[24,7],[8,8]]);ya.static_ltree=GR(MZe.map((e,t)=>[e,LZe[t]]));var NZe=[0,16,8,24,4,20,12,28,2,18,10,26,6,22,14,30,1,17,9,25,5,21,13,29,3,19,11,27,7,23],FZe=HR([[30,5]]);ya.static_dtree=GR(NZe.map((e,t)=>[e,FZe[t]]));ya.static_l_desc=new ya(ya.static_ltree,ar.extra_lbits,257,286,15);ya.static_d_desc=new ya(ya.static_dtree,ar.extra_dbits,0,30,15);ya.static_bl_desc=new ya(null,ar.extra_blbits,0,19,7);var BZe=9,kZe=8;function Hh(e,t,n,i,o){let r=this;r.good_length=e,r.max_lazy=t,r.nice_length=n,r.max_chain=i,r.func=o}var Ade=0,UR=1,bb=2,Dd=[new Hh(0,0,0,0,Ade),new Hh(4,4,8,4,UR),new Hh(4,5,16,8,UR),new Hh(4,6,32,32,UR),new Hh(4,4,16,16,bb),new Hh(8,16,32,32,bb),new Hh(8,16,128,128,bb),new Hh(8,32,128,256,bb),new Hh(32,128,258,1024,bb),new Hh(32,258,258,4096,bb)],FR=["need dictionary","stream end","","","stream error","data error","","buffer error","",""],yf=0,BR=1,Uv=2,kR=3,VZe=32,ej=42,VR=113,zv=666,tj=8,UZe=0,nj=1,zZe=2,xr=3,zR=258,Ql=zR+xr+1;function Tde(e,t,n,i){let o=e[t*2],r=e[n*2];return o<r||o==r&&i[t]<=i[n]}function HZe(){let e=this,t,n,i,o,r,s,a,l,u,f,d,p,g,m,b,x,T,C,S,v,D,I,L,M,N,B,_,w,P,O,F,V,G,z=new ar,W=new ar,U=new ar;e.depth=[];let q,K,te,Y,Z,ee;e.bl_count=[],e.heap=[],F=[],V=[],G=[];function me(){u=2*r,d[g-1]=0;for(let Le=0;Le<g-1;Le++)d[Le]=0;B=Dd[_].max_lazy,P=Dd[_].good_length,O=Dd[_].nice_length,N=Dd[_].max_chain,D=0,T=0,L=0,C=M=xr-1,v=0,p=0}function be(){let Le;for(Le=0;Le<286;Le++)F[Le*2]=0;for(Le=0;Le<30;Le++)V[Le*2]=0;for(Le=0;Le<19;Le++)G[Le*2]=0;F[256*2]=1,e.opt_len=e.static_len=0,K=te=0}function le(){z.dyn_tree=F,z.stat_desc=ya.static_l_desc,W.dyn_tree=V,W.stat_desc=ya.static_d_desc,U.dyn_tree=G,U.stat_desc=ya.static_bl_desc,Z=0,ee=0,Y=8,be()}e.pqdownheap=function(Le,st){let Xe=e.heap,Ze=Xe[st],ht=st<<1;for(;ht<=e.heap_len&&(ht<e.heap_len&&Tde(Le,Xe[ht+1],Xe[ht],e.depth)&&ht++,!Tde(Le,Ze,Xe[ht],e.depth));)Xe[st]=Xe[ht],st=ht,ht<<=1;Xe[st]=Ze};function ge(Le,st){let Xe=-1,Ze,ht=Le[0*2+1],jt=0,gn=7,To=4;ht===0&&(gn=138,To=3),Le[(st+1)*2+1]=65535;for(let _o=0;_o<=st;_o++)Ze=ht,ht=Le[(_o+1)*2+1],!(++jt<gn&&Ze==ht)&&(jt<To?G[Ze*2]+=jt:Ze!==0?(Ze!=Xe&&G[Ze*2]++,G[16*2]++):jt<=10?G[17*2]++:G[18*2]++,jt=0,Xe=Ze,ht===0?(gn=138,To=3):Ze==ht?(gn=6,To=3):(gn=7,To=4))}function xe(){let Le;for(ge(F,z.max_code),ge(V,W.max_code),U.build_tree(e),Le=18;Le>=3&&G[ar.bl_order[Le]*2+1]===0;Le--);return e.opt_len+=3*(Le+1)+5+5+4,Le}function Pe(Le){e.pending_buf[e.pending++]=Le}function Ee(Le){Pe(Le&255),Pe(Le>>>8&255)}function Ue(Le){Pe(Le>>8&255),Pe(Le&255&255)}function Ye(Le,st){let Xe,Ze=st;ee>16-Ze?(Xe=Le,Z|=Xe<<ee&65535,Ee(Z),Z=Xe>>>16-ee,ee+=Ze-16):(Z|=Le<<ee&65535,ee+=Ze)}function it(Le,st){let Xe=Le*2;Ye(st[Xe]&65535,st[Xe+1]&65535)}function It(Le,st){let Xe,Ze=-1,ht,jt=Le[0*2+1],gn=0,To=7,_o=4;for(jt===0&&(To=138,_o=3),Xe=0;Xe<=st;Xe++)if(ht=jt,jt=Le[(Xe+1)*2+1],!(++gn<To&&ht==jt)){if(gn<_o)do it(ht,G);while(--gn!==0);else ht!==0?(ht!=Ze&&(it(ht,G),gn--),it(16,G),Ye(gn-3,2)):gn<=10?(it(17,G),Ye(gn-3,3)):(it(18,G),Ye(gn-11,7));gn=0,Ze=ht,jt===0?(To=138,_o=3):ht==jt?(To=6,_o=3):(To=7,_o=4)}}function Ot(Le,st,Xe){let Ze;for(Ye(Le-257,5),Ye(st-1,5),Ye(Xe-4,4),Ze=0;Ze<Xe;Ze++)Ye(G[ar.bl_order[Ze]*2+1],3);It(F,Le-1),It(V,st-1)}function He(){ee==16?(Ee(Z),Z=0,ee=0):ee>=8&&(Pe(Z&255),Z>>>=8,ee-=8)}function tn(){Ye(nj<<1,3),it(256,ya.static_ltree),He(),1+Y+10-ee<9&&(Ye(nj<<1,3),it(256,ya.static_ltree),He()),Y=7}function dt(Le,st){let Xe,Ze,ht;if(e.dist_buf[K]=Le,e.lc_buf[K]=st&255,K++,Le===0?F[st*2]++:(te++,Le--,F[(ar._length_code[st]+256+1)*2]++,V[ar.d_code(Le)*2]++),!(K&8191)&&_>2){for(Xe=K*8,Ze=D-T,ht=0;ht<30;ht++)Xe+=V[ht*2]*(5+ar.extra_dbits[ht]);if(Xe>>>=3,te<Math.floor(K/2)&&Xe<Math.floor(Ze/2))return!0}return K==q-1}function bt(Le,st){let Xe,Ze,ht=0,jt,gn;if(K!==0)do Xe=e.dist_buf[ht],Ze=e.lc_buf[ht],ht++,Xe===0?it(Ze,Le):(jt=ar._length_code[Ze],it(jt+256+1,Le),gn=ar.extra_lbits[jt],gn!==0&&(Ze-=ar.base_length[jt],Ye(Ze,gn)),Xe--,jt=ar.d_code(Xe),it(jt,st),gn=ar.extra_dbits[jt],gn!==0&&(Xe-=ar.base_dist[jt],Ye(Xe,gn)));while(ht<K);it(256,Le),Y=Le[256*2+1]}function nn(){ee>8?Ee(Z):ee>0&&Pe(Z&255),Z=0,ee=0}function Ae(Le,st,Xe){nn(),Y=8,Xe&&(Ee(st),Ee(~st)),e.pending_buf.set(l.subarray(Le,Le+st),e.pending),e.pending+=st}function Ce(Le,st,Xe){Ye((UZe<<1)+(Xe?1:0),3),Ae(Le,st,!0)}function rt(Le,st,Xe){let Ze,ht,jt=0;_>0?(z.build_tree(e),W.build_tree(e),jt=xe(),Ze=e.opt_len+3+7>>>3,ht=e.static_len+3+7>>>3,ht<=Ze&&(Ze=ht)):Ze=ht=st+5,st+4<=Ze&&Le!=-1?Ce(Le,st,Xe):ht==Ze?(Ye((nj<<1)+(Xe?1:0),3),bt(ya.static_ltree,ya.static_dtree)):(Ye((zZe<<1)+(Xe?1:0),3),Ot(z.max_code+1,W.max_code+1,jt+1),bt(F,V)),be(),Xe&&nn()}function Ri(Le){rt(T>=0?T:-1,D-T,Le),T=D,t.flush_pending()}function lt(){let Le,st,Xe,Ze;do{if(Ze=u-L-D,Ze===0&&D===0&&L===0)Ze=r;else if(Ze==-1)Ze--;else if(D>=r+r-Ql){l.set(l.subarray(r,r+r),0),I-=r,D-=r,T-=r,Le=g,Xe=Le;do st=d[--Xe]&65535,d[Xe]=st>=r?st-r:0;while(--Le!==0);Le=r,Xe=Le;do st=f[--Xe]&65535,f[Xe]=st>=r?st-r:0;while(--Le!==0);Ze+=r}if(t.avail_in===0)return;Le=t.read_buf(l,D+L,Ze),L+=Le,L>=xr&&(p=l[D]&255,p=(p<<x^l[D+1]&255)&b)}while(L<Ql&&t.avail_in!==0)}function ao(Le){let st=65535,Xe;for(st>i-5&&(st=i-5);;){if(L<=1){if(lt(),L===0&&Le==0)return yf;if(L===0)break}if(D+=L,L=0,Xe=T+st,(D===0||D>=Xe)&&(L=D-Xe,D=Xe,Ri(!1),t.avail_out===0)||D-T>=r-Ql&&(Ri(!1),t.avail_out===0))return yf}return Ri(Le==4),t.avail_out===0?Le==4?Uv:yf:Le==4?kR:BR}function Fo(Le){let st=N,Xe=D,Ze,ht,jt=M,gn=D>r-Ql?D-(r-Ql):0,To=O,_o=a,Da=D+zR,Pa=l[Xe+jt-1],pi=l[Xe+jt];M>=P&&(st>>=2),To>L&&(To=L);do if(Ze=Le,!(l[Ze+jt]!=pi||l[Ze+jt-1]!=Pa||l[Ze]!=l[Xe]||l[++Ze]!=l[Xe+1])){Xe+=2,Ze++;do;while(l[++Xe]==l[++Ze]&&l[++Xe]==l[++Ze]&&l[++Xe]==l[++Ze]&&l[++Xe]==l[++Ze]&&l[++Xe]==l[++Ze]&&l[++Xe]==l[++Ze]&&l[++Xe]==l[++Ze]&&l[++Xe]==l[++Ze]&&Xe<Da);if(ht=zR-(Da-Xe),Xe=Da-zR,ht>jt){if(I=Le,jt=ht,ht>=To)break;Pa=l[Xe+jt-1],pi=l[Xe+jt]}}while((Le=f[Le&_o]&65535)>gn&&--st!==0);return jt<=L?jt:L}function va(Le){let st=0,Xe;for(;;){if(L<Ql){if(lt(),L<Ql&&Le==0)return yf;if(L===0)break}if(L>=xr&&(p=(p<<x^l[D+(xr-1)]&255)&b,st=d[p]&65535,f[D&a]=d[p],d[p]=D),st!==0&&(D-st&65535)<=r-Ql&&w!=2&&(C=Fo(st)),C>=xr)if(Xe=dt(D-I,C-xr),L-=C,C<=B&&L>=xr){C--;do D++,p=(p<<x^l[D+(xr-1)]&255)&b,st=d[p]&65535,f[D&a]=d[p],d[p]=D;while(--C!==0);D++}else D+=C,C=0,p=l[D]&255,p=(p<<x^l[D+1]&255)&b;else Xe=dt(0,l[D]&255),L--,D++;if(Xe&&(Ri(!1),t.avail_out===0))return yf}return Ri(Le==4),t.avail_out===0?Le==4?Uv:yf:Le==4?kR:BR}function Cr(Le){let st=0,Xe,Ze;for(;;){if(L<Ql){if(lt(),L<Ql&&Le==0)return yf;if(L===0)break}if(L>=xr&&(p=(p<<x^l[D+(xr-1)]&255)&b,st=d[p]&65535,f[D&a]=d[p],d[p]=D),M=C,S=I,C=xr-1,st!==0&&M<B&&(D-st&65535)<=r-Ql&&(w!=2&&(C=Fo(st)),C<=5&&(w==1||C==xr&&D-I>4096)&&(C=xr-1)),M>=xr&&C<=M){Ze=D+L-xr,Xe=dt(D-1-S,M-xr),L-=M-1,M-=2;do++D<=Ze&&(p=(p<<x^l[D+(xr-1)]&255)&b,st=d[p]&65535,f[D&a]=d[p],d[p]=D);while(--M!==0);if(v=0,C=xr-1,D++,Xe&&(Ri(!1),t.avail_out===0))return yf}else if(v!==0){if(Xe=dt(0,l[D-1]&255),Xe&&Ri(!1),D++,L--,t.avail_out===0)return yf}else v=1,D++,L--}return v!==0&&(Xe=dt(0,l[D-1]&255),v=0),Ri(Le==4),t.avail_out===0?Le==4?Uv:yf:Le==4?kR:BR}function ss(Le){return Le.total_in=Le.total_out=0,Le.msg=null,e.pending=0,e.pending_out=0,n=VR,o=0,le(),me(),0}e.deflateInit=function(Le,st,Xe,Ze,ht,jt){return Ze||(Ze=tj),ht||(ht=kZe),jt||(jt=0),Le.msg=null,st==-1&&(st=6),ht<1||ht>BZe||Ze!=tj||Xe<9||Xe>15||st<0||st>9||jt<0||jt>2?-2:(Le.dstate=e,s=Xe,r=1<<s,a=r-1,m=ht+7,g=1<<m,b=g-1,x=Math.floor((m+xr-1)/xr),l=new Uint8Array(r*2),f=[],d=[],q=1<<ht+6,e.pending_buf=new Uint8Array(q*4),i=q*4,e.dist_buf=new Uint16Array(q),e.lc_buf=new Uint8Array(q),_=st,w=jt,ss(Le))},e.deflateEnd=function(){return n!=ej&&n!=VR&&n!=zv?-2:(e.lc_buf=null,e.dist_buf=null,e.pending_buf=null,d=null,f=null,l=null,e.dstate=null,n==VR?-3:0)},e.deflateParams=function(Le,st,Xe){let Ze=0;return st==-1&&(st=6),st<0||st>9||Xe<0||Xe>2?-2:(Dd[_].func!=Dd[st].func&&Le.total_in!==0&&(Ze=Le.deflate(1)),_!=st&&(_=st,B=Dd[_].max_lazy,P=Dd[_].good_length,O=Dd[_].nice_length,N=Dd[_].max_chain),w=Xe,Ze)},e.deflateSetDictionary=function(Le,st,Xe){let Ze=Xe,ht,jt=0;if(!st||n!=ej)return-2;if(Ze<xr)return 0;for(Ze>r-Ql&&(Ze=r-Ql,jt=Xe-Ze),l.set(st.subarray(jt,jt+Ze),0),D=Ze,T=Ze,p=l[0]&255,p=(p<<x^l[1]&255)&b,ht=0;ht<=Ze-xr;ht++)p=(p<<x^l[ht+(xr-1)]&255)&b,f[ht&a]=d[p],d[p]=ht;return 0},e.deflate=function(Le,st){let Xe,Ze,ht,jt,gn;if(st>4||st<0)return-2;if(!Le.next_out||!Le.next_in&&Le.avail_in!==0||n==zv&&st!=4)return Le.msg=FR[4],-2;if(Le.avail_out===0)return Le.msg=FR[7],-5;if(t=Le,jt=o,o=st,n==ej&&(Ze=tj+(s-8<<4)<<8,ht=(_-1&255)>>1,ht>3&&(ht=3),Ze|=ht<<6,D!==0&&(Ze|=VZe),Ze+=31-Ze%31,n=VR,Ue(Ze)),e.pending!==0){if(t.flush_pending(),t.avail_out===0)return o=-1,0}else if(t.avail_in===0&&st<=jt&&st!=4)return t.msg=FR[7],-5;if(n==zv&&t.avail_in!==0)return Le.msg=FR[7],-5;if(t.avail_in!==0||L!==0||st!=0&&n!=zv){switch(gn=-1,Dd[_].func){case Ade:gn=ao(st);break;case UR:gn=va(st);break;case bb:gn=Cr(st);break;default:}if((gn==Uv||gn==kR)&&(n=zv),gn==yf||gn==Uv)return t.avail_out===0&&(o=-1),0;if(gn==BR){if(st==1)tn();else if(Ce(0,0,!1),st==3)for(Xe=0;Xe<g;Xe++)d[Xe]=0;if(t.flush_pending(),t.avail_out===0)return o=-1,0}}return st!=4?0:1}}function Cde(){let e=this;e.next_in_index=0,e.next_out_index=0,e.avail_in=0,e.total_in=0,e.avail_out=0,e.total_out=0}Cde.prototype={deflateInit(e,t){let n=this;return n.dstate=new HZe,t||(t=15),n.dstate.deflateInit(n,e,t)},deflate(e){let t=this;return t.dstate?t.dstate.deflate(t,e):-2},deflateEnd(){let e=this;if(!e.dstate)return-2;let t=e.dstate.deflateEnd();return e.dstate=null,t},deflateParams(e,t){let n=this;return n.dstate?n.dstate.deflateParams(n,e,t):-2},deflateSetDictionary(e,t){let n=this;return n.dstate?n.dstate.deflateSetDictionary(n,e,t):-2},read_buf(e,t,n){let i=this,o=i.avail_in;return o>n&&(o=n),o===0?0:(i.avail_in-=o,e.set(i.next_in.subarray(i.next_in_index,i.next_in_index+o),t),i.next_in_index+=o,i.total_in+=o,o)},flush_pending(){let e=this,t=e.dstate.pending;t>e.avail_out&&(t=e.avail_out),t!==0&&(e.next_out.set(e.dstate.pending_buf.subarray(e.dstate.pending_out,e.dstate.pending_out+t),e.next_out_index),e.next_out_index+=t,e.dstate.pending_out+=t,e.total_out+=t,e.avail_out-=t,e.dstate.pending-=t,e.dstate.pending===0&&(e.dstate.pending_out=0))}};function Ede(e){let t=this,n=new Cde,i=GZe(e&&e.chunkSize?e.chunkSize:64*1024),o=0,r=new Uint8Array(i),s=e?e.level:-1;typeof s>"u"&&(s=-1),n.deflateInit(s),n.next_out=r,t.append=function(a,l){let u,f,d=0,p=0,g=0,m=[];if(a.length){n.next_in_index=0,n.next_in=a,n.avail_in=a.length;do{if(n.next_out_index=0,n.avail_out=i,u=n.deflate(o),u!=0)throw new Error("deflating: "+n.msg);n.next_out_index&&(n.next_out_index==i?m.push(new Uint8Array(r)):m.push(r.subarray(0,n.next_out_index))),g+=n.next_out_index,l&&n.next_in_index>0&&n.next_in_index!=d&&(l(n.next_in_index),d=n.next_in_index)}while(n.avail_in>0||n.avail_out===0);return m.length>1?(f=new Uint8Array(g),m.forEach(function(b){f.set(b,p),p+=b.length})):f=m[0]?new Uint8Array(m[0]):new Uint8Array,f}},t.flush=function(){let a,l,u=0,f=0,d=[];do{if(n.next_out_index=0,n.avail_out=i,a=n.deflate(4),a!=1&&a!=0)throw new Error("deflating: "+n.msg);i-n.avail_out>0&&d.push(r.slice(0,n.next_out_index)),f+=n.next_out_index}while(n.avail_in>0||n.avail_out===0);return n.deflateEnd(),l=new Uint8Array(f),d.forEach(function(p){l.set(p,u),u+=p.length}),l}}function GZe(e){return e+5*(Math.floor(e/16383)+1)}var eu=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],jde=1440,jZe=0,WZe=4,qZe=9,YZe=5,XZe=[96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,192,80,7,10,0,8,96,0,8,32,0,9,160,0,8,0,0,8,128,0,8,64,0,9,224,80,7,6,0,8,88,0,8,24,0,9,144,83,7,59,0,8,120,0,8,56,0,9,208,81,7,17,0,8,104,0,8,40,0,9,176,0,8,8,0,8,136,0,8,72,0,9,240,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,200,81,7,13,0,8,100,0,8,36,0,9,168,0,8,4,0,8,132,0,8,68,0,9,232,80,7,8,0,8,92,0,8,28,0,9,152,84,7,83,0,8,124,0,8,60,0,9,216,82,7,23,0,8,108,0,8,44,0,9,184,0,8,12,0,8,140,0,8,76,0,9,248,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,196,81,7,11,0,8,98,0,8,34,0,9,164,0,8,2,0,8,130,0,8,66,0,9,228,80,7,7,0,8,90,0,8,26,0,9,148,84,7,67,0,8,122,0,8,58,0,9,212,82,7,19,0,8,106,0,8,42,0,9,180,0,8,10,0,8,138,0,8,74,0,9,244,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,204,81,7,15,0,8,102,0,8,38,0,9,172,0,8,6,0,8,134,0,8,70,0,9,236,80,7,9,0,8,94,0,8,30,0,9,156,84,7,99,0,8,126,0,8,62,0,9,220,82,7,27,0,8,110,0,8,46,0,9,188,0,8,14,0,8,142,0,8,78,0,9,252,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,194,80,7,10,0,8,97,0,8,33,0,9,162,0,8,1,0,8,129,0,8,65,0,9,226,80,7,6,0,8,89,0,8,25,0,9,146,83,7,59,0,8,121,0,8,57,0,9,210,81,7,17,0,8,105,0,8,41,0,9,178,0,8,9,0,8,137,0,8,73,0,9,242,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,202,81,7,13,0,8,101,0,8,37,0,9,170,0,8,5,0,8,133,0,8,69,0,9,234,80,7,8,0,8,93,0,8,29,0,9,154,84,7,83,0,8,125,0,8,61,0,9,218,82,7,23,0,8,109,0,8,45,0,9,186,0,8,13,0,8,141,0,8,77,0,9,250,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,198,81,7,11,0,8,99,0,8,35,0,9,166,0,8,3,0,8,131,0,8,67,0,9,230,80,7,7,0,8,91,0,8,27,0,9,150,84,7,67,0,8,123,0,8,59,0,9,214,82,7,19,0,8,107,0,8,43,0,9,182,0,8,11,0,8,139,0,8,75,0,9,246,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,206,81,7,15,0,8,103,0,8,39,0,9,174,0,8,7,0,8,135,0,8,71,0,9,238,80,7,9,0,8,95,0,8,31,0,9,158,84,7,99,0,8,127,0,8,63,0,9,222,82,7,27,0,8,111,0,8,47,0,9,190,0,8,15,0,8,143,0,8,79,0,9,254,96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,193,80,7,10,0,8,96,0,8,32,0,9,161,0,8,0,0,8,128,0,8,64,0,9,225,80,7,6,0,8,88,0,8,24,0,9,145,83,7,59,0,8,120,0,8,56,0,9,209,81,7,17,0,8,104,0,8,40,0,9,177,0,8,8,0,8,136,0,8,72,0,9,241,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,201,81,7,13,0,8,100,0,8,36,0,9,169,0,8,4,0,8,132,0,8,68,0,9,233,80,7,8,0,8,92,0,8,28,0,9,153,84,7,83,0,8,124,0,8,60,0,9,217,82,7,23,0,8,108,0,8,44,0,9,185,0,8,12,0,8,140,0,8,76,0,9,249,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,197,81,7,11,0,8,98,0,8,34,0,9,165,0,8,2,0,8,130,0,8,66,0,9,229,80,7,7,0,8,90,0,8,26,0,9,149,84,7,67,0,8,122,0,8,58,0,9,213,82,7,19,0,8,106,0,8,42,0,9,181,0,8,10,0,8,138,0,8,74,0,9,245,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,205,81,7,15,0,8,102,0,8,38,0,9,173,0,8,6,0,8,134,0,8,70,0,9,237,80,7,9,0,8,94,0,8,30,0,9,157,84,7,99,0,8,126,0,8,62,0,9,221,82,7,27,0,8,110,0,8,46,0,9,189,0,8,14,0,8,142,0,8,78,0,9,253,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,195,80,7,10,0,8,97,0,8,33,0,9,163,0,8,1,0,8,129,0,8,65,0,9,227,80,7,6,0,8,89,0,8,25,0,9,147,83,7,59,0,8,121,0,8,57,0,9,211,81,7,17,0,8,105,0,8,41,0,9,179,0,8,9,0,8,137,0,8,73,0,9,243,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,203,81,7,13,0,8,101,0,8,37,0,9,171,0,8,5,0,8,133,0,8,69,0,9,235,80,7,8,0,8,93,0,8,29,0,9,155,84,7,83,0,8,125,0,8,61,0,9,219,82,7,23,0,8,109,0,8,45,0,9,187,0,8,13,0,8,141,0,8,77,0,9,251,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,199,81,7,11,0,8,99,0,8,35,0,9,167,0,8,3,0,8,131,0,8,67,0,9,231,80,7,7,0,8,91,0,8,27,0,9,151,84,7,67,0,8,123,0,8,59,0,9,215,82,7,19,0,8,107,0,8,43,0,9,183,0,8,11,0,8,139,0,8,75,0,9,247,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,207,81,7,15,0,8,103,0,8,39,0,9,175,0,8,7,0,8,135,0,8,71,0,9,239,80,7,9,0,8,95,0,8,31,0,9,159,84,7,99,0,8,127,0,8,63,0,9,223,82,7,27,0,8,111,0,8,47,0,9,191,0,8,15,0,8,143,0,8,79,0,9,255],KZe=[80,5,1,87,5,257,83,5,17,91,5,4097,81,5,5,89,5,1025,85,5,65,93,5,16385,80,5,3,88,5,513,84,5,33,92,5,8193,82,5,9,90,5,2049,86,5,129,192,5,24577,80,5,2,87,5,385,83,5,25,91,5,6145,81,5,7,89,5,1537,85,5,97,93,5,24577,80,5,4,88,5,769,84,5,49,92,5,12289,82,5,13,90,5,3073,86,5,193,192,5,24577],$Ze=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],ZZe=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,112,112],JZe=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],QZe=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],Rg=15;function sj(){let e=this,t,n,i,o,r,s;function a(u,f,d,p,g,m,b,x,T,C,S){let v,D,I,L,M,N,B,_,w,P,O,F,V,G,z;P=0,M=d;do i[u[f+P]]++,P++,M--;while(M!==0);if(i[0]==d)return b[0]=-1,x[0]=0,0;for(_=x[0],N=1;N<=Rg&&i[N]===0;N++);for(B=N,_<N&&(_=N),M=Rg;M!==0&&i[M]===0;M--);for(I=M,_>M&&(_=M),x[0]=_,G=1<<N;N<M;N++,G<<=1)if((G-=i[N])<0)return-3;if((G-=i[M])<0)return-3;for(i[M]+=G,s[1]=N=0,P=1,V=2;--M!==0;)s[V]=N+=i[P],V++,P++;M=0,P=0;do(N=u[f+P])!==0&&(S[s[N]++]=M),P++;while(++M<d);for(d=s[I],s[0]=M=0,P=0,L=-1,F=-_,r[0]=0,O=0,z=0;B<=I;B++)for(v=i[B];v--!==0;){for(;B>F+_;){if(L++,F+=_,z=I-F,z=z>_?_:z,(D=1<<(N=B-F))>v+1&&(D-=v+1,V=B,N<z))for(;++N<z&&!((D<<=1)<=i[++V]);)D-=i[V];if(z=1<<N,C[0]+z>jde)return-3;r[L]=O=C[0],C[0]+=z,L!==0?(s[L]=M,o[0]=N,o[1]=_,N=M>>>F-_,o[2]=O-r[L-1]-N,T.set(o,(r[L-1]+N)*3)):b[0]=O}for(o[1]=B-F,P>=d?o[0]=192:S[P]<p?(o[0]=S[P]<256?0:96,o[2]=S[P++]):(o[0]=m[S[P]-p]+16+64,o[2]=g[S[P++]-p]),D=1<<B-F,N=M>>>F;N<z;N+=D)T.set(o,(O+N)*3);for(N=1<<B-1;M&N;N>>>=1)M^=N;for(M^=N,w=(1<<F)-1;(M&w)!=s[L];)L--,F-=_,w=(1<<F)-1}return G!==0&&I!=1?-5:0}function l(u){let f;for(t||(t=[],n=[],i=new Int32Array(Rg+1),o=[],r=new Int32Array(Rg),s=new Int32Array(Rg+1)),n.length<u&&(n=[]),f=0;f<u;f++)n[f]=0;for(f=0;f<Rg+1;f++)i[f]=0;for(f=0;f<3;f++)o[f]=0;r.set(i.subarray(0,Rg),0),s.set(i.subarray(0,Rg+1),0)}e.inflate_trees_bits=function(u,f,d,p,g){let m;return l(19),t[0]=0,m=a(u,0,19,19,null,null,d,f,p,t,n),m==-3?g.msg="oversubscribed dynamic bit lengths tree":(m==-5||f[0]===0)&&(g.msg="incomplete dynamic bit lengths tree",m=-3),m},e.inflate_trees_dynamic=function(u,f,d,p,g,m,b,x,T){let C;return l(288),t[0]=0,C=a(d,0,u,257,$Ze,ZZe,m,p,x,t,n),C!=0||p[0]===0?(C==-3?T.msg="oversubscribed literal/length tree":C!=-4&&(T.msg="incomplete literal/length tree",C=-3),C):(l(288),C=a(d,u,f,0,JZe,QZe,b,g,x,t,n),C!=0||g[0]===0&&u>257?(C==-3?T.msg="oversubscribed distance tree":C==-5?(T.msg="incomplete distance tree",C=-3):C!=-4&&(T.msg="empty distance tree with lengths",C=-3),C):0)}}sj.inflate_trees_fixed=function(e,t,n,i){return e[0]=qZe,t[0]=YZe,n[0]=XZe,i[0]=KZe,0};var jR=0,Sde=1,wde=2,vde=3,Dde=4,Pde=5,Ide=6,ij=7,Ode=8,WR=9;function eJe(){let e=this,t,n=0,i,o=0,r=0,s=0,a=0,l=0,u=0,f=0,d,p=0,g,m=0;function b(x,T,C,S,v,D,I,L){let M,N,B,_,w,P,O,F,V,G,z,W,U,q,K,te;O=L.next_in_index,F=L.avail_in,w=I.bitb,P=I.bitk,V=I.write,G=V<I.read?I.read-V-1:I.end-V,z=eu[x],W=eu[T];do{for(;P<20;)F--,w|=(L.read_byte(O++)&255)<<P,P+=8;if(M=w&z,N=C,B=S,te=(B+M)*3,(_=N[te])===0){w>>=N[te+1],P-=N[te+1],I.win[V++]=N[te+2],G--;continue}do{if(w>>=N[te+1],P-=N[te+1],_&16){for(_&=15,U=N[te+2]+(w&eu[_]),w>>=_,P-=_;P<15;)F--,w|=(L.read_byte(O++)&255)<<P,P+=8;M=w&W,N=v,B=D,te=(B+M)*3,_=N[te];do if(w>>=N[te+1],P-=N[te+1],_&16){for(_&=15;P<_;)F--,w|=(L.read_byte(O++)&255)<<P,P+=8;if(q=N[te+2]+(w&eu[_]),w>>=_,P-=_,G-=U,V>=q)K=V-q,V-K>0&&2>V-K?(I.win[V++]=I.win[K++],I.win[V++]=I.win[K++],U-=2):(I.win.set(I.win.subarray(K,K+2),V),V+=2,K+=2,U-=2);else{K=V-q;do K+=I.end;while(K<0);if(_=I.end-K,U>_){if(U-=_,V-K>0&&_>V-K)do I.win[V++]=I.win[K++];while(--_!==0);else I.win.set(I.win.subarray(K,K+_),V),V+=_,K+=_,_=0;K=0}}if(V-K>0&&U>V-K)do I.win[V++]=I.win[K++];while(--U!==0);else I.win.set(I.win.subarray(K,K+U),V),V+=U,K+=U,U=0;break}else if(!(_&64))M+=N[te+2],M+=w&eu[_],te=(B+M)*3,_=N[te];else return L.msg="invalid distance code",U=L.avail_in-F,U=P>>3<U?P>>3:U,F+=U,O-=U,P-=U<<3,I.bitb=w,I.bitk=P,L.avail_in=F,L.total_in+=O-L.next_in_index,L.next_in_index=O,I.write=V,-3;while(!0);break}if(_&64)return _&32?(U=L.avail_in-F,U=P>>3<U?P>>3:U,F+=U,O-=U,P-=U<<3,I.bitb=w,I.bitk=P,L.avail_in=F,L.total_in+=O-L.next_in_index,L.next_in_index=O,I.write=V,1):(L.msg="invalid literal/length code",U=L.avail_in-F,U=P>>3<U?P>>3:U,F+=U,O-=U,P-=U<<3,I.bitb=w,I.bitk=P,L.avail_in=F,L.total_in+=O-L.next_in_index,L.next_in_index=O,I.write=V,-3);if(M+=N[te+2],M+=w&eu[_],te=(B+M)*3,(_=N[te])===0){w>>=N[te+1],P-=N[te+1],I.win[V++]=N[te+2],G--;break}}while(!0)}while(G>=258&&F>=10);return U=L.avail_in-F,U=P>>3<U?P>>3:U,F+=U,O-=U,P-=U<<3,I.bitb=w,I.bitk=P,L.avail_in=F,L.total_in+=O-L.next_in_index,L.next_in_index=O,I.write=V,0}e.init=function(x,T,C,S,v,D){t=jR,u=x,f=T,d=C,p=S,g=v,m=D,i=null},e.proc=function(x,T,C){let S,v,D,I=0,L=0,M=0,N,B,_,w;for(M=T.next_in_index,N=T.avail_in,I=x.bitb,L=x.bitk,B=x.write,_=B<x.read?x.read-B-1:x.end-B;;)switch(t){case jR:if(_>=258&&N>=10&&(x.bitb=I,x.bitk=L,T.avail_in=N,T.total_in+=M-T.next_in_index,T.next_in_index=M,x.write=B,C=b(u,f,d,p,g,m,x,T),M=T.next_in_index,N=T.avail_in,I=x.bitb,L=x.bitk,B=x.write,_=B<x.read?x.read-B-1:x.end-B,C!=0)){t=C==1?ij:WR;break}r=u,i=d,o=p,t=Sde;case Sde:for(S=r;L<S;){if(N!==0)C=0;else return x.bitb=I,x.bitk=L,T.avail_in=N,T.total_in+=M-T.next_in_index,T.next_in_index=M,x.write=B,x.inflate_flush(T,C);N--,I|=(T.read_byte(M++)&255)<<L,L+=8}if(v=(o+(I&eu[S]))*3,I>>>=i[v+1],L-=i[v+1],D=i[v],D===0){s=i[v+2],t=Ide;break}if(D&16){a=D&15,n=i[v+2],t=wde;break}if(!(D&64)){r=D,o=v/3+i[v+2];break}if(D&32){t=ij;break}return t=WR,T.msg="invalid literal/length code",C=-3,x.bitb=I,x.bitk=L,T.avail_in=N,T.total_in+=M-T.next_in_index,T.next_in_index=M,x.write=B,x.inflate_flush(T,C);case wde:for(S=a;L<S;){if(N!==0)C=0;else return x.bitb=I,x.bitk=L,T.avail_in=N,T.total_in+=M-T.next_in_index,T.next_in_index=M,x.write=B,x.inflate_flush(T,C);N--,I|=(T.read_byte(M++)&255)<<L,L+=8}n+=I&eu[S],I>>=S,L-=S,r=f,i=g,o=m,t=vde;case vde:for(S=r;L<S;){if(N!==0)C=0;else return x.bitb=I,x.bitk=L,T.avail_in=N,T.total_in+=M-T.next_in_index,T.next_in_index=M,x.write=B,x.inflate_flush(T,C);N--,I|=(T.read_byte(M++)&255)<<L,L+=8}if(v=(o+(I&eu[S]))*3,I>>=i[v+1],L-=i[v+1],D=i[v],D&16){a=D&15,l=i[v+2],t=Dde;break}if(!(D&64)){r=D,o=v/3+i[v+2];break}return t=WR,T.msg="invalid distance code",C=-3,x.bitb=I,x.bitk=L,T.avail_in=N,T.total_in+=M-T.next_in_index,T.next_in_index=M,x.write=B,x.inflate_flush(T,C);case Dde:for(S=a;L<S;){if(N!==0)C=0;else return x.bitb=I,x.bitk=L,T.avail_in=N,T.total_in+=M-T.next_in_index,T.next_in_index=M,x.write=B,x.inflate_flush(T,C);N--,I|=(T.read_byte(M++)&255)<<L,L+=8}l+=I&eu[S],I>>=S,L-=S,t=Pde;case Pde:for(w=B-l;w<0;)w+=x.end;for(;n!==0;){if(_===0&&(B==x.end&&x.read!==0&&(B=0,_=B<x.read?x.read-B-1:x.end-B),_===0&&(x.write=B,C=x.inflate_flush(T,C),B=x.write,_=B<x.read?x.read-B-1:x.end-B,B==x.end&&x.read!==0&&(B=0,_=B<x.read?x.read-B-1:x.end-B),_===0)))return x.bitb=I,x.bitk=L,T.avail_in=N,T.total_in+=M-T.next_in_index,T.next_in_index=M,x.write=B,x.inflate_flush(T,C);x.win[B++]=x.win[w++],_--,w==x.end&&(w=0),n--}t=jR;break;case Ide:if(_===0&&(B==x.end&&x.read!==0&&(B=0,_=B<x.read?x.read-B-1:x.end-B),_===0&&(x.write=B,C=x.inflate_flush(T,C),B=x.write,_=B<x.read?x.read-B-1:x.end-B,B==x.end&&x.read!==0&&(B=0,_=B<x.read?x.read-B-1:x.end-B),_===0)))return x.bitb=I,x.bitk=L,T.avail_in=N,T.total_in+=M-T.next_in_index,T.next_in_index=M,x.write=B,x.inflate_flush(T,C);C=0,x.win[B++]=s,_--,t=jR;break;case ij:if(L>7&&(L-=8,N++,M--),x.write=B,C=x.inflate_flush(T,C),B=x.write,_=B<x.read?x.read-B-1:x.end-B,x.read!=x.write)return x.bitb=I,x.bitk=L,T.avail_in=N,T.total_in+=M-T.next_in_index,T.next_in_index=M,x.write=B,x.inflate_flush(T,C);t=Ode;case Ode:return C=1,x.bitb=I,x.bitk=L,T.avail_in=N,T.total_in+=M-T.next_in_index,T.next_in_index=M,x.write=B,x.inflate_flush(T,C);case WR:return C=-3,x.bitb=I,x.bitk=L,T.avail_in=N,T.total_in+=M-T.next_in_index,T.next_in_index=M,x.write=B,x.inflate_flush(T,C);default:return C=-2,x.bitb=I,x.bitk=L,T.avail_in=N,T.total_in+=M-T.next_in_index,T.next_in_index=M,x.write=B,x.inflate_flush(T,C)}},e.free=function(){}}var Rde=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],HA=0,oj=1,Mde=2,Lde=3,Nde=4,Fde=5,qR=6,YR=7,Bde=8,xb=9;function tJe(e,t){let n=this,i=HA,o=0,r=0,s=0,a,l=[0],u=[0],f=new eJe,d=0,p=new Int32Array(jde*3),g=0,m=new sj;n.bitk=0,n.bitb=0,n.win=new Uint8Array(t),n.end=t,n.read=0,n.write=0,n.reset=function(b,x){x&&(x[0]=g),i==qR&&f.free(b),i=HA,n.bitk=0,n.bitb=0,n.read=n.write=0},n.reset(e,null),n.inflate_flush=function(b,x){let T,C,S;return C=b.next_out_index,S=n.read,T=(S<=n.write?n.write:n.end)-S,T>b.avail_out&&(T=b.avail_out),T!==0&&x==-5&&(x=0),b.avail_out-=T,b.total_out+=T,b.next_out.set(n.win.subarray(S,S+T),C),C+=T,S+=T,S==n.end&&(S=0,n.write==n.end&&(n.write=0),T=n.write-S,T>b.avail_out&&(T=b.avail_out),T!==0&&x==-5&&(x=0),b.avail_out-=T,b.total_out+=T,b.next_out.set(n.win.subarray(S,S+T),C),C+=T,S+=T),b.next_out_index=C,n.read=S,x},n.proc=function(b,x){let T,C,S,v,D,I,L,M;for(v=b.next_in_index,D=b.avail_in,C=n.bitb,S=n.bitk,I=n.write,L=I<n.read?n.read-I-1:n.end-I;;){let N,B,_,w,P,O,F,V;switch(i){case HA:for(;S<3;){if(D!==0)x=0;else return n.bitb=C,n.bitk=S,b.avail_in=D,b.total_in+=v-b.next_in_index,b.next_in_index=v,n.write=I,n.inflate_flush(b,x);D--,C|=(b.read_byte(v++)&255)<<S,S+=8}switch(T=C&7,d=T&1,T>>>1){case 0:C>>>=3,S-=3,T=S&7,C>>>=T,S-=T,i=oj;break;case 1:N=[],B=[],_=[[]],w=[[]],sj.inflate_trees_fixed(N,B,_,w),f.init(N[0],B[0],_[0],0,w[0],0),C>>>=3,S-=3,i=qR;break;case 2:C>>>=3,S-=3,i=Lde;break;case 3:return C>>>=3,S-=3,i=xb,b.msg="invalid block type",x=-3,n.bitb=C,n.bitk=S,b.avail_in=D,b.total_in+=v-b.next_in_index,b.next_in_index=v,n.write=I,n.inflate_flush(b,x)}break;case oj:for(;S<32;){if(D!==0)x=0;else return n.bitb=C,n.bitk=S,b.avail_in=D,b.total_in+=v-b.next_in_index,b.next_in_index=v,n.write=I,n.inflate_flush(b,x);D--,C|=(b.read_byte(v++)&255)<<S,S+=8}if((~C>>>16&65535)!=(C&65535))return i=xb,b.msg="invalid stored block lengths",x=-3,n.bitb=C,n.bitk=S,b.avail_in=D,b.total_in+=v-b.next_in_index,b.next_in_index=v,n.write=I,n.inflate_flush(b,x);o=C&65535,C=S=0,i=o!==0?Mde:d!==0?YR:HA;break;case Mde:if(D===0||L===0&&(I==n.end&&n.read!==0&&(I=0,L=I<n.read?n.read-I-1:n.end-I),L===0&&(n.write=I,x=n.inflate_flush(b,x),I=n.write,L=I<n.read?n.read-I-1:n.end-I,I==n.end&&n.read!==0&&(I=0,L=I<n.read?n.read-I-1:n.end-I),L===0)))return n.bitb=C,n.bitk=S,b.avail_in=D,b.total_in+=v-b.next_in_index,b.next_in_index=v,n.write=I,n.inflate_flush(b,x);if(x=0,T=o,T>D&&(T=D),T>L&&(T=L),n.win.set(b.read_buf(v,T),I),v+=T,D-=T,I+=T,L-=T,(o-=T)!==0)break;i=d!==0?YR:HA;break;case Lde:for(;S<14;){if(D!==0)x=0;else return n.bitb=C,n.bitk=S,b.avail_in=D,b.total_in+=v-b.next_in_index,b.next_in_index=v,n.write=I,n.inflate_flush(b,x);D--,C|=(b.read_byte(v++)&255)<<S,S+=8}if(r=T=C&16383,(T&31)>29||(T>>5&31)>29)return i=xb,b.msg="too many length or distance symbols",x=-3,n.bitb=C,n.bitk=S,b.avail_in=D,b.total_in+=v-b.next_in_index,b.next_in_index=v,n.write=I,n.inflate_flush(b,x);if(T=258+(T&31)+(T>>5&31),!a||a.length<T)a=[];else for(M=0;M<T;M++)a[M]=0;C>>>=14,S-=14,s=0,i=Nde;case Nde:for(;s<4+(r>>>10);){for(;S<3;){if(D!==0)x=0;else return n.bitb=C,n.bitk=S,b.avail_in=D,b.total_in+=v-b.next_in_index,b.next_in_index=v,n.write=I,n.inflate_flush(b,x);D--,C|=(b.read_byte(v++)&255)<<S,S+=8}a[Rde[s++]]=C&7,C>>>=3,S-=3}for(;s<19;)a[Rde[s++]]=0;if(l[0]=7,T=m.inflate_trees_bits(a,l,u,p,b),T!=0)return x=T,x==-3&&(a=null,i=xb),n.bitb=C,n.bitk=S,b.avail_in=D,b.total_in+=v-b.next_in_index,b.next_in_index=v,n.write=I,n.inflate_flush(b,x);s=0,i=Fde;case Fde:for(;T=r,!(s>=258+(T&31)+(T>>5&31));){let G,z;for(T=l[0];S<T;){if(D!==0)x=0;else return n.bitb=C,n.bitk=S,b.avail_in=D,b.total_in+=v-b.next_in_index,b.next_in_index=v,n.write=I,n.inflate_flush(b,x);D--,C|=(b.read_byte(v++)&255)<<S,S+=8}if(T=p[(u[0]+(C&eu[T]))*3+1],z=p[(u[0]+(C&eu[T]))*3+2],z<16)C>>>=T,S-=T,a[s++]=z;else{for(M=z==18?7:z-14,G=z==18?11:3;S<T+M;){if(D!==0)x=0;else return n.bitb=C,n.bitk=S,b.avail_in=D,b.total_in+=v-b.next_in_index,b.next_in_index=v,n.write=I,n.inflate_flush(b,x);D--,C|=(b.read_byte(v++)&255)<<S,S+=8}if(C>>>=T,S-=T,G+=C&eu[M],C>>>=M,S-=M,M=s,T=r,M+G>258+(T&31)+(T>>5&31)||z==16&&M<1)return a=null,i=xb,b.msg="invalid bit length repeat",x=-3,n.bitb=C,n.bitk=S,b.avail_in=D,b.total_in+=v-b.next_in_index,b.next_in_index=v,n.write=I,n.inflate_flush(b,x);z=z==16?a[M-1]:0;do a[M++]=z;while(--G!==0);s=M}}if(u[0]=-1,P=[],O=[],F=[],V=[],P[0]=9,O[0]=6,T=r,T=m.inflate_trees_dynamic(257+(T&31),1+(T>>5&31),a,P,O,F,V,p,b),T!=0)return T==-3&&(a=null,i=xb),x=T,n.bitb=C,n.bitk=S,b.avail_in=D,b.total_in+=v-b.next_in_index,b.next_in_index=v,n.write=I,n.inflate_flush(b,x);f.init(P[0],O[0],p,F[0],p,V[0]),i=qR;case qR:if(n.bitb=C,n.bitk=S,b.avail_in=D,b.total_in+=v-b.next_in_index,b.next_in_index=v,n.write=I,(x=f.proc(n,b,x))!=1)return n.inflate_flush(b,x);if(x=0,f.free(b),v=b.next_in_index,D=b.avail_in,C=n.bitb,S=n.bitk,I=n.write,L=I<n.read?n.read-I-1:n.end-I,d===0){i=HA;break}i=YR;case YR:if(n.write=I,x=n.inflate_flush(b,x),I=n.write,L=I<n.read?n.read-I-1:n.end-I,n.read!=n.write)return n.bitb=C,n.bitk=S,b.avail_in=D,b.total_in+=v-b.next_in_index,b.next_in_index=v,n.write=I,n.inflate_flush(b,x);i=Bde;case Bde:return x=1,n.bitb=C,n.bitk=S,b.avail_in=D,b.total_in+=v-b.next_in_index,b.next_in_index=v,n.write=I,n.inflate_flush(b,x);case xb:return x=-3,n.bitb=C,n.bitk=S,b.avail_in=D,b.total_in+=v-b.next_in_index,b.next_in_index=v,n.write=I,n.inflate_flush(b,x);default:return x=-2,n.bitb=C,n.bitk=S,b.avail_in=D,b.total_in+=v-b.next_in_index,b.next_in_index=v,n.write=I,n.inflate_flush(b,x)}}},n.free=function(b){n.reset(b,null),n.win=null,p=null},n.set_dictionary=function(b,x,T){n.win.set(b.subarray(x,x+T),0),n.read=n.write=T},n.sync_point=function(){return i==oj?1:0}}var nJe=32,iJe=8,oJe=0,kde=1,Vde=2,Ude=3,zde=4,Hde=5,rj=6,Hv=7,Gde=12,Mg=13,rJe=[0,0,255,255];function sJe(){let e=this;e.mode=0,e.method=0,e.was=[0],e.need=0,e.marker=0,e.wbits=0;function t(n){return!n||!n.istate?-2:(n.total_in=n.total_out=0,n.msg=null,n.istate.mode=Hv,n.istate.blocks.reset(n,null),0)}e.inflateEnd=function(n){return e.blocks&&e.blocks.free(n),e.blocks=null,0},e.inflateInit=function(n,i){return n.msg=null,e.blocks=null,i<8||i>15?(e.inflateEnd(n),-2):(e.wbits=i,n.istate.blocks=new tJe(n,1<<i),t(n),0)},e.inflate=function(n,i){let o,r;if(!n||!n.istate||!n.next_in)return-2;let s=n.istate;for(i=i==WZe?-5:0,o=-5;;)switch(s.mode){case oJe:if(n.avail_in===0)return o;if(o=i,n.avail_in--,n.total_in++,((s.method=n.read_byte(n.next_in_index++))&15)!=iJe){s.mode=Mg,n.msg="unknown compression method",s.marker=5;break}if((s.method>>4)+8>s.wbits){s.mode=Mg,n.msg="invalid win size",s.marker=5;break}s.mode=kde;case kde:if(n.avail_in===0)return o;if(o=i,n.avail_in--,n.total_in++,r=n.read_byte(n.next_in_index++)&255,((s.method<<8)+r)%31!==0){s.mode=Mg,n.msg="incorrect header check",s.marker=5;break}if(!(r&nJe)){s.mode=Hv;break}s.mode=Vde;case Vde:if(n.avail_in===0)return o;o=i,n.avail_in--,n.total_in++,s.need=(n.read_byte(n.next_in_index++)&255)<<24&4278190080,s.mode=Ude;case Ude:if(n.avail_in===0)return o;o=i,n.avail_in--,n.total_in++,s.need+=(n.read_byte(n.next_in_index++)&255)<<16&16711680,s.mode=zde;case zde:if(n.avail_in===0)return o;o=i,n.avail_in--,n.total_in++,s.need+=(n.read_byte(n.next_in_index++)&255)<<8&65280,s.mode=Hde;case Hde:return n.avail_in===0?o:(o=i,n.avail_in--,n.total_in++,s.need+=n.read_byte(n.next_in_index++)&255,s.mode=rj,2);case rj:return s.mode=Mg,n.msg="need dictionary",s.marker=0,-2;case Hv:if(o=s.blocks.proc(n,o),o==-3){s.mode=Mg,s.marker=0;break}if(o==0&&(o=i),o!=1)return o;o=i,s.blocks.reset(n,s.was),s.mode=Gde;case Gde:return n.avail_in=0,1;case Mg:return-3;default:return-2}},e.inflateSetDictionary=function(n,i,o){let r=0,s=o;if(!n||!n.istate||n.istate.mode!=rj)return-2;let a=n.istate;return s>=1<<a.wbits&&(s=(1<<a.wbits)-1,r=o-s),a.blocks.set_dictionary(i,r,s),a.mode=Hv,0},e.inflateSync=function(n){let i,o,r,s,a;if(!n||!n.istate)return-2;let l=n.istate;if(l.mode!=Mg&&(l.mode=Mg,l.marker=0),(i=n.avail_in)===0)return-5;for(o=n.next_in_index,r=l.marker;i!==0&&r<4;)n.read_byte(o)==rJe[r]?r++:n.read_byte(o)!==0?r=0:r=4-r,o++,i--;return n.total_in+=o-n.next_in_index,n.next_in_index=o,n.avail_in=i,l.marker=r,r!=4?-3:(s=n.total_in,a=n.total_out,t(n),n.total_in=s,n.total_out=a,l.mode=Hv,0)},e.inflateSyncPoint=function(n){return!n||!n.istate||!n.istate.blocks?-2:n.istate.blocks.sync_point()}}function Wde(){}Wde.prototype={inflateInit(e){let t=this;return t.istate=new sJe,e||(e=15),t.istate.inflateInit(t,e)},inflate(e){let t=this;return t.istate?t.istate.inflate(t,e):-2},inflateEnd(){let e=this;if(!e.istate)return-2;let t=e.istate.inflateEnd(e);return e.istate=null,t},inflateSync(){let e=this;return e.istate?e.istate.inflateSync(e):-2},inflateSetDictionary(e,t){let n=this;return n.istate?n.istate.inflateSetDictionary(n,e,t):-2},read_byte(e){return this.next_in[e]},read_buf(e,t){return this.next_in.subarray(e,e+t)}};function qde(e){let t=this,n=new Wde,i=e&&e.chunkSize?Math.floor(e.chunkSize*2):128*1024,o=jZe,r=new Uint8Array(i),s=!1;n.inflateInit(),n.next_out=r,t.append=function(a,l){let u=[],f,d,p=0,g=0,m=0;if(a.length!==0){n.next_in_index=0,n.next_in=a,n.avail_in=a.length;do{if(n.next_out_index=0,n.avail_out=i,n.avail_in===0&&!s&&(n.next_in_index=0,s=!0),f=n.inflate(o),s&&f===-5){if(n.avail_in!==0)throw new Error("inflating: bad input")}else if(f!==0&&f!==1)throw new Error("inflating: "+n.msg);if((s||f===1)&&n.avail_in===a.length)throw new Error("inflating: bad input");n.next_out_index&&(n.next_out_index===i?u.push(new Uint8Array(r)):u.push(r.subarray(0,n.next_out_index))),m+=n.next_out_index,l&&n.next_in_index>0&&n.next_in_index!=p&&(l(n.next_in_index),p=n.next_in_index)}while(n.avail_in>0||n.avail_out===0);return u.length>1?(d=new Uint8Array(m),u.forEach(function(b){d.set(b,g),g+=b.length})):d=u[0]?new Uint8Array(u[0]):new Uint8Array,d}},t.flush=function(){n.inflateEnd()}}var GA="/",aj=new Date(2107,11,31),cj=new Date(1980,0,1),qo=void 0,tu="undefined",Hp="function";var Gv=class{constructor(t){return class extends TransformStream{constructor(n,i){let o=new t(i);super({transform(r,s){s.enqueue(o.append(r))},flush(r){let s=o.flush();s&&r.enqueue(s)}})}}}};var aJe=64,Yde=2;try{typeof navigator!=tu&&navigator.hardwareConcurrency&&(Yde=navigator.hardwareConcurrency)}catch{}var cJe={chunkSize:512*1024,maxWorkers:Yde,terminateWorkerTimeout:5e3,useWebWorkers:!0,useCompressionStream:!0,workerScripts:qo,CompressionStreamNative:typeof CompressionStream!=tu&&CompressionStream,DecompressionStreamNative:typeof DecompressionStream!=tu&&DecompressionStream},Ng=Object.assign({},cJe);function jv(){return Ng}function XR(e){return Math.max(e.chunkSize,aJe)}function jA(e){let{baseURL:t,chunkSize:n,maxWorkers:i,terminateWorkerTimeout:o,useCompressionStream:r,useWebWorkers:s,Deflate:a,Inflate:l,CompressionStream:u,DecompressionStream:f,workerScripts:d}=e;if(Lg("baseURL",t),Lg("chunkSize",n),Lg("maxWorkers",i),Lg("terminateWorkerTimeout",o),Lg("useCompressionStream",r),Lg("useWebWorkers",s),a&&(Ng.CompressionStream=new Gv(a)),l&&(Ng.DecompressionStream=new Gv(l)),Lg("CompressionStream",u),Lg("DecompressionStream",f),d!==qo){let{deflate:p,inflate:g}=d;if((p||g)&&(Ng.workerScripts||(Ng.workerScripts={})),p){if(!Array.isArray(p))throw new Error("workerScripts.deflate must be an array");Ng.workerScripts.deflate=p}if(g){if(!Array.isArray(g))throw new Error("workerScripts.inflate must be an array");Ng.workerScripts.inflate=g}}}function Lg(e,t){t!==qo&&(Ng[e]=t)}var Xde=[];for(let e=0;e<256;e++){let t=e;for(let n=0;n<8;n++)t&1?t=t>>>1^3988292384:t=t>>>1;Xde[e]=t}var Gp=class{constructor(t){this.crc=t||-1}append(t){let n=this.crc|0;for(let i=0,o=t.length|0;i<o;i++)n=n>>>8^Xde[(n^t[i])&255];this.crc=n}get(){return~this.crc}};var Wv=class extends TransformStream{constructor(){let t,n=new Gp;super({transform(i,o){n.append(i),o.enqueue(i)},flush(){let i=new Uint8Array(4);new DataView(i.buffer).setUint32(0,n.get()),t.value=i}}),t=this}};function qv(e){if(typeof TextEncoder==tu){e=unescape(encodeURIComponent(e));let t=new Uint8Array(e.length);for(let n=0;n<t.length;n++)t[n]=e.charCodeAt(n);return t}else return new TextEncoder().encode(e)}var Ic={concat(e,t){if(e.length===0||t.length===0)return e.concat(t);let n=e[e.length-1],i=Ic.getPartial(n);return i===32?e.concat(t):Ic._shiftRight(t,i,n|0,e.slice(0,e.length-1))},bitLength(e){let t=e.length;if(t===0)return 0;let n=e[t-1];return(t-1)*32+Ic.getPartial(n)},clamp(e,t){if(e.length*32<t)return e;e=e.slice(0,Math.ceil(t/32));let n=e.length;return t=t&31,n>0&&t&&(e[n-1]=Ic.partial(t,e[n-1]&2147483648>>t-1,1)),e},partial(e,t,n){return e===32?t:(n?t|0:t<<32-e)+e*1099511627776},getPartial(e){return Math.round(e/1099511627776)||32},_shiftRight(e,t,n,i){for(i===void 0&&(i=[]);t>=32;t-=32)i.push(n),n=0;if(t===0)return i.concat(e);for(let s=0;s<e.length;s++)i.push(n|e[s]>>>t),n=e[s]<<32-t;let o=e.length?e[e.length-1]:0,r=Ic.getPartial(o);return i.push(Ic.partial(t+r&31,t+r>32?n:i.pop(),1)),i}},Yv={bytes:{fromBits(e){let n=Ic.bitLength(e)/8,i=new Uint8Array(n),o;for(let r=0;r<n;r++)r&3||(o=e[r/4]),i[r]=o>>>24,o<<=8;return i},toBits(e){let t=[],n,i=0;for(n=0;n<e.length;n++)i=i<<8|e[n],(n&3)===3&&(t.push(i),i=0);return n&3&&t.push(Ic.partial(8*(n&3),i)),t}}},Kde={};Kde.sha1=class{constructor(e){let t=this;t.blockSize=512,t._init=[1732584193,4023233417,2562383102,271733878,3285377520],t._key=[1518500249,1859775393,2400959708,3395469782],e?(t._h=e._h.slice(0),t._buffer=e._buffer.slice(0),t._length=e._length):t.reset()}reset(){let e=this;return e._h=e._init.slice(0),e._buffer=[],e._length=0,e}update(e){let t=this;typeof e=="string"&&(e=Yv.utf8String.toBits(e));let n=t._buffer=Ic.concat(t._buffer,e),i=t._length,o=t._length=i+Ic.bitLength(e);if(o>9007199254740991)throw new Error("Cannot hash more than 2^53 - 1 bits");let r=new Uint32Array(n),s=0;for(let a=t.blockSize+i-(t.blockSize+i&t.blockSize-1);a<=o;a+=t.blockSize)t._block(r.subarray(16*s,16*(s+1))),s+=1;return n.splice(0,16*s),t}finalize(){let e=this,t=e._buffer,n=e._h;t=Ic.concat(t,[Ic.partial(1,1)]);for(let i=t.length+2;i&15;i++)t.push(0);for(t.push(Math.floor(e._length/4294967296)),t.push(e._length|0);t.length;)e._block(t.splice(0,16));return e.reset(),n}_f(e,t,n,i){if(e<=19)return t&n|~t&i;if(e<=39)return t^n^i;if(e<=59)return t&n|t&i|n&i;if(e<=79)return t^n^i}_S(e,t){return t<<e|t>>>32-e}_block(e){let t=this,n=t._h,i=Array(80);for(let u=0;u<16;u++)i[u]=e[u];let o=n[0],r=n[1],s=n[2],a=n[3],l=n[4];for(let u=0;u<=79;u++){u>=16&&(i[u]=t._S(1,i[u-3]^i[u-8]^i[u-14]^i[u-16]));let f=t._S(5,o)+t._f(u,r,s,a)+l+i[u]+t._key[Math.floor(u/20)]|0;l=a,a=s,s=t._S(30,r),r=o,o=f}n[0]=n[0]+o|0,n[1]=n[1]+r|0,n[2]=n[2]+s|0,n[3]=n[3]+a|0,n[4]=n[4]+l|0}};var lj={};lj.aes=class{constructor(e){let t=this;t._tables=[[[],[],[],[],[]],[[],[],[],[],[]]],t._tables[0][0][0]||t._precompute();let n=t._tables[0][4],i=t._tables[1],o=e.length,r,s,a,l=1;if(o!==4&&o!==6&&o!==8)throw new Error("invalid aes key size");for(t._key=[s=e.slice(0),a=[]],r=o;r<4*o+28;r++){let u=s[r-1];(r%o===0||o===8&&r%o===4)&&(u=n[u>>>24]<<24^n[u>>16&255]<<16^n[u>>8&255]<<8^n[u&255],r%o===0&&(u=u<<8^u>>>24^l<<24,l=l<<1^(l>>7)*283)),s[r]=s[r-o]^u}for(let u=0;r;u++,r--){let f=s[u&3?r:r-4];r<=4||u<4?a[u]=f:a[u]=i[0][n[f>>>24]]^i[1][n[f>>16&255]]^i[2][n[f>>8&255]]^i[3][n[f&255]]}}encrypt(e){return this._crypt(e,0)}decrypt(e){return this._crypt(e,1)}_precompute(){let e=this._tables[0],t=this._tables[1],n=e[4],i=t[4],o=[],r=[],s,a,l,u;for(let f=0;f<256;f++)r[(o[f]=f<<1^(f>>7)*283)^f]=f;for(let f=s=0;!n[f];f^=a||1,s=r[s]||1){let d=s^s<<1^s<<2^s<<3^s<<4;d=d>>8^d&255^99,n[f]=d,i[d]=f,u=o[l=o[a=o[f]]];let p=u*16843009^l*65537^a*257^f*16843008,g=o[d]*257^d*16843008;for(let m=0;m<4;m++)e[m][f]=g=g<<24^g>>>8,t[m][d]=p=p<<24^p>>>8}for(let f=0;f<5;f++)e[f]=e[f].slice(0),t[f]=t[f].slice(0)}_crypt(e,t){if(e.length!==4)throw new Error("invalid aes block size");let n=this._key[t],i=n.length/4-2,o=[0,0,0,0],r=this._tables[t],s=r[0],a=r[1],l=r[2],u=r[3],f=r[4],d=e[0]^n[0],p=e[t?3:1]^n[1],g=e[2]^n[2],m=e[t?1:3]^n[3],b=4,x,T,C;for(let S=0;S<i;S++)x=s[d>>>24]^a[p>>16&255]^l[g>>8&255]^u[m&255]^n[b],T=s[p>>>24]^a[g>>16&255]^l[m>>8&255]^u[d&255]^n[b+1],C=s[g>>>24]^a[m>>16&255]^l[d>>8&255]^u[p&255]^n[b+2],m=s[m>>>24]^a[d>>16&255]^l[p>>8&255]^u[g&255]^n[b+3],b+=4,d=x,p=T,g=C;for(let S=0;S<4;S++)o[t?3&-S:S]=f[d>>>24]<<24^f[p>>16&255]<<16^f[g>>8&255]<<8^f[m&255]^n[b++],x=d,d=p,p=g,g=m,m=x;return o}};var $de={getRandomValues(e){let t=new Uint32Array(e.buffer),n=i=>{let o=987654321,r=4294967295;return function(){return o=36969*(o&65535)+(o>>16)&r,i=18e3*(i&65535)+(i>>16)&r,(((o<<16)+i&r)/4294967296+.5)*(Math.random()>.5?1:-1)}};for(let i=0,o;i<e.length;i+=4){let r=n((o||Math.random())*4294967296);o=r()*987654071,t[i/4]=r()*4294967296|0}return e}},uj={};uj.ctrGladman=class{constructor(e,t){this._prf=e,this._initIv=t,this._iv=t}reset(){this._iv=this._initIv}update(e){return this.calculate(this._prf,e,this._iv)}incWord(e){if((e>>24&255)===255){let t=e>>16&255,n=e>>8&255,i=e&255;t===255?(t=0,n===255?(n=0,i===255?i=0:++i):++n):++t,e=0,e+=t<<16,e+=n<<8,e+=i}else e+=1<<24;return e}incCounter(e){(e[0]=this.incWord(e[0]))===0&&(e[1]=this.incWord(e[1]))}calculate(e,t,n){let i;if(!(i=t.length))return[];let o=Ic.bitLength(t);for(let r=0;r<i;r+=4){this.incCounter(n);let s=e.encrypt(n);t[r]^=s[0],t[r+1]^=s[1],t[r+2]^=s[2],t[r+3]^=s[3]}return Ic.clamp(t,o)}};var Fg={importKey(e){return new Fg.hmacSha1(Yv.bytes.toBits(e))},pbkdf2(e,t,n,i){if(n=n||1e4,i<0||n<0)throw new Error("invalid params to pbkdf2");let o=(i>>5)+1<<2,r,s,a,l,u,f=new ArrayBuffer(o),d=new DataView(f),p=0,g=Ic;for(t=Yv.bytes.toBits(t),u=1;p<(o||1);u++){for(r=s=e.encrypt(g.concat(t,[u])),a=1;a<n;a++)for(s=e.encrypt(s),l=0;l<s.length;l++)r[l]^=s[l];for(a=0;p<(o||1)&&a<r.length;a++)d.setInt32(p,r[a]),p+=4}return f.slice(0,i/8)}};Fg.hmacSha1=class{constructor(e){let t=this,n=t._hash=Kde.sha1,i=[[],[]];t._baseHash=[new n,new n];let o=t._baseHash[0].blockSize/32;e.length>o&&(e=new n().update(e).finalize());for(let r=0;r<o;r++)i[0][r]=e[r]^909522486,i[1][r]=e[r]^1549556828;t._baseHash[0].update(i[0]),t._baseHash[1].update(i[1]),t._resultHash=new n(t._baseHash[0])}reset(){let e=this;e._resultHash=new e._hash(e._baseHash[0]),e._updated=!1}update(e){let t=this;t._updated=!0,t._resultHash.update(e)}digest(){let e=this,t=e._resultHash.finalize(),n=new e._hash(e._baseHash[1]).update(t).finalize();return e.reset(),n}encrypt(e){if(this._updated)throw new Error("encrypt on already updated hmac called!");return this.update(e),this.digest(e)}};var lJe=typeof crypto!=tu&&typeof crypto.getRandomValues==Hp,Bg="Invalid password",Tb="Invalid signature",jp="zipjs-abort-check-password";function KR(e){return lJe?crypto.getRandomValues(e):$de.getRandomValues(e)}var WA=16,uJe="raw",Qde={name:"PBKDF2"},fJe={name:"HMAC"},dJe="SHA-1",hJe=Object.assign({hash:fJe},Qde),fj=Object.assign({iterations:1e3,hash:{name:dJe}},Qde),mJe=["deriveBits"],Kv=[8,12,16],Xv=[16,24,32],kg=10,pJe=[0,0,0,0],JR=typeof crypto!=tu,Jv=JR&&crypto.subtle,ehe=JR&&typeof Jv!=tu,Gh=Yv.bytes,_Je=lj.aes,gJe=uj.ctrGladman,yJe=Fg.hmacSha1,Zde=JR&&ehe&&typeof Jv.importKey==Hp,Jde=JR&&ehe&&typeof Jv.deriveBits==Hp,$R=class extends TransformStream{constructor({password:t,rawPassword:n,signed:i,encryptionStrength:o,checkPasswordOnly:r}){super({start(){Object.assign(this,{ready:new Promise(s=>this.resolveReady=s),password:ihe(t,n),signed:i,strength:o-1,pending:new Uint8Array})},async transform(s,a){let l=this,{password:u,strength:f,resolveReady:d,ready:p}=l;u?(await bJe(l,f,u,bf(s,0,Kv[f]+2)),s=bf(s,Kv[f]+2),r?a.error(new Error(jp)):d()):await p;let g=new Uint8Array(s.length-kg-(s.length-kg)%WA);a.enqueue(the(l,s,g,0,kg,!0))},async flush(s){let{signed:a,ctr:l,hmac:u,pending:f,ready:d}=this;if(u&&l){await d;let p=bf(f,0,f.length-kg),g=bf(f,f.length-kg),m=new Uint8Array;if(p.length){let b=Zv(Gh,p);u.update(b);let x=l.update(b);m=$v(Gh,x)}if(a){let b=bf($v(Gh,u.digest()),0,kg);for(let x=0;x<kg;x++)if(b[x]!=g[x])throw new Error(Tb)}s.enqueue(m)}}})}},ZR=class extends TransformStream{constructor({password:t,rawPassword:n,encryptionStrength:i}){let o;super({start(){Object.assign(this,{ready:new Promise(r=>this.resolveReady=r),password:ihe(t,n),strength:i-1,pending:new Uint8Array})},async transform(r,s){let a=this,{password:l,strength:u,resolveReady:f,ready:d}=a,p=new Uint8Array;l?(p=await xJe(a,u,l),f()):await d;let g=new Uint8Array(p.length+r.length-r.length%WA);g.set(p,0),s.enqueue(the(a,r,g,p.length,0))},async flush(r){let{ctr:s,hmac:a,pending:l,ready:u}=this;if(a&&s){await u;let f=new Uint8Array;if(l.length){let d=s.update(Zv(Gh,l));a.update(d),f=$v(Gh,d)}o.signature=$v(Gh,a.digest()).slice(0,kg),r.enqueue(dj(f,o.signature))}}}),o=this}};function the(e,t,n,i,o,r){let{ctr:s,hmac:a,pending:l}=e,u=t.length-o;l.length&&(t=dj(l,t),n=CJe(n,u-u%WA));let f;for(f=0;f<=u-WA;f+=WA){let d=Zv(Gh,bf(t,f,f+WA));r&&a.update(d);let p=s.update(d);r||a.update(p),n.set($v(Gh,p),f+i)}return e.pending=bf(t,f),n}async function bJe(e,t,n,i){let o=await nhe(e,t,n,bf(i,0,Kv[t])),r=bf(i,Kv[t]);if(o[0]!=r[0]||o[1]!=r[1])throw new Error(Bg)}async function xJe(e,t,n){let i=KR(new Uint8Array(Kv[t])),o=await nhe(e,t,n,i);return dj(i,o)}async function nhe(e,t,n,i){e.password=null;let o=await TJe(uJe,n,hJe,!1,mJe),r=await AJe(Object.assign({salt:i},fj),o,8*(Xv[t]*2+2)),s=new Uint8Array(r),a=Zv(Gh,bf(s,0,Xv[t])),l=Zv(Gh,bf(s,Xv[t],Xv[t]*2)),u=bf(s,Xv[t]*2);return Object.assign(e,{keys:{key:a,authentication:l,passwordVerification:u},ctr:new gJe(new _Je(a),Array.from(pJe)),hmac:new yJe(l)}),u}async function TJe(e,t,n,i,o){if(Zde)try{return await Jv.importKey(e,t,n,i,o)}catch{return Zde=!1,Fg.importKey(t)}else return Fg.importKey(t)}async function AJe(e,t,n){if(Jde)try{return await Jv.deriveBits(e,t,n)}catch{return Jde=!1,Fg.pbkdf2(t,e.salt,fj.iterations,n)}else return Fg.pbkdf2(t,e.salt,fj.iterations,n)}function ihe(e,t){return t===qo?qv(e):t}function dj(e,t){let n=e;return e.length+t.length&&(n=new Uint8Array(e.length+t.length),n.set(e,0),n.set(t,e.length)),n}function CJe(e,t){if(t&&t>e.length){let n=e;e=new Uint8Array(t),e.set(n,0)}return e}function bf(e,t,n){return e.subarray(t,n)}function $v(e,t){return e.fromBits(t)}function Zv(e,t){return e.toBits(t)}var qA=12,QR=class extends TransformStream{constructor({password:t,passwordVerification:n,checkPasswordOnly:i}){super({start(){Object.assign(this,{password:t,passwordVerification:n}),ahe(this,t)},transform(o,r){let s=this;if(s.password){let a=ohe(s,o.subarray(0,qA));if(s.password=null,a[qA-1]!=s.passwordVerification)throw new Error(Bg);o=o.subarray(qA)}i?r.error(new Error(jp)):r.enqueue(ohe(s,o))}})}},eM=class extends TransformStream{constructor({password:t,passwordVerification:n}){super({start(){Object.assign(this,{password:t,passwordVerification:n}),ahe(this,t)},transform(i,o){let r=this,s,a;if(r.password){r.password=null;let l=KR(new Uint8Array(qA));l[qA-1]=r.passwordVerification,s=new Uint8Array(i.length+l.length),s.set(rhe(r,l),0),a=qA}else s=new Uint8Array(i.length),a=0;s.set(rhe(r,i),a),o.enqueue(s)}})}};function ohe(e,t){let n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=che(e)^t[i],hj(e,n[i]);return n}function rhe(e,t){let n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=che(e)^t[i],hj(e,t[i]);return n}function ahe(e,t){let n=[305419896,591751049,878082192];Object.assign(e,{keys:n,crcKey0:new Gp(n[0]),crcKey2:new Gp(n[2])});for(let i=0;i<t.length;i++)hj(e,t.charCodeAt(i))}function hj(e,t){let[n,i,o]=e.keys;e.crcKey0.append([t]),n=~e.crcKey0.get(),i=she(Math.imul(she(i+lhe(n)),134775813)+1),e.crcKey2.append([i>>>24]),o=~e.crcKey2.get(),e.keys=[n,i,o]}function che(e){let t=e.keys[2]|2;return lhe(Math.imul(t,t^1)>>>8)}function lhe(e){return e&255}function she(e){return e&4294967295}var uhe="deflate-raw",tM=class extends TransformStream{constructor(t,{chunkSize:n,CompressionStream:i,CompressionStreamNative:o}){super({});let{compressed:r,encrypted:s,useCompressionStream:a,zipCrypto:l,signed:u,level:f}=t,d=this,p,g,m=fhe(super.readable);(!s||l)&&u&&(p=new Wv,m=jh(m,p)),r&&(m=hhe(m,a,{level:f,chunkSize:n},o,i)),s&&(l?m=jh(m,new eM(t)):(g=new ZR(t),m=jh(m,g))),dhe(d,m,()=>{let b;s&&!l&&(b=g.signature),(!s||l)&&u&&(b=new DataView(p.value.buffer).getUint32(0)),d.signature=b})}},nM=class extends TransformStream{constructor(t,{chunkSize:n,DecompressionStream:i,DecompressionStreamNative:o}){super({});let{zipCrypto:r,encrypted:s,signed:a,signature:l,compressed:u,useCompressionStream:f}=t,d,p,g=fhe(super.readable);s&&(r?g=jh(g,new QR(t)):(p=new $R(t),g=jh(g,p))),u&&(g=hhe(g,f,{chunkSize:n},o,i)),(!s||r)&&a&&(d=new Wv,g=jh(g,d)),dhe(this,g,()=>{if((!s||r)&&a){let m=new DataView(d.value.buffer);if(l!=m.getUint32(0,!1))throw new Error(Tb)}})}};function fhe(e){return jh(e,new TransformStream({transform(t,n){t&&t.length&&n.enqueue(t)}}))}function dhe(e,t,n){t=jh(t,new TransformStream({flush:n})),Object.defineProperty(e,"readable",{get(){return t}})}function hhe(e,t,n,i,o){try{let r=t&&i?i:o;e=jh(e,new r(uhe,n))}catch{if(t)try{e=jh(e,new o(uhe,n))}catch{return e}else return e}return e}function jh(e,t){return e.pipeThrough(t)}var mhe="message",phe="start",_he="pull",mj="data",ghe="ack",pj="close",rM="deflate",sM="inflate";var iM=class extends TransformStream{constructor(t,n){super({});let i=this,{codecType:o}=t,r;o.startsWith(rM)?r=tM:o.startsWith(sM)&&(r=nM);let s=0,a=0,l=new r(t,n),u=super.readable,f=new TransformStream({transform(p,g){p&&p.length&&(a+=p.length,g.enqueue(p))},flush(){Object.assign(i,{inputSize:a})}}),d=new TransformStream({transform(p,g){p&&p.length&&(s+=p.length,g.enqueue(p))},flush(){let{signature:p}=l;Object.assign(i,{signature:p,outputSize:s,inputSize:a})}});Object.defineProperty(i,"readable",{get(){return u.pipeThrough(f).pipeThrough(l).pipeThrough(d)}})}},oM=class extends TransformStream{constructor(t){let n;super({transform:i,flush(o){n&&n.length&&o.enqueue(n)}});function i(o,r){if(n){let s=new Uint8Array(n.length+o.length);s.set(n),s.set(o,n.length),o=s,n=null}o.length>t?(r.enqueue(o.slice(0,t)),i(o.slice(t),r)):n=o}}};var xhe=typeof Worker!=tu;var YA=class{constructor(t,{readable:n,writable:i},{options:o,config:r,streamOptions:s,useWebWorkers:a,transferStreams:l,scripts:u},f){let{signal:d}=s;return Object.assign(t,{busy:!0,readable:n.pipeThrough(new oM(r.chunkSize)).pipeThrough(new gj(n,s),{signal:d}),writable:i,options:Object.assign({},o),scripts:u,transferStreams:l,terminate(){return new Promise(p=>{let{worker:g,busy:m}=t;g?(m?t.resolveTerminated=p:(g.terminate(),p()),t.interface=null):p()})},onTaskFinished(){let{resolveTerminated:p}=t;p&&(t.resolveTerminated=null,t.terminated=!0,t.worker.terminate(),p()),t.busy=!1,f(t)}}),(a&&xhe?EJe:The)(t,r)}},gj=class extends TransformStream{constructor(t,{onstart:n,onprogress:i,size:o,onend:r}){let s=0;super({async start(){n&&await _j(n,o)},async transform(a,l){s+=a.length,i&&await _j(i,s,o),l.enqueue(a)},async flush(){t.size=s,r&&await _j(r,s)}})}};async function _j(e,...t){try{await e(...t)}catch{}}function The(e,t){return{run:()=>SJe(e,t)}}function EJe(e,t){let{baseURL:n,chunkSize:i}=t;if(!e.interface){let o;try{o=DJe(e.scripts[0],n,e)}catch{return xhe=!1,The(e,t)}Object.assign(e,{worker:o,interface:{run:()=>wJe(e,{chunkSize:i})}})}return e.interface}async function SJe({options:e,readable:t,writable:n,onTaskFinished:i},o){try{let r=new iM(e,o);await t.pipeThrough(r).pipeTo(n,{preventClose:!0,preventAbort:!0});let{signature:s,inputSize:a,outputSize:l}=r;return{signature:s,inputSize:a,outputSize:l}}finally{i()}}async function wJe(e,t){let n,i,o=new Promise((p,g)=>{n=p,i=g});Object.assign(e,{reader:null,writer:null,resolveResult:n,rejectResult:i,result:o});let{readable:r,options:s,scripts:a}=e,{writable:l,closed:u}=vJe(e.writable);aM({type:phe,scripts:a.slice(1),options:s,config:t,readable:r,writable:l},e)||Object.assign(e,{reader:r.getReader(),writer:l.getWriter()});let d=await o;try{await l.getWriter().close()}catch{}return await u,d}function vJe(e){let t,n=new Promise(o=>t=o);return{writable:new WritableStream({async write(o){let r=e.getWriter();await r.ready,await r.write(o),r.releaseLock()},close(){t()},abort(o){return e.getWriter().abort(o)}}),closed:n}}var yhe=!0,bhe=!0;function DJe(e,t,n){let i={type:"module"},o,r;typeof e==Hp&&(e=e());try{o=new URL(e,t)}catch{o=e}if(yhe)try{r=new Worker(o)}catch{yhe=!1,r=new Worker(o,i)}else r=new Worker(o,i);return r.addEventListener(mhe,s=>PJe(s,n)),r}function aM(e,{worker:t,writer:n,onTaskFinished:i,transferStreams:o}){try{let{value:r,readable:s,writable:a}=e,l=[];if(r&&(r.byteLength<r.buffer.byteLength?e.value=r.buffer.slice(0,r.byteLength):e.value=r.buffer,l.push(e.value)),o&&bhe?(s&&l.push(s),a&&l.push(a)):e.readable=e.writable=null,l.length)try{return t.postMessage(e,l),!0}catch{bhe=!1,e.readable=e.writable=null,t.postMessage(e)}else t.postMessage(e)}catch(r){throw n&&n.releaseLock(),i(),r}}async function PJe({data:e},t){let{type:n,value:i,messageId:o,result:r,error:s}=e,{reader:a,writer:l,resolveResult:u,rejectResult:f,onTaskFinished:d}=t;try{if(s){let{message:g,stack:m,code:b,name:x}=s,T=new Error(g);Object.assign(T,{stack:m,code:b,name:x}),p(T)}else{if(n==_he){let{value:g,done:m}=await a.read();aM({type:mj,value:g,done:m,messageId:o},t)}n==mj&&(await l.ready,await l.write(new Uint8Array(i)),aM({type:ghe,messageId:o},t)),n==pj&&p(null,r)}}catch(g){aM({type:pj,messageId:o},t),p(g)}function p(g,m){g?f(g):u(m),l&&l.releaseLock(),d()}}var Ab=[],yj=[];var Ahe=0;async function cM(e,t){let{options:n,config:i}=t,{transferStreams:o,useWebWorkers:r,useCompressionStream:s,codecType:a,compressed:l,signed:u,encrypted:f}=n,{workerScripts:d,maxWorkers:p}=i;t.transferStreams=o||o===qo;let g=!l&&!u&&!f&&!t.transferStreams;return t.useWebWorkers=!g&&(r||r===qo&&i.useWebWorkers),t.scripts=t.useWebWorkers&&d?d[a]:[],n.useCompressionStream=s||s===qo&&i.useCompressionStream,(await m()).run();async function m(){let x=Ab.find(T=>!T.busy);if(x)return Che(x),new YA(x,e,t,b);if(Ab.length<p){let T={indexWorker:Ahe};return Ahe++,Ab.push(T),new YA(T,e,t,b)}else return new Promise(T=>yj.push({resolve:T,stream:e,workerOptions:t}))}function b(x){if(yj.length){let[{resolve:T,stream:C,workerOptions:S}]=yj.splice(0,1);T(new YA(x,C,S,b))}else x.worker?(Che(x),IJe(x,t)):Ab=Ab.filter(T=>T!=x)}}function IJe(e,t){let{config:n}=t,{terminateWorkerTimeout:i}=n;Number.isFinite(i)&&i>=0&&(e.terminated?e.terminated=!1:e.terminateTimeout=setTimeout(async()=>{Ab=Ab.filter(o=>o!=e);try{await e.terminate()}catch{}},i))}function Che(e){let{terminateTimeout:t}=e;t&&(clearTimeout(t),e.terminateTimeout=null)}var OJe="Writer iterator completed too soon",RJe="text/plain";var MJe="Content-Type";var LJe=64*1024,Tj="writable",XA=class{constructor(){this.size=0}init(){this.initialized=!0}},lM=class extends XA{get readable(){let t=this,{chunkSize:n=LJe}=t,i=new ReadableStream({start(){this.chunkOffset=0},async pull(o){let{offset:r=0,size:s,diskNumberStart:a}=i,{chunkOffset:l}=this;o.enqueue(await ba(t,r+l,Math.min(n,s-l),a)),l+n>s?o.close():this.chunkOffset+=n}});return i}},bj=class extends XA{constructor(){super();let t=this,n=new WritableStream({write(i){return t.writeUint8Array(i)}});Object.defineProperty(t,Tj,{get(){return n}})}writeUint8Array(){}};var uM=class extends bj{constructor(t){super(),Object.assign(this,{data:"data:"+(t||"")+";base64,",pending:[]})}writeUint8Array(t){let n=this,i=0,o=n.pending,r=n.pending.length;for(n.pending="",i=0;i<Math.floor((r+t.length)/3)*3-r;i++)o+=String.fromCharCode(t[i]);for(;i<t.length;i++)n.pending+=String.fromCharCode(t[i]);o.length>2?n.data+=btoa(o):n.pending=o}getData(){return this.data+btoa(this.pending)}},Wp=class extends lM{constructor(t){super(),Object.assign(this,{blob:t,size:t.size})}async readUint8Array(t,n){let i=this,o=t+n,s=await(t||o<i.size?i.blob.slice(t,o):i.blob).arrayBuffer();return s.byteLength>n&&(s=s.slice(t,o)),new Uint8Array(s)}},Cb=class extends XA{constructor(t){super();let n=this,i=new TransformStream,o=[];t&&o.push([MJe,t]),Object.defineProperty(n,Tj,{get(){return i.writable}}),n.blob=new Response(i.readable,{headers:o}).blob()}getData(){return this.blob}},fM=class extends Wp{constructor(t){super(new Blob([t],{type:RJe}))}},dM=class extends Cb{constructor(t){super(t),Object.assign(this,{encoding:t,utf8:!t||t.toLowerCase()=="utf-8"})}async getData(){let{encoding:t,utf8:n}=this,i=await super.getData();if(i.text&&n)return i.text();{let o=new FileReader;return new Promise((r,s)=>{Object.assign(o,{onload:({target:a})=>r(a.result),onerror:()=>s(o.error)}),o.readAsText(i,t)})}}};var xj=class extends lM{constructor(t){super(),this.readers=t}async init(){let t=this,{readers:n}=t;t.lastDiskNumber=0,t.lastDiskOffset=0,await Promise.all(n.map(async(i,o)=>{await i.init(),o!=n.length-1&&(t.lastDiskOffset+=i.size),t.size+=i.size})),super.init()}async readUint8Array(t,n,i=0){let o=this,{readers:r}=this,s,a=i;a==-1&&(a=r.length-1);let l=t;for(;l>=r[a].size;)l-=r[a].size,a++;let u=r[a],f=u.size;if(l+n<=f)s=await ba(u,l,n);else{let d=f-l;s=new Uint8Array(n),s.set(await ba(u,l,d)),s.set(await o.readUint8Array(t+d,n-d,i),d)}return o.lastDiskNumber=Math.max(a,o.lastDiskNumber),s}},KA=class extends XA{constructor(t,n=4294967295){super();let i=this;Object.assign(i,{diskNumber:0,diskOffset:0,size:0,maxSize:n,availableSize:n});let o,r,s,a=new WritableStream({async write(f){let{availableSize:d}=i;if(s)f.length>=d?(await l(f.slice(0,d)),await u(),i.diskOffset+=o.size,i.diskNumber++,s=null,await this.write(f.slice(d))):await l(f);else{let{value:p,done:g}=await t.next();if(g&&!p)throw new Error(OJe);o=p,o.size=0,o.maxSize&&(i.maxSize=o.maxSize),i.availableSize=i.maxSize,await Wh(o),r=p.writable,s=r.getWriter(),await this.write(f)}},async close(){await s.ready,await u()}});Object.defineProperty(i,Tj,{get(){return a}});async function l(f){let d=f.length;d&&(await s.ready,await s.write(f),o.size+=d,i.size+=d,i.availableSize-=d)}async function u(){r.size=o.size,await s.close()}}};async function Wh(e,t){e.init&&!e.initialized&&await e.init(t)}function hM(e){return Array.isArray(e)&&(e=new xj(e)),e instanceof ReadableStream&&(e={readable:e}),e}function mM(e){e.writable===qo&&typeof e.next==Hp&&(e=new KA(e)),e instanceof WritableStream&&(e={writable:e});let{writable:t}=e;return t.size===qo&&(t.size=0),e instanceof KA||Object.assign(e,{diskNumber:0,diskOffset:0,availableSize:1/0,maxSize:1/0}),e}function ba(e,t,n,i){return e.readUint8Array(t,n,i)}var Ehe="\0\u263A\u263B\u2665\u2666\u2663\u2660\u2022\u25D8\u25CB\u25D9\u2642\u2640\u266A\u266B\u263C\u25BA\u25C4\u2195\u203C\xB6\xA7\u25AC\u21A8\u2191\u2193\u2192\u2190\u221F\u2194\u25B2\u25BC !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~\u2302\xC7\xFC\xE9\xE2\xE4\xE0\xE5\xE7\xEA\xEB\xE8\xEF\xEE\xEC\xC4\xC5\xC9\xE6\xC6\xF4\xF6\xF2\xFB\xF9\xFF\xD6\xDC\xA2\xA3\xA5\u20A7\u0192\xE1\xED\xF3\xFA\xF1\xD1\xAA\xBA\xBF\u2310\xAC\xBD\xBC\xA1\xAB\xBB\u2591\u2592\u2593\u2502\u2524\u2561\u2562\u2556\u2555\u2563\u2551\u2557\u255D\u255C\u255B\u2510\u2514\u2534\u252C\u251C\u2500\u253C\u255E\u255F\u255A\u2554\u2569\u2566\u2560\u2550\u256C\u2567\u2568\u2564\u2565\u2559\u2558\u2552\u2553\u256B\u256A\u2518\u250C\u2588\u2584\u258C\u2590\u2580\u03B1\xDF\u0393\u03C0\u03A3\u03C3\xB5\u03C4\u03A6\u0398\u03A9\u03B4\u221E\u03C6\u03B5\u2229\u2261\xB1\u2265\u2264\u2320\u2321\xF7\u2248\xB0\u2219\xB7\u221A\u207F\xB2\u25A0 ".split(""),NJe=Ehe.length==256;function She(e){if(NJe){let t="";for(let n=0;n<e.length;n++)t+=Ehe[e[n]];return t}else return new TextDecoder().decode(e)}function pM(e,t){return t&&t.trim().toLowerCase()=="cp437"?She(e):new TextDecoder(t).decode(e)}var Aj="filename",Cj="rawFilename",Ej="comment",Sj="rawComment",wj="uncompressedSize",vj="compressedSize",Dj="offset",_M="diskNumberStart",$A="lastModDate",gM="rawLastModDate",Qv="lastAccessDate",whe="rawLastAccessDate",eD="creationDate",vhe="rawCreationDate",Pj="internalFileAttribute",Ij="externalFileAttribute",Oj="msDosCompatible",Rj="zip64",FJe=[Aj,Cj,vj,wj,$A,gM,Ej,Sj,Qv,eD,Dj,_M,_M,Pj,Ij,Oj,Rj,"directory","bitFlag","encrypted","signature","filenameUTF8","commentUTF8","compressionMethod","version","versionMadeBy","extraField","rawExtraField","extraFieldZip64","extraFieldUnicodePath","extraFieldUnicodeComment","extraFieldAES","extraFieldNTFS","extraFieldExtendedTimestamp"],Vg=class{constructor(t){FJe.forEach(n=>this[n]=t[n])}};var Mj="File format is not recognized",UJe="End of central directory not found",zJe="End of Zip64 central directory not found",HJe="End of Zip64 central directory locator not found",GJe="Central directory header not found",jJe="Local file header not found",WJe="Zip64 extra field not found",qJe="File contains encrypted entry",YJe="Encryption method not supported",Dhe="Compression method not supported",Phe="Split zip file",Ihe="utf-8",Ohe="cp437",XJe=[[wj,4294967295],[vj,4294967295],[Dj,4294967295],[_M,65535]],KJe={[65535]:{getValue:os,bytes:4},[4294967295]:{getValue:yM,bytes:8}},SM=class{constructor(t,n={}){Object.assign(this,{reader:hM(t),options:n,config:jv()})}async*getEntriesGenerator(t={}){let n=this,{reader:i}=n,{config:o}=n;if(await Wh(i),(i.size===qo||!i.readUint8Array)&&(i=new Wp(await new Response(i.readable).blob()),await Wh(i)),i.size<22)throw new Error(Mj);i.chunkSize=XR(o);let r=await eQe(i,101010256,i.size,22,65535*16);if(!r){let B=await ba(i,0,4),_=ia(B);throw os(_)==134695760?new Error(Phe):new Error(UJe)}let s=ia(r),a=os(s,12),l=os(s,16),u=r.offset,f=na(s,20),d=u+22+f,p=na(s,4),g=i.lastDiskNumber||0,m=na(s,6),b=na(s,8),x=0,T=0;if(l==4294967295||a==4294967295||b==65535||m==65535){let B=await ba(i,r.offset-20,20),_=ia(B);if(os(_,0)!=117853008)throw new Error(zJe);l=yM(_,8);let w=await ba(i,l,56,-1),P=ia(w),O=r.offset-20-56;if(os(P,0)!=101075792&&l!=O){let F=l;l=O,x=l-F,w=await ba(i,l,56,-1),P=ia(w)}if(os(P,0)!=101075792)throw new Error(HJe);p==65535&&(p=os(P,16)),m==65535&&(m=os(P,20)),b==65535&&(b=yM(P,32)),a==4294967295&&(a=yM(P,40)),l-=a}if(l>=i.size&&(x=i.size-l-a-22,l=i.size-a-22),g!=p)throw new Error(Phe);if(l<0)throw new Error(Mj);let C=0,S=await ba(i,l,a,m),v=ia(S);if(a){let B=r.offset-a;if(os(v,C)!=33639248&&l!=B){let _=l;l=B,x+=l-_,S=await ba(i,l,a,m),v=ia(S)}}let D=r.offset-l-(i.lastDiskOffset||0);if(a!=D&&D>=0&&(a=D,S=await ba(i,l,a,m),v=ia(S)),l<0||l>=i.size)throw new Error(Mj);let I=nu(n,t,"filenameEncoding"),L=nu(n,t,"commentEncoding");for(let B=0;B<b;B++){let _=new Nj(i,o,n.options);if(os(v,C)!=33639248)throw new Error(GJe);Mhe(_,v,C+6);let w=!!_.bitFlag.languageEncodingFlag,P=C+46,O=P+_.filenameLength,F=O+_.extraFieldLength,V=na(v,C+4),G=(V&0)==0,z=S.subarray(P,O),W=na(v,C+32),U=F+W,q=S.subarray(F,U),K=w,te=w,Y=G&&(ZA(v,C+38)&16)==16,Z=os(v,C+42)+x;Object.assign(_,{versionMadeBy:V,msDosCompatible:G,compressedSize:0,uncompressedSize:0,commentLength:W,directory:Y,offset:Z,diskNumberStart:na(v,C+34),internalFileAttribute:na(v,C+36),externalFileAttribute:os(v,C+38),rawFilename:z,filenameUTF8:K,commentUTF8:te,rawExtraField:S.subarray(O,F)});let[ee,me]=await Promise.all([pM(z,K?Ihe:I||Ohe),pM(q,te?Ihe:L||Ohe)]);Object.assign(_,{rawComment:q,filename:ee,comment:me,directory:Y||ee.endsWith(GA)}),T=Math.max(Z,T),await Lhe(_,_,v,C+6);let be=new Vg(_);be.getData=(ge,xe)=>_.getData(ge,be,xe),C=U;let{onprogress:le}=t;if(le)try{await le(B+1,b,new Vg(_))}catch{}yield be}let M=nu(n,t,"extractPrependedData"),N=nu(n,t,"extractAppendedData");return M&&(n.prependedData=T>0?await ba(i,0,T):new Uint8Array),n.comment=f?await ba(i,u+22,f):new Uint8Array,N&&(n.appendedData=d<i.size?await ba(i,d,i.size-d):new Uint8Array),!0}async getEntries(t={}){let n=[];for await(let i of this.getEntriesGenerator(t))n.push(i);return n}async close(){}};var Nj=class{constructor(t,n,i){Object.assign(this,{reader:t,config:n,options:i})}async getData(t,n,i={}){let o=this,{reader:r,offset:s,diskNumberStart:a,extraFieldAES:l,compressionMethod:u,config:f,bitFlag:d,signature:p,rawLastModDate:g,uncompressedSize:m,compressedSize:b}=o,x=n.localDirectory={},T=await ba(r,s,30,a),C=ia(T),S=nu(o,i,"password"),v=nu(o,i,"rawPassword");if(S=S&&S.length&&S,v=v&&v.length&&v,l&&l.originalCompressionMethod!=99)throw new Error(Dhe);if(u!=0&&u!=8)throw new Error(Dhe);if(os(C,0)!=67324752)throw new Error(jJe);Mhe(x,C,4),x.rawExtraField=x.extraFieldLength?await ba(r,s+30+x.filenameLength,x.extraFieldLength,a):new Uint8Array,await Lhe(o,x,C,4,!0),Object.assign(n,{lastAccessDate:x.lastAccessDate,creationDate:x.creationDate});let D=o.encrypted&&x.encrypted,I=D&&!l;if(D){if(!I&&l.strength===qo)throw new Error(YJe);if(!S&&!v)throw new Error(qJe)}let L=s+30+x.filenameLength+x.extraFieldLength,M=b,N=r.readable;Object.assign(N,{diskNumberStart:a,offset:L,size:M});let B=nu(o,i,"signal"),_=nu(o,i,"checkPasswordOnly");_&&(t=new WritableStream),t=mM(t),await Wh(t,m);let{writable:w}=t,{onstart:P,onprogress:O,onend:F}=i,V={options:{codecType:sM,password:S,rawPassword:v,zipCrypto:I,encryptionStrength:l&&l.strength,signed:nu(o,i,"checkSignature"),passwordVerification:I&&(d.dataDescriptor?g>>>8&255:p>>>24&255),signature:p,compressed:u!=0,encrypted:D,useWebWorkers:nu(o,i,"useWebWorkers"),useCompressionStream:nu(o,i,"useCompressionStream"),transferStreams:nu(o,i,"transferStreams"),checkPasswordOnly:_},config:f,streamOptions:{signal:B,size:M,onstart:P,onprogress:O,onend:F}},G=0;try{({outputSize:G}=await cM({readable:N,writable:w},V))}catch(z){if(!_||z.message!=jp)throw z}finally{let z=nu(o,i,"preventClose");w.size+=G,!z&&!w.locked&&await w.getWriter().close()}return _?qo:t.getData?t.getData():w}};function Mhe(e,t,n){let i=e.rawBitFlag=na(t,n+2),o=(i&1)==1,r=os(t,n+6);Object.assign(e,{encrypted:o,version:na(t,n),bitFlag:{level:(i&6)>>1,dataDescriptor:(i&8)==8,languageEncodingFlag:(i&2048)==2048},rawLastModDate:r,lastModDate:tQe(r),filenameLength:na(t,n+22),extraFieldLength:na(t,n+24)})}async function Lhe(e,t,n,i,o){let{rawExtraField:r}=t,s=t.extraField=new Map,a=ia(new Uint8Array(r)),l=0;try{for(;l<r.length;){let T=na(a,l),C=na(a,l+2);s.set(T,{type:T,data:r.slice(l+4,l+4+C)}),l+=4+C}}catch{}let u=na(n,i+4);Object.assign(t,{signature:os(n,i+10),uncompressedSize:os(n,i+18),compressedSize:os(n,i+14)});let f=s.get(1);f&&($Je(f,t),t.extraFieldZip64=f);let d=s.get(28789);d&&(await Rhe(d,Aj,Cj,t,e),t.extraFieldUnicodePath=d);let p=s.get(25461);p&&(await Rhe(p,Ej,Sj,t,e),t.extraFieldUnicodeComment=p);let g=s.get(39169);g?(ZJe(g,t,u),t.extraFieldAES=g):t.compressionMethod=u;let m=s.get(10);m&&(JJe(m,t),t.extraFieldNTFS=m);let b=s.get(21589);b&&(QJe(b,t,o),t.extraFieldExtendedTimestamp=b);let x=s.get(6534);x&&(t.extraFieldUSDZ=x)}function $Je(e,t){t.zip64=!0;let n=ia(e.data),i=XJe.filter(([o,r])=>t[o]==r);for(let o=0,r=0;o<i.length;o++){let[s,a]=i[o];if(t[s]==a){let l=KJe[a];t[s]=e[s]=l.getValue(n,r),r+=l.bytes}else if(e[s])throw new Error(WJe)}}async function Rhe(e,t,n,i,o){let r=ia(e.data),s=new Gp;s.append(o[n]);let a=ia(new Uint8Array(4));a.setUint32(0,s.get(),!0);let l=os(r,1);Object.assign(e,{version:ZA(r,0),[t]:pM(e.data.subarray(5)),valid:!o.bitFlag.languageEncodingFlag&&l==os(a,0)}),e.valid&&(i[t]=e[t],i[t+"UTF8"]=!0)}function ZJe(e,t,n){let i=ia(e.data),o=ZA(i,4);Object.assign(e,{vendorVersion:ZA(i,0),vendorId:ZA(i,2),strength:o,originalCompressionMethod:n,compressionMethod:na(i,5)}),t.compressionMethod=e.compressionMethod}function JJe(e,t){let n=ia(e.data),i=4,o;try{for(;i<e.data.length&&!o;){let r=na(n,i),s=na(n,i+2);r==1&&(o=e.data.slice(i+4,i+4+s)),i+=4+s}}catch{}try{if(o&&o.length==24){let r=ia(o),s=r.getBigUint64(0,!0),a=r.getBigUint64(8,!0),l=r.getBigUint64(16,!0);Object.assign(e,{rawLastModDate:s,rawLastAccessDate:a,rawCreationDate:l});let u=Lj(s),f=Lj(a),d=Lj(l),p={lastModDate:u,lastAccessDate:f,creationDate:d};Object.assign(e,p),Object.assign(t,p)}}catch{}}function QJe(e,t,n){let i=ia(e.data),o=ZA(i,0),r=[],s=[];n?((o&1)==1&&(r.push($A),s.push(gM)),(o&2)==2&&(r.push(Qv),s.push(whe)),(o&4)==4&&(r.push(eD),s.push(vhe))):e.data.length>=5&&(r.push($A),s.push(gM));let a=1;r.forEach((l,u)=>{if(e.data.length>=a+4){let f=os(i,a);t[l]=e[l]=new Date(f*1e3);let d=s[u];e[d]=f}a+=4})}async function eQe(e,t,n,i,o){let r=new Uint8Array(4),s=ia(r);nQe(s,0,t);let a=i+o;return await l(i)||await l(Math.min(a,n));async function l(u){let f=n-u,d=await ba(e,f,u);for(let p=d.length-i;p>=0;p--)if(d[p]==r[0]&&d[p+1]==r[1]&&d[p+2]==r[2]&&d[p+3]==r[3])return{offset:f+p,buffer:d.slice(p,p+i).buffer}}}function nu(e,t,n){return t[n]===qo?e.options[n]:t[n]}function tQe(e){let t=(e&4294901760)>>16,n=e&65535;try{return new Date(1980+((t&65024)>>9),((t&480)>>5)-1,t&31,(n&63488)>>11,(n&2016)>>5,(n&31)*2,0)}catch{}}function Lj(e){return new Date(Number(e/BigInt(1e4)-BigInt(116444736e5)))}function ZA(e,t){return e.getUint8(t)}function na(e,t){return e.getUint16(t,!0)}function os(e,t){return e.getUint32(t,!0)}function yM(e,t){return Number(e.getBigUint64(t,!0))}function nQe(e,t,n){e.setUint32(t,n,!0)}function ia(e){return new DataView(e.buffer)}var sQe="File already exists",aQe="Zip file comment exceeds 64KB",cQe="File entry comment exceeds 64KB",lQe="File entry name exceeds 64KB",Bhe="Version exceeds 65535",uQe="The strength must equal 1, 2, or 3",fQe="Extra field type exceeds 65535",dQe="Extra field data exceeds 64KB",Kj="Zip64 is not supported (make sure 'keepOrder' is set to 'true')",khe=new Uint8Array([7,0,2,0,65,69,3,0,0]),Yj=0,Vhe=[],DM=class{constructor(t,n={}){t=mM(t),Object.assign(this,{writer:t,addSplitZipSignature:t instanceof KA,options:n,config:jv(),files:new Map,filenames:new Set,offset:t.writable.size,pendingEntriesSize:0,pendingAddFileCalls:new Set,bufferedWrites:0})}async add(t="",n,i={}){let o=this,{pendingAddFileCalls:r,config:s}=o;Yj<s.maxWorkers?Yj++:await new Promise(l=>Vhe.push(l));let a;try{if(t=t.trim(),o.filenames.has(t))throw new Error(sQe);return o.filenames.add(t),a=hQe(o,t,n,i),r.add(a),await a}catch(l){throw o.filenames.delete(t),l}finally{r.delete(a);let l=Vhe.shift();l?l():Yj--}}async close(t=new Uint8Array,n={}){let i=this,{pendingAddFileCalls:o,writer:r}=this,{writable:s}=r;for(;o.size;)await Promise.allSettled(Array.from(o));return await AQe(this,t,n),Yo(i,n,"preventClose")||await s.getWriter().close(),r.getData?r.getData():s}};async function hQe(e,t,n,i){t=t.trim(),i.directory&&!t.endsWith(GA)?t+=GA:i.directory=t.endsWith(GA);let o=qv(t);if(Ui(o)>65535)throw new Error(lQe);let r=i.comment||"",s=qv(r);if(Ui(s)>65535)throw new Error(cQe);let a=Yo(e,i,"version",20);if(a>65535)throw new Error(Bhe);let l=Yo(e,i,"versionMadeBy",20);if(l>65535)throw new Error(Bhe);let u=Yo(e,i,$A,new Date),f=Yo(e,i,Qv),d=Yo(e,i,eD),p=Yo(e,i,Oj,!0),g=Yo(e,i,Pj,0),m=Yo(e,i,Ij,0),b=Yo(e,i,"password"),x=Yo(e,i,"rawPassword"),T=Yo(e,i,"encryptionStrength",3),C=Yo(e,i,"zipCrypto"),S=Yo(e,i,"extendedTimestamp",!0),v=Yo(e,i,"keepOrder",!0),D=Yo(e,i,"level"),I=Yo(e,i,"useWebWorkers"),L=Yo(e,i,"bufferedWrite"),M=Yo(e,i,"dataDescriptorSignature",!1),N=Yo(e,i,"signal"),B=Yo(e,i,"useCompressionStream"),_=Yo(e,i,"dataDescriptor",!0),w=Yo(e,i,Rj);if(b!==qo&&T!==qo&&(T<1||T>3))throw new Error(uQe);let P=new Uint8Array,{extraField:O}=i;if(O){let xe=0,Pe=0;O.forEach(Ee=>xe+=4+Ui(Ee)),P=new Uint8Array(xe),O.forEach((Ee,Ue)=>{if(Ue>65535)throw new Error(fQe);if(Ui(Ee)>65535)throw new Error(dQe);ps(P,new Uint16Array([Ue]),Pe),ps(P,new Uint16Array([Ui(Ee)]),Pe+2),ps(P,Ee,Pe+4),Pe+=4+Ui(Ee)})}let F=0,V=0,G=0,z=w===!0;n&&(n=hM(n),await Wh(n),n.size===qo?(_=!0,(w||w===qo)&&(w=!0,G=F=4294967295)):(G=n.size,F=CQe(G)));let{diskOffset:W,diskNumber:U,maxSize:q}=e.writer,K=z||G>=4294967295,te=z||F>=4294967295,Y=z||e.offset+e.pendingEntriesSize-W>=4294967295,ee=Yo(e,i,"supportZip64SplitFile",!0)&&z||U+Math.ceil(e.pendingEntriesSize/q)>=65535;if(Y||K||te||ee){if(w===!1||!v)throw new Error(Kj);w=!0}w=w||!1,i=Object.assign({},i,{rawFilename:o,rawComment:s,version:a,versionMadeBy:l,lastModDate:u,lastAccessDate:f,creationDate:d,rawExtraField:P,zip64:w,zip64UncompressedSize:K,zip64CompressedSize:te,zip64Offset:Y,zip64DiskNumberStart:ee,password:b,rawPassword:x,level:D,useWebWorkers:I,encryptionStrength:T,extendedTimestamp:S,zipCrypto:C,bufferedWrite:L,keepOrder:v,dataDescriptor:_,dataDescriptorSignature:M,signal:N,msDosCompatible:p,internalFileAttribute:g,externalFileAttribute:m,useCompressionStream:B});let me=_Qe(i),be=yQe(i),le=Ui(me.localHeaderArray,be.dataDescriptorArray);V=le+F,e.options.usdz&&(V+=V+64),e.pendingEntriesSize+=V;let ge;try{ge=await mQe(e,t,n,{headerInfo:me,dataDescriptorInfo:be,metadataSize:le},i)}finally{e.pendingEntriesSize-=V}return Object.assign(ge,{name:t,comment:r,extraField:O}),new Vg(ge)}async function mQe(e,t,n,i,o){let{files:r,writer:s}=e,{keepOrder:a,dataDescriptor:l,signal:u}=o,{headerInfo:f}=i,{usdz:d}=e.options,p=Array.from(r.values()).pop(),g={},m,b,x,T,C,S;r.set(t,g);try{let L;a&&(L=p&&p.lock,v()),(o.bufferedWrite||e.writerLocked||e.bufferedWrites&&a||!l)&&!d?(S=new Cb,S.writable.size=0,m=!0,e.bufferedWrites++,await Wh(s)):(S=s,await D()),await Wh(S);let{writable:M}=s,{diskOffset:N}=s;if(e.addSplitZipSignature){delete e.addSplitZipSignature;let _=new Uint8Array(4),w=xa(_);Vi(w,0,134695760),await qh(M,_),e.offset+=4}d&&gQe(i,e.offset-N),m||(await L,await I(M));let{diskNumber:B}=s;if(C=!0,g.diskNumberStart=B,g=await pQe(n,S,g,i,e.config,o),C=!1,r.set(t,g),g.filename=t,m){await S.writable.getWriter().close();let _=await S.getData();await L,await D(),T=!0,l||(_=await xQe(g,_,M,o)),await I(M),g.diskNumberStart=s.diskNumber,N=s.diskOffset,await _.stream().pipeTo(M,{preventClose:!0,preventAbort:!0,signal:u}),M.size+=_.size,T=!1}if(g.offset=e.offset-N,g.zip64)TQe(g,o);else if(g.offset>=4294967295)throw new Error(Kj);return e.offset+=g.size,g}catch(L){if(m&&T||!m&&C){if(e.hasCorruptedEntries=!0,L)try{L.corruptedEntry=!0}catch{}m?e.offset+=S.writable.size:e.offset=S.writable.size}throw r.delete(t),L}finally{m&&e.bufferedWrites--,x&&x(),b&&b()}function v(){g.lock=new Promise(L=>x=L)}async function D(){e.writerLocked=!0;let{lockWriter:L}=e;e.lockWriter=new Promise(M=>b=()=>{e.writerLocked=!1,M()}),await L}async function I(L){Ui(f.localHeaderArray)>s.availableSize&&(s.availableSize=0,await qh(L,new Uint8Array))}}async function pQe(e,t,{diskNumberStart:n,lock:i},o,r,s){let{headerInfo:a,dataDescriptorInfo:l,metadataSize:u}=o,{localHeaderArray:f,headerArray:d,lastModDate:p,rawLastModDate:g,encrypted:m,compressed:b,version:x,compressionMethod:T,rawExtraFieldExtendedTimestamp:C,extraFieldExtendedTimestampFlag:S,rawExtraFieldNTFS:v,rawExtraFieldAES:D}=a,{dataDescriptorArray:I}=l,{rawFilename:L,lastAccessDate:M,creationDate:N,password:B,rawPassword:_,level:w,zip64:P,zip64UncompressedSize:O,zip64CompressedSize:F,zip64Offset:V,zip64DiskNumberStart:G,zipCrypto:z,dataDescriptor:W,directory:U,versionMadeBy:q,rawComment:K,rawExtraField:te,useWebWorkers:Y,onstart:Z,onprogress:ee,onend:me,signal:be,encryptionStrength:le,extendedTimestamp:ge,msDosCompatible:xe,internalFileAttribute:Pe,externalFileAttribute:Ee,useCompressionStream:Ue}=s,Ye={lock:i,versionMadeBy:q,zip64:P,directory:!!U,filenameUTF8:!0,rawFilename:L,commentUTF8:!0,rawComment:K,rawExtraFieldExtendedTimestamp:C,rawExtraFieldNTFS:v,rawExtraFieldAES:D,rawExtraField:te,extendedTimestamp:ge,msDosCompatible:xe,internalFileAttribute:Pe,externalFileAttribute:Ee,diskNumberStart:n},it=0,It=0,Ot,{writable:He}=t;if(e){e.chunkSize=XR(r),await qh(He,f);let dt=e.readable,bt=dt.size=e.size,nn={options:{codecType:rM,level:w,rawPassword:_,password:B,encryptionStrength:le,zipCrypto:m&&z,passwordVerification:m&&z&&g>>8&255,signed:!0,compressed:b,encrypted:m,useWebWorkers:Y,useCompressionStream:Ue,transferStreams:!1},config:r,streamOptions:{signal:be,size:bt,onstart:Z,onprogress:ee,onend:me}},Ae=await cM({readable:dt,writable:He},nn);It=Ae.inputSize,it=Ae.outputSize,Ot=Ae.signature,He.size+=It}else await qh(He,f);let tn;if(P){let dt=4;O&&(dt+=8),F&&(dt+=8),V&&(dt+=8),G&&(dt+=4),tn=new Uint8Array(dt)}else tn=new Uint8Array;return bQe({signature:Ot,rawExtraFieldZip64:tn,compressedSize:it,uncompressedSize:It,headerInfo:a,dataDescriptorInfo:l},s),W&&await qh(He,I),Object.assign(Ye,{uncompressedSize:It,compressedSize:it,lastModDate:p,rawLastModDate:g,creationDate:N,lastAccessDate:M,encrypted:m,size:u+it,compressionMethod:T,version:x,headerArray:d,signature:Ot,rawExtraFieldZip64:tn,extraFieldExtendedTimestampFlag:S,zip64UncompressedSize:O,zip64CompressedSize:F,zip64Offset:V,zip64DiskNumberStart:G}),Ye}function _Qe(e){let{rawFilename:t,lastModDate:n,lastAccessDate:i,creationDate:o,rawPassword:r,password:s,level:a,zip64:l,zipCrypto:u,dataDescriptor:f,directory:d,rawExtraField:p,encryptionStrength:g,extendedTimestamp:m}=e,b=a!==0&&!d,x=!!(s&&Ui(s)||r&&Ui(r)),T=e.version,C;if(x&&!u){C=new Uint8Array(Ui(khe)+2);let G=xa(C);Ji(G,0,39169),ps(C,khe,2),PM(G,8,g)}else C=new Uint8Array;let S,v,D;if(m){v=new Uint8Array(9+(i?4:0)+(o?4:0));let G=xa(v);Ji(G,0,21589),Ji(G,2,Ui(v)-4),D=1+(i?2:0)+(o?4:0),PM(G,4,D);let z=5;Vi(G,z,Math.floor(n.getTime()/1e3)),z+=4,i&&(Vi(G,z,Math.floor(i.getTime()/1e3)),z+=4),o&&Vi(G,z,Math.floor(o.getTime()/1e3));try{S=new Uint8Array(36);let W=xa(S),U=Xj(n);Ji(W,0,10),Ji(W,2,32),Ji(W,8,1),Ji(W,10,24),_l(W,12,U),_l(W,20,Xj(i)||U),_l(W,28,Xj(o)||U)}catch{S=new Uint8Array}}else S=v=new Uint8Array;let I=2048;f&&(I=I|8);let L=0;b&&(L=8),l&&(T=T>45?T:45),x&&(I=I|1,u||(T=T>51?T:51,L=99,b&&(C[9]=8)));let M=new Uint8Array(26),N=xa(M);Ji(N,0,T),Ji(N,2,I),Ji(N,4,L);let B=new Uint32Array(1),_=xa(B),w;n<cj?w=cj:n>aj?w=aj:w=n,Ji(_,0,(w.getHours()<<6|w.getMinutes())<<5|w.getSeconds()/2),Ji(_,2,(w.getFullYear()-1980<<4|w.getMonth()+1)<<5|w.getDate());let P=B[0];Vi(N,6,P),Ji(N,22,Ui(t));let O=Ui(C,v,S,p);Ji(N,24,O);let F=new Uint8Array(30+Ui(t)+O),V=xa(F);return Vi(V,0,67324752),ps(F,M,4),ps(F,t,30),ps(F,C,30+Ui(t)),ps(F,v,30+Ui(t,C)),ps(F,S,30+Ui(t,C,v)),ps(F,p,30+Ui(t,C,v,S)),{localHeaderArray:F,headerArray:M,headerView:N,lastModDate:n,rawLastModDate:P,encrypted:x,compressed:b,version:T,compressionMethod:L,extraFieldExtendedTimestampFlag:D,rawExtraFieldExtendedTimestamp:v,rawExtraFieldNTFS:S,rawExtraFieldAES:C,extraFieldLength:O}}function gQe(e,t){let{headerInfo:n}=e,{localHeaderArray:i,extraFieldLength:o}=n,r=xa(i),s=64-(t+Ui(i))%64;s<4&&(s+=64);let a=new Uint8Array(s),l=xa(a);Ji(l,0,6534),Ji(l,2,s-2);let u=i;n.localHeaderArray=i=new Uint8Array(Ui(u)+s),ps(i,u),ps(i,a,Ui(u)),r=xa(i),Ji(r,28,o+s),e.metadataSize+=s}function yQe(e){let{zip64:t,dataDescriptor:n,dataDescriptorSignature:i}=e,o=new Uint8Array,r,s=0;return n&&(o=new Uint8Array(t?i?24:20:i?16:12),r=xa(o),i&&(s=4,Vi(r,0,134695760))),{dataDescriptorArray:o,dataDescriptorView:r,dataDescriptorOffset:s}}function bQe(e,t){let{signature:n,rawExtraFieldZip64:i,compressedSize:o,uncompressedSize:r,headerInfo:s,dataDescriptorInfo:a}=e,{headerView:l,encrypted:u}=s,{dataDescriptorView:f,dataDescriptorOffset:d}=a,{zip64:p,zip64UncompressedSize:g,zip64CompressedSize:m,zipCrypto:b,dataDescriptor:x}=t;if((!u||b)&&n!==qo&&(Vi(l,10,n),x&&Vi(f,d,n)),p){let T=xa(i);Ji(T,0,1),Ji(T,2,Ui(i)-4);let C=4;g&&(Vi(l,18,4294967295),_l(T,C,BigInt(r)),C+=8),m&&(Vi(l,14,4294967295),_l(T,C,BigInt(o))),x&&(_l(f,d+4,BigInt(o)),_l(f,d+12,BigInt(r)))}else Vi(l,14,o),Vi(l,18,r),x&&(Vi(f,d+4,o),Vi(f,d+8,r))}async function xQe(e,t,n,{zipCrypto:i}){let o;o=await t.slice(0,26).arrayBuffer(),o.byteLength!=26&&(o=o.slice(0,26));let r=new DataView(o);return(!e.encrypted||i)&&Vi(r,14,e.signature),e.zip64?(Vi(r,18,4294967295),Vi(r,22,4294967295)):(Vi(r,18,e.compressedSize),Vi(r,22,e.uncompressedSize)),await qh(n,new Uint8Array(o)),t.slice(o.byteLength)}function TQe(e,t){let{rawExtraFieldZip64:n,offset:i,diskNumberStart:o}=e,{zip64UncompressedSize:r,zip64CompressedSize:s,zip64Offset:a,zip64DiskNumberStart:l}=t,u=xa(n),f=4;r&&(f+=8),s&&(f+=8),a&&(_l(u,f,BigInt(i)),f+=8),l&&Vi(u,f,o)}async function AQe(e,t,n){let{files:i,writer:o}=e,{diskOffset:r,writable:s}=o,{diskNumber:a}=o,l=0,u=0,f=e.offset-r,d=i.size;for(let[,D]of i){let{rawFilename:I,rawExtraFieldZip64:L,rawExtraFieldAES:M,rawComment:N,rawExtraFieldNTFS:B,rawExtraField:_,extendedTimestamp:w,extraFieldExtendedTimestampFlag:P,lastModDate:O}=D,F;if(w){F=new Uint8Array(9);let V=xa(F);Ji(V,0,21589),Ji(V,2,5),PM(V,4,P),Vi(V,5,Math.floor(O.getTime()/1e3))}else F=new Uint8Array;D.rawExtraFieldCDExtendedTimestamp=F,u+=46+Ui(I,N,L,M,B,F,_)}let p=new Uint8Array(u),g=xa(p);await Wh(o);let m=0;for(let[D,I]of Array.from(i.values()).entries()){let{offset:L,rawFilename:M,rawExtraFieldZip64:N,rawExtraFieldAES:B,rawExtraFieldCDExtendedTimestamp:_,rawExtraFieldNTFS:w,rawExtraField:P,rawComment:O,versionMadeBy:F,headerArray:V,directory:G,zip64:z,zip64UncompressedSize:W,zip64CompressedSize:U,zip64DiskNumberStart:q,zip64Offset:K,msDosCompatible:te,internalFileAttribute:Y,externalFileAttribute:Z,diskNumberStart:ee,uncompressedSize:me,compressedSize:be}=I,le=Ui(N,B,_,w,P);Vi(g,l,33639248),Ji(g,l+4,F);let ge=xa(V);W||Vi(ge,18,me),U||Vi(ge,14,be),ps(p,V,l+6),Ji(g,l+30,le),Ji(g,l+32,Ui(O)),Ji(g,l+34,z&&q?65535:ee),Ji(g,l+36,Y),Z?Vi(g,l+38,Z):G&&te&&PM(g,l+38,16),Vi(g,l+42,z&&K?4294967295:L),ps(p,M,l+46),ps(p,N,l+46+Ui(M)),ps(p,B,l+46+Ui(M,N)),ps(p,_,l+46+Ui(M,N,B)),ps(p,w,l+46+Ui(M,N,B,_)),ps(p,P,l+46+Ui(M,N,B,_,w)),ps(p,O,l+46+Ui(M)+le);let xe=46+Ui(M,O)+le;if(l-m>o.availableSize&&(o.availableSize=0,await qh(s,p.slice(m,l)),m=l),l+=xe,n.onprogress)try{await n.onprogress(D+1,i.size,new Vg(I))}catch{}}await qh(s,m?p.slice(m):p);let b=o.diskNumber,{availableSize:x}=o;x<22&&b++;let T=Yo(e,n,"zip64");if(f>=4294967295||u>=4294967295||d>=65535||b>=65535){if(T===!1)throw new Error(Kj);T=!0}let C=new Uint8Array(T?98:22),S=xa(C);l=0,T&&(Vi(S,0,101075792),_l(S,4,BigInt(44)),Ji(S,12,45),Ji(S,14,45),Vi(S,16,b),Vi(S,20,a),_l(S,24,BigInt(d)),_l(S,32,BigInt(d)),_l(S,40,BigInt(u)),_l(S,48,BigInt(f)),Vi(S,56,117853008),_l(S,64,BigInt(f)+BigInt(u)),Vi(S,72,b+1),Yo(e,n,"supportZip64SplitFile",!0)&&(b=65535,a=65535),d=65535,f=4294967295,u=4294967295,l+=76),Vi(S,l,101010256),Ji(S,l+4,b),Ji(S,l+6,a),Ji(S,l+8,d),Ji(S,l+10,d),Vi(S,l+12,u),Vi(S,l+16,f);let v=Ui(t);if(v)if(v<=65535)Ji(S,l+20,v);else throw new Error(aQe);await qh(s,C),v&&await qh(s,t)}async function qh(e,t){let n=e.getWriter();try{await n.ready,e.size+=Ui(t),await n.write(t)}finally{n.releaseLock()}}function Xj(e){if(e)return(BigInt(e.getTime())+BigInt(116444736e5))*BigInt(1e4)}function Yo(e,t,n,i){let o=t[n]===qo?e.options[n]:t[n];return o===qo?i:o}function CQe(e){return e+5*(Math.floor(e/16383)+1)}function PM(e,t,n){e.setUint8(t,n)}function Ji(e,t,n){e.setUint16(t,n,!0)}function Vi(e,t,n){e.setUint32(t,n,!0)}function _l(e,t,n){e.setBigUint64(t,n,!0)}function ps(e,t,n){e.set(t,n)}function xa(e){return new DataView(e.buffer)}function Ui(...e){let t=0;return e.forEach(n=>n&&(t+=n.length)),t}jA({Deflate:Ede,Inflate:qde});var $j=32,EQe="http://www.opengis.net/kml/2.2",Id="http://www.google.com/kml/ext/2.2",SQe="http://www.w3.org/2000/xmlns/";function IM(e){this._files={},this._promises=[],this._count=0,this._modelCallback=e}var wQe=/^data:image\/([^,;]+)/;IM.prototype.texture=function(e){let t=this,n;if(typeof e=="string"||e instanceof De){if(e=De.createIfNeeded(e),!e.isDataUri)return e.url;let i=e.url.match(wQe);n=`texture_${++this._count}`,c(i)&&(n+=`.${i[1]}`);let o=e.fetchBlob().then(function(r){t._files[n]=r});return this._promises.push(o),n}if(e instanceof HTMLCanvasElement){n=`texture_${++this._count}.png`;let i=new Promise(o=>{e.toBlob(function(r){t._files[n]=r,o()})});return this._promises.push(i),n}return""};function vQe(e,t){return function(n){e._files[t]=n}}IM.prototype.model=function(e,t){let n=this._modelCallback;if(!c(n))throw new ue("Encountered a model entity while exporting to KML, but no model callback was supplied.");let i={},o=n(e,t,i);for(let r in i)if(i.hasOwnProperty(r)){let s=Promise.resolve(i[r]);this._promises.push(s),s.then(vQe(this,r))}return o};Object.defineProperties(IM.prototype,{promise:{get:function(){return Promise.all(this._promises)}},files:{get:function(){return this._files}}});function OM(e){this._time=e}OM.prototype.get=function(e,t,n){let i;return c(e)&&(i=c(e.getValue)?e.getValue(this._time,n):e),y(i,t)};OM.prototype.getColor=function(e,t){let n=this.get(e,t);if(c(n))return Sb(n)};OM.prototype.getMaterialType=function(e){if(c(e))return e.getType(this._time)};function Zj(){this._ids={},this._styles={},this._count=0}Zj.prototype.get=function(e){let t=this._ids,n=e.innerHTML;if(c(t[n]))return t[n];let i=`style-${++this._count}`;return e.setAttribute("id",i),i=`#${i}`,t[n]=i,this._styles[n]=e,i};Zj.prototype.save=function(e){let t=this._styles,n=e.childNodes[0];for(let i in t)t.hasOwnProperty(i)&&e.insertBefore(t[i],n)};function Ghe(){this._ids={}}Ghe.prototype.get=function(e){if(!c(e))return this.get(Hn());let t=this._ids;return c(t[e])?`${e.toString()}-${++t[e]}`:(t[e]=0,e)};function Jj(e){e=y(e,y.EMPTY_OBJECT);let t=e.entities,n=y(e.kmz,!1);if(!c(t))throw new E("entities is required.");let i=Jj._createState(e),o=t.values.filter(function(u){return!c(u.parent)}),r=i.kmlDoc,s=r.documentElement;s.setAttributeNS(SQe,"xmlns:gx",Id);let a=r.createElement("Document");s.appendChild(a),Whe(i,a,o),i.styleCache.save(a);let l=i.externalFileHandler;return l.promise.then(function(){let f=new XMLSerializer().serializeToString(i.kmlDoc);return n?DQe(f,l.files):{kml:f,externalFiles:l.files}})}function DQe(e,t){let n=sn("ThirdParty/Workers/z-worker-pako.js");jA({workerScripts:{deflate:[n,"./pako_deflate.min.js"],inflate:[n,"./pako_inflate.min.js"]}});let i=new Cb,o=new DM(i);return o.add("doc.kml",new fM(e)).then(function(){let r=Object.keys(t);return jhe(o,r,t,0)}).then(function(){return o.close()}).then(function(r){return{kmz:r}})}function jhe(e,t,n,i){if(t.length===i)return;let o=t[i];return e.add(o,new Wp(n[o])).then(function(){return jhe(e,t,n,i+1)})}Jj._createState=function(e){let t=e.entities,n=new Zj,i=t.computeAvailability(),o=c(e.time)?e.time:i.start,r=y(e.defaultAvailability,i),s=y(e.sampleDuration,60);r.start===je.MINIMUM_VALUE?r.stop===je.MAXIMUM_VALUE?r=new wn:J.addSeconds(r.stop,-10*s,r.start):r.stop===je.MAXIMUM_VALUE&&J.addSeconds(r.start,10*s,r.stop);let a=new IM(e.modelCallback);return{kmlDoc:document.implementation.createDocument(EQe,"kml"),ellipsoid:y(e.ellipsoid,ie.default),idManager:new Ghe,styleCache:n,externalFileHandler:a,time:o,valueGetter:new OM(o),sampleDuration:s,defaultAvailability:new ts([r])}};function Whe(e,t,n){let i=e.kmlDoc,o=e.styleCache,r=e.valueGetter,s=e.idManager,a=n.length,l,u,f;for(let d=0;d<a;++d){let p=n[d];l=[],u=[],f=[],PQe(e,p,u,f),IQe(e,p.polyline,u,f),Hhe(e,p.rectangle,u,f,l),Hhe(e,p.polygon,u,f,l),LQe(e,p,p.model,u,f);let g,m=p.availability;c(m)&&(g=i.createElement("TimeSpan"),J.equals(m.start,je.MINIMUM_VALUE)||g.appendChild(fn(i,"begin",J.toIso8601(m.start))),J.equals(m.stop,je.MAXIMUM_VALUE)||g.appendChild(fn(i,"end",J.toIso8601(m.stop))));for(let T=0;T<l.length;++T){let C=l[T];C.setAttribute("id",s.get(p.id)),C.appendChild(fn(i,"name",p.name)),C.appendChild(fn(i,"visibility",p.show)),C.appendChild(fn(i,"description",p.description)),c(g)&&C.appendChild(g),t.appendChild(C)}let b=u.length;if(b>0){let T=i.createElement("Placemark");T.setAttribute("id",s.get(p.id));let C=p.name,S=p.label;if(c(S)){let D=i.createElement("LabelStyle"),I=r.get(S.text);C=c(I)&&I.length>0?I:C;let L=r.getColor(S.fillColor);c(L)&&(D.appendChild(fn(i,"color",L)),D.appendChild(fn(i,"colorMode","normal")));let M=r.get(S.scale);c(M)&&D.appendChild(fn(i,"scale",M)),f.push(D)}T.appendChild(fn(i,"name",C)),T.appendChild(fn(i,"visibility",p.show)),T.appendChild(fn(i,"description",p.description)),c(g)&&T.appendChild(g),t.appendChild(T);let v=f.length;if(v>0){let D=i.createElement("Style");for(let I=0;I<v;++I)D.appendChild(f[I]);T.appendChild(fn(i,"styleUrl",o.get(D)))}if(u.length===1)T.appendChild(u[0]);else if(u.length>1){let D=i.createElement("MultiGeometry");for(let I=0;I<b;++I)D.appendChild(u[I]);T.appendChild(D)}}let x=p._children;if(x.length>0){let T=i.createElement("Folder");T.setAttribute("id",s.get(p.id)),T.appendChild(fn(i,"name",p.name)),T.appendChild(fn(i,"visibility",p.show)),T.appendChild(fn(i,"description",p.description)),t.appendChild(T),Whe(e,T,x)}}}var gl=new h,Oc=new he,Pd=new J;function PQe(e,t,n,i){let o=e.kmlDoc,r=e.ellipsoid,s=e.valueGetter,a=y(t.billboard,t.point);if(!c(a)&&!c(t.path))return;let l=t.position;if(!l.isConstant){qhe(e,t,a,n,i);return}s.get(l,void 0,gl);let u=fn(o,"coordinates",Eb(gl,r)),f=o.createElement("Point"),d=o.createElement("altitudeMode");d.appendChild(wb(e,a.heightReference)),f.appendChild(d),f.appendChild(u),n.push(f);let p=a instanceof Wc?Xhe(e,a):Yhe(e,a);i.push(p)}function qhe(e,t,n,i,o){let r=e.kmlDoc,s=e.ellipsoid,a=e.valueGetter,l,u=t.position,f=!0;u instanceof Ka?(l=u.intervals,f=!1):l=y(t.availability,e.defaultAvailability);let d=n instanceof Jy,p,g,m,b=[];for(p=0;p<l.length;++p){let T=l.get(p),C=f?u:T.data,S=r.createElement("altitudeMode");C instanceof Pg?(C=C._value,S.appendChild(wb(e,$e.CLAMP_TO_GROUND))):c(n)?S.appendChild(wb(e,n.heightReference)):S.appendChild(wb(e,$e.NONE));let v=[],D=[];if(C.isConstant){a.get(C,void 0,gl);let L=fn(r,"coordinates",Eb(gl,s));v.push(J.toIso8601(T.start)),D.push(L),v.push(J.toIso8601(T.stop)),D.push(L)}else if(C instanceof Ja)for(m=C._property._times,g=0;g<m.length;++g)v.push(J.toIso8601(m[g])),C.getValueInReferenceFrame(m[g],ji.FIXED,gl),D.push(Eb(gl,s));else if(C instanceof bd){m=C._times;let L=C._values;for(g=0;g<m.length;++g)v.push(J.toIso8601(m[g])),h.fromArray(L,g*3,gl),D.push(Eb(gl,s))}else{let L=e.sampleDuration;T.start.clone(Pd),T.isStartIncluded||J.addSeconds(Pd,L,Pd);let M=T.stop;for(;J.lessThan(Pd,M);)C.getValue(Pd,gl),v.push(J.toIso8601(Pd)),D.push(Eb(gl,s)),J.addSeconds(Pd,L,Pd);T.isStopIncluded&&J.equals(Pd,M)&&(C.getValue(Pd,gl),v.push(J.toIso8601(Pd)),D.push(Eb(gl,s)))}let I=r.createElementNS(Id,"Track");I.appendChild(S);for(let L=0;L<v.length;++L){let M=fn(r,"when",v[L]),N=fn(r,"coord",D[L],Id);I.appendChild(M),I.appendChild(N)}d&&I.appendChild(Khe(e,n)),b.push(I)}if(b.length===1)i.push(b[0]);else if(b.length>1){let T=r.createElementNS(Id,"MultiTrack");for(p=0;p<b.length;++p)T.appendChild(b[p]);i.push(T)}if(c(n)&&!d){let T=n instanceof Wc?Xhe(e,n):Yhe(e,n);o.push(T)}let x=t.path;if(c(x)){let T=a.get(x.width),C=x.material;if(c(C)||c(T)){let S=r.createElement("LineStyle");c(T)&&S.appendChild(fn(r,"width",T)),Qj(e,C,S),o.push(S)}}}function Yhe(e,t){let n=e.kmlDoc,i=e.valueGetter,o=n.createElement("IconStyle"),r=i.getColor(t.color);c(r)&&(o.appendChild(fn(n,"color",r)),o.appendChild(fn(n,"colorMode","normal")));let s=i.get(t.pixelSize);return c(s)&&o.appendChild(fn(n,"scale",s/$j)),o}function Xhe(e,t){let n=e.kmlDoc,i=e.valueGetter,o=e.externalFileHandler,r=n.createElement("IconStyle"),s=i.get(t.image);if(c(s)){s=o.texture(s);let p=n.createElement("Icon");p.appendChild(fn(n,"href",s));let g=i.get(t.imageSubRegion);c(g)&&(p.appendChild(fn(n,"x",g.x,Id)),p.appendChild(fn(n,"y",g.y,Id)),p.appendChild(fn(n,"w",g.width,Id)),p.appendChild(fn(n,"h",g.height,Id))),r.appendChild(p)}let a=i.getColor(t.color);c(a)&&(r.appendChild(fn(n,"color",a)),r.appendChild(fn(n,"colorMode","normal")));let l=i.get(t.scale);c(l)&&r.appendChild(fn(n,"scale",l));let u=i.get(t.pixelOffset);if(c(u)){l=y(l,1),H.divideByScalar(u,l,u);let p=i.get(t.width,$j),g=i.get(t.height,$j),m=i.get(t.horizontalOrigin,bi.CENTER);m===bi.CENTER?u.x-=p*.5:m===bi.RIGHT&&(u.x-=p);let b=i.get(t.verticalOrigin,Ln.CENTER);b===Ln.TOP?u.y+=g:b===Ln.CENTER&&(u.y+=g*.5);let x=n.createElement("hotSpot");x.setAttribute("x",-u.x),x.setAttribute("y",u.y),x.setAttribute("xunits","pixels"),x.setAttribute("yunits","pixels"),r.appendChild(x)}let f=i.get(t.rotation),d=i.get(t.alignedAxis);return c(f)&&h.equals(h.UNIT_Z,d)&&(f=R.toDegrees(-f),f===0&&(f=360),r.appendChild(fn(n,"heading",f))),r}function IQe(e,t,n,i){let o=e.kmlDoc,r=e.ellipsoid,s=e.valueGetter;if(!c(t))return;let a=o.createElement("LineString"),l=o.createElement("altitudeMode"),u=s.get(t.clampToGround,!1),f;u?(a.appendChild(fn(o,"tessellate",!0)),f=o.createTextNode("clampToGround")):f=o.createTextNode("absolute"),l.appendChild(f),a.appendChild(l);let d=t.positions,p=s.get(d),g=fn(o,"coordinates",Eb(p,r));a.appendChild(g);let m=s.get(t.zIndex);u&&c(m)&&a.appendChild(fn(o,"drawOrder",m,Id)),n.push(a);let b=o.createElement("LineStyle"),x=s.get(t.width);c(x)&&b.appendChild(fn(o,"width",x)),Qj(e,t.material,b),i.push(b)}function OQe(e,t,n){let i=e.kmlDoc,o=e.valueGetter,r=o.get(t.height,0);n>0&&(r=n);let s=t.coordinates,a=o.get(s),l=[],u=[ae.northeast,ae.southeast,ae.southwest,ae.northwest];for(let g=0;g<4;++g)u[g](a,Oc),l.push(`${R.toDegrees(Oc.longitude)},${R.toDegrees(Oc.latitude)},${r}`);let f=fn(i,"coordinates",l.join(" ")),d=i.createElement("outerBoundaryIs"),p=i.createElement("LinearRing");return p.appendChild(f),d.appendChild(p),[d]}function zhe(e,t,n,i){let o=e.kmlDoc,r=e.ellipsoid,s=[],a=t.length;for(let f=0;f<a;++f)he.fromCartesian(t[f],r,Oc),s.push(`${R.toDegrees(Oc.longitude)},${R.toDegrees(Oc.latitude)},${i?Oc.height:n}`);let l=fn(o,"coordinates",s.join(" ")),u=o.createElement("LinearRing");return u.appendChild(l),u}function RQe(e,t,n){let i=e.kmlDoc,o=e.valueGetter,r=o.get(t.height,0),s=o.get(t.perPositionHeight,!1);!s&&n>0&&(r=n);let a=[],l=t.hierarchy,u=o.get(l),f=Array.isArray(u)?u:u.positions,d=i.createElement("outerBoundaryIs");d.appendChild(zhe(e,f,r,s)),a.push(d);let p=u.holes;if(c(p)){let g=p.length;for(let m=0;m<g;++m){let b=i.createElement("innerBoundaryIs");b.appendChild(zhe(e,p[m].positions,r,s)),a.push(b)}}return a}function Hhe(e,t,n,i,o){let r=e.kmlDoc,s=e.valueGetter;if(!c(t))return;let a=t instanceof zm;if(a&&s.getMaterialType(t.material)==="Image"){MQe(e,t,o);return}let l=r.createElement("Polygon"),u=s.get(t.extrudedHeight,0);u>0&&l.appendChild(fn(r,"extrude",!0));let f=a?OQe(e,t,u):RQe(e,t,u),d=f.length;for(let x=0;x<d;++x)l.appendChild(f[x]);let p=r.createElement("altitudeMode");p.appendChild(wb(e,t.heightReference)),l.appendChild(p),n.push(l);let g=r.createElement("PolyStyle"),m=s.get(t.fill,!1);m&&g.appendChild(fn(r,"fill",m)),Qj(e,t.material,g);let b=s.get(t.outline,!1);if(b){g.appendChild(fn(r,"outline",b));let x=r.createElement("LineStyle"),T=s.get(t.outlineWidth,1);x.appendChild(fn(r,"width",T));let C=s.getColor(t.outlineColor,j.BLACK);x.appendChild(fn(r,"color",C)),x.appendChild(fn(r,"colorMode","normal")),i.push(x)}i.push(g)}function MQe(e,t,n){let i=e.kmlDoc,o=e.valueGetter,r=e.externalFileHandler,s=i.createElement("GroundOverlay"),a=i.createElement("altitudeMode");a.appendChild(wb(e,t.heightReference)),s.appendChild(a);let l=o.get(t.height);c(l)&&s.appendChild(fn(i,"altitude",l));let u=o.get(t.coordinates),f=i.createElement("LatLonBox");f.appendChild(fn(i,"north",R.toDegrees(u.north))),f.appendChild(fn(i,"south",R.toDegrees(u.south))),f.appendChild(fn(i,"east",R.toDegrees(u.east))),f.appendChild(fn(i,"west",R.toDegrees(u.west))),s.appendChild(f);let d=o.get(t.material),p=r.texture(d.image),g=i.createElement("Icon");g.appendChild(fn(i,"href",p)),s.appendChild(g);let m=d.color;c(m)&&s.appendChild(fn(i,"color",Sb(d.color))),n.push(s)}function Khe(e,t){let n=e.kmlDoc,i=e.valueGetter,o=e.externalFileHandler,r=n.createElement("Model"),s=i.get(t.scale);if(c(s)){let u=n.createElement("scale");u.appendChild(fn(n,"x",s)),u.appendChild(fn(n,"y",s)),u.appendChild(fn(n,"z",s)),r.appendChild(u)}let a=n.createElement("Link"),l=o.model(t,e.time);return a.appendChild(fn(n,"href",l)),r.appendChild(a),r}function LQe(e,t,n,i,o){let r=e.kmlDoc,s=e.ellipsoid,a=e.valueGetter;if(!c(n))return;let l=t.position;if(!l.isConstant){qhe(e,t,n,i,o);return}let u=Khe(e,n),f=r.createElement("altitudeMode");f.appendChild(wb(e,n.heightReference)),u.appendChild(f),a.get(l,void 0,gl),he.fromCartesian(gl,s,Oc);let d=r.createElement("Location");d.appendChild(fn(r,"longitude",R.toDegrees(Oc.longitude))),d.appendChild(fn(r,"latitude",R.toDegrees(Oc.latitude))),d.appendChild(fn(r,"altitude",Oc.height)),u.appendChild(d),i.push(u)}function Qj(e,t,n){let i=e.kmlDoc,o=e.valueGetter;if(!c(t))return;let r=o.get(t);if(!c(r))return;let s,a=o.getMaterialType(t),l,u;switch(a){case"Image":s=Sb(j.WHITE);break;case"Color":case"Grid":case"PolylineGlow":case"PolylineArrow":case"PolylineDash":s=Sb(r.color);break;case"PolylineOutline":s=Sb(r.color),l=Sb(r.outlineColor),u=r.outlineWidth,n.appendChild(fn(i,"outerColor",l,Id)),n.appendChild(fn(i,"outerWidth",u,Id));break;case"Stripe":s=Sb(r.oddColor);break}c(s)&&(n.appendChild(fn(i,"color",s)),n.appendChild(fn(i,"colorMode","normal")))}function wb(e,t){let n=e.kmlDoc,o=e.valueGetter.get(t,$e.NONE),r;switch(o){case $e.NONE:r=n.createTextNode("absolute");break;case $e.CLAMP_TO_GROUND:r=n.createTextNode("clampToGround");break;case $e.RELATIVE_TO_GROUND:r=n.createTextNode("relativeToGround");break}return r}function Eb(e,t){Array.isArray(e)||(e=[e]);let n=e.length,i=[];for(let o=0;o<n;++o)he.fromCartesian(e[o],t,Oc),i.push(`${R.toDegrees(Oc.longitude)},${R.toDegrees(Oc.latitude)},${Oc.height}`);return i.join(" ")}function fn(e,t,n,i){n=y(n,""),typeof n=="boolean"&&(n=n?"1":"0");let o=c(i)?e.createElementNS(i,t):e.createElement(t),r=n==="string"&&n.indexOf("<")!==-1?e.createCDATASection(n):e.createTextNode(n);return o.appendChild(r),o}function Sb(e){let t="",n=e.toBytes();for(let i=3;i>=0;--i)t+=n[i]<16?`0${n[i].toString(16)}`:n[i].toString(16);return t}var NQe=Jj;function oD(){this._cache={}}oD.prototype.fromColor=function(e,t){if(!c(e))throw new E("color is required");if(!c(t))throw new E("size is required");return RM(void 0,void 0,e,t,this._cache)};oD.prototype.fromUrl=function(e,t,n){if(!c(e))throw new E("url is required");if(!c(t))throw new E("color is required");if(!c(n))throw new E("size is required");return RM(e,void 0,t,n,this._cache)};oD.prototype.fromMakiIconId=function(e,t,n){if(!c(e))throw new E("id is required");if(!c(t))throw new E("color is required");if(!c(n))throw new E("size is required");return RM(sn(`Assets/Textures/maki/${encodeURIComponent(e)}.png`),void 0,t,n,this._cache)};oD.prototype.fromText=function(e,t,n){if(!c(e))throw new E("text is required");if(!c(t))throw new E("color is required");if(!c(n))throw new E("size is required");return RM(void 0,e,t,n,this._cache)};var FQe=new j;function BQe(e,t,n){e.save(),e.scale(n/24,n/24),e.fillStyle=t.toCssColorString(),e.strokeStyle=t.brighten(.6,FQe).toCssColorString(),e.lineWidth=.846,e.beginPath(),e.moveTo(6.72,.422),e.lineTo(17.28,.422),e.bezierCurveTo(18.553,.422,19.577,1.758,19.577,3.415),e.lineTo(19.577,10.973),e.bezierCurveTo(19.577,12.63,18.553,13.966,17.282,13.966),e.lineTo(14.386,14.008),e.lineTo(11.826,23.578),e.lineTo(9.614,14.008),e.lineTo(6.719,13.965),e.bezierCurveTo(5.446,13.983,4.422,12.629,4.422,10.972),e.lineTo(4.422,3.416),e.bezierCurveTo(4.423,1.76,5.447,.423,6.718,.423),e.closePath(),e.fill(),e.stroke(),e.restore()}function $he(e,t,n){let i=n/2.5,o=i,r=i;t.width>t.height?r=i*(t.height/t.width):t.width<t.height&&(o=i*(t.width/t.height));let s=Math.round((n-o)/2),a=Math.round(7/24*n-r/2);e.globalCompositeOperation="destination-out",e.drawImage(t,s-1,a,o,r),e.drawImage(t,s,a-1,o,r),e.drawImage(t,s+1,a,o,r),e.drawImage(t,s,a+1,o,r),e.globalCompositeOperation="destination-over",e.fillStyle=j.BLACK.toCssColorString(),e.fillRect(s-1,a-1,o+2,r+2),e.globalCompositeOperation="destination-out",e.drawImage(t,s,a,o,r),e.globalCompositeOperation="destination-over",e.fillStyle=j.WHITE.toCssColorString(),e.fillRect(s-1,a-2,o+2,r+2)}var iD=new Array(4);function RM(e,t,n,i,o){iD[0]=e,iD[1]=t,iD[2]=n,iD[3]=i;let r=JSON.stringify(iD),s=o[r];if(c(s))return s;let a=document.createElement("canvas");a.width=i,a.height=i;let l=a.getContext("2d");if(BQe(l,n,i),c(e)){let f=De.createIfNeeded(e).fetchImage().then(function(d){return $he(l,d,i),o[r]=a,a});return o[r]=f,f}else if(c(t)){let u=Sw(t,{font:`bold ${i}px sans-serif`});$he(l,u,i)}return o[r]=a,a}var vb=oD;function e9(e){return e}function MM(e){if(e==null)return e9;var t,n,i=e.scale[0],o=e.scale[1],r=e.translate[0],s=e.translate[1];return function(a,l){l||(t=n=0);var u=2,f=a.length,d=new Array(f);for(d[0]=(t+=a[0])*i+r,d[1]=(n+=a[1])*o+s;u<f;)d[u]=a[u],++u;return d}}function Zhe(e,t){for(var n,i=e.length,o=i-t;o<--i;)n=e[o],e[o++]=e[i],e[i]=n}function t9(e,t){return typeof t=="string"&&(t=e.objects[t]),t.type==="GeometryCollection"?{type:"FeatureCollection",features:t.geometries.map(function(n){return Jhe(e,n)})}:Jhe(e,t)}function Jhe(e,t){var n=t.id,i=t.bbox,o=t.properties==null?{}:t.properties,r=n9(e,t);return n==null&&i==null?{type:"Feature",properties:o,geometry:r}:i==null?{type:"Feature",id:n,properties:o,geometry:r}:{type:"Feature",id:n,bbox:i,properties:o,geometry:r}}function n9(e,t){var n=MM(e.transform),i=e.arcs;function o(f,d){d.length&&d.pop();for(var p=i[f<0?~f:f],g=0,m=p.length;g<m;++g)d.push(n(p[g],g));f<0&&Zhe(d,m)}function r(f){return n(f)}function s(f){for(var d=[],p=0,g=f.length;p<g;++p)o(f[p],d);return d.length<2&&d.push(d[0]),d}function a(f){for(var d=s(f);d.length<4;)d.push(d[0]);return d}function l(f){return f.map(a)}function u(f){var d=f.type,p;switch(d){case"GeometryCollection":return{type:d,geometries:f.geometries.map(u)};case"Point":p=r(f.coordinates);break;case"MultiPoint":p=f.coordinates.map(r);break;case"LineString":p=s(f.arcs);break;case"MultiLineString":p=f.arcs.map(s);break;case"Polygon":p=l(f.arcs);break;case"MultiPolygon":p=f.arcs.map(l);break;default:return null}return{type:d,coordinates:p}}return u(t)}function LM(e){return h.fromDegrees(e[0],e[1],e[2])}var i9={"urn:ogc:def:crs:OGC:1.3:CRS84":LM,"EPSG:4326":LM,"urn:ogc:def:crs:EPSG::4326":LM},Qhe={},eme={},o9=48,r9,s9=j.ROYALBLUE,a9=j.YELLOW,c9=2,l9=j.fromBytes(255,255,0,100),u9=!1,HQe={small:24,medium:48,large:64},GQe=["title","description","marker-size","marker-symbol","marker-color","stroke","stroke-opacity","stroke-width","fill","fill-opacity"];function tme(e,t){let n="";for(let i in e)if(e.hasOwnProperty(i)){if(i===t||GQe.indexOf(i)!==-1)continue;let o=e[i];c(o)&&(typeof o=="object"?n+=`<tr><th>${i}</th><td>${tme(o)}</td></tr>`:n+=`<tr><th>${i}</th><td>${o}</td></tr>`)}return n.length>0&&(n=`<table class="cesium-infoBox-defaultTable"><tbody>${n}</tbody></table>`),n}function jQe(e,t,n){let i;return function(o,r){return c(i)||(i=e(t,n)),i}}function WQe(e,t){return new Hm(jQe(tme,e,t),!0)}function NM(e,t,n){let i=e.id;if(!c(i)||e.type!=="Feature")i=Hn();else{let s=2,a=i;for(;c(t.getById(a));)a=`${i}_${s}`,s++;i=a}let o=t.getOrCreateEntity(i),r=e.properties;if(c(r)){o.properties=r;let s,a=r.title;if(c(a))o.name=a,s="title";else{let u=Number.MAX_VALUE;for(let f in r)if(r.hasOwnProperty(f)&&r[f]){let d=f.toLowerCase();if(u>1&&d==="title"){u=1,s=f;break}else u>2&&d==="name"?(u=2,s=f):u>3&&/title/i.test(f)?(u=3,s=f):u>4&&/name/i.test(f)&&(u=4,s=f)}c(s)&&(o.name=r[s])}let l=r.description;l!==null&&(o.description=c(l)?new Kn(l):n(r,s))}return o}function f9(e,t){let n=new Array(e.length);for(let i=0;i<e.length;i++)n[i]=t(e[i]);return n}var nme={Feature:ome,FeatureCollection:qQe,GeometryCollection:rme,LineString:ume,MultiLineString:fme,MultiPoint:cme,MultiPolygon:mme,Point:ame,Polygon:hme,Topology:pme},ime={GeometryCollection:rme,LineString:ume,MultiLineString:fme,MultiPoint:cme,MultiPolygon:mme,Point:ame,Polygon:hme,Topology:pme};function ome(e,t,n,i,o){if(t.geometry===null){NM(t,e._entityCollection,o.describe);return}if(!c(t.geometry))throw new ue("feature.geometry is required.");let r=t.geometry.type,s=ime[r];if(!c(s))throw new ue(`Unknown geometry type: ${r}`);s(e,t,t.geometry,i,o)}function qQe(e,t,n,i,o){let r=t.features;for(let s=0,a=r.length;s<a;s++)ome(e,r[s],void 0,i,o)}function rme(e,t,n,i,o){let r=n.geometries;for(let s=0,a=r.length;s<a;s++){let l=r[s],u=l.type,f=ime[u];if(!c(f))throw new ue(`Unknown geometry type: ${u}`);f(e,t,l,i,o)}}function sme(e,t,n,i,o){let r=o.markerSymbol,s=o.markerColor,a=o.markerSize,l=t.properties;if(c(l)){let g=l["marker-color"];c(g)&&(s=j.fromCssColorString(g)),a=y(HQe[l["marker-size"]],a);let m=l["marker-symbol"];c(m)&&(r=m)}let u;c(r)?r.length===1?u=e._pinBuilder.fromText(r.toUpperCase(),s,a):u=e._pinBuilder.fromMakiIconId(r,s,a):u=e._pinBuilder.fromColor(s,a);let f=new Wc;f.verticalOrigin=new Kn(Ln.BOTTOM),i.length===2&&o.clampToGround&&(f.heightReference=$e.CLAMP_TO_GROUND);let d=NM(t,e._entityCollection,o.describe);d.billboard=f,d.position=new Qc(n(i));let p=Promise.resolve(u).then(function(g){f.image=new Kn(g)}).catch(function(){f.image=new Kn(e._pinBuilder.fromColor(s,a))});e._promises.push(p)}function ame(e,t,n,i,o){sme(e,t,i,n.coordinates,o)}function cme(e,t,n,i,o){let r=n.coordinates;for(let s=0;s<r.length;s++)sme(e,t,i,r[s],o)}function lme(e,t,n,i,o){let r=o.strokeMaterialProperty,s=o.strokeWidthProperty,a=t.properties;if(c(a)){let f=a["stroke-width"];c(f)&&(s=new Kn(f));let d,p=a.stroke;c(p)&&(d=j.fromCssColorString(p));let g=a["stroke-opacity"];c(g)&&g!==1&&(c(d)||(d=r.color.getValue().clone()),d.alpha=g),c(d)&&(r=new Ht(d))}let l=NM(t,e._entityCollection,o.describe),u=new el;l.polyline=u,u.clampToGround=o.clampToGround,u.material=r,u.width=s,u.positions=new Kn(f9(i,n)),u.arcType=Yt.RHUMB}function ume(e,t,n,i,o){lme(e,t,i,n.coordinates,o)}function fme(e,t,n,i,o){let r=n.coordinates;for(let s=0;s<r.length;s++)lme(e,t,i,r[s],o)}function dme(e,t,n,i,o){if(i.length===0||i[0].length===0)return;let r=o.strokeMaterialProperty.color,s=o.fillMaterialProperty,a=o.strokeWidthProperty,l=t.properties;if(c(l)){let g=l["stroke-width"];c(g)&&(a=new Kn(g));let m,b=l.stroke;c(b)&&(m=j.fromCssColorString(b));let x=l["stroke-opacity"];c(x)&&x!==1&&(c(m)||(m=r.getValue().clone()),m.alpha=x),c(m)&&(r=new Kn(m));let T,C=l.fill,S=s.color.getValue();c(C)&&(T=j.fromCssColorString(C),T.alpha=S.alpha),x=l["fill-opacity"],c(x)&&x!==S.alpha&&(c(T)||(T=S.clone()),T.alpha=x),c(T)&&(s=new Ht(T))}let u=new Um;u.outline=new Kn(!0),u.outlineColor=r,u.outlineWidth=a,u.material=s,u.arcType=Yt.RHUMB;let f=[];for(let g=1,m=i.length;g<m;g++)f.push(new _c(f9(i[g],n)));let d=i[0];u.hierarchy=new Kn(new _c(f9(d,n),f)),d[0].length>2?u.perPositionHeight=new Kn(!0):o.clampToGround||(u.height=0);let p=NM(t,e._entityCollection,o.describe);p.polygon=u}function hme(e,t,n,i,o){dme(e,t,i,n.coordinates,o)}function mme(e,t,n,i,o){let r=n.coordinates;for(let s=0;s<r.length;s++)dme(e,t,i,r[s],o)}function pme(e,t,n,i,o){for(let r in n.objects)if(n.objects.hasOwnProperty(r)){let s=t9(n,n.objects[r]),a=nme[s.type];a(e,s,s,i,o)}}function Ug(e){this._name=e,this._changed=new pe,this._error=new pe,this._isLoading=!1,this._loading=new pe,this._entityCollection=new _a(this),this._promises=[],this._pinBuilder=new vb,this._entityCluster=new _d,this._credit=void 0,this._resourceCredits=[]}Ug.load=function(e,t){return new Ug().load(e,t)};Object.defineProperties(Ug,{markerSize:{get:function(){return o9},set:function(e){o9=e}},markerSymbol:{get:function(){return r9},set:function(e){r9=e}},markerColor:{get:function(){return s9},set:function(e){s9=e}},stroke:{get:function(){return a9},set:function(e){a9=e}},strokeWidth:{get:function(){return c9},set:function(e){c9=e}},fill:{get:function(){return l9},set:function(e){l9=e}},clampToGround:{get:function(){return u9},set:function(e){u9=e}},crsNames:{get:function(){return i9}},crsLinkHrefs:{get:function(){return Qhe}},crsLinkTypes:{get:function(){return eme}}});Object.defineProperties(Ug.prototype,{name:{get:function(){return this._name},set:function(e){this._name!==e&&(this._name=e,this._changed.raiseEvent(this))}},clock:{value:void 0,writable:!1},entities:{get:function(){return this._entityCollection}},isLoading:{get:function(){return this._isLoading}},changedEvent:{get:function(){return this._changed}},errorEvent:{get:function(){return this._error}},loadingEvent:{get:function(){return this._loading}},show:{get:function(){return this._entityCollection.show},set:function(e){this._entityCollection.show=e}},clustering:{get:function(){return this._entityCluster},set:function(e){if(!c(e))throw new E("value must be defined.");this._entityCluster=e}},credit:{get:function(){return this._credit}}});Ug.prototype.load=function(e,t){return _me(this,e,t,!0)};Ug.prototype.process=function(e,t){return _me(this,e,t,!1)};function _me(e,t,n,i){if(!c(t))throw new E("data is required.");ns.setLoading(e,!0),n=y(n,y.EMPTY_OBJECT);let o=n.credit;typeof o=="string"&&(o=new Pt(o)),e._credit=o;let r=t,s=n.sourceUri;if(typeof t=="string"||t instanceof De){t=De.createIfNeeded(t),r=t.fetchJson(),s=y(s,t.getUrlComponent());let a=e._resourceCredits,l=t.credits;if(c(l)){let u=l.length;for(let f=0;f<u;f++)a.push(l[f])}}return n={describe:y(n.describe,WQe),markerSize:y(n.markerSize,o9),markerSymbol:y(n.markerSymbol,r9),markerColor:y(n.markerColor,s9),strokeWidthProperty:new Kn(y(n.strokeWidth,c9)),strokeMaterialProperty:new Ht(y(n.stroke,a9)),fillMaterialProperty:new Ht(y(n.fill,l9)),clampToGround:y(n.clampToGround,u9)},Promise.resolve(r).then(function(a){return YQe(e,a,n,s,i)}).catch(function(a){throw ns.setLoading(e,!1),e._error.raiseEvent(e,a),a})}Ug.prototype.update=function(e){return!0};function YQe(e,t,n,i,o){let r;c(i)&&(r=Q0(i)),c(r)&&e._name!==r&&(e._name=r,e._changed.raiseEvent(e));let s=nme[t.type];if(!c(s))throw new ue(`Unsupported GeoJSON object type: ${t.type}`);let a=t.crs,l=a!==null?LM:null;if(c(a)){if(!c(a.properties))throw new ue("crs.properties is undefined.");let u=a.properties;if(a.type==="name"){if(l=i9[u.name],!c(l))throw new ue(`Unknown crs name: ${u.name}`)}else if(a.type==="link"){let f=Qhe[u.href];if(c(f)||(f=eme[u.type]),!c(f))throw new ue(`Unable to resolve crs link: ${JSON.stringify(u)}`);l=f(u)}else if(a.type==="EPSG"){if(l=i9[`EPSG:${u.code}`],!c(l))throw new ue(`Unknown crs EPSG code: ${u.code}`)}else throw new ue(`Unknown crs type: ${a.type}`)}return Promise.resolve(l).then(function(u){return o&&e._entityCollection.removeAll(),u!==null&&s(e,t,t,u,n),Promise.all(e._promises).then(function(){return e._promises.length=0,ns.setLoading(e,!1),e})})}var FM=Ug;function XQe(e){if(typeof e=="string"){let t=document.getElementById(e);if(t===null)throw new E(`Element with id "${e}" does not exist in the document.`);e=t}return e}var On=XQe;var gme="4.0.0";function KQe(e){return e===void 0}function iu(e){return typeof e=="boolean"}function yme(e,t){for(var n in t)t.hasOwnProperty(n)&&KQe(e[n])&&(e[n]=t[n]);return e}function bme(e,t,n){var i;return e.length>t&&(n==null?(n="&hellip;",i=3):i=n.length,e=e.substring(0,t-i)+n),e}function Lo(e,t){for(var n=e.length-1;n>=0;n--)e[n]===t&&e.splice(n,1)}function zg(e,t){for(var n=e.length-1;n>=0;n--)t(e[n])===!0&&e.splice(n,1)}function Hg(e){throw new Error("Unhandled case for value: '".concat(e,"'"))}var Gg=/[A-Za-z]/,Bs=/[\d]/;var ou=/\s/,BM=/['"]/,xme=/[\x00-\x1F\x7F]/,Tme=/A-Za-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16F1-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC/.source,$Qe=/\u2700-\u27bf\udde6-\uddff\ud800-\udbff\udc00-\udfff\ufe0e\ufe0f\u0300-\u036f\ufe20-\ufe23\u20d0-\u20f0\ud83c\udffb-\udfff\u200d\u3299\u3297\u303d\u3030\u24c2\ud83c\udd70-\udd71\udd7e-\udd7f\udd8e\udd91-\udd9a\udde6-\uddff\ude01-\ude02\ude1a\ude2f\ude32-\ude3a\ude50-\ude51\u203c\u2049\u25aa-\u25ab\u25b6\u25c0\u25fb-\u25fe\u00a9\u00ae\u2122\u2139\udc04\u2600-\u26FF\u2b05\u2b06\u2b07\u2b1b\u2b1c\u2b50\u2b55\u231a\u231b\u2328\u23cf\u23e9-\u23f3\u23f8-\u23fa\udccf\u2935\u2934\u2190-\u21ff/.source,ZQe=/\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D4-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B62\u0B63\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0C00-\u0C03\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0D01-\u0D03\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D82\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EB9\u0EBB\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F\u109A-\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u180B-\u180D\u1885\u1886\u18A9\u1920-\u192B\u1930-\u193B\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F\u1AB0-\u1ABE\u1B00-\u1B04\u1B34-\u1B44\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BE6-\u1BF3\u1C24-\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF2-\u1CF4\u1CF8\u1CF9\u1DC0-\u1DF5\u1DFB-\u1DFF\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA880\uA881\uA8B4-\uA8C5\uA8E0-\uA8F1\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9E5\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F/.source,JQe=Tme+$Qe+ZQe,Ame=/0-9\u0660-\u0669\u06F0-\u06F9\u07C0-\u07C9\u0966-\u096F\u09E6-\u09EF\u0A66-\u0A6F\u0AE6-\u0AEF\u0B66-\u0B6F\u0BE6-\u0BEF\u0C66-\u0C6F\u0CE6-\u0CEF\u0D66-\u0D6F\u0DE6-\u0DEF\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F29\u1040-\u1049\u1090-\u1099\u17E0-\u17E9\u1810-\u1819\u1946-\u194F\u19D0-\u19D9\u1A80-\u1A89\u1A90-\u1A99\u1B50-\u1B59\u1BB0-\u1BB9\u1C40-\u1C49\u1C50-\u1C59\uA620-\uA629\uA8D0-\uA8D9\uA900-\uA909\uA9D0-\uA9D9\uA9F0-\uA9F9\uAA50-\uAA59\uABF0-\uABF9\uFF10-\uFF19/.source,Ssi=new RegExp("[".concat(Tme+Ame,"]")),d9=JQe+Ame,Od=new RegExp("[".concat(d9,"]"));var kM=function(){function e(t){t===void 0&&(t={}),this.tagName="",this.attrs={},this.innerHTML="",this.tagName=t.tagName||"",this.attrs=t.attrs||{},this.innerHTML=t.innerHtml||t.innerHTML||""}return e.prototype.setTagName=function(t){return this.tagName=t,this},e.prototype.getTagName=function(){return this.tagName||""},e.prototype.setAttr=function(t,n){var i=this.getAttrs();return i[t]=n,this},e.prototype.getAttr=function(t){return this.getAttrs()[t]},e.prototype.setAttrs=function(t){return Object.assign(this.getAttrs(),t),this},e.prototype.getAttrs=function(){return this.attrs||(this.attrs={})},e.prototype.setClass=function(t){return this.setAttr("class",t)},e.prototype.addClass=function(t){for(var n=this.getClass(),i=n?n.split(ou):[],o=t.split(ou),r;r=o.shift();)i.indexOf(r)===-1&&i.push(r);return this.getAttrs().class=i.join(" "),this},e.prototype.removeClass=function(t){for(var n=this.getClass(),i=n?n.split(ou):[],o=t.split(ou),r;i.length&&(r=o.shift());){var s=i.indexOf(r);s!==-1&&i.splice(s,1)}return this.getAttrs().class=i.join(" "),this},e.prototype.getClass=function(){return this.getAttrs().class||""},e.prototype.hasClass=function(t){return(" "+this.getClass()+" ").indexOf(" "+t+" ")!==-1},e.prototype.setInnerHTML=function(t){return this.innerHTML=t,this},e.prototype.setInnerHtml=function(t){return this.setInnerHTML(t)},e.prototype.getInnerHTML=function(){return this.innerHTML||""},e.prototype.getInnerHtml=function(){return this.getInnerHTML()},e.prototype.toAnchorString=function(){var t=this.getTagName(),n=this.buildAttrsStr();return n=n?" "+n:"",["<",t,n,">",this.getInnerHtml(),"</",t,">"].join("")},e.prototype.buildAttrsStr=function(){if(!this.attrs)return"";var t=this.getAttrs(),n=[];for(var i in t)t.hasOwnProperty(i)&&n.push(i+'="'+t[i]+'"');return n.join(" ")},e}();function Cme(e,t,n){var i,o;n==null?(n="&hellip;",o=3,i=8):(o=n.length,i=n.length);var r=function(C){var S={},v=C,D=v.match(/^([a-z]+):\/\//i);return D&&(S.scheme=D[1],v=v.substr(D[0].length)),D=v.match(/^(.*?)(?=(\?|#|\/|$))/i),D&&(S.host=D[1],v=v.substr(D[0].length)),D=v.match(/^\/(.*?)(?=(\?|#|$))/i),D&&(S.path=D[1],v=v.substr(D[0].length)),D=v.match(/^\?(.*?)(?=(#|$))/i),D&&(S.query=D[1],v=v.substr(D[0].length)),D=v.match(/^#(.*?)$/i),D&&(S.fragment=D[1]),S},s=function(C){var S="";return C.scheme&&C.host&&(S+=C.scheme+"://"),C.host&&(S+=C.host),C.path&&(S+="/"+C.path),C.query&&(S+="?"+C.query),C.fragment&&(S+="#"+C.fragment),S},a=function(C,S){var v=S/2,D=Math.ceil(v),I=-1*Math.floor(v),L="";return I<0&&(L=C.substr(I)),C.substr(0,D)+n+L};if(e.length<=t)return e;var l=t-o,u=r(e);if(u.query){var f=u.query.match(/^(.*?)(?=(\?|\#))(.*?)$/i);f&&(u.query=u.query.substr(0,f[1].length),e=s(u))}if(e.length<=t||(u.host&&(u.host=u.host.replace(/^www\./,""),e=s(u)),e.length<=t))return e;var d="";if(u.host&&(d+=u.host),d.length>=l)return u.host.length==t?(u.host.substr(0,t-o)+n).substr(0,l+i):a(d,l).substr(0,l+i);var p="";if(u.path&&(p+="/"+u.path),u.query&&(p+="?"+u.query),p)if((d+p).length>=l){if((d+p).length==t)return(d+p).substr(0,t);var g=l-d.length;return(d+a(p,g)).substr(0,l+i)}else d+=p;if(u.fragment){var m="#"+u.fragment;if((d+m).length>=l){if((d+m).length==t)return(d+m).substr(0,t);var b=l-d.length;return(d+a(m,b)).substr(0,l+i)}else d+=m}if(u.scheme&&u.host){var x=u.scheme+"://";if((d+x).length<l)return(x+d).substr(0,t)}if(d.length<=t)return d;var T="";return l>0&&(T=d.substr(-1*Math.floor(l/2))),(d.substr(0,Math.ceil(l/2))+n+T).substr(0,l+i)}function Eme(e,t,n){if(e.length<=t)return e;var i,o;n==null?(n="&hellip;",i=8,o=3):(i=n.length,o=n.length);var r=t-o,s="";return r>0&&(s=e.substr(-1*Math.floor(r/2))),(e.substr(0,Math.ceil(r/2))+n+s).substr(0,r+i)}function Sme(e,t,n){return bme(e,t,n)}var wme=function(){function e(t){t===void 0&&(t={}),this.newWindow=!1,this.truncate={},this.className="",this.newWindow=t.newWindow||!1,this.truncate=t.truncate||{},this.className=t.className||""}return e.prototype.build=function(t){return new kM({tagName:"a",attrs:this.createAttrs(t),innerHtml:this.processAnchorText(t.getAnchorText())})},e.prototype.createAttrs=function(t){var n={href:t.getAnchorHref()},i=this.createCssClass(t);return i&&(n.class=i),this.newWindow&&(n.target="_blank",n.rel="noopener noreferrer"),this.truncate&&this.truncate.length&&this.truncate.length<t.getAnchorText().length&&(n.title=t.getAnchorHref()),n},e.prototype.createCssClass=function(t){var n=this.className;if(n){for(var i=[n],o=t.getCssClassSuffixes(),r=0,s=o.length;r<s;r++)i.push(n+"-"+o[r]);return i.join(" ")}else return""},e.prototype.processAnchorText=function(t){return t=this.doTruncate(t),t},e.prototype.doTruncate=function(t){var n=this.truncate;if(!n||!n.length)return t;var i=n.length,o=n.location;return o==="smart"?Cme(t,i):o==="middle"?Eme(t,i):Sme(t,i)},e}();var h9=function(e,t){return h9=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},h9(e,t)};function Yh(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");h9(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}var ks=function(){return ks=Object.assign||function(t){for(var n,i=1,o=arguments.length;i<o;i++){n=arguments[i];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},ks.apply(this,arguments)};var Xh=function(){function e(t){this._=null,this.matchedText="",this.offset=0,this.tagBuilder=t.tagBuilder,this.matchedText=t.matchedText,this.offset=t.offset}return e.prototype.getMatchedText=function(){return this.matchedText},e.prototype.setOffset=function(t){this.offset=t},e.prototype.getOffset=function(){return this.offset},e.prototype.getCssClassSuffixes=function(){return[this.type]},e.prototype.buildTag=function(){return this.tagBuilder.build(this)},e}();var QQe="(?:xn--vermgensberatung-pwb|xn--vermgensberater-ctb|xn--clchc0ea0b2g2a9gcd|xn--w4r85el8fhu5dnra|northwesternmutual|travelersinsurance|verm\xF6gensberatung|xn--5su34j936bgsg|xn--bck1b9a5dre4c|xn--mgbah1a3hjkrd|xn--mgbai9azgqp6j|xn--mgberp4a5d4ar|xn--xkc2dl3a5ee0h|verm\xF6gensberater|xn--fzys8d69uvgm|xn--mgba7c0bbn0a|xn--mgbcpq6gpa1a|xn--xkc2al3hye2a|americanexpress|kerryproperties|sandvikcoromant|xn--i1b6b1a6a2e|xn--kcrx77d1x4a|xn--lgbbat1ad8j|xn--mgba3a4f16a|xn--mgbaakc7dvf|xn--mgbc0a9azcg|xn--nqv7fs00ema|americanfamily|bananarepublic|cancerresearch|cookingchannel|kerrylogistics|weatherchannel|xn--54b7fta0cc|xn--6qq986b3xl|xn--80aqecdr1a|xn--b4w605ferd|xn--fiq228c5hs|xn--h2breg3eve|xn--jlq480n2rg|xn--jlq61u9w7b|xn--mgba3a3ejt|xn--mgbaam7a8h|xn--mgbayh7gpa|xn--mgbbh1a71e|xn--mgbca7dzdo|xn--mgbi4ecexp|xn--mgbx4cd0ab|xn--rvc1e0am3e|international|lifeinsurance|travelchannel|wolterskluwer|xn--cckwcxetd|xn--eckvdtc9d|xn--fpcrj9c3d|xn--fzc2c9e2c|xn--h2brj9c8c|xn--tiq49xqyj|xn--yfro4i67o|xn--ygbi2ammx|construction|lplfinancial|scholarships|versicherung|xn--3e0b707e|xn--45br5cyl|xn--4dbrk0ce|xn--80adxhks|xn--80asehdb|xn--8y0a063a|xn--gckr3f0f|xn--mgb9awbf|xn--mgbab2bd|xn--mgbgu82a|xn--mgbpl2fh|xn--mgbt3dhd|xn--mk1bu44c|xn--ngbc5azd|xn--ngbe9e0a|xn--ogbpf8fl|xn--qcka1pmc|accountants|barclaycard|blackfriday|blockbuster|bridgestone|calvinklein|contractors|creditunion|engineering|enterprises|foodnetwork|investments|kerryhotels|lamborghini|motorcycles|olayangroup|photography|playstation|productions|progressive|redumbrella|williamhill|xn--11b4c3d|xn--1ck2e1b|xn--1qqw23a|xn--2scrj9c|xn--3bst00m|xn--3ds443g|xn--3hcrj9c|xn--42c2d9a|xn--45brj9c|xn--55qw42g|xn--6frz82g|xn--80ao21a|xn--9krt00a|xn--cck2b3b|xn--czr694b|xn--d1acj3b|xn--efvy88h|xn--fct429k|xn--fjq720a|xn--flw351e|xn--g2xx48c|xn--gecrj9c|xn--gk3at1e|xn--h2brj9c|xn--hxt814e|xn--imr513n|xn--j6w193g|xn--jvr189m|xn--kprw13d|xn--kpry57d|xn--mgbbh1a|xn--mgbtx2b|xn--mix891f|xn--nyqy26a|xn--otu796d|xn--pgbs0dh|xn--q9jyb4c|xn--rhqv96g|xn--rovu88b|xn--s9brj9c|xn--ses554g|xn--t60b56a|xn--vuq861b|xn--w4rs40l|xn--xhq521b|xn--zfr164b|\u0B9A\u0BBF\u0B99\u0BCD\u0B95\u0BAA\u0BCD\u0BAA\u0BC2\u0BB0\u0BCD|accountant|apartments|associates|basketball|bnpparibas|boehringer|capitalone|consulting|creditcard|cuisinella|eurovision|extraspace|foundation|healthcare|immobilien|industries|management|mitsubishi|nextdirect|properties|protection|prudential|realestate|republican|restaurant|schaeffler|tatamotors|technology|university|vlaanderen|volkswagen|xn--30rr7y|xn--3pxu8k|xn--45q11c|xn--4gbrim|xn--55qx5d|xn--5tzm5g|xn--80aswg|xn--90a3ac|xn--9dbq2a|xn--9et52u|xn--c2br7g|xn--cg4bki|xn--czrs0t|xn--czru2d|xn--fiq64b|xn--fiqs8s|xn--fiqz9s|xn--io0a7i|xn--kput3i|xn--mxtq1m|xn--o3cw4h|xn--pssy2u|xn--q7ce6a|xn--unup4y|xn--wgbh1c|xn--wgbl6a|xn--y9a3aq|accenture|alfaromeo|allfinanz|amsterdam|analytics|aquarelle|barcelona|bloomberg|christmas|community|directory|education|equipment|fairwinds|financial|firestone|fresenius|frontdoor|furniture|goldpoint|hisamitsu|homedepot|homegoods|homesense|institute|insurance|kuokgroup|lancaster|landrover|lifestyle|marketing|marshalls|melbourne|microsoft|panasonic|passagens|pramerica|richardli|shangrila|solutions|statebank|statefarm|stockholm|travelers|vacations|xn--90ais|xn--c1avg|xn--d1alf|xn--e1a4c|xn--fhbei|xn--j1aef|xn--j1amh|xn--l1acc|xn--ngbrx|xn--nqv7f|xn--p1acf|xn--qxa6a|xn--tckwe|xn--vhquv|yodobashi|\u0645\u0648\u0631\u064A\u062A\u0627\u0646\u064A\u0627|abudhabi|airforce|allstate|attorney|barclays|barefoot|bargains|baseball|boutique|bradesco|broadway|brussels|builders|business|capetown|catering|catholic|cipriani|cityeats|cleaning|clinique|clothing|commbank|computer|delivery|deloitte|democrat|diamonds|discount|discover|download|engineer|ericsson|etisalat|exchange|feedback|fidelity|firmdale|football|frontier|goodyear|grainger|graphics|guardian|hdfcbank|helsinki|holdings|hospital|infiniti|ipiranga|istanbul|jpmorgan|lighting|lundbeck|marriott|maserati|mckinsey|memorial|merckmsd|mortgage|observer|partners|pharmacy|pictures|plumbing|property|redstone|reliance|saarland|samsclub|security|services|shopping|showtime|softbank|software|stcgroup|supplies|training|vanguard|ventures|verisign|woodside|xn--90ae|xn--node|xn--p1ai|xn--qxam|yokohama|\u0627\u0644\u0633\u0639\u0648\u062F\u064A\u0629|abogado|academy|agakhan|alibaba|android|athleta|auction|audible|auspost|avianca|banamex|bauhaus|bentley|bestbuy|booking|brother|bugatti|capital|caravan|careers|channel|charity|chintai|citadel|clubmed|college|cologne|comcast|company|compare|contact|cooking|corsica|country|coupons|courses|cricket|cruises|dentist|digital|domains|exposed|express|farmers|fashion|ferrari|ferrero|finance|fishing|fitness|flights|florist|flowers|forsale|frogans|fujitsu|gallery|genting|godaddy|grocery|guitars|hamburg|hangout|hitachi|holiday|hosting|hoteles|hotmail|hyundai|ismaili|jewelry|juniper|kitchen|komatsu|lacaixa|lanxess|lasalle|latrobe|leclerc|limited|lincoln|markets|monster|netbank|netflix|network|neustar|okinawa|oldnavy|organic|origins|philips|pioneer|politie|realtor|recipes|rentals|reviews|rexroth|samsung|sandvik|schmidt|schwarz|science|shiksha|singles|staples|storage|support|surgery|systems|temasek|theater|theatre|tickets|tiffany|toshiba|trading|walmart|wanggou|watches|weather|website|wedding|whoswho|windows|winners|xfinity|yamaxun|youtube|zuerich|\u043A\u0430\u0442\u043E\u043B\u0438\u043A|\u0627\u062A\u0635\u0627\u0644\u0627\u062A|\u0627\u0644\u0628\u062D\u0631\u064A\u0646|\u0627\u0644\u062C\u0632\u0627\u0626\u0631|\u0627\u0644\u0639\u0644\u064A\u0627\u0646|\u067E\u0627\u06A9\u0633\u062A\u0627\u0646|\u0643\u0627\u062B\u0648\u0644\u064A\u0643|\u0B87\u0BA8\u0BCD\u0BA4\u0BBF\u0BAF\u0BBE|abarth|abbott|abbvie|africa|agency|airbus|airtel|alipay|alsace|alstom|amazon|anquan|aramco|author|bayern|beauty|berlin|bharti|bostik|boston|broker|camera|career|casino|center|chanel|chrome|church|circle|claims|clinic|coffee|comsec|condos|coupon|credit|cruise|dating|datsun|dealer|degree|dental|design|direct|doctor|dunlop|dupont|durban|emerck|energy|estate|events|expert|family|flickr|futbol|gallup|garden|george|giving|global|google|gratis|health|hermes|hiphop|hockey|hotels|hughes|imamat|insure|intuit|jaguar|joburg|juegos|kaufen|kinder|kindle|kosher|lancia|latino|lawyer|lefrak|living|locker|london|luxury|madrid|maison|makeup|market|mattel|mobile|monash|mormon|moscow|museum|mutual|nagoya|natura|nissan|nissay|norton|nowruz|office|olayan|online|oracle|orange|otsuka|pfizer|photos|physio|pictet|quebec|racing|realty|reisen|repair|report|review|rocher|rogers|ryukyu|safety|sakura|sanofi|school|schule|search|secure|select|shouji|soccer|social|stream|studio|supply|suzuki|swatch|sydney|taipei|taobao|target|tattoo|tennis|tienda|tjmaxx|tkmaxx|toyota|travel|unicom|viajes|viking|villas|virgin|vision|voting|voyage|vuelos|walter|webcam|xihuan|yachts|yandex|zappos|\u043C\u043E\u0441\u043A\u0432\u0430|\u043E\u043D\u043B\u0430\u0439\u043D|\u0627\u0628\u0648\u0638\u0628\u064A|\u0627\u0631\u0627\u0645\u0643\u0648|\u0627\u0644\u0627\u0631\u062F\u0646|\u0627\u0644\u0645\u063A\u0631\u0628|\u0627\u0645\u0627\u0631\u0627\u062A|\u0641\u0644\u0633\u0637\u064A\u0646|\u0645\u0644\u064A\u0633\u064A\u0627|\u092D\u093E\u0930\u0924\u092E\u094D|\u0B87\u0BB2\u0B99\u0BCD\u0B95\u0BC8|\u30D5\u30A1\u30C3\u30B7\u30E7\u30F3|actor|adult|aetna|amfam|amica|apple|archi|audio|autos|azure|baidu|beats|bible|bingo|black|boats|bosch|build|canon|cards|chase|cheap|cisco|citic|click|cloud|coach|codes|crown|cymru|dabur|dance|deals|delta|drive|dubai|earth|edeka|email|epson|faith|fedex|final|forex|forum|gallo|games|gifts|gives|glass|globo|gmail|green|gripe|group|gucci|guide|homes|honda|horse|house|hyatt|ikano|irish|jetzt|koeln|kyoto|lamer|lease|legal|lexus|lilly|linde|lipsy|loans|locus|lotte|lotto|macys|mango|media|miami|money|movie|music|nexus|nikon|ninja|nokia|nowtv|omega|osaka|paris|parts|party|phone|photo|pizza|place|poker|praxi|press|prime|promo|quest|radio|rehab|reise|ricoh|rocks|rodeo|rugby|salon|sener|seven|sharp|shell|shoes|skype|sling|smart|smile|solar|space|sport|stada|store|study|style|sucks|swiss|tatar|tires|tirol|tmall|today|tokyo|tools|toray|total|tours|trade|trust|tunes|tushu|ubank|vegas|video|vodka|volvo|wales|watch|weber|weibo|works|world|xerox|yahoo|\u05D9\u05E9\u05E8\u05D0\u05DC|\u0627\u06CC\u0631\u0627\u0646|\u0628\u0627\u0632\u0627\u0631|\u0628\u06BE\u0627\u0631\u062A|\u0633\u0648\u062F\u0627\u0646|\u0633\u0648\u0631\u064A\u0629|\u0647\u0645\u0631\u0627\u0647|\u092D\u093E\u0930\u094B\u0924|\u0938\u0902\u0917\u0920\u0928|\u09AC\u09BE\u0982\u09B2\u09BE|\u0C2D\u0C3E\u0C30\u0C24\u0C4D|\u0D2D\u0D3E\u0D30\u0D24\u0D02|\u5609\u91CC\u5927\u9152\u5E97|aarp|able|adac|aero|akdn|ally|amex|arab|army|arpa|arte|asda|asia|audi|auto|baby|band|bank|bbva|beer|best|bike|bing|blog|blue|bofa|bond|book|buzz|cafe|call|camp|care|cars|casa|case|cash|cbre|cern|chat|citi|city|club|cool|coop|cyou|data|date|dclk|deal|dell|desi|diet|dish|docs|dvag|erni|fage|fail|fans|farm|fast|fiat|fido|film|fire|fish|flir|food|ford|free|fund|game|gbiz|gent|ggee|gift|gmbh|gold|golf|goog|guge|guru|hair|haus|hdfc|help|here|hgtv|host|hsbc|icbc|ieee|imdb|immo|info|itau|java|jeep|jobs|jprs|kddi|kids|kiwi|kpmg|kred|land|lego|lgbt|lidl|life|like|limo|link|live|loan|loft|love|ltda|luxe|maif|meet|meme|menu|mini|mint|mobi|moda|moto|name|navy|news|next|nico|nike|ollo|open|page|pars|pccw|pics|ping|pink|play|plus|pohl|porn|post|prod|prof|qpon|read|reit|rent|rest|rich|room|rsvp|ruhr|safe|sale|sarl|save|saxo|scot|seat|seek|sexy|shaw|shia|shop|show|silk|sina|site|skin|sncf|sohu|song|sony|spot|star|surf|talk|taxi|team|tech|teva|tiaa|tips|town|toys|tube|vana|visa|viva|vivo|vote|voto|wang|weir|wien|wiki|wine|work|xbox|yoga|zara|zero|zone|\u0434\u0435\u0442\u0438|\u0441\u0430\u0439\u0442|\u0628\u0627\u0631\u062A|\u0628\u064A\u062A\u0643|\u0680\u0627\u0631\u062A|\u062A\u0648\u0646\u0633|\u0634\u0628\u0643\u0629|\u0639\u0631\u0627\u0642|\u0639\u0645\u0627\u0646|\u0645\u0648\u0642\u0639|\u092D\u093E\u0930\u0924|\u09AD\u09BE\u09B0\u09A4|\u09AD\u09BE\u09F0\u09A4|\u0A2D\u0A3E\u0A30\u0A24|\u0AAD\u0ABE\u0AB0\u0AA4|\u0B2D\u0B3E\u0B30\u0B24|\u0CAD\u0CBE\u0CB0\u0CA4|\u0DBD\u0D82\u0D9A\u0DCF|\u30A2\u30DE\u30BE\u30F3|\u30B0\u30FC\u30B0\u30EB|\u30AF\u30E9\u30A6\u30C9|\u30DD\u30A4\u30F3\u30C8|\u7EC4\u7EC7\u673A\u6784|\u96FB\u8A0A\u76C8\u79D1|\u9999\u683C\u91CC\u62C9|aaa|abb|abc|aco|ads|aeg|afl|aig|anz|aol|app|art|aws|axa|bar|bbc|bbt|bcg|bcn|bet|bid|bio|biz|bms|bmw|bom|boo|bot|box|buy|bzh|cab|cal|cam|car|cat|cba|cbn|cbs|ceo|cfa|cfd|com|cpa|crs|dad|day|dds|dev|dhl|diy|dnp|dog|dot|dtv|dvr|eat|eco|edu|esq|eus|fan|fit|fly|foo|fox|frl|ftr|fun|fyi|gal|gap|gay|gdn|gea|gle|gmo|gmx|goo|gop|got|gov|hbo|hiv|hkt|hot|how|ibm|ice|icu|ifm|inc|ing|ink|int|ist|itv|jcb|jio|jll|jmp|jnj|jot|joy|kfh|kia|kim|kpn|krd|lat|law|lds|llc|llp|lol|lpl|ltd|man|map|mba|med|men|mil|mit|mlb|mls|mma|moe|moi|mom|mov|msd|mtn|mtr|nab|nba|nec|net|new|nfl|ngo|nhk|now|nra|nrw|ntt|nyc|obi|one|ong|onl|ooo|org|ott|ovh|pay|pet|phd|pid|pin|pnc|pro|pru|pub|pwc|red|ren|ril|rio|rip|run|rwe|sap|sas|sbi|sbs|sca|scb|ses|sew|sex|sfr|ski|sky|soy|spa|srl|stc|tab|tax|tci|tdk|tel|thd|tjx|top|trv|tui|tvs|ubs|uno|uol|ups|vet|vig|vin|vip|wed|win|wme|wow|wtc|wtf|xin|xxx|xyz|you|yun|zip|\u0431\u0435\u043B|\u043A\u043E\u043C|\u049B\u0430\u0437|\u043C\u043A\u0434|\u043C\u043E\u043D|\u043E\u0440\u0433|\u0440\u0443\u0441|\u0441\u0440\u0431|\u0443\u043A\u0440|\u0570\u0561\u0575|\u05E7\u05D5\u05DD|\u0639\u0631\u0628|\u0642\u0637\u0631|\u0643\u0648\u0645|\u0645\u0635\u0631|\u0915\u0949\u092E|\u0928\u0947\u091F|\u0E04\u0E2D\u0E21|\u0E44\u0E17\u0E22|\u0EA5\u0EB2\u0EA7|\u30B9\u30C8\u30A2|\u30BB\u30FC\u30EB|\u307F\u3093\u306A|\u4E2D\u6587\u7F51|\u4E9A\u9A6C\u900A|\u5929\u4E3B\u6559|\u6211\u7231\u4F60|\u65B0\u52A0\u5761|\u6DE1\u9A6C\u9521|\u8BFA\u57FA\u4E9A|\u98DE\u5229\u6D66|ac|ad|ae|af|ag|ai|al|am|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cu|cv|cw|cx|cy|cz|de|dj|dk|dm|do|dz|ec|ee|eg|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sk|sl|sm|sn|so|sr|ss|st|su|sv|sx|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tr|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|za|zm|zw|\u03B5\u03BB|\u03B5\u03C5|\u0431\u0433|\u0435\u044E|\u0440\u0444|\u10D2\u10D4|\uB2F7\uB137|\uB2F7\uCEF4|\uC0BC\uC131|\uD55C\uAD6D|\u30B3\u30E0|\u4E16\u754C|\u4E2D\u4FE1|\u4E2D\u56FD|\u4E2D\u570B|\u4F01\u4E1A|\u4F5B\u5C71|\u4FE1\u606F|\u5065\u5EB7|\u516B\u5366|\u516C\u53F8|\u516C\u76CA|\u53F0\u6E7E|\u53F0\u7063|\u5546\u57CE|\u5546\u5E97|\u5546\u6807|\u5609\u91CC|\u5728\u7EBF|\u5927\u62FF|\u5A31\u4E50|\u5BB6\u96FB|\u5E7F\u4E1C|\u5FAE\u535A|\u6148\u5584|\u624B\u673A|\u62DB\u8058|\u653F\u52A1|\u653F\u5E9C|\u65B0\u95FB|\u65F6\u5C1A|\u66F8\u7C4D|\u673A\u6784|\u6E38\u620F|\u6FB3\u9580|\u70B9\u770B|\u79FB\u52A8|\u7F51\u5740|\u7F51\u5E97|\u7F51\u7AD9|\u7F51\u7EDC|\u8054\u901A|\u8C37\u6B4C|\u8D2D\u7269|\u901A\u8CA9|\u96C6\u56E2|\u98DF\u54C1|\u9910\u5385|\u9999\u6E2F)",vme=new RegExp("^"+QQe+"$");var eet=/[\/?#]/,tet=/[-+&@#/%=~_()|'$*\[\]{}\u2713]/,Dme=/[?!:,.;^]/,m9=/https?:\/\//i,Pme=new RegExp("^"+m9.source,"i"),Ime=new RegExp(Dme.source+"$"),net=/^(javascript|vbscript):/i,iet=/^[A-Za-z][-.+A-Za-z0-9]*:(\/\/)?([^:/]*)/,oet=/^(?:\/\/)?([^/#?:]+)/;function VM(e){return Gg.test(e)}function p9(e){return Gg.test(e)||Bs.test(e)||e==="+"||e==="-"||e==="."}function Yp(e){return Od.test(e)}function UM(e){return e==="_"||Yp(e)}function _9(e){return Od.test(e)||tet.test(e)||Dme.test(e)}function zM(e){return eet.test(e)}function g9(e){return vme.test(e.toLowerCase())}function Ome(e){if(net.test(e))return!1;var t=e.match(iet);if(!t)return!1;var n=!!t[1],i=t[2];return n?!0:!(i.indexOf(".")===-1||!Gg.test(i))}function Rme(e){var t=e.match(oet);if(!t)return!1;var n=t[0],i=n.split(".");if(i.length<2)return!1;var o=i[i.length-1];return!!g9(o)}var ret=/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/,set=/[:/?#]/;function Mme(e){var t=e.split(set,1)[0];return ret.test(t)}var aet=/^(https?:\/\/)?(www\.)?/i,cet=/^\/\//,Lme=function(e){Yh(t,e);function t(n){var i=e.call(this,n)||this;return i.type="url",i.url="",i.urlMatchType="scheme",i.protocolRelativeMatch=!1,i.stripPrefix={scheme:!0,www:!0},i.stripTrailingSlash=!0,i.decodePercentEncoding=!0,i.protocolPrepended=!1,i.urlMatchType=n.urlMatchType,i.url=n.url,i.protocolRelativeMatch=n.protocolRelativeMatch,i.stripPrefix=n.stripPrefix,i.stripTrailingSlash=n.stripTrailingSlash,i.decodePercentEncoding=n.decodePercentEncoding,i}return t.prototype.getType=function(){return"url"},t.prototype.getUrlMatchType=function(){return this.urlMatchType},t.prototype.getUrl=function(){var n=this.url;return!this.protocolRelativeMatch&&this.urlMatchType!=="scheme"&&!this.protocolPrepended&&(n=this.url="http://"+n,this.protocolPrepended=!0),n},t.prototype.getAnchorHref=function(){var n=this.getUrl();return n.replace(/&amp;/g,"&")},t.prototype.getAnchorText=function(){var n=this.getMatchedText();return this.protocolRelativeMatch&&(n=det(n)),this.stripPrefix.scheme&&(n=uet(n)),this.stripPrefix.www&&(n=fet(n)),this.stripTrailingSlash&&(n=het(n)),this.decodePercentEncoding&&(n=met(n)),n},t}(Xh);function uet(e){return e.replace(Pme,"")}function fet(e){return e.replace(aet,"$1")}function det(e){return e.replace(cet,"")}function het(e){return e.charAt(e.length-1)==="/"&&(e=e.slice(0,-1)),e}function met(e){var t=e.replace(/%22/gi,"&quot;").replace(/%26/gi,"&amp;").replace(/%27/gi,"&#39;").replace(/%3C/gi,"&lt;").replace(/%3E/gi,"&gt;");try{return decodeURIComponent(t)}catch{return t}}var Nme=/^mailto:/i,pet=new RegExp("[".concat(d9,"!#$%&'*+/=?^_`{|}~-]"));function Fme(e){return Od.test(e)}function HM(e){return pet.test(e)}function Bme(e){var t=e.split(".").pop()||"";return g9(t)}var kme=function(e){Yh(t,e);function t(n){var i=e.call(this,n)||this;return i.type="email",i.email="",i.email=n.email,i}return t.prototype.getType=function(){return"email"},t.prototype.getEmail=function(){return this.email},t.prototype.getAnchorHref=function(){return"mailto:"+this.email},t.prototype.getAnchorText=function(){return this.email},t}(Xh);function y9(e){return e==="_"||Od.test(e)}function Vme(e){return e.length<=140}var Ume=["twitter","facebook","instagram","tiktok"];var zme=function(e){Yh(t,e);function t(n){var i=e.call(this,n)||this;return i.type="hashtag",i.serviceName="twitter",i.hashtag="",i.serviceName=n.serviceName,i.hashtag=n.hashtag,i}return t.prototype.getType=function(){return"hashtag"},t.prototype.getServiceName=function(){return this.serviceName},t.prototype.getHashtag=function(){return this.hashtag},t.prototype.getAnchorHref=function(){var n=this.serviceName,i=this.hashtag;switch(n){case"twitter":return"https://twitter.com/hashtag/"+i;case"facebook":return"https://www.facebook.com/hashtag/"+i;case"instagram":return"https://instagram.com/explore/tags/"+i;case"tiktok":return"https://www.tiktok.com/tag/"+i;default:throw Hg(n),new Error("Invalid hashtag service: ".concat(n))}},t.prototype.getAnchorText=function(){return"#"+this.hashtag},t.prototype.getCssClassSuffixes=function(){var n=e.prototype.getCssClassSuffixes.call(this),i=this.getServiceName();return i&&n.push(i),n},t}(Xh);var _et={twitter:/^@\w{1,15}$/,instagram:/^@[_\w]{1,30}$/,soundcloud:/^@[-a-z0-9_]{3,25}$/,tiktok:/^@[.\w]{1,23}[\w]$/},get=/[-\w.]/;function b9(e){return get.test(e)}function Hme(e,t){var n=_et[t];return n.test(e)}var Gme=["twitter","instagram","soundcloud","tiktok"];var jme=function(e){Yh(t,e);function t(n){var i=e.call(this,n)||this;return i.type="mention",i.serviceName="twitter",i.mention="",i.mention=n.mention,i.serviceName=n.serviceName,i}return t.prototype.getType=function(){return"mention"},t.prototype.getMention=function(){return this.mention},t.prototype.getServiceName=function(){return this.serviceName},t.prototype.getAnchorHref=function(){switch(this.serviceName){case"twitter":return"https://twitter.com/"+this.mention;case"instagram":return"https://instagram.com/"+this.mention;case"soundcloud":return"https://soundcloud.com/"+this.mention;case"tiktok":return"https://www.tiktok.com/@"+this.mention;default:throw new Error("Unknown service name to point mention to: "+this.serviceName)}},t.prototype.getAnchorText=function(){return"@"+this.mention},t.prototype.getCssClassSuffixes=function(){var n=e.prototype.getCssClassSuffixes.call(this),i=this.getServiceName();return i&&n.push(i),n},t}(Xh);var yet=/[-. ]/,bet=/[-. ()]/,xet=/[,;]/,Tet=/(?:(?:(?:(\+)?\d{1,3}[-. ]?)?\(?\d{3}\)?[-. ]?\d{3}[-. ]?\d{4})|(?:(\+)(?:9[976]\d|8[987530]\d|6[987]\d|5[90]\d|42\d|3[875]\d|2[98654321]\d|9[8543210]|8[6421]|6[6543210]|5[87654321]|4[987654310]|3[9643210]|2[70]|7|1)[-. ]?(?:\d[-. ]?){6,12}\d+))([,;]+[0-9]+#?)*/,Aet=/(0([1-9]-?[1-9]\d{3}|[1-9]{2}-?\d{3}|[1-9]{2}\d{1}-?\d{2}|[1-9]{2}\d{2}-?\d{1})-?\d{4}|0[789]0-?\d{4}-?\d{4}|050-?\d{4}-?\d{4})/,Cet=new RegExp("^".concat(Tet.source,"|").concat(Aet.source,"$"));function x9(e){return yet.test(e)}function GM(e){return xet.test(e)}function Wme(e){var t=e.charAt(0)==="+"||bet.test(e);return t&&Cet.test(e)}var qme=function(e){Yh(t,e);function t(n){var i=e.call(this,n)||this;return i.type="phone",i.number="",i.plusSign=!1,i.number=n.number,i.plusSign=n.plusSign,i}return t.prototype.getType=function(){return"phone"},t.prototype.getPhoneNumber=function(){return this.number},t.prototype.getNumber=function(){return this.getPhoneNumber()},t.prototype.getAnchorHref=function(){return"tel:"+(this.plusSign?"+":"")+this.number},t.prototype.getAnchorText=function(){return this.matchedText},t}(Xh);function Kme(e,t){for(var n=t.tagBuilder,i=t.stripPrefix,o=t.stripTrailingSlash,r=t.decodePercentEncoding,s=t.hashtagServiceName,a=t.mentionServiceName,l=[],u=e.length,f=[],d=0;d<u;d++){var p=e.charAt(d);if(f.length===0)x(p);else for(var g=f.length-1;g>=0;g--){var m=f[g];switch(m.state){case 11:I(m,p);break;case 12:L(m,p);break;case 0:T(m,p);break;case 1:C(m,p);break;case 2:S(m,p);break;case 3:v(m,p);break;case 4:D(m,p);break;case 5:M(m,p);break;case 6:N(m,p);break;case 7:B(m,p);break;case 13:_(m,p);break;case 14:w(m,p);break;case 8:P(m,p);break;case 9:O(m,p);break;case 10:F(m,p);break;case 15:V(m,p);break;case 16:G(m,p);break;case 17:z(m,p);break;case 18:W(m,p);break;case 19:U(m,p);break;case 20:q(m,p);break;case 21:K(m,p);break;case 22:te(m,p);break;case 23:Y(m,p);break;case 24:Z(m,p);break;case 25:ee(m,p);break;case 26:me(m,p);break;case 27:be(m,p);break;case 28:le(m,p);break;case 29:ge(m,p);break;case 30:xe(m,p);break;case 31:Pe(m,p);break;case 32:Ue(m,p);break;case 33:Ye(m,p);break;case 34:it(m,p);break;case 35:It(m,p);break;case 36:Ot(m,p);break;case 37:Ee(m,p);break;case 38:He(m,p);break;case 39:tn(m,p);break;case 40:dt(m,p);break;case 41:bt(m,p);break;default:Hg(m.state)}}}for(var b=f.length-1;b>=0;b--)f.forEach(function(Ae){return nn(Ae)});return l;function x(Ae){if(Ae==="#")f.push(Pet(d,28));else if(Ae==="@")f.push(Iet(d,30));else if(Ae==="/")f.push(A9(d,11));else if(Ae==="+")f.push(C9(d,37));else if(Ae==="(")f.push(C9(d,32));else{if(Bs.test(Ae)&&(f.push(C9(d,38)),f.push(vet(d,13))),Fme(Ae)){var Ce=Ae.toLowerCase()==="m"?15:22;f.push(Det(d,Ce))}VM(Ae)&&f.push(T9(d,0)),Od.test(Ae)&&f.push(A9(d,5))}}function T(Ae,Ce){Ce===":"?Ae.state=2:Ce==="-"?Ae.state=1:p9(Ce)||Lo(f,Ae)}function C(Ae,Ce){Ce==="-"||(Ce==="/"?(Lo(f,Ae),f.push(A9(d,11))):p9(Ce)?Ae.state=0:Lo(f,Ae))}function S(Ae,Ce){Ce==="/"?Ae.state=3:Ce==="."?Lo(f,Ae):Yp(Ce)?(Ae.state=5,VM(Ce)&&f.push(T9(d,0))):Lo(f,Ae)}function v(Ae,Ce){Ce==="/"?Ae.state=4:_9(Ce)?(Ae.state=10,Ae.acceptStateReached=!0):nn(Ae)}function D(Ae,Ce){Ce==="/"?Ae.state=10:Yp(Ce)?(Ae.state=5,Ae.acceptStateReached=!0):Lo(f,Ae)}function I(Ae,Ce){Ce==="/"?Ae.state=12:Lo(f,Ae)}function L(Ae,Ce){Yp(Ce)?Ae.state=5:Lo(f,Ae)}function M(Ae,Ce){Ce==="."?Ae.state=7:Ce==="-"?Ae.state=6:Ce===":"?Ae.state=8:zM(Ce)?Ae.state=10:UM(Ce)||nn(Ae)}function N(Ae,Ce){Ce==="-"||(Ce==="."?nn(Ae):Yp(Ce)?Ae.state=5:nn(Ae))}function B(Ae,Ce){Ce==="."?nn(Ae):Yp(Ce)?(Ae.state=5,Ae.acceptStateReached=!0):nn(Ae)}function _(Ae,Ce){Ce==="."?Ae.state=14:Ce===":"?Ae.state=8:Bs.test(Ce)||(zM(Ce)?Ae.state=10:Od.test(Ce)?Lo(f,Ae):nn(Ae))}function w(Ae,Ce){Bs.test(Ce)?(Ae.octetsEncountered++,Ae.octetsEncountered===4&&(Ae.acceptStateReached=!0),Ae.state=13):nn(Ae)}function P(Ae,Ce){Bs.test(Ce)?Ae.state=9:nn(Ae)}function O(Ae,Ce){Bs.test(Ce)||(zM(Ce)?Ae.state=10:nn(Ae))}function F(Ae,Ce){_9(Ce)||nn(Ae)}function V(Ae,Ce){Ce.toLowerCase()==="a"?Ae.state=16:te(Ae,Ce)}function G(Ae,Ce){Ce.toLowerCase()==="i"?Ae.state=17:te(Ae,Ce)}function z(Ae,Ce){Ce.toLowerCase()==="l"?Ae.state=18:te(Ae,Ce)}function W(Ae,Ce){Ce.toLowerCase()==="t"?Ae.state=19:te(Ae,Ce)}function U(Ae,Ce){Ce.toLowerCase()==="o"?Ae.state=20:te(Ae,Ce)}function q(Ae,Ce){Ce.toLowerCase()===":"?Ae.state=21:te(Ae,Ce)}function K(Ae,Ce){HM(Ce)?Ae.state=22:Lo(f,Ae)}function te(Ae,Ce){Ce==="."?Ae.state=23:Ce==="@"?Ae.state=24:HM(Ce)?Ae.state=22:Lo(f,Ae)}function Y(Ae,Ce){Ce==="."?Lo(f,Ae):Ce==="@"?Lo(f,Ae):HM(Ce)?Ae.state=22:Lo(f,Ae)}function Z(Ae,Ce){Yp(Ce)?Ae.state=25:Lo(f,Ae)}function ee(Ae,Ce){Ce==="."?Ae.state=27:Ce==="-"?Ae.state=26:UM(Ce)||nn(Ae)}function me(Ae,Ce){Ce==="-"||Ce==="."?nn(Ae):UM(Ce)?Ae.state=25:nn(Ae)}function be(Ae,Ce){Ce==="."||Ce==="-"?nn(Ae):Yp(Ce)?(Ae.state=25,Ae.acceptStateReached=!0):nn(Ae)}function le(Ae,Ce){y9(Ce)?(Ae.state=29,Ae.acceptStateReached=!0):Lo(f,Ae)}function ge(Ae,Ce){y9(Ce)||nn(Ae)}function xe(Ae,Ce){b9(Ce)?(Ae.state=31,Ae.acceptStateReached=!0):Lo(f,Ae)}function Pe(Ae,Ce){b9(Ce)||(Od.test(Ce)?Lo(f,Ae):nn(Ae))}function Ee(Ae,Ce){Bs.test(Ce)?Ae.state=38:(Lo(f,Ae),x(Ce))}function Ue(Ae,Ce){Bs.test(Ce)?Ae.state=33:Lo(f,Ae),x(Ce)}function Ye(Ae,Ce){Bs.test(Ce)?Ae.state=34:Lo(f,Ae)}function it(Ae,Ce){Bs.test(Ce)?Ae.state=35:Lo(f,Ae)}function It(Ae,Ce){Ce===")"?Ae.state=36:Lo(f,Ae)}function Ot(Ae,Ce){Bs.test(Ce)?Ae.state=38:x9(Ce)?Ae.state=39:Lo(f,Ae)}function He(Ae,Ce){Ae.acceptStateReached=!0,GM(Ce)?Ae.state=40:Ce==="#"?Ae.state=41:Bs.test(Ce)||(Ce==="("?Ae.state=32:x9(Ce)?Ae.state=39:(nn(Ae),VM(Ce)&&f.push(T9(d,0))))}function tn(Ae,Ce){Bs.test(Ce)?Ae.state=38:Ce==="("?Ae.state=32:(nn(Ae),x(Ce))}function dt(Ae,Ce){GM(Ce)||(Ce==="#"?Ae.state=41:Bs.test(Ce)?Ae.state=38:nn(Ae))}function bt(Ae,Ce){GM(Ce)?Ae.state=40:Bs.test(Ce)?Lo(f,Ae):nn(Ae)}function nn(Ae){if(Lo(f,Ae),!!Ae.acceptStateReached){var Ce=Ae.startIdx,rt=e.slice(Ae.startIdx,d);if(rt=wet(rt),Ae.type==="url"){var Ri=e.charAt(Ae.startIdx-1);if(Ri==="@")return;var lt=Ae.matchType;if(lt==="scheme"){var ao=m9.exec(rt);if(ao&&(Ce=Ce+ao.index,rt=rt.slice(ao.index)),!Ome(rt))return}else if(lt==="tld"){if(!Rme(rt))return}else if(lt==="ipV4"){if(!Mme(rt))return}else Hg(lt);l.push(new Lme({tagBuilder:n,matchedText:rt,offset:Ce,urlMatchType:lt,url:rt,protocolRelativeMatch:rt.slice(0,2)==="//",stripPrefix:i,stripTrailingSlash:o,decodePercentEncoding:r}))}else if(Ae.type==="email")Bme(rt)&&l.push(new kme({tagBuilder:n,matchedText:rt,offset:Ce,email:rt.replace(Nme,"")}));else if(Ae.type==="hashtag")Vme(rt)&&l.push(new zme({tagBuilder:n,matchedText:rt,offset:Ce,serviceName:s,hashtag:rt.slice(1)}));else if(Ae.type==="mention")Hme(rt,a)&&l.push(new jme({tagBuilder:n,matchedText:rt,offset:Ce,serviceName:a,mention:rt.slice(1)}));else if(Ae.type==="phone"){if(rt=rt.replace(/ +$/g,""),Wme(rt)){var Fo=rt.replace(/[^0-9,;#]/g,"");l.push(new qme({tagBuilder:n,matchedText:rt,offset:Ce,number:Fo,plusSign:rt.charAt(0)==="+"}))}}else Hg(Ae)}}}var Eet=/[\(\{\[]/,Yme=/[\)\}\]]/,Xme={")":"(","}":"{","]":"["};function wet(e){for(var t={"(":0,"{":0,"[":0},n=0;n<e.length;n++){var i=e.charAt(n);Eet.test(i)?t[i]++:Yme.test(i)&&t[Xme[i]]--}for(var o=e.length-1,r;o>=0;)if(r=e.charAt(o),Yme.test(r)){var s=Xme[r];if(t[s]<0)t[s]++,o--;else break}else if(Ime.test(r))o--;else break;return e.slice(0,o+1)}function T9(e,t){return{type:"url",startIdx:e,state:t,acceptStateReached:!1,matchType:"scheme"}}function A9(e,t){return{type:"url",startIdx:e,state:t,acceptStateReached:!1,matchType:"tld"}}function vet(e,t){return{type:"url",startIdx:e,state:t,acceptStateReached:!1,matchType:"ipV4",octetsEncountered:1}}function Det(e,t){return{type:"email",startIdx:e,state:t,acceptStateReached:!1}}function Pet(e,t){return{type:"hashtag",startIdx:e,state:t,acceptStateReached:!1}}function Iet(e,t){return{type:"mention",startIdx:e,state:t,acceptStateReached:!1}}function C9(e,t){return{type:"phone",startIdx:e,state:t,acceptStateReached:!1}}function $me(e,t){for(var n=t.onOpenTag,i=t.onCloseTag,o=t.onText,r=t.onComment,s=t.onDoctype,a=new Kh,l=0,u=e.length,f=0,d=0,p=a;l<u;){var g=e.charAt(l);switch(f){case 0:m(g);break;case 1:b(g);break;case 2:T(g);break;case 3:x(g);break;case 4:C(g);break;case 5:S(g);break;case 6:v(g);break;case 7:D(g);break;case 8:I(g);break;case 9:L(g);break;case 10:M(g);break;case 11:N(g);break;case 12:B(g);break;case 13:_(g);break;case 14:w(g);break;case 15:P(g);break;case 16:O(g);break;case 17:F(g);break;case 18:V(g);break;case 19:G(g);break;case 20:z(g);break;default:Hg(f)}l++}d<l&&K();function m(Z){Z==="<"&&U()}function b(Z){Z==="!"?f=13:Z==="/"?(f=2,p=new Kh(ks(ks({},p),{isClosing:!0}))):Z==="<"?U():Gg.test(Z)?(f=3,p=new Kh(ks(ks({},p),{isOpening:!0}))):(f=0,p=a)}function x(Z){ou.test(Z)?(p=new Kh(ks(ks({},p),{name:te()})),f=4):Z==="<"?U():Z==="/"?(p=new Kh(ks(ks({},p),{name:te()})),f=12):Z===">"?(p=new Kh(ks(ks({},p),{name:te()})),q()):!Gg.test(Z)&&!Bs.test(Z)&&Z!==":"&&W()}function T(Z){Z===">"?W():Gg.test(Z)?f=3:W()}function C(Z){ou.test(Z)||(Z==="/"?f=12:Z===">"?q():Z==="<"?U():Z==="="||BM.test(Z)||xme.test(Z)?W():f=5)}function S(Z){ou.test(Z)?f=6:Z==="/"?f=12:Z==="="?f=7:Z===">"?q():Z==="<"?U():BM.test(Z)&&W()}function v(Z){ou.test(Z)||(Z==="/"?f=12:Z==="="?f=7:Z===">"?q():Z==="<"?U():BM.test(Z)?W():f=5)}function D(Z){ou.test(Z)||(Z==='"'?f=8:Z==="'"?f=9:/[>=`]/.test(Z)?W():Z==="<"?U():f=10)}function I(Z){Z==='"'&&(f=11)}function L(Z){Z==="'"&&(f=11)}function M(Z){ou.test(Z)?f=4:Z===">"?q():Z==="<"&&U()}function N(Z){ou.test(Z)?f=4:Z==="/"?f=12:Z===">"?q():Z==="<"?U():(f=4,Y())}function B(Z){Z===">"?(p=new Kh(ks(ks({},p),{isClosing:!0})),q()):f=4}function _(Z){e.substr(l,2)==="--"?(l+=2,p=new Kh(ks(ks({},p),{type:"comment"})),f=14):e.substr(l,7).toUpperCase()==="DOCTYPE"?(l+=7,p=new Kh(ks(ks({},p),{type:"doctype"})),f=20):W()}function w(Z){Z==="-"?f=15:Z===">"?W():f=16}function P(Z){Z==="-"?f=18:Z===">"?W():f=16}function O(Z){Z==="-"&&(f=17)}function F(Z){Z==="-"?f=18:f=16}function V(Z){Z===">"?q():Z==="!"?f=19:Z==="-"||(f=16)}function G(Z){Z==="-"?f=17:Z===">"?q():f=16}function z(Z){Z===">"?q():Z==="<"&&U()}function W(){f=0,p=a}function U(){f=1,p=new Kh({idx:l})}function q(){var Z=e.slice(d,p.idx);Z&&o(Z,d),p.type==="comment"?r(p.idx):p.type==="doctype"?s(p.idx):(p.isOpening&&n(p.name,p.idx),p.isClosing&&i(p.name,p.idx)),W(),d=l+1}function K(){var Z=e.slice(d,l);o(Z,d),d=l+1}function te(){var Z=p.idx+(p.isClosing?2:1);return e.slice(Z,l).toLowerCase()}function Y(){l--}}var Kh=function(){function e(t){t===void 0&&(t={}),this.idx=t.idx!==void 0?t.idx:-1,this.type=t.type||"tag",this.name=t.name||"",this.isOpening=!!t.isOpening,this.isClosing=!!t.isClosing}return e}();var Oet=function(){function e(t){t===void 0&&(t={}),this.version=e.version,this.urls={},this.email=!0,this.phone=!0,this.hashtag=!1,this.mention=!1,this.newWindow=!0,this.stripPrefix={scheme:!0,www:!0},this.stripTrailingSlash=!0,this.decodePercentEncoding=!0,this.truncate={length:0,location:"end"},this.className="",this.replaceFn=null,this.context=void 0,this.sanitizeHtml=!1,this.tagBuilder=null,this.urls=Ret(t.urls),this.email=iu(t.email)?t.email:this.email,this.phone=iu(t.phone)?t.phone:this.phone,this.hashtag=t.hashtag||this.hashtag,this.mention=t.mention||this.mention,this.newWindow=iu(t.newWindow)?t.newWindow:this.newWindow,this.stripPrefix=Met(t.stripPrefix),this.stripTrailingSlash=iu(t.stripTrailingSlash)?t.stripTrailingSlash:this.stripTrailingSlash,this.decodePercentEncoding=iu(t.decodePercentEncoding)?t.decodePercentEncoding:this.decodePercentEncoding,this.sanitizeHtml=t.sanitizeHtml||!1;var n=this.mention;if(n!==!1&&Gme.indexOf(n)===-1)throw new Error("invalid `mention` cfg '".concat(n,"' - see docs"));var i=this.hashtag;if(i!==!1&&Ume.indexOf(i)===-1)throw new Error("invalid `hashtag` cfg '".concat(i,"' - see docs"));this.truncate=Let(t.truncate),this.className=t.className||this.className,this.replaceFn=t.replaceFn||this.replaceFn,this.context=t.context||this}return e.link=function(t,n){var i=new e(n);return i.link(t)},e.parse=function(t,n){var i=new e(n);return i.parse(t)},e.prototype.parse=function(t){var n=this,i=["a","style","script"],o=0,r=[];return $me(t,{onOpenTag:function(s){i.indexOf(s)>=0&&o++},onText:function(s,a){if(o===0){var l=/(&nbsp;|&#160;|&lt;|&#60;|&gt;|&#62;|&quot;|&#34;|&#39;)/gi,u=s.split(l),f=a;u.forEach(function(d,p){if(p%2===0){var g=n.parseText(d,f);r.push.apply(r,g)}f+=d.length})}},onCloseTag:function(s){i.indexOf(s)>=0&&(o=Math.max(o-1,0))},onComment:function(s){},onDoctype:function(s){}}),r=this.compactMatches(r),r=this.removeUnwantedMatches(r),r},e.prototype.compactMatches=function(t){t.sort(function(l,u){return l.getOffset()-u.getOffset()});for(var n=0;n<t.length-1;){var i=t[n],o=i.getOffset(),r=i.getMatchedText().length,s=o+r;if(n+1<t.length){if(t[n+1].getOffset()===o){var a=t[n+1].getMatchedText().length>r?n:n+1;t.splice(a,1);continue}if(t[n+1].getOffset()<s){t.splice(n+1,1);continue}}n++}return t},e.prototype.removeUnwantedMatches=function(t){return this.hashtag||zg(t,function(n){return n.getType()==="hashtag"}),this.email||zg(t,function(n){return n.getType()==="email"}),this.phone||zg(t,function(n){return n.getType()==="phone"}),this.mention||zg(t,function(n){return n.getType()==="mention"}),this.urls.schemeMatches||zg(t,function(n){return n.getType()==="url"&&n.getUrlMatchType()==="scheme"}),this.urls.tldMatches||zg(t,function(n){return n.getType()==="url"&&n.getUrlMatchType()==="tld"}),this.urls.ipV4Matches||zg(t,function(n){return n.getType()==="url"&&n.getUrlMatchType()==="ipV4"}),t},e.prototype.parseText=function(t,n){n===void 0&&(n=0),n=n||0;for(var i=Kme(t,{tagBuilder:this.getTagBuilder(),stripPrefix:this.stripPrefix,stripTrailingSlash:this.stripTrailingSlash,decodePercentEncoding:this.decodePercentEncoding,hashtagServiceName:this.hashtag,mentionServiceName:this.mention||"twitter"}),o=0,r=i.length;o<r;o++)i[o].setOffset(n+i[o].getOffset());return i},e.prototype.link=function(t){if(!t)return"";this.sanitizeHtml&&(t=t.replace(/</g,"&lt;").replace(/>/g,"&gt;"));for(var n=this.parse(t),i=[],o=0,r=0,s=n.length;r<s;r++){var a=n[r];i.push(t.substring(o,a.getOffset())),i.push(this.createMatchReturnVal(a)),o=a.getOffset()+a.getMatchedText().length}return i.push(t.substring(o)),i.join("")},e.prototype.createMatchReturnVal=function(t){var n;if(this.replaceFn&&(n=this.replaceFn.call(this.context,t)),typeof n=="string")return n;if(n===!1)return t.getMatchedText();if(n instanceof kM)return n.toAnchorString();var i=t.buildTag();return i.toAnchorString()},e.prototype.getTagBuilder=function(){var t=this.tagBuilder;return t||(t=this.tagBuilder=new wme({newWindow:this.newWindow,truncate:this.truncate,className:this.className})),t},e.version=gme,e}(),Zme=Oet;function Ret(e){return e==null&&(e=!0),iu(e)?{schemeMatches:e,tldMatches:e,ipV4Matches:e}:{schemeMatches:iu(e.schemeMatches)?e.schemeMatches:!0,tldMatches:iu(e.tldMatches)?e.tldMatches:!0,ipV4Matches:iu(e.ipV4Matches)?e.ipV4Matches:!0}}function Met(e){return e==null&&(e=!0),iu(e)?{scheme:e,www:e}:{scheme:iu(e.scheme)?e.scheme:!0,www:iu(e.www)?e.www:!0}}function Let(e){return typeof e=="number"?{length:e,location:"end"}:yme(e||{},{length:Number.POSITIVE_INFINITY,location:"end"})}var jM=Zme;var spe;typeof DOMParser<"u"&&(spe=new DOMParser);var Net=new jM({stripPrefix:!1,email:!1,replaceFn:function(e,t){return t.urlMatchType==="scheme"||t.urlMatchType==="www"}}),WM=32,Jme=2414016,Qme=1,epe=16093e3,tpe=.1,Fet=[null,void 0,"http://www.topografix.com/GPX/1/1"],bo={gpx:Fet};function Bet(e){return new Promise((t,n)=>{let i=new FileReader;i.addEventListener("load",function(){t(i.result)}),i.addEventListener("error",function(){n(i.error)}),i.readAsText(e)})}function E9(e,t){let n=aD(e,"id");return n=c(n)?n:Hn(),t.getOrCreateEntity(n)}function S9(e){let t=npe(e,"lon"),n=npe(e,"lat"),i=rD(e,"ele",bo.gpx);return h.fromDegrees(t,n,i)}function npe(e,t){if(!c(e))return;let n=e.getAttribute(t);if(n!==null){let i=parseFloat(n);return isNaN(i)?void 0:i}}function aD(e,t){if(!c(e))return;let n=e.getAttribute(t);return n!==null?n:void 0}function jg(e,t,n){if(!c(e))return;let i=e.childNodes,o=i.length;for(let r=0;r<o;r++){let s=i[r];if(s.localName===t&&n.indexOf(s.namespaceURI)!==-1)return s}}function w9(e,t,n){if(!c(e))return;let i=[],o=e.getElementsByTagName(t),r=o.length;for(let s=0;s<r;s++){let a=o[s];a.localName===t&&n.indexOf(a.namespaceURI)!==-1&&i.push(a)}return i}function rD(e,t,n){let i=jg(e,t,n);if(c(i)){let o=parseFloat(i.textContent);return isNaN(o)?void 0:o}}function yl(e,t,n){let i=jg(e,t,n);if(c(i))return i.textContent.trim()}function ape(e){let t=new Wc;return t.width=WM,t.height=WM,t.scaleByDistance=new Vt(Jme,Qme,epe,tpe),t.pixelOffsetScaleByDistance=new Vt(Jme,Qme,epe,tpe),t.verticalOrigin=new Kn(Ln.BOTTOM),t.image=e,t}function ket(){let e=new km;return e.translucencyByDistance=new Vt(3e6,1,5e6,0),e.pixelOffset=new H(17,0),e.horizontalOrigin=bi.LEFT,e.font="16px sans-serif",e.style=ir.FILL_AND_OUTLINE,e}function cpe(e){let t=new el;return t.width=4,t.material=new _A,t.material.color=c(e)?e:j.RED,t.material.outlineWidth=2,t.material.outlineColor=j.BLACK,t}var ipe={time:{text:"Time",tag:"time"},comment:{text:"Comment",tag:"cmt"},description:{text:"Description",tag:"desc"},source:{text:"Source",tag:"src"},number:{text:"GPS track/route number",tag:"number"},type:{text:"Type",tag:"type"}},sD;typeof document<"u"&&(sD=document.createElement("div"));function v9(e,t){let n,i="",o=Object.keys(ipe),r=o.length;for(n=0;n<r;n++){let f=o[n],d=ipe[f];d.value=y(yl(e,d.tag,bo.gpx),""),c(d.value)&&d.value!==""&&(i=`${i}<p>${d.text}: ${d.value}</p>`)}if(!c(i)||i==="")return;i=Net.link(i),sD.innerHTML=i;let s=sD.querySelectorAll("a");for(n=0;n<s.length;n++)s[n].setAttribute("target","_blank");let a=j.WHITE,l=j.BLACK,u='<div class="cesium-infoBox-description-lighter" style="';return u+="overflow:auto;",u+="word-wrap:break-word;",u+=`background-color:${a.toCssColorString()};`,u+=`color:${l.toCssColorString()};`,u+='">',u+=`${sD.innerHTML}</div>`,sD.innerHTML="",u}function lpe(e,t,n,i){let o=S9(t),r=E9(t,n);r.position=o;let s=c(i.waypointImage)?i.waypointImage:e._pinBuilder.fromMakiIconId("marker",j.RED,WM);r.billboard=ape(s);let a=yl(t,"name",bo.gpx);r.name=a,r.label=ket(),r.label.text=a,r.description=v9(t,r),i.clampToGround&&(r.billboard.heightReference=$e.CLAMP_TO_GROUND,r.label.heightReference=$e.CLAMP_TO_GROUND)}function Vet(e,t,n,i){let o=E9(t,n);o.description=v9(t,o);let r=w9(t,"rtept",bo.gpx),s=new Array(r.length);for(let a=0;a<r.length;a++)lpe(e,r[a],n,i),s[a]=S9(r[a]);o.polyline=cpe(i.routeColor),i.clampToGround&&(o.polyline.clampToGround=!0),o.polyline.positions=s}function Uet(e,t,n,i){let o=E9(t,n);o.description=v9(t,o);let r=w9(t,"trkseg",bo.gpx),s=[],a=[],l,u=!0,f=new Ja;for(let d=0;d<r.length;d++)l=zet(r[d]),s=s.concat(l.positions),l.times.length>0?(a=a.concat(l.times),f.addSamples(a,s),u=u&&!0):u=!1;if(u){let d=c(i.waypointImage)?i.waypointImage:e._pinBuilder.fromMakiIconId("marker",j.RED,WM);o.billboard=ape(d),o.position=f,i.clampToGround&&(o.billboard.heightReference=$e.CLAMP_TO_GROUND),o.availability=new ts,o.availability.addInterval(new wn({start:a[0],stop:a[a.length-1]}))}o.polyline=cpe(i.trackColor),o.polyline.positions=s,i.clampToGround&&(o.polyline.clampToGround=!0)}function zet(e){let t={positions:[],times:[]},n=w9(e,"trkpt",bo.gpx),i;for(let o=0;o<n.length;o++){let r=S9(n[o]);t.positions.push(r),i=yl(n[o],"time",bo.gpx),c(i)&&t.times.push(J.fromIso8601(i))}return t}function Het(e){let t=jg(e,"metadata",bo.gpx);if(c(t)){let n={name:yl(t,"name",bo.gpx),desc:yl(t,"desc",bo.gpx),author:Get(t),copyright:Wet(t),link:upe(t),time:yl(t,"time",bo.gpx),keywords:yl(t,"keywords",bo.gpx),bounds:qet(t)};if(c(n.name)||c(n.desc)||c(n.author)||c(n.copyright)||c(n.link)||c(n.time)||c(n.keywords)||c(n.bounds))return n}}function Get(e){let t=jg(e,"author",bo.gpx);if(c(t)){let n={name:yl(t,"name",bo.gpx),email:jet(t),link:upe(t)};if(c(n.name)||c(n.email)||c(n.link))return n}}function jet(e){let t=jg(e,"email",bo.gpx);if(c(t)){let n=yl(t,"id",bo.gpx),i=yl(t,"domain",bo.gpx);return`${n}@${i}`}}function upe(e){let t=jg(e,"link",bo.gpx);if(c(t)){let n={href:aD(t,"href"),text:yl(t,"text",bo.gpx),mimeType:yl(t,"type",bo.gpx)};if(c(n.href)||c(n.text)||c(n.mimeType))return n}}function Wet(e){let t=jg(e,"copyright",bo.gpx);if(c(t)){let n={author:aD(t,"author"),year:yl(t,"year",bo.gpx),license:yl(t,"license",bo.gpx)};if(c(n.author)||c(n.year)||c(n.license))return n}}function qet(e){let t=jg(e,"bounds",bo.gpx);if(c(t)){let n={minLat:rD(t,"minlat",bo.gpx),maxLat:rD(t,"maxlat",bo.gpx),minLon:rD(t,"minlon",bo.gpx),maxLon:rD(t,"maxlon",bo.gpx)};if(c(n.minLat)||c(n.maxLat)||c(n.minLon)||c(n.maxLon))return n}}var ope={wpt:lpe,rte:Vet,trk:Uet};function Yet(e,t,n,i){let o=Object.keys(ope),r=o.length;for(let s=0;s<r;s++){let a=o[s],l=ope[a],u=t.childNodes,f=u.length;for(let d=0;d<f;d++){let p=u[d];p.localName===a&&bo.gpx.indexOf(p.namespaceURI)!==-1&&l(e,p,n,i)}}}function rpe(e,t,n){let i=e._entityCollection;i.removeAll();let o=t.documentElement,r=aD(o,"version"),s=aD(o,"creator"),a,l=Het(o);c(l)&&(a=l.name),o.localName==="gpx"?Yet(e,o,i,n):console.log(`GPX - Unsupported node: ${o.localName}`);let u,f=i.computeAvailability(),d=f.start,p=f.stop,g=J.equals(d,je.MINIMUM_VALUE),m=J.equals(p,je.MAXIMUM_VALUE);if(!g||!m){let x;g&&(x=new Date,x.setHours(0,0,0,0),d=J.fromDate(x)),m&&(x=new Date,x.setHours(24,0,0,0),p=J.fromDate(x)),u=new Lp,u.startTime=d,u.stopTime=p,u.currentTime=J.clone(d),u.clockRange=jr.LOOP_STOP,u.clockStep=ho.SYSTEM_CLOCK_MULTIPLIER,u.multiplier=Math.round(Math.min(Math.max(J.secondsDifference(p,d)/60,1),31556900))}let b=!1;return e._name!==a&&(e._name=a,b=!0),e._creator!==s&&(e._creator=s,b=!0),Xet(e._metadata,l)&&(e._metadata=l,b=!0),e._version!==r&&(e._version=r,b=!0),u!==e._clock&&(b=!0,e._clock=u),b&&e._changed.raiseEvent(e),ns.setLoading(e,!1),e}function Xet(e,t){return!c(e)&&!c(t)?!1:c(e)&&c(t)?e.name!==t.name||e.dec!==t.desc||e.src!==t.src||e.author!==t.author||e.copyright!==t.copyright||e.link!==t.link||e.time!==t.time||e.bounds!==t.bounds:!0}function Ket(e,t,n,i){i=y(i,y.EMPTY_OBJECT);let o=n;if(typeof n=="string"||n instanceof De){n=De.createIfNeeded(n),o=n.fetchBlob();let r=e._resourceCredits,s=n.credits;if(c(s)){let a=s.length;for(let l=0;l<a;l++)r.push(s[l])}}return Promise.resolve(o).then(function(r){return r instanceof Blob?Bet(r).then(function(s){let a,l;try{a=spe.parseFromString(s,"application/xml")}catch(u){l=u.toString()}if(c(l)||a.body||a.documentElement.tagName==="parsererror"){let u=c(l)?l:a.documentElement.firstChild.nodeValue;throw u||(u=a.body.innerText),new ue(u)}return rpe(e,a,i)}):rpe(e,r,i)}).catch(function(r){return e._error.raiseEvent(e,r),console.log(r),Promise.reject(r)})}function JA(){this._changed=new pe,this._error=new pe,this._loading=new pe,this._clock=void 0,this._entityCollection=new _a(this),this._entityCluster=new _d,this._name=void 0,this._version=void 0,this._creator=void 0,this._metadata=void 0,this._isLoading=!1,this._pinBuilder=new vb}JA.load=function(e,t){return new JA().load(e,t)};Object.defineProperties(JA.prototype,{name:{get:function(){return this._name}},version:{get:function(){return this._version}},creator:{get:function(){return this._creator}},metadata:{get:function(){return this._metadata}},clock:{get:function(){return this._clock}},entities:{get:function(){return this._entityCollection}},isLoading:{get:function(){return this._isLoading}},changedEvent:{get:function(){return this._changed}},errorEvent:{get:function(){return this._error}},loadingEvent:{get:function(){return this._loading}},show:{get:function(){return this._entityCollection.show},set:function(e){this._entityCollection.show=e}},clustering:{get:function(){return this._entityCluster},set:function(e){if(!c(e))throw new E("value must be defined.");this._entityCluster=e}}});JA.prototype.update=function(e){return!0};JA.prototype.load=function(e,t){if(!c(e))throw new E("data is required.");t=y(t,y.EMPTY_OBJECT),ns.setLoading(this,!0);let n=this._name,i=this;return Ket(this,this._entityCollection,e,t).then(function(){let o,r=i._entityCollection.computeAvailability(),s=r.start,a=r.stop,l=J.equals(s,je.MINIMUM_VALUE),u=J.equals(a,je.MAXIMUM_VALUE);if(!l||!u){let d;l&&(d=new Date,d.setHours(0,0,0,0),s=J.fromDate(d)),u&&(d=new Date,d.setHours(24,0,0,0),a=J.fromDate(d)),o=new Lp,o.startTime=s,o.stopTime=a,o.currentTime=J.clone(s),o.clockRange=jr.LOOP_STOP,o.clockStep=ho.SYSTEM_CLOCK_MULTIPLIER,o.multiplier=Math.round(Math.min(Math.max(J.secondsDifference(a,s)/60,1),31556900))}let f=!1;return o!==i._clock&&(i._clock=o,f=!0),n!==i._name&&(f=!0),f&&i._changed.raiseEvent(i),ns.setLoading(i,!1),i}).catch(function(o){return ns.setLoading(i,!1),i._error.raiseEvent(i,o),console.log(o),Promise.reject(o)})};var qM=JA;function $et(e,t){this.position=e,this.headingPitchRoll=t}var D9=$et;var lD=Ur(Pl(),1);function Zet(e,t){this.position=e,this.headingPitchRange=t}var P9=Zet;function YM(e,t){this.id=t,this.name=e,this.playlistIndex=0,this.playlist=[],this.tourStart=new pe,this.tourEnd=new pe,this.entryStart=new pe,this.entryEnd=new pe,this._activeEntries=[]}YM.prototype.addPlaylistEntry=function(e){this.playlist.push(e)};YM.prototype.play=function(e,t){this.tourStart.raiseEvent();let n=this;dpe.call(this,e,t,function(i){n.playlistIndex=0,i||fpe(n._activeEntries),n.tourEnd.raiseEvent(i)})};YM.prototype.stop=function(){fpe(this._activeEntries)};function fpe(e){for(let t=e.pop();t!==void 0;t=e.pop())t.stop()}function dpe(e,t,n){let i=this.playlist[this.playlistIndex];if(i){let o=Jet.bind(this,e,t,n);if(this._activeEntries.push(i),this.entryStart.raiseEvent(i),i.blocking)i.play(o,e.scene.camera,t);else{let r=this;i.play(function(){r.entryEnd.raiseEvent(i);let s=r._activeEntries.indexOf(i);s>=0&&r._activeEntries.splice(s,1)}),o(e,t,n)}}else c(n)&&n(!1)}function Jet(e,t,n,i){let o=this.playlist[this.playlistIndex];if(this.entryEnd.raiseEvent(o,i),i)n(i);else{let r=this._activeEntries.indexOf(o);r>=0&&this._activeEntries.splice(r,1),this.playlistIndex++,dpe.call(this,e,t,n)}}var I9=YM;var Si=Object.freeze({Linear:Object.freeze({None:function(e){return e},In:function(e){return e},Out:function(e){return e},InOut:function(e){return e}}),Quadratic:Object.freeze({In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}}),Cubic:Object.freeze({In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}}),Quartic:Object.freeze({In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}}),Quintic:Object.freeze({In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}}),Sinusoidal:Object.freeze({In:function(e){return 1-Math.sin((1-e)*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return .5*(1-Math.sin(Math.PI*(.5-e)))}}),Exponential:Object.freeze({In:function(e){return e===0?0:Math.pow(1024,e-1)},Out:function(e){return e===1?1:1-Math.pow(2,-10*e)},InOut:function(e){return e===0?0:e===1?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(-Math.pow(2,-10*(e-1))+2)}}),Circular:Object.freeze({In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}}),Elastic:Object.freeze({In:function(e){return e===0?0:e===1?1:-Math.pow(2,10*(e-1))*Math.sin((e-1.1)*5*Math.PI)},Out:function(e){return e===0?0:e===1?1:Math.pow(2,-10*e)*Math.sin((e-.1)*5*Math.PI)+1},InOut:function(e){return e===0?0:e===1?1:(e*=2,e<1?-.5*Math.pow(2,10*(e-1))*Math.sin((e-1.1)*5*Math.PI):.5*Math.pow(2,-10*(e-1))*Math.sin((e-1.1)*5*Math.PI)+1)}}),Back:Object.freeze({In:function(e){var t=1.70158;return e===1?1:e*e*((t+1)*e-t)},Out:function(e){var t=1.70158;return e===0?0:--e*e*((t+1)*e+t)+1},InOut:function(e){var t=2.5949095;return(e*=2)<1?.5*(e*e*((t+1)*e-t)):.5*((e-=2)*e*((t+1)*e+t)+2)}}),Bounce:Object.freeze({In:function(e){return 1-Si.Bounce.Out(1-e)},Out:function(e){return e<.36363636363636365?7.5625*e*e:e<.7272727272727273?7.5625*(e-=.5454545454545454)*e+.75:e<.9090909090909091?7.5625*(e-=.8181818181818182)*e+.9375:7.5625*(e-=.9545454545454546)*e+.984375},InOut:function(e){return e<.5?Si.Bounce.In(e*2)*.5:Si.Bounce.Out(e*2-1)*.5+.5}}),generatePow:function(e){return e===void 0&&(e=4),e=e<Number.EPSILON?Number.EPSILON:e,e=e>1e4?1e4:e,{In:function(t){return Math.pow(t,e)},Out:function(t){return 1-Math.pow(1-t,e)},InOut:function(t){return t<.5?Math.pow(t*2,e)/2:(1-Math.pow(2-t*2,e))/2+.5}}}}),cD=function(){return performance.now()},Qet=function(){function e(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this._tweens={},this._tweensAddedDuringUpdate={},this.add.apply(this,t)}return e.prototype.getAll=function(){var t=this;return Object.keys(this._tweens).map(function(n){return t._tweens[n]})},e.prototype.removeAll=function(){this._tweens={}},e.prototype.add=function(){for(var t,n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];for(var o=0,r=n;o<r.length;o++){var s=r[o];(t=s._group)===null||t===void 0||t.remove(s),s._group=this,this._tweens[s.getId()]=s,this._tweensAddedDuringUpdate[s.getId()]=s}},e.prototype.remove=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var i=0,o=t;i<o.length;i++){var r=o[i];r._group=void 0,delete this._tweens[r.getId()],delete this._tweensAddedDuringUpdate[r.getId()]}},e.prototype.allStopped=function(){return this.getAll().every(function(t){return!t.isPlaying()})},e.prototype.update=function(t,n){t===void 0&&(t=cD()),n===void 0&&(n=!0);var i=Object.keys(this._tweens);if(i.length!==0)for(;i.length>0;){this._tweensAddedDuringUpdate={};for(var o=0;o<i.length;o++){var r=this._tweens[i[o]],s=!n;r&&r.update(t,s)===!1&&!n&&this.remove(r)}i=Object.keys(this._tweensAddedDuringUpdate)}},e}(),QA={Linear:function(e,t){var n=e.length-1,i=n*t,o=Math.floor(i),r=QA.Utils.Linear;return t<0?r(e[0],e[1],i):t>1?r(e[n],e[n-1],n-i):r(e[o],e[o+1>n?n:o+1],i-o)},Bezier:function(e,t){for(var n=0,i=e.length-1,o=Math.pow,r=QA.Utils.Bernstein,s=0;s<=i;s++)n+=o(1-t,i-s)*o(t,s)*e[s]*r(i,s);return n},CatmullRom:function(e,t){var n=e.length-1,i=n*t,o=Math.floor(i),r=QA.Utils.CatmullRom;return e[0]===e[n]?(t<0&&(o=Math.floor(i=n*(1+t))),r(e[(o-1+n)%n],e[o],e[(o+1)%n],e[(o+2)%n],i-o)):t<0?e[0]-(r(e[0],e[0],e[1],e[1],-i)-e[0]):t>1?e[n]-(r(e[n],e[n],e[n-1],e[n-1],i-n)-e[n]):r(e[o?o-1:0],e[o],e[n<o+1?n:o+1],e[n<o+2?n:o+2],i-o)},Utils:{Linear:function(e,t,n){return(t-e)*n+e},Bernstein:function(e,t){var n=QA.Utils.Factorial;return n(e)/n(t)/n(e-t)},Factorial:function(){var e=[1];return function(t){var n=1;if(e[t])return e[t];for(var i=t;i>1;i--)n*=i;return e[t]=n,n}}(),CatmullRom:function(e,t,n,i,o){var r=(n-e)*.5,s=(i-t)*.5,a=o*o,l=o*a;return(2*t-2*n+r+s)*l+(-3*t+3*n-2*r-s)*a+r*o+t}}},hpe=function(){function e(){}return e.nextId=function(){return e._nextId++},e._nextId=0,e}(),O9=new Qet,mpe=function(){function e(t,n){this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._isDynamic=!1,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=Si.Linear.None,this._interpolationFunction=QA.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._id=hpe.nextId(),this._isChainStopped=!1,this._propertiesAreSetUp=!1,this._goToEnd=!1,this._object=t,typeof n=="object"?(this._group=n,n.add(this)):n===!0&&(this._group=O9,O9.add(this))}return e.prototype.getId=function(){return this._id},e.prototype.isPlaying=function(){return this._isPlaying},e.prototype.isPaused=function(){return this._isPaused},e.prototype.getDuration=function(){return this._duration},e.prototype.to=function(t,n){if(n===void 0&&(n=1e3),this._isPlaying)throw new Error("Can not call Tween.to() while Tween is already started or paused. Stop the Tween first.");return this._valuesEnd=t,this._propertiesAreSetUp=!1,this._duration=n<0?0:n,this},e.prototype.duration=function(t){return t===void 0&&(t=1e3),this._duration=t<0?0:t,this},e.prototype.dynamic=function(t){return t===void 0&&(t=!1),this._isDynamic=t,this},e.prototype.start=function(t,n){if(t===void 0&&(t=cD()),n===void 0&&(n=!1),this._isPlaying)return this;if(this._repeat=this._initialRepeat,this._reversed){this._reversed=!1;for(var i in this._valuesStartRepeat)this._swapEndStartRepeatValues(i),this._valuesStart[i]=this._valuesStartRepeat[i]}if(this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=t,this._startTime+=this._delayTime,!this._propertiesAreSetUp||n){if(this._propertiesAreSetUp=!0,!this._isDynamic){var o={};for(var r in this._valuesEnd)o[r]=this._valuesEnd[r];this._valuesEnd=o}this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat,n)}return this},e.prototype.startFromCurrentValues=function(t){return this.start(t,!0)},e.prototype._setupProperties=function(t,n,i,o,r){for(var s in i){var a=t[s],l=Array.isArray(a),u=l?"array":typeof a,f=!l&&Array.isArray(i[s]);if(!(u==="undefined"||u==="function")){if(f){var d=i[s];if(d.length===0)continue;for(var p=[a],g=0,m=d.length;g<m;g+=1){var b=this._handleRelativeValue(a,d[g]);if(isNaN(b)){f=!1,console.warn("Found invalid interpolation list. Skipping.");break}p.push(b)}f&&(i[s]=p)}if((u==="object"||l)&&a&&!f){n[s]=l?[]:{};var x=a;for(var T in x)n[s][T]=x[T];o[s]=l?[]:{};var d=i[s];if(!this._isDynamic){var C={};for(var T in d)C[T]=d[T];i[s]=d=C}this._setupProperties(x,n[s],d,o[s],r)}else(typeof n[s]>"u"||r)&&(n[s]=a),l||(n[s]*=1),f?o[s]=i[s].slice().reverse():o[s]=n[s]||0}}},e.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},e.prototype.end=function(){return this._goToEnd=!0,this.update(this._startTime+this._duration),this},e.prototype.pause=function(t){return t===void 0&&(t=cD()),this._isPaused||!this._isPlaying?this:(this._isPaused=!0,this._pauseStart=t,this)},e.prototype.resume=function(t){return t===void 0&&(t=cD()),!this._isPaused||!this._isPlaying?this:(this._isPaused=!1,this._startTime+=t-this._pauseStart,this._pauseStart=0,this)},e.prototype.stopChainedTweens=function(){for(var t=0,n=this._chainedTweens.length;t<n;t++)this._chainedTweens[t].stop();return this},e.prototype.group=function(t){return t?(t.add(this),this):(console.warn("tween.group() without args has been removed, use group.add(tween) instead."),this)},e.prototype.remove=function(){var t;return(t=this._group)===null||t===void 0||t.remove(this),this},e.prototype.delay=function(t){return t===void 0&&(t=0),this._delayTime=t,this},e.prototype.repeat=function(t){return t===void 0&&(t=0),this._initialRepeat=t,this._repeat=t,this},e.prototype.repeatDelay=function(t){return this._repeatDelayTime=t,this},e.prototype.yoyo=function(t){return t===void 0&&(t=!1),this._yoyo=t,this},e.prototype.easing=function(t){return t===void 0&&(t=Si.Linear.None),this._easingFunction=t,this},e.prototype.interpolation=function(t){return t===void 0&&(t=QA.Linear),this._interpolationFunction=t,this},e.prototype.chain=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return this._chainedTweens=t,this},e.prototype.onStart=function(t){return this._onStartCallback=t,this},e.prototype.onEveryStart=function(t){return this._onEveryStartCallback=t,this},e.prototype.onUpdate=function(t){return this._onUpdateCallback=t,this},e.prototype.onRepeat=function(t){return this._onRepeatCallback=t,this},e.prototype.onComplete=function(t){return this._onCompleteCallback=t,this},e.prototype.onStop=function(t){return this._onStopCallback=t,this},e.prototype.update=function(t,n){var i=this,o;if(t===void 0&&(t=cD()),n===void 0&&(n=e.autoStartOnUpdate),this._isPaused)return!0;var r;if(!this._goToEnd&&!this._isPlaying)if(n)this.start(t,!0);else return!1;if(this._goToEnd=!1,t<this._startTime)return!0;this._onStartCallbackFired===!1&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),this._onEveryStartCallbackFired===!1&&(this._onEveryStartCallback&&this._onEveryStartCallback(this._object),this._onEveryStartCallbackFired=!0);var s=t-this._startTime,a=this._duration+((o=this._repeatDelayTime)!==null&&o!==void 0?o:this._delayTime),l=this._duration+this._repeat*a,u=function(){if(i._duration===0||s>l)return 1;var b=Math.trunc(s/a),x=s-b*a,T=Math.min(x/i._duration,1);return T===0&&s===i._duration?1:T},f=u(),d=this._easingFunction(f);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,d),this._onUpdateCallback&&this._onUpdateCallback(this._object,f),this._duration===0||s>=this._duration)if(this._repeat>0){var p=Math.min(Math.trunc((s-this._duration)/a)+1,this._repeat);isFinite(this._repeat)&&(this._repeat-=p);for(r in this._valuesStartRepeat)!this._yoyo&&typeof this._valuesEnd[r]=="string"&&(this._valuesStartRepeat[r]=this._valuesStartRepeat[r]+parseFloat(this._valuesEnd[r])),this._yoyo&&this._swapEndStartRepeatValues(r),this._valuesStart[r]=this._valuesStartRepeat[r];return this._yoyo&&(this._reversed=!this._reversed),this._startTime+=a*p,this._onRepeatCallback&&this._onRepeatCallback(this._object),this._onEveryStartCallbackFired=!1,!0}else{this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var g=0,m=this._chainedTweens.length;g<m;g++)this._chainedTweens[g].start(this._startTime+this._duration,!1);return this._isPlaying=!1,!1}return!0},e.prototype._updateProperties=function(t,n,i,o){for(var r in i)if(n[r]!==void 0){var s=n[r]||0,a=i[r],l=Array.isArray(t[r]),u=Array.isArray(a),f=!l&&u;f?t[r]=this._interpolationFunction(a,o):typeof a=="object"&&a?this._updateProperties(t[r],s,a,o):(a=this._handleRelativeValue(s,a),typeof a=="number"&&(t[r]=s+(a-s)*o))}},e.prototype._handleRelativeValue=function(t,n){return typeof n!="string"?n:n.charAt(0)==="+"||n.charAt(0)==="-"?t+parseFloat(n):parseFloat(n)},e.prototype._swapEndStartRepeatValues=function(t){var n=this._valuesStartRepeat[t],i=this._valuesEnd[t];typeof i=="string"?this._valuesStartRepeat[t]=this._valuesStartRepeat[t]+parseFloat(i):this._valuesStartRepeat[t]=this._valuesEnd[t],this._valuesEnd[t]=n},e.autoStartOnUpdate=!1,e}();var Hci=hpe.nextId,$h=O9,Gci=$h.getAll.bind($h),jci=$h.removeAll.bind($h),Wci=$h.add.bind($h),qci=$h.remove.bind($h),Yci=$h.update.bind($h);var ett={LINEAR_NONE:Si.Linear.None,QUADRATIC_IN:Si.Quadratic.In,QUADRATIC_OUT:Si.Quadratic.Out,QUADRATIC_IN_OUT:Si.Quadratic.InOut,CUBIC_IN:Si.Cubic.In,CUBIC_OUT:Si.Cubic.Out,CUBIC_IN_OUT:Si.Cubic.InOut,QUARTIC_IN:Si.Quartic.In,QUARTIC_OUT:Si.Quartic.Out,QUARTIC_IN_OUT:Si.Quartic.InOut,QUINTIC_IN:Si.Quintic.In,QUINTIC_OUT:Si.Quintic.Out,QUINTIC_IN_OUT:Si.Quintic.InOut,SINUSOIDAL_IN:Si.Sinusoidal.In,SINUSOIDAL_OUT:Si.Sinusoidal.Out,SINUSOIDAL_IN_OUT:Si.Sinusoidal.InOut,EXPONENTIAL_IN:Si.Exponential.In,EXPONENTIAL_OUT:Si.Exponential.Out,EXPONENTIAL_IN_OUT:Si.Exponential.InOut,CIRCULAR_IN:Si.Circular.In,CIRCULAR_OUT:Si.Circular.Out,CIRCULAR_IN_OUT:Si.Circular.InOut,ELASTIC_IN:Si.Elastic.In,ELASTIC_OUT:Si.Elastic.Out,ELASTIC_IN_OUT:Si.Elastic.InOut,BACK_IN:Si.Back.In,BACK_OUT:Si.Back.Out,BACK_IN_OUT:Si.Back.InOut,BOUNCE_IN:Si.Bounce.In,BOUNCE_OUT:Si.Bounce.Out,BOUNCE_IN_OUT:Si.Bounce.InOut},qr=Object.freeze(ett);function XM(e,t,n){this.type="KmlTourFlyTo",this.blocking=!0,this.activeCamera=null,this.activeCallback=null,this.duration=e,this.view=n,this.flyToMode=t}XM.prototype.play=function(e,t,n){if(this.activeCamera=t,c(e)&&e!==null){let o=this;this.activeCallback=function(r){delete o.activeCallback,delete o.activeCamera,e(c(r)?!1:r)}}let i=this.getCameraOptions(n);if(this.view.headingPitchRoll)t.flyTo(i);else if(this.view.headingPitchRange){let o=new ce(this.view.position);t.flyToBoundingSphere(o,i)}};XM.prototype.stop=function(){c(this.activeCamera)&&this.activeCamera.cancelFlight(),c(this.activeCallback)&&this.activeCallback(!0)};XM.prototype.getCameraOptions=function(e){let t={duration:this.duration};return c(this.activeCallback)&&(t.complete=this.activeCallback),this.flyToMode==="smooth"&&(t.easingFunction=qr.LINEAR_NONE),this.view.headingPitchRoll?(t.destination=this.view.position,t.orientation=this.view.headingPitchRoll):this.view.headingPitchRange&&(t.offset=this.view.headingPitchRange),c(e)&&(t=At(t,e)),t};var R9=XM;function M9(e){this.type="KmlTourWait",this.blocking=!0,this.duration=e,this.timeout=null}M9.prototype.play=function(e){let t=this;this.activeCallback=e,this.timeout=setTimeout(function(){delete t.activeCallback,e(!1)},this.duration*1e3)};M9.prototype.stop=function(){clearTimeout(this.timeout),c(this.activeCallback)&&this.activeCallback(!0)};var L9=M9;var Epe={avi:"video/x-msvideo",bmp:"image/bmp",bz2:"application/x-bzip2",chm:"application/vnd.ms-htmlhelp",css:"text/css",csv:"text/csv",doc:"application/msword",dvi:"application/x-dvi",eps:"application/postscript",flv:"video/x-flv",gif:"image/gif",gz:"application/x-gzip",htm:"text/html",html:"text/html",ico:"image/vnd.microsoft.icon",jnlp:"application/x-java-jnlp-file",jpeg:"image/jpeg",jpg:"image/jpeg",m3u:"audio/x-mpegurl",m4v:"video/mp4",mathml:"application/mathml+xml",mid:"audio/midi",midi:"audio/midi",mov:"video/quicktime",mp3:"audio/mpeg",mp4:"video/mp4",mp4v:"video/mp4",mpeg:"video/mpeg",mpg:"video/mpeg",odp:"application/vnd.oasis.opendocument.presentation",ods:"application/vnd.oasis.opendocument.spreadsheet",odt:"application/vnd.oasis.opendocument.text",ogg:"application/ogg",pdf:"application/pdf",png:"image/png",pps:"application/vnd.ms-powerpoint",ppt:"application/vnd.ms-powerpoint",ps:"application/postscript",qt:"video/quicktime",rdf:"application/rdf+xml",rss:"application/rss+xml",rtf:"application/rtf",svg:"image/svg+xml",swf:"application/x-shockwave-flash",text:"text/plain",tif:"image/tiff",tiff:"image/tiff",txt:"text/plain",wav:"audio/x-wav",wma:"audio/x-ms-wma",wmv:"video/x-ms-wmv",xml:"application/xml",zip:"application/zip",detectFromFilename:function(e){let t=e.toLowerCase();return t=sE(t),Epe[t]}},z9;typeof DOMParser<"u"&&(z9=new DOMParser);var ttt=new jM({stripPrefix:!1,email:!1,replaceFn:function(e){return e.urlMatchType==="scheme"||e.urlMatchType==="www"}}),Wg=32,ppe=2414016,_pe=1,gpe=16093e3,ype=.1,bpe=[null,void 0,"http://www.opengis.net/kml/2.2","http://earth.google.com/kml/2.2","http://earth.google.com/kml/2.1","http://earth.google.com/kml/2.0"],xpe=["http://www.google.com/kml/ext/2.2"],ntt=["http://www.w3.org/2005/Atom"],Re={kml:bpe,gx:xpe,atom:ntt,kmlgx:bpe.concat(xpe)},H9={Document:Lpe,Folder:Ttt,Placemark:Att,NetworkLink:Ott,GroundOverlay:Dtt,PhotoOverlay:Bpe,ScreenOverlay:vtt,Tour:Ett};function Zh(e){this._dataSource=e,this._deferred=Pu(),this._stack=[],this._promises=[],this._timeoutSet=!1,this._used=!1,this._started=0,this._timeThreshold=1e3}Object.defineProperties(Zh.prototype,{dataSource:{get:function(){return this._dataSource}}});Zh.prototype.addNodes=function(e,t){this._stack.push({nodes:e,index:0,processingData:t}),this._used=!0};Zh.prototype.addPromise=function(e){this._promises.push(e)};Zh.prototype.wait=function(){let e=this._deferred;return this._used||e.resolve(),Promise.all([e.promise,Promise.all(this._promises)])};Zh.prototype.process=function(){let e=this._stack.length===1;return e&&(this._started=au._getTimestamp()),this._process(e)};Zh.prototype._giveUpTime=function(){if(this._timeoutSet)return;this._timeoutSet=!0,this._timeThreshold=50;let e=this;setTimeout(function(){e._timeoutSet=!1,e._started=au._getTimestamp(),e._process(!0)},0)};Zh.prototype._nextNode=function(){let e=this._stack,t=e[e.length-1],n=t.index,i=t.nodes;if(n!==i.length)return++t.index,i[n]};Zh.prototype._pop=function(){let e=this._stack;return e.pop(),e.length===0?(this._deferred.resolve(),!1):!0};Zh.prototype._process=function(e){let t=this.dataSource,n=this._stack[this._stack.length-1].processingData,i=this._nextNode();for(;c(i);){let o=H9[i.localName];if(c(o)&&(Re.kml.indexOf(i.namespaceURI)!==-1||Re.gx.indexOf(i.namespaceURI)!==-1)&&(o(t,i,n,this),this._timeoutSet||au._getTimestamp()>this._started+this._timeThreshold)){this._giveUpTime();return}i=this._nextNode()}this._pop()&&e&&this._process(!0)};function itt(e){let t=e.slice(0,Math.min(4,e.size)),n=Pu(),i=new FileReader;return i.addEventListener("load",function(){n.resolve(new DataView(i.result).getUint32(0,!1)===1347093252)}),i.addEventListener("error",function(){n.reject(i.error)}),i.readAsArrayBuffer(t),n.promise}function ott(e){let t=Pu(),n=new FileReader;return n.addEventListener("load",function(){t.resolve(n.result)}),n.addEventListener("error",function(){t.reject(n.error)}),n.readAsText(e),t.promise}function Spe(e){let t={xsi:"http://www.w3.org/2001/XMLSchema-instance"},n,i,o,r;for(let s in t)t.hasOwnProperty(s)&&(o=RegExp(`[< ]${s}:`),r=`xmlns:${s}=`,o.test(e)&&e.indexOf(r)===-1&&(c(n)||(n=e.substr(0,e.indexOf("<kml")+4),i=e.substr(n.length)),n+=` ${r}"${t[s]}"`));return c(n)&&(e=n+i),e}function wpe(e){let t=e.indexOf("xmlns:"),n=e.indexOf(">",t),i,o,r;for(;t!==-1&&t<n;)i=e.slice(t,e.indexOf('"',t)),o=t,t=e.indexOf(i,t+1),t!==-1?(r=e.indexOf('"',e.indexOf('"',t)+1),e=e.slice(0,t-1)+e.slice(r+1,e.length),t=e.indexOf("xmlns:",o-1)):t=e.indexOf("xmlns:",o+1);return e}function rtt(e,t){return Promise.resolve(e.getData(new dM)).then(function(n){n=Spe(n),n=wpe(n),t.kml=z9.parseFromString(n,"application/xml")})}function N9(e,t){let n=y(Epe.detectFromFilename(e.filename),"application/octet-stream");return Promise.resolve(e.getData(new uM(n))).then(function(i){t[e.filename]=i})}function ru(e,t,n,i){let o=i.keys,r=new lD.default("."),s=e.querySelectorAll(t);for(let a=0;a<s.length;a++){let l=s[a],u=l.getAttribute(n);if(c(u)){let d=new lD.default(u).absoluteTo(r).toString(),p=o.indexOf(d);if(p!==-1){let g=o[p];l.setAttribute(n,i[g]),t==="a"&&l.getAttribute("download")===null&&l.setAttribute("download",g)}}}}function su(e,t,n,i){let o=e.querySelectorAll(t);for(let r=0;r<o.length;r++){let s=o[r],a=s.getAttribute(n),l=G9(a,i);c(l)&&s.setAttribute(n,l.url)}}function vpe(e,t,n){let i=_s(e,"id");i=c(i)&&i.length!==0?i:Hn(),c(n)&&(i=n+i);let o=t.getById(i);return c(o)&&(i=Hn(),c(n)&&(i=n+i)),o=t.add(new Qo({id:i})),c(o.kml)||(o.addProperty("kml"),o.kml=new Ntt),o}function uD(e,t){return e==="absolute"||e==="relativeToGround"||t==="relativeToSeaFloor"}function JM(e,t){if(!c(e))return h.fromDegrees(0,0,0,t);let n=e.match(/[^\s,\n]+/g);if(!c(n))return h.fromDegrees(0,0,0,t);let i=parseFloat(n[0]),o=parseFloat(n[1]),r=parseFloat(n[2]);return i=isNaN(i)?0:i,o=isNaN(o)?0:o,r=isNaN(r)?0:r,h.fromDegrees(i,o,r,t)}function KM(e,t){if(!c(e))return;let n=e.textContent.match(/[^\s\n]+/g);if(!c(n))return;let i=n.length,o=new Array(i),r=0;for(let s=0;s<i;s++)o[r++]=JM(n[s],t);return o}function qg(e,t){if(!c(e))return;let n=e.getAttribute(t);if(n!==null){let i=parseFloat(n);return isNaN(i)?void 0:i}}function _s(e,t){if(!c(e))return;let n=e.getAttribute(t);return n!==null?n:void 0}function wi(e,t,n){if(!c(e))return;let i=e.childNodes,o=i.length;for(let r=0;r<o;r++){let s=i[r];if(s.localName===t&&n.indexOf(s.namespaceURI)!==-1)return s}}function Tpe(e,t,n){if(!c(e))return;let i=[],o=e.getElementsByTagNameNS("*",t),r=o.length;for(let s=0;s<r;s++){let a=o[s];a.localName===t&&n.indexOf(a.namespaceURI)!==-1&&i.push(a)}return i}function Rd(e,t,n){if(!c(e))return[];let i=[],o=e.childNodes,r=o.length;for(let s=0;s<r;s++){let a=o[s];a.localName===t&&n.indexOf(a.namespaceURI)!==-1&&i.push(a)}return i}function Yn(e,t,n){let i=wi(e,t,n);if(c(i)){let o=parseFloat(i.textContent);return isNaN(o)?void 0:o}}function Dn(e,t,n){let i=wi(e,t,n);if(c(i))return i.textContent.trim()}function Md(e,t,n){let i=wi(e,t,n);if(c(i)){let o=i.textContent.trim();return o==="1"||/^true$/i.test(o)}}function G9(e,t,n){if(!c(e))return;let i;if(c(n)){e=e.replace(/\\/g,"/");let o=n[e];if(c(o))i=new De({url:o});else{let r=new lD.default(t.getUrlComponent()),s=new lD.default(e);o=n[s.absoluteTo(r)],c(o)&&(i=new De({url:o}))}}return c(i)||(i=t.getDerivedResource({url:e})),i}var bl={maximumRed:void 0,red:void 0,maximumGreen:void 0,green:void 0,maximumBlue:void 0,blue:void 0};function V9(e,t){if(!c(e)||/^\s*$/gm.test(e))return;e[0]==="#"&&(e=e.substring(1));let n=parseInt(e.substring(0,2),16)/255,i=parseInt(e.substring(2,4),16)/255,o=parseInt(e.substring(4,6),16)/255,r=parseInt(e.substring(6,8),16)/255;return t?(r>0?(bl.maximumRed=r,bl.red=void 0):(bl.maximumRed=void 0,bl.red=0),o>0?(bl.maximumGreen=o,bl.green=void 0):(bl.maximumGreen=void 0,bl.green=0),i>0?(bl.maximumBlue=i,bl.blue=void 0):(bl.maximumBlue=void 0,bl.blue=0),bl.alpha=n,j.fromRandom(bl)):new j(r,o,i,n)}function Db(e,t,n){let i=Dn(e,t,n);if(c(i))return V9(i,Dn(e,"colorMode",n)==="random")}function stt(e){let t=wi(e,"TimeStamp",Re.kmlgx),n=Dn(t,"when",Re.kmlgx);if(!c(t)||!c(n)||n.length===0)return;let i=J.fromIso8601(n),o=new ts;return o.addInterval(new wn({start:i,stop:je.MAXIMUM_VALUE})),o}function att(e){let t=wi(e,"TimeSpan",Re.kmlgx);if(!c(t))return;let n,i=wi(t,"begin",Re.kmlgx),o=c(i)?J.fromIso8601(i.textContent):void 0,r=wi(t,"end",Re.kmlgx),s=c(r)?J.fromIso8601(r.textContent):void 0;if(c(o)&&c(s)){if(J.lessThan(s,o)){let a=o;o=s,s=a}n=new ts,n.addInterval(new wn({start:o,stop:s}))}else c(o)?(n=new ts,n.addInterval(new wn({start:o,stop:je.MAXIMUM_VALUE}))):c(s)&&(n=new ts,n.addInterval(new wn({start:je.MINIMUM_VALUE,stop:s})));return n}function Dpe(){let e=new Wc;return e.width=Wg,e.height=Wg,e.scaleByDistance=new Vt(ppe,_pe,gpe,ype),e.pixelOffsetScaleByDistance=new Vt(ppe,_pe,gpe,ype),e}function j9(){let e=new Um;return e.outline=!0,e.outlineColor=j.WHITE,e}function Ppe(){let e=new km;return e.translucencyByDistance=new Vt(3e6,1,5e6,0),e.pixelOffset=new H(17,0),e.horizontalOrigin=bi.LEFT,e.font="16px sans-serif",e.style=ir.FILL_AND_OUTLINE,e}function W9(e,t,n,i,o){let r=Dn(e,"href",Re.kml);if(!c(r)||r.length===0)return;if(r.indexOf("root://icons/palette-")===0){let a=r.charAt(21),l=y(Yn(e,"x",Re.gx),0),u=y(Yn(e,"y",Re.gx),0);l=Math.min(l/32,7),u=7-Math.min(u/32,7);let f=8*u+l;r=`https://maps.google.com/mapfiles/kml/pal${a}/icon${f}.png`}let s=G9(r,n,i);if(o){let a=Dn(e,"refreshMode",Re.kml),l=Dn(e,"viewRefreshMode",Re.kml);a==="onInterval"||a==="onExpire"?_t(`kml-refreshMode-${a}`,`KML - Unsupported Icon refreshMode: ${a}`):(l==="onStop"||l==="onRegion")&&_t(`kml-refreshMode-${l}`,`KML - Unsupported Icon viewRefreshMode: ${l}`);let u=y(Dn(e,"viewBoundScale",Re.kml),1),f=l==="onStop"?"BBOX=[bboxWest],[bboxSouth],[bboxEast],[bboxNorth]":"",d=y(Dn(e,"viewFormat",Re.kml),f),p=Dn(e,"httpQuery",Re.kml);c(d)&&s.setQueryParameters(Bf(ZM(d))),c(p)&&s.setQueryParameters(Bf(ZM(p)));let g=t._ellipsoid;return Y9(s,t.camera,t.canvas,u,t._lastCameraView.bbox,g),s}return s}function ctt(e,t,n,i,o){let r=Yn(t,"scale",Re.kml),s=Yn(t,"heading",Re.kml),a=Db(t,"color",Re.kml),l=wi(t,"Icon",Re.kml),u=W9(l,e,i,o,!1);c(l)&&!c(u)&&(u=!1);let f=Yn(l,"x",Re.gx),d=Yn(l,"y",Re.gx),p=Yn(l,"w",Re.gx),g=Yn(l,"h",Re.gx),m=wi(t,"hotSpot",Re.kml),b=qg(m,"x"),x=qg(m,"y"),T=_s(m,"xunits"),C=_s(m,"yunits"),S=n.billboard;c(S)||(S=Dpe(),n.billboard=S),S.image=u,S.scale=r,S.color=a,(c(f)||c(d)||c(p)||c(g))&&(S.imageSubRegion=new Ke(f,d,p,g)),c(s)&&s!==0&&(S.rotation=R.toRadians(-s),S.alignedAxis=h.UNIT_Z),r=y(r,1);let v,D;c(b)&&(T==="pixels"?v=-b*r:T==="insetPixels"?v=(b-Wg)*r:T==="fraction"&&(v=-b*Wg*r),v+=Wg*.5*r),c(x)&&(C==="pixels"?D=x*r:C==="insetPixels"?D=(-x+Wg)*r:C==="fraction"&&(D=x*Wg*r),D-=Wg*.5*r),(c(v)||c(D))&&(S.pixelOffset=new H(v,D))}function $M(e,t,n,i,o){for(let r=0,s=t.childNodes.length;r<s;r++){let a=t.childNodes.item(r);if(a.localName==="IconStyle")ctt(e,a,n,i,o);else if(a.localName==="LabelStyle"){let l=n.label;c(l)||(l=Ppe(),n.label=l),l.scale=y(Yn(a,"scale",Re.kml),l.scale),l.fillColor=y(Db(a,"color",Re.kml),l.fillColor),l.text=n.name}else if(a.localName==="LineStyle"){let l=n.polyline;c(l)||(l=new el,n.polyline=l),l.width=Yn(a,"width",Re.kml),l.material=Db(a,"color",Re.kml),c(Db(a,"outerColor",Re.gx))&&_t("kml-gx:outerColor","KML - gx:outerColor is not supported in a LineStyle"),c(Yn(a,"outerWidth",Re.gx))&&_t("kml-gx:outerWidth","KML - gx:outerWidth is not supported in a LineStyle"),c(Yn(a,"physicalWidth",Re.gx))&&_t("kml-gx:physicalWidth","KML - gx:physicalWidth is not supported in a LineStyle"),c(Md(a,"labelVisibility",Re.gx))&&_t("kml-gx:labelVisibility","KML - gx:labelVisibility is not supported in a LineStyle")}else if(a.localName==="PolyStyle"){let l=n.polygon;c(l)||(l=j9(),n.polygon=l),l.material=y(Db(a,"color",Re.kml),l.material),l.fill=y(Md(a,"fill",Re.kml),l.fill),l.outline=y(Md(a,"outline",Re.kml),l.outline)}else if(a.localName==="BalloonStyle"){let l=y(V9(Dn(a,"bgColor",Re.kml)),j.WHITE),u=y(V9(Dn(a,"textColor",Re.kml)),j.BLACK),f=Dn(a,"text",Re.kml);n.addProperty("balloonStyle"),n.balloonStyle={bgColor:l,textColor:u,text:f}}else if(a.localName==="ListStyle"){let l=Dn(a,"listItemType",Re.kml);(l==="radioFolder"||l==="checkOffOnly")&&_t(`kml-listStyle-${l}`,`KML - Unsupported ListStyle with listItemType: ${l}`)}}}function ltt(e,t,n,i,o){let r=new Qo,s,a=-1,l=t.childNodes,u=l.length;for(let d=0;d<u;d++){let p=l[d];(p.localName==="Style"||p.localName==="StyleMap")&&(a=d)}if(a!==-1){let d=l[a];if(d.localName==="Style")$M(e,d,r,i,o);else{let p=Rd(d,"Pair",Re.kml);for(let g=0;g<p.length;g++){let m=p[g],b=Dn(m,"key",Re.kml);if(b==="normal"){let x=Dn(m,"styleUrl",Re.kml);if(c(x))s=n.getById(x),c(s)||(s=n.getById(`#${x}`)),c(s)&&r.merge(s);else{let T=wi(m,"Style",Re.kml);$M(e,T,r,i,o)}}else _t(`kml-styleMap-${b}`,`KML - Unsupported StyleMap key: ${b}`)}}}let f=Dn(t,"styleUrl",Re.kml);if(c(f)){let d=f;if(f[0]!=="#"&&f.indexOf("#")!==-1){let p=f.split("#"),g=p[0];d=`${i.getDerivedResource({url:g}).getUrlComponent()}#${p[1]}`}s=n.getById(d),c(s)||(s=n.getById(`#${d}`)),c(s)&&r.merge(s)}return r}function utt(e,t,n){return t.fetchXML().then(function(i){return Ipe(e,i,n,t,!0)})}function Ipe(e,t,n,i,o,r){let s,a,l,u,f=Tpe(t,"Style",Re.kml);if(c(f)){let b=f.length;for(s=0;s<b;s++)u=f[s],a=_s(u,"id"),c(a)&&(a=`#${a}`,o&&c(i)&&(a=i.getUrlComponent()+a),c(n.getById(a))||(l=new Qo({id:a}),n.add(l),$M(e,u,l,i,r)))}let d=Tpe(t,"StyleMap",Re.kml);if(c(d)){let b=d.length;for(s=0;s<b;s++){let x=d[s];if(a=_s(x,"id"),c(a)){let T=Rd(x,"Pair",Re.kml);for(let C=0;C<T.length;C++){let S=T[C],v=Dn(S,"key",Re.kml);if(v==="normal"){if(a=`#${a}`,o&&c(i)&&(a=i.getUrlComponent()+a),!c(n.getById(a))){l=n.getOrCreateEntity(a);let D=Dn(S,"styleUrl",Re.kml);if(c(D)){D[0]!=="#"&&(D=`#${D}`),o&&c(i)&&(D=i.getUrlComponent()+D);let I=n.getById(D);c(I)&&l.merge(I)}else u=wi(S,"Style",Re.kml),$M(e,u,l,i,r)}}else _t(`kml-styleMap-${v}`,`KML - Unsupported StyleMap key: ${v}`)}}}}let p=[],g=t.getElementsByTagName("styleUrl"),m=g.length;for(s=0;s<m;s++){let b=g[s].textContent;if(b[0]!=="#"){let x=b.split("#");if(x.length===2){let T=x[0],C=i.getDerivedResource({url:T});p.push(utt(e,C,n))}}}return p}function q9(e,t,n){let i=new ib(e,t.id,["position"]),o=new Pg(t.position);t.polyline=c(n.polyline)?n.polyline.clone():new el,t.polyline.positions=new tb([i,o])}function Ope(e,t){return!c(e)&&!c(t)||e==="clampToGround"?$e.CLAMP_TO_GROUND:e==="relativeToGround"?$e.RELATIVE_TO_GROUND:e==="absolute"?$e.NONE:t==="clampToSeaFloor"?(_t("kml-gx:altitudeMode-clampToSeaFloor","KML - <gx:altitudeMode>:clampToSeaFloor is currently not supported, using <kml:altitudeMode>:clampToGround."),$e.CLAMP_TO_GROUND):t==="relativeToSeaFloor"?(_t("kml-gx:altitudeMode-relativeToSeaFloor","KML - <gx:altitudeMode>:relativeToSeaFloor is currently not supported, using <kml:altitudeMode>:relativeToGround."),$e.RELATIVE_TO_GROUND):(c(e)?_t("kml-altitudeMode-unknown",`KML - Unknown <kml:altitudeMode>:${e}, using <kml:altitudeMode>:CLAMP_TO_GROUND.`):_t("kml-gx:altitudeMode-unknown",`KML - Unknown <gx:altitudeMode>:${t}, using <kml:altitudeMode>:CLAMP_TO_GROUND.`),$e.CLAMP_TO_GROUND)}function ftt(e,t,n){return n==="relativeToSeaFloor"||t==="absolute"||t==="relativeToGround"?e:((c(t)&&t!=="clampToGround"||c(n)&&n!=="clampToSeaFloor")&&_t("kml-altitudeMode-unknown",`KML - Unknown altitudeMode: ${y(t,n)}`),new Pg(e))}function dtt(e,t,n,i){if(!c(e))return;if(n==="relativeToSeaFloor"||t==="absolute"||t==="relativeToGround")return e;(c(t)&&t!=="clampToGround"||c(n)&&n!=="clampToSeaFloor")&&_t("kml-altitudeMode-unknown",`KML - Unknown altitudeMode: ${y(t,n)}`);let o=e.length;for(let r=0;r<o;r++){let s=e[r];i.scaleToGeodeticSurface(s,s)}return e}function QM(e,t,n,i){let o=t.label;c(o)||(o=c(n.label)?n.label.clone():Ppe(),t.label=o),o.text=t.name;let r=t.billboard;c(r)||(r=c(n.billboard)?n.billboard.clone():Dpe(),t.billboard=r),c(r.image)?r.image.getValue()||(r.image=void 0):r.image=e._pinBuilder.fromColor(j.YELLOW,64);let s=1;c(r.scale)&&(s=r.scale.getValue(),s!==0?o.pixelOffset=new H(s*16+1,0):(o.pixelOffset=void 0,o.horizontalOrigin=void 0)),c(i)&&e._clampToGround&&(r.heightReference=i,o.heightReference=i)}function Rpe(e,t){let n=e.path;c(n)||(n=new Qy,n.leadTime=0,e.path=n);let i=t.polyline;c(i)&&(n.material=i.material,n.width=i.width)}function htt(e,t,n,i,o){let r=Dn(n,"coordinates",Re.kml),s=Dn(n,"altitudeMode",Re.kml),a=Dn(n,"altitudeMode",Re.gx),l=Md(n,"extrude",Re.kml),u=e._ellipsoid,f=JM(r,u);return i.position=f,QM(e,i,o,Ope(s,a)),l&&uD(s,a)&&q9(t,i,o),!0}function Ape(e,t,n,i,o){let r=wi(n,"coordinates",Re.kml),s=Dn(n,"altitudeMode",Re.kml),a=Dn(n,"altitudeMode",Re.gx),l=Md(n,"extrude",Re.kml),u=Md(n,"tessellate",Re.kml),f=uD(s,a),d=Yn(n,"drawOrder",Re.gx),p=e._ellipsoid,g=KM(r,p),m=o.polyline;if(f&&l){let b=new e0;i.wall=b,b.positions=g;let x=o.polygon;c(x)&&(b.fill=x.fill,b.material=x.material),b.outline=!0,c(m)?(b.outlineColor=c(m.material)?m.material.color:j.WHITE,b.outlineWidth=m.width):c(x)&&(b.outlineColor=c(x.material)?x.material.color:j.WHITE)}else if(e._clampToGround&&!f&&u){let b=new el;b.clampToGround=!0,i.polyline=b,b.positions=g,c(m)?(b.material=c(m.material)?m.material.color.getValue(je.MINIMUM_VALUE):j.WHITE,b.width=y(m.width,1)):(b.material=j.WHITE,b.width=1),b.zIndex=d}else c(d)&&_t("kml-gx:drawOrder","KML - gx:drawOrder is not supported in LineStrings when clampToGround is false"),e._clampToGround&&!u&&_t("kml-line-tesselate","Ignoring clampToGround for KML lines without the tessellate flag."),m=c(m)?m.clone():new el,i.polyline=m,m.positions=dtt(g,s,a,p),(!u||f)&&(m.arcType=Yt.NONE);return!0}function mtt(e,t,n,i,o){let r=wi(n,"outerBoundaryIs",Re.kml),s=wi(r,"LinearRing",Re.kml),a=wi(s,"coordinates",Re.kml),l=e._ellipsoid,u=KM(a,l),f=Md(n,"extrude",Re.kml),d=Dn(n,"altitudeMode",Re.kml),p=Dn(n,"altitudeMode",Re.gx),g=uD(d,p),m=c(o.polygon)?o.polygon.clone():j9(),b=o.polyline;if(c(b)&&(m.outlineColor=c(b.material)?b.material.color:j.WHITE,m.outlineWidth=b.width),i.polygon=m,g?(m.perPositionHeight=!0,m.extrudedHeight=f?0:void 0):e._clampToGround||(m.height=0),c(u)){let x=new _c(u),T=Rd(n,"innerBoundaryIs",Re.kml);for(let C=0;C<T.length;C++){s=Rd(T[C],"LinearRing",Re.kml);for(let S=0;S<s.length;S++)a=wi(s[S],"coordinates",Re.kml),u=KM(a,l),c(u)&&x.holes.push(new _c(u))}m.hierarchy=x}return!0}function ptt(e,t,n,i,o){let r=Dn(n,"altitudeMode",Re.kml),s=Dn(n,"altitudeMode",Re.gx),a=Rd(n,"coord",Re.gx),l=Rd(n,"angles",Re.gx),u=Rd(n,"when",Re.kml),f=Md(n,"extrude",Re.kml),d=uD(r,s),p=e._ellipsoid;l.length>0&&_t("kml-gx:angles","KML - gx:angles are not supported in gx:Tracks");let g=Math.min(a.length,u.length),m=[],b=[];for(let T=0;T<g;T++){let C=JM(a[T].textContent,p);m.push(C),b.push(J.fromIso8601(u[T].textContent))}let x=new Ja;return x.addSamples(b,m),i.position=x,QM(e,i,o,Ope(r,s)),Rpe(i,o),i.availability=new ts,u.length>0&&i.availability.addInterval(new wn({start:b[0],stop:b[b.length-1]})),d&&f&&q9(t,i,o),!0}function Cpe(e,t,n,i,o,r,s,a,l){let u=e[0],f=e[e.length-1],d=new Ja;d.addSamples(e,t),n.intervals.addInterval(new wn({start:u,stop:f,isStartIncluded:l,isStopIncluded:l,data:ftt(d,s,a)})),i.addInterval(new wn({start:u,stop:f,isStartIncluded:l,isStopIncluded:l})),o.intervals.addInterval(new wn({start:u,stop:f,isStartIncluded:l,isStopIncluded:l,data:r}))}function _tt(e,t,n,i,o){let r=Md(n,"interpolate",Re.gx),s=Rd(n,"Track",Re.gx),a,l,u,f=!1,d=new sb,p=new ts,g=new Ka,m=e._ellipsoid;for(let b=0,x=s.length;b<x;b++){let T=s[b],C=Rd(T,"when",Re.kml),S=Rd(T,"coord",Re.gx),v=Dn(T,"altitudeMode",Re.kml),D=Dn(T,"altitudeMode",Re.gx),I=uD(v,D),L=Md(T,"extrude",Re.kml),M=Math.min(S.length,C.length),N=[];a=[];for(let B=0;B<M;B++){let _=JM(S[B].textContent,m);N.push(_),a.push(J.fromIso8601(C[B].textContent))}r&&(c(l)&&Cpe([l,a[0]],[u,N[0]],g,p,d,!1,"absolute",void 0,!1),l=a[M-1],u=N[N.length-1]),Cpe(a,N,g,p,d,I&&L,v,D,!0),f=f||I&&L}return i.availability=p,i.position=g,QM(e,i,o),Rpe(i,o),f&&(q9(t,i,o),i.polyline.show=d),!0}var Mpe={Point:htt,LineString:Ape,LinearRing:Ape,Polygon:mtt,Track:ptt,MultiTrack:_tt,MultiGeometry:gtt,Model:ytt};function gtt(e,t,n,i,o,r){let s=n.childNodes,a=!1;for(let l=0,u=s.length;l<u;l++){let f=s.item(l),d=Mpe[f.localName];if(c(d)){let p=vpe(f,t,r);p.parent=i,p.name=i.name,p.availability=i.availability,p.description=i.description,p.kml=i.kml,d(e,t,f,p,o)&&(a=!0)}}return a}function ytt(e,t,n,i,o){return _t("kml-unsupportedGeometry",`KML - Unsupported geometry: ${n.localName}`),!1}function btt(e,t){let n=wi(e,"ExtendedData",Re.kml);if(!c(n))return;c(wi(n,"SchemaData",Re.kml))&&_t("kml-schemaData","KML - SchemaData is unsupported"),c(_s(n,"xmlns:prefix"))&&_t("kml-extendedData","KML - ExtendedData with xmlns:prefix is unsupported");let i={},o=Rd(n,"Data",Re.kml);if(c(o)){let r=o.length;for(let s=0;s<r;s++){let a=o[s],l=_s(a,"name");c(l)&&(i[l]={displayName:Dn(a,"displayName",Re.kml),value:Dn(a,"value",Re.kml)})}}t.kml.extendedData=i}var ro;typeof document<"u"&&(ro=document.createElement("div"));function xtt(e,t,n,i,o){let r,s,a,l=t.kml,u=l.extendedData,f=Dn(e,"description",Re.kml),d=y(t.balloonStyle,n.balloonStyle),p=j.WHITE,g=j.BLACK,m=f;c(d)&&(p=y(d.bgColor,j.WHITE),g=y(d.textColor,j.BLACK),m=y(d.text,f));let b;if(c(m)){if(m=m.replace("$[name]",y(t.name,"")),m=m.replace("$[description]",y(f,"")),m=m.replace("$[address]",y(l.address,"")),m=m.replace("$[Snippet]",y(l.snippet,"")),m=m.replace("$[id]",t.id),m=m.replace("$[geDirections]",""),c(u)){let C=m.match(/\$\[.+?\]/g);if(C!==null)for(r=0;r<C.length;r++){let S=C[r],v=S.substr(2,S.length-3),D=/\/displayName$/.test(v);v=v.replace(/\/displayName$/,""),b=u[v],c(b)&&(b=D?b.displayName:b.value),c(b)&&(m=m.replace(S,y(b,"")))}}}else if(c(u)&&(a=Object.keys(u),a.length>0)){for(m='<table class="cesium-infoBox-defaultTable cesium-infoBox-defaultTable-lighter"><tbody>',r=0;r<a.length;r++)s=a[r],b=u[s],m+=`<tr><th>${y(b.displayName,s)}</th><td>${y(b.value,"")}</td></tr>`;m+="</tbody></table>"}if(!c(m))return;m=ttt.link(m),ro.innerHTML=m;let x=ro.querySelectorAll("a");for(r=0;r<x.length;r++)x[r].setAttribute("target","_blank");c(i)&&i.keys.length>1&&(ru(ro,"a","href",i),ru(ro,"link","href",i),ru(ro,"area","href",i),ru(ro,"img","src",i),ru(ro,"iframe","src",i),ru(ro,"video","src",i),ru(ro,"audio","src",i),ru(ro,"source","src",i),ru(ro,"track","src",i),ru(ro,"input","src",i),ru(ro,"embed","src",i),ru(ro,"script","src",i),ru(ro,"video","poster",i)),su(ro,"a","href",o),su(ro,"link","href",o),su(ro,"area","href",o),su(ro,"img","src",o),su(ro,"iframe","src",o),su(ro,"video","src",o),su(ro,"audio","src",o),su(ro,"source","src",o),su(ro,"track","src",o),su(ro,"input","src",o),su(ro,"embed","src",o),su(ro,"script","src",o),su(ro,"video","poster",o);let T='<div class="cesium-infoBox-description-lighter" style="';T+="overflow:auto;",T+="word-wrap:break-word;",T+=`background-color:${p.toCssColorString()};`,T+=`color:${g.toCssColorString()};`,T+='">',T+=`${ro.innerHTML}</div>`,ro.innerHTML="",t.description=T}function eL(e,t,n){let i=n.entityCollection,o=n.parentEntity,r=n.sourceResource,s=n.uriResolver,a=vpe(t,i,n.context),l=a.kml,u=ltt(e,t,n.styleCollection,r,s),f=Dn(t,"name",Re.kml);a.name=f,a.parent=o;let d=att(t);c(d)||(d=stt(t)),a.availability=d,K9(a);function p(S){return S?S.show&&p(S.parent):!0}let g=Md(t,"visibility",Re.kml);a.show=p(o)&&y(g,!0);let m=wi(t,"author",Re.atom),b=l.author;b.name=Dn(m,"name",Re.atom),b.uri=Dn(m,"uri",Re.atom),b.email=Dn(m,"email",Re.atom);let x=wi(t,"link",Re.atom),T=l.link;T.href=_s(x,"href"),T.hreflang=_s(x,"hreflang"),T.rel=_s(x,"rel"),T.type=_s(x,"type"),T.title=_s(x,"title"),T.length=_s(x,"length"),l.address=Dn(t,"address",Re.kml),l.phoneNumber=Dn(t,"phoneNumber",Re.kml),l.snippet=Dn(t,"Snippet",Re.kml),btt(t,a),xtt(t,a,u,s,r);let C=e._ellipsoid;return Fpe(t,a,C),Npe(t,a,C),c(wi(t,"Region",Re.kml))&&_t("kml-region","KML - Placemark Regions are unsupported"),{entity:a,styleEntity:u}}function Lpe(e,t,n,i){i.addNodes(t.childNodes,n),i.process()}function Ttt(e,t,n,i){let o=eL(e,t,n),r=qe(n);r.parentEntity=o.entity,Lpe(e,t,r,i)}function Att(e,t,n,i){let o=eL(e,t,n),r=o.entity,s=o.styleEntity,a=!1,l=t.childNodes;for(let u=0,f=l.length;u<f&&!a;u++){let d=l.item(u),p=Mpe[d.localName];c(p)&&(p(e,n.entityCollection,d,r,s,r.id),a=!0)}a||(r.merge(s),QM(e,r,s))}var Ctt={FlyTo:wtt,Wait:Stt,SoundCue:F9,AnimatedUpdate:F9,TourControl:F9};function Ett(e,t,n,i){let o=Dn(t,"name",Re.kml),r=_s(t,"id"),s=new I9(o,r),a=wi(t,"Playlist",Re.gx);if(a){let l=e._ellipsoid,u=a.childNodes;for(let f=0;f<u.length;f++){let d=u[f];if(d.localName){let p=Ctt[d.localName];p?p(s,d,l):console.log(`Unknown KML Tour playlist entry type ${d.localName}`)}}}e._kmlTours.push(s)}function F9(e,t){_t(`KML Tour unsupported node ${t.localName}`)}function Stt(e,t){let n=Yn(t,"duration",Re.gx);e.addPlaylistEntry(new L9(n))}function wtt(e,t,n){let i=Yn(t,"duration",Re.gx),o=Dn(t,"flyToMode",Re.gx),r={kml:{}};Fpe(t,r,n),Npe(t,r,n);let s=r.kml.lookAt||r.kml.camera,a=new R9(i,o,s);e.addPlaylistEntry(a)}function Npe(e,t,n){let i=wi(e,"Camera",Re.kml);if(c(i)){let o=y(Yn(i,"longitude",Re.kml),0),r=y(Yn(i,"latitude",Re.kml),0),s=y(Yn(i,"altitude",Re.kml),0),a=y(Yn(i,"heading",Re.kml),0),l=y(Yn(i,"tilt",Re.kml),0),u=y(Yn(i,"roll",Re.kml),0),f=h.fromDegrees(o,r,s,n),d=Fa.fromDegrees(a,l-90,u);t.kml.camera=new D9(f,d)}}function Fpe(e,t,n){let i=wi(e,"LookAt",Re.kml);if(c(i)){let o=y(Yn(i,"longitude",Re.kml),0),r=y(Yn(i,"latitude",Re.kml),0),s=y(Yn(i,"altitude",Re.kml),0),a=Yn(i,"heading",Re.kml),l=Yn(i,"tilt",Re.kml),u=y(Yn(i,"range",Re.kml),0);l=R.toRadians(y(l,0)),a=R.toRadians(y(a,0));let f=new zh(a,l-R.PI_OVER_TWO,u),d=h.fromDegrees(o,r,s,n);t.kml.lookAt=new P9(d,f)}}function vtt(e,t,n,i){let o=n.screenOverlayContainer;if(!c(o))return;let r=n.sourceResource,s=n.uriResolver,a=wi(t,"Icon",Re.kml),l=W9(a,e,r,s,!1);if(!c(l))return;let u=document.createElement("img");e._screenOverlays.push(u),u.src=l.url,u.onload=function(){let f=["position: absolute"],d=wi(t,"screenXY",Re.kml),p=wi(t,"overlayXY",Re.kml),g=wi(t,"size",Re.kml),m,b,x,T,C,S;c(g)&&(m=qg(g,"x"),b=qg(g,"y"),x=_s(g,"xunits"),T=_s(g,"yunits"),c(m)&&m!==-1&&m!==0&&(x==="fraction"?C=`width: ${Math.floor(m*100)}%`:x==="pixels"&&(C=`width: ${m}px`),f.push(C)),c(b)&&b!==-1&&b!==0&&(T==="fraction"?S=`height: ${Math.floor(b*100)}%`:T==="pixels"&&(S=`height: ${b}px`),f.push(S))),u.style=f.join(";");let v=0,D=u.height;c(p)&&(m=qg(p,"x"),b=qg(p,"y"),x=_s(p,"xunits"),T=_s(p,"yunits"),c(m)&&(x==="fraction"?v=m*u.width:(x==="pixels"||x==="insetPixels")&&(v=m)),c(b)&&(T==="fraction"?D=b*u.height:(T==="pixels"||T==="insetPixels")&&(D=b))),c(d)&&(m=qg(d,"x"),b=qg(d,"y"),x=_s(d,"xunits"),T=_s(d,"yunits"),c(m)&&(x==="fraction"?C=`left: calc(${Math.floor(m*100)}% - ${v}px)`:x==="pixels"?C=`left: ${m-v}px`:x==="insetPixels"&&(C=`right: ${m-v}px`),f.push(C)),c(b)&&(T==="fraction"?S=`bottom: calc(${Math.floor(b*100)}% - ${D}px)`:T==="pixels"?S=`bottom: ${b-D}px`:T==="insetPixels"&&(S=`top: ${b-D}px`),f.push(S))),u.style=f.join(";")},o.appendChild(u)}function Dtt(e,t,n,i){let r=eL(e,t,n).entity,s,a=!1,l=e._ellipsoid,u=KM(wi(t,"LatLonQuad",Re.gx),l),f=Yn(t,"drawOrder",Re.kml);if(c(u))s=j9(),s.hierarchy=new _c(u),s.zIndex=f,r.polygon=s,a=!0;else{s=new zm,s.zIndex=f,r.rectangle=s;let m=wi(t,"LatLonBox",Re.kml);if(c(m)){let b=Yn(m,"west",Re.kml),x=Yn(m,"south",Re.kml),T=Yn(m,"east",Re.kml),C=Yn(m,"north",Re.kml);c(b)&&(b=R.negativePiToPi(R.toRadians(b))),c(x)&&(x=R.clampToLatitudeRange(R.toRadians(x))),c(T)&&(T=R.negativePiToPi(R.toRadians(T))),c(C)&&(C=R.clampToLatitudeRange(R.toRadians(C))),s.coordinates=new ae(b,x,T,C);let S=Yn(m,"rotation",Re.kml);if(c(S)){let v=R.toRadians(S);s.rotation=v,s.stRotation=v}}}let d=wi(t,"Icon",Re.kml),p=W9(d,e,n.sourceResource,n.uriResolver,!0);if(c(p)){a&&_t("kml-gx:LatLonQuad","KML - gx:LatLonQuad Icon does not support texture projection.");let m=Yn(d,"x",Re.gx),b=Yn(d,"y",Re.gx),x=Yn(d,"w",Re.gx),T=Yn(d,"h",Re.gx);(c(m)||c(b)||c(x)||c(T))&&_t("kml-groundOverlay-xywh","KML - gx:x, gx:y, gx:w, gx:h aren't supported for GroundOverlays"),s.material=p,s.material.color=Db(t,"color",Re.kml),s.material.transparent=!0}else s.material=Db(t,"color",Re.kml);let g=Dn(t,"altitudeMode",Re.kml);c(g)?g==="absolute"?(s.height=Yn(t,"altitude",Re.kml),s.zIndex=void 0):g!=="clampToGround"&&_t("kml-altitudeMode-unknown",`KML - Unknown altitudeMode: ${g}`):(g=Dn(t,"altitudeMode",Re.gx),g==="relativeToSeaFloor"?(_t("kml-altitudeMode-relativeToSeaFloor","KML - altitudeMode relativeToSeaFloor is currently not supported, treating as absolute."),s.height=Yn(t,"altitude",Re.kml),s.zIndex=void 0):g==="clampToSeaFloor"?_t("kml-altitudeMode-clampToSeaFloor","KML - altitudeMode clampToSeaFloor is currently not supported, treating as clampToGround."):c(g)&&_t("kml-altitudeMode-unknown",`KML - Unknown altitudeMode: ${g}`))}function Bpe(e,t,n,i){e._unsupportedNode.raiseEvent(e,n.parentEntity,t,n.entityCollection,n.styleCollection,n.sourceResource,n.uriResolver),_t(`kml-unsupportedFeature-${t.nodeName}`,`KML - Unsupported feature: ${t.nodeName}`)}var Yg={INTERVAL:0,EXPIRE:1,STOP:2};function ZM(e){if(!c(e)||e.length===0)return"";let t=e[0];return(t==="&"||t==="?")&&(e=e.substring(1)),e}var Ptt=new ae,eC=new he,B9=new H,Itt=new h;function Y9(e,t,n,i,o,r){function s(u){return u<-R.PI_OVER_TWO?-R.PI_OVER_TWO:u>R.PI_OVER_TWO?R.PI_OVER_TWO:u}function a(u){return u>R.PI?u-R.TWO_PI:u<-R.PI?u+R.TWO_PI:u}let l=lE(e.queryParameters);if(l=l.replace(/%5B/g,"[").replace(/%5D/g,"]"),c(t)&&t._mode!==oe.MORPHING){let u,f;if(o=y(o,Ptt),c(n)&&(B9.x=n.clientWidth*.5,B9.y=n.clientHeight*.5,u=t.pickEllipsoid(B9,r,Itt)),c(u)?f=r.cartesianToCartographic(u,eC):(f=ae.center(o,eC),u=r.cartographicToCartesian(f)),c(i)&&!R.equalsEpsilon(i,1,R.EPSILON9)){let T=o.width*i*.5,C=o.height*i*.5;o=new ae(a(f.longitude-T),s(f.latitude-C),a(f.longitude+T),s(f.latitude+C))}l=l.replace("[bboxWest]",R.toDegrees(o.west).toString()),l=l.replace("[bboxSouth]",R.toDegrees(o.south).toString()),l=l.replace("[bboxEast]",R.toDegrees(o.east).toString()),l=l.replace("[bboxNorth]",R.toDegrees(o.north).toString());let d=R.toDegrees(f.longitude).toString(),p=R.toDegrees(f.latitude).toString();l=l.replace("[lookatLon]",d),l=l.replace("[lookatLat]",p),l=l.replace("[lookatTilt]",R.toDegrees(t.pitch).toString()),l=l.replace("[lookatHeading]",R.toDegrees(t.heading).toString()),l=l.replace("[lookatRange]",h.distance(t.positionWC,u)),l=l.replace("[lookatTerrainLon]",d),l=l.replace("[lookatTerrainLat]",p),l=l.replace("[lookatTerrainAlt]",f.height.toString()),r.cartesianToCartographic(t.positionWC,eC),l=l.replace("[cameraLon]",R.toDegrees(eC.longitude).toString()),l=l.replace("[cameraLat]",R.toDegrees(eC.latitude).toString()),l=l.replace("[cameraAlt]",R.toDegrees(eC.height).toString());let g=t.frustum,m=g.aspectRatio,b="",x="";if(c(m)){let T=R.toDegrees(g.fov);m>1?(b=T,x=T/m):(x=T,b=T*m)}l=l.replace("[horizFov]",b.toString()),l=l.replace("[vertFov]",x.toString())}else l=l.replace("[bboxWest]","-180"),l=l.replace("[bboxSouth]","-90"),l=l.replace("[bboxEast]","180"),l=l.replace("[bboxNorth]","90"),l=l.replace("[lookatLon]",""),l=l.replace("[lookatLat]",""),l=l.replace("[lookatRange]",""),l=l.replace("[lookatTilt]",""),l=l.replace("[lookatHeading]",""),l=l.replace("[lookatTerrainLon]",""),l=l.replace("[lookatTerrainLat]",""),l=l.replace("[lookatTerrainAlt]",""),l=l.replace("[cameraLon]",""),l=l.replace("[cameraLat]",""),l=l.replace("[cameraAlt]",""),l=l.replace("[horizFov]",""),l=l.replace("[vertFov]","");c(n)?(l=l.replace("[horizPixels]",n.clientWidth),l=l.replace("[vertPixels]",n.clientHeight)):(l=l.replace("[horizPixels]",""),l=l.replace("[vertPixels]","")),l=l.replace("[terrainEnabled]","1"),l=l.replace("[clientVersion]","1"),l=l.replace("[kmlVersion]","2.2"),l=l.replace("[clientName]","Cesium"),l=l.replace("[language]","English"),e.setQueryParameters(Bf(l))}function Ott(e,t,n,i){let r=eL(e,t,n).entity,s=n.sourceResource,a=n.uriResolver,l=wi(t,"Link",Re.kml);if(c(l)||(l=wi(t,"Url",Re.kml)),c(l)){let u=Dn(l,"href",Re.kml),f,d;if(c(u)){let p=u;if(u=G9(u,s,n.uriResolver),/^data:/.test(u.getUrlComponent()))/\.kmz/i.test(s.getUrlComponent())||(p=s.getDerivedResource({url:p}));else{if(p=u.clone(),f=Dn(l,"viewRefreshMode",Re.kml),f==="onRegion"){_t("kml-refrehMode-onRegion","KML - Unsupported viewRefreshMode: onRegion");return}d=y(Dn(l,"viewBoundScale",Re.kml),1);let x=f==="onStop"?"BBOX=[bboxWest],[bboxSouth],[bboxEast],[bboxNorth]":"",T=y(Dn(l,"viewFormat",Re.kml),x),C=Dn(l,"httpQuery",Re.kml);c(T)&&u.setQueryParameters(Bf(ZM(T))),c(C)&&u.setQueryParameters(Bf(ZM(C)));let S=e._ellipsoid;Y9(u,e.camera,e.canvas,d,e._lastCameraView.bbox,S)}let g={sourceUri:p,uriResolver:a,context:r.id,screenOverlayContainer:n.screenOverlayContainer},m=new _a,b=X9(e,m,u,g).then(function(x){let T=e._entityCollection,C=m.values;T.suspendEvents();for(let D=0;D<C.length;D++){let I=C[D];c(I.parent)||(I.parent=r,K9(I)),T.add(I)}T.resumeEvents();let S=Dn(l,"refreshMode",Re.kml),v=y(Yn(l,"refreshInterval",Re.kml),0);if(S==="onInterval"&&v>0||S==="onExpire"||f==="onStop"){let D=wi(x,"NetworkLinkControl",Re.kml),I=c(D),L=J.now(),M={id:Hn(),href:u,cookie:{},lastUpdated:L,updating:!1,entity:r,viewBoundScale:d,needsUpdate:!1,cameraUpdateTime:L},N=0;if(I&&(M.cookie=Bf(y(Dn(D,"cookie",Re.kml),"")),N=y(Yn(D,"minRefreshPeriod",Re.kml),0)),S==="onInterval")I&&(v=Math.max(N,v)),M.refreshMode=Yg.INTERVAL,M.time=v;else if(S==="onExpire"){let B;if(I&&(B=Dn(D,"expires",Re.kml)),c(B))try{let _=J.fromIso8601(B),w=J.secondsDifference(_,L);w>0&&w<N&&J.addSeconds(L,N,_),M.refreshMode=Yg.EXPIRE,M.time=_}catch{_t("kml-refreshMode-onInterval-onExpire","KML - NetworkLinkControl expires is not a valid date")}else _t("kml-refreshMode-onExpire","KML - refreshMode of onExpire requires the NetworkLinkControl to have an expires element")}else c(e.camera)?(M.refreshMode=Yg.STOP,M.time=y(Yn(l,"viewRefreshTime",Re.kml),0)):_t("kml-refrehMode-onStop-noCamera","A NetworkLink with viewRefreshMode=onStop requires the `camera` property to be defined.");c(M.refreshMode)&&e._networkLinks.set(M.id,M)}}).catch(function(x){_t(`An error occured during loading ${u.url}`),e._error.raiseEvent(e,x)});i.addPromise(b)}}}function Rtt(e,t,n,i){let o=H9[t.localName];return c(o)?o(e,t,n,i):Bpe(e,t,n,i)}function U9(e,t,n,i,o,r,s){t.removeAll();let a=n.documentElement,l=a.localName==="Document"?a:wi(a,"Document",Re.kml),u=Dn(l,"name",Re.kml);c(u)||(u=Q0(i.getUrlComponent())),c(e._name)||(e._name=u);let f=new au._DeferredLoading(e),d=new _a(e);return Promise.all(Ipe(e,n,d,i,!1,o)).then(function(){let p=n.documentElement;if(p.localName==="kml"){let m=p.childNodes;for(let b=0;b<m.length;b++){let x=m[b];if(c(H9[x.localName])){p=x;break}}}let g={parentEntity:void 0,entityCollection:t,styleCollection:d,sourceResource:i,uriResolver:o,context:s,screenOverlayContainer:r};return t.suspendEvents(),Rtt(e,p,g,f),t.resumeEvents(),f.wait().then(function(){return n.documentElement})})}function Mtt(e,t,n,i,o){let r=sn("ThirdParty/Workers/z-worker-pako.js");jA({workerScripts:{deflate:[r,"./pako_deflate.min.js"],inflate:[r,"./pako_inflate.min.js"]}});let s=new SM(new Wp(n));return Promise.resolve(s.getEntries()).then(function(a){let l=[],u={},f;for(let d=0;d<a.length;d++){let p=a[d];p.directory||(/\.kml$/i.test(p.filename)&&(!c(f)||!/\//i.test(p.filename))?(c(f)&&l.push(N9(f,u)),f=p):l.push(N9(p,u)))}return c(f)&&l.push(rtt(f,u)),Promise.all(l).then(function(){if(s.close(),!c(u.kml))throw new ue("KMZ file does not contain a KML document.");return u.keys=Object.keys(u),U9(e,t,u.kml,i,u,o)})})}function X9(e,t,n,i){i=y(i,y.EMPTY_OBJECT);let o=i.sourceUri,r=i.uriResolver,s=i.context,a=i.screenOverlayContainer,l=n;if(typeof n=="string"||n instanceof De){n=De.createIfNeeded(n),l=n.fetchBlob(),o=y(o,n.clone());let u=e._resourceCredits,f=n.credits;if(c(f)){let d=f.length;for(let p=0;p<d;p++)u.push(f[p])}}else o=y(o,De.DEFAULT.clone());return o=De.createIfNeeded(o),c(a)&&(a=On(a)),Promise.resolve(l).then(function(u){return u instanceof Blob?itt(u).then(function(f){return f?Mtt(e,t,u,o,a):ott(u).then(function(d){d=Spe(d),d=wpe(d);let p,g;try{p=z9.parseFromString(d,"application/xml")}catch(m){g=m.toString()}if(c(g)||p.body||p.documentElement.tagName==="parsererror"){let m=c(g)?g:p.documentElement.firstChild.nodeValue;throw m||(m=p.body.innerText),new ue(m)}return U9(e,t,p,o,r,a,s)})}):U9(e,t,u,o,r,a,s)}).catch(function(u){return e._error.raiseEvent(e,u),console.log(u),Promise.reject(u)})}function au(e){e=y(e,y.EMPTY_OBJECT);let t=e.camera,n=e.canvas;this._changed=new pe,this._error=new pe,this._loading=new pe,this._refresh=new pe,this._unsupportedNode=new pe,this._clock=void 0,this._entityCollection=new _a(this),this._name=void 0,this._isLoading=!1,this._pinBuilder=new vb,this._networkLinks=new St,this._entityCluster=new _d,this.canvas=n,this.camera=t,this._lastCameraView={position:c(t)?h.clone(t.positionWC):void 0,direction:c(t)?h.clone(t.directionWC):void 0,up:c(t)?h.clone(t.upWC):void 0,bbox:c(t)?t.computeViewRectangle():ae.clone(ae.MAX_VALUE)},this._ellipsoid=y(e.ellipsoid,ie.default);let i=e.credit;typeof i=="string"&&(i=new Pt(i)),this._credit=i,this._resourceCredits=[],this._kmlTours=[],this._screenOverlays=[]}au.load=function(e,t){return t=y(t,y.EMPTY_OBJECT),new au(t).load(e,t)};Object.defineProperties(au.prototype,{name:{get:function(){return this._name},set:function(e){this._name!==e&&(this._name=e,this._changed.raiseEvent(this))}},clock:{get:function(){return this._clock}},entities:{get:function(){return this._entityCollection}},isLoading:{get:function(){return this._isLoading}},changedEvent:{get:function(){return this._changed}},errorEvent:{get:function(){return this._error}},loadingEvent:{get:function(){return this._loading}},refreshEvent:{get:function(){return this._refresh}},unsupportedNodeEvent:{get:function(){return this._unsupportedNode}},show:{get:function(){return this._entityCollection.show},set:function(e){this._entityCollection.show=e}},clustering:{get:function(){return this._entityCluster},set:function(e){if(!c(e))throw new E("value must be defined.");this._entityCluster=e}},credit:{get:function(){return this._credit}},kmlTours:{get:function(){return this._kmlTours}}});au.prototype.load=function(e,t){if(!c(e))throw new E("data is required.");t=y(t,y.EMPTY_OBJECT),ns.setLoading(this,!0);let n=this._name;this._name=void 0,this._clampToGround=y(t.clampToGround,!1);let i=this;return X9(this,this._entityCollection,e,t).then(function(){let o,r=i._entityCollection.computeAvailability(),s=r.start,a=r.stop,l=J.equals(s,je.MINIMUM_VALUE),u=J.equals(a,je.MAXIMUM_VALUE);if(!l||!u){let d;l&&(d=new Date,d.setHours(0,0,0,0),s=J.fromDate(d)),u&&(d=new Date,d.setHours(24,0,0,0),a=J.fromDate(d)),o=new Lp,o.startTime=s,o.stopTime=a,o.currentTime=J.clone(s),o.clockRange=jr.LOOP_STOP,o.clockStep=ho.SYSTEM_CLOCK_MULTIPLIER,o.multiplier=Math.round(Math.min(Math.max(J.secondsDifference(a,s)/60,1),31556900))}let f=!1;return o!==i._clock&&(i._clock=o,f=!0),n!==i._name&&(f=!0),f&&i._changed.raiseEvent(i),ns.setLoading(i,!1),i}).catch(function(o){return ns.setLoading(i,!1),i._error.raiseEvent(i,o),console.log(o),Promise.reject(o)})};au.prototype.destroy=function(){for(;this._screenOverlays.length>0;)this._screenOverlays.pop().remove()};function K9(e){let t=e.parent;if(c(t)){let n=t.availability;if(c(n)){let i=e.availability;c(i)?i.intersect(n):e.availability=n}}}function Ltt(e,t,n,i,o){return function(r){if(!i.contains(t.id))return;let s=!1,a=wi(r,"NetworkLinkControl",Re.kml),l=c(a),u=0;if(l){if(c(wi(a,"Update",Re.kml))){_t("kml-networkLinkControl-update","KML - NetworkLinkControl updates aren't supported."),t.updating=!1,i.remove(t.id);return}t.cookie=Bf(y(Dn(a,"cookie",Re.kml),"")),u=y(Yn(a,"minRefreshPeriod",Re.kml),0)}let f=J.now(),d=t.refreshMode;if(d===Yg.INTERVAL)c(a)&&(t.time=Math.max(u,t.time));else if(d===Yg.EXPIRE){let L;if(c(a)&&(L=Dn(a,"expires",Re.kml)),c(L))try{let M=J.fromIso8601(L),N=J.secondsDifference(M,f);N>0&&N<u&&J.addSeconds(f,u,M),t.time=M}catch{_t("kml-networkLinkControl-expires","KML - NetworkLinkControl expires is not a valid date"),s=!0}else _t("kml-refreshMode-onExpire","KML - refreshMode of onExpire requires the NetworkLinkControl to have an expires element"),s=!0}let p=t.entity,g=e._entityCollection,m=n.values;function b(L){g.remove(L);let M=L._children,N=M.length;for(let B=0;B<N;++B)b(M[B])}g.suspendEvents();let x=g.values.slice(),T;for(T=0;T<x.length;++T){let L=x[T];L.parent===p&&(L.parent=void 0,b(L))}for(g.resumeEvents(),g.suspendEvents(),T=0;T<m.length;T++){let L=m[T];c(L.parent)||(L.parent=p,K9(L)),g.add(L)}g.resumeEvents(),s?i.remove(t.id):t.lastUpdated=f;let C=g.computeAvailability(),S=C.start,v=C.stop,D=J.equals(S,je.MINIMUM_VALUE),I=J.equals(v,je.MAXIMUM_VALUE);if(!D||!I){let L=e._clock;(L.startTime!==S||L.stopTime!==v)&&(L.startTime=S,L.stopTime=v,e._changed.raiseEvent(e))}t.updating=!1,t.needsUpdate=!1,e._refresh.raiseEvent(e,o.getUrlComponent(!0))}}var k9=new St;au.prototype.update=function(e){let t=this._networkLinks;if(t.length===0)return!0;let n=J.now(),i=this;k9.removeAll();function o(f){let d=f._children,p=d.length;for(let g=0;g<p;++g){let m=d[g];k9.set(m.id,m),o(m)}}let r=!1,s=this._lastCameraView,a=this.camera;c(a)&&!(a.positionWC.equalsEpsilon(s.position,R.EPSILON7)&&a.directionWC.equalsEpsilon(s.direction,R.EPSILON7)&&a.upWC.equalsEpsilon(s.up,R.EPSILON7))&&(s.position=h.clone(a.positionWC),s.direction=h.clone(a.directionWC),s.up=h.clone(a.upWC),s.bbox=a.computeViewRectangle(),r=!0);let l=new St,u=!1;return t.values.forEach(function(f){let d=f.entity;if(!k9.contains(d.id)){if(!f.updating){let p=!1;if(f.refreshMode===Yg.INTERVAL?J.secondsDifference(n,f.lastUpdated)>f.time&&(p=!0):f.refreshMode===Yg.EXPIRE?J.greaterThan(n,f.time)&&(p=!0):f.refreshMode===Yg.STOP&&(r&&(f.needsUpdate=!0,f.cameraUpdateTime=n),f.needsUpdate&&J.secondsDifference(n,f.cameraUpdateTime)>=f.time&&(p=!0)),p){o(d),f.updating=!0;let g=new _a,m=f.href.clone();m.setQueryParameters(f.cookie);let b=y(i._ellipsoid,ie.default);Y9(m,i.camera,i.canvas,f.viewBoundScale,s.bbox,b),X9(i,g,m,{context:d.id}).then(Ltt(i,f,g,l,m)).catch(function(x){let T=`NetworkLink ${f.href} refresh failed: ${x}`;console.log(T),i._error.raiseEvent(i,T)}),u=!0}}l.set(f.id,f)}}),u&&(this._networkLinks=l,this._changed.raiseEvent(this)),!0};function Ntt(){this.author={name:void 0,uri:void 0,email:void 0},this.link={href:void 0,hreflang:void 0,rel:void 0,type:void 0,title:void 0,length:void 0},this.address=void 0,this.phoneNumber=void 0,this.snippet=void 0,this.extendedData=void 0}au._DeferredLoading=Zh;au._getTimestamp=Ei;var tL=au;function fD(){E.throwInstantiationError()}fD.prototype.update=E.throwInstantiationError;fD.prototype.getBoundingSphere=E.throwInstantiationError;fD.prototype.isDestroyed=E.throwInstantiationError;fD.prototype.destroy=E.throwInstantiationError;var Ftt=fD;var Btt={NONE:0,LERC:1},Jh=Object.freeze(Btt);var ktt={NONE:0,BITS12:1},Ta=Object.freeze(ktt);var Pb=new h,Vtt=new h,xf=new H,nL=new k,Utt=new k,ztt=Math.pow(2,12);function ec(e,t,n,i,o,r,s,a,l,u){let f=Ta.NONE,d,p;if(c(t)&&c(n)&&c(i)&&c(o)){let g=t.minimum,m=t.maximum,b=h.subtract(m,g,Vtt),x=i-n;Math.max(h.maximumComponent(b),x)<ztt-1?f=Ta.BITS12:f=Ta.NONE,d=k.inverseTransformation(o,new k);let C=h.negate(g,Pb);k.multiply(k.fromTranslation(C,nL),d,d);let S=Pb;S.x=1/b.x,S.y=1/b.y,S.z=1/b.z,k.multiply(k.fromScale(S,nL),d,d),p=k.clone(o),k.setTranslation(p,h.ZERO,p),o=k.clone(o,new k);let v=k.fromTranslation(g,nL),D=k.fromScale(b,Utt),I=k.multiply(v,D,nL);k.multiply(o,I,o),k.multiply(p,I,p)}this.quantization=f,this.minimumHeight=n,this.maximumHeight=i,this.center=h.clone(e),this.toScaledENU=d,this.fromScaledENU=o,this.matrix=p,this.hasVertexNormals=r,this.hasWebMercatorT=y(s,!1),this.hasGeodeticSurfaceNormals=y(a,!1),this.exaggeration=y(l,1),this.exaggerationRelativeHeight=y(u,0),this.stride=0,this._offsetGeodeticSurfaceNormal=0,this._offsetVertexNormal=0,this._calculateStrideAndOffsets()}ec.prototype.encode=function(e,t,n,i,o,r,s,a){let l=i.x,u=i.y;if(this.quantization===Ta.BITS12){n=k.multiplyByPoint(this.toScaledENU,n,Pb),n.x=R.clamp(n.x,0,1),n.y=R.clamp(n.y,0,1),n.z=R.clamp(n.z,0,1);let f=this.maximumHeight-this.minimumHeight,d=R.clamp((o-this.minimumHeight)/f,0,1);H.fromElements(n.x,n.y,xf);let p=Nn.compressTextureCoordinates(xf);H.fromElements(n.z,d,xf);let g=Nn.compressTextureCoordinates(xf);H.fromElements(l,u,xf);let m=Nn.compressTextureCoordinates(xf);if(e[t++]=p,e[t++]=g,e[t++]=m,this.hasWebMercatorT){H.fromElements(s,0,xf);let b=Nn.compressTextureCoordinates(xf);e[t++]=b}}else h.subtract(n,this.center,Pb),e[t++]=Pb.x,e[t++]=Pb.y,e[t++]=Pb.z,e[t++]=o,e[t++]=l,e[t++]=u,this.hasWebMercatorT&&(e[t++]=s);return this.hasVertexNormals&&(e[t++]=Nn.octPackFloat(r)),this.hasGeodeticSurfaceNormals&&(e[t++]=a.x,e[t++]=a.y,e[t++]=a.z),t};var Htt=new h,kpe=new h;ec.prototype.addGeodeticSurfaceNormals=function(e,t,n){if(this.hasGeodeticSurfaceNormals)return;let i=this.stride,o=e.length/i;this.hasGeodeticSurfaceNormals=!0,this._calculateStrideAndOffsets();let r=this.stride;for(let s=0;s<o;s++){for(let f=0;f<i;f++){let d=s*i+f,p=s*r+f;t[p]=e[d]}let a=this.decodePosition(t,s,Htt),l=n.geodeticSurfaceNormal(a,kpe),u=s*r+this._offsetGeodeticSurfaceNormal;t[u]=l.x,t[u+1]=l.y,t[u+2]=l.z}};ec.prototype.removeGeodeticSurfaceNormals=function(e,t){if(!this.hasGeodeticSurfaceNormals)return;let n=this.stride,i=e.length/n;this.hasGeodeticSurfaceNormals=!1,this._calculateStrideAndOffsets();let o=this.stride;for(let r=0;r<i;r++)for(let s=0;s<o;s++){let a=r*n+s,l=r*o+s;t[l]=e[a]}};ec.prototype.decodePosition=function(e,t,n){if(c(n)||(n=new h),t*=this.stride,this.quantization===Ta.BITS12){let i=Nn.decompressTextureCoordinates(e[t],xf);n.x=i.x,n.y=i.y;let o=Nn.decompressTextureCoordinates(e[t+1],xf);return n.z=o.x,k.multiplyByPoint(this.fromScaledENU,n,n)}return n.x=e[t],n.y=e[t+1],n.z=e[t+2],h.add(n,this.center,n)};ec.prototype.getExaggeratedPosition=function(e,t,n){n=this.decodePosition(e,t,n);let i=this.exaggeration,o=this.exaggerationRelativeHeight;if(i!==1&&this.hasGeodeticSurfaceNormals){let s=this.decodeGeodeticSurfaceNormal(e,t,kpe),a=this.decodeHeight(e,t),l=zr.getHeight(a,i,o)-a;n.x+=s.x*l,n.y+=s.y*l,n.z+=s.z*l}return n};ec.prototype.decodeTextureCoordinates=function(e,t,n){return c(n)||(n=new H),t*=this.stride,this.quantization===Ta.BITS12?Nn.decompressTextureCoordinates(e[t+2],n):H.fromElements(e[t+4],e[t+5],n)};ec.prototype.decodeHeight=function(e,t){return t*=this.stride,this.quantization===Ta.BITS12?Nn.decompressTextureCoordinates(e[t+1],xf).y*(this.maximumHeight-this.minimumHeight)+this.minimumHeight:e[t+3]};ec.prototype.decodeWebMercatorT=function(e,t){return t*=this.stride,this.quantization===Ta.BITS12?Nn.decompressTextureCoordinates(e[t+3],xf).x:e[t+6]};ec.prototype.getOctEncodedNormal=function(e,t,n){t=t*this.stride+this._offsetVertexNormal;let i=e[t]/256,o=Math.floor(i),r=(i-o)*256;return H.fromElements(o,r,n)};ec.prototype.decodeGeodeticSurfaceNormal=function(e,t,n){return t=t*this.stride+this._offsetGeodeticSurfaceNormal,n.x=e[t],n.y=e[t+1],n.z=e[t+2],n};ec.prototype._calculateStrideAndOffsets=function(){let e=0;switch(this.quantization){case Ta.BITS12:e+=3;break;default:e+=6}this.hasWebMercatorT&&(e+=1),this.hasVertexNormals&&(this._offsetVertexNormal=e,e+=1),this.hasGeodeticSurfaceNormals&&(this._offsetGeodeticSurfaceNormal=e,e+=3),this.stride=e};var iL={position3DAndHeight:0,textureCoordAndEncodedNormals:1,geodeticSurfaceNormal:2},oL={compressed0:0,compressed1:1,geodeticSurfaceNormal:2};ec.prototype.getAttributes=function(e){let t=$.FLOAT,n=$.getSizeInBytes(t),i=this.stride*n,o=0,r=[];function s(a,l){r.push({index:a,vertexBuffer:e,componentDatatype:t,componentsPerAttribute:l,offsetInBytes:o,strideInBytes:i}),o+=l*n}if(this.quantization===Ta.NONE){s(iL.position3DAndHeight,4);let a=2;a+=this.hasWebMercatorT?1:0,a+=this.hasVertexNormals?1:0,s(iL.textureCoordAndEncodedNormals,a),this.hasGeodeticSurfaceNormals&&s(iL.geodeticSurfaceNormal,3)}else{let a=this.hasWebMercatorT||this.hasVertexNormals,l=this.hasWebMercatorT&&this.hasVertexNormals;s(oL.compressed0,a?4:3),l&&s(oL.compressed1,1),this.hasGeodeticSurfaceNormals&&s(oL.geodeticSurfaceNormal,3)}return r};ec.prototype.getAttributeLocations=function(){return this.quantization===Ta.NONE?iL:oL};ec.clone=function(e,t){if(c(e))return c(t)||(t=new ec),t.quantization=e.quantization,t.minimumHeight=e.minimumHeight,t.maximumHeight=e.maximumHeight,t.center=h.clone(e.center),t.toScaledENU=k.clone(e.toScaledENU),t.fromScaledENU=k.clone(e.fromScaledENU),t.matrix=k.clone(e.matrix),t.hasVertexNormals=e.hasVertexNormals,t.hasWebMercatorT=e.hasWebMercatorT,t.hasGeodeticSurfaceNormals=e.hasGeodeticSurfaceNormals,t.exaggeration=e.exaggeration,t.exaggerationRelativeHeight=e.exaggerationRelativeHeight,t._calculateStrideAndOffsets(),t};var xl=ec;var Qh={};Qh.DEFAULT_STRUCTURE=Object.freeze({heightScale:1,heightOffset:0,elementsPerHeight:1,stride:1,elementMultiplier:256,isBigEndian:!1});var $9=new h,Gtt=new k,jtt=new h,Wtt=new h;Qh.computeVertices=function(e){if(!c(e)||!c(e.heightmap))throw new E("options.heightmap is required.");if(!c(e.width)||!c(e.height))throw new E("options.width and options.height are required.");if(!c(e.nativeRectangle))throw new E("options.nativeRectangle is required.");if(!c(e.skirtHeight))throw new E("options.skirtHeight is required.");let t=Math.cos,n=Math.sin,i=Math.sqrt,o=Math.atan,r=Math.exp,s=R.PI_OVER_TWO,a=R.toRadians,l=e.heightmap,u=e.width,f=e.height,d=e.skirtHeight,p=d>0,g=y(e.isGeographic,!0),m=y(e.ellipsoid,ie.default),b=1/m.maximumRadius,x=ae.clone(e.nativeRectangle),T=ae.clone(e.rectangle),C,S,v,D;c(T)?(C=T.west,S=T.south,v=T.east,D=T.north):g?(C=a(x.west),S=a(x.south),v=a(x.east),D=a(x.north)):(C=x.west*b,S=s-2*o(r(-x.south*b)),v=x.east*b,D=s-2*o(r(-x.north*b)));let I=e.relativeToCenter,L=c(I);I=L?I:h.ZERO;let M=y(e.includeWebMercatorT,!1),N=y(e.exaggeration,1),B=y(e.exaggerationRelativeHeight,0),w=N!==1,P=y(e.structure,Qh.DEFAULT_STRUCTURE),O=y(P.heightScale,Qh.DEFAULT_STRUCTURE.heightScale),F=y(P.heightOffset,Qh.DEFAULT_STRUCTURE.heightOffset),V=y(P.elementsPerHeight,Qh.DEFAULT_STRUCTURE.elementsPerHeight),G=y(P.stride,Qh.DEFAULT_STRUCTURE.stride),z=y(P.elementMultiplier,Qh.DEFAULT_STRUCTURE.elementMultiplier),W=y(P.isBigEndian,Qh.DEFAULT_STRUCTURE.isBigEndian),U=ae.computeWidth(x),q=ae.computeHeight(x),K=U/(u-1),te=q/(f-1);g||(U*=b,q*=b);let Y=m.radiiSquared,Z=Y.x,ee=Y.y,me=Y.z,be=65536,le=-65536,ge=Ft.eastNorthUpToFixedFrame(I,m),xe=k.inverseTransformation(ge,Gtt),Pe,Ee;M&&(Pe=Li.geodeticLatitudeToMercatorAngle(S),Ee=1/(Li.geodeticLatitudeToMercatorAngle(D)-Pe));let Ue=jtt;Ue.x=Number.POSITIVE_INFINITY,Ue.y=Number.POSITIVE_INFINITY,Ue.z=Number.POSITIVE_INFINITY;let Ye=Wtt;Ye.x=Number.NEGATIVE_INFINITY,Ye.y=Number.NEGATIVE_INFINITY,Ye.z=Number.NEGATIVE_INFINITY;let it=Number.POSITIVE_INFINITY,It=u*f,Ot=d>0?u*2+f*2:0,He=It+Ot,tn=new Array(He),dt=new Array(He),bt=new Array(He),nn=M?new Array(He):[],Ae=w?new Array(He):[],Ce=0,rt=f,Ri=0,lt=u;p&&(--Ce,++rt,--Ri,++lt);let ao=1e-5;for(let Ze=Ce;Ze<rt;++Ze){let ht=Ze;ht<0&&(ht=0),ht>=f&&(ht=f-1);let jt=x.north-te*ht;g?jt=a(jt):jt=s-2*o(r(-jt*b));let gn=(jt-S)/(D-S);gn=R.clamp(gn,0,1);let To=Ze===Ce,_o=Ze===rt-1;d>0&&(To?jt+=ao*q:_o&&(jt-=ao*q));let Da=t(jt),Pa=n(jt),pi=me*Pa,li;M&&(li=(Li.geodeticLatitudeToMercatorAngle(jt)-Pe)*Ee);for(let Hs=Ri;Hs<lt;++Hs){let kr=Hs;kr<0&&(kr=0),kr>=u&&(kr=u-1);let Hc=ht*(u*G)+kr*G,co;if(V===1)co=l[Hc];else{co=0;let So;if(W)for(So=0;So<V;++So)co=co*z+l[Hc+So];else for(So=V-1;So>=0;--So)co=co*z+l[Hc+So]}co=co*O+F,le=Math.max(le,co),be=Math.min(be,co);let Er=x.west+K*kr;g?Er=a(Er):Er=Er*b;let gm=(Er-C)/(v-C);gm=R.clamp(gm,0,1);let Vr=ht*u+kr;if(d>0){let So=Hs===Ri,on=Hs===lt-1,Se=To||_o||So||on;if((To||_o)&&(So||on))continue;Se&&(co-=d,So?(Vr=It+(f-ht-1),Er-=ao*U):_o?Vr=It+f+(u-kr-1):on?(Vr=It+f+u+ht,Er+=ao*U):To&&(Vr=It+f+u+f+kr))}let Cu=Da*t(Er),Ia=Da*n(Er),Dy=Z*Cu,sa=ee*Ia,Oa=1/i(Dy*Cu+sa*Ia+pi*Pa),Kr=Dy*Oa,Eu=sa*Oa,Su=pi*Oa,wu=new h;wu.x=Kr+Cu*co,wu.y=Eu+Ia*co,wu.z=Su+Pa*co,k.multiplyByPoint(xe,wu,$9),h.minimumByComponent($9,Ue,Ue),h.maximumByComponent($9,Ye,Ye),it=Math.min(it,co),tn[Vr]=wu,bt[Vr]=new H(gm,gn),dt[Vr]=co,M&&(nn[Vr]=li),w&&(Ae[Vr]=m.geodeticSurfaceNormal(wu))}}let Fo=ce.fromPoints(tn),va;c(T)&&(va=Pn.fromRectangle(T,be,le,m));let Cr;L&&(Cr=new Z0(m).computeHorizonCullingPointPossiblyUnderEllipsoid(I,tn,be));let ss=new jx(Ue,Ye,I),Le=new xl(I,ss,it,le,ge,!1,M,w,N,B),st=new Float32Array(He*Le.stride),Xe=0;for(let Ze=0;Ze<He;++Ze)Xe=Le.encode(st,Xe,tn[Ze],bt[Ze],dt[Ze],void 0,nn[Ze],Ae[Ze]);return{vertices:st,maximumHeight:le,minimumHeight:be,encoding:Le,boundingSphere3D:Fo,orientedBoundingBox:va,occludeePointInScaledSpace:Cr}};var rL=Qh;function Xg(){E.throwInstantiationError()}Object.defineProperties(Xg.prototype,{credits:{get:E.throwInstantiationError},waterMask:{get:E.throwInstantiationError}});Xg.prototype.interpolateHeight=E.throwInstantiationError;Xg.prototype.isChildAvailable=E.throwInstantiationError;Xg.prototype.createMesh=E.throwInstantiationError;Xg.prototype.upsample=E.throwInstantiationError;Xg.prototype.wasCreatedByUpsampling=E.throwInstantiationError;Xg.maximumAsynchronousTasks=5;var Xp=Xg;function qtt(e,t,n,i,o,r,s,a,l,u,f,d,p,g,m,b){this.center=e,this.vertices=t,this.stride=y(u,6),this.indices=n,this.indexCountWithoutSkirts=i,this.vertexCountWithoutSkirts=o,this.minimumHeight=r,this.maximumHeight=s,this.boundingSphere3D=a,this.occludeePointInScaledSpace=l,this.orientedBoundingBox=f,this.encoding=d,this.westIndicesSouthToNorth=p,this.southIndicesEastToWest=g,this.eastIndicesNorthToSouth=m,this.northIndicesWestToEast=b}var em=qtt;function Rc(){E.throwInstantiationError()}Object.defineProperties(Rc.prototype,{errorEvent:{get:E.throwInstantiationError},credit:{get:E.throwInstantiationError},tilingScheme:{get:E.throwInstantiationError},hasWaterMask:{get:E.throwInstantiationError},hasVertexNormals:{get:E.throwInstantiationError},availability:{get:E.throwInstantiationError}});var Vpe=[];Rc.getRegularGridIndices=function(e,t){if(e*t>=R.FOUR_GIGABYTES)throw new E("The total number of vertices (width * height) must be less than 4,294,967,296.");let n=Vpe[e];c(n)||(Vpe[e]=n=[]);let i=n[t];return c(i)||(e*t<R.SIXTY_FOUR_KILOBYTES?i=n[t]=new Uint16Array((e-1)*(t-1)*6):i=n[t]=new Uint32Array((e-1)*(t-1)*6),Gpe(e,t,i,0)),i};var Upe=[];Rc.getRegularGridIndicesAndEdgeIndices=function(e,t){if(e*t>=R.FOUR_GIGABYTES)throw new E("The total number of vertices (width * height) must be less than 4,294,967,296.");let n=Upe[e];c(n)||(Upe[e]=n=[]);let i=n[t];if(!c(i)){let o=Rc.getRegularGridIndices(e,t),r=Hpe(e,t),s=r.westIndicesSouthToNorth,a=r.southIndicesEastToWest,l=r.eastIndicesNorthToSouth,u=r.northIndicesWestToEast;i=n[t]={indices:o,westIndicesSouthToNorth:s,southIndicesEastToWest:a,eastIndicesNorthToSouth:l,northIndicesWestToEast:u}}return i};var zpe=[];Rc.getRegularGridAndSkirtIndicesAndEdgeIndices=function(e,t){if(e*t>=R.FOUR_GIGABYTES)throw new E("The total number of vertices (width * height) must be less than 4,294,967,296.");let n=zpe[e];c(n)||(zpe[e]=n=[]);let i=n[t];if(!c(i)){let o=e*t,r=(e-1)*(t-1)*6,s=e*2+t*2,a=Math.max(0,s-4)*6,l=o+s,u=r+a,f=Hpe(e,t),d=f.westIndicesSouthToNorth,p=f.southIndicesEastToWest,g=f.eastIndicesNorthToSouth,m=f.northIndicesWestToEast,b=Fe.createTypedArray(l,u);Gpe(e,t,b,0),Rc.addSkirtIndices(d,p,g,m,o,b,r),i=n[t]={indices:b,westIndicesSouthToNorth:d,southIndicesEastToWest:p,eastIndicesNorthToSouth:g,northIndicesWestToEast:m,indexCountWithoutSkirts:r}}return i};Rc.addSkirtIndices=function(e,t,n,i,o,r,s){let a=o;s=sL(e,a,r,s),a+=e.length,s=sL(t,a,r,s),a+=t.length,s=sL(n,a,r,s),a+=n.length,sL(i,a,r,s)};function Hpe(e,t){let n=new Array(t),i=new Array(e),o=new Array(t),r=new Array(e),s;for(s=0;s<e;++s)r[s]=s,i[s]=e*t-1-s;for(s=0;s<t;++s)o[s]=(s+1)*e-1,n[s]=(t-s-1)*e;return{westIndicesSouthToNorth:n,southIndicesEastToWest:i,eastIndicesNorthToSouth:o,northIndicesWestToEast:r}}function Gpe(e,t,n,i){let o=0;for(let r=0;r<t-1;++r){for(let s=0;s<e-1;++s){let a=o,l=a+e,u=l+1,f=a+1;n[i++]=a,n[i++]=l,n[i++]=f,n[i++]=f,n[i++]=l,n[i++]=u,++o}++o}}function sL(e,t,n,i){let o=e[0],r=e.length;for(let s=1;s<r;++s){let a=e[s];n[i++]=o,n[i++]=a,n[i++]=t,n[i++]=t,n[i++]=a,n[i++]=t+1,o=a,++t}return i}Rc.heightmapTerrainQuality=.25;Rc.getEstimatedLevelZeroGeometricErrorForAHeightmap=function(e,t,n){return e.maximumRadius*2*Math.PI*Rc.heightmapTerrainQuality/(t*n)};Rc.prototype.requestTileGeometry=E.throwInstantiationError;Rc.prototype.getLevelMaximumGeometricError=E.throwInstantiationError;Rc.prototype.getTileDataAvailable=E.throwInstantiationError;Rc.prototype.loadTileDataAvailability=E.throwInstantiationError;var gs=Rc;function Kp(e){if(!c(e)||!c(e.buffer))throw new E("options.buffer is required.");if(!c(e.width))throw new E("options.width is required.");if(!c(e.height))throw new E("options.height is required.");this._buffer=e.buffer,this._width=e.width,this._height=e.height,this._childTileMask=y(e.childTileMask,15),this._encoding=y(e.encoding,Jh.NONE);let t=rL.DEFAULT_STRUCTURE,n=e.structure;c(n)?n!==t&&(n.heightScale=y(n.heightScale,t.heightScale),n.heightOffset=y(n.heightOffset,t.heightOffset),n.elementsPerHeight=y(n.elementsPerHeight,t.elementsPerHeight),n.stride=y(n.stride,t.stride),n.elementMultiplier=y(n.elementMultiplier,t.elementMultiplier),n.isBigEndian=y(n.isBigEndian,t.isBigEndian)):n=t,this._structure=n,this._createdByUpsampling=y(e.createdByUpsampling,!1),this._waterMask=e.waterMask,this._skirtHeight=void 0,this._bufferType=this._encoding===Jh.LERC?Float32Array:this._buffer.constructor,this._mesh=void 0}Object.defineProperties(Kp.prototype,{credits:{get:function(){}},waterMask:{get:function(){return this._waterMask}},childTileMask:{get:function(){return this._childTileMask}}});var jpe="createVerticesFromHeightmap",Ytt=new Ti(jpe),Xtt=new Ti(jpe,Xp.maximumAsynchronousTasks);Kp.prototype.createMesh=function(e){e=y(e,y.EMPTY_OBJECT),A.typeOf.object("options.tilingScheme",e.tilingScheme),A.typeOf.number("options.x",e.x),A.typeOf.number("options.y",e.y),A.typeOf.number("options.level",e.level);let t=e.tilingScheme,n=e.x,i=e.y,o=e.level,r=y(e.exaggeration,1),s=y(e.exaggerationRelativeHeight,0),a=y(e.throttle,!0),l=t.ellipsoid,u=t.tileXYToNativeRectangle(n,i,o),f=t.tileXYToRectangle(n,i,o),d=l.cartographicToCartesian(ae.center(f)),p=this._structure,m=gs.getEstimatedLevelZeroGeometricErrorForAHeightmap(l,this._width,t.getNumberOfXTilesAtLevel(0))/(1<<o);this._skirtHeight=Math.min(m*4,1e3);let x=(a?Xtt:Ytt).scheduleTask({heightmap:this._buffer,structure:p,includeWebMercatorT:!0,width:this._width,height:this._height,nativeRectangle:u,rectangle:f,relativeToCenter:d,ellipsoid:l,skirtHeight:this._skirtHeight,isGeographic:t.projection instanceof Mi,exaggeration:r,exaggerationRelativeHeight:s,encoding:this._encoding});if(!c(x))return;let T=this;return Promise.resolve(x).then(function(C){let S;T._skirtHeight>0?S=gs.getRegularGridAndSkirtIndicesAndEdgeIndices(C.gridWidth,C.gridHeight):S=gs.getRegularGridIndicesAndEdgeIndices(C.gridWidth,C.gridHeight);let v=C.gridWidth*C.gridHeight;return T._mesh=new em(d,new Float32Array(C.vertices),S.indices,S.indexCountWithoutSkirts,v,C.minimumHeight,C.maximumHeight,ce.clone(C.boundingSphere3D),h.clone(C.occludeePointInScaledSpace),C.numberOfAttributes,Pn.clone(C.orientedBoundingBox),xl.clone(C.encoding),S.westIndicesSouthToNorth,S.southIndicesEastToWest,S.eastIndicesNorthToSouth,S.northIndicesWestToEast),T._buffer=void 0,T._mesh})};Kp.prototype._createMeshSync=function(e){A.typeOf.object("options.tilingScheme",e.tilingScheme),A.typeOf.number("options.x",e.x),A.typeOf.number("options.y",e.y),A.typeOf.number("options.level",e.level);let t=e.tilingScheme,n=e.x,i=e.y,o=e.level,r=y(e.exaggeration,1),s=y(e.exaggerationRelativeHeight,0),a=t.ellipsoid,l=t.tileXYToNativeRectangle(n,i,o),u=t.tileXYToRectangle(n,i,o),f=a.cartographicToCartesian(ae.center(u)),d=this._structure,g=gs.getEstimatedLevelZeroGeometricErrorForAHeightmap(a,this._width,t.getNumberOfXTilesAtLevel(0))/(1<<o);this._skirtHeight=Math.min(g*4,1e3);let m=rL.computeVertices({heightmap:this._buffer,structure:d,includeWebMercatorT:!0,width:this._width,height:this._height,nativeRectangle:l,rectangle:u,relativeToCenter:f,ellipsoid:a,skirtHeight:this._skirtHeight,isGeographic:t.projection instanceof Mi,exaggeration:r,exaggerationRelativeHeight:s});this._buffer=void 0;let b;this._skirtHeight>0?b=gs.getRegularGridAndSkirtIndicesAndEdgeIndices(this._width,this._height):b=gs.getRegularGridIndicesAndEdgeIndices(this._width,this._height);let x=m.gridWidth*m.gridHeight;return this._mesh=new em(f,m.vertices,b.indices,b.indexCountWithoutSkirts,x,m.minimumHeight,m.maximumHeight,m.boundingSphere3D,m.occludeePointInScaledSpace,m.encoding.stride,m.orientedBoundingBox,m.encoding,b.westIndicesSouthToNorth,b.southIndicesEastToWest,b.eastIndicesNorthToSouth,b.northIndicesWestToEast),this._mesh};Kp.prototype.interpolateHeight=function(e,t,n){let i=this._width,o=this._height,r=this._structure,s=r.stride,a=r.elementsPerHeight,l=r.elementMultiplier,u=r.isBigEndian,f=r.heightOffset,d=r.heightScale,p=c(this._mesh),g=this._encoding===Jh.LERC;if(!p&&g)return;let b;if(p){let x=this._mesh.vertices,T=this._mesh.encoding;b=Wpe(x,T,f,d,e,i,o,t,n)}else b=Ktt(this._buffer,a,l,s,u,e,i,o,t,n),b=b*d+f;return b};Kp.prototype.upsample=function(e,t,n,i,o,r,s){if(!c(e))throw new E("tilingScheme is required.");if(!c(t))throw new E("thisX is required.");if(!c(n))throw new E("thisY is required.");if(!c(i))throw new E("thisLevel is required.");if(!c(o))throw new E("descendantX is required.");if(!c(r))throw new E("descendantY is required.");if(!c(s))throw new E("descendantLevel is required.");if(s-i>1)throw new E("Upsampling through more than one level at a time is not currently supported.");let l=this._mesh;if(!c(l))return;let u=this._width,f=this._height,d=this._structure,p=d.stride,g=new this._bufferType(u*f*p),m=l.vertices,b=l.encoding,x=e.tileXYToRectangle(t,n,i),T=e.tileXYToRectangle(o,r,s),C=d.heightOffset,S=d.heightScale,v=d.elementsPerHeight,D=d.elementMultiplier,I=d.isBigEndian,L=Math.pow(D,v-1);for(let M=0;M<f;++M){let N=R.lerp(T.north,T.south,M/(f-1));for(let B=0;B<u;++B){let _=R.lerp(T.west,T.east,B/(u-1)),w=Wpe(m,b,C,S,x,u,f,_,N);w=w<d.lowestEncodedHeight?d.lowestEncodedHeight:w,w=w>d.highestEncodedHeight?d.highestEncodedHeight:w,$tt(g,v,D,L,p,I,M*u+B,w)}}return Promise.resolve(new Kp({buffer:g,width:u,height:f,childTileMask:0,structure:this._structure,createdByUpsampling:!0}))};Kp.prototype.isChildAvailable=function(e,t,n,i){if(!c(e))throw new E("thisX is required.");if(!c(t))throw new E("thisY is required.");if(!c(n))throw new E("childX is required.");if(!c(i))throw new E("childY is required.");let o=2;return n!==e*2&&++o,i!==t*2&&(o-=2),(this._childTileMask&1<<o)!==0};Kp.prototype.wasCreatedByUpsampling=function(){return this._createdByUpsampling};function Ktt(e,t,n,i,o,r,s,a,l,u){let f=(l-r.west)*(s-1)/(r.east-r.west),d=(u-r.south)*(a-1)/(r.north-r.south),p=f|0,g=p+1;g>=s&&(g=s-1,p=s-2);let m=d|0,b=m+1;b>=a&&(b=a-1,m=a-2);let x=f-p,T=d-m;m=a-1-m,b=a-1-b;let C=aL(e,t,n,i,o,m*s+p),S=aL(e,t,n,i,o,m*s+g),v=aL(e,t,n,i,o,b*s+p),D=aL(e,t,n,i,o,b*s+g);return qpe(x,T,C,S,v,D)}function Wpe(e,t,n,i,o,r,s,a,l){let u=(a-o.west)*(r-1)/(o.east-o.west),f=(l-o.south)*(s-1)/(o.north-o.south),d=u|0,p=d+1;p>=r&&(p=r-1,d=r-2);let g=f|0,m=g+1;m>=s&&(m=s-1,g=s-2);let b=u-d,x=f-g;g=s-1-g,m=s-1-m;let T=(t.decodeHeight(e,g*r+d)-n)/i,C=(t.decodeHeight(e,g*r+p)-n)/i,S=(t.decodeHeight(e,m*r+d)-n)/i,v=(t.decodeHeight(e,m*r+p)-n)/i;return qpe(b,x,T,C,S,v)}function qpe(e,t,n,i,o,r){return t<e?n+e*(i-n)+t*(r-i):n+e*(r-o)+t*(o-n)}function aL(e,t,n,i,o,r){r*=i;let s=0,a;if(o)for(a=0;a<t;++a)s=s*n+e[r+a];else for(a=t-1;a>=0;--a)s=s*n+e[r+a];return s}function $tt(e,t,n,i,o,r,s,a){s*=o;let l;if(r)for(l=0;l<t-1;++l)e[s+l]=a/i|0,a-=e[s+l]*i,i/=n;else for(l=t-1;l>0;--l)e[s+l]=a/i|0,a-=e[s+l]*i,i/=n;e[s+l]=a}var Mc=Kp;function iC(e,t){this._tilingScheme=e,this._maximumLevel=t,this._rootNodes=[]}var Ib=new ae;function Ztt(e,t,n,i){let o=i.length;for(let r=0;r<o;++r){let s=i[r];if(s.x===t&&s.y===n&&s.level===e)return!0}return!1}iC.prototype.addAvailableTileRange=function(e,t,n,i,o){let r=this._tilingScheme,s=this._rootNodes;if(e===0)for(let p=n;p<=o;++p)for(let g=t;g<=i;++g)Ztt(e,g,p,s)||s.push(new tC(r,void 0,0,g,p));r.tileXYToRectangle(t,n,e,Ib);let a=Ib.west,l=Ib.north;r.tileXYToRectangle(i,o,e,Ib);let u=Ib.east,f=Ib.south,d=new nnt(e,a,f,u,l);for(let p=0;p<s.length;++p){let g=s[p];Z9(g.extent,d)&&int(this._maximumLevel,g,d)}};iC.prototype.computeMaximumLevelAtPosition=function(e){let t;for(let n=0;n<this._rootNodes.length;++n){let i=this._rootNodes[n];if(nC(i.extent,e)){t=i;break}}return c(t)?dD(void 0,t,e):-1};var Jtt=[],Qtt=[],ent=new ae,tnt=new ae;iC.prototype.computeBestAvailableLevelOverRectangle=function(e){let t=Jtt;t.length=0,e.east<e.west?(t.push(ae.fromRadians(-Math.PI,e.south,e.east,e.north,ent)),t.push(ae.fromRadians(e.west,e.south,Math.PI,e.north,tnt))):t.push(e);let n=Qtt;n.length=0;let i;for(i=0;i<this._rootNodes.length;++i)hD(n,this._rootNodes[i],t);for(i=n.length-1;i>=0;--i)if(c(n[i])&&n[i].length===0)return i;return 0};var Ype=new he;iC.prototype.isTileAvailable=function(e,t,n){let i=this._tilingScheme.tileXYToRectangle(t,n,e,Ib);return ae.center(i,Ype),this.computeMaximumLevelAtPosition(Ype)>=e};iC.prototype.computeChildMaskForTile=function(e,t,n){let i=e+1;if(i>=this._maximumLevel)return 0;let o=0;return o|=this.isTileAvailable(i,2*t,2*n+1)?1:0,o|=this.isTileAvailable(i,2*t+1,2*n+1)?2:0,o|=this.isTileAvailable(i,2*t,2*n)?4:0,o|=this.isTileAvailable(i,2*t+1,2*n)?8:0,o};function tC(e,t,n,i,o){this.tilingScheme=e,this.parent=t,this.level=n,this.x=i,this.y=o,this.extent=e.tileXYToRectangle(i,o,n),this.rectangles=[],this._sw=void 0,this._se=void 0,this._nw=void 0,this._ne=void 0}Object.defineProperties(tC.prototype,{nw:{get:function(){return this._nw||(this._nw=new tC(this.tilingScheme,this,this.level+1,this.x*2,this.y*2)),this._nw}},ne:{get:function(){return this._ne||(this._ne=new tC(this.tilingScheme,this,this.level+1,this.x*2+1,this.y*2)),this._ne}},sw:{get:function(){return this._sw||(this._sw=new tC(this.tilingScheme,this,this.level+1,this.x*2,this.y*2+1)),this._sw}},se:{get:function(){return this._se||(this._se=new tC(this.tilingScheme,this,this.level+1,this.x*2+1,this.y*2+1)),this._se}}});function nnt(e,t,n,i,o){this.level=e,this.west=t,this.south=n,this.east=i,this.north=o}function Z9(e,t){let n=Math.max(e.west,t.west),i=Math.max(e.south,t.south),o=Math.min(e.east,t.east),r=Math.min(e.north,t.north);return i<r&&n<o}function int(e,t,n){for(;t.level<e;)if(cL(t.nw.extent,n))t=t.nw;else if(cL(t.ne.extent,n))t=t.ne;else if(cL(t.sw.extent,n))t=t.sw;else if(cL(t.se.extent,n))t=t.se;else break;if(t.rectangles.length===0||t.rectangles[t.rectangles.length-1].level<=n.level)t.rectangles.push(n);else{let i=vo(t.rectangles,n.level,ont);i<0&&(i=~i),t.rectangles.splice(i,0,n)}}function ont(e,t){return e.level-t}function cL(e,t){return t.west>=e.west&&t.east<=e.east&&t.south>=e.south&&t.north<=e.north}function nC(e,t){return t.longitude>=e.west&&t.longitude<=e.east&&t.latitude>=e.south&&t.latitude<=e.north}function dD(e,t,n){let i=0,o=!1;for(;!o;){let r=t._nw&&nC(t._nw.extent,n),s=t._ne&&nC(t._ne.extent,n),a=t._sw&&nC(t._sw.extent,n),l=t._se&&nC(t._se.extent,n);if(r+s+a+l>1){r&&(i=Math.max(i,dD(t,t._nw,n))),s&&(i=Math.max(i,dD(t,t._ne,n))),a&&(i=Math.max(i,dD(t,t._sw,n))),l&&(i=Math.max(i,dD(t,t._se,n)));break}else r?t=t._nw:s?t=t._ne:a?t=t._sw:l?t=t._se:o=!0}for(;t!==e;){let r=t.rectangles;for(let s=r.length-1;s>=0&&r[s].level>i;--s){let a=r[s];nC(a,n)&&(i=a.level)}t=t.parent}return i}function hD(e,t,n){if(!t)return;let i,o=!1;for(i=0;i<n.length;++i)o=o||Z9(t.extent,n[i]);if(!o)return;let r=t.rectangles;for(i=0;i<r.length;++i){let s=r[i];e[s.level]||(e[s.level]=n),e[s.level]=rnt(e[s.level],s)}hD(e,t._nw,n),hD(e,t._ne,n),hD(e,t._sw,n),hD(e,t._se,n)}function rnt(e,t){let n=[];for(let i=0;i<e.length;++i){let o=e[i];Z9(o,t)?(o.west<t.west&&n.push(new ae(o.west,o.south,t.west,o.north)),o.east>t.east&&n.push(new ae(t.east,o.south,o.east,o.north)),o.south<t.south&&n.push(new ae(Math.max(t.west,o.west),o.south,Math.min(t.east,o.east),t.south)),o.north>t.north&&n.push(new ae(Math.max(t.west,o.west),t.north,Math.min(t.east,o.east),o.north))):n.push(o)}return n}var $p=iC;function snt(e){let t,n=e.name,i=e.message;c(n)&&c(i)?t=`${n}: ${i}`:t=e.toString();let o=e.stack;return c(o)&&(t+=`
${o}`),t}var Kg=snt;function lL(e,t,n,i,o,r,s){this.provider=e,this.message=t,this.x=n,this.y=i,this.level=o,this.timesRetried=y(r,0),this.retry=!1,this.error=s}lL.reportError=function(e,t,n,i,o,r,s,a){let l=e;return c(e)?(l.provider=t,l.message=i,l.x=o,l.y=r,l.level=s,l.retry=!1,l.error=a,++l.timesRetried):l=new lL(t,i,o,r,s,0,a),c(n)&&n.numberOfListeners>0?n.raiseEvent(l):c(t)&&console.log(`An error occurred in "${t.constructor.name}": ${Kg(i)}`),l};lL.reportSuccess=function(e){c(e)&&(e.timesRetried=-1)};var No=lL;function $g(e){if(e=y(e,y.EMPTY_OBJECT),this._ellipsoid=y(e.ellipsoid,ie.default),this._numberOfLevelZeroTilesX=y(e.numberOfLevelZeroTilesX,1),this._numberOfLevelZeroTilesY=y(e.numberOfLevelZeroTilesY,1),this._projection=new Li(this._ellipsoid),c(e.rectangleSouthwestInMeters)&&c(e.rectangleNortheastInMeters))this._rectangleSouthwestInMeters=e.rectangleSouthwestInMeters,this._rectangleNortheastInMeters=e.rectangleNortheastInMeters;else{let i=this._ellipsoid.maximumRadius*Math.PI;this._rectangleSouthwestInMeters=new H(-i,-i),this._rectangleNortheastInMeters=new H(i,i)}let t=this._projection.unproject(this._rectangleSouthwestInMeters),n=this._projection.unproject(this._rectangleNortheastInMeters);this._rectangle=new ae(t.longitude,t.latitude,n.longitude,n.latitude)}Object.defineProperties($g.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},rectangle:{get:function(){return this._rectangle}},projection:{get:function(){return this._projection}}});$g.prototype.getNumberOfXTilesAtLevel=function(e){return this._numberOfLevelZeroTilesX<<e};$g.prototype.getNumberOfYTilesAtLevel=function(e){return this._numberOfLevelZeroTilesY<<e};$g.prototype.rectangleToNativeRectangle=function(e,t){let n=this._projection,i=n.project(ae.southwest(e)),o=n.project(ae.northeast(e));return c(t)?(t.west=i.x,t.south=i.y,t.east=o.x,t.north=o.y,t):new ae(i.x,i.y,o.x,o.y)};$g.prototype.tileXYToNativeRectangle=function(e,t,n,i){let o=this.getNumberOfXTilesAtLevel(n),r=this.getNumberOfYTilesAtLevel(n),s=(this._rectangleNortheastInMeters.x-this._rectangleSouthwestInMeters.x)/o,a=this._rectangleSouthwestInMeters.x+e*s,l=this._rectangleSouthwestInMeters.x+(e+1)*s,u=(this._rectangleNortheastInMeters.y-this._rectangleSouthwestInMeters.y)/r,f=this._rectangleNortheastInMeters.y-t*u,d=this._rectangleNortheastInMeters.y-(t+1)*u;return c(i)?(i.west=a,i.south=d,i.east=l,i.north=f,i):new ae(a,d,l,f)};$g.prototype.tileXYToRectangle=function(e,t,n,i){let o=this.tileXYToNativeRectangle(e,t,n,i),r=this._projection,s=r.unproject(new H(o.west,o.south)),a=r.unproject(new H(o.east,o.north));return o.west=s.longitude,o.south=s.latitude,o.east=a.longitude,o.north=a.latitude,o};$g.prototype.positionToTileXY=function(e,t,n){let i=this._rectangle;if(!ae.contains(i,e))return;let o=this.getNumberOfXTilesAtLevel(t),r=this.getNumberOfYTilesAtLevel(t),a=(this._rectangleNortheastInMeters.x-this._rectangleSouthwestInMeters.x)/o,u=(this._rectangleNortheastInMeters.y-this._rectangleSouthwestInMeters.y)/r,d=this._projection.project(e),p=d.x-this._rectangleSouthwestInMeters.x,g=this._rectangleNortheastInMeters.y-d.y,m=p/a|0;m>=o&&(m=o-1);let b=g/u|0;return b>=r&&(b=r-1),c(n)?(n.x=m,n.y=b,n):new H(m,b)};var ys=$g;var ant=15;function Xpe(e){this.ellipsoid=y(e.ellipsoid,ie.default),this.credit=void 0,this.tilingScheme=void 0,this.height=void 0,this.width=void 0,this.encoding=void 0,this.lodCount=void 0,this.hasAvailability=!1,this.tilesAvailable=void 0,this.tilesAvailabilityLoaded=void 0,this.levelZeroMaximumGeometricError=void 0,this.terrainDataStructure=void 0}Xpe.prototype.build=function(e){e._credit=this.credit,e._tilingScheme=this.tilingScheme,e._height=this.height,e._width=this.width,e._encoding=this.encoding,e._lodCount=this.lodCount,e._hasAvailability=this.hasAvailability,e._tilesAvailable=this.tilesAvailable,e._tilesAvailabilityLoaded=this.tilesAvailabilityLoaded,e._levelZeroMaximumGeometricError=this.levelZeroMaximumGeometricError,e._terrainDataStructure=this.terrainDataStructure};function cnt(e,t){let n=t.copyrightText;c(n)&&(e.credit=new Pt(n));let i=t.spatialReference,o=y(i.latestWkid,i.wkid),r=t.extent,s={ellipsoid:e.ellipsoid};if(o===4326)s.rectangle=ae.fromDegrees(r.xmin,r.ymin,r.xmax,r.ymax),e.tilingScheme=new $i(s);else if(o===3857){let u=Math.PI*e.ellipsoid.maximumRadius;t.extent.xmax>u&&(t.extent.xmax=u),t.extent.ymax>u&&(t.extent.ymax=u),t.extent.xmin<-u&&(t.extent.xmin=-u),t.extent.ymin<-u&&(t.extent.ymin=-u),s.rectangleSouthwestInMeters=new H(r.xmin,r.ymin),s.rectangleNortheastInMeters=new H(r.xmax,r.ymax),e.tilingScheme=new ys(s)}else throw new ue("Invalid spatial reference");let a=t.tileInfo;if(!c(a))throw new ue("tileInfo is required");e.width=a.rows+1,e.height=a.cols+1,e.encoding=a.format==="LERC"?Jh.LERC:Jh.NONE,e.lodCount=a.lods.length-1,(e.hasAvailability=t.capabilities.indexOf("Tilemap")!==-1)&&(e.tilesAvailable=new $p(e.tilingScheme,e.lodCount),e.tilesAvailable.addAvailableTileRange(0,0,0,e.tilingScheme.getNumberOfXTilesAtLevel(0),e.tilingScheme.getNumberOfYTilesAtLevel(0)),e.tilesAvailabilityLoaded=new $p(e.tilingScheme,e.lodCount)),e.levelZeroMaximumGeometricError=gs.getEstimatedLevelZeroGeometricErrorForAHeightmap(e.tilingScheme.ellipsoid,e.width,e.tilingScheme.getNumberOfXTilesAtLevel(0)),t.bandCount>1&&console.log("ArcGISTiledElevationTerrainProvider: Terrain data has more than 1 band. Using the first one."),c(t.minValues)&&c(t.maxValues)?e.terrainDataStructure={elementMultiplier:1,lowestEncodedHeight:t.minValues[0],highestEncodedHeight:t.maxValues[0]}:e.terrainDataStructure={elementMultiplier:1}}async function lnt(e,t,n){try{let i=await t.fetchJson();cnt(e,i)}catch(i){let o=`An error occurred while accessing ${t}.`;throw No.reportError(void 0,n,c(n)?n._errorEvent:void 0,o),i}}function Zg(e){e=y(e,y.EMPTY_OBJECT),this._resource=void 0,this._credit=void 0,this._tilingScheme=void 0,this._levelZeroMaximumGeometricError=void 0,this._maxLevel=void 0,this._terrainDataStructure=void 0,this._width=void 0,this._height=void 0,this._encoding=void 0,this._lodCount=void 0,this._hasAvailability=!1,this._tilesAvailable=void 0,this._tilesAvailabilityLoaded=void 0,this._availableCache={},this._errorEvent=new pe}Object.defineProperties(Zg.prototype,{errorEvent:{get:function(){return this._errorEvent}},credit:{get:function(){return this._credit}},tilingScheme:{get:function(){return this._tilingScheme}},hasWaterMask:{get:function(){return!1}},hasVertexNormals:{get:function(){return!1}},availability:{get:function(){return this._tilesAvailable}}});Zg.fromUrl=async function(e,t){A.defined("url",e),t=y(t,y.EMPTY_OBJECT),e=await Promise.resolve(e);let n=De.createIfNeeded(e);n.appendForwardSlash(),c(t.token)&&(n=n.getDerivedResource({queryParameters:{token:t.token}}));let i=n.getDerivedResource({queryParameters:{f:"pjson"}}),o=new Xpe(t);await lnt(o,i);let r=new Zg(t);return o.build(r),r._resource=n,r};Zg.prototype.requestTileGeometry=function(e,t,n,i){let o=this._resource.getDerivedResource({url:`tile/${n}/${t}/${e}`,request:i}),r=this._hasAvailability,s=Promise.resolve(!0),a;if(r&&!c(J9(this,n+1,e*2,t*2))){let d=Kpe(this,n+1,e*2,t*2);s=d.promise,a=d.request}let l=o.fetchArrayBuffer();if(!c(l)||!c(s))return;let u=this,f=this._tilesAvailable;return Promise.all([l,s]).then(function(d){return new Mc({buffer:d[0],width:u._width,height:u._height,childTileMask:r?f.computeChildMaskForTile(n,e,t):ant,structure:u._terrainDataStructure,encoding:u._encoding})}).catch(async function(d){if(c(a)&&a.state===Jn.CANCELLED){i.cancel();try{await i.deferred?.promise}catch{}return i.state=Jn.CANCELLED,Promise.reject(d)}return Promise.reject(d)})};function J9(e,t,n,i){if(!e._hasAvailability)return;let o=e._tilesAvailabilityLoaded,r=e._tilesAvailable;if(t>e._lodCount)return!1;if(r.isTileAvailable(t,n,i))return!0;if(o.isTileAvailable(t,n,i))return!1}Zg.prototype.getLevelMaximumGeometricError=function(e){return this._levelZeroMaximumGeometricError/(1<<e)};Zg.prototype.getTileDataAvailable=function(e,t,n){if(!this._hasAvailability)return;let i=J9(this,n,e,t);if(c(i))return i;Kpe(this,n,e,t)};Zg.prototype.loadTileDataAvailability=function(e,t,n){};function unt(e,t,n,i){let o=t-1,r=n-1,s=i[e.y*t+e.x],a=[],l={startX:e.x,startY:e.y,endX:0,endY:0},u=new H(e.x+1,e.y+1),f=!1,d=!1;for(;!(f&&d);){let p=u.x,g=d?u.y+1:u.y;if(!f){for(let m=e.y;m<g;++m)if(i[m*t+u.x]!==s){f=!0;break}f?(a.push(new H(u.x,e.y)),--u.x,--p,l.endX=u.x):u.x===o?(l.endX=u.x,f=!0):++u.x}if(!d){let m=u.y*t;for(let b=e.x;b<=p;++b)if(i[m+b]!==s){d=!0;break}d?(a.push(new H(e.x,u.y)),--u.y,l.endY=u.y):u.y===r?(l.endY=u.y,d=!0):++u.y}}return{endingIndices:a,range:l,value:s}}function fnt(e,t,n,i,o){let r=[];if(o.every(function(l){return l===o[0]}))return o[0]===1&&r.push({startX:e,startY:t,endX:e+n-1,endY:t+i-1}),r;let a=[new H(0,0)];for(;a.length>0;){let l=a.pop(),u=unt(l,n,i,o);if(u.value===1){let d=u.range;d.startX+=e,d.endX+=e,d.startY+=t,d.endY+=t,r.push(d)}let f=u.endingIndices;f.length>0&&(a=a.concat(f))}return r}function Kpe(e,t,n,i){if(!e._hasAvailability)return{};let o=Math.floor(n/128)*128,r=Math.floor(i/128)*128,s=Math.min(1<<t,128),a=`tilemap/${t}/${r}/${o}/${s}/${s}`,l=e._availableCache;if(c(l[a]))return l[a];let u=new ur({throttle:!1,throttleByServer:!0,type:Es.TERRAIN}),d=e._resource.getDerivedResource({url:a,request:u}).fetchJson();return c(d)?(d=d.then(function(p){let g=fnt(o,r,s,s,p.data);e._tilesAvailabilityLoaded.addAvailableTileRange(t,o,r,o+s,r+s);let m=e._tilesAvailable;for(let b=0;b<g.length;++b){let x=g[b];m.addAvailableTileRange(t,x.startX,x.startY,x.endX,x.endY)}return J9(e,t,n,i)}),l[a]={promise:d,request:u},d=d.finally(function(p){return delete l[a],p}),{promise:d,request:u}):{}}var dnt=Zg;var $pe="https://dev.virtualearth.net/REST/v1/Locations";function Q9(e){e=y(e,y.EMPTY_OBJECT);let t=e.key;if(!c(t))throw new E("options.key is required.");this._key=t;let n={key:t};c(e.culture)&&(n.culture=e.culture),this._resource=new De({url:$pe,queryParameters:n}),this._credit=new Pt('<img src="http://dev.virtualearth.net/Branding/logo_powered_by.png"/>',!1)}Object.defineProperties(Q9.prototype,{url:{get:function(){return $pe}},key:{get:function(){return this._key}},credit:{get:function(){return this._credit}}});Q9.prototype.geocode=async function(e){return A.typeOf.string("query",e),this._resource.getDerivedResource({queryParameters:{query:e}}).fetchJsonp("jsonp").then(function(n){return n.resourceSets.length===0?[]:n.resourceSets[0].resources.map(function(o){let r=o.bbox,s=r[0],a=r[1],l=r[2],u=r[3];return{displayName:o.name,destination:ae.fromDegrees(a,s,u,l)}})})};var hnt=Q9;function eW(){}Object.defineProperties(eW.prototype,{credit:{get:function(){}}});eW.prototype.geocode=function(e){A.typeOf.string("query",e);let t=e.match(/[^\s,\n]+/g);if(t.length===2||t.length===3){let n=+t[0],i=+t[1],o=t.length===3?+t[2]:300;if(isNaN(n)&&isNaN(i)){let r=/^(\d+.?\d*)([nsew])/i;for(let s=0;s<t.length;++s){let a=t[s].match(r);r.test(t[s])&&a.length===3&&(/^[ns]/i.test(a[2])?i=/^[n]/i.test(a[2])?+a[1]:-a[1]:/^[ew]/i.test(a[2])&&(n=/^[e]/i.test(a[2])?+a[1]:-a[1]))}}if(!isNaN(n)&&!isNaN(i)&&!isNaN(o)){let r={displayName:e,destination:h.fromDegrees(n,i,o)};return Promise.resolve([r])}}return Promise.resolve([])};var mnt=eW;var pnt=new se,Zpe=new h,oC=new h;function _nt(e){let t=e.points,n=e.times;if(t.length<3){let i=n[0],o=1/(n[1]-i),r=t[0],s=t[1];return function(a,l){c(l)||(l=new h);let u=(a-i)*o;return h.lerp(r,s,u,l)}}return function(i,o){c(o)||(o=new h);let r=e._lastTimeIndex=e.findTimeInterval(i,e._lastTimeIndex),s=(i-n[r])/(n[r+1]-n[r]),a=pnt;a.z=s,a.y=s*s,a.x=a.y*s,a.w=1;let l,u,f,d,p;return r===0?(l=t[0],u=t[1],f=e.firstTangent,d=h.subtract(t[2],l,Zpe),h.multiplyByScalar(d,.5,d),p=k.multiplyByVector(ST.hermiteCoefficientMatrix,a,a)):r===t.length-2?(l=t[r],u=t[r+1],d=e.lastTangent,f=h.subtract(u,t[r-1],Zpe),h.multiplyByScalar(f,.5,f),p=k.multiplyByVector(ST.hermiteCoefficientMatrix,a,a)):(l=t[r-1],u=t[r],f=t[r+1],d=t[r+2],p=k.multiplyByVector(Jg.catmullRomCoefficientMatrix,a,a)),o=h.multiplyByScalar(l,p.x,o),h.multiplyByScalar(u,p.y,oC),h.add(o,oC,o),h.multiplyByScalar(f,p.z,oC),h.add(o,oC,o),h.multiplyByScalar(d,p.w,oC),h.add(o,oC,o)}}var gnt=new h,ynt=new h;function Jg(e){e=y(e,y.EMPTY_OBJECT);let t=e.points,n=e.times,i=e.firstTangent,o=e.lastTangent;if(A.defined("points",t),A.defined("times",n),A.typeOf.number.greaterThanOrEquals("points.length",t.length,2),A.typeOf.number.equals("times.length","points.length",n.length,t.length),t.length>2&&(c(i)||(i=gnt,h.multiplyByScalar(t[1],2,i),h.subtract(i,t[2],i),h.subtract(i,t[0],i),h.multiplyByScalar(i,.5,i)),!c(o))){let r=t.length-1;o=ynt,h.multiplyByScalar(t[r-1],2,o),h.subtract(t[r],o,o),h.add(o,t[r-2],o),h.multiplyByScalar(o,.5,o)}this._times=n,this._points=t,this._firstTangent=h.clone(i),this._lastTangent=h.clone(o),this._evaluateFunction=_nt(this),this._lastTimeIndex=0}Object.defineProperties(Jg.prototype,{times:{get:function(){return this._times}},points:{get:function(){return this._points}},firstTangent:{get:function(){return this._firstTangent}},lastTangent:{get:function(){return this._lastTangent}}});Jg.catmullRomCoefficientMatrix=new k(-.5,1,-.5,0,1.5,-2.5,0,1,-1.5,2,.5,0,.5,-.5,0,0);Jg.prototype.findTimeInterval=Fi.prototype.findTimeInterval;Jg.prototype.wrapTime=Fi.prototype.wrapTime;Jg.prototype.clampTime=Fi.prototype.clampTime;Jg.prototype.evaluate=function(e,t){return this._evaluateFunction(e,t)};var bnt=Jg;var uL={};uL.clipTriangleAtAxisAlignedThreshold=function(e,t,n,i,o,r){if(!c(e))throw new E("threshold is required.");if(!c(t))throw new E("keepAbove is required.");if(!c(n))throw new E("u0 is required.");if(!c(i))throw new E("u1 is required.");if(!c(o))throw new E("u2 is required.");c(r)?r.length=0:r=[];let s,a,l;t?(s=n<e,a=i<e,l=o<e):(s=n>e,a=i>e,l=o>e);let u=s+a+l,f,d,p,g,m,b;return u===1?s?(f=(e-n)/(i-n),d=(e-n)/(o-n),r.push(1),r.push(2),d!==1&&(r.push(-1),r.push(0),r.push(2),r.push(d)),f!==1&&(r.push(-1),r.push(0),r.push(1),r.push(f))):a?(p=(e-i)/(o-i),g=(e-i)/(n-i),r.push(2),r.push(0),g!==1&&(r.push(-1),r.push(1),r.push(0),r.push(g)),p!==1&&(r.push(-1),r.push(1),r.push(2),r.push(p))):l&&(m=(e-o)/(n-o),b=(e-o)/(i-o),r.push(0),r.push(1),b!==1&&(r.push(-1),r.push(2),r.push(1),r.push(b)),m!==1&&(r.push(-1),r.push(2),r.push(0),r.push(m))):u===2?!s&&n!==e?(g=(e-i)/(n-i),m=(e-o)/(n-o),r.push(0),r.push(-1),r.push(1),r.push(0),r.push(g),r.push(-1),r.push(2),r.push(0),r.push(m)):!a&&i!==e?(b=(e-o)/(i-o),f=(e-n)/(i-n),r.push(1),r.push(-1),r.push(2),r.push(1),r.push(b),r.push(-1),r.push(0),r.push(1),r.push(f)):!l&&o!==e&&(d=(e-n)/(o-n),p=(e-i)/(o-i),r.push(2),r.push(-1),r.push(0),r.push(2),r.push(d),r.push(-1),r.push(1),r.push(2),r.push(p)):u!==3&&(r.push(0),r.push(1),r.push(2)),r};uL.computeBarycentricCoordinates=function(e,t,n,i,o,r,s,a,l){if(!c(e))throw new E("x is required.");if(!c(t))throw new E("y is required.");if(!c(n))throw new E("x1 is required.");if(!c(i))throw new E("y1 is required.");if(!c(o))throw new E("x2 is required.");if(!c(r))throw new E("y2 is required.");if(!c(s))throw new E("x3 is required.");if(!c(a))throw new E("y3 is required.");let u=n-s,f=s-o,d=r-a,p=i-a,g=1/(d*u+f*p),m=t-a,b=e-s,x=(d*b+f*m)*g,T=(-p*b+u*m)*g,C=1-x-T;return c(l)?(l.x=x,l.y=T,l.z=C,l):new h(x,T,C)};uL.computeLineSegmentLineSegmentIntersection=function(e,t,n,i,o,r,s,a,l){A.typeOf.number("x00",e),A.typeOf.number("y00",t),A.typeOf.number("x01",n),A.typeOf.number("y01",i),A.typeOf.number("x10",o),A.typeOf.number("y10",r),A.typeOf.number("x11",s),A.typeOf.number("y11",a);let u=(s-o)*(t-r)-(a-r)*(e-o),f=(n-e)*(t-r)-(i-t)*(e-o),d=(a-r)*(n-e)-(s-o)*(i-t);if(d===0)return;let p=u/d,g=f/d;if(p>=0&&p<=1&&g>=0&&g<=1)return c(l)||(l=new H),l.x=e+p*(n-e),l.y=t+p*(i-t),l};var Ob=uL;function Qg(e){if(!c(e)||!c(e.quantizedVertices))throw new E("options.quantizedVertices is required.");if(!c(e.indices))throw new E("options.indices is required.");if(!c(e.minimumHeight))throw new E("options.minimumHeight is required.");if(!c(e.maximumHeight))throw new E("options.maximumHeight is required.");if(!c(e.maximumHeight))throw new E("options.maximumHeight is required.");if(!c(e.boundingSphere))throw new E("options.boundingSphere is required.");if(!c(e.horizonOcclusionPoint))throw new E("options.horizonOcclusionPoint is required.");if(!c(e.westIndices))throw new E("options.westIndices is required.");if(!c(e.southIndices))throw new E("options.southIndices is required.");if(!c(e.eastIndices))throw new E("options.eastIndices is required.");if(!c(e.northIndices))throw new E("options.northIndices is required.");if(!c(e.westSkirtHeight))throw new E("options.westSkirtHeight is required.");if(!c(e.southSkirtHeight))throw new E("options.southSkirtHeight is required.");if(!c(e.eastSkirtHeight))throw new E("options.eastSkirtHeight is required.");if(!c(e.northSkirtHeight))throw new E("options.northSkirtHeight is required.");this._quantizedVertices=e.quantizedVertices,this._encodedNormals=e.encodedNormals,this._indices=e.indices,this._minimumHeight=e.minimumHeight,this._maximumHeight=e.maximumHeight,this._boundingSphere=e.boundingSphere,this._orientedBoundingBox=e.orientedBoundingBox,this._horizonOcclusionPoint=e.horizonOcclusionPoint,this._credits=e.credits;let t=this._quantizedVertices.length/3,n=this._uValues=this._quantizedVertices.subarray(0,t),i=this._vValues=this._quantizedVertices.subarray(t,2*t);this._heightValues=this._quantizedVertices.subarray(2*t,3*t);function o(s,a){return i[s]-i[a]}function r(s,a){return n[s]-n[a]}this._westIndices=dL(e.westIndices,o,t),this._southIndices=dL(e.southIndices,r,t),this._eastIndices=dL(e.eastIndices,o,t),this._northIndices=dL(e.northIndices,r,t),this._westSkirtHeight=e.westSkirtHeight,this._southSkirtHeight=e.southSkirtHeight,this._eastSkirtHeight=e.eastSkirtHeight,this._northSkirtHeight=e.northSkirtHeight,this._childTileMask=y(e.childTileMask,15),this._createdByUpsampling=y(e.createdByUpsampling,!1),this._waterMask=e.waterMask,this._mesh=void 0}Object.defineProperties(Qg.prototype,{credits:{get:function(){return this._credits}},waterMask:{get:function(){return this._waterMask}},childTileMask:{get:function(){return this._childTileMask}},canUpsample:{get:function(){return c(this._mesh)}}});var fL=[];function dL(e,t,n){fL.length=e.length;let i=!1;for(let o=0,r=e.length;o<r;++o)fL[o]=e[o],i=i||o>0&&t(e[o-1],e[o])>0;return i?(fL.sort(t),Fe.createTypedArray(n,fL)):e}var Jpe="createVerticesFromQuantizedTerrainMesh",xnt=new Ti(Jpe),Tnt=new Ti(Jpe,Xp.maximumAsynchronousTasks);Qg.prototype.createMesh=function(e){e=y(e,y.EMPTY_OBJECT),A.typeOf.object("options.tilingScheme",e.tilingScheme),A.typeOf.number("options.x",e.x),A.typeOf.number("options.y",e.y),A.typeOf.number("options.level",e.level);let t=e.tilingScheme,n=e.x,i=e.y,o=e.level,r=y(e.exaggeration,1),s=y(e.exaggerationRelativeHeight,0),a=y(e.throttle,!0),l=t.ellipsoid,u=t.tileXYToRectangle(n,i,o),d=(a?Tnt:xnt).scheduleTask({minimumHeight:this._minimumHeight,maximumHeight:this._maximumHeight,quantizedVertices:this._quantizedVertices,octEncodedNormals:this._encodedNormals,includeWebMercatorT:!0,indices:this._indices,westIndices:this._westIndices,southIndices:this._southIndices,eastIndices:this._eastIndices,northIndices:this._northIndices,westSkirtHeight:this._westSkirtHeight,southSkirtHeight:this._southSkirtHeight,eastSkirtHeight:this._eastSkirtHeight,northSkirtHeight:this._northSkirtHeight,rectangle:u,relativeToCenter:this._boundingSphere.center,ellipsoid:l,exaggeration:r,exaggerationRelativeHeight:s});if(!c(d))return;let p=this;return Promise.resolve(d).then(function(g){let m=p._quantizedVertices.length/3,b=m+p._westIndices.length+p._southIndices.length+p._eastIndices.length+p._northIndices.length,x=Fe.createTypedArray(b,g.indices),T=new Float32Array(g.vertices),C=g.center,S=g.minimumHeight,v=g.maximumHeight,D=p._boundingSphere,I=p._orientedBoundingBox,L=y(h.clone(g.occludeePointInScaledSpace),p._horizonOcclusionPoint),M=g.vertexStride,N=xl.clone(g.encoding);return p._mesh=new em(C,T,x,g.indexCountWithoutSkirts,m,S,v,D,L,M,I,N,g.westIndicesSouthToNorth,g.southIndicesEastToWest,g.eastIndicesNorthToSouth,g.northIndicesWestToEast),p._quantizedVertices=void 0,p._encodedNormals=void 0,p._indices=void 0,p._uValues=void 0,p._vValues=void 0,p._heightValues=void 0,p._westIndices=void 0,p._southIndices=void 0,p._eastIndices=void 0,p._northIndices=void 0,p._mesh})};var Ant=new Ti("upsampleQuantizedTerrainMesh",Xp.maximumAsynchronousTasks);Qg.prototype.upsample=function(e,t,n,i,o,r,s){if(!c(e))throw new E("tilingScheme is required.");if(!c(t))throw new E("thisX is required.");if(!c(n))throw new E("thisY is required.");if(!c(i))throw new E("thisLevel is required.");if(!c(o))throw new E("descendantX is required.");if(!c(r))throw new E("descendantY is required.");if(!c(s))throw new E("descendantLevel is required.");if(s-i>1)throw new E("Upsampling through more than one level at a time is not currently supported.");let l=this._mesh;if(!c(this._mesh))return;let u=t*2!==o,f=n*2===r,d=e.ellipsoid,p=e.tileXYToRectangle(o,r,s),g=Ant.scheduleTask({vertices:l.vertices,vertexCountWithoutSkirts:l.vertexCountWithoutSkirts,indices:l.indices,indexCountWithoutSkirts:l.indexCountWithoutSkirts,encoding:l.encoding,minimumHeight:this._minimumHeight,maximumHeight:this._maximumHeight,isEastChild:u,isNorthChild:f,childRectangle:p,ellipsoid:d});if(!c(g))return;let m=Math.min(this._westSkirtHeight,this._eastSkirtHeight);m=Math.min(m,this._southSkirtHeight),m=Math.min(m,this._northSkirtHeight);let b=u?m*.5:this._westSkirtHeight,x=f?m*.5:this._southSkirtHeight,T=u?this._eastSkirtHeight:m*.5,C=f?this._northSkirtHeight:m*.5,S=this._credits;return Promise.resolve(g).then(function(v){let D=new Uint16Array(v.vertices),I=Fe.createTypedArray(D.length/3,v.indices),L;return c(v.encodedNormals)&&(L=new Uint8Array(v.encodedNormals)),new Qg({quantizedVertices:D,indices:I,encodedNormals:L,minimumHeight:v.minimumHeight,maximumHeight:v.maximumHeight,boundingSphere:ce.clone(v.boundingSphere),orientedBoundingBox:Pn.clone(v.orientedBoundingBox),horizonOcclusionPoint:h.clone(v.horizonOcclusionPoint),westIndices:v.westIndices,southIndices:v.southIndices,eastIndices:v.eastIndices,northIndices:v.northIndices,westSkirtHeight:b,southSkirtHeight:x,eastSkirtHeight:T,northSkirtHeight:C,childTileMask:0,credits:S,createdByUpsampling:!0})})};var tW=32767,Qpe=new h;Qg.prototype.interpolateHeight=function(e,t,n){let i=R.clamp((t-e.west)/e.width,0,1);i*=tW;let o=R.clamp((n-e.south)/e.height,0,1);return o*=tW,c(this._mesh)?wnt(this,i,o):vnt(this,i,o)};function e_e(e,t,n,i,o,r,s,a){let l=Math.min(n,o,s),u=Math.max(n,o,s),f=Math.min(i,r,a),d=Math.max(i,r,a);return e>=l&&e<=u&&t>=f&&t<=d}var Cnt=new H,Ent=new H,Snt=new H;function wnt(e,t,n){let i=e._mesh,o=i.vertices,r=i.encoding,s=i.indices;for(let a=0,l=s.length;a<l;a+=3){let u=s[a],f=s[a+1],d=s[a+2],p=r.decodeTextureCoordinates(o,u,Cnt),g=r.decodeTextureCoordinates(o,f,Ent),m=r.decodeTextureCoordinates(o,d,Snt);if(e_e(t,n,p.x,p.y,g.x,g.y,m.x,m.y)){let b=Ob.computeBarycentricCoordinates(t,n,p.x,p.y,g.x,g.y,m.x,m.y,Qpe);if(b.x>=-1e-15&&b.y>=-1e-15&&b.z>=-1e-15){let x=r.decodeHeight(o,u),T=r.decodeHeight(o,f),C=r.decodeHeight(o,d);return b.x*x+b.y*T+b.z*C}}}}function vnt(e,t,n){let i=e._uValues,o=e._vValues,r=e._heightValues,s=e._indices;for(let a=0,l=s.length;a<l;a+=3){let u=s[a],f=s[a+1],d=s[a+2],p=i[u],g=i[f],m=i[d],b=o[u],x=o[f],T=o[d];if(e_e(t,n,p,b,g,x,m,T)){let C=Ob.computeBarycentricCoordinates(t,n,p,b,g,x,m,T,Qpe);if(C.x>=-1e-15&&C.y>=-1e-15&&C.z>=-1e-15){let S=C.x*r[u]+C.y*r[f]+C.z*r[d];return R.lerp(e._minimumHeight,e._maximumHeight,S/tW)}}}}Qg.prototype.isChildAvailable=function(e,t,n,i){if(!c(e))throw new E("thisX is required.");if(!c(t))throw new E("thisY is required.");if(!c(n))throw new E("childX is required.");if(!c(i))throw new E("childY is required.");let o=2;return n!==e*2&&++o,i!==t*2&&(o-=2),(this._childTileMask&1<<o)!==0};Qg.prototype.wasCreatedByUpsampling=function(){return this._createdByUpsampling};var mD=Qg;function Dnt(e){this.resource=e.resource,this.version=e.version,this.isHeightmap=e.isHeightmap,this.tileUrlTemplates=e.tileUrlTemplates,this.availability=e.availability,this.hasVertexNormals=e.hasVertexNormals,this.hasWaterMask=e.hasWaterMask,this.hasMetadata=e.hasMetadata,this.availabilityLevels=e.availabilityLevels,this.availabilityTilesLoaded=e.availabilityTilesLoaded,this.littleEndianExtensionSize=e.littleEndianExtensionSize,this.availabilityPromiseCache={}}function n_e(e){this.requestVertexNormals=y(e.requestVertexNormals,!1),this.requestWaterMask=y(e.requestWaterMask,!1),this.requestMetadata=y(e.requestMetadata,!0),this.ellipsoid=y(e.ellipsoid,ie.default),this.heightmapWidth=65,this.heightmapStructure=void 0,this.hasWaterMask=!1,this.hasMetadata=!1,this.hasVertexNormals=!1,this.scheme=void 0,this.lastResource=void 0,this.layerJsonResource=void 0,this.previousError=void 0,this.availability=void 0,this.tilingScheme=void 0,this.levelZeroMaximumGeometricError=void 0,this.heightmapStructure=void 0,this.layers=[],this.attribution="",this.overallAvailability=[],this.overallMaxZoom=0,this.tileCredits=[]}n_e.prototype.build=function(e){e._heightmapWidth=this.heightmapWidth,e._scheme=this.scheme;let t=c(this.lastResource.credits)?this.lastResource.credits:[];e._tileCredits=t.concat(this.tileCredits),e._availability=this.availability,e._tilingScheme=this.tilingScheme,e._requestWaterMask=this.requestWaterMask,e._levelZeroMaximumGeometricError=this.levelZeroMaximumGeometricError,e._heightmapStructure=this.heightmapStructure,e._layers=this.layers,e._hasWaterMask=this.hasWaterMask,e._hasVertexNormals=this.hasVertexNormals,e._hasMetadata=this.hasMetadata};async function i_e(e,t,n){if(!t.format){let b="The tile format is not specified in the layer.json file.";throw e.previousError=No.reportError(e.previousError,n,c(n)?n._errorEvent:void 0,b),new ue(b)}if(!t.tiles||t.tiles.length===0){let b="The layer.json file does not specify any tile URL templates.";throw e.previousError=No.reportError(e.previousError,n,c(n)?n._errorEvent:void 0,b),new ue(b)}let i=!1,o=!1,r=!1,s=!0,a=!1;if(t.format==="heightmap-1.0")a=!0,c(e.heightmapStructure)||(e.heightmapStructure={heightScale:1/5,heightOffset:-1e3,elementsPerHeight:1,stride:1,elementMultiplier:256,isBigEndian:!1,lowestEncodedHeight:0,highestEncodedHeight:256*256-1}),o=!0,e.requestWaterMask=!0;else if(t.format.indexOf("quantized-mesh-1.")!==0){let b=`The tile format "${t.format}" is invalid or not supported.`;throw e.previousError=No.reportError(e.previousError,n,c(n)?n._errorEvent:void 0,b),new ue(b)}let l=t.tiles,u=t.maxzoom;if(e.overallMaxZoom=Math.max(e.overallMaxZoom,u),!t.projection||t.projection==="EPSG:4326")e.tilingScheme=new $i({numberOfLevelZeroTilesX:2,numberOfLevelZeroTilesY:1,ellipsoid:e.ellipsoid});else if(t.projection==="EPSG:3857")e.tilingScheme=new ys({numberOfLevelZeroTilesX:1,numberOfLevelZeroTilesY:1,ellipsoid:e.ellipsoid});else{let b=`The projection "${t.projection}" is invalid or not supported.`;throw e.previousError=No.reportError(e.previousError,n,c(n)?n._errorEvent:void 0,b),new ue(b)}if(e.levelZeroMaximumGeometricError=gs.getEstimatedLevelZeroGeometricErrorForAHeightmap(e.tilingScheme.ellipsoid,e.heightmapWidth,e.tilingScheme.getNumberOfXTilesAtLevel(0)),!t.scheme||t.scheme==="tms"||t.scheme==="slippyMap")e.scheme=t.scheme;else{let b=`The scheme "${t.scheme}" is invalid or not supported.`;throw e.previousError=No.reportError(e.previousError,n,c(n)?n._errorEvent:void 0,b),new ue(b)}let f;c(t.extensions)&&t.extensions.indexOf("octvertexnormals")!==-1?i=!0:c(t.extensions)&&t.extensions.indexOf("vertexnormals")!==-1&&(i=!0,s=!1),c(t.extensions)&&t.extensions.indexOf("watermask")!==-1&&(o=!0),c(t.extensions)&&t.extensions.indexOf("metadata")!==-1&&(r=!0);let d=t.metadataAvailability,p=t.available,g;if(c(p)&&!c(d)){g=new $p(e.tilingScheme,p.length);for(let b=0;b<p.length;++b){let x=p[b],T=e.tilingScheme.getNumberOfYTilesAtLevel(b);c(e.overallAvailability[b])||(e.overallAvailability[b]=[]);for(let C=0;C<x.length;++C){let S=x[C],v=T-S.endY-1,D=T-S.startY-1;e.overallAvailability[b].push([S.startX,v,S.endX,D]),g.addAvailableTileRange(b,S.startX,v,S.endX,D)}}}else c(d)&&(f=new $p(e.tilingScheme,u),g=new $p(e.tilingScheme,u),e.overallAvailability[0]=[[0,0,1,0]],g.addAvailableTileRange(0,0,0,1,0));e.hasWaterMask=e.hasWaterMask||o,e.hasVertexNormals=e.hasVertexNormals||i,e.hasMetadata=e.hasMetadata||r,c(t.attribution)&&(e.attribution.length>0&&(e.attribution+=" "),e.attribution+=t.attribution),e.layers.push(new Dnt({resource:e.lastResource,version:t.version,isHeightmap:a,tileUrlTemplates:l,availability:g,hasVertexNormals:i,hasWaterMask:o,hasMetadata:r,availabilityLevels:d,availabilityTilesLoaded:f,littleEndianExtensionSize:s}));let m=t.parentUrl;return c(m)?c(g)?(e.lastResource=e.lastResource.getDerivedResource({url:m}),e.lastResource.appendForwardSlash(),e.layerJsonResource=e.lastResource.getDerivedResource({url:"layer.json"}),await oW(e),!0):(console.log("A layer.json can't have a parentUrl if it does't have an available array."),!0):!0}function Pnt(e,t,n){let i=`An error occurred while accessing ${e.layerJsonResource.url}.`;if(c(t)&&(i+=`
${t.message}`),e.previousError=No.reportError(e.previousError,n,c(n)?n._errorEvent:void 0,i),e.previousError.retry)return oW(e,n);throw new ue(i)}async function Int(e,t,n){await i_e(e,t,n);let i=e.overallAvailability.length;if(i>0){let o=e.availability=new $p(e.tilingScheme,e.overallMaxZoom);for(let r=0;r<i;++r){let s=e.overallAvailability[r];for(let a=0;a<s.length;++a){let l=s[a];o.addAvailableTileRange(r,l[0],l[1],l[2],l[3])}}}if(e.attribution.length>0){let o=new Pt(e.attribution);e.tileCredits.push(o)}return!0}async function oW(e,t){try{let n=await e.layerJsonResource.fetchJson();return Int(e,n,t)}catch(n){return c(n)&&n.statusCode===404?(await i_e(e,{tilejson:"2.1.0",format:"heightmap-1.0",version:"1.0.0",scheme:"tms",tiles:["{z}/{x}/{y}.terrain?v={version}"]},t),!0):Pnt(e,n,t)}}function Ld(e){e=y(e,y.EMPTY_OBJECT),this._heightmapWidth=void 0,this._heightmapStructure=void 0,this._hasWaterMask=!1,this._hasVertexNormals=!1,this._hasMetadata=!1,this._scheme=void 0,this._ellipsoid=e.ellipsoid,this._requestVertexNormals=y(e.requestVertexNormals,!1),this._requestWaterMask=y(e.requestWaterMask,!1),this._requestMetadata=y(e.requestMetadata,!0),this._errorEvent=new pe;let t=e.credit;typeof t=="string"&&(t=new Pt(t)),this._credit=t,this._availability=void 0,this._tilingScheme=void 0,this._levelZeroMaximumGeometricError=void 0,this._layers=void 0,this._tileCredits=void 0}var nW={OCT_VERTEX_NORMALS:1,WATER_MASK:2,METADATA:4};function t_e(e){return!c(e)||e.length===0?{Accept:"application/vnd.quantized-mesh,application/octet-stream;q=0.9,*/*;q=0.01"}:{Accept:`application/vnd.quantized-mesh;extensions=${e.join("-")},application/octet-stream;q=0.9,*/*;q=0.01`}}function Ont(e,t,n,i,o){let r=new Uint16Array(t,0,e._heightmapWidth*e._heightmapWidth);return new Mc({buffer:r,childTileMask:new Uint8Array(t,r.byteLength,1)[0],waterMask:new Uint8Array(t,r.byteLength+1,t.byteLength-r.byteLength-1),width:e._heightmapWidth,height:e._heightmapWidth,structure:e._heightmapStructure,credits:e._tileCredits})}function Rnt(e,t,n,i,o,r){let s=r.littleEndianExtensionSize,a=0,l=3,u=l+1,f=Float64Array.BYTES_PER_ELEMENT*l,d=Float64Array.BYTES_PER_ELEMENT*u,g=Uint16Array.BYTES_PER_ELEMENT*3,m=3,b=Uint16Array.BYTES_PER_ELEMENT,x=b*m,T=new DataView(t),C=new h(T.getFloat64(a,!0),T.getFloat64(a+8,!0),T.getFloat64(a+16,!0));a+=f;let S=T.getFloat32(a,!0);a+=Float32Array.BYTES_PER_ELEMENT;let v=T.getFloat32(a,!0);a+=Float32Array.BYTES_PER_ELEMENT;let D=new ce(new h(T.getFloat64(a,!0),T.getFloat64(a+8,!0),T.getFloat64(a+16,!0)),T.getFloat64(a+f,!0));a+=d;let I=new h(T.getFloat64(a,!0),T.getFloat64(a+8,!0),T.getFloat64(a+16,!0));a+=f;let L=T.getUint32(a,!0);a+=Uint32Array.BYTES_PER_ELEMENT;let M=new Uint16Array(t,a,L*3);a+=L*g,L>64*1024&&(b=Uint32Array.BYTES_PER_ELEMENT,x=b*m);let N=M.subarray(0,L),B=M.subarray(L,2*L),_=M.subarray(L*2,3*L);Nn.zigZagDeltaDecode(N,B,_),a%b!==0&&(a+=b-a%b);let w=T.getUint32(a,!0);a+=Uint32Array.BYTES_PER_ELEMENT;let P=Fe.createTypedArrayFromArrayBuffer(L,t,a,w*m);a+=w*x;let O=0,F=P.length;for(let le=0;le<F;++le){let ge=P[le];P[le]=O-ge,ge===0&&++O}let V=T.getUint32(a,!0);a+=Uint32Array.BYTES_PER_ELEMENT;let G=Fe.createTypedArrayFromArrayBuffer(L,t,a,V);a+=V*b;let z=T.getUint32(a,!0);a+=Uint32Array.BYTES_PER_ELEMENT;let W=Fe.createTypedArrayFromArrayBuffer(L,t,a,z);a+=z*b;let U=T.getUint32(a,!0);a+=Uint32Array.BYTES_PER_ELEMENT;let q=Fe.createTypedArrayFromArrayBuffer(L,t,a,U);a+=U*b;let K=T.getUint32(a,!0);a+=Uint32Array.BYTES_PER_ELEMENT;let te=Fe.createTypedArrayFromArrayBuffer(L,t,a,K);a+=K*b;let Y,Z;for(;a<T.byteLength;){let le=T.getUint8(a,!0);a+=Uint8Array.BYTES_PER_ELEMENT;let ge=T.getUint32(a,s);if(a+=Uint32Array.BYTES_PER_ELEMENT,le===nW.OCT_VERTEX_NORMALS&&e._requestVertexNormals)Y=new Uint8Array(t,a,L*2);else if(le===nW.WATER_MASK&&e._requestWaterMask)Z=new Uint8Array(t,a,ge);else if(le===nW.METADATA&&e._requestMetadata){let xe=T.getUint32(a,!0);if(xe>0){let Ee=Ho(new Uint8Array(t),a+Uint32Array.BYTES_PER_ELEMENT,xe).available;if(c(Ee))for(let Ue=0;Ue<Ee.length;++Ue){let Ye=n+Ue+1,it=Ee[Ue],It=e._tilingScheme.getNumberOfYTilesAtLevel(Ye);for(let Ot=0;Ot<it.length;++Ot){let He=it[Ot],tn=It-He.endY-1,dt=It-He.startY-1;e.availability.addAvailableTileRange(Ye,He.startX,tn,He.endX,dt),r.availability.addAvailableTileRange(Ye,He.startX,tn,He.endX,dt)}}}r.availabilityTilesLoaded.addAvailableTileRange(n,i,o,i,o)}a+=ge}let ee=e.getLevelMaximumGeometricError(n)*5,me=e._tilingScheme.tileXYToRectangle(i,o,n),be=Pn.fromRectangle(me,S,v,e._tilingScheme.ellipsoid);return new mD({center:C,minimumHeight:S,maximumHeight:v,boundingSphere:D,orientedBoundingBox:be,horizonOcclusionPoint:I,quantizedVertices:M,encodedNormals:Y,indices:P,westIndices:G,southIndices:W,eastIndices:q,northIndices:te,westSkirtHeight:ee,southSkirtHeight:ee,eastSkirtHeight:ee,northSkirtHeight:ee,childTileMask:e.availability.computeChildMaskForTile(n,i,o),waterMask:Z,credits:e._tileCredits})}Ld.prototype.requestTileGeometry=function(e,t,n,i){let o=this._layers,r,s=o.length,a=!1,l=Promise.resolve();if(s===1)r=o[0];else for(let u=0;u<s;++u){let f=o[u];if(!c(f.availability)||f.availability.isTileAvailable(n,e,t)){r=f;break}let d=rW(this,e,t,n,f,u===0);d.result&&(a=!0,l=l.then(()=>d.promise))}return!c(r)&&a?l.then(()=>new Promise(u=>{setTimeout(()=>{let f=this.requestTileGeometry(e,t,n,i);u(f)},0)})):o_e(this,e,t,n,r,i)};function o_e(e,t,n,i,o,r){if(!c(o))return Promise.reject(new ue("Terrain tile doesn't exist"));let s=o.tileUrlTemplates;if(s.length===0)return;let a;!e._scheme||e._scheme==="tms"?a=e._tilingScheme.getNumberOfYTilesAtLevel(i)-n-1:a=n;let l=[];e._requestVertexNormals&&o.hasVertexNormals&&l.push(o.littleEndianExtensionSize?"octvertexnormals":"vertexnormals"),e._requestWaterMask&&o.hasWaterMask&&l.push("watermask"),e._requestMetadata&&o.hasMetadata&&l.push("metadata");let u,f,d=s[(t+a+i)%s.length],p=o.resource;c(p._ionEndpoint)&&!c(p._ionEndpoint.externalType)?(l.length!==0&&(f={extensions:l.join("-")}),u=t_e(void 0)):u=t_e(l);let g=p.getDerivedResource({url:d,templateValues:{version:o.version,z:i,x:t,y:a},queryParameters:f,headers:u,request:r}).fetchArrayBuffer();if(c(g))return g.then(function(m){return c(m)?c(e._heightmapStructure)?Ont(e,m,i,t,n):Rnt(e,m,i,t,n,o):Promise.reject(new ue("Mesh buffer doesn't exist."))})}Object.defineProperties(Ld.prototype,{errorEvent:{get:function(){return this._errorEvent}},credit:{get:function(){return this._credit}},tilingScheme:{get:function(){return this._tilingScheme}},hasWaterMask:{get:function(){return this._hasWaterMask&&this._requestWaterMask}},hasVertexNormals:{get:function(){return this._hasVertexNormals&&this._requestVertexNormals}},hasMetadata:{get:function(){return this._hasMetadata&&this._requestMetadata}},requestVertexNormals:{get:function(){return this._requestVertexNormals}},requestWaterMask:{get:function(){return this._requestWaterMask}},requestMetadata:{get:function(){return this._requestMetadata}},availability:{get:function(){return this._availability}}});Ld.prototype.getLevelMaximumGeometricError=function(e){return this._levelZeroMaximumGeometricError/(1<<e)};Ld.fromIonAssetId=async function(e,t){A.defined("assetId",e);let n=await Xf.fromAssetId(e);return Ld.fromUrl(n,t)};Ld.fromUrl=async function(e,t){A.defined("url",e),t=y(t,y.EMPTY_OBJECT),e=await Promise.resolve(e);let n=De.createIfNeeded(e);n.appendForwardSlash();let i=new n_e(t);i.lastResource=n,i.layerJsonResource=i.lastResource.getDerivedResource({url:"layer.json"}),await oW(i);let o=new Ld(t);return i.build(o),o};Ld.prototype.getTileDataAvailable=function(e,t,n){if(!c(this._availability))return;if(n>this._availability._maximumLevel)return!1;if(this._availability.isTileAvailable(n,e,t))return!0;if(!this._hasMetadata)return!1;let i=this._layers,o=i.length;for(let r=0;r<o;++r)if(rW(this,e,t,n,i[r],r===0).result)return;return!1};Ld.prototype.loadTileDataAvailability=function(e,t,n){if(!c(this._availability)||n>this._availability._maximumLevel||this._availability.isTileAvailable(n,e,t)||!this._hasMetadata)return;let i=this._layers,o=i.length;for(let r=0;r<o;++r){let s=rW(this,e,t,n,i[r],r===0);if(c(s.promise))return s.promise}};function iW(e,t,n,i){if(i===0)return;let o=e.availabilityLevels,r=i%o===0?i-o:(i/o|0)*o,s=1<<i-r,a=t/s|0,l=n/s|0;return{level:r,x:a,y:l}}function rW(e,t,n,i,o,r){if(!c(o.availabilityLevels))return{result:!1};let s,a=function(){delete o.availabilityPromiseCache[s]},l=o.availabilityTilesLoaded,u=o.availability,f=iW(o,t,n,i);for(;c(f);){if(u.isTileAvailable(f.level,f.x,f.y)&&!l.isTileAvailable(f.level,f.x,f.y)){let d;if(!r&&(s=`${f.level}-${f.x}-${f.y}`,d=o.availabilityPromiseCache[s],!c(d))){let p=new ur({throttle:!1,throttleByServer:!0,type:Es.TERRAIN});d=o_e(e,f.x,f.y,f.level,o,p),c(d)&&(o.availabilityPromiseCache[s]=d,d.then(a))}return{result:!0,promise:d}}f=iW(o,f.x,f.y,f.level)}return{result:!1}}Ld._getAvailabilityTile=iW;var pD=Ld;function Zp(e){e=y(e,y.EMPTY_OBJECT);let t=e.radius;A.typeOf.number("radius",t);let n={center:e.center,semiMajorAxis:t,semiMinorAxis:t,ellipsoid:e.ellipsoid,height:e.height,extrudedHeight:e.extrudedHeight,granularity:e.granularity,vertexFormat:e.vertexFormat,stRotation:e.stRotation,shadowVolume:e.shadowVolume};this._ellipseGeometry=new $l(n),this._workerName="createCircleGeometry"}Zp.packedLength=$l.packedLength;Zp.pack=function(e,t,n){return A.typeOf.object("value",e),$l.pack(e._ellipseGeometry,t,n)};var r_e=new $l({center:new h,semiMajorAxis:1,semiMinorAxis:1}),Aa={center:new h,radius:void 0,ellipsoid:ie.clone(ie.default),height:void 0,extrudedHeight:void 0,granularity:void 0,vertexFormat:new Ie,stRotation:void 0,semiMajorAxis:void 0,semiMinorAxis:void 0,shadowVolume:void 0};Zp.unpack=function(e,t,n){let i=$l.unpack(e,t,r_e);return Aa.center=h.clone(i._center,Aa.center),Aa.ellipsoid=ie.clone(i._ellipsoid,Aa.ellipsoid),Aa.ellipsoid=ie.clone(i._ellipsoid,r_e._ellipsoid),Aa.height=i._height,Aa.extrudedHeight=i._extrudedHeight,Aa.granularity=i._granularity,Aa.vertexFormat=Ie.clone(i._vertexFormat,Aa.vertexFormat),Aa.stRotation=i._stRotation,Aa.shadowVolume=i._shadowVolume,c(n)?(Aa.semiMajorAxis=i._semiMajorAxis,Aa.semiMinorAxis=i._semiMinorAxis,n._ellipseGeometry=new $l(Aa),n):(Aa.radius=i._semiMajorAxis,new Zp(Aa))};Zp.createGeometry=function(e){return $l.createGeometry(e._ellipseGeometry)};Zp.createShadowVolume=function(e,t,n){let i=e._ellipseGeometry._granularity,o=e._ellipseGeometry._ellipsoid,r=t(i,o),s=n(i,o);return new Zp({center:e._ellipseGeometry._center,radius:e._ellipseGeometry._semiMajorAxis,ellipsoid:o,stRotation:e._ellipseGeometry._stRotation,granularity:i,extrudedHeight:r,height:s,vertexFormat:Ie.POSITION_ONLY,shadowVolume:!0})};Object.defineProperties(Zp.prototype,{rectangle:{get:function(){return this._ellipseGeometry.rectangle}},textureCoordinateRotationPoints:{get:function(){return this._ellipseGeometry.textureCoordinateRotationPoints}}});var Mnt=Zp;function rC(e){e=y(e,y.EMPTY_OBJECT);let t=e.radius;A.typeOf.number("radius",t);let n={center:e.center,semiMajorAxis:t,semiMinorAxis:t,ellipsoid:e.ellipsoid,height:e.height,extrudedHeight:e.extrudedHeight,granularity:e.granularity,numberOfVerticalLines:e.numberOfVerticalLines};this._ellipseGeometry=new xd(n),this._workerName="createCircleOutlineGeometry"}rC.packedLength=xd.packedLength;rC.pack=function(e,t,n){return A.typeOf.object("value",e),xd.pack(e._ellipseGeometry,t,n)};var Lnt=new xd({center:new h,semiMajorAxis:1,semiMinorAxis:1}),cu={center:new h,radius:void 0,ellipsoid:ie.clone(ie.UNIT_SPHERE),height:void 0,extrudedHeight:void 0,granularity:void 0,numberOfVerticalLines:void 0,semiMajorAxis:void 0,semiMinorAxis:void 0};rC.unpack=function(e,t,n){let i=xd.unpack(e,t,Lnt);return cu.center=h.clone(i._center,cu.center),cu.ellipsoid=ie.clone(i._ellipsoid,cu.ellipsoid),cu.height=i._height,cu.extrudedHeight=i._extrudedHeight,cu.granularity=i._granularity,cu.numberOfVerticalLines=i._numberOfVerticalLines,c(n)?(cu.semiMajorAxis=i._semiMajorAxis,cu.semiMinorAxis=i._semiMinorAxis,n._ellipseGeometry=new xd(cu),n):(cu.radius=i._semiMajorAxis,new rC(cu))};rC.createGeometry=function(e){return xd.createGeometry(e._ellipseGeometry)};var Nnt=rC;function Fnt(e){return e=y(e,y.EMPTY_OBJECT),pD.fromIonAssetId(2426648,{requestVertexNormals:y(e.requestVertexNormals,!1)})}var sW=Fnt;function Bnt(e){return e=y(e,y.EMPTY_OBJECT),pD.fromIonAssetId(1,{requestVertexNormals:y(e.requestVertexNormals,!1),requestWaterMask:y(e.requestWaterMask,!1),ellipsoid:ie.WGS84})}var sC=Bnt;function aC(e){e=y(e,y.EMPTY_OBJECT),A.defined("options.callback",e.callback),A.defined("options.width",e.width),A.defined("options.height",e.height),this._callback=e.callback,this._tilingScheme=e.tilingScheme,c(this._tilingScheme)||(this._tilingScheme=new $i({ellipsoid:y(e.ellipsoid,ie.default)})),this._width=e.width,this._height=e.height;let t=Math.max(this._width,this._height);this._levelZeroMaximumGeometricError=gs.getEstimatedLevelZeroGeometricErrorForAHeightmap(this._tilingScheme.ellipsoid,t,this._tilingScheme.getNumberOfXTilesAtLevel(0)),this._errorEvent=new pe;let n=e.credit;typeof n=="string"&&(n=new Pt(n)),this._credit=n}Object.defineProperties(aC.prototype,{errorEvent:{get:function(){return this._errorEvent}},credit:{get:function(){return this._credit}},tilingScheme:{get:function(){return this._tilingScheme}},hasWaterMask:{get:function(){return!1}},hasVertexNormals:{get:function(){return!1}},availability:{get:function(){}},width:{get:function(){return this._width}},height:{get:function(){return this._height}}});aC.prototype.requestTileGeometry=function(e,t,n,i){let o=this._callback(e,t,n);if(!c(o))return;let r=this._width,s=this._height;return Promise.resolve(o).then(function(a){let l=a;return Array.isArray(l)&&(l=new Float64Array(l)),new Mc({buffer:l,width:r,height:s})})};aC.prototype.getLevelMaximumGeometricError=function(e){return this._levelZeroMaximumGeometricError/(1<<e)};aC.prototype.getTileDataAvailable=function(e,t,n){};aC.prototype.loadTileDataAvailability=function(e,t,n){};var knt=aC;var Vnt=1953029805,Unt=2917034100;function aW(e,t){if(aW.passThroughDataForTesting)return t;A.typeOf.object("key",e),A.typeOf.object("data",t);let n=e.byteLength;if(n===0||n%4!==0)throw new ue("The length of key must be greater than 0 and a multiple of 4.");let i=new DataView(t),o=i.getUint32(0,!0);if(o===Vnt||o===Unt)return t;let r=new DataView(e),s=0,a=t.byteLength,l=a-a%8,u=n,f,d=8;for(;s<l;)for(d=(d+8)%24,f=d;s<l&&f<u;)i.setUint32(s,i.getUint32(s,!0)^r.getUint32(f,!0),!0),i.setUint32(s+4,i.getUint32(s+4,!0)^r.getUint32(f+4,!0),!0),s+=8,f+=24;if(s<a)for(f>=u&&(d=(d+8)%24,f=d);s<a;)i.setUint8(s,i.getUint8(s)^r.getUint8(f)),s++,f++}aW.passThroughDataForTesting=!1;var cW=aW;function s_e(e){this.proxy=e}s_e.prototype.getURL=function(e){let t=this.proxy.indexOf("?")===-1?"?":"";return this.proxy+t+encodeURIComponent(e)};var znt=s_e;function Nd(e){A.typeOf.object("options",e),A.defined("options.comparator",e.comparator),c(e.maximumLength)&&A.typeOf.number.greaterThanOrEquals("options.maximumLength",e.maximumLength,0),this._comparator=e.comparator,this._maximumLength=e.maximumLength,this._array=c(e.maximumLength)?new Array(e.maximumLength):[],this._length=0}Object.defineProperties(Nd.prototype,{length:{get:function(){return this._length}},maximumLength:{get:function(){return this._maximumLength},set:function(e){if(c(e)){for(A.typeOf.number.greaterThanOrEquals("maximumLength",e,0);this._length>e;)this.removeMinimum();this._array.length=e}this._maximumLength=e}},internalArray:{get:function(){return this._array}},comparator:{get:function(){return this._comparator}}});Nd.prototype.clone=function(){let e=this._maximumLength,t=this._comparator,n=this._array,i=this._length,o=new Nd({comparator:t,maximumLength:e});o._length=i;for(let r=0;r<i;r++)o._array[r]=n[r];return o};Nd.prototype.reset=function(){this._length=0;let e=this._maximumLength;if(c(e))for(let t=0;t<e;t++)this._array[t]=void 0;else this._array.length=0};Nd.prototype.resort=function(){let e=this._length;for(let t=0;t<e;t++)a_e(this,t)};Nd.prototype.insert=function(e){let t,n=this._maximumLength;if(c(n)){if(n===0)return;if(this._length===n){let o=this._array[0];if(this._comparator(e,o)<=0)return e;t=this.removeMinimum()}}let i=this._length;return this._array[i]=e,this._length++,a_e(this,i),t};Nd.prototype.removeMinimum=function(){let e=this._length;if(e===0)return;this._length--;let t=this._array[0];return e>=2&&(this._array[0]=this._array[e-1],c_e(this,0)),this._array[e-1]=void 0,t};Nd.prototype.removeMaximum=function(){let e=this._length;if(e===0)return;this._length--;let t;if(e<=2)t=this._array[e-1];else{let n=lW(this,1,2)?1:2;t=this._array[n],this._array[n]=this._array[e-1],e>=4&&c_e(this,n)}return this._array[e-1]=void 0,t};Nd.prototype.getMinimum=function(){if(this._length!==0)return this._array[0]};Nd.prototype.getMaximum=function(){let e=this._length;if(e!==0)return e<=2?this._array[e-1]:this._array[lW(this,1,2)?1:2]};function hL(e,t,n){let i=e._array,o=i[t];i[t]=i[n],i[n]=o}function _D(e,t,n){return e._comparator(e._array[t],e._array[n])<0}function lW(e,t,n){return e._comparator(e._array[t],e._array[n])>0}function a_e(e,t){if(t===0)return;let n=Math.floor(R.log2(t+1))%2===0,i=Math.floor((t-1)/2),o=_D(e,t,i);for(o!==n&&(hL(e,t,i),t=i);t>=3;){let r=Math.floor((t-3)/4);if(_D(e,t,r)!==o)break;hL(e,t,r),t=r}}function c_e(e,t){let n=e._length,i=Math.floor(R.log2(t+1))%2===0,o;for(;(o=2*t+1)<n;){let r=o,s=o+1;if(s<n){_D(e,s,r)===i&&(r=s);let a=2*o+1,l=Math.max(Math.min(n-a,4),0);for(let u=0;u<l;u++){let f=a+u;_D(e,f,r)===i&&(r=f)}}if(_D(e,r,t)===i&&(hL(e,r,t),r!==o&&r!==s)){let a=Math.floor((r-1)/2);lW(e,r,a)===i&&hL(e,r,a)}t=r}}var gD=Nd;function cC(e){e=y(e,y.EMPTY_OBJECT),this._tilingScheme=e.tilingScheme,c(this._tilingScheme)||(this._tilingScheme=new $i({ellipsoid:y(e.ellipsoid,ie.default)})),this._levelZeroMaximumGeometricError=gs.getEstimatedLevelZeroGeometricErrorForAHeightmap(this._tilingScheme.ellipsoid,64,this._tilingScheme.getNumberOfXTilesAtLevel(0)),this._errorEvent=new pe}Object.defineProperties(cC.prototype,{errorEvent:{get:function(){return this._errorEvent}},credit:{get:function(){}},tilingScheme:{get:function(){return this._tilingScheme}},hasWaterMask:{get:function(){return!1}},hasVertexNormals:{get:function(){return!1}},availability:{get:function(){}}});cC.prototype.requestTileGeometry=function(e,t,n,i){return Promise.resolve(new Mc({buffer:new Uint8Array(16*16),width:16,height:16}))};cC.prototype.getLevelMaximumGeometricError=function(e){return this._levelZeroMaximumGeometricError/(1<<e)};cC.prototype.getTileDataAvailable=function(e,t,n){};cC.prototype.loadTileDataAvailability=function(e,t,n){};var Jp=cC;function tm(e){e=y(e,y.EMPTY_OBJECT),this.left=e.left,this._left=void 0,this.right=e.right,this._right=void 0,this.top=e.top,this._top=void 0,this.bottom=e.bottom,this._bottom=void 0,this.near=y(e.near,1),this._near=this.near,this.far=y(e.far,5e8),this._far=this.far,this._cullingVolume=new Os,this._perspectiveMatrix=new k,this._infinitePerspective=new k}function uW(e){if(!c(e.right)||!c(e.left)||!c(e.top)||!c(e.bottom)||!c(e.near)||!c(e.far))throw new E("right, left, top, bottom, near, or far parameters are not set.");let{top:t,bottom:n,right:i,left:o,near:r,far:s}=e;if(t!==e._top||n!==e._bottom||o!==e._left||i!==e._right||r!==e._near||s!==e._far){if(e.near<=0||e.near>e.far)throw new E("near must be greater than zero and less than far.");e._left=o,e._right=i,e._top=t,e._bottom=n,e._near=r,e._far=s,e._perspectiveMatrix=k.computePerspectiveOffCenter(o,i,n,t,r,s,e._perspectiveMatrix),e._infinitePerspective=k.computeInfinitePerspectiveOffCenter(o,i,n,t,r,e._infinitePerspective)}}Object.defineProperties(tm.prototype,{projectionMatrix:{get:function(){return uW(this),this._perspectiveMatrix}},infiniteProjectionMatrix:{get:function(){return uW(this),this._infinitePerspective}}});var Hnt=new h,Gnt=new h,jnt=new h,Wnt=new h;tm.prototype.computeCullingVolume=function(e,t,n){if(!c(e))throw new E("position is required.");if(!c(t))throw new E("direction is required.");if(!c(n))throw new E("up is required.");let i=this._cullingVolume.planes,o=this.top,r=this.bottom,s=this.right,a=this.left,l=this.near,u=this.far,f=h.cross(t,n,Hnt),d=Gnt;h.multiplyByScalar(t,l,d),h.add(e,d,d);let p=jnt;h.multiplyByScalar(t,u,p),h.add(e,p,p);let g=Wnt;h.multiplyByScalar(f,a,g),h.add(d,g,g),h.subtract(g,e,g),h.normalize(g,g),h.cross(g,n,g),h.normalize(g,g);let m=i[0];return c(m)||(m=i[0]=new se),m.x=g.x,m.y=g.y,m.z=g.z,m.w=-h.dot(g,e),h.multiplyByScalar(f,s,g),h.add(d,g,g),h.subtract(g,e,g),h.cross(n,g,g),h.normalize(g,g),m=i[1],c(m)||(m=i[1]=new se),m.x=g.x,m.y=g.y,m.z=g.z,m.w=-h.dot(g,e),h.multiplyByScalar(n,r,g),h.add(d,g,g),h.subtract(g,e,g),h.cross(f,g,g),h.normalize(g,g),m=i[2],c(m)||(m=i[2]=new se),m.x=g.x,m.y=g.y,m.z=g.z,m.w=-h.dot(g,e),h.multiplyByScalar(n,o,g),h.add(d,g,g),h.subtract(g,e,g),h.cross(g,f,g),h.normalize(g,g),m=i[3],c(m)||(m=i[3]=new se),m.x=g.x,m.y=g.y,m.z=g.z,m.w=-h.dot(g,e),m=i[4],c(m)||(m=i[4]=new se),m.x=t.x,m.y=t.y,m.z=t.z,m.w=-h.dot(t,d),h.negate(t,g),m=i[5],c(m)||(m=i[5]=new se),m.x=g.x,m.y=g.y,m.z=g.z,m.w=-h.dot(g,p),this._cullingVolume};tm.prototype.getPixelDimensions=function(e,t,n,i,o){if(uW(this),!c(e)||!c(t))throw new E("Both drawingBufferWidth and drawingBufferHeight are required.");if(e<=0)throw new E("drawingBufferWidth must be greater than zero.");if(t<=0)throw new E("drawingBufferHeight must be greater than zero.");if(!c(n))throw new E("distance is required.");if(!c(i))throw new E("pixelRatio is required");if(i<=0)throw new E("pixelRatio must be greater than zero.");if(!c(o))throw new E("A result object is required.");let r=1/this.near,s=this.top*r,a=2*i*n*s/t;s=this.right*r;let l=2*i*n*s/e;return o.x=l,o.y=a,o};tm.prototype.clone=function(e){return c(e)||(e=new tm),e.right=this.right,e.left=this.left,e.top=this.top,e.bottom=this.bottom,e.near=this.near,e.far=this.far,e._left=void 0,e._right=void 0,e._top=void 0,e._bottom=void 0,e._near=void 0,e._far=void 0,e};tm.prototype.equals=function(e){return c(e)&&e instanceof tm&&this.right===e.right&&this.left===e.left&&this.top===e.top&&this.bottom===e.bottom&&this.near===e.near&&this.far===e.far};tm.prototype.equalsEpsilon=function(e,t,n){return e===this||c(e)&&e instanceof tm&&R.equalsEpsilon(this.right,e.right,t,n)&&R.equalsEpsilon(this.left,e.left,t,n)&&R.equalsEpsilon(this.top,e.top,t,n)&&R.equalsEpsilon(this.bottom,e.bottom,t,n)&&R.equalsEpsilon(this.near,e.near,t,n)&&R.equalsEpsilon(this.far,e.far,t,n)};var lu=tm;function Tl(e){e=y(e,y.EMPTY_OBJECT),this._offCenterFrustum=new lu,this.fov=e.fov,this._fov=void 0,this._fovy=void 0,this._sseDenominator=void 0,this.aspectRatio=e.aspectRatio,this._aspectRatio=void 0,this.near=y(e.near,1),this._near=this.near,this.far=y(e.far,5e8),this._far=this.far,this.xOffset=y(e.xOffset,0),this._xOffset=this.xOffset,this.yOffset=y(e.yOffset,0),this._yOffset=this.yOffset}Tl.packedLength=6;Tl.pack=function(e,t,n){return A.typeOf.object("value",e),A.defined("array",t),n=y(n,0),t[n++]=e.fov,t[n++]=e.aspectRatio,t[n++]=e.near,t[n++]=e.far,t[n++]=e.xOffset,t[n]=e.yOffset,t};Tl.unpack=function(e,t,n){return A.defined("array",e),t=y(t,0),c(n)||(n=new Tl),n.fov=e[t++],n.aspectRatio=e[t++],n.near=e[t++],n.far=e[t++],n.xOffset=e[t++],n.yOffset=e[t],n};function Fd(e){if(!c(e.fov)||!c(e.aspectRatio)||!c(e.near)||!c(e.far))throw new E("fov, aspectRatio, near, or far parameters are not set.");if(!(e.fov!==e._fov||e.aspectRatio!==e._aspectRatio||e.near!==e._near||e.far!==e._far||e.xOffset!==e._xOffset||e.yOffset!==e._yOffset))return;if(A.typeOf.number.greaterThanOrEquals("fov",e.fov,0),A.typeOf.number.lessThan("fov",e.fov,Math.PI),A.typeOf.number.greaterThanOrEquals("aspectRatio",e.aspectRatio,0),A.typeOf.number.greaterThanOrEquals("near",e.near,0),e.near>e.far)throw new E("near must be less than far.");e._aspectRatio=e.aspectRatio,e._fov=e.fov,e._fovy=e.aspectRatio<=1?e.fov:Math.atan(Math.tan(e.fov*.5)/e.aspectRatio)*2,e._near=e.near,e._far=e.far,e._sseDenominator=2*Math.tan(.5*e._fovy),e._xOffset=e.xOffset,e._yOffset=e.yOffset;let n=e._offCenterFrustum;n.top=e.near*Math.tan(.5*e._fovy),n.bottom=-n.top,n.right=e.aspectRatio*n.top,n.left=-n.right,n.near=e.near,n.far=e.far,n.right+=e.xOffset,n.left+=e.xOffset,n.top+=e.yOffset,n.bottom+=e.yOffset}Object.defineProperties(Tl.prototype,{projectionMatrix:{get:function(){return Fd(this),this._offCenterFrustum.projectionMatrix}},infiniteProjectionMatrix:{get:function(){return Fd(this),this._offCenterFrustum.infiniteProjectionMatrix}},fovy:{get:function(){return Fd(this),this._fovy}},sseDenominator:{get:function(){return Fd(this),this._sseDenominator}},offCenterFrustum:{get:function(){return Fd(this),this._offCenterFrustum}}});Tl.prototype.computeCullingVolume=function(e,t,n){return Fd(this),this._offCenterFrustum.computeCullingVolume(e,t,n)};Tl.prototype.getPixelDimensions=function(e,t,n,i,o){return Fd(this),this._offCenterFrustum.getPixelDimensions(e,t,n,i,o)};Tl.prototype.clone=function(e){return c(e)||(e=new Tl),e.aspectRatio=this.aspectRatio,e.fov=this.fov,e.near=this.near,e.far=this.far,e._aspectRatio=void 0,e._fov=void 0,e._near=void 0,e._far=void 0,this._offCenterFrustum.clone(e._offCenterFrustum),e};Tl.prototype.equals=function(e){return!c(e)||!(e instanceof Tl)?!1:(Fd(this),Fd(e),this.fov===e.fov&&this.aspectRatio===e.aspectRatio&&this._offCenterFrustum.equals(e._offCenterFrustum))};Tl.prototype.equalsEpsilon=function(e,t,n){return!c(e)||!(e instanceof Tl)?!1:(Fd(this),Fd(e),R.equalsEpsilon(this.fov,e.fov,t,n)&&R.equalsEpsilon(this.aspectRatio,e.aspectRatio,t,n)&&this._offCenterFrustum.equalsEpsilon(e._offCenterFrustum,t,n))};var vi=Tl;var mL=0,qnt=1;function Rb(e){A.typeOf.object("options",e),A.typeOf.object("options.frustum",e.frustum),A.typeOf.object("options.origin",e.origin),A.typeOf.object("options.orientation",e.orientation);let t=e.frustum,n=e.orientation,i=e.origin,o=y(e.vertexFormat,Ie.DEFAULT),r=y(e._drawNearPlane,!0),s,a;t instanceof vi?(s=mL,a=vi.packedLength):t instanceof rn&&(s=qnt,a=rn.packedLength),this._frustumType=s,this._frustum=t.clone(),this._origin=h.clone(i),this._orientation=Ne.clone(n),this._drawNearPlane=r,this._vertexFormat=o,this._workerName="createFrustumGeometry",this.packedLength=2+a+h.packedLength+Ne.packedLength+Ie.packedLength}Rb.pack=function(e,t,n){A.typeOf.object("value",e),A.defined("array",t),n=y(n,0);let i=e._frustumType,o=e._frustum;return t[n++]=i,i===mL?(vi.pack(o,t,n),n+=vi.packedLength):(rn.pack(o,t,n),n+=rn.packedLength),h.pack(e._origin,t,n),n+=h.packedLength,Ne.pack(e._orientation,t,n),n+=Ne.packedLength,Ie.pack(e._vertexFormat,t,n),n+=Ie.packedLength,t[n]=e._drawNearPlane?1:0,t};var Ynt=new vi,Xnt=new rn,Knt=new Ne,$nt=new h,Znt=new Ie;Rb.unpack=function(e,t,n){A.defined("array",e),t=y(t,0);let i=e[t++],o;i===mL?(o=vi.unpack(e,t,Ynt),t+=vi.packedLength):(o=rn.unpack(e,t,Xnt),t+=rn.packedLength);let r=h.unpack(e,t,$nt);t+=h.packedLength;let s=Ne.unpack(e,t,Knt);t+=Ne.packedLength;let a=Ie.unpack(e,t,Znt);t+=Ie.packedLength;let l=e[t]===1;if(!c(n))return new Rb({frustum:o,origin:r,orientation:s,vertexFormat:a,_drawNearPlane:l});let u=i===n._frustumType?n._frustum:void 0;return n._frustum=o.clone(u),n._frustumType=i,n._origin=h.clone(r,n._origin),n._orientation=Ne.clone(s,n._orientation),n._vertexFormat=Ie.clone(a,n._vertexFormat),n._drawNearPlane=l,n};function lC(e,t,n,i,o,r,s,a){let l=e/3*2;for(let u=0;u<4;++u)c(t)&&(t[e]=r.x,t[e+1]=r.y,t[e+2]=r.z),c(n)&&(n[e]=s.x,n[e+1]=s.y,n[e+2]=s.z),c(i)&&(i[e]=a.x,i[e+1]=a.y,i[e+2]=a.z),e+=3;o[l]=0,o[l+1]=0,o[l+2]=1,o[l+3]=0,o[l+4]=1,o[l+5]=1,o[l+6]=0,o[l+7]=1}var Jnt=new Q,Qnt=new k,fW=new k,l_e=new h,u_e=new h,f_e=new h,eit=new h,tit=new h,nit=new h,ey=new Array(3),yD=new Array(4);yD[0]=new se(-1,-1,1,1);yD[1]=new se(1,-1,1,1);yD[2]=new se(1,1,1,1);yD[3]=new se(-1,1,1,1);var d_e=new Array(4);for(let e=0;e<4;++e)d_e[e]=new se;Rb._computeNearFarPlanes=function(e,t,n,i,o,r,s,a){let l=Q.fromQuaternion(t,Jnt),u=y(r,l_e),f=y(s,u_e),d=y(a,f_e);u=Q.getColumn(l,0,u),f=Q.getColumn(l,1,f),d=Q.getColumn(l,2,d),h.normalize(u,u),h.normalize(f,f),h.normalize(d,d),h.negate(u,u);let p=k.computeView(e,d,f,u,Qnt),g,m,b=i.projectionMatrix;if(n===mL){let x=k.multiply(b,p,fW);m=k.inverse(x,fW)}else g=k.inverseTransformation(p,fW);c(m)?(ey[0]=i.near,ey[1]=i.far):(ey[0]=0,ey[1]=i.near,ey[2]=i.far);for(let x=0;x<2;++x)for(let T=0;T<4;++T){let C=se.clone(yD[T],d_e[T]);if(c(m)){C=k.multiplyByVector(m,C,C);let S=1/C.w;h.multiplyByScalar(C,S,C),h.subtract(C,e,C),h.normalize(C,C);let v=h.dot(d,C);h.multiplyByScalar(C,ey[x]/v,C),h.add(C,e,C)}else{let S=i.offCenterFrustum;c(S)&&(i=S);let v=ey[x],D=ey[x+1];C.x=(C.x*(i.right-i.left)+i.left+i.right)*.5,C.y=(C.y*(i.top-i.bottom)+i.bottom+i.top)*.5,C.z=(C.z*(v-D)-v-D)*.5,C.w=1,k.multiplyByVector(g,C,C)}o[12*x+T*3]=C.x,o[12*x+T*3+1]=C.y,o[12*x+T*3+2]=C.z}};Rb.createGeometry=function(e){let t=e._frustumType,n=e._frustum,i=e._origin,o=e._orientation,r=e._drawNearPlane,s=e._vertexFormat,a=r?6:5,l=new Float64Array(3*4*6);Rb._computeNearFarPlanes(i,o,t,n,l);let u=3*4*2;l[u]=l[3*4],l[u+1]=l[3*4+1],l[u+2]=l[3*4+2],l[u+3]=l[0],l[u+4]=l[1],l[u+5]=l[2],l[u+6]=l[3*3],l[u+7]=l[3*3+1],l[u+8]=l[3*3+2],l[u+9]=l[3*7],l[u+10]=l[3*7+1],l[u+11]=l[3*7+2],u+=3*4,l[u]=l[3*5],l[u+1]=l[3*5+1],l[u+2]=l[3*5+2],l[u+3]=l[3],l[u+4]=l[4],l[u+5]=l[5],l[u+6]=l[0],l[u+7]=l[1],l[u+8]=l[2],l[u+9]=l[3*4],l[u+10]=l[3*4+1],l[u+11]=l[3*4+2],u+=3*4,l[u]=l[3],l[u+1]=l[4],l[u+2]=l[5],l[u+3]=l[3*5],l[u+4]=l[3*5+1],l[u+5]=l[3*5+2],l[u+6]=l[3*6],l[u+7]=l[3*6+1],l[u+8]=l[3*6+2],l[u+9]=l[3*2],l[u+10]=l[3*2+1],l[u+11]=l[3*2+2],u+=3*4,l[u]=l[3*2],l[u+1]=l[3*2+1],l[u+2]=l[3*2+2],l[u+3]=l[3*6],l[u+4]=l[3*6+1],l[u+5]=l[3*6+2],l[u+6]=l[3*7],l[u+7]=l[3*7+1],l[u+8]=l[3*7+2],l[u+9]=l[3*3],l[u+10]=l[3*3+1],l[u+11]=l[3*3+2],r||(l=l.subarray(3*4));let f=new pn({position:new we({componentDatatype:$.DOUBLE,componentsPerAttribute:3,values:l})});if(c(s.normal)||c(s.tangent)||c(s.bitangent)||c(s.st)){let p=c(s.normal)?new Float32Array(12*a):void 0,g=c(s.tangent)?new Float32Array(3*4*a):void 0,m=c(s.bitangent)?new Float32Array(3*4*a):void 0,b=c(s.st)?new Float32Array(2*4*a):void 0,x=l_e,T=u_e,C=f_e,S=h.negate(x,eit),v=h.negate(T,tit),D=h.negate(C,nit);u=0,r&&(lC(u,p,g,m,b,D,x,T),u+=3*4),lC(u,p,g,m,b,C,S,T),u+=3*4,lC(u,p,g,m,b,S,D,T),u+=3*4,lC(u,p,g,m,b,v,D,S),u+=3*4,lC(u,p,g,m,b,x,C,T),u+=3*4,lC(u,p,g,m,b,T,C,S),c(p)&&(f.normal=new we({componentDatatype:$.FLOAT,componentsPerAttribute:3,values:p})),c(g)&&(f.tangent=new we({componentDatatype:$.FLOAT,componentsPerAttribute:3,values:g})),c(m)&&(f.bitangent=new we({componentDatatype:$.FLOAT,componentsPerAttribute:3,values:m})),c(b)&&(f.st=new we({componentDatatype:$.FLOAT,componentsPerAttribute:2,values:b}))}let d=new Uint16Array(6*a);for(let p=0;p<a;++p){let g=p*6,m=p*4;d[g]=m,d[g+1]=m+1,d[g+2]=m+2,d[g+3]=m,d[g+4]=m+2,d[g+5]=m+3}return new ut({attributes:f,indices:d,primitiveType:Me.TRIANGLES,boundingSphere:ce.fromVertices(l)})};var bD=Rb;var dW=0,iit=1;function xD(e){A.typeOf.object("options",e),A.typeOf.object("options.frustum",e.frustum),A.typeOf.object("options.origin",e.origin),A.typeOf.object("options.orientation",e.orientation);let t=e.frustum,n=e.orientation,i=e.origin,o=y(e._drawNearPlane,!0),r,s;t instanceof vi?(r=dW,s=vi.packedLength):t instanceof rn&&(r=iit,s=rn.packedLength),this._frustumType=r,this._frustum=t.clone(),this._origin=h.clone(i),this._orientation=Ne.clone(n),this._drawNearPlane=o,this._workerName="createFrustumOutlineGeometry",this.packedLength=2+s+h.packedLength+Ne.packedLength}xD.pack=function(e,t,n){A.typeOf.object("value",e),A.defined("array",t),n=y(n,0);let i=e._frustumType,o=e._frustum;return t[n++]=i,i===dW?(vi.pack(o,t,n),n+=vi.packedLength):(rn.pack(o,t,n),n+=rn.packedLength),h.pack(e._origin,t,n),n+=h.packedLength,Ne.pack(e._orientation,t,n),n+=Ne.packedLength,t[n]=e._drawNearPlane?1:0,t};var oit=new vi,rit=new rn,sit=new Ne,ait=new h;xD.unpack=function(e,t,n){A.defined("array",e),t=y(t,0);let i=e[t++],o;i===dW?(o=vi.unpack(e,t,oit),t+=vi.packedLength):(o=rn.unpack(e,t,rit),t+=rn.packedLength);let r=h.unpack(e,t,ait);t+=h.packedLength;let s=Ne.unpack(e,t,sit);t+=Ne.packedLength;let a=e[t]===1;if(!c(n))return new xD({frustum:o,origin:r,orientation:s,_drawNearPlane:a});let l=i===n._frustumType?n._frustum:void 0;return n._frustum=o.clone(l),n._frustumType=i,n._origin=h.clone(r,n._origin),n._orientation=Ne.clone(s,n._orientation),n._drawNearPlane=a,n};xD.createGeometry=function(e){let t=e._frustumType,n=e._frustum,i=e._origin,o=e._orientation,r=e._drawNearPlane,s=new Float64Array(3*4*2);bD._computeNearFarPlanes(i,o,t,n,s);let a=new pn({position:new we({componentDatatype:$.DOUBLE,componentsPerAttribute:3,values:s})}),l,u,f=r?2:1,d=new Uint16Array(8*(f+1)),p=r?0:1;for(;p<2;++p)l=r?p*8:0,u=p*4,d[l]=u,d[l+1]=u+1,d[l+2]=u+1,d[l+3]=u+2,d[l+4]=u+2,d[l+5]=u+3,d[l+6]=u+3,d[l+7]=u;for(p=0;p<2;++p)l=(f+p)*8,u=p*4,d[l]=u,d[l+1]=u+4,d[l+2]=u+1,d[l+3]=u+5,d[l+4]=u+2,d[l+5]=u+6,d[l+6]=u+3,d[l+7]=u+7;return new ut({attributes:a,indices:d,primitiveType:Me.LINES,boundingSphere:ce.fromVertices(s)})};var hW=xD;function pL(){E.throwInstantiationError()}Object.defineProperties(pL.prototype,{credit:{get:E.throwInstantiationError}});pL.getCreditsFromResult=function(e){if(c(e.attributions))return e.attributions.map(Pt.getIonCredit)};pL.prototype.geocode=E.throwInstantiationError;var TD=pL;var cit={SEARCH:0,AUTOCOMPLETE:1},Mb=Object.freeze(cit);function h_e(){E.throwInstantiationError()}h_e.createGeometry=function(e){E.throwInstantiationError()};var lit=h_e;function uit(e,t,n){let i=new Uint8ClampedArray(e.buffer),o=new ImageData(i,t,n),r=document.createElement("canvas");return r.width=t,r.height=n,r.getContext("2d").putImageData(o,0,0),r}var mW=uit;var _it=Ur(pW(),1);function fit(e,t){return(e&t)!==0}var Al=fit;var dit=[1,2,4,8],m_e=15,hit=16,mit=64,pit=128;function nm(e,t,n,i,o,r){this._bits=e,this.cnodeVersion=t,this.imageryVersion=n,this.terrainVersion=i,this.imageryProvider=o,this.terrainProvider=r,this.ancestorHasTerrain=!1,this.terrainState=void 0}nm.clone=function(e,t){return c(t)?(t._bits=e._bits,t.cnodeVersion=e.cnodeVersion,t.imageryVersion=e.imageryVersion,t.terrainVersion=e.terrainVersion,t.imageryProvider=e.imageryProvider,t.terrainProvider=e.terrainProvider):t=new nm(e._bits,e.cnodeVersion,e.imageryVersion,e.terrainVersion,e.imageryProvider,e.terrainProvider),t.ancestorHasTerrain=e.ancestorHasTerrain,t.terrainState=e.terrainState,t};nm.prototype.setParent=function(e){this.ancestorHasTerrain=e.ancestorHasTerrain||this.hasTerrain()};nm.prototype.hasSubtree=function(){return Al(this._bits,hit)};nm.prototype.hasImagery=function(){return Al(this._bits,mit)};nm.prototype.hasTerrain=function(){return Al(this._bits,pit)};nm.prototype.hasChildren=function(){return Al(this._bits,m_e)};nm.prototype.hasChild=function(e){return Al(this._bits,dit[e])};nm.prototype.getChildBitmask=function(){return this._bits&m_e};var _W=nm;function git(e){let t=e.length,n=new ArrayBuffer(t),i=new Uint8Array(n);for(let o=0;o<t;++o)i[o]=e.charCodeAt(o);return n}var yit=git(`E\xF4\xBD\vy\xE2jE"\x92,\xCDq\xF8IFgQ\0B%\xC6\xE8a,f)\b\xC64\xDCjb%y
wmi\xD6\xF0\x9Ck\x93\xA1\xBDNu\xE0A[\xDF@V\f\xD9\xBBr\x9B\x81|3S\xEEOl\xD4q\xB0{\xC0\x7FEVZ\xADwUe\v3\x92*\xACl5\xC50s\xF83>mF8J\xB4\xDD\xF0.\xDDu\xDA\x8CDt"\xFAa"\f3"So\xAF9D\v\x8C9\xD99L\xB9\xBF\x7F\xAB\\\x8CP_\x9F"ux\xE9\x07q\x91h;\xC1\xC4\x9B\x7F\xF0<VqH\x82'UfYNe\x98u\xA3aF}a?A\0\x9F\xD7\xB44M\xCE\x87F\xB0\xD5\xB8\x8A'{\x8B\xDC+\xBBMg0\xC8\xD1\xF6\\\x8FP\xFA[/F\x9Bn5/'C.\xEB
\f^\xA5s\x1Be4\xE5l.jC'c#U\xA9?q{gC}:\xAF\xCD\xE2TU\x9C\xFDK\xC6\xE2\x9F/(\xED\xCB\\\xC6-f\x07\x88\xA7;/*"N\xB0k.\xDD\r\x95}}G\xBAC\xB2\xB2+>M\xAA>}\xE6\xCEI\x89\xC6\xE6x\fa1-\xA4O\xA5~q \x88\xEC\r1\xE8N\v\0nPh}=\b\r\x95\xA6n\xA3h\x97$[k\xF3#\xF3\xB6s\xB3\r\v@\xC0\x9F\xD8Q]\xFA".j\xDFI\0\xB9\xA0wU\xC6\xEFj\xBF{GL\x7F\x83\xEE\xDC\xDCF\x85\xA9\xADS\x07+S4\x07\xFF\x94Y\xE48\xE81\x83N\xB9XFk\xCB-#\x86\x92p\x005\x88"\xCF1\xB2&/\xE7\xC3u-6,rt\xB0#G\xB7\xD3\xD1&\x857r\xE2\0\x8CD\xCF\xDA3-\xDE\`\x86i#i*|\xCDKQ\r\x95T9w.)\xEA\x1B\xA6P\xA2j\x8FoP\x99\\>T\xFB\xEFP[\v\x07E\x89m(w7\xDB\x8EJfJo\x99 \xE5p\xE2\xB9q~\fmI-z\xFEr\xC7\xF2Y0\x8F\xBB]s\xE5\xC9 \xEAx\xEC \x90\xF0\x8A\x7FB|G\`\xB0\xBD&\xB7q\xB6\xC7\x9F\xD13\x82=\xD3\xAB\xEEc\x99\xC8+S\xA0D\\q\xC6\xCCD2O<\xCA\xC0)=R\xD3aX\xA9}e\xB4\xDC\xCF\r\xF4=\xF1\b\xA9B\xDA#	\xD8\xBF^PI\xF8M\xC0\xCBGLO\xF7{+\xD8\xC51\x92;\xB5o\xDCl\r\x92\x88\xD1\x9E\xDB?\xE2\xE9\xDA_\xD4\x84\xE2FaZ\xDEU\xCF\xA4\0\xBE\xFD\xCEg\xF1Ji\x97\xE6 H\xD8]\x7F~\xAEq N\xAE\xC0V\xA9\x91<\x82r\xE7v\xEC)I\xD6]-\x83\xE3\xDB6\xA9;f\x97\x87j\xD5\xB6=P^R\xB9K\xC7sWx\xC9\xF4.Y\x07\x95\x93o\xD0KW>''\xC7\`\xDB;\xED\x9ASD>?\x8D\x92mw\xA2
\xEB?R\xA8\xC6U^1I7\x85\xF4\xC5&-\xA9\xBF\x8B'T\xDA\xC3j \xE5*x\xB0\xD6\x90pr\xAA\x8Bh\xBD\x88\xF7_H\xB1~\xC0XL?f\xF9>\xE1e\xC0p\xA7\xCF8i\xAF\xF0VldI\x9C'\xADxtO\xC2\x87\xDEV9\0\xDAw\v\xCB-\x1B\x89\xFB5O\xF5\bQ\`\xC1
ZGM&30x\xDA\xC0\x9CFG\xE2[y\`In7gS
>\xE9\xECF9\xB2\xF14\r\xC6\x84Sun\xE1\fY\xD9\xDE)\x85{II\xA5wy\xBEIV.6\xE7\v:\xBBOb{\xD2M1\x95/\xBD8{\xA8O!\xE1\xECFpv\x95})"x\x88
\x90\xDD\x9D\\\xDA\xDEQ\xCF\xF0\xFCYRe|3\xDF\xF3H\xDA\xBB*u\xDB\`\xB2\xD4\xFC\xED\x1B\xEC\x7F5\xA8\xFF(1\x07-\xC8\xDC\x88F|\x8A["`);function uu(e){this.imageryPresent=!0,this.protoImagery=void 0,this.terrainPresent=!0,this.negativeAltitudeExponentBias=32,this.negativeAltitudeThreshold=R.EPSILON12,this.providers={},this.key=void 0,this._resource=void 0,this._quadPacketVersion=1,this._tileInfo={},this._subtreePromises={}}Object.defineProperties(uu.prototype,{url:{get:function(){return this._resource.url}},proxy:{get:function(){return this._resource.proxy}},resource:{get:function(){return this._resource}}});uu.fromUrl=async function(e){A.defined("resourceOrUrl",e);let t=e;typeof t!="string"&&!(t instanceof De)&&(A.typeOf.string("resourceOrUrl.url",e.url),t=e.url);let n=De.createIfNeeded(t);n.appendForwardSlash();let i=new uu;i._resource=n;try{await bit(i),await i.getQuadTreePacket("",i._quadPacketVersion)}catch(o){let r=`An error occurred while accessing ${__e(i,"",1).url}: ${o}`;throw new ue(r)}return i};uu.tileXYToQuadKey=function(e,t,n){let i="";for(let o=n;o>=0;--o){let r=1<<o,s=0;Al(t,r)?Al(e,r)&&(s|=1):(s|=2,Al(e,r)||(s|=1)),i+=s}return i};uu.quadKeyToTileXY=function(e){let t=0,n=0,i=e.length-1;for(let o=i;o>=0;--o){let r=1<<o,s=+e[i-o];Al(s,2)?Al(s,1)||(t|=r):(n|=r,Al(s,1)&&(t|=r))}return{x:t,y:n,level:i}};uu.prototype.isValid=function(e){let t=this.getTileInformationFromQuadKey(e);if(c(t))return t!==null;let n=!0,i=e,o;for(;i.length>1;)if(o=i.substring(i.length-1),i=i.substring(0,i.length-1),t=this.getTileInformationFromQuadKey(i),c(t)){!t.hasSubtree()&&!t.hasChild(parseInt(o))&&(n=!1);break}else if(t===null){n=!1;break}return n};var p_e=new Ti("decodeGoogleEarthEnterprisePacket");uu.prototype.getQuadTreePacket=function(e,t,n){t=y(t,1),e=y(e,"");let o=__e(this,e,t,n).fetchArrayBuffer();if(!c(o))return;let r=this._tileInfo,s=this.key;return o.then(function(a){return p_e.scheduleTask({buffer:a,quadKey:e,type:"Metadata",key:s},[a]).then(function(u){let f,d=-1;if(e!==""){d=e.length+1;let m=u[e];f=r[e],f._bits|=m._bits,delete u[e]}let p=Object.keys(u);p.sort(function(m,b){return m.length-b.length});let g=p.length;for(let m=0;m<g;++m){let b=p[m];if(u[b]!==null){let T=_W.clone(u[b]),C=b.length;if(C===d)T.setParent(f);else if(C>1){let S=r[b.substring(0,b.length-1)];T.setParent(S)}r[b]=T}else r[b]=null}})})};uu.prototype.populateSubtree=function(e,t,n,i){let o=uu.tileXYToQuadKey(e,t,n);return bW(this,o,i)};function bW(e,t,n){let i=e._tileInfo,o=t,r=i[o];if(c(r)&&(!r.hasSubtree()||r.hasChildren()))return r;for(;r===void 0&&o.length>1;)o=o.substring(0,o.length-1),r=i[o];let s,a=e._subtreePromises,l=a[o];if(c(l))return l.then(function(){return s=new ur({throttle:n.throttle,throttleByServer:n.throttleByServer,type:n.type,priorityFunction:n.priorityFunction}),bW(e,t,s)});if(!c(r)||!r.hasSubtree())return Promise.reject(new ue(`Couldn't load metadata for tile ${t}`));if(l=e.getQuadTreePacket(o,r.cnodeVersion,n),!!c(l))return a[o]=l,l.then(function(){return s=new ur({throttle:n.throttle,throttleByServer:n.throttleByServer,type:n.type,priorityFunction:n.priorityFunction}),bW(e,t,s)}).finally(function(){delete a[o]})}uu.prototype.getTileInformation=function(e,t,n){let i=uu.tileXYToQuadKey(e,t,n);return this._tileInfo[i]};uu.prototype.getTileInformationFromQuadKey=function(e){return this._tileInfo[e]};function __e(e,t,n,i){return e._resource.getDerivedResource({url:`flatfile?q2-0${t}-q.${n.toString()}`,request:i})}var gW,yW;function bit(e){let t=e._resource.getDerivedResource({url:"dbRoot.v5",queryParameters:{output:"proto"}});if(!c(yW)){let n=sn("ThirdParty/google-earth-dbroot-parser.js"),i=window.cesiumGoogleEarthDbRootParser;yW=cE(n).then(function(){gW=window.cesiumGoogleEarthDbRootParser(_it),c(i)?window.cesiumGoogleEarthDbRootParser=i:delete window.cesiumGoogleEarthDbRootParser})}return yW.then(function(){return t.fetchArrayBuffer()}).then(function(n){let i=gW.EncryptedDbRootProto.decode(new Uint8Array(n)),o=i.encryptionData,r=o.byteOffset,s=r+o.byteLength,a=e.key=o.buffer.slice(r,s);o=i.dbrootData,r=o.byteOffset,s=r+o.byteLength;let l=o.buffer.slice(r,s);return p_e.scheduleTask({buffer:l,type:"DbRoot",key:a},[l])}).then(function(n){let i=gW.DbRootProto.decode(new Uint8Array(n.buffer));if(e.imageryPresent=y(i.imageryPresent,e.imageryPresent),e.protoImagery=i.protoImagery,e.terrainPresent=y(i.terrainPresent,e.terrainPresent),c(i.endSnippet)&&c(i.endSnippet.model)){let a=i.endSnippet.model;e.negativeAltitudeExponentBias=y(a.negativeAltitudeExponentBias,e.negativeAltitudeExponentBias),e.negativeAltitudeThreshold=y(a.compressedNegativeAltitudeThreshold,e.negativeAltitudeThreshold)}c(i.databaseVersion)&&(e._quadPacketVersion=y(i.databaseVersion.quadtreeVersion,e._quadPacketVersion));let o=e.providers,r=y(i.providerInfo,[]),s=r.length;for(let a=0;a<s;++a){let l=r[a],u=l.copyrightString;c(u)&&(o[l.providerId]=new Pt(u.value))}}).catch(function(){console.log(`Failed to retrieve ${t.url}. Using defaults.`),e.key=yit})}var Lb=uu;function Nb(e){e=y(e,y.EMPTY_OBJECT),A.typeOf.object("options.buffer",e.buffer),A.typeOf.number("options.negativeAltitudeExponentBias",e.negativeAltitudeExponentBias),A.typeOf.number("options.negativeElevationThreshold",e.negativeElevationThreshold),this._buffer=e.buffer,this._credits=e.credits,this._negativeAltitudeExponentBias=e.negativeAltitudeExponentBias,this._negativeElevationThreshold=e.negativeElevationThreshold;let t=y(e.childTileMask,15),n=t&3;n|=t&4?8:0,n|=t&8?4:0,this._childTileMask=n,this._createdByUpsampling=y(e.createdByUpsampling,!1),this._skirtHeight=void 0,this._bufferType=this._buffer.constructor,this._mesh=void 0,this._minimumHeight=void 0,this._maximumHeight=void 0}Object.defineProperties(Nb.prototype,{credits:{get:function(){return this._credits}},waterMask:{get:function(){}}});var b_e="createVerticesFromGoogleEarthEnterpriseBuffer",xit=new Ti(b_e),Tit=new Ti(b_e,Xp.maximumAsynchronousTasks),g_e=new ae,xW=new ae;Nb.prototype.createMesh=function(e){e=y(e,y.EMPTY_OBJECT),A.typeOf.object("options.tilingScheme",e.tilingScheme),A.typeOf.number("options.x",e.x),A.typeOf.number("options.y",e.y),A.typeOf.number("options.level",e.level);let t=e.tilingScheme,n=e.x,i=e.y,o=e.level,r=y(e.exaggeration,1),s=y(e.exaggerationRelativeHeight,0),a=y(e.throttle,!0),l=t.ellipsoid;t.tileXYToNativeRectangle(n,i,o,g_e),t.tileXYToRectangle(n,i,o,xW);let u=l.cartographicToCartesian(ae.center(xW)),d=40075.16/(1<<o);this._skirtHeight=Math.min(d*8,1e3);let g=(a?Tit:xit).scheduleTask({buffer:this._buffer,nativeRectangle:g_e,rectangle:xW,relativeToCenter:u,ellipsoid:l,skirtHeight:this._skirtHeight,exaggeration:r,exaggerationRelativeHeight:s,includeWebMercatorT:!0,negativeAltitudeExponentBias:this._negativeAltitudeExponentBias,negativeElevationThreshold:this._negativeElevationThreshold});if(!c(g))return;let m=this;return g.then(function(b){return m._mesh=new em(u,new Float32Array(b.vertices),new Uint16Array(b.indices),b.indexCountWithoutSkirts,b.vertexCountWithoutSkirts,b.minimumHeight,b.maximumHeight,ce.clone(b.boundingSphere3D),h.clone(b.occludeePointInScaledSpace),b.numberOfAttributes,Pn.clone(b.orientedBoundingBox),xl.clone(b.encoding),b.westIndicesSouthToNorth,b.southIndicesEastToWest,b.eastIndicesNorthToSouth,b.northIndicesWestToEast),m._minimumHeight=b.minimumHeight,m._maximumHeight=b.maximumHeight,m._buffer=void 0,m._mesh})};Nb.prototype.interpolateHeight=function(e,t,n){let i=R.clamp((t-e.west)/e.width,0,1),o=R.clamp((n-e.south)/e.height,0,1);return c(this._mesh)?wit(this,i,o):Pit(this,i,o,e)};var Ait=new Ti("upsampleQuantizedTerrainMesh",Xp.maximumAsynchronousTasks);Nb.prototype.upsample=function(e,t,n,i,o,r,s){if(A.typeOf.object("tilingScheme",e),A.typeOf.number("thisX",t),A.typeOf.number("thisY",n),A.typeOf.number("thisLevel",i),A.typeOf.number("descendantX",o),A.typeOf.number("descendantY",r),A.typeOf.number("descendantLevel",s),s-i>1)throw new E("Upsampling through more than one level at a time is not currently supported.");let l=this._mesh;if(!c(this._mesh))return;let u=t*2!==o,f=n*2===r,d=e.ellipsoid,p=e.tileXYToRectangle(o,r,s),g=Ait.scheduleTask({vertices:l.vertices,indices:l.indices,indexCountWithoutSkirts:l.indexCountWithoutSkirts,vertexCountWithoutSkirts:l.vertexCountWithoutSkirts,encoding:l.encoding,minimumHeight:this._minimumHeight,maximumHeight:this._maximumHeight,isEastChild:u,isNorthChild:f,childRectangle:p,ellipsoid:d});if(!c(g))return;let m=this;return g.then(function(b){let x=new Uint16Array(b.vertices),T=Fe.createTypedArray(x.length/3,b.indices),C=m._skirtHeight;return new mD({quantizedVertices:x,indices:T,minimumHeight:b.minimumHeight,maximumHeight:b.maximumHeight,boundingSphere:ce.clone(b.boundingSphere),orientedBoundingBox:Pn.clone(b.orientedBoundingBox),horizonOcclusionPoint:h.clone(b.horizonOcclusionPoint),westIndices:b.westIndices,southIndices:b.southIndices,eastIndices:b.eastIndices,northIndices:b.northIndices,westSkirtHeight:C,southSkirtHeight:C,eastSkirtHeight:C,northSkirtHeight:C,childTileMask:0,createdByUpsampling:!0,credits:m._credits})})};Nb.prototype.isChildAvailable=function(e,t,n,i){A.typeOf.number("thisX",e),A.typeOf.number("thisY",t),A.typeOf.number("childX",n),A.typeOf.number("childY",i);let o=2;return n!==e*2&&++o,i!==t*2&&(o-=2),(this._childTileMask&1<<o)!==0};Nb.prototype.wasCreatedByUpsampling=function(){return this._createdByUpsampling};var Cit=new H,Eit=new H,Sit=new H,x_e=new h;function wit(e,t,n){let i=e._mesh,o=i.vertices,r=i.encoding,s=i.indices;for(let a=0,l=s.length;a<l;a+=3){let u=s[a],f=s[a+1],d=s[a+2],p=r.decodeTextureCoordinates(o,u,Cit),g=r.decodeTextureCoordinates(o,f,Eit),m=r.decodeTextureCoordinates(o,d,Sit),b=Ob.computeBarycentricCoordinates(t,n,p.x,p.y,g.x,g.y,m.x,m.y,x_e);if(b.x>=-1e-15&&b.y>=-1e-15&&b.z>=-1e-15){let x=r.decodeHeight(o,u),T=r.decodeHeight(o,f),C=r.decodeHeight(o,d);return b.x*x+b.y*T+b.z*C}}}var vit=Uint16Array.BYTES_PER_ELEMENT,y_e=Uint32Array.BYTES_PER_ELEMENT,TW=Int32Array.BYTES_PER_ELEMENT,Dit=Float32Array.BYTES_PER_ELEMENT,AW=Float64Array.BYTES_PER_ELEMENT;function Pit(e,t,n,i){let o=e._buffer,r=0,s=0,a=0;n>.5?(t>.5?(r=2,s=.5):r=3,a=.5):t>.5&&(r=1,s=.5);let l=new DataView(o),u=0;for(let D=0;D<r;++D)u+=l.getUint32(u,!0),u+=y_e;u+=y_e,u+=2*AW;let f=R.toRadians(l.getFloat64(u,!0)*180);u+=AW;let d=R.toRadians(l.getFloat64(u,!0)*180);u+=AW;let p=i.width/f/2,g=i.height/d/2,m=l.getInt32(u,!0);u+=TW;let b=l.getInt32(u,!0)*3;u+=TW,u+=TW;let x=new Array(m),T=new Array(m),C=new Array(m),S;for(S=0;S<m;++S)x[S]=s+l.getUint8(u++)*p,T[S]=a+l.getUint8(u++)*g,C[S]=l.getFloat32(u,!0)*6371010,u+=Dit;let v=new Array(b);for(S=0;S<b;++S)v[S]=l.getUint16(u,!0),u+=vit;for(S=0;S<b;S+=3){let D=v[S],I=v[S+1],L=v[S+2],M=x[D],N=x[I],B=x[L],_=T[D],w=T[I],P=T[L],O=Ob.computeBarycentricCoordinates(t,n,M,_,N,w,B,P,x_e);if(O.x>=-1e-15&&O.y>=-1e-15&&O.z>=-1e-15)return O.x*C[D]+O.y*C[I]+O.z*C[L]}}var _L=Nb;var Tf={UNKNOWN:0,NONE:1,SELF:2,PARENT:3},gL=new J;function yL(){this._terrainCache={},this._lastTidy=J.now()}yL.prototype.add=function(e,t){this._terrainCache[e]={buffer:t,timestamp:J.now()}};yL.prototype.get=function(e){let n=this._terrainCache[e];if(c(n))return delete this._terrainCache[e],n.buffer};yL.prototype.tidy=function(){if(J.now(gL),J.secondsDifference(gL,this._lastTidy)>10){let e=this._terrainCache,t=Object.keys(e),n=t.length;for(let i=0;i<n;++i){let o=t[i],r=e[o];J.secondsDifference(gL,r.timestamp)>10&&delete e[o]}J.clone(gL,this._lastTidy)}};function ty(e){e=y(e,y.EMPTY_OBJECT),this._tilingScheme=new $i({numberOfLevelZeroTilesX:2,numberOfLevelZeroTilesY:2,rectangle:new ae(-R.PI,-R.PI,R.PI,R.PI),ellipsoid:e.ellipsoid});let t=e.credit;typeof t=="string"&&(t=new Pt(t)),this._credit=t,this._levelZeroMaximumGeometricError=40075.16,this._terrainCache=new yL,this._terrainPromises={},this._terrainRequests={},this._errorEvent=new pe}Object.defineProperties(ty.prototype,{url:{get:function(){return this._metadata.url}},proxy:{get:function(){return this._metadata.proxy}},tilingScheme:{get:function(){return this._tilingScheme}},errorEvent:{get:function(){return this._errorEvent}},credit:{get:function(){return this._credit}},hasWaterMask:{get:function(){return!1}},hasVertexNormals:{get:function(){return!1}},availability:{get:function(){}}});ty.fromMetadata=function(e,t){if(A.defined("metadata",e),!e.terrainPresent)throw new ue(`The server ${e.url} doesn't have terrain`);let n=new ty(t);return n._metadata=e,n};var Iit=new Ti("decodeGoogleEarthEnterprisePacket");function T_e(e,t,n){let i=t.getChildBitmask();if(t.terrainState===Tf.PARENT){i=0;for(let o=0;o<4;++o){let r=n.getTileInformationFromQuadKey(e+o.toString());c(r)&&r.hasTerrain()&&(i|=1<<o)}}return i}ty.prototype.requestTileGeometry=function(e,t,n,i){let o=Lb.tileXYToQuadKey(e,t,n),r=this._terrainCache,s=this._metadata,a=s.getTileInformationFromQuadKey(o);if(!c(a))return Promise.reject(new ue("Terrain tile doesn't exist"));let l=a.terrainState;c(l)||(l=a.terrainState=Tf.UNKNOWN);let u=r.get(o);if(c(u)){let T=s.providers[a.terrainProvider];return Promise.resolve(new _L({buffer:u,childTileMask:T_e(o,a,s),credits:c(T)?[T]:void 0,negativeAltitudeExponentBias:s.negativeAltitudeExponentBias,negativeElevationThreshold:s.negativeAltitudeThreshold}))}if(r.tidy(),a.ancestorHasTerrain){if(l===Tf.NONE)return Promise.reject(new ue("Terrain tile doesn't exist"))}else return Promise.resolve(new Mc({buffer:new Uint8Array(16*16),width:16,height:16}));let f,d=o,p=-1;switch(l){case Tf.SELF:p=a.terrainVersion;break;case Tf.PARENT:d=d.substring(0,d.length-1),f=s.getTileInformationFromQuadKey(d),p=f.terrainVersion;break;case Tf.UNKNOWN:a.hasTerrain()?p=a.terrainVersion:(d=d.substring(0,d.length-1),f=s.getTileInformationFromQuadKey(d),c(f)&&f.hasTerrain()&&(p=f.terrainVersion));break}if(p<0)return Promise.reject(new ue("Terrain tile doesn't exist"));let g=this._terrainPromises,m=this._terrainRequests,b,x;if(c(g[d]))b=g[d],x=m[d];else{x=i;let T=Oit(this,d,p,x).fetchArrayBuffer();if(!c(T))return;b=T.then(function(C){return c(C)?Iit.scheduleTask({buffer:C,type:"Terrain",key:s.key},[C]).then(function(S){let v=s.getTileInformationFromQuadKey(d);v.terrainState=Tf.SELF,r.add(d,S[0]);let D=v.terrainProvider,I=S.length-1;for(let L=0;L<I;++L){let M=d+L.toString(),N=s.getTileInformationFromQuadKey(M);c(N)&&(r.add(M,S[L+1]),N.terrainState=Tf.PARENT,N.terrainProvider===0&&(N.terrainProvider=D))}}):Promise.reject(new ue("Failed to load terrain."))}),g[d]=b,m[d]=x,b=b.finally(function(){delete g[d],delete m[d]})}return b.then(function(){let T=r.get(o);if(c(T)){let C=s.providers[a.terrainProvider];return new _L({buffer:T,childTileMask:T_e(o,a,s),credits:c(C)?[C]:void 0,negativeAltitudeExponentBias:s.negativeAltitudeExponentBias,negativeElevationThreshold:s.negativeAltitudeThreshold})}return Promise.reject(new ue("Failed to load terrain."))}).catch(function(T){return x.state===Jn.CANCELLED?(i.state=x.state,Promise.reject(T)):(a.terrainState=Tf.NONE,Promise.reject(T))})};ty.prototype.getLevelMaximumGeometricError=function(e){return this._levelZeroMaximumGeometricError/(1<<e)};ty.prototype.getTileDataAvailable=function(e,t,n){let i=this._metadata,o=Lb.tileXYToQuadKey(e,t,n),r=i.getTileInformation(e,t,n);if(r===null)return!1;if(c(r)){if(!r.ancestorHasTerrain)return!0;let s=r.terrainState;if(s===Tf.NONE)return!1;if((!c(s)||s===Tf.UNKNOWN)&&(r.terrainState=Tf.UNKNOWN,!r.hasTerrain())){o=o.substring(0,o.length-1);let a=i.getTileInformationFromQuadKey(o);if(!c(a)||!a.hasTerrain())return!1}return!0}if(i.isValid(o)){let s=new ur({throttle:!1,throttleByServer:!0,type:Es.TERRAIN});i.populateSubtree(e,t,n,s)}return!1};ty.prototype.loadTileDataAvailability=function(e,t,n){};function Oit(e,t,n,i){return n=c(n)&&n>0?n:1,e._metadata.resource.getDerivedResource({url:`flatfile?f1c-0${t}-t.${n.toString()}`,request:i})}var Rit=ty;var bL={};bL.defaultApiKey=void 0;bL.mapTilesApiEndpoint=new De({url:"https://tile.googleapis.com/v1/"});bL.getDefaultCredit=function(){return new Pt('<img src="https://assets.ion.cesium.com/google-credit.png" style="vertical-align: -5px" alt="Google">',!0)};var AD=bL;function Mit(e,t,n,i){this.rightAscension=e,this.declination=t,this.rotation=n,this.rotationRate=i}var CW=Mit;var N_e={},Lit=32.184,Nit=2451545,A_e=-.0529921,C_e=-.1059842,E_e=13.0120009,S_e=13.3407154,w_e=.9856003,v_e=26.4057084,D_e=13.064993,P_e=.3287146,I_e=1.7484877,O_e=-.1589763,R_e=.0036096,M_e=.1643573,L_e=12.9590088,EW=new J;N_e.ComputeMoon=function(e,t){c(e)||(e=J.now()),EW=J.addSeconds(e,Lit,EW);let n=J.totalDays(EW)-Nit,i=n/qn.DAYS_PER_JULIAN_CENTURY,o=(125.045+A_e*n)*R.RADIANS_PER_DEGREE,r=(250.089+C_e*n)*R.RADIANS_PER_DEGREE,s=(260.008+E_e*n)*R.RADIANS_PER_DEGREE,a=(176.625+S_e*n)*R.RADIANS_PER_DEGREE,l=(357.529+w_e*n)*R.RADIANS_PER_DEGREE,u=(311.589+v_e*n)*R.RADIANS_PER_DEGREE,f=(134.963+D_e*n)*R.RADIANS_PER_DEGREE,d=(276.617+P_e*n)*R.RADIANS_PER_DEGREE,p=(34.226+I_e*n)*R.RADIANS_PER_DEGREE,g=(15.134+O_e*n)*R.RADIANS_PER_DEGREE,m=(119.743+R_e*n)*R.RADIANS_PER_DEGREE,b=(239.961+M_e*n)*R.RADIANS_PER_DEGREE,x=(25.053+L_e*n)*R.RADIANS_PER_DEGREE,T=Math.sin(o),C=Math.sin(r),S=Math.sin(s),v=Math.sin(a),D=Math.sin(l),I=Math.sin(u),L=Math.sin(f),M=Math.sin(d),N=Math.sin(p),B=Math.sin(g),_=Math.sin(m),w=Math.sin(b),P=Math.sin(x),O=Math.cos(o),F=Math.cos(r),V=Math.cos(s),G=Math.cos(a),z=Math.cos(l),W=Math.cos(u),U=Math.cos(f),q=Math.cos(d),K=Math.cos(p),te=Math.cos(g),Y=Math.cos(m),Z=Math.cos(b),ee=Math.cos(x),me=(269.9949+.0031*i-3.8787*T-.1204*C+.07*S-.0172*v+.0072*I-.0052*B+.0043*P)*R.RADIANS_PER_DEGREE,be=(66.5392+.013*i+1.5419*O+.0239*F-.0278*V+.0068*G-.0029*W+9e-4*U+8e-4*te-9e-4*ee)*R.RADIANS_PER_DEGREE,le=(38.3213+13.17635815*n-14e-13*n*n+3.561*T+.1208*C-.0642*S+.0158*v+.0252*D-.0066*I-.0047*L-.0046*M+.0028*N+.0052*B+.004*_+.0019*w-.0044*P)*R.RADIANS_PER_DEGREE,ge=(13.17635815-14e-13*(2*n)+3.561*O*A_e+.1208*F*C_e-.0642*V*E_e+.0158*G*S_e+.0252*z*w_e-.0066*W*v_e-.0047*U*D_e-.0046*q*P_e+.0028*K*I_e+.0052*te*O_e+.004*Y*R_e+.0019*Z*M_e-.0044*ee*L_e)/86400*R.RADIANS_PER_DEGREE;return c(t)||(t=new CW),t.rightAscension=me,t.declination=be,t.rotation=le,t.rotationRate=ge,t};var SW=N_e;function F_e(e){(!c(e)||typeof e!="function")&&(e=SW.ComputeMoon),this._computeFunction=e}var Fit=new h,Bit=new h,kit=new h;function Vit(e,t,n){let i=Fit;i.x=Math.cos(e+R.PI_OVER_TWO),i.y=Math.sin(e+R.PI_OVER_TWO),i.z=0;let o=Math.cos(t),r=kit;r.x=o*Math.cos(e),r.y=o*Math.sin(e),r.z=Math.sin(t);let s=h.cross(r,i,Bit);return c(n)||(n=new Q),n[0]=i.x,n[1]=s.x,n[2]=r.x,n[3]=i.y,n[4]=s.y,n[5]=r.y,n[6]=i.z,n[7]=s.z,n[8]=r.z,n}var Uit=new Q,zit=new Ne;F_e.prototype.evaluate=function(e,t){c(e)||(e=J.now());let n=this._computeFunction(e),i=Vit(n.rightAscension,n.declination,t),o=R.zeroToTwoPi(n.rotation),r=Ne.fromAxisAngle(h.UNIT_Z,o,zit),s=Q.fromQuaternion(Ne.conjugate(r,r),Uit);return Q.multiply(s,i,i)};var wW=F_e;var CD={};CD.type=void 0;CD.getRequiredDataPoints=E.throwInstantiationError;CD.interpolateOrderZero=E.throwInstantiationError;CD.interpolate=E.throwInstantiationError;var Hit=CD;function vW(e){A.defined("url",e),this._url=De.createIfNeeded(e),this._url.appendForwardSlash()}Object.defineProperties(vW.prototype,{url:{get:function(){return this._url}},credit:{get:function(){}}});vW.prototype.geocode=async function(e,t){return A.typeOf.string("query",e),this._url.getDerivedResource({url:t===Mb.AUTOCOMPLETE?"autocomplete":"search",queryParameters:{text:e}}).fetchJson().then(function(i){return i.features.map(function(o){let r,s=o.bbox;if(c(s))r=ae.fromDegrees(s[0],s[1],s[2],s[3]);else{let a=o.geometry.coordinates[0],l=o.geometry.coordinates[1];r=h.fromDegrees(a,l)}return{displayName:o.properties.label,destination:r,attributions:i.attributions}})})};var DW=vW;function PW(e){e=y(e,y.EMPTY_OBJECT),A.typeOf.object("options.scene",e.scene);let t=y(e.accessToken,jm.defaultAccessToken),n=De.createIfNeeded(y(e.server,jm.defaultServer));n.appendForwardSlash();let i=jm.getDefaultTokenCredit(t);c(i)&&e.scene.frameState.creditDisplay.addStaticCredit(Pt.clone(i));let o=n.getDerivedResource({url:"v1/geocode"});c(t)&&o.appendQueryParameters({access_token:t}),this._accessToken=t,this._server=n,this._pelias=new DW(o)}Object.defineProperties(PW.prototype,{credit:{get:function(){}}});PW.prototype.geocode=async function(e,t){return this._pelias.geocode(e,t)};var xL=PW;var Git={SHIFT:0,CTRL:1,ALT:2},Ca=Object.freeze(Git);function TL(){E.throwInstantiationError()}Object.defineProperties(TL.prototype,{ellipsoid:{get:E.throwInstantiationError}});TL.prototype.project=E.throwInstantiationError;TL.prototype.unproject=E.throwInstantiationError;var jit=TL;var IW=[],OW=[];function Wit(e,t,n,i,o,r){let s=o-i+1,a=r-o,l=IW,u=OW,f,d;for(f=0;f<s;++f)l[f]=e[i+f];for(d=0;d<a;++d)u[d]=e[o+d+1];f=0,d=0;for(let p=i;p<=r;++p){let g=l[f],m=u[d];f<s&&(d>=a||t(g,m,n)<=0)?(e[p]=g,++f):d<a&&(e[p]=m,++d)}}function RW(e,t,n,i,o){if(i>=o)return;let r=Math.floor((i+o)*.5);RW(e,t,n,i,r),RW(e,t,n,r+1,o),Wit(e,t,n,i,r,o)}function qit(e,t,n){if(!c(e))throw new E("array is required.");if(!c(t))throw new E("comparator is required.");let i=e.length,o=Math.ceil(i*.5);IW.length=o,OW.length=o,RW(e,t,n,0,i-1),IW.length=0,OW.length=0}var Fb=qit;function uC(e){e=y(e,y.EMPTY_OBJECT);let t=e.weights,n=e.times;if(A.defined("weights",t),A.defined("times",n),A.typeOf.number.greaterThanOrEquals("weights.length",t.length,3),t.length%n.length!==0)throw new E("times.length must be a factor of weights.length.");this._times=n,this._weights=t,this._count=t.length/n.length,this._lastTimeIndex=0}Object.defineProperties(uC.prototype,{times:{get:function(){return this._times}},weights:{get:function(){return this._weights}}});uC.prototype.findTimeInterval=Fi.prototype.findTimeInterval;uC.prototype.wrapTime=Fi.prototype.wrapTime;uC.prototype.clampTime=Fi.prototype.clampTime;uC.prototype.evaluate=function(e,t){let n=this.weights,i=this.times,o=this._lastTimeIndex=this.findTimeInterval(e,this._lastTimeIndex),r=(e-i[o])/(i[o+1]-i[o]);c(t)||(t=new Array(this._count));for(let s=0;s<this._count;s++){let a=o*this._count+s;t[s]=n[a]*(1-r)+n[a+this._count]*r}return t};var Yit=uC;var Xit={NONE:-1,PARTIAL:0,FULL:1},Br=Object.freeze(Xit);function tc(e,t){if(!c(e))throw new E("occluderBoundingSphere is required.");if(!c(t))throw new E("camera position is required.");this._occluderPosition=h.clone(e.center),this._occluderRadius=e.radius,this._horizonDistance=0,this._horizonPlaneNormal=void 0,this._horizonPlanePosition=void 0,this._cameraPosition=void 0,this.cameraPosition=t}var AL=new h;Object.defineProperties(tc.prototype,{position:{get:function(){return this._occluderPosition}},radius:{get:function(){return this._occluderRadius}},cameraPosition:{set:function(e){if(!c(e))throw new E("cameraPosition is required.");e=h.clone(e,this._cameraPosition);let t=h.subtract(this._occluderPosition,e,AL),n=h.magnitudeSquared(t),i=this._occluderRadius*this._occluderRadius,o,r,s;if(n>i){o=Math.sqrt(n-i),n=1/Math.sqrt(n),r=h.multiplyByScalar(t,n,AL);let a=o*o*n;s=h.add(e,h.multiplyByScalar(r,a,AL),AL)}else o=Number.MAX_VALUE;this._horizonDistance=o,this._horizonPlaneNormal=r,this._horizonPlanePosition=s,this._cameraPosition=e}}});tc.fromBoundingSphere=function(e,t,n){if(!c(e))throw new E("occluderBoundingSphere is required.");if(!c(t))throw new E("camera position is required.");return c(n)?(h.clone(e.center,n._occluderPosition),n._occluderRadius=e.radius,n.cameraPosition=t,n):new tc(e,t)};var k_e=new h;tc.prototype.isPointVisible=function(e){if(this._horizonDistance!==Number.MAX_VALUE){let t=h.subtract(e,this._occluderPosition,k_e),n=this._occluderRadius;if(n=h.magnitudeSquared(t)-n*n,n>0)return n=Math.sqrt(n)+this._horizonDistance,t=h.subtract(e,this._cameraPosition,t),n*n>h.magnitudeSquared(t)}return!1};var Kit=new h;tc.prototype.isBoundingSphereVisible=function(e){let t=h.clone(e.center,Kit),n=e.radius;if(this._horizonDistance!==Number.MAX_VALUE){let i=h.subtract(t,this._occluderPosition,k_e),o=this._occluderRadius-n;if(o=h.magnitudeSquared(i)-o*o,n<this._occluderRadius)return o>0?(o=Math.sqrt(o)+this._horizonDistance,i=h.subtract(t,this._cameraPosition,i),o*o+n*n>h.magnitudeSquared(i)):!1;if(o>0){i=h.subtract(t,this._cameraPosition,i);let r=h.magnitudeSquared(i),s=this._occluderRadius*this._occluderRadius,a=n*n;return(this._horizonDistance*this._horizonDistance+s)*a>r*s?!0:(o=Math.sqrt(o)+this._horizonDistance,o*o+a>r)}return!0}return!1};var $it=new h;tc.prototype.computeVisibility=function(e){if(!c(e))throw new E("occludeeBS is required.");let t=h.clone(e.center),n=e.radius;if(n>this._occluderRadius)return Br.FULL;if(this._horizonDistance!==Number.MAX_VALUE){let i=h.subtract(t,this._occluderPosition,$it),o=this._occluderRadius-n,r=h.magnitudeSquared(i);if(o=r-o*o,o>0){o=Math.sqrt(o)+this._horizonDistance,i=h.subtract(t,this._cameraPosition,i);let s=h.magnitudeSquared(i);return o*o+n*n<s?Br.NONE:(o=this._occluderRadius+n,o=r-o*o,o>0?(o=Math.sqrt(o)+this._horizonDistance,s<o*o+n*n?Br.FULL:Br.PARTIAL):(i=h.subtract(t,this._horizonPlanePosition,i),h.dot(i,this._horizonPlaneNormal)>-n?Br.PARTIAL:Br.FULL))}}return Br.NONE};var CL=new h;tc.computeOccludeePoint=function(e,t,n){if(!c(e))throw new E("occluderBoundingSphere is required.");if(!c(n))throw new E("positions is required.");if(n.length===0)throw new E("positions must contain at least one element");let i=h.clone(t),o=h.clone(e.center),r=e.radius,s=n.length;if(h.equals(o,t))throw new E("occludeePosition must be different than occluderBoundingSphere.center");let a=h.normalize(h.subtract(i,o,CL),CL),l=-h.dot(a,o),u=tc._anyRotationVector(o,a,l),f=tc._horizonToPlaneNormalDotProduct(e,a,l,u,n[0]);if(!f)return;let d;for(let g=1;g<s;++g){if(d=tc._horizonToPlaneNormalDotProduct(e,a,l,u,n[g]),!d)return;d<f&&(f=d)}if(f<.0017453283658983088)return;let p=r/f;return h.add(o,h.multiplyByScalar(a,p,CL),CL)};var Zit=[];tc.computeOccludeePointFromRectangle=function(e,t){if(!c(e))throw new E("rectangle is required.");t=y(t,ie.default);let n=ae.subsample(e,t,0,Zit),i=ce.fromPoints(n),o=h.ZERO;if(!h.equals(o,i.center))return tc.computeOccludeePoint(new ce(o,t.minimumRadius),i.center,n)};var Jit=new h;tc._anyRotationVector=function(e,t,n){let i=h.abs(t,Jit),o=i.x>i.y?0:1;(o===0&&i.z>i.x||o===1&&i.z>i.y)&&(o=2);let r=new h,s;o===0?(i.x=e.x,i.y=e.y+1,i.z=e.z+1,s=h.UNIT_X):o===1?(i.x=e.x+1,i.y=e.y,i.z=e.z+1,s=h.UNIT_Y):(i.x=e.x+1,i.y=e.y+1,i.z=e.z,s=h.UNIT_Z);let a=(h.dot(t,i)+n)/-h.dot(t,s);return h.normalize(h.subtract(h.add(i,h.multiplyByScalar(s,a,r),i),e,i),i)};var Qit=new h;tc._rotationVector=function(e,t,n,i,o){let r=h.subtract(i,e,Qit);if(r=h.normalize(r,r),h.dot(t,r)<.9999999847691291){let s=h.cross(t,r,r);if(h.magnitude(s)>R.EPSILON13)return h.normalize(s,new h)}return o};var MW=new h,eot=new h,EL=new h,B_e=new h;tc._horizonToPlaneNormalDotProduct=function(e,t,n,i,o){let r=h.clone(o,MW),s=h.clone(e.center,eot),a=e.radius,l=h.subtract(s,r,EL),u=h.magnitudeSquared(l),f=a*a;if(u<f)return!1;let d=u-f,p=Math.sqrt(d),m=1/Math.sqrt(u),x=p*m*p;l=h.normalize(l,l);let T=h.add(r,h.multiplyByScalar(l,x,B_e),B_e),C=Math.sqrt(d-x*x),S=this._rotationVector(s,t,n,r,i),v=h.fromElements(S.x*S.x*l.x+(S.x*S.y-S.z)*l.y+(S.x*S.z+S.y)*l.z,(S.x*S.y+S.z)*l.x+S.y*S.y*l.y+(S.y*S.z-S.x)*l.z,(S.x*S.z-S.y)*l.x+(S.y*S.z+S.x)*l.y+S.z*S.z*l.z,MW);v=h.normalize(v,v);let D=h.multiplyByScalar(v,C,MW);S=h.normalize(h.subtract(h.add(T,D,EL),s,EL),EL);let I=h.dot(t,S);S=h.normalize(h.subtract(h.subtract(T,D,S),s,S),S);let L=h.dot(t,S);return I<L?I:L};var LW=tc;function NW(e,t,n){A.defined("url",e),A.defined("apiKey",t),c(n)&&A.typeOf.object("params",n),e=De.createIfNeeded(e),e.appendForwardSlash(),e.setQueryParameters({key:t}),this._url=e,this._params=y(n,{}),this._credit=new Pt('Geodata copyright <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors',!1)}Object.defineProperties(NW.prototype,{url:{get:function(){return this._url}},params:{get:function(){return this._params}},credit:{get:function(){return this._credit}}});NW.prototype.geocode=async function(e){return A.typeOf.string("query",e),this._url.getDerivedResource({url:"json",queryParameters:At(this._params,{q:e})}).fetchJson().then(function(n){return n.results.map(function(i){let o,r=i.bounds;if(c(r))o=ae.fromDegrees(r.southwest.lng,r.southwest.lat,r.northeast.lng,r.northeast.lat);else{let s=i.geometry.lat,a=i.geometry.lng;o=h.fromDegrees(s,a)}return{displayName:i.formatted,destination:o}})})};var tot=NW;var not={packedLength:void 0,pack:E.throwInstantiationError,unpack:E.throwInstantiationError},iot=not;var oot={packedInterpolationLength:void 0,convertPackedArrayForInterpolation:E.throwInstantiationError,unpackInterpolationResult:E.throwInstantiationError},rot=oot;var sot=new h;function aot(e,t,n,i){let o=CE(e,t,n,i,sot);return c(o)?o.x>0&&o.y>0&&o.z>0:!1}var cot=aot;function V_e(){E.throwInstantiationError()}V_e.prototype.getURL=E.throwInstantiationError;var lot=V_e;async function uot(e,t,n,i){return c(i)||(i=!1),A.typeOf.object("terrainProvider",e),A.typeOf.number("level",t),A.typeOf.bool("rejectOnTileFail",i),A.defined("positions",n),hot(e,t,n,i)}function fot(e,t,n){let i=e[0],o=i.terrainProvider.requestTileGeometry(i.x,i.y,i.level);if(!o)return!1;let r;return n?r=o.then(z_e(i)):r=o.then(z_e(i)).catch(mot(i)),e.shift(),t.push(r),!0}function dot(e){return new Promise(function(t){setTimeout(t,e)})}function FW(e,t,n){return e.length?fot(e,t,n)?FW(e,t,n):dot(100).then(()=>FW(e,t,n)):Promise.resolve()}function hot(e,t,n,i){let o=e.tilingScheme,r,s=[],a={};for(r=0;r<n.length;++r){let u=o.positionToTileXY(n[r],t);if(!c(u))continue;let f=u.toString();if(!a.hasOwnProperty(f)){let d={x:u.x,y:u.y,level:t,tilingScheme:o,terrainProvider:e,positions:[]};a[f]=d,s.push(d)}a[f].positions.push(n[r])}let l=[];return FW(s,l,i).then(function(){return Promise.all(l).then(function(){return n})})}function U_e(e,t,n){let i=t.interpolateHeight(n,e.longitude,e.latitude);return i===void 0?!1:(e.height=i,!0)}function z_e(e){let t=e.positions,n=e.tilingScheme.tileXYToRectangle(e.x,e.y,e.level);return function(i){let o=!1;for(let r=0;r<t.length;++r){let s=t[r];if(!U_e(s,i,n)){o=!0;break}}return o?i.createMesh({tilingScheme:e.tilingScheme,x:e.x,y:e.y,level:e.level,throttle:!1}).then(function(){for(let r=0;r<t.length;++r){let s=t[r];U_e(s,i,n)}}):Promise.resolve()}}function mot(e){let t=e.positions;return function(){for(let n=0;n<t.length;++n){let i=t[n];i.height=void 0}}}var BW=uot;var kW=new H;async function H_e(e,t,n){if(c(n)||(n=!1),!c(e))throw new E("terrainProvider is required.");if(!c(t))throw new E("positions is required.");let i=[],o=[],r=e.availability;if(!c(r))throw new E("sampleTerrainMostDetailed requires a terrain provider that has tile availability.");let s=[];for(let l=0;l<t.length;++l){let u=t[l],f=r.computeMaximumLevelAtPosition(u);if(o[l]=f,f===0){e.tilingScheme.positionToTileXY(u,1,kW);let p=e.loadTileDataAvailability(kW.x,kW.y,1);c(p)&&s.push(p)}let d=i[f];c(d)||(i[f]=d=[]),d.push(u)}await Promise.all(s),await Promise.all(i.map(function(l,u){if(c(l))return BW(e,u,l,n)}));let a=[];for(let l=0;l<t.length;++l){let u=t[l];r.computeMaximumLevelAtPosition(u)!==o[l]&&a.push(u)}return a.length>0&&await H_e(e,a,n),t}var fC=H_e;var pot={LEFT_DOWN:0,LEFT_UP:1,LEFT_CLICK:2,LEFT_DOUBLE_CLICK:3,RIGHT_DOWN:5,RIGHT_UP:6,RIGHT_CLICK:7,MIDDLE_DOWN:10,MIDDLE_UP:11,MIDDLE_CLICK:12,MOUSE_MOVE:15,WHEEL:16,PINCH_START:17,PINCH_END:18,PINCH_MOVE:19},bn=Object.freeze(pot);function ny(e,t,n){let i=e._element;if(i===document)return n.x=t.clientX,n.y=t.clientY,n;let o=i.getBoundingClientRect();return n.x=t.clientX-o.left,n.y=t.clientY-o.top,n}function jW(e,t){let n=e;return c(t)&&(n+=`+${t}`),n}function Bb(e){if(e.shiftKey)return Ca.SHIFT;if(e.ctrlKey)return Ca.CTRL;if(e.altKey)return Ca.ALT}var bs={LEFT:0,MIDDLE:1,RIGHT:2};function fu(e,t,n,i){function o(r){i(e,r)}zt.isInternetExplorer()?n.addEventListener(t,o,!1):n.addEventListener(t,o,{capture:!1,passive:!1}),e._removalFunctions.push(function(){n.removeEventListener(t,o,!1)})}function _ot(e){let t=e._element,n=c(t.disableRootEvents)?t:document;zt.supportsPointerEvents()?(fu(e,"pointerdown",t,Aot),fu(e,"pointerup",t,J_e),fu(e,"pointermove",t,Cot),fu(e,"pointercancel",t,J_e)):(fu(e,"mousedown",t,Q_e),fu(e,"mouseup",n,ege),fu(e,"mousemove",n,tge),fu(e,"touchstart",t,xot),fu(e,"touchend",n,Y_e),fu(e,"touchmove",n,Tot),fu(e,"touchcancel",n,Y_e)),fu(e,"dblclick",t,yot);let i;"onwheel"in t?i="wheel":document.onmousewheel!==void 0?i="mousewheel":i="DOMMouseScroll",fu(e,i,t,bot)}function got(e){let t=e._removalFunctions;for(let n=0;n<t.length;++n)t[n]()}var G_e={position:new H};function WW(e){e._lastSeenTouchEvent=Ei()}function qW(e){return Ei()-e._lastSeenTouchEvent>Bd.mouseEmulationIgnoreMilliseconds}function GW(e,t,n){let i=e.x-t.x,o=e.y-t.y;return Math.sqrt(i*i+o*o)<n}function Q_e(e,t){if(!qW(e))return;let n=t.button;e._buttonDown[n]=!0;let i;if(n===bs.LEFT)i=bn.LEFT_DOWN;else if(n===bs.MIDDLE)i=bn.MIDDLE_DOWN;else if(n===bs.RIGHT)i=bn.RIGHT_DOWN;else return;let o=ny(e,t,e._primaryPosition);H.clone(o,e._primaryStartPosition),H.clone(o,e._primaryPreviousPosition);let r=Bb(t),s=e.getInputAction(i,r);c(s)&&(H.clone(o,G_e.position),s(G_e),t.preventDefault())}var j_e={position:new H},W_e={position:new H};function VW(e,t,n,i){let o=Bb(i),r=e.getInputAction(t,o),s=e.getInputAction(n,o);if(c(r)||c(s)){let a=ny(e,i,e._primaryPosition);if(c(r)&&(H.clone(a,j_e.position),r(j_e)),c(s)){let l=e._primaryStartPosition;GW(l,a,e._clickPixelTolerance)&&(H.clone(a,W_e.position),s(W_e))}}}function ege(e,t){if(!qW(e))return;let n=t.button;n!==bs.LEFT&&n!==bs.MIDDLE&&n!==bs.RIGHT||(e._buttonDown[bs.LEFT]&&(VW(e,bn.LEFT_UP,bn.LEFT_CLICK,t),e._buttonDown[bs.LEFT]=!1),e._buttonDown[bs.MIDDLE]&&(VW(e,bn.MIDDLE_UP,bn.MIDDLE_CLICK,t),e._buttonDown[bs.MIDDLE]=!1),e._buttonDown[bs.RIGHT]&&(VW(e,bn.RIGHT_UP,bn.RIGHT_CLICK,t),e._buttonDown[bs.RIGHT]=!1))}var UW={startPosition:new H,endPosition:new H};function tge(e,t){if(!qW(e))return;let n=Bb(t),i=ny(e,t,e._primaryPosition),o=e._primaryPreviousPosition,r=e.getInputAction(bn.MOUSE_MOVE,n);c(r)&&(H.clone(o,UW.startPosition),H.clone(i,UW.endPosition),r(UW)),H.clone(i,o),(e._buttonDown[bs.LEFT]||e._buttonDown[bs.MIDDLE]||e._buttonDown[bs.RIGHT])&&t.preventDefault()}var q_e={position:new H};function yot(e,t){let n=t.button,i;if(n===bs.LEFT)i=bn.LEFT_DOUBLE_CLICK;else return;let o=Bb(t),r=e.getInputAction(i,o);c(r)&&(ny(e,t,q_e.position),r(q_e))}function bot(e,t){let n;if(c(t.deltaY)){let r=t.deltaMode;r===t.DOM_DELTA_PIXEL?n=-t.deltaY:r===t.DOM_DELTA_LINE?n=-t.deltaY*40:n=-t.deltaY*120}else t.detail>0?n=t.detail*-120:n=t.wheelDelta;if(!c(n))return;let i=Bb(t),o=e.getInputAction(bn.WHEEL,i);c(o)&&(o(n),t.preventDefault())}function xot(e,t){WW(e);let n=t.changedTouches,i,o=n.length,r,s,a=e._positions;for(i=0;i<o;++i)r=n[i],s=r.identifier,a.set(s,ny(e,r,new H));SL(e,t);let l=e._previousPositions;for(i=0;i<o;++i)r=n[i],s=r.identifier,l.set(s,H.clone(a.get(s)))}function Y_e(e,t){WW(e);let n=t.changedTouches,i,o=n.length,r,s,a=e._positions;for(i=0;i<o;++i)r=n[i],s=r.identifier,a.remove(s);SL(e,t);let l=e._previousPositions;for(i=0;i<o;++i)r=n[i],s=r.identifier,l.remove(s)}var X_e={position:new H},zW={position1:new H,position2:new H},K_e={position:new H},$_e={position:new H},Z_e={position:new H};function SL(e,t){let n=Bb(t),i=e._positions,o=i.length,r,s,a=e._isPinching;if(o!==1&&e._buttonDown[bs.LEFT]){if(e._buttonDown[bs.LEFT]=!1,c(e._touchHoldTimer)&&(clearTimeout(e._touchHoldTimer),e._touchHoldTimer=void 0),r=e.getInputAction(bn.LEFT_UP,n),c(r)&&(H.clone(e._primaryPosition,K_e.position),r(K_e)),o===0&&!e._isTouchHolding&&(s=e.getInputAction(bn.LEFT_CLICK,n),c(s))){let l=e._primaryStartPosition,u=e._previousPositions.values[0];GW(l,u,e._clickPixelTolerance)&&(H.clone(e._primaryPosition,$_e.position),s($_e))}e._isTouchHolding=!1}if(o===0&&a&&(e._isPinching=!1,r=e.getInputAction(bn.PINCH_END,n),c(r)&&r()),o===1&&!a){let l=i.values[0];H.clone(l,e._primaryPosition),H.clone(l,e._primaryStartPosition),H.clone(l,e._primaryPreviousPosition),e._buttonDown[bs.LEFT]=!0,r=e.getInputAction(bn.LEFT_DOWN,n),c(r)&&(H.clone(l,X_e.position),r(X_e)),e._touchHoldTimer=setTimeout(function(){if(!e.isDestroyed()&&(e._touchHoldTimer=void 0,e._isTouchHolding=!0,s=e.getInputAction(bn.RIGHT_CLICK,n),c(s))){let u=e._primaryStartPosition,f=e._previousPositions.values[0];GW(u,f,e._holdPixelTolerance)&&(H.clone(e._primaryPosition,Z_e.position),s(Z_e))}},Bd.touchHoldDelayMilliseconds),t.preventDefault()}o===2&&!a&&(e._isPinching=!0,r=e.getInputAction(bn.PINCH_START,n),c(r)&&(H.clone(i.values[0],zW.position1),H.clone(i.values[1],zW.position2),r(zW),t.preventDefault()))}function Tot(e,t){WW(e);let n=t.changedTouches,i,o=n.length,r,s,a=e._positions;for(i=0;i<o;++i){r=n[i],s=r.identifier;let u=a.get(s);c(u)&&ny(e,r,u)}nge(e,t);let l=e._previousPositions;for(i=0;i<o;++i)r=n[i],s=r.identifier,H.clone(a.get(s),l.get(s))}var HW={startPosition:new H,endPosition:new H},ED={distance:{startPosition:new H,endPosition:new H},angleAndHeight:{startPosition:new H,endPosition:new H}};function nge(e,t){let n=Bb(t),i=e._positions,o=e._previousPositions,r=i.length,s;if(r===1&&e._buttonDown[bs.LEFT]){let a=i.values[0];H.clone(a,e._primaryPosition);let l=e._primaryPreviousPosition;s=e.getInputAction(bn.MOUSE_MOVE,n),c(s)&&(H.clone(l,HW.startPosition),H.clone(a,HW.endPosition),s(HW)),H.clone(a,l),t.preventDefault()}else if(r===2&&e._isPinching&&(s=e.getInputAction(bn.PINCH_MOVE,n),c(s))){let a=i.values[0],l=i.values[1],u=o.values[0],f=o.values[1],d=l.x-a.x,p=l.y-a.y,g=Math.sqrt(d*d+p*p)*.25,m=f.x-u.x,b=f.y-u.y,x=Math.sqrt(m*m+b*b)*.25,T=(l.y+a.y)*.125,C=(f.y+u.y)*.125,S=Math.atan2(p,d),v=Math.atan2(b,m);H.fromElements(0,x,ED.distance.startPosition),H.fromElements(0,g,ED.distance.endPosition),H.fromElements(v,C,ED.angleAndHeight.startPosition),H.fromElements(S,T,ED.angleAndHeight.endPosition),s(ED)}}function Aot(e,t){if(t.target.setPointerCapture(t.pointerId),t.pointerType==="touch"){let n=e._positions,i=t.pointerId;n.set(i,ny(e,t,new H)),SL(e,t),e._previousPositions.set(i,H.clone(n.get(i)))}else Q_e(e,t)}function J_e(e,t){if(t.pointerType==="touch"){let n=e._positions,i=t.pointerId;n.remove(i),SL(e,t),e._previousPositions.remove(i)}else ege(e,t)}function Cot(e,t){if(t.pointerType==="touch"){let n=e._positions,i=t.pointerId,o=n.get(i);if(!c(o))return;ny(e,t,o),nge(e,t);let r=e._previousPositions;H.clone(n.get(i),r.get(i))}else tge(e,t)}function Bd(e){this._inputEvents={},this._buttonDown={LEFT:!1,MIDDLE:!1,RIGHT:!1},this._isPinching=!1,this._isTouchHolding=!1,this._lastSeenTouchEvent=-Bd.mouseEmulationIgnoreMilliseconds,this._primaryStartPosition=new H,this._primaryPosition=new H,this._primaryPreviousPosition=new H,this._positions=new St,this._previousPositions=new St,this._removalFunctions=[],this._touchHoldTimer=void 0,this._clickPixelTolerance=5,this._holdPixelTolerance=25,this._element=y(e,document),_ot(this)}Bd.prototype.setInputAction=function(e,t,n){if(!c(e))throw new E("action is required.");if(!c(t))throw new E("type is required.");let i=jW(t,n);this._inputEvents[i]=e};Bd.prototype.getInputAction=function(e,t){if(!c(e))throw new E("type is required.");let n=jW(e,t);return this._inputEvents[n]};Bd.prototype.removeInputAction=function(e,t){if(!c(e))throw new E("type is required.");let n=jW(e,t);delete this._inputEvents[n]};Bd.prototype.isDestroyed=function(){return!1};Bd.prototype.destroy=function(){return got(this),de(this)};Bd.mouseEmulationIgnoreMilliseconds=800;Bd.touchHoldDelayMilliseconds=1500;var Af=Bd;var YW={};function Eot(e){let t=6.239996+.0172019696544*e;return .001657*Math.sin(t+.01671*Math.sin(t))}var Sot=32.184,wot=2451545;function Age(e,t){t=J.addSeconds(e,Sot,t);let n=J.totalDays(t)-wot;return t=J.addSeconds(t,Eot(n),t),t}var wL=new J(2451545,0,Wn.TAI),vot=1e3,Cf=R.RADIANS_PER_DEGREE,du=R.RADIANS_PER_ARCSECOND,Ea=14959787e4,ige=new Q;function Cge(e,t,n,i,o,r,s){if(n<0&&(n=-n,o+=R.PI),n<0||n>R.PI)throw new E("The inclination is out of range. Inclination must be greater than or equal to zero and less than or equal to Pi radians.");let a=e*(1-t),l=i-o,u=o,f=Pot(r-i,t);if(Dot(t,0)==="Hyperbolic"&&Math.abs(R.negativePiToPi(f))>=Math.acos(-1/t))throw new E("The true anomaly of the hyperbolic orbit lies outside of the bounds of the hyperbola.");Mot(l,n,u,ige);let p=a*(1+t),g=Math.cos(f),m=Math.sin(f),b=1+t*g;if(b<=R.Epsilon10)throw new E("elements cannot be converted to cartesian");let x=p/b;return c(s)?(s.x=x*g,s.y=x*m,s.z=0):s=new h(x*g,x*m,0),Q.multiplyByVector(ige,s,s)}function Dot(e,t){if(e<0)throw new E("eccentricity cannot be negative.");return e<=t?"Circular":e<1-t?"Elliptical":e<=1+t?"Parabolic":"Hyperbolic"}function Pot(e,t){if(t<0||t>=1)throw new E("eccentricity out of range.");let n=Oot(e,t);return Rot(n,t)}var oge=50,Iot=R.EPSILON8;function Oot(e,t){if(t<0||t>=1)throw new E("eccentricity out of range.");let n=Math.floor(e/R.TWO_PI);e-=n*R.TWO_PI;let i=e+t*Math.sin(e)/(1-Math.sin(e+t)+Math.sin(e)),o=Number.MAX_VALUE,r;for(r=0;r<oge&&Math.abs(o-i)>Iot;++r){o=i;let s=o-t*Math.sin(o)-e,a=1-t*Math.cos(o);i=o-s/a}if(r>=oge)throw new E("Kepler equation did not converge");return o=i+n*R.TWO_PI,o}function Rot(e,t){if(t<0||t>=1)throw new E("eccentricity out of range.");let n=Math.floor(e/R.TWO_PI);e-=n*R.TWO_PI;let i=Math.cos(e)-t,o=Math.sin(e)*Math.sqrt(1-t*t),r=Math.atan2(o,i);return r=R.zeroToTwoPi(r),e<0&&(r-=R.TWO_PI),r+=n*R.TWO_PI,r}function Mot(e,t,n,i){if(t<0||t>R.PI)throw new E("inclination out of range");let o=Math.cos(e),r=Math.sin(e),s=Math.cos(t),a=Math.sin(t),l=Math.cos(n),u=Math.sin(n);return c(i)?(i[0]=l*o-u*r*s,i[1]=u*o+l*r*s,i[2]=r*a,i[3]=-l*r-u*o*s,i[4]=-u*r+l*o*s,i[5]=o*a,i[6]=u*a,i[7]=-l*a,i[8]=s):i=new Q(l*o-u*r*s,-l*r-u*o*s,u*a,u*o+l*r*s,-u*r+l*o*s,-l*a,r*a,o*a,s),i}var Lot=1.0000010178*Ea,Not=100.46645683*Cf,Fot=129597742283429e-5*du,rge=16002,sge=21863,age=32004,cge=10931,lge=14529,uge=16368,fge=15318,dge=32794,Bot=64*1e-7*Ea,kot=-152*1e-7*Ea,Vot=62*1e-7*Ea,Uot=-8*1e-7*Ea,zot=32*1e-7*Ea,Hot=-41*1e-7*Ea,Got=19*1e-7*Ea,jot=-11*1e-7*Ea,Wot=-150*1e-7*Ea,qot=-46*1e-7*Ea,Yot=68*1e-7*Ea,Xot=54*1e-7*Ea,Kot=14*1e-7*Ea,$ot=24*1e-7*Ea,Zot=-28*1e-7*Ea,Jot=22*1e-7*Ea,hge=10,mge=16002,pge=21863,_ge=10931,gge=1473,yge=32004,bge=4387,xge=73,Qot=-325*1e-7,ert=-322*1e-7,trt=-79*1e-7,nrt=232*1e-7,irt=-52*1e-7,ort=97*1e-7,rrt=55*1e-7,srt=-41*1e-7,art=-105*1e-7,crt=-137*1e-7,lrt=258*1e-7,urt=35*1e-7,frt=-116*1e-7,drt=-88*1e-7,hrt=-112*1e-7,mrt=-80*1e-7,dC=new J(0,0,Wn.TAI);function prt(e,t){Age(e,dC);let i=(dC.dayNumber-wL.dayNumber+(dC.secondsOfDay-wL.secondsOfDay)/qn.SECONDS_PER_DAY)/(qn.DAYS_PER_JULIAN_CENTURY*10),o=.3595362*i,r=Lot+Bot*Math.cos(rge*o)+Wot*Math.sin(rge*o)+kot*Math.cos(sge*o)+qot*Math.sin(sge*o)+Vot*Math.cos(age*o)+Yot*Math.sin(age*o)+Uot*Math.cos(cge*o)+Xot*Math.sin(cge*o)+zot*Math.cos(lge*o)+Kot*Math.sin(lge*o)+Hot*Math.cos(uge*o)+$ot*Math.sin(uge*o)+Got*Math.cos(fge*o)+Zot*Math.sin(fge*o)+jot*Math.cos(dge*o)+Jot*Math.sin(dge*o),s=Not+Fot*i+Qot*Math.cos(hge*o)+art*Math.sin(hge*o)+ert*Math.cos(mge*o)+crt*Math.sin(mge*o)+trt*Math.cos(pge*o)+lrt*Math.sin(pge*o)+nrt*Math.cos(_ge*o)+urt*Math.sin(_ge*o)+irt*Math.cos(gge*o)+frt*Math.sin(gge*o)+ort*Math.cos(yge*o)+drt*Math.sin(yge*o)+rrt*Math.cos(bge*o)+hrt*Math.sin(bge*o)+srt*Math.cos(xge*o)+mrt*Math.sin(xge*o),a=.0167086342-.0004203654*i,l=102.93734808*Cf+11612.3529*du*i,u=469.97289*du*i,f=174.87317577*Cf-8679.27034*du*i;return Cge(r,a,u,l,f,s,t)}function Ege(e,t){Age(e,dC);let i=(dC.dayNumber-wL.dayNumber+(dC.secondsOfDay-wL.secondsOfDay)/qn.SECONDS_PER_DAY)/qn.DAYS_PER_JULIAN_CENTURY,o=i*i,r=o*i,s=r*i,a=383397.7725+.004*i,l=.055545526-16e-9*i,u=5.15668983*Cf,f=-8e-5*i+.02966*o-42e-6*r-13e-8*s,d=83.35324312*Cf,p=146434202669e-4*i-38.2702*o-.045047*r+21301e-8*s,g=125.04455501*Cf,m=-69679193631e-4*i+6.3602*o+.007625*r-3586e-8*s,b=218.31664563*Cf,x=17325593434847e-4*i-6.391*o+.006588*r-3169e-8*s,T=297.85019547*Cf+du*(1602961601209e-3*i-6.3706*o+.006593*r-3169e-8*s),C=93.27209062*Cf+du*(17395272628478e-4*i-12.7512*o-.001037*r+417e-8*s),S=134.96340251*Cf+du*(17179159232178e-4*i+31.8792*o+.051635*r-2447e-7*s),v=357.52910918*Cf+du*(1295965810481e-4*i-.5532*o+136e-6*r-1149e-8*s),D=310.17137918*Cf-du*(6967051436e-3*i+6.2068*o+.007618*r-3219e-8*s),I=2*T,L=4*T,M=6*T,N=2*S,B=3*S,_=4*S,w=2*C;a+=3400.4*Math.cos(I)-635.6*Math.cos(I-S)-235.6*Math.cos(S)+218.1*Math.cos(I-v)+181*Math.cos(I+S),l+=.014216*Math.cos(I-S)+.008551*Math.cos(I-N)-.001383*Math.cos(S)+.001356*Math.cos(I+S)-.001147*Math.cos(L-B)-914e-6*Math.cos(L-N)+869e-6*Math.cos(I-v-S)-627e-6*Math.cos(I)-394e-6*Math.cos(L-_)+282e-6*Math.cos(I-v-N)-279e-6*Math.cos(T-S)-236e-6*Math.cos(N)+231e-6*Math.cos(L)+229e-6*Math.cos(M-_)-201e-6*Math.cos(N-w),f+=486.26*Math.cos(I-w)-40.13*Math.cos(I)+37.51*Math.cos(w)+25.73*Math.cos(N-w)+19.97*Math.cos(I-v-w),p+=-55609*Math.sin(I-S)-34711*Math.sin(I-N)-9792*Math.sin(S)+9385*Math.sin(L-B)+7505*Math.sin(L-N)+5318*Math.sin(I+S)+3484*Math.sin(L-_)-3417*Math.sin(I-v-S)-2530*Math.sin(M-_)-2376*Math.sin(I)-2075*Math.sin(I-B)-1883*Math.sin(N)-1736*Math.sin(M-5*S)+1626*Math.sin(v)-1370*Math.sin(M-B),m+=-5392*Math.sin(I-w)-540*Math.sin(v)-441*Math.sin(I)+423*Math.sin(w)-288*Math.sin(N-w),x+=-3332.9*Math.sin(I)+1197.4*Math.sin(I-S)-662.5*Math.sin(v)+396.3*Math.sin(S)-218*Math.sin(I-v);let P=2*D,O=3*D;f+=46.997*Math.cos(D)*i-.614*Math.cos(I-w+D)*i+.614*Math.cos(I-w-D)*i-.0297*Math.cos(P)*o-.0335*Math.cos(D)*o+.0012*Math.cos(I-w+P)*o-16e-5*Math.cos(D)*r+4e-5*Math.cos(O)*r+4e-5*Math.cos(P)*r;let F=2.116*Math.sin(D)*i-.111*Math.sin(I-w-D)*i-.0015*Math.sin(D)*o;p+=F,x+=F,m+=-520.77*Math.sin(D)*i+13.66*Math.sin(I-w+D)*i+1.12*Math.sin(I-D)*i-1.06*Math.sin(w-D)*i+.66*Math.sin(P)*o+.371*Math.sin(D)*o-.035*Math.sin(I-w+P)*o-.015*Math.sin(I-w+D)*o+.0014*Math.sin(D)*r-.0011*Math.sin(O)*r-9e-4*Math.sin(P)*r,a*=vot;let V=u+f*du,G=d+p*du,z=b+x*du,W=g+m*du;return Cge(a,l,V,G,W,z,t)}var Tge=.012300034,_rt=Tge/(Tge+1)*-1;function grt(e,t){return t=Ege(e,t),h.multiplyByScalar(t,_rt,t)}var Sge=new Q(1.0000000000000002,5619723173785822e-31,4690511510146299e-34,-5154129427414611e-31,.9174820620691819,-.39777715593191376,-223970096136568e-30,.39777715593191376,.9174820620691819),SD=new h;YW.computeSunPositionInEarthInertialFrame=function(e,t){return c(e)||(e=J.now()),c(t)||(t=new h),SD=prt(e,SD),t=h.negate(SD,t),grt(e,SD),h.subtract(t,SD,t),Q.multiplyByVector(Sge,t,t),t};YW.computeMoonPositionInEarthInertialFrame=function(e,t){return c(e)||(e=J.now()),t=Ege(e,t),Q.multiplyByVector(Sge,t,t),t};var hC=YW;function yrt(e,t,n,i,o,r,s){let a=Bi.numberOfPoints(e,t,o),l,u=n.red,f=n.green,d=n.blue,p=n.alpha,g=i.red,m=i.green,b=i.blue,x=i.alpha;if(j.equals(n,i)){for(l=0;l<a;l++)r[s++]=j.floatToByte(u),r[s++]=j.floatToByte(f),r[s++]=j.floatToByte(d),r[s++]=j.floatToByte(p);return s}let T=(g-u)/a,C=(m-f)/a,S=(b-d)/a,v=(x-p)/a,D=s;for(l=0;l<a;l++)r[D++]=j.floatToByte(u+l*T),r[D++]=j.floatToByte(f+l*C),r[D++]=j.floatToByte(d+l*S),r[D++]=j.floatToByte(p+l*v);return D}function wD(e){e=y(e,y.EMPTY_OBJECT);let t=e.positions,n=e.colors,i=y(e.colorsPerVertex,!1);if(!c(t)||t.length<2)throw new E("At least two positions are required.");if(c(n)&&(i&&n.length<t.length||!i&&n.length<t.length-1))throw new E("colors has an invalid length.");this._positions=t,this._colors=n,this._colorsPerVertex=i,this._arcType=y(e.arcType,Yt.GEODESIC),this._granularity=y(e.granularity,R.RADIANS_PER_DEGREE),this._ellipsoid=y(e.ellipsoid,ie.default),this._workerName="createSimplePolylineGeometry";let o=1+t.length*h.packedLength;o+=c(n)?1+n.length*j.packedLength:1,this.packedLength=o+ie.packedLength+3}wD.pack=function(e,t,n){if(!c(e))throw new E("value is required");if(!c(t))throw new E("array is required");n=y(n,0);let i,o=e._positions,r=o.length;for(t[n++]=r,i=0;i<r;++i,n+=h.packedLength)h.pack(o[i],t,n);let s=e._colors;for(r=c(s)?s.length:0,t[n++]=r,i=0;i<r;++i,n+=j.packedLength)j.pack(s[i],t,n);return ie.pack(e._ellipsoid,t,n),n+=ie.packedLength,t[n++]=e._colorsPerVertex?1:0,t[n++]=e._arcType,t[n]=e._granularity,t};wD.unpack=function(e,t,n){if(!c(e))throw new E("array is required");t=y(t,0);let i,o=e[t++],r=new Array(o);for(i=0;i<o;++i,t+=h.packedLength)r[i]=h.unpack(e,t);o=e[t++];let s=o>0?new Array(o):void 0;for(i=0;i<o;++i,t+=j.packedLength)s[i]=j.unpack(e,t);let a=ie.unpack(e,t);t+=ie.packedLength;let l=e[t++]===1,u=e[t++],f=e[t];return c(n)?(n._positions=r,n._colors=s,n._ellipsoid=a,n._colorsPerVertex=l,n._arcType=u,n._granularity=f,n):new wD({positions:r,colors:s,ellipsoid:a,colorsPerVertex:l,arcType:u,granularity:f})};var vL=new Array(2),DL=new Array(2),brt={positions:vL,height:DL,ellipsoid:void 0,minDistance:void 0,granularity:void 0};wD.createGeometry=function(e){let t=e._positions,n=e._colors,i=e._colorsPerVertex,o=e._arcType,r=e._granularity,s=e._ellipsoid,a=R.chordLength(r,s.maximumRadius),l=c(n)&&!i,u,f=t.length,d,p,g,m,b=0;if(o===Yt.GEODESIC||o===Yt.RHUMB){let v,D,I;o===Yt.GEODESIC?(v=R.chordLength(r,s.maximumRadius),D=Bi.numberOfPoints,I=Bi.generateArc):(v=r,D=Bi.numberOfPointsRhumbLine,I=Bi.generateRhumbArc);let L=Bi.extractHeights(t,s),M=brt;if(o===Yt.GEODESIC?M.minDistance=a:M.granularity=r,M.ellipsoid=s,l){let N=0;for(u=0;u<f-1;u++)N+=D(t[u],t[u+1],v)+1;d=new Float64Array(N*3),g=new Uint8Array(N*4),M.positions=vL,M.height=DL;let B=0;for(u=0;u<f-1;++u){vL[0]=t[u],vL[1]=t[u+1],DL[0]=L[u],DL[1]=L[u+1];let _=I(M);if(c(n)){let w=_.length/3;m=n[u];for(let P=0;P<w;++P)g[B++]=j.floatToByte(m.red),g[B++]=j.floatToByte(m.green),g[B++]=j.floatToByte(m.blue),g[B++]=j.floatToByte(m.alpha)}d.set(_,b),b+=_.length}}else if(M.positions=t,M.height=L,d=new Float64Array(I(M)),c(n)){for(g=new Uint8Array(d.length/3*4),u=0;u<f-1;++u){let B=t[u],_=t[u+1],w=n[u],P=n[u+1];b=yrt(B,_,w,P,a,g,b)}let N=n[f-1];g[b++]=j.floatToByte(N.red),g[b++]=j.floatToByte(N.green),g[b++]=j.floatToByte(N.blue),g[b++]=j.floatToByte(N.alpha)}}else{p=l?f*2-2:f,d=new Float64Array(p*3),g=c(n)?new Uint8Array(p*4):void 0;let v=0,D=0;for(u=0;u<f;++u){let I=t[u];if(l&&u>0&&(h.pack(I,d,v),v+=3,m=n[u-1],g[D++]=j.floatToByte(m.red),g[D++]=j.floatToByte(m.green),g[D++]=j.floatToByte(m.blue),g[D++]=j.floatToByte(m.alpha)),l&&u===f-1)break;h.pack(I,d,v),v+=3,c(n)&&(m=n[u],g[D++]=j.floatToByte(m.red),g[D++]=j.floatToByte(m.green),g[D++]=j.floatToByte(m.blue),g[D++]=j.floatToByte(m.alpha))}}let x=new pn;x.position=new we({componentDatatype:$.DOUBLE,componentsPerAttribute:3,values:d}),c(n)&&(x.color=new we({componentDatatype:$.UNSIGNED_BYTE,componentsPerAttribute:4,values:g,normalize:!0})),p=d.length/3;let T=(p-1)*2,C=Fe.createTypedArray(p,T),S=0;for(u=0;u<p-1;++u)C[S++]=u,C[S++]=u+1;return new ut({attributes:x,indices:C,primitiveType:Me.LINES,boundingSphere:ce.fromPoints(t)})};var xrt=wD;function mC(e){let t=y(e.radius,1),i={radii:new h(t,t,t),stackPartitions:e.stackPartitions,slicePartitions:e.slicePartitions,vertexFormat:e.vertexFormat};this._ellipsoidGeometry=new ga(i),this._workerName="createSphereGeometry"}mC.packedLength=ga.packedLength;mC.pack=function(e,t,n){return A.typeOf.object("value",e),ga.pack(e._ellipsoidGeometry,t,n)};var Trt=new ga,iy={radius:void 0,radii:new h,vertexFormat:new Ie,stackPartitions:void 0,slicePartitions:void 0};mC.unpack=function(e,t,n){let i=ga.unpack(e,t,Trt);return iy.vertexFormat=Ie.clone(i._vertexFormat,iy.vertexFormat),iy.stackPartitions=i._stackPartitions,iy.slicePartitions=i._slicePartitions,c(n)?(h.clone(i._radii,iy.radii),n._ellipsoidGeometry=new ga(iy),n):(iy.radius=i._radii.x,new mC(iy))};mC.createGeometry=function(e){return ga.createGeometry(e._ellipsoidGeometry)};var Art=mC;function Crt(e){return A.defined("value",e),e<=.04045?e*.07739938080495357:Math.pow((e+.055)*.9478672985781991,2.4)}var vD=Crt;var Ert={WEST:0,NORTH:1,EAST:2,SOUTH:3,NORTHWEST:4,NORTHEAST:5,SOUTHWEST:6,SOUTHEAST:7},xn=Ert;function oy(e){throw new E("This type should not be instantiated directly.  Instead, use WebMercatorTilingScheme or GeographicTilingScheme.")}Object.defineProperties(oy.prototype,{ellipsoid:{get:E.throwInstantiationError},rectangle:{get:E.throwInstantiationError},projection:{get:E.throwInstantiationError}});oy.prototype.getNumberOfXTilesAtLevel=E.throwInstantiationError;oy.prototype.getNumberOfYTilesAtLevel=E.throwInstantiationError;oy.prototype.rectangleToNativeRectangle=E.throwInstantiationError;oy.prototype.tileXYToNativeRectangle=E.throwInstantiationError;oy.prototype.tileXYToRectangle=E.throwInstantiationError;oy.prototype.positionToTileXY=E.throwInstantiationError;var Srt=oy;function kb(e){e=y(e,y.EMPTY_OBJECT),this._clock=void 0,this._element=void 0,this._clockSubscription=void 0,this._seekFunction=void 0,this._lastPlaybackRate=void 0,this.clock=e.clock,this.element=e.element,this.epoch=y(e.epoch,je.MINIMUM_VALUE),this.tolerance=y(e.tolerance,1),this._seeking=!1,this._seekFunction=void 0,this._firstTickAfterSeek=!1}Object.defineProperties(kb.prototype,{clock:{get:function(){return this._clock},set:function(e){let t=this._clock;t!==e&&(c(t)&&(this._clockSubscription(),this._clockSubscription=void 0),c(e)&&(this._clockSubscription=e.onTick.addEventListener(kb.prototype._onTick,this)),this._clock=e)}},element:{get:function(){return this._element},set:function(e){let t=this._element;t!==e&&(c(t)&&t.removeEventListener("seeked",this._seekFunction,!1),c(e)&&(this._seeking=!1,this._seekFunction=wrt(this),e.addEventListener("seeked",this._seekFunction,!1)),this._element=e,this._seeking=!1,this._firstTickAfterSeek=!1)}}});kb.prototype.destroy=function(){return this.element=void 0,this.clock=void 0,de(this)};kb.prototype.isDestroyed=function(){return!1};kb.prototype._trySetPlaybackRate=function(e){if(this._lastPlaybackRate===e.multiplier)return;let t=this._element;try{t.playbackRate=e.multiplier}catch{t.playbackRate=0}this._lastPlaybackRate=e.multiplier};kb.prototype._onTick=function(e){let t=this._element;if(!c(t)||t.readyState<2)return;let n=t.paused,i=e.shouldAnimate;if(i===n&&(i?t.play():t.pause()),this._seeking||this._firstTickAfterSeek){this._firstTickAfterSeek=!1;return}this._trySetPlaybackRate(e);let o=e.currentTime,r=y(this.epoch,je.MINIMUM_VALUE),s=J.secondsDifference(o,r),a=t.duration,l,u=t.currentTime;t.loop?(s=s%a,s<0&&(s=a-s),l=s):s>a?l=a:s<0?l=0:l=s;let f=i?y(this.tolerance,1):.001;Math.abs(l-u)>f&&(this._seeking=!0,t.currentTime=l)};function wrt(e){return function(){e._seeking=!1,e._firstTickAfterSeek=!0}}var vrt=kb;function Drt(e,t){this.rectangle=e,this.maxLevel=t}function wge(e){this.ellipsoid=y(e.ellipsoid,ie.default),this.tilingScheme=void 0,this.heightmapWidth=void 0,this.heightmapHeight=void 0,this.levelZeroMaximumGeometricError=void 0,this.rectangles=[]}wge.prototype.build=function(e){e._tilingScheme=this.tilingScheme,e._heightmapWidth=this.heightmapWidth,e._heightmapHeight=this.heightmapHeight,e._levelZeroMaximumGeometricError=this.levelZeroMaximumGeometricError,e._rectangles=this.rectangles};function Prt(e,t){let n=t.getElementsByTagName("SRS")[0].textContent;if(n==="EPSG:4326")e.tilingScheme=new $i({ellipsoid:e.ellipsoid});else throw new ue(`SRS ${n} is not supported`);let i=t.getElementsByTagName("TileFormat")[0];e.heightmapWidth=parseInt(i.getAttribute("width"),10),e.heightmapHeight=parseInt(i.getAttribute("height"),10),e.levelZeroMaximumGeometricError=gs.getEstimatedLevelZeroGeometricErrorForAHeightmap(e.ellipsoid,Math.min(e.heightmapWidth,e.heightmapHeight),e.tilingScheme.getNumberOfXTilesAtLevel(0));let o=t.getElementsByTagName("DataExtent");for(let r=0;r<o.length;++r){let s=o[r],a=R.toRadians(parseFloat(s.getAttribute("minx"))),l=R.toRadians(parseFloat(s.getAttribute("miny"))),u=R.toRadians(parseFloat(s.getAttribute("maxx"))),f=R.toRadians(parseFloat(s.getAttribute("maxy"))),d=parseInt(s.getAttribute("maxlevel"),10);e.rectangles.push(new Drt(new ae(a,l,u,f),d))}}function Irt(e,t,n){let i=`An error occurred while accessing ${e.url}`;throw c(t)&&c(t.message)&&(i=`${i}: ${t.message}`),No.reportError(void 0,n,c(n)?n._errorEvent:void 0,i),new ue(i)}async function Ort(e,t,n){try{let i=await t.fetchXML();Prt(e,i)}catch(i){Irt(t,i,n)}}function ry(e){e=y(e,y.EMPTY_OBJECT),this._errorEvent=new pe,this._terrainDataStructure={heightScale:1/1e3,heightOffset:-1e3,elementsPerHeight:3,stride:4,elementMultiplier:256,isBigEndian:!0,lowestEncodedHeight:0,highestEncodedHeight:256*256*256-1};let t=e.credit;typeof t=="string"&&(t=new Pt(t)),this._credit=t,this._tilingScheme=void 0,this._rectangles=[]}Object.defineProperties(ry.prototype,{errorEvent:{get:function(){return this._errorEvent}},credit:{get:function(){return this._credit}},tilingScheme:{get:function(){return this._tilingScheme}},hasWaterMask:{get:function(){return!1}},hasVertexNormals:{get:function(){return!1}},availability:{get:function(){}}});ry.fromUrl=async function(e,t){A.defined("url",e),t=y(t,y.EMPTY_OBJECT);let n=new wge(t),i=De.createIfNeeded(e);await Ort(n,i);let o=new ry(t);return n.build(o),o._resource=i,o};ry.prototype.requestTileGeometry=function(e,t,n,i){let o=this._tilingScheme.getNumberOfYTilesAtLevel(n),s=this._resource.getDerivedResource({url:`${n}/${e}/${o-t-1}.tif`,queryParameters:{cesium:!0},request:i}).fetchImage({preferImageBitmap:!0});if(!c(s))return;let a=this;return Promise.resolve(s).then(function(l){return new Mc({buffer:xm(l),width:a._heightmapWidth,height:a._heightmapHeight,childTileMask:Rrt(a,e,t,n),structure:a._terrainDataStructure})})};ry.prototype.getLevelMaximumGeometricError=function(e){return this._levelZeroMaximumGeometricError/(1<<e)};var vge=new ae;function Rrt(e,t,n,i){let o=e._tilingScheme,r=e._rectangles,s=o.tileXYToRectangle(t,n,i),a=0;for(let l=0;l<r.length&&a!==15;++l){let u=r[l];if(u.maxLevel<=i)continue;let f=u.rectangle,d=ae.intersection(f,s,vge);c(d)&&(PL(o,f,t*2,n*2,i+1)&&(a|=4),PL(o,f,t*2+1,n*2,i+1)&&(a|=8),PL(o,f,t*2,n*2+1,i+1)&&(a|=1),PL(o,f,t*2+1,n*2+1,i+1)&&(a|=2))}return a}function PL(e,t,n,i,o){let r=e.tileXYToRectangle(n,i,o);return c(ae.intersection(r,t,vge))}ry.prototype.getTileDataAvailable=function(e,t,n){};ry.prototype.loadTileDataAvailability=function(e,t,n){};var Mrt=ry;var Lrt={VK_FORMAT_UNDEFINED:0,VK_FORMAT_R4G4_UNORM_PACK8:1,VK_FORMAT_R4G4B4A4_UNORM_PACK16:2,VK_FORMAT_B4G4R4A4_UNORM_PACK16:3,VK_FORMAT_R5G6B5_UNORM_PACK16:4,VK_FORMAT_B5G6R5_UNORM_PACK16:5,VK_FORMAT_R5G5B5A1_UNORM_PACK16:6,VK_FORMAT_B5G5R5A1_UNORM_PACK16:7,VK_FORMAT_A1R5G5B5_UNORM_PACK16:8,VK_FORMAT_R8_UNORM:9,VK_FORMAT_R8_SNORM:10,VK_FORMAT_R8_USCALED:11,VK_FORMAT_R8_SSCALED:12,VK_FORMAT_R8_UINT:13,VK_FORMAT_R8_SINT:14,VK_FORMAT_R8_SRGB:15,VK_FORMAT_R8G8_UNORM:16,VK_FORMAT_R8G8_SNORM:17,VK_FORMAT_R8G8_USCALED:18,VK_FORMAT_R8G8_SSCALED:19,VK_FORMAT_R8G8_UINT:20,VK_FORMAT_R8G8_SINT:21,VK_FORMAT_R8G8_SRGB:22,VK_FORMAT_R8G8B8_UNORM:23,VK_FORMAT_R8G8B8_SNORM:24,VK_FORMAT_R8G8B8_USCALED:25,VK_FORMAT_R8G8B8_SSCALED:26,VK_FORMAT_R8G8B8_UINT:27,VK_FORMAT_R8G8B8_SINT:28,VK_FORMAT_R8G8B8_SRGB:29,VK_FORMAT_B8G8R8_UNORM:30,VK_FORMAT_B8G8R8_SNORM:31,VK_FORMAT_B8G8R8_USCALED:32,VK_FORMAT_B8G8R8_SSCALED:33,VK_FORMAT_B8G8R8_UINT:34,VK_FORMAT_B8G8R8_SINT:35,VK_FORMAT_B8G8R8_SRGB:36,VK_FORMAT_R8G8B8A8_UNORM:37,VK_FORMAT_R8G8B8A8_SNORM:38,VK_FORMAT_R8G8B8A8_USCALED:39,VK_FORMAT_R8G8B8A8_SSCALED:40,VK_FORMAT_R8G8B8A8_UINT:41,VK_FORMAT_R8G8B8A8_SINT:42,VK_FORMAT_R8G8B8A8_SRGB:43,VK_FORMAT_B8G8R8A8_UNORM:44,VK_FORMAT_B8G8R8A8_SNORM:45,VK_FORMAT_B8G8R8A8_USCALED:46,VK_FORMAT_B8G8R8A8_SSCALED:47,VK_FORMAT_B8G8R8A8_UINT:48,VK_FORMAT_B8G8R8A8_SINT:49,VK_FORMAT_B8G8R8A8_SRGB:50,VK_FORMAT_A8B8G8R8_UNORM_PACK32:51,VK_FORMAT_A8B8G8R8_SNORM_PACK32:52,VK_FORMAT_A8B8G8R8_USCALED_PACK32:53,VK_FORMAT_A8B8G8R8_SSCALED_PACK32:54,VK_FORMAT_A8B8G8R8_UINT_PACK32:55,VK_FORMAT_A8B8G8R8_SINT_PACK32:56,VK_FORMAT_A8B8G8R8_SRGB_PACK32:57,VK_FORMAT_A2R10G10B10_UNORM_PACK32:58,VK_FORMAT_A2R10G10B10_SNORM_PACK32:59,VK_FORMAT_A2R10G10B10_USCALED_PACK32:60,VK_FORMAT_A2R10G10B10_SSCALED_PACK32:61,VK_FORMAT_A2R10G10B10_UINT_PACK32:62,VK_FORMAT_A2R10G10B10_SINT_PACK32:63,VK_FORMAT_A2B10G10R10_UNORM_PACK32:64,VK_FORMAT_A2B10G10R10_SNORM_PACK32:65,VK_FORMAT_A2B10G10R10_USCALED_PACK32:66,VK_FORMAT_A2B10G10R10_SSCALED_PACK32:67,VK_FORMAT_A2B10G10R10_UINT_PACK32:68,VK_FORMAT_A2B10G10R10_SINT_PACK32:69,VK_FORMAT_R16_UNORM:70,VK_FORMAT_R16_SNORM:71,VK_FORMAT_R16_USCALED:72,VK_FORMAT_R16_SSCALED:73,VK_FORMAT_R16_UINT:74,VK_FORMAT_R16_SINT:75,VK_FORMAT_R16_SFLOAT:76,VK_FORMAT_R16G16_UNORM:77,VK_FORMAT_R16G16_SNORM:78,VK_FORMAT_R16G16_USCALED:79,VK_FORMAT_R16G16_SSCALED:80,VK_FORMAT_R16G16_UINT:81,VK_FORMAT_R16G16_SINT:82,VK_FORMAT_R16G16_SFLOAT:83,VK_FORMAT_R16G16B16_UNORM:84,VK_FORMAT_R16G16B16_SNORM:85,VK_FORMAT_R16G16B16_USCALED:86,VK_FORMAT_R16G16B16_SSCALED:87,VK_FORMAT_R16G16B16_UINT:88,VK_FORMAT_R16G16B16_SINT:89,VK_FORMAT_R16G16B16_SFLOAT:90,VK_FORMAT_R16G16B16A16_UNORM:91,VK_FORMAT_R16G16B16A16_SNORM:92,VK_FORMAT_R16G16B16A16_USCALED:93,VK_FORMAT_R16G16B16A16_SSCALED:94,VK_FORMAT_R16G16B16A16_UINT:95,VK_FORMAT_R16G16B16A16_SINT:96,VK_FORMAT_R16G16B16A16_SFLOAT:97,VK_FORMAT_R32_UINT:98,VK_FORMAT_R32_SINT:99,VK_FORMAT_R32_SFLOAT:100,VK_FORMAT_R32G32_UINT:101,VK_FORMAT_R32G32_SINT:102,VK_FORMAT_R32G32_SFLOAT:103,VK_FORMAT_R32G32B32_UINT:104,VK_FORMAT_R32G32B32_SINT:105,VK_FORMAT_R32G32B32_SFLOAT:106,VK_FORMAT_R32G32B32A32_UINT:107,VK_FORMAT_R32G32B32A32_SINT:108,VK_FORMAT_R32G32B32A32_SFLOAT:109,VK_FORMAT_R64_UINT:110,VK_FORMAT_R64_SINT:111,VK_FORMAT_R64_SFLOAT:112,VK_FORMAT_R64G64_UINT:113,VK_FORMAT_R64G64_SINT:114,VK_FORMAT_R64G64_SFLOAT:115,VK_FORMAT_R64G64B64_UINT:116,VK_FORMAT_R64G64B64_SINT:117,VK_FORMAT_R64G64B64_SFLOAT:118,VK_FORMAT_R64G64B64A64_UINT:119,VK_FORMAT_R64G64B64A64_SINT:120,VK_FORMAT_R64G64B64A64_SFLOAT:121,VK_FORMAT_B10G11R11_UFLOAT_PACK32:122,VK_FORMAT_E5B9G9R9_UFLOAT_PACK32:123,VK_FORMAT_D16_UNORM:124,VK_FORMAT_X8_D24_UNORM_PACK32:125,VK_FORMAT_D32_SFLOAT:126,VK_FORMAT_S8_UINT:127,VK_FORMAT_D16_UNORM_S8_UINT:128,VK_FORMAT_D24_UNORM_S8_UINT:129,VK_FORMAT_D32_SFLOAT_S8_UINT:130,VK_FORMAT_BC1_RGB_UNORM_BLOCK:131,VK_FORMAT_BC1_RGB_SRGB_BLOCK:132,VK_FORMAT_BC1_RGBA_UNORM_BLOCK:133,VK_FORMAT_BC1_RGBA_SRGB_BLOCK:134,VK_FORMAT_BC2_UNORM_BLOCK:135,VK_FORMAT_BC2_SRGB_BLOCK:136,VK_FORMAT_BC3_UNORM_BLOCK:137,VK_FORMAT_BC3_SRGB_BLOCK:138,VK_FORMAT_BC4_UNORM_BLOCK:139,VK_FORMAT_BC4_SNORM_BLOCK:140,VK_FORMAT_BC5_UNORM_BLOCK:141,VK_FORMAT_BC5_SNORM_BLOCK:142,VK_FORMAT_BC6H_UFLOAT_BLOCK:143,VK_FORMAT_BC6H_SFLOAT_BLOCK:144,VK_FORMAT_BC7_UNORM_BLOCK:145,VK_FORMAT_BC7_SRGB_BLOCK:146,VK_FORMAT_ETC2_R8G8B8_UNORM_BLOCK:147,VK_FORMAT_ETC2_R8G8B8_SRGB_BLOCK:148,VK_FORMAT_ETC2_R8G8B8A1_UNORM_BLOCK:149,VK_FORMAT_ETC2_R8G8B8A1_SRGB_BLOCK:150,VK_FORMAT_ETC2_R8G8B8A8_UNORM_BLOCK:151,VK_FORMAT_ETC2_R8G8B8A8_SRGB_BLOCK:152,VK_FORMAT_EAC_R11_UNORM_BLOCK:153,VK_FORMAT_EAC_R11_SNORM_BLOCK:154,VK_FORMAT_EAC_R11G11_UNORM_BLOCK:155,VK_FORMAT_EAC_R11G11_SNORM_BLOCK:156,VK_FORMAT_ASTC_4x4_UNORM_BLOCK:157,VK_FORMAT_ASTC_4x4_SRGB_BLOCK:158,VK_FORMAT_ASTC_5x4_UNORM_BLOCK:159,VK_FORMAT_ASTC_5x4_SRGB_BLOCK:160,VK_FORMAT_ASTC_5x5_UNORM_BLOCK:161,VK_FORMAT_ASTC_5x5_SRGB_BLOCK:162,VK_FORMAT_ASTC_6x5_UNORM_BLOCK:163,VK_FORMAT_ASTC_6x5_SRGB_BLOCK:164,VK_FORMAT_ASTC_6x6_UNORM_BLOCK:165,VK_FORMAT_ASTC_6x6_SRGB_BLOCK:166,VK_FORMAT_ASTC_8x5_UNORM_BLOCK:167,VK_FORMAT_ASTC_8x5_SRGB_BLOCK:168,VK_FORMAT_ASTC_8x6_UNORM_BLOCK:169,VK_FORMAT_ASTC_8x6_SRGB_BLOCK:170,VK_FORMAT_ASTC_8x8_UNORM_BLOCK:171,VK_FORMAT_ASTC_8x8_SRGB_BLOCK:172,VK_FORMAT_ASTC_10x5_UNORM_BLOCK:173,VK_FORMAT_ASTC_10x5_SRGB_BLOCK:174,VK_FORMAT_ASTC_10x6_UNORM_BLOCK:175,VK_FORMAT_ASTC_10x6_SRGB_BLOCK:176,VK_FORMAT_ASTC_10x8_UNORM_BLOCK:177,VK_FORMAT_ASTC_10x8_SRGB_BLOCK:178,VK_FORMAT_ASTC_10x10_UNORM_BLOCK:179,VK_FORMAT_ASTC_10x10_SRGB_BLOCK:180,VK_FORMAT_ASTC_12x10_UNORM_BLOCK:181,VK_FORMAT_ASTC_12x10_SRGB_BLOCK:182,VK_FORMAT_ASTC_12x12_UNORM_BLOCK:183,VK_FORMAT_ASTC_12x12_SRGB_BLOCK:184,VK_FORMAT_G8B8G8R8_422_UNORM:1000156e3,VK_FORMAT_B8G8R8G8_422_UNORM:1000156001,VK_FORMAT_G8_B8_R8_3PLANE_420_UNORM:1000156002,VK_FORMAT_G8_B8R8_2PLANE_420_UNORM:1000156003,VK_FORMAT_G8_B8_R8_3PLANE_422_UNORM:1000156004,VK_FORMAT_G8_B8R8_2PLANE_422_UNORM:1000156005,VK_FORMAT_G8_B8_R8_3PLANE_444_UNORM:1000156006,VK_FORMAT_R10X6_UNORM_PACK16:1000156007,VK_FORMAT_R10X6G10X6_UNORM_2PACK16:1000156008,VK_FORMAT_R10X6G10X6B10X6A10X6_UNORM_4PACK16:1000156009,VK_FORMAT_G10X6B10X6G10X6R10X6_422_UNORM_4PACK16:1000156010,VK_FORMAT_B10X6G10X6R10X6G10X6_422_UNORM_4PACK16:1000156011,VK_FORMAT_G10X6_B10X6_R10X6_3PLANE_420_UNORM_3PACK16:1000156012,VK_FORMAT_G10X6_B10X6R10X6_2PLANE_420_UNORM_3PACK16:1000156013,VK_FORMAT_G10X6_B10X6_R10X6_3PLANE_422_UNORM_3PACK16:1000156014,VK_FORMAT_G10X6_B10X6R10X6_2PLANE_422_UNORM_3PACK16:1000156015,VK_FORMAT_G10X6_B10X6_R10X6_3PLANE_444_UNORM_3PACK16:1000156016,VK_FORMAT_R12X4_UNORM_PACK16:1000156017,VK_FORMAT_R12X4G12X4_UNORM_2PACK16:1000156018,VK_FORMAT_R12X4G12X4B12X4A12X4_UNORM_4PACK16:1000156019,VK_FORMAT_G12X4B12X4G12X4R12X4_422_UNORM_4PACK16:1000156020,VK_FORMAT_B12X4G12X4R12X4G12X4_422_UNORM_4PACK16:1000156021,VK_FORMAT_G12X4_B12X4_R12X4_3PLANE_420_UNORM_3PACK16:1000156022,VK_FORMAT_G12X4_B12X4R12X4_2PLANE_420_UNORM_3PACK16:1000156023,VK_FORMAT_G12X4_B12X4_R12X4_3PLANE_422_UNORM_3PACK16:1000156024,VK_FORMAT_G12X4_B12X4R12X4_2PLANE_422_UNORM_3PACK16:1000156025,VK_FORMAT_G12X4_B12X4_R12X4_3PLANE_444_UNORM_3PACK16:1000156026,VK_FORMAT_G16B16G16R16_422_UNORM:1000156027,VK_FORMAT_B16G16R16G16_422_UNORM:1000156028,VK_FORMAT_G16_B16_R16_3PLANE_420_UNORM:1000156029,VK_FORMAT_G16_B16R16_2PLANE_420_UNORM:1000156030,VK_FORMAT_G16_B16_R16_3PLANE_422_UNORM:1000156031,VK_FORMAT_G16_B16R16_2PLANE_422_UNORM:1000156032,VK_FORMAT_G16_B16_R16_3PLANE_444_UNORM:1000156033,VK_FORMAT_PVRTC1_2BPP_UNORM_BLOCK_IMG:1000054e3,VK_FORMAT_PVRTC1_4BPP_UNORM_BLOCK_IMG:1000054001,VK_FORMAT_PVRTC2_2BPP_UNORM_BLOCK_IMG:1000054002,VK_FORMAT_PVRTC2_4BPP_UNORM_BLOCK_IMG:1000054003,VK_FORMAT_PVRTC1_2BPP_SRGB_BLOCK_IMG:1000054004,VK_FORMAT_PVRTC1_4BPP_SRGB_BLOCK_IMG:1000054005,VK_FORMAT_PVRTC2_2BPP_SRGB_BLOCK_IMG:1000054006,VK_FORMAT_PVRTC2_4BPP_SRGB_BLOCK_IMG:1000054007,VK_FORMAT_ASTC_4x4_SFLOAT_BLOCK_EXT:1000066e3,VK_FORMAT_ASTC_5x4_SFLOAT_BLOCK_EXT:1000066001,VK_FORMAT_ASTC_5x5_SFLOAT_BLOCK_EXT:1000066002,VK_FORMAT_ASTC_6x5_SFLOAT_BLOCK_EXT:1000066003,VK_FORMAT_ASTC_6x6_SFLOAT_BLOCK_EXT:1000066004,VK_FORMAT_ASTC_8x5_SFLOAT_BLOCK_EXT:1000066005,VK_FORMAT_ASTC_8x6_SFLOAT_BLOCK_EXT:1000066006,VK_FORMAT_ASTC_8x8_SFLOAT_BLOCK_EXT:1000066007,VK_FORMAT_ASTC_10x5_SFLOAT_BLOCK_EXT:1000066008,VK_FORMAT_ASTC_10x6_SFLOAT_BLOCK_EXT:1000066009,VK_FORMAT_ASTC_10x8_SFLOAT_BLOCK_EXT:1000066010,VK_FORMAT_ASTC_10x10_SFLOAT_BLOCK_EXT:1000066011,VK_FORMAT_ASTC_12x10_SFLOAT_BLOCK_EXT:1000066012,VK_FORMAT_ASTC_12x12_SFLOAT_BLOCK_EXT:1000066013,VK_FORMAT_G8B8G8R8_422_UNORM_KHR:1000156e3,VK_FORMAT_B8G8R8G8_422_UNORM_KHR:1000156001,VK_FORMAT_G8_B8_R8_3PLANE_420_UNORM_KHR:1000156002,VK_FORMAT_G8_B8R8_2PLANE_420_UNORM_KHR:1000156003,VK_FORMAT_G8_B8_R8_3PLANE_422_UNORM_KHR:1000156004,VK_FORMAT_G8_B8R8_2PLANE_422_UNORM_KHR:1000156005,VK_FORMAT_G8_B8_R8_3PLANE_444_UNORM_KHR:1000156006,VK_FORMAT_R10X6_UNORM_PACK16_KHR:1000156007,VK_FORMAT_R10X6G10X6_UNORM_2PACK16_KHR:1000156008,VK_FORMAT_R10X6G10X6B10X6A10X6_UNORM_4PACK16_KHR:1000156009,VK_FORMAT_G10X6B10X6G10X6R10X6_422_UNORM_4PACK16_KHR:1000156010,VK_FORMAT_B10X6G10X6R10X6G10X6_422_UNORM_4PACK16_KHR:1000156011,VK_FORMAT_G10X6_B10X6_R10X6_3PLANE_420_UNORM_3PACK16_KHR:1000156012,VK_FORMAT_G10X6_B10X6R10X6_2PLANE_420_UNORM_3PACK16_KHR:1000156013,VK_FORMAT_G10X6_B10X6_R10X6_3PLANE_422_UNORM_3PACK16_KHR:1000156014,VK_FORMAT_G10X6_B10X6R10X6_2PLANE_422_UNORM_3PACK16_KHR:1000156015,VK_FORMAT_G10X6_B10X6_R10X6_3PLANE_444_UNORM_3PACK16_KHR:1000156016,VK_FORMAT_R12X4_UNORM_PACK16_KHR:1000156017,VK_FORMAT_R12X4G12X4_UNORM_2PACK16_KHR:1000156018,VK_FORMAT_R12X4G12X4B12X4A12X4_UNORM_4PACK16_KHR:1000156019,VK_FORMAT_G12X4B12X4G12X4R12X4_422_UNORM_4PACK16_KHR:1000156020,VK_FORMAT_B12X4G12X4R12X4G12X4_422_UNORM_4PACK16_KHR:1000156021,VK_FORMAT_G12X4_B12X4_R12X4_3PLANE_420_UNORM_3PACK16_KHR:1000156022,VK_FORMAT_G12X4_B12X4R12X4_2PLANE_420_UNORM_3PACK16_KHR:1000156023,VK_FORMAT_G12X4_B12X4_R12X4_3PLANE_422_UNORM_3PACK16_KHR:1000156024,VK_FORMAT_G12X4_B12X4R12X4_2PLANE_422_UNORM_3PACK16_KHR:1000156025,VK_FORMAT_G12X4_B12X4_R12X4_3PLANE_444_UNORM_3PACK16_KHR:1000156026,VK_FORMAT_G16B16G16R16_422_UNORM_KHR:1000156027,VK_FORMAT_B16G16R16G16_422_UNORM_KHR:1000156028,VK_FORMAT_G16_B16_R16_3PLANE_420_UNORM_KHR:1000156029,VK_FORMAT_G16_B16R16_2PLANE_420_UNORM_KHR:1000156030,VK_FORMAT_G16_B16_R16_3PLANE_422_UNORM_KHR:1000156031,VK_FORMAT_G16_B16R16_2PLANE_422_UNORM_KHR:1000156032,VK_FORMAT_G16_B16_R16_3PLANE_444_UNORM_KHR:1000156033},Nrt=Object.freeze(Lrt);function Frt(e){switch(e){case ne.FLOAT:return"float";case ne.FLOAT_VEC2:return"vec2";case ne.FLOAT_VEC3:return"vec3";case ne.FLOAT_VEC4:return"vec4";case ne.FLOAT_MAT2:return"mat2";case ne.FLOAT_MAT3:return"mat3";case ne.FLOAT_MAT4:return"mat4";case ne.SAMPLER_2D:return"sampler2D";case ne.UNSIGNED_INT_SAMPLER_2D:return"usampler2D";case ne.BOOL:return"bool"}}var Brt=Frt;function krt(e,t,n){if(typeof t!="function")throw new E("oldFunction is required to be a function.");if(typeof n!="function")throw new E("oldFunction is required to be a function.");return function(){n.apply(e,arguments),t.apply(e,arguments)}}var IL=krt;var DD=`in vec4 position;
in vec2 textureCoordinates;
out vec2 v_textureCoordinates;
void main()
{
gl_Position = position;
v_textureCoordinates = textureCoordinates;
}
`;function OL(e){this._context=e}var PD,Vrt=new et({primitiveType:Me.TRIANGLES}),Urt=new ri({color:new j(0,0,0,0)});function zrt(e,t){return new Jr({context:e,colorTextures:[t],destroyAttachments:!1})}function Hrt(e,t){return an.fromCache({context:e,vertexShaderSource:DD,fragmentShaderSource:t,attributeLocations:{position:0,textureCoordinates:1}})}function Grt(e,t){return(!c(PD)||PD.viewport.width!==e||PD.viewport.height!==t)&&(PD=ze.fromCache({viewport:new Ke(0,0,e,t)})),PD}OL.prototype.execute=function(e){if(A.defined("computeCommand",e),c(e.preExecute)&&e.preExecute(e),!c(e.fragmentShaderSource)&&!c(e.shaderProgram))throw new E("computeCommand.fragmentShaderSource or computeCommand.shaderProgram is required.");A.defined("computeCommand.outputTexture",e.outputTexture);let t=e.outputTexture,n=t.width,i=t.height,o=this._context,r=c(e.vertexArray)?e.vertexArray:o.getViewportQuadVertexArray(),s=c(e.shaderProgram)?e.shaderProgram:Hrt(o,e.fragmentShaderSource),a=zrt(o,t),l=Grt(n,i),u=e.uniformMap,f=Urt;f.framebuffer=a,f.renderState=l,f.execute(o);let d=Vrt;d.vertexArray=r,d.renderState=l,d.shaderProgram=s,d.uniformMap=u,d.framebuffer=a,d.execute(o),a.destroy(),e.persists||(s.destroy(),c(e.vertexArray)&&r.destroy()),c(e.postExecute)&&e.postExecute(t)};OL.prototype.isDestroyed=function(){return!1};OL.prototype.destroy=function(){return de(this)};var XW=OL;function jrt(e){this.context=e,this.framebuffer=void 0,this.blendingEnabled=void 0,this.scissorTest=void 0,this.viewport=void 0}var Cl=jrt;function kd(e){this._context=e,this._shaders={},this._numberOfShaders=0,this._shadersToRelease={}}Object.defineProperties(kd.prototype,{numberOfShaders:{get:function(){return this._numberOfShaders}}});kd.prototype.replaceShaderProgram=function(e){return c(e.shaderProgram)&&e.shaderProgram.destroy(),this.getShaderProgram(e)};function Wrt(e){let t=Object.keys(e).sort();return JSON.stringify(e,t)}kd.prototype.getShaderProgram=function(e){let t=e.vertexShaderSource,n=e.fragmentShaderSource,i=e.attributeLocations;typeof t=="string"&&(t=new Ge({sources:[t]})),typeof n=="string"&&(n=new Ge({sources:[n]}));let o=t.getCacheKey(),r=n.getCacheKey(),s=c(i)?Wrt(i):"",a=`${o}:${r}:${s}`,l;if(c(this._shaders[a]))l=this._shaders[a],delete this._shadersToRelease[a];else{let u=this._context,f=t.createCombinedVertexShader(u),d=n.createCombinedFragmentShader(u),p=new an({gl:u._gl,logShaderCompilation:u.logShaderCompilation,debugShaders:u.debugShaders,vertexShaderSource:t,vertexShaderText:f,fragmentShaderSource:n,fragmentShaderText:d,attributeLocations:i});l={cache:this,shaderProgram:p,keyword:a,derivedKeywords:[],count:0},p._cachedShader=l,this._shaders[a]=l,++this._numberOfShaders}return++l.count,l.shaderProgram};kd.prototype.replaceDerivedShaderProgram=function(e,t,n){let i=e._cachedShader,o=t+i.keyword,r=this._shaders[o];if(c(r)){KW(this,r);let s=i.derivedKeywords.indexOf(t);s>-1&&i.derivedKeywords.splice(s,1)}return this.createDerivedShaderProgram(e,t,n)};kd.prototype.getDerivedShaderProgram=function(e,t){let n=e._cachedShader,i=t+n.keyword,o=this._shaders[i];if(c(o))return o.shaderProgram};kd.prototype.createDerivedShaderProgram=function(e,t,n){let i=e._cachedShader,o=t+i.keyword,r=n.vertexShaderSource,s=n.fragmentShaderSource,a=n.attributeLocations;typeof r=="string"&&(r=new Ge({sources:[r]})),typeof s=="string"&&(s=new Ge({sources:[s]}));let l=this._context,u=r.createCombinedVertexShader(l),f=s.createCombinedFragmentShader(l),d=new an({gl:l._gl,logShaderCompilation:l.logShaderCompilation,debugShaders:l.debugShaders,vertexShaderSource:r,vertexShaderText:u,fragmentShaderSource:s,fragmentShaderText:f,attributeLocations:a}),p={cache:this,shaderProgram:d,keyword:o,derivedKeywords:[],count:0};return i.derivedKeywords.push(t),d._cachedShader=p,this._shaders[o]=p,d};function KW(e,t){let n=t.derivedKeywords,i=n.length;for(let o=0;o<i;++o){let r=n[o]+t.keyword,s=e._shaders[r];KW(e,s)}delete e._shaders[t.keyword],t.shaderProgram.finalDestroy()}kd.prototype.destroyReleasedShaderPrograms=function(){let e=this._shadersToRelease;for(let t in e)if(e.hasOwnProperty(t)){let n=e[t];KW(this,n),--this._numberOfShaders}this._shadersToRelease={}};kd.prototype.releaseShaderProgram=function(e){if(c(e)){let t=e._cachedShader;t&&--t.count===0&&(this._shadersToRelease[t.keyword]=t)}};kd.prototype.isDestroyed=function(){return!1};kd.prototype.destroy=function(){let e=this._shaders;for(let t in e)e.hasOwnProperty(t)&&e[t].shaderProgram.finalDestroy();return de(this)};var $W=kd;function Vb(){this._textures={},this._numberOfTextures=0,this._texturesToRelease={}}Object.defineProperties(Vb.prototype,{numberOfTextures:{get:function(){return this._numberOfTextures}}});Vb.prototype.getTexture=function(e){let t=this._textures[e];if(c(t))return delete this._texturesToRelease[e],++t.count,t.texture};Vb.prototype.addTexture=function(e,t){let n={texture:t,count:1};t.finalDestroy=t.destroy;let i=this;t.destroy=function(){--n.count===0&&(i._texturesToRelease[e]=n)},this._textures[e]=n,++this._numberOfTextures};Vb.prototype.destroyReleasedTextures=function(){let e=this._texturesToRelease;for(let t in e)if(e.hasOwnProperty(t)){let n=e[t];delete this._textures[t],n.texture.finalDestroy(),--this._numberOfTextures}this._texturesToRelease={}};Vb.prototype.isDestroyed=function(){return!1};Vb.prototype.destroy=function(){let e=this._textures;for(let t in e)e.hasOwnProperty(t)&&e[t].texture.finalDestroy();return de(this)};var ZW=Vb;function qrt(e){e=y(e,y.EMPTY_OBJECT),this.color=j.clone(y(e.color,j.WHITE)),this.intensity=y(e.intensity,2)}var Ub=qrt;function pC(){this.globeDepthTexture=void 0,this.gamma=void 0,this._viewport=new Ke,this._viewportCartesian4=new se,this._viewportDirty=!1,this._viewportOrthographicMatrix=k.clone(k.IDENTITY),this._viewportTransformation=k.clone(k.IDENTITY),this._model=k.clone(k.IDENTITY),this._view=k.clone(k.IDENTITY),this._inverseView=k.clone(k.IDENTITY),this._projection=k.clone(k.IDENTITY),this._infiniteProjection=k.clone(k.IDENTITY),this._entireFrustum=new H,this._currentFrustum=new H,this._frustumPlanes=new se,this._farDepthFromNearPlusOne=void 0,this._log2FarDepthFromNearPlusOne=void 0,this._oneOverLog2FarDepthFromNearPlusOne=void 0,this._frameState=void 0,this._temeToPseudoFixed=Q.clone(k.IDENTITY),this._view3DDirty=!0,this._view3D=new k,this._inverseView3DDirty=!0,this._inverseView3D=new k,this._inverseModelDirty=!0,this._inverseModel=new k,this._inverseTransposeModelDirty=!0,this._inverseTransposeModel=new Q,this._viewRotation=new Q,this._inverseViewRotation=new Q,this._viewRotation3D=new Q,this._inverseViewRotation3D=new Q,this._inverseProjectionDirty=!0,this._inverseProjection=new k,this._modelViewDirty=!0,this._modelView=new k,this._modelView3DDirty=!0,this._modelView3D=new k,this._modelViewRelativeToEyeDirty=!0,this._modelViewRelativeToEye=new k,this._inverseModelViewDirty=!0,this._inverseModelView=new k,this._inverseModelView3DDirty=!0,this._inverseModelView3D=new k,this._viewProjectionDirty=!0,this._viewProjection=new k,this._inverseViewProjectionDirty=!0,this._inverseViewProjection=new k,this._modelViewProjectionDirty=!0,this._modelViewProjection=new k,this._inverseModelViewProjectionDirty=!0,this._inverseModelViewProjection=new k,this._modelViewProjectionRelativeToEyeDirty=!0,this._modelViewProjectionRelativeToEye=new k,this._modelViewInfiniteProjectionDirty=!0,this._modelViewInfiniteProjection=new k,this._normalDirty=!0,this._normal=new Q,this._normal3DDirty=!0,this._normal3D=new Q,this._inverseNormalDirty=!0,this._inverseNormal=new Q,this._inverseNormal3DDirty=!0,this._inverseNormal3D=new Q,this._encodedCameraPositionMCDirty=!0,this._encodedCameraPositionMC=new Gn,this._cameraPosition=new h,this._sunPositionWC=new h,this._sunPositionColumbusView=new h,this._sunDirectionWC=new h,this._sunDirectionEC=new h,this._moonDirectionEC=new h,this._lightDirectionWC=new h,this._lightDirectionEC=new h,this._lightColor=new h,this._lightColorHdr=new h,this._pass=void 0,this._mode=void 0,this._mapProjection=void 0,this._ellipsoid=void 0,this._cameraDirection=new h,this._cameraRight=new h,this._cameraUp=new h,this._frustum2DWidth=0,this._eyeHeight=0,this._eyeHeight2D=new H,this._eyeEllipsoidNormalEC=new h,this._eyeEllipsoidCurvature=new H,this._modelToEnu=new k,this._enuToModel=new k,this._pixelRatio=1,this._orthographicIn3D=!1,this._backgroundColor=new j,this._brdfLut=void 0,this._environmentMap=void 0,this._sphericalHarmonicCoefficients=void 0,this._specularEnvironmentMaps=void 0,this._specularEnvironmentMapsMaximumLOD=void 0,this._fogDensity=void 0,this._fogVisualDensityScalar=void 0,this._fogMinimumBrightness=void 0,this._atmosphereHsbShift=void 0,this._atmosphereLightIntensity=void 0,this._atmosphereRayleighCoefficient=new h,this._atmosphereRayleighScaleHeight=new h,this._atmosphereMieCoefficient=new h,this._atmosphereMieScaleHeight=void 0,this._atmosphereMieAnisotropy=void 0,this._atmosphereDynamicLighting=void 0,this._invertClassificationColor=void 0,this._splitPosition=0,this._pixelSizePerMeter=void 0,this._geometricToleranceOverMeter=void 0,this._minimumDisableDepthTestDistance=void 0}Object.defineProperties(pC.prototype,{frameState:{get:function(){return this._frameState}},viewport:{get:function(){return this._viewport},set:function(e){if(!Ke.equals(e,this._viewport)){Ke.clone(e,this._viewport);let t=this._viewport,n=this._viewportCartesian4;n.x=t.x,n.y=t.y,n.z=t.width,n.w=t.height,this._viewportDirty=!0}}},viewportCartesian4:{get:function(){return this._viewportCartesian4}},viewportOrthographic:{get:function(){return Pge(this),this._viewportOrthographicMatrix}},viewportTransformation:{get:function(){return Pge(this),this._viewportTransformation}},model:{get:function(){return this._model},set:function(e){k.clone(e,this._model),this._modelView3DDirty=!0,this._inverseModelView3DDirty=!0,this._inverseModelDirty=!0,this._inverseTransposeModelDirty=!0,this._modelViewDirty=!0,this._inverseModelViewDirty=!0,this._modelViewRelativeToEyeDirty=!0,this._inverseModelViewDirty=!0,this._modelViewProjectionDirty=!0,this._inverseModelViewProjectionDirty=!0,this._modelViewProjectionRelativeToEyeDirty=!0,this._modelViewInfiniteProjectionDirty=!0,this._normalDirty=!0,this._inverseNormalDirty=!0,this._normal3DDirty=!0,this._inverseNormal3DDirty=!0,this._encodedCameraPositionMCDirty=!0}},inverseModel:{get:function(){return this._inverseModelDirty&&(this._inverseModelDirty=!1,k.inverse(this._model,this._inverseModel)),this._inverseModel}},inverseTransposeModel:{get:function(){let e=this._inverseTransposeModel;return this._inverseTransposeModelDirty&&(this._inverseTransposeModelDirty=!1,k.getMatrix3(this.inverseModel,e),Q.transpose(e,e)),e}},view:{get:function(){return this._view}},view3D:{get:function(){return QW(this),this._view3D}},viewRotation:{get:function(){return QW(this),this._viewRotation}},viewRotation3D:{get:function(){return QW(this),this._viewRotation3D}},inverseView:{get:function(){return this._inverseView}},inverseView3D:{get:function(){return Rge(this),this._inverseView3D}},inverseViewRotation:{get:function(){return this._inverseViewRotation}},inverseViewRotation3D:{get:function(){return Rge(this),this._inverseViewRotation3D}},projection:{get:function(){return this._projection}},inverseProjection:{get:function(){return ist(this),this._inverseProjection}},infiniteProjection:{get:function(){return this._infiniteProjection}},modelView:{get:function(){return ost(this),this._modelView}},modelView3D:{get:function(){return rst(this),this._modelView3D}},modelViewRelativeToEye:{get:function(){return fst(this),this._modelViewRelativeToEye}},inverseModelView:{get:function(){return sst(this),this._inverseModelView}},inverseModelView3D:{get:function(){return ast(this),this._inverseModelView3D}},viewProjection:{get:function(){return cst(this),this._viewProjection}},inverseViewProjection:{get:function(){return lst(this),this._inverseViewProjection}},modelViewProjection:{get:function(){return ust(this),this._modelViewProjection}},inverseModelViewProjection:{get:function(){return dst(this),this._inverseModelViewProjection}},modelViewProjectionRelativeToEye:{get:function(){return hst(this),this._modelViewProjectionRelativeToEye}},modelViewInfiniteProjection:{get:function(){return mst(this),this._modelViewInfiniteProjection}},normal:{get:function(){return pst(this),this._normal}},normal3D:{get:function(){return _st(this),this._normal3D}},inverseNormal:{get:function(){return gst(this),this._inverseNormal}},inverseNormal3D:{get:function(){return yst(this),this._inverseNormal3D}},entireFrustum:{get:function(){return this._entireFrustum}},currentFrustum:{get:function(){return this._currentFrustum}},frustumPlanes:{get:function(){return this._frustumPlanes}},farDepthFromNearPlusOne:{get:function(){return this._farDepthFromNearPlusOne}},log2FarDepthFromNearPlusOne:{get:function(){return this._log2FarDepthFromNearPlusOne}},oneOverLog2FarDepthFromNearPlusOne:{get:function(){return this._oneOverLog2FarDepthFromNearPlusOne}},eyeHeight:{get:function(){return this._eyeHeight}},eyeHeight2D:{get:function(){return this._eyeHeight2D}},eyeEllipsoidNormalEC:{get:function(){return this._eyeEllipsoidNormalEC}},eyeEllipsoidCurvature:{get:function(){return this._eyeEllipsoidCurvature}},modelToEnu:{get:function(){return this._modelToEnu}},enuToModel:{get:function(){return this._enuToModel}},sunPositionWC:{get:function(){return this._sunPositionWC}},sunPositionColumbusView:{get:function(){return this._sunPositionColumbusView}},sunDirectionWC:{get:function(){return this._sunDirectionWC}},sunDirectionEC:{get:function(){return this._sunDirectionEC}},moonDirectionEC:{get:function(){return this._moonDirectionEC}},lightDirectionWC:{get:function(){return this._lightDirectionWC}},lightDirectionEC:{get:function(){return this._lightDirectionEC}},lightColor:{get:function(){return this._lightColor}},lightColorHdr:{get:function(){return this._lightColorHdr}},encodedCameraPositionMCHigh:{get:function(){return Oge(this),this._encodedCameraPositionMC.high}},encodedCameraPositionMCLow:{get:function(){return Oge(this),this._encodedCameraPositionMC.low}},temeToPseudoFixedMatrix:{get:function(){return this._temeToPseudoFixed}},pixelRatio:{get:function(){return this._pixelRatio}},fogDensity:{get:function(){return this._fogDensity}},fogVisualDensityScalar:{get:function(){return this._fogVisualDensityScalar}},fogMinimumBrightness:{get:function(){return this._fogMinimumBrightness}},atmosphereHsbShift:{get:function(){return this._atmosphereHsbShift}},atmosphereLightIntensity:{get:function(){return this._atmosphereLightIntensity}},atmosphereRayleighCoefficient:{get:function(){return this._atmosphereRayleighCoefficient}},atmosphereRayleighScaleHeight:{get:function(){return this._atmosphereRayleighScaleHeight}},atmosphereMieCoefficient:{get:function(){return this._atmosphereMieCoefficient}},atmosphereMieScaleHeight:{get:function(){return this._atmosphereMieScaleHeight}},atmosphereMieAnisotropy:{get:function(){return this._atmosphereMieAnisotropy}},atmosphereDynamicLighting:{get:function(){return this._atmosphereDynamicLighting}},geometricToleranceOverMeter:{get:function(){return this._geometricToleranceOverMeter}},pass:{get:function(){return this._pass}},backgroundColor:{get:function(){return this._backgroundColor}},brdfLut:{get:function(){return this._brdfLut}},environmentMap:{get:function(){return this._environmentMap}},sphericalHarmonicCoefficients:{get:function(){return this._sphericalHarmonicCoefficients}},specularEnvironmentMaps:{get:function(){return this._specularEnvironmentMaps}},specularEnvironmentMapsMaximumLOD:{get:function(){return this._specularEnvironmentMapsMaximumLOD}},splitPosition:{get:function(){return this._splitPosition}},minimumDisableDepthTestDistance:{get:function(){return this._minimumDisableDepthTestDistance}},invertClassificationColor:{get:function(){return this._invertClassificationColor}},orthographicIn3D:{get:function(){return this._orthographicIn3D}},ellipsoid:{get:function(){return y(this._ellipsoid,ie.default)}}});function Yrt(e,t){k.clone(t,e._view),k.getMatrix3(t,e._viewRotation),e._view3DDirty=!0,e._inverseView3DDirty=!0,e._modelViewDirty=!0,e._modelView3DDirty=!0,e._modelViewRelativeToEyeDirty=!0,e._inverseModelViewDirty=!0,e._inverseModelView3DDirty=!0,e._viewProjectionDirty=!0,e._inverseViewProjectionDirty=!0,e._modelViewProjectionDirty=!0,e._modelViewProjectionRelativeToEyeDirty=!0,e._modelViewInfiniteProjectionDirty=!0,e._normalDirty=!0,e._inverseNormalDirty=!0,e._normal3DDirty=!0,e._inverseNormal3DDirty=!0}function Xrt(e,t){k.clone(t,e._inverseView),k.getMatrix3(t,e._inverseViewRotation)}function Krt(e,t){k.clone(t,e._projection),e._inverseProjectionDirty=!0,e._viewProjectionDirty=!0,e._inverseViewProjectionDirty=!0,e._modelViewProjectionDirty=!0,e._modelViewProjectionRelativeToEyeDirty=!0}function $rt(e,t){k.clone(t,e._infiniteProjection),e._modelViewInfiniteProjectionDirty=!0}var Dge=new h,Zrt=new k;function Jrt(e,t){h.clone(t.positionWC,e._cameraPosition),h.clone(t.directionWC,e._cameraDirection),h.clone(t.rightWC,e._cameraRight),h.clone(t.upWC,e._cameraUp);let n=e._ellipsoid,i,o=t.positionCartographic;if(c(o)?(e._eyeHeight=o.height,e._eyeEllipsoidNormalEC=n.geodeticSurfaceNormalCartographic(o,e._eyeEllipsoidNormalEC),i=h.fromRadians(o.longitude,o.latitude,0,n,Dge)):(e._eyeHeight=-n.maximumRadius,h.magnitude(t.positionWC)>0&&(e._eyeEllipsoidNormalEC=h.normalize(t.positionWC,e._eyeEllipsoidNormalEC)),i=n.scaleToGeodeticSurface(t.positionWC,Dge)),e._encodedCameraPositionMCDirty=!0,!c(i))return;e._eyeEllipsoidNormalEC=Q.multiplyByVector(e._viewRotation,e._eyeEllipsoidNormalEC,e._eyeEllipsoidNormalEC);let r=Ft.eastNorthUpToFixedFrame(i,n,Zrt);e._enuToModel=k.multiplyTransformation(e.inverseModel,r,e._enuToModel),e._modelToEnu=k.inverseTransformation(e._enuToModel,e._modelToEnu),R.equalsEpsilon(n._radii.x,n._radii.y,R.EPSILON15)&&(e._eyeEllipsoidCurvature=n.getLocalCurvature(i,e._eyeEllipsoidCurvature))}var JW=new Q,Qrt=new he;function est(e,t){Ft.computeIcrfToCentralBodyFixedMatrix(t.time,JW);let n=hC.computeSunPositionInEarthInertialFrame(t.time,e._sunPositionWC);Q.multiplyByVector(JW,n,n),h.normalize(n,e._sunDirectionWC),n=Q.multiplyByVector(e.viewRotation3D,n,e._sunDirectionEC),h.normalize(n,n),n=hC.computeMoonPositionInEarthInertialFrame(t.time,e._moonDirectionEC),Q.multiplyByVector(JW,n,n),Q.multiplyByVector(e.viewRotation3D,n,n),h.normalize(n,n);let i=t.mapProjection,r=i.ellipsoid.cartesianToCartographic(e._sunPositionWC,Qrt);i.project(r,e._sunPositionColumbusView)}pC.prototype.updateCamera=function(e){Yrt(this,e.viewMatrix),Xrt(this,e.inverseViewMatrix),Jrt(this,e),this._entireFrustum.x=e.frustum.near,this._entireFrustum.y=e.frustum.far,this.updateFrustum(e.frustum),this._orthographicIn3D=this._mode!==oe.SCENE2D&&e.frustum instanceof rn};pC.prototype.updateFrustum=function(e){Krt(this,e.projectionMatrix),c(e.infiniteProjectionMatrix)&&$rt(this,e.infiniteProjectionMatrix),this._currentFrustum.x=e.near,this._currentFrustum.y=e.far,this._farDepthFromNearPlusOne=e.far-e.near+1,this._log2FarDepthFromNearPlusOne=R.log2(this._farDepthFromNearPlusOne),this._oneOverLog2FarDepthFromNearPlusOne=1/this._log2FarDepthFromNearPlusOne;let t=e.offCenterFrustum;c(t)&&(e=t),this._frustumPlanes.x=e.top,this._frustumPlanes.y=e.bottom,this._frustumPlanes.z=e.left,this._frustumPlanes.w=e.right};pC.prototype.updatePass=function(e){this._pass=e};var tst=[],nst=new Ub;pC.prototype.update=function(e){this._mode=e.mode,this._mapProjection=e.mapProjection,this._ellipsoid=e.mapProjection.ellipsoid,this._pixelRatio=e.pixelRatio;let t=e.camera;this.updateCamera(t),e.mode===oe.SCENE2D?(this._frustum2DWidth=t.frustum.right-t.frustum.left,this._eyeHeight2D.x=this._frustum2DWidth*.5,this._eyeHeight2D.y=this._eyeHeight2D.x*this._eyeHeight2D.x):(this._frustum2DWidth=0,this._eyeHeight2D.x=0,this._eyeHeight2D.y=0),est(this,e);let n=y(e.light,nst);n instanceof Ub?(this._lightDirectionWC=h.clone(this._sunDirectionWC,this._lightDirectionWC),this._lightDirectionEC=h.clone(this._sunDirectionEC,this._lightDirectionEC)):(this._lightDirectionWC=h.normalize(h.negate(n.direction,this._lightDirectionWC),this._lightDirectionWC),this._lightDirectionEC=Q.multiplyByVector(this.viewRotation3D,this._lightDirectionWC,this._lightDirectionEC));let i=n.color,o=h.fromElements(i.red,i.green,i.blue,this._lightColorHdr);o=h.multiplyByScalar(o,n.intensity,o);let r=h.maximumComponent(o);r>1?h.divideByScalar(o,r,this._lightColor):h.clone(o,this._lightColor);let s=e.brdfLutGenerator,a=c(s)?s.colorTexture:void 0;this._brdfLut=a,this._environmentMap=y(e.environmentMap,e.context.defaultCubeMap),this._sphericalHarmonicCoefficients=y(e.sphericalHarmonicCoefficients,tst),this._specularEnvironmentMaps=e.specularEnvironmentMaps,this._specularEnvironmentMapsMaximumLOD=e.specularEnvironmentMapsMaximumLOD,this._fogDensity=e.fog.density,this._fogVisualDensityScalar=e.fog.visualDensityScalar,this._fogMinimumBrightness=e.fog.minimumBrightness;let l=e.atmosphere;c(l)&&(this._atmosphereHsbShift=h.fromElements(l.hueShift,l.saturationShift,l.brightnessShift,this._atmosphereHsbShift),this._atmosphereLightIntensity=l.lightIntensity,this._atmosphereRayleighCoefficient=h.clone(l.rayleighCoefficient,this._atmosphereRayleighCoefficient),this._atmosphereRayleighScaleHeight=l.rayleighScaleHeight,this._atmosphereMieCoefficient=h.clone(l.mieCoefficient,this._atmosphereMieCoefficient),this._atmosphereMieScaleHeight=l.mieScaleHeight,this._atmosphereMieAnisotropy=l.mieAnisotropy,this._atmosphereDynamicLighting=l.dynamicLighting),this._invertClassificationColor=e.invertClassificationColor,this._frameState=e,this._temeToPseudoFixed=Ft.computeTemeToPseudoFixedMatrix(e.time,this._temeToPseudoFixed),this._splitPosition=e.splitPosition*e.context.drawingBufferWidth;let u=t.frustum.fov,f=this._viewport,d;c(u)?f.height>f.width?d=Math.tan(.5*u)*2/f.height:d=Math.tan(.5*u)*2/f.width:d=1/Math.max(f.width,f.height),this._geometricToleranceOverMeter=d*e.maximumScreenSpaceError,j.clone(e.backgroundColor,this._backgroundColor),this._minimumDisableDepthTestDistance=e.minimumDisableDepthTestDistance,this._minimumDisableDepthTestDistance*=this._minimumDisableDepthTestDistance,this._minimumDisableDepthTestDistance===Number.POSITIVE_INFINITY&&(this._minimumDisableDepthTestDistance=-1)};function Pge(e){if(e._viewportDirty){let t=e._viewport;k.computeOrthographicOffCenter(t.x,t.x+t.width,t.y,t.y+t.height,0,1,e._viewportOrthographicMatrix),k.computeViewportTransformation(t,0,1,e._viewportTransformation),e._viewportDirty=!1}}function ist(e){e._inverseProjectionDirty&&(e._inverseProjectionDirty=!1,e._mode!==oe.SCENE2D&&e._mode!==oe.MORPHING&&!e._orthographicIn3D?k.inverse(e._projection,e._inverseProjection):k.clone(k.ZERO,e._inverseProjection))}function ost(e){e._modelViewDirty&&(e._modelViewDirty=!1,k.multiplyTransformation(e._view,e._model,e._modelView))}function rst(e){e._modelView3DDirty&&(e._modelView3DDirty=!1,k.multiplyTransformation(e.view3D,e._model,e._modelView3D))}function sst(e){e._inverseModelViewDirty&&(e._inverseModelViewDirty=!1,k.inverse(e.modelView,e._inverseModelView))}function ast(e){e._inverseModelView3DDirty&&(e._inverseModelView3DDirty=!1,k.inverse(e.modelView3D,e._inverseModelView3D))}function cst(e){e._viewProjectionDirty&&(e._viewProjectionDirty=!1,k.multiply(e._projection,e._view,e._viewProjection))}function lst(e){e._inverseViewProjectionDirty&&(e._inverseViewProjectionDirty=!1,k.inverse(e.viewProjection,e._inverseViewProjection))}function ust(e){e._modelViewProjectionDirty&&(e._modelViewProjectionDirty=!1,k.multiply(e._projection,e.modelView,e._modelViewProjection))}function fst(e){if(e._modelViewRelativeToEyeDirty){e._modelViewRelativeToEyeDirty=!1;let t=e.modelView,n=e._modelViewRelativeToEye;n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=0,n[13]=0,n[14]=0,n[15]=t[15]}}function dst(e){e._inverseModelViewProjectionDirty&&(e._inverseModelViewProjectionDirty=!1,k.inverse(e.modelViewProjection,e._inverseModelViewProjection))}function hst(e){e._modelViewProjectionRelativeToEyeDirty&&(e._modelViewProjectionRelativeToEyeDirty=!1,k.multiply(e._projection,e.modelViewRelativeToEye,e._modelViewProjectionRelativeToEye))}function mst(e){e._modelViewInfiniteProjectionDirty&&(e._modelViewInfiniteProjectionDirty=!1,k.multiply(e._infiniteProjection,e.modelView,e._modelViewInfiniteProjection))}function pst(e){if(e._normalDirty){e._normalDirty=!1;let t=e._normal;k.getMatrix3(e.inverseModelView,t),Q.transpose(t,t)}}function _st(e){if(e._normal3DDirty){e._normal3DDirty=!1;let t=e._normal3D;k.getMatrix3(e.inverseModelView3D,t),Q.transpose(t,t)}}function gst(e){if(e._inverseNormalDirty){e._inverseNormalDirty=!1;let t=e._inverseNormal;k.getMatrix3(e.modelView,t),Q.transpose(t,t)}}function yst(e){if(e._inverseNormal3DDirty){e._inverseNormal3DDirty=!1;let t=e._inverseNormal3D;k.getMatrix3(e.modelView3D,t),Q.transpose(t,t)}}var Ige=new h;function Oge(e){e._encodedCameraPositionMCDirty&&(e._encodedCameraPositionMCDirty=!1,k.multiplyByPoint(e.inverseModel,e._cameraPosition,Ige),Gn.fromCartesian(Ige,e._encodedCameraPositionMC))}var bst=new h,xst=new h,Tst=new h,Ast=new h,Cst=new he,Est=new h,Sst=new k;function wst(e,t,n,i,o,r,s,a){let l=bst;l.x=e.y,l.y=e.z,l.z=e.x;let u=xst;u.x=n.y,u.y=n.z,u.z=n.x;let f=Tst;f.x=i.y,f.y=i.z,f.z=i.x;let d=Ast;d.x=t.y,d.y=t.z,d.z=t.x,r===oe.SCENE2D&&(l.z=o*.5);let p=s.unproject(l,Cst);p.longitude=R.clamp(p.longitude,-Math.PI,Math.PI),p.latitude=R.clamp(p.latitude,-R.PI_OVER_TWO,R.PI_OVER_TWO);let g=s.ellipsoid,m=g.cartographicToCartesian(p,Est),b=Ft.eastNorthUpToFixedFrame(m,g,Sst);return k.multiplyByPointAsVector(b,u,u),k.multiplyByPointAsVector(b,f,f),k.multiplyByPointAsVector(b,d,d),c(a)||(a=new k),a[0]=u.x,a[1]=f.x,a[2]=-d.x,a[3]=0,a[4]=u.y,a[5]=f.y,a[6]=-d.y,a[7]=0,a[8]=u.z,a[9]=f.z,a[10]=-d.z,a[11]=0,a[12]=-h.dot(u,m),a[13]=-h.dot(f,m),a[14]=h.dot(d,m),a[15]=1,a}function QW(e){e._view3DDirty&&(e._mode===oe.SCENE3D?k.clone(e._view,e._view3D):wst(e._cameraPosition,e._cameraDirection,e._cameraRight,e._cameraUp,e._frustum2DWidth,e._mode,e._mapProjection,e._view3D),k.getMatrix3(e._view3D,e._viewRotation3D),e._view3DDirty=!1)}function Rge(e){e._inverseView3DDirty&&(k.inverseTransformation(e.view3D,e._inverseView3D),k.getMatrix3(e._inverseView3D,e._inverseViewRotation3D),e._inverseView3DDirty=!1)}var eq=pC;function hu(e,t){A.defined("canvas",e);let{getWebGLStub:n,requestWebgl1:i,webgl:o={},allowTextureFilterAnisotropic:r=!0}=y(t,{});o.alpha=y(o.alpha,!1),o.stencil=y(o.stencil,!0),o.powerPreference=y(o.powerPreference,"high-performance");let s=c(n)?n(e,o):vst(e,o,i),l=typeof WebGL2RenderingContext<"u"&&s instanceof WebGL2RenderingContext;this._canvas=e,this._originalGLContext=s,this._gl=s,this._webgl2=l,this._id=Hn(),this.validateFramebuffer=!1,this.validateShaderProgram=!1,this.logShaderCompilation=!1,this._throwOnWebGLError=!1,this._shaderCache=new $W(this),this._textureCache=new ZW;let u=s;this._stencilBits=u.getParameter(u.STENCIL_BITS),mt._maximumCombinedTextureImageUnits=u.getParameter(u.MAX_COMBINED_TEXTURE_IMAGE_UNITS),mt._maximumCubeMapSize=u.getParameter(u.MAX_CUBE_MAP_TEXTURE_SIZE),mt._maximumFragmentUniformVectors=u.getParameter(u.MAX_FRAGMENT_UNIFORM_VECTORS),mt._maximumTextureImageUnits=u.getParameter(u.MAX_TEXTURE_IMAGE_UNITS),mt._maximumRenderbufferSize=u.getParameter(u.MAX_RENDERBUFFER_SIZE),mt._maximumTextureSize=u.getParameter(u.MAX_TEXTURE_SIZE),mt._maximumVaryingVectors=u.getParameter(u.MAX_VARYING_VECTORS),mt._maximumVertexAttributes=u.getParameter(u.MAX_VERTEX_ATTRIBS),mt._maximumVertexTextureImageUnits=u.getParameter(u.MAX_VERTEX_TEXTURE_IMAGE_UNITS),mt._maximumVertexUniformVectors=u.getParameter(u.MAX_VERTEX_UNIFORM_VECTORS),mt._maximumSamples=this._webgl2?u.getParameter(u.MAX_SAMPLES):0;let f=u.getParameter(u.ALIASED_LINE_WIDTH_RANGE);mt._minimumAliasedLineWidth=f[0],mt._maximumAliasedLineWidth=f[1];let d=u.getParameter(u.ALIASED_POINT_SIZE_RANGE);mt._minimumAliasedPointSize=d[0],mt._maximumAliasedPointSize=d[1];let p=u.getParameter(u.MAX_VIEWPORT_DIMS);mt._maximumViewportWidth=p[0],mt._maximumViewportHeight=p[1];let g=u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_FLOAT);mt._highpFloatSupported=g.precision!==0;let m=u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_INT);mt._highpIntSupported=m.rangeMax!==0,this._antialias=u.getContextAttributes().antialias,this._standardDerivatives=!!Tr(u,["OES_standard_derivatives"]),this._blendMinmax=!!Tr(u,["EXT_blend_minmax"]),this._elementIndexUint=!!Tr(u,["OES_element_index_uint"]),this._depthTexture=!!Tr(u,["WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"]),this._fragDepth=!!Tr(u,["EXT_frag_depth"]),this._debugShaders=Tr(u,["WEBGL_debug_shaders"]),this._textureFloat=!!Tr(u,["OES_texture_float"]),this._textureHalfFloat=!!Tr(u,["OES_texture_half_float"]),this._textureFloatLinear=!!Tr(u,["OES_texture_float_linear"]),this._textureHalfFloatLinear=!!Tr(u,["OES_texture_half_float_linear"]),this._supportsTextureLod=!!Tr(u,["EXT_shader_texture_lod"]),this._colorBufferFloat=!!Tr(u,["EXT_color_buffer_float","WEBGL_color_buffer_float"]),this._floatBlend=!!Tr(u,["EXT_float_blend"]),this._colorBufferHalfFloat=!!Tr(u,["EXT_color_buffer_half_float"]),this._s3tc=!!Tr(u,["WEBGL_compressed_texture_s3tc","MOZ_WEBGL_compressed_texture_s3tc","WEBKIT_WEBGL_compressed_texture_s3tc"]),this._pvrtc=!!Tr(u,["WEBGL_compressed_texture_pvrtc","WEBKIT_WEBGL_compressed_texture_pvrtc"]),this._astc=!!Tr(u,["WEBGL_compressed_texture_astc"]),this._etc=!!Tr(u,["WEBG_compressed_texture_etc"]),this._etc1=!!Tr(u,["WEBGL_compressed_texture_etc1"]),this._bc7=!!Tr(u,["EXT_texture_compression_bptc"]),Mu.setKTX2SupportedFormats(this._s3tc,this._pvrtc,this._astc,this._etc,this._etc1,this._bc7);let b=r?Tr(u,["EXT_texture_filter_anisotropic","WEBKIT_EXT_texture_filter_anisotropic"]):void 0;this._textureFilterAnisotropic=b,mt._maximumTextureFilterAnisotropy=c(b)?u.getParameter(b.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1;let x,T,C,S,v,D,I,L,M,N;if(l){let P=this;x=function(){return P._gl.createVertexArray()},T=function(O){P._gl.bindVertexArray(O)},C=function(O){P._gl.deleteVertexArray(O)},S=function(O,F,V,G,z){u.drawElementsInstanced(O,F,V,G,z)},v=function(O,F,V,G){u.drawArraysInstanced(O,F,V,G)},D=function(O,F){u.vertexAttribDivisor(O,F)},I=function(O){u.drawBuffers(O)}}else L=Tr(u,["OES_vertex_array_object"]),c(L)&&(x=function(){return L.createVertexArrayOES()},T=function(P){L.bindVertexArrayOES(P)},C=function(P){L.deleteVertexArrayOES(P)}),M=Tr(u,["ANGLE_instanced_arrays"]),c(M)&&(S=function(P,O,F,V,G){M.drawElementsInstancedANGLE(P,O,F,V,G)},v=function(P,O,F,V){M.drawArraysInstancedANGLE(P,O,F,V)},D=function(P,O){M.vertexAttribDivisorANGLE(P,O)}),N=Tr(u,["WEBGL_draw_buffers"]),c(N)&&(I=function(P){N.drawBuffersWEBGL(P)});this.glCreateVertexArray=x,this.glBindVertexArray=T,this.glDeleteVertexArray=C,this.glDrawElementsInstanced=S,this.glDrawArraysInstanced=v,this.glVertexAttribDivisor=D,this.glDrawBuffers=I,this._vertexArrayObject=!!L,this._instancedArrays=!!M,this._drawBuffers=!!N,mt._maximumDrawBuffers=this.drawBuffers?u.getParameter(ne.MAX_DRAW_BUFFERS):1,mt._maximumColorAttachments=this.drawBuffers?u.getParameter(ne.MAX_COLOR_ATTACHMENTS):1,this._clearColor=new j(0,0,0,0),this._clearDepth=1,this._clearStencil=0;let B=new eq,_=new Cl(this),w=ze.fromCache();this._defaultPassState=_,this._defaultRenderState=w,this._defaultTexture=void 0,this._defaultEmissiveTexture=void 0,this._defaultNormalTexture=void 0,this._defaultCubeMap=void 0,this._us=B,this._currentRenderState=w,this._currentPassState=_,this._currentFramebuffer=void 0,this._maxFrameTextureUnitIndex=0,this._vertexAttribDivisors=[],this._previousDrawInstanced=!1;for(let P=0;P<mt._maximumVertexAttributes;P++)this._vertexAttribDivisors.push(0);this._pickObjects={},this._nextPickColor=new Uint32Array(1),this.options={getWebGLStub:n,requestWebgl1:i,webgl:o,allowTextureFilterAnisotropic:r},this.cache={},ze.apply(u,w,_)}function vst(e,t,n){if(typeof WebGLRenderingContext>"u")throw new ue("The browser does not support WebGL.  Visit http://get.webgl.org.");!n&&!(typeof WebGL2RenderingContext<"u")&&(n=!0);let o=n?"webgl":"webgl2",r=e.getContext(o,t);if(!c(r))throw new ue("The browser supports WebGL, but initialization failed.");return r}function Dst(e,t){let n="WebGL Error:  ";switch(t){case e.INVALID_ENUM:n+="INVALID_ENUM";break;case e.INVALID_VALUE:n+="INVALID_VALUE";break;case e.INVALID_OPERATION:n+="INVALID_OPERATION";break;case e.OUT_OF_MEMORY:n+="OUT_OF_MEMORY";break;case e.CONTEXT_LOST_WEBGL:n+="CONTEXT_LOST_WEBGL lost";break;default:n+=`Unknown (${t})`}return n}function Pst(e,t,n,i){let o=`${Dst(e,i)}: ${t.name}(`;for(let r=0;r<n.length;++r)r!==0&&(o+=", "),o+=n[r];return o+=");",o}function Ist(e,t,n){let i=e.getError();if(i!==e.NO_ERROR)throw new ue(Pst(e,t,n,i))}function Ost(e,t,n){return{get:function(){let i=e[t];return n(e,`get: ${t}`,i),e[t]},set:function(i){e[t]=i,n(e,`set: ${t}`,i)}}}function Rst(e,t){if(!c(t))return e;function n(o){return function(){let r=o.apply(e,arguments);return t(e,o,arguments),r}}let i={};for(let o in e){let r=e[o];r instanceof Function?i[o]=n(r):Object.defineProperty(i,o,Ost(e,o,t))}return i}function Tr(e,t){let n=t.length;for(let i=0;i<n;++i){let o=e.getExtension(t[i]);if(o)return o}}var Mst={};Object.defineProperties(hu.prototype,{id:{get:function(){return this._id}},webgl2:{get:function(){return this._webgl2}},canvas:{get:function(){return this._canvas}},shaderCache:{get:function(){return this._shaderCache}},textureCache:{get:function(){return this._textureCache}},uniformState:{get:function(){return this._us}},stencilBits:{get:function(){return this._stencilBits}},stencilBuffer:{get:function(){return this._stencilBits>=8}},antialias:{get:function(){return this._antialias}},msaa:{get:function(){return this._webgl2}},standardDerivatives:{get:function(){return this._standardDerivatives||this._webgl2}},floatBlend:{get:function(){return this._floatBlend}},blendMinmax:{get:function(){return this._blendMinmax||this._webgl2}},elementIndexUint:{get:function(){return this._elementIndexUint||this._webgl2}},depthTexture:{get:function(){return this._depthTexture||this._webgl2}},floatingPointTexture:{get:function(){return this._webgl2||this._textureFloat}},halfFloatingPointTexture:{get:function(){return this._webgl2||this._textureHalfFloat}},textureFloatLinear:{get:function(){return this._textureFloatLinear}},textureHalfFloatLinear:{get:function(){return this._webgl2&&this._textureFloatLinear||!this._webgl2&&this._textureHalfFloatLinear}},supportsTextureLod:{get:function(){return this._webgl2||this._supportsTextureLod}},textureFilterAnisotropic:{get:function(){return!!this._textureFilterAnisotropic}},s3tc:{get:function(){return this._s3tc}},pvrtc:{get:function(){return this._pvrtc}},astc:{get:function(){return this._astc}},etc:{get:function(){return this._etc}},etc1:{get:function(){return this._etc1}},bc7:{get:function(){return this._bc7}},supportsBasis:{get:function(){return this._s3tc||this._pvrtc||this._astc||this._etc||this._etc1||this._bc7}},vertexArrayObject:{get:function(){return this._vertexArrayObject||this._webgl2}},fragmentDepth:{get:function(){return this._fragDepth||this._webgl2}},instancedArrays:{get:function(){return this._instancedArrays||this._webgl2}},colorBufferFloat:{get:function(){return this._colorBufferFloat}},colorBufferHalfFloat:{get:function(){return this._webgl2&&this._colorBufferFloat||!this._webgl2&&this._colorBufferHalfFloat}},drawBuffers:{get:function(){return this._drawBuffers||this._webgl2}},debugShaders:{get:function(){return this._debugShaders}},throwOnWebGLError:{get:function(){return this._throwOnWebGLError},set:function(e){this._throwOnWebGLError=e,this._gl=Rst(this._originalGLContext,e?Ist:void 0)}},defaultTexture:{get:function(){return this._defaultTexture===void 0&&(this._defaultTexture=new Lt({context:this,source:{width:1,height:1,arrayBufferView:new Uint8Array([255,255,255,255])},flipY:!1})),this._defaultTexture}},defaultEmissiveTexture:{get:function(){return this._defaultEmissiveTexture===void 0&&(this._defaultEmissiveTexture=new Lt({context:this,pixelFormat:Ve.RGB,source:{width:1,height:1,arrayBufferView:new Uint8Array([0,0,0])},flipY:!1})),this._defaultEmissiveTexture}},defaultNormalTexture:{get:function(){return this._defaultNormalTexture===void 0&&(this._defaultNormalTexture=new Lt({context:this,pixelFormat:Ve.RGB,source:{width:1,height:1,arrayBufferView:new Uint8Array([128,128,255])},flipY:!1})),this._defaultNormalTexture}},defaultCubeMap:{get:function(){if(this._defaultCubeMap===void 0){let e={width:1,height:1,arrayBufferView:new Uint8Array([255,255,255,255])};this._defaultCubeMap=new Jo({context:this,source:{positiveX:e,negativeX:e,positiveY:e,negativeY:e,positiveZ:e,negativeZ:e},flipY:!1})}return this._defaultCubeMap}},drawingBufferHeight:{get:function(){return this._gl.drawingBufferHeight}},drawingBufferWidth:{get:function(){return this._gl.drawingBufferWidth}},defaultFramebuffer:{get:function(){return Mst}}});function Lst(e){if(e.validateFramebuffer){let t=e._gl,n=t.checkFramebufferStatus(t.FRAMEBUFFER);if(n!==t.FRAMEBUFFER_COMPLETE){let i;switch(n){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:i="Framebuffer is not complete.  Incomplete attachment: at least one attachment point with a renderbuffer or texture attached has its attached object no longer in existence or has an attached image with a width or height of zero, or the color attachment point has a non-color-renderable image attached, or the depth attachment point has a non-depth-renderable image attached, or the stencil attachment point has a non-stencil-renderable image attached.  Color-renderable formats include GL_RGBA4, GL_RGB5_A1, and GL_RGB565. GL_DEPTH_COMPONENT16 is the only depth-renderable format. GL_STENCIL_INDEX8 is the only stencil-renderable format.";break;case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:i="Framebuffer is not complete.  Incomplete dimensions: not all attached images have the same width and height.";break;case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:i="Framebuffer is not complete.  Missing attachment: no images are attached to the framebuffer.";break;case t.FRAMEBUFFER_UNSUPPORTED:i="Framebuffer is not complete.  Unsupported: the combination of internal formats of the attached images violates an implementation-dependent set of restrictions.";break}throw new E(i)}}}function Mge(e,t,n,i){let o=e._currentRenderState,r=e._currentPassState;e._currentRenderState=t,e._currentPassState=n,ze.partialApply(e._gl,o,t,r,n,i)}var tq;typeof WebGLRenderingContext<"u"&&(tq=[ne.BACK]);function nq(e,t){if(t!==e._currentFramebuffer){e._currentFramebuffer=t;let n=tq;if(c(t))t._bind(),Lst(e),n=t._getActiveColorAttachments();else{let i=e._gl;i.bindFramebuffer(i.FRAMEBUFFER,null)}e.drawBuffers&&e.glDrawBuffers(n)}}var Nst=new ri;hu.prototype.clear=function(e,t){e=y(e,Nst),t=y(t,this._defaultPassState);let n=this._gl,i=0,o=e.color,r=e.depth,s=e.stencil;c(o)&&(j.equals(this._clearColor,o)||(j.clone(o,this._clearColor),n.clearColor(o.red,o.green,o.blue,o.alpha)),i|=n.COLOR_BUFFER_BIT),c(r)&&(r!==this._clearDepth&&(this._clearDepth=r,n.clearDepth(r)),i|=n.DEPTH_BUFFER_BIT),c(s)&&(s!==this._clearStencil&&(this._clearStencil=s,n.clearStencil(s)),i|=n.STENCIL_BUFFER_BIT);let a=y(e.renderState,this._defaultRenderState);Mge(this,a,t,!0);let l=y(e.framebuffer,t.framebuffer);nq(this,l),n.clear(i)};function Fst(e,t,n,i,o){if(c(t)&&o.depthTest&&o.depthTest.enabled&&!t.hasDepthAttachment)throw new E("The depth test can not be enabled (drawCommand.renderState.depthTest.enabled) because the framebuffer (drawCommand.framebuffer) does not have a depth or depth-stencil renderbuffer.");nq(e,t),Mge(e,o,n,!1),i._bind(),e._maxFrameTextureUnitIndex=Math.max(e._maxFrameTextureUnitIndex,i.maximumTextureUnitIndex)}function Bst(e,t,n,i){let o=t._primitiveType,r=t._vertexArray,s=t._offset,a=t._count,l=t.instanceCount;if(!Me.validate(o))throw new E("drawCommand.primitiveType is required and must be valid.");if(A.defined("drawCommand.vertexArray",r),A.typeOf.number.greaterThanOrEquals("drawCommand.offset",s,0),c(a)&&A.typeOf.number.greaterThanOrEquals("drawCommand.count",a,0),A.typeOf.number.greaterThanOrEquals("drawCommand.instanceCount",l,0),l>0&&!e.instancedArrays)throw new E("Instanced arrays extension is not supported");e._us.model=y(t._modelMatrix,k.IDENTITY),n._setUniforms(i,e._us,e.validateShaderProgram),r._bind();let u=r.indexBuffer;c(u)?(s=s*u.bytesPerIndex,c(a)?a=Math.min(a,u.numberOfIndices):a=u.numberOfIndices,l===0?e._gl.drawElements(o,a,u.indexDatatype,s):e.glDrawElementsInstanced(o,a,u.indexDatatype,s,l)):(c(a)?a=Math.min(a,r.numberOfVertices):a=r.numberOfVertices,l===0?e._gl.drawArrays(o,s,a):e.glDrawArraysInstanced(o,s,a,l)),r._unBind()}hu.prototype.draw=function(e,t,n,i){A.defined("drawCommand",e),A.defined("drawCommand.shaderProgram",e._shaderProgram),t=y(t,this._defaultPassState);let o=y(e._framebuffer,t.framebuffer),r=y(e._renderState,this._defaultRenderState);n=y(n,e._shaderProgram),i=y(i,e._uniformMap),Fst(this,o,t,n,r),Bst(this,e,n,i)};hu.prototype.endFrame=function(){let e=this._gl;e.useProgram(null),this._currentFramebuffer=void 0,e.bindFramebuffer(e.FRAMEBUFFER,null);let t=tq;this.drawBuffers&&this.glDrawBuffers(t);let n=this._maxFrameTextureUnitIndex;this._maxFrameTextureUnitIndex=0;for(let i=0;i<n;++i)e.activeTexture(e.TEXTURE0+i),e.bindTexture(e.TEXTURE_2D,null),e.bindTexture(e.TEXTURE_CUBE_MAP,null)};hu.prototype.readPixels=function(e){let t=this._gl;e=y(e,y.EMPTY_OBJECT);let n=Math.max(y(e.x,0),0),i=Math.max(y(e.y,0),0),o=y(e.width,t.drawingBufferWidth),r=y(e.height,t.drawingBufferHeight),s=e.framebuffer;A.typeOf.number.greaterThan("readState.width",o,0),A.typeOf.number.greaterThan("readState.height",r,0);let a=Be.UNSIGNED_BYTE;c(s)&&s.numberOfColorAttachments>0&&(a=s.getColorTexture(0).pixelDatatype);let l=Ve.createTypedArray(Ve.RGBA,a,o,r);return nq(this,s),t.readPixels(n,i,o,r,Ve.RGBA,Be.toWebGLConstant(a,this),l),l};var Lge={position:0,textureCoordinates:1};hu.prototype.getViewportQuadVertexArray=function(){let e=this.cache.viewportQuad_vertexArray;if(!c(e)){let t=new ut({attributes:{position:new we({componentDatatype:$.FLOAT,componentsPerAttribute:2,values:[-1,-1,1,-1,1,1,-1,1]}),textureCoordinates:new we({componentDatatype:$.FLOAT,componentsPerAttribute:2,values:[0,0,1,0,1,1,0,1]})},indices:new Uint16Array([0,1,2,0,2,3]),primitiveType:Me.TRIANGLES});e=ni.fromGeometry({context:this,geometry:t,attributeLocations:Lge,bufferUsage:ke.STATIC_DRAW,interleave:!0}),this.cache.viewportQuad_vertexArray=e}return e};hu.prototype.createViewportQuadCommand=function(e,t){return t=y(t,y.EMPTY_OBJECT),new et({vertexArray:this.getViewportQuadVertexArray(),primitiveType:Me.TRIANGLES,renderState:t.renderState,shaderProgram:an.fromCache({context:this,vertexShaderSource:DD,fragmentShaderSource:e,attributeLocations:Lge}),uniformMap:t.uniformMap,owner:t.owner,framebuffer:t.framebuffer,pass:t.pass})};hu.prototype.getObjectByPickColor=function(e){return A.defined("pickColor",e),this._pickObjects[e.toRgba()]};function iq(e,t,n){this._pickObjects=e,this.key=t,this.color=n}Object.defineProperties(iq.prototype,{object:{get:function(){return this._pickObjects[this.key]},set:function(e){this._pickObjects[this.key]=e}}});iq.prototype.destroy=function(){delete this._pickObjects[this.key]};hu.prototype.createPickId=function(e){A.defined("object",e),++this._nextPickColor[0];let t=this._nextPickColor[0];if(t===0)throw new ue("Out of unique Pick IDs.");return this._pickObjects[t]=e,new iq(this._pickObjects,t,j.fromRgba(t))};hu.prototype.isDestroyed=function(){return!1};hu.prototype.destroy=function(){let e=this.cache;for(let t in e)if(e.hasOwnProperty(t)){let n=e[t];c(n.destroy)&&n.destroy()}return this._shaderCache=this._shaderCache.destroy(),this._textureCache=this._textureCache.destroy(),this._defaultTexture=this._defaultTexture&&this._defaultTexture.destroy(),this._defaultEmissiveTexture=this._defaultEmissiveTexture&&this._defaultEmissiveTexture.destroy(),this._defaultNormalTexture=this._defaultNormalTexture&&this._defaultNormalTexture.destroy(),this._defaultCubeMap=this._defaultCubeMap&&this._defaultCubeMap.destroy(),de(this)};hu._deprecationWarning=Ss;var oq=hu;function kst(e,t,n){if(A.defined("context",e),A.defined("urls",t),Object.values(Jo.FaceName).some(r=>!c(t[r])))throw new E("urls must have positiveX, negativeX, positiveY, negativeY, positiveZ, and negativeZ properties.");let i={flipY:!0,skipColorSpaceConversion:n,preferImageBitmap:!0},o=[De.createIfNeeded(t.positiveX).fetchImage(i),De.createIfNeeded(t.negativeX).fetchImage(i),De.createIfNeeded(t.positiveY).fetchImage(i),De.createIfNeeded(t.negativeY).fetchImage(i),De.createIfNeeded(t.positiveZ).fetchImage(i),De.createIfNeeded(t.negativeZ).fetchImage(i)];return Promise.all(o).then(function(r){return new Jo({context:e,source:{positiveX:r[0],negativeX:r[1],positiveY:r[2],negativeY:r[3],positiveZ:r[4],negativeZ:r[5]}})})}var rq=kst;var Vst={SATELLITE:1,OCEANS:2,HILLSHADE:3},im=Object.freeze(Vst);var sq,Nge="AAPTxy8BH1VEsoebNVZXo8HurEOF051kAEKlhkOhBEc9BmQpcUfxe1Yndhf82d5oKkQJ4_7VPaBQGYSISOMaRew7Sy-eTX1JQ4XwaC8v5aCvV72O6LCPs5Ss1pXXH-0uEw6bSRhTeQYHOmikutC2OMyZt6lu0VfT7FA-jVMO_UsunWNTf2cycP2O4IeDN_UV9G-VNmUu2jRvCHioi8o72ua4238s2219cYLEmcoGRJGVJTA.AT1_PjLvyih0",_C={};_C.defaultAccessToken=Nge;_C.defaultWorldImageryServer=new De({url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"});_C.defaultWorldHillshadeServer=new De({url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"});_C.defaultWorldOceanServer=new De({url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer"});_C.getDefaultTokenCredit=function(e){if(e===Nge){if(!c(sq)){let t='<b>             This application is using a default ArcGIS access token. Please assign <i>Cesium.ArcGisMapService.defaultAccessToken</i>             with an API key from your ArcGIS Developer account before using the ArcGIS tile services.             You can sign up for a free ArcGIS Developer account at <a href="https://developers.arcgis.com/">https://developers.arcgis.com/</a>.</b>';sq=new Pt(t,!0)}return sq}};var Vd=_C;function aq(e){if(e=y(e,y.EMPTY_OBJECT),!c(e.missingImageUrl))throw new E("options.missingImageUrl is required.");if(!c(e.pixelsToCheck))throw new E("options.pixelsToCheck is required.");this._pixelsToCheck=e.pixelsToCheck,this._missingImagePixels=void 0,this._missingImageByteLength=void 0,this._isReady=!1;let t=De.createIfNeeded(e.missingImageUrl),n=this;function i(r){c(r.blob)&&(n._missingImageByteLength=r.blob.size);let s=xm(r);if(e.disableCheckIfAllPixelsAreTransparent){let a=!0,l=r.width,u=e.pixelsToCheck;for(let f=0,d=u.length;a&&f<d;++f){let p=u[f],g=p.x*4+p.y*l;s[g+3]>0&&(a=!1)}a&&(s=void 0)}n._missingImagePixels=s,n._isReady=!0}function o(){n._missingImagePixels=void 0,n._isReady=!0}t.fetchImage({preferBlob:!0,preferImageBitmap:!0,flipY:!0}).then(i).catch(o)}aq.prototype.isReady=function(){return this._isReady};aq.prototype.shouldDiscardImage=function(e){if(!this._isReady)throw new E("shouldDiscardImage must not be called before the discard policy is ready.");let t=this._pixelsToCheck,n=this._missingImagePixels;if(!c(n)||c(e.blob)&&e.blob.size!==this._missingImageByteLength)return!1;let i=xm(e),o=e.width;for(let r=0,s=t.length;r<s;++r){let a=t[r],l=a.x*4+a.y*o;for(let u=0;u<4;++u){let f=l+u;if(i[f]!==n[f])return!1}}return!0};var cq=aq;function lq(){this.name=void 0,this.description=void 0,this.position=void 0,this.data=void 0,this.imageryLayer=void 0}lq.prototype.configureNameFromProperties=function(e){let t=10,n;for(let i in e)if(e.hasOwnProperty(i)&&e[i]){let o=i.toLowerCase();t>1&&o==="name"?(t=1,n=i):t>2&&o==="title"?(t=2,n=i):t>3&&/name/i.test(i)?(t=3,n=i):t>4&&/title/i.test(i)&&(t=4,n=i)}c(n)&&(this.name=e[n])};lq.prototype.configureDescriptionFromProperties=function(e){function t(n){let i='<table class="cesium-infoBox-defaultTable">';for(let o in n)if(n.hasOwnProperty(o)){let r=n[o];c(r)&&(typeof r=="object"?i+=`<tr><td>${o}</td><td>${t(r)}</td></tr>`:i+=`<tr><td>${o}</td><td>${r}</td></tr>`)}return i+="</table>",i}this.description=t(e)};var Qp=lq;function gC(){E.throwInstantiationError()}Object.defineProperties(gC.prototype,{rectangle:{get:E.throwInstantiationError},tileWidth:{get:E.throwInstantiationError},tileHeight:{get:E.throwInstantiationError},maximumLevel:{get:E.throwInstantiationError},minimumLevel:{get:E.throwInstantiationError},tilingScheme:{get:E.throwInstantiationError},tileDiscardPolicy:{get:E.throwInstantiationError},errorEvent:{get:E.throwInstantiationError},credit:{get:E.throwInstantiationError},proxy:{get:E.throwInstantiationError},hasAlphaChannel:{get:E.throwInstantiationError}});gC.prototype.getTileCredits=function(e,t,n){E.throwInstantiationError()};gC.prototype.requestImage=function(e,t,n,i){E.throwInstantiationError()};gC.prototype.pickFeatures=function(e,t,n,i,o){E.throwInstantiationError()};var Ust=/\.ktx2$/i;gC.loadImage=function(e,t){A.defined("url",t);let n=De.createIfNeeded(t);return Ust.test(n.url)?Mu(n):c(e)&&c(e.tileDiscardPolicy)?n.fetchImage({preferBlob:!0,preferImageBitmap:!0,flipY:!0}):n.fetchImage({preferImageBitmap:!0,flipY:!0})};var mu=gC;function Fge(e){this.useTiles=y(e.usePreCachedTilesIfAvailable,!0);let t=e.ellipsoid;this.tilingScheme=y(e.tilingScheme,new $i({ellipsoid:t})),this.rectangle=y(e.rectangle,this.tilingScheme.rectangle),this.ellipsoid=t;let n=e.credit;typeof n=="string"&&(n=new Pt(n)),this.credit=n,this.tileCredits=void 0,this.tileDiscardPolicy=e.tileDiscardPolicy,this.tileWidth=y(e.tileWidth,256),this.tileHeight=y(e.tileHeight,256),this.maximumLevel=e.maximumLevel}Fge.prototype.build=function(e){e._useTiles=this.useTiles,e._tilingScheme=this.tilingScheme,e._rectangle=this.rectangle,e._credit=this.credit,e._tileCredits=this.tileCredits,e._tileDiscardPolicy=this.tileDiscardPolicy,e._tileWidth=this.tileWidth,e._tileHeight=this.tileHeight,e._maximumLevel=this.maximumLevel,this.useTiles&&!c(this.tileDiscardPolicy)&&(e._tileDiscardPolicy=new cq({missingImageUrl:Bge(e,0,0,this.maximumLevel).url,pixelsToCheck:[new H(0,0),new H(200,20),new H(20,200),new H(80,110),new H(160,130)],disableCheckIfAllPixelsAreTransparent:!0}))};function zst(e,t){let n=e.tileInfo;if(!c(n))t.useTiles=!1;else{if(t.tileWidth=n.rows,t.tileHeight=n.cols,n.spatialReference.wkid===102100||n.spatialReference.wkid===102113)t.tilingScheme=new ys({ellipsoid:t.ellipsoid});else if(e.tileInfo.spatialReference.wkid===4326)t.tilingScheme=new $i({ellipsoid:t.ellipsoid});else{let i=`Tile spatial reference WKID ${e.tileInfo.spatialReference.wkid} is not supported.`;throw new ue(i)}if(t.maximumLevel=e.tileInfo.lods.length-1,c(e.fullExtent)){if(c(e.fullExtent.spatialReference)&&c(e.fullExtent.spatialReference.wkid))if(e.fullExtent.spatialReference.wkid===102100||e.fullExtent.spatialReference.wkid===102113){let i=new Li,o=e.fullExtent,r=i.unproject(new h(Math.max(o.xmin,-t.tilingScheme.ellipsoid.maximumRadius*Math.PI),Math.max(o.ymin,-t.tilingScheme.ellipsoid.maximumRadius*Math.PI),0)),s=i.unproject(new h(Math.min(o.xmax,t.tilingScheme.ellipsoid.maximumRadius*Math.PI),Math.min(o.ymax,t.tilingScheme.ellipsoid.maximumRadius*Math.PI),0));t.rectangle=new ae(r.longitude,r.latitude,s.longitude,s.latitude)}else if(e.fullExtent.spatialReference.wkid===4326)t.rectangle=ae.fromDegrees(e.fullExtent.xmin,e.fullExtent.ymin,e.fullExtent.xmax,e.fullExtent.ymax);else{let i=`fullExtent.spatialReference WKID ${e.fullExtent.spatialReference.wkid} is not supported.`;throw new ue(i)}}else t.rectangle=t.tilingScheme.rectangle;t.useTiles=!0}c(e.copyrightText)&&e.copyrightText.length>0&&(c(t.credit)?t.tileCredits=[new Pt(e.copyrightText)]:t.credit=new Pt(e.copyrightText))}function Hst(e,t){let n=`An error occurred while accessing ${e.url}`;throw c(t)&&c(t.message)&&(n+=`: ${t.message}`),new ue(n)}async function Gst(e,t){let n=e.getDerivedResource({queryParameters:{f:"json"}});try{let i=await n.fetchJson();zst(i,t)}catch(i){Hst(e,i)}}function om(e){e=y(e,y.EMPTY_OBJECT),this._defaultAlpha=void 0,this._defaultNightAlpha=void 0,this._defaultDayAlpha=void 0,this._defaultBrightness=void 0,this._defaultContrast=void 0,this._defaultHue=void 0,this._defaultSaturation=void 0,this._defaultGamma=void 0,this._defaultMinificationFilter=void 0,this._defaultMagnificationFilter=void 0,this._tileDiscardPolicy=e.tileDiscardPolicy,this._tileWidth=y(e.tileWidth,256),this._tileHeight=y(e.tileHeight,256),this._maximumLevel=e.maximumLevel,this._tilingScheme=y(e.tilingScheme,new $i({ellipsoid:e.ellipsoid})),this._useTiles=y(e.usePreCachedTilesIfAvailable,!0),this._rectangle=y(e.rectangle,this._tilingScheme.rectangle),this._layers=e.layers,this._credit=e.credit,this._tileCredits=void 0;let t=e.credit;typeof t=="string"&&(t=new Pt(t)),this.enablePickFeatures=y(e.enablePickFeatures,!0),this._errorEvent=new pe}om.fromBasemapType=async function(e,t){A.defined("style",e),t=y(t,y.EMPTY_OBJECT);let n,i,o;switch(e){case im.SATELLITE:{n=y(t.token,Vd.defaultAccessToken),i=De.createIfNeeded(Vd.defaultWorldImageryServer),i.appendForwardSlash();let r=Vd.getDefaultTokenCredit(n);c(r)&&(o=Pt.clone(r))}break;case im.OCEANS:{n=y(t.token,Vd.defaultAccessToken),i=De.createIfNeeded(Vd.defaultWorldOceanServer),i.appendForwardSlash();let r=Vd.getDefaultTokenCredit(n);c(r)&&(o=Pt.clone(r))}break;case im.HILLSHADE:{n=y(t.token,Vd.defaultAccessToken),i=De.createIfNeeded(Vd.defaultWorldHillshadeServer),i.appendForwardSlash();let r=Vd.getDefaultTokenCredit(n);c(r)&&(o=Pt.clone(r))}break;default:throw new E(`Unsupported basemap type: ${e}`)}return om.fromUrl(i,{...t,token:n,credit:o,usePreCachedTilesIfAvailable:!0})};function Bge(e,t,n,i,o){let r;if(e._useTiles)r=e._resource.getDerivedResource({url:`tile/${i}/${n}/${t}`,request:o});else{let s=e._tilingScheme.tileXYToNativeRectangle(t,n,i),l={bbox:`${s.west},${s.south},${s.east},${s.north}`,size:`${e._tileWidth},${e._tileHeight}`,format:"png32",transparent:!0,f:"image"};e._tilingScheme.projection instanceof Mi?(l.bboxSR=4326,l.imageSR=4326):(l.bboxSR=3857,l.imageSR=3857),e.layers&&(l.layers=`show:${e.layers}`),r=e._resource.getDerivedResource({url:"export",request:o,queryParameters:l})}return r}Object.defineProperties(om.prototype,{url:{get:function(){return this._resource._url}},token:{get:function(){return this._resource.queryParameters.token}},proxy:{get:function(){return this._resource.proxy}},tileWidth:{get:function(){return this._tileWidth}},tileHeight:{get:function(){return this._tileHeight}},maximumLevel:{get:function(){return this._maximumLevel}},minimumLevel:{get:function(){return 0}},tilingScheme:{get:function(){return this._tilingScheme}},rectangle:{get:function(){return this._rectangle}},tileDiscardPolicy:{get:function(){return this._tileDiscardPolicy}},errorEvent:{get:function(){return this._errorEvent}},credit:{get:function(){return this._credit}},usingPrecachedTiles:{get:function(){return this._useTiles}},hasAlphaChannel:{get:function(){return!0}},layers:{get:function(){return this._layers}}});om.fromUrl=async function(e,t){A.defined("url",e),t=y(t,y.EMPTY_OBJECT);let n=De.createIfNeeded(e);n.appendForwardSlash(),c(t.token)&&n.setQueryParameters({token:t.token});let i=new om(t);i._resource=n;let o=new Fge(t);return y(t.usePreCachedTilesIfAvailable,!0)&&await Gst(n,o),o.build(i),i};om.prototype.getTileCredits=function(e,t,n){return this._tileCredits};om.prototype.requestImage=function(e,t,n,i){return mu.loadImage(this,Bge(this,e,t,n,i))};om.prototype.pickFeatures=function(e,t,n,i,o){if(!this.enablePickFeatures)return;let r=this._tilingScheme.tileXYToNativeRectangle(e,t,n),s,a,l;if(this._tilingScheme.projection instanceof Mi)s=R.toDegrees(i),a=R.toDegrees(o),l="4326";else{let p=this._tilingScheme.projection.project(new he(i,o,0));s=p.x,a=p.y,l="3857"}let u="visible";c(this._layers)&&(u+=`:${this._layers}`);let f={f:"json",tolerance:2,geometryType:"esriGeometryPoint",geometry:`${s},${a}`,mapExtent:`${r.west},${r.south},${r.east},${r.north}`,imageDisplay:`${this._tileWidth},${this._tileHeight},96`,sr:l,layers:u};return this._resource.getDerivedResource({url:"identify",queryParameters:f}).fetchJson().then(function(p){let g=[],m=p.results;if(!c(m))return g;for(let b=0;b<m.length;++b){let x=m[b],T=new Qp;if(T.data=x,T.name=x.value,T.properties=x.attributes,T.configureDescriptionFromProperties(x.attributes),x.geometryType==="esriGeometryPoint"&&x.geometry){let C=x.geometry.spatialReference&&x.geometry.spatialReference.wkid?x.geometry.spatialReference.wkid:4326;if(C===4326||C===4283)T.position=he.fromDegrees(x.geometry.x,x.geometry.y,x.geometry.z);else if(C===102100||C===900913||C===3857){let S=new Li;T.position=S.unproject(new h(x.geometry.x,x.geometry.y,x.geometry.z))}}g.push(T)}return g})};om._metadataCache={};var sy=om;function zb(){this._uniformMap=void 0,this._command=void 0,this._colorTexture=void 0,this._depthTexture=void 0,this._ready=!1,this._name="czm_autoexposure",this._logDepthChanged=void 0,this._useLogDepth=void 0,this._framebuffers=void 0,this._previousLuminance=new gi,this._commands=void 0,this._clearCommand=void 0,this._minMaxLuminance=new H,this.enabled=!0,this._enabled=!0,this.minimumLuminance=.1,this.maximumLuminance=10}Object.defineProperties(zb.prototype,{ready:{get:function(){return this._ready}},name:{get:function(){return this._name}},outputTexture:{get:function(){let e=this._framebuffers;if(c(e))return e[e.length-1].getColorTexture(0)}}});function kge(e){let t=e._framebuffers;if(!c(t))return;let n=t.length;for(let i=0;i<n;++i)t[i].destroy();e._framebuffers=void 0,e._previousLuminance.destroy(),e._previousLuminance=void 0}function jst(e,t){kge(e);let n=e._width,i=e._height,o=t.halfFloatingPointTexture?Be.HALF_FLOAT:Be.FLOAT,r=Math.ceil(Math.log(Math.max(n,i))/Math.log(3)),s=new Array(r);for(let l=0;l<r;++l)n=Math.max(Math.ceil(n/3),1),i=Math.max(Math.ceil(i/3),1),s[l]=new gi,s[l].update(t,n,i,1,o);let a=s[r-1].getColorTexture(0);e._previousLuminance.update(t,a.width,a.height,1,o),e._framebuffers=s}function Vge(e){let t=e._commands;if(!c(t))return;let n=t.length;for(let i=0;i<n;++i)t[i].shaderProgram.destroy();e._commands=void 0}function Wst(e,t){let n;if(t===0)n={colorTexture:function(){return e._colorTexture},colorTextureDimensions:function(){return e._colorTexture.dimensions}};else{let i=e._framebuffers[t-1].getColorTexture(0);n={colorTexture:function(){return i},colorTextureDimensions:function(){return i.dimensions}}}return n.minMaxLuminance=function(){return e._minMaxLuminance},n.previousLuminance=function(){return e._previousLuminance.getColorTexture(0)},n}function qst(e,t){let n=`uniform sampler2D colorTexture; 
in vec2 v_textureCoordinates; 
float sampleTexture(vec2 offset) { 
`;return e===0?n+=`    vec4 color = texture(colorTexture, v_textureCoordinates + offset); 
    return czm_luminance(color.rgb); 
`:n+=`    return texture(colorTexture, v_textureCoordinates + offset).r; 
`,n+=`}

`,n+=`uniform vec2 colorTextureDimensions; 
uniform vec2 minMaxLuminance; 
uniform sampler2D previousLuminance; 
void main() { 
    float color = 0.0; 
    float xStep = 1.0 / colorTextureDimensions.x; 
    float yStep = 1.0 / colorTextureDimensions.y; 
    int count = 0; 
    for (int i = 0; i < 3; ++i) { 
        for (int j = 0; j < 3; ++j) { 
            vec2 offset; 
            offset.x = -xStep + float(i) * xStep; 
            offset.y = -yStep + float(j) * yStep; 
            if (offset.x < 0.0 || offset.x > 1.0 || offset.y < 0.0 || offset.y > 1.0) { 
                continue; 
            } 
            color += sampleTexture(offset); 
            ++count; 
        } 
    } 
    if (count > 0) { 
        color /= float(count); 
    } 
`,e===t-1&&(n+=`    float previous = texture(previousLuminance, vec2(0.5)).r; 
    color = clamp(color, minMaxLuminance.x, minMaxLuminance.y); 
    color = previous + (color - previous) / (60.0 * 1.5); 
    color = clamp(color, minMaxLuminance.x, minMaxLuminance.y); 
`),n+=`    out_FragColor = vec4(color); 
} 
`,n}function Yst(e,t){Vge(e);let n=e._framebuffers,i=n.length,o=new Array(i);for(let r=0;r<i;++r)o[r]=t.createViewportQuadCommand(qst(r,i),{framebuffer:n[r].framebuffer,uniformMap:Wst(e,r)});e._commands=o}zb.prototype.clear=function(e){let t=this._framebuffers;if(!c(t))return;let n=this._clearCommand;c(n)||(n=this._clearCommand=new ri({color:new j(0,0,0,0),framebuffer:void 0}));let i=t.length;for(let o=0;o<i;++o)t[o].clear(e,n)};zb.prototype.update=function(e){let t=e.drawingBufferWidth,n=e.drawingBufferHeight;(t!==this._width||n!==this._height)&&(this._width=t,this._height=n,jst(this,e),Yst(this,e),this._ready||(this._ready=!0)),this._minMaxLuminance.x=this.minimumLuminance,this._minMaxLuminance.y=this.maximumLuminance;let i=this._framebuffers,o=i[i.length-1];i[i.length-1]=this._previousLuminance,this._commands[this._commands.length-1].framebuffer=this._previousLuminance.framebuffer,this._previousLuminance=o};zb.prototype.execute=function(e,t){this._colorTexture=t;let n=this._commands;if(!c(n))return;let i=n.length;for(let o=0;o<i;++o)n[o].execute(e)};zb.prototype.isDestroyed=function(){return!1};zb.prototype.destroy=function(){return kge(this),Vge(this),de(this)};var uq=zb;var Xst={AERIAL:"Aerial",AERIAL_WITH_LABELS:"AerialWithLabels",AERIAL_WITH_LABELS_ON_DEMAND:"AerialWithLabelsOnDemand",ROAD:"Road",ROAD_ON_DEMAND:"RoadOnDemand",CANVAS_DARK:"CanvasDark",CANVAS_LIGHT:"CanvasLight",CANVAS_GRAY:"CanvasGray",ORDNANCE_SURVEY:"OrdnanceSurvey",COLLINS_BART:"CollinsBart"},RL=Object.freeze(Xst);function ID(e){}ID.prototype.isReady=function(){return!0};ID.prototype.shouldDiscardImage=function(e){return ID.EMPTY_IMAGE===e};var ML;Object.defineProperties(ID,{EMPTY_IMAGE:{get:function(){return c(ML)||(ML=new Image,ML.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII="),ML}}});var LL=ID;function Uge(e){this.tileWidth=void 0,this.tileHeight=void 0,this.maximumLevel=void 0,this.imageUrlSubdomains=void 0,this.imageUrlTemplate=void 0,this.attributionList=void 0}Uge.prototype.build=function(e){e._tileWidth=this.tileWidth,e._tileHeight=this.tileHeight,e._maximumLevel=this.maximumLevel,e._imageUrlSubdomains=this.imageUrlSubdomains,e._imageUrlTemplate=this.imageUrlTemplate;let t=e._attributionList=this.attributionList;t||(t=[]),e._attributionList=t;for(let n=0,i=t.length;n<i;++n){let o=t[n];if(o.credit instanceof Pt)break;o.credit=new Pt(o.attribution);let r=o.coverageAreas;for(let s=0,a=o.coverageAreas.length;s<a;++s){let l=r[s],u=l.bbox;l.bbox=new ae(R.toRadians(u[1]),R.toRadians(u[0]),R.toRadians(u[3]),R.toRadians(u[2]))}}};function Kst(e,t){if(e.resourceSets.length!==1)throw new ue("metadata does not specify one resource in resourceSets");let n=e.resourceSets[0].resources[0];t.tileWidth=n.imageWidth,t.tileHeight=n.imageHeight,t.maximumLevel=n.zoomMax-1,t.imageUrlSubdomains=n.imageUrlSubdomains,t.imageUrlTemplate=n.imageUrl;let i=n.imageryProviders;c(n.imageryProviders)&&(i=n.imageryProviders.filter(o=>o.coverageAreas?.some(r=>c(r.bbox)))),t.attributionList=i}function $st(e,t,n){let i=`An error occurred while accessing ${e.url}`;throw c(t)&&c(t.message)&&(i+=`: ${t.message}`),No.reportError(void 0,n,c(n)?n._errorEvent:void 0,i,void 0,void 0,void 0,t),new ue(i)}async function Zst(e,t,n){let i=e.url,o=xs._metadataCache[i];c(o)||(o=e.fetchJsonp("jsonp"),xs._metadataCache[i]=o);try{let r=await o;return Kst(r,t)}catch(r){$st(e,r,n)}}function xs(e){e=y(e,y.EMPTY_OBJECT),this._defaultAlpha=void 0,this._defaultNightAlpha=void 0,this._defaultDayAlpha=void 0,this._defaultBrightness=void 0,this._defaultContrast=void 0,this._defaultHue=void 0,this._defaultSaturation=void 0,this._defaultGamma=1,this._defaultMinificationFilter=void 0,this._defaultMagnificationFilter=void 0,this._mapStyle=y(e.mapStyle,RL.AERIAL),this._mapLayer=e.mapLayer,this._culture=y(e.culture,""),this._key=e.key,this._tileDiscardPolicy=e.tileDiscardPolicy,c(this._tileDiscardPolicy)||(this._tileDiscardPolicy=new LL),this._proxy=e.proxy,this._credit=new Pt(`<a href="https://www.microsoft.com/en-us/maps/bing-maps/product"><img src="${xs.logoUrl}" title="Bing Imagery"/></a>`),this._tilingScheme=new ys({numberOfLevelZeroTilesX:2,numberOfLevelZeroTilesY:2,ellipsoid:e.ellipsoid}),this._tileWidth=void 0,this._tileHeight=void 0,this._maximumLevel=void 0,this._imageUrlTemplate=void 0,this._imageUrlSubdomains=void 0,this._attributionList=void 0,this._errorEvent=new pe}Object.defineProperties(xs.prototype,{url:{get:function(){return this._resource.url}},proxy:{get:function(){return this._resource.proxy}},key:{get:function(){return this._key}},mapStyle:{get:function(){return this._mapStyle}},mapLayer:{get:function(){return this._mapLayer}},culture:{get:function(){return this._culture}},tileWidth:{get:function(){return this._tileWidth}},tileHeight:{get:function(){return this._tileHeight}},maximumLevel:{get:function(){return this._maximumLevel}},minimumLevel:{get:function(){return 0}},tilingScheme:{get:function(){return this._tilingScheme}},rectangle:{get:function(){return this._tilingScheme.rectangle}},tileDiscardPolicy:{get:function(){return this._tileDiscardPolicy}},errorEvent:{get:function(){return this._errorEvent}},credit:{get:function(){return this._credit}},hasAlphaChannel:{get:function(){return c(this.mapLayer)}}});xs.fromUrl=async function(e,t){t=y(t,y.EMPTY_OBJECT),A.defined("url",e),A.defined("options.key",t.key);let n=t.tileProtocol;c(n)?n.length>0&&n[n.length-1]===":"&&(n=n.substr(0,n.length-1)):n=document.location.protocol==="http:"?"http":"https";let i=y(t.mapStyle,RL.AERIAL),o=De.createIfNeeded(e);o.appendForwardSlash();let r={incl:"ImageryProviders",key:t.key,uriScheme:n};c(t.mapLayer)&&(r.mapLayer=t.mapLayer),c(t.culture)&&(r.culture=t.culture);let s=o.getDerivedResource({url:`REST/v1/Imagery/Metadata/${i}`,queryParameters:r}),a=new xs(t);a._resource=o;let l=new Uge(t);return await Zst(s,l),l.build(a),a};var Jst=new ae;xs.prototype.getTileCredits=function(e,t,n){let i=this._tilingScheme.tileXYToRectangle(e,t,n,Jst);return tat(this._attributionList,n,i)};xs.prototype.requestImage=function(e,t,n,i){let o=mu.loadImage(this,Qst(this,e,t,n,i));if(c(o))return o.catch(function(r){return c(r.blob)&&r.blob.size===0?LL.EMPTY_IMAGE:Promise.reject(r)})};xs.prototype.pickFeatures=function(e,t,n,i,o){};xs.tileXYToQuadKey=function(e,t,n){let i="";for(let o=n;o>=0;--o){let r=1<<o,s=0;e&r&&(s|=1),t&r&&(s|=2),i+=s}return i};xs.quadKeyToTileXY=function(e){let t=0,n=0,i=e.length-1;for(let o=i;o>=0;--o){let r=1<<o,s=+e[i-o];s&1&&(t|=r),s&2&&(n|=r)}return{x:t,y:n,level:i}};xs._logoUrl=void 0;Object.defineProperties(xs,{logoUrl:{get:function(){return c(xs._logoUrl)||(xs._logoUrl=sn("Assets/Images/bing_maps_credit.png")),xs._logoUrl},set:function(e){A.defined("value",e),xs._logoUrl=e}}});function Qst(e,t,n,i,o){let r=e._imageUrlTemplate,s=e._imageUrlSubdomains,a=(t+n+i)%s.length;return e._resource.getDerivedResource({url:r,request:o,templateValues:{quadkey:xs.tileXYToQuadKey(t,n,i),subdomain:s[a],culture:e._culture},queryParameters:{n:"z"}})}var eat=new ae;function tat(e,t,n){++t;let i=[];for(let o=0,r=e.length;o<r;++o){let s=e[o],a=s.coverageAreas,l=!1;for(let u=0,f=s.coverageAreas.length;!l&&u<f;++u){let d=a[u];if(t>=d.zoomMin&&t<=d.zoomMax){let p=ae.intersection(n,d.bbox,eat);c(p)&&(l=!0)}}l&&i.push(s.credit)}return i}xs._metadataCache={};var fq=xs;var nat=new h(1,1,1);function dq(e){e=y(e,nat),A.defined("dimensions",e),A.typeOf.number.greaterThanOrEquals("dimensions.x",e.x,0),A.typeOf.number.greaterThanOrEquals("dimensions.y",e.y,0),A.typeOf.number.greaterThanOrEquals("dimensions.z",e.z,0),this._dimensions=h.clone(e)}Object.defineProperties(dq.prototype,{dimensions:{get:function(){return this._dimensions},set:function(e){A.defined("value",e),A.typeOf.number.greaterThanOrEquals("value.x",e.x,0),A.typeOf.number.greaterThanOrEquals("value.y",e.y,0),A.typeOf.number.greaterThanOrEquals("value.z",e.z,0),h.clone(e,this._dimensions)}}});var iat=new h;dq.prototype.emit=function(e){let t=this._dimensions,n=h.multiplyByScalar(t,.5,iat),i=R.randomBetween(-n.x,n.x),o=R.randomBetween(-n.y,n.y),r=R.randomBetween(-n.z,n.z);e.position=h.fromElements(i,o,r,e.position),e.velocity=h.normalize(e.position,e.velocity)};var oat=dq;var hq=`in vec2 v_textureCoordinates;
const float M_PI = 3.141592653589793;
float vdcRadicalInverse(int i)
{
float r;
float base = 2.0;
float value = 0.0;
float invBase = 1.0 / base;
float invBi = invBase;
for (int x = 0; x < 100; x++)
{
if (i <= 0)
{
break;
}
r = mod(float(i), base);
value += r * invBi;
invBi *= invBase;
i = int(float(i) * invBase);
}
return value;
}
vec2 hammersley2D(int i, int N)
{
return vec2(float(i) / float(N), vdcRadicalInverse(i));
}
vec3 importanceSampleGGX(vec2 xi, float alphaRoughness, vec3 N)
{
float alphaRoughnessSquared = alphaRoughness * alphaRoughness;
float phi = 2.0 * M_PI * xi.x;
float cosTheta = sqrt((1.0 - xi.y) / (1.0 + (alphaRoughnessSquared - 1.0) * xi.y));
float sinTheta = sqrt(1.0 - cosTheta * cosTheta);
vec3 H = vec3(sinTheta * cos(phi), sinTheta * sin(phi), cosTheta);
vec3 upVector = abs(N.z) < 0.999 ? vec3(0.0, 0.0, 1.0) : vec3(1.0, 0.0, 0.0);
vec3 tangentX = normalize(cross(upVector, N));
vec3 tangentY = cross(N, tangentX);
return tangentX * H.x + tangentY * H.y + N * H.z;
}
float smithVisibilityGGX(float alphaRoughness, float NdotL, float NdotV)
{
float alphaRoughnessSq = alphaRoughness * alphaRoughness;
float GGXV = NdotL * sqrt(NdotV * NdotV * (1.0 - alphaRoughnessSq) + alphaRoughnessSq);
float GGXL = NdotV * sqrt(NdotL * NdotL * (1.0 - alphaRoughnessSq) + alphaRoughnessSq);
float GGX = GGXV + GGXL;
if (GGX > 0.0)
{
return 0.5 / GGX;
}
return 0.0;
}
vec2 integrateBrdf(float roughness, float NdotV)
{
vec3 V = vec3(sqrt(1.0 - NdotV * NdotV), 0.0, NdotV);
float A = 0.0;
float B = 0.0;
const int NumSamples = 1024;
float alphaRoughness = roughness * roughness;
for (int i = 0; i < NumSamples; i++)
{
vec2 xi = hammersley2D(i, NumSamples);
vec3 H = importanceSampleGGX(xi, alphaRoughness, vec3(0.0, 0.0, 1.0));
vec3 L = 2.0 * dot(V, H) * H - V;
float NdotL = clamp(L.z, 0.0, 1.0);
float NdotH = clamp(H.z, 0.0, 1.0);
float VdotH = clamp(dot(V, H), 0.0, 1.0);
if (NdotL > 0.0)
{
float G = smithVisibilityGGX(alphaRoughness, NdotL, NdotV);
float G_Vis = 4.0 * G * VdotH * NdotL / NdotH;
float Fc = pow(1.0 - VdotH, 5.0);
A += (1.0 - Fc) * G_Vis;
B += Fc * G_Vis;
}
}
return vec2(A, B) / float(NumSamples);
}
void main()
{
out_FragColor = vec4(integrateBrdf(v_textureCoordinates.y, v_textureCoordinates.x), 0.0, 1.0);
}
`;function OD(){this._colorTexture=void 0,this._drawCommand=void 0}Object.defineProperties(OD.prototype,{colorTexture:{get:function(){return this._colorTexture}}});function rat(e,t,n){let i=t.createViewportQuadCommand(hq,{framebuffer:n,renderState:ze.fromCache({viewport:new Ke(0,0,256,256)})});e._drawCommand=i}OD.prototype.update=function(e){if(!c(this._colorTexture)){let t=e.context,n=new Lt({context:t,width:256,height:256,pixelFormat:Ve.RGBA,pixelDatatype:Be.UNSIGNED_BYTE,sampler:Qt.NEAREST});this._colorTexture=n;let i=new Jr({context:t,colorTextures:[n],destroyAttachments:!1});rat(this,t,i),this._drawCommand.execute(t),i.destroy(),this._drawCommand.shaderProgram=this._drawCommand.shaderProgram&&this._drawCommand.shaderProgram.destroy()}};OD.prototype.isDestroyed=function(){return!1};OD.prototype.destroy=function(){return this._colorTexture=this._colorTexture&&this._colorTexture.destroy(),de(this)};var mq=OD;var sat=new H;function aat(e,t){A.typeOf.object("clippingPlaneCollection",e),A.typeOf.object("context",t);let n=e.unionClippingRegions,i=e.length,o=Ms.useFloatTexture(t),r=Ms.getTextureResolution(e,t,sat),s=r.x,a=r.y,l=o?uat(s,a):fat(s,a);return l+=`
`,l+=n?cat(i):lat(i),l}function cat(e){return`float clip(vec4 fragCoord, sampler2D clippingPlanes, mat4 clippingPlanesMatrix)
{
    vec4 position = czm_windowToEyeCoordinates(fragCoord);
    vec3 clipNormal = vec3(0.0);
    vec3 clipPosition = vec3(0.0);
    float clipAmount;
    float pixelWidth = czm_metersPerPixel(position);
    bool breakAndDiscard = false;
    for (int i = 0; i < ${e}; ++i)
    {
        vec4 clippingPlane = getClippingPlane(clippingPlanes, i, clippingPlanesMatrix);
        clipNormal = clippingPlane.xyz;
        clipPosition = -clippingPlane.w * clipNormal;
        float amount = dot(clipNormal, (position.xyz - clipPosition)) / pixelWidth;
        clipAmount = czm_branchFreeTernary(i == 0, amount, min(amount, clipAmount));
        if (amount <= 0.0)
        {
           breakAndDiscard = true;
           break;
        }
    }
    if (breakAndDiscard) {
        discard;
    }
    return clipAmount;
}
`}function lat(e){return`float clip(vec4 fragCoord, sampler2D clippingPlanes, mat4 clippingPlanesMatrix)
{
    bool clipped = true;
    vec4 position = czm_windowToEyeCoordinates(fragCoord);
    vec3 clipNormal = vec3(0.0);
    vec3 clipPosition = vec3(0.0);
    float clipAmount = 0.0;
    float pixelWidth = czm_metersPerPixel(position);
    for (int i = 0; i < ${e}; ++i)
    {
        vec4 clippingPlane = getClippingPlane(clippingPlanes, i, clippingPlanesMatrix);
        clipNormal = clippingPlane.xyz;
        clipPosition = -clippingPlane.w * clipNormal;
        float amount = dot(clipNormal, (position.xyz - clipPosition)) / pixelWidth;
        clipAmount = max(amount, clipAmount);
        clipped = clipped && (amount <= 0.0);
    }
    if (clipped)
    {
        discard;
    }
    return clipAmount;
}
`}function uat(e,t){let n=1/e,i=1/t,o=`${n}`;o.indexOf(".")===-1&&(o+=".0");let r=`${i}`;return r.indexOf(".")===-1&&(r+=".0"),`vec4 getClippingPlane(highp sampler2D packedClippingPlanes, int clippingPlaneNumber, mat4 transform)
{
    int pixY = clippingPlaneNumber / ${e};
    int pixX = clippingPlaneNumber - (pixY * ${e});
    float u = (float(pixX) + 0.5) * ${o};
    float v = (float(pixY) + 0.5) * ${r};
    vec4 plane = texture(packedClippingPlanes, vec2(u, v));
    return czm_transformPlane(plane, transform);
}
`}function fat(e,t){let n=1/e,i=1/t,o=`${n}`;o.indexOf(".")===-1&&(o+=".0");let r=`${i}`;return r.indexOf(".")===-1&&(r+=".0"),`vec4 getClippingPlane(highp sampler2D packedClippingPlanes, int clippingPlaneNumber, mat4 transform)
{
    int clippingPlaneStartIndex = clippingPlaneNumber * 2;
    int pixY = clippingPlaneStartIndex / ${e};
    int pixX = clippingPlaneStartIndex - (pixY * ${e});
    float u = (float(pixX) + 0.5) * ${o};
    float v = (float(pixY) + 0.5) * ${r};
    vec4 oct32 = texture(packedClippingPlanes, vec2(u, v)) * 255.0;
    vec2 oct = vec2(oct32.x * 256.0 + oct32.y, oct32.z * 256.0 + oct32.w);
    vec4 plane;
    plane.xyz = czm_octDecode(oct, 65535.0);
    plane.w = czm_unpackFloat(texture(packedClippingPlanes, vec2(u + ${o}, v)));
    return czm_transformPlane(plane, transform);
}
`}var Hb=aat;var pq=`struct Ray {
vec3 pos;
vec3 dir;
vec3 rawDir;
};
#if defined(JITTER)
float hash(vec2 p)
{
vec3 p3 = fract(vec3(p.xyx) * 50.0);
p3 += dot(p3, p3.yzx + 19.19);
return fract((p3.x + p3.y) * p3.z);
}
#endif
float minComponent(in vec3 v) {
return min(min(v.x, v.y), v.z);
}
float maxComponent(in vec3 v) {
return max(max(v.x, v.y), v.z);
}
struct PointJacobianT {
vec3 point;
mat3 jacobianT;
};
`;var _q=`#define STEP_COUNT_MAX 1000 // Harcoded value because GLSL doesn't like variable length loops
#if defined(PICKING_VOXEL)
#define ALPHA_ACCUM_MAX 0.1
#else
#define ALPHA_ACCUM_MAX 0.98 // Must be > 0.0 and <= 1.0
#endif
uniform mat3 u_transformDirectionViewToLocal;
uniform vec3 u_cameraPositionUv;
uniform float u_stepSize;
#if defined(PICKING)
uniform vec4 u_pickColor;
#endif
vec3 getSampleSize(in int level) {
vec3 sampleCount = exp2(float(level)) * vec3(u_dimensions);
vec3 sampleSizeUv = 1.0 / sampleCount;
return scaleShapeUvToShapeSpace(sampleSizeUv);
}
#define MINIMUM_STEP_SCALAR (0.02)
#define SHIFT_FRACTION (0.001)
RayShapeIntersection getVoxelIntersection(in vec3 tileUv, in vec3 sampleSizeAlongRay) {
vec3 voxelCoord = tileUv * vec3(u_dimensions);
vec3 directions = sign(sampleSizeAlongRay);
vec3 positiveDirections = max(directions, 0.0);
vec3 entryCoord = mix(ceil(voxelCoord), floor(voxelCoord), positiveDirections);
vec3 exitCoord = entryCoord + directions;
vec3 distanceFromEntry = -abs((entryCoord - voxelCoord) * sampleSizeAlongRay);
float lastEntry = maxComponent(distanceFromEntry);
bvec3 isLastEntry = equal(distanceFromEntry, vec3(lastEntry));
vec3 entryNormal = -1.0 * vec3(isLastEntry) * directions;
vec4 entry = vec4(entryNormal, lastEntry);
vec3 distanceToExit = abs((exitCoord - voxelCoord) * sampleSizeAlongRay);
float firstExit = minComponent(distanceToExit);
bvec3 isFirstExit = equal(distanceToExit, vec3(firstExit));
vec3 exitNormal = vec3(isFirstExit) * directions;
vec4 exit = vec4(exitNormal, firstExit);
return RayShapeIntersection(entry, exit);
}
vec4 getStepSize(in SampleData sampleData, in Ray viewRay, in RayShapeIntersection shapeIntersection, in mat3 jacobianT, in float currentT) {
vec3 gradient = 2.0 * viewRay.rawDir * jacobianT;
vec3 sampleSizeAlongRay = getSampleSize(sampleData.tileCoords.w) / gradient;
RayShapeIntersection voxelIntersection = getVoxelIntersection(sampleData.tileUv, sampleSizeAlongRay);
vec3 voxelNormal = normalize(jacobianT * voxelIntersection.entry.xyz);
vec4 voxelEntry = vec4(voxelNormal, currentT + voxelIntersection.entry.w);
vec4 entry = intersectionMax(shapeIntersection.entry, voxelEntry);
float fixedStep = minComponent(abs(sampleSizeAlongRay)) * u_stepSize;
float shift = fixedStep * SHIFT_FRACTION;
float dt = voxelIntersection.exit.w + shift;
if ((currentT + dt) > shapeIntersection.exit.w) {
dt = shapeIntersection.exit.w - currentT + shift;
}
float stepSize = clamp(dt, fixedStep * MINIMUM_STEP_SCALAR, fixedStep + shift);
return vec4(entry.xyz, stepSize);
}
vec2 packIntToVec2(int value) {
float shifted = float(value) / 255.0;
float lowBits = fract(shifted);
float highBits = floor(shifted) / 255.0;
return vec2(highBits, lowBits);
}
vec2 packFloatToVec2(float value) {
float lowBits = fract(value);
float highBits = floor(value) / 255.0;
return vec2(highBits, lowBits);
}
int getSampleIndex(in vec3 tileUv) {
ivec3 voxelDimensions = u_dimensions;
vec3 sampleCoordinate = tileUv * vec3(voxelDimensions);
vec3 maxCoordinate = vec3(voxelDimensions) - vec3(0.5);
sampleCoordinate = clamp(sampleCoordinate, vec3(0.0), maxCoordinate);
ivec3 sampleIndex = ivec3(floor(sampleCoordinate));
#if defined(PADDING)
voxelDimensions += u_paddingBefore + u_paddingAfter;
sampleIndex += u_paddingBefore;
#endif
return sampleIndex.x + voxelDimensions.x * (sampleIndex.y + voxelDimensions.y * sampleIndex.z);
}
void main()
{
vec4 fragCoord = gl_FragCoord;
vec2 screenCoord = (fragCoord.xy - czm_viewport.xy) / czm_viewport.zw;
vec3 eyeDirection = normalize(czm_windowToEyeCoordinates(fragCoord).xyz);
vec3 viewDirWorld = normalize(czm_inverseViewRotation * eyeDirection);
vec3 viewDirUv = normalize(u_transformDirectionViewToLocal * eyeDirection);
vec3 viewPosUv = u_cameraPositionUv;
#if defined(SHAPE_ELLIPSOID)
vec3 rawDir = viewDirUv * u_ellipsoidRadiiUv;
Ray viewRayUv = Ray(viewPosUv, viewDirUv, rawDir);
#else
Ray viewRayUv = Ray(viewPosUv, viewDirUv, viewDirUv);
#endif
Intersections ix;
RayShapeIntersection shapeIntersection = intersectScene(screenCoord, viewRayUv, ix);
if (shapeIntersection.entry.w == NO_HIT) {
discard;
}
float currentT = shapeIntersection.entry.w;
float endT = shapeIntersection.exit.w;
vec3 positionUv = viewPosUv + currentT * viewDirUv;
PointJacobianT pointJacobian = convertUvToShapeUvSpaceDerivative(positionUv);
TraversalData traversalData;
SampleData sampleDatas[SAMPLE_COUNT];
traverseOctreeFromBeginning(pointJacobian.point, traversalData, sampleDatas);
vec4 step = getStepSize(sampleDatas[0], viewRayUv, shapeIntersection, pointJacobian.jacobianT, currentT);
#if defined(JITTER)
float noise = hash(screenCoord);
currentT += noise * step.w;
positionUv += noise * step.w * viewDirUv;
#endif
FragmentInput fragmentInput;
#if defined(STATISTICS)
setStatistics(fragmentInput.metadata.statistics);
#endif
vec4 colorAccum = vec4(0.0);
for (int stepCount = 0; stepCount < STEP_COUNT_MAX; ++stepCount) {
Properties properties = accumulatePropertiesFromMegatexture(sampleDatas);
copyPropertiesToMetadata(properties, fragmentInput.metadata);
fragmentInput.voxel.positionUv = positionUv;
fragmentInput.voxel.positionShapeUv = pointJacobian.point;
fragmentInput.voxel.positionUvLocal = sampleDatas[0].tileUv;
fragmentInput.voxel.viewDirUv = viewDirUv;
fragmentInput.voxel.viewDirWorld = viewDirWorld;
fragmentInput.voxel.surfaceNormal = step.xyz;
fragmentInput.voxel.travelDistance = step.w;
fragmentInput.voxel.stepCount = stepCount;
fragmentInput.voxel.tileIndex = sampleDatas[0].megatextureIndex;
fragmentInput.voxel.sampleIndex = getSampleIndex(sampleDatas[0].tileUv);
czm_modelMaterial materialOutput;
fragmentMain(fragmentInput, materialOutput);
vec4 color = vec4(materialOutput.diffuse, materialOutput.alpha);
color.rgb = max(color.rgb, vec3(0.0));
color.a = clamp(color.a, 0.0, 1.0);
colorAccum += (1.0 - colorAccum.a) * vec4(color.rgb * color.a, color.a);
if (colorAccum.a > ALPHA_ACCUM_MAX) {
colorAccum.a = ALPHA_ACCUM_MAX;
break;
}
if (step.w == 0.0) {
step.w == 0.00001;
}
currentT += step.w;
positionUv = viewPosUv + currentT * viewDirUv;
if (currentT > endT) {
#if (INTERSECTION_COUNT == 1)
break;
#else
shapeIntersection = nextIntersection(ix);
if (shapeIntersection.entry.w == NO_HIT) {
break;
} else {
currentT = shapeIntersection.entry.w;
endT = shapeIntersection.exit.w;
positionUv = viewPosUv + currentT * viewDirUv;
}
#endif
}
pointJacobian = convertUvToShapeUvSpaceDerivative(positionUv);
traverseOctreeFromExisting(pointJacobian.point, traversalData, sampleDatas);
step = getStepSize(sampleDatas[0], viewRayUv, shapeIntersection, pointJacobian.jacobianT, currentT);
}
colorAccum.a /= ALPHA_ACCUM_MAX;
#if defined(PICKING)
if (colorAccum.a == 0.0) {
discard;
}
out_FragColor = u_pickColor;
#elif defined(PICKING_VOXEL)
if (colorAccum.a == 0.0) {
discard;
}
vec2 megatextureId = packIntToVec2(sampleDatas[0].megatextureIndex);
vec2 sampleIndex = packIntToVec2(getSampleIndex(sampleDatas[0].tileUv));
out_FragColor = vec4(megatextureId, sampleIndex);
#else
out_FragColor = colorAccum;
#endif
}
`;var gq=`in vec2 position;
uniform vec4 u_ndcSpaceAxisAlignedBoundingBox;
void main() {
vec2 aabbMin = u_ndcSpaceAxisAlignedBoundingBox.xy;
vec2 aabbMax = u_ndcSpaceAxisAlignedBoundingBox.zw;
vec2 translation = 0.5 * (aabbMax + aabbMin);
vec2 scale = 0.5 * (aabbMax - aabbMin);
gl_Position = vec4(position * scale + translation, 0.0, 1.0);
}
`;var yq=`#define NO_HIT (-czm_infinity)
#define INF_HIT (czm_infinity * 0.5)
struct RayShapeIntersection {
vec4 entry;
vec4 exit;
};
vec4 intersectionMin(in vec4 intersect0, in vec4 intersect1)
{
if (intersect0.w == NO_HIT) {
return intersect1;
} else if (intersect1.w == NO_HIT) {
return intersect0;
}
return (intersect0.w <= intersect1.w) ? intersect0 : intersect1;
}
vec4 intersectionMax(in vec4 intersect0, in vec4 intersect1)
{
return (intersect0.w >= intersect1.w) ? intersect0 : intersect1;
}
RayShapeIntersection intersectIntersections(in Ray ray, in RayShapeIntersection intersect0, in RayShapeIntersection intersect1)
{
bool missed = (intersect0.entry.w == NO_HIT) ||
(intersect1.entry.w == NO_HIT) ||
(intersect0.exit.w < intersect1.entry.w) ||
(intersect0.entry.w > intersect1.exit.w);
if (missed) {
vec4 miss = vec4(normalize(ray.dir), NO_HIT);
return RayShapeIntersection(miss, miss);
}
vec4 entry = intersectionMax(intersect0.entry, intersect1.entry);
vec4 exit = intersectionMin(intersect0.exit, intersect1.exit);
return RayShapeIntersection(entry, exit);
}
struct Intersections {
vec4 intersections[INTERSECTION_COUNT * 2];
#if (INTERSECTION_COUNT > 1)
int index;
int surroundCount;
bool surroundIsPositive;
#endif
};
RayShapeIntersection getFirstIntersection(in Intersections ix)
{
return RayShapeIntersection(ix.intersections[0], ix.intersections[1]);
}
vec4 encodeIntersectionType(vec4 intersection, int index, bool entry)
{
float scale = float(index > 0) * 2.0 + float(!entry) + 1.0;
return vec4(intersection.xyz * scale, intersection.w);
}
#define setIntersection(/*inout Intersections*/ ix, /*int*/ index, /*float*/ t, /*bool*/ positive, /*bool*/ enter) (ix).intersections[(index)] = vec4(0.0, float(!positive) * 2.0 + float(!enter) + 1.0, 0.0, (t))
#define setIntersectionPair(/*inout Intersections*/ ix, /*int*/ index, /*vec2*/ entryExit) (ix).intersections[(index) * 2 + 0] = vec4(0.0, float((index) > 0) * 2.0 + 1.0, 0.0, (entryExit).x); (ix).intersections[(index) * 2 + 1] = vec4(0.0, float((index) > 0) * 2.0 + 2.0, 0.0, (entryExit).y)
#define setSurfaceIntersection(/*inout Intersections*/ ix, /*int*/ index, /*vec4*/ intersection, /*bool*/ positive, /*bool*/ enter) (ix).intersections[(index)] = encodeIntersectionType((intersection), int(!positive), (enter))
#define setShapeIntersection(/*inout Intersections*/ ix, /*int*/ index, /*RayShapeIntersection*/ intersection) (ix).intersections[(index) * 2 + 0] = encodeIntersectionType((intersection).entry, (index), true); (ix).intersections[(index) * 2 + 1] = encodeIntersectionType((intersection).exit, (index), false)
#if (INTERSECTION_COUNT > 1)
void initializeIntersections(inout Intersections ix) {
const int sortPasses = INTERSECTION_COUNT * 2 - 1;
for (int n = sortPasses; n > 0; --n) {
for (int i = 0; i < sortPasses; ++i) {
if (i >= n) { break; }
vec4 intersect0 = ix.intersections[i + 0];
vec4 intersect1 = ix.intersections[i + 1];
bool inOrder = intersect0.w <= intersect1.w;
ix.intersections[i + 0] = inOrder ? intersect0 : intersect1;
ix.intersections[i + 1] = inOrder ? intersect1 : intersect0;
}
}
ix.index = 0;
ix.surroundCount = 0;
ix.surroundIsPositive = false;
}
#endif
#if (INTERSECTION_COUNT > 1)
RayShapeIntersection nextIntersection(inout Intersections ix) {
vec4 surfaceIntersection = vec4(0.0, 0.0, 0.0, NO_HIT);
RayShapeIntersection shapeIntersection = RayShapeIntersection(surfaceIntersection, surfaceIntersection);
const int passCount = INTERSECTION_COUNT * 2;
if (ix.index == passCount) {
return shapeIntersection;
}
for (int i = 0; i < passCount; ++i) {
if (i < ix.index) {
continue;
}
ix.index = i + 1;
surfaceIntersection = ix.intersections[i];
int intersectionType = int(length(surfaceIntersection.xyz) - 0.5);
bool currShapeIsPositive = intersectionType < 2;
bool enter = intMod(intersectionType, 2) == 0;
ix.surroundCount += enter ? +1 : -1;
ix.surroundIsPositive = currShapeIsPositive ? enter : ix.surroundIsPositive;
if (ix.surroundCount == 1 && ix.surroundIsPositive && enter == currShapeIsPositive) {
shapeIntersection.entry = surfaceIntersection;
}
bool exitPositive = !enter && currShapeIsPositive && ix.surroundCount == 0;
bool enterNegativeFromPositive = enter && !currShapeIsPositive && ix.surroundCount == 2 && ix.surroundIsPositive;
if (exitPositive || enterNegativeFromPositive) {
shapeIntersection.exit = surfaceIntersection;
if (exitPositive) {
ix.index = passCount;
}
break;
}
}
return shapeIntersection;
}
#endif
`;var bq=`uniform mat4 u_transformPositionViewToUv;
void intersectDepth(in vec2 screenCoord, in Ray ray, inout Intersections ix) {
float logDepthOrDepth = czm_unpackDepth(texture(czm_globeDepthTexture, screenCoord));
if (logDepthOrDepth != 0.0) {
vec4 eyeCoordinateDepth = czm_screenToEyeCoordinates(screenCoord, logDepthOrDepth);
eyeCoordinateDepth /= eyeCoordinateDepth.w;
vec3 depthPositionUv = vec3(u_transformPositionViewToUv * eyeCoordinateDepth);
float t = dot(depthPositionUv - ray.pos, ray.dir);
setIntersectionPair(ix, DEPTH_INTERSECTION_INDEX, vec2(t, +INF_HIT));
} else {
setIntersectionPair(ix, DEPTH_INTERSECTION_INDEX, vec2(NO_HIT));
}
}
`;var xq=`uniform sampler2D u_clippingPlanesTexture;
uniform mat4 u_clippingPlanesMatrix;
vec4 intersectPlane(in Ray ray, in vec4 plane) {
vec3 n = plane.xyz;
float w = plane.w;
float a = dot(ray.pos, n);
float b = dot(ray.dir, n);
float t = -(w + a) / b;
return vec4(n, t);
}
void intersectClippingPlanes(in Ray ray, inout Intersections ix) {
vec4 backSide = vec4(-ray.dir, -INF_HIT);
vec4 farSide = vec4(ray.dir, +INF_HIT);
RayShapeIntersection clippingVolume;
#if (CLIPPING_PLANES_COUNT == 1)
vec4 planeUv = getClippingPlane(u_clippingPlanesTexture, 0, u_clippingPlanesMatrix);
vec4 intersection = intersectPlane(ray, planeUv);
bool reflects = dot(ray.dir, intersection.xyz) < 0.0;
clippingVolume.entry = reflects ? backSide : intersection;
clippingVolume.exit = reflects ? intersection : farSide;
setShapeIntersection(ix, CLIPPING_PLANES_INTERSECTION_INDEX, clippingVolume);
#elif defined(CLIPPING_PLANES_UNION)
vec4 firstTransmission = vec4(ray.dir, +INF_HIT);
vec4 lastReflection = vec4(-ray.dir, -INF_HIT);
for (int i = 0; i < CLIPPING_PLANES_COUNT; i++) {
vec4 planeUv = getClippingPlane(u_clippingPlanesTexture, i, u_clippingPlanesMatrix);
vec4 intersection = intersectPlane(ray, planeUv);
if (dot(ray.dir, planeUv.xyz) > 0.0) {
firstTransmission = intersection.w <= firstTransmission.w ? intersection : firstTransmission;
} else {
lastReflection = intersection.w >= lastReflection.w ? intersection : lastReflection;
}
}
clippingVolume.entry = backSide;
clippingVolume.exit = lastReflection;
setShapeIntersection(ix, CLIPPING_PLANES_INTERSECTION_INDEX + 0, clippingVolume);
clippingVolume.entry = firstTransmission;
clippingVolume.exit = farSide;
setShapeIntersection(ix, CLIPPING_PLANES_INTERSECTION_INDEX + 1, clippingVolume);
#else // intersection
vec4 lastTransmission = vec4(ray.dir, -INF_HIT);
vec4 firstReflection = vec4(-ray.dir, +INF_HIT);
for (int i = 0; i < CLIPPING_PLANES_COUNT; i++) {
vec4 planeUv = getClippingPlane(u_clippingPlanesTexture, i, u_clippingPlanesMatrix);
vec4 intersection = intersectPlane(ray, planeUv);
if (dot(ray.dir, planeUv.xyz) > 0.0) {
lastTransmission = intersection.w > lastTransmission.w ? intersection : lastTransmission;
} else {
firstReflection = intersection.w < firstReflection.w ? intersection: firstReflection;
}
}
if (lastTransmission.w < firstReflection.w) {
clippingVolume.entry = lastTransmission;
clippingVolume.exit = firstReflection;
} else {
clippingVolume.entry = vec4(-ray.dir, NO_HIT);
clippingVolume.exit = vec4(ray.dir, NO_HIT);
}
setShapeIntersection(ix, CLIPPING_PLANES_INTERSECTION_INDEX, clippingVolume);
#endif
}
`;var NL=`vec4 intersectLongitude(in Ray ray, in float angle, in bool positiveNormal) {
float normalSign = positiveNormal ? 1.0 : -1.0;
vec2 planeNormal = vec2(-sin(angle), cos(angle)) * normalSign;
vec2 position = ray.pos.xy;
vec2 direction = ray.dir.xy;
float approachRate = dot(direction, planeNormal);
float distance = -dot(position, planeNormal);
float t = (approachRate == 0.0)
? NO_HIT
: distance / approachRate;
return vec4(planeNormal, 0.0, t);
}
RayShapeIntersection intersectHalfSpace(in Ray ray, in float angle, in bool positiveNormal)
{
vec4 intersection = intersectLongitude(ray, angle, positiveNormal);
vec4 farSide = vec4(normalize(ray.dir), INF_HIT);
bool hitFront = (intersection.w > 0.0) == (dot(ray.pos.xy, intersection.xy) > 0.0);
if (!hitFront) {
return RayShapeIntersection(intersection, farSide);
} else {
return RayShapeIntersection(-1.0 * farSide, intersection);
}
}
void intersectFlippedWedge(in Ray ray, in vec2 minMaxAngle, out RayShapeIntersection intersections[2])
{
intersections[0] = intersectHalfSpace(ray, minMaxAngle.x, false);
intersections[1] = intersectHalfSpace(ray, minMaxAngle.y, true);
}
bool hitPositiveHalfPlane(in Ray ray, in vec4 intersection, in bool positiveNormal) {
float normalSign = positiveNormal ? 1.0 : -1.0;
vec2 planeDirection = vec2(intersection.y, -intersection.x) * normalSign;
vec2 hit = ray.pos.xy + intersection.w * ray.dir.xy;
return dot(hit, planeDirection) > 0.0;
}
void intersectHalfPlane(in Ray ray, in float angle, out RayShapeIntersection intersections[2]) {
vec4 intersection = intersectLongitude(ray, angle, true);
vec4 farSide = vec4(normalize(ray.dir), INF_HIT);
if (hitPositiveHalfPlane(ray, intersection, true)) {
intersections[0].entry = -1.0 * farSide;
intersections[0].exit = vec4(-1.0 * intersection.xy, 0.0, intersection.w);
intersections[1].entry = intersection;
intersections[1].exit = farSide;
} else {
vec4 miss = vec4(normalize(ray.dir), NO_HIT);
intersections[0].entry = -1.0 * farSide;
intersections[0].exit = farSide;
intersections[1].entry = miss;
intersections[1].exit = miss;
}
}
RayShapeIntersection intersectRegularWedge(in Ray ray, in vec2 minMaxAngle)
{
vec4 intersect1 = intersectLongitude(ray, minMaxAngle.x, false);
vec4 intersect2 = intersectLongitude(ray, minMaxAngle.y, true);
bool inOrder = intersect1.w <= intersect2.w;
vec4 first = inOrder ? intersect1 : intersect2;
vec4 last = inOrder ? intersect2 : intersect1;
bool firstIsAhead = first.w >= 0.0;
bool startedInsideFirst = dot(ray.pos.xy, first.xy) < 0.0;
bool exitFromInside = firstIsAhead == startedInsideFirst;
bool lastIsAhead = last.w > 0.0;
bool startedOutsideLast = dot(ray.pos.xy, last.xy) >= 0.0;
bool enterFromOutside = lastIsAhead == startedOutsideLast;
vec4 farSide = vec4(normalize(ray.dir), INF_HIT);
vec4 miss = vec4(normalize(ray.dir), NO_HIT);
if (exitFromInside && enterFromOutside) {
return RayShapeIntersection(first, last);
} else if (!exitFromInside && enterFromOutside) {
return RayShapeIntersection(-1.0 * farSide, first);
} else if (exitFromInside && !enterFromOutside) {
return RayShapeIntersection(last, farSide);
} else {
return RayShapeIntersection(miss, miss);
}
}
`;var Tq=`uniform vec3 u_renderMinBounds;
uniform vec3 u_renderMaxBounds;
RayShapeIntersection intersectBox(in Ray ray, in vec3 minBound, in vec3 maxBound)
{
vec3 t0 = (minBound - ray.pos) / ray.dir;
vec3 t1 = (maxBound - ray.pos) / ray.dir;
vec3 entries = min(t0, t1);
vec3 exits = max(t0, t1);
vec3 directions = sign(ray.dir);
float lastEntry = maxComponent(entries);
bvec3 isLastEntry = equal(entries, vec3(lastEntry));
vec3 entryNormal = -1.0 * vec3(isLastEntry) * directions;
vec4 entry = vec4(entryNormal, lastEntry);
float firstExit = minComponent(exits);
bvec3 isFirstExit = equal(exits, vec3(firstExit));
vec3 exitNormal = vec3(isLastEntry) * directions;
vec4 exit = vec4(exitNormal, firstExit);
if (entry.w > exit.w) {
entry.w = NO_HIT;
exit.w = NO_HIT;
}
return RayShapeIntersection(entry, exit);
}
void intersectShape(in Ray ray, inout Intersections ix)
{
RayShapeIntersection intersection = intersectBox(ray, u_renderMinBounds, u_renderMaxBounds);
setShapeIntersection(ix, BOX_INTERSECTION_INDEX, intersection);
}
`;var Aq=`uniform vec2 u_cylinderRenderRadiusMinMax;
uniform vec2 u_cylinderRenderHeightMinMax;
#if defined(CYLINDER_HAS_RENDER_BOUNDS_ANGLE)
uniform vec2 u_cylinderRenderAngleMinMax;
#endif
RayShapeIntersection intersectHeightBounds(in Ray ray, in vec2 minMaxHeight, in bool convex)
{
float zPosition = ray.pos.z;
float zDirection = ray.dir.z;
float tmin = (minMaxHeight.x - zPosition) / zDirection;
float tmax = (minMaxHeight.y - zPosition) / zDirection;
float signFlip = convex ? 1.0 : -1.0;
vec4 intersectMin = vec4(0.0, 0.0, -1.0 * signFlip, tmin);
vec4 intersectMax = vec4(0.0, 0.0, 1.0 * signFlip, tmax);
bool topEntry = zDirection < 0.0;
vec4 entry = topEntry ? intersectMax : intersectMin;
vec4 exit = topEntry ? intersectMin : intersectMax;
return RayShapeIntersection(entry, exit);
}
RayShapeIntersection intersectCylinder(in Ray ray, in float radius, in bool convex)
{
vec2 position = ray.pos.xy;
vec2 direction = ray.dir.xy;
float a = dot(direction, direction);
float b = dot(position, direction);
float c = dot(position, position) - radius * radius;
float determinant = b * b - a * c;
if (determinant < 0.0) {
vec4 miss = vec4(normalize(ray.dir), NO_HIT);
return RayShapeIntersection(miss, miss);
}
determinant = sqrt(determinant);
float t1 = (-b - determinant) / a;
float t2 = (-b + determinant) / a;
float signFlip = convex ? 1.0 : -1.0;
vec4 intersect1 = vec4(normalize(position + t1 * direction) * signFlip, 0.0, t1);
vec4 intersect2 = vec4(normalize(position + t2 * direction) * signFlip, 0.0, t2);
return RayShapeIntersection(intersect1, intersect2);
}
RayShapeIntersection intersectBoundedCylinder(in Ray ray, in float radius, in vec2 minMaxHeight)
{
RayShapeIntersection cylinderIntersection = intersectCylinder(ray, radius, true);
RayShapeIntersection heightBoundsIntersection = intersectHeightBounds(ray, minMaxHeight, true);
return intersectIntersections(ray, cylinderIntersection, heightBoundsIntersection);
}
void intersectShape(Ray ray, inout Intersections ix)
{
ray.pos = ray.pos * 2.0 - 1.0;
ray.dir *= 2.0;
RayShapeIntersection outerIntersect = intersectBoundedCylinder(ray, u_cylinderRenderRadiusMinMax.y, u_cylinderRenderHeightMinMax);
setShapeIntersection(ix, CYLINDER_INTERSECTION_INDEX_RADIUS_MAX, outerIntersect);
if (outerIntersect.entry.w == NO_HIT) {
return;
}
#if defined(CYLINDER_HAS_RENDER_BOUNDS_RADIUS_FLAT)
RayShapeIntersection innerIntersect = intersectCylinder(ray, 1.0, false);
setSurfaceIntersection(ix, 0, outerIntersect.entry, true, true);
setSurfaceIntersection(ix, 1, innerIntersect.entry, false, true);
setSurfaceIntersection(ix, 2, innerIntersect.exit, false, false);
setSurfaceIntersection(ix, 3, outerIntersect.exit, true, false);
#elif defined(CYLINDER_HAS_RENDER_BOUNDS_RADIUS_MIN)
RayShapeIntersection innerIntersect = intersectCylinder(ray, u_cylinderRenderRadiusMinMax.x, false);
setShapeIntersection(ix, CYLINDER_INTERSECTION_INDEX_RADIUS_MIN, innerIntersect);
#endif
#if defined(CYLINDER_HAS_RENDER_BOUNDS_ANGLE_RANGE_UNDER_HALF)
RayShapeIntersection wedgeIntersect = intersectRegularWedge(ray, u_cylinderRenderAngleMinMax);
setShapeIntersection(ix, CYLINDER_INTERSECTION_INDEX_ANGLE, wedgeIntersect);
#elif defined(CYLINDER_HAS_RENDER_BOUNDS_ANGLE_RANGE_OVER_HALF)
RayShapeIntersection wedgeIntersects[2];
intersectFlippedWedge(ray, u_cylinderRenderAngleMinMax, wedgeIntersects);
setShapeIntersection(ix, CYLINDER_INTERSECTION_INDEX_ANGLE + 0, wedgeIntersects[0]);
setShapeIntersection(ix, CYLINDER_INTERSECTION_INDEX_ANGLE + 1, wedgeIntersects[1]);
#elif defined(CYLINDER_HAS_RENDER_BOUNDS_ANGLE_RANGE_EQUAL_ZERO)
RayShapeIntersection wedgeIntersects[2];
intersectHalfPlane(ray, u_cylinderRenderAngleMinMax.x, wedgeIntersects);
setShapeIntersection(ix, CYLINDER_INTERSECTION_INDEX_ANGLE + 0, wedgeIntersects[0]);
setShapeIntersection(ix, CYLINDER_INTERSECTION_INDEX_ANGLE + 1, wedgeIntersects[1]);
#endif
}
`;var Cq=`#if defined(ELLIPSOID_HAS_RENDER_BOUNDS_LONGITUDE)
uniform vec2 u_ellipsoidRenderLongitudeMinMax;
#endif
uniform float u_eccentricitySquared;
uniform vec2 u_ellipsoidRenderLatitudeSinMinMax;
uniform vec2 u_clipMinMaxHeight;
RayShapeIntersection intersectZPlane(in Ray ray, in float z) {
float t = -ray.pos.z / ray.dir.z;
bool startsOutside = sign(ray.pos.z) == sign(z);
bool entry = (t >= 0.0) != startsOutside;
vec4 intersect = vec4(0.0, 0.0, z, t);
vec4 farSide = vec4(normalize(ray.dir), INF_HIT);
if (entry) {
return RayShapeIntersection(intersect, farSide);
} else {
return RayShapeIntersection(-1.0 * farSide, intersect);
}
}
RayShapeIntersection intersectHeight(in Ray ray, in float relativeHeight, in bool convex)
{
vec3 radiiCorrection = u_ellipsoidRadiiUv / (u_ellipsoidRadiiUv + relativeHeight);
vec3 position = ray.pos * radiiCorrection;
vec3 direction = ray.dir * radiiCorrection;
float a = dot(direction, direction);
float b = dot(direction, position);
float c = dot(position, position) - 1.0;
float determinant = b * b - a * c;
if (determinant < 0.0) {
vec4 miss = vec4(normalize(direction), NO_HIT);
return RayShapeIntersection(miss, miss);
}
determinant = sqrt(determinant);
float signB = b < 0.0 ? -1.0 : 1.0;
float t1 = (-b - signB * determinant) / a;
float t2 = c / (a * t1);
float tmin = min(t1, t2);
float tmax = max(t1, t2);
float directionScale = convex ? 1.0 : -1.0;
vec3 d1 = directionScale * normalize(position + tmin * direction);
vec3 d2 = directionScale * normalize(position + tmax * direction);
return RayShapeIntersection(vec4(d1, tmin), vec4(d2, tmax));
}
vec2 intersectDoubleEndedCone(in Ray ray, in float cosSqrHalfAngle)
{
vec3 o = ray.pos;
vec3 d = ray.dir;
float sinSqrHalfAngle = 1.0 - cosSqrHalfAngle;
float aSin = d.z * d.z * sinSqrHalfAngle;
float aCos = -dot(d.xy, d.xy) * cosSqrHalfAngle;
float a = aSin + aCos;
float bSin = d.z * o.z * sinSqrHalfAngle;
float bCos = -dot(o.xy, d.xy) * cosSqrHalfAngle;
float b = bSin + bCos;
float cSin = o.z * o.z * sinSqrHalfAngle;
float cCos = -dot(o.xy, o.xy) * cosSqrHalfAngle;
float c = cSin + cCos;
float determinant = 2.0 * bSin * bCos + bCos * bCos - aSin * cCos - aCos * cSin - aCos * cCos;
if (determinant < 0.0) {
return vec2(NO_HIT);
} else if (a == 0.0) {
return (b == 0.0)
? vec2(NO_HIT)
: vec2(-0.5 * c / b, NO_HIT);
}
determinant = sqrt(determinant);
float signB = b < 0.0 ? -1.0 : 1.0;
float t1 = (-b - signB * determinant) / a;
float t2 = c / (a * t1);
float tmin = min(t1, t2);
float tmax = max(t1, t2);
return vec2(tmin, tmax);
}
vec3 getConeNormal(in vec3 p, in bool convex) {
vec2 radial = -abs(p.z) * normalize(p.xy);
float zSign = (p.z < 0.0) ? -1.0 : 1.0;
float z = length(p.xy) * zSign;
float flip = (convex) ? -1.0 : 1.0;
return normalize(vec3(radial, z) * flip);
}
float getLatitudeConeShift(in float sinLatitude) {
float x2 = u_eccentricitySquared * sinLatitude * sinLatitude;
float primeVerticalRadius = inversesqrt(1.0 - x2);
return primeVerticalRadius * u_eccentricitySquared * sinLatitude;
}
void intersectFlippedCone(in Ray ray, in float cosHalfAngle, out RayShapeIntersection intersections[2]) {
ray.pos = ray.pos * u_ellipsoidRadiiUv;
ray.dir = ray.dir * u_ellipsoidRadiiUv;
ray.pos.z += getLatitudeConeShift(cosHalfAngle);
float cosSqrHalfAngle = cosHalfAngle * cosHalfAngle;
vec2 intersect = intersectDoubleEndedCone(ray, cosSqrHalfAngle);
vec4 miss = vec4(normalize(ray.dir), NO_HIT);
vec4 farSide = vec4(normalize(ray.dir), INF_HIT);
intersections[0].entry = -1.0 * farSide;
intersections[0].exit = farSide;
intersections[1].entry = miss;
intersections[1].exit = miss;
if (intersect.x == NO_HIT) {
return;
}
float tmin = intersect.x;
float tmax = intersect.y;
vec3 p0 = ray.pos + tmin * ray.dir;
vec3 p1 = ray.pos + tmax * ray.dir;
vec4 intersect0 = vec4(getConeNormal(p0, true), tmin);
vec4 intersect1 = vec4(getConeNormal(p1, true), tmax);
bool p0InShadowCone = sign(p0.z) != sign(cosHalfAngle);
bool p1InShadowCone = sign(p1.z) != sign(cosHalfAngle);
if (p0InShadowCone && p1InShadowCone) {
} else if (p0InShadowCone) {
intersections[0].exit = intersect1;
} else if (p1InShadowCone) {
intersections[0].entry = intersect0;
} else {
intersections[0].exit = intersect0;
intersections[1].entry = intersect1;
intersections[1].exit = farSide;
}
}
RayShapeIntersection intersectRegularCone(in Ray ray, in float cosHalfAngle, in bool convex) {
ray.pos = ray.pos * u_ellipsoidRadiiUv;
ray.dir = ray.dir * u_ellipsoidRadiiUv;
ray.pos.z += getLatitudeConeShift(cosHalfAngle);
float cosSqrHalfAngle = cosHalfAngle * cosHalfAngle;
vec2 intersect = intersectDoubleEndedCone(ray, cosSqrHalfAngle);
vec4 miss = vec4(normalize(ray.dir), NO_HIT);
vec4 farSide = vec4(normalize(ray.dir), INF_HIT);
if (intersect.x == NO_HIT) {
return RayShapeIntersection(miss, miss);
}
float tmin = intersect.x;
float tmax = intersect.y;
vec3 p0 = ray.pos + tmin * ray.dir;
vec3 p1 = ray.pos + tmax * ray.dir;
vec4 intersect0 = vec4(getConeNormal(p0, convex), tmin);
vec4 intersect1 = vec4(getConeNormal(p1, convex), tmax);
bool p0InShadowCone = sign(p0.z) != sign(cosHalfAngle);
bool p1InShadowCone = sign(p1.z) != sign(cosHalfAngle);
if (p0InShadowCone && p1InShadowCone) {
return RayShapeIntersection(miss, miss);
} else if (p0InShadowCone) {
return RayShapeIntersection(intersect1, farSide);
} else if (p1InShadowCone) {
return RayShapeIntersection(-1.0 * farSide, intersect0);
} else {
return RayShapeIntersection(intersect0, intersect1);
}
}
void intersectShape(in Ray ray, inout Intersections ix) {
ray.pos = ray.pos * 2.0 - 1.0;
ray.dir *= 2.0;
RayShapeIntersection outerIntersect = intersectHeight(ray, u_clipMinMaxHeight.y, true);
setShapeIntersection(ix, ELLIPSOID_INTERSECTION_INDEX_HEIGHT_MAX, outerIntersect);
if (outerIntersect.entry.w == NO_HIT) {
return;
}
RayShapeIntersection innerIntersect = intersectHeight(ray, u_clipMinMaxHeight.x, false);
if (innerIntersect.entry.w == NO_HIT) {
setShapeIntersection(ix, ELLIPSOID_INTERSECTION_INDEX_HEIGHT_MIN, innerIntersect);
} else {
innerIntersect.entry.w = max(innerIntersect.entry.w, outerIntersect.entry.w);
innerIntersect.exit.w = min(innerIntersect.exit.w, outerIntersect.exit.w);
setSurfaceIntersection(ix, 0, outerIntersect.entry, true, true);
setSurfaceIntersection(ix, 1, innerIntersect.entry, false, true);
setSurfaceIntersection(ix, 2, innerIntersect.exit, false, false);
setSurfaceIntersection(ix, 3, outerIntersect.exit, true, false);
}
#if defined(ELLIPSOID_HAS_RENDER_BOUNDS_LATITUDE_MIN_UNDER_HALF)
RayShapeIntersection bottomConeIntersection = intersectRegularCone(ray, u_ellipsoidRenderLatitudeSinMinMax.x, false);
setShapeIntersection(ix, ELLIPSOID_INTERSECTION_INDEX_LATITUDE_MIN, bottomConeIntersection);
#elif defined(ELLIPSOID_HAS_RENDER_BOUNDS_LATITUDE_MIN_EQUAL_HALF)
RayShapeIntersection bottomConeIntersection = intersectZPlane(ray, -1.0);
setShapeIntersection(ix, ELLIPSOID_INTERSECTION_INDEX_LATITUDE_MIN, bottomConeIntersection);
#elif defined(ELLIPSOID_HAS_RENDER_BOUNDS_LATITUDE_MIN_OVER_HALF)
RayShapeIntersection bottomConeIntersections[2];
intersectFlippedCone(ray, u_ellipsoidRenderLatitudeSinMinMax.x, bottomConeIntersections);
setShapeIntersection(ix, ELLIPSOID_INTERSECTION_INDEX_LATITUDE_MIN + 0, bottomConeIntersections[0]);
setShapeIntersection(ix, ELLIPSOID_INTERSECTION_INDEX_LATITUDE_MIN + 1, bottomConeIntersections[1]);
#endif
#if defined(ELLIPSOID_HAS_RENDER_BOUNDS_LATITUDE_MAX_UNDER_HALF)
RayShapeIntersection topConeIntersections[2];
intersectFlippedCone(ray, u_ellipsoidRenderLatitudeSinMinMax.y, topConeIntersections);
setShapeIntersection(ix, ELLIPSOID_INTERSECTION_INDEX_LATITUDE_MAX + 0, topConeIntersections[0]);
setShapeIntersection(ix, ELLIPSOID_INTERSECTION_INDEX_LATITUDE_MAX + 1, topConeIntersections[1]);
#elif defined(ELLIPSOID_HAS_RENDER_BOUNDS_LATITUDE_MAX_EQUAL_HALF)
RayShapeIntersection topConeIntersection = intersectZPlane(ray, 1.0);
setShapeIntersection(ix, ELLIPSOID_INTERSECTION_INDEX_LATITUDE_MAX, topConeIntersection);
#elif defined(ELLIPSOID_HAS_RENDER_BOUNDS_LATITUDE_MAX_OVER_HALF)
RayShapeIntersection topConeIntersection = intersectRegularCone(ray, u_ellipsoidRenderLatitudeSinMinMax.y, false);
setShapeIntersection(ix, ELLIPSOID_INTERSECTION_INDEX_LATITUDE_MAX, topConeIntersection);
#endif
#if defined(ELLIPSOID_HAS_RENDER_BOUNDS_LONGITUDE_RANGE_EQUAL_ZERO)
RayShapeIntersection wedgeIntersects[2];
intersectHalfPlane(ray, u_ellipsoidRenderLongitudeMinMax.x, wedgeIntersects);
setShapeIntersection(ix, ELLIPSOID_INTERSECTION_INDEX_LONGITUDE + 0, wedgeIntersects[0]);
setShapeIntersection(ix, ELLIPSOID_INTERSECTION_INDEX_LONGITUDE + 1, wedgeIntersects[1]);
#elif defined(ELLIPSOID_HAS_RENDER_BOUNDS_LONGITUDE_RANGE_UNDER_HALF)
RayShapeIntersection wedgeIntersect = intersectRegularWedge(ray, u_ellipsoidRenderLongitudeMinMax);
setShapeIntersection(ix, ELLIPSOID_INTERSECTION_INDEX_LONGITUDE, wedgeIntersect);
#elif defined(ELLIPSOID_HAS_RENDER_BOUNDS_LONGITUDE_RANGE_OVER_HALF)
RayShapeIntersection wedgeIntersects[2];
intersectFlippedWedge(ray, u_ellipsoidRenderLongitudeMinMax, wedgeIntersects);
setShapeIntersection(ix, ELLIPSOID_INTERSECTION_INDEX_LONGITUDE + 0, wedgeIntersects[0]);
setShapeIntersection(ix, ELLIPSOID_INTERSECTION_INDEX_LONGITUDE + 1, wedgeIntersects[1]);
#endif
}
`;var RD=`RayShapeIntersection intersectScene(in vec2 screenCoord, in Ray ray, out Intersections ix) {
intersectShape(ray, ix);
RayShapeIntersection intersection = getFirstIntersection(ix);
if (intersection.entry.w == NO_HIT) {
return intersection;
}
#if defined(CLIPPING_PLANES)
intersectClippingPlanes(ray, ix);
#endif
#if defined(DEPTH_TEST)
intersectDepth(screenCoord, ray, ix);
#endif
#if (INTERSECTION_COUNT > 1)
initializeIntersections(ix);
for (int i = 0; i < INTERSECTION_COUNT; ++i) {
intersection = nextIntersection(ix);
if (intersection.exit.w > 0.0) {
intersection.entry.w = max(intersection.entry.w, 0.0);
break;
}
}
#else
intersection.entry.w = max(intersection.entry.w, 0.0);
#endif
return intersection;
}
`;var Eq=`#if defined(BOX_HAS_SHAPE_BOUNDS)
uniform vec3 u_boxUvToShapeUvScale;
uniform vec3 u_boxUvToShapeUvTranslate;
#endif
PointJacobianT convertUvToShapeSpaceDerivative(in vec3 positionUv) {
return PointJacobianT(positionUv, mat3(0.5));
}
vec3 convertShapeToShapeUvSpace(in vec3 positionShape) {
#if defined(BOX_HAS_SHAPE_BOUNDS)
return positionShape * u_boxUvToShapeUvScale + u_boxUvToShapeUvTranslate;
#else
return positionShape;
#endif
}
PointJacobianT convertUvToShapeUvSpaceDerivative(in vec3 positionUv) {
PointJacobianT pointJacobian = convertUvToShapeSpaceDerivative(positionUv);
pointJacobian.point = convertShapeToShapeUvSpace(pointJacobian.point);
return pointJacobian;
}
vec3 convertShapeUvToUvSpace(in vec3 shapeUv) {
#if defined(BOX_HAS_SHAPE_BOUNDS)
return (shapeUv - u_boxUvToShapeUvTranslate) / u_boxUvToShapeUvScale;
#else
return shapeUv;
#endif
}
vec3 scaleShapeUvToShapeSpace(in vec3 shapeUv) {
#if defined(BOX_HAS_SHAPE_BOUNDS)
return shapeUv / u_boxUvToShapeUvScale;
#else
return shapeUv;
#endif
}
`;var Sq=`#if defined(CYLINDER_HAS_SHAPE_BOUNDS_RADIUS)
uniform vec2 u_cylinderUvToShapeUvRadius;
#endif
#if defined(CYLINDER_HAS_SHAPE_BOUNDS_HEIGHT)
uniform vec2 u_cylinderUvToShapeUvHeight;
#endif
#if defined(CYLINDER_HAS_SHAPE_BOUNDS_ANGLE)
uniform vec2 u_cylinderUvToShapeUvAngle;
#endif
#if defined(CYLINDER_HAS_SHAPE_BOUNDS_ANGLE_MIN_DISCONTINUITY) || defined(CYLINDER_HAS_SHAPE_BOUNDS_ANGLE_MAX_DISCONTINUITY)
uniform vec2 u_cylinderShapeUvAngleMinMax;
#endif
#if defined(CYLINDER_HAS_SHAPE_BOUNDS_ANGLE_MIN_DISCONTINUITY) || defined(CYLINDER_HAS_SHAPE_BOUNDS_ANGLE_MAX_DISCONTINUITY) || defined(CYLINDER_HAS_SHAPE_BOUNDS_ANGLE_MIN_MAX_REVERSED)
uniform float u_cylinderShapeUvAngleRangeZeroMid;
#endif
PointJacobianT convertUvToShapeSpaceDerivative(in vec3 positionUv) {
vec3 position = positionUv * 2.0 - 1.0;
float radius = length(position.xy);
vec3 radial = normalize(vec3(position.xy, 0.0));
float height = positionUv.z;
vec3 z = vec3(0.0, 0.0, 1.0);
float angle = atan(position.y, position.x);
vec3 east = normalize(vec3(-position.y, position.x, 0.0));
vec3 point = vec3(radius, height, angle);
mat3 jacobianT = mat3(radial, z, east / length(position.xy));
return PointJacobianT(point, jacobianT);
}
vec3 convertShapeToShapeUvSpace(in vec3 positionShape) {
float radius = positionShape.x;
#if defined(CYLINDER_HAS_SHAPE_BOUNDS_RADIUS)
radius = radius * u_cylinderUvToShapeUvRadius.x + u_cylinderUvToShapeUvRadius.y;
#endif
float height = positionShape.y;
#if defined(CYLINDER_HAS_SHAPE_BOUNDS_HEIGHT)
height = height * u_cylinderUvToShapeUvHeight.x + u_cylinderUvToShapeUvHeight.y;
#endif
float angle = (positionShape.z + czm_pi) / czm_twoPi;
#if defined(CYLINDER_HAS_SHAPE_BOUNDS_ANGLE)
#if defined(CYLINDER_HAS_SHAPE_BOUNDS_ANGLE_MIN_MAX_REVERSED)
angle += float(angle < u_cylinderShapeUvAngleRangeZeroMid);
#endif
#if defined(CYLINDER_HAS_SHAPE_BOUNDS_ANGLE_MIN_DISCONTINUITY)
angle = angle > u_cylinderShapeUvAngleRangeZeroMid ? u_cylinderShapeUvAngleMinMax.x : angle;
#elif defined(CYLINDER_HAS_SHAPE_BOUNDS_ANGLE_MAX_DISCONTINUITY)
angle = angle < u_cylinderShapeUvAngleRangeZeroMid ? u_cylinderShapeUvAngleMinMax.y : angle;
#endif
angle = angle * u_cylinderUvToShapeUvAngle.x + u_cylinderUvToShapeUvAngle.y;
#endif
return vec3(radius, height, angle);
}
PointJacobianT convertUvToShapeUvSpaceDerivative(in vec3 positionUv) {
PointJacobianT pointJacobian = convertUvToShapeSpaceDerivative(positionUv);
pointJacobian.point = convertShapeToShapeUvSpace(pointJacobian.point);
return pointJacobian;
}
vec3 scaleShapeUvToShapeSpace(in vec3 shapeUv) {
float radius = shapeUv.x;
#if defined(CYLINDER_HAS_SHAPE_BOUNDS_RADIUS)
radius /= u_cylinderUvToShapeUvRadius.x;
#endif
float height = shapeUv.y;
#if defined(CYLINDER_HAS_SHAPE_BOUNDS_HEIGHT)
height /= u_cylinderUvToShapeUvHeight.x;
#endif
float angle = shapeUv.z * czm_twoPi;
#if defined(CYLINDER_HAS_SHAPE_BOUNDS_ANGLE)
angle /= u_cylinderUvToShapeUvAngle.x;
#endif
return vec3(radius, height, angle);
}
`;var wq=`uniform vec3 u_ellipsoidRadiiUv;
uniform vec2 u_evoluteScale;
uniform vec3 u_ellipsoidInverseRadiiSquaredUv;
#if defined(ELLIPSOID_HAS_RENDER_BOUNDS_LONGITUDE_MIN_DISCONTINUITY) || defined(ELLIPSOID_HAS_RENDER_BOUNDS_LONGITUDE_MAX_DISCONTINUITY) || defined(ELLIPSOID_HAS_SHAPE_BOUNDS_LONGITUDE_MIN_MAX_REVERSED)
uniform vec3 u_ellipsoidShapeUvLongitudeMinMaxMid;
#endif
#if defined(ELLIPSOID_HAS_SHAPE_BOUNDS_LONGITUDE)
uniform vec2 u_ellipsoidUvToShapeUvLongitude;
#endif
#if defined(ELLIPSOID_HAS_SHAPE_BOUNDS_LATITUDE)
uniform vec2 u_ellipsoidUvToShapeUvLatitude;
#endif
uniform float u_ellipsoidInverseHeightDifferenceUv;
vec3 nearestPointAndRadiusOnEllipse(vec2 pos, vec2 radii) {
vec2 p = abs(pos);
vec2 inverseRadii = 1.0 / radii;
vec2 tTrigs = vec2(0.7071067811865476);
vec2 v = radii * tTrigs;
vec2 evolute = u_evoluteScale * tTrigs * tTrigs * tTrigs;
const int iterations = 3;
for (int i = 0; i < iterations; ++i) {
vec2 q = normalize(p - evolute) * length(v - evolute);
tTrigs = (q + evolute) * inverseRadii;
tTrigs = normalize(clamp(tTrigs, 0.0, 1.0));
v = radii * tTrigs;
evolute = u_evoluteScale * tTrigs * tTrigs * tTrigs;
}
return vec3(v * sign(pos), length(v - evolute));
}
PointJacobianT convertUvToShapeSpaceDerivative(in vec3 positionUv) {
vec3 position = positionUv * 2.0 - 1.0;
position = position * u_ellipsoidRadiiUv;
float longitude = atan(position.y, position.x);
vec3 east = normalize(vec3(-position.y, position.x, 0.0));
float distanceFromZAxis = length(position.xy);
vec2 posEllipse = vec2(distanceFromZAxis, position.z);
vec3 surfacePointAndRadius = nearestPointAndRadiusOnEllipse(posEllipse, u_ellipsoidRadiiUv.xz);
vec2 surfacePoint = surfacePointAndRadius.xy;
vec2 normal2d = normalize(surfacePoint * u_ellipsoidInverseRadiiSquaredUv.xz);
float latitude = atan(normal2d.y, normal2d.x);
vec3 north = vec3(-normal2d.y * normalize(position.xy), abs(normal2d.x));
float heightSign = length(posEllipse) < length(surfacePoint) ? -1.0 : 1.0;
float height = heightSign * length(posEllipse - surfacePoint);
vec3 up = normalize(cross(east, north));
vec3 point = vec3(longitude, latitude, height);
mat3 jacobianT = mat3(east / distanceFromZAxis, north / (surfacePointAndRadius.z + height), up);
return PointJacobianT(point, jacobianT);
}
vec3 convertShapeToShapeUvSpace(in vec3 positionShape) {
float longitude = (positionShape.x + czm_pi) / czm_twoPi;
#if defined(ELLIPSOID_HAS_SHAPE_BOUNDS_LONGITUDE_MIN_MAX_REVERSED)
longitude += float(longitude < u_ellipsoidShapeUvLongitudeMinMaxMid.z);
#endif
#if defined(ELLIPSOID_HAS_RENDER_BOUNDS_LONGITUDE_MIN_DISCONTINUITY)
longitude = longitude > u_ellipsoidShapeUvLongitudeMinMaxMid.z ? u_ellipsoidShapeUvLongitudeMinMaxMid.x : longitude;
#endif
#if defined(ELLIPSOID_HAS_RENDER_BOUNDS_LONGITUDE_MAX_DISCONTINUITY)
longitude = longitude < u_ellipsoidShapeUvLongitudeMinMaxMid.z ? u_ellipsoidShapeUvLongitudeMinMaxMid.y : longitude;
#endif
#if defined(ELLIPSOID_HAS_SHAPE_BOUNDS_LONGITUDE)
longitude = longitude * u_ellipsoidUvToShapeUvLongitude.x + u_ellipsoidUvToShapeUvLongitude.y;
#endif
float latitude = (positionShape.y + czm_piOverTwo) / czm_pi;
#if defined(ELLIPSOID_HAS_SHAPE_BOUNDS_LATITUDE)
latitude = latitude * u_ellipsoidUvToShapeUvLatitude.x + u_ellipsoidUvToShapeUvLatitude.y;
#endif
float height = 1.0 + positionShape.z * u_ellipsoidInverseHeightDifferenceUv;
return vec3(longitude, latitude, height);
}
PointJacobianT convertUvToShapeUvSpaceDerivative(in vec3 positionUv) {
PointJacobianT pointJacobian = convertUvToShapeSpaceDerivative(positionUv);
pointJacobian.point = convertShapeToShapeUvSpace(pointJacobian.point);
return pointJacobian;
}
vec3 scaleShapeUvToShapeSpace(in vec3 shapeUv) {
float longitude = shapeUv.x * czm_twoPi;
#if defined (ELLIPSOID_HAS_SHAPE_BOUNDS_LONGITUDE)
longitude /= u_ellipsoidUvToShapeUvLongitude.x;
#endif
float latitude = shapeUv.y * czm_pi;
#if defined(ELLIPSOID_HAS_SHAPE_BOUNDS_LATITUDE)
latitude /= u_ellipsoidUvToShapeUvLatitude.x;
#endif
float height = shapeUv.z / u_ellipsoidInverseHeightDifferenceUv;
return vec3(longitude, latitude, height);
}
`;var vq=`#define OCTREE_FLAG_INTERNAL 0
#define OCTREE_FLAG_LEAF 1
#define OCTREE_FLAG_PACKED_LEAF_FROM_PARENT 2
#define OCTREE_MAX_LEVELS 32 // Harcoded value because GLSL doesn't like variable length loops
uniform sampler2D u_octreeInternalNodeTexture;
uniform vec2 u_octreeInternalNodeTexelSizeUv;
uniform int u_octreeInternalNodeTilesPerRow;
#if (SAMPLE_COUNT > 1)
uniform sampler2D u_octreeLeafNodeTexture;
uniform vec2 u_octreeLeafNodeTexelSizeUv;
uniform int u_octreeLeafNodeTilesPerRow;
#endif
struct OctreeNodeData {
int data;
int flag;
};
struct TraversalData {
ivec4 octreeCoords;
int parentOctreeIndex;
};
struct SampleData {
int megatextureIndex;
ivec4 tileCoords;
vec3 tileUv;
#if (SAMPLE_COUNT > 1)
float weight;
#endif
};
int intMod(in int a, in int b) {
return a - (b * (a / b));
}
int normU8_toInt(in float value) {
return int(value * 255.0);
}
int normU8x2_toInt(in vec2 value) {
return int(value.x * 255.0) + 256 * int(value.y * 255.0);
}
float normU8x2_toFloat(in vec2 value) {
return float(normU8x2_toInt(value)) / 65535.0;
}
OctreeNodeData getOctreeNodeData(in vec2 octreeUv) {
vec4 texData = texture(u_octreeInternalNodeTexture, octreeUv);
OctreeNodeData data;
data.data = normU8x2_toInt(texData.xy);
data.flag = normU8x2_toInt(texData.zw);
return data;
}
OctreeNodeData getOctreeChildData(in int parentOctreeIndex, in ivec3 childCoord) {
int childIndex = childCoord.z * 4 + childCoord.y * 2 + childCoord.x;
int octreeCoordX = intMod(parentOctreeIndex, u_octreeInternalNodeTilesPerRow) * 9 + 1 + childIndex;
int octreeCoordY = parentOctreeIndex / u_octreeInternalNodeTilesPerRow;
vec2 octreeUv = u_octreeInternalNodeTexelSizeUv * vec2(float(octreeCoordX) + 0.5, float(octreeCoordY) + 0.5);
return getOctreeNodeData(octreeUv);
}
int getOctreeParentIndex(in int octreeIndex) {
int octreeCoordX = intMod(octreeIndex, u_octreeInternalNodeTilesPerRow) * 9;
int octreeCoordY = octreeIndex / u_octreeInternalNodeTilesPerRow;
vec2 octreeUv = u_octreeInternalNodeTexelSizeUv * vec2(float(octreeCoordX) + 0.5, float(octreeCoordY) + 0.5);
vec4 parentData = texture(u_octreeInternalNodeTexture, octreeUv);
int parentOctreeIndex = normU8x2_toInt(parentData.xy);
return parentOctreeIndex;
}
vec3 getTileUv(in vec3 shapePosition, in ivec4 octreeCoords) {
float dimAtLevel = exp2(float(octreeCoords.w));
return shapePosition * dimAtLevel - vec3(octreeCoords.xyz);
}
vec3 getClampedTileUv(in vec3 shapePosition, in ivec4 octreeCoords) {
vec3 tileUv = getTileUv(shapePosition, octreeCoords);
return clamp(tileUv, vec3(0.0), vec3(1.0));
}
void getOctreeLeafSampleData(in OctreeNodeData data, in ivec4 octreeCoords, out SampleData sampleData) {
sampleData.megatextureIndex = data.data;
sampleData.tileCoords = (data.flag == OCTREE_FLAG_PACKED_LEAF_FROM_PARENT)
? ivec4(octreeCoords.xyz / 2, octreeCoords.w - 1)
: octreeCoords;
}
#if (SAMPLE_COUNT > 1)
void getOctreeLeafSampleDatas(in OctreeNodeData data, in ivec4 octreeCoords, out SampleData sampleDatas[SAMPLE_COUNT]) {
int leafIndex = data.data;
int leafNodeTexelCount = 2;
float leafCoordXStart = float(intMod(leafIndex, u_octreeLeafNodeTilesPerRow) * leafNodeTexelCount) + 0.5;
float leafCoordY = float(leafIndex / u_octreeLeafNodeTilesPerRow) + 0.5;
vec2 leafUv0 = u_octreeLeafNodeTexelSizeUv * vec2(leafCoordXStart + 0.0, leafCoordY);
vec4 leafData0 = texture(u_octreeLeafNodeTexture, leafUv0);
float lerp = normU8x2_toFloat(leafData0.xy);
sampleDatas[0].weight = 1.0 - lerp;
sampleDatas[1].weight = lerp;
sampleDatas[0].tileCoords = (normU8_toInt(leafData0.z) == 1)
? ivec4(octreeCoords.xyz / 2, octreeCoords.w - 1)
: octreeCoords;
sampleDatas[1].tileCoords = (normU8_toInt(leafData0.w) == 1)
? ivec4(octreeCoords.xyz / 2, octreeCoords.w - 1)
: octreeCoords;
vec2 leafUv1 = u_octreeLeafNodeTexelSizeUv * vec2(leafCoordXStart + 1.0, leafCoordY);
vec4 leafData1 = texture(u_octreeLeafNodeTexture, leafUv1);
sampleDatas[0].megatextureIndex = normU8x2_toInt(leafData1.xy);
sampleDatas[1].megatextureIndex = normU8x2_toInt(leafData1.zw);
}
#endif
OctreeNodeData traverseOctreeDownwards(in vec3 shapePosition, inout TraversalData traversalData) {
float sizeAtLevel = exp2(-1.0 * float(traversalData.octreeCoords.w));
vec3 start = vec3(traversalData.octreeCoords.xyz) * sizeAtLevel;
vec3 end = start + vec3(sizeAtLevel);
OctreeNodeData childData;
for (int i = 0; i < OCTREE_MAX_LEVELS; ++i) {
vec3 center = 0.5 * (start + end);
vec3 childCoord = step(center, shapePosition);
ivec4 octreeCoords = traversalData.octreeCoords;
traversalData.octreeCoords = ivec4(octreeCoords.xyz * 2 + ivec3(childCoord), octreeCoords.w + 1);
childData = getOctreeChildData(traversalData.parentOctreeIndex, ivec3(childCoord));
if (childData.flag != OCTREE_FLAG_INTERNAL) {
break;
}
start = mix(start, center, childCoord);
end = mix(center, end, childCoord);
traversalData.parentOctreeIndex = childData.data;
}
return childData;
}
void traverseOctreeFromBeginning(in vec3 shapePosition, out TraversalData traversalData, out SampleData sampleDatas[SAMPLE_COUNT]) {
traversalData.octreeCoords = ivec4(0);
traversalData.parentOctreeIndex = 0;
OctreeNodeData nodeData = getOctreeNodeData(vec2(0.0));
if (nodeData.flag != OCTREE_FLAG_LEAF) {
nodeData = traverseOctreeDownwards(shapePosition, traversalData);
}
#if (SAMPLE_COUNT == 1)
getOctreeLeafSampleData(nodeData, traversalData.octreeCoords, sampleDatas[0]);
sampleDatas[0].tileUv = getClampedTileUv(shapePosition, sampleDatas[0].tileCoords);
#else
getOctreeLeafSampleDatas(nodeData, traversalData.octreeCoords, sampleDatas);
sampleDatas[0].tileUv = getClampedTileUv(shapePosition, sampleDatas[0].tileCoords);
sampleDatas[1].tileUv = getClampedTileUv(shapePosition, sampleDatas[1].tileCoords);
#endif
}
bool inRange(in vec3 v, in vec3 minVal, in vec3 maxVal) {
return clamp(v, minVal, maxVal) == v;
}
bool insideTile(in vec3 shapePosition, in ivec4 octreeCoords) {
vec3 tileUv = getTileUv(shapePosition, octreeCoords);
bool inside = inRange(tileUv, vec3(0.0), vec3(1.0));
return inside || octreeCoords.w == 0;
}
void traverseOctreeFromExisting(in vec3 shapePosition, inout TraversalData traversalData, inout SampleData sampleDatas[SAMPLE_COUNT]) {
if (insideTile(shapePosition, traversalData.octreeCoords)) {
for (int i = 0; i < SAMPLE_COUNT; i++) {
sampleDatas[0].tileUv = getClampedTileUv(shapePosition, sampleDatas[0].tileCoords);
}
return;
}
for (int i = 0; i < OCTREE_MAX_LEVELS; ++i) {
traversalData.octreeCoords.xyz /= 2;
traversalData.octreeCoords.w -= 1;
if (insideTile(shapePosition, traversalData.octreeCoords)) {
break;
}
traversalData.parentOctreeIndex = getOctreeParentIndex(traversalData.parentOctreeIndex);
}
OctreeNodeData nodeData = traverseOctreeDownwards(shapePosition, traversalData);
#if (SAMPLE_COUNT == 1)
getOctreeLeafSampleData(nodeData, traversalData.octreeCoords, sampleDatas[0]);
sampleDatas[0].tileUv = getClampedTileUv(shapePosition, sampleDatas[0].tileCoords);
#else
getOctreeLeafSampleDatas(nodeData, traversalData.octreeCoords, sampleDatas);
sampleDatas[0].tileUv = getClampedTileUv(shapePosition, sampleDatas[0].tileCoords);
sampleDatas[1].tileUv = getClampedTileUv(shapePosition, sampleDatas[1].tileCoords);
#endif
}
`;var Dq=`uniform ivec2 u_megatextureSliceDimensions;
uniform ivec2 u_megatextureTileDimensions;
uniform vec2 u_megatextureVoxelSizeUv;
uniform vec2 u_megatextureSliceSizeUv;
uniform vec2 u_megatextureTileSizeUv;
uniform ivec3 u_dimensions;
#if defined(PADDING)
uniform ivec3 u_paddingBefore;
uniform ivec3 u_paddingAfter;
#endif
int intMin(int a, int b) {
return a <= b ? a : b;
}
int intMax(int a, int b) {
return a >= b ? a : b;
}
int intClamp(int v, int minVal, int maxVal) {
return intMin(intMax(v, minVal), maxVal);
}
vec2 index1DTo2DTexcoord(int index, ivec2 dimensions, vec2 uvScale)
{
int indexX = intMod(index, dimensions.x);
int indexY = index / dimensions.x;
return vec2(indexX, indexY) * uvScale;
}
Properties getPropertiesFromMegatexture(in SampleData sampleData) {
int tileIndex = sampleData.megatextureIndex;
vec3 voxelCoord = sampleData.tileUv * vec3(u_dimensions);
ivec3 voxelDimensions = u_dimensions;
#if defined(PADDING)
voxelDimensions += u_paddingBefore + u_paddingAfter;
voxelCoord += vec3(u_paddingBefore);
#endif
#if defined(NEAREST_SAMPLING)
voxelCoord = floor(voxelCoord) + vec3(0.5);
#endif
vec2 tileUvOffset = index1DTo2DTexcoord(tileIndex, u_megatextureTileDimensions, u_megatextureTileSizeUv);
float slice = voxelCoord.z - 0.5;
int sliceIndex = int(floor(slice));
int sliceIndex0 = intClamp(sliceIndex, 0, voxelDimensions.z - 1);
vec2 sliceUvOffset0 = index1DTo2DTexcoord(sliceIndex0, u_megatextureSliceDimensions, u_megatextureSliceSizeUv);
vec2 voxelUvOffset = clamp(voxelCoord.xy, vec2(0.5), vec2(voxelDimensions.xy) - vec2(0.5)) * u_megatextureVoxelSizeUv;
vec2 uv0 = tileUvOffset + sliceUvOffset0 + voxelUvOffset;
#if defined(NEAREST_SAMPLING)
return getPropertiesFromMegatextureAtUv(uv0);
#else
float sliceLerp = fract(slice);
int sliceIndex1 = intMin(sliceIndex + 1, voxelDimensions.z - 1);
vec2 sliceUvOffset1 = index1DTo2DTexcoord(sliceIndex1, u_megatextureSliceDimensions, u_megatextureSliceSizeUv);
vec2 uv1 = tileUvOffset + sliceUvOffset1 + voxelUvOffset;
Properties properties0 = getPropertiesFromMegatextureAtUv(uv0);
Properties properties1 = getPropertiesFromMegatextureAtUv(uv1);
return mixProperties(properties0, properties1, sliceLerp);
#endif
}
Properties accumulatePropertiesFromMegatexture(in SampleData sampleDatas[SAMPLE_COUNT]) {
#if (SAMPLE_COUNT == 1)
return getPropertiesFromMegatexture(sampleDatas[0]);
#else
Properties properties = clearProperties();
for (int i = 0; i < SAMPLE_COUNT; ++i) {
float weight = sampleDatas[i].weight;
if (weight > 0.0) {
Properties tempProperties = getPropertiesFromMegatexture(sampleDatas[i]);
tempProperties = scaleProperties(tempProperties, weight);
properties = sumProperties(properties, tempProperties);
}
}
return properties;
#endif
}
`;function dat(e){let t=new _w;this.shaderBuilder=t;let n=e._customShader,i=At(e._uniformMap,n.uniformMap);e._uniformMap=i;let o=n.uniforms;for(let p in o)if(o.hasOwnProperty(p)){let g=o[p];t.addUniform(g.type,p,_e.FRAGMENT)}t.addUniform("sampler2D","u_megatextureTextures[METADATA_COUNT]",_e.FRAGMENT),this.uniformMap=i;let r=e._clippingPlanes,s=c(r)&&r.enabled?r.length:0;this.clippingPlanes=r,this.clippingPlanesLength=s,t.addVertexLines([gq]),t.addFragmentLines([n.fragmentShaderText,"#line 0",vq,pq,yq,Dq]),s>0&&(t.addDefine("CLIPPING_PLANES",void 0,_e.FRAGMENT),t.addDefine("CLIPPING_PLANES_COUNT",s,_e.FRAGMENT),r.unionClippingRegions&&t.addDefine("CLIPPING_PLANES_UNION",void 0,_e.FRAGMENT),t.addFragmentLines([xq])),e._depthTest&&(t.addDefine("DEPTH_TEST",void 0,_e.FRAGMENT),t.addFragmentLines([bq]));let a=e._provider.shape;a==="BOX"?t.addFragmentLines([Eq,Tq,RD]):a==="CYLINDER"?t.addFragmentLines([Sq,NL,Aq,RD]):a==="ELLIPSOID"&&(t.addDefine("SHAPE_ELLIPSOID",void 0,_e.FRAGMENT),t.addFragmentLines([wq,NL,Cq,RD])),t.addFragmentLines([_q]);let l=e._shape,u=l.shaderDefines;for(let p in u)if(u.hasOwnProperty(p)){let g=u[p];c(g)&&(g=g===!0?void 0:g,t.addDefine(p,g,_e.FRAGMENT))}let f=l.shaderMaximumIntersectionsLength;s>0&&(t.addDefine("CLIPPING_PLANES_INTERSECTION_INDEX",f,_e.FRAGMENT),s===1?f+=1:r.unionClippingRegions?f+=2:f+=1),e._depthTest&&(t.addDefine("DEPTH_INTERSECTION_INDEX",f,_e.FRAGMENT),f+=1),t.addDefine("INTERSECTION_COUNT",f,_e.FRAGMENT),(!h.equals(e.paddingBefore,h.ZERO)||!h.equals(e.paddingAfter,h.ZERO))&&t.addDefine("PADDING",void 0,_e.FRAGMENT),e._useLogDepth&&t.addDefine("LOG_DEPTH_READ_ONLY",void 0,_e.FRAGMENT),e._nearestSampling&&t.addDefine("NEAREST_SAMPLING",void 0,_e.FRAGMENT);let d=e._traversal;t.addDefine("SAMPLE_COUNT",`${d._sampleCount}`,_e.FRAGMENT)}var Pq=dat;function hat(e,t){let{shaderBuilder:n}=e,{names:i,types:o,componentTypes:r,minimumValues:s,maximumValues:a}=t._provider,l=o.length,u=c(s)&&c(a);n.addDefine("METADATA_COUNT",l,_e.FRAGMENT),u&&n.addDefine("STATISTICS",void 0,_e.FRAGMENT);for(let M=0;M<l;M++){let N=i[M],B=o[M],_=`PropertyStatistics_${N}`,w=`PropertyStatistics_${N}`;n.addStruct(_,w,_e.FRAGMENT);let P=FL(B);n.addStructField(_,P,"min"),n.addStructField(_,P,"max")}let f="Statistics",d="Statistics",p="statistics";n.addStruct(f,d,_e.FRAGMENT);for(let M=0;M<l;M++){let N=i[M],B=`PropertyStatistics_${N}`,_=N;n.addStructField(f,B,_)}let g="Metadata",m="Metadata",b="metadata";n.addStruct(g,m,_e.FRAGMENT),n.addStructField(g,d,p);for(let M=0;M<l;M++){let N=i[M],B=o[M],_=FL(B);n.addStructField(g,_,N)}for(let M=0;M<l;M++){let N=i[M],B=o[M],_=pat(B),w=`VoxelProperty_${N}`,P=`VoxelProperty_${N}`;n.addStruct(w,P,_e.FRAGMENT),n.addStructField(w,_,"partialDerivativeLocal"),n.addStructField(w,_,"partialDerivativeWorld"),n.addStructField(w,_,"partialDerivativeView"),n.addStructField(w,_,"partialDerivativeValid")}let x="Voxel",T="Voxel",C="voxel";n.addStruct(x,T,_e.FRAGMENT);for(let M=0;M<l;M++){let N=i[M],B=`VoxelProperty_${N}`;n.addStructField(x,B,N)}n.addStructField(x,"vec3","positionEC"),n.addStructField(x,"vec3","positionUv"),n.addStructField(x,"vec3","positionShapeUv"),n.addStructField(x,"vec3","positionUvLocal"),n.addStructField(x,"vec3","viewDirUv"),n.addStructField(x,"vec3","viewDirWorld"),n.addStructField(x,"vec3","surfaceNormal"),n.addStructField(x,"float","travelDistance"),n.addStructField(x,"int","stepCount"),n.addStructField(x,"int","tileIndex"),n.addStructField(x,"int","sampleIndex");let S="FragmentInput";n.addStruct(S,"FragmentInput",_e.FRAGMENT),n.addStructField(S,m,b),n.addStructField(S,T,C);let D="Properties",I="Properties",L="properties";n.addStruct(D,I,_e.FRAGMENT);for(let M=0;M<l;M++){let N=i[M],B=o[M],_=FL(B);n.addStructField(D,_,N)}{let M="clearProperties";n.addFunction(M,`${I} clearProperties()`,_e.FRAGMENT),n.addFunctionLines(M,[`${I} ${L};`]);for(let N=0;N<l;N++){let B=i[N],_=o[N],w=r[N],P=FL(_,w);n.addFunctionLines(M,[`${L}.${B} = ${P}(0.0);`])}n.addFunctionLines(M,[`return ${L};`])}{let M="sumProperties";n.addFunction(M,`${I} sumProperties(${I} propertiesA, ${I} propertiesB)`,_e.FRAGMENT),n.addFunctionLines(M,[`${I} ${L};`]);for(let N=0;N<l;N++){let B=i[N];n.addFunctionLines(M,[`${L}.${B} = propertiesA.${B} + propertiesB.${B};`])}n.addFunctionLines(M,[`return ${L};`])}{let M="scaleProperties";n.addFunction(M,`${I} scaleProperties(${I} ${L}, float scale)`,_e.FRAGMENT),n.addFunctionLines(M,[`${I} scaledProperties = ${L};`]);for(let N=0;N<l;N++){let B=i[N];n.addFunctionLines(M,[`scaledProperties.${B} *= scale;`])}n.addFunctionLines(M,["return scaledProperties;"])}{let M="mixProperties";n.addFunction(M,`${I} mixProperties(${I} propertiesA, ${I} propertiesB, float mixFactor)`,_e.FRAGMENT),n.addFunctionLines(M,[`${I} ${L};`]);for(let N=0;N<l;N++){let B=i[N];n.addFunctionLines(M,[`${L}.${B} = mix(propertiesA.${B}, propertiesB.${B}, mixFactor);`])}n.addFunctionLines(M,[`return ${L};`])}{let M="copyPropertiesToMetadata";n.addFunction(M,`void copyPropertiesToMetadata(in ${I} ${L}, inout ${m} ${b})`,_e.FRAGMENT);for(let N=0;N<l;N++){let B=i[N];n.addFunctionLines(M,[`${b}.${B} = ${L}.${B};`])}}if(u){let M="setStatistics";n.addFunction(M,`void setStatistics(inout ${d} ${p})`,_e.FRAGMENT);for(let N=0;N<l;N++){let B=i[N],_=o[N],w=Et.getComponentCount(_);for(let P=0;P<w;P++){let O=_at(_,P),F=s[N][P],V=a[N][P];n.addFunctionLines(M,[`${p}.${B}.min${O} = ${zge(F)};`,`${p}.${B}.max${O} = ${zge(V)};`])}}}{let M="getPropertiesFromMegatextureAtUv";n.addFunction(M,`${I} getPropertiesFromMegatextureAtUv(vec2 texcoord)`,_e.FRAGMENT),n.addFunctionLines(M,[`${I} ${L};`]);for(let N=0;N<l;N++){let B=i[N],_=o[N],w=r[N],P=mat(_,w);n.addFunctionLines(M,[`properties.${B} = texture(u_megatextureTextures[${N}], texcoord)${P};`])}n.addFunctionLines(M,[`return ${L};`])}}function FL(e){if(e===Et.SCALAR)return"float";if(e===Et.VEC2)return"vec2";if(e===Et.VEC3)return"vec3";if(e===Et.VEC4)return"vec4"}function mat(e){if(e===Et.SCALAR)return".r";if(e===Et.VEC2)return".ra";if(e===Et.VEC3)return".rgb";if(e===Et.VEC4)return""}function pat(e){if(e===Et.SCALAR)return"vec3";if(e===Et.VEC2)return"mat2";if(e===Et.VEC3)return"mat3";if(e===Et.VEC4)return"mat4"}function zge(e){let t=e.toString();return t.indexOf(".")===-1&&(t=`${e}.0`),t}function _at(e,t){return e===Et.SCALAR?"":`[${t}]`}var Iq=hat;function gat(e,t){let n=new Pq(e);Iq(n,e);let{shaderBuilder:i,clippingPlanes:o,clippingPlanesLength:r}=n;if(r>0){let T="getClippingPlane",C=Hb(o,t),S=0,v=C.indexOf(")")+1,D=C.indexOf("{",v)+1,I=C.indexOf("}",D),L=C.slice(S,v),M=C.slice(D,I);i.addFunction(T,L,_e.FRAGMENT),i.addFunctionLines(T,[M])}let s=i.clone();s.addDefine("PICKING",void 0,_e.FRAGMENT);let a=i.clone();a.addDefine("PICKING_VOXEL",void 0,_e.FRAGMENT);let l=i.buildShaderProgram(t),u=s.buildShaderProgram(t),f=a.buildShaderProgram(t),d=ze.fromCache({cull:{enabled:!0,face:xi.BACK},depthTest:{enabled:!1},depthMask:!1,blending:hn.PRE_MULTIPLIED_ALPHA_BLEND}),p=t.getViewportQuadVertexArray(),g=e._depthTest,m=new et({vertexArray:p,primitiveType:Me.TRIANGLES,renderState:d,shaderProgram:l,uniformMap:n.uniformMap,modelMatrix:e._compoundModelMatrix,pass:ve.VOXELS,executeInClosestFrustum:!0,owner:this,cull:g,occlude:g}),b=et.shallowClone(m,new et);b.shaderProgram=u,b.pickOnly=!0;let x=et.shallowClone(m,new et);if(x.shaderProgram=f,x.pickOnly=!0,c(e._drawCommand)){let T=e._drawCommand;T.shaderProgram=T.shaderProgram&&T.shaderProgram.destroy()}if(c(e._drawCommandPick)){let T=e._drawCommandPick;T.shaderProgram=T.shaderProgram&&T.shaderProgram.destroy()}if(c(e._drawCommandPickVoxel)){let T=e._drawCommandPickVoxel;T.shaderProgram=T.shaderProgram&&T.shaderProgram.destroy()}e._drawCommand=m,e._drawCommandPick=b,e._drawCommandPickVoxel=x}var Oq=gat;var Wge={};function yat(e,t,n){let i,o,r;if(e instanceof vi){let s=Math.tan(.5*e.fovy);return i=e.near,o=e.near*s,r=e.aspectRatio*o,Math.max(t*i/r,n*i/o)}else if(e instanceof lu)return i=e.near,o=e.top,r=e.right,Math.max(t*i/r,n*i/o);return Math.max(t,n)}var bat=new h,Hge=new h;function qge(e,t,n,i){if(c(i)&&n(.5)>i){let o=n(0),r=n(1),s=n(.5),a=s-o,l=s-r;return function(u){let f=n(u);if(u<=.5){let p=(f-o)/a;return R.lerp(e,-R.PI_OVER_TWO,p)}let d=(f-r)/l;return R.lerp(-R.PI_OVER_TWO,t,1-d)}}return function(o){return R.lerp(e,t,o)}}function Mq(e,t,n,i,o){let r=o,s=Math.max(n,i);if(!c(r)){let a=e.position,l=t,u=e.up,f=e.right,d=e.frustum,p=h.subtract(a,l,bat),g=h.magnitude(h.multiplyByScalar(u,h.dot(p,u),Hge)),m=h.magnitude(h.multiplyByScalar(f,h.dot(p,f),Hge));r=Math.min(yat(d,g,m)*.2,1e9)}if(s<r){let u=-Math.pow((r-n)*1e6,.125),f=Math.pow((r-i)*1e6,1/8);return function(d){let p=d*(f-u)+u;return-Math.pow(p,8)/1e6+r}}return function(a){return R.lerp(n,i,a)}}function MD(e,t){return R.equalsEpsilon(e,R.TWO_PI,R.EPSILON11)&&(e=0),t>e+Math.PI?e+=R.TWO_PI:t<e-Math.PI&&(e-=R.TWO_PI),e}var Yge=new h;function xat(e,t,n,i,o,r,s,a){let l=e.camera,u=h.clone(l.position,Yge),f=l.pitch,d=MD(l.heading,i),p=MD(l.roll,r),g=Mq(l,n,u.z,n.z,s),m=qge(f,o,g,a);function b(x){let T=x.time/t;l.setView({orientation:{heading:R.lerp(d,i,T),pitch:m(T),roll:R.lerp(p,r,T)}}),H.lerp(u,n,T,l.position),l.position.z=g(T)}return b}function Tat(e,t){e.longitude<t.longitude?e.longitude+=R.TWO_PI:t.longitude+=R.TWO_PI}function Aat(e,t){let n=e.longitude-t.longitude;n<-R.PI?e.longitude+=R.TWO_PI:n>R.PI&&(t.longitude+=R.TWO_PI)}var Cat=new he,Eat=new he;function Sat(e,t,n,i,o,r,s,a,l,u){let f=e.camera,p=e.mapProjection.ellipsoid,g=he.clone(f.positionCartographic,Cat),m=f.pitch,b=MD(f.heading,i),x=MD(f.roll,r),T=p.cartesianToCartographic(n,Eat);g.longitude=R.zeroToTwoPi(g.longitude),T.longitude=R.zeroToTwoPi(T.longitude);let C=!1;if(c(a)){let I=R.zeroToTwoPi(a),L=Math.min(g.longitude,T.longitude),M=Math.max(g.longitude,T.longitude),N=I>=L&&I<=M;if(c(l)){let B=Math.abs(g.longitude-T.longitude),_=R.TWO_PI-B;(N?B:_)<(N?_:B)*l&&!N&&(C=!0)}else N||(C=!0)}C?Tat(g,T):Aat(g,T);let S=Mq(f,n,g.height,T.height,s),v=qge(m,o,S,u);function D(){let I=g.longitude,L=T.longitude,M=g.latitude,N=T.latitude;return function(_){let w=_.time/t,P=h.fromRadians(R.lerp(I,L,w),R.lerp(M,N,w),S(w),p);f.setView({destination:P,orientation:{heading:R.lerp(b,i,w),pitch:v(w),roll:R.lerp(x,r,w)}})}}return D()}function wat(e,t,n,i,o,r,s){let a=e.camera,l=h.clone(a.position,Yge),u=MD(a.heading,i),f=a.frustum.right-a.frustum.left,d=Mq(a,n,f,n.z,s);function p(g){let m=g.time/t;a.setView({orientation:{heading:R.lerp(u,i,m)}}),H.lerp(l,n,m,a.position);let b=d(m),x=a.frustum,T=x.top/x.right,C=(b-(x.right-x.left))*.5;x.right+=C,x.left-=C,x.top=T*x.right,x.bottom=-x.top}return p}var Gge=new he,vat=new h;function Rq(e,t){return{startObject:{},stopObject:{},duration:0,complete:e,cancel:t}}function jge(e,t){function n(){typeof t=="function"&&t(),e.enableInputs=!0}return n}Wge.createTween=function(e,t){t=y(t,y.EMPTY_OBJECT);let n=t.destination;if(!c(e))throw new E("scene is required.");if(!c(n))throw new E("destination is required.");let i=e.mode;if(i===oe.MORPHING)return Rq();let o=y(t.convert,!0),r=e.mapProjection,s=r.ellipsoid,a=t.maximumHeight,l=t.flyOverLongitude,u=t.flyOverLongitudeWeight,f=t.pitchAdjustHeight,d=t.easingFunction;o&&i!==oe.SCENE3D&&(s.cartesianToCartographic(n,Gge),n=r.project(Gge,vat));let p=e.camera,g=t.endTransform;c(g)&&p._setTransform(g);let m=t.duration;c(m)||(m=Math.ceil(h.distance(p.position,n)/1e6)+2,m=Math.min(m,3));let b=y(t.heading,0),x=y(t.pitch,-R.PI_OVER_TWO),T=y(t.roll,0),C=e.screenSpaceCameraController;C.enableInputs=!1;let S=jge(C,t.complete),v=jge(C,t.cancel),D=p.frustum,I=e.mode===oe.SCENE2D;if(I=I&&H.equalsEpsilon(p.position,n,R.EPSILON6),I=I&&R.equalsEpsilon(Math.max(D.right-D.left,D.top-D.bottom),n.z,R.EPSILON6),I=I||e.mode!==oe.SCENE2D&&h.equalsEpsilon(n,p.position,R.EPSILON10),I=I&&R.equalsEpsilon(R.negativePiToPi(b),R.negativePiToPi(p.heading),R.EPSILON10)&&R.equalsEpsilon(R.negativePiToPi(x),R.negativePiToPi(p.pitch),R.EPSILON10)&&R.equalsEpsilon(R.negativePiToPi(T),R.negativePiToPi(p.roll),R.EPSILON10),I)return Rq(S,v);let L=new Array(4);if(L[oe.SCENE2D]=wat,L[oe.SCENE3D]=Sat,L[oe.COLUMBUS_VIEW]=xat,m<=0)return Rq(function(){L[i](e,1,n,b,x,T,a,l,u,f)({time:1}),typeof S=="function"&&S()},v);let M=L[i](e,m,n,b,x,T,a,l,u,f);if(!c(d)){let N=p.positionCartographic.height,B=i===oe.SCENE3D?s.cartesianToCartographic(n).height:n.z;N>B&&N>11500?d=qr.CUBIC_OUT:d=qr.QUINTIC_IN_OUT}return{duration:m,easingFunction:d,startObject:{time:0},stopObject:{time:m},update:M,complete:S,cancel:v}};var Lq=Wge;var Dat={ROTATE:0,INFINITE_SCROLL:1},Ef=Object.freeze(Dat);function en(e){if(!c(e))throw new E("scene is required.");this._scene=e,this._transform=k.clone(k.IDENTITY),this._invTransform=k.clone(k.IDENTITY),this._actualTransform=k.clone(k.IDENTITY),this._actualInvTransform=k.clone(k.IDENTITY),this._transformChanged=!1,this.position=new h,this._position=new h,this._positionWC=new h,this._positionCartographic=new he,this._oldPositionWC=void 0,this.positionWCDeltaMagnitude=0,this.positionWCDeltaMagnitudeLastFrame=0,this.timeSinceMoved=0,this._lastMovedTimestamp=0,this.direction=new h,this._direction=new h,this._directionWC=new h,this.up=new h,this._up=new h,this._upWC=new h,this.right=new h,this._right=new h,this._rightWC=new h,this.frustum=new vi,this.frustum.aspectRatio=e.drawingBufferWidth/e.drawingBufferHeight,this.frustum.fov=R.toRadians(60),this.defaultMoveAmount=1e5,this.defaultLookAmount=Math.PI/60,this.defaultRotateAmount=Math.PI/3600,this.defaultZoomAmount=1e5,this.constrainedAxis=void 0,this.maximumZoomFactor=1.5,this._moveStart=new pe,this._moveEnd=new pe,this._changed=new pe,this._changedPosition=void 0,this._changedDirection=void 0,this._changedFrustum=void 0,this._changedHeading=void 0,this._changedRoll=void 0,this.percentageChanged=.5,this._viewMatrix=new k,this._invViewMatrix=new k,tye(this),this._mode=oe.SCENE3D,this._modeChanged=!0;let t=e.mapProjection;this._projection=t,this._maxCoord=t.project(new he(Math.PI,R.PI_OVER_TWO)),this._max2Dfrustum=void 0,hye(this,en.DEFAULT_VIEW_RECTANGLE,this.position,!0);let n=h.magnitude(this.position);n+=n*en.DEFAULT_VIEW_FACTOR,h.normalize(this.position,this.position),h.multiplyByScalar(this.position,n,this.position)}en.TRANSFORM_2D=new k(0,0,1,0,1,0,0,0,0,1,0,0,0,0,0,1);en.TRANSFORM_2D_INVERSE=k.inverseTransformation(en.TRANSFORM_2D,new k);en.DEFAULT_VIEW_RECTANGLE=ae.fromDegrees(-95,-20,-70,90);en.DEFAULT_VIEW_FACTOR=.5;en.DEFAULT_OFFSET=new zh(0,-R.PI_OVER_FOUR,0);function tye(e){k.computeView(e._position,e._direction,e._up,e._right,e._viewMatrix),k.multiply(e._viewMatrix,e._actualInvTransform,e._viewMatrix),k.inverseTransformation(e._viewMatrix,e._invViewMatrix)}function Pat(e){if(!c(e._oldPositionWC))e._oldPositionWC=h.clone(e.positionWC,e._oldPositionWC);else{e.positionWCDeltaMagnitudeLastFrame=e.positionWCDeltaMagnitude;let t=h.subtract(e.positionWC,e._oldPositionWC,e._oldPositionWC);e.positionWCDeltaMagnitude=h.magnitude(t),e._oldPositionWC=h.clone(e.positionWC,e._oldPositionWC),e.positionWCDeltaMagnitude>0?(e.timeSinceMoved=0,e._lastMovedTimestamp=Ei()):e.timeSinceMoved=Math.max(Ei()-e._lastMovedTimestamp,0)/1e3}}en.prototype.canPreloadFlight=function(){return c(this._currentFlight)&&this._mode!==oe.SCENE2D};en.prototype._updateCameraChanged=function(){let e=this;if(Pat(e),e._changed.numberOfListeners===0)return;let t=e.percentageChanged,n=e.heading;c(e._changedHeading)||(e._changedHeading=n);let i=Math.abs(e._changedHeading-n)%R.TWO_PI;i=i>R.PI?R.TWO_PI-i:i;let o=i/Math.PI;o>t&&(e._changedHeading=n);let r=e.roll;c(e._changedRoll)||(e._changedRoll=r);let s=Math.abs(e._changedRoll-r)%R.TWO_PI;s=s>R.PI?R.TWO_PI-s:s;let a=s/Math.PI;if(a>t&&(e._changedRoll=r),(a>t||o>t)&&e._changed.raiseEvent(Math.max(a,o)),e._mode===oe.SCENE2D){if(!c(e._changedFrustum)){e._changedPosition=h.clone(e.position,e._changedPosition),e._changedFrustum=e.frustum.clone();return}let p=e.position,g=e._changedPosition,m=e.frustum,b=e._changedFrustum,x=p.x+m.left,T=p.x+m.right,C=g.x+b.left,S=g.x+b.right,v=p.y+m.bottom,D=p.y+m.top,I=g.y+b.bottom,L=g.y+b.top,M=Math.max(x,C),N=Math.min(T,S),B=Math.max(v,I),_=Math.min(D,L),w;if(M>=N||B>=D)w=1;else{let P=b;x<C&&T>S&&v<I&&D>L&&(P=m),w=1-(N-M)*(_-B)/((P.right-P.left)*(P.top-P.bottom))}w>t&&(e._changed.raiseEvent(w),e._changedPosition=h.clone(e.position,e._changedPosition),e._changedFrustum=e.frustum.clone(e._changedFrustum));return}if(!c(e._changedDirection)){e._changedPosition=h.clone(e.positionWC,e._changedPosition),e._changedDirection=h.clone(e.directionWC,e._changedDirection);return}let l=R.acosClamped(h.dot(e.directionWC,e._changedDirection)),u;c(e.frustum.fovy)?u=l/(e.frustum.fovy*.5):u=l;let d=h.distance(e.positionWC,e._changedPosition)/e.positionCartographic.height;(u>t||d>t)&&(e._changed.raiseEvent(Math.max(u,d)),e._changedPosition=h.clone(e.positionWC,e._changedPosition),e._changedDirection=h.clone(e.directionWC,e._changedDirection))};function Iat(e){Ft.basisTo2D(e._projection,e._transform,e._actualTransform)}var Oat=new he,Rat=new h,BL=new h,Mat=new se,Lat=new se,Nat=new se,Fat=new se,Bat=new se;function kat(e){let t=e._projection,n=t.ellipsoid,i=k.getColumn(e._transform,3,Mat),o=n.cartesianToCartographic(i,Oat),r=t.project(o,Rat),s=Lat;s.x=r.z,s.y=r.x,s.z=r.y,s.w=1;let a=se.clone(se.UNIT_X,Bat),l=se.add(k.getColumn(e._transform,0,BL),i,BL);n.cartesianToCartographic(l,o),t.project(o,r);let u=Nat;u.x=r.z,u.y=r.x,u.z=r.y,u.w=0,h.subtract(u,s,u),u.x=0;let f=Fat;if(h.magnitudeSquared(u)>R.EPSILON10)h.cross(a,u,f);else{let d=se.add(k.getColumn(e._transform,1,BL),i,BL);n.cartesianToCartographic(d,o),t.project(o,r),f.x=r.z,f.y=r.x,f.z=r.y,f.w=0,h.subtract(f,s,f),f.x=0,h.magnitudeSquared(f)<R.EPSILON10&&(se.clone(se.UNIT_Y,u),se.clone(se.UNIT_Z,f))}h.cross(f,a,u),h.normalize(u,u),h.cross(a,u,f),h.normalize(f,f),k.setColumn(e._actualTransform,0,u,e._actualTransform),k.setColumn(e._actualTransform,1,f,e._actualTransform),k.setColumn(e._actualTransform,2,a,e._actualTransform),k.setColumn(e._actualTransform,3,s,e._actualTransform)}var Nq=new h;function ic(e){let t=e._mode,n=!1,i=0;t===oe.SCENE2D&&(i=e.frustum.right-e.frustum.left,n=i!==e._positionCartographic.height);let o=e._position,r=!h.equals(o,e.position)||n;r&&(o=h.clone(e.position,e._position));let s=e._direction,a=!h.equals(s,e.direction);a&&(h.normalize(e.direction,e.direction),s=h.clone(e.direction,e._direction));let l=e._up,u=!h.equals(l,e.up);u&&(h.normalize(e.up,e.up),l=h.clone(e.up,e._up));let f=e._right,d=!h.equals(f,e.right);d&&(h.normalize(e.right,e.right),f=h.clone(e.right,e._right));let p=e._transformChanged||e._modeChanged;e._transformChanged=!1,p&&(k.inverseTransformation(e._transform,e._invTransform),e._mode===oe.COLUMBUS_VIEW||e._mode===oe.SCENE2D?k.equals(k.IDENTITY,e._transform)?k.clone(en.TRANSFORM_2D,e._actualTransform):e._mode===oe.COLUMBUS_VIEW?Iat(e):kat(e):k.clone(e._transform,e._actualTransform),k.inverseTransformation(e._actualTransform,e._actualInvTransform),e._modeChanged=!1);let g=e._actualTransform;if(r||p)if(e._positionWC=k.multiplyByPoint(g,o,e._positionWC),t===oe.SCENE3D||t===oe.MORPHING)e._positionCartographic=e._projection.ellipsoid.cartesianToCartographic(e._positionWC,e._positionCartographic);else{let m=Nq;m.x=e._positionWC.y,m.y=e._positionWC.z,m.z=e._positionWC.x,t===oe.SCENE2D&&(m.z=i),e._projection.unproject(m,e._positionCartographic)}if(a||u||d){let m=h.dot(s,h.cross(l,f,Nq));if(Math.abs(1-m)>R.EPSILON2){let b=1/h.magnitudeSquared(l),x=h.dot(l,s)*b,T=h.multiplyByScalar(s,x,Nq);l=h.normalize(h.subtract(l,T,e._up),e._up),h.clone(l,e.up),f=h.cross(s,l,e._right),h.clone(f,e.right)}}(a||p)&&(e._directionWC=k.multiplyByPointAsVector(g,s,e._directionWC),h.normalize(e._directionWC,e._directionWC)),(u||p)&&(e._upWC=k.multiplyByPointAsVector(g,l,e._upWC),h.normalize(e._upWC,e._upWC)),(d||p)&&(e._rightWC=k.multiplyByPointAsVector(g,f,e._rightWC),h.normalize(e._rightWC,e._rightWC)),(r||a||u||d||p)&&tye(e)}function nye(e,t){let n;return R.equalsEpsilon(Math.abs(e.z),1,R.EPSILON3)?n=Math.atan2(t.y,t.x)-R.PI_OVER_TWO:n=Math.atan2(e.y,e.x)-R.PI_OVER_TWO,R.TWO_PI-R.zeroToTwoPi(n)}function iye(e){return R.PI_OVER_TWO-R.acosClamped(e.z)}function oye(e,t,n){let i=0;return R.equalsEpsilon(Math.abs(e.z),1,R.EPSILON3)||(i=Math.atan2(-n.z,t.z),i=R.zeroToTwoPi(i+R.TWO_PI)),i}var UL=new k,zL=new k;Object.defineProperties(en.prototype,{transform:{get:function(){return this._transform}},inverseTransform:{get:function(){return ic(this),this._invTransform}},viewMatrix:{get:function(){return ic(this),this._viewMatrix}},inverseViewMatrix:{get:function(){return ic(this),this._invViewMatrix}},positionCartographic:{get:function(){return ic(this),this._positionCartographic}},positionWC:{get:function(){return ic(this),this._positionWC}},directionWC:{get:function(){return ic(this),this._directionWC}},upWC:{get:function(){return ic(this),this._upWC}},rightWC:{get:function(){return ic(this),this._rightWC}},heading:{get:function(){if(this._mode!==oe.MORPHING){let e=this._projection.ellipsoid,t=k.clone(this._transform,UL),n=Ft.eastNorthUpToFixedFrame(this.positionWC,e,zL);this._setTransform(n);let i=nye(this.direction,this.up);return this._setTransform(t),i}}},pitch:{get:function(){if(this._mode!==oe.MORPHING){let e=this._projection.ellipsoid,t=k.clone(this._transform,UL),n=Ft.eastNorthUpToFixedFrame(this.positionWC,e,zL);this._setTransform(n);let i=iye(this.direction);return this._setTransform(t),i}}},roll:{get:function(){if(this._mode!==oe.MORPHING){let e=this._projection.ellipsoid,t=k.clone(this._transform,UL),n=Ft.eastNorthUpToFixedFrame(this.positionWC,e,zL);this._setTransform(n);let i=oye(this.direction,this.up,this.right);return this._setTransform(t),i}}},moveStart:{get:function(){return this._moveStart}},moveEnd:{get:function(){return this._moveEnd}},changed:{get:function(){return this._changed}}});en.prototype.update=function(e){if(!c(e))throw new E("mode is required.");if(e===oe.SCENE2D&&!(this.frustum instanceof er))throw new E("An OrthographicOffCenterFrustum is required in 2D.");if((e===oe.SCENE3D||e===oe.COLUMBUS_VIEW)&&!(this.frustum instanceof vi)&&!(this.frustum instanceof rn))throw new E("A PerspectiveFrustum or OrthographicFrustum is required in 3D and Columbus view");let t=!1;if(e!==this._mode&&(this._mode=e,this._modeChanged=e!==oe.MORPHING,t=this._mode===oe.SCENE2D),t){let n=this._max2Dfrustum=this.frustum.clone();if(!(n instanceof er))throw new E("The camera frustum is expected to be orthographic for 2D camera control.");let i=2,o=n.top/n.right;n.right=this._maxCoord.x*i,n.left=-n.right,n.top=o*n.right,n.bottom=-n.top}this._mode===oe.SCENE2D&&cye(this,this.position)};var Vat=new h,Uat=new h,zat=new h;en.prototype._setTransform=function(e){let t=h.clone(this.positionWC,Vat),n=h.clone(this.upWC,Uat),i=h.clone(this.directionWC,zat);k.clone(e,this._transform),this._transformChanged=!0,ic(this);let o=this._actualInvTransform;k.multiplyByPoint(o,t,this.position),k.multiplyByPointAsVector(o,i,this.direction),k.multiplyByPointAsVector(o,n,this.up),h.cross(this.direction,this.up,this.right),ic(this)};var Hat=new H,Gat=new _n,jat=new h,Wat=new h;function rye(e){if(!k.equals(k.IDENTITY,e.transform))return h.magnitude(e.position);let t=e._scene,n=t.globe,i=Hat;i.x=t.drawingBufferWidth/2,i.y=t.drawingBufferHeight/2;let o;if(c(n)){let a=e.getPickRay(i,Gat);o=n.pickWorldCoordinates(a,t,!0,jat)}let r;t.pickPositionSupported&&(r=t.pickPositionWorldCoordinates(i,Wat));let s;if(c(o)||c(r)){let a=c(r)?h.distance(r,e.positionWC):Number.POSITIVE_INFINITY,l=c(o)?h.distance(o,e.positionWC):Number.POSITIVE_INFINITY;s=Math.min(a,l)}else s=Math.max(e.positionCartographic.height,0);return s}en.prototype._adjustOrthographicFrustum=function(e){this.frustum instanceof rn&&(!e&&this._positionCartographic.height<15e4||(this.frustum.width=rye(this)))};var HL=new h,Uq=new k,qat=new k,zq=new Ne,Hq=new Q,sye=new he;function Yat(e,t,n){if(isNaN(t.x)||isNaN(t.y)||isNaN(t.z))throw new E("position has a NaN component");let i=k.clone(e.transform,Uq),o=Ft.eastNorthUpToFixedFrame(t,e._projection.ellipsoid,qat);e._setTransform(o),h.clone(h.ZERO,e.position),n.heading=n.heading-R.PI_OVER_TWO;let r=Ne.fromHeadingPitchRoll(n,zq),s=Q.fromQuaternion(r,Hq);Q.getColumn(s,0,e.direction),Q.getColumn(s,2,e.up),h.cross(e.direction,e.up,e.right),e._setTransform(i),e._adjustOrthographicFrustum(!0)}function Xat(e,t,n,i){let o=k.clone(e.transform,Uq);if(e._setTransform(k.IDENTITY),!h.equals(t,e.positionWC)){if(i){let a=e._projection,l=a.ellipsoid.cartesianToCartographic(t,sye);t=a.project(l,HL)}h.clone(t,e.position)}n.heading=n.heading-R.PI_OVER_TWO;let r=Ne.fromHeadingPitchRoll(n,zq),s=Q.fromQuaternion(r,Hq);Q.getColumn(s,0,e.direction),Q.getColumn(s,2,e.up),h.cross(e.direction,e.up,e.right),e._setTransform(o),e._adjustOrthographicFrustum(!0)}function Kat(e,t,n,i){let o=k.clone(e.transform,Uq);if(e._setTransform(k.IDENTITY),!h.equals(t,e.positionWC)){if(i){let l=e._projection,u=l.ellipsoid.cartesianToCartographic(t,sye);t=l.project(u,HL)}H.clone(t,e.position);let r=-t.z*.5,s=-r,a=e.frustum;if(s>r){let l=a.top/a.right;a.right=s,a.left=r,a.top=a.right*l,a.bottom=-a.top}}if(e._scene.mapMode2D===Ef.ROTATE){n.heading=n.heading-R.PI_OVER_TWO,n.pitch=-R.PI_OVER_TWO,n.roll=0;let r=Ne.fromHeadingPitchRoll(n,zq),s=Q.fromQuaternion(r,Hq);Q.getColumn(s,2,e.up),h.cross(e.direction,e.up,e.right)}e._setTransform(o)}var $at=new h,Zat=new h,Jat=new h;function aye(e,t,n,i){let o=h.clone(n.direction,$at),r=h.clone(n.up,Zat);if(e._scene.mode===oe.SCENE3D){let a=e._projection.ellipsoid,l=Ft.eastNorthUpToFixedFrame(t,a,UL),u=k.inverseTransformation(l,zL);k.multiplyByPointAsVector(u,o,o),k.multiplyByPointAsVector(u,r,r)}let s=h.cross(o,r,Jat);return i.heading=nye(o,r),i.pitch=iye(o),i.roll=oye(o,r,s),i}var Vq={destination:void 0,orientation:{direction:void 0,up:void 0,heading:void 0,pitch:void 0,roll:void 0},convert:void 0,endTransform:void 0},yC=new Fa;en.prototype.setView=function(e){e=y(e,y.EMPTY_OBJECT);let t=y(e.orientation,y.EMPTY_OBJECT),n=this._mode;if(n===oe.MORPHING)return;c(e.endTransform)&&this._setTransform(e.endTransform);let i=y(e.convert,!0),o=y(e.destination,h.clone(this.positionWC,HL));if(c(o)&&c(o.west)){if(o=this.getRectangleCameraCoordinates(o,HL),isNaN(o.x)||isNaN(o.y))throw new E("destination has a NaN component");i=!1}c(t.direction)&&(t=aye(this,o,t,Vq.orientation)),yC.heading=y(t.heading,0),yC.pitch=y(t.pitch,-R.PI_OVER_TWO),yC.roll=y(t.roll,0),n===oe.SCENE3D?Yat(this,o,yC):n===oe.SCENE2D?Kat(this,o,yC,i):Xat(this,o,yC,i)};var Qat=new h;en.prototype.flyHome=function(e){let t=this._mode;if(t===oe.MORPHING&&this._scene.completeMorph(),t===oe.SCENE2D)this.flyTo({destination:en.DEFAULT_VIEW_RECTANGLE,duration:e,endTransform:k.IDENTITY});else if(t===oe.SCENE3D){let n=this.getRectangleCameraCoordinates(en.DEFAULT_VIEW_RECTANGLE),i=h.magnitude(n);i+=i*en.DEFAULT_VIEW_FACTOR,h.normalize(n,n),h.multiplyByScalar(n,i,n),this.flyTo({destination:n,duration:e,endTransform:k.IDENTITY})}else if(t===oe.COLUMBUS_VIEW){let n=this._projection.ellipsoid.maximumRadius,i=new h(0,-1,1);i=h.multiplyByScalar(h.normalize(i,i),5*n,i),this.flyTo({destination:i,duration:e,orientation:{heading:0,pitch:-Math.acos(h.normalize(i,Qat).z),roll:0},endTransform:k.IDENTITY,convert:!1})}};en.prototype.worldToCameraCoordinates=function(e,t){if(!c(e))throw new E("cartesian is required.");return c(t)||(t=new se),ic(this),k.multiplyByVector(this._actualInvTransform,e,t)};en.prototype.worldToCameraCoordinatesPoint=function(e,t){if(!c(e))throw new E("cartesian is required.");return c(t)||(t=new h),ic(this),k.multiplyByPoint(this._actualInvTransform,e,t)};en.prototype.worldToCameraCoordinatesVector=function(e,t){if(!c(e))throw new E("cartesian is required.");return c(t)||(t=new h),ic(this),k.multiplyByPointAsVector(this._actualInvTransform,e,t)};en.prototype.cameraToWorldCoordinates=function(e,t){if(!c(e))throw new E("cartesian is required.");return c(t)||(t=new se),ic(this),k.multiplyByVector(this._actualTransform,e,t)};en.prototype.cameraToWorldCoordinatesPoint=function(e,t){if(!c(e))throw new E("cartesian is required.");return c(t)||(t=new h),ic(this),k.multiplyByPoint(this._actualTransform,e,t)};en.prototype.cameraToWorldCoordinatesVector=function(e,t){if(!c(e))throw new E("cartesian is required.");return c(t)||(t=new h),ic(this),k.multiplyByPointAsVector(this._actualTransform,e,t)};function cye(e,t){let n=e._scene.mapMode2D===Ef.ROTATE,i=e._maxCoord.x,o=e._maxCoord.y,r,s;n?(s=i,r=-s):(s=t.x-i*2,r=t.x+i*2),t.x>i&&(t.x=s),t.x<-i&&(t.x=r),t.y>o&&(t.y=o),t.y<-o&&(t.y=-o)}var Xge=new h;en.prototype.move=function(e,t){if(!c(e))throw new E("direction is required.");let n=this.position;h.multiplyByScalar(e,t,Xge),h.add(n,Xge,n),this._mode===oe.SCENE2D&&cye(this,n),this._adjustOrthographicFrustum(!0)};en.prototype.moveForward=function(e){e=y(e,this.defaultMoveAmount),this._mode===oe.SCENE2D?GL(this,e):this.move(this.direction,e)};en.prototype.moveBackward=function(e){e=y(e,this.defaultMoveAmount),this._mode===oe.SCENE2D?GL(this,-e):this.move(this.direction,-e)};en.prototype.moveUp=function(e){e=y(e,this.defaultMoveAmount),this.move(this.up,e)};en.prototype.moveDown=function(e){e=y(e,this.defaultMoveAmount),this.move(this.up,-e)};en.prototype.moveRight=function(e){e=y(e,this.defaultMoveAmount),this.move(this.right,e)};en.prototype.moveLeft=function(e){e=y(e,this.defaultMoveAmount),this.move(this.right,-e)};en.prototype.lookLeft=function(e){e=y(e,this.defaultLookAmount),this._mode!==oe.SCENE2D&&this.look(this.up,-e)};en.prototype.lookRight=function(e){e=y(e,this.defaultLookAmount),this._mode!==oe.SCENE2D&&this.look(this.up,e)};en.prototype.lookUp=function(e){e=y(e,this.defaultLookAmount),this._mode!==oe.SCENE2D&&this.look(this.right,-e)};en.prototype.lookDown=function(e){e=y(e,this.defaultLookAmount),this._mode!==oe.SCENE2D&&this.look(this.right,e)};var ect=new Ne,tct=new Q;en.prototype.look=function(e,t){if(!c(e))throw new E("axis is required.");let n=y(t,this.defaultLookAmount),i=Ne.fromAxisAngle(e,-n,ect),o=Q.fromQuaternion(i,tct),r=this.direction,s=this.up,a=this.right;Q.multiplyByVector(o,r,r),Q.multiplyByVector(o,s,s),Q.multiplyByVector(o,a,a)};en.prototype.twistLeft=function(e){e=y(e,this.defaultLookAmount),this.look(this.direction,e)};en.prototype.twistRight=function(e){e=y(e,this.defaultLookAmount),this.look(this.direction,-e)};var nct=new Ne,ict=new Q;en.prototype.rotate=function(e,t){if(!c(e))throw new E("axis is required.");let n=y(t,this.defaultRotateAmount),i=Ne.fromAxisAngle(e,-n,nct),o=Q.fromQuaternion(i,ict);Q.multiplyByVector(o,this.position,this.position),Q.multiplyByVector(o,this.direction,this.direction),Q.multiplyByVector(o,this.up,this.up),h.cross(this.direction,this.up,this.right),h.cross(this.right,this.direction,this.up),this._adjustOrthographicFrustum(!1)};en.prototype.rotateDown=function(e){e=y(e,this.defaultRotateAmount),lye(this,e)};en.prototype.rotateUp=function(e){e=y(e,this.defaultRotateAmount),lye(this,-e)};var oct=new h,rct=new h,sct=new h,Kge=new h;function lye(e,t){let n=e.position;if(c(e.constrainedAxis)&&!h.equalsEpsilon(e.position,h.ZERO,R.EPSILON2)){let i=h.normalize(n,oct),o=h.equalsEpsilon(i,e.constrainedAxis,R.EPSILON2),r=h.equalsEpsilon(i,h.negate(e.constrainedAxis,Kge),R.EPSILON2);if(!o&&!r){let s=h.normalize(e.constrainedAxis,rct),a=h.dot(i,s),l=R.acosClamped(a);t>0&&t>l&&(t=l-R.EPSILON4),a=h.dot(i,h.negate(s,Kge)),l=R.acosClamped(a),t<0&&-t>l&&(t=-l+R.EPSILON4);let u=h.cross(s,i,sct);e.rotate(u,t)}else(o&&t<0||r&&t>0)&&e.rotate(e.right,t)}else e.rotate(e.right,t)}en.prototype.rotateRight=function(e){e=y(e,this.defaultRotateAmount),uye(this,-e)};en.prototype.rotateLeft=function(e){e=y(e,this.defaultRotateAmount),uye(this,e)};function uye(e,t){c(e.constrainedAxis)?e.rotate(e.constrainedAxis,t):e.rotate(e.up,t)}function GL(e,t){let n=e.frustum;if(!(n instanceof er)||!c(n.left)||!c(n.right)||!c(n.bottom)||!c(n.top))throw new E("The camera frustum is expected to be orthographic for 2D camera control.");let i;if(t=t*.5,Math.abs(n.top)+Math.abs(n.bottom)>Math.abs(n.left)+Math.abs(n.right)){let o=n.top-t,r=n.bottom+t,s=e._maxCoord.y;e._scene.mapMode2D===Ef.ROTATE&&(s*=e.maximumZoomFactor),r>s&&(r=s,o=-s),o<=r&&(o=1,r=-1),i=n.right/n.top,n.top=o,n.bottom=r,n.right=n.top*i,n.left=-n.right}else{let o=n.right-t,r=n.left+t,s=e._maxCoord.x;e._scene.mapMode2D===Ef.ROTATE&&(s*=e.maximumZoomFactor),o>s&&(o=s,r=-s),o<=r&&(o=1,r=-1),i=n.top/n.right,n.right=o,n.left=r,n.top=n.right*i,n.bottom=-n.top}}function fye(e,t){e.move(e.direction,t)}en.prototype.zoomIn=function(e){e=y(e,this.defaultZoomAmount),this._mode===oe.SCENE2D?GL(this,e):fye(this,e)};en.prototype.zoomOut=function(e){e=y(e,this.defaultZoomAmount),this._mode===oe.SCENE2D?GL(this,-e):fye(this,-e)};en.prototype.getMagnitude=function(){if(this._mode===oe.SCENE3D)return h.magnitude(this.position);if(this._mode===oe.COLUMBUS_VIEW)return Math.abs(this.position.z);if(this._mode===oe.SCENE2D)return Math.max(this.frustum.right-this.frustum.left,this.frustum.top-this.frustum.bottom)};var act=new k;en.prototype.lookAt=function(e,t){if(!c(e))throw new E("target is required");if(!c(t))throw new E("offset is required");if(this._mode===oe.MORPHING)throw new E("lookAt is not supported while morphing.");let n=this._scene,i=y(n.ellipsoid,ie.default),o=Ft.eastNorthUpToFixedFrame(e,i,act);this.lookAtTransform(o,t)};var cct=new h,lct=new Ne,uct=new Ne,fct=new Q;function dye(e,t,n){t=R.clamp(t,-R.PI_OVER_TWO,R.PI_OVER_TWO),e=R.zeroToTwoPi(e)-R.PI_OVER_TWO;let i=Ne.fromAxisAngle(h.UNIT_Y,-t,lct),o=Ne.fromAxisAngle(h.UNIT_Z,-e,uct),r=Ne.multiply(o,i,o),s=Q.fromQuaternion(r,fct),a=h.clone(h.UNIT_X,cct);return Q.multiplyByVector(s,a,a),h.negate(a,a),h.multiplyByScalar(a,n,a),a}en.prototype.lookAtTransform=function(e,t){if(!c(e))throw new E("transform is required");if(this._mode===oe.MORPHING)throw new E("lookAtTransform is not supported while morphing.");if(this._setTransform(e),!c(t))return;let n;if(c(t.heading)?n=dye(t.heading,t.pitch,t.range):n=t,this._mode===oe.SCENE2D){H.clone(H.ZERO,this.position),h.negate(n,this.up),this.up.z=0,h.magnitudeSquared(this.up)<R.EPSILON10&&h.clone(h.UNIT_Y,this.up),h.normalize(this.up,this.up),this._setTransform(k.IDENTITY),h.negate(h.UNIT_Z,this.direction),h.cross(this.direction,this.up,this.right),h.normalize(this.right,this.right);let i=this.frustum,o=i.top/i.right;i.right=h.magnitude(n)*.5,i.left=-i.right,i.top=o*i.right,i.bottom=-i.top,this._setTransform(e);return}h.clone(n,this.position),h.negate(this.position,this.direction),h.normalize(this.direction,this.direction),h.cross(this.direction,h.UNIT_Z,this.right),h.magnitudeSquared(this.right)<R.EPSILON10&&h.clone(h.UNIT_X,this.right),h.normalize(this.right,this.right),h.cross(this.right,this.direction,this.up),h.normalize(this.up,this.up),this._adjustOrthographicFrustum(!0)};var LD=new he,dct=new he,hct=new h,mct=new h,pct=new h,_ct=new h,gct=new h,yct=new h,bct=new h,Fq=new h,xct={direction:new h,right:new h,up:new h},$ge;function nc(e,t,n,i){return Math.abs(h.dot(t,n))/i-h.dot(e,n)}function hye(e,t,n,i){let o=e._projection.ellipsoid,r=i?e:xct,{north:s,south:a,west:l}=t,{east:u}=t;l>u&&(u+=R.TWO_PI);let f=(l+u)*.5,d;if(a<-R.PI_OVER_TWO+R.RADIANS_PER_DEGREE&&s>R.PI_OVER_TWO-R.RADIANS_PER_DEGREE)d=0;else{let N=LD;N.longitude=f,N.latitude=s,N.height=0;let B=dct;B.longitude=f,B.latitude=a,B.height=0;let _=$ge;(!c(_)||_.ellipsoid!==o)&&($ge=_=new Xy(void 0,void 0,o)),_.setEndPoints(N,B),d=_.interpolateUsingFraction(.5,LD).latitude}let p=LD;p.longitude=f,p.latitude=d,p.height=0;let g=o.cartographicToCartesian(p,bct),m=LD;m.longitude=u,m.latitude=s;let b=o.cartographicToCartesian(m,hct);m.longitude=l;let x=o.cartographicToCartesian(m,pct);m.longitude=f;let T=o.cartographicToCartesian(m,gct);m.latitude=a;let C=o.cartographicToCartesian(m,yct);m.longitude=u;let S=o.cartographicToCartesian(m,_ct);m.longitude=l;let v=o.cartographicToCartesian(m,mct);h.subtract(x,g,x),h.subtract(S,g,S),h.subtract(b,g,b),h.subtract(v,g,v),h.subtract(T,g,T),h.subtract(C,g,C);let D=o.geodeticSurfaceNormal(g,r.direction);h.negate(D,D);let I=h.cross(D,h.UNIT_Z,r.right);h.normalize(I,I);let L=h.cross(I,D,r.up),M;if(e.frustum instanceof rn){let N=Math.max(h.distance(b,x),h.distance(S,v)),B=Math.max(h.distance(b,S),h.distance(x,v)),_,w,P=e.frustum._offCenterFrustum,O=P.right/P.top,F=B*O;N>F?(_=N,w=_/O):(w=B,_=F),M=Math.max(_,w)}else{let N=Math.tan(e.frustum.fovy*.5),B=e.frustum.aspectRatio*N;if(M=Math.max(nc(D,L,x,N),nc(D,L,S,N),nc(D,L,b,N),nc(D,L,v,N),nc(D,L,T,N),nc(D,L,C,N),nc(D,I,x,B),nc(D,I,S,B),nc(D,I,b,B),nc(D,I,v,B),nc(D,I,T,B),nc(D,I,C,B)),a<0&&s>0){let _=LD;_.longitude=l,_.latitude=0,_.height=0;let w=o.cartographicToCartesian(_,Fq);h.subtract(w,g,w),M=Math.max(M,nc(D,L,w,N),nc(D,I,w,B)),_.longitude=u,w=o.cartographicToCartesian(_,Fq),h.subtract(w,g,w),M=Math.max(M,nc(D,L,w,N),nc(D,I,w,B))}}return h.add(g,h.multiplyByScalar(D,-M,Fq),n)}var Tct=new he,Act=new h,Cct=new h;function Ect(e,t,n){let i=e._projection;t.west>t.east&&(t=ae.MAX_VALUE);let o=e._actualTransform,r=e._actualInvTransform,s=Tct;s.longitude=t.east,s.latitude=t.north;let a=i.project(s,Act);k.multiplyByPoint(o,a,a),k.multiplyByPoint(r,a,a),s.longitude=t.west,s.latitude=t.south;let l=i.project(s,Cct);if(k.multiplyByPoint(o,l,l),k.multiplyByPoint(r,l,l),n.x=(a.x-l.x)*.5+l.x,n.y=(a.y-l.y)*.5+l.y,c(e.frustum.fovy)){let u=Math.tan(e.frustum.fovy*.5),f=e.frustum.aspectRatio*u;n.z=Math.max((a.x-l.x)/f,(a.y-l.y)/u)*.5}else{let u=a.x-l.x,f=a.y-l.y;n.z=Math.max(u,f)}return n}var Sct=new he,wct=new h,vct=new h;function Dct(e,t,n){let i=e._projection,o=t.east;t.west>t.east&&(e._scene.mapMode2D===Ef.INFINITE_SCROLL?o+=R.TWO_PI:(t=ae.MAX_VALUE,o=t.east));let r=Sct;r.longitude=o,r.latitude=t.north;let s=i.project(r,wct);r.longitude=t.west,r.latitude=t.south;let a=i.project(r,vct),l=Math.abs(s.x-a.x)*.5,u=Math.abs(s.y-a.y)*.5,f,d,p=e.frustum.right/e.frustum.top,g=u*p;return l>g?(f=l,d=f/p):(d=u,f=g),u=Math.max(2*f,2*d),n.x=(s.x-a.x)*.5+a.x,n.y=(s.y-a.y)*.5+a.y,r=i.unproject(n,r),r.height=u,n=i.project(r,n),n}en.prototype.getRectangleCameraCoordinates=function(e,t){if(!c(e))throw new E("rectangle is required");let n=this._mode;if(c(t)||(t=new h),n===oe.SCENE3D)return hye(this,e,t);if(n===oe.COLUMBUS_VIEW)return Ect(this,e,t);if(n===oe.SCENE2D)return Dct(this,e,t)};var Pct=new _n;function Ict(e,t,n,i){n=y(n,ie.default);let o=e.getPickRay(t,Pct),r=Qn.rayEllipsoid(o,n);if(!r)return;let s=r.start>0?r.start:r.stop;return _n.getPoint(o,s,i)}var Oct=new _n;function Rct(e,t,n,i){let r=e.getPickRay(t,Oct).origin;r=h.fromElements(r.y,r.z,0,r);let s=n.unproject(r);if(!(s.latitude<-R.PI_OVER_TWO||s.latitude>R.PI_OVER_TWO))return n.ellipsoid.cartographicToCartesian(s,i)}var Mct=new _n;function Lct(e,t,n,i){let o=e.getPickRay(t,Mct),r=-o.origin.x/o.direction.x;_n.getPoint(o,r,i);let s=n.unproject(new h(i.y,i.z,0));if(!(s.latitude<-R.PI_OVER_TWO||s.latitude>R.PI_OVER_TWO||s.longitude<-Math.PI||s.longitude>Math.PI))return n.ellipsoid.cartographicToCartesian(s,i)}en.prototype.pickEllipsoid=function(e,t,n){if(!c(e))throw new E("windowPosition is required.");let i=this._scene.canvas;if(!(i.clientWidth===0||i.clientHeight===0)){if(c(n)||(n=new h),t=y(t,ie.default),this._mode===oe.SCENE3D)n=Ict(this,e,t,n);else if(this._mode===oe.SCENE2D)n=Rct(this,e,this._projection,n);else if(this._mode===oe.COLUMBUS_VIEW)n=Lct(this,e,this._projection,n);else return;return n}};var Nct=new h,Fct=new h,Bct=new h;function kct(e,t,n){let i=e._scene.canvas,o=i.clientWidth,r=i.clientHeight,s=Math.tan(e.frustum.fovy*.5),a=e.frustum.aspectRatio*s,l=e.frustum.near,u=2/o*t.x-1,f=2/r*(r-t.y)-1,d=e.positionWC;h.clone(d,n.origin);let p=h.multiplyByScalar(e.directionWC,l,Nct);h.add(d,p,p);let g=h.multiplyByScalar(e.rightWC,u*l*a,Fct),m=h.multiplyByScalar(e.upWC,f*l*s,Bct),b=h.add(p,g,n.direction);return h.add(b,m,b),h.subtract(b,d,b),h.normalize(b,b),n}var kL=new h;function Vct(e,t,n){let i=e._scene.canvas,o=i.clientWidth,r=i.clientHeight,s=e.frustum,a=s.offCenterFrustum;c(a)&&(s=a);let l=2/o*t.x-1;l*=(s.right-s.left)*.5;let u=2/r*(r-t.y)-1;u*=(s.top-s.bottom)*.5;let f=n.origin;return h.clone(e.position,f),h.multiplyByScalar(e.right,l,kL),h.add(kL,f,f),h.multiplyByScalar(e.up,u,kL),h.add(kL,f,f),h.clone(e.directionWC,n.direction),(e._mode===oe.COLUMBUS_VIEW||e._mode===oe.SCENE2D)&&h.fromElements(n.origin.z,n.origin.x,n.origin.y,n.origin),n}en.prototype.getPickRay=function(e,t){if(!c(e))throw new E("windowPosition is required.");c(t)||(t=new _n);let n=this._scene.canvas;if(n.clientWidth<=0||n.clientHeight<=0)return;let i=this.frustum;return c(i.aspectRatio)&&c(i.fov)&&c(i.near)?kct(this,e,t):Vct(this,e,t)};var Uct=new h,zct=new h;en.prototype.distanceToBoundingSphere=function(e){if(!c(e))throw new E("boundingSphere is required.");let t=h.subtract(this.positionWC,e.center,Uct),n=h.multiplyByScalar(this.directionWC,h.dot(t,this.directionWC),zct);return Math.max(0,h.magnitude(n)-e.radius)};var Hct=new H;en.prototype.getPixelSize=function(e,t,n){if(!c(e))throw new E("boundingSphere is required.");if(!c(t))throw new E("drawingBufferWidth is required.");if(!c(n))throw new E("drawingBufferHeight is required.");let i=this.distanceToBoundingSphere(e),o=this.frustum.getPixelDimensions(t,n,i,this._scene.pixelRatio,Hct);return Math.max(o.x,o.y)};function Gct(e,t,n,i,o,r){let s=h.clone(t);n.y>i?s.y-=n.y-i:n.y<-i&&(s.y+=-i-n.y),n.z>o?s.z-=n.z-o:n.z<-o&&(s.z+=-o-n.z);function a(l){let u=h.lerp(t,s,l.time,new h);e.worldToCameraCoordinatesPoint(u,e.position)}return{easingFunction:qr.EXPONENTIAL_OUT,startObject:{time:0},stopObject:{time:1},duration:r,update:a}}var jct=new h,Zge=new h,Wct=new h,qct=new h;function Yct(e,t){let n=e.position,i=e.direction,o=e.worldToCameraCoordinatesVector(h.UNIT_X,jct),r=-h.dot(o,n)/h.dot(o,i),s=h.add(n,h.multiplyByScalar(i,r,Zge),Zge);e.cameraToWorldCoordinatesPoint(s,s),n=e.cameraToWorldCoordinatesPoint(e.position,Wct);let a=Math.tan(e.frustum.fovy*.5),l=e.frustum.aspectRatio*a,u=h.magnitude(h.subtract(n,s,qct)),f=l*u,d=a*u,p=e._maxCoord.x,g=e._maxCoord.y,m=Math.max(f-p,p),b=Math.max(d-g,g);if(n.z<-m||n.z>m||n.y<-b||n.y>b){let x=s.y<-m||s.y>m,T=s.z<-b||s.z>b;if(x||T)return Gct(e,n,s,m,b,t)}}en.prototype.createCorrectPositionTween=function(e){if(!c(e))throw new E("duration is required.");if(this._mode===oe.COLUMBUS_VIEW)return Yct(this,e)};var Xct=new h,Vs={destination:void 0,heading:void 0,pitch:void 0,roll:void 0,duration:void 0,complete:void 0,cancel:void 0,endTransform:void 0,maximumHeight:void 0,easingFunction:void 0};en.prototype.cancelFlight=function(){c(this._currentFlight)&&(this._currentFlight.cancelTween(),this._currentFlight=void 0)};en.prototype.completeFlight=function(){if(c(this._currentFlight)){this._currentFlight.cancelTween();let e={destination:void 0,orientation:{heading:void 0,pitch:void 0,roll:void 0}};e.destination=Vs.destination,e.orientation.heading=Vs.heading,e.orientation.pitch=Vs.pitch,e.orientation.roll=Vs.roll,this.setView(e),c(this._currentFlight.complete)&&this._currentFlight.complete(),this._currentFlight=void 0}};en.prototype.flyTo=function(e){e=y(e,y.EMPTY_OBJECT);let t=e.destination;if(!c(t))throw new E("destination is required.");if(this._mode===oe.MORPHING)return;this.cancelFlight();let i=t instanceof ae;i&&(t=this.getRectangleCameraCoordinates(t,Xct));let o=y(e.orientation,y.EMPTY_OBJECT);if(c(o.direction)&&(o=aye(this,t,o,Vq.orientation)),c(e.duration)&&e.duration<=0){let f=Vq;f.destination=e.destination,f.orientation.heading=o.heading,f.orientation.pitch=o.pitch,f.orientation.roll=o.roll,f.convert=e.convert,f.endTransform=e.endTransform,this.setView(f),typeof e.complete=="function"&&e.complete();return}let r=this,s;Vs.destination=t,Vs.heading=o.heading,Vs.pitch=o.pitch,Vs.roll=o.roll,Vs.duration=e.duration,Vs.complete=function(){s===r._currentFlight&&(r._currentFlight=void 0),c(e.complete)&&e.complete()},Vs.cancel=e.cancel,Vs.endTransform=e.endTransform,Vs.convert=i?!1:e.convert,Vs.maximumHeight=e.maximumHeight,Vs.pitchAdjustHeight=e.pitchAdjustHeight,Vs.flyOverLongitude=e.flyOverLongitude,Vs.flyOverLongitudeWeight=e.flyOverLongitudeWeight,Vs.easingFunction=e.easingFunction;let a=this._scene,l=Lq.createTween(a,Vs);if(l.duration===0){typeof l.complete=="function"&&l.complete();return}s=a.tweens.add(l),this._currentFlight=s;let u=this._scene.preloadFlightCamera;this._mode!==oe.SCENE2D&&(c(u)||(u=en.clone(this)),u.setView({destination:t,orientation:o}),this._scene.preloadFlightCullingVolume=u.frustum.computeCullingVolume(u.positionWC,u.directionWC,u.upWC))};function Kct(e,t){let n=e.frustum,i=Math.tan(n.fovy*.5),o=n.aspectRatio*i;return Math.max(t/o,t/i)}function $ct(e,t){let n=e.frustum,i=n.offCenterFrustum;c(i)&&(n=i);let o,r,s=n.right/n.top,a=t*s;return t>a?(o=t,r=o/s):(r=t,o=a),Math.max(o,r)*1.5}var Zct=100;function mye(e,t,n){n=zh.clone(c(n)?n:en.DEFAULT_OFFSET);let i=e._scene.screenSpaceCameraController.minimumZoomDistance,o=e._scene.screenSpaceCameraController.maximumZoomDistance,r=n.range;if(!c(r)||r===0){let s=t.radius;s===0?n.range=Zct:e.frustum instanceof rn||e._mode===oe.SCENE2D?n.range=$ct(e,s):n.range=Kct(e,s),n.range=R.clamp(n.range,i,o)}return n}en.prototype.viewBoundingSphere=function(e,t){if(!c(e))throw new E("boundingSphere is required.");if(this._mode===oe.MORPHING)throw new E("viewBoundingSphere is not supported while morphing.");t=mye(this,e,t),this.lookAt(e.center,t)};var Jct=new k,Qct=new h,elt=new h,tlt=new h,nlt=new h,ilt=new se,olt=new Ne,rlt=new Q;en.prototype.flyToBoundingSphere=function(e,t){if(!c(e))throw new E("boundingSphere is required.");t=y(t,y.EMPTY_OBJECT);let n=this._mode===oe.SCENE2D||this._mode===oe.COLUMBUS_VIEW;this._setTransform(k.IDENTITY);let i=mye(this,e,t.offset),o;n?o=h.multiplyByScalar(h.UNIT_Z,i.range,Qct):o=dye(i.heading,i.pitch,i.range);let r=this._scene,s=y(r.ellipsoid,ie.default),a=Ft.eastNorthUpToFixedFrame(e.center,s,Jct);k.multiplyByPoint(a,o,o);let l,u;if(!n){if(l=h.subtract(e.center,o,elt),h.normalize(l,l),u=k.multiplyByPointAsVector(a,h.UNIT_Z,tlt),1-Math.abs(h.dot(l,u))<R.EPSILON6){let d=Ne.fromAxisAngle(l,i.heading,olt),p=Q.fromQuaternion(d,rlt);h.fromCartesian4(k.getColumn(a,1,ilt),u),Q.multiplyByVector(p,u,u)}let f=h.cross(l,u,nlt);h.cross(f,l,u),h.normalize(u,u)}this.flyTo({destination:o,orientation:{direction:l,up:u},duration:t.duration,complete:t.complete,cancel:t.cancel,endTransform:t.endTransform,maximumHeight:t.maximumHeight,easingFunction:t.easingFunction,flyOverLongitude:t.flyOverLongitude,flyOverLongitudeWeight:t.flyOverLongitudeWeight,pitchAdjustHeight:t.pitchAdjustHeight})};var Jge=new h,Qge=new h,Bq=new h,eye=new h,ND=[new h,new h,new h,new h];function slt(e,t){let n=t.radii,i=e.positionWC,o=h.multiplyComponents(t.oneOverRadii,i,Jge),r=h.magnitude(o),s=h.normalize(o,Qge),a,l;h.equalsEpsilon(s,h.UNIT_Z,R.EPSILON10)?(a=new h(0,1,0),l=new h(0,0,1)):(a=h.normalize(h.cross(h.UNIT_Z,s,Bq),Bq),l=h.normalize(h.cross(s,a,eye),eye));let u=Math.sqrt(h.magnitudeSquared(o)-1),f=h.multiplyByScalar(s,1/r,Jge),d=u/r,p=h.multiplyByScalar(a,d,Qge),g=h.multiplyByScalar(l,d,Bq),m=h.add(f,g,ND[0]);h.subtract(m,p,m),h.multiplyComponents(n,m,m);let b=h.subtract(f,g,ND[1]);h.subtract(b,p,b),h.multiplyComponents(n,b,b);let x=h.subtract(f,g,ND[2]);h.add(x,p,x),h.multiplyComponents(n,x,x);let T=h.add(f,g,ND[3]);return h.add(T,p,T),h.multiplyComponents(n,T,T),ND}var kq=new H,alt=new h,ay=[new he,new he,new he,new he];function VL(e,t,n,i,o,r){kq.x=e,kq.y=t;let s=i.pickEllipsoid(kq,o,alt);return c(s)?(ay[n]=o.cartesianToCartographic(s,ay[n]),1):(ay[n]=o.cartesianToCartographic(r[n],ay[n]),0)}en.prototype.computeViewRectangle=function(e,t){e=y(e,ie.default);let n=this.frustum.computeCullingVolume(this.positionWC,this.directionWC,this.upWC),i=new ce(h.ZERO,e.maximumRadius);if(n.computeVisibility(i)===qt.OUTSIDE)return;let r=this._scene.canvas,s=r.clientWidth,a=r.clientHeight,l=0,u=slt(this,e);if(l+=VL(0,0,0,this,e,u),l+=VL(0,a,1,this,e,u),l+=VL(s,a,2,this,e,u),l+=VL(s,0,3,this,e,u),l<2)return ae.MAX_VALUE;t=ae.fromCartographicArray(ay,t);let f=0,d=ay[3].longitude;for(let p=0;p<4;++p){let g=ay[p].longitude,m=Math.abs(g-d);m>R.PI?f+=R.TWO_PI-m:f+=m,d=g}return R.equalsEpsilon(Math.abs(f),R.TWO_PI,R.EPSILON9)&&(t.west=-R.PI,t.east=R.PI,ay[0].latitude>=0?t.north=R.PI_OVER_TWO:t.south=-R.PI_OVER_TWO),t};en.prototype.switchToPerspectiveFrustum=function(){if(this._mode===oe.SCENE2D||this.frustum instanceof vi)return;let e=this._scene;this.frustum=new vi,this.frustum.aspectRatio=e.drawingBufferWidth/e.drawingBufferHeight,this.frustum.fov=R.toRadians(60)};en.prototype.switchToOrthographicFrustum=function(){if(this._mode===oe.SCENE2D||this.frustum instanceof rn)return;let e=rye(this),t=this._scene;this.frustum=new rn,this.frustum.aspectRatio=t.drawingBufferWidth/t.drawingBufferHeight,this.frustum.width=e};en.clone=function(e,t){return c(t)||(t=new en(e._scene)),h.clone(e.position,t.position),h.clone(e.direction,t.direction),h.clone(e.up,t.up),h.clone(e.right,t.right),k.clone(e._transform,t.transform),t._transformChanged=!0,t.frustum=e.frustum.clone(),t};var so=en;var clt={LEFT_DRAG:0,RIGHT_DRAG:1,MIDDLE_DRAG:2,WHEEL:3,PINCH:4},zi=Object.freeze(clt);function Us(e,t){let n=`${e}`;return c(t)&&(n+=`+${t}`),n}function llt(e,t){H.clone(e.distance.startPosition,t.distance.startPosition),H.clone(e.distance.endPosition,t.distance.endPosition),H.clone(e.angleAndHeight.startPosition,t.angleAndHeight.startPosition),H.clone(e.angleAndHeight.endPosition,t.angleAndHeight.endPosition)}function pye(e,t,n){let i=Us(zi.PINCH,t),o=e._update,r=e._isDown,s=e._eventStartPosition,a=e._pressTime,l=e._releaseTime;o[i]=!0,r[i]=!1,s[i]=new H;let u=e._movement[i];c(u)||(u=e._movement[i]={}),u.distance={startPosition:new H,endPosition:new H},u.angleAndHeight={startPosition:new H,endPosition:new H},u.prevAngle=0,e._eventHandler.setInputAction(function(f){e._buttonsDown++,r[i]=!0,a[i]=new Date,H.lerp(f.position1,f.position2,.5,s[i])},bn.PINCH_START,t),e._eventHandler.setInputAction(function(){e._buttonsDown=Math.max(e._buttonsDown-1,0),r[i]=!1,l[i]=new Date},bn.PINCH_END,t),e._eventHandler.setInputAction(function(f){if(r[i]){o[i]?(llt(f,u),o[i]=!1,u.prevAngle=u.angleAndHeight.startPosition.x):(H.clone(f.distance.endPosition,u.distance.endPosition),H.clone(f.angleAndHeight.endPosition,u.angleAndHeight.endPosition));let d=u.angleAndHeight.endPosition.x,p=u.prevAngle,g=Math.PI*2;for(;d>=p+Math.PI;)d-=g;for(;d<p-Math.PI;)d+=g;u.angleAndHeight.endPosition.x=-d*n.clientWidth/12,u.angleAndHeight.startPosition.x=-p*n.clientWidth/12}},bn.PINCH_MOVE,t)}function _ye(e,t){let n=Us(zi.WHEEL,t),i=e._pressTime,o=e._releaseTime,r=e._update;r[n]=!0;let s=e._movement[n];c(s)||(s=e._movement[n]={});let a=e._lastMovement[n];c(a)||(a=e._lastMovement[n]={startPosition:new H,endPosition:new H,valid:!1}),s.startPosition=new H,H.clone(H.ZERO,s.startPosition),s.endPosition=new H,e._eventHandler.setInputAction(function(l){let u=7.5*R.toRadians(l);i[n]=o[n]=new Date,s.endPosition.x=0,s.endPosition.y=u,H.clone(s.endPosition,a.endPosition),a.valid=!0,r[n]=!1},bn.WHEEL,t)}function bC(e,t,n){let i=Us(n,t),o=e._isDown,r=e._eventStartPosition,s=e._pressTime;o[i]=!1,r[i]=new H;let a=e._lastMovement[i];c(a)||(a=e._lastMovement[i]={startPosition:new H,endPosition:new H,valid:!1});let l,u;n===zi.LEFT_DRAG?(l=bn.LEFT_DOWN,u=bn.LEFT_UP):n===zi.RIGHT_DRAG?(l=bn.RIGHT_DOWN,u=bn.RIGHT_UP):n===zi.MIDDLE_DRAG&&(l=bn.MIDDLE_DOWN,u=bn.MIDDLE_UP),e._eventHandler.setInputAction(function(f){e._buttonsDown++,a.valid=!1,o[i]=!0,s[i]=new Date,H.clone(f.position,r[i])},l,t),e._eventHandler.setInputAction(function(){Gq(Us(n,void 0),e);for(let f of Object.values(Ca)){let d=Us(n,f);Gq(d,e)}},u,t)}function Gq(e,t){let n=t._releaseTime,i=t._isDown;i[e]&&(t._buttonsDown=Math.max(t._buttonsDown-1,0)),i[e]=!1,n[e]=new Date}function gye(e,t){H.clone(e.startPosition,t.startPosition),H.clone(e.endPosition,t.endPosition)}function ult(e,t,n){let i=n._isDown,o=!1,r=Us(e,t);for(let[l,u]of Object.entries(i))l.startsWith(e)&&u&&l!==r&&(o=!0,Gq(l,n));if(!o)return;let s=n._pressTime,a=n._lastMovement[r];c(a)||(a=n._lastMovement[r]={startPosition:new H,endPosition:new H,valid:!1}),n._buttonsDown++,a.valid=!1,i[r]=!0,s[r]=new Date}function yye(e,t){let n=e._update,i=e._movement,o=e._lastMovement,r=e._isDown;for(let s in zi)if(zi.hasOwnProperty(s)){let a=zi[s];if(c(a)){let l=Us(a,t);n[l]=!0,c(e._lastMovement[l])||(e._lastMovement[l]={startPosition:new H,endPosition:new H,valid:!1}),c(e._movement[l])||(e._movement[l]={startPosition:new H,endPosition:new H})}}e._eventHandler.setInputAction(function(s){for(let a in zi)if(zi.hasOwnProperty(a)){let l=zi[a];if(c(l)){let u=Us(l,t);ult(l,t,e),r[u]&&(n[u]?(gye(i[u],o[u]),o[u].valid=!0,gye(s,i[u]),n[u]=!1):H.clone(s.endPosition,i[u].endPosition))}}H.clone(s.endPosition,e._currentMousePosition)},bn.MOUSE_MOVE,t)}function Sf(e){if(!c(e))throw new E("canvas is required.");this._eventHandler=new Af(e),this._update={},this._movement={},this._lastMovement={},this._isDown={},this._eventStartPosition={},this._pressTime={},this._releaseTime={},this._buttonsDown=0,this._currentMousePosition=new H,_ye(this,void 0),pye(this,void 0,e),bC(this,void 0,zi.LEFT_DRAG),bC(this,void 0,zi.RIGHT_DRAG),bC(this,void 0,zi.MIDDLE_DRAG),yye(this,void 0);for(let t in Ca)if(Ca.hasOwnProperty(t)){let n=Ca[t];c(n)&&(_ye(this,n),pye(this,n,e),bC(this,n,zi.LEFT_DRAG),bC(this,n,zi.RIGHT_DRAG),bC(this,n,zi.MIDDLE_DRAG),yye(this,n))}}Object.defineProperties(Sf.prototype,{currentMousePosition:{get:function(){return this._currentMousePosition}},anyButtonDown:{get:function(){let e=!this._update[Us(zi.WHEEL)]||!this._update[Us(zi.WHEEL,Ca.SHIFT)]||!this._update[Us(zi.WHEEL,Ca.CTRL)]||!this._update[Us(zi.WHEEL,Ca.ALT)];return this._buttonsDown>0||e}}});Sf.prototype.isMoving=function(e,t){if(!c(e))throw new E("type is required.");let n=Us(e,t);return!this._update[n]};Sf.prototype.getMovement=function(e,t){if(!c(e))throw new E("type is required.");let n=Us(e,t);return this._movement[n]};Sf.prototype.getLastMovement=function(e,t){if(!c(e))throw new E("type is required.");let n=Us(e,t),i=this._lastMovement[n];if(i.valid)return i};Sf.prototype.isButtonDown=function(e,t){if(!c(e))throw new E("type is required.");let n=Us(e,t);return this._isDown[n]};Sf.prototype.getStartMousePosition=function(e,t){if(!c(e))throw new E("type is required.");if(e===zi.WHEEL)return this._currentMousePosition;let n=Us(e,t);return this._eventStartPosition[n]};Sf.prototype.getButtonPressTime=function(e,t){if(!c(e))throw new E("type is required.");let n=Us(e,t);return this._pressTime[n]};Sf.prototype.getButtonReleaseTime=function(e,t){if(!c(e))throw new E("type is required.");let n=Us(e,t);return this._releaseTime[n]};Sf.prototype.reset=function(){for(let e in this._update)this._update.hasOwnProperty(e)&&(this._update[e]=!0)};Sf.prototype.isDestroyed=function(){return!1};Sf.prototype.destroy=function(){return this._eventHandler=this._eventHandler&&this._eventHandler.destroy(),de(this)};var jq=Sf;function rm(){this.featurePropertiesDirty=!1}Object.defineProperties(rm.prototype,{featuresLength:{get:function(){E.throwInstantiationError()}},pointsLength:{get:function(){E.throwInstantiationError()}},trianglesLength:{get:function(){E.throwInstantiationError()}},geometryByteLength:{get:function(){E.throwInstantiationError()}},texturesByteLength:{get:function(){E.throwInstantiationError()}},batchTableByteLength:{get:function(){E.throwInstantiationError()}},innerContents:{get:function(){E.throwInstantiationError()}},ready:{get:function(){E.throwInstantiationError()}},tileset:{get:function(){E.throwInstantiationError()}},tile:{get:function(){E.throwInstantiationError()}},url:{get:function(){E.throwInstantiationError()}},batchTable:{get:function(){E.throwInstantiationError()}},metadata:{get:function(){E.throwInstantiationError()},set:function(e){E.throwInstantiationError()}},group:{get:function(){E.throwInstantiationError()},set:function(e){E.throwInstantiationError()}}});rm.prototype.hasProperty=function(e,t){E.throwInstantiationError()};rm.prototype.getFeature=function(e){E.throwInstantiationError()};rm.prototype.applyDebugSettings=function(e,t){E.throwInstantiationError()};rm.prototype.applyStyle=function(e){E.throwInstantiationError()};rm.prototype.update=function(e,t){E.throwInstantiationError()};rm.prototype.pick=function(e,t,n){E.throwInstantiationError()};rm.prototype.isDestroyed=function(){E.throwInstantiationError()};rm.prototype.destroy=function(){E.throwInstantiationError()};var flt=rm;function dlt(e){A.typeOf.object("options",e),A.typeOf.number("options.pass",e.pass),this.pass=e.pass,this.commandList=e.commandList,this.camera=e.camera,this.cullingVolume=e.cullingVolume,this.ready=!1}var sm=dlt;function xC(e,t){this._conditionsExpression=qe(e,!0),this._conditions=e.conditions,this._runtimeConditions=void 0,mlt(this,t)}Object.defineProperties(xC.prototype,{conditionsExpression:{get:function(){return this._conditionsExpression}}});function hlt(e,t){this.condition=e,this.expression=t}function mlt(e,t){let n=[],i=e._conditions;if(!c(i))return;let o=i.length;for(let r=0;r<o;++r){let s=i[r],a=String(s[0]),l=String(s[1]);n.push(new hlt(new hh(a,t),new hh(l,t)))}e._runtimeConditions=n}xC.prototype.evaluate=function(e,t){let n=this._runtimeConditions;if(!c(n))return;let i=n.length;for(let o=0;o<i;++o){let r=n[o];if(r.condition.evaluate(e))return r.expression.evaluate(e,t)}};xC.prototype.evaluateColor=function(e,t){let n=this._runtimeConditions;if(!c(n))return;let i=n.length;for(let o=0;o<i;++o){let r=n[o];if(r.condition.evaluate(e))return r.expression.evaluateColor(e,t)}};xC.prototype.getShaderFunction=function(e,t,n,i){let o=this._runtimeConditions;if(!c(o)||o.length===0)return;let r="",s=o.length;for(let a=0;a<s;++a){let l=o[a],u=l.condition.getShaderExpression(t,n),f=l.expression.getShaderExpression(t,n);r+=`    ${a===0?"if":"else if"} (${u})
    {
        return ${f};
    }
`}return r=`${i} ${e}
{
${r}    return ${i}(1.0);
}
`,r};xC.prototype.getVariables=function(){let e=[],t=this._runtimeConditions;if(!c(t)||t.length===0)return e;let n=t.length;for(let i=0;i<n;++i){let o=t[i];e.push.apply(e,o.condition.getVariables()),e.push.apply(e,o.expression.getVariables())}return e=e.filter(function(i,o,r){return r.indexOf(i)===o}),e};var Wq=xC;function cy(e){this._style={},this._ready=!1,this._show=void 0,this._color=void 0,this._pointSize=void 0,this._pointOutlineColor=void 0,this._pointOutlineWidth=void 0,this._labelColor=void 0,this._labelOutlineColor=void 0,this._labelOutlineWidth=void 0,this._font=void 0,this._labelStyle=void 0,this._labelText=void 0,this._backgroundColor=void 0,this._backgroundPadding=void 0,this._backgroundEnabled=void 0,this._scaleByDistance=void 0,this._translucencyByDistance=void 0,this._distanceDisplayCondition=void 0,this._heightOffset=void 0,this._anchorLineEnabled=void 0,this._anchorLineColor=void 0,this._image=void 0,this._disableDepthTestDistance=void 0,this._horizontalOrigin=void 0,this._verticalOrigin=void 0,this._labelHorizontalOrigin=void 0,this._labelVerticalOrigin=void 0,this._meta=void 0,this._colorShaderFunction=void 0,this._showShaderFunction=void 0,this._pointSizeShaderFunction=void 0,this._colorShaderFunctionReady=!1,this._showShaderFunctionReady=!1,this._pointSizeShaderFunctionReady=!1,this._colorShaderTranslucent=!1,plt(this,e)}function plt(e,t){t=y(qe(t,!0),e._style),e._style=t,e.show=t.show,e.color=t.color,e.pointSize=t.pointSize,e.pointOutlineColor=t.pointOutlineColor,e.pointOutlineWidth=t.pointOutlineWidth,e.labelColor=t.labelColor,e.labelOutlineColor=t.labelOutlineColor,e.labelOutlineWidth=t.labelOutlineWidth,e.labelStyle=t.labelStyle,e.font=t.font,e.labelText=t.labelText,e.backgroundColor=t.backgroundColor,e.backgroundPadding=t.backgroundPadding,e.backgroundEnabled=t.backgroundEnabled,e.scaleByDistance=t.scaleByDistance,e.translucencyByDistance=t.translucencyByDistance,e.distanceDisplayCondition=t.distanceDisplayCondition,e.heightOffset=t.heightOffset,e.anchorLineEnabled=t.anchorLineEnabled,e.anchorLineColor=t.anchorLineColor,e.image=t.image,e.disableDepthTestDistance=t.disableDepthTestDistance,e.horizontalOrigin=t.horizontalOrigin,e.verticalOrigin=t.verticalOrigin,e.labelHorizontalOrigin=t.labelHorizontalOrigin,e.labelVerticalOrigin=t.labelVerticalOrigin;let n={};if(c(t.meta)){let i=t.defines,o=y(t.meta,y.EMPTY_OBJECT);for(let r in o)o.hasOwnProperty(r)&&(n[r]=new hh(o[r],i))}e._meta=n,e._ready=!0}function Xo(e,t){let n=y(e._style,y.EMPTY_OBJECT).defines;if(c(t)){if(typeof t=="boolean"||typeof t=="number")return new hh(String(t));if(typeof t=="string")return new hh(t,n);if(c(t.conditions))return new Wq(t,n)}else return;return t}function Ko(e){if(c(e)){if(c(e.expression))return e.expression;if(c(e.conditionsExpression))return qe(e.conditionsExpression,!0)}else return;return e}Object.defineProperties(cy.prototype,{style:{get:function(){return this._style}},show:{get:function(){return this._show},set:function(e){this._show=Xo(this,e),this._style.show=Ko(this._show),this._showShaderFunctionReady=!1}},color:{get:function(){return this._color},set:function(e){this._color=Xo(this,e),this._style.color=Ko(this._color),this._colorShaderFunctionReady=!1}},pointSize:{get:function(){return this._pointSize},set:function(e){this._pointSize=Xo(this,e),this._style.pointSize=Ko(this._pointSize),this._pointSizeShaderFunctionReady=!1}},pointOutlineColor:{get:function(){return this._pointOutlineColor},set:function(e){this._pointOutlineColor=Xo(this,e),this._style.pointOutlineColor=Ko(this._pointOutlineColor)}},pointOutlineWidth:{get:function(){return this._pointOutlineWidth},set:function(e){this._pointOutlineWidth=Xo(this,e),this._style.pointOutlineWidth=Ko(this._pointOutlineWidth)}},labelColor:{get:function(){return this._labelColor},set:function(e){this._labelColor=Xo(this,e),this._style.labelColor=Ko(this._labelColor)}},labelOutlineColor:{get:function(){return this._labelOutlineColor},set:function(e){this._labelOutlineColor=Xo(this,e),this._style.labelOutlineColor=Ko(this._labelOutlineColor)}},labelOutlineWidth:{get:function(){return this._labelOutlineWidth},set:function(e){this._labelOutlineWidth=Xo(this,e),this._style.labelOutlineWidth=Ko(this._labelOutlineWidth)}},font:{get:function(){return this._font},set:function(e){this._font=Xo(this,e),this._style.font=Ko(this._font)}},labelStyle:{get:function(){return this._labelStyle},set:function(e){this._labelStyle=Xo(this,e),this._style.labelStyle=Ko(this._labelStyle)}},labelText:{get:function(){return this._labelText},set:function(e){this._labelText=Xo(this,e),this._style.labelText=Ko(this._labelText)}},backgroundColor:{get:function(){return this._backgroundColor},set:function(e){this._backgroundColor=Xo(this,e),this._style.backgroundColor=Ko(this._backgroundColor)}},backgroundPadding:{get:function(){return this._backgroundPadding},set:function(e){this._backgroundPadding=Xo(this,e),this._style.backgroundPadding=Ko(this._backgroundPadding)}},backgroundEnabled:{get:function(){return this._backgroundEnabled},set:function(e){this._backgroundEnabled=Xo(this,e),this._style.backgroundEnabled=Ko(this._backgroundEnabled)}},scaleByDistance:{get:function(){return this._scaleByDistance},set:function(e){this._scaleByDistance=Xo(this,e),this._style.scaleByDistance=Ko(this._scaleByDistance)}},translucencyByDistance:{get:function(){return this._translucencyByDistance},set:function(e){this._translucencyByDistance=Xo(this,e),this._style.translucencyByDistance=Ko(this._translucencyByDistance)}},distanceDisplayCondition:{get:function(){return this._distanceDisplayCondition},set:function(e){this._distanceDisplayCondition=Xo(this,e),this._style.distanceDisplayCondition=Ko(this._distanceDisplayCondition)}},heightOffset:{get:function(){return this._heightOffset},set:function(e){this._heightOffset=Xo(this,e),this._style.heightOffset=Ko(this._heightOffset)}},anchorLineEnabled:{get:function(){return this._anchorLineEnabled},set:function(e){this._anchorLineEnabled=Xo(this,e),this._style.anchorLineEnabled=Ko(this._anchorLineEnabled)}},anchorLineColor:{get:function(){return this._anchorLineColor},set:function(e){this._anchorLineColor=Xo(this,e),this._style.anchorLineColor=Ko(this._anchorLineColor)}},image:{get:function(){return this._image},set:function(e){this._image=Xo(this,e),this._style.image=Ko(this._image)}},disableDepthTestDistance:{get:function(){return this._disableDepthTestDistance},set:function(e){this._disableDepthTestDistance=Xo(this,e),this._style.disableDepthTestDistance=Ko(this._disableDepthTestDistance)}},horizontalOrigin:{get:function(){return this._horizontalOrigin},set:function(e){this._horizontalOrigin=Xo(this,e),this._style.horizontalOrigin=Ko(this._horizontalOrigin)}},verticalOrigin:{get:function(){return this._verticalOrigin},set:function(e){this._verticalOrigin=Xo(this,e),this._style.verticalOrigin=Ko(this._verticalOrigin)}},labelHorizontalOrigin:{get:function(){return this._labelHorizontalOrigin},set:function(e){this._labelHorizontalOrigin=Xo(this,e),this._style.labelHorizontalOrigin=Ko(this._labelHorizontalOrigin)}},labelVerticalOrigin:{get:function(){return this._labelVerticalOrigin},set:function(e){this._labelVerticalOrigin=Xo(this,e),this._style.labelVerticalOrigin=Ko(this._labelVerticalOrigin)}},meta:{get:function(){return this._meta},set:function(e){this._meta=e}}});cy.fromUrl=function(e){if(!c(e))throw new E("url is required");return De.createIfNeeded(e).fetchJson(e).then(function(n){return new cy(n)})};cy.prototype.getColorShaderFunction=function(e,t,n){return this._colorShaderFunctionReady?(n.translucent=this._colorShaderTranslucent,this._colorShaderFunction):(this._colorShaderFunctionReady=!0,c(this.color)&&c(this.color.getShaderFunction)?this._colorShaderFunction=this.color.getShaderFunction(e,t,n,"vec4"):this._colorShaderFunction=void 0,this._colorShaderTranslucent=n.translucent,this._colorShaderFunction)};cy.prototype.getShowShaderFunction=function(e,t,n){return this._showShaderFunctionReady?this._showShaderFunction:(this._showShaderFunctionReady=!0,c(this.show)&&c(this.show.getShaderFunction)?this._showShaderFunction=this.show.getShaderFunction(e,t,n,"bool"):this._showShaderFunction=void 0,this._showShaderFunction)};cy.prototype.getPointSizeShaderFunction=function(e,t,n){return this._pointSizeShaderFunctionReady?this._pointSizeShaderFunction:(this._pointSizeShaderFunctionReady=!0,c(this.pointSize)&&c(this.pointSize.getShaderFunction)?this._pointSizeShaderFunction=this.pointSize.getShaderFunction(e,t,n,"float"):this._pointSizeShaderFunction=void 0,this._pointSizeShaderFunction)};cy.prototype.getVariables=function(){let e=[];return c(this.color)&&c(this.color.getVariables)&&e.push.apply(e,this.color.getVariables()),c(this.show)&&c(this.show.getVariables)&&e.push.apply(e,this.show.getVariables()),c(this.pointSize)&&c(this.pointSize.getVariables)&&e.push.apply(e,this.pointSize.getVariables()),e=e.filter(function(t,n,i){return i.indexOf(t)===n}),e};var TC=cy;function FD(e){e=y(e,y.EMPTY_OBJECT),this._maximumSubtreeCount=y(e.maximumSubtreeCount,0),this._subtreeRequestCounter=0,this._queue=new gD({comparator:FD.comparator})}FD.prototype.addSubtree=function(e){let t=new _lt(e,this._subtreeRequestCounter);this._subtreeRequestCounter++,this._queue.insert(t);let n=e.implicitCoordinates;if(n.level>0){let i=n.getParentSubtreeCoordinates();if(this.find(i)===void 0)throw new E("parent node needs to exist")}if(this._maximumSubtreeCount>0)for(;this._queue.length>this._maximumSubtreeCount&&this._queue.getMinimum()!==t;)this._queue.removeMinimum()};FD.prototype.find=function(e){let t=this._queue,n=t.internalArray,i=t.length;for(let o=0;o<i;o++){let r=n[o],a=r.subtree.implicitCoordinates;if(e.isEqual(a))return r.subtree}};FD.comparator=function(e,t){let n=e.subtree.implicitCoordinates,i=t.subtree.implicitCoordinates;return n.isAncestor(i)?1:i.isAncestor(n)?-1:e.stamp-t.stamp};function _lt(e,t){this.subtree=e,this.stamp=t}var qq=FD;function El(){this.orientedBoundingBox=new Pn,this.boundingSphere=new ce,this.boundTransform=new k,this.shapeTransform=new k,this._minBounds=h.clone(El.DefaultMinBounds,new h),this._maxBounds=h.clone(El.DefaultMaxBounds,new h),this.shaderUniforms={renderMinBounds:new h,renderMaxBounds:new h,boxUvToShapeUvScale:new h,boxUvToShapeUvTranslate:new h},this.shaderDefines={BOX_INTERSECTION_INDEX:void 0,BOX_HAS_SHAPE_BOUNDS:void 0},this.shaderMaximumIntersectionsLength=0}var glt=new h,Yq=new h,ylt=new Q,blt=new h,xlt=new h,Tlt=new h,Alt=new h,bye=k.fromRotationTranslation(Q.fromUniformScale(.5,new Q),new h(.5,.5,.5),new k);El.prototype.update=function(e,t,n,i,o){i=y(i,El.DefaultMinBounds),o=y(o,El.DefaultMaxBounds),A.typeOf.object("modelMatrix",e),A.typeOf.object("minBounds",t),A.typeOf.object("maxBounds",n);let r=El.DefaultMinBounds,s=El.DefaultMaxBounds;t=this._minBounds=h.clamp(t,r,s,this._minBounds),n=this._maxBounds=h.clamp(n,r,s,this._maxBounds),i=h.clamp(i,r,s,blt),o=h.clamp(o,r,s,xlt);let a=h.clamp(t,i,o,Tlt),l=h.clamp(n,i,o,Alt),u=k.getScale(e,Yq);if(a.x>l.x||a.y>l.y||a.z>l.z||(a.x===l.x)+(a.y===l.y)+(a.z===l.z)>=2||i.x>o.x||i.y>o.y||i.z>o.z||u.x===0||u.y===0||u.z===0)return!1;this.shapeTransform=k.clone(e,this.shapeTransform),this.orientedBoundingBox=Kq(a,l,this.shapeTransform,this.orientedBoundingBox),this.boundTransform=k.fromRotationTranslation(this.orientedBoundingBox.halfAxes,this.orientedBoundingBox.center,this.boundTransform),this.boundingSphere=ce.fromOrientedBoundingBox(this.orientedBoundingBox,this.boundingSphere);let{shaderUniforms:f,shaderDefines:d}=this;for(let m in d)d.hasOwnProperty(m)&&(d[m]=void 0);let p=!h.equals(t,r)||!h.equals(n,s),g=0;if(d.BOX_INTERSECTION_INDEX=g,g+=1,f.renderMinBounds=k.multiplyByPoint(bye,a,f.renderMinBounds),f.renderMaxBounds=k.multiplyByPoint(bye,l,f.renderMaxBounds),p){d.BOX_HAS_SHAPE_BOUNDS=!0;let m=t,b=n;f.boxUvToShapeUvScale=h.fromElements(2/(m.x===b.x?1:b.x-m.x),2/(m.y===b.y?1:b.y-m.y),2/(m.z===b.z?1:b.z-m.z),f.boxUvToShapeUvScale),f.boxUvToShapeUvTranslate=h.fromElements(-f.boxUvToShapeUvScale.x*(m.x*.5+.5),-f.boxUvToShapeUvScale.y*(m.y*.5+.5),-f.boxUvToShapeUvScale.z*(m.z*.5+.5),f.boxUvToShapeUvTranslate)}return this.shaderMaximumIntersectionsLength=g,!0};var jL=new h,Xq=new h;El.prototype.computeOrientedBoundingBoxForTile=function(e,t,n,i,o){A.typeOf.number("tileLevel",e),A.typeOf.number("tileX",t),A.typeOf.number("tileY",n),A.typeOf.number("tileZ",i),A.typeOf.object("result",o);let r=this._minBounds,s=this._maxBounds,a=1/Math.pow(2,e),l=h.fromElements(R.lerp(r.x,s.x,a*t),R.lerp(r.y,s.y,a*n),R.lerp(r.z,s.z,a*i),jL),u=h.fromElements(R.lerp(r.x,s.x,a*(t+1)),R.lerp(r.y,s.y,a*(n+1)),R.lerp(r.z,s.z,a*(i+1)),Xq);return Kq(l,u,this.shapeTransform,o)};var xye=new h;El.prototype.computeOrientedBoundingBoxForSample=function(e,t,n,i){A.typeOf.object("spatialNode",e),A.typeOf.object("tileDimensions",t),A.typeOf.object("tileUv",n),A.typeOf.object("result",i);let o=1/Math.pow(2,e.level),r=h.divideComponents(h.ONE,t,xye),s=h.multiplyByScalar(r,o,xye),a=h.multiplyByScalar(h.fromElements(e.x+n.x,e.y+n.y,e.z+n.z,jL),o,jL),l=h.add(a,s,Xq),u=this._minBounds,f=this._maxBounds,d=h.fromElements(R.lerp(u.x,f.x,a.x),R.lerp(u.y,f.y,a.y),R.lerp(u.z,f.z,a.z),jL),p=h.fromElements(R.lerp(u.x,f.x,l.x),R.lerp(u.y,f.y,l.y),R.lerp(u.z,f.z,l.z),Xq);return Kq(d,p,this.shapeTransform,i)};El.DefaultMinBounds=Object.freeze(new h(-1,-1,-1));El.DefaultMaxBounds=Object.freeze(new h(1,1,1));function Kq(e,t,n,i){let o=El.DefaultMinBounds,r=El.DefaultMaxBounds;if(h.equals(e,o)&&h.equals(t,r))i.center=k.getTranslation(n,i.center),i.halfAxes=k.getMatrix3(n,i.halfAxes);else{let a=k.getScale(n,Yq),l=h.midpoint(e,t,glt);i.center=k.multiplyByPoint(n,l,i.center),a=h.fromElements(a.x*.5*(t.x-e.x),a.y*.5*(t.y-e.y),a.z*.5*(t.z-e.z),Yq);let u=k.getRotation(n,ylt);i.halfAxes=Q.setScale(u,a,i.halfAxes)}return i}var ly=El;function WL(e){A.typeOf.object("resource",e),this._resource=e,this._metadataTable=void 0}Object.defineProperties(WL.prototype,{metadataTable:{get:function(){return this._metadataTable}}});WL.fromJson=async function(e,t,n,i){if(A.typeOf.object("resource",e),c(t)===c(n))throw new E("One of json and binary must be defined.");let o;c(t)?o={json:t,binary:void 0}:o=Elt(n);let r=await Clt(e,o.json,o.binary),s={},a=o.json.bufferViews.length;for(let d=0;d<a;++d){let p=o.json.bufferViews[d],g=p.byteOffset,m=g+p.byteLength,x=r[p.buffer].subarray(g,m);s[d]=x}let l=o.json.voxelTable,u=o.json.propertyTables[l],f=new WL(e);return f._metadataTable=new qu({count:u.count,properties:u.properties,class:i.classes[u.class],bufferViews:s}),f};function Clt(e,t,n){let i=t.buffers.length,o=new Array(i);for(let r=0;r<i;r++){let s=t.buffers[r];if(c(s.uri)){let l=e.getDerivedResource({url:s.uri});o[r]=l.fetchArrayBuffer().then(function(u){return new Uint8Array(u)})}else o[r]=Promise.resolve(n)}return Promise.all(o)}function Elt(e){let n=new DataView(e.buffer,e.byteOffset),i=8,o=n.getUint32(i,!0);i+=8;let r=n.getUint32(i,!0);i+=8;let s=Ho(e,i,o);i+=o;let a=e.subarray(i,i+r);return{json:s,binary:a}}var $q=WL;function Yr(){this.orientedBoundingBox=new Pn,this.boundingSphere=new ce,this.boundTransform=new k,this.shapeTransform=new k,this._minimumRadius=Yr.DefaultMinBounds.x,this._maximumRadius=Yr.DefaultMaxBounds.x,this._minimumHeight=Yr.DefaultMinBounds.y,this._maximumHeight=Yr.DefaultMaxBounds.y,this._minimumAngle=Yr.DefaultMinBounds.z,this._maximumAngle=Yr.DefaultMaxBounds.z,this.shaderUniforms={cylinderRenderHeightMinMax:new H,cylinderRenderRadiusMinMax:new H,cylinderRenderAngleMinMax:new H,cylinderUvToShapeUvRadius:new H,cylinderUvToShapeUvHeight:new H,cylinderUvToShapeUvAngle:new H,cylinderShapeUvAngleMinMax:new H,cylinderShapeUvAngleRangeZeroMid:0},this.shaderDefines={CYLINDER_HAS_RENDER_BOUNDS_RADIUS_MIN:void 0,CYLINDER_HAS_RENDER_BOUNDS_RADIUS_FLAT:void 0,CYLINDER_HAS_RENDER_BOUNDS_ANGLE:void 0,CYLINDER_HAS_RENDER_BOUNDS_ANGLE_RANGE_EQUAL_ZERO:void 0,CYLINDER_HAS_RENDER_BOUNDS_ANGLE_RANGE_UNDER_HALF:void 0,CYLINDER_HAS_RENDER_BOUNDS_ANGLE_RANGE_OVER_HALF:void 0,CYLINDER_HAS_SHAPE_BOUNDS_RADIUS:void 0,CYLINDER_HAS_SHAPE_BOUNDS_HEIGHT:void 0,CYLINDER_HAS_SHAPE_BOUNDS_ANGLE:void 0,CYLINDER_HAS_SHAPE_BOUNDS_ANGLE_MIN_DISCONTINUITY:void 0,CYLINDER_HAS_SHAPE_BOUNDS_ANGLE_MAX_DISCONTINUITY:void 0,CYLINDER_HAS_SHAPE_BOUNDS_ANGLE_MIN_MAX_REVERSED:void 0,CYLINDER_INTERSECTION_INDEX_RADIUS_MAX:void 0,CYLINDER_INTERSECTION_INDEX_RADIUS_MIN:void 0,CYLINDER_INTERSECTION_INDEX_ANGLE:void 0},this.shaderMaximumIntersectionsLength=0}var Eye=new h;Yr.prototype.update=function(e,t,n,i,o){i=y(i,Yr.DefaultMinBounds),o=y(o,Yr.DefaultMaxBounds),A.typeOf.object("modelMatrix",e),A.typeOf.object("minBounds",t),A.typeOf.object("maxBounds",n);let r=Yr.DefaultMinBounds.x,s=Yr.DefaultMaxBounds.x,a=Yr.DefaultMinBounds.y,l=Yr.DefaultMaxBounds.y,u=Yr.DefaultMinBounds.z,f=Yr.DefaultMaxBounds.z,d=f-u,p=.5*d,g=R.EPSILON10,m=R.EPSILON3,b=R.EPSILON10,x=R.clamp(t.x,r,s),T=R.clamp(n.x,r,s),C=R.clamp(i.x,r,s),S=R.clamp(o.x,r,s),v=Math.max(x,C),D=Math.min(T,S),I=R.clamp(t.y,a,l),L=R.clamp(n.y,a,l),M=R.clamp(i.y,a,l),N=R.clamp(o.y,a,l),B=Math.max(I,M),_=Math.min(L,N),w=R.negativePiToPi(t.z),P=R.negativePiToPi(n.z),O=R.negativePiToPi(i.z),F=R.negativePiToPi(o.z),V=Math.max(w,O),G=Math.min(P,F),z=k.getScale(e,Eye);if(D===0||v>D||B>_||R.equalsEpsilon(z.x,0,void 0,g)||R.equalsEpsilon(z.y,0,void 0,g)||R.equalsEpsilon(z.z,0,void 0,g))return!1;this._minimumRadius=x,this._maximumRadius=T,this._minimumHeight=I,this._maximumHeight=L,this._minimumAngle=w,this._maximumAngle=P,this.shapeTransform=k.clone(e,this.shapeTransform),this.orientedBoundingBox=Jq(v,D,B,_,V,G,this.shapeTransform,this.orientedBoundingBox),this.boundTransform=k.fromRotationTranslation(this.orientedBoundingBox.halfAxes,this.orientedBoundingBox.center,this.boundTransform),this.boundingSphere=ce.fromOrientedBoundingBox(this.orientedBoundingBox,this.boundingSphere);let q=x===r&&T===s,K=I===a&&L===l,te=P<w,Y=P-w+te*d,Z=Y>p+b&&Y<d-b,ee=Y<p-b,me=Y>=p-b&&Y<=p+b,be=Z||ee||me,le=R.equalsEpsilon(w,u,void 0,m),ge=R.equalsEpsilon(P,f,void 0,m),xe=v===r,Pe=G<V,Ee=G-V+Pe*d,Ue=Ee>=p-b&&Ee<d-b,Ye=Ee>b&&Ee<p-b,it=Ee<=b,It=Ue||Ye||it,{shaderUniforms:Ot,shaderDefines:He}=this;for(let dt in He)He.hasOwnProperty(dt)&&(He[dt]=void 0);let tn=0;if(He.CYLINDER_INTERSECTION_INDEX_RADIUS_MAX=tn,tn+=1,xe||(He.CYLINDER_HAS_RENDER_BOUNDS_RADIUS_MIN=!0,He.CYLINDER_INTERSECTION_INDEX_RADIUS_MIN=tn,tn+=1),Ot.cylinderRenderRadiusMinMax=H.fromElements(v,D,Ot.cylinderRenderRadiusMinMax),v===D&&(He.CYLINDER_HAS_RENDER_BOUNDS_RADIUS_FLAT=!0),!q){He.CYLINDER_HAS_SHAPE_BOUNDS_RADIUS=!0;let dt=T-x,bt=0,nn=1;dt!==0&&(bt=1/dt,nn=-x/dt),Ot.cylinderUvToShapeUvRadius=H.fromElements(bt,nn,Ot.cylinderUvToShapeUvRadius)}if(!K){He.CYLINDER_HAS_SHAPE_BOUNDS_HEIGHT=!0;let dt=L-I,bt=0,nn=1;dt!==0&&(bt=2/dt,nn=-(I+1)/dt),Ot.cylinderUvToShapeUvHeight=H.fromElements(bt,nn,Ot.cylinderUvToShapeUvHeight)}if(Ot.cylinderRenderHeightMinMax=H.fromElements(B,_,Ot.cylinderRenderHeightMinMax),te&&(He.CYLINDER_HAS_SHAPE_BOUNDS_ANGLE_MIN_MAX_REVERSED=!0),It&&(He.CYLINDER_HAS_RENDER_BOUNDS_ANGLE=!0,He.CYLINDER_INTERSECTION_INDEX_ANGLE=tn,Ue?(He.CYLINDER_HAS_RENDER_BOUNDS_ANGLE_RANGE_UNDER_HALF=!0,tn+=1):Ye?(He.CYLINDER_HAS_RENDER_BOUNDS_ANGLE_RANGE_OVER_HALF=!0,tn+=2):it&&(He.CYLINDER_HAS_RENDER_BOUNDS_ANGLE_RANGE_EQUAL_ZERO=!0,tn+=2),Ot.cylinderRenderAngleMinMax=H.fromElements(V,G,Ot.cylinderRenderAngleMinMax)),be){He.CYLINDER_HAS_SHAPE_BOUNDS_ANGLE=!0,le&&(He.CYLINDER_HAS_SHAPE_BOUNDS_ANGLE_MIN_DISCONTINUITY=!0),ge&&(He.CYLINDER_HAS_SHAPE_BOUNDS_ANGLE_MAX_DISCONTINUITY=!0);let dt=(w-u)/d,bt=(P-u)/d,nn=1-Y/d;if(Ot.cylinderShapeUvAngleMinMax=H.fromElements(dt,bt,Ot.cylinderShapeUvAngleMinMax),Ot.cylinderShapeUvAngleRangeZeroMid=(bt+.5*nn)%1,Y<=b)Ot.cylinderUvToShapeUvAngle=H.fromElements(0,1,Ot.cylinderUvToShapeUvAngle);else{let Ae=d/Y,Ce=-(w-u)/Y;Ot.cylinderUvToShapeUvAngle=H.fromElements(Ae,Ce,Ot.cylinderUvToShapeUvAngle)}}return this.shaderMaximumIntersectionsLength=tn,!0};Yr.prototype.computeOrientedBoundingBoxForTile=function(e,t,n,i,o){A.typeOf.number("tileLevel",e),A.typeOf.number("tileX",t),A.typeOf.number("tileY",n),A.typeOf.number("tileZ",i),A.typeOf.object("result",o);let r=this._minimumRadius,s=this._maximumRadius,a=this._minimumHeight,l=this._maximumHeight,u=this._minimumAngle,f=this._maximumAngle,d=1/Math.pow(2,e),p=R.lerp(r,s,t*d),g=R.lerp(r,s,(t+1)*d),m=R.lerp(a,l,n*d),b=R.lerp(a,l,(n+1)*d),x=R.lerp(u,f,i*d),T=R.lerp(u,f,(i+1)*d);return Jq(p,g,m,b,x,T,this.shapeTransform,o)};var Tye=new h,Aye=new h,Slt=new h;Yr.prototype.computeOrientedBoundingBoxForSample=function(e,t,n,i){A.typeOf.object("spatialNode",e),A.typeOf.object("tileDimensions",t),A.typeOf.object("tileUv",n),A.typeOf.object("result",i);let o=1/Math.pow(2,e.level),r=h.divideComponents(h.ONE,t,Tye),s=h.multiplyByScalar(r,o,Tye),a=h.multiplyByScalar(h.fromElements(e.x+n.x,e.y+n.y,e.z+n.z,Aye),o,Aye),l=h.add(a,s,Slt),u=this._minimumRadius,f=this._maximumRadius,d=this._minimumHeight,p=this._maximumHeight,g=this._minimumAngle,m=this._maximumAngle,b=R.lerp(u,f,a.x),x=R.lerp(u,f,l.x),T=R.lerp(d,p,a.y),C=R.lerp(d,p,l.y),S=R.lerp(g,m,a.z),v=R.lerp(g,m,l.z);return Jq(b,x,T,C,S,v,this.shapeTransform,i)};Yr.DefaultMinBounds=Object.freeze(new h(0,-1,-R.PI));Yr.DefaultMaxBounds=Object.freeze(new h(1,1,+R.PI));var wlt=5,vlt=new Array(wlt),Dlt=new h,Plt=new Q,Ilt=new k,Olt=new k,Rlt=new k,Zq=new k,Mlt=new h,Llt=new h,Nlt=new h,Sye=new Array(8);for(let e=0;e<8;e++)Sye[e]=new h;function Cye(e,t,n){return Math.abs(se.dot(e,t))<n}function Flt(e){let t=k.getColumn(e,0,Mlt),n=k.getColumn(e,1,Llt),i=k.getColumn(e,2,Nlt),o=R.EPSILON4;return Cye(t,n,o)&&Cye(n,i,o)}function Blt(e,t){let n=Sye;h.fromElements(-.5,-.5,-.5,n[0]),h.fromElements(-.5,-.5,.5,n[1]),h.fromElements(-.5,.5,-.5,n[2]),h.fromElements(-.5,.5,.5,n[3]),h.fromElements(.5,-.5,-.5,n[4]),h.fromElements(.5,-.5,.5,n[5]),h.fromElements(.5,.5,-.5,n[6]),h.fromElements(.5,.5,.5,n[7]);for(let i=0;i<8;++i)k.multiplyByPoint(e,n[i],n[i]);return Pn.fromPoints(n,t)}function Jq(e,t,n,i,o,r,s,a){let l=Yr.DefaultMinBounds,u=Yr.DefaultMaxBounds,f=l.x,d=u.x,p=l.y,g=u.y,m=l.z,b=u.z;if(e===f&&t===d&&n===p&&i===g&&o===m&&r===b)return a.center=k.getTranslation(s,a.center),a.halfAxes=k.getMatrix3(s,a.halfAxes),a;r<o&&(r+=R.TWO_PI);let T=r-o,C=o+T*.5,S=vlt,v=0;S[v++]=o,S[v++]=r,S[v++]=C,T>R.PI&&(S[v++]=C-R.PI_OVER_TWO,S[v++]=C+R.PI_OVER_TWO);let D=1,I=1,L=-1,M=-1;for(let te=0;te<v;++te){let Y=S[te]-C,Z=Math.cos(Y),ee=Math.sin(Y),me=Z*e,be=ee*e,le=Z*t,ge=ee*t;D=Math.min(D,me),I=Math.min(I,be),D=Math.min(D,le),I=Math.min(I,ge),L=Math.max(L,me),M=Math.max(M,be),L=Math.max(L,le),M=Math.max(M,ge)}let N=L-D,B=M-I,_=i-n,w=(D+L)*.5,P=(I+M)*.5,O=(n+i)*.5,F=h.fromElements(w,P,O,Dlt),V=Q.fromRotationZ(C,Plt),G=h.fromElements(N,B,_,Eye),z=k.fromScale(G,Rlt),W=k.fromRotation(V,Olt),U=k.fromTranslation(F,Ilt),q=k.multiplyTransformation(W,k.multiplyTransformation(U,z,Zq),Zq),K=k.multiplyTransformation(s,q,Zq);return Flt(K)?Pn.fromTransformation(K,a):Blt(K,a)}var uy=Yr;function e_(){this.orientedBoundingBox=new Pn,this.boundingSphere=new ce,this.boundTransform=new k,this.shapeTransform=new k,this._rectangle=new ae,this._minimumHeight=e_.DefaultMinBounds.z,this._maximumHeight=e_.DefaultMaxBounds.z,this._ellipsoid=new ie,this._translation=new h,this._rotation=new Q,this.shaderUniforms={ellipsoidRadiiUv:new h,eccentricitySquared:0,evoluteScale:new H,ellipsoidInverseRadiiSquaredUv:new h,ellipsoidRenderLongitudeMinMax:new H,ellipsoidShapeUvLongitudeMinMaxMid:new h,ellipsoidUvToShapeUvLongitude:new H,ellipsoidUvToShapeUvLatitude:new H,ellipsoidRenderLatitudeSinMinMax:new H,ellipsoidInverseHeightDifferenceUv:0,clipMinMaxHeight:new H},this.shaderDefines={ELLIPSOID_HAS_RENDER_BOUNDS_LONGITUDE:void 0,ELLIPSOID_HAS_RENDER_BOUNDS_LONGITUDE_RANGE_EQUAL_ZERO:void 0,ELLIPSOID_HAS_RENDER_BOUNDS_LONGITUDE_RANGE_UNDER_HALF:void 0,ELLIPSOID_HAS_RENDER_BOUNDS_LONGITUDE_RANGE_OVER_HALF:void 0,ELLIPSOID_HAS_RENDER_BOUNDS_LONGITUDE_MIN_DISCONTINUITY:void 0,ELLIPSOID_HAS_RENDER_BOUNDS_LONGITUDE_MAX_DISCONTINUITY:void 0,ELLIPSOID_HAS_SHAPE_BOUNDS_LONGITUDE:void 0,ELLIPSOID_HAS_SHAPE_BOUNDS_LONGITUDE_MIN_MAX_REVERSED:void 0,ELLIPSOID_HAS_RENDER_BOUNDS_LATITUDE_MAX_UNDER_HALF:void 0,ELLIPSOID_HAS_RENDER_BOUNDS_LATITUDE_MAX_EQUAL_HALF:void 0,ELLIPSOID_HAS_RENDER_BOUNDS_LATITUDE_MAX_OVER_HALF:void 0,ELLIPSOID_HAS_RENDER_BOUNDS_LATITUDE_MIN_UNDER_HALF:void 0,ELLIPSOID_HAS_RENDER_BOUNDS_LATITUDE_MIN_EQUAL_HALF:void 0,ELLIPSOID_HAS_RENDER_BOUNDS_LATITUDE_MIN_OVER_HALF:void 0,ELLIPSOID_HAS_SHAPE_BOUNDS_LATITUDE:void 0,ELLIPSOID_INTERSECTION_INDEX_LONGITUDE:void 0,ELLIPSOID_INTERSECTION_INDEX_LATITUDE_MAX:void 0,ELLIPSOID_INTERSECTION_INDEX_LATITUDE_MIN:void 0,ELLIPSOID_INTERSECTION_INDEX_HEIGHT_MAX:void 0,ELLIPSOID_INTERSECTION_INDEX_HEIGHT_MIN:void 0},this.shaderMaximumIntersectionsLength=0}var klt=new h,Vlt=new h,Ult=new h,zlt=new h,Hlt=new h,Glt=new h,jlt=new h,Wlt=new h,qlt=new Q,wye=new h,vye=new h,Ylt=new ae;e_.prototype.update=function(e,t,n,i,o){let{DefaultMinBounds:r,DefaultMaxBounds:s}=e_;i=y(i,r),o=y(o,s),A.typeOf.object("modelMatrix",e),A.typeOf.object("minBounds",t),A.typeOf.object("maxBounds",n);let a=R.EPSILON10,l=R.EPSILON3,u=R.EPSILON10,f=R.EPSILON10,d=R.EPSILON3,p=k.getScale(e,Wlt),g=h.clone(r,klt);g.z=-h.minimumComponent(p);let m=h.clamp(t,g,s,Vlt),b=h.clamp(n,g,s,Ult),x=h.clamp(i,g,s,zlt),T=h.clamp(o,g,s,Hlt),C=h.maximumByComponent(m,x,Glt),S=h.minimumByComponent(b,T,jlt),v=h.add(p,h.fromElements(b.z,b.z,b.z,wye),wye),D=h.maximumComponent(v),I=h.add(p,h.fromElements(S.z,S.z,S.z,vye),vye);if(C.y>S.y||C.y===s.y||S.y===r.y||C.z>S.z||R.equalsEpsilon(I,h.ZERO,void 0,a))return!1;this._rectangle=ae.fromRadians(m.x,m.y,b.x,b.y),this._translation=k.getTranslation(e,this._translation),this._rotation=k.getRotation(e,this._rotation),this._ellipsoid=ie.fromCartesian3(p,this._ellipsoid),this._minimumHeight=m.z,this._maximumHeight=b.z;let L=ae.fromRadians(C.x,C.y,S.x,S.y,Ylt);this.orientedBoundingBox=Qq(L,C.z,S.z,this._ellipsoid,this._translation,this._rotation,this.orientedBoundingBox),this.shapeTransform=k.fromRotationTranslation(Q.setScale(this._rotation,v,qlt),this._translation,this.shapeTransform),this.boundTransform=k.fromRotationTranslation(this.orientedBoundingBox.halfAxes,this.orientedBoundingBox.center,this.boundTransform),this.boundingSphere=ce.fromOrientedBoundingBox(this.orientedBoundingBox,this.boundingSphere);let M=s.x-r.x,N=.5*M,B=S.x<C.x,_=S.x-C.x+B*M,w=_<=u,P=_>=N-u&&_<M-u,O=_>u&&_<N-u,F=w||P||O,V=b.x<m.x,G=b.x-m.x+V*M,z=G>N+u&&G<M-u,W=G>=N-u&&G<=N+u,U=G<N-u,q=z||W||U,K=S.y<-d,te=S.y>=-d&&S.y<=+d,Y=S.y>+d&&S.y<s.y-f,Z=K||te||Y,ee=C.y>r.y+f&&C.y<-d,me=C.y>=-d&&C.y<=+d,be=C.y>+d,le=ee||me||be,ge=Z||le,xe=b.y-m.y,Pe=b.y<-d,Ee=b.y>=-d&&b.y<=+d,Ue=b.y>+d&&b.y<s.y-f,Ye=Pe||Ee||Ue,it=m.y>r.y+f&&m.y<-d,It=m.y>=-d&&m.y<=+d,Ot=m.y>+d,tn=Ye||(it||It||Ot),{shaderUniforms:dt,shaderDefines:bt}=this;for(let lt in bt)bt.hasOwnProperty(lt)&&(bt[lt]=void 0);dt.ellipsoidRadiiUv=h.divideByScalar(v,D,dt.ellipsoidRadiiUv);let{x:nn,z:Ae}=dt.ellipsoidRadiiUv,Ce=Ae/nn;dt.eccentricitySquared=1-Ce*Ce,dt.evoluteScale=H.fromElements((nn*nn-Ae*Ae)/nn,(Ae*Ae-nn*nn)/Ae,dt.evoluteScale),dt.ellipsoidInverseRadiiSquaredUv=h.divideComponents(h.ONE,h.multiplyComponents(dt.ellipsoidRadiiUv,dt.ellipsoidRadiiUv,dt.ellipsoidInverseRadiiSquaredUv),dt.ellipsoidInverseRadiiSquaredUv);let rt=0;bt.ELLIPSOID_INTERSECTION_INDEX_HEIGHT_MAX=rt,rt+=1,bt.ELLIPSOID_INTERSECTION_INDEX_HEIGHT_MIN=rt,rt+=1,dt.clipMinMaxHeight=H.fromElements((C.z-b.z)/D,(S.z-b.z)/D,dt.clipMinMaxHeight);let Ri=(b.z-m.z)/D;if(dt.ellipsoidInverseHeightDifferenceUv=1/Ri,m.z===b.z&&(dt.ellipsoidInverseHeightDifferenceUv=0),F&&(bt.ELLIPSOID_HAS_RENDER_BOUNDS_LONGITUDE=!0,bt.ELLIPSOID_INTERSECTION_INDEX_LONGITUDE=rt,P?(bt.ELLIPSOID_HAS_RENDER_BOUNDS_LONGITUDE_RANGE_UNDER_HALF=!0,rt+=1):O?(bt.ELLIPSOID_HAS_RENDER_BOUNDS_LONGITUDE_RANGE_OVER_HALF=!0,rt+=2):w&&(bt.ELLIPSOID_HAS_RENDER_BOUNDS_LONGITUDE_RANGE_EQUAL_ZERO=!0,rt+=2),dt.ellipsoidRenderLongitudeMinMax=H.fromElements(C.x,S.x,dt.ellipsoidRenderLongitudeMinMax)),q)if(bt.ELLIPSOID_HAS_SHAPE_BOUNDS_LONGITUDE=!0,b.x<m.x&&(bt.ELLIPSOID_HAS_SHAPE_BOUNDS_LONGITUDE_MIN_MAX_REVERSED=!0),G<=u)dt.ellipsoidUvToShapeUvLongitude=H.fromElements(0,1,dt.ellipsoidUvToShapeUvLongitude);else{let ao=M/G,Fo=-(m.x-r.x)/G;dt.ellipsoidUvToShapeUvLongitude=H.fromElements(ao,Fo,dt.ellipsoidUvToShapeUvLongitude)}if(F){let lt=R.equalsEpsilon(C.x,r.x,void 0,l),ao=R.equalsEpsilon(S.x,s.x,void 0,l);lt&&(bt.ELLIPSOID_HAS_RENDER_BOUNDS_LONGITUDE_MIN_DISCONTINUITY=!0),ao&&(bt.ELLIPSOID_HAS_RENDER_BOUNDS_LONGITUDE_MAX_DISCONTINUITY=!0);let Fo=(m.x-r.x)/M,va=(b.x-r.x)/M,Cr=(S.x-r.x)/M,ss=1-_/M,Le=(Cr+.5*ss)%1;dt.ellipsoidShapeUvLongitudeMinMaxMid=h.fromElements(Fo,va,Le,dt.ellipsoidShapeUvLongitudeMinMaxMid)}if(ge&&(le&&(bt.ELLIPSOID_HAS_RENDER_BOUNDS_LATITUDE_MIN=!0,bt.ELLIPSOID_INTERSECTION_INDEX_LATITUDE_MIN=rt,ee?(bt.ELLIPSOID_HAS_RENDER_BOUNDS_LATITUDE_MIN_UNDER_HALF=!0,rt+=1):me?(bt.ELLIPSOID_HAS_RENDER_BOUNDS_LATITUDE_MIN_EQUAL_HALF=!0,rt+=1):be&&(bt.ELLIPSOID_HAS_RENDER_BOUNDS_LATITUDE_MIN_OVER_HALF=!0,rt+=2)),Z&&(bt.ELLIPSOID_HAS_RENDER_BOUNDS_LATITUDE_MAX=!0,bt.ELLIPSOID_INTERSECTION_INDEX_LATITUDE_MAX=rt,K?(bt.ELLIPSOID_HAS_RENDER_BOUNDS_LATITUDE_MAX_UNDER_HALF=!0,rt+=2):te?(bt.ELLIPSOID_HAS_RENDER_BOUNDS_LATITUDE_MAX_EQUAL_HALF=!0,rt+=1):Y&&(bt.ELLIPSOID_HAS_RENDER_BOUNDS_LATITUDE_MAX_OVER_HALF=!0,rt+=1)),dt.ellipsoidRenderLatitudeSinMinMax=H.fromElements(Math.sin(C.y),Math.sin(S.y),dt.ellipsoidRenderLatitudeSinMinMax)),tn)if(bt.ELLIPSOID_HAS_SHAPE_BOUNDS_LATITUDE=!0,xe<f)dt.ellipsoidUvToShapeUvLatitude=H.fromElements(0,1,dt.ellipsoidUvToShapeUvLatitude);else{let ao=(s.y-r.y)/xe,Fo=(r.y-m.y)/xe;dt.ellipsoidUvToShapeUvLatitude=H.fromElements(ao,Fo,dt.ellipsoidUvToShapeUvLatitude)}return this.shaderMaximumIntersectionsLength=rt,!0};var Iye=new ae;e_.prototype.computeOrientedBoundingBoxForTile=function(e,t,n,i,o){A.typeOf.number("tileLevel",e),A.typeOf.number("tileX",t),A.typeOf.number("tileY",n),A.typeOf.number("tileZ",i),A.typeOf.object("result",o);let r=1/Math.pow(2,e),s=t*r,a=(t+1)*r,l=n*r,u=(n+1)*r,f=i*r,d=(i+1)*r,p=ae.subsection(this._rectangle,s,l,a,u,Iye),g=R.lerp(this._minimumHeight,this._maximumHeight,f),m=R.lerp(this._minimumHeight,this._maximumHeight,d);return Qq(p,g,m,this._ellipsoid,this._translation,this._rotation,o)};var Dye=new h,Pye=new h,Xlt=new h;e_.prototype.computeOrientedBoundingBoxForSample=function(e,t,n,i){A.typeOf.object("spatialNode",e),A.typeOf.object("tileDimensions",t),A.typeOf.object("tileUv",n),A.typeOf.object("result",i);let o=1/Math.pow(2,e.level),r=h.divideComponents(h.ONE,t,Dye),s=h.multiplyByScalar(r,o,Dye),a=h.multiplyByScalar(h.fromElements(e.x+n.x,e.y+n.y,e.z+n.z,Pye),o,Pye),l=h.add(a,s,Xlt),u=ae.subsection(this._rectangle,a.x,a.y,l.x,l.y,Iye),f=R.lerp(this._minimumHeight,this._maximumHeight,a.z),d=R.lerp(this._minimumHeight,this._maximumHeight,l.z);return Qq(u,f,d,this._ellipsoid,this._translation,this._rotation,i)};function Qq(e,t,n,i,o,r,s){return s=Pn.fromRectangle(e,t,n,i,s),s.center=h.add(s.center,o,s.center),s.halfAxes=Q.multiply(s.halfAxes,r,s.halfAxes),s}e_.DefaultMinBounds=Object.freeze(new h(-R.PI,-R.PI_OVER_TWO,-ie.WGS84.minimumRadius));e_.DefaultMaxBounds=Object.freeze(new h(R.PI,R.PI_OVER_TWO,10*ie.WGS84.maximumRadius));var BD=e_;var pu={BOX:"BOX",ELLIPSOID:"ELLIPSOID",CYLINDER:"CYLINDER"};pu.getMinBounds=function(e){switch(e){case pu.BOX:return ly.DefaultMinBounds;case pu.ELLIPSOID:return BD.DefaultMinBounds;case pu.CYLINDER:return uy.DefaultMinBounds;default:throw new E(`Invalid shape type ${e}`)}};pu.getMaxBounds=function(e){switch(e){case pu.BOX:return ly.DefaultMaxBounds;case pu.ELLIPSOID:return BD.DefaultMaxBounds;case pu.CYLINDER:return uy.DefaultMaxBounds;default:throw new E(`Invalid shape type ${e}`)}};pu.getShapeConstructor=function(e){switch(e){case pu.BOX:return ly;case pu.ELLIPSOID:return BD;case pu.CYLINDER:return uy;default:throw new E(`Invalid shape type ${e}`)}};var Oi=Object.freeze(pu);function qL(e){e=y(e,y.EMPTY_OBJECT),this.shapeTransform=void 0,this.globalTransform=void 0,this.shape=void 0,this.minBounds=void 0,this.maxBounds=void 0,this.dimensions=void 0,this.paddingBefore=void 0,this.paddingAfter=void 0,this.names=void 0,this.types=void 0,this.componentTypes=void 0,this.minimumValues=void 0,this.maximumValues=void 0,this.maximumTileCount=void 0,this._implicitTileset=void 0,this._subtreeCache=new qq}qL.fromUrl=async function(e){A.defined("url",e);let t=De.createIfNeeded(e),n=await t.fetchJson();$lt(n);let i=tut(n,t);await i.load();let o=n.root,r=o.content.extensions["3DTILES_content_voxels"],s=r.class,a=si(n,"3DTILES_metadata")?n.extensions["3DTILES_metadata"]:n,l=i.schema,u=new Ww({metadataJson:a,schema:l}),f=new qL;nut(f,u,s);let d=new Xw(t,o,l),{shape:p,minBounds:g,maxBounds:m,shapeTransform:b,globalTransform:x}=Zlt(o);f.shape=p,f.minBounds=g,f.maxBounds=m,f.dimensions=h.unpack(r.dimensions),f.shapeTransform=b,f.globalTransform=x,f.maximumTileCount=Klt(u);let T,C;return c(r.padding)&&(T=h.unpack(r.padding.before),C=h.unpack(r.padding.after)),f.paddingBefore=T,f.paddingAfter=C,f._implicitTileset=d,Ci.unload(i),f};function Klt(e){if(c(e.tileset))return e.tileset.getPropertyBySemantic(YS.TILESET_TILE_COUNT)}function $lt(e){let t=e.root;if(!c(t.content))throw new ue("Root must have content");if(!si(t.content,"3DTILES_content_voxels"))throw new ue("Root tile content must have 3DTILES_content_voxels extension");if(!si(t,"3DTILES_implicit_tiling")&&!c(t.implicitTiling))throw new ue("Root tile must have implicit tiling");if(!c(e.schema)&&!c(e.schemaUri)&&!si(e,"3DTILES_metadata"))throw new ue("Tileset must have a metadata schema")}function Zlt(e){let t=e.boundingVolume,n;if(c(e.transform)?n=k.unpack(e.transform):n=k.clone(k.IDENTITY),c(t.box))return Qlt(t.box,n);if(c(t.region))return Jlt(t.region);if(si(t,"3DTILES_bounding_volume_cylinder"))return eut(t.extensions["3DTILES_bounding_volume_cylinder"].cylinder,n);throw new ue("Only box, region and 3DTILES_bounding_volume_cylinder are supported in Cesium3DTilesVoxelProvider")}function Jlt(e){let t=e[0],n=e[1],i=e[2],o=e[3],r=e[4],s=e[5],a=k.fromScale(ie.WGS84.radii),l=new h(t,n,r),u=new h(i,o,s);return{shape:Oi.ELLIPSOID,minBounds:l,maxBounds:u,shapeTransform:a,globalTransform:k.clone(k.IDENTITY)}}function Qlt(e,t){let n=Pn.unpack(e),i=k.fromRotationTranslation(n.halfAxes,n.center);return{shape:Oi.BOX,minBounds:h.clone(ly.DefaultMinBounds),maxBounds:h.clone(ly.DefaultMaxBounds),shapeTransform:i,globalTransform:t}}function eut(e,t){let n=Pn.unpack(e),i=k.fromRotationTranslation(n.halfAxes,n.center);return{shape:Oi.CYLINDER,minBounds:h.clone(uy.DefaultMinBounds),maxBounds:h.clone(uy.DefaultMaxBounds),shapeTransform:i,globalTransform:t}}function tut(e,t){let{schemaUri:n,schema:i}=e;return c(n)?Ci.getSchemaLoader({resource:t.getDerivedResource({url:n})}):Ci.getSchemaLoader({schema:i})}function nut(e,t,n){let{schema:i,statistics:o}=t,r=o?.classes[n],s=i.classes[n].properties,a=Object.entries(s).map(([d,p])=>{let{type:g,componentType:m}=p,b=r?.properties[d].min,x=r?.properties[d].max,T=Et.getComponentCount(g),C=Oye(b,T),S=Oye(x,T);return{id:d,type:g,componentType:m,minValue:C,maxValue:S}});e.names=a.map(d=>d.id),e.types=a.map(d=>d.type),e.componentTypes=a.map(d=>d.componentType);let l=a.map(d=>d.minValue),u=a.map(d=>d.maxValue),f=l.some(c);e.minimumValues=f?l:void 0,e.maximumValues=f?u:void 0}function Oye(e,t){if(!c(e))return;let n=Array.isArray(e)?e:[e];return Array.from({length:t},(i,o)=>n[o])}async function iut(e,t){let n=e.contentUriTemplates[0].getDerivedResource({templateValues:t.getTemplateValues()}),i=e.baseResource.getDerivedResource({url:n.url}),o=await i.fetchArrayBuffer(),r=fg(o);return await $q.fromJson(i,r.jsonPayload,r.binaryPayload,e.metadataSchema)}async function out(e,t){let n=e._implicitTileset,i=e._subtreeCache,o=i.find(t);if(c(o))return o;let r=n.subtreeUriTemplate.getDerivedResource({templateValues:t.getTemplateValues()}),s=n.baseResource.getDerivedResource({url:r.url}),a=await s.fetchArrayBuffer();if(o=i.find(t),c(o))return o;let l=fg(a);return o=await qS.fromSubtreeJson(s,l.jsonPayload,l.binaryPayload,n,t),i.addSubtree(o),o}qL.prototype.requestData=function(e){e=y(e,y.EMPTY_OBJECT);let t=y(e.tileLevel,0),n=y(e.tileX,0),i=y(e.tileY,0),o=y(e.tileZ,0);if(y(e.keyframe,0)!==0)return;let s=this._implicitTileset,a=this.names,l=new $w({subdivisionScheme:s.subdivisionScheme,subtreeLevels:s.subtreeLevels,level:t,x:n,y:i,z:o}),u=l.isSubtreeRoot()&&l.level>0,f=u?l.getParentSubtreeCoordinates():l.getSubtreeCoordinates();return out(this,f).then(function(p){return(u?p.childSubtreeIsAvailableAtCoordinates(l):p.tileIsAvailableAtCoordinates(l))?iut(s,l):Promise.reject("Tile is not available")}).then(function(p){return a.map(function(g){return p.metadataTable.getPropertyTypedArray(g)})})};var rut=qL;function e7(e){e=y(e,1),A.typeOf.number.greaterThan("radius",e,0),this._radius=y(e,1)}Object.defineProperties(e7.prototype,{radius:{get:function(){return this._radius},set:function(e){A.typeOf.number.greaterThan("value",e,0),this._radius=e}}});e7.prototype.emit=function(e){let t=R.randomBetween(0,R.TWO_PI),n=R.randomBetween(0,this._radius),i=n*Math.cos(t),o=n*Math.sin(t),r=0;e.position=h.fromElements(i,o,r,e.position),e.velocity=h.clone(h.UNIT_Z,e.velocity)};var t7=e7;var n7={CUMULUS:0};n7.validate=function(e){return e===n7.CUMULUS};var kD=Object.freeze(n7);var i7=`uniform sampler2D u_noiseTexture;
uniform vec3 u_noiseTextureDimensions;
uniform float u_noiseDetail;
in vec2 v_offset;
in vec3 v_maximumSize;
in vec4 v_color;
in float v_slice;
in float v_brightness;
float wrap(float value, float rangeLength) {
if(value < 0.0) {
float absValue = abs(value);
float modValue = mod(absValue, rangeLength);
return mod(rangeLength - modValue, rangeLength);
}
return mod(value, rangeLength);
}
vec3 wrapVec(vec3 value, float rangeLength) {
return vec3(wrap(value.x, rangeLength),
wrap(value.y, rangeLength),
wrap(value.z, rangeLength));
}
vec2 voxelToUV(vec3 voxelIndex) {
float textureSliceWidth = u_noiseTextureDimensions.x;
float noiseTextureRows = u_noiseTextureDimensions.y;
float inverseNoiseTextureRows = u_noiseTextureDimensions.z;
float textureSliceWidthSquared = textureSliceWidth * textureSliceWidth;
vec2 inverseNoiseTextureDimensions = vec2(noiseTextureRows / textureSliceWidthSquared,
inverseNoiseTextureRows / textureSliceWidth);
vec3 wrappedIndex = wrapVec(voxelIndex, textureSliceWidth);
float column = mod(wrappedIndex.z, textureSliceWidth * inverseNoiseTextureRows);
float row = floor(wrappedIndex.z / textureSliceWidth * noiseTextureRows);
float xPixelCoord = wrappedIndex.x + column * textureSliceWidth;
float yPixelCoord = wrappedIndex.y + row * textureSliceWidth;
return vec2(xPixelCoord, yPixelCoord) * inverseNoiseTextureDimensions;
}
vec4 lerpSamplesX(vec3 voxelIndex, float x) {
vec2 uv0 = voxelToUV(voxelIndex);
vec2 uv1 = voxelToUV(voxelIndex + vec3(1.0, 0.0, 0.0));
vec4 sample0 = texture(u_noiseTexture, uv0);
vec4 sample1 = texture(u_noiseTexture, uv1);
return mix(sample0, sample1, x);
}
vec4 sampleNoiseTexture(vec3 position) {
float textureSliceWidth = u_noiseTextureDimensions.x;
vec3 recenteredPos = position + vec3(textureSliceWidth / 2.0);
vec3 lerpValue = fract(recenteredPos);
vec3 voxelIndex = floor(recenteredPos);
vec4 xLerp00 = lerpSamplesX(voxelIndex, lerpValue.x);
vec4 xLerp01 = lerpSamplesX(voxelIndex + vec3(0.0, 0.0, 1.0), lerpValue.x);
vec4 xLerp10 = lerpSamplesX(voxelIndex + vec3(0.0, 1.0, 0.0), lerpValue.x);
vec4 xLerp11 = lerpSamplesX(voxelIndex + vec3(0.0, 1.0, 1.0), lerpValue.x);
vec4 yLerp0 = mix(xLerp00, xLerp10, lerpValue.y);
vec4 yLerp1 = mix(xLerp01, xLerp11, lerpValue.y);
return mix(yLerp0, yLerp1, lerpValue.z);
}
bool intersectSphere(vec3 origin, vec3 dir, float slice,
out vec3 point, out vec3 normal) {
float A = dot(dir, dir);
float B = dot(origin, dir);
float C = dot(origin, origin) - 0.25;
float discriminant = (B * B) - (A * C);
if(discriminant < 0.0) {
return false;
}
float root = sqrt(discriminant);
float t = (-B - root) / A;
if(t < 0.0) {
t = (-B + root) / A;
}
point = origin + t * dir;
if(slice >= 0.0) {
point.z = (slice / 2.0) - 0.5;
if(length(point) > 0.5) {
return false;
}
}
normal = normalize(point);
point -= czm_epsilon2 * normal;
return true;
}
bool intersectEllipsoid(vec3 origin, vec3 dir, vec3 center, vec3 scale, float slice,
out vec3 point, out vec3 normal) {
if(scale.x <= 0.01 || scale.y < 0.01 || scale.z < 0.01) {
return false;
}
vec3 o = (origin - center) / scale;
vec3 d = dir / scale;
vec3 p, n;
bool intersected = intersectSphere(o, d, slice, p, n);
if(intersected) {
point = (p * scale) + center;
normal = n;
}
return intersected;
}
vec2 phaseShift2D(vec2 p, vec2 freq) {
return (czm_pi / 2.0) * sin(freq.yx * p.yx);
}
vec2 phaseShift3D(vec3 p, vec2 freq) {
return phaseShift2D(p.xy, freq) + czm_pi * vec2(sin(freq.x * p.z));
}
const float T0    = 0.6;
const float k     = 0.1;
const float C0    = 0.8;
const float FX0   = 0.6;
const float FY0   = 0.6;
const int octaves = 5;
float T(vec3 point) {
vec2 sum = vec2(0.0);
float Ci = C0;
vec2 FXY = vec2(FX0, FY0);
vec2 PXY = vec2(0.0);
for(int i = 1; i <= octaves; i++) {
PXY = phaseShift3D(point, FXY);
Ci *= 0.707;
FXY *= 2.0;
vec2 sinTerm = sin(FXY * point.xy + PXY);
sum += Ci * sinTerm + vec2(T0);
}
return k * sum.x * sum.y;
}
const float a = 0.5;
const float t = 0.4;
const float s = 0.25;
float I(float Id, float Is, float It) {
return (1.0 - a) * ((1.0 - t) * ((1.0 - s) * Id + s * Is) + t * It) + a;
}
const vec3 lightDir = normalize(vec3(0.2, -1.0, 0.7));
vec4 drawCloud(vec3 rayOrigin, vec3 rayDir, vec3 cloudCenter, vec3 cloudScale, float cloudSlice,
float brightness) {
vec3 cloudPoint, cloudNormal;
if(!intersectEllipsoid(rayOrigin, rayDir, cloudCenter, cloudScale, cloudSlice,
cloudPoint, cloudNormal)) {
return vec4(0.0);
}
float Id = clamp(dot(cloudNormal, -lightDir), 0.0, 1.0);
float Is = max(pow(dot(-lightDir, -rayDir), 2.0), 0.0);
float It = T(cloudPoint);
float intensity = I(Id, Is, It);
vec3 color = vec3(intensity * clamp(brightness, 0.1, 1.0));
vec4 noise = sampleNoiseTexture(u_noiseDetail * cloudPoint);
float W = noise.x;
float W2 = noise.y;
float W3 = noise.z;
float ndDot = clamp(dot(cloudNormal, -rayDir), 0.0, 1.0);
float TR = pow(ndDot, 3.0) - W;
TR *= 1.3;
float minusDot = 0.5 - ndDot;
TR -= min(minusDot * W2, 0.0);
TR -= 0.8 * (minusDot + 0.25) * W3;
float shading = mix(1.0 - 0.8 * W * W, 1.0, Id * TR);
shading = clamp(shading + 0.2, 0.3, 1.0);
vec3 finalColor = mix(vec3(0.5), shading * color, 1.15);
return vec4(finalColor, clamp(TR, 0.0, 1.0)) * v_color;
}
void main() {
#ifdef DEBUG_BILLBOARDS
out_FragColor = vec4(0.0, 0.5, 0.5, 1.0);
#endif
vec2 coordinate = v_maximumSize.xy * v_offset;
vec3 ellipsoidScale = 0.82 * v_maximumSize;
vec3 ellipsoidCenter = vec3(0.0);
float zOffset = max(ellipsoidScale.z - 10.0, 0.0);
vec3 eye = vec3(0, 0, -10.0 - zOffset);
vec3 rayDir = normalize(vec3(coordinate, 1.0) - eye);
vec3 rayOrigin = eye;
#ifdef DEBUG_ELLIPSOIDS
vec3 point, normal;
if(intersectEllipsoid(rayOrigin, rayDir, ellipsoidCenter, ellipsoidScale, v_slice,
point, normal)) {
out_FragColor = v_brightness * v_color;
}
#else
#ifndef DEBUG_BILLBOARDS
vec4 cloud = drawCloud(rayOrigin, rayDir,
ellipsoidCenter, ellipsoidScale, v_slice, v_brightness);
if(cloud.w < 0.01) {
discard;
}
out_FragColor = cloud;
#endif
#endif
}
`;var o7=`#ifdef INSTANCED
in vec2 direction;
#endif
in vec4 positionHighAndScaleX;
in vec4 positionLowAndScaleY;
in vec4 packedAttribute0;
in vec4 packedAttribute1;
in vec4 color;
out vec2 v_offset;
out vec3 v_maximumSize;
out vec4 v_color;
out float v_slice;
out float v_brightness;
void main() {
vec3 positionHigh = positionHighAndScaleX.xyz;
vec3 positionLow = positionLowAndScaleY.xyz;
vec2 scale = vec2(positionHighAndScaleX.w, positionLowAndScaleY.w);
float show = packedAttribute0.x;
float brightness = packedAttribute0.y;
vec2 coordinates = packedAttribute0.wz;
vec3 maximumSize = packedAttribute1.xyz;
float slice = packedAttribute1.w;
#ifdef INSTANCED
vec2 dir = direction;
#else
vec2 dir = coordinates;
#endif
vec2 offset = dir - vec2(0.5, 0.5);
vec2 scaledOffset = scale * offset;
vec4 p = czm_translateRelativeToEye(positionHigh, positionLow);
vec4 positionEC = czm_modelViewRelativeToEye * p;
positionEC.xy += scaledOffset;
positionEC.xyz *= show;
gl_Position = czm_projection * positionEC;
v_offset = offset;
v_maximumSize = maximumSize;
v_color = color;
v_slice = slice;
v_brightness = brightness;
}
`;var r7=`uniform vec3 u_noiseTextureDimensions;
uniform float u_noiseDetail;
uniform vec3 u_noiseOffset;
in vec2 v_position;
float wrap(float value, float rangeLength) {
if(value < 0.0) {
float absValue = abs(value);
float modValue = mod(absValue, rangeLength);
return mod(rangeLength - modValue, rangeLength);
}
return mod(value, rangeLength);
}
vec3 wrapVec(vec3 value, float rangeLength) {
return vec3(wrap(value.x, rangeLength),
wrap(value.y, rangeLength),
wrap(value.z, rangeLength));
}
vec3 random3(vec3 p) {
float dot1 = dot(p, vec3(127.1, 311.7, 932.8));
float dot2 = dot(p, vec3(269.5, 183.3, 421.4));
return fract(vec3(sin(dot1 - dot2), cos(dot1 * dot2), dot1 * dot2));
}
vec3 getWorleyCellPoint(vec3 centerCell, vec3 offset, float freq) {
float textureSliceWidth = u_noiseTextureDimensions.x;
vec3 cell = centerCell + offset;
cell = wrapVec(cell, textureSliceWidth / u_noiseDetail);
cell += floor(u_noiseOffset / u_noiseDetail);
vec3 p = offset + random3(cell);
return p;
}
float worleyNoise(vec3 p, float freq) {
vec3 centerCell = floor(p * freq);
vec3 pointInCell = fract(p * freq);
float shortestDistance = 1000.0;
for(float z = -1.0; z <= 1.0; z++) {
for(float y = -1.0; y <= 1.0; y++) {
for(float x = -1.0; x <= 1.0; x++) {
vec3 offset = vec3(x, y, z);
vec3 point = getWorleyCellPoint(centerCell, offset, freq);
float distance = length(pointInCell - point);
if(distance < shortestDistance) {
shortestDistance = distance;
}
}
}
}
return shortestDistance;
}
const float MAX_FBM_ITERATIONS = 10.0;
float worleyFBMNoise(vec3 p, float octaves, float scale) {
float noise = 0.0;
float freq = 1.0;
float persistence = 0.625;
for(float i = 0.0; i < MAX_FBM_ITERATIONS; i++) {
if(i >= octaves) {
break;
}
noise += worleyNoise(p * scale, freq * scale) * persistence;
persistence *= 0.5;
freq *= 2.0;
}
return noise;
}
void main() {
float textureSliceWidth = u_noiseTextureDimensions.x;
float inverseNoiseTextureRows = u_noiseTextureDimensions.z;
float x = mod(v_position.x, textureSliceWidth);
float y = mod(v_position.y, textureSliceWidth);
float sliceRow = floor(v_position.y / textureSliceWidth);
float z = floor(v_position.x / textureSliceWidth) + sliceRow * inverseNoiseTextureRows * textureSliceWidth;
vec3 position = vec3(x, y, z);
position /= u_noiseDetail;
float worley0 = clamp(worleyFBMNoise(position, 3.0, 1.0), 0.0, 1.0);
float worley1 = clamp(worleyFBMNoise(position, 3.0, 2.0), 0.0, 1.0);
float worley2 = clamp(worleyFBMNoise(position, 3.0, 3.0), 0.0, 1.0);
out_FragColor = vec4(worley0, worley1, worley2, 1.0);
}
`;var s7=`uniform vec3 u_noiseTextureDimensions;
in vec2 position;
out vec2 v_position;
void main()
{
gl_Position = vec4(position, 0.1, 1.0);
float textureSliceWidth = u_noiseTextureDimensions.x;
float noiseTextureRows = u_noiseTextureDimensions.y;
float inverseNoiseTextureRows = u_noiseTextureDimensions.z;
vec2 transformedPos = (position * 0.5) + vec2(0.5);
transformedPos *= textureSliceWidth;
transformedPos.x *= textureSliceWidth * inverseNoiseTextureRows;
transformedPos.y *= noiseTextureRows;
v_position = transformedPos;
}
`;function Ud(e,t){if(e=y(e,y.EMPTY_OBJECT),this._show=y(e.show,!0),this._position=h.clone(y(e.position,h.ZERO)),!c(e.scale)&&c(e.maximumSize))this._maximumSize=h.clone(e.maximumSize),this._scale=new H(this._maximumSize.x,this._maximumSize.y);else{this._scale=H.clone(y(e.scale,new H(20,12)));let n=new h(this._scale.x,this._scale.y,Math.min(this._scale.x,this._scale.y)/1.5);this._maximumSize=h.clone(y(e.maximumSize,n))}this._slice=y(e.slice,-1),this._color=j.clone(y(e.color,j.WHITE)),this._brightness=y(e.brightness,1),this._cloudCollection=t,this._index=-1}var sut=Ud.SHOW_INDEX=0,aut=Ud.POSITION_INDEX=1,cut=Ud.SCALE_INDEX=2,lut=Ud.MAXIMUM_SIZE_INDEX=3,uut=Ud.SLICE_INDEX=4,fut=Ud.BRIGHTNESS_INDEX=5,dut=Ud.COLOR_INDEX=6;Ud.NUMBER_OF_PROPERTIES=7;function Gb(e,t){let n=e._cloudCollection;c(n)&&(n._updateCloud(e,t),e._dirty=!0)}Object.defineProperties(Ud.prototype,{show:{get:function(){return this._show},set:function(e){A.typeOf.bool("value",e),this._show!==e&&(this._show=e,Gb(this,sut))}},position:{get:function(){return this._position},set:function(e){A.typeOf.object("value",e);let t=this._position;h.equals(t,e)||(h.clone(e,t),Gb(this,aut))}},scale:{get:function(){return this._scale},set:function(e){A.typeOf.object("value",e);let t=this._scale;H.equals(t,e)||(H.clone(e,t),Gb(this,cut))}},maximumSize:{get:function(){return this._maximumSize},set:function(e){A.typeOf.object("value",e);let t=this._maximumSize;h.equals(t,e)||(h.clone(e,t),Gb(this,lut))}},color:{get:function(){return this._color},set:function(e){A.typeOf.object("value",e);let t=this._color;j.equals(t,e)||(j.clone(e,t),Gb(this,dut))}},slice:{get:function(){return this._slice},set:function(e){A.typeOf.number("value",e),this._slice!==e&&(this._slice=e,Gb(this,uut))}},brightness:{get:function(){return this._brightness},set:function(e){A.typeOf.number("value",e),this._brightness!==e&&(this._brightness=e,Gb(this,fut))}}});Ud.prototype._destroy=function(){this._cloudCollection=void 0};var zd=Ud;var _u,YL=new h,hut={positionHighAndScaleX:0,positionLowAndScaleY:1,packedAttribute0:2,packedAttribute1:3,color:4},mut={direction:0,positionHighAndScaleX:1,positionLowAndScaleY:2,packedAttribute0:3,packedAttribute1:4,color:5},put=zd.SHOW_INDEX,_ut=zd.POSITION_INDEX,gut=zd.SCALE_INDEX,yut=zd.MAXIMUM_SIZE_INDEX,but=zd.SLICE_INDEX,xut=zd.BRIGHTNESS_INDEX,Tut=zd.NUMBER_OF_PROPERTIES,Aut=zd.COLOR_INDEX;function Hd(e){e=y(e,y.EMPTY_OBJECT),this._clouds=[],this._cloudsToUpdate=[],this._cloudsToUpdateIndex=0,this._cloudsRemoved=!1,this._createVertexArray=!1,this._propertiesChanged=new Uint32Array(Tut),this._noiseTexture=void 0,this._textureSliceWidth=128,this._noiseTextureRows=4,this.noiseDetail=y(e.noiseDetail,16),this.noiseOffset=h.clone(y(e.noiseOffset,h.ZERO)),this._loading=!1,this._ready=!1;let t=this;this._uniforms={u_noiseTexture:function(){return t._noiseTexture},u_noiseTextureDimensions:Rye(t),u_noiseDetail:function(){return t.noiseDetail}},this._vaNoise=void 0,this._spNoise=void 0,this._spCreated=!1,this._sp=void 0,this._rs=void 0,this.show=y(e.show,!0),this._colorCommands=[],this.debugBillboards=y(e.debugBillboards,!1),this._compiledDebugBillboards=!1,this.debugEllipsoids=y(e.debugEllipsoids,!1),this._compiledDebugEllipsoids=!1}function Rye(e){return function(){return YL.x=e._textureSliceWidth,YL.y=e._noiseTextureRows,YL.z=1/e._noiseTextureRows,YL}}Object.defineProperties(Hd.prototype,{length:{get:function(){return c7(this),this._clouds.length}}});function Mye(e){let t=e.length;for(let n=0;n<t;++n)e[n]&&e[n]._destroy()}Hd.prototype.add=function(e){e=y(e,y.EMPTY_OBJECT);let t=y(e.cloudType,kD.CUMULUS);if(!kD.validate(t))throw new E("invalid cloud type");let n;return t===kD.CUMULUS&&(n=new zd(e,this),n._index=this._clouds.length,this._clouds.push(n),this._createVertexArray=!0),n};Hd.prototype.remove=function(e){return this.contains(e)?(this._clouds[e._index]=void 0,this._cloudsRemoved=!0,this._createVertexArray=!0,e._destroy(),!0):!1};Hd.prototype.removeAll=function(){Mye(this._clouds),this._clouds=[],this._cloudsToUpdate=[],this._cloudsToUpdateIndex=0,this._cloudsRemoved=!1,this._createVertexArray=!0};function c7(e){if(e._cloudsRemoved){e._cloudsRemoved=!1;let t=[],n=e._clouds,i=n.length;for(let o=0,r=0;o<i;++o){let s=n[o];c(s)&&(n._index=r++,t.push(s))}e._clouds=t}}Hd.prototype._updateCloud=function(e,t){e._dirty||(this._cloudsToUpdate[this._cloudsToUpdateIndex++]=e),++this._propertiesChanged[t]};Hd.prototype.contains=function(e){return c(e)&&e._cloudCollection===this};Hd.prototype.get=function(e){return A.typeOf.number("index",e),c7(this),this._clouds[e]};var Cut=new Float32Array([-1,-1,1,-1,1,1,-1,1]),Eut=new Uint16Array([0,1,2,0,2,3]);function Sut(e){let t=xt.createVertexBuffer({context:e,typedArray:Cut,usage:ke.STATIC_DRAW}),n=xt.createIndexBuffer({context:e,typedArray:Eut,usage:ke.STATIC_DRAW,indexDatatype:Fe.UNSIGNED_SHORT}),i=[{index:0,vertexBuffer:t,componentsPerAttribute:2,componentDatatype:$.FLOAT}];return new ni({context:e,attributes:i,indexBuffer:n})}var l7;function wut(e){let n=e.cache.cloudCollection_indexBufferBatched;if(c(n))return n;let i=16384*6-6,o=new Uint16Array(i);for(let r=0,s=0;r<i;r+=6,s+=4)o[r]=s,o[r+1]=s+1,o[r+2]=s+2,o[r+3]=s,o[r+4]=s+2,o[r+5]=s+3;return n=xt.createIndexBuffer({context:e,typedArray:o,usage:ke.STATIC_DRAW,indexDatatype:Fe.UNSIGNED_SHORT}),n.vertexArrayDestroyable=!1,e.cache.cloudCollection_indexBufferBatched=n,n}function vut(e){let t=e.cache.cloudCollection_indexBufferInstanced;return c(t)||(t=xt.createIndexBuffer({context:e,typedArray:new Uint16Array([0,1,2,0,2,3]),usage:ke.STATIC_DRAW,indexDatatype:Fe.UNSIGNED_SHORT}),t.vertexArrayDestroyable=!1,e.cache.cloudCollection_indexBufferInstanced=t),t}function Dut(e){let t=e.cache.cloudCollection_vertexBufferInstanced;return c(t)||(t=xt.createVertexBuffer({context:e,typedArray:new Float32Array([0,0,1,0,1,1,0,1]),usage:ke.STATIC_DRAW}),t.vertexArrayDestroyable=!1,e.cache.cloudCollection_vertexBufferInstanced=t),t}function Put(e,t,n){let i=[{index:_u.positionHighAndScaleX,componentsPerAttribute:4,componentDatatype:$.FLOAT,usage:ke.STATIC_DRAW},{index:_u.positionLowAndScaleY,componentsPerAttribute:4,componentDatatype:$.FLOAT,usage:ke.STATIC_DRAW},{index:_u.packedAttribute0,componentsPerAttribute:4,componentDatatype:$.FLOAT,usage:ke.STATIC_DRAW},{index:_u.packedAttribute1,componentsPerAttribute:4,componentDatatype:$.FLOAT,usage:ke.STATIC_DRAW},{index:_u.color,componentsPerAttribute:4,componentDatatype:$.UNSIGNED_BYTE,normalize:!0,usage:ke.STATIC_DRAW}];n&&i.push({index:_u.direction,componentsPerAttribute:2,componentDatatype:$.FLOAT,vertexBuffer:Dut(e)});let o=n?t:4*t;return new L0(e,i,o,n)}var a7=new Gn;function Lye(e,t,n,i){let o,r=n[_u.positionHighAndScaleX],s=n[_u.positionLowAndScaleY],a=i.position;Gn.fromCartesian(a,a7);let l=i.scale,u=a7.high,f=a7.low;e._instanced?(o=i._index,r(o,u.x,u.y,u.z,l.x),s(o,f.x,f.y,f.z,l.y)):(o=i._index*4,r(o+0,u.x,u.y,u.z,l.x),r(o+1,u.x,u.y,u.z,l.x),r(o+2,u.x,u.y,u.z,l.x),r(o+3,u.x,u.y,u.z,l.x),s(o+0,f.x,f.y,f.z,l.y),s(o+1,f.x,f.y,f.z,l.y),s(o+2,f.x,f.y,f.z,l.y),s(o+3,f.x,f.y,f.z,l.y))}function Nye(e,t,n,i){let o,r=n[_u.packedAttribute0],s=i.show,a=i.brightness;e._instanced?(o=i._index,r(o,s,a,0,0)):(o=i._index*4,r(o+0,s,a,0,0),r(o+1,s,a,1,0),r(o+2,s,a,1,1),r(o+3,s,a,0,1))}function Fye(e,t,n,i){let o,r=n[_u.packedAttribute1],s=i.maximumSize,a=i.slice;e._instanced?(o=i._index,r(o,s.x,s.y,s.z,a)):(o=i._index*4,r(o+0,s.x,s.y,s.z,a),r(o+1,s.x,s.y,s.z,a),r(o+2,s.x,s.y,s.z,a),r(o+3,s.x,s.y,s.z,a))}function Bye(e,t,n,i){let o,r=n[_u.color],s=i.color,a=j.floatToByte(s.red),l=j.floatToByte(s.green),u=j.floatToByte(s.blue),f=j.floatToByte(s.alpha);e._instanced?(o=i._index,r(o,a,l,u,f)):(o=i._index*4,r(o+0,a,l,u,f),r(o+1,a,l,u,f),r(o+2,a,l,u,f),r(o+3,a,l,u,f))}function Iut(e,t,n,i){Lye(e,t,n,i),Nye(e,t,n,i),Fye(e,t,n,i),Bye(e,t,n,i)}function Out(e,t,n,i){let o=e,r=o._textureSliceWidth,s=o._noiseTextureRows;if(r/s<1||r%s!==0)throw new E("noiseTextureRows must evenly divide textureSliceWidth");let a=t.context;o._vaNoise=Sut(a),o._spNoise=an.fromCache({context:a,vertexShaderSource:n,fragmentShaderSource:i,attributeLocations:{position:0}});let l=o.noiseDetail,u=o.noiseOffset;o._noiseTexture=new Lt({context:a,width:r*r/s,height:r*s,pixelDatatype:Be.UNSIGNED_BYTE,pixelFormat:Ve.RGBA,sampler:new Qt({wrapS:yn.REPEAT,wrapT:yn.REPEAT,minificationFilter:$t.NEAREST,magnificationFilter:fi.NEAREST})});let f=new zl({vertexArray:o._vaNoise,shaderProgram:o._spNoise,outputTexture:o._noiseTexture,uniformMap:{u_noiseTextureDimensions:Rye(o),u_noiseDetail:function(){return l},u_noiseOffset:function(){return u}},persists:!1,owner:e,postExecute:function(d){o._ready=!0,o._loading=!1}});t.commandList.push(f),o._loading=!0}function Rut(e,t){let n=e,i=t.context;n._createVertexArray=!1,n._vaf=n._vaf&&n._vaf.destroy();let o=e._clouds,r=o.length;if(r>0){n._vaf=Put(i,r,n._instanced);let s=n._vaf.writers,a;for(a=0;a<r;++a){let l=o[a];Iut(e,t,s,l)}n._vaf.commit(l7(i))}}var Mut=[];function Lut(e,t){let n=t.context,i=e,r=i._clouds.length,s=i._cloudsToUpdate,a=i._cloudsToUpdateIndex,l=i._propertiesChanged,u=Mut;u.length=0,(l[_ut]||l[gut])&&u.push(Lye),(l[put]||l[xut])&&u.push(Nye),(l[yut]||l[but])&&u.push(Fye),l[Aut]&&u.push(Bye);let f=u.length,d=i._vaf.writers,p,g,m;if(a/r>.1){for(p=0;p<a;++p)for(g=s[p],g._dirty=!1,m=0;m<f;++m)u[m](e,t,d,g);i._vaf.commit(l7(n))}else{for(p=0;p<a;++p){for(g=s[p],g._dirty=!1,m=0;m<f;++m)u[m](e,t,d,g);i._instanced?i._vaf.subCommit(g._index,1):i._vaf.subCommit(g._index*4,4)}i._vaf.endSubCommits()}i._cloudsToUpdateIndex=0}function Nut(e,t,n,i){let o=t.context,r=e,s=new Ge({defines:[],sources:[n]});r._instanced&&s.defines.push("INSTANCED");let a=new Ge({defines:[],sources:[i]});r.debugBillboards&&a.defines.push("DEBUG_BILLBOARDS"),r.debugEllipsoids&&a.defines.push("DEBUG_ELLIPSOIDS"),r._sp=an.replaceCache({context:o,shaderProgram:r._sp,vertexShaderSource:s,fragmentShaderSource:a,attributeLocations:_u}),r._rs=ze.fromCache({depthTest:{enabled:!0,func:ne.LESS},depthMask:!1,blending:hn.ALPHA_BLEND}),r._spCreated=!0,r._compiledDebugBillboards=r.debugBillboards,r._compiledDebugEllipsoids=r.debugEllipsoids}function Fut(e,t){let n=e,i=t.passes,o=n._uniforms,r=t.commandList;if(i.render){let s=n._colorCommands,a=n._vaf.va,l=a.length;s.length=l;for(let u=0;u<l;u++){let f=s[u];c(f)||(f=s[u]=new et),f.pass=ve.TRANSLUCENT,f.owner=e,f.uniformMap=o,f.count=a[u].indicesCount,f.vertexArray=a[u].va,f.shaderProgram=n._sp,f.renderState=n._rs,n._instanced&&(f.count=6,f.instanceCount=n._clouds.length),r.push(f)}}}Hd.prototype.update=function(e){if(c7(this),!this.show)return;let t=this.debugBillboards||this.debugEllipsoids;this._ready=t?!0:c(this._noiseTexture),!this._ready&&!this._loading&&!t&&Out(this,e,s7,r7),this._instanced=e.context.instancedArrays,_u=this._instanced?mut:hut,l7=this._instanced?vut:wut;let i=this._clouds.length,o=this._cloudsToUpdate,r=this._cloudsToUpdateIndex;this._createVertexArray?Rut(this,e):r>0&&Lut(this,e),r>i*1.5&&(o.length=i),!(!c(this._vaf)||!c(this._vaf.va)||!this._ready&!t)&&((!this._spCreated||this.debugBillboards!==this._compiledDebugBillboards||this.debugEllipsoids!==this._compiledDebugEllipsoids)&&Nut(this,e,o7,i7),Fut(this,e))};Hd.prototype.isDestroyed=function(){return!1};Hd.prototype.destroy=function(){return this._noiseTexture=this._noiseTexture&&this._noiseTexture.destroy(),this._sp=this._sp&&this._sp.destroy(),this._vaf=this._vaf&&this._vaf.destroy(),Mye(this._clouds),de(this)};var But=Hd;async function u7(e,t){let n=t.terrainProvider,i=t.mapProjection,o=i.ellipsoid,r,s=t.camera.getRectangleCameraCoordinates(e);if(t.mode===oe.SCENE3D?r=o.cartesianToCartographic(s):r=i.unproject(s),!c(n))return r;let a=n.availability;if(!c(a)||t.mode===oe.SCENE2D)return r;let l=[ae.center(e),ae.southeast(e),ae.southwest(e),ae.northeast(e),ae.northwest(e)],u=await u7._sampleTerrainMostDetailed(n,l),f=!1,d=u.reduce(function(g,m){return c(m.height)?(f=!0,Math.max(m.height,g)):g},-Number.MAX_VALUE),p=r;return f&&(p.height+=d),p}u7._sampleTerrainMostDetailed=fC;var AC=u7;var kut=R.toRadians(30);function f7(e){this._angle=y(e,kut)}Object.defineProperties(f7.prototype,{angle:{get:function(){return this._angle},set:function(e){A.typeOf.number("value",e),this._angle=e}}});f7.prototype.emit=function(e){let t=Math.tan(this._angle),n=R.randomBetween(0,R.TWO_PI),i=R.randomBetween(0,t),o=i*Math.cos(n),r=i*Math.sin(n),s=1;e.velocity=h.fromElements(o,r,s,e.velocity),h.normalize(e.velocity,e.velocity),e.position=h.clone(h.ZERO,e.position)};var Vut=f7;var Uut=new j,zut=new j,Hut=new j,Gut=new j,kye=new se,VD=new Uint8Array(4);function Vye(e,t,n,i){let o=t.height===n.height?0:(e-t.height)/(n.height-t.height);return j.lerp(t.color,n.color,o,i)}function XL(e,t){return{height:e,color:j.clone(t)}}function Uye(e){return e=e.filter(function(t,n,i){let o=n>0,r=n<i.length-1,s=o?t.height===i[n-1].height:!0,a=r?t.height===i[n+1].height:!0;return!s||!a}),e=e.filter(function(t,n,i){let o=n>0,r=n<i.length-1,s=o?j.equals(t.color,i[n-1].color):!1,a=r?j.equals(t.color,i[n+1].color):!1;return!s||!a}),e=e.filter(function(t,n,i){let o=n>0,r=o?j.equals(t.color,i[n-1].color):!1,s=o?t.height===i[n-1].height:!0;return!r||!s}),e}function jut(e){let t,n,i=[],o=e.length;for(t=0;t<o;t++){let r=e[t],s=r.entries,a=s.length;if(!Array.isArray(s)||a===0)throw new E("entries must be an array with size > 0.");let l=[];for(n=0;n<a;n++){let g=s[n];if(!c(g.height))throw new E("entry requires a height.");if(!c(g.color))throw new E("entry requires a color.");let m=R.clamp(g.height,Sl._minimumHeight,Sl._maximumHeight),b=j.clone(g.color,Uut);b.red*=b.alpha,b.green*=b.alpha,b.blue*=b.alpha,l.push(XL(m,b))}let u=!0,f=!0;for(n=0;n<a-1;n++){let g=l[n+0],m=l[n+1];u=u&&g.height<=m.height,f=f&&g.height>=m.height}f?l=l.reverse():u||Fb(l,function(g,m){return R.sign(g.height-m.height)});let d=y(r.extendDownwards,!1),p=y(r.extendUpwards,!1);l.length===1&&!d&&!p&&(d=!0,p=!0),d&&l.splice(0,0,XL(Sl._minimumHeight,l[0].color)),p&&l.splice(l.length,0,XL(Sl._maximumHeight,l[l.length-1].color)),l=Uye(l),i.push(l)}return i}function Wut(e){let t=jut(e),n=[],i=[],o;function r(u,f){n.push(XL(u,f))}function s(u,f,d){let p=j.multiplyByScalar(d,1-f.alpha,Gut);p=j.add(p,f,p),r(u,p)}let a=t.length;for(o=0;o<a;o++){let u=t[o],f=0,d=0;i=n,n=[];let p=u.length,g=i.length;for(;f<p||d<g;){let m=f<p?u[f]:void 0,b=f>0?u[f-1]:void 0,x=f<p-1?u[f+1]:void 0,T=d<g?i[d]:void 0,C=d>0?i[d-1]:void 0,S=d<g-1?i[d+1]:void 0;if(c(m)&&c(T)&&m.height===T.height){let v=c(S)&&T.height===S.height,D=!c(C),I=!c(S),L=c(x)&&m.height===x.height,M=!c(b),N=!c(x);v?L?(s(m.height,m.color,T.color),s(m.height,x.color,S.color)):M?(r(m.height,T.color),s(m.height,m.color,S.color)):N?(s(m.height,m.color,T.color),r(m.height,S.color)):(s(m.height,m.color,T.color),s(m.height,m.color,S.color)):D?L?(r(m.height,m.color),s(m.height,x.color,T.color)):N?(r(m.height,m.color),r(m.height,T.color)):(M||r(m.height,m.color),s(m.height,m.color,T.color)):I?L?(s(m.height,m.color,T.color),r(m.height,x.color)):M?(r(m.height,T.color),r(m.height,m.color)):N?s(m.height,m.color,T.color):(s(m.height,m.color,T.color),r(m.height,m.color)):L?(s(m.height,m.color,T.color),s(m.height,x.color,T.color)):M?(r(m.height,T.color),s(m.height,m.color,T.color)):N?(s(m.height,m.color,T.color),r(m.height,T.color)):s(m.height,m.color,T.color),f+=L?2:1,d+=v?2:1}else if(c(m)&&c(T)&&c(C)&&m.height<T.height){let v=Vye(m.height,C,T,Hut);c(b)?c(x)?s(m.height,m.color,v):(s(m.height,m.color,v),r(m.height,v)):(r(m.height,v),s(m.height,m.color,v)),f++}else if(c(T)&&c(m)&&c(b)&&T.height<m.height){let v=Vye(T.height,b,m,zut);c(C)?c(S)?s(T.height,v,T.color):(s(T.height,v,T.color),r(T.height,v)):(r(T.height,v),s(T.height,v,T.color)),d++}else c(m)&&(!c(T)||m.height<T.height)?(c(T)&&!c(C)&&!c(x)?(r(m.height,m.color),r(m.height,Sl._emptyColor),r(T.height,Sl._emptyColor)):(!c(T)&&c(C)&&!c(b)&&(r(C.height,Sl._emptyColor),r(m.height,Sl._emptyColor)),r(m.height,m.color)),f++):c(T)&&(!c(m)||T.height<m.height)&&(r(T.height,T.color),d++)}}return Uye(n)}function Sl(e){let{scene:t,layers:n}=y(e,y.EMPTY_OBJECT);A.typeOf.object("options.scene",t),A.defined("options.layers",n),A.typeOf.number.greaterThan("options.layers.length",n.length,0);let{context:i}=t,o=Wut(n),r=o.length,s,a,l;if(!Sl._useFloatTexture(i)){a=Be.UNSIGNED_BYTE,l=Ve.RGBA,s=new Uint8Array(r*4);for(let g=0;g<r;g++)se.packFloat(o[g].height,kye),se.pack(kye,s,g*4)}else{a=Be.FLOAT,l=i.webgl2?Ve.RED:Ve.LUMINANCE,s=new Float32Array(r);for(let g=0;g<r;g++)s[g]=o[g].height}let f=Lt.create({context:i,pixelFormat:l,pixelDatatype:a,source:{arrayBufferView:s,width:r,height:1},sampler:new Qt({wrapS:yn.CLAMP_TO_EDGE,wrapT:yn.CLAMP_TO_EDGE,minificationFilter:$t.NEAREST,magnificationFilter:fi.NEAREST})}),d=new Uint8Array(r*4);for(let g=0;g<r;g++)o[g].color.toBytes(VD),d[g*4+0]=VD[0],d[g*4+1]=VD[1],d[g*4+2]=VD[2],d[g*4+3]=VD[3];let p=Lt.create({context:i,pixelFormat:Ve.RGBA,pixelDatatype:Be.UNSIGNED_BYTE,source:{arrayBufferView:d,width:r,height:1},sampler:new Qt({wrapS:yn.CLAMP_TO_EDGE,wrapT:yn.CLAMP_TO_EDGE,minificationFilter:$t.LINEAR,magnificationFilter:fi.LINEAR})});return Ki.fromType("ElevationBand",{heights:f,colors:p})}Sl._useFloatTexture=function(e){return e.floatingPointTexture};Sl._maximumHeight=5906376425472;Sl._minimumHeight=-5906376425472;Sl._emptyColor=new j(0,0,0,0);var qut=Sl;async function Yut(e,t){if(t=y(t,{}),t.cacheBytes=y(t.cacheBytes,1536*1024*1024),t.maximumCacheOverflowBytes=y(t.maximumCacheOverflowBytes,1024*1024*1024),t.enableCollision=y(t.enableCollision,!0),e=y(e,AD.defaultApiKey),!c(e))return Xut(t);let n,i=AD.getDefaultCredit();c(i)&&(n=[i]);let o=new De({url:`${AD.mapTilesApiEndpoint}3dtiles/root.json`,queryParameters:{key:e},credits:n});return pa.fromUrl(o,t)}var zye={};async function Xut(e){let i=zye[2275207];c(i)||(i=Xf.fromAssetId(2275207),zye[2275207]=i);let o=await i;return pa.fromUrl(o,e)}var Kut=Yut;async function $ut(e){let t=await pa.fromIonAssetId(96188,e);e=y(e,y.EMPTY_OBJECT);let n=e.style;if(!c(n)){let i=y(e.defaultColor,j.WHITE).toCssColorString();n=new TC({color:`Boolean(\${feature['cesium#color']}) ? color(\${feature['cesium#color']}) : ${i}`})}return t.style=n,t}var Zut=$ut;function Jut(e){e=y(e,y.EMPTY_OBJECT);let t=[],n=e.geometry;if(!c(n))throw new E("options.geometry is required.");(!c(n.attributes)||!c(n.primitiveType))&&(n=n.constructor.createGeometry(n));let i=n.attributes,o=k.clone(y(e.modelMatrix,k.IDENTITY)),r=y(e.length,1e4);if(c(i.normal)&&t.push(new vt({geometry:Fn.createLineSegmentsForVectors(n,"normal",r),attributes:{color:new Wt(1,0,0,1)},modelMatrix:o})),c(i.tangent)&&t.push(new vt({geometry:Fn.createLineSegmentsForVectors(n,"tangent",r),attributes:{color:new Wt(0,1,0,1)},modelMatrix:o})),c(i.bitangent)&&t.push(new vt({geometry:Fn.createLineSegmentsForVectors(n,"bitangent",r),attributes:{color:new Wt(0,0,1,1)},modelMatrix:o})),t.length>0)return new Rn({asynchronous:!1,geometryInstances:t,appearance:new ln({flat:!0,translucent:!1})})}var Qut=Jut;var Hye=/{[^}]+}/g,Gye={x:ift,y:rft,z:cft,s:lft,reverseX:oft,reverseY:sft,reverseZ:aft,westDegrees:uft,southDegrees:fft,eastDegrees:dft,northDegrees:hft,westProjected:mft,southProjected:pft,eastProjected:_ft,northProjected:gft,width:yft,height:bft},eft=At(Gye,{i:xft,j:Tft,reverseI:Aft,reverseJ:Cft,longitudeDegrees:Sft,latitudeDegrees:wft,longitudeProjected:vft,latitudeProjected:Dft,format:Ift});function UD(e){e=y(e,y.EMPTY_OBJECT),this._errorEvent=new pe,A.defined("options.url",e.url);let t=De.createIfNeeded(e.url),n=De.createIfNeeded(e.pickFeaturesUrl);this._resource=t,this._urlSchemeZeroPadding=e.urlSchemeZeroPadding,this._getFeatureInfoFormats=e.getFeatureInfoFormats,this._pickFeaturesResource=n;let i=e.subdomains;Array.isArray(i)?i=i.slice():c(i)&&i.length>0?i=i.split(""):i=["a","b","c"],this._subdomains=i,this._tileWidth=y(e.tileWidth,256),this._tileHeight=y(e.tileHeight,256),this._minimumLevel=y(e.minimumLevel,0),this._maximumLevel=e.maximumLevel,this._tilingScheme=y(e.tilingScheme,new ys({ellipsoid:e.ellipsoid})),this._rectangle=y(e.rectangle,this._tilingScheme.rectangle),this._rectangle=ae.intersection(this._rectangle,this._tilingScheme.rectangle),this._tileDiscardPolicy=e.tileDiscardPolicy;let o=e.credit;typeof o=="string"&&(o=new Pt(o)),this._credit=o,this._hasAlphaChannel=y(e.hasAlphaChannel,!0);let r=e.customTags,s=At(Gye,r),a=At(eft,r);this._tags=s,this._pickFeaturesTags=a,this._defaultAlpha=void 0,this._defaultNightAlpha=void 0,this._defaultDayAlpha=void 0,this._defaultBrightness=void 0,this._defaultContrast=void 0,this._defaultHue=void 0,this._defaultSaturation=void 0,this._defaultGamma=void 0,this._defaultMinificationFilter=void 0,this._defaultMagnificationFilter=void 0,this.enablePickFeatures=y(e.enablePickFeatures,!0)}Object.defineProperties(UD.prototype,{url:{get:function(){return this._resource.url}},urlSchemeZeroPadding:{get:function(){return this._urlSchemeZeroPadding}},pickFeaturesUrl:{get:function(){return this._pickFeaturesResource.url}},proxy:{get:function(){return this._resource.proxy}},tileWidth:{get:function(){return this._tileWidth}},tileHeight:{get:function(){return this._tileHeight}},maximumLevel:{get:function(){return this._maximumLevel}},minimumLevel:{get:function(){return this._minimumLevel}},tilingScheme:{get:function(){return this._tilingScheme}},rectangle:{get:function(){return this._rectangle}},tileDiscardPolicy:{get:function(){return this._tileDiscardPolicy}},errorEvent:{get:function(){return this._errorEvent}},credit:{get:function(){return this._credit}},hasAlphaChannel:{get:function(){return this._hasAlphaChannel}}});UD.prototype.getTileCredits=function(e,t,n){};UD.prototype.requestImage=function(e,t,n,i){return mu.loadImage(this,tft(this,e,t,n,i))};UD.prototype.pickFeatures=function(e,t,n,i,o){if(!this.enablePickFeatures||!c(this._pickFeaturesResource)||this._getFeatureInfoFormats.length===0)return;let r=0,s=this;function a(u,f){return u.callback(f)}function l(){if(r>=s._getFeatureInfoFormats.length)return Promise.resolve([]);let u=s._getFeatureInfoFormats[r],f=nft(s,e,t,n,i,o,u.format);return++r,u.type==="json"?f.fetchJson().then(u.callback).catch(l):u.type==="xml"?f.fetchXML().then(u.callback).catch(l):u.type==="text"||u.type==="html"?f.fetchText().then(u.callback).catch(l):f.fetch({responseType:u.format}).then(a.bind(void 0,u)).catch(l)}return l()};var KL=!1,gu=new ae,$L=!1,zD=new ae;function tft(e,t,n,i,o){KL=!1,$L=!1;let r=e._resource,s=r.getUrlComponent(!0),a=e._tags,l={},u=s.match(Hye);return c(u)&&u.forEach(function(f){let d=f.substring(1,f.length-1);c(a[d])&&(l[d]=a[d](e,t,n,i))}),r.getDerivedResource({request:o,templateValues:l})}var d7=!1,EC=new H,h7=!1;function nft(e,t,n,i,o,r,s){KL=!1,$L=!1,d7=!1,h7=!1;let a=e._pickFeaturesResource,l=a.getUrlComponent(!0),u=e._pickFeaturesTags,f={},d=l.match(Hye);return c(d)&&d.forEach(function(p){let g=p.substring(1,p.length-1);c(u[g])&&(f[g]=u[g](e,t,n,i,o,r,s))}),a.getDerivedResource({templateValues:f})}function SC(e,t,n){if(e&&e.urlSchemeZeroPadding&&e.urlSchemeZeroPadding.hasOwnProperty(t)){let i=e.urlSchemeZeroPadding[t];if(typeof i=="string"){let o=i.length;o>1&&(n=n.length>=o?n:new Array(o-n.toString().length+1).join("0")+n)}}return n}function ift(e,t,n,i){return SC(e,"{x}",t)}function oft(e,t,n,i){let o=e.tilingScheme.getNumberOfXTilesAtLevel(i)-t-1;return SC(e,"{reverseX}",o)}function rft(e,t,n,i){return SC(e,"{y}",n)}function sft(e,t,n,i){let o=e.tilingScheme.getNumberOfYTilesAtLevel(i)-n-1;return SC(e,"{reverseY}",o)}function aft(e,t,n,i){let o=e.maximumLevel,r=c(o)&&i<o?o-i-1:i;return SC(e,"{reverseZ}",r)}function cft(e,t,n,i){return SC(e,"{z}",i)}function lft(e,t,n,i){let o=(t+n+i)%e._subdomains.length;return e._subdomains[o]}function ZL(e,t,n,i){KL||(e.tilingScheme.tileXYToRectangle(t,n,i,gu),gu.west=R.toDegrees(gu.west),gu.south=R.toDegrees(gu.south),gu.east=R.toDegrees(gu.east),gu.north=R.toDegrees(gu.north),KL=!0)}function uft(e,t,n,i){return ZL(e,t,n,i),gu.west}function fft(e,t,n,i){return ZL(e,t,n,i),gu.south}function dft(e,t,n,i){return ZL(e,t,n,i),gu.east}function hft(e,t,n,i){return ZL(e,t,n,i),gu.north}function JL(e,t,n,i){$L||(e.tilingScheme.tileXYToNativeRectangle(t,n,i,zD),$L=!0)}function mft(e,t,n,i){return JL(e,t,n,i),zD.west}function pft(e,t,n,i){return JL(e,t,n,i),zD.south}function _ft(e,t,n,i){return JL(e,t,n,i),zD.east}function gft(e,t,n,i){return JL(e,t,n,i),zD.north}function yft(e,t,n,i){return e.tileWidth}function bft(e,t,n,i){return e.tileHeight}function xft(e,t,n,i,o,r,s){return QL(e,t,n,i,o,r),EC.x}function Tft(e,t,n,i,o,r,s){return QL(e,t,n,i,o,r),EC.y}function Aft(e,t,n,i,o,r,s){return QL(e,t,n,i,o,r),e.tileWidth-EC.x-1}function Cft(e,t,n,i,o,r,s){return QL(e,t,n,i,o,r),e.tileHeight-EC.y-1}var Eft=new ae,CC=new h;function QL(e,t,n,i,o,r,s){if(d7)return;m7(e,t,n,i,o,r);let a=CC,l=e.tilingScheme.tileXYToNativeRectangle(t,n,i,Eft);EC.x=e.tileWidth*(a.x-l.west)/l.width|0,EC.y=e.tileHeight*(l.north-a.y)/l.height|0,d7=!0}function Sft(e,t,n,i,o,r,s){return R.toDegrees(o)}function wft(e,t,n,i,o,r,s){return R.toDegrees(r)}function vft(e,t,n,i,o,r,s){return m7(e,t,n,i,o,r),CC.x}function Dft(e,t,n,i,o,r,s){return m7(e,t,n,i,o,r),CC.y}var Pft=new he;function m7(e,t,n,i,o,r,s){if(!h7){if(e.tilingScheme.projection instanceof Mi)CC.x=R.toDegrees(o),CC.y=R.toDegrees(r);else{let a=Pft;a.longitude=o,a.latitude=r,e.tilingScheme.projection.project(a,CC)}h7=!0}}function Ift(e,t,n,i,o,r,s){return s}var Lc=UD;function wf(e){Lc.call(this,e)}wf._requestMetadata=async function(e,t,n,i){try{let o=await n.fetchXML();return wf._metadataSuccess(o,e,t,n,i)}catch(o){if(o instanceof p_)return wf._metadataFailure(e,t);throw o}};wf.fromUrl=async function(e,t){A.defined("url",e);let n=De.createIfNeeded(e);n.appendForwardSlash();let i=n,o=n.getDerivedResource({url:"tilemapresource.xml"});t=y(t,y.EMPTY_OBJECT);let r=await wf._requestMetadata(t,i,o);return new wf(r)};c(Object.create)&&(wf.prototype=Object.create(Lc.prototype),wf.prototype.constructor=wf);function jye(e,t){return e.west<t.rectangle.west&&(e.west=t.rectangle.west),e.east>t.rectangle.east&&(e.east=t.rectangle.east),e.south<t.rectangle.south&&(e.south=t.rectangle.south),e.north>t.rectangle.north&&(e.north=t.rectangle.north),e}function Wye(e,t,n){let i=e.positionToTileXY(ae.southwest(t),n),o=e.positionToTileXY(ae.northeast(t),n);return(Math.abs(o.x-i.x)+1)*(Math.abs(o.y-i.y)+1)>4?0:n}wf._metadataSuccess=function(e,t,n,i,o){let r=/tileformat/i,s=/tileset/i,a=/tilesets/i,l=/boundingbox/i,u,f,d,p=[],g=e.childNodes[0].childNodes;for(let M=0;M<g.length;M++)if(r.test(g.item(M).nodeName))u=g.item(M);else if(a.test(g.item(M).nodeName)){d=g.item(M);let N=g.item(M).childNodes;for(let B=0;B<N.length;B++)s.test(N.item(B).nodeName)&&p.push(N.item(B))}else l.test(g.item(M).nodeName)&&(f=g.item(M));let m;if(!c(d)||!c(f))throw m=`Unable to find expected tilesets or bbox attributes in ${i.url}.`,c(o)&&No.reportError(void 0,o,o.errorEvent,m),new ue(m);let b=y(t.fileExtension,u.getAttribute("extension")),x=y(t.tileWidth,parseInt(u.getAttribute("width"),10)),T=y(t.tileHeight,parseInt(u.getAttribute("height"),10)),C=y(t.minimumLevel,parseInt(p[0].getAttribute("order"),10)),S=y(t.maximumLevel,parseInt(p[p.length-1].getAttribute("order"),10)),v=d.getAttribute("profile"),D=t.tilingScheme;if(!c(D))if(v==="geodetic"||v==="global-geodetic")D=new $i({ellipsoid:t.ellipsoid});else if(v==="mercator"||v==="global-mercator")D=new ys({ellipsoid:t.ellipsoid});else throw m=`${i.url} specifies an unsupported profile attribute, ${v}.`,c(o)&&No.reportError(void 0,o,o.errorEvent,m),new ue(m);let I=ae.clone(t.rectangle);if(!c(I)){let M,N,B,_;y(t.flipXY,!1)?(B=new H(parseFloat(f.getAttribute("miny")),parseFloat(f.getAttribute("minx"))),_=new H(parseFloat(f.getAttribute("maxy")),parseFloat(f.getAttribute("maxx")))):(B=new H(parseFloat(f.getAttribute("minx")),parseFloat(f.getAttribute("miny"))),_=new H(parseFloat(f.getAttribute("maxx")),parseFloat(f.getAttribute("maxy"))));let P=v==="geodetic"||v==="mercator";if(D.projection instanceof Mi||P)M=he.fromDegrees(B.x,B.y),N=he.fromDegrees(_.x,_.y);else{let O=D.projection;M=O.unproject(B),N=O.unproject(_)}I=new ae(M.longitude,M.latitude,N.longitude,N.latitude)}return I=jye(I,D),C=Wye(D,I,C),{url:n.getDerivedResource({url:`{z}/{x}/{reverseY}.${b}`}),tilingScheme:D,rectangle:I,tileWidth:x,tileHeight:T,minimumLevel:C,maximumLevel:S,tileDiscardPolicy:t.tileDiscardPolicy,credit:t.credit}};wf._metadataFailure=function(e,t){let n=y(e.fileExtension,"png"),i=y(e.tileWidth,256),o=y(e.tileHeight,256),r=e.maximumLevel,s=c(e.tilingScheme)?e.tilingScheme:new ys({ellipsoid:e.ellipsoid}),a=y(e.rectangle,s.rectangle);a=jye(a,s);let l=Wye(s,a,e.minimumLevel);return{url:t.getDerivedResource({url:`{z}/{x}/{reverseY}.${n}`}),tilingScheme:s,rectangle:a,tileWidth:i,tileHeight:o,minimumLevel:l,maximumLevel:r,tileDiscardPolicy:e.tileDiscardPolicy,credit:e.credit}};var jb=wf;function qye(e){this.channel=e.channel,this.ellipsoid=e.ellipsoid,this.tilingScheme=void 0,this.version=void 0}qye.prototype.build=function(e){e._channel=this.channel,e._version=this.version,e._tilingScheme=this.tilingScheme};function Oft(e,t){let n;try{n=JSON.parse(e)}catch{n=JSON.parse(e.replace(/([\[\{,])[\n\r ]*([A-Za-z0-9]+)[\n\r ]*:/g,'$1"$2":'))}let i;for(let o=0;o<n.layers.length;o++)if(n.layers[o].id===t.channel){i=n.layers[o];break}if(!c(i)){let o=`Could not find layer with channel (id) of ${t.channel}.`;throw new ue(o)}if(!c(i.version)){let o=`Could not find a version in channel (id) ${t.channel}.`;throw new ue(o)}if(t.version=i.version,c(n.projection)&&n.projection==="flat")t.tilingScheme=new $i({numberOfLevelZeroTilesX:2,numberOfLevelZeroTilesY:2,rectangle:new ae(-Math.PI,-Math.PI,Math.PI,Math.PI),ellipsoid:t.ellipsoid});else if(!c(n.projection)||n.projection==="mercator")t.tilingScheme=new ys({numberOfLevelZeroTilesX:2,numberOfLevelZeroTilesY:2,ellipsoid:t.ellipsoid});else{let o=`Unsupported projection ${n.projection}.`;throw new ue(o)}return!0}function Rft(e,t,n){let i=`An error occurred while accessing ${t.url}.`;throw c(e)&&c(e.message)&&(i+=`: ${e.message}`),No.reportError(void 0,n,c(n)?n._errorEvent:void 0,i),new ue(i)}async function Mft(e,t,n){try{let i=await e.fetchText();Oft(i,t)}catch(i){Rft(i,e,n)}}function wl(e){e=y(e,{}),this._defaultAlpha=void 0,this._defaultNightAlpha=void 0,this._defaultDayAlpha=void 0,this._defaultBrightness=void 0,this._defaultContrast=void 0,this._defaultHue=void 0,this._defaultSaturation=void 0,this._defaultGamma=1.9,this._defaultMinificationFilter=void 0,this._defaultMagnificationFilter=void 0,this._tileDiscardPolicy=e.tileDiscardPolicy,this._channel=e.channel,this._requestType="ImageryMaps",this._credit=new Pt(`<a href="http://www.google.com/enterprise/mapsearth/products/earthenterprise.html"><img src="${wl.logoUrl}" title="Google Imagery"/></a>`),this._tilingScheme=void 0,this._version=void 0,this._tileWidth=256,this._tileHeight=256,this._maximumLevel=e.maximumLevel,this._errorEvent=new pe}Object.defineProperties(wl.prototype,{url:{get:function(){return this._url}},path:{get:function(){return this._path}},proxy:{get:function(){return this._resource.proxy}},channel:{get:function(){return this._channel}},tileWidth:{get:function(){return this._tileWidth}},tileHeight:{get:function(){return this._tileHeight}},maximumLevel:{get:function(){return this._maximumLevel}},minimumLevel:{get:function(){return 0}},tilingScheme:{get:function(){return this._tilingScheme}},version:{get:function(){return this._version}},requestType:{get:function(){return this._requestType}},rectangle:{get:function(){return this._tilingScheme.rectangle}},tileDiscardPolicy:{get:function(){return this._tileDiscardPolicy}},errorEvent:{get:function(){return this._errorEvent}},credit:{get:function(){return this._credit}},hasAlphaChannel:{get:function(){return!0}}});wl.fromUrl=async function(e,t,n){A.defined("url",e),A.defined("channel",t),n=y(n,{});let i=y(n.path,"/default_map"),o=De.createIfNeeded(e).getDerivedResource({url:i[0]==="/"?i.substring(1):i});o.appendForwardSlash();let r=o.getDerivedResource({url:"query",queryParameters:{request:"Json",vars:"geeServerDefs",is2d:"t"}}),s=new qye(n);s.channel=t,await Mft(r,s);let a=new wl(n);return s.build(a),a._resource=o,a._url=e,a._path=i,a};wl.prototype.getTileCredits=function(e,t,n){};wl.prototype.requestImage=function(e,t,n,i){let o=this._resource.getDerivedResource({url:"query",request:i,queryParameters:{request:this._requestType,channel:this._channel,version:this._version,x:e,y:t,z:n+1}});return mu.loadImage(this,o)};wl.prototype.pickFeatures=function(e,t,n,i,o){};wl._logoUrl=void 0;Object.defineProperties(wl,{logoUrl:{get:function(){return c(wl._logoUrl)||(wl._logoUrl=sn("Assets/Images/google_earth_credit.png")),wl._logoUrl},set:function(e){A.defined("value",e),wl._logoUrl=e}}});var p7=wl;var Lft=/\/$/,Yye=new Pt('&copy; <a href="https://www.mapbox.com/about/maps/">Mapbox</a> &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> <strong><a href="https://www.mapbox.com/map-feedback/">Improve this map</a></strong>');function wC(e){e=y(e,y.EMPTY_OBJECT);let t=e.mapId;if(!c(t))throw new E("options.mapId is required.");let n=e.accessToken;if(!c(n))throw new E("options.accessToken is required.");this._defaultAlpha=void 0,this._defaultNightAlpha=void 0,this._defaultDayAlpha=void 0,this._defaultBrightness=void 0,this._defaultContrast=void 0,this._defaultHue=void 0,this._defaultSaturation=void 0,this._defaultGamma=void 0,this._defaultMinificationFilter=void 0,this._defaultMagnificationFilter=void 0;let i=De.createIfNeeded(y(e.url,"https://{s}.tiles.mapbox.com/v4/"));this._mapId=t,this._accessToken=n;let o=y(e.format,"png");/\./.test(o)||(o=`.${o}`),this._format=o;let r=i.getUrlComponent();Lft.test(r)||(r+="/"),r+=`${t}/{z}/{x}/{y}${this._format}`,i.url=r,i.setQueryParameters({access_token:n});let s;c(e.credit)?(s=e.credit,typeof s=="string"&&(s=new Pt(s))):s=Yye,this._resource=i,this._imageryProvider=new Lc({url:i,credit:s,ellipsoid:e.ellipsoid,minimumLevel:e.minimumLevel,maximumLevel:e.maximumLevel,rectangle:e.rectangle})}Object.defineProperties(wC.prototype,{url:{get:function(){return this._imageryProvider.url}},rectangle:{get:function(){return this._imageryProvider.rectangle}},tileWidth:{get:function(){return this._imageryProvider.tileWidth}},tileHeight:{get:function(){return this._imageryProvider.tileHeight}},maximumLevel:{get:function(){return this._imageryProvider.maximumLevel}},minimumLevel:{get:function(){return this._imageryProvider.minimumLevel}},tilingScheme:{get:function(){return this._imageryProvider.tilingScheme}},tileDiscardPolicy:{get:function(){return this._imageryProvider.tileDiscardPolicy}},errorEvent:{get:function(){return this._imageryProvider.errorEvent}},credit:{get:function(){return this._imageryProvider.credit}},proxy:{get:function(){return this._imageryProvider.proxy}},hasAlphaChannel:{get:function(){return this._imageryProvider.hasAlphaChannel}}});wC.prototype.getTileCredits=function(e,t,n){};wC.prototype.requestImage=function(e,t,n,i){return this._imageryProvider.requestImage(e,t,n,i)};wC.prototype.pickFeatures=function(e,t,n,i,o){return this._imageryProvider.pickFeatures(e,t,n,i,o)};wC._defaultCredit=Yye;var _7=wC;function Wb(e){e=y(e,y.EMPTY_OBJECT),this._defaultAlpha=void 0,this._defaultNightAlpha=void 0,this._defaultDayAlpha=void 0,this._defaultBrightness=void 0,this._defaultContrast=void 0,this._defaultHue=void 0,this._defaultSaturation=void 0,this._defaultGamma=void 0,this._defaultMinificationFilter=void 0,this._defaultMagnificationFilter=void 0;let t=y(e.rectangle,ae.MAX_VALUE),n=new $i({rectangle:t,numberOfLevelZeroTilesX:1,numberOfLevelZeroTilesY:1,ellipsoid:e.ellipsoid});this._tilingScheme=n,this._image=void 0,this._texture=void 0,this._hasError=!1,this._errorEvent=new pe;let i=e.credit;typeof i=="string"&&(i=new Pt(i)),this._credit=i,A.defined("options.url",e.url);let o=De.createIfNeeded(e.url);this._resource=o,A.typeOf.number("options.tileWidth",e.tileWidth),A.typeOf.number("options.tileHeight",e.tileHeight),this._tileWidth=e.tileWidth,this._tileHeight=e.tileHeight}Object.defineProperties(Wb.prototype,{url:{get:function(){return this._resource.url}},proxy:{get:function(){return this._resource.proxy}},tileWidth:{get:function(){return this._tileWidth}},tileHeight:{get:function(){return this._tileHeight}},maximumLevel:{get:function(){return 0}},minimumLevel:{get:function(){return 0}},tilingScheme:{get:function(){return this._tilingScheme}},rectangle:{get:function(){return this._tilingScheme.rectangle}},tileDiscardPolicy:{get:function(){}},errorEvent:{get:function(){return this._errorEvent}},credit:{get:function(){return this._credit}},hasAlphaChannel:{get:function(){return!0}}});function Nft(e,t,n,i){let o=`Failed to load image ${e.url}`;c(t)&&c(t.message)&&(o+=`: ${t.message}`);let r=No.reportError(i,n,c(n)?n._errorEvent:void 0,o,0,0,0,t);if(r.retry)return g7(e,n,r);throw c(n)&&(n._hasError=!0),new ue(o)}async function g7(e,t,n){try{return await mu.loadImage(null,e)}catch(i){return Nft(e,i,t,n)}}Wb.fromUrl=async function(e,t){A.defined("url",e);let n=De.createIfNeeded(e),i=await g7(n);t=y(t,y.EMPTY_OBJECT);let o=new Wb({...t,url:e,tileWidth:i.width,tileHeight:i.height});return o._image=i,o};Wb.prototype.getTileCredits=function(e,t,n){};Wb.prototype.requestImage=async function(e,t,n,i){if(!this._hasError&&!c(this._image)){let o=await g7(this._resource,this);return this._image=o,No.reportSuccess(this._errorEvent),o}return this._image};Wb.prototype.pickFeatures=function(e,t,n,i,o){};var y7=Wb;function Fft(e,t,n){if(!c(e))throw new E("type is required.");if(this.type=e,!c(t))if(e==="json")t="application/json";else if(e==="xml")t="text/xml";else if(e==="html")t="text/html";else if(e==="text")t="text/plain";else throw new E('format is required when type is not "json", "xml", "html", or "text".');if(this.format=t,!c(n))if(e==="json")n=Bft;else if(e==="xml")n=zft;else if(e==="html")n=Xye;else if(e==="text")n=Xye;else throw new E('callback is required when type is not "json", "xml", "html", or "text".');this.callback=n}function Bft(e){let t=[],n=e.features;for(let i=0;i<n.length;++i){let o=n[i],r=new Qp;if(r.data=o,r.properties=o.properties,r.configureNameFromProperties(o.properties),r.configureDescriptionFromProperties(o.properties),c(o.geometry)&&o.geometry.type==="Point"){let s=o.geometry.coordinates[0],a=o.geometry.coordinates[1];r.position=he.fromDegrees(s,a)}t.push(r)}return t}var b7="http://www.mapinfo.com/mxp",kft="http://www.esri.com/wms",Vft="http://www.opengis.net/wfs",Uft="http://www.opengis.net/gml";function zft(e){let t=e.documentElement;if(t.localName==="MultiFeatureCollection"&&t.namespaceURI===b7)return Hft(e);if(t.localName==="FeatureInfoResponse"&&t.namespaceURI===kft)return Gft(e);if(t.localName==="FeatureCollection"&&t.namespaceURI===Vft)return jft(e);if(t.localName==="ServiceExceptionReport")throw new ue(new XMLSerializer().serializeToString(t));return t.localName==="msGMLOutput"?Wft(e):qft(e)}function Hft(e){let t=[],i=e.documentElement.getElementsByTagNameNS(b7,"Feature");for(let o=0;o<i.length;++o){let r=i[o],s={},a=r.getElementsByTagNameNS(b7,"Val");for(let u=0;u<a.length;++u){let f=a[u];if(f.hasAttribute("ref")){let d=f.getAttribute("ref"),p=f.textContent.trim();s[d]=p}}let l=new Qp;l.data=r,l.properties=s,l.configureNameFromProperties(s),l.configureDescriptionFromProperties(s),t.push(l)}return t}function Gft(e){let t=e.documentElement,n=[],i,o=t.getElementsByTagNameNS("*","FIELDS");if(o.length>0)for(let r=0;r<o.length;++r){let s=o[r];i={};let a=s.attributes;for(let l=0;l<a.length;++l){let u=a[l];i[u.name]=u.value}n.push(eN(s,i))}else{let r=t.getElementsByTagNameNS("*","FeatureInfo");for(let s=0;s<r.length;++s){let a=r[s];i={};let l=a.childNodes;for(let u=0;u<l.length;++u){let f=l[u];f.nodeType===Node.ELEMENT_NODE&&(i[f.localName]=f.textContent)}n.push(eN(a,i))}}return n}function jft(e){let t=[],i=e.documentElement.getElementsByTagNameNS(Uft,"featureMember");for(let o=0;o<i.length;++o){let r=i[o],s={};x7(r,s),t.push(eN(r,s))}return t}function Wft(e){let t=[],n,i=e.documentElement.childNodes;for(let r=0;r<i.length;r++)if(i[r].nodeType===Node.ELEMENT_NODE){n=i[r];break}if(!c(n))throw new ue("Unable to find first child of the feature info xml document");let o=n.childNodes;for(let r=0;r<o.length;++r){let s=o[r];if(s.nodeType===Node.ELEMENT_NODE){let a={};x7(s,a),t.push(eN(s,a))}}return t}function x7(e,t){let n=!0;for(let i=0;i<e.childNodes.length;++i){let o=e.childNodes[i];o.nodeType===Node.ELEMENT_NODE&&(n=!1),!(o.localName==="Point"||o.localName==="LineString"||o.localName==="Polygon"||o.localName==="boundedBy")&&o.hasChildNodes()&&x7(o,t)&&(t[o.localName]=o.textContent)}return n}function eN(e,t){let n=new Qp;return n.data=e,n.properties=t,n.configureNameFromProperties(t),n.configureDescriptionFromProperties(t),n}function qft(e){let t=new XMLSerializer().serializeToString(e),n=document.createElement("div"),i=document.createElement("pre");i.textContent=t,n.appendChild(i);let o=new Qp;return o.data=e,o.description=n.innerHTML,[o]}var Yft=/<body>\s*<\/body>/im,Xft=/<ServiceExceptionReport([\s\S]*)<\/ServiceExceptionReport>/im,Kft=/<title>([\s\S]*)<\/title>/im;function Xye(e){if(Yft.test(e)||Xft.test(e))return;let t,n=Kft.exec(e);n&&n.length>1&&(t=n[1]);let i=new Qp;return i.name=t,i.description=e,i.data=e,[i]}var HD=Fft;function GD(e){e=y(e,y.EMPTY_OBJECT),A.typeOf.object("options.clock",e.clock),A.typeOf.object("options.times",e.times),A.typeOf.func("options.requestImageFunction",e.requestImageFunction),A.typeOf.func("options.reloadFunction",e.reloadFunction),this._tileCache={},this._tilesRequestedForInterval=[];let t=this._clock=e.clock;this._times=e.times,this._requestImageFunction=e.requestImageFunction,this._reloadFunction=e.reloadFunction,this._currentIntervalIndex=-1,t.onTick.addEventListener(this._clockOnTick,this),this._clockOnTick(t)}Object.defineProperties(GD.prototype,{clock:{get:function(){return this._clock},set:function(e){if(!c(e))throw new E("value is required.");this._clock!==e&&(this._clock=e,this._clockOnTick(e),this._reloadFunction())}},times:{get:function(){return this._times},set:function(e){if(!c(e))throw new E("value is required.");this._times!==e&&(this._times=e,this._clockOnTick(this._clock),this._reloadFunction())}},currentInterval:{get:function(){return this._times.get(this._currentIntervalIndex)}}});GD.prototype.getFromCache=function(e,t,n,i){let o=Kye(e,t,n),r,s=this._tileCache[this._currentIntervalIndex];if(c(s)&&c(s[o])){let a=s[o];r=a.promise.catch(function(l){throw i.state=a.request.state,l}),delete s[o]}return r};GD.prototype.checkApproachingInterval=function(e,t,n,i){let o=Kye(e,t,n),r=this._tilesRequestedForInterval,s=$ye(this),a={key:o,priorityFunction:i.priorityFunction};(!c(s)||!Zye(this,a,s))&&r.push(a),r.length>=512&&r.splice(0,256)};GD.prototype._clockOnTick=function(e){let t=e.currentTime,i=this._times.indexOf(t),o=this._currentIntervalIndex;if(i!==o){let s=this._tileCache[o];for(let a in s)s.hasOwnProperty(a)&&s[a].request.cancel();delete this._tileCache[o],this._tilesRequestedForInterval=[],this._currentIntervalIndex=i,this._reloadFunction();return}let r=$ye(this);if(c(r)){let s=this._tilesRequestedForInterval,a=!0;for(;a&&s.length!==0;){let l=s.pop();a=Zye(this,l,r),a||s.push(l)}}};function Kye(e,t,n){return`${e}-${t}-${n}`}function $ft(e){let t=e.split("-");if(t.length===3)return{x:Number(t[0]),y:Number(t[1]),level:Number(t[2])}}function $ye(e){let t=e._times;if(!c(t))return;let n=e._clock,i=n.currentTime,o=n.canAnimate&&n.shouldAnimate,r=n.multiplier;if(!o&&r!==0)return;let s,a=t.indexOf(i);if(a<0)return;let l=t.get(a);return r>0?(s=J.secondsDifference(l.stop,i),++a):(s=J.secondsDifference(l.start,i),--a),s/=r,a>=0&&s<=5?t.get(a):void 0}function Zye(e,t,n){let i=e._times.indexOf(n.start),o=e._tileCache,r=o[i];c(r)||(r=o[i]={});let s=t.key;if(c(r[s]))return!0;let a=$ft(s),l=new ur({throttle:!1,throttleByServer:!0,type:Es.IMAGERY,priorityFunction:t.priorityFunction}),u=e._requestImageFunction(a.x,a.y,a.level,l,n);return c(u)?(r[s]={promise:u,request:l},!0):!1}var jD=GD;var Zft=[3034,3035,3042,3043,3044],Jft=[4471,4559];function Gd(e){if(e=y(e,y.EMPTY_OBJECT),!c(e.url))throw new E("options.url is required.");if(!c(e.layers))throw new E("options.layers is required.");if(c(e.times)&&!c(e.clock))throw new E("options.times was specified, so options.clock is required.");this._defaultAlpha=void 0,this._defaultNightAlpha=void 0,this._defaultDayAlpha=void 0,this._defaultBrightness=void 0,this._defaultContrast=void 0,this._defaultHue=void 0,this._defaultSaturation=void 0,this._defaultGamma=void 0,this._defaultMinificationFilter=void 0,this._defaultMagnificationFilter=void 0,this._getFeatureInfoUrl=y(e.getFeatureInfoUrl,e.url);let t=De.createIfNeeded(e.url),n=De.createIfNeeded(this._getFeatureInfoUrl);t.setQueryParameters(Gd.DefaultParameters,!0),n.setQueryParameters(Gd.GetFeatureInfoDefaultParameters,!0),c(e.parameters)&&t.setQueryParameters(Jye(e.parameters)),c(e.getFeatureInfoParameters)&&n.setQueryParameters(Jye(e.getFeatureInfoParameters));let i=this;this._reload=void 0,c(e.times)&&(this._timeDynamicImagery=new jD({clock:e.clock,times:e.times,requestImageFunction:function(s,a,l,u,f){return Qye(i,s,a,l,u,f)},reloadFunction:function(){c(i._reload)&&i._reload()}}));let o={};if(o.layers=e.layers,o.bbox="{westProjected},{southProjected},{eastProjected},{northProjected}",o.width="{width}",o.height="{height}",parseFloat(t.queryParameters.version)>=1.3){o.crs=y(e.crs,e.tilingScheme&&e.tilingScheme.projection instanceof Li?"EPSG:3857":"CRS:84");let s=o.crs.split(":");if(s[0]==="EPSG"&&s.length===2){let a=Number(s[1]);(a>=4e3&&a<5e3&&!Jft.includes(a)||Zft.includes(a))&&(o.bbox="{southProjected},{westProjected},{northProjected},{eastProjected}")}}else o.srs=y(e.srs,e.tilingScheme&&e.tilingScheme.projection instanceof Li?"EPSG:3857":"EPSG:4326");t.setQueryParameters(o,!0),n.setQueryParameters(o,!0);let r={query_layers:e.layers,info_format:"{format}"};parseFloat(n.queryParameters.version)>=1.3?(r.i="{i}",r.j="{j}"):(r.x="{i}",r.y="{j}"),n.setQueryParameters(r,!0),this._resource=t,this._pickFeaturesResource=n,this._layers=e.layers,this._tileProvider=new Lc({url:t,pickFeaturesUrl:n,tilingScheme:y(e.tilingScheme,new $i({ellipsoid:e.ellipsoid})),rectangle:e.rectangle,tileWidth:e.tileWidth,tileHeight:e.tileHeight,minimumLevel:e.minimumLevel,maximumLevel:e.maximumLevel,subdomains:e.subdomains,tileDiscardPolicy:e.tileDiscardPolicy,credit:e.credit,getFeatureInfoFormats:y(e.getFeatureInfoFormats,Gd.DefaultGetFeatureInfoFormats),enablePickFeatures:e.enablePickFeatures})}function Qye(e,t,n,i,o,r){let s=c(r)?r.data:void 0,a=e._tileProvider;return c(s)&&a._resource.setQueryParameters(s),a.requestImage(t,n,i,o)}function Qft(e,t,n,i,o,r,s){let a=c(s)?s.data:void 0,l=e._tileProvider;return c(a)&&l._pickFeaturesResource.setQueryParameters(a),l.pickFeatures(t,n,i,o,r)}Object.defineProperties(Gd.prototype,{url:{get:function(){return this._resource._url}},proxy:{get:function(){return this._resource.proxy}},layers:{get:function(){return this._layers}},tileWidth:{get:function(){return this._tileProvider.tileWidth}},tileHeight:{get:function(){return this._tileProvider.tileHeight}},maximumLevel:{get:function(){return this._tileProvider.maximumLevel}},minimumLevel:{get:function(){return this._tileProvider.minimumLevel}},tilingScheme:{get:function(){return this._tileProvider.tilingScheme}},rectangle:{get:function(){return this._tileProvider.rectangle}},tileDiscardPolicy:{get:function(){return this._tileProvider.tileDiscardPolicy}},errorEvent:{get:function(){return this._tileProvider.errorEvent}},credit:{get:function(){return this._tileProvider.credit}},hasAlphaChannel:{get:function(){return this._tileProvider.hasAlphaChannel}},enablePickFeatures:{get:function(){return this._tileProvider.enablePickFeatures},set:function(e){this._tileProvider.enablePickFeatures=e}},clock:{get:function(){return this._timeDynamicImagery.clock},set:function(e){this._timeDynamicImagery.clock=e}},times:{get:function(){return this._timeDynamicImagery.times},set:function(e){this._timeDynamicImagery.times=e}},getFeatureInfoUrl:{get:function(){return this._getFeatureInfoUrl}}});Gd.prototype.getTileCredits=function(e,t,n){return this._tileProvider.getTileCredits(e,t,n)};Gd.prototype.requestImage=function(e,t,n,i){let o,r=this._timeDynamicImagery,s;return c(r)&&(s=r.currentInterval,o=r.getFromCache(e,t,n,i)),c(o)||(o=Qye(this,e,t,n,i,s)),c(o)&&c(r)&&r.checkApproachingInterval(e,t,n,i),o};Gd.prototype.pickFeatures=function(e,t,n,i,o){let r=this._timeDynamicImagery,s=c(r)?r.currentInterval:void 0;return Qft(this,e,t,n,i,o,s)};Gd.DefaultParameters=Object.freeze({service:"WMS",version:"1.1.1",request:"GetMap",styles:"",format:"image/jpeg"});Gd.GetFeatureInfoDefaultParameters=Object.freeze({service:"WMS",version:"1.1.1",request:"GetFeatureInfo"});Gd.DefaultGetFeatureInfoFormats=Object.freeze([Object.freeze(new HD("json","application/json")),Object.freeze(new HD("xml","text/xml")),Object.freeze(new HD("text","text/html"))]);function Jye(e){let t={};for(let n in e)e.hasOwnProperty(n)&&(t[n.toLowerCase()]=e[n]);return t}var T7=Gd;var edt=Object.freeze({service:"WMTS",version:"1.0.0",request:"GetTile"});function WD(e){if(e=y(e,y.EMPTY_OBJECT),!c(e.url))throw new E("options.url is required.");if(!c(e.layer))throw new E("options.layer is required.");if(!c(e.style))throw new E("options.style is required.");if(!c(e.tileMatrixSetID))throw new E("options.tileMatrixSetID is required.");if(c(e.times)&&!c(e.clock))throw new E("options.times was specified, so options.clock is required.");this._defaultAlpha=void 0,this._defaultNightAlpha=void 0,this._defaultDayAlpha=void 0,this._defaultBrightness=void 0,this._defaultContrast=void 0,this._defaultHue=void 0,this._defaultSaturation=void 0,this._defaultGamma=void 0,this._defaultMinificationFilter=void 0,this._defaultMagnificationFilter=void 0;let t=De.createIfNeeded(e.url),n=e.style,i=e.tileMatrixSetID,o=t.url,r=o.match(/{/g);if(!c(r)||r.length===1&&/{s}/.test(o))t.setQueryParameters(edt),this._useKvp=!0;else{let d={style:n,Style:n,TileMatrixSet:i};t.setTemplateValues(d),this._useKvp=!1}this._resource=t,this._layer=e.layer,this._style=n,this._tileMatrixSetID=i,this._tileMatrixLabels=e.tileMatrixLabels,this._format=y(e.format,"image/jpeg"),this._tileDiscardPolicy=e.tileDiscardPolicy,this._tilingScheme=c(e.tilingScheme)?e.tilingScheme:new ys({ellipsoid:e.ellipsoid}),this._tileWidth=y(e.tileWidth,256),this._tileHeight=y(e.tileHeight,256),this._minimumLevel=y(e.minimumLevel,0),this._maximumLevel=e.maximumLevel,this._rectangle=y(e.rectangle,this._tilingScheme.rectangle),this._dimensions=e.dimensions;let s=this;this._reload=void 0,c(e.times)&&(this._timeDynamicImagery=new jD({clock:e.clock,times:e.times,requestImageFunction:function(d,p,g,m,b){return e0e(s,d,p,g,m,b)},reloadFunction:function(){c(s._reload)&&s._reload()}}));let a=this._tilingScheme.positionToTileXY(ae.southwest(this._rectangle),this._minimumLevel),l=this._tilingScheme.positionToTileXY(ae.northeast(this._rectangle),this._minimumLevel),u=(Math.abs(l.x-a.x)+1)*(Math.abs(l.y-a.y)+1);if(u>4)throw new E(`The imagery provider's rectangle and minimumLevel indicate that there are ${u} tiles at the minimum level. Imagery providers with more than four tiles at the minimum level are not supported.`);this._errorEvent=new pe;let f=e.credit;this._credit=typeof f=="string"?new Pt(f):f,this._subdomains=e.subdomains,Array.isArray(this._subdomains)?this._subdomains=this._subdomains.slice():c(this._subdomains)&&this._subdomains.length>0?this._subdomains=this._subdomains.split(""):this._subdomains=["a","b","c"]}function e0e(e,t,n,i,o,r){let s=e._tileMatrixLabels,a=c(s)?s[i]:i.toString(),l=e._subdomains,u=e._dimensions,f=c(r)?r.data:void 0,d,p;if(!e._useKvp)p={TileMatrix:a,TileRow:n.toString(),TileCol:t.toString(),s:l[(t+n+i)%l.length]},d=e._resource.getDerivedResource({request:o}),d.setTemplateValues(p),c(u)&&d.setTemplateValues(u),c(f)&&d.setTemplateValues(f);else{let g={};g.tilematrix=a,g.layer=e._layer,g.style=e._style,g.tilerow=n,g.tilecol=t,g.tilematrixset=e._tileMatrixSetID,g.format=e._format,c(u)&&(g=At(g,u)),c(f)&&(g=At(g,f)),p={s:l[(t+n+i)%l.length]},d=e._resource.getDerivedResource({queryParameters:g,request:o}),d.setTemplateValues(p)}return mu.loadImage(e,d)}Object.defineProperties(WD.prototype,{url:{get:function(){return this._resource.url}},proxy:{get:function(){return this._resource.proxy}},tileWidth:{get:function(){return this._tileWidth}},tileHeight:{get:function(){return this._tileHeight}},maximumLevel:{get:function(){return this._maximumLevel}},minimumLevel:{get:function(){return this._minimumLevel}},tilingScheme:{get:function(){return this._tilingScheme}},rectangle:{get:function(){return this._rectangle}},tileDiscardPolicy:{get:function(){return this._tileDiscardPolicy}},errorEvent:{get:function(){return this._errorEvent}},format:{get:function(){return this._format}},credit:{get:function(){return this._credit}},hasAlphaChannel:{get:function(){return!0}},clock:{get:function(){return this._timeDynamicImagery.clock},set:function(e){this._timeDynamicImagery.clock=e}},times:{get:function(){return this._timeDynamicImagery.times},set:function(e){this._timeDynamicImagery.times=e}},dimensions:{get:function(){return this._dimensions},set:function(e){this._dimensions!==e&&(this._dimensions=e,c(this._reload)&&this._reload())}}});WD.prototype.getTileCredits=function(e,t,n){};WD.prototype.requestImage=function(e,t,n,i){let o,r=this._timeDynamicImagery,s;return c(r)&&(s=r.currentInterval,o=r.getFromCache(e,t,n,i)),c(o)||(o=e0e(this,e,t,n,i,s)),c(o)&&c(r)&&r.checkApproachingInterval(e,t,n,i),o};WD.prototype.pickFeatures=function(e,t,n,i,o){};var A7=WD;var tdt={ARCGIS_MAPSERVER:sy.fromUrl,BING:async(e,t)=>fq.fromUrl(e,t),GOOGLE_EARTH:async(e,t)=>{let n=t.channel;return delete t.channel,p7.fromUrl(e,n,t)},MAPBOX:(e,t)=>new _7({url:e,...t}),SINGLE_TILE:y7.fromUrl,TMS:jb.fromUrl,URL_TEMPLATE:(e,t)=>new Lc({url:e,...t}),WMS:(e,t)=>new T7({url:e,...t}),WMTS:(e,t)=>new A7({url:e,...t})};function am(e){e=y(e,y.EMPTY_OBJECT),this._defaultAlpha=void 0,this._defaultNightAlpha=void 0,this._defaultDayAlpha=void 0,this._defaultBrightness=void 0,this._defaultContrast=void 0,this._defaultHue=void 0,this._defaultSaturation=void 0,this._defaultGamma=void 0,this._defaultMinificationFilter=void 0,this._defaultMagnificationFilter=void 0,this._tileCredits=void 0,this._errorEvent=new pe}Object.defineProperties(am.prototype,{rectangle:{get:function(){return this._imageryProvider.rectangle}},tileWidth:{get:function(){return this._imageryProvider.tileWidth}},tileHeight:{get:function(){return this._imageryProvider.tileHeight}},maximumLevel:{get:function(){return this._imageryProvider.maximumLevel}},minimumLevel:{get:function(){return this._imageryProvider.minimumLevel}},tilingScheme:{get:function(){return this._imageryProvider.tilingScheme}},tileDiscardPolicy:{get:function(){return this._imageryProvider.tileDiscardPolicy}},errorEvent:{get:function(){return this._errorEvent}},credit:{get:function(){return this._imageryProvider.credit}},hasAlphaChannel:{get:function(){return this._imageryProvider.hasAlphaChannel}},proxy:{get:function(){}}});am.fromAssetId=async function(e,t){A.typeOf.number("assetId",e),t=y(t,y.EMPTY_OBJECT);let n=Xf._createEndpointResource(e,t),i=e.toString()+t.accessToken+t.server,o=am._endpointCache[i];c(o)||(o=n.fetchJson(),am._endpointCache[i]=o);let r=await o;if(r.type!=="IMAGERY")throw new ue(`Cesium ion asset ${e} is not an imagery asset.`);let s,a=r.externalType;if(!c(a))s=await jb.fromUrl(new Xf(r,n));else{let u=tdt[a];if(!c(u))throw new ue(`Unrecognized Cesium ion imagery type: ${a}`);let f={...r.options},d=f.url;delete f.url,s=await u(d,f)}let l=new am(t);return s.errorEvent.addEventListener(function(u){u.provider=l,l._errorEvent.raiseEvent(u)}),l._tileCredits=Xf.getCreditsFromEndpoint(r,n),l._imageryProvider=s,l};am.prototype.getTileCredits=function(e,t,n){let i=this._imageryProvider.getTileCredits(e,t,n);return c(i)?this._tileCredits.concat(i):this._tileCredits};am.prototype.requestImage=function(e,t,n,i){return this._imageryProvider.requestImage(e,t,n,i)};am.prototype.pickFeatures=function(e,t,n,i,o){return this._imageryProvider.pickFeatures(e,t,n,i,o)};am._endpointCache={};var fy=am;var ndt={AERIAL:2,AERIAL_WITH_LABELS:3,ROAD:4},dy=Object.freeze(ndt);function idt(e){e=y(e,y.EMPTY_OBJECT);let t=y(e.style,dy.AERIAL);return fy.fromAssetId(t)}var hy=idt;var r0e=Ur(Pl(),1),t0e=576,odt=100,qD="#ffffff",tN="#48b";function s0e(e,t){this.credit=e,this.count=y(t,1)}function rdt(e,t){let n=e.length;for(let i=0;i<n;i++){let o=e[i];if(Pt.equals(o,t))return!0}return!1}function sdt(e){let t=e._previousCesiumCredit,n=e._currentCesiumCredit;Pt.equals(n,t)||(c(t)&&e._cesiumCreditContainer.removeChild(t.element),c(n)&&e._cesiumCreditContainer.appendChild(n.element),e._previousCesiumCredit=n)}var a0e="cesium-credit-delimiter";function n0e(e){let t=document.createElement("span");return t.textContent=e,t.className=a0e,t}function i0e(e,t){if(c(t)){let n=document.createElement(t);n._creditId=e._creditId,n.appendChild(e),e=n}return e}function o0e(e,t,n,i){let o=e.childNodes,r=-1;t.sort(function(s,a){return a.count-s.count});for(let s=0;s<t.length;++s){let a=t[s].credit;if(c(a)){if(r=s,c(n)&&(r*=2,s>0)){let u=r-1;if(o.length<=u)e.appendChild(n0e(n));else{let f=o[u];f.className!==a0e&&e.replaceChild(n0e(n),f)}}let l=a.element;if(o.length<=r)e.appendChild(i0e(l,i));else{let u=o[r];u._creditId!==a._id&&e.replaceChild(i0e(l,i),u)}}}for(++r;r<o.length;)e.removeChild(o[r])}function adt(e){let t=e._lightboxCredits,n=e.viewport.clientWidth,i=e.viewport.clientHeight;n!==e._lastViewportWidth&&(n<t0e?(t.className="cesium-credit-lightbox cesium-credit-lightbox-mobile",t.style.marginTop="0"):(t.className="cesium-credit-lightbox cesium-credit-lightbox-expanded",t.style.marginTop=`${Math.floor((i-t.clientHeight)*.5)}px`),e._lastViewportWidth=n),n>=t0e&&i!==e._lastViewportHeight&&(t.style.marginTop=`${Math.floor((i-t.clientHeight)*.5)}px`,e._lastViewportHeight=i)}function cdt(e){let t=`
.cesium-credit-lightbox-overlay {
  display: none;
  z-index: 1;
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(80, 80, 80, 0.8);
}

.cesium-credit-lightbox {
  background-color: #303336;
  color: ${qD};
  position: relative;
  min-height: ${odt}px;
  margin: auto;
}
.cesium-credit-lightbox > ul > li a,
.cesium-credit-lightbox > ul > li a:visited,
.cesium-credit-wrapper a,
.cesium-credit-wrapper a:visited {
  color: ${qD};
}
.cesium-credit-lightbox > ul > li a:hover {
  color: ${tN};
}
.cesium-credit-lightbox.cesium-credit-lightbox-expanded {
  border: 1px solid #444;
  border-radius: 5px;
  max-width: 370px;
}
.cesium-credit-lightbox.cesium-credit-lightbox-mobile {
  height: 100%;
  width: 100%;
}
.cesium-credit-lightbox-title {
  padding: 20px 20px 0 20px;
}
.cesium-credit-lightbox-close {
  font-size: 18pt;
  cursor: pointer;
  position: absolute;
  top: 0;
  right: 6px;
  color: ${qD};
}
.cesium-credit-lightbox-close:hover {
  color: ${tN};
}
.cesium-credit-lightbox > ul {
  margin: 0;
  padding: 12px 20px 12px 40px;
  font-size: 13px;
}
.cesium-credit-lightbox > ul > li {
  padding-bottom: 6px;
}
.cesium-credit-lightbox > ul > li * {
  padding: 0;
  margin: 0;
}

.cesium-credit-expand-link {
  padding-left: 5px;
  cursor: pointer;
  text-decoration: underline;
  color: ${qD};
}
.cesium-credit-expand-link:hover {
  color: ${tN};
}

.cesium-credit-text {
  color: ${qD};
}

.cesium-credit-delimiter {
  padding: 0 5px;
}

.cesium-credit-textContainer *,
.cesium-credit-logoContainer * {
  display: inline;
}

.cesium-credit-textContainer a:hover {
  color: ${tN}
}

.cesium-credit-textContainer .cesium-credit-wrapper:first-of-type {
  padding-left: 5px;
}
`;function n(r){if(r.shadowRoot)return r.shadowRoot;if(r.getRootNode){let s=r.getRootNode();if(s instanceof ShadowRoot)return s}}let i=y(n(e),document.head),o=document.createElement("style");o.innerHTML=t,i.appendChild(o)}function cr(e,t,n){A.defined("container",e);let i=this;n=y(n,document.body);let o=document.createElement("div");o.className="cesium-credit-lightbox-overlay",n.appendChild(o);let r=document.createElement("div");r.className="cesium-credit-lightbox",o.appendChild(r);function s(m){r.contains(m.target)||i.hideLightbox()}o.addEventListener("click",s,!1);let a=document.createElement("div");a.className="cesium-credit-lightbox-title",a.textContent="Data provided by:",r.appendChild(a);let l=document.createElement("a");l.onclick=this.hideLightbox.bind(this),l.innerHTML="&times;",l.className="cesium-credit-lightbox-close",r.appendChild(l);let u=document.createElement("ul");r.appendChild(u);let f=document.createElement("div");f.className="cesium-credit-logoContainer",f.style.display="inline",e.appendChild(f);let d=document.createElement("div");d.className="cesium-credit-textContainer",d.style.display="inline",e.appendChild(d);let p=document.createElement("a");p.className="cesium-credit-expand-link",p.onclick=this.showLightbox.bind(this),p.textContent="Data attribution",e.appendChild(p),cdt(e);let g=Pt.clone(cr.cesiumCredit);this._delimiter=y(t,"\u2022"),this._screenContainer=d,this._cesiumCreditContainer=f,this._lastViewportHeight=void 0,this._lastViewportWidth=void 0,this._lightboxCredits=r,this._creditList=u,this._lightbox=o,this._hideLightbox=s,this._expandLink=p,this._expanded=!1,this._staticCredits=[],this._cesiumCredit=g,this._previousCesiumCredit=void 0,this._currentCesiumCredit=g,this._creditDisplayElementPool=[],this._creditDisplayElementIndex=0,this._currentFrameCredits={screenCredits:new St,lightboxCredits:new St},this._defaultCredit=void 0,this.viewport=n,this.container=e}function c0e(e,t,n,i){i=y(i,1);let o=t.get(n.id);if(c(o))o.count<Number.MAX_VALUE&&(o.count+=i);else{let r=e._creditDisplayElementPool,s=e._creditDisplayElementPoolIndex;s<r.length?(o=r[s],o.credit=n,o.count=i):(o=new s0e(n,i),r.push(o)),++e._creditDisplayElementPoolIndex,t.set(n.id,o)}}cr.prototype.addCreditToNextFrame=function(e){if(A.defined("credit",e),e.isIon()){c(this._defaultCredit)||(this._defaultCredit=Pt.clone(l0e())),this._currentCesiumCredit=this._defaultCredit;return}let t;e.showOnScreen?t=this._currentFrameCredits.screenCredits:t=this._currentFrameCredits.lightboxCredits,c0e(this,t,e)};cr.prototype.addStaticCredit=function(e){A.defined("credit",e);let t=this._staticCredits;rdt(t,e)||t.push(e)};cr.prototype.removeStaticCredit=function(e){A.defined("credit",e);let t=this._staticCredits,n=t.indexOf(e);n!==-1&&t.splice(n,1)};cr.prototype.showLightbox=function(){this._lightbox.style.display="block",this._expanded=!0};cr.prototype.hideLightbox=function(){this._lightbox.style.display="none",this._expanded=!1};cr.prototype.update=function(){this._expanded&&adt(this)};cr.prototype.beginFrame=function(){let e=this._currentFrameCredits;this._creditDisplayElementPoolIndex=0;let t=e.screenCredits,n=e.lightboxCredits;t.removeAll(),n.removeAll();let i=this._staticCredits;for(let o=0;o<i.length;++o){let r=i[o],s=r.showOnScreen?t:n;r.isIon()&&Pt.equals(cr.cesiumCredit,this._cesiumCredit)||c0e(this,s,r,Number.MAX_VALUE)}Pt.equals(cr.cesiumCredit,this._cesiumCredit)||(this._cesiumCredit=Pt.clone(cr.cesiumCredit)),this._currentCesiumCredit=this._cesiumCredit};cr.prototype.endFrame=function(){let e=this._currentFrameCredits.screenCredits.values;o0e(this._screenContainer,e,this._delimiter,void 0);let t=this._currentFrameCredits.lightboxCredits.values;this._expandLink.style.display=t.length>0?"inline":"none",o0e(this._creditList,t,void 0,"li"),sdt(this)};cr.prototype.destroy=function(){return this._lightbox.removeEventListener("click",this._hideLightbox,!1),this.container.removeChild(this._cesiumCreditContainer),this.container.removeChild(this._screenContainer),this.container.removeChild(this._expandLink),this.viewport.removeChild(this._lightbox),de(this)};cr.prototype.isDestroyed=function(){return!1};cr._cesiumCredit=void 0;cr._cesiumCreditInitialized=!1;var nN;function l0e(){if(!c(nN)){let e=sn("Assets/Images/ion-credit.png");e.indexOf("http://")!==0&&e.indexOf("https://")!==0&&e.indexOf("data:")!==0&&(e=new r0e.default(e).path()),nN=new Pt(`<a href="https://cesium.com/" target="_blank"><img src="${e}" style="vertical-align: -7px" title="Cesium ion"/></a>`,!0)}return cr._cesiumCreditInitialized||(cr._cesiumCredit=nN,cr._cesiumCreditInitialized=!0),nN}Object.defineProperties(cr,{cesiumCredit:{get:function(){return l0e(),cr._cesiumCredit},set:function(e){cr._cesiumCredit=e,cr._cesiumCreditInitialized=!0}}});cr.CreditDisplayElement=s0e;var C7=cr;function YD(e){e=y(e,y.EMPTY_OBJECT);let t=e.attributeName,n=e.perInstanceAttribute;if(!c(t))throw new E("options.attributeName is required.");c(n)||(n=!1);let i=y(e.glslDatatype,"vec3"),o=`v_${t}`,r;if(t==="normal"||t==="tangent"||t==="bitangent")r=`vec4 getColor() { return vec4((${o} + vec3(1.0)) * 0.5, 1.0); }
`;else switch(t==="st"&&(i="vec2"),i){case"float":r=`vec4 getColor() { return vec4(vec3(${o}), 1.0); }
`;break;case"vec2":r=`vec4 getColor() { return vec4(${o}, 0.0, 1.0); }
`;break;case"vec3":r=`vec4 getColor() { return vec4(${o}, 1.0); }
`;break;case"vec4":r=`vec4 getColor() { return ${o}; }
`;break;default:throw new E("options.glslDatatype must be float, vec2, vec3, or vec4.")}let s=`in vec3 position3DHigh;
in vec3 position3DLow;
in float batchId;
${n?"":`in ${i} ${t};
`}out ${i} ${o};
void main()
{
vec4 p = czm_translateRelativeToEye(position3DHigh, position3DLow);
${n?`${o} = czm_batchTable_${t}(batchId);
`:`${o} = ${t};
`}gl_Position = czm_modelViewProjectionRelativeToEye * p;
}`,a=`in ${i} ${o};
${r}
void main()
{
out_FragColor = getColor();
}`;this.material=void 0,this.translucent=y(e.translucent,!1),this._vertexShaderSource=y(e.vertexShaderSource,s),this._fragmentShaderSource=y(e.fragmentShaderSource,a),this._renderState=io.getDefaultRenderState(!1,!1,e.renderState),this._closed=y(e.closed,!1),this._attributeName=t,this._glslDatatype=i}Object.defineProperties(YD.prototype,{vertexShaderSource:{get:function(){return this._vertexShaderSource}},fragmentShaderSource:{get:function(){return this._fragmentShaderSource}},renderState:{get:function(){return this._renderState}},closed:{get:function(){return this._closed}},attributeName:{get:function(){return this._attributeName}},glslDatatype:{get:function(){return this._glslDatatype}}});YD.prototype.getFragmentShaderSource=io.prototype.getFragmentShaderSource;YD.prototype.isTranslucent=io.prototype.isTranslucent;YD.prototype.getRenderState=io.prototype.getRenderState;var ldt=YD;function iN(e){if(e=y(e,y.EMPTY_OBJECT),!c(e.camera))throw new E("options.camera is required.");this._camera=e.camera,this._frustumSplits=e.frustumSplits,this._color=y(e.color,j.CYAN),this._updateOnChange=y(e.updateOnChange,!0),this.show=y(e.show,!0),this.id=e.id,this._id=void 0,this._outlinePrimitives=[],this._planesPrimitives=[]}var udt=new h,fdt=new Q,ddt=new Ne,hdt=new vi,mdt=new lu,pdt=new rn,_dt=new er,gdt=new j,ydt=[1,1e5];iN.prototype.update=function(e){if(!this.show)return;let t=this._planesPrimitives,n=this._outlinePrimitives,i,o;if(this._updateOnChange){for(o=t.length,i=0;i<o;++i)n[i]=n[i]&&n[i].destroy(),t[i]=t[i]&&t[i].destroy();t.length=0,n.length=0}if(t.length===0){let r=this._camera,s=r.frustum,a;s instanceof vi?a=hdt:s instanceof lu?a=mdt:s instanceof rn?a=pdt:a=_dt,a=s.clone(a);let l,u=this._frustumSplits;!c(u)||u.length<=1?(u=ydt,u[0]=this._camera.frustum.near,u[1]=this._camera.frustum.far,l=1):l=u.length-1;let f=r.positionWC,d=r.directionWC,p=r.upWC,g=r.rightWC;g=h.negate(g,udt);let m=fdt;Q.setColumn(m,0,g,m),Q.setColumn(m,1,p,m),Q.setColumn(m,2,d,m);let b=Ne.fromRotationMatrix(m,ddt);for(t.length=n.length=l,i=0;i<l;++i)a.near=u[i],a.far=u[i+1],t[i]=new Rn({geometryInstances:new vt({geometry:new bD({origin:f,orientation:b,frustum:a,_drawNearPlane:i===0}),attributes:{color:Wt.fromColor(j.fromAlpha(this._color,.1,gdt))},id:this.id,pickPrimitive:this}),appearance:new ln({translucent:!0,flat:!0}),asynchronous:!1}),n[i]=new Rn({geometryInstances:new vt({geometry:new hW({origin:f,orientation:b,frustum:a,_drawNearPlane:i===0}),attributes:{color:Wt.fromColor(this._color)},id:this.id,pickPrimitive:this}),appearance:new ln({translucent:!1,flat:!0}),asynchronous:!1})}for(o=t.length,i=0;i<o;++i)n[i].update(e),t[i].update(e)};iN.prototype.isDestroyed=function(){return!1};iN.prototype.destroy=function(){let e=this._planesPrimitives.length;for(let t=0;t<e;++t)this._outlinePrimitives[t]=this._outlinePrimitives[t]&&this._outlinePrimitives[t].destroy(),this._planesPrimitives[t]=this._planesPrimitives[t]&&this._planesPrimitives[t].destroy();return de(this)};var my=iN;function u0e(){this._cachedShowFrustumsShaders={}}function bdt(e){let t={},n=e.vertexAttributes;for(let i in n)n.hasOwnProperty(i)&&(t[i]=n[i].index);return t}function xdt(e,t){let n=e.context,i=t,o=i.fragmentShaderSource.clone(),r=[];o.sources=o.sources.map(function(f){f=Ge.replaceMain(f,"czm_Debug_main");let d=/out_FragData_(\d+)/g,p;for(;(p=d.exec(f))!==null;)r.indexOf(p[1])===-1&&r.push(p[1]);return f});let s=r.length,a="";a+=`uniform vec3 debugShowCommandsColor;
`,a+=`uniform vec3 debugShowFrustumsColor;
`,a+=`void main() 
{ 
    czm_Debug_main(); 
`;let l;if(s>0)for(l=0;l<s;++l)a+=`    out_FragData_${r[l]}.rgb *= debugShowCommandsColor;
`,a+=`    out_FragData_${r[l]}.rgb *= debugShowFrustumsColor;
`;else a+=`    out_FragColor.rgb *= debugShowCommandsColor;
`,a+=`    out_FragColor.rgb *= debugShowFrustumsColor;
`;a+="}",o.sources.push(a);let u=bdt(i);return an.fromCache({context:n,vertexShaderSource:i.vertexShaderSource,fragmentShaderSource:o,attributeLocations:u})}var XD=new j;function Tdt(e,t){let n;return c(t.uniformMap)?n=t.uniformMap:n={},c(n.debugShowCommandsColor)||c(n.debugShowFrustumsColor)||(n.debugShowCommandsColor=function(){return e.debugShowCommands?(c(t._debugColor)||(t._debugColor=j.fromRandom()),t._debugColor):j.WHITE},n.debugShowFrustumsColor=function(){return e.debugShowFrustums?(XD.red=t.debugOverlappingFrustums&1?1:0,XD.green=t.debugOverlappingFrustums&2?1:0,XD.blue=t.debugOverlappingFrustums&4?1:0,XD.alpha=1,XD):j.WHITE}),n}var Adt=new et;u0e.prototype.executeDebugShowFrustumsCommand=function(e,t,n){let i=t.shaderProgram.id,o=this._cachedShowFrustumsShaders[i];c(o)||(o=xdt(e,t.shaderProgram),this._cachedShowFrustumsShaders[i]=o);let r=et.shallowClone(t,Adt);r.shaderProgram=o,r.uniformMap=Tdt(e,t),r.execute(e.context,n)};var E7=u0e;function oN(e){e=y(e,y.EMPTY_OBJECT),this.length=y(e.length,1e7),this._length=void 0,this.width=y(e.width,2),this._width=void 0,this.show=y(e.show,!0),this.modelMatrix=k.clone(y(e.modelMatrix,k.IDENTITY)),this._modelMatrix=new k,this.id=e.id,this._id=void 0,this._primitive=void 0}oN.prototype.update=function(e){if(this.show){if(!c(this._primitive)||!k.equals(this._modelMatrix,this.modelMatrix)||this._length!==this.length||this._width!==this.width||this._id!==this.id){this._modelMatrix=k.clone(this.modelMatrix,this._modelMatrix),this._length=this.length,this._width=this.width,this._id=this.id,c(this._primitive)&&this._primitive.destroy(),this.modelMatrix[12]===0&&this.modelMatrix[13]===0&&this.modelMatrix[14]===0&&(this.modelMatrix[14]=.01);let t=new vt({geometry:new yb({positions:[h.ZERO,h.UNIT_X],width:this.width,vertexFormat:us.VERTEX_FORMAT,colors:[j.RED,j.RED],arcType:Yt.NONE}),modelMatrix:k.multiplyByUniformScale(this.modelMatrix,this.length,new k),id:this.id,pickPrimitive:this}),n=new vt({geometry:new yb({positions:[h.ZERO,h.UNIT_Y],width:this.width,vertexFormat:us.VERTEX_FORMAT,colors:[j.GREEN,j.GREEN],arcType:Yt.NONE}),modelMatrix:k.multiplyByUniformScale(this.modelMatrix,this.length,new k),id:this.id,pickPrimitive:this}),i=new vt({geometry:new yb({positions:[h.ZERO,h.UNIT_Z],width:this.width,vertexFormat:us.VERTEX_FORMAT,colors:[j.BLUE,j.BLUE],arcType:Yt.NONE}),modelMatrix:k.multiplyByUniformScale(this.modelMatrix,this.length,new k),id:this.id,pickPrimitive:this});this._primitive=new Rn({geometryInstances:[t,n,i],appearance:new us,asynchronous:!1})}this._primitive.update(e)}};oN.prototype.isDestroyed=function(){return!1};oN.prototype.destroy=function(){return this._primitive=this._primitive&&this._primitive.destroy(),de(this)};var rN=oN;var S7=`in vec4 positionEC;
void main()
{
vec3 position;
vec3 direction;
if (czm_orthographicIn3D == 1.0)
{
vec2 uv = (gl_FragCoord.xy -  czm_viewport.xy) / czm_viewport.zw;
vec2 minPlane = vec2(czm_frustumPlanes.z, czm_frustumPlanes.y);
vec2 maxPlane = vec2(czm_frustumPlanes.w, czm_frustumPlanes.x);
position = vec3(mix(minPlane, maxPlane, uv), 0.0);
direction = vec3(0.0, 0.0, -1.0);
}
else
{
position = vec3(0.0);
direction = normalize(positionEC.xyz);
}
czm_ray ray = czm_ray(position, direction);
vec3 ellipsoid_center = czm_view[3].xyz;
czm_raySegment intersection = czm_rayEllipsoidIntersectionInterval(ray, ellipsoid_center, czm_ellipsoidInverseRadii);
if (!czm_isEmpty(intersection))
{
out_FragColor = vec4(1.0, 1.0, 0.0, 1.0);
}
else
{
discard;
}
czm_writeLogDepth();
}
`;var w7=`in vec4 position;
out vec4 positionEC;
void main()
{
positionEC = czm_modelView * position;
gl_Position = czm_modelViewProjection * position;
czm_vertexLogDepth();
}
`;function $D(e){this._rs=void 0,this._sp=void 0,this._va=void 0,this._command=void 0,this._mode=void 0,this._useLogDepth=!1,this._ellipsoidOffset=y(e,0)}var KD=zt.supportsTypedArrays()?new Float32Array(12):[],f0e=new h,d0e=new h,v7=new h,h0e=new h,sN=new h;function Cdt(e,t){let n=e.radii,i=t.camera,o,r,s;if(i.frustum instanceof rn)o=h.ZERO,r=i.rightWC,s=i.upWC;else{let d=i.positionWC,p=h.multiplyComponents(e.oneOverRadii,d,f0e),g=h.normalize(p,d0e),m=h.normalize(h.cross(h.UNIT_Z,p,v7),v7),b=h.normalize(h.cross(g,m,h0e),h0e),x=h.magnitude(p),T=Math.sqrt(x*x-1);o=h.multiplyByScalar(g,1/x,f0e);let C=T/x;r=h.multiplyByScalar(m,C,d0e),s=h.multiplyByScalar(b,C,v7)}let a=h.add(o,s,sN);h.subtract(a,r,a),h.multiplyComponents(n,a,a),h.pack(a,KD,0);let l=h.subtract(o,s,sN);h.subtract(l,r,l),h.multiplyComponents(n,l,l),h.pack(l,KD,3);let u=h.add(o,s,sN);h.add(u,r,u),h.multiplyComponents(n,u,u),h.pack(u,KD,6);let f=h.subtract(o,s,sN);return h.add(f,r,f),h.multiplyComponents(n,f,f),h.pack(f,KD,9),KD}$D.prototype.update=function(e){if(this._mode=e.mode,e.mode!==oe.SCENE3D)return;let t=e.context,n=e.mapProjection.ellipsoid.radii,i=new ie(n.x+this._ellipsoidOffset,n.y+this._ellipsoidOffset,n.z+this._ellipsoidOffset),o=e.useLogDepth;if(c(this._command)||(this._rs=ze.fromCache({cull:{enabled:!0},depthTest:{enabled:!0},colorMask:{red:!1,green:!1,blue:!1,alpha:!1}}),this._command=new et({renderState:this._rs,boundingVolume:new ce(h.ZERO,i.maximumRadius),pass:ve.OPAQUE,owner:this})),!c(this._sp)||this._useLogDepth!==o){this._useLogDepth=o;let s=new Ge({sources:[w7]}),a=new Ge({sources:[S7]});o&&(a.defines.push("LOG_DEPTH"),s.defines.push("LOG_DEPTH")),this._sp=an.replaceCache({shaderProgram:this._sp,context:t,vertexShaderSource:s,fragmentShaderSource:a,attributeLocations:{position:0}}),this._command.shaderProgram=this._sp}let r=Cdt(i,e);if(c(this._va))this._va.getAttribute(0).vertexBuffer.copyFromArrayView(r);else{let s=new ut({attributes:{position:new we({componentDatatype:$.FLOAT,componentsPerAttribute:3,values:r})},indices:[0,1,2,2,1,3],primitiveType:Me.TRIANGLES});this._va=ni.fromGeometry({context:t,geometry:s,attributeLocations:{position:0},bufferUsage:ke.DYNAMIC_DRAW}),this._command.vertexArray=this._va}};$D.prototype.execute=function(e,t){this._mode===oe.SCENE3D&&this._command.execute(e,t)};$D.prototype.isDestroyed=function(){return!1};$D.prototype.destroy=function(){this._sp=this._sp&&this._sp.destroy(),this._va=this._va&&this._va.destroy()};var D7=$D;function DC(){}var Edt=/\bgl_FragDepth\b/,Sdt=/\bdiscard\b/;function wdt(e,t){let n=e.shaderCache.getDerivedShaderProgram(t,"depthOnly");if(c(n))return n;let i=t.fragmentShaderSource,o=!1,r=i.sources;for(let a=0;a<r.length;++a)if(Edt.test(r[a])||Sdt.test(r[a])){o=!0;break}let s=i.defines.indexOf("LOG_DEPTH")>=0;if(!o&&!s){let a=`void main()
{
    out_FragColor = vec4(1.0);
}
`;i=new Ge({sources:[a]})}else if(!o&&s){let a=`void main()
{
    out_FragColor = vec4(1.0);
    czm_writeLogDepth();
}
`;i=new Ge({defines:["LOG_DEPTH"],sources:[a]})}return e.shaderCache.createDerivedShaderProgram(t,"depthOnly",{vertexShaderSource:t.vertexShaderSource,fragmentShaderSource:i,attributeLocations:t._attributeLocations})}function vdt(e,t){let n=e._depthOnlyRenderStateCache,i=n[t.id];if(c(i))return i;let o=ze.getState(t);o.depthMask=!0,o.colorMask={red:!1,green:!1,blue:!1,alpha:!1};let r=ze.fromCache(o);return n[t.id]=r,r}DC.createDepthOnlyDerivedCommand=function(e,t,n,i){c(i)||(i={});let o=i.depthOnlyCommand?.shaderProgram,r=i.depthOnlyCommand?.renderState;return i.depthOnlyCommand=et.shallowClone(t,i.depthOnlyCommand),!c(o)||i.shaderProgramId!==t.shaderProgram.id?(i.depthOnlyCommand.shaderProgram=wdt(n,t.shaderProgram),i.depthOnlyCommand.renderState=vdt(e,t.renderState),i.shaderProgramId=t.shaderProgram.id):(i.depthOnlyCommand.shaderProgram=o,i.depthOnlyCommand.renderState=r),i};var Ddt=/\s+czm_writeLogDepth\(/,Pdt=/\s+czm_vertexLogDepth\(/;function Idt(e,t){if(t.fragmentShaderSource.defines.indexOf("LOG_DEPTH_READ_ONLY")>=0)return t;let i=e.shaderCache.getDerivedShaderProgram(t,"logDepth");if(c(i))return i;let o=t._attributeLocations,r=t.vertexShaderSource.clone(),s=t.fragmentShaderSource.clone();r.defines=c(r.defines)?r.defines.slice(0):[],r.defines.push("LOG_DEPTH"),s.defines=c(s.defines)?s.defines.slice(0):[],s.defines.push("LOG_DEPTH");let a=!1,l=r.sources;for(let f=0;f<l.length;++f)if(Pdt.test(l[f])){a=!0;break}if(!a){for(let d=0;d<l.length;++d)l[d]=Ge.replaceMain(l[d],"czm_log_depth_main");l.push(`

void main()
{
    czm_log_depth_main();
    czm_vertexLogDepth();
}
`)}l=s.sources,a=!1;for(let f=0;f<l.length;++f)Ddt.test(l[f])&&(a=!0);s.defines.indexOf("LOG_DEPTH_WRITE")!==-1&&(a=!0);let u="";if(!a){for(let f=0;f<l.length;f++)l[f]=Ge.replaceMain(l[f],"czm_log_depth_main");u=`
void main()
{
    czm_log_depth_main();
    czm_writeLogDepth();
}
`}return l.push(u),e.shaderCache.createDerivedShaderProgram(t,"logDepth",{vertexShaderSource:r,fragmentShaderSource:s,attributeLocations:o})}DC.createLogDepthCommand=function(e,t,n){c(n)||(n={});let i=n.command?.shaderProgram;return n.command=et.shallowClone(e,n.command),!c(i)||n.shaderProgramId!==e.shaderProgram.id?(n.command.shaderProgram=Idt(t,e.shaderProgram),n.shaderProgramId=e.shaderProgram.id):n.command.shaderProgram=i,n};function Odt(e,t,n){let i=e.shaderCache.getDerivedShaderProgram(t,"pick");if(c(i))return i;let o=t._attributeLocations,{sources:r,defines:s}=t.fragmentShaderSource,l=r.some(g=>g.includes("out_FragData"))?"out_FragData_0":"out_FragColor",u=`void main () 
{ 
    czm_non_pick_main(); 
    if (${l}.a == 0.0) { 
        discard; 
    } 
    ${l} = ${n}; 
} `,f=r.length,d=new Array(f+1);for(let g=0;g<f;++g)d[g]=Ge.replaceMain(r[g],"czm_non_pick_main");d[f]=u;let p=new Ge({sources:d,defines:s});return e.shaderCache.createDerivedShaderProgram(t,"pick",{vertexShaderSource:t.vertexShaderSource,fragmentShaderSource:p,attributeLocations:o})}function m0e(e,t){let n=e.picking.pickRenderStateCache,i=n[t.id];if(c(i))return i;let o=ze.getState(t);o.blending.enabled=!1,o.depthMask=!0;let r=ze.fromCache(o);return n[t.id]=r,r}DC.createPickDerivedCommand=function(e,t,n,i){c(i)||(i={});let o=i.pickCommand?.shaderProgram,r=i.pickCommand?.renderState;return i.pickCommand=et.shallowClone(t,i.pickCommand),!c(o)||i.shaderProgramId!==t.shaderProgram.id?(i.pickCommand.shaderProgram=Odt(n,t.shaderProgram,t.pickId),i.pickCommand.renderState=m0e(e,t.renderState),i.shaderProgramId=t.shaderProgram.id):(i.pickCommand.shaderProgram=o,i.pickCommand.renderState=r),i};function vC(e,t,n){let i=e.length;for(let o=0;o<i;o++)e[o].trimStart().split(/\s+/)[0]===t&&(e[o]=`${t} ${n}`)}function p0e(e){return e.isArray?e.arrayLength:Et.getComponentCount(e.type)}function Rdt(e){let t=p0e(e);return e.normalized?t===1?"float":`vec${t}`:t===1?"int":`ivec${t}`}function Mdt(e,t,n){let i=n.schemaId,o=n.className,r=n.propertyName,s=`pickMetadata-${i}-${o}-${r}`,a=e.shaderCache.getDerivedShaderProgram(t,s);if(c(a))return a;let l=n.classProperty,u=Rdt(l),f=["0.0","0.0","0.0","0.0"],d=p0e(l);if(d===1)f[0]="float(value)";else{let b=["x","y","z","w"];for(let x=0;x<d;x++){let C=`value.${b[x]}`;f[x]=`float(${C})`}}if(!l.normalized)for(let b=0;b<d;b++)f[b]+=" / 255.0";let p=t.fragmentShaderSource.defines.slice();p.push(od.METADATA_PICKING_ENABLED),vC(p,od.METADATA_PICKING_VALUE_TYPE,u),vC(p,od.METADATA_PICKING_VALUE_STRING,`metadata.${r}`),vC(p,od.METADATA_PICKING_VALUE_COMPONENT_X,f[0]),vC(p,od.METADATA_PICKING_VALUE_COMPONENT_Y,f[1]),vC(p,od.METADATA_PICKING_VALUE_COMPONENT_Z,f[2]),vC(p,od.METADATA_PICKING_VALUE_COMPONENT_W,f[3]);let g=new Ge({sources:t.fragmentShaderSource.sources,defines:p});return e.shaderCache.createDerivedShaderProgram(t,s,{vertexShaderSource:t.vertexShaderSource,fragmentShaderSource:g,attributeLocations:t._attributeLocations})}DC.createPickMetadataDerivedCommand=function(e,t,n,i){return c(i)||(i={}),i.pickMetadataCommand=et.shallowClone(t,i.pickMetadataCommand),i.pickMetadataCommand.shaderProgram=Mdt(n,t.shaderProgram,t.pickedMetadataInfo),i.pickMetadataCommand.renderState=m0e(e,t.renderState),i.shaderProgramId=t.shaderProgram.id,i};function Ldt(e,t){let n=e.shaderCache.getDerivedShaderProgram(t,"HDR");if(c(n))return n;let i=t._attributeLocations,o=t.vertexShaderSource.clone(),r=t.fragmentShaderSource.clone();return o.defines=c(o.defines)?o.defines.slice(0):[],o.defines.push("HDR"),r.defines=c(r.defines)?r.defines.slice(0):[],r.defines.push("HDR"),e.shaderCache.createDerivedShaderProgram(t,"HDR",{vertexShaderSource:o,fragmentShaderSource:r,attributeLocations:i})}DC.createHdrCommand=function(e,t,n){c(n)||(n={});let i=n.command?.shaderProgram;return n.command=et.shallowClone(e,n.command),!c(i)||n.shaderProgramId!==e.shaderProgram.id?(n.command.shaderProgram=Ldt(t,e.shaderProgram),n.shaderProgramId=e.shaderProgram.id):n.command.shaderProgram=i,n};var py=DC;function aN(e){if(!c(e))throw new E("scene is required.");this._scene=e,this._lastAlpha=void 0,this._lastBeta=void 0,this._lastGamma=void 0,this._alpha=void 0,this._beta=void 0,this._gamma=void 0;let t=this;function n(i){let o=i.alpha;if(!c(o)){t._alpha=void 0,t._beta=void 0,t._gamma=void 0;return}t._alpha=R.toRadians(o),t._beta=R.toRadians(i.beta),t._gamma=R.toRadians(i.gamma)}window.addEventListener("deviceorientation",n,!1),this._removeListener=function(){window.removeEventListener("deviceorientation",n,!1)}}var Ndt=new Ne,_0e=new Ne,Fdt=new Q;function Bdt(e,t,n,i){let o=e.direction,r=e.right,s=e.up,a=Ne.fromAxisAngle(o,n,_0e),l=Ne.fromAxisAngle(r,i,Ndt),u=Ne.multiply(l,a,l),f=Ne.fromAxisAngle(s,t,_0e);Ne.multiply(f,u,u);let d=Q.fromQuaternion(u,Fdt);Q.multiplyByVector(d,r,r),Q.multiplyByVector(d,s,s),Q.multiplyByVector(d,o,o)}aN.prototype.update=function(){if(!c(this._alpha))return;c(this._lastAlpha)||(this._lastAlpha=this._alpha,this._lastBeta=this._beta,this._lastGamma=this._gamma);let e=this._lastAlpha-this._alpha,t=this._lastBeta-this._beta,n=this._lastGamma-this._gamma;Bdt(this._scene.camera,-e,t,n),this._lastAlpha=this._alpha,this._lastBeta=this._beta,this._lastGamma=this._gamma};aN.prototype.isDestroyed=function(){return!1};aN.prototype.destroy=function(){return this._removeListener(),de(this)};var P7=aN;function kdt(e){if(A.typeOf.object("options",e),A.typeOf.object("options.direction",e.direction),h.equals(e.direction,h.ZERO))throw new E("options.direction cannot be zero-length");this.direction=h.clone(e.direction),this.color=j.clone(y(e.color,j.WHITE)),this.intensity=y(e.intensity,1)}var Vdt=kdt;var cN=`uniform vec3 u_radii;
uniform vec3 u_oneOverEllipsoidRadiiSquared;
in vec3 v_positionEC;
vec4 computeEllipsoidColor(czm_ray ray, float intersection, float side)
{
vec3 positionEC = czm_pointAlongRay(ray, intersection);
vec3 positionMC = (czm_inverseModelView * vec4(positionEC, 1.0)).xyz;
vec3 geodeticNormal = normalize(czm_geodeticSurfaceNormal(positionMC, vec3(0.0), u_oneOverEllipsoidRadiiSquared));
vec3 sphericalNormal = normalize(positionMC / u_radii);
vec3 normalMC = geodeticNormal * side;
vec3 normalEC = normalize(czm_normal * normalMC);
vec2 st = czm_ellipsoidTextureCoordinates(sphericalNormal);
vec3 positionToEyeEC = -positionEC;
czm_materialInput materialInput;
materialInput.s = st.s;
materialInput.st = st;
materialInput.str = (positionMC + u_radii) / u_radii;
materialInput.normalEC = normalEC;
materialInput.tangentToEyeMatrix = czm_eastNorthUpToEyeCoordinates(positionMC, normalEC);
materialInput.positionToEyeEC = positionToEyeEC;
czm_material material = czm_getMaterial(materialInput);
#ifdef ONLY_SUN_LIGHTING
return czm_private_phong(normalize(positionToEyeEC), material, czm_sunDirectionEC);
#else
return czm_phong(normalize(positionToEyeEC), material, czm_lightDirectionEC);
#endif
}
void main()
{
float maxRadius = max(u_radii.x, max(u_radii.y, u_radii.z)) * 1.5;
vec3 direction = normalize(v_positionEC);
vec3 ellipsoidCenter = czm_modelView[3].xyz;
float t1 = -1.0;
float t2 = -1.0;
float b = -2.0 * dot(direction, ellipsoidCenter);
float c = dot(ellipsoidCenter, ellipsoidCenter) - maxRadius * maxRadius;
float discriminant = b * b - 4.0 * c;
if (discriminant >= 0.0) {
t1 = (-b - sqrt(discriminant)) * 0.5;
t2 = (-b + sqrt(discriminant)) * 0.5;
}
if (t1 < 0.0 && t2 < 0.0) {
discard;
}
float t = min(t1, t2);
if (t < 0.0) {
t = 0.0;
}
czm_ray ray = czm_ray(t * direction, direction);
vec3 ellipsoid_inverseRadii = vec3(1.0 / u_radii.x, 1.0 / u_radii.y, 1.0 / u_radii.z);
czm_raySegment intersection = czm_rayEllipsoidIntersectionInterval(ray, ellipsoidCenter, ellipsoid_inverseRadii);
if (czm_isEmpty(intersection))
{
discard;
}
vec4 outsideFaceColor = (intersection.start != 0.0) ? computeEllipsoidColor(ray, intersection.start, 1.0) : vec4(0.0);
vec4 insideFaceColor = (outsideFaceColor.a < 1.0) ? computeEllipsoidColor(ray, intersection.stop, -1.0) : vec4(0.0);
out_FragColor = mix(insideFaceColor, outsideFaceColor, outsideFaceColor.a);
out_FragColor.a = 1.0 - (1.0 - insideFaceColor.a) * (1.0 - outsideFaceColor.a);
#if (defined(WRITE_DEPTH) && (__VERSION__ == 300 || defined(GL_EXT_frag_depth)))
t = (intersection.start != 0.0) ? intersection.start : intersection.stop;
vec3 positionEC = czm_pointAlongRay(ray, t);
vec4 positionCC = czm_projection * vec4(positionEC, 1.0);
#ifdef LOG_DEPTH
czm_writeLogDepth(1.0 + positionCC.w);
#else
float z = positionCC.z / positionCC.w;
float n = czm_depthRange.near;
float f = czm_depthRange.far;
gl_FragDepth = (z * (f - n) + f + n) * 0.5;
#endif
#endif
}
`;var lN=`in vec3 position;
uniform vec3 u_radii;
out vec3 v_positionEC;
void main()
{
vec4 p = vec4(u_radii * position, 1.0);
v_positionEC = (czm_modelView * p).xyz;
gl_Position = czm_modelViewProjection * p;
gl_Position.z = clamp(gl_Position.z, czm_depthRange.near, czm_depthRange.far);
czm_vertexLogDepth();
}
`;var I7={position:0};function uN(e){e=y(e,y.EMPTY_OBJECT),this.center=h.clone(y(e.center,h.ZERO)),this._center=new h,this.radii=h.clone(e.radii),this._radii=new h,this._oneOverEllipsoidRadiiSquared=new h,this._boundingSphere=new ce,this.modelMatrix=k.clone(y(e.modelMatrix,k.IDENTITY)),this._modelMatrix=new k,this._computedModelMatrix=new k,this.show=y(e.show,!0),this.material=y(e.material,Ki.fromType(Ki.ColorType)),this._material=void 0,this._translucent=void 0,this.id=e.id,this._id=void 0,this.debugShowBoundingVolume=y(e.debugShowBoundingVolume,!1),this.onlySunLighting=y(e.onlySunLighting,!1),this._onlySunLighting=!1,this._depthTestEnabled=y(e.depthTestEnabled,!0),this._useLogDepth=!1,this._sp=void 0,this._rs=void 0,this._va=void 0,this._pickSP=void 0,this._pickId=void 0,this._colorCommand=new et({owner:y(e._owner,this)}),this._pickCommand=new et({owner:y(e._owner,this),pickOnly:!0});let t=this;this._uniforms={u_radii:function(){return t.radii},u_oneOverEllipsoidRadiiSquared:function(){return t._oneOverEllipsoidRadiiSquared}},this._pickUniforms={czm_pickColor:function(){return t._pickId.color}}}function Udt(e){let t=e.cache.ellipsoidPrimitive_vertexArray;if(c(t))return t;let n=uc.createGeometry(uc.fromDimensions({dimensions:new h(2,2,2),vertexFormat:Ie.POSITION_ONLY}));return t=ni.fromGeometry({context:e,geometry:n,attributeLocations:I7,bufferUsage:ke.STATIC_DRAW,interleave:!0}),e.cache.ellipsoidPrimitive_vertexArray=t,t}uN.prototype.update=function(e){if(!this.show||e.mode!==oe.SCENE3D||!c(this.center)||!c(this.radii))return;if(!c(this.material))throw new E("this.material must be defined.");let t=e.context,n=this.material.isTranslucent(),i=this._translucent!==n;(!c(this._rs)||i)&&(this._translucent=n,this._rs=ze.fromCache({cull:{enabled:!0,face:xi.FRONT},depthTest:{enabled:this._depthTestEnabled},depthMask:!n&&t.fragmentDepth,blending:n?hn.ALPHA_BLEND:void 0})),c(this._va)||(this._va=Udt(t));let o=!1,r=this.radii;if(!h.equals(this._radii,r)){h.clone(r,this._radii);let b=this._oneOverEllipsoidRadiiSquared;b.x=1/(r.x*r.x),b.y=1/(r.y*r.y),b.z=1/(r.z*r.z),o=!0}(!k.equals(this.modelMatrix,this._modelMatrix)||!h.equals(this.center,this._center))&&(k.clone(this.modelMatrix,this._modelMatrix),h.clone(this.center,this._center),k.multiplyByTranslation(this.modelMatrix,this.center,this._computedModelMatrix),o=!0),o&&(h.clone(h.ZERO,this._boundingSphere.center),this._boundingSphere.radius=h.maximumComponent(r),ce.transform(this._boundingSphere,this._computedModelMatrix,this._boundingSphere));let s=this._material!==this.material;this._material=this.material,this._material.update(t);let a=this.onlySunLighting!==this._onlySunLighting;this._onlySunLighting=this.onlySunLighting;let l=e.useLogDepth,u=this._useLogDepth!==l;this._useLogDepth=l;let f=this._colorCommand,d,p;(s||a||i||u)&&(d=new Ge({sources:[lN]}),p=new Ge({sources:[this.material.shaderSource,cN]}),this.onlySunLighting&&p.defines.push("ONLY_SUN_LIGHTING"),!n&&t.fragmentDepth&&p.defines.push("WRITE_DEPTH"),this._useLogDepth&&(d.defines.push("LOG_DEPTH"),p.defines.push("LOG_DEPTH")),this._sp=an.replaceCache({context:t,shaderProgram:this._sp,vertexShaderSource:d,fragmentShaderSource:p,attributeLocations:I7}),f.vertexArray=this._va,f.renderState=this._rs,f.shaderProgram=this._sp,f.uniformMap=At(this._uniforms,this.material._uniforms),f.executeInClosestFrustum=n);let g=e.commandList,m=e.passes;if(m.render&&(f.boundingVolume=this._boundingSphere,f.debugShowBoundingVolume=this.debugShowBoundingVolume,f.modelMatrix=this._computedModelMatrix,f.pass=n?ve.TRANSLUCENT:ve.OPAQUE,g.push(f)),m.pick){let b=this._pickCommand;(!c(this._pickId)||this._id!==this.id)&&(this._id=this.id,this._pickId=this._pickId&&this._pickId.destroy(),this._pickId=t.createPickId({primitive:this,id:this.id})),(s||a||!c(this._pickSP)||u)&&(d=new Ge({sources:[lN]}),p=new Ge({sources:[this.material.shaderSource,cN],pickColorQualifier:"uniform"}),this.onlySunLighting&&p.defines.push("ONLY_SUN_LIGHTING"),!n&&t.fragmentDepth&&p.defines.push("WRITE_DEPTH"),this._useLogDepth&&(d.defines.push("LOG_DEPTH"),p.defines.push("LOG_DEPTH")),this._pickSP=an.replaceCache({context:t,shaderProgram:this._pickSP,vertexShaderSource:d,fragmentShaderSource:p,attributeLocations:I7}),b.vertexArray=this._va,b.renderState=this._rs,b.shaderProgram=this._pickSP,b.uniformMap=At(At(this._uniforms,this._pickUniforms),this.material._uniforms),b.executeInClosestFrustum=n),b.boundingVolume=this._boundingSphere,b.modelMatrix=this._computedModelMatrix,b.pass=n?ve.TRANSLUCENT:ve.OPAQUE,g.push(b)}};uN.prototype.isDestroyed=function(){return!1};uN.prototype.destroy=function(){return this._sp=this._sp&&this._sp.destroy(),this._pickSP=this._pickSP&&this._pickSP.destroy(),this._pickId=this._pickId&&this._pickId.destroy(),de(this)};var O7=uN;var R7=`in vec3 v_positionMC;
in vec3 v_positionEC;
in vec2 v_st;
void main()
{
czm_materialInput materialInput;
vec3 normalEC = normalize(czm_normal3D * czm_geodeticSurfaceNormal(v_positionMC, vec3(0.0), vec3(1.0)));
#ifdef FACE_FORWARD
normalEC = faceforward(normalEC, vec3(0.0, 0.0, 1.0), -normalEC);
#endif
materialInput.s = v_st.s;
materialInput.st = v_st;
materialInput.str = vec3(v_st, 0.0);
materialInput.normalEC = normalEC;
materialInput.tangentToEyeMatrix = czm_eastNorthUpToEyeCoordinates(v_positionMC, materialInput.normalEC);
vec3 positionToEyeEC = -v_positionEC;
materialInput.positionToEyeEC = positionToEyeEC;
czm_material material = czm_getMaterial(materialInput);
#ifdef FLAT
out_FragColor = vec4(material.diffuse + material.emission, material.alpha);
#else
out_FragColor = czm_phong(normalize(positionToEyeEC), material, czm_lightDirectionEC);
#endif
}
`;var M7=`in vec3 position3DHigh;
in vec3 position3DLow;
in vec2 st;
in float batchId;
out vec3 v_positionMC;
out vec3 v_positionEC;
out vec2 v_st;
void main()
{
vec4 p = czm_computePosition();
v_positionMC = position3DHigh + position3DLow;
v_positionEC = (czm_modelViewRelativeToEye * p).xyz;
v_st = st;
gl_Position = czm_modelViewProjectionRelativeToEye * p;
}
`;function qb(e){e=y(e,y.EMPTY_OBJECT);let t=y(e.translucent,!0),n=y(e.aboveGround,!1);this.material=c(e.material)?e.material:Ki.fromType(Ki.ColorType),this.translucent=y(e.translucent,!0),this._vertexShaderSource=y(e.vertexShaderSource,M7),this._fragmentShaderSource=y(e.fragmentShaderSource,R7),this._renderState=io.getDefaultRenderState(t,!n,e.renderState),this._closed=!1,this._flat=y(e.flat,!1),this._faceForward=y(e.faceForward,n),this._aboveGround=n}Object.defineProperties(qb.prototype,{vertexShaderSource:{get:function(){return this._vertexShaderSource}},fragmentShaderSource:{get:function(){return this._fragmentShaderSource}},renderState:{get:function(){return this._renderState}},closed:{get:function(){return this._closed}},vertexFormat:{get:function(){return qb.VERTEX_FORMAT}},flat:{get:function(){return this._flat}},faceForward:{get:function(){return this._faceForward}},aboveGround:{get:function(){return this._aboveGround}}});qb.VERTEX_FORMAT=Ie.POSITION_AND_ST;qb.prototype.getFragmentShaderSource=io.prototype.getFragmentShaderSource;qb.prototype.isTranslucent=io.prototype.isTranslucent;qb.prototype.getRenderState=io.prototype.getRenderState;var zdt=qb;function L7(){this.enabled=!0,this.renderable=!0,this.density=6e-4,this.heightScalar=.001,this._heightFalloff=.59,this.maxHeight=8e5,this.visualDensityScalar=.15,this.screenSpaceErrorFactor=2,this.minimumBrightness=.03}Object.defineProperties(L7.prototype,{heightFalloff:{get:function(){return this._heightFalloff},set:function(e){if(c(e)&&e<0)throw new E("value must be positive.");this._heightFalloff=e}}});var Hdt=new h;L7.prototype.update=function(e){if(!(e.fog.enabled=this.enabled))return;e.fog.renderable=this.renderable;let n=e.camera,i=n.positionCartographic;if(!c(i)||i.height>this.maxHeight||e.mode!==oe.SCENE3D){e.fog.enabled=!1,e.fog.density=0;return}let o=i.height,r=this.density*this.heightScalar*Math.pow(Math.max(o/this.maxHeight,R.EPSILON4),-Math.max(this._heightFalloff,0)),s=h.normalize(n.positionWC,Hdt),a=Math.abs(h.dot(n.directionWC,s));r*=1-a,e.fog.density=r,e.fog.visualDensityScalar=this.visualDensityScalar,e.fog.sse=this.screenSpaceErrorFactor,e.fog.minimumBrightness=this.minimumBrightness};var N7=L7;function vl(e){if(!c(e)||!c(e.scene))throw new E("options.scene is required.");this._scene=e.scene,this.samplingWindow=y(e.samplingWindow,vl.defaultSettings.samplingWindow),this.quietPeriod=y(e.quietPeriod,vl.defaultSettings.quietPeriod),this.warmupPeriod=y(e.warmupPeriod,vl.defaultSettings.warmupPeriod),this.minimumFrameRateDuringWarmup=y(e.minimumFrameRateDuringWarmup,vl.defaultSettings.minimumFrameRateDuringWarmup),this.minimumFrameRateAfterWarmup=y(e.minimumFrameRateAfterWarmup,vl.defaultSettings.minimumFrameRateAfterWarmup),this._lowFrameRate=new pe,this._nominalFrameRate=new pe,this._frameTimes=[],this._needsQuietPeriod=!0,this._quietPeriodEndTime=0,this._warmupPeriodEndTime=0,this._frameRateIsLow=!1,this._lastFramesPerSecond=void 0,this._pauseCount=0;let t=this;this._preUpdateRemoveListener=this._scene.preUpdate.addEventListener(function(o,r){Gdt(t,r)}),this._hiddenPropertyName=document.hidden!==void 0?"hidden":document.mozHidden!==void 0?"mozHidden":document.msHidden!==void 0?"msHidden":document.webkitHidden!==void 0?"webkitHidden":void 0;let n=document.hidden!==void 0?"visibilitychange":document.mozHidden!==void 0?"mozvisibilitychange":document.msHidden!==void 0?"msvisibilitychange":document.webkitHidden!==void 0?"webkitvisibilitychange":void 0;function i(){jdt(t)}this._visibilityChangeRemoveListener=void 0,c(n)&&(document.addEventListener(n,i,!1),this._visibilityChangeRemoveListener=function(){document.removeEventListener(n,i,!1)})}vl.defaultSettings={samplingWindow:5,quietPeriod:2,warmupPeriod:5,minimumFrameRateDuringWarmup:4,minimumFrameRateAfterWarmup:8};vl.fromScene=function(e){if(!c(e))throw new E("scene is required.");return(!c(e._frameRateMonitor)||e._frameRateMonitor.isDestroyed())&&(e._frameRateMonitor=new vl({scene:e})),e._frameRateMonitor};Object.defineProperties(vl.prototype,{scene:{get:function(){return this._scene}},lowFrameRate:{get:function(){return this._lowFrameRate}},nominalFrameRate:{get:function(){return this._nominalFrameRate}},lastFramesPerSecond:{get:function(){return this._lastFramesPerSecond}}});vl.prototype.pause=function(){++this._pauseCount,this._pauseCount===1&&(this._frameTimes.length=0,this._lastFramesPerSecond=void 0)};vl.prototype.unpause=function(){--this._pauseCount,this._pauseCount<=0&&(this._pauseCount=0,this._needsQuietPeriod=!0)};vl.prototype.isDestroyed=function(){return!1};vl.prototype.destroy=function(){return this._preUpdateRemoveListener(),c(this._visibilityChangeRemoveListener)&&this._visibilityChangeRemoveListener(),de(this)};function Gdt(e,t){if(e._pauseCount>0)return;let n=Ei();if(e._needsQuietPeriod)e._needsQuietPeriod=!1,e._frameTimes.length=0,e._quietPeriodEndTime=n+e.quietPeriod/qn.SECONDS_PER_MILLISECOND,e._warmupPeriodEndTime=e._quietPeriodEndTime+(e.warmupPeriod+e.samplingWindow)/qn.SECONDS_PER_MILLISECOND;else if(n>=e._quietPeriodEndTime){e._frameTimes.push(n);let i=n-e.samplingWindow/qn.SECONDS_PER_MILLISECOND;if(e._frameTimes.length>=2&&e._frameTimes[0]<=i){for(;e._frameTimes.length>=2&&e._frameTimes[1]<i;)e._frameTimes.shift();let o=(n-e._frameTimes[0])/(e._frameTimes.length-1);e._lastFramesPerSecond=1e3/o;let r=1e3/(n>e._warmupPeriodEndTime?e.minimumFrameRateAfterWarmup:e.minimumFrameRateDuringWarmup);o>r?e._frameRateIsLow||(e._frameRateIsLow=!0,e._needsQuietPeriod=!0,e.lowFrameRate.raiseEvent(e.scene,e._lastFramesPerSecond)):e._frameRateIsLow&&(e._frameRateIsLow=!1,e._needsQuietPeriod=!0,e.nominalFrameRate.raiseEvent(e.scene,e._lastFramesPerSecond))}}}function jdt(e){document[e._hiddenPropertyName]?e.pause():e.unpause()}var fN=vl;function Wdt(e,t,n){this.context=e,this.commandList=[],this.shadowMaps=[],this.brdfLutGenerator=void 0,this.environmentMap=void 0,this.sphericalHarmonicCoefficients=void 0,this.specularEnvironmentMaps=void 0,this.specularEnvironmentMapsMaximumLOD=void 0,this.mode=oe.SCENE3D,this.morphTime=oe.getMorphTime(oe.SCENE3D),this.frameNumber=0,this.newFrame=!1,this.time=void 0,this.jobScheduler=n,this.mapProjection=void 0,this.camera=void 0,this.cameraUnderground=!1,this.globeTranslucencyState=void 0,this.cullingVolume=void 0,this.occluder=void 0,this.maximumScreenSpaceError=void 0,this.pixelRatio=1,this.passes={render:!1,pick:!1,pickVoxel:!1,depth:!1,postProcess:!1,offscreen:!1},this.creditDisplay=t,this.afterRender=[],this.scene3DOnly=!1,this.fog={enabled:!1,renderable:!1,density:void 0,visualDensityScalar:void 0,sse:void 0,minimumBrightness:void 0},this.atmosphere=void 0,this.verticalExaggeration=1,this.verticalExaggerationRelativeHeight=0,this.shadowState={shadowsEnabled:!0,shadowMaps:[],lightShadowMaps:[],nearPlane:1,farPlane:5e3,closestObjectSize:1e3,lastDirtyTime:0,outOfView:!0},this.splitPosition=0,this.frustumSplits=[],this.backgroundColor=void 0,this.light=void 0,this.minimumDisableDepthTestDistance=void 0,this.invertClassification=!1,this.invertClassificationColor=void 0,this.useLogDepth=!1,this.tilesetPassState=void 0,this.minimumTerrainHeight=0,this.pickingMetadata=!1,this.pickedMetadataInfo=void 0}var F7=Wdt;function qdt(e,t){this.near=y(e,0),this.far=y(t,0);let n=ve.NUMBER_OF_PASSES,i=new Array(n),o=new Array(n);for(let r=0;r<n;++r)i[r]=[],o[r]=0;this.commands=i,this.indices=o}var B7=qdt;function Ydt(e,t,n){return A.typeOf.string("samplerUniformName",e),A.typeOf.string("matrixUniformName",t),A.typeOf.string("styleUniformName",n),`    float clipDistance = clip(gl_FragCoord, ${e}, ${t}); 
    vec4 clippingPlanesEdgeColor = vec4(1.0); 
    clippingPlanesEdgeColor.rgb = ${n}.rgb; 
    float clippingPlanesEdgeWidth = ${n}.a; 
    if (clipDistance > 0.0 && clipDistance < clippingPlanesEdgeWidth) 
    { 
        out_FragColor = clippingPlanesEdgeColor;
    } 
`}var k7=Ydt;function Xdt(e,t,n,i){if(!c(e)||c(t)&&e.id!==t)return;let r=(e.classes||{})[n];if(!c(r))return;let a=(r.properties||{})[i];if(c(a))return a}var V7=Xdt;var U7=`uniform vec4 u_initialColor;
#if TEXTURE_UNITS > 0
uniform sampler2D u_dayTextures[TEXTURE_UNITS];
uniform vec4 u_dayTextureTranslationAndScale[TEXTURE_UNITS];
uniform bool u_dayTextureUseWebMercatorT[TEXTURE_UNITS];
#ifdef APPLY_ALPHA
uniform float u_dayTextureAlpha[TEXTURE_UNITS];
#endif
#ifdef APPLY_DAY_NIGHT_ALPHA
uniform float u_dayTextureNightAlpha[TEXTURE_UNITS];
uniform float u_dayTextureDayAlpha[TEXTURE_UNITS];
#endif
#ifdef APPLY_SPLIT
uniform float u_dayTextureSplit[TEXTURE_UNITS];
#endif
#ifdef APPLY_BRIGHTNESS
uniform float u_dayTextureBrightness[TEXTURE_UNITS];
#endif
#ifdef APPLY_CONTRAST
uniform float u_dayTextureContrast[TEXTURE_UNITS];
#endif
#ifdef APPLY_HUE
uniform float u_dayTextureHue[TEXTURE_UNITS];
#endif
#ifdef APPLY_SATURATION
uniform float u_dayTextureSaturation[TEXTURE_UNITS];
#endif
#ifdef APPLY_GAMMA
uniform float u_dayTextureOneOverGamma[TEXTURE_UNITS];
#endif
#ifdef APPLY_IMAGERY_CUTOUT
uniform vec4 u_dayTextureCutoutRectangles[TEXTURE_UNITS];
#endif
#ifdef APPLY_COLOR_TO_ALPHA
uniform vec4 u_colorsToAlpha[TEXTURE_UNITS];
#endif
uniform vec4 u_dayTextureTexCoordsRectangle[TEXTURE_UNITS];
#endif
#if defined(HAS_WATER_MASK) && (defined(SHOW_REFLECTIVE_OCEAN) || defined(APPLY_MATERIAL))
uniform sampler2D u_waterMask;
uniform vec4 u_waterMaskTranslationAndScale;
uniform float u_zoomedOutOceanSpecularIntensity;
#endif
#ifdef SHOW_OCEAN_WAVES
uniform sampler2D u_oceanNormalMap;
#endif
#if defined(ENABLE_DAYNIGHT_SHADING) || defined(GROUND_ATMOSPHERE)
uniform vec2 u_lightingFadeDistance;
#endif
#ifdef TILE_LIMIT_RECTANGLE
uniform vec4 u_cartographicLimitRectangle;
#endif
#ifdef GROUND_ATMOSPHERE
uniform vec2 u_nightFadeDistance;
#endif
#ifdef ENABLE_CLIPPING_PLANES
uniform highp sampler2D u_clippingPlanes;
uniform mat4 u_clippingPlanesMatrix;
uniform vec4 u_clippingPlanesEdgeStyle;
#endif
#ifdef ENABLE_CLIPPING_POLYGONS
uniform highp sampler2D u_clippingDistance;
in vec2 v_clippingPosition;
flat in int v_regionIndex;
#endif
#if defined(GROUND_ATMOSPHERE) || defined(FOG) && defined(DYNAMIC_ATMOSPHERE_LIGHTING) && (defined(ENABLE_VERTEX_LIGHTING) || defined(ENABLE_DAYNIGHT_SHADING))
uniform float u_minimumBrightness;
#endif
#ifdef COLOR_CORRECT
uniform vec3 u_hsbShift;
#endif
#ifdef HIGHLIGHT_FILL_TILE
uniform vec4 u_fillHighlightColor;
#endif
#ifdef TRANSLUCENT
uniform vec4 u_frontFaceAlphaByDistance;
uniform vec4 u_backFaceAlphaByDistance;
uniform vec4 u_translucencyRectangle;
#endif
#ifdef UNDERGROUND_COLOR
uniform vec4 u_undergroundColor;
uniform vec4 u_undergroundColorAlphaByDistance;
#endif
#ifdef ENABLE_VERTEX_LIGHTING
uniform float u_lambertDiffuseMultiplier;
uniform float u_vertexShadowDarkness;
#endif
in vec3 v_positionMC;
in vec3 v_positionEC;
in vec3 v_textureCoordinates;
in vec3 v_normalMC;
in vec3 v_normalEC;
#ifdef APPLY_MATERIAL
in float v_height;
in float v_slope;
in float v_aspect;
#endif
#if defined(FOG) || defined(GROUND_ATMOSPHERE) || defined(UNDERGROUND_COLOR) || defined(TRANSLUCENT)
in float v_distance;
#endif
#if defined(GROUND_ATMOSPHERE) || defined(FOG)
in vec3 v_atmosphereRayleighColor;
in vec3 v_atmosphereMieColor;
in float v_atmosphereOpacity;
#endif
#if defined(UNDERGROUND_COLOR) || defined(TRANSLUCENT)
float interpolateByDistance(vec4 nearFarScalar, float distance)
{
float startDistance = nearFarScalar.x;
float startValue = nearFarScalar.y;
float endDistance = nearFarScalar.z;
float endValue = nearFarScalar.w;
float t = clamp((distance - startDistance) / (endDistance - startDistance), 0.0, 1.0);
return mix(startValue, endValue, t);
}
#endif
#if defined(UNDERGROUND_COLOR) || defined(TRANSLUCENT) || defined(APPLY_MATERIAL)
vec4 alphaBlend(vec4 sourceColor, vec4 destinationColor)
{
return sourceColor * vec4(sourceColor.aaa, 1.0) + destinationColor * (1.0 - sourceColor.a);
}
#endif
#ifdef TRANSLUCENT
bool inTranslucencyRectangle()
{
return
v_textureCoordinates.x > u_translucencyRectangle.x &&
v_textureCoordinates.x < u_translucencyRectangle.z &&
v_textureCoordinates.y > u_translucencyRectangle.y &&
v_textureCoordinates.y < u_translucencyRectangle.w;
}
#endif
vec4 sampleAndBlend(
vec4 previousColor,
sampler2D textureToSample,
vec2 tileTextureCoordinates,
vec4 textureCoordinateRectangle,
vec4 textureCoordinateTranslationAndScale,
float textureAlpha,
float textureNightAlpha,
float textureDayAlpha,
float textureBrightness,
float textureContrast,
float textureHue,
float textureSaturation,
float textureOneOverGamma,
float split,
vec4 colorToAlpha,
float nightBlend)
{
vec2 alphaMultiplier = step(textureCoordinateRectangle.st, tileTextureCoordinates);
textureAlpha = textureAlpha * alphaMultiplier.x * alphaMultiplier.y;
alphaMultiplier = step(vec2(0.0), textureCoordinateRectangle.pq - tileTextureCoordinates);
textureAlpha = textureAlpha * alphaMultiplier.x * alphaMultiplier.y;
#if defined(APPLY_DAY_NIGHT_ALPHA) && defined(ENABLE_DAYNIGHT_SHADING)
textureAlpha *= mix(textureDayAlpha, textureNightAlpha, nightBlend);
#endif
vec2 translation = textureCoordinateTranslationAndScale.xy;
vec2 scale = textureCoordinateTranslationAndScale.zw;
vec2 textureCoordinates = tileTextureCoordinates * scale + translation;
vec4 value = texture(textureToSample, textureCoordinates);
vec3 color = value.rgb;
float alpha = value.a;
#ifdef APPLY_COLOR_TO_ALPHA
vec3 colorDiff = abs(color.rgb - colorToAlpha.rgb);
colorDiff.r = czm_maximumComponent(colorDiff);
alpha = czm_branchFreeTernary(colorDiff.r < colorToAlpha.a, 0.0, alpha);
#endif
#if !defined(APPLY_GAMMA)
vec4 tempColor = czm_gammaCorrect(vec4(color, alpha));
color = tempColor.rgb;
alpha = tempColor.a;
#else
color = pow(color, vec3(textureOneOverGamma));
#endif
#ifdef APPLY_SPLIT
float splitPosition = czm_splitPosition;
if (split < 0.0 && gl_FragCoord.x > splitPosition) {
alpha = 0.0;
}
else if (split > 0.0 && gl_FragCoord.x < splitPosition) {
alpha = 0.0;
}
#endif
#ifdef APPLY_BRIGHTNESS
color = mix(vec3(0.0), color, textureBrightness);
#endif
#ifdef APPLY_CONTRAST
color = mix(vec3(0.5), color, textureContrast);
#endif
#ifdef APPLY_HUE
color = czm_hue(color, textureHue);
#endif
#ifdef APPLY_SATURATION
color = czm_saturation(color, textureSaturation);
#endif
float sourceAlpha = alpha * textureAlpha;
float outAlpha = mix(previousColor.a, 1.0, sourceAlpha);
outAlpha += sign(outAlpha) - 1.0;
vec3 outColor = mix(previousColor.rgb * previousColor.a, color, sourceAlpha) / outAlpha;
return vec4(outColor, max(outAlpha, 0.0));
}
vec4 computeDayColor(vec4 initialColor, vec3 textureCoordinates, float nightBlend);
vec4 computeWaterColor(vec3 positionEyeCoordinates, vec2 textureCoordinates, mat3 enuToEye, vec4 imageryColor, float specularMapValue, float fade);
const float fExposure = 2.0;
vec3 computeEllipsoidPosition()
{
float mpp = czm_metersPerPixel(vec4(0.0, 0.0, -czm_currentFrustum.x, 1.0), 1.0);
vec2 xy = gl_FragCoord.xy / czm_viewport.zw * 2.0 - vec2(1.0);
xy *= czm_viewport.zw * mpp * 0.5;
vec3 direction = normalize(vec3(xy, -czm_currentFrustum.x));
czm_ray ray = czm_ray(vec3(0.0), direction);
vec3 ellipsoid_center = czm_view[3].xyz;
czm_raySegment intersection = czm_rayEllipsoidIntersectionInterval(ray, ellipsoid_center, czm_ellipsoidInverseRadii);
vec3 ellipsoidPosition = czm_pointAlongRay(ray, intersection.start);
return (czm_inverseView * vec4(ellipsoidPosition, 1.0)).xyz;
}
void main()
{
#ifdef TILE_LIMIT_RECTANGLE
if (v_textureCoordinates.x < u_cartographicLimitRectangle.x || u_cartographicLimitRectangle.z < v_textureCoordinates.x ||
v_textureCoordinates.y < u_cartographicLimitRectangle.y || u_cartographicLimitRectangle.w < v_textureCoordinates.y)
{
discard;
}
#endif
#ifdef ENABLE_CLIPPING_PLANES
float clipDistance = clip(gl_FragCoord, u_clippingPlanes, u_clippingPlanesMatrix);
#endif
#if defined(SHOW_REFLECTIVE_OCEAN) || defined(ENABLE_DAYNIGHT_SHADING) || defined(HDR)
vec3 normalMC = czm_geodeticSurfaceNormal(v_positionMC, vec3(0.0), vec3(1.0));
vec3 normalEC = czm_normal3D * normalMC;
#endif
#if defined(APPLY_DAY_NIGHT_ALPHA) && defined(ENABLE_DAYNIGHT_SHADING)
float nightBlend = 1.0 - clamp(czm_getLambertDiffuse(czm_lightDirectionEC, normalEC) * 5.0, 0.0, 1.0);
#else
float nightBlend = 0.0;
#endif
vec4 color = computeDayColor(u_initialColor, clamp(v_textureCoordinates, 0.0, 1.0), nightBlend);
#ifdef SHOW_TILE_BOUNDARIES
if (v_textureCoordinates.x < (1.0/256.0) || v_textureCoordinates.x > (255.0/256.0) ||
v_textureCoordinates.y < (1.0/256.0) || v_textureCoordinates.y > (255.0/256.0))
{
color = vec4(1.0, 0.0, 0.0, 1.0);
}
#endif
#if defined(ENABLE_DAYNIGHT_SHADING) || defined(GROUND_ATMOSPHERE)
float cameraDist;
if (czm_sceneMode == czm_sceneMode2D)
{
cameraDist = max(czm_frustumPlanes.x - czm_frustumPlanes.y, czm_frustumPlanes.w - czm_frustumPlanes.z) * 0.5;
}
else if (czm_sceneMode == czm_sceneModeColumbusView)
{
cameraDist = -czm_view[3].z;
}
else
{
cameraDist = length(czm_view[3]);
}
float fadeOutDist = u_lightingFadeDistance.x;
float fadeInDist = u_lightingFadeDistance.y;
if (czm_sceneMode != czm_sceneMode3D) {
vec3 radii = czm_ellipsoidRadii;
float maxRadii = max(radii.x, max(radii.y, radii.z));
fadeOutDist -= maxRadii;
fadeInDist -= maxRadii;
}
float fade = clamp((cameraDist - fadeOutDist) / (fadeInDist - fadeOutDist), 0.0, 1.0);
#else
float fade = 0.0;
#endif
#if defined(HAS_WATER_MASK) && (defined(SHOW_REFLECTIVE_OCEAN) || defined(APPLY_MATERIAL))
vec2 waterMaskTranslation = u_waterMaskTranslationAndScale.xy;
vec2 waterMaskScale = u_waterMaskTranslationAndScale.zw;
vec2 waterMaskTextureCoordinates = v_textureCoordinates.xy * waterMaskScale + waterMaskTranslation;
waterMaskTextureCoordinates.y = 1.0 - waterMaskTextureCoordinates.y;
float mask = texture(u_waterMask, waterMaskTextureCoordinates).r;
#ifdef SHOW_REFLECTIVE_OCEAN
if (mask > 0.0)
{
mat3 enuToEye = czm_eastNorthUpToEyeCoordinates(v_positionMC, normalEC);
vec2 ellipsoidTextureCoordinates = czm_ellipsoidTextureCoordinates(normalMC);
vec2 ellipsoidFlippedTextureCoordinates = czm_ellipsoidTextureCoordinates(normalMC.zyx);
vec2 textureCoordinates = mix(ellipsoidTextureCoordinates, ellipsoidFlippedTextureCoordinates, czm_morphTime * smoothstep(0.9, 0.95, normalMC.z));
color = computeWaterColor(v_positionEC, textureCoordinates, enuToEye, color, mask, fade);
}
#endif
#endif
#ifdef APPLY_MATERIAL
czm_materialInput materialInput;
materialInput.st = v_textureCoordinates.st;
materialInput.normalEC = normalize(v_normalEC);
materialInput.positionToEyeEC = -v_positionEC;
materialInput.tangentToEyeMatrix = czm_eastNorthUpToEyeCoordinates(v_positionMC, normalize(v_normalEC));
materialInput.slope = v_slope;
materialInput.height = v_height;
materialInput.aspect = v_aspect;
#ifdef HAS_WATER_MASK
materialInput.waterMask = mask;
#endif
czm_material material = czm_getMaterial(materialInput);
vec4 materialColor = vec4(material.diffuse, material.alpha);
color = alphaBlend(materialColor, color);
#endif
#ifdef ENABLE_VERTEX_LIGHTING
float diffuseIntensity = clamp(czm_getLambertDiffuse(czm_lightDirectionEC, normalize(v_normalEC)) * u_lambertDiffuseMultiplier + u_vertexShadowDarkness, 0.0, 1.0);
vec4 finalColor = vec4(color.rgb * czm_lightColor * diffuseIntensity, color.a);
#elif defined(ENABLE_DAYNIGHT_SHADING)
float diffuseIntensity = clamp(czm_getLambertDiffuse(czm_lightDirectionEC, normalEC) * 5.0 + 0.3, 0.0, 1.0);
diffuseIntensity = mix(1.0, diffuseIntensity, fade);
vec4 finalColor = vec4(color.rgb * czm_lightColor * diffuseIntensity, color.a);
#else
vec4 finalColor = color;
#endif
#ifdef ENABLE_CLIPPING_PLANES
vec4 clippingPlanesEdgeColor = vec4(1.0);
clippingPlanesEdgeColor.rgb = u_clippingPlanesEdgeStyle.rgb;
float clippingPlanesEdgeWidth = u_clippingPlanesEdgeStyle.a;
if (clipDistance < clippingPlanesEdgeWidth)
{
finalColor = clippingPlanesEdgeColor;
}
#endif
#ifdef ENABLE_CLIPPING_POLYGONS
vec2 clippingPosition = v_clippingPosition;
int regionIndex = v_regionIndex;
clipPolygons(u_clippingDistance, CLIPPING_POLYGON_REGIONS_LENGTH, clippingPosition, regionIndex);
#endif
#ifdef HIGHLIGHT_FILL_TILE
finalColor = vec4(mix(finalColor.rgb, u_fillHighlightColor.rgb, u_fillHighlightColor.a), finalColor.a);
#endif
#if defined(DYNAMIC_ATMOSPHERE_LIGHTING_FROM_SUN)
vec3 atmosphereLightDirection = czm_sunDirectionWC;
#else
vec3 atmosphereLightDirection = czm_lightDirectionWC;
#endif
#if defined(GROUND_ATMOSPHERE) || defined(FOG)
if (!czm_backFacing())
{
bool dynamicLighting = false;
#if defined(DYNAMIC_ATMOSPHERE_LIGHTING) && (defined(ENABLE_DAYNIGHT_SHADING) || defined(ENABLE_VERTEX_LIGHTING))
dynamicLighting = true;
#endif
vec3 rayleighColor;
vec3 mieColor;
float opacity;
vec3 positionWC;
vec3 lightDirection;
#ifdef PER_FRAGMENT_GROUND_ATMOSPHERE
positionWC = computeEllipsoidPosition();
lightDirection = czm_branchFreeTernary(dynamicLighting, atmosphereLightDirection, normalize(positionWC));
computeAtmosphereScattering(
positionWC,
lightDirection,
rayleighColor,
mieColor,
opacity
);
#else
positionWC = v_positionMC;
lightDirection = czm_branchFreeTernary(dynamicLighting, atmosphereLightDirection, normalize(positionWC));
rayleighColor = v_atmosphereRayleighColor;
mieColor = v_atmosphereMieColor;
opacity = v_atmosphereOpacity;
#endif
#ifdef COLOR_CORRECT
const bool ignoreBlackPixels = true;
rayleighColor = czm_applyHSBShift(rayleighColor, u_hsbShift, ignoreBlackPixels);
mieColor = czm_applyHSBShift(mieColor, u_hsbShift, ignoreBlackPixels);
#endif
vec4 groundAtmosphereColor = computeAtmosphereColor(positionWC, lightDirection, rayleighColor, mieColor, opacity);
#ifdef FOG
vec3 fogColor = groundAtmosphereColor.rgb;
#if defined(DYNAMIC_ATMOSPHERE_LIGHTING) && (defined(ENABLE_VERTEX_LIGHTING) || defined(ENABLE_DAYNIGHT_SHADING))
float darken = clamp(dot(normalize(czm_viewerPositionWC), atmosphereLightDirection), u_minimumBrightness, 1.0);
fogColor *= darken;
#endif
#ifndef HDR
fogColor.rgb = czm_pbrNeutralTonemapping(fogColor.rgb);
fogColor.rgb = czm_inverseGamma(fogColor.rgb);
#endif
finalColor = vec4(czm_fog(v_distance, finalColor.rgb, fogColor.rgb, czm_fogVisualDensityScalar), finalColor.a);
#else
const float transmittanceModifier = 0.5;
float transmittance = transmittanceModifier + clamp(1.0 - groundAtmosphereColor.a, 0.0, 1.0);
vec3 finalAtmosphereColor = finalColor.rgb + groundAtmosphereColor.rgb * transmittance;
#if defined(DYNAMIC_ATMOSPHERE_LIGHTING) && (defined(ENABLE_VERTEX_LIGHTING) || defined(ENABLE_DAYNIGHT_SHADING))
float fadeInDist = u_nightFadeDistance.x;
float fadeOutDist = u_nightFadeDistance.y;
float sunlitAtmosphereIntensity = clamp((cameraDist - fadeOutDist) / (fadeInDist - fadeOutDist), 0.05, 1.0);
float darken = clamp(dot(normalize(positionWC), atmosphereLightDirection), 0.0, 1.0);
vec3 darkenendGroundAtmosphereColor = mix(groundAtmosphereColor.rgb, finalAtmosphereColor.rgb, darken);
finalAtmosphereColor = mix(darkenendGroundAtmosphereColor, finalAtmosphereColor, sunlitAtmosphereIntensity);
#endif
#ifndef HDR
finalAtmosphereColor.rgb = vec3(1.0) - exp(-fExposure * finalAtmosphereColor.rgb);
#else
finalAtmosphereColor.rgb = czm_saturation(finalAtmosphereColor.rgb, 1.6);
#endif
finalColor.rgb = mix(finalColor.rgb, finalAtmosphereColor.rgb, fade);
#endif
}
#endif
#ifdef UNDERGROUND_COLOR
if (czm_backFacing())
{
float distanceFromEllipsoid = max(czm_eyeHeight, 0.0);
float distance = max(v_distance - distanceFromEllipsoid, 0.0);
float blendAmount = interpolateByDistance(u_undergroundColorAlphaByDistance, distance);
vec4 undergroundColor = vec4(u_undergroundColor.rgb, u_undergroundColor.a * blendAmount);
finalColor = alphaBlend(undergroundColor, finalColor);
}
#endif
#ifdef TRANSLUCENT
if (inTranslucencyRectangle())
{
vec4 alphaByDistance = gl_FrontFacing ? u_frontFaceAlphaByDistance : u_backFaceAlphaByDistance;
finalColor.a *= interpolateByDistance(alphaByDistance, v_distance);
}
#endif
out_FragColor =  finalColor;
}
#ifdef SHOW_REFLECTIVE_OCEAN
float waveFade(float edge0, float edge1, float x)
{
float y = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);
return pow(1.0 - y, 5.0);
}
float linearFade(float edge0, float edge1, float x)
{
return clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);
}
const float oceanFrequencyLowAltitude = 825000.0;
const float oceanAnimationSpeedLowAltitude = 0.004;
const float oceanOneOverAmplitudeLowAltitude = 1.0 / 2.0;
const float oceanSpecularIntensity = 0.5;
const float oceanFrequencyHighAltitude = 125000.0;
const float oceanAnimationSpeedHighAltitude = 0.008;
const float oceanOneOverAmplitudeHighAltitude = 1.0 / 2.0;
vec4 computeWaterColor(vec3 positionEyeCoordinates, vec2 textureCoordinates, mat3 enuToEye, vec4 imageryColor, float maskValue, float fade)
{
vec3 positionToEyeEC = -positionEyeCoordinates;
float positionToEyeECLength = length(positionToEyeEC);
vec3 normalizedPositionToEyeEC = normalize(normalize(positionToEyeEC));
float waveIntensity = waveFade(70000.0, 1000000.0, positionToEyeECLength);
#ifdef SHOW_OCEAN_WAVES
float time = czm_frameNumber * oceanAnimationSpeedHighAltitude;
vec4 noise = czm_getWaterNoise(u_oceanNormalMap, textureCoordinates * oceanFrequencyHighAltitude, time, 0.0);
vec3 normalTangentSpaceHighAltitude = vec3(noise.xy, noise.z * oceanOneOverAmplitudeHighAltitude);
time = czm_frameNumber * oceanAnimationSpeedLowAltitude;
noise = czm_getWaterNoise(u_oceanNormalMap, textureCoordinates * oceanFrequencyLowAltitude, time, 0.0);
vec3 normalTangentSpaceLowAltitude = vec3(noise.xy, noise.z * oceanOneOverAmplitudeLowAltitude);
float highAltitudeFade = linearFade(0.0, 60000.0, positionToEyeECLength);
float lowAltitudeFade = 1.0 - linearFade(20000.0, 60000.0, positionToEyeECLength);
vec3 normalTangentSpace =
(highAltitudeFade * normalTangentSpaceHighAltitude) +
(lowAltitudeFade * normalTangentSpaceLowAltitude);
normalTangentSpace = normalize(normalTangentSpace);
normalTangentSpace.xy *= waveIntensity;
normalTangentSpace = normalize(normalTangentSpace);
#else
vec3 normalTangentSpace = vec3(0.0, 0.0, 1.0);
#endif
vec3 normalEC = enuToEye * normalTangentSpace;
const vec3 waveHighlightColor = vec3(0.3, 0.45, 0.6);
float diffuseIntensity = czm_getLambertDiffuse(czm_lightDirectionEC, normalEC) * maskValue;
vec3 diffuseHighlight = waveHighlightColor * diffuseIntensity * (1.0 - fade);
#ifdef SHOW_OCEAN_WAVES
float tsPerturbationRatio = normalTangentSpace.z;
vec3 nonDiffuseHighlight = mix(waveHighlightColor * 5.0 * (1.0 - tsPerturbationRatio), vec3(0.0), diffuseIntensity);
#else
vec3 nonDiffuseHighlight = vec3(0.0);
#endif
float specularIntensity = czm_getSpecular(czm_lightDirectionEC, normalizedPositionToEyeEC, normalEC, 10.0);
float surfaceReflectance = mix(0.0, mix(u_zoomedOutOceanSpecularIntensity, oceanSpecularIntensity, waveIntensity), maskValue);
float specular = specularIntensity * surfaceReflectance;
#ifdef HDR
specular *= 1.4;
float e = 0.2;
float d = 3.3;
float c = 1.7;
vec3 color = imageryColor.rgb + (c * (vec3(e) + imageryColor.rgb * d) * (diffuseHighlight + nonDiffuseHighlight + specular));
#else
vec3 color = imageryColor.rgb + diffuseHighlight + nonDiffuseHighlight + specular;
#endif
return vec4(color, imageryColor.a);
}
#endif // #ifdef SHOW_REFLECTIVE_OCEAN
`;var z7=`#ifdef QUANTIZATION_BITS12
in vec4 compressed0;
in float compressed1;
#else
in vec4 position3DAndHeight;
in vec4 textureCoordAndEncodedNormals;
#endif
#ifdef GEODETIC_SURFACE_NORMALS
in vec3 geodeticSurfaceNormal;
#endif
#ifdef EXAGGERATION
uniform vec2 u_verticalExaggerationAndRelativeHeight;
#endif
uniform vec3 u_center3D;
uniform mat4 u_modifiedModelView;
uniform mat4 u_modifiedModelViewProjection;
uniform vec4 u_tileRectangle;
uniform vec2 u_southAndNorthLatitude;
uniform vec2 u_southMercatorYAndOneOverHeight;
out vec3 v_positionMC;
out vec3 v_positionEC;
out vec3 v_textureCoordinates;
out vec3 v_normalMC;
out vec3 v_normalEC;
#ifdef APPLY_MATERIAL
out float v_slope;
out float v_aspect;
out float v_height;
#endif
#if defined(FOG) || defined(GROUND_ATMOSPHERE) || defined(UNDERGROUND_COLOR) || defined(TRANSLUCENT)
out float v_distance;
#endif
#if defined(FOG) || defined(GROUND_ATMOSPHERE)
out vec3 v_atmosphereRayleighColor;
out vec3 v_atmosphereMieColor;
out float v_atmosphereOpacity;
#endif
#ifdef ENABLE_CLIPPING_POLYGONS
uniform highp sampler2D u_clippingExtents;
out vec2 v_clippingPosition;
flat out int v_regionIndex;
#endif
vec4 getPosition(vec3 position, float height, vec2 textureCoordinates);
float get2DYPositionFraction(vec2 textureCoordinates);
vec4 getPosition3DMode(vec3 position, float height, vec2 textureCoordinates)
{
return u_modifiedModelViewProjection * vec4(position, 1.0);
}
float get2DMercatorYPositionFraction(vec2 textureCoordinates)
{
const float maxTileWidth = 0.003068;
float positionFraction = textureCoordinates.y;
float southLatitude = u_southAndNorthLatitude.x;
float northLatitude = u_southAndNorthLatitude.y;
if (northLatitude - southLatitude > maxTileWidth)
{
float southMercatorY = u_southMercatorYAndOneOverHeight.x;
float oneOverMercatorHeight = u_southMercatorYAndOneOverHeight.y;
float currentLatitude = mix(southLatitude, northLatitude, textureCoordinates.y);
currentLatitude = clamp(currentLatitude, -czm_webMercatorMaxLatitude, czm_webMercatorMaxLatitude);
positionFraction = czm_latitudeToWebMercatorFraction(currentLatitude, southMercatorY, oneOverMercatorHeight);
}
return positionFraction;
}
float get2DGeographicYPositionFraction(vec2 textureCoordinates)
{
return textureCoordinates.y;
}
vec4 getPositionPlanarEarth(vec3 position, float height, vec2 textureCoordinates)
{
float yPositionFraction = get2DYPositionFraction(textureCoordinates);
vec4 rtcPosition2D = vec4(height, mix(u_tileRectangle.st, u_tileRectangle.pq, vec2(textureCoordinates.x, yPositionFraction)), 1.0);
return u_modifiedModelViewProjection * rtcPosition2D;
}
vec4 getPosition2DMode(vec3 position, float height, vec2 textureCoordinates)
{
return getPositionPlanarEarth(position, 0.0, textureCoordinates);
}
vec4 getPositionColumbusViewMode(vec3 position, float height, vec2 textureCoordinates)
{
return getPositionPlanarEarth(position, height, textureCoordinates);
}
vec4 getPositionMorphingMode(vec3 position, float height, vec2 textureCoordinates)
{
vec3 position3DWC = position + u_center3D;
float yPositionFraction = get2DYPositionFraction(textureCoordinates);
vec4 position2DWC = vec4(height, mix(u_tileRectangle.st, u_tileRectangle.pq, vec2(textureCoordinates.x, yPositionFraction)), 1.0);
vec4 morphPosition = czm_columbusViewMorph(position2DWC, vec4(position3DWC, 1.0), czm_morphTime);
return czm_modelViewProjection * morphPosition;
}
#ifdef QUANTIZATION_BITS12
uniform vec2 u_minMaxHeight;
uniform mat4 u_scaleAndBias;
#endif
void main()
{
#ifdef QUANTIZATION_BITS12
vec2 xy = czm_decompressTextureCoordinates(compressed0.x);
vec2 zh = czm_decompressTextureCoordinates(compressed0.y);
vec3 position = vec3(xy, zh.x);
float height = zh.y;
vec2 textureCoordinates = czm_decompressTextureCoordinates(compressed0.z);
height = height * (u_minMaxHeight.y - u_minMaxHeight.x) + u_minMaxHeight.x;
position = (u_scaleAndBias * vec4(position, 1.0)).xyz;
#if (defined(ENABLE_VERTEX_LIGHTING) || defined(GENERATE_POSITION_AND_NORMAL)) && defined(INCLUDE_WEB_MERCATOR_Y) || defined(APPLY_MATERIAL)
float webMercatorT = czm_decompressTextureCoordinates(compressed0.w).x;
float encodedNormal = compressed1;
#elif defined(INCLUDE_WEB_MERCATOR_Y)
float webMercatorT = czm_decompressTextureCoordinates(compressed0.w).x;
float encodedNormal = 0.0;
#elif defined(ENABLE_VERTEX_LIGHTING) || defined(GENERATE_POSITION_AND_NORMAL)
float webMercatorT = textureCoordinates.y;
float encodedNormal = compressed0.w;
#else
float webMercatorT = textureCoordinates.y;
float encodedNormal = 0.0;
#endif
#else
vec3 position = position3DAndHeight.xyz;
float height = position3DAndHeight.w;
vec2 textureCoordinates = textureCoordAndEncodedNormals.xy;
#if (defined(ENABLE_VERTEX_LIGHTING) || defined(GENERATE_POSITION_AND_NORMAL) || defined(APPLY_MATERIAL)) && defined(INCLUDE_WEB_MERCATOR_Y)
float webMercatorT = textureCoordAndEncodedNormals.z;
float encodedNormal = textureCoordAndEncodedNormals.w;
#elif defined(ENABLE_VERTEX_LIGHTING) || defined(GENERATE_POSITION_AND_NORMAL) || defined(APPLY_MATERIAL)
float webMercatorT = textureCoordinates.y;
float encodedNormal = textureCoordAndEncodedNormals.z;
#elif defined(INCLUDE_WEB_MERCATOR_Y)
float webMercatorT = textureCoordAndEncodedNormals.z;
float encodedNormal = 0.0;
#else
float webMercatorT = textureCoordinates.y;
float encodedNormal = 0.0;
#endif
#endif
vec3 position3DWC = position + u_center3D;
#ifdef GEODETIC_SURFACE_NORMALS
vec3 ellipsoidNormal = geodeticSurfaceNormal;
#else
vec3 ellipsoidNormal = normalize(position3DWC);
#endif
#if defined(EXAGGERATION) && defined(GEODETIC_SURFACE_NORMALS)
float exaggeration = u_verticalExaggerationAndRelativeHeight.x;
float relativeHeight = u_verticalExaggerationAndRelativeHeight.y;
float newHeight = (height - relativeHeight) * exaggeration + relativeHeight;
float minRadius = min(min(czm_ellipsoidRadii.x, czm_ellipsoidRadii.y), czm_ellipsoidRadii.z);
newHeight = max(newHeight, -minRadius);
vec3 offset = ellipsoidNormal * (newHeight - height);
position += offset;
position3DWC += offset;
height = newHeight;
#endif
gl_Position = getPosition(position, height, textureCoordinates);
v_positionEC = (u_modifiedModelView * vec4(position, 1.0)).xyz;
v_positionMC = position3DWC;
v_textureCoordinates = vec3(textureCoordinates, webMercatorT);
#if defined(ENABLE_VERTEX_LIGHTING) || defined(GENERATE_POSITION_AND_NORMAL) || defined(APPLY_MATERIAL)
vec3 normalMC = czm_octDecode(encodedNormal);
#if defined(EXAGGERATION) && defined(GEODETIC_SURFACE_NORMALS)
vec3 projection = dot(normalMC, ellipsoidNormal) * ellipsoidNormal;
vec3 rejection = normalMC - projection;
normalMC = normalize(projection + rejection * exaggeration);
#endif
v_normalMC = normalMC;
v_normalEC = czm_normal3D * v_normalMC;
#endif
#ifdef ENABLE_CLIPPING_POLYGONS
vec2 sphericalLatLong = czm_approximateSphericalCoordinates(position3DWC);
sphericalLatLong.y = czm_branchFreeTernary(sphericalLatLong.y < czm_pi, sphericalLatLong.y, sphericalLatLong.y - czm_twoPi);
vec2 minDistance = vec2(czm_infinity);
v_clippingPosition = vec2(czm_infinity);
v_regionIndex = -1;
for (int regionIndex = 0; regionIndex < CLIPPING_POLYGON_REGIONS_LENGTH; regionIndex++) {
vec4 extents = unpackClippingExtents(u_clippingExtents, regionIndex);
vec2 rectUv = (sphericalLatLong.yx - extents.yx) * extents.wz;
vec2 clamped = clamp(rectUv, vec2(0.0), vec2(1.0));
vec2 distance = abs(rectUv - clamped) * extents.wz;
float threshold = 0.01;
if (minDistance.x > distance.x || minDistance.y > distance.y) {
minDistance = distance;
v_clippingPosition = rectUv;
if (rectUv.x > threshold && rectUv.y > threshold && rectUv.x < 1.0 - threshold && rectUv.y < 1.0 - threshold) {
v_regionIndex = regionIndex;
}
}
}
#endif
#if defined(FOG) || (defined(GROUND_ATMOSPHERE) && !defined(PER_FRAGMENT_GROUND_ATMOSPHERE))
bool dynamicLighting = false;
#if defined(DYNAMIC_ATMOSPHERE_LIGHTING) && (defined(ENABLE_DAYNIGHT_SHADING) || defined(ENABLE_VERTEX_LIGHTING))
dynamicLighting = true;
#endif
#if defined(DYNAMIC_ATMOSPHERE_LIGHTING_FROM_SUN)
vec3 atmosphereLightDirection = czm_sunDirectionWC;
#else
vec3 atmosphereLightDirection = czm_lightDirectionWC;
#endif
vec3 lightDirection = czm_branchFreeTernary(dynamicLighting, atmosphereLightDirection, normalize(position3DWC));
computeAtmosphereScattering(
position3DWC,
lightDirection,
v_atmosphereRayleighColor,
v_atmosphereMieColor,
v_atmosphereOpacity
);
#endif
#if defined(FOG) || defined(GROUND_ATMOSPHERE) || defined(UNDERGROUND_COLOR) || defined(TRANSLUCENT)
v_distance = length((czm_modelView3D * vec4(position3DWC, 1.0)).xyz);
#endif
#ifdef APPLY_MATERIAL
float northPoleZ = czm_ellipsoidRadii.z;
vec3 northPolePositionMC = vec3(0.0, 0.0, northPoleZ);
vec3 vectorEastMC = normalize(cross(northPolePositionMC - v_positionMC, ellipsoidNormal));
float dotProd = abs(dot(ellipsoidNormal, v_normalMC));
v_slope = acos(dotProd);
vec3 normalRejected = ellipsoidNormal * dotProd;
vec3 normalProjected = v_normalMC - normalRejected;
vec3 aspectVector = normalize(normalProjected);
v_aspect = acos(dot(aspectVector, vectorEastMC));
float determ = dot(cross(vectorEastMC, aspectVector), ellipsoidNormal);
v_aspect = czm_branchFreeTernary(determ < 0.0, 2.0 * czm_pi - v_aspect, v_aspect);
v_height = height;
#endif
}
`;var dN=`void computeAtmosphereScattering(vec3 positionWC, vec3 lightDirection, out vec3 rayleighColor, out vec3 mieColor, out float opacity) {
vec3 cameraToPositionWC = positionWC - czm_viewerPositionWC;
vec3 cameraToPositionWCDirection = normalize(cameraToPositionWC);
czm_ray primaryRay = czm_ray(czm_viewerPositionWC, cameraToPositionWCDirection);
float atmosphereInnerRadius = length(positionWC);
computeScattering(
primaryRay,
length(cameraToPositionWC),
lightDirection,
atmosphereInnerRadius,
rayleighColor,
mieColor,
opacity
);
}
`;function Kdt(e,t,n,i,o,r){this.numberOfDayTextures=e,this.flags=t,this.material=n,this.shaderProgram=i,this.clippingShaderState=o,this.clippingPolygonShaderState=r}function H7(){this.baseVertexShaderSource=void 0,this.baseFragmentShaderSource=void 0,this._shadersByTexturesFlags=[],this.material=void 0}function $dt(e){let t="vec4 getPosition(vec3 position, float height, vec2 textureCoordinates) { return getPosition3DMode(position, height, textureCoordinates); }",n="vec4 getPosition(vec3 position, float height, vec2 textureCoordinates) { return getPositionColumbusViewMode(position, height, textureCoordinates); }",i="vec4 getPosition(vec3 position, float height, vec2 textureCoordinates) { return getPositionMorphingMode(position, height, textureCoordinates); }",o;switch(e){case oe.SCENE3D:o=t;break;case oe.SCENE2D:case oe.COLUMBUS_VIEW:o=n;break;case oe.MORPHING:o=i;break}return o}function Zdt(e){return e.webgl2?`void clipPolygons(highp sampler2D clippingDistance, int regionsLength, vec2 clippingPosition, int regionIndex) {
    czm_clipPolygons(clippingDistance, regionsLength, clippingPosition, regionIndex);
  }`:`void clipPolygons(highp sampler2D clippingDistance, int regionsLength, vec2 clippingPosition, int regionIndex) {
    }`}function Jdt(e){return e.webgl2?`vec4 unpackClippingExtents(highp sampler2D extentsTexture, int index) {
    return czm_unpackClippingExtents(extentsTexture, index);
  }`:`vec4 unpackClippingExtents(highp sampler2D extentsTexture, int index) {
      return vec4();
    }`}function Qdt(e){return e?"float get2DYPositionFraction(vec2 textureCoordinates) { return get2DMercatorYPositionFraction(textureCoordinates); }":"float get2DYPositionFraction(vec2 textureCoordinates) { return get2DGeographicYPositionFraction(textureCoordinates); }"}H7.prototype.getShaderProgram=function(e){let t=e.frameState,n=e.surfaceTile,i=e.numberOfDayTextures,o=e.applyBrightness,r=e.applyContrast,s=e.applyHue,a=e.applySaturation,l=e.applyGamma,u=e.applyAlpha,f=e.applyDayNightAlpha,d=e.applySplit,p=e.hasWaterMask,g=e.showReflectiveOcean,m=e.showOceanWaves,b=e.enableLighting,x=e.dynamicAtmosphereLighting,T=e.dynamicAtmosphereLightingFromSun,C=e.showGroundAtmosphere,S=e.perFragmentGroundAtmosphere,v=e.hasVertexNormals,D=e.useWebMercatorProjection,I=e.enableFog,L=e.enableClippingPlanes,M=e.clippingPlanes,N=e.enableClippingPolygons,B=e.clippingPolygons,_=e.clippedByBoundaries,w=e.hasImageryLayerCutout,P=e.colorCorrect,O=e.highlightFillTile,F=e.colorToAlpha,V=e.hasGeodeticSurfaceNormals,G=e.hasExaggeration,z=e.showUndergroundColor,W=e.translucent,U=0,q="",te=n.renderedMesh.encoding;te.quantization===Ta.BITS12&&(U=1,q="QUANTIZATION_BITS12");let Z=0,ee="";_&&(Z=1,ee="TILE_LIMIT_RECTANGLE");let me=0,be="";w&&(me=1,be="APPLY_IMAGERY_CUTOUT");let le=t.mode,ge=le|o<<2|r<<3|s<<4|a<<5|l<<6|u<<7|p<<8|g<<9|m<<10|b<<11|x<<12|T<<13|C<<14|S<<15|v<<16|D<<17|I<<18|U<<19|d<<20|L<<21|N<<22|Z<<23|me<<24|P<<25|O<<26|F<<27|V<<28|G<<29|z<<30|W<<31|f<<32,xe=0;c(M)&&M.length>0&&(xe=L?M.clippingPlanesState:0);let Pe=0;c(B)&&B.length>0&&(Pe=N?B.clippingPolygonsState:0);let Ee=n.surfaceShader;if(c(Ee)&&Ee.numberOfDayTextures===i&&Ee.flags===ge&&Ee.material===this.material&&Ee.clippingShaderState===xe&&Ee.clippingPolygonShaderState===Pe)return Ee.shaderProgram;let Ue=this._shadersByTexturesFlags[i];if(c(Ue)||(Ue=this._shadersByTexturesFlags[i]=[]),Ee=Ue[ge],!c(Ee)||Ee.material!==this.material||Ee.clippingShaderState!==xe||Ee.clippingPolygonShaderState!==Pe){let Ye=this.baseVertexShaderSource.clone(),it=this.baseFragmentShaderSource.clone();xe!==0&&it.sources.unshift(Hb(M,t.context)),Pe!==0&&(it.sources.unshift(Zdt(t.context)),Ye.sources.unshift(Jdt(t.context))),Ye.defines.push(q),it.defines.push(`TEXTURE_UNITS ${i}`,ee,be),o&&it.defines.push("APPLY_BRIGHTNESS"),r&&it.defines.push("APPLY_CONTRAST"),s&&it.defines.push("APPLY_HUE"),a&&it.defines.push("APPLY_SATURATION"),l&&it.defines.push("APPLY_GAMMA"),u&&it.defines.push("APPLY_ALPHA"),f&&it.defines.push("APPLY_DAY_NIGHT_ALPHA"),p&&it.defines.push("HAS_WATER_MASK"),g&&(it.defines.push("SHOW_REFLECTIVE_OCEAN"),Ye.defines.push("SHOW_REFLECTIVE_OCEAN")),m&&it.defines.push("SHOW_OCEAN_WAVES"),F&&it.defines.push("APPLY_COLOR_TO_ALPHA"),z&&(Ye.defines.push("UNDERGROUND_COLOR"),it.defines.push("UNDERGROUND_COLOR")),W&&(Ye.defines.push("TRANSLUCENT"),it.defines.push("TRANSLUCENT")),b&&(v?(Ye.defines.push("ENABLE_VERTEX_LIGHTING"),it.defines.push("ENABLE_VERTEX_LIGHTING")):(Ye.defines.push("ENABLE_DAYNIGHT_SHADING"),it.defines.push("ENABLE_DAYNIGHT_SHADING"))),x&&(Ye.defines.push("DYNAMIC_ATMOSPHERE_LIGHTING"),it.defines.push("DYNAMIC_ATMOSPHERE_LIGHTING"),T&&(Ye.defines.push("DYNAMIC_ATMOSPHERE_LIGHTING_FROM_SUN"),it.defines.push("DYNAMIC_ATMOSPHERE_LIGHTING_FROM_SUN"))),C&&(Ye.defines.push("GROUND_ATMOSPHERE"),it.defines.push("GROUND_ATMOSPHERE"),S&&(Ye.defines.push("PER_FRAGMENT_GROUND_ATMOSPHERE"),it.defines.push("PER_FRAGMENT_GROUND_ATMOSPHERE"))),Ye.defines.push("INCLUDE_WEB_MERCATOR_Y"),it.defines.push("INCLUDE_WEB_MERCATOR_Y"),I&&(Ye.defines.push("FOG"),it.defines.push("FOG")),d&&it.defines.push("APPLY_SPLIT"),L&&it.defines.push("ENABLE_CLIPPING_PLANES"),N&&(it.defines.push("ENABLE_CLIPPING_POLYGONS"),Ye.defines.push("ENABLE_CLIPPING_POLYGONS"),B.inverse&&it.defines.push("CLIPPING_INVERSE"),it.defines.push(`CLIPPING_POLYGON_REGIONS_LENGTH ${B.extentsCount}`),Ye.defines.push(`CLIPPING_POLYGON_REGIONS_LENGTH ${B.extentsCount}`)),P&&it.defines.push("COLOR_CORRECT"),O&&it.defines.push("HIGHLIGHT_FILL_TILE"),V&&Ye.defines.push("GEODETIC_SURFACE_NORMALS"),G&&Ye.defines.push("EXAGGERATION");let It=`    vec4 computeDayColor(vec4 initialColor, vec3 textureCoordinates, float nightBlend)
    {
        vec4 color = initialColor;
`;w&&(It+=`        vec4 cutoutAndColorResult;
        bool texelUnclipped;
`);for(let He=0;He<i;++He)w?It+=`        cutoutAndColorResult = u_dayTextureCutoutRectangles[${He}];
        texelUnclipped = v_textureCoordinates.x < cutoutAndColorResult.x || cutoutAndColorResult.z < v_textureCoordinates.x || v_textureCoordinates.y < cutoutAndColorResult.y || cutoutAndColorResult.w < v_textureCoordinates.y;
        cutoutAndColorResult = sampleAndBlend(
`:It+=`        color = sampleAndBlend(
`,It+=`            color,
            u_dayTextures[${He}],
            u_dayTextureUseWebMercatorT[${He}] ? textureCoordinates.xz : textureCoordinates.xy,
            u_dayTextureTexCoordsRectangle[${He}],
            u_dayTextureTranslationAndScale[${He}],
            ${u?`u_dayTextureAlpha[${He}]`:"1.0"},
            ${f?`u_dayTextureNightAlpha[${He}]`:"1.0"},
${f?`u_dayTextureDayAlpha[${He}]`:"1.0"},
${o?`u_dayTextureBrightness[${He}]`:"0.0"},
            ${r?`u_dayTextureContrast[${He}]`:"0.0"},
            ${s?`u_dayTextureHue[${He}]`:"0.0"},
            ${a?`u_dayTextureSaturation[${He}]`:"0.0"},
            ${l?`u_dayTextureOneOverGamma[${He}]`:"0.0"},
            ${d?`u_dayTextureSplit[${He}]`:"0.0"},
            ${F?`u_colorsToAlpha[${He}]`:"vec4(0.0)"},
        nightBlend        );
`,w&&(It+=`        color = czm_branchFreeTernary(texelUnclipped, cutoutAndColorResult, color);
`);It+=`        return color;
    }`,it.sources.push(It),Ye.sources.push($dt(le)),Ye.sources.push(Qdt(D));let Ot=an.fromCache({context:t.context,vertexShaderSource:Ye,fragmentShaderSource:it,attributeLocations:te.getAttributeLocations()});Ee=Ue[ge]=new Kdt(i,ge,this.material,Ot,xe,Pe)}return n.surfaceShader=Ee,Ee.shaderProgram};H7.prototype.destroy=function(){let e,t,n=this._shadersByTexturesFlags;for(let i in n)if(n.hasOwnProperty(i)){let o=n[i];if(!c(o))continue;for(e in o)o.hasOwnProperty(e)&&(t=o[e],c(t)&&t.shaderProgram.destroy())}return de(this)};var G7=H7;var eht={UNLOADED:0,TRANSITIONING:1,RECEIVED:2,TEXTURE_LOADED:3,READY:4,FAILED:5,INVALID:6,PLACEHOLDER:7},ci=Object.freeze(eht);var tht={START:0,LOADING:1,DONE:2,FAILED:3},Sa=Object.freeze(tht);var nht={FAILED:0,UNLOADED:1,RECEIVING:2,RECEIVED:3,TRANSFORMING:4,TRANSFORMED:5,READY:6},mo=Object.freeze(nht);function $o(){this.imagery=[],this.waterMaskTexture=void 0,this.waterMaskTranslationAndScale=new se(0,0,1,1),this.terrainData=void 0,this.vertexArray=void 0,this.tileBoundingRegion=void 0,this.occludeePointInScaledSpace=new h,this.boundingVolumeSourceTile=void 0,this.boundingVolumeIsFromMesh=!1,this.terrainState=mo.UNLOADED,this.mesh=void 0,this.fill=void 0,this.pickBoundingSphere=new ce,this.surfaceShader=void 0,this.isClipped=!0,this.clippedByBoundaries=!1}Object.defineProperties($o.prototype,{eligibleForUnloading:{get:function(){let e=this.terrainState,n=!(e===mo.RECEIVING||e===mo.TRANSFORMING),i=this.imagery;for(let o=0,r=i.length;n&&o<r;++o){let s=i[o];n=!c(s.loadingImagery)||s.loadingImagery.state!==ci.TRANSITIONING}return n}},renderedMesh:{get:function(){if(c(this.vertexArray))return this.mesh;if(c(this.fill))return this.fill.mesh}}});var iht=new he;function j7(e,t,n,i,o,r){let s=e.getExaggeratedPosition(i,o,r);if(c(t)&&t!==oe.SCENE3D){let l=n.ellipsoid.cartesianToCartographic(s,iht);s=n.project(l,r),s=h.fromElements(s.z,s.x,s.y,r)}return s}var oht=new h,rht=new h,sht=new h;$o.prototype.pick=function(e,t,n,i,o){let r=this.renderedMesh;if(!c(r))return;let s=r.vertices,a=r.indices,l=r.encoding,u=a.length,f=Number.MAX_VALUE;for(let d=0;d<u;d+=3){let p=a[d],g=a[d+1],m=a[d+2],b=j7(l,t,n,s,p,oht),x=j7(l,t,n,s,g,rht),T=j7(l,t,n,s,m,sht),C=Qn.rayTriangleParametric(e,b,x,T,i);c(C)&&C<f&&C>=0&&(f=C)}return f!==Number.MAX_VALUE?_n.getPoint(e,f,o):void 0};$o.prototype.freeResources=function(){c(this.waterMaskTexture)&&(--this.waterMaskTexture.referenceCount,this.waterMaskTexture.referenceCount===0&&this.waterMaskTexture.destroy(),this.waterMaskTexture=void 0),this.terrainData=void 0,this.terrainState=mo.UNLOADED,this.mesh=void 0,this.fill=this.fill&&this.fill.destroy();let e=this.imagery;for(let t=0,n=e.length;t<n;++t)e[t].freeResources();this.imagery.length=0,this.freeVertexArray()};$o.prototype.freeVertexArray=function(){$o._freeVertexArray(this.vertexArray),this.vertexArray=void 0,$o._freeVertexArray(this.wireframeVertexArray),this.wireframeVertexArray=void 0};$o.initialize=function(e,t,n){let i=e.data;c(i)||(i=e.data=new $o),e.state===Sa.START&&(aht(e,t,n),e.state=Sa.LOADING)};$o.processStateMachine=function(e,t,n,i,o,r,s){$o.initialize(e,n,i);let a=e.data;if(e.state===Sa.LOADING&&cht(e,t,n,i,o,r),s)return;let l=e.renderable;e.renderable=c(a.vertexArray);let u=a.terrainState===mo.READY;e.upsampledFromParent=c(a.terrainData)&&a.terrainData.wasCreatedByUpsampling();let f=a.processImagery(e,n,t);if(u&&f){let d=e._loadedCallbacks,p={};for(let g in d)d.hasOwnProperty(g)&&(d[g](e)||(p[g]=d[g]));e._loadedCallbacks=p,e.state=Sa.DONE}l&&(e.renderable=!0)};$o.prototype.processImagery=function(e,t,n,i){let o=e.data,r=e.upsampledFromParent,s=!1,a=!0,l=o.imagery,u,f;for(u=0,f=l.length;u<f;++u){let d=l[u];if(!c(d.loadingImagery)){r=!1;continue}if(d.loadingImagery.state===ci.PLACEHOLDER){let g=d.loadingImagery.imageryLayer;if(g.ready){d.freeResources(),l.splice(u,1),g._createTileImagerySkeletons(e,t,u),--u,f=l.length;continue}else r=!1}let p=d.processStateMachine(e,n,i);a=a&&p,s=s||p||c(d.readyImagery),r=r&&c(d.loadingImagery)&&(d.loadingImagery.state===ci.FAILED||d.loadingImagery.state===ci.INVALID)}return e.upsampledFromParent=r,e.renderable=e.renderable&&(s||a),a};function g0e(e,t,n,i){let o=e.renderedMesh,r=o.vertices,s=o.encoding,a=r.length/s.stride,l=xl.clone(s);l.hasGeodeticSurfaceNormals=t,l=xl.clone(l);let u=l.stride,f=new Float32Array(a*u);t?s.addGeodeticSurfaceNormals(r,f,n):s.removeGeodeticSurfaceNormals(r,f),o.vertices=f,o.stride=u,o!==e.mesh?($o._freeVertexArray(e.fill.vertexArray),e.fill.vertexArray=$o._createVertexArrayForMesh(i.context,o)):($o._freeVertexArray(e.vertexArray),e.vertexArray=$o._createVertexArrayForMesh(i.context,o)),$o._freeVertexArray(e.wireframeVertexArray),e.wireframeVertexArray=void 0}$o.prototype.addGeodeticSurfaceNormals=function(e,t){g0e(this,!0,e,t)};$o.prototype.removeGeodeticSurfaceNormals=function(e){g0e(this,!1,void 0,e)};$o.prototype.updateExaggeration=function(e,t,n){let i=this,o=i.renderedMesh;if(o===void 0)return;let r=t.verticalExaggeration,s=t.verticalExaggerationRelativeHeight,a=r!==1,l=o.encoding,u=l.exaggeration!==r,f=l.exaggerationRelativeHeight!==s;if(u||f){if(u)if(a&&!l.hasGeodeticSurfaceNormals){let d=e.tilingScheme.ellipsoid;i.addGeodeticSurfaceNormals(d,t)}else!a&&l.hasGeodeticSurfaceNormals&&i.removeGeodeticSurfaceNormals(t);if(l.exaggeration=r,l.exaggerationRelativeHeight=s,n!==void 0){n._tileToUpdateHeights.push(e);let d=e.customData,p=d.length;for(let g=0;g<p;g++){let m=d[g];m.level=-1}}}};function aht(e,t,n){let i=t.getTileDataAvailable(e.x,e.y,e.level);if(!c(i)&&c(e.parent)){let o=e.parent,r=o.data;c(r)&&c(r.terrainData)&&(i=r.terrainData.isChildAvailable(o.x,o.y,e.x,e.y))}i===!1&&(e.data.terrainState=mo.FAILED);for(let o=0,r=n.length;o<r;++o){let s=n.get(o);s.show&&s._createTileImagerySkeletons(e,t)}}function cht(e,t,n,i,o,r){let s=e.data,a=e.parent;if(s.terrainState===mo.FAILED&&a!==void 0&&(a.data!==void 0&&a.data.terrainData!==void 0&&a.data.terrainData.canUpsample!==!1||$o.processStateMachine(a,t,n,i,o,r,!0)),s.terrainState===mo.FAILED&&lht(s,e,t,n,e.x,e.y,e.level),s.terrainState===mo.UNLOADED&&uht(s,n,e.x,e.y,e.level),s.terrainState===mo.RECEIVED&&dht(s,t,n,e.x,e.y,e.level),s.terrainState===mo.TRANSFORMED&&(hht(s,t.context,n,e.x,e.y,e.level,r),s.updateExaggeration(e,t,o)),s.terrainState>=mo.RECEIVED&&s.waterMaskTexture===void 0&&n.hasWaterMask)if(s.terrainData.waterMask!==void 0)pht(t.context,s);else{let u=s._findAncestorTileWithTerrainData(e);c(u)&&c(u.data.waterMaskTexture)&&(s.waterMaskTexture=u.data.waterMaskTexture,++s.waterMaskTexture.referenceCount,s._computeWaterMaskTranslationAndScale(e,u,s.waterMaskTranslationAndScale))}}function lht(e,t,n,i,o,r,s){let a=t.parent;if(!a){t.state=Sa.FAILED;return}let l=a.data.terrainData,u=a.x,f=a.y,d=a.level;if(!c(l))return;let p=l.upsample(i.tilingScheme,u,f,d,o,r,s);c(p)&&(e.terrainState=mo.RECEIVING,Promise.resolve(p).then(function(g){c(g)&&(e.terrainData=g,e.terrainState=mo.RECEIVED)}).catch(function(){e.terrainState=mo.FAILED}))}function uht(e,t,n,i,o){function r(l){if(!c(l)){e.terrainState=mo.UNLOADED,e.request=void 0;return}e.terrainData=l,e.terrainState=mo.RECEIVED,e.request=void 0}function s(l){if(e.request.state===Jn.CANCELLED){e.terrainData=void 0,e.terrainState=mo.UNLOADED,e.request=void 0;return}e.terrainState=mo.FAILED,e.request=void 0;let u=`Failed to obtain terrain tile X: ${n} Y: ${i} Level: ${o}. Error message: "${l}"`;t._requestError=No.reportError(t._requestError,t,t.errorEvent,u,n,i,o),t._requestError.retry&&a()}function a(){let l=new ur({throttle:!1,throttleByServer:!0,type:Es.TERRAIN});e.request=l;let u=t.requestTileGeometry(n,i,o,l);c(u)?(e.terrainState=mo.RECEIVING,Promise.resolve(u).then(function(f){r(f)}).catch(function(f){s(f)})):(e.terrainState=mo.UNLOADED,e.request=void 0)}a()}var fht={tilingScheme:void 0,x:0,y:0,level:0,exaggeration:1,exaggerationRelativeHeight:0,throttle:!0};function dht(e,t,n,i,o,r){let s=n.tilingScheme,a=fht;a.tilingScheme=s,a.x=i,a.y=o,a.level=r,a.exaggeration=t.verticalExaggeration,a.exaggerationRelativeHeight=t.verticalExaggerationRelativeHeight,a.throttle=!0;let u=e.terrainData.createMesh(a);c(u)&&(e.terrainState=mo.TRANSFORMING,Promise.resolve(u).then(function(f){e.mesh=f,e.terrainState=mo.TRANSFORMED}).catch(function(){e.terrainState=mo.FAILED}))}$o._createVertexArrayForMesh=function(e,t){let n=t.vertices,i=xt.createVertexBuffer({context:e,typedArray:n,usage:ke.STATIC_DRAW}),o=t.encoding.getAttributes(i),r=t.indices.indexBuffers||{},s=r[e.id];if(!c(s)||s.isDestroyed()){let a=t.indices;s=xt.createIndexBuffer({context:e,typedArray:a,usage:ke.STATIC_DRAW,indexDatatype:Fe.fromSizeInBytes(a.BYTES_PER_ELEMENT)}),s.vertexArrayDestroyable=!1,s.referenceCount=1,r[e.id]=s,t.indices.indexBuffers=r}else++s.referenceCount;return new ni({context:e,attributes:o,indexBuffer:s})};$o._freeVertexArray=function(e){if(c(e)){let t=e.indexBuffer;e.isDestroyed()||e.destroy(),c(t)&&!t.isDestroyed()&&c(t.referenceCount)&&(--t.referenceCount,t.referenceCount===0&&t.destroy())}};function hht(e,t,n,i,o,r,s){e.vertexArray=$o._createVertexArrayForMesh(t,e.mesh),e.terrainState=mo.READY,e.fill=e.fill&&e.fill.destroy(s)}function mht(e){let t=e.cache.tile_waterMaskData;if(!c(t)){let n=Lt.create({context:e,pixelFormat:Ve.LUMINANCE,pixelDatatype:Be.UNSIGNED_BYTE,source:{arrayBufferView:new Uint8Array([255]),width:1,height:1}});n.referenceCount=1;let i=new Qt({wrapS:yn.CLAMP_TO_EDGE,wrapT:yn.CLAMP_TO_EDGE,minificationFilter:$t.LINEAR,magnificationFilter:fi.LINEAR});t={allWaterTexture:n,sampler:i,destroy:function(){this.allWaterTexture.destroy()}},e.cache.tile_waterMaskData=t}return t}function pht(e,t){let n=t.terrainData.waterMask,i=mht(e),o,r=n.length;if(r===1)if(n[0]!==0)o=i.allWaterTexture;else return;else{let s=Math.sqrt(r);o=Lt.create({context:e,pixelFormat:Ve.LUMINANCE,pixelDatatype:Be.UNSIGNED_BYTE,source:{width:s,height:s,arrayBufferView:n},sampler:i.sampler,flipY:!1}),o.referenceCount=0}++o.referenceCount,t.waterMaskTexture=o,se.fromElements(0,0,1,1,t.waterMaskTranslationAndScale)}$o.prototype._findAncestorTileWithTerrainData=function(e){let t=e.parent;for(;c(t)&&(!c(t.data)||!c(t.data.terrainData)||t.data.terrainData.wasCreatedByUpsampling());)t=t.parent;return t};$o.prototype._computeWaterMaskTranslationAndScale=function(e,t,n){let i=t.rectangle,o=e.rectangle,r=o.width,s=o.height,a=r/i.width,l=s/i.height;return n.x=a*(o.west-i.west)/r,n.y=l*(o.south-i.south)/s,n.z=a,n.w=l,n};var cm=$o;var W7=`uniform sampler2D u_texture;
in vec2 v_textureCoordinates;
void main()
{
out_FragColor = texture(u_texture, v_textureCoordinates);
}
`;var q7=`in vec4 position;
in float webMercatorT;
uniform vec2 u_textureDimensions;
out vec2 v_textureCoordinates;
void main()
{
v_textureCoordinates = vec2(position.x, webMercatorT);
gl_Position = czm_viewportOrthographic * (position * vec4(u_textureDimensions, 1.0, 1.0));
}
`;function PC(e,t,n,i,o){if(this.imageryLayer=e,this.x=t,this.y=n,this.level=i,this.request=void 0,i!==0){let r=t/2|0,s=n/2|0,a=i-1;this.parent=e.getImageryFromCache(r,s,a)}this.state=ci.UNLOADED,this.imageUrl=void 0,this.image=void 0,this.texture=void 0,this.textureWebMercator=void 0,this.credits=void 0,this.referenceCount=0,!c(o)&&e.ready&&(o=e.imageryProvider.tilingScheme.tileXYToRectangle(t,n,i)),this.rectangle=o}PC.createPlaceholder=function(e){let t=new PC(e,0,0,0);return t.addReference(),t.state=ci.PLACEHOLDER,t};PC.prototype.addReference=function(){++this.referenceCount};PC.prototype.releaseReference=function(){return--this.referenceCount,this.referenceCount===0?(this.imageryLayer.removeImageryFromCache(this),c(this.parent)&&this.parent.releaseReference(),c(this.image)&&c(this.image.destroy)&&this.image.destroy(),c(this.texture)&&this.texture.destroy(),c(this.textureWebMercator)&&this.texture!==this.textureWebMercator&&this.textureWebMercator.destroy(),de(this),0):this.referenceCount};PC.prototype.processStateMachine=function(e,t,n){this.state===ci.UNLOADED&&!n&&(this.state=ci.TRANSITIONING,this.imageryLayer._requestImagery(this)),this.state===ci.RECEIVED&&(this.state=ci.TRANSITIONING,this.imageryLayer._createTexture(e.context,this));let i=this.state===ci.READY&&t&&!this.texture;(this.state===ci.TEXTURE_LOADED||i)&&(this.state=ci.TRANSITIONING,this.imageryLayer._reprojectTexture(e,this,t))};var hN=PC;function Y7(e,t,n){this.readyImagery=void 0,this.loadingImagery=e,this.textureCoordinateRectangle=t,this.textureTranslationAndScale=void 0,this.useWebMercatorT=n}Y7.prototype.freeResources=function(){c(this.readyImagery)&&this.readyImagery.releaseReference(),c(this.loadingImagery)&&this.loadingImagery.releaseReference()};Y7.prototype.processStateMachine=function(e,t,n){let i=this.loadingImagery,o=i.imageryLayer;if(i.processStateMachine(t,!this.useWebMercatorT,n),i.state===ci.READY)return c(this.readyImagery)&&this.readyImagery.releaseReference(),this.readyImagery=this.loadingImagery,this.loadingImagery=void 0,this.textureTranslationAndScale=o._calculateTextureTranslationAndScale(e,this),!0;let r=i.parent,s;for(;c(r)&&(r.state!==ci.READY||!this.useWebMercatorT&&!c(r.texture));)r.state!==ci.FAILED&&r.state!==ci.INVALID&&(s=s||r),r=r.parent;return this.readyImagery!==r&&(c(this.readyImagery)&&this.readyImagery.releaseReference(),this.readyImagery=r,c(r)&&(r.addReference(),this.textureTranslationAndScale=o._calculateTextureTranslationAndScale(e,this))),i.state===ci.FAILED||i.state===ci.INVALID?c(s)?(s.processStateMachine(t,!this.useWebMercatorT,n),!1):!0:!1};var mN=Y7;function mi(e,t){this._imageryProvider=e,this._readyEvent=new pe,this._errorEvent=new pe,t=y(t,y.EMPTY_OBJECT),e=y(e,y.EMPTY_OBJECT),this.alpha=y(t.alpha,y(e._defaultAlpha,1)),this.nightAlpha=y(t.nightAlpha,y(e._defaultNightAlpha,1)),this.dayAlpha=y(t.dayAlpha,y(e._defaultDayAlpha,1)),this.brightness=y(t.brightness,y(e._defaultBrightness,mi.DEFAULT_BRIGHTNESS)),this.contrast=y(t.contrast,y(e._defaultContrast,mi.DEFAULT_CONTRAST)),this.hue=y(t.hue,y(e._defaultHue,mi.DEFAULT_HUE)),this.saturation=y(t.saturation,y(e._defaultSaturation,mi.DEFAULT_SATURATION)),this.gamma=y(t.gamma,y(e._defaultGamma,mi.DEFAULT_GAMMA)),this.splitDirection=y(t.splitDirection,mi.DEFAULT_SPLIT),this.minificationFilter=y(t.minificationFilter,y(e._defaultMinificationFilter,mi.DEFAULT_MINIFICATION_FILTER)),this.magnificationFilter=y(t.magnificationFilter,y(e._defaultMagnificationFilter,mi.DEFAULT_MAGNIFICATION_FILTER)),this.show=y(t.show,!0),this._minimumTerrainLevel=t.minimumTerrainLevel,this._maximumTerrainLevel=t.maximumTerrainLevel,this._rectangle=y(t.rectangle,ae.MAX_VALUE),this._maximumAnisotropy=t.maximumAnisotropy,this._imageryCache={},this._skeletonPlaceholder=new mN(hN.createPlaceholder(this)),this._show=!0,this._layerIndex=-1,this._isBaseLayer=!1,this._requestImageError=void 0,this._reprojectComputeCommands=[],this.cutoutRectangle=t.cutoutRectangle,this.colorToAlpha=t.colorToAlpha,this.colorToAlphaThreshold=y(t.colorToAlphaThreshold,mi.DEFAULT_APPLY_COLOR_TO_ALPHA_THRESHOLD)}Object.defineProperties(mi.prototype,{imageryProvider:{get:function(){return this._imageryProvider}},ready:{get:function(){return c(this._imageryProvider)}},errorEvent:{get:function(){return this._errorEvent}},readyEvent:{get:function(){return this._readyEvent}},rectangle:{get:function(){return this._rectangle}}});mi.DEFAULT_BRIGHTNESS=1;mi.DEFAULT_CONTRAST=1;mi.DEFAULT_HUE=0;mi.DEFAULT_SATURATION=1;mi.DEFAULT_GAMMA=1;mi.DEFAULT_SPLIT=$r.NONE;mi.DEFAULT_MINIFICATION_FILTER=$t.LINEAR;mi.DEFAULT_MAGNIFICATION_FILTER=fi.LINEAR;mi.DEFAULT_APPLY_COLOR_TO_ALPHA_THRESHOLD=.004;mi.fromProviderAsync=function(e,t){A.typeOf.object("imageryProviderPromise",e);let n=new mi(void 0,t);return xht(n,Promise.resolve(e)),n};mi.fromWorldImagery=function(e){return e=y(e,y.EMPTY_OBJECT),mi.fromProviderAsync(hy({style:e.style}),e)};mi.prototype.isBaseLayer=function(){return this._isBaseLayer};mi.prototype.isDestroyed=function(){return!1};mi.prototype.destroy=function(){return de(this)};var x0e=new ae,y0e=new ae,X7=new ae,T0e=new ae;mi.prototype.getImageryRectangle=function(){let e=this._imageryProvider,t=this._rectangle;return ae.intersection(e.rectangle,t)};mi.prototype._createTileImagerySkeletons=function(e,t,n){let i=e.data;if(!c(t)||c(this._minimumTerrainLevel)&&e.level<this._minimumTerrainLevel||c(this._maximumTerrainLevel)&&e.level>this._maximumTerrainLevel)return!1;c(n)||(n=i.imagery.length);let o=this._imageryProvider;if(!this.ready)return this._skeletonPlaceholder.loadingImagery.addReference(),i.imagery.splice(n,0,this._skeletonPlaceholder),!0;let r=o.tilingScheme.projection instanceof Li&&e.rectangle.north<Li.MaximumLatitude&&e.rectangle.south>-Li.MaximumLatitude,s=ae.intersection(o.rectangle,this._rectangle,x0e),a=ae.intersection(e.rectangle,s,y0e);if(!c(a)){if(!this.isBaseLayer())return!1;let P=s,O=e.rectangle;a=y0e,O.south>=P.north?a.north=a.south=P.north:O.north<=P.south?a.north=a.south=P.south:(a.south=Math.max(O.south,P.south),a.north=Math.min(O.north,P.north)),O.west>=P.east?a.west=a.east=P.east:O.east<=P.west?a.west=a.east=P.west:(a.west=Math.max(O.west,P.west),a.east=Math.min(O.east,P.east))}let l=0;a.south>0?l=a.south:a.north<0&&(l=a.north);let f=1*t.getLevelMaximumGeometricError(e.level),d=yht(this,f,l);d=Math.max(0,d);let p=o.maximumLevel;if(d>p&&(d=p),c(o.minimumLevel)){let P=o.minimumLevel;d<P&&(d=P)}let g=o.tilingScheme,m=g.positionToTileXY(ae.northwest(a),d),b=g.positionToTileXY(ae.southeast(a),d),x=e.rectangle.width/512,T=e.rectangle.height/512,C=g.tileXYToRectangle(m.x,m.y,d);Math.abs(C.south-e.rectangle.north)<T&&m.y<b.y&&++m.y,Math.abs(C.east-e.rectangle.west)<x&&m.x<b.x&&++m.x;let S=g.tileXYToRectangle(b.x,b.y,d);Math.abs(S.north-e.rectangle.south)<T&&b.y>m.y&&--b.y,Math.abs(S.west-e.rectangle.east)<x&&b.x>m.x&&--b.x;let v=ae.clone(e.rectangle,T0e),D=g.tileXYToRectangle(m.x,m.y,d),I=ae.intersection(D,s,X7),L;r?(g.rectangleToNativeRectangle(v,v),g.rectangleToNativeRectangle(D,D),g.rectangleToNativeRectangle(I,I),g.rectangleToNativeRectangle(s,s),L=g.tileXYToNativeRectangle.bind(g),x=v.width/512,T=v.height/512):L=g.tileXYToRectangle.bind(g);let M,N=0,B=1,_;!this.isBaseLayer()&&Math.abs(I.west-v.west)>=x&&(N=Math.min(1,(I.west-v.west)/v.width)),!this.isBaseLayer()&&Math.abs(I.north-v.north)>=T&&(B=Math.max(0,(I.north-v.south)/v.height));let w=B;for(let P=m.x;P<=b.x;P++)if(M=N,D=L(P,m.y,d),I=ae.simpleIntersection(D,s,X7),!!c(I)){N=Math.min(1,(I.east-v.west)/v.width),P===b.x&&(this.isBaseLayer()||Math.abs(I.east-v.east)<x)&&(N=1),B=w;for(let O=m.y;O<=b.y;O++){if(_=B,D=L(P,O,d),I=ae.simpleIntersection(D,s,X7),!c(I))continue;B=Math.max(0,(I.south-v.south)/v.height),O===b.y&&(this.isBaseLayer()||Math.abs(I.south-v.south)<T)&&(B=0);let F=new se(M,B,N,_),V=this.getImageryFromCache(P,O,d);i.imagery.splice(n,0,new mN(V,F,r)),++n}}return!0};mi.prototype._calculateTextureTranslationAndScale=function(e,t){let n=t.readyImagery.rectangle,i=e.rectangle;if(t.useWebMercatorT){let l=t.readyImagery.imageryLayer.imageryProvider.tilingScheme;n=l.rectangleToNativeRectangle(n,x0e),i=l.rectangleToNativeRectangle(i,T0e)}let o=i.width,r=i.height,s=o/n.width,a=r/n.height;return new se(s*(i.west-n.west)/o,a*(i.south-n.south)/r,s,a)};mi.prototype._requestImagery=function(e){let t=this._imageryProvider,n=this;function i(s){if(!c(s))return o();e.image=s,e.state=ci.RECEIVED,e.request=void 0,No.reportSuccess(n._requestImageError)}function o(s){if(e.request.state===Jn.CANCELLED){e.state=ci.UNLOADED,e.request=void 0;return}e.state=ci.FAILED,e.request=void 0;let a=`Failed to obtain image tile X: ${e.x} Y: ${e.y} Level: ${e.level}.`;n._requestImageError=No.reportError(n._requestImageError,t,t.errorEvent,a,e.x,e.y,e.level,s),n._requestImageError.retry&&r()}function r(){let s=new ur({throttle:!1,throttleByServer:!0,type:Es.IMAGERY});e.request=s,e.state=ci.TRANSITIONING;let a=t.requestImage(e.x,e.y,e.level,s);if(!c(a)){e.state=ci.UNLOADED,e.request=void 0;return}c(t.getTileCredits)&&(e.credits=t.getTileCredits(e.x,e.y,e.level)),a.then(function(l){i(l)}).catch(function(l){o(l)})}r()};mi.prototype._createTextureWebGL=function(e,t){let n=new Qt({minificationFilter:this.minificationFilter,magnificationFilter:this.magnificationFilter}),i=t.image;return c(i.internalFormat)?new Lt({context:e,pixelFormat:i.internalFormat,width:i.width,height:i.height,source:{arrayBufferView:i.bufferView},sampler:n}):new Lt({context:e,source:i,pixelFormat:this._imageryProvider.hasAlphaChannel?Ve.RGBA:Ve.RGB,sampler:n})};mi.prototype._createTexture=function(e,t){let n=this._imageryProvider,i=t.image;if(c(n.tileDiscardPolicy)){let r=n.tileDiscardPolicy;if(c(r)){if(!r.isReady()){t.state=ci.RECEIVED;return}if(r.shouldDiscardImage(i)){t.state=ci.INVALID;return}}}if(this.minificationFilter!==$t.NEAREST&&this.minificationFilter!==$t.LINEAR)throw new E("ImageryLayer minification filter must be NEAREST or LINEAR");let o=this._createTextureWebGL(e,t);n.tilingScheme.projection instanceof Li?t.textureWebMercator=o:t.texture=o,t.image=void 0,t.state=ci.TEXTURE_LOADED};function b0e(e,t,n){return`${e}:${t}:${n}`}mi.prototype._finalizeReprojectTexture=function(e,t){let n=this.minificationFilter,i=this.magnificationFilter;if(n===$t.LINEAR&&i===fi.LINEAR&&!Ve.isCompressedFormat(t.pixelFormat)&&R.isPowerOfTwo(t.width)&&R.isPowerOfTwo(t.height)){n=$t.LINEAR_MIPMAP_LINEAR;let r=mt.maximumTextureFilterAnisotropy,s=Math.min(r,y(this._maximumAnisotropy,r)),a=b0e(n,i,s),l=e.cache.imageryLayerMipmapSamplers;c(l)||(l={},e.cache.imageryLayerMipmapSamplers=l);let u=l[a];c(u)||(u=l[a]=new Qt({wrapS:yn.CLAMP_TO_EDGE,wrapT:yn.CLAMP_TO_EDGE,minificationFilter:n,magnificationFilter:i,maximumAnisotropy:s})),t.generateMipmap(rh.NICEST),t.sampler=u}else{let r=b0e(n,i,0),s=e.cache.imageryLayerNonMipmapSamplers;c(s)||(s={},e.cache.imageryLayerNonMipmapSamplers=s);let a=s[r];c(a)||(a=s[r]=new Qt({wrapS:yn.CLAMP_TO_EDGE,wrapT:yn.CLAMP_TO_EDGE,minificationFilter:n,magnificationFilter:i})),t.sampler=a}};mi.prototype._reprojectTexture=function(e,t,n){let i=t.textureWebMercator||t.texture,o=t.rectangle,r=e.context;if(n=y(n,!0),n&&!(this._imageryProvider.tilingScheme.projection instanceof Mi)&&o.width/i.width>1e-5){let s=this;t.addReference();let a=new zl({persists:!0,owner:this,preExecute:function(l){ght(l,r,i,t.rectangle)},postExecute:function(l){t.texture=l,s._finalizeReprojectTexture(r,l),t.state=ci.READY,t.releaseReference()},canceled:function(){t.state=ci.TEXTURE_LOADED,t.releaseReference()}});this._reprojectComputeCommands.push(a)}else n&&(t.texture=i),this._finalizeReprojectTexture(r,i),t.state=ci.READY};mi.prototype.queueReprojectionCommands=function(e){let t=this._reprojectComputeCommands,n=t.length;for(let i=0;i<n;++i)e.commandList.push(t[i]);t.length=0};mi.prototype.cancelReprojections=function(){this._reprojectComputeCommands.forEach(function(e){c(e.canceled)&&e.canceled()}),this._reprojectComputeCommands.length=0};mi.prototype.getImageryFromCache=function(e,t,n,i){let o=A0e(e,t,n),r=this._imageryCache[o];return c(r)||(r=new hN(this,e,t,n,i),this._imageryCache[o]=r),r.addReference(),r};mi.prototype.removeImageryFromCache=function(e){let t=A0e(e.x,e.y,e.level);delete this._imageryCache[t]};function A0e(e,t,n){return JSON.stringify([e,t,n])}var pN={u_textureDimensions:function(){return this.textureDimensions},u_texture:function(){return this.texture},textureDimensions:new H,texture:void 0},_ht=zt.supportsTypedArrays()?new Float32Array(2*64):void 0;function ght(e,t,n,i){let o=t.cache.imageryLayer_reproject;if(!c(o)){o=t.cache.imageryLayer_reproject={vertexArray:void 0,shaderProgram:void 0,sampler:void 0,destroy:function(){c(this.framebuffer)&&this.framebuffer.destroy(),c(this.vertexArray)&&this.vertexArray.destroy(),c(this.shaderProgram)&&this.shaderProgram.destroy()}};let x=new Float32Array(2*64*2),T=0;for(let I=0;I<64;++I){let L=I/63;x[T++]=0,x[T++]=L,x[T++]=1,x[T++]=L}let C={position:0,webMercatorT:1},S=gs.getRegularGridIndices(2,64),v=xt.createIndexBuffer({context:t,typedArray:S,usage:ke.STATIC_DRAW,indexDatatype:Fe.UNSIGNED_SHORT});o.vertexArray=new ni({context:t,attributes:[{index:C.position,vertexBuffer:xt.createVertexBuffer({context:t,typedArray:x,usage:ke.STATIC_DRAW}),componentsPerAttribute:2},{index:C.webMercatorT,vertexBuffer:xt.createVertexBuffer({context:t,sizeInBytes:64*2*4,usage:ke.STREAM_DRAW}),componentsPerAttribute:1}],indexBuffer:v});let D=new Ge({sources:[q7]});o.shaderProgram=an.fromCache({context:t,vertexShaderSource:D,fragmentShaderSource:W7,attributeLocations:C}),o.sampler=new Qt({wrapS:yn.CLAMP_TO_EDGE,wrapT:yn.CLAMP_TO_EDGE,minificationFilter:$t.LINEAR,magnificationFilter:fi.LINEAR})}n.sampler=o.sampler;let r=n.width,s=n.height;pN.textureDimensions.x=r,pN.textureDimensions.y=s,pN.texture=n;let a=Math.sin(i.south),l=.5*Math.log((1+a)/(1-a));a=Math.sin(i.north);let f=1/(.5*Math.log((1+a)/(1-a))-l),d=new Lt({context:t,width:r,height:s,pixelFormat:n.pixelFormat,pixelDatatype:n.pixelDatatype,preMultiplyAlpha:n.preMultiplyAlpha});R.isPowerOfTwo(r)&&R.isPowerOfTwo(s)&&d.generateMipmap(rh.NICEST);let p=i.south,g=i.north,m=_ht,b=0;for(let x=0;x<64;++x){let T=x/63,C=R.lerp(p,g,T);a=Math.sin(C);let v=(.5*Math.log((1+a)/(1-a))-l)*f;m[b++]=v,m[b++]=v}o.vertexArray.getAttribute(1).vertexBuffer.copyFromArrayView(m),e.shaderProgram=o.shaderProgram,e.outputTexture=d,e.uniformMap=pN,e.vertexArray=o.vertexArray}function yht(e,t,n){let i=e._imageryProvider,o=i.tilingScheme,r=o.ellipsoid,s=e._imageryProvider.tilingScheme.projection instanceof Mi?1:Math.cos(n),a=o.rectangle,u=r.maximumRadius*a.width*s/(i.tileWidth*o.getNumberOfXTilesAtLevel(0))/t,f=Math.log(u)/Math.log(2);return Math.round(f)|0}function bht(e,t){e.numberOfListeners>0?e.raiseEvent(t):console.error(t)}async function xht(e,t){let n;try{if(n=await Promise.resolve(t),e.isDestroyed())return;e._imageryProvider=n,e._readyEvent.raiseEvent(n)}catch(i){bht(e._errorEvent,i)}}var oc=mi;var C0e={NONE:0,CULLED:1,RENDERED:2,REFINED:3,RENDERED_AND_KICKED:6,REFINED_AND_KICKED:7,CULLED_BUT_NEEDED:9,wasKicked:function(e){return e>=C0e.RENDERED_AND_KICKED},originalResult:function(e){return e&3},kick:function(e){return e|4}},Xn=C0e;function OC(e){this.tile=e,this.frameLastUpdated=void 0,this.westMeshes=[],this.westTiles=[],this.southMeshes=[],this.southTiles=[],this.eastMeshes=[],this.eastTiles=[],this.northMeshes=[],this.northTiles=[],this.southwestMesh=void 0,this.southwestTile=void 0,this.southeastMesh=void 0,this.southeastTile=void 0,this.northwestMesh=void 0,this.northwestTile=void 0,this.northeastMesh=void 0,this.northeastTile=void 0,this.changedThisFrame=!0,this.visitedFrame=void 0,this.enqueuedFrame=void 0,this.mesh=void 0,this.vertexArray=void 0,this.waterMaskTexture=void 0,this.waterMaskTranslationAndScale=new se}OC.prototype.update=function(e,t,n){this.changedThisFrame&&(I0e(e,t,this.tile,n),this.changedThisFrame=!1)};OC.prototype.destroy=function(e){this._destroyVertexArray(e),c(this.waterMaskTexture)&&(--this.waterMaskTexture.referenceCount,this.waterMaskTexture.referenceCount===0&&this.waterMaskTexture.destroy(),this.waterMaskTexture=void 0)};OC.prototype._destroyVertexArray=function(e){c(this.vertexArray)&&(c(e)?e.push(this.vertexArray):cm._freeVertexArray(this.vertexArray),this.vertexArray=void 0)};var Tht=new dT;OC.updateFillTiles=function(e,t,n,i){let o=e._quadtree,r=o._levelZeroTiles,s=o._lastSelectionFrameNumber,a=Tht;a.clear();for(let u=0;u<t.length;++u){let f=t[u];c(f.data.vertexArray)&&a.enqueue(t[u])}let l=a.dequeue();for(;l!==void 0;){let u=l.findTileToWest(r),f=l.findTileToSouth(r),d=l.findTileToEast(r),p=l.findTileToNorth(r);Ts(e,n,l,u,s,xn.EAST,!1,a,i),Ts(e,n,l,f,s,xn.NORTH,!1,a,i),Ts(e,n,l,d,s,xn.WEST,!1,a,i),Ts(e,n,l,p,s,xn.SOUTH,!1,a,i);let g=u.findTileToNorth(r),m=u.findTileToSouth(r),b=d.findTileToNorth(r),x=d.findTileToSouth(r);Ts(e,n,l,g,s,xn.SOUTHEAST,!1,a,i),Ts(e,n,l,b,s,xn.SOUTHWEST,!1,a,i),Ts(e,n,l,m,s,xn.NORTHEAST,!1,a,i),Ts(e,n,l,x,s,xn.NORTHWEST,!1,a,i),l=a.dequeue()}};function Ts(e,t,n,i,o,r,s,a,l){if(i===void 0)return;let u=i;for(;u&&(u._lastSelectionResultFrame!==o||Xn.wasKicked(u._lastSelectionResult)||Xn.originalResult(u._lastSelectionResult)===Xn.CULLED);){if(s)return;let f=u.parent;if(r>=xn.NORTHWEST&&f!==void 0)switch(r){case xn.NORTHWEST:u=u===f.northwestChild?f:void 0;break;case xn.NORTHEAST:u=u===f.northeastChild?f:void 0;break;case xn.SOUTHWEST:u=u===f.southwestChild?f:void 0;break;case xn.SOUTHEAST:u=u===f.southeastChild?f:void 0;break}else u=f}if(u!==void 0){if(u._lastSelectionResult===Xn.RENDERED){if(c(u.data.vertexArray))return;Aht(e,t,n,u,r,o,a,l);return}if(Xn.originalResult(i._lastSelectionResult)!==Xn.CULLED)switch(r){case xn.WEST:Ts(e,t,n,i.northwestChild,o,r,!0,a,l),Ts(e,t,n,i.southwestChild,o,r,!0,a,l);break;case xn.EAST:Ts(e,t,n,i.southeastChild,o,r,!0,a,l),Ts(e,t,n,i.northeastChild,o,r,!0,a,l);break;case xn.SOUTH:Ts(e,t,n,i.southwestChild,o,r,!0,a,l),Ts(e,t,n,i.southeastChild,o,r,!0,a,l);break;case xn.NORTH:Ts(e,t,n,i.northeastChild,o,r,!0,a,l),Ts(e,t,n,i.northwestChild,o,r,!0,a,l);break;case xn.NORTHWEST:Ts(e,t,n,i.northwestChild,o,r,!0,a,l);break;case xn.NORTHEAST:Ts(e,t,n,i.northeastChild,o,r,!0,a,l);break;case xn.SOUTHWEST:Ts(e,t,n,i.southwestChild,o,r,!0,a,l);break;case xn.SOUTHEAST:Ts(e,t,n,i.southeastChild,o,r,!0,a,l);break;default:throw new E("Invalid edge")}}}function Aht(e,t,n,i,o,r,s,a){let l=i.data;if(l.fill===void 0)l.fill=new OC(i);else if(l.fill.visitedFrame===r)return;l.fill.enqueuedFrame!==r&&(l.fill.enqueuedFrame=r,l.fill.changedThisFrame=!1,s.enqueue(i)),Cht(e,t,n,i,o,a)}function Cht(e,t,n,i,o,r){let s=i.data.fill,a,l=n.data.fill;c(l)?(l.visitedFrame=t.frameNumber,l.changedThisFrame&&(I0e(e,t,n,r),l.changedThisFrame=!1),a=n.data.fill.mesh):a=n.data.mesh;let u,f;switch(o){case xn.WEST:u=s.westMeshes,f=s.westTiles;break;case xn.SOUTH:u=s.southMeshes,f=s.southTiles;break;case xn.EAST:u=s.eastMeshes,f=s.eastTiles;break;case xn.NORTH:u=s.northMeshes,f=s.northTiles;break;case xn.NORTHWEST:s.changedThisFrame=s.changedThisFrame||s.northwestMesh!==a,s.northwestMesh=a,s.northwestTile=n;return;case xn.NORTHEAST:s.changedThisFrame=s.changedThisFrame||s.northeastMesh!==a,s.northeastMesh=a,s.northeastTile=n;return;case xn.SOUTHWEST:s.changedThisFrame=s.changedThisFrame||s.southwestMesh!==a,s.southwestMesh=a,s.southwestTile=n;return;case xn.SOUTHEAST:s.changedThisFrame=s.changedThisFrame||s.southeastMesh!==a,s.southeastMesh=a,s.southeastTile=n;return}if(n.level<=i.level){s.changedThisFrame=s.changedThisFrame||u[0]!==a||u.length!==1,u[0]=a,f[0]=n,u.length=1,f.length=1;return}let d,p,g,m,b=n.rectangle,x,T=i.rectangle;switch(o){case xn.WEST:for(x=(T.north-T.south)*R.EPSILON5,d=0;d<f.length&&(g=f[d],m=g.rectangle,!R.greaterThan(b.north,m.south,x));++d);for(p=d;p<f.length&&(g=f[p],m=g.rectangle,!R.greaterThanOrEquals(b.south,m.north,x));++p);break;case xn.SOUTH:for(x=(T.east-T.west)*R.EPSILON5,d=0;d<f.length&&(g=f[d],m=g.rectangle,!R.lessThan(b.west,m.east,x));++d);for(p=d;p<f.length&&(g=f[p],m=g.rectangle,!R.lessThanOrEquals(b.east,m.west,x));++p);break;case xn.EAST:for(x=(T.north-T.south)*R.EPSILON5,d=0;d<f.length&&(g=f[d],m=g.rectangle,!R.lessThan(b.south,m.north,x));++d);for(p=d;p<f.length&&(g=f[p],m=g.rectangle,!R.lessThanOrEquals(b.north,m.south,x));++p);break;case xn.NORTH:for(x=(T.east-T.west)*R.EPSILON5,d=0;d<f.length&&(g=f[d],m=g.rectangle,!R.greaterThan(b.east,m.west,x));++d);for(p=d;p<f.length&&(g=f[p],m=g.rectangle,!R.greaterThanOrEquals(b.west,m.east,x));++p);break}p-d===1?(s.changedThisFrame=s.changedThisFrame||u[d]!==a,u[d]=a,f[d]=n):(s.changedThisFrame=!0,u.splice(d,p-d,a),f.splice(d,p-d,n))}var Yb=new he,Eht=new he,IC=new h,J7=new h,K7=new H,$7=new H,yu=new H;function AN(){this.height=0,this.encodedNormal=new H}function _N(e,t,n,i,o,r,s,a,l){if(c(o))return o;let u;if(c(r)&&c(s))u=(r.height+s.height)*.5;else if(c(r))u=r.height;else if(c(s))u=s.height;else if(c(a))u=a.height;else{let d=e.tile.data.tileBoundingRegion,p=0,g=0;c(d)&&(p=d.minimumHeight,g=d.maximumHeight),u=(p+g)*.5}return O0e(e,t,n,i,u,l),l}var Sht={minimumHeight:0,maximumHeight:0},wht=new h,E0e=new AN,S0e=new AN,w0e=new AN,v0e=new AN,vht=typeof Uint8Array<"u"?new Uint8Array(9*9):void 0,Dht={tilingScheme:void 0,x:0,y:0,level:0,exaggeration:1,exaggerationRelativeHeight:0};function I0e(e,t,n,i){cm.initialize(n,e.terrainProvider,e._imageryLayers);let o=n.data,r=o.fill,s=n.rectangle,a=t.verticalExaggeration,l=t.verticalExaggerationRelativeHeight,u=a!==1,f=n.tilingScheme.ellipsoid,d=yN(r,f,0,1,r.northwestTile,r.northwestMesh,r.northTiles,r.northMeshes,r.westTiles,r.westMeshes,w0e),p=yN(r,f,0,0,r.southwestTile,r.southwestMesh,r.westTiles,r.westMeshes,r.southTiles,r.southMeshes,E0e),g=yN(r,f,1,0,r.southeastTile,r.southeastMesh,r.southTiles,r.southMeshes,r.eastTiles,r.eastMeshes,S0e),m=yN(r,f,1,1,r.northeastTile,r.northeastMesh,r.eastTiles,r.eastMeshes,r.northTiles,r.northMeshes,v0e);d=_N(r,f,0,1,d,p,m,g,w0e),p=_N(r,f,0,0,p,d,g,m,E0e),g=_N(r,f,1,1,g,p,m,d,S0e),m=_N(r,f,1,1,m,g,d,p,v0e);let b=p.height,x=g.height,T=d.height,C=m.height,S=Math.min(b,x,T,C),v=Math.max(b,x,T,C),D=(S+v)*.5,I,L,M=e.getLevelMaximumGeometricError(n.level),N=f.maximumRadius-M,B=Math.acos(N/f.maximumRadius)*4;if(B*=1.5,s.width>B&&v-S<=M){let P=new Mc({width:9,height:9,buffer:vht,structure:{heightOffset:v}}),O=Dht;O.tilingScheme=n.tilingScheme,O.x=n.x,O.y=n.y,O.level=n.level,O.exaggeration=a,O.exaggerationRelativeHeight=l,r.mesh=P._createMeshSync(O)}else{let P=u,O=ae.center(s,Eht);O.height=D;let F=f.cartographicToCartesian(O,wht),V=new xl(F,void 0,void 0,void 0,void 0,!0,!0,P,a,l),G=5,z;for(z=r.westMeshes,I=0,L=z.length;I<L;++I)G+=z[I].eastIndicesNorthToSouth.length;for(z=r.southMeshes,I=0,L=z.length;I<L;++I)G+=z[I].northIndicesWestToEast.length;for(z=r.eastMeshes,I=0,L=z.length;I<L;++I)G+=z[I].westIndicesSouthToNorth.length;for(z=r.northMeshes,I=0,L=z.length;I<L;++I)G+=z[I].southIndicesEastToWest.length;let W=Sht;W.minimumHeight=S,W.maximumHeight=v;let U=V.stride,q=new Float32Array(G*U),K=0,te=K;K=gN(f,s,V,q,K,0,1,d.height,d.encodedNormal,1,W),K=xN(r,f,V,q,K,r.westTiles,r.westMeshes,xn.EAST,W);let Y=K;K=gN(f,s,V,q,K,0,0,p.height,p.encodedNormal,0,W),K=xN(r,f,V,q,K,r.southTiles,r.southMeshes,xn.NORTH,W);let Z=K;K=gN(f,s,V,q,K,1,0,g.height,g.encodedNormal,0,W),K=xN(r,f,V,q,K,r.eastTiles,r.eastMeshes,xn.WEST,W);let ee=K;K=gN(f,s,V,q,K,1,1,m.height,m.encodedNormal,1,W),K=xN(r,f,V,q,K,r.northTiles,r.northMeshes,xn.SOUTH,W),S=W.minimumHeight,v=W.maximumHeight;let me=Pn.fromRectangle(s,S,v,n.tilingScheme.ellipsoid),be=Li.geodeticLatitudeToMercatorAngle(s.south),le=1/(Li.geodeticLatitudeToMercatorAngle(s.north)-be),ge=(Li.geodeticLatitudeToMercatorAngle(O.latitude)-be)*le,xe=f.geodeticSurfaceNormalCartographic(Yb,J7),Pe=Nn.octEncode(xe,K7),Ee=K;V.encode(q,K*U,me.center,H.fromElements(.5,.5,yu),D,Pe,ge,xe),++K;let Ue=K,Ye=Ue<256?1:2,it=(Ue-1)*3,It=it*Ye,Ot=(q.length-Ue*U)*Float32Array.BYTES_PER_ELEMENT,He;if(Ot>=It){let Ce=Ue*U*Float32Array.BYTES_PER_ELEMENT;He=Ue<256?new Uint8Array(q.buffer,Ce,it):new Uint16Array(q.buffer,Ce,it)}else He=Ue<256?new Uint8Array(it):new Uint16Array(it);q=new Float32Array(q.buffer,0,Ue*U);let tn=0;for(I=0;I<Ue-2;++I)He[tn++]=Ee,He[tn++]=I,He[tn++]=I+1;He[tn++]=Ee,He[tn++]=I,He[tn++]=0;let dt=[];for(I=Y;I>=te;--I)dt.push(I);let bt=[];for(I=Z;I>=Y;--I)bt.push(I);let nn=[];for(I=ee;I>=Z;--I)nn.push(I);let Ae=[];for(Ae.push(0),I=Ee-1;I>=ee;--I)Ae.push(I);r.mesh=new em(V.center,q,He,it,Ue,S,v,ce.fromOrientedBoundingBox(me),Nht(e,me.center,s,S,v),V.stride,me,V,dt,bt,nn,Ae)}let _=t.context;r._destroyVertexArray(i),r.vertexArray=cm._createVertexArrayForMesh(_,r.mesh),o.processImagery(n,e.terrainProvider,t,!0);let w=r.waterMaskTexture;if(r.waterMaskTexture=void 0,e.terrainProvider.hasWaterMask){let P=o._findAncestorTileWithTerrainData(n);c(P)&&c(P.data.waterMaskTexture)&&(r.waterMaskTexture=P.data.waterMaskTexture,++r.waterMaskTexture.referenceCount,o._computeWaterMaskTranslationAndScale(n,P,r.waterMaskTranslationAndScale))}c(w)&&(--w.referenceCount,w.referenceCount===0&&w.destroy())}function gN(e,t,n,i,o,r,s,a,l,u,f){let d=Yb;d.longitude=R.lerp(t.west,t.east,r),d.latitude=R.lerp(t.south,t.north,s),d.height=a;let p=e.cartographicToCartesian(d,IC),g;n.hasGeodeticSurfaceNormals&&(g=e.geodeticSurfaceNormal(p,J7));let m=$7;return m.x=r,m.y=s,n.encode(i,o*n.stride,p,m,a,l,u,g),f.minimumHeight=Math.min(f.minimumHeight,a),f.maximumHeight=Math.max(f.maximumHeight,a),o+1}var TN=new ae;function ZD(e,t,n,i){let o=e.rectangle,r=t.rectangle;t.x===0&&n.x===1&&e.x===e.tilingScheme.getNumberOfXTilesAtLevel(e.level)-1?(o=ae.clone(e.rectangle,TN),o.west-=R.TWO_PI,o.east-=R.TWO_PI):e.x===0&&n.x===0&&t.x===t.tilingScheme.getNumberOfXTilesAtLevel(t.level)-1&&(o=ae.clone(e.rectangle,TN),o.west+=R.TWO_PI,o.east+=R.TWO_PI);let s=o.east-o.west,a=(r.west-o.west)/s,l=(r.east-o.west)/s,u=o.north-o.south,f=(r.south-o.south)/u,d=(r.north-o.south)/u,p=(n.x-a)/(l-a),g=(n.y-f)/(d-f);return Math.abs(p)<Math.EPSILON5?p=0:Math.abs(p-1)<Math.EPSILON5&&(p=1),Math.abs(g)<Math.EPSILON5?g=0:Math.abs(g-1)<Math.EPSILON5&&(g=1),i.x=p,i.y=g,i}var Pht=new H;function Z7(e,t,n,i,o){let r=e.encoding,s=e.vertices;if(o.height=r.decodeHeight(s,t),r.hasVertexNormals)r.getOctEncodedNormal(s,t,o.encodedNormal);else{let a=o.encodedNormal;a.x=0,a.y=0}}var Iht=new H,Oht=new h;function Rht(e,t,n,i,o,r,s,a,l,u){let f=i.encoding,d=i.vertices,p=ZD(t,n,f.decodeTextureCoordinates(d,o,yu),yu),g=ZD(t,n,f.decodeTextureCoordinates(d,r,$7),$7),m;l?m=(s-p.x)/(g.x-p.x):m=(a-p.y)/(g.y-p.y);let b=f.decodeHeight(d,o),x=f.decodeHeight(d,r),T=n.rectangle;Yb.longitude=R.lerp(T.west,T.east,s),Yb.latitude=R.lerp(T.south,T.north,a),u.height=Yb.height=R.lerp(b,x,m);let C;if(f.hasVertexNormals){let S=f.getOctEncodedNormal(d,o,Pht),v=f.getOctEncodedNormal(d,r,Iht),D=Nn.octDecode(S.x,S.y,IC),I=Nn.octDecode(v.x,v.y,Oht);C=h.lerp(D,I,m,IC),h.normalize(C,C),Nn.octEncode(C,u.encodedNormal)}else C=e.geodeticSurfaceNormalCartographic(Yb,IC),Nn.octEncode(C,u.encodedNormal)}function O0e(e,t,n,i,o,r){r.height=o;let s=t.geodeticSurfaceNormalCartographic(Yb,IC);Nn.octEncode(s,r.encodedNormal)}function yN(e,t,n,i,o,r,s,a,l,u,f){if(P0e(e,t,a,s,!1,n,i,f)||P0e(e,t,u,l,!0,n,i,f))return f;let p;if(Q7(o,r))return n===0?i===0?p=r.eastIndicesNorthToSouth[0]:p=r.southIndicesEastToWest[0]:i===0?p=r.northIndicesWestToEast[0]:p=r.westIndicesSouthToNorth[0],Z7(r,p,n,i,f),f;let g;if(n===0?i===0?g=bN(e.westMeshes,e.westTiles,xn.EAST,e.southMeshes,e.southTiles,xn.NORTH,n,i):g=bN(e.northMeshes,e.northTiles,xn.SOUTH,e.westMeshes,e.westTiles,xn.EAST,n,i):i===0?g=bN(e.southMeshes,e.southTiles,xn.NORTH,e.eastMeshes,e.eastTiles,xn.WEST,n,i):g=bN(e.eastMeshes,e.eastTiles,xn.WEST,e.northMeshes,e.northTiles,xn.SOUTH,n,i),c(g))return O0e(e,t,n,i,g,f),f}function bN(e,t,n,i,o,r,s,a){let l=D0e(e,t,!1,n,s,a),u=D0e(i,o,!0,r,s,a);return c(l)&&c(u)?(l+u)*.5:c(l)?l:u}function xN(e,t,n,i,o,r,s,a,l){for(let u=0;u<r.length;++u)o=Mht(e,t,n,i,o,r[u],s[u],a,l);return o}function Mht(e,t,n,i,o,r,s,a,l){let u=r.rectangle;a===xn.EAST&&e.tile.x===0?(u=ae.clone(r.rectangle,TN),u.west-=R.TWO_PI,u.east-=R.TWO_PI):a===xn.WEST&&r.x===0&&(u=ae.clone(r.rectangle,TN),u.west+=R.TWO_PI,u.east+=R.TWO_PI);let f=e.tile.rectangle,d,p;o>0&&(n.decodeTextureCoordinates(i,o-1,yu),d=yu.x,p=yu.y);let g,m;switch(a){case xn.WEST:g=s.westIndicesSouthToNorth,m=!1;break;case xn.NORTH:g=s.northIndicesWestToEast,m=!0;break;case xn.EAST:g=s.eastIndicesNorthToSouth,m=!1;break;case xn.SOUTH:g=s.southIndicesEastToWest,m=!0;break}let b=r,x=e.tile,T=s.encoding,C=s.vertices,S=n.stride,v,D;T.hasWebMercatorT&&(v=Li.geodeticLatitudeToMercatorAngle(f.south),D=1/(Li.geodeticLatitudeToMercatorAngle(f.north)-v));for(let I=0;I<g.length;++I){let L=g[I],M=T.decodeTextureCoordinates(C,L,yu);ZD(b,x,M,M);let N=M.x,B=M.y,_=m?N:B;if(_<0||_>1||Math.abs(N-d)<R.EPSILON5&&Math.abs(B-p)<R.EPSILON5)continue;let w=Math.abs(N)<R.EPSILON5||Math.abs(N-1)<R.EPSILON5,P=Math.abs(B)<R.EPSILON5||Math.abs(B-1)<R.EPSILON5;if(w&&P)continue;let O=T.decodePosition(C,L,IC),F=T.decodeHeight(C,L),V;T.hasVertexNormals?V=T.getOctEncodedNormal(C,L,K7):(V=K7,V.x=0,V.y=0);let G=B;if(T.hasWebMercatorT){let W=R.lerp(f.south,f.north,B);G=(Li.geodeticLatitudeToMercatorAngle(W)-v)*D}let z;n.hasGeodeticSurfaceNormals&&(z=t.geodeticSurfaceNormal(O,J7)),n.encode(i,o*S,O,M,F,V,G,z),l.minimumHeight=Math.min(l.minimumHeight,F),l.maximumHeight=Math.max(l.maximumHeight,F),++o}return o}function D0e(e,t,n,i,o,r){let s,a,l;n?(s=0,a=e.length,l=1):(s=e.length-1,a=-1,l=-1);for(let u=s;u!==a;u+=l){let f=e[u],d=t[u];if(!Q7(d,f))continue;let p;switch(i){case xn.WEST:p=f.westIndicesSouthToNorth;break;case xn.SOUTH:p=f.southIndicesEastToWest;break;case xn.EAST:p=f.eastIndicesNorthToSouth;break;case xn.NORTH:p=f.northIndicesWestToEast;break}let g=p[n?0:p.length-1];if(c(g))return f.encoding.decodeHeight(f.vertices,g)}}function Q7(e,t){return c(t)&&(!c(e.data.fill)||!e.data.fill.changedThisFrame)}function P0e(e,t,n,i,o,r,s,a){let l,u,f,d,p,g=i[o?0:n.length-1],m=n[o?0:n.length-1];if(Q7(g,m)&&(r===0?s===0?(l=o?m.northIndicesWestToEast:m.eastIndicesNorthToSouth,u=o,f=o):(l=o?m.eastIndicesNorthToSouth:m.southIndicesEastToWest,u=!o,f=!1):s===0?(l=o?m.westIndicesSouthToNorth:m.northIndicesWestToEast,u=!o,f=!0):(l=o?m.southIndicesEastToWest:m.westIndicesSouthToNorth,u=o,f=!o),l.length>0)){d=o?0:l.length-1,p=l[d],m.encoding.decodeTextureCoordinates(m.vertices,p,yu);let b=ZD(g,e.tile,yu,yu);if(b.x===r&&b.y===s)return Z7(m,p,r,s,a),!0;if(d=vo(l,u?r:s,function(x,T){m.encoding.decodeTextureCoordinates(m.vertices,x,yu);let C=ZD(g,e.tile,yu,yu);return f?u?C.x-r:C.y-s:u?r-C.x:s-C.y}),d<0){if(d=~d,d>0&&d<l.length)return Rht(t,g,e.tile,m,l[d-1],l[d],r,s,u,a),!0}else return Z7(m,l[d],r,s,a),!0}return!1}var Lht=[new h,new h,new h,new h];function Nht(e,t,n,i,o,r){let s=e.quadtree._occluders.ellipsoid,a=s.ellipsoid,l=Lht;return h.fromRadians(n.west,n.south,o,a,l[0]),h.fromRadians(n.east,n.south,o,a,l[1]),h.fromRadians(n.west,n.north,o,a,l[2]),h.fromRadians(n.east,n.north,o,a,l[3]),s.computeHorizonCullingPointPossiblyUnderEllipsoid(t,l,i,r)}var CN=OC;function Zo(e){if(!c(e))throw new E("options is required.");if(c(e.terrainProvider))if(c(e.imageryLayers)){if(!c(e.surfaceShaderSet))throw new E("options.surfaceShaderSet is required.")}else throw new E("options.imageryLayers is required.");else throw new E("options.terrainProvider is required.");this.lightingFadeOutDistance=65e5,this.lightingFadeInDistance=9e6,this.hasWaterMask=!1,this.showWaterEffect=!1,this.oceanNormalMap=void 0,this.zoomedOutOceanSpecularIntensity=.5,this.enableLighting=!1,this.dynamicAtmosphereLighting=!1,this.dynamicAtmosphereLightingFromSun=!1,this.showGroundAtmosphere=!1,this.shadows=En.RECEIVE_ONLY,this.vertexShadowDarkness=.3,this.fillHighlightColor=void 0,this.hueShift=0,this.saturationShift=0,this.brightnessShift=0,this.showSkirts=!0,this.backFaceCulling=!0,this.undergroundColor=void 0,this.undergroundColorAlphaByDistance=void 0,this.lambertDiffuseMultiplier=0,this.materialUniformMap=void 0,this._materialUniformMap=void 0,this._quadtree=void 0,this._terrainProvider=e.terrainProvider,this._imageryLayers=e.imageryLayers,this._surfaceShaderSet=e.surfaceShaderSet,this._renderState=void 0,this._blendRenderState=void 0,this._disableCullingRenderState=void 0,this._disableCullingBlendRenderState=void 0,this._errorEvent=new pe,this._removeLayerAddedListener=this._imageryLayers.layerAdded.addEventListener(Zo.prototype._onLayerAdded,this),this._removeLayerRemovedListener=this._imageryLayers.layerRemoved.addEventListener(Zo.prototype._onLayerRemoved,this),this._removeLayerMovedListener=this._imageryLayers.layerMoved.addEventListener(Zo.prototype._onLayerMoved,this),this._removeLayerShownListener=this._imageryLayers.layerShownOrHidden.addEventListener(Zo.prototype._onLayerShownOrHidden,this),this._imageryLayersUpdatedEvent=new pe,this._layerOrderChanged=!1,this._tilesToRenderByTextureCount=[],this._drawCommands=[],this._uniformMaps=[],this._usedDrawCommands=0,this._vertexArraysToDestroy=[],this._debug={wireframe:!1,boundingSphereTile:void 0},this._baseColor=void 0,this._firstPassInitialColor=void 0,this.baseColor=new j(0,0,.5,1),this._clippingPlanes=void 0,this._clippingPolygons=void 0,this.cartographicLimitRectangle=ae.clone(ae.MAX_VALUE),this._hasLoadedTilesThisFrame=!1,this._hasFillTilesThisFrame=!1,this._oldVerticalExaggeration=void 0,this._oldVerticalExaggerationRelativeHeight=void 0}Object.defineProperties(Zo.prototype,{baseColor:{get:function(){return this._baseColor},set:function(e){if(!c(e))throw new E("value is required.");this._baseColor=e,this._firstPassInitialColor=se.fromColor(e,this._firstPassInitialColor)}},quadtree:{get:function(){return this._quadtree},set:function(e){if(!c(e))throw new E("value is required.");this._quadtree=e}},tilingScheme:{get:function(){if(c(this._terrainProvider))return this._terrainProvider.tilingScheme}},errorEvent:{get:function(){return this._errorEvent}},imageryLayersUpdatedEvent:{get:function(){return this._imageryLayersUpdatedEvent}},terrainProvider:{get:function(){return this._terrainProvider},set:function(e){this._terrainProvider!==e&&(this._terrainProvider=e,c(this._quadtree)&&this._quadtree.invalidateAllTiles())}},clippingPlanes:{get:function(){return this._clippingPlanes},set:function(e){Ms.setOwner(e,this,"_clippingPlanes")}},clippingPolygons:{get:function(){return this._clippingPolygons},set:function(e){tp.setOwner(e,this,"_clippingPolygons")}}});function Fht(e,t){let n=e.loadingImagery;c(n)||(n=e.readyImagery);let i=t.loadingImagery;return c(i)||(i=t.readyImagery),n.imageryLayer._layerIndex-i.imageryLayer._layerIndex}Zo.prototype.update=function(e){this._imageryLayers._update()};function Bht(e,t){let n=t.creditDisplay,i=e._terrainProvider;c(i)&&c(i.credit)&&n.addCreditToNextFrame(i.credit);let o=e._imageryLayers;for(let r=0,s=o.length;r<s;++r){let a=o.get(r);a.ready&&a.show&&c(a.imageryProvider.credit)&&n.addCreditToNextFrame(a.imageryProvider.credit)}}Zo.prototype.initialize=function(e){this._imageryLayers.queueReprojectionCommands(e),this._layerOrderChanged&&(this._layerOrderChanged=!1,this._quadtree.forEachLoadedTile(function(i){i.data.imagery.sort(Fht)})),Bht(this,e);let t=this._vertexArraysToDestroy,n=t.length;for(let i=0;i<n;++i)cm._freeVertexArray(t[i]);t.length=0};Zo.prototype.beginUpdate=function(e){let t=this._tilesToRenderByTextureCount;for(let o=0,r=t.length;o<r;++o){let s=t[o];c(s)&&(s.length=0)}let n=this._clippingPlanes;c(n)&&n.enabled&&n.update(e);let i=this._clippingPolygons;c(i)&&i.enabled&&(i.update(e),i.queueCommands(e)),this._usedDrawCommands=0,this._hasLoadedTilesThisFrame=!1,this._hasFillTilesThisFrame=!1};Zo.prototype.endUpdate=function(e){if(!c(this._renderState)){this._renderState=ze.fromCache({cull:{enabled:!0},depthTest:{enabled:!0,func:Kc.LESS}}),this._blendRenderState=ze.fromCache({cull:{enabled:!0},depthTest:{enabled:!0,func:Kc.LESS_OR_EQUAL},blending:hn.ALPHA_BLEND});let s=qe(this._renderState,!0);s.cull.enabled=!1,this._disableCullingRenderState=ze.fromCache(s),s=qe(this._blendRenderState,!0),s.cull.enabled=!1,this._disableCullingBlendRenderState=ze.fromCache(s)}this._hasFillTilesThisFrame&&this._hasLoadedTilesThisFrame&&CN.updateFillTiles(this,this._quadtree._tilesToRender,e,this._vertexArraysToDestroy);let t=this.quadtree,n=e.verticalExaggeration,i=e.verticalExaggerationRelativeHeight,o=this._oldVerticalExaggeration!==n||this._oldVerticalExaggerationRelativeHeight!==i;this._oldVerticalExaggeration=n,this._oldVerticalExaggerationRelativeHeight=i,o&&t.forEachLoadedTile(function(s){s.data.updateExaggeration(s,e,t)});let r=this._tilesToRenderByTextureCount;for(let s=0,a=r.length;s<a;++s){let l=r[s];if(c(l))for(let u=0,f=l.length;u<f;++u){let d=l[u],p=d.data.tileBoundingRegion;amt(this,d,e),e.minimumTerrainHeight=Math.min(e.minimumTerrainHeight,p.minimumHeight)}}};function F0e(e,t){let n=t.globeTranslucencyState;if(n.translucent){let i=e.renderState.blending.enabled;n.pushDerivedCommands(e,i,t)}else t.commandList.push(e)}Zo.prototype.updateForPick=function(e){let t=this._drawCommands;for(let n=0,i=this._usedDrawCommands;n<i;++n)F0e(t[n],e)};Zo.prototype.cancelReprojections=function(){this._imageryLayers.cancelReprojections()};Zo.prototype.getLevelMaximumGeometricError=function(e){return c(this._terrainProvider)?this._terrainProvider.getLevelMaximumGeometricError(e):0};Zo.prototype.loadTile=function(e,t){let n=t.data,i=!0,o;c(n)&&(i=n.boundingVolumeSourceTile!==t||t._lastSelectionResult===Xn.CULLED_BUT_NEEDED,o=n.terrainState),cm.processStateMachine(t,e,this.terrainProvider,this._imageryLayers,this.quadtree,this._vertexArraysToDestroy,i),n=t.data,i&&o!==t.data.terrainState&&this.computeTileVisibility(t,e,this.quadtree.occluders)!==Br.NONE&&n.boundingVolumeSourceTile===t&&(i=!1,cm.processStateMachine(t,e,this.terrainProvider,this._imageryLayers,this.quadtree,this._vertexArraysToDestroy,i))};var kht=new ce,B0e=new ae,Vht=new ae,Uht=new he;function SN(e,t){if(t.west<t.east)return t;let n=ae.clone(t,Vht);return ae.center(e,Uht).longitude>0?n.east=R.PI:n.west=-R.PI,n}function k0e(e,t){if(t.cameraUnderground||t.globeTranslucencyState.translucent)return!0;if(e.backFaceCulling)return!1;let n=e._clippingPlanes;if(c(n)&&n.enabled)return!0;let i=e._clippingPolygons;return!!(c(i)&&i.enabled||!ae.equals(e.cartographicLimitRectangle,ae.MAX_VALUE))}Zo.prototype.computeTileVisibility=function(e,t,n){let i=this.computeDistanceToTile(e,t);e._distance=i;let o=k0e(this,t);if(t.fog.enabled&&!o&&R.fog(i,t.fog.density)>=1)return Br.NONE;let r=e.data,s=r.tileBoundingRegion;if(r.boundingVolumeSourceTile===void 0)return Br.PARTIAL;let a=t.cullingVolume,l=s.boundingVolume;c(l)||(l=s.boundingSphere),r.clippedByBoundaries=!1;let u=SN(e.rectangle,this.cartographicLimitRectangle),f=ae.simpleIntersection(u,e.rectangle,B0e);if(!c(f))return Br.NONE;if(ae.equals(f,e.rectangle)||(r.clippedByBoundaries=!0),t.mode!==oe.SCENE3D&&(l=kht,ce.fromRectangleWithHeights2D(e.rectangle,t.mapProjection,s.minimumHeight,s.maximumHeight,l),h.fromElements(l.center.z,l.center.x,l.center.y,l.center),t.mode===oe.MORPHING&&c(r.renderedMesh)&&(l=ce.union(s.boundingSphere,l,l))),!c(l))return Br.PARTIAL;let d=this._clippingPlanes;if(c(d)&&d.enabled){let x=d.computeIntersectionWithBoundingVolume(l);if(e.isClipped=x!==qt.INSIDE,x===qt.OUTSIDE)return Br.NONE}let p=this._clippingPolygons;if(c(p)&&p.enabled){let x=p.computeIntersectionWithBoundingVolume(s);e.isClipped=x!==qt.OUTSIDE}let g,m=a.computeVisibility(l);if(m===qt.OUTSIDE?g=Br.NONE:m===qt.INTERSECTING?g=Br.PARTIAL:m===qt.INSIDE&&(g=Br.FULL),g===Br.NONE)return g;let b=t.mode===oe.SCENE3D&&t.camera.frustum instanceof rn;if(t.mode===oe.SCENE3D&&!b&&c(n)&&!o){let x=r.occludeePointInScaledSpace;return!c(x)||n.ellipsoid.isScaledSpacePointVisiblePossiblyUnderEllipsoid(x,s.minimumHeight)?g:Br.NONE}return g};Zo.prototype.canRefine=function(e){return c(e.data.terrainData)?!0:this.terrainProvider.getTileDataAvailable(e.x*2,e.y*2,e.level+1)!==void 0};var zht=[],Hht=[];Zo.prototype.canRenderWithoutLosingDetail=function(e,t){let n=e.data,i=zht;i.length=this._imageryLayers.length;let o=!1,r=!1,s;c(n)&&(o=n.terrainState===mo.READY,r=!0,s=n.imagery);let a,l;for(a=0,l=i.length;a<l;++a)i[a]=r;if(c(s))for(a=0,l=s.length;a<l;++a){let d=s[a],p=d.loadingImagery,g=!c(p)||p.state===ci.FAILED||p.state===ci.INVALID,m=(d.loadingImagery||d.readyImagery).imageryLayer._layerIndex;i[m]=g&&i[m]}let u=this.quadtree._lastSelectionFrameNumber,f=Hht;for(f.length=0,f.push(e.southwestChild,e.southeastChild,e.northwestChild,e.northeastChild);f.length>0;){let d=f.pop(),p=d._lastSelectionResultFrame===u?d._lastSelectionResult:Xn.NONE;if(p===Xn.RENDERED){let g=d.data;if(!c(g))continue;if(!o&&d.data.terrainState===mo.READY)return!1;let m=d.data.imagery;for(a=0,l=m.length;a<l;++a){let b=m[a],x=b.loadingImagery,T=!c(x)||x.state===ci.FAILED||x.state===ci.INVALID,C=(b.loadingImagery||b.readyImagery).imageryLayer._layerIndex;if(T&&!i[C])return!1}}else p===Xn.REFINED&&f.push(d.southwestChild,d.southeastChild,d.northwestChild,d.northeastChild)}return!0};var Ght=new h;Zo.prototype.computeTileLoadPriority=function(e,t){let n=e.data;if(n===void 0)return 0;let i=n.tileBoundingRegion.boundingVolume;if(i===void 0)return 0;let o=t.camera.positionWC,r=t.camera.directionWC,s=h.subtract(i.center,o,Ght),a=h.magnitude(s);return a<R.EPSILON5?0:(h.divideByScalar(s,a,s),(1-h.dot(s,r))*e._distance)};var R0e=new k,EN=new k,jht=new se,Wht=new se,qht=new se,Yht=new h,M0e=new h,Xht=new h,Kht=new h;Zo.prototype.showTileThisFrame=function(e,t){let n=0,i=e.data.imagery;for(let a=0,l=i.length;a<l;++a){let u=i[a];c(u.readyImagery)&&u.readyImagery.imageryLayer.alpha!==0&&++n}let o=this._tilesToRenderByTextureCount[n];c(o)||(o=[],this._tilesToRenderByTextureCount[n]=o),o.push(e);let r=e.data;c(r.vertexArray)?this._hasLoadedTilesThisFrame=!0:this._hasFillTilesThisFrame=!0;let s=this._debug;++s.tilesRendered,s.texturesRendered+=n};var $ht=[new h,new h,new h,new h];function L0e(e,t,n,i,o,r){let s=e.quadtree._occluders.ellipsoid,a=s.ellipsoid,l=$ht;return h.fromRadians(n.west,n.south,o,a,l[0]),h.fromRadians(n.east,n.south,o,a,l[1]),h.fromRadians(n.west,n.north,o,a,l[2]),h.fromRadians(n.east,n.north,o,a,l[3]),s.computeHorizonCullingPointPossiblyUnderEllipsoid(t,l,i,r)}Zo.prototype.computeDistanceToTile=function(e,t){Zht(e,this,t);let n=e.data;if(n.boundingVolumeSourceTile===void 0)return 9999999999;let o=n.tileBoundingRegion,r=o.minimumHeight,s=o.maximumHeight;if(n.boundingVolumeSourceTile!==e){let l=t.camera.positionCartographic.height,u=Math.abs(l-r),f=Math.abs(l-s);u>f?(o.minimumHeight=r,o.maximumHeight=r):(o.minimumHeight=s,o.maximumHeight=s)}let a=o.distanceToCamera(t);return o.minimumHeight=r,o.maximumHeight=s,a};function Zht(e,t,n){let i=e.data;i===void 0&&(i=e.data=new cm);let o=e.tilingScheme.ellipsoid;i.tileBoundingRegion===void 0&&(i.tileBoundingRegion=new wh({computeBoundingVolumes:!1,rectangle:e.rectangle,ellipsoid:o,minimumHeight:0,maximumHeight:0}));let r=i.tileBoundingRegion,s=r.minimumHeight,a=r.maximumHeight,l=!1,u=e,f=i.mesh,d=i.terrainData;if(f!==void 0&&f.minimumHeight!==void 0&&f.maximumHeight!==void 0)r.minimumHeight=f.minimumHeight,r.maximumHeight=f.maximumHeight,l=!0;else if(d!==void 0&&d._minimumHeight!==void 0&&d._maximumHeight!==void 0)r.minimumHeight=d._minimumHeight,r.maximumHeight=d._maximumHeight;else{r.minimumHeight=Number.NaN,r.maximumHeight=Number.NaN;let p=e.parent;for(;p!==void 0;){let g=p.data;if(g!==void 0){let m=g.mesh,b=g.terrainData;if(m!==void 0&&m.minimumHeight!==void 0&&m.maximumHeight!==void 0){r.minimumHeight=m.minimumHeight,r.maximumHeight=m.maximumHeight;break}else if(b!==void 0&&b._minimumHeight!==void 0&&b._maximumHeight!==void 0){r.minimumHeight=b._minimumHeight,r.maximumHeight=b._maximumHeight;break}}p=p.parent}u=p}if(u!==void 0){let p=n.verticalExaggeration,g=n.verticalExaggerationRelativeHeight;if(p!==1&&(l=!1,r.minimumHeight=zr.getHeight(r.minimumHeight,p,g),r.maximumHeight=zr.getHeight(r.maximumHeight,p,g)),l)i.boundingVolumeIsFromMesh||(r._orientedBoundingBox=Pn.clone(f.orientedBoundingBox,r._orientedBoundingBox),r._boundingSphere=ce.clone(f.boundingSphere3D,r._boundingSphere),i.occludeePointInScaledSpace=h.clone(f.occludeePointInScaledSpace,i.occludeePointInScaledSpace),c(i.occludeePointInScaledSpace)||(i.occludeePointInScaledSpace=L0e(t,r._orientedBoundingBox.center,e.rectangle,r.minimumHeight,r.maximumHeight,i.occludeePointInScaledSpace)));else{let b=r._orientedBoundingBox===void 0||r._boundingSphere===void 0;(r.minimumHeight!==s||r.maximumHeight!==a||b)&&(r.computeBoundingVolumes(o),i.occludeePointInScaledSpace=L0e(t,r._orientedBoundingBox.center,e.rectangle,r.minimumHeight,r.maximumHeight,i.occludeePointInScaledSpace))}i.boundingVolumeSourceTile=u,i.boundingVolumeIsFromMesh=l}else i.boundingVolumeSourceTile=void 0,i.boundingVolumeIsFromMesh=!1}Zo.prototype.isDestroyed=function(){return!1};Zo.prototype.destroy=function(){return this._tileProvider=this._tileProvider&&this._tileProvider.destroy(),this._clippingPlanes=this._clippingPlanes&&this._clippingPlanes.destroy(),this._clippingPolygons=this._clippingPolygons&&this._clippingPolygons.destroy(),this._removeLayerAddedListener=this._removeLayerAddedListener&&this._removeLayerAddedListener(),this._removeLayerRemovedListener=this._removeLayerRemovedListener&&this._removeLayerRemovedListener(),this._removeLayerMovedListener=this._removeLayerMovedListener&&this._removeLayerMovedListener(),this._removeLayerShownListener=this._removeLayerShownListener&&this._removeLayerShownListener(),de(this)};function Jht(e,t,n){return function(i){let o,r,s=-1,a=i.data.imagery,l=a.length,u;for(u=0;u<l;++u)if(o=a[u],r=y(o.readyImagery,o.loadingImagery),r.imageryLayer===t){s=u;break}if(s!==-1){let f=s+e;if(o=a[f],r=c(o)?y(o.readyImagery,o.loadingImagery):void 0,!c(r)||r.imageryLayer!==t)return!t._createTileImagerySkeletons(i,n,f);for(u=s;u<f;++u)a[u].freeResources();a.splice(s,e)}return!0}}Zo.prototype._onLayerAdded=function(e,t){if(!this.isDestroyed()&&e.show){let n=this._terrainProvider,i=this,o=this._imageryLayersUpdatedEvent,r=function(){e._imageryCache={},i._quadtree.forEachLoadedTile(function(s){if(c(s._loadedCallbacks[e._layerIndex]))return;let a,l=s.data.imagery,u=l.length,f=-1,d=0;for(a=0;a<u;++a){let g=l[a];if(y(g.readyImagery,g.loadingImagery).imageryLayer===e)f===-1&&(f=a),++d;else if(f!==-1)break}if(f===-1)return;let p=f+d;e._createTileImagerySkeletons(s,n,p)&&(s._loadedCallbacks[e._layerIndex]=Jht(d,e,n),s.state=Sa.LOADING)})};if(e.ready){let s=e.imageryProvider;s._reload=r}this._quadtree.forEachLoadedTile(function(s){e._createTileImagerySkeletons(s,n)&&(s.state=Sa.LOADING,s.level!==0&&(s._lastSelectionResultFrame!==i.quadtree._lastSelectionFrameNumber||s._lastSelectionResult!==Xn.RENDERED)&&(s.renderable=!1))}),this._layerOrderChanged=!0,o.raiseEvent()}};Zo.prototype._onLayerRemoved=function(e,t){this._quadtree.forEachLoadedTile(function(n){let i=n.data.imagery,o=-1,r=0;for(let s=0,a=i.length;s<a;++s){let l=i[s],u=l.loadingImagery;if(c(u)||(u=l.readyImagery),u.imageryLayer===e)o===-1&&(o=s),l.freeResources(),++r;else if(o!==-1)break}o!==-1&&i.splice(o,r)}),c(e.imageryProvider)&&(e.imageryProvider._reload=void 0),this._imageryLayersUpdatedEvent.raiseEvent()};Zo.prototype._onLayerMoved=function(e,t,n){this._layerOrderChanged=!0,this._imageryLayersUpdatedEvent.raiseEvent()};Zo.prototype._onLayerShownOrHidden=function(e,t,n){n?this._onLayerAdded(e,t):this._onLayerRemoved(e,t)};var Qht=new k,emt=new k;function N0e(e,t){let n={u_initialColor:function(){return this.properties.initialColor},u_fillHighlightColor:function(){return this.properties.fillHighlightColor},u_zoomedOutOceanSpecularIntensity:function(){return this.properties.zoomedOutOceanSpecularIntensity},u_oceanNormalMap:function(){return this.properties.oceanNormalMap},u_atmosphereLightIntensity:function(){return this.properties.atmosphereLightIntensity},u_atmosphereRayleighCoefficient:function(){return this.properties.atmosphereRayleighCoefficient},u_atmosphereMieCoefficient:function(){return this.properties.atmosphereMieCoefficient},u_atmosphereRayleighScaleHeight:function(){return this.properties.atmosphereRayleighScaleHeight},u_atmosphereMieScaleHeight:function(){return this.properties.atmosphereMieScaleHeight},u_atmosphereMieAnisotropy:function(){return this.properties.atmosphereMieAnisotropy},u_lightingFadeDistance:function(){return this.properties.lightingFadeDistance},u_nightFadeDistance:function(){return this.properties.nightFadeDistance},u_center3D:function(){return this.properties.center3D},u_verticalExaggerationAndRelativeHeight:function(){return this.properties.verticalExaggerationAndRelativeHeight},u_tileRectangle:function(){return this.properties.tileRectangle},u_modifiedModelView:function(){let i=e.context.uniformState.view,o=k.multiplyByPoint(i,this.properties.rtc,M0e);return k.setTranslation(i,o,R0e),R0e},u_modifiedModelViewProjection:function(){let i=e.context.uniformState.view,o=e.context.uniformState.projection,r=k.multiplyByPoint(i,this.properties.rtc,M0e);return k.setTranslation(i,r,EN),k.multiply(o,EN,EN),EN},u_dayTextures:function(){return this.properties.dayTextures},u_dayTextureTranslationAndScale:function(){return this.properties.dayTextureTranslationAndScale},u_dayTextureTexCoordsRectangle:function(){return this.properties.dayTextureTexCoordsRectangle},u_dayTextureUseWebMercatorT:function(){return this.properties.dayTextureUseWebMercatorT},u_dayTextureAlpha:function(){return this.properties.dayTextureAlpha},u_dayTextureNightAlpha:function(){return this.properties.dayTextureNightAlpha},u_dayTextureDayAlpha:function(){return this.properties.dayTextureDayAlpha},u_dayTextureBrightness:function(){return this.properties.dayTextureBrightness},u_dayTextureContrast:function(){return this.properties.dayTextureContrast},u_dayTextureHue:function(){return this.properties.dayTextureHue},u_dayTextureSaturation:function(){return this.properties.dayTextureSaturation},u_dayTextureOneOverGamma:function(){return this.properties.dayTextureOneOverGamma},u_dayIntensity:function(){return this.properties.dayIntensity},u_southAndNorthLatitude:function(){return this.properties.southAndNorthLatitude},u_southMercatorYAndOneOverHeight:function(){return this.properties.southMercatorYAndOneOverHeight},u_waterMask:function(){return this.properties.waterMask},u_waterMaskTranslationAndScale:function(){return this.properties.waterMaskTranslationAndScale},u_minMaxHeight:function(){return this.properties.minMaxHeight},u_scaleAndBias:function(){return this.properties.scaleAndBias},u_dayTextureSplit:function(){return this.properties.dayTextureSplit},u_dayTextureCutoutRectangles:function(){return this.properties.dayTextureCutoutRectangles},u_clippingPlanes:function(){let i=t._clippingPlanes;return c(i)&&c(i.texture)?i.texture:e.context.defaultTexture},u_cartographicLimitRectangle:function(){return this.properties.localizedCartographicLimitRectangle},u_clippingPlanesMatrix:function(){let i=t._clippingPlanes,o=c(i)?k.multiply(e.context.uniformState.view,i.modelMatrix,Qht):k.IDENTITY;return k.inverseTranspose(o,emt)},u_clippingPlanesEdgeStyle:function(){let i=this.properties.clippingPlanesEdgeColor;return i.alpha=this.properties.clippingPlanesEdgeWidth,i},u_clippingDistance:function(){let i=t._clippingPolygons.clippingTexture;return c(i)?i:e.context.defaultTexture},u_clippingExtents:function(){let i=t._clippingPolygons.extentsTexture;return c(i)?i:e.context.defaultTexture},u_minimumBrightness:function(){return e.fog.minimumBrightness},u_hsbShift:function(){return this.properties.hsbShift},u_colorsToAlpha:function(){return this.properties.colorsToAlpha},u_frontFaceAlphaByDistance:function(){return this.properties.frontFaceAlphaByDistance},u_backFaceAlphaByDistance:function(){return this.properties.backFaceAlphaByDistance},u_translucencyRectangle:function(){return this.properties.localizedTranslucencyRectangle},u_undergroundColor:function(){return this.properties.undergroundColor},u_undergroundColorAlphaByDistance:function(){return this.properties.undergroundColorAlphaByDistance},u_lambertDiffuseMultiplier:function(){return this.properties.lambertDiffuseMultiplier},u_vertexShadowDarkness:function(){return this.properties.vertexShadowDarkness},properties:{initialColor:new se(0,0,.5,1),fillHighlightColor:new j(0,0,0,0),zoomedOutOceanSpecularIntensity:.5,oceanNormalMap:void 0,lightingFadeDistance:new H(65e5,9e6),nightFadeDistance:new H(1e7,4e7),atmosphereLightIntensity:10,atmosphereRayleighCoefficient:new h(55e-7,13e-6,284e-7),atmosphereMieCoefficient:new h(21e-6,21e-6,21e-6),atmosphereRayleighScaleHeight:1e4,atmosphereMieScaleHeight:3200,atmosphereMieAnisotropy:.9,hsbShift:new h,center3D:void 0,rtc:new h,modifiedModelView:new k,tileRectangle:new se,verticalExaggerationAndRelativeHeight:new H(1,0),dayTextures:[],dayTextureTranslationAndScale:[],dayTextureTexCoordsRectangle:[],dayTextureUseWebMercatorT:[],dayTextureAlpha:[],dayTextureNightAlpha:[],dayTextureDayAlpha:[],dayTextureBrightness:[],dayTextureContrast:[],dayTextureHue:[],dayTextureSaturation:[],dayTextureOneOverGamma:[],dayTextureSplit:[],dayTextureCutoutRectangles:[],dayIntensity:0,colorsToAlpha:[],southAndNorthLatitude:new H,southMercatorYAndOneOverHeight:new H,waterMask:void 0,waterMaskTranslationAndScale:new se,minMaxHeight:new H,scaleAndBias:new k,clippingPlanesEdgeColor:j.clone(j.WHITE),clippingPlanesEdgeWidth:0,localizedCartographicLimitRectangle:new se,frontFaceAlphaByDistance:new se,backFaceAlphaByDistance:new se,localizedTranslucencyRectangle:new se,undergroundColor:j.clone(j.TRANSPARENT),undergroundColorAlphaByDistance:new se,lambertDiffuseMultiplier:0,vertexShadowDarkness:0}};return c(t.materialUniformMap)?At(n,t.materialUniformMap):n}function tmt(e,t,n){let i=n.data,o,r;if(c(i.vertexArray)?(o=i.mesh,r=i.vertexArray):c(i.fill)&&c(i.fill.vertexArray)&&(o=i.fill.mesh,r=i.fill.vertexArray),!(!c(o)||!c(r))){if(c(i.wireframeVertexArray)){if(i.wireframeVertexArray.mesh===o)return;i.wireframeVertexArray.destroy(),i.wireframeVertexArray=void 0}i.wireframeVertexArray=nmt(e,r,o),i.wireframeVertexArray.mesh=o}}function nmt(e,t,n){let o={indices:n.indices,primitiveType:Me.TRIANGLES};Fn.toWireframe(o);let r=o.indices,s=xt.createIndexBuffer({context:e,typedArray:r,usage:ke.STATIC_DRAW,indexDatatype:Fe.fromSizeInBytes(r.BYTES_PER_ELEMENT)});return new ni({context:e,attributes:t._attributes,indexBuffer:s})}var V0e,U0e,wN;(function(){let e=new vt({geometry:Sm.fromDimensions({dimensions:new h(2,2,2)})}),t=new vt({geometry:new j0({radius:1})}),n=new k,i,o;function r(s){return new Rn({geometryInstances:s,appearance:new ln({translucent:!1,flat:!0}),asynchronous:!1})}V0e=function(s,a){return s===i||(wN(),i=s,n=k.fromRotationTranslation(s.halfAxes,s.center,n),e.modelMatrix=n,e.attributes.color=Wt.fromColor(a),o=r(e)),o},U0e=function(s,a){return s===i||(wN(),i=s,n=k.fromTranslation(s.center,n),n=k.multiplyByUniformScale(n,s.radius,n),t.modelMatrix=n,t.attributes.color=Wt.fromColor(a),o=r(t)),o},wN=function(){c(o)&&(o.destroy(),o=void 0,i=void 0)}})();var imt=new se(0,0,0,0),omt={frameState:void 0,surfaceTile:void 0,numberOfDayTextures:void 0,applyBrightness:void 0,applyContrast:void 0,applyHue:void 0,applySaturation:void 0,applyGamma:void 0,applyAlpha:void 0,applyDayNightAlpha:void 0,applySplit:void 0,showReflectiveOcean:void 0,showOceanWaves:void 0,enableLighting:void 0,dynamicAtmosphereLighting:void 0,dynamicAtmosphereLightingFromSun:void 0,showGroundAtmosphere:void 0,perFragmentGroundAtmosphere:void 0,hasVertexNormals:void 0,useWebMercatorProjection:void 0,enableFog:void 0,enableClippingPlanes:void 0,clippingPlanes:void 0,enableClippingPolygons:void 0,clippingPolygons:void 0,clippedByBoundaries:void 0,hasImageryLayerCutout:void 0,colorCorrect:void 0,colorToAlpha:void 0,hasGeodeticSurfaceNormals:void 0,hasExaggeration:void 0},rmt=j.TRANSPARENT,smt=new Vt;function amt(e,t,n){let i=t.data;c(i.vertexArray)||(i.fill===void 0&&(i.fill=new CN(t)),i.fill.update(e,n));let o=n.creditDisplay,r=i.terrainData;if(c(r)&&c(r.credits)){let Ce=r.credits;for(let rt=0,Ri=Ce.length;rt<Ri;++rt)o.addCreditToNextFrame(Ce[rt])}let s=mt.maximumTextureImageUnits,a=i.waterMaskTexture,l=i.waterMaskTranslationAndScale;!c(a)&&c(i.fill)&&(a=i.fill.waterMaskTexture,l=i.fill.waterMaskTranslationAndScale);let u=n.cameraUnderground,f=n.globeTranslucencyState,d=f.translucent,p=f.frontFaceAlphaByDistance,g=f.backFaceAlphaByDistance,m=f.rectangle,b=y(e.undergroundColor,rmt),x=y(e.undergroundColorAlphaByDistance,smt),T=k0e(e,n)&&n.mode===oe.SCENE3D&&b.alpha>0&&(x.nearValue>0||x.farValue>0),C=e.lambertDiffuseMultiplier,S=e.vertexShadowDarkness,v=e.hasWaterMask&&c(a),D=v&&e.showWaterEffect,I=e.oceanNormalMap,L=D&&c(I),M=e.terrainProvider,N=c(M)&&e.terrainProvider.hasVertexNormals,B=n.fog.enabled&&n.fog.renderable&&!u,_=e.showGroundAtmosphere&&n.mode===oe.SCENE3D,w=En.castShadows(e.shadows)&&!d,P=En.receiveShadows(e.shadows)&&!d,O=e.hueShift,F=e.saturationShift,V=e.brightnessShift,G=!(R.equalsEpsilon(O,0,R.EPSILON7)&&R.equalsEpsilon(F,0,R.EPSILON7)&&R.equalsEpsilon(V,0,R.EPSILON7)),z=!1;if(_){let Ce=h.magnitude(n.camera.positionWC),rt=e.nightFadeOutDistance;z=Ce>rt}v&&--s,L&&--s,c(n.shadowState)&&n.shadowState.shadowsEnabled&&--s,c(e.clippingPlanes)&&e.clippingPlanes.enabled&&--s,c(e.clippingPolygons)&&e.clippingPolygons.enabled&&(--s,--s),s-=f.numberOfTextureUniforms;let W=i.renderedMesh,U=W.center,q=W.encoding,K=i.tileBoundingRegion,te=n.verticalExaggeration,Y=n.verticalExaggerationRelativeHeight,Z=te!==1,ee=q.hasGeodeticSurfaceNormals,me=jht,be=0,le=0,ge=0,xe=0,Pe=!1;if(n.mode!==oe.SCENE3D){let Ce=n.mapProjection,rt=Ce.project(ae.southwest(t.rectangle),Xht),Ri=Ce.project(ae.northeast(t.rectangle),Kht);if(me.x=rt.x,me.y=rt.y,me.z=Ri.x,me.w=Ri.y,n.mode!==oe.MORPHING&&(U=Yht,U.x=0,U.y=(me.z+me.x)*.5,U.z=(me.w+me.y)*.5,me.x-=U.y,me.y-=U.z,me.z-=U.y,me.w-=U.z),n.mode===oe.SCENE2D&&q.quantization===Ta.BITS12){let lt=1/(Math.pow(2,12)-1)*.5,ao=(me.z-me.x)*lt,Fo=(me.w-me.y)*lt;me.x-=ao,me.y-=Fo,me.z+=ao,me.w+=Fo}Ce instanceof Li&&(be=t.rectangle.south,le=t.rectangle.north,ge=Li.geodeticLatitudeToMercatorAngle(be),xe=1/(Li.geodeticLatitudeToMercatorAngle(le)-ge),Pe=!0)}let Ee=omt;Ee.frameState=n,Ee.surfaceTile=i,Ee.hasWaterMask=v,Ee.showReflectiveOcean=D,Ee.showOceanWaves=L,Ee.enableLighting=e.enableLighting,Ee.dynamicAtmosphereLighting=e.dynamicAtmosphereLighting,Ee.dynamicAtmosphereLightingFromSun=e.dynamicAtmosphereLightingFromSun,Ee.showGroundAtmosphere=_,Ee.atmosphereLightIntensity=e.atmosphereLightIntensity,Ee.atmosphereRayleighCoefficient=e.atmosphereRayleighCoefficient,Ee.atmosphereMieCoefficient=e.atmosphereMieCoefficient,Ee.atmosphereRayleighScaleHeight=e.atmosphereRayleighScaleHeight,Ee.atmosphereMieScaleHeight=e.atmosphereMieScaleHeight,Ee.atmosphereMieAnisotropy=e.atmosphereMieAnisotropy,Ee.perFragmentGroundAtmosphere=z,Ee.hasVertexNormals=N,Ee.useWebMercatorProjection=Pe,Ee.clippedByBoundaries=i.clippedByBoundaries,Ee.hasGeodeticSurfaceNormals=ee,Ee.hasExaggeration=Z;let Ue=i.imagery,Ye=0,it=Ue.length,It=e.showSkirts&&!u&&!d,Ot=e.backFaceCulling&&!u&&!d,He=Ot?e._renderState:e._disableCullingRenderState,tn=Ot?e._blendRenderState:e._disableCullingBlendRenderState,dt=He,bt=e._firstPassInitialColor,nn=n.context;if(c(e._debug.boundingSphereTile)||wN(),e._materialUniformMap!==e.materialUniformMap){e._materialUniformMap=e.materialUniformMap;let Ce=e._drawCommands.length;for(let rt=0;rt<Ce;++rt)e._uniformMaps[rt]=N0e(n,e)}do{let Ce=0,rt,Ri;if(e._drawCommands.length<=e._usedDrawCommands?(rt=new et,rt.owner=t,rt.cull=!1,rt.boundingVolume=new ce,rt.orientedBoundingBox=void 0,Ri=N0e(n,e),e._drawCommands.push(rt),e._uniformMaps.push(Ri)):(rt=e._drawCommands[e._usedDrawCommands],Ri=e._uniformMaps[e._usedDrawCommands]),rt.owner=t,++e._usedDrawCommands,t===e._debug.boundingSphereTile){let sa=K.boundingVolume,Gc=K.boundingSphere;c(sa)?V0e(sa,j.RED).update(n):c(Gc)&&U0e(Gc,j.RED).update(n)}let lt=Ri.properties;se.clone(bt,lt.initialColor),lt.oceanNormalMap=I,lt.lightingFadeDistance.x=e.lightingFadeOutDistance,lt.lightingFadeDistance.y=e.lightingFadeInDistance,lt.nightFadeDistance.x=e.nightFadeOutDistance,lt.nightFadeDistance.y=e.nightFadeInDistance,lt.atmosphereLightIntensity=e.atmosphereLightIntensity,lt.atmosphereRayleighCoefficient=e.atmosphereRayleighCoefficient,lt.atmosphereMieCoefficient=e.atmosphereMieCoefficient,lt.atmosphereRayleighScaleHeight=e.atmosphereRayleighScaleHeight,lt.atmosphereMieScaleHeight=e.atmosphereMieScaleHeight,lt.atmosphereMieAnisotropy=e.atmosphereMieAnisotropy,lt.zoomedOutOceanSpecularIntensity=e.zoomedOutOceanSpecularIntensity;let ao=u?g:p,Fo=u?p:g;c(ao)&&(se.fromElements(ao.near,ao.nearValue,ao.far,ao.farValue,lt.frontFaceAlphaByDistance),se.fromElements(Fo.near,Fo.nearValue,Fo.far,Fo.farValue,lt.backFaceAlphaByDistance)),se.fromElements(x.near,x.nearValue,x.far,x.farValue,lt.undergroundColorAlphaByDistance),j.clone(b,lt.undergroundColor),lt.lambertDiffuseMultiplier=C,lt.vertexShadowDarkness=S;let va=!c(i.vertexArray)&&c(e.fillHighlightColor)&&e.fillHighlightColor.alpha>0;va&&j.clone(e.fillHighlightColor,lt.fillHighlightColor),lt.verticalExaggerationAndRelativeHeight.x=te,lt.verticalExaggerationAndRelativeHeight.y=Y,lt.center3D=W.center,h.clone(U,lt.rtc),se.clone(me,lt.tileRectangle),lt.southAndNorthLatitude.x=be,lt.southAndNorthLatitude.y=le,lt.southMercatorYAndOneOverHeight.x=ge,lt.southMercatorYAndOneOverHeight.y=xe;let Cr=Wht,ss=SN(t.rectangle,e.cartographicLimitRectangle),Le=qht,st=SN(t.rectangle,m);h.fromElements(O,F,V,lt.hsbShift);let Xe=t.rectangle,Ze=1/Xe.width,ht=1/Xe.height;Cr.x=(ss.west-Xe.west)*Ze,Cr.y=(ss.south-Xe.south)*ht,Cr.z=(ss.east-Xe.west)*Ze,Cr.w=(ss.north-Xe.south)*ht,se.clone(Cr,lt.localizedCartographicLimitRectangle),Le.x=(st.west-Xe.west)*Ze,Le.y=(st.south-Xe.south)*ht,Le.z=(st.east-Xe.west)*Ze,Le.w=(st.north-Xe.south)*ht,se.clone(Le,lt.localizedTranslucencyRectangle);let jt=B&&R.fog(t._distance,n.fog.density)>R.EPSILON3;G=G&&(jt||_);let gn=!1,To=!1,_o=!1,Da=!1,Pa=!1,pi=!1,li=!1,Hs=!1,kr=!1,Hc=!1;for(;Ce<s&&Ye<it;){let sa=Ue[Ye],Gc=sa.readyImagery;if(++Ye,!c(Gc)||Gc.imageryLayer.alpha===0)continue;let Oa=sa.useWebMercatorT?Gc.textureWebMercator:Gc.texture;if(!c(Oa))throw new E("readyImagery is not actually ready!");let Kr=Gc.imageryLayer;c(sa.textureTranslationAndScale)||(sa.textureTranslationAndScale=Kr._calculateTextureTranslationAndScale(t,sa)),lt.dayTextures[Ce]=Oa,lt.dayTextureTranslationAndScale[Ce]=sa.textureTranslationAndScale,lt.dayTextureTexCoordsRectangle[Ce]=sa.textureCoordinateRectangle,lt.dayTextureUseWebMercatorT[Ce]=sa.useWebMercatorT,lt.dayTextureAlpha[Ce]=Kr.alpha,pi=pi||lt.dayTextureAlpha[Ce]!==1,lt.dayTextureNightAlpha[Ce]=Kr.nightAlpha,li=li||lt.dayTextureNightAlpha[Ce]!==1,lt.dayTextureDayAlpha[Ce]=Kr.dayAlpha,li=li||lt.dayTextureDayAlpha[Ce]!==1,lt.dayTextureBrightness[Ce]=Kr.brightness,gn=gn||lt.dayTextureBrightness[Ce]!==oc.DEFAULT_BRIGHTNESS,lt.dayTextureContrast[Ce]=Kr.contrast,To=To||lt.dayTextureContrast[Ce]!==oc.DEFAULT_CONTRAST,lt.dayTextureHue[Ce]=Kr.hue,_o=_o||lt.dayTextureHue[Ce]!==oc.DEFAULT_HUE,lt.dayTextureSaturation[Ce]=Kr.saturation,Da=Da||lt.dayTextureSaturation[Ce]!==oc.DEFAULT_SATURATION,lt.dayTextureOneOverGamma[Ce]=1/Kr.gamma,Pa=Pa||lt.dayTextureOneOverGamma[Ce]!==1/oc.DEFAULT_GAMMA,lt.dayTextureSplit[Ce]=Kr.splitDirection,Hs=Hs||lt.dayTextureSplit[Ce]!==0;let Eu=lt.dayTextureCutoutRectangles[Ce];if(c(Eu)||(Eu=lt.dayTextureCutoutRectangles[Ce]=new se),se.clone(se.ZERO,Eu),c(Kr.cutoutRectangle)){let So=SN(Xe,Kr.cutoutRectangle),on=ae.simpleIntersection(So,Xe,B0e);kr=c(on)||kr,Eu.x=(So.west-Xe.west)*Ze,Eu.y=(So.south-Xe.south)*ht,Eu.z=(So.east-Xe.west)*Ze,Eu.w=(So.north-Xe.south)*ht}let Su=lt.colorsToAlpha[Ce];c(Su)||(Su=lt.colorsToAlpha[Ce]=new se);let wu=c(Kr.colorToAlpha)&&Kr.colorToAlphaThreshold>0;if(Hc=Hc||wu,wu){let So=Kr.colorToAlpha;Su.x=So.red,Su.y=So.green,Su.z=So.blue,Su.w=Kr.colorToAlphaThreshold}else Su.w=-1;if(c(Gc.credits)){let So=Gc.credits;for(let on=0,Se=So.length;on<Se;++on)o.addCreditToNextFrame(So[on])}++Ce}lt.dayTextures.length=Ce,lt.waterMask=a,se.clone(l,lt.waterMaskTranslationAndScale),lt.minMaxHeight.x=q.minimumHeight,lt.minMaxHeight.y=q.maximumHeight,k.clone(q.matrix,lt.scaleAndBias);let co=e._clippingPlanes,Er=c(co)&&co.enabled&&t.isClipped;Er&&(lt.clippingPlanesEdgeColor=j.clone(co.edgeColor,lt.clippingPlanesEdgeColor),lt.clippingPlanesEdgeWidth=co.edgeWidth);let gm=e._clippingPolygons,Vr=c(gm)&&gm.enabled&&t.isClipped;Ee.numberOfDayTextures=Ce,Ee.applyBrightness=gn,Ee.applyContrast=To,Ee.applyHue=_o,Ee.applySaturation=Da,Ee.applyGamma=Pa,Ee.applyAlpha=pi,Ee.applyDayNightAlpha=li,Ee.applySplit=Hs,Ee.enableFog=jt,Ee.enableClippingPlanes=Er,Ee.clippingPlanes=co,Ee.enableClippingPolygons=Vr,Ee.clippingPolygons=gm,Ee.hasImageryLayerCutout=kr,Ee.colorCorrect=G,Ee.highlightFillTile=va,Ee.colorToAlpha=Hc,Ee.showUndergroundColor=T,Ee.translucent=d;let Cu=i.renderedMesh.indices.length;It||(Cu=i.renderedMesh.indexCountWithoutSkirts),rt.shaderProgram=e._surfaceShaderSet.getShaderProgram(Ee),rt.castShadows=w,rt.receiveShadows=P,rt.renderState=dt,rt.primitiveType=Me.TRIANGLES,rt.vertexArray=i.vertexArray||i.fill.vertexArray,rt.count=Cu,rt.uniformMap=Ri,rt.pass=ve.GLOBE,e._debug.wireframe&&(tmt(nn,e,t),c(i.wireframeVertexArray)&&(rt.vertexArray=i.wireframeVertexArray,rt.primitiveType=Me.LINES,rt.count=Cu*2));let Ia=rt.boundingVolume,Dy=rt.orientedBoundingBox;n.mode!==oe.SCENE3D?(ce.fromRectangleWithHeights2D(t.rectangle,n.mapProjection,K.minimumHeight,K.maximumHeight,Ia),h.fromElements(Ia.center.z,Ia.center.x,Ia.center.y,Ia.center),n.mode===oe.MORPHING&&(Ia=ce.union(K.boundingSphere,Ia,Ia))):(rt.boundingVolume=ce.clone(K.boundingSphere,Ia),rt.orientedBoundingBox=Pn.clone(K.boundingVolume,Dy)),rt.dirty=!0,d&&f.updateDerivedCommands(rt,n),F0e(rt,n),dt=tn,bt=imt}while(Ye<it)}var eY=Zo;function z0e(){this._enabled=!1,this._frontFaceAlpha=1,this._frontFaceAlphaByDistance=void 0,this._backFaceAlpha=1,this._backFaceAlphaByDistance=void 0,this._rectangle=ae.clone(ae.MAX_VALUE)}Object.defineProperties(z0e.prototype,{enabled:{get:function(){return this._enabled},set:function(e){A.typeOf.bool("enabled",e),this._enabled=e}},frontFaceAlpha:{get:function(){return this._frontFaceAlpha},set:function(e){A.typeOf.number.greaterThanOrEquals("frontFaceAlpha",e,0),A.typeOf.number.lessThanOrEquals("frontFaceAlpha",e,1),this._frontFaceAlpha=e}},frontFaceAlphaByDistance:{get:function(){return this._frontFaceAlphaByDistance},set:function(e){if(c(e)&&e.far<e.near)throw new E("far distance must be greater than near distance.");this._frontFaceAlphaByDistance=Vt.clone(e,this._frontFaceAlphaByDistance)}},backFaceAlpha:{get:function(){return this._backFaceAlpha},set:function(e){A.typeOf.number.greaterThanOrEquals("backFaceAlpha",e,0),A.typeOf.number.lessThanOrEquals("backFaceAlpha",e,1),this._backFaceAlpha=e}},backFaceAlphaByDistance:{get:function(){return this._backFaceAlphaByDistance},set:function(e){if(c(e)&&e.far<e.near)throw new E("far distance must be greater than near distance.");this._backFaceAlphaByDistance=Vt.clone(e,this._backFaceAlphaByDistance)}},rectangle:{get:function(){return this._rectangle},set:function(e){c(e)||(e=ae.clone(ae.MAX_VALUE)),ae.clone(e,this._rectangle)}}});var tY=z0e;function As(){this._layers=[],this.layerAdded=new pe,this.layerRemoved=new pe,this.layerMoved=new pe,this.layerShownOrHidden=new pe}Object.defineProperties(As.prototype,{length:{get:function(){return this._layers.length}}});As.prototype.add=function(e,t){let n=c(t);if(!c(e))throw new E("layer is required.");if(n){if(t<0)throw new E("index must be greater than or equal to zero.");if(t>this._layers.length)throw new E("index must be less than or equal to the number of layers.")}n?this._layers.splice(t,0,e):(t=this._layers.length,this._layers.push(e)),this._update(),this.layerAdded.raiseEvent(e,t);let i=e.readyEvent.addEventListener(()=>{this.layerShownOrHidden.raiseEvent(e,e._layerIndex,e.show),i()})};As.prototype.addImageryProvider=function(e,t){if(!c(e))throw new E("imageryProvider is required.");let n=new oc(e);return this.add(n,t),n};As.prototype.remove=function(e,t){t=y(t,!0);let n=this._layers.indexOf(e);return n!==-1?(this._layers.splice(n,1),this._update(),this.layerRemoved.raiseEvent(e,n),t&&e.destroy(),!0):!1};As.prototype.removeAll=function(e){e=y(e,!0);let t=this._layers;for(let n=0,i=t.length;n<i;n++){let o=t[n];this.layerRemoved.raiseEvent(o,n),e&&o.destroy()}this._layers=[]};As.prototype.contains=function(e){return this.indexOf(e)!==-1};As.prototype.indexOf=function(e){return this._layers.indexOf(e)};As.prototype.get=function(e){if(!c(e))throw new E("index is required.","index");return this._layers[e]};function vN(e,t){if(!c(t))throw new E("layer is required.");let n=e.indexOf(t);if(n===-1)throw new E("layer is not in this collection.");return n}function H0e(e,t,n){let i=e._layers;if(t=R.clamp(t,0,i.length-1),n=R.clamp(n,0,i.length-1),t===n)return;let o=i[t];i[t]=i[n],i[n]=o,e._update(),e.layerMoved.raiseEvent(o,n,t)}As.prototype.raise=function(e){let t=vN(this._layers,e);H0e(this,t,t+1)};As.prototype.lower=function(e){let t=vN(this._layers,e);H0e(this,t,t-1)};As.prototype.raiseToTop=function(e){let t=vN(this._layers,e);t!==this._layers.length-1&&(this._layers.splice(t,1),this._layers.push(e),this._update(),this.layerMoved.raiseEvent(e,this._layers.length-1,t))};As.prototype.lowerToBottom=function(e){let t=vN(this._layers,e);t!==0&&(this._layers.splice(t,1),this._layers.splice(0,0,e),this._update(),this.layerMoved.raiseEvent(e,0,t))};var cmt=new ae;function G0e(e,t,n,i){let o=e.globe._surface._tilesToRender,r;for(let a=0;!c(r)&&a<o.length;++a){let l=o[a];ae.contains(l.rectangle,t)&&(r=l)}if(!c(r))return;let s=r.data.imagery;for(let a=s.length-1;a>=0;--a){let l=s[a],u=l.readyImagery;if(!c(u)||!u.imageryLayer.ready)continue;let f=u.imageryLayer.imageryProvider;if(n&&!c(f.pickFeatures)||!ae.contains(u.rectangle,t))continue;let d=cmt,p=1/1024;d.west=R.lerp(r.rectangle.west,r.rectangle.east,l.textureCoordinateRectangle.x-p),d.east=R.lerp(r.rectangle.west,r.rectangle.east,l.textureCoordinateRectangle.z+p),d.south=R.lerp(r.rectangle.south,r.rectangle.north,l.textureCoordinateRectangle.y-p),d.north=R.lerp(r.rectangle.south,r.rectangle.north,l.textureCoordinateRectangle.w+p),ae.contains(d,t)&&i(u)}}As.prototype.pickImageryLayers=function(e,t){let n=t.globe.pick(e,t);if(!c(n))return;let i=t.ellipsoid.cartesianToCartographic(n),o=[];if(G0e(t,i,!1,function(r){o.push(r.imageryLayer)}),o.length!==0)return o};As.prototype.pickImageryLayerFeatures=function(e,t){let n=t.globe.pick(e,t);if(!c(n))return;let i=t.ellipsoid.cartesianToCartographic(n),o=[],r=[];if(G0e(t,i,!0,function(s){if(!s.imageryLayer.ready)return;let l=s.imageryLayer.imageryProvider.pickFeatures(s.x,s.y,s.level,i.longitude,i.latitude);c(l)&&(o.push(l),r.push(s.imageryLayer))}),o.length!==0)return Promise.all(o).then(function(s){let a=[];for(let l=0;l<s.length;++l){let u=s[l],f=r[l];if(c(u)&&u.length>0)for(let d=0;d<u.length;++d){let p=u[d];p.imageryLayer=f,c(p.position)||(p.position=i),a.push(p)}}return a})};As.prototype.queueReprojectionCommands=function(e){let t=this._layers;for(let n=0,i=t.length;n<i;++n)t[n].queueReprojectionCommands(e)};As.prototype.cancelReprojections=function(){let e=this._layers;for(let t=0,n=e.length;t<n;++t)e[t].cancelReprojections()};As.prototype.isDestroyed=function(){return!1};As.prototype.destroy=function(){return this.removeAll(!0),de(this)};As.prototype._update=function(){let e=!0,t=this._layers,n,i,o,r;for(o=0,r=t.length;o<r;++o)i=t[o],i._layerIndex=o,i.show?(i._isBaseLayer=e,e=!1):i._isBaseLayer=!1,i.show!==i._show&&(c(i._show)&&(c(n)||(n=[]),n.push(i)),i._show=i.show);if(c(n))for(o=0,r=n.length;o<r;++o)i=n[o],this.layerShownOrHidden.raiseEvent(i,i._layerIndex,i.show)};var nY=As;function j0e(e){this._ellipsoid=new Z0(e.ellipsoid,h.ZERO)}Object.defineProperties(j0e.prototype,{ellipsoid:{get:function(){return this._ellipsoid}}});var iY=j0e;function Nc(e){if(!c(e))throw new E("options is required.");if(c(e.x))if(c(e.y)){if(e.x<0||e.y<0)throw new E("options.x and options.y must be greater than or equal to zero.")}else throw new E("options.y is required.");else throw new E("options.x is required.");if(!c(e.level))throw new E("options.level is required and must be greater than or equal to zero.");if(!c(e.tilingScheme))throw new E("options.tilingScheme is required.");this._tilingScheme=e.tilingScheme,this._x=e.x,this._y=e.y,this._level=e.level,this._parent=e.parent,this._rectangle=this._tilingScheme.tileXYToRectangle(this._x,this._y,this._level),this._southwestChild=void 0,this._southeastChild=void 0,this._northwestChild=void 0,this._northeastChild=void 0,this.replacementPrevious=void 0,this.replacementNext=void 0,this._distance=0,this._loadPriority=0,this._customData=[],this._frameUpdated=void 0,this._lastSelectionResult=Xn.NONE,this._lastSelectionResultFrame=void 0,this._loadedCallbacks={},this.state=Sa.START,this.renderable=!1,this.upsampledFromParent=!1,this.data=void 0}Nc.createLevelZeroTiles=function(e){if(!c(e))throw new E("tilingScheme is required.");let t=e.getNumberOfXTilesAtLevel(0),n=e.getNumberOfYTilesAtLevel(0),i=new Array(t*n),o=0;for(let r=0;r<n;++r)for(let s=0;s<t;++s)i[o++]=new Nc({tilingScheme:e,x:s,y:r,level:0});return i};Nc.prototype._updateCustomData=function(e,t,n){let i=this.customData,o,r,s;if(c(t)&&c(n)){for(i=i.filter(function(a){return n.indexOf(a)===-1}),this._customData=i,s=this._rectangle,o=0;o<t.length;++o)r=t[o],ae.contains(s,r.positionCartographic)&&i.push(r);this._frameUpdated=e}else{let a=this._parent;if(c(a)&&this._frameUpdated!==a._frameUpdated){i.length=0,s=this._rectangle;let l=a.customData;for(o=0;o<l.length;++o)r=l[o],ae.contains(s,r.positionCartographic)&&i.push(r);this._frameUpdated=a._frameUpdated}}};Object.defineProperties(Nc.prototype,{tilingScheme:{get:function(){return this._tilingScheme}},x:{get:function(){return this._x}},y:{get:function(){return this._y}},level:{get:function(){return this._level}},parent:{get:function(){return this._parent}},rectangle:{get:function(){return this._rectangle}},children:{get:function(){return[this.northwestChild,this.northeastChild,this.southwestChild,this.southeastChild]}},southwestChild:{get:function(){return c(this._southwestChild)||(this._southwestChild=new Nc({tilingScheme:this.tilingScheme,x:this.x*2,y:this.y*2+1,level:this.level+1,parent:this})),this._southwestChild}},southeastChild:{get:function(){return c(this._southeastChild)||(this._southeastChild=new Nc({tilingScheme:this.tilingScheme,x:this.x*2+1,y:this.y*2+1,level:this.level+1,parent:this})),this._southeastChild}},northwestChild:{get:function(){return c(this._northwestChild)||(this._northwestChild=new Nc({tilingScheme:this.tilingScheme,x:this.x*2,y:this.y*2,level:this.level+1,parent:this})),this._northwestChild}},northeastChild:{get:function(){return c(this._northeastChild)||(this._northeastChild=new Nc({tilingScheme:this.tilingScheme,x:this.x*2+1,y:this.y*2,level:this.level+1,parent:this})),this._northeastChild}},customData:{get:function(){return this._customData}},needsLoading:{get:function(){return this.state<Sa.DONE}},eligibleForUnloading:{get:function(){let e=!0;return c(this.data)&&(e=this.data.eligibleForUnloading,c(e)||(e=!0)),e}}});Nc.prototype.findLevelZeroTile=function(e,t,n){let i=this.tilingScheme.getNumberOfXTilesAtLevel(0);if(t<0?t+=i:t>=i&&(t-=i),!(n<0||n>=this.tilingScheme.getNumberOfYTilesAtLevel(0)))return e.filter(function(o){return o.x===t&&o.y===n})[0]};Nc.prototype.findTileToWest=function(e){let t=this.parent;if(t===void 0)return this.findLevelZeroTile(e,this.x-1,this.y);if(t.southeastChild===this)return t.southwestChild;if(t.northeastChild===this)return t.northwestChild;let n=t.findTileToWest(e);if(n!==void 0)return t.southwestChild===this?n.southeastChild:n.northeastChild};Nc.prototype.findTileToEast=function(e){let t=this.parent;if(t===void 0)return this.findLevelZeroTile(e,this.x+1,this.y);if(t.southwestChild===this)return t.southeastChild;if(t.northwestChild===this)return t.northeastChild;let n=t.findTileToEast(e);if(n!==void 0)return t.southeastChild===this?n.southwestChild:n.northwestChild};Nc.prototype.findTileToSouth=function(e){let t=this.parent;if(t===void 0)return this.findLevelZeroTile(e,this.x,this.y+1);if(t.northwestChild===this)return t.southwestChild;if(t.northeastChild===this)return t.southeastChild;let n=t.findTileToSouth(e);if(n!==void 0)return t.southwestChild===this?n.northwestChild:n.northeastChild};Nc.prototype.findTileToNorth=function(e){let t=this.parent;if(t===void 0)return this.findLevelZeroTile(e,this.x,this.y-1);if(t.southwestChild===this)return t.northwestChild;if(t.southeastChild===this)return t.northeastChild;let n=t.findTileToNorth(e);if(n!==void 0)return t.northwestChild===this?n.southwestChild:n.southeastChild};Nc.prototype.freeResources=function(){this.state=Sa.START,this.renderable=!1,this.upsampledFromParent=!1,c(this.data)&&c(this.data.freeResources)&&this.data.freeResources(),DN(this._southwestChild),this._southwestChild=void 0,DN(this._southeastChild),this._southeastChild=void 0,DN(this._northwestChild),this._northwestChild=void 0,DN(this._northeastChild),this._northeastChild=void 0};function DN(e){c(e)&&e.freeResources()}var oY=Nc;function PN(){this.head=void 0,this.tail=void 0,this.count=0,this._lastBeforeStartOfFrame=void 0}PN.prototype.markStartOfRenderFrame=function(){this._lastBeforeStartOfFrame=this.head};PN.prototype.trimTiles=function(e){let t=this.tail,n=!0;for(;n&&c(this._lastBeforeStartOfFrame)&&this.count>e&&c(t);){n=t!==this._lastBeforeStartOfFrame;let i=t.replacementPrevious;t.eligibleForUnloading&&(t.freeResources(),W0e(this,t)),t=i}};function W0e(e,t){let n=t.replacementPrevious,i=t.replacementNext;t===e._lastBeforeStartOfFrame&&(e._lastBeforeStartOfFrame=i),t===e.head?e.head=i:n.replacementNext=i,t===e.tail?e.tail=n:i.replacementPrevious=n,t.replacementPrevious=void 0,t.replacementNext=void 0,--e.count}PN.prototype.markTileRendered=function(e){let t=this.head;if(t===e){e===this._lastBeforeStartOfFrame&&(this._lastBeforeStartOfFrame=e.replacementNext);return}if(++this.count,!c(t)){e.replacementPrevious=void 0,e.replacementNext=void 0,this.head=e,this.tail=e;return}(c(e.replacementPrevious)||c(e.replacementNext))&&W0e(this,e),e.replacementPrevious=void 0,e.replacementNext=t,t.replacementPrevious=e,this.head=e};var rY=PN;function vf(e){if(!c(e)||!c(e.tileProvider))throw new E("options.tileProvider is required.");if(c(e.tileProvider.quadtree))throw new E("A QuadtreeTileProvider can only be used with a single QuadtreePrimitive");this._tileProvider=e.tileProvider,this._tileProvider.quadtree=this,this._debug={enableDebugOutput:!1,maxDepth:0,maxDepthVisited:0,tilesVisited:0,tilesCulled:0,tilesRendered:0,tilesWaitingForChildren:0,lastMaxDepth:-1,lastMaxDepthVisited:-1,lastTilesVisited:-1,lastTilesCulled:-1,lastTilesRendered:-1,lastTilesWaitingForChildren:-1,suspendLodUpdate:!1};let n=this._tileProvider.tilingScheme.ellipsoid;this._tilesToRender=[],this._tileLoadQueueHigh=[],this._tileLoadQueueMedium=[],this._tileLoadQueueLow=[],this._tileReplacementQueue=new rY,this._levelZeroTiles=void 0,this._loadQueueTimeSlice=5,this._tilesInvalidated=!1,this._addHeightCallbacks=[],this._removeHeightCallbacks=[],this._tileToUpdateHeights=[],this._lastTileIndex=0,this._updateHeightsTimeSlice=2,this._cameraPositionCartographic=void 0,this._cameraReferenceFrameOriginCartographic=void 0,this.maximumScreenSpaceError=y(e.maximumScreenSpaceError,2),this.tileCacheSize=y(e.tileCacheSize,100),this.loadingDescendantLimit=20,this.preloadAncestors=!0,this.preloadSiblings=!1,this._occluders=new iY({ellipsoid:n}),this._tileLoadProgressEvent=new pe,this._lastTileLoadQueueLength=0,this._lastSelectionFrameNumber=void 0}Object.defineProperties(vf.prototype,{tileProvider:{get:function(){return this._tileProvider}},tileLoadProgressEvent:{get:function(){return this._tileLoadProgressEvent}},occluders:{get:function(){return this._occluders}}});vf.prototype.invalidateAllTiles=function(){this._tilesInvalidated=!0};function lmt(e){let t=e._tileReplacementQueue;t.head=void 0,t.tail=void 0,t.count=0,Y0e(e);let n=e._levelZeroTiles;if(c(n))for(let i=0;i<n.length;++i){let r=n[i].customData,s=r.length;for(let a=0;a<s;++a){let l=r[a];l.level=0,e._addHeightCallbacks.push(l)}n[i].freeResources()}e._levelZeroTiles=void 0,e._tileProvider.cancelReprojections()}vf.prototype.forEachLoadedTile=function(e){let t=this._tileReplacementQueue.head;for(;c(t);)t.state!==Sa.START&&e(t),t=t.replacementNext};vf.prototype.forEachRenderedTile=function(e){let t=this._tilesToRender;for(let n=0,i=t.length;n<i;++n)e(t[n])};vf.prototype.updateHeight=function(e,t){let n=this,i={positionOnEllipsoidSurface:void 0,positionCartographic:e,level:-1,callback:t};return i.removeFunc=function(){let o=n._addHeightCallbacks,r=o.length;for(let s=0;s<r;++s)if(o[s]===i){o.splice(s,1);break}n._removeHeightCallbacks.push(i),i.callback&&(i.callback=void 0)},n._addHeightCallbacks.push(i),i.removeFunc};vf.prototype.update=function(e){c(this._tileProvider.update)&&this._tileProvider.update(e)};function Y0e(e){let t=e._debug;t.maxDepth=0,t.maxDepthVisited=0,t.tilesVisited=0,t.tilesCulled=0,t.tilesRendered=0,t.tilesWaitingForChildren=0,e._tileLoadQueueHigh.length=0,e._tileLoadQueueMedium.length=0,e._tileLoadQueueLow.length=0}vf.prototype.beginFrame=function(e){e.passes.render&&(this._tilesInvalidated&&(lmt(this),this._tilesInvalidated=!1),this._tileProvider.initialize(e),Y0e(this),!this._debug.suspendLodUpdate&&this._tileReplacementQueue.markStartOfRenderFrame())};vf.prototype.render=function(e){let t=e.passes,n=this._tileProvider;t.render&&(n.beginUpdate(e),hmt(this,e),Cmt(this,e),n.endUpdate(e)),t.pick&&this._tilesToRender.length>0&&n.updateForPick(e)};function umt(e,t){let n=e._tileLoadQueueHigh.length+e._tileLoadQueueMedium.length+e._tileLoadQueueLow.length;if(n!==e._lastTileLoadQueueLength||e._tilesInvalidated){let o=pe.prototype.raiseEvent.bind(e._tileLoadProgressEvent,n);t.afterRender.push(()=>(o(),!0)),e._lastTileLoadQueueLength=n}let i=e._debug;i.enableDebugOutput&&!i.suspendLodUpdate&&(i.maxDepth=e._tilesToRender.reduce(function(o,r){return Math.max(o,r.level)},-1),i.tilesRendered=e._tilesToRender.length,(i.tilesVisited!==i.lastTilesVisited||i.tilesRendered!==i.lastTilesRendered||i.tilesCulled!==i.lastTilesCulled||i.maxDepth!==i.lastMaxDepth||i.tilesWaitingForChildren!==i.lastTilesWaitingForChildren||i.maxDepthVisited!==i.lastMaxDepthVisited)&&(console.log(`Visited ${i.tilesVisited}, Rendered: ${i.tilesRendered}, Culled: ${i.tilesCulled}, Max Depth Rendered: ${i.maxDepth}, Max Depth Visited: ${i.maxDepthVisited}, Waiting for children: ${i.tilesWaitingForChildren}`),i.lastTilesVisited=i.tilesVisited,i.lastTilesRendered=i.tilesRendered,i.lastTilesCulled=i.tilesCulled,i.lastMaxDepth=i.maxDepth,i.lastTilesWaitingForChildren=i.tilesWaitingForChildren,i.lastMaxDepthVisited=i.maxDepthVisited))}vf.prototype.endFrame=function(e){!e.passes.render||e.mode===oe.MORPHING||(bmt(this,e),Amt(this,e),umt(this,e))};vf.prototype.isDestroyed=function(){return!1};vf.prototype.destroy=function(){this._tileProvider=this._tileProvider&&this._tileProvider.destroy()};var QD,q0e=new he;function fmt(e,t){let n=ae.center(e.rectangle,q0e),i=n.longitude-QD.longitude,o=n.latitude-QD.latitude;n=ae.center(t.rectangle,q0e);let r=n.longitude-QD.longitude,s=n.latitude-QD.latitude;return i*i+o*o-(r*r+s*s)}var dmt=new h,JD=[];function hmt(e,t){let n=e._debug;if(n.suspendLodUpdate)return;let i=e._tilesToRender;i.length=0;let o,r=e._tileProvider;if(!c(e._levelZeroTiles)){let b=r.tilingScheme;if(c(b)){let x=r.tilingScheme;e._levelZeroTiles=oY.createLevelZeroTiles(x);let T=e._levelZeroTiles.length;if(JD.length<T)for(JD=new Array(T),o=0;o<T;++o)JD[o]===void 0&&(JD[o]=new eP)}else return}e._occluders.ellipsoid.cameraPosition=t.camera.positionWC;let s,a=e._levelZeroTiles,l=a.length>1?e._occluders:void 0;QD=t.camera.positionCartographic,a.sort(fmt);let u=e._addHeightCallbacks,f=e._removeHeightCallbacks,d=t.frameNumber,p;if(u.length>0||f.length>0){for(o=0,p=a.length;o<p;++o)s=a[o],s._updateCustomData(d,u,f);u.length=0,f.length=0}let g=t.camera;e._cameraPositionCartographic=g.positionCartographic;let m=k.getTranslation(g.transform,dmt);for(e._cameraReferenceFrameOriginCartographic=e.tileProvider.tilingScheme.ellipsoid.cartesianToCartographic(m,e._cameraReferenceFrameOriginCartographic),o=0,p=a.length;o<p;++o)s=a[o],e._tileReplacementQueue.markTileRendered(s),s.renderable?wa(e,s,r,t,l,!1,JD[o]):(t_(e,e._tileLoadQueueHigh,s,t),++n.tilesWaitingForChildren);e._lastSelectionFrameNumber=d}function t_(e,t,n,i){n.needsLoading&&(e.tileProvider.computeTileLoadPriority!==void 0&&(n._loadPriority=e.tileProvider.computeTileLoadPriority(n,i)),t.push(n))}function eP(){this.allAreRenderable=!0,this.anyWereRenderedLastFrame=!1,this.notYetRenderableCount=0}function X0e(){this.southwest=new eP,this.southeast=new eP,this.northwest=new eP,this.northeast=new eP}X0e.prototype.combine=function(e){let t=this.southwest,n=this.southeast,i=this.northwest,o=this.northeast;e.allAreRenderable=t.allAreRenderable&&n.allAreRenderable&&i.allAreRenderable&&o.allAreRenderable,e.anyWereRenderedLastFrame=t.anyWereRenderedLastFrame||n.anyWereRenderedLastFrame||i.anyWereRenderedLastFrame||o.anyWereRenderedLastFrame,e.notYetRenderableCount=t.notYetRenderableCount+n.notYetRenderableCount+i.notYetRenderableCount+o.notYetRenderableCount};var cY=new Array(31);for(let e=0;e<cY.length;++e)cY[e]=new X0e;function mmt(e,t,n,i,o){let r=e._debug;++r.tilesVisited,e._tileReplacementQueue.markTileRendered(n),n._updateCustomData(t.frameNumber),n.level>r.maxDepthVisited&&(r.maxDepthVisited=n.level);let s=gmt(e,t,n)<e.maximumScreenSpaceError,a=n.southwestChild,l=n.southeastChild,u=n.northwestChild,f=n.northeastChild,d=e._lastSelectionFrameNumber,p=n._lastSelectionResultFrame===d?n._lastSelectionResult:Xn.NONE,g=e.tileProvider;if(s||i){let m=Xn.originalResult(p)===Xn.RENDERED,b=Xn.originalResult(p)===Xn.CULLED||p===Xn.NONE,x=n.state===Sa.DONE,T=m||b||x;if(T||c(g.canRenderWithoutLosingDetail)&&(T=g.canRenderWithoutLosingDetail(n)),T){s&&t_(e,e._tileLoadQueueMedium,n,t),IN(e,n),o.allAreRenderable=n.renderable,o.anyWereRenderedLastFrame=p===Xn.RENDERED,o.notYetRenderableCount=n.renderable?0:1,n._lastSelectionResultFrame=t.frameNumber,n._lastSelectionResult=Xn.RENDERED,o.anyWereRenderedLastFrame||e._tileToUpdateHeights.push(n);return}i=!0,s&&t_(e,e._tileLoadQueueHigh,n,t)}if(g.canRefine(n)){if(a.upsampledFromParent&&l.upsampledFromParent&&u.upsampledFromParent&&f.upsampledFromParent){IN(e,n),t_(e,e._tileLoadQueueMedium,n,t),e._tileReplacementQueue.markTileRendered(a),e._tileReplacementQueue.markTileRendered(l),e._tileReplacementQueue.markTileRendered(u),e._tileReplacementQueue.markTileRendered(f),o.allAreRenderable=n.renderable,o.anyWereRenderedLastFrame=p===Xn.RENDERED,o.notYetRenderableCount=n.renderable?0:1,n._lastSelectionResultFrame=t.frameNumber,n._lastSelectionResult=Xn.RENDERED,o.anyWereRenderedLastFrame||e._tileToUpdateHeights.push(n);return}n._lastSelectionResultFrame=t.frameNumber,n._lastSelectionResult=Xn.REFINED;let b=e._tilesToRender.length,x=e._tileLoadQueueLow.length,T=e._tileLoadQueueMedium.length,C=e._tileLoadQueueHigh.length,S=e._tileToUpdateHeights.length;if(pmt(e,a,l,u,f,t,i,o),b!==e._tilesToRender.length){let v=o.allAreRenderable,D=o.anyWereRenderedLastFrame,I=o.notYetRenderableCount,L=!1;if(!v&&!D){let M=e._tilesToRender;for(let B=b;B<M.length;++B){let _=M[B];for(;_!==void 0&&_._lastSelectionResult!==Xn.KICKED&&_!==n;)_._lastSelectionResult=Xn.kick(_._lastSelectionResult),_=_.parent}e._tilesToRender.length=b,e._tileToUpdateHeights.length=S,IN(e,n),n._lastSelectionResult=Xn.RENDERED;let N=p===Xn.RENDERED;!N&&I>e.loadingDescendantLimit&&(e._tileLoadQueueLow.length=x,e._tileLoadQueueMedium.length=T,e._tileLoadQueueHigh.length=C,t_(e,e._tileLoadQueueMedium,n,t),o.notYetRenderableCount=n.renderable?0:1,L=!0),o.allAreRenderable=n.renderable,o.anyWereRenderedLastFrame=N,N||e._tileToUpdateHeights.push(n),++r.tilesWaitingForChildren}e.preloadAncestors&&!L&&t_(e,e._tileLoadQueueLow,n,t)}return}n._lastSelectionResultFrame=t.frameNumber,n._lastSelectionResult=Xn.RENDERED,IN(e,n),t_(e,e._tileLoadQueueHigh,n,t),o.allAreRenderable=n.renderable,o.anyWereRenderedLastFrame=p===Xn.RENDERED,o.notYetRenderableCount=n.renderable?0:1}function pmt(e,t,n,i,o,r,s,a){let l=r.camera.positionCartographic,u=e._tileProvider,f=e._occluders,d=cY[t.level],p=d.southwest,g=d.southeast,m=d.northwest,b=d.northeast;l.longitude<t.rectangle.east?l.latitude<t.rectangle.north?(wa(e,t,u,r,f,s,p),wa(e,n,u,r,f,s,g),wa(e,i,u,r,f,s,m),wa(e,o,u,r,f,s,b)):(wa(e,i,u,r,f,s,m),wa(e,t,u,r,f,s,p),wa(e,o,u,r,f,s,b),wa(e,n,u,r,f,s,g)):l.latitude<t.rectangle.north?(wa(e,n,u,r,f,s,g),wa(e,t,u,r,f,s,p),wa(e,o,u,r,f,s,b),wa(e,i,u,r,f,s,m)):(wa(e,o,u,r,f,s,b),wa(e,i,u,r,f,s,m),wa(e,n,u,r,f,s,g),wa(e,t,u,r,f,s,p)),d.combine(a)}function _mt(e,t){let n=t.rectangle;return c(e._cameraPositionCartographic)&&ae.contains(n,e._cameraPositionCartographic)||c(e._cameraReferenceFrameOriginCartographic)&&ae.contains(n,e._cameraReferenceFrameOriginCartographic)}function wa(e,t,n,i,o,r,s){if(n.computeTileVisibility(t,i,o)!==Br.NONE)return mmt(e,i,t,r,s);if(++e._debug.tilesCulled,e._tileReplacementQueue.markTileRendered(t),s.allAreRenderable=!0,s.anyWereRenderedLastFrame=!1,s.notYetRenderableCount=0,_mt(e,t)){(!c(t.data)||!c(t.data.vertexArray))&&t_(e,e._tileLoadQueueMedium,t,i);let a=e._lastSelectionFrameNumber,l=t._lastSelectionResultFrame===a?t._lastSelectionResult:Xn.NONE;l!==Xn.CULLED_BUT_NEEDED&&l!==Xn.RENDERED&&e._tileToUpdateHeights.push(t),t._lastSelectionResult=Xn.CULLED_BUT_NEEDED}else e.preloadSiblings||t.level===0?(t_(e,e._tileLoadQueueLow,t,i),t._lastSelectionResult=Xn.CULLED):t._lastSelectionResult=Xn.CULLED;t._lastSelectionResultFrame=i.frameNumber}function gmt(e,t,n){if(t.mode===oe.SCENE2D||t.camera.frustum instanceof rn||t.camera.frustum instanceof er)return ymt(e,t,n);let i=e._tileProvider.getLevelMaximumGeometricError(n.level),o=n._distance,r=t.context.drawingBufferHeight,s=t.camera.frustum.sseDenominator,a=i*r/(o*s);return t.fog.enabled&&(a-=R.fog(o,t.fog.density)*t.fog.sse),a/=t.pixelRatio,a}function ymt(e,t,n){let o=t.camera.frustum,r=o.offCenterFrustum;c(r)&&(o=r);let s=t.context,a=s.drawingBufferWidth,l=s.drawingBufferHeight,u=e._tileProvider.getLevelMaximumGeometricError(n.level),f=Math.max(o.top-o.bottom,o.right-o.left)/Math.max(a,l),d=u/f;return t.fog.enabled&&t.mode!==oe.SCENE2D&&(d-=R.fog(n._distance,t.fog.density)*t.fog.sse),d/=t.pixelRatio,d}function IN(e,t){e._tilesToRender.push(t)}function bmt(e,t){let n=e._tileLoadQueueHigh,i=e._tileLoadQueueMedium,o=e._tileLoadQueueLow;if(n.length===0&&i.length===0&&o.length===0)return;e._tileReplacementQueue.trimTiles(e.tileCacheSize);let r=Ei()+e._loadQueueTimeSlice,s=e._tileProvider,a=sY(e,t,s,r,n,!1);a=sY(e,t,s,r,i,a),sY(e,t,s,r,o,a)}function xmt(e,t){return e._loadPriority-t._loadPriority}function sY(e,t,n,i,o,r){n.computeTileLoadPriority!==void 0&&o.sort(xmt);for(let s=0,a=o.length;s<a&&(Ei()<i||!r);++s){let l=o[s];e._tileReplacementQueue.markTileRendered(l),n.loadTile(t,l),r=!0}return r}var RC=new _n,aY=new he,_y=new h,Tmt=[];function Amt(e,t){if(!c(e.tileProvider.tilingScheme))return;let n=Tmt;n.length=0;let i=e._tileToUpdateHeights,o=Ei(),r=e._updateHeightsTimeSlice,s=o+r,a=t.mode,l=t.mapProjection,u=e.tileProvider.tilingScheme.ellipsoid,f;for(;i.length>0;){let d=i[0];if(!c(d.data)||!c(d.data.mesh)){let b=d._lastSelectionResultFrame===e._lastSelectionFrameNumber?d._lastSelectionResult:Xn.NONE;(b===Xn.RENDERED||b===Xn.CULLED_BUT_NEEDED)&&n.push(d),i.shift(),e._lastTileIndex=0;continue}let p=d.customData,g=p.length,m=!1;for(f=e._lastTileIndex;f<g;++f){let b=p[f],x=d.data.terrainData,T=c(x)&&x.wasCreatedByUpsampling();if(d.level>b.level&&!T){if(c(b.positionOnEllipsoidSurface)||(b.positionOnEllipsoidSurface=h.fromRadians(b.positionCartographic.longitude,b.positionCartographic.latitude,0,u)),a===oe.SCENE3D){let S=u.geodeticSurfaceNormal(b.positionOnEllipsoidSurface,RC.direction),v=u.getSurfaceNormalIntersectionWithZAxis(b.positionOnEllipsoidSurface,11500,RC.origin);if(!c(v)){let D=0;c(d.data.tileBoundingRegion)&&(D=d.data.tileBoundingRegion.minimumHeight);let I=Math.min(D,-11500),L=h.multiplyByScalar(S,Math.abs(I)+1,_y);h.subtract(b.positionOnEllipsoidSurface,L,RC.origin)}}else he.clone(b.positionCartographic,aY),aY.height=-11500,l.project(aY,_y),h.fromElements(_y.z,_y.x,_y.y,_y),h.clone(_y,RC.origin),h.clone(h.UNIT_X,RC.direction);let C=d.data.pick(RC,a,l,!1,_y);c(C)&&(c(b.callback)&&b.callback(C),b.level=d.level)}if(Ei()>=s){m=!0;break}}if(m){e._lastTileIndex=f;break}else e._lastTileIndex=0,i.shift()}for(f=0;f<n.length;f++)i.push(n[f])}function Cmt(e,t){let n=e._tileProvider,i=e._tilesToRender;for(let o=0,r=i.length;o<r;++o){let s=i[o];n.showTileThisFrame(s,t)}}var lY=vf;function jd(e){e=y(e,ie.default);let t=new Jp({ellipsoid:e}),n=new nY;this._ellipsoid=e,this._imageryLayerCollection=n,this._surfaceShaderSet=new G7,this._material=void 0,this._surface=new lY({tileProvider:new eY({terrainProvider:t,imageryLayers:n,surfaceShaderSet:this._surfaceShaderSet})}),this._terrainProvider=t,this._terrainProviderChanged=new pe,this._undergroundColor=j.clone(j.BLACK),this._undergroundColorAlphaByDistance=new Vt(e.maximumRadius/1e3,0,e.maximumRadius/5,1),this._translucency=new tY,fY(this),this.show=!0,this._oceanNormalMapResourceDirty=!0,this._oceanNormalMapResource=new De({url:sn("Assets/Textures/waterNormalsSmall.jpg")}),this.maximumScreenSpaceError=2,this.tileCacheSize=100,this.loadingDescendantLimit=20,this.preloadAncestors=!0,this.preloadSiblings=!1,this.fillHighlightColor=void 0,this.enableLighting=!1,this.lambertDiffuseMultiplier=.9,this.dynamicAtmosphereLighting=!0,this.dynamicAtmosphereLightingFromSun=!1,this.showGroundAtmosphere=ie.WGS84.equals(e),this.atmosphereLightIntensity=10,this.atmosphereRayleighCoefficient=new h(55e-7,13e-6,284e-7),this.atmosphereMieCoefficient=new h(21e-6,21e-6,21e-6),this.atmosphereRayleighScaleHeight=1e4,this.atmosphereMieScaleHeight=3200,this.atmosphereMieAnisotropy=.9,this.lightingFadeOutDistance=R.PI_OVER_TWO*e.minimumRadius,this.lightingFadeInDistance=R.PI*e.minimumRadius,this.nightFadeOutDistance=R.PI_OVER_TWO*e.minimumRadius,this.nightFadeInDistance=5*R.PI_OVER_TWO*e.minimumRadius,this.showWaterEffect=!0,this.depthTestAgainstTerrain=!1,this.shadows=En.RECEIVE_ONLY,this.atmosphereHueShift=0,this.atmosphereSaturationShift=0,this.atmosphereBrightnessShift=0,this.showSkirts=!0,this.backFaceCulling=!0,this._oceanNormalMap=void 0,this._zoomedOutOceanSpecularIntensity=void 0,this.vertexShadowDarkness=.3}Object.defineProperties(jd.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},imageryLayers:{get:function(){return this._imageryLayerCollection}},imageryLayersUpdatedEvent:{get:function(){return this._surface.tileProvider.imageryLayersUpdatedEvent}},tilesLoaded:{get:function(){return c(this._surface)?this._surface._tileLoadQueueHigh.length===0&&this._surface._tileLoadQueueMedium.length===0&&this._surface._tileLoadQueueLow.length===0:!0}},baseColor:{get:function(){return this._surface.tileProvider.baseColor},set:function(e){this._surface.tileProvider.baseColor=e}},clippingPlanes:{get:function(){return this._surface.tileProvider.clippingPlanes},set:function(e){this._surface.tileProvider.clippingPlanes=e}},clippingPolygons:{get:function(){return this._surface.tileProvider.clippingPolygons},set:function(e){this._surface.tileProvider.clippingPolygons=e}},cartographicLimitRectangle:{get:function(){return this._surface.tileProvider.cartographicLimitRectangle},set:function(e){c(e)||(e=ae.clone(ae.MAX_VALUE)),this._surface.tileProvider.cartographicLimitRectangle=e}},oceanNormalMapUrl:{get:function(){return this._oceanNormalMapResource.url},set:function(e){this._oceanNormalMapResource.url=e,this._oceanNormalMapResourceDirty=!0}},terrainProvider:{get:function(){return this._terrainProvider},set:function(e){e!==this._terrainProvider&&(this._terrainProvider=e,this._terrainProviderChanged.raiseEvent(e),c(this._material)&&fY(this))}},terrainProviderChanged:{get:function(){return this._terrainProviderChanged}},tileLoadProgressEvent:{get:function(){return this._surface.tileLoadProgressEvent}},material:{get:function(){return this._material},set:function(e){this._material!==e&&(this._material=e,fY(this))}},undergroundColor:{get:function(){return this._undergroundColor},set:function(e){this._undergroundColor=j.clone(e,this._undergroundColor)}},undergroundColorAlphaByDistance:{get:function(){return this._undergroundColorAlphaByDistance},set:function(e){if(c(e)&&e.far<e.near)throw new E("far distance must be greater than near distance.");this._undergroundColorAlphaByDistance=Vt.clone(e,this._undergroundColorAlphaByDistance)}},translucency:{get:function(){return this._translucency}}});function fY(e){let t=[],n=c(e._material)&&(c(e._material.shaderSource.match(/slope/))||c(e._material.shaderSource.match("normalEC"))),i=[np,dN];c(e._material)&&(!n||e._terrainProvider.requestVertexNormals)?(i.push(e._material.shaderSource),t.push("APPLY_MATERIAL"),e._surface._tileProvider.materialUniformMap=e._material._uniforms):e._surface._tileProvider.materialUniformMap=void 0,i.push(U7),e._surfaceShaderSet.baseVertexShaderSource=new Ge({sources:[np,dN,z7],defines:t}),e._surfaceShaderSet.baseFragmentShaderSource=new Ge({sources:i,defines:t}),e._surfaceShaderSet.material=e._material}function Emt(e){return function(t,n){let i=ce.distanceSquaredTo(t.pickBoundingSphere,e),o=ce.distanceSquaredTo(n.pickBoundingSphere,e);return i-o}}var Smt=[],wmt={start:0,stop:0};jd.prototype.pickWorldCoordinates=function(e,t,n,i){if(!c(e))throw new E("ray is required");if(!c(t))throw new E("scene is required");n=y(n,!0);let o=t.mode,r=t.mapProjection,s=Smt;s.length=0;let a=this._surface._tilesToRender,l=a.length,u,f;for(f=0;f<l;++f){u=a[f];let p=u.data;if(!c(p))continue;let g=p.pickBoundingSphere;if(o!==oe.SCENE3D)p.pickBoundingSphere=g=ce.fromRectangleWithHeights2D(u.rectangle,r,p.tileBoundingRegion.minimumHeight,p.tileBoundingRegion.maximumHeight,g),h.fromElements(g.center.z,g.center.x,g.center.y,g.center);else if(c(p.renderedMesh))ce.clone(p.tileBoundingRegion.boundingSphere,g);else continue;let m=Qn.raySphere(e,g,wmt);c(m)&&s.push(p)}s.sort(Emt(e.origin));let d;for(l=s.length,f=0;f<l&&(d=s[f].pick(e,t.mode,t.mapProjection,n,i),!c(d));++f);return d};var vmt=new he;jd.prototype.pick=function(e,t,n){if(n=this.pickWorldCoordinates(e,t,!0,n),c(n)&&t.mode!==oe.SCENE3D){n=h.fromElements(n.y,n.z,n.x,n);let i=t.mapProjection.unproject(n,vmt);n=this._ellipsoid.cartographicToCartesian(i,n)}return n};var Dmt=new h,K0e=new h,Pmt=new he,Imt=new _n;function uY(e,t){return c(e)&&ae.contains(e.rectangle,t)?e:void 0}jd.prototype.getHeight=function(e){if(!c(e))throw new E("cartographic is required");let t=this._surface._levelZeroTiles;if(!c(t))return;let n,i,o=t.length;for(i=0;i<o&&(n=t[i],!ae.contains(n.rectangle,e));++i);if(i>=o)return;let r=n;for(;c(n);)n=uY(n._southwestChild,e)||uY(n._southeastChild,e)||uY(n._northwestChild,e)||n._northeastChild,c(n)&&c(n.data)&&c(n.data.renderedMesh)&&(r=n);if(n=r,!c(n)||!c(n.data)||!c(n.data.renderedMesh))return;let s=this._surface._tileProvider.tilingScheme.projection,a=this._surface._tileProvider.tilingScheme.ellipsoid,l=h.fromRadians(e.longitude,e.latitude,0,a,Dmt),u=Imt,f=a.geodeticSurfaceNormal(l,u.direction),d=a.getSurfaceNormalIntersectionWithZAxis(l,11500,u.origin);if(!c(d)){let g;c(n.data.tileBoundingRegion)&&(g=n.data.tileBoundingRegion.minimumHeight);let m=Math.min(y(g,0),-11500),b=h.multiplyByScalar(f,Math.abs(m)+1,K0e);h.subtract(l,b,u.origin)}let p=n.data.pick(u,void 0,s,!1,K0e);if(c(p))return a.cartesianToCartographic(p,Pmt).height};jd.prototype.update=function(e){this.show&&e.passes.render&&this._surface.update(e)};jd.prototype.beginFrame=function(e){let t=this._surface,n=t.tileProvider,i=this.terrainProvider,o=c(i)&&i.hasWaterMask&&i.hasWaterMask;if(o&&this._oceanNormalMapResourceDirty){this._oceanNormalMapResourceDirty=!1;let a=this._oceanNormalMapResource,l=a.url;if(c(l)){let u=this;a.fetchImage().then(function(f){l===u._oceanNormalMapResource.url&&(u._oceanNormalMap=u._oceanNormalMap&&u._oceanNormalMap.destroy(),u._oceanNormalMap=new Lt({context:e.context,source:f}))})}else this._oceanNormalMap=this._oceanNormalMap&&this._oceanNormalMap.destroy()}let r=e.passes,s=e.mode;r.render&&(this.showGroundAtmosphere?this._zoomedOutOceanSpecularIntensity=.4:this._zoomedOutOceanSpecularIntensity=.5,t.maximumScreenSpaceError=this.maximumScreenSpaceError,t.tileCacheSize=this.tileCacheSize,t.loadingDescendantLimit=this.loadingDescendantLimit,t.preloadAncestors=this.preloadAncestors,t.preloadSiblings=this.preloadSiblings,n.terrainProvider=this.terrainProvider,n.lightingFadeOutDistance=this.lightingFadeOutDistance,n.lightingFadeInDistance=this.lightingFadeInDistance,n.nightFadeOutDistance=this.nightFadeOutDistance,n.nightFadeInDistance=this.nightFadeInDistance,n.zoomedOutOceanSpecularIntensity=s===oe.SCENE3D?this._zoomedOutOceanSpecularIntensity:0,n.hasWaterMask=o,n.showWaterEffect=this.showWaterEffect,n.oceanNormalMap=this._oceanNormalMap,n.enableLighting=this.enableLighting,n.dynamicAtmosphereLighting=this.dynamicAtmosphereLighting,n.dynamicAtmosphereLightingFromSun=this.dynamicAtmosphereLightingFromSun,n.showGroundAtmosphere=this.showGroundAtmosphere,n.atmosphereLightIntensity=this.atmosphereLightIntensity,n.atmosphereRayleighCoefficient=this.atmosphereRayleighCoefficient,n.atmosphereMieCoefficient=this.atmosphereMieCoefficient,n.atmosphereRayleighScaleHeight=this.atmosphereRayleighScaleHeight,n.atmosphereMieScaleHeight=this.atmosphereMieScaleHeight,n.atmosphereMieAnisotropy=this.atmosphereMieAnisotropy,n.shadows=this.shadows,n.hueShift=this.atmosphereHueShift,n.saturationShift=this.atmosphereSaturationShift,n.brightnessShift=this.atmosphereBrightnessShift,n.fillHighlightColor=this.fillHighlightColor,n.showSkirts=this.showSkirts,n.backFaceCulling=this.backFaceCulling,n.vertexShadowDarkness=this.vertexShadowDarkness,n.undergroundColor=this._undergroundColor,n.undergroundColorAlphaByDistance=this._undergroundColorAlphaByDistance,n.lambertDiffuseMultiplier=this.lambertDiffuseMultiplier,t.beginFrame(e))};jd.prototype.render=function(e){this.show&&(c(this._material)&&this._material.update(e.context),this._surface.render(e))};jd.prototype.endFrame=function(e){this.show&&e.passes.render&&this._surface.endFrame(e)};jd.prototype.isDestroyed=function(){return!1};jd.prototype.destroy=function(){return this._surfaceShaderSet=this._surfaceShaderSet&&this._surfaceShaderSet.destroy(),this._surface=this._surface&&this._surface.destroy(),this._oceanNormalMap=this._oceanNormalMap&&this._oceanNormalMap.destroy(),de(this)};var dY=jd;var Df=`uniform sampler2D colorTexture;
in vec2 v_textureCoordinates;
void main()
{
out_FragColor = texture(colorTexture, v_textureCoordinates);
}
`;var MC=`uniform highp sampler2D u_depthTexture;
in vec2 v_textureCoordinates;
void main()
{
out_FragColor = czm_packDepth(texture(u_depthTexture, v_textureCoordinates).r);
}
`;function lm(){this._picking=!1,this._numSamples=1,this._tempCopyDepthTexture=void 0,this._pickColorFramebuffer=new gi({depthStencil:!0,supportsDepthTexture:!0}),this._outputFramebuffer=new gi({depthStencil:!0,supportsDepthTexture:!0}),this._copyDepthFramebuffer=new gi,this._tempCopyDepthFramebuffer=new gi,this._updateDepthFramebuffer=new gi({createColorAttachments:!1,createDepthAttachments:!1,depthStencil:!0}),this._clearGlobeColorCommand=void 0,this._copyColorCommand=void 0,this._copyDepthCommand=void 0,this._tempCopyDepthCommand=void 0,this._updateDepthCommand=void 0,this._viewport=new Ke,this._rs=void 0,this._rsBlend=void 0,this._rsUpdate=void 0,this._useScissorTest=!1,this._scissorRectangle=void 0,this._useHdr=void 0,this._clearGlobeDepth=void 0}Object.defineProperties(lm.prototype,{colorFramebufferManager:{get:function(){return this._picking?this._pickColorFramebuffer:this._outputFramebuffer}},framebuffer:{get:function(){return this.colorFramebufferManager.framebuffer}},depthStencilTexture:{get:function(){return this.colorFramebufferManager.getDepthStencilTexture()}},picking:{get:function(){return this._picking},set:function(e){this._picking=e}}});function $0e(e,t,n,i,o){let r=e._viewport;r.width=n,r.height=i;let s=!Ke.equals(r,o.viewport),a=s!==e._useScissorTest;e._useScissorTest=s,Ke.equals(e._scissorRectangle,o.viewport)||(e._scissorRectangle=Ke.clone(o.viewport,e._scissorRectangle),a=!0),(!c(e._rs)||!Ke.equals(r,e._rs.viewport)||a)&&(e._rs=ze.fromCache({viewport:r,scissorTest:{enabled:e._useScissorTest,rectangle:e._scissorRectangle}}),e._rsBlend=ze.fromCache({viewport:r,scissorTest:{enabled:e._useScissorTest,rectangle:e._scissorRectangle},blending:hn.ALPHA_BLEND}),e._rsUpdate=ze.fromCache({viewport:r,scissorTest:{enabled:e._useScissorTest,rectangle:e._scissorRectangle},stencilTest:{enabled:!0,frontFunction:Un.EQUAL,frontOperation:{fail:ft.KEEP,zFail:ft.KEEP,zPass:ft.KEEP},backFunction:Un.NEVER,reference:Ut.CESIUM_3D_TILE_MASK,mask:Ut.CESIUM_3D_TILE_MASK}})),c(e._copyDepthCommand)||(e._copyDepthCommand=t.createViewportQuadCommand(MC,{uniformMap:{u_depthTexture:function(){return e.colorFramebufferManager.getDepthStencilTexture()}},owner:e})),e._copyDepthCommand.framebuffer=e._copyDepthFramebuffer.framebuffer,e._copyDepthCommand.renderState=e._rs,c(e._copyColorCommand)||(e._copyColorCommand=t.createViewportQuadCommand(Df,{uniformMap:{colorTexture:function(){return e.colorFramebufferManager.getColorTexture()}},owner:e})),e._copyColorCommand.renderState=e._rs,c(e._tempCopyDepthCommand)||(e._tempCopyDepthCommand=t.createViewportQuadCommand(MC,{uniformMap:{u_depthTexture:function(){return e._tempCopyDepthTexture}},owner:e})),e._tempCopyDepthCommand.framebuffer=e._tempCopyDepthFramebuffer.framebuffer,e._tempCopyDepthCommand.renderState=e._rs,c(e._updateDepthCommand)||(e._updateDepthCommand=t.createViewportQuadCommand(Df,{uniformMap:{colorTexture:function(){return e._tempCopyDepthFramebuffer.getColorTexture()}},owner:e})),e._updateDepthCommand.framebuffer=e._updateDepthFramebuffer.framebuffer,e._updateDepthCommand.renderState=e._rsUpdate,c(e._clearGlobeColorCommand)||(e._clearGlobeColorCommand=new ri({color:new j(0,0,0,0),stencil:0,owner:e})),e._clearGlobeColorCommand.framebuffer=e.framebuffer}lm.prototype.update=function(e,t,n,i,o,r){let{width:s,height:a}=n,l=o?e.halfFloatingPointTexture?Be.HALF_FLOAT:Be.FLOAT:Be.UNSIGNED_BYTE;this._numSamples=i,this.picking?this._pickColorFramebuffer.update(e,s,a):this._outputFramebuffer.update(e,s,a,i,l),this._copyDepthFramebuffer.update(e,s,a),$0e(this,e,s,a,t),e.uniformState.globeDepthTexture=void 0,this._clearGlobeDepth=r};lm.prototype.prepareColorTextures=function(e,t){!this.picking&&this._numSamples>1&&this._outputFramebuffer.prepareTextures(e,t)};lm.prototype.executeCopyDepth=function(e,t){c(this._copyDepthCommand)&&(this.prepareColorTextures(e),this._copyDepthCommand.execute(e,t),e.uniformState.globeDepthTexture=this._copyDepthFramebuffer.getColorTexture())};lm.prototype.executeUpdateDepth=function(e,t,n){let i=c(n)?n:t.framebuffer.depthStencilTexture;if(!this._clearGlobeDepth&&i===this.colorFramebufferManager.getDepthStencilTexture()){c(this._copyDepthCommand)&&this._copyDepthCommand.execute(e,t);return}if(!c(this._updateDepthCommand))return;let o=this._updateDepthFramebuffer;if(!c(o.framebuffer)||o.getDepthStencilTexture()!==i||o.getColorTexture()!==this._copyDepthFramebuffer.getColorTexture()){let r=this._copyDepthFramebuffer.getColorTexture(),{width:s,height:a}=r;this._tempCopyDepthFramebuffer.destroy(),this._tempCopyDepthFramebuffer.update(e,s,a),o.setColorTexture(r,0),o.setDepthStencilTexture(i),o.update(e,s,a),$0e(this,e,s,a,t)}this._tempCopyDepthTexture=i,this._tempCopyDepthCommand.execute(e,t),this._updateDepthCommand.execute(e,t)};lm.prototype.executeCopyColor=function(e,t){c(this._copyColorCommand)&&this._copyColorCommand.execute(e,t)};lm.prototype.clear=function(e,t,n){let i=this._clearGlobeColorCommand;c(i)&&(j.clone(n,i.color),this.colorFramebufferManager.clear(e,i,t))};lm.prototype.isDestroyed=function(){return!1};lm.prototype.destroy=function(){return this._pickColorFramebuffer.destroy(),this._outputFramebuffer.destroy(),this._copyDepthFramebuffer.destroy(),this._tempCopyDepthFramebuffer.destroy(),this._updateDepthFramebuffer.destroy(),c(this._copyColorCommand)&&(this._copyColorCommand.shaderProgram=this._copyColorCommand.shaderProgram.destroy()),c(this._copyDepthCommand)&&(this._copyDepthCommand.shaderProgram=this._copyDepthCommand.shaderProgram.destroy()),c(this._tempCopyDepthCommand)&&(this._tempCopyDepthCommand.shaderProgram=this._tempCopyDepthCommand.shaderProgram.destroy()),c(this._updateDepthCommand)&&(this._updateDepthCommand.shaderProgram=this._updateDepthCommand.shaderProgram.destroy()),de(this)};var hY=lm;function Xb(){this._framebuffer=new gi({depthStencil:!0,supportsDepthTexture:!0}),this._packedDepthFramebuffer=new gi,this._renderState=void 0,this._packedDepthCommand=void 0,this._clearCommand=void 0,this._viewport=new Ke,this._useScissorTest=!1,this._scissorRectangle=void 0,this._useHdr=void 0}Object.defineProperties(Xb.prototype,{classificationTexture:{get:function(){return this._framebuffer.getColorTexture()}},classificationFramebuffer:{get:function(){return this._framebuffer.framebuffer}},packedDepthFramebuffer:{get:function(){return this._packedDepthFramebuffer.framebuffer}},depthStencilTexture:{get:function(){return this._framebuffer.getDepthStencilTexture()}},depthStencilRenderbuffer:{get:function(){return this._framebuffer.getDepthStencilRenderbuffer()}},packedDepthTexture:{get:function(){return this._packedDepthFramebuffer.getColorTexture()}}});function Omt(e){e._framebuffer.destroy(),e._packedDepthFramebuffer.destroy()}function Rmt(e,t,n,i,o){let r=o?t.halfFloatingPointTexture?Be.HALF_FLOAT:Be.FLOAT:Be.UNSIGNED_BYTE;e._framebuffer.update(t,n,i,1,r),e._packedDepthFramebuffer.update(t,n,i)}function Mmt(e,t,n,i,o){e._viewport.width=n,e._viewport.height=i;let r=!Ke.equals(e._viewport,o.viewport),s=r!==e._useScissorTest;e._useScissorTest=r,Ke.equals(e._scissorRectangle,o.viewport)||(e._scissorRectangle=Ke.clone(o.viewport,e._scissorRectangle),s=!0),(!c(e._renderState)||!Ke.equals(e._viewport,e._renderState.viewport)||s)&&(e._renderState=ze.fromCache({viewport:e._viewport,scissorTest:{enabled:e._useScissorTest,rectangle:e._scissorRectangle}})),c(e._packedDepthCommand)||(e._packedDepthCommand=t.createViewportQuadCommand(MC,{uniformMap:{u_depthTexture:function(){return e.depthStencilTexture}},owner:e})),c(e._clearCommand)||(e._clearCommand=new ri({color:new j(0,0,0,0),depth:1,stencil:0,owner:e})),e._packedDepthCommand.framebuffer=e._packedDepthFramebuffer.framebuffer,e._packedDepthCommand.renderState=e._renderState,e._clearCommand.framebuffer=e.classificationFramebuffer,e._clearCommand.renderState=e._renderState}Xb.prototype.updateAndClear=function(e,t,n,i){let o=t.width,r=t.height;Rmt(this,n,o,r,e),Mmt(this,n,o,r,i),this._useHdr=e};Xb.prototype.clearClassification=function(e,t){this._clearCommand.execute(e,t)};Xb.prototype.packDepth=function(e,t){return this._packedDepthCommand.execute(e,t),this.packedDepthTexture};Xb.prototype.isDestroyed=function(){return!1};Xb.prototype.destroy=function(){return Omt(this),de(this)};var mY=Xb;var oa={OPAQUE_FRONT_FACE:0,OPAQUE_BACK_FACE:1,DEPTH_ONLY_FRONT_FACE:2,DEPTH_ONLY_BACK_FACE:3,DEPTH_ONLY_FRONT_AND_BACK_FACE:4,TRANSLUCENT_FRONT_FACE:5,TRANSLUCENT_BACK_FACE:6,TRANSLUCENT_FRONT_FACE_MANUAL_DEPTH_TEST:7,TRANSLUCENT_BACK_FACE_MANUAL_DEPTH_TEST:8,PICK_FRONT_FACE:9,PICK_BACK_FACE:10,DERIVED_COMMANDS_MAXIMUM_LENGTH:11},Kb=oa.DERIVED_COMMANDS_MAXIMUM_LENGTH,sbe=["opaqueFrontFaceCommand","opaqueBackFaceCommand","depthOnlyFrontFaceCommand","depthOnlyBackFaceCommand","depthOnlyFrontAndBackFaceCommand","translucentFrontFaceCommand","translucentBackFaceCommand","translucentFrontFaceManualDepthTestCommand","translucentBackFaceManualDepthTestCommand","pickFrontFaceCommand","pickBackFaceCommand"];function $b(){this._frontFaceAlphaByDistance=new Vt(0,1,0,1),this._backFaceAlphaByDistance=new Vt(0,1,0,1),this._frontFaceTranslucent=!1,this._backFaceTranslucent=!1,this._requiresManualDepthTest=!1,this._sunVisibleThroughGlobe=!1,this._environmentVisible=!1,this._useDepthPlane=!1,this._numberOfTextureUniforms=0,this._globeTranslucencyFramebuffer=void 0,this._rectangle=ae.clone(ae.MAX_VALUE),this._derivedCommandKey=0,this._derivedCommandsDirty=!1,this._derivedCommandPacks=void 0,this._derivedCommandTypes=new Array(Kb),this._derivedBlendCommandTypes=new Array(Kb),this._derivedPickCommandTypes=new Array(Kb),this._derivedCommandTypesToUpdate=new Array(Kb),this._derivedCommandsLength=0,this._derivedBlendCommandsLength=0,this._derivedPickCommandsLength=0,this._derivedCommandsToUpdateLength=0}Object.defineProperties($b.prototype,{frontFaceAlphaByDistance:{get:function(){return this._frontFaceAlphaByDistance}},backFaceAlphaByDistance:{get:function(){return this._backFaceAlphaByDistance}},translucent:{get:function(){return this._frontFaceTranslucent}},sunVisibleThroughGlobe:{get:function(){return this._sunVisibleThroughGlobe}},environmentVisible:{get:function(){return this._environmentVisible}},useDepthPlane:{get:function(){return this._useDepthPlane}},numberOfTextureUniforms:{get:function(){return this._numberOfTextureUniforms}},rectangle:{get:function(){return this._rectangle}}});$b.prototype.update=function(e){let t=e.globe;if(!c(t)||!t.show){this._frontFaceTranslucent=!1,this._backFaceTranslucent=!1,this._sunVisibleThroughGlobe=!0,this._environmentVisible=!0,this._useDepthPlane=!1;return}this._frontFaceAlphaByDistance=Z0e(t.translucency.enabled,t.translucency.frontFaceAlpha,t.translucency.frontFaceAlphaByDistance,this._frontFaceAlphaByDistance),this._backFaceAlphaByDistance=Z0e(t.translucency.enabled,t.translucency.backFaceAlpha,t.translucency.backFaceAlphaByDistance,this._backFaceAlphaByDistance),this._frontFaceTranslucent=J0e(t.translucency.enabled,this._frontFaceAlphaByDistance,t),this._backFaceTranslucent=J0e(t.translucency.enabled,this._backFaceAlphaByDistance,t),this._requiresManualDepthTest=Bmt(this,e,t),this._sunVisibleThroughGlobe=Lmt(this,e),this._environmentVisible=Nmt(this,e),this._useDepthPlane=Fmt(this,e),this._numberOfTextureUniforms=kmt(this),this._rectangle=ae.clone(t.translucency.rectangle,this._rectangle),Vmt(this,e)};function Z0e(e,t,n,i){return e?c(n)?(Vt.clone(n,i),i.nearValue*=t,i.farValue*=t,i):(i.nearValue=t,i.farValue=t,i):(i.nearValue=1,i.farValue=1,i)}function J0e(e,t,n){return e&&(n.baseColor.alpha<1||t.nearValue<1||t.farValue<1)}function Lmt(e,t){let n=e._frontFaceTranslucent,i=e._backFaceTranslucent;return n&&(t.cameraUnderground||i)}function Nmt(e,t){return!t.cameraUnderground||e._frontFaceTranslucent}function Fmt(e,t){return!t.cameraUnderground&&!e._frontFaceTranslucent}function Bmt(e,t,n){return e._frontFaceTranslucent&&!e._backFaceTranslucent&&!n.depthTestAgainstTerrain&&t.mode!==oe.SCENE2D&&t.context.depthTexture}function kmt(e){let t=0;return e._frontFaceTranslucent&&++t,e._requiresManualDepthTest&&++t,t}function Vmt(e,t){e._derivedCommandsLength=pY(e,t,!1,!1,e._derivedCommandTypes),e._derivedBlendCommandsLength=pY(e,t,!0,!1,e._derivedBlendCommandTypes),e._derivedPickCommandsLength=pY(e,t,!1,!0,e._derivedPickCommandTypes);let n,i=0;for(n=0;n<e._derivedCommandsLength;++n)i|=1<<e._derivedCommandTypes[n];for(n=0;n<e._derivedBlendCommandsLength;++n)i|=1<<e._derivedBlendCommandTypes[n];for(n=0;n<e._derivedPickCommandsLength;++n)i|=1<<e._derivedPickCommandTypes[n];let o=0;for(n=0;n<Kb;++n)(i&1<<n)>0&&(e._derivedCommandTypesToUpdate[o++]=n);e._derivedCommandsToUpdateLength=o;let r=i!==e._derivedCommandKey;e._derivedCommandKey=i,e._derivedCommandsDirty=r,!c(e._derivedCommandPacks)&&e._frontFaceTranslucent&&(e._derivedCommandPacks=ept())}function pY(e,t,n,i,o){let r=0,s=e._frontFaceTranslucent,a=e._backFaceTranslucent;if(!s)return r;let l=t.cameraUnderground,u=e._requiresManualDepthTest,f=i?oa.PICK_FRONT_FACE:u?oa.TRANSLUCENT_FRONT_FACE_MANUAL_DEPTH_TEST:oa.TRANSLUCENT_FRONT_FACE,d=i?oa.PICK_BACK_FACE:u?oa.TRANSLUCENT_BACK_FACE_MANUAL_DEPTH_TEST:oa.TRANSLUCENT_BACK_FACE;return t.mode===oe.SCENE2D?(o[r++]=oa.DEPTH_ONLY_FRONT_FACE,o[r++]=f,r):(a?(n||(o[r++]=oa.DEPTH_ONLY_FRONT_AND_BACK_FACE),l?(o[r++]=f,o[r++]=d):(o[r++]=d,o[r++]=f)):l?(n||(o[r++]=oa.DEPTH_ONLY_BACK_FACE),o[r++]=oa.OPAQUE_FRONT_FACE,o[r++]=d):(n||(o[r++]=oa.DEPTH_ONLY_FRONT_FACE),o[r++]=oa.OPAQUE_BACK_FACE,o[r++]=f),r)}function Pf(e,t){let n=e.indexOf(t);n>-1&&e.splice(n,1)}function Q0e(e,t){return e.indexOf(t)>-1}function Umt(e,t){Pf(e.defines,"TRANSLUCENT"),Pf(t.defines,"TRANSLUCENT")}function zmt(e,t){Pf(e.defines,"GROUND_ATMOSPHERE"),Pf(t.defines,"GROUND_ATMOSPHERE"),Pf(e.defines,"FOG"),Pf(t.defines,"FOG"),Pf(e.defines,"TRANSLUCENT"),Pf(t.defines,"TRANSLUCENT")}function _Y(e,t){if(Q0e(t.defines,"TILE_LIMIT_RECTANGLE")||Q0e(t.defines,"ENABLE_CLIPPING_PLANES"))return;let n=`void main() 
{ 
    out_FragColor = vec4(1.0); 
} 
`;t.sources=[n]}function gY(e,t){let n=t.sources,i=n.length;for(let r=0;r<i;++r)n[r]=Ge.replaceMain(n[r],"czm_globe_translucency_main");n.push(`

uniform sampler2D u_classificationTexture; 
void main() 
{ 
    vec2 st = gl_FragCoord.xy / czm_viewport.zw; 
#ifdef MANUAL_DEPTH_TEST 
    float logDepthOrDepth = czm_unpackDepth(texture(czm_globeDepthTexture, st)); 
    if (logDepthOrDepth != 0.0) 
    { 
        vec4 eyeCoordinate = czm_windowToEyeCoordinates(gl_FragCoord.xy, logDepthOrDepth); 
        float depthEC = eyeCoordinate.z / eyeCoordinate.w; 
        if (v_positionEC.z < depthEC) 
        { 
            discard; 
        } 
    } 
#endif 
    czm_globe_translucency_main(); 
    vec4 classificationColor = texture(u_classificationTexture, st); 
    if (classificationColor.a > 0.0) 
    { 
        // Reverse premultiplication process to get the correct composited result of the classification primitives 
        classificationColor.rgb /= classificationColor.a; 
    } 
    out_FragColor = classificationColor * vec4(classificationColor.aaa, 1.0) + out_FragColor * (1.0 - classificationColor.a); 
} 
`)}function abe(e,t){gY(e,t),Pf(e.defines,"GROUND_ATMOSPHERE"),Pf(t.defines,"GROUND_ATMOSPHERE"),Pf(e.defines,"FOG"),Pf(t.defines,"FOG")}function Hmt(e,t){gY(e,t),e.defines.push("GENERATE_POSITION"),t.defines.push("MANUAL_DEPTH_TEST")}function Gmt(e,t){abe(e,t),e.defines.push("GENERATE_POSITION"),t.defines.push("MANUAL_DEPTH_TEST")}function ebe(e,t){let n=`uniform sampler2D u_classificationTexture; 
void main() 
{ 
    vec2 st = gl_FragCoord.xy / czm_viewport.zw; 
    vec4 pickColor = texture(u_classificationTexture, st); 
    if (pickColor == vec4(0.0)) 
    { 
        discard; 
    } 
    out_FragColor = pickColor; 
} 
`;t.sources=[n]}function jmt(e,t,n,i,o,r){if(!c(o))return t;if(!i&&c(n))return n;let s=e.shaderCache.getDerivedShaderProgram(t,r);if(!c(s)){let a=t._attributeLocations,l=t.vertexShaderSource.clone(),u=t.fragmentShaderSource.clone();l.defines=c(l.defines)?l.defines.slice(0):[],u.defines=c(u.defines)?u.defines.slice(0):[],o(l,u),s=e.shaderCache.createDerivedShaderProgram(t,r,{vertexShaderSource:l,fragmentShaderSource:u,attributeLocations:a})}return s}function Wmt(e){e.cull.face=xi.BACK,e.cull.enabled=!0}function qmt(e){e.cull.face=xi.FRONT,e.cull.enabled=!0}function Ymt(e){e.cull.face=xi.BACK,e.cull.enabled=!0,e.colorMask={red:!1,green:!1,blue:!1,alpha:!1}}function Xmt(e){e.cull.face=xi.FRONT,e.cull.enabled=!0,e.colorMask={red:!1,green:!1,blue:!1,alpha:!1}}function Kmt(e){e.cull.enabled=!1,e.colorMask={red:!1,green:!1,blue:!1,alpha:!1}}function tbe(e){e.cull.face=xi.BACK,e.cull.enabled=!0,e.depthMask=!1,e.blending=hn.ALPHA_BLEND}function nbe(e){e.cull.face=xi.FRONT,e.cull.enabled=!0,e.depthMask=!1,e.blending=hn.ALPHA_BLEND}function $mt(e){e.cull.face=xi.BACK,e.cull.enabled=!0,e.blending.enabled=!1}function Zmt(e){e.cull.face=xi.FRONT,e.cull.enabled=!0,e.blending.enabled=!1}function Jmt(e,t,n,i,o){if(!c(i))return e;if(!n&&c(t))return t;let r=o[e.id];if(!c(r)){let s=ze.getState(e);i(s),r=ze.fromCache(s),o[e.id]=r}return r}function LC(e){return{u_classificationTexture:function(){return e._globeTranslucencyFramebuffer.classificationTexture}}}function Qmt(e,t,n,i,o){return c(o)?!i&&c(n)?n:At(t,o(e),!1):t}function Wd(e){this.pass=e.pass,this.pickOnly=e.pickOnly,this.getShaderProgramFunction=e.getShaderProgramFunction,this.getRenderStateFunction=e.getRenderStateFunction,this.getUniformMapFunction=e.getUniformMapFunction,this.renderStateCache={}}function ept(){return[new Wd({pass:ve.GLOBE,pickOnly:!1,getShaderProgramFunction:Umt,getRenderStateFunction:Wmt,getUniformMapFunction:void 0}),new Wd({pass:ve.GLOBE,pickOnly:!1,getShaderProgramFunction:zmt,getRenderStateFunction:qmt,getUniformMapFunction:void 0}),new Wd({pass:ve.GLOBE,pickOnly:!1,getShaderProgramFunction:_Y,getRenderStateFunction:Ymt,getUniformMapFunction:void 0}),new Wd({pass:ve.GLOBE,pickOnly:!1,getShaderProgramFunction:_Y,getRenderStateFunction:Xmt,getUniformMapFunction:void 0}),new Wd({pass:ve.GLOBE,pickOnly:!1,getShaderProgramFunction:_Y,getRenderStateFunction:Kmt,getUniformMapFunction:void 0}),new Wd({pass:ve.TRANSLUCENT,pickOnly:!1,getShaderProgramFunction:gY,getRenderStateFunction:tbe,getUniformMapFunction:LC}),new Wd({pass:ve.TRANSLUCENT,pickOnly:!1,getShaderProgramFunction:abe,getRenderStateFunction:nbe,getUniformMapFunction:LC}),new Wd({pass:ve.TRANSLUCENT,pickOnly:!1,getShaderProgramFunction:Hmt,getRenderStateFunction:tbe,getUniformMapFunction:LC}),new Wd({pass:ve.TRANSLUCENT,pickOnly:!1,getShaderProgramFunction:Gmt,getRenderStateFunction:nbe,getUniformMapFunction:LC}),new Wd({pass:ve.TRANSLUCENT,pickOnly:!0,getShaderProgramFunction:ebe,getRenderStateFunction:$mt,getUniformMapFunction:LC}),new Wd({pass:ve.TRANSLUCENT,pickOnly:!0,getShaderProgramFunction:ebe,getRenderStateFunction:Zmt,getUniformMapFunction:LC})]}var ibe=new Array(Kb),obe=new Array(Kb);$b.prototype.updateDerivedCommands=function(e,t){let n=this._derivedCommandTypesToUpdate,i=this._derivedCommandsToUpdateLength;if(i!==0){for(let o=0;o<i;++o)obe[o]=this._derivedCommandPacks[n[o]],ibe[o]=sbe[n[o]];tpt(this,e,i,n,ibe,obe,t)}};function tpt(e,t,n,i,o,r,s){let a=t.derivedCommands.globeTranslucency,l=e._derivedCommandsDirty;if(t.dirty||!c(a)||l){t.dirty=!1,c(a)||(a={},t.derivedCommands.globeTranslucency=a);let u=s.frameNumber,f=y(a.uniformMapDirtyFrame,0),d=y(a.shaderProgramDirtyFrame,0),p=y(a.renderStateDirtyFrame,0),g=a.uniformMap!==t.uniformMap,m=a.shaderProgramId!==t.shaderProgram.id,b=a.renderStateId!==t.renderState.id;g&&(a.uniformMapDirtyFrame=u),m&&(a.shaderProgramDirtyFrame=u),b&&(a.renderStateDirtyFrame=u),a.uniformMap=t.uniformMap,a.shaderProgramId=t.shaderProgram.id,a.renderStateId=t.renderState.id;for(let x=0;x<n;++x){let T=r[x],C=i[x],S=o[x],v=a[S],D,I,L;c(v)?(D=v.uniformMap,I=v.shaderProgram,L=v.renderState):(D=void 0,I=void 0,L=void 0),v=et.shallowClone(t,v),a[S]=v;let M=y(v.derivedCommands.uniformMapDirtyFrame,0),N=y(v.derivedCommands.shaderProgramDirtyFrame,0),B=y(v.derivedCommands.renderStateDirtyFrame,0),_=g||M<f,w=m||N<d,P=b||B<p;_&&(v.derivedCommands.uniformMapDirtyFrame=u),w&&(v.derivedCommands.shaderProgramDirtyFrame=u),P&&(v.derivedCommands.renderStateDirtyFrame=u),v.derivedCommands.type=C,v.pass=T.pass,v.pickOnly=T.pickOnly,v.uniformMap=Qmt(e,t.uniformMap,D,_,T.getUniformMapFunction),v.shaderProgram=jmt(s.context,t.shaderProgram,I,w,T.getShaderProgramFunction,S),v.renderState=Jmt(t.renderState,L,P,T.getRenderStateFunction,T.renderStateCache)}}}$b.prototype.pushDerivedCommands=function(e,t,n){let i=n.passes.pick||n.passes.pickVoxel;if(i&&t)return;let o=this._derivedCommandTypes,r=this._derivedCommandsLength;if(i?(o=this._derivedPickCommandTypes,r=this._derivedPickCommandsLength):t&&(o=this._derivedBlendCommandTypes,r=this._derivedBlendCommandsLength),r===0){n.commandList.push(e);return}let s=e.derivedCommands.globeTranslucency;for(let a=0;a<r;++a){let l=sbe[o[a]];n.commandList.push(s[l])}};function cbe(e,t,n,i,o,r){for(let s=0;s<t;++s){let a=e[s],l=a.derivedCommands.type;(!c(r)||r.indexOf(l)>-1)&&n(a,i,o)}}function rbe(e,t,n,i,o){for(let r=0;r<t;++r)n(e[r],i,o)}var npt=[oa.OPAQUE_FRONT_FACE,oa.OPAQUE_BACK_FACE],ipt=[oa.DEPTH_ONLY_FRONT_FACE,oa.DEPTH_ONLY_BACK_FACE,oa.DEPTH_ONLY_FRONT_AND_BACK_FACE];$b.prototype.executeGlobeCommands=function(e,t,n,i,o){let r=i.context,s=e.commands[ve.GLOBE],a=e.indices[ve.GLOBE];a!==0&&(this._globeTranslucencyFramebuffer=n,n.clearClassification(r,o),cbe(s,a,t,i,o,npt))};$b.prototype.executeGlobeClassificationCommands=function(e,t,n,i,o){let{context:r}=i,{uniformState:s}=r,a=e.commands[ve.GLOBE],l=e.indices[ve.GLOBE],u=e.commands[ve.TERRAIN_CLASSIFICATION],f=e.indices[ve.TERRAIN_CLASSIFICATION];if(l===0||f===0)return;let d=this._frontFaceTranslucent,p=this._backFaceTranslucent;if((!d||!p)&&rbe(u,f,t,i,o),!d&&!p)return;this._globeTranslucencyFramebuffer=n;let g=s.globeDepthTexture,m=o.framebuffer;if(o.framebuffer=n.classificationFramebuffer,cbe(a,l,t,i,o,ipt),r.depthTexture){let b=n.packDepth(r,o);s.globeDepthTexture=b}rbe(u,f,t,i,o),s.globeDepthTexture=g,o.framebuffer=m};var yY=$b;var lbe=Ur(pW(),1);function bY(){this._image=new Image}bY.prototype.isReady=function(){return!0};bY.prototype.shouldDiscardImage=function(e){return e===this._image};function Zb(e){e=y(e,y.EMPTY_OBJECT),this._defaultAlpha=void 0,this._defaultNightAlpha=void 0,this._defaultDayAlpha=void 0,this._defaultBrightness=void 0,this._defaultContrast=void 0,this._defaultHue=void 0,this._defaultSaturation=void 0,this._defaultGamma=void 0,this._defaultMinificationFilter=void 0,this._defaultMagnificationFilter=void 0,this._tileDiscardPolicy=e.tileDiscardPolicy,this._tilingScheme=new $i({numberOfLevelZeroTilesX:2,numberOfLevelZeroTilesY:2,rectangle:new ae(-R.PI,-R.PI,R.PI,R.PI),ellipsoid:e.ellipsoid});let t=e.credit;typeof t=="string"&&(t=new Pt(t)),this._credit=t,this._tileWidth=256,this._tileHeight=256,this._maximumLevel=23,c(this._tileDiscardPolicy)||(this._tileDiscardPolicy=new bY),this._errorEvent=new pe}Object.defineProperties(Zb.prototype,{url:{get:function(){return this._metadata.url}},proxy:{get:function(){return this._metadata.proxy}},tileWidth:{get:function(){return this._tileWidth}},tileHeight:{get:function(){return this._tileHeight}},maximumLevel:{get:function(){return this._maximumLevel}},minimumLevel:{get:function(){return 0}},tilingScheme:{get:function(){return this._tilingScheme}},rectangle:{get:function(){return this._tilingScheme.rectangle}},tileDiscardPolicy:{get:function(){return this._tileDiscardPolicy}},errorEvent:{get:function(){return this._errorEvent}},credit:{get:function(){return this._credit}},hasAlphaChannel:{get:function(){return!1}}});Zb.fromMetadata=function(e,t){if(A.defined("metadata",e),!e.imageryPresent)throw new ue(`The server ${e.url} doesn't have imagery`);let n=new Zb(t);return n._metadata=e,n};Zb.prototype.getTileCredits=function(e,t,n){let i=this._metadata,o=i.getTileInformation(e,t,n);if(c(o)){let r=i.providers[o.imageryProvider];if(c(r))return[r]}};Zb.prototype.requestImage=function(e,t,n,i){let o=this._tileDiscardPolicy._image,r=this._metadata,s=Lb.tileXYToQuadKey(e,t,n),a=r.getTileInformation(e,t,n);if(!c(a)){if(r.isValid(s)){let u=new ur({throttle:i.throttle,throttleByServer:i.throttleByServer,type:i.type,priorityFunction:i.priorityFunction});r.populateSubtree(e,t,n,u);return}return Promise.resolve(o)}if(!a.hasImagery())return Promise.resolve(o);let l=opt(this,a,e,t,n,i).fetchArrayBuffer();if(c(l))return l.then(function(u){cW(r.key,u);let f=new Uint8Array(u),d,p=r.protoImagery;if((!c(p)||!p)&&(d=rpt(f)),!c(d)&&(!c(p)||p)){let g=spt(f);d=g.imageType,f=g.imageData}return!c(d)||!c(f)?o:FS({uint8Array:f,format:d,flipY:!0})})};Zb.prototype.pickFeatures=function(e,t,n,i,o){};function opt(e,t,n,i,o,r){let s=Lb.tileXYToQuadKey(n,i,o),a=t.imageryVersion;return a=c(a)&&a>0?a:1,e._metadata.resource.getDerivedResource({url:`flatfile?f1-0${s}-i.${a.toString()}`,request:r})}function rpt(e){let t="JFIF";if(e[6]===t.charCodeAt(0)&&e[7]===t.charCodeAt(1)&&e[8]===t.charCodeAt(2)&&e[9]===t.charCodeAt(3))return"image/jpeg";let n="PNG";if(e[1]===n.charCodeAt(0)&&e[2]===n.charCodeAt(1)&&e[3]===n.charCodeAt(2))return"image/png"}function spt(e){let t=lbe.Reader.create(e),n=t.len,i={};for(;t.pos<n;){let s=t.uint32(),a;switch(s>>>3){case 1:i.imageType=t.uint32();break;case 2:i.imageData=t.bytes();break;case 3:i.alphaType=t.uint32();break;case 4:i.imageAlpha=t.bytes();break;case 5:if(a=i.copyrightIds,c(a)||(a=i.copyrightIds=[]),(s&7)===2){let l=t.uint32()+t.pos;for(;t.pos<l;)a.push(t.uint32())}else a.push(t.uint32());break;default:t.skipType(s&7);break}}let o=i.imageType;if(c(o))switch(o){case 0:i.imageType="image/jpeg";break;case 4:i.imageType="image/png";break;default:throw new ue("GoogleEarthEnterpriseImageryProvider: Unsupported image type.")}let r=i.alphaType;return c(r)&&r!==0&&(console.log("GoogleEarthEnterpriseImageryProvider: External alpha not supported."),delete i.alphaType,delete i.imageAlpha),i}var apt=Zb;var cpt=new j(1,1,1,.4),lpt=new j(0,1,0,.05),upt=new j(0,.5,0,.2);function Jb(e){e=y(e,y.EMPTY_OBJECT),this._defaultAlpha=void 0,this._defaultNightAlpha=void 0,this._defaultDayAlpha=void 0,this._defaultBrightness=void 0,this._defaultContrast=void 0,this._defaultHue=void 0,this._defaultSaturation=void 0,this._defaultGamma=void 0,this._defaultMinificationFilter=void 0,this._defaultMagnificationFilter=void 0,this._tilingScheme=c(e.tilingScheme)?e.tilingScheme:new $i({ellipsoid:e.ellipsoid}),this._cells=y(e.cells,8),this._color=y(e.color,cpt),this._glowColor=y(e.glowColor,lpt),this._glowWidth=y(e.glowWidth,6),this._backgroundColor=y(e.backgroundColor,upt),this._errorEvent=new pe,this._tileWidth=y(e.tileWidth,256),this._tileHeight=y(e.tileHeight,256),this._canvasSize=y(e.canvasSize,256),this._canvas=this._createGridCanvas()}Object.defineProperties(Jb.prototype,{proxy:{get:function(){}},tileWidth:{get:function(){return this._tileWidth}},tileHeight:{get:function(){return this._tileHeight}},maximumLevel:{get:function(){}},minimumLevel:{get:function(){}},tilingScheme:{get:function(){return this._tilingScheme}},rectangle:{get:function(){return this._tilingScheme.rectangle}},tileDiscardPolicy:{get:function(){}},errorEvent:{get:function(){return this._errorEvent}},credit:{get:function(){}},hasAlphaChannel:{get:function(){return!0}}});Jb.prototype._drawGrid=function(e){let n=this._canvasSize;for(let i=0;i<=this._cells;++i){let r=1+i/this._cells*(n-1);e.moveTo(r,0),e.lineTo(r,n),e.moveTo(0,r),e.lineTo(n,r)}e.stroke()};Jb.prototype._createGridCanvas=function(){let e=document.createElement("canvas");e.width=this._canvasSize,e.height=this._canvasSize;let t=0,n=this._canvasSize,i=e.getContext("2d"),o=this._backgroundColor.toCssColorString();i.fillStyle=o,i.fillRect(t,t,n,n);let r=this._glowColor.toCssColorString();i.strokeStyle=r,i.lineWidth=this._glowWidth,i.strokeRect(t,t,n,n),this._drawGrid(i),i.lineWidth=this._glowWidth*.5,i.strokeRect(t,t,n,n),this._drawGrid(i);let s=this._color.toCssColorString();return i.strokeStyle=s,i.lineWidth=2,i.strokeRect(t,t,n,n),i.lineWidth=1,this._drawGrid(i),e};Jb.prototype.getTileCredits=function(e,t,n){};Jb.prototype.requestImage=function(e,t,n,i){return Promise.resolve(this._canvas)};Jb.prototype.pickFeatures=function(e,t,n,i,o){};var fpt=Jb;function qd(){}qd._maxDecodingConcurrency=Math.max(zt.hardwareConcurrency-1,1);qd._decodeTaskProcessor=new Ti("decodeI3S",qd._maxDecodingConcurrency);qd._promise=void 0;async function dpt(){if(await qd._decodeTaskProcessor.initWebAssemblyModule({wasmBinaryFile:"ThirdParty/draco_decoder.wasm"}))return qd._decodeTaskProcessor;throw new ue("I3S decoder could not be initialized.")}qd.decode=async function(e,t,n,i,o){return A.typeOf.string("url",e),A.defined("defaultGeometrySchema",t),A.defined("geometryData",n),c(qd._promise)||(qd._promise=dpt()),qd._promise.then(function(r){let s=n._parent._data,a=n._parent._inverseRotationMatrix,l=0,u=0,f=0;c(s.obb)?(l=s.obb.center[0],u=s.obb.center[1],f=s.obb.center[2]):c(s.mbs)&&(l=s.mbs[0],u=s.mbs[1],f=s.mbs[2]);let d=Q.fromRotationX(-R.PI_OVER_TWO),p=new Q;Q.multiply(d,a,p);let g=he.fromDegrees(l,u,f),m=ie.WGS84.cartographicToCartesian(g),b={binaryData:n._data,featureData:c(i)&&c(i[0])?i[0].data:void 0,schema:t,bufferInfo:n._geometryBufferInfo,ellipsoidRadiiSquare:ie.WGS84.radiiSquared,url:e,geoidDataList:n._dataProvider._geoidDataList,cartographicCenter:g,cartesianCenter:m,parentRotation:p,enableFeatures:n._dataProvider.showFeatures,splitGeometryByColorTransparency:n._dataProvider.adjustMaterialAlphaMode,symbologyData:o,calculateNormals:n._dataProvider.calculateNormals};return r.scheduleTask(b)})};var xY=qd;function TY(e,t){this._parent=e,this._dataProvider=e._dataProvider,this._layer=e._layer,c(this._parent._nodeIndex)?this._resource=this._parent._layer.resource.getDerivedResource({url:`nodes/${this._parent._data.mesh.attribute.resource}/${t}`}):this._resource=this._parent.resource.getDerivedResource({url:t})}Object.defineProperties(TY.prototype,{resource:{get:function(){return this._resource}},data:{get:function(){return this._data}}});TY.prototype.load=async function(){return this._data=await n_.loadJson(this._resource),this._data};var AY=TY;function i_(e,t){this._storageInfo=t,this._parent=e,this._dataProvider=e._dataProvider,this._loadPromise=void 0;let n=`attributes/${t.key}/0`;c(this._parent._nodeIndex)?this._resource=this._parent._layer.resource.getDerivedResource({url:`nodes/${this._parent._data.mesh.attribute.resource}/${n}`}):this._resource=this._parent.resource.getDerivedResource({url:n})}Object.defineProperties(i_.prototype,{resource:{get:function(){return this._resource}},header:{get:function(){return this._header}},values:{get:function(){if(c(this._values)){if(c(this._values.attributeValues))return this._values.attributeValues;if(c(this._values.objectIds))return this._values.objectIds}return[]}},name:{get:function(){return this._storageInfo.name}}});function ON(e){return e==="UInt8"||e==="Int8"?1:e==="UInt16"||e==="Int16"?2:e==="UInt32"||e==="Int32"||e==="Oid32"||e==="Float32"?4:e==="UInt64"||e==="Int64"||e==="Float64"?8:0}function hpt(e){return e==="String"?1:ON(e)}async function mpt(e){let t=await e._dataProvider._loadBinary(e._resource),n=new DataView(t);e._data=t,e._validateHeader(n);let i=e._parseHeader(n),o=e._getBodyOffset(i);e._validateBody(n,o),e._parseBody(n,o)}i_.prototype.load=function(){return c(this._loadPromise)?this._loadPromise:(this._loadPromise=mpt(this).catch(function(e){console.error(e)}),this._loadPromise)};i_.prototype._parseValue=function(e,t,n){let i;if(t==="UInt8")i=e.getUint8(n),n+=1;else if(t==="Int8")i=e.getInt8(n),n+=1;else if(t==="UInt16")i=e.getUint16(n,!0),n+=2;else if(t==="Int16")i=e.getInt16(n,!0),n+=2;else if(t==="UInt32")i=e.getUint32(n,!0),n+=4;else if(t==="Oid32")i=e.getUint32(n,!0),n+=4;else if(t==="Int32")i=e.getInt32(n,!0),n+=4;else if(t==="UInt64"){let o=e.getUint32(n,!0),r=e.getUint32(n+4,!0);i=o+Math.pow(2,32)*r,n+=8}else if(t==="Int64"){let o=e.getUint32(n,!0),r=e.getUint32(n+4,!0);r<Math.pow(2,31)?i=o+Math.pow(2,32)*r:i=o+Math.pow(2,32)*(r-Math.pow(2,32)),n+=8}else t==="Float32"?(i=e.getFloat32(n,!0),n+=4):t==="Float64"?(i=e.getFloat64(n,!0),n+=8):t==="String"&&(i=String.fromCharCode(e.getUint8(n)),n+=1);return{value:i,offset:n}};i_.prototype._parseHeader=function(e){let t=0;this._header={};for(let n=0;n<this._storageInfo.header.length;n++){let i=this._storageInfo.header[n],o=this._parseValue(e,i.valueType,t);this._header[i.property]=o.value,t=o.offset}return t};i_.prototype._parseBody=function(e,t){this._values={};for(let n=0;n<this._storageInfo.ordering.length;n++){let i=this._storageInfo.ordering[n],o=i==="ObjectIds"?"objectIds":i,r=this._storageInfo[o];if(c(r)){this._values[o]=[];for(let s=0;s<this._header.count;++s)if(r.valueType!=="String"){let a=this._parseValue(e,r.valueType,t);this._values[o].push(a.value),t=a.offset}else{let a=this._values.attributeByteCounts[s],l="";for(let u=0;u<a;++u){let f=this._parseValue(e,r.valueType,t);f.value.charCodeAt(0)!==0&&(l+=f.value),t=f.offset}this._values[o].push(l)}}}};i_.prototype._getBodyOffset=function(e){let t=0;return c(this._storageInfo.attributeValues)?t=ON(this._storageInfo.attributeValues.valueType):c(this._storageInfo.objectIds)&&(t=ON(this._storageInfo.objectIds.valueType)),t>0?Math.ceil(e/t)*t:e};i_.prototype._validateHeader=function(e){let t=0;for(let n=0;n<this._storageInfo.header.length;n++){let i=this._storageInfo.header[n];t+=hpt(i.valueType)}if(e.byteLength<t)throw new ue(`Invalid attribute buffer size (field: ${this.name}, header: ${t}, actual: ${e.byteLength})`)};i_.prototype._validateBody=function(e,t){if(!c(this._header.count))throw new ue(`Invalid attribute buffer (field: ${this.name}, count is missing)`);let n;for(let i=0;i<this._storageInfo.ordering.length&&t<e.byteLength;i++){let o=this._storageInfo.ordering[i],r=o==="ObjectIds"?"objectIds":o,s=this._storageInfo[r];if(c(s))if(s.valueType!=="String"){r==="attributeByteCounts"&&(n=t);let a=ON(s.valueType);t+=a*this._header.count}else{if(!c(n))throw new ue(`Invalid attribute buffer (field: ${this.name}, attributeByteCounts is missing)`);for(let a=0;a<this._header.count&&t<e.byteLength;++a){let l=this._parseValue(e,this._storageInfo.attributeByteCounts.valueType,n);t+=l.value,n=l.offset}}else throw new ue(`Invalid attribute buffer (field: ${this.name}, ${r} is missing)`)}if(e.byteLength<t)throw new ue(`Invalid attribute buffer size (field: ${this.name}, expected: ${t}, actual: ${e.byteLength})`)};var CY=i_;function tP(e,t){let n=e._dataProvider,i=e._layer,o;c(e._nodeIndex)?o=i.resource.getDerivedResource({url:`nodes/${e._data.mesh.geometry.resource}/${t}`}):o=e.resource.getDerivedResource({url:t}),this._parent=e,this._dataProvider=n,this._layer=i,this._resource=o,this._customAttributes=void 0}Object.defineProperties(tP.prototype,{resource:{get:function(){return this._resource}},data:{get:function(){return this._data}},customAttributes:{get:function(){return this._customAttributes}}});tP.prototype.load=function(){let e=this;return this._dataProvider._loadBinary(this._resource).then(function(t){return e._data=t,t})};var ppt=new h,_pt=new h,gpt=new h,ypt=new h,bpt=new h;function EY(e,t,n,i){let o=h.subtract(i,n,ppt),r=h.cross(o,h.subtract(e,n,_pt),ypt),s=h.cross(o,h.subtract(t,n,gpt),bpt);return h.dot(r,s)>=0}var xpt=new h,Tpt=new h,Apt=new h,Cpt=new h,Ept=new h,Spt=new h,wpt=new h,vpt=new h,Dpt=new h,Ppt=new h;tP.prototype.getClosestPointIndexOnTriangle=function(e,t,n){if(c(this._customAttributes)&&c(this._customAttributes.positions)){let i=new h(e,t,n);i.x-=this._customAttributes.cartesianCenter.x,i.y-=this._customAttributes.cartesianCenter.y,i.z-=this._customAttributes.cartesianCenter.z,Q.multiplyByVector(this._customAttributes.parentRotation,i,i);let o=Number.MAX_VALUE,r,s,a,l,u=this._customAttributes.positions,f=this._customAttributes.indices,d;c(f)?d=f.length:d=u.length/3;for(let p=0;p<d;p++){let g,m,b;c(f)?(g=f[p],m=f[p+1],b=f[p+2]):(g=p*3,m=p*3+1,b=p*3+2);let x=h.fromElements(u[g*3],u[g*3+1],u[g*3+2],xpt),T=h.fromElements(u[m*3],u[m*3+1],u[m*3+2],Tpt),C=new h(u[b*3],u[b*3+1],u[b*3+2],Apt);if(!EY(i,x,T,C)||!EY(i,T,x,C)||!EY(i,C,x,T))continue;let S=h.subtract(T,x,Cpt),v=h.subtract(C,x,Ept),D=h.cross(S,v,Spt);if(h.magnitude(D)===0)continue;let I=h.normalize(D,wpt),L=h.subtract(i,x,vpt),M=Math.abs(h.dot(L,I));if(M<o){o=M,r=p;let N=h.magnitudeSquared(h.subtract(i,x,L)),B=h.magnitudeSquared(h.subtract(i,T,Dpt)),_=h.magnitudeSquared(h.subtract(i,C,Ppt));N<B&&N<_?(a=g,l=x,s=N):B<_?(a=m,l=T,s=B):(a=b,l=C,s=_)}}if(c(r))return{index:a,distanceSquared:s,distance:Math.sqrt(s),queriedPosition:i,closestPosition:h.clone(l)}}return{index:-1,distanceSquared:Number.Infinity,distance:Number.Infinity}};function ube(e){let t=[],n=e.length;for(let i=0;i<n;i++)i<3?t.push(vD(e[i])):t.push(e[i]);return t}tP.prototype._generateGltf=function(e,t,n,i,o,r,s,a){let l={pbrMetallicRoughness:{metallicFactor:0},doubleSided:!0,name:"Material"},u=!1,f,d="";if(c(this._parent._data.mesh)&&c(this._layer._data.materialDefinitions)){let S=this._parent._data.mesh.material.definition;if(S>=0&&S<this._layer._data.materialDefinitions.length){if(f=this._layer._data.materialDefinitions[S],l=f,c(l.pbrMetallicRoughness)&&c(l.pbrMetallicRoughness.baseColorTexture)){u=!0,l.pbrMetallicRoughness.baseColorTexture.index=0;let v="0";if(c(this._layer._data.textureSetDefinitions))for(let D=0;D<this._layer._data.textureSetDefinitions.length;D++){let I=this._layer._data.textureSetDefinitions[D];for(let L=0;L<I.formats.length;L++){let M=I.formats[L];if(M.format==="jpg"){v=M.name;break}}}c(this._parent._data.mesh)&&this._parent._data.mesh.material.resource>=0&&(d=this._layer.resource.getDerivedResource({url:`nodes/${this._parent._data.mesh.material.resource}/textures/${v}`}).url)}c(l.pbrMetallicRoughness)&&c(l.pbrMetallicRoughness.baseColorFactor)&&(l.pbrMetallicRoughness.baseColorFactor=ube(l.pbrMetallicRoughness.baseColorFactor)),c(l.emissiveFactor)&&(l.emissiveFactor=ube(l.emissiveFactor))}}else c(this._parent._data.textureData)&&(u=!0,d=this._parent.resource.getDerivedResource({url:`${this._parent._data.textureData[0].href}`}).url,l.pbrMetallicRoughness.baseColorTexture={index:0});c(l.alphaMode)&&(l.alphaMode=l.alphaMode.toUpperCase());let p=[],g=[],m=[];u&&(p=[{sampler:0,source:0}],g=[{uri:d}],m=[{magFilter:9729,minFilter:9986,wrapS:10497,wrapT:10497}]);let b=[],x=n.length;for(let C=0;C<x;C++){let S=n[C].primitives,v=S.length;for(let D=0;D<v;D++){let I=S[D];if(c(I.material)){for(;I.material>=b.length;){let M=qe(l,!0);b.push(M)}let L=b[I.material];c(I.extra)&&I.extra.isTransparent?c(L.alphaMode)||(L.alphaMode="BLEND"):L.alphaMode==="BLEND"&&(L.alphaMode="OPAQUE")}}}return{scene:0,scenes:[{nodes:e}],nodes:t,meshes:n,buffers:i,bufferViews:o,accessors:r,materials:b,textures:p,images:g,samplers:m,asset:{version:"2.0"},extensions:s,extensionsUsed:a}};var RN=tP;function rc(e,t,n){let i,o,r,s;n?(i=0,o=e):(i=e._level+1,o=e._layer),typeof t=="number"?r=t:s=e.resource.getDerivedResource({url:`${t}/`}),this._parent=e,this._dataProvider=e._dataProvider,this._isRoot=n,this._level=i,this._layer=o,this._nodeIndex=r,this._resource=s,this._isLoading=!1,this._tile=void 0,this._data=void 0,this._geometryData=[],this._featureData=[],this._fields={},this._children=[],this._childrenReadyPromise=void 0,this._globalTransform=void 0,this._inverseGlobalTransform=void 0,this._inverseRotationMatrix=void 0,this._symbologyData=void 0}Object.defineProperties(rc.prototype,{resource:{get:function(){return this._resource}},layer:{get:function(){return this._layer}},parent:{get:function(){return this._parent}},children:{get:function(){return this._children}},geometryData:{get:function(){return this._geometryData}},featureData:{get:function(){return this._featureData}},fields:{get:function(){return this._fields}},tile:{get:function(){return this._tile}},data:{get:function(){return this._data}}});rc.prototype.load=async function(){let e=this;function t(){if(!e._isRoot){let o=e._create3DTileDefinition();e._tile=new Ph(e._layer._tileset,e._dataProvider.resource,o,e._parent._tile),e._tile._i3sNode=e}}if(!c(this._nodeIndex)){let o=await n_.loadJson(this._resource);e._data=o,t();return}let n=await this._layer._getNodeInNodePages(this._nodeIndex);e._data=n;let i;e._isRoot?i="nodes/root/":c(n.mesh)&&(i=`../${n.mesh.geometry.resource}/`),c(i)&&c(e._parent.resource)&&(e._resource=e._parent.resource.getDerivedResource({url:i})),t()};function fbe(e,t){let n=new CY(e,t);return e._fields[t.name]=n,n.load()}rc.prototype.loadFields=function(){let e=this._layer._data.attributeStorageInfo,t=[];if(c(e))for(let n=0;n<e.length;n++){let i=e[n],o=this._fields[i.name];c(o)?t.push(o.load()):t.push(fbe(this,i))}return Promise.all(t)};rc.prototype.loadField=function(e){A.defined("name",e);let t=this._fields[e];if(c(t))return t.load();let n=this._layer._data.attributeStorageInfo;if(c(n))for(let i=0;i<n.length;i++){let o=n[i];if(o.name===e)return fbe(this,o)}return Promise.resolve()};rc.prototype.getFieldsForPickedPosition=function(e){let t=this.geometryData[0];if(!c(t.customAttributes.featureIndex))return{};let n=t.getClosestPointIndexOnTriangle(e.x,e.y,e.z);if(n.index===-1||n.index>t.customAttributes.featureIndex.length)return{};let i=t.customAttributes.featureIndex[n.index];return this.getFieldsForFeature(i)};rc.prototype.getFieldsForFeature=function(e){let t={};for(let n in this.fields)if(this.fields.hasOwnProperty(n)){let i=this.fields[n];e>=0&&e<i.values.length&&(t[i.name]=i.values[e])}return t};rc.prototype._loadChildren=function(){let e=this;if(c(this._childrenReadyPromise))return this._childrenReadyPromise;let t=[];if(c(e._data.children))for(let n=0;n<e._data.children.length;n++){let i=e._data.children[n],o=new rc(e,y(i.href,i),!1);e._children.push(o),t.push(o.load())}return this._childrenReadyPromise=Promise.all(t).then(function(){for(let n=0;n<e._children.length;n++)e._tile.children.push(e._children[n]._tile)}),this._childrenReadyPromise};rc.prototype._loadGeometryData=function(){let e=[];if(c(this._data.geometryData))for(let t=0;t<this._data.geometryData.length;t++){let n=new RN(this,this._data.geometryData[t].href);this._geometryData.push(n),e.push(n.load())}else if(c(this._data.mesh)){let t=this._layer._findBestGeometryBuffers(this._data.mesh.geometry.definition,["position","uv0"]),n=`./geometries/${t.bufferIndex}/`,i=new RN(this,n);i._geometryDefinitions=t.definition,i._geometryBufferInfo=t.geometryBufferInfo,this._geometryData.push(i),e.push(i.load())}return Promise.all(e)};rc.prototype._loadFeatureData=function(){let e=[];if(c(this._data.featureData))for(let t=0;t<this._data.featureData.length;t++){let n=new AY(this,this._data.featureData[t].href);this._featureData.push(n),e.push(n.load())}return Promise.all(e)};rc.prototype._clearGeometryData=function(){this._geometryData=[]};rc.prototype._create3DTileDefinition=function(){let e=this._data.obb,t=this._data.mbs;if(!c(e)&&!c(t)){console.error("Failed to load I3S node. Bounding volume is required.");return}let n;if(c(e)?n=he.fromDegrees(e.center[0],e.center[1],e.center[2]):n=he.fromDegrees(t[0],t[1],t[2]),c(this._dataProvider._geoidDataList)&&c(n))for(let T=0;T<this._dataProvider._geoidDataList.length;T++){let C=this._dataProvider._geoidDataList[T],S=C.projection.project(n);if(S.x>C.nativeExtent.west&&S.x<C.nativeExtent.east&&S.y>C.nativeExtent.south&&S.y<C.nativeExtent.north){n.height+=Mpt(S.x,S.y,C);break}}let i={},o,r=0;c(e)?(i={box:[0,0,0,e.halfSize[0],0,0,0,e.halfSize[1],0,0,0,e.halfSize[2]]},r=Math.max(Math.max(this._data.obb.halfSize[0],this._data.obb.halfSize[1]),this._data.obb.halfSize[2]),o=ie.WGS84.cartographicToCartesian(n)):(i={sphere:[0,0,0,t[3]]},o=ie.WGS84.cartographicToCartesian(n),r=this._data.mbs[3]),r*=2;let s=1/0;if(c(this._data.lodThreshold))if(this._layer._data.nodePages.lodSelectionMetricType==="maxScreenThresholdSQ"){let T=Math.sqrt(this._data.lodThreshold/(Math.PI*.25));s=r/T}else if(this._layer._data.nodePages.lodSelectionMetricType==="maxScreenThreshold"){let T=this._data.lodThreshold;s=r/T}else console.error("Invalid lodSelectionMetricType in Layer");else if(c(this._data.lodSelection))for(let T=0;T<this._data.lodSelection.length;T++)this._data.lodSelection[T].metricType==="maxScreenThreshold"&&(s=r/this._data.lodSelection[T].maxError);s===1/0&&(s=1e5);let a=s*16,l=new Fa(0,0,0),u=Ft.headingPitchRollQuaternion(o,l);c(this._data.obb)&&(u=new Ne(this._data.obb.quaternion[0],this._data.obb.quaternion[1],this._data.obb.quaternion[2],this._data.obb.quaternion[3]));let f=Q.fromQuaternion(u),d=Q.inverse(f,new Q),p=new k(f[0],f[1],f[2],0,f[3],f[4],f[5],0,f[6],f[7],f[8],0,o.x,o.y,o.z,1),g=k.inverse(p,new k),m=k.clone(p);c(this._parent._globalTransform)&&k.multiply(p,this._parent._inverseGlobalTransform,m),this._globalTransform=p,this._inverseGlobalTransform=g,this._inverseRotationMatrix=d;let b=[];for(let T=0;T<this._children.length;T++)b.push(this._children[T]._create3DTileDefinition());return{children:b,refine:"REPLACE",boundingVolume:i,transform:[m[0],m[4],m[8],m[12],m[1],m[5],m[9],m[13],m[2],m[6],m[10],m[14],m[3],m[7],m[11],m[15]],content:{uri:c(this._resource)?this._resource.url:void 0},geometricError:a}};rc.prototype._loadSymbology=async function(){!c(this._symbologyData)&&c(this._layer._symbology)&&(this._symbologyData=await this._layer._symbology._getSymbology(this))};rc.prototype._createContentURL=async function(){let e={scene:0,scenes:[{nodes:[0]}],nodes:[{name:"singleNode"}],meshes:[],buffers:[],bufferViews:[],accessors:[],materials:[],textures:[],images:[],samplers:[],asset:{version:"2.0"}},t=[this._loadGeometryData()];if(this._dataProvider.legacyVersion16&&t.push(this._loadFeatureData()),await Promise.all(t),c(this._geometryData)&&this._geometryData.length>0){this._dataProvider._applySymbology&&await this._loadSymbology();let o=this._geometryData[0].resource.url,r=this._layer._data.store.defaultGeometrySchema,s=this._geometryData[0],a=await xY.decode(o,r,s,this._featureData[0],this._symbologyData);if(!c(a))return;e=s._generateGltf(a.meshData.nodesInScene,a.meshData.nodes,a.meshData.meshes,a.meshData.buffers,a.meshData.bufferViews,a.meshData.accessors,a.meshData.rootExtensions,a.meshData.extensionsUsed),this._geometryData[0]._customAttributes=a.meshData._customAttributes}let n=this._dataProvider._binarizeGltf(e),i=new Blob([n],{type:"application/binary"});return URL.createObjectURL(i)};async function Ipt(e){let t=e._layer._filters,n=[];for(let i=0;i<t.length;i++){let o=e.loadField(t[i].name);n.push(o)}return await Promise.all(n),t}function Opt(e,t,n){if(!c(n.values)||n.values.length===0)return!1;let i=c(t)?t.values:[],o;e<i.length&&(o=i[e]);let r=!1;for(let s=0;s<n.values.length;s++)if(n.values[s]===o){r=!0;break}return r}async function dbe(e,t){let n=e._tile.content.batchTable;if(c(n)&&n.featuresLength>0){n.setAllShow(!0);let i=await Ipt(e);if(i.length>0)for(let o=0;o<n.featuresLength;o++)for(let r=0;r<i.length;r++){let s=i[r];if(!Opt(o,e._fields[s.name],s)){n.setShow(o,!1);break}}}t.show=!0}rc.prototype._filterFeatures=function(){let e=[];for(let n=0;n<this._children.length;n++){let i=this._children[n]._filterFeatures();e.push(i)}let t=this._tile?.content?._model;if(c(this._geometryData)&&this._geometryData.length>0&&c(t)&&t.ready){t.show=!1;let n=dbe(this,t);e.push(n)}return Promise.all(e)};Ph.prototype._hookedRequestContent=Ph.prototype.requestContent;Ph.prototype.requestContent=function(){if(!this.tileset._isI3STileSet)return this._hookedRequestContent();if(!this._isLoading){this._isLoading=!0;let e=this;return this._i3sNode._createContentURL().then(t=>{if(!c(t)){e._isLoading=!1;return}return e._contentResource=new De({url:t}),e._hookedRequestContent()}).then(t=>{let n=t?._model;return c(e._i3sNode._geometryData)&&e._i3sNode._geometryData.length>0&&c(n)&&(n.show=!1,n.readyEvent.addEventListener(()=>{dbe(e._i3sNode,n)})),e._isLoading=!1,t})}};function Rpt(e,t,n,i,o,r){let s=n*(1-e)+i*e,a=o*(1-e)+r*e;return s*(1-t)+a*t}function MN(e,t,n,i){let o=e+t*n;return i[o]}function Mpt(e,t,n){let i=n.nativeExtent,o=(e-i.west)/(i.east-i.west)*(n.width-1),r=(t-i.south)/(i.north-i.south)*(n.height-1),s=Math.floor(o),a=Math.floor(r);o-=s,r-=a;let l=s<n.width?s+1:s,u=a<n.height?a+1:a;a=n.height-1-a,u=n.height-1-u;let f=MN(s,a,n.width,n.buffer),d=MN(l,a,n.width,n.buffer),p=MN(s,u,n.width,n.buffer),g=MN(l,u,n.width,n.buffer),m=Rpt(o,r,f,d,p,g);return m=m*n.scale+n.offset,m}Object.defineProperties(Ph.prototype,{i3sNode:{get:function(){return this._i3sNode}}});var LN=rc;function NN(e){this._layer=e,this._defaultSymbology=void 0,this._valueFields=[],this._uniqueValueHash=void 0,this._classBreaksHash=void 0,this._parseLayerSymbology()}Object.defineProperties(NN.prototype,{defaultSymbology:{get:function(){return this._defaultSymbology}}});function SY(e,t){let n=[];for(let i=0;i<e.length;i++){let o=j.byteToFloat(e[i]);i<3?n.push(vD(o)):n.push(o)}return n.length===3&&(c(t)?n.push(1-t/100):n.push(1)),n}function NC(e,t){let n={edges:void 0,material:void 0};if(c(e)&&c(e.symbolLayers))for(let i=0;i<e.symbolLayers.length;i++){let o=e.symbolLayers[i];if(o.type==="Fill"){let r=o.edges,s=o.outline;if(c(r)?(n.edges={},c(r.color)&&(n.edges.color=SY(r.color,r.transparency))):c(s)&&(n.edges={},c(s.color)&&(n.edges.color=SY(s.color,s.transparency))),!t){let a=o.material;c(a)&&(n.material={colorMixMode:a.colorMixMode},c(a.color)&&(n.material.color=SY(a.color,a.transparency)))}break}}return n}function Lpt(e,t){if(c(e.uniqueValueGroups)){let n={};for(let i=0;i<e.uniqueValueGroups.length;i++){let o=e.uniqueValueGroups[i].classes;if(c(o))for(let r=0;r<o.length;r++){let s=NC(o[r].symbol,t),a=o[r].values;for(let l=0;l<a.length;l++){let u=a[l],f=n;for(let d=0;d<u.length;d++){let p=u[d];d===u.length-1?f[p]=s:(c(f[p])||(f[p]={}),f=f[p])}}}}return n}if(c(e.uniqueValueInfos)){let n={};for(let i=0;i<e.uniqueValueInfos.length;i++){let o=e.uniqueValueInfos[i];n[o.value]=NC(o.symbol,t)}return n}}function Npt(e,t){if(c(e.classBreakInfos)){let n=[...e.classBreakInfos];n.sort(function(o,r){let s=y(o.classMaxValue,o.classMinValue),a=y(r.classMaxValue,r.classMinValue);return s-a});let i={ranges:[],symbols:[]};c(e.minValue)&&(i.ranges.push(e.minValue),i.symbols.push(void 0));for(let o=0;o<n.length;o++){let r=n[o];c(r.classMinValue)&&(i.ranges.length===0||r.classMinValue>i.ranges[i.ranges.length-1])&&(i.ranges.push(r.classMinValue),i.symbols.push(void 0)),c(r.classMaxValue)&&(i.ranges.length===0||r.classMaxValue>i.ranges[i.ranges.length-1])&&(i.ranges.push(r.classMaxValue),i.symbols.push(NC(r.symbol,t)))}return i.symbols.push(void 0),i}}NN.prototype._parseLayerSymbology=function(){let e=this._layer.data.drawingInfo;if(c(e)&&c(e.renderer)){let t=this._layer.data.cachedDrawingInfo,n=c(t)&&t.color===!0,i=e.renderer;i.type==="simple"?this._defaultSymbology=NC(i.symbol,n):i.type==="uniqueValue"?(this._defaultSymbology=NC(i.defaultSymbol,n),this._valueFields.push(i.field1),c(i.field2)&&this._valueFields.push(i.field2),c(i.field3)&&this._valueFields.push(i.field3),this._uniqueValueHash=Lpt(i,n)):i.type==="classBreaks"&&(this._defaultSymbology=NC(i.defaultSymbol,n),this._valueFields.push(i.field),this._classBreaksHash=Npt(i,n))}};function hbe(e,t,n,i){let o=t[n];if(i<o.length){let r=o[i],s=e[r];return c(s)&&++n<t.length?hbe(s,t,n,i):s}}function Fpt(e,t){let n=0,i=e.length;if(n<i)do{let o=n+i>>>1;e[o]<t?n=o+1:i=o}while(n<i);return n}function Bpt(e,t,n){let i=t[n],o=Fpt(e.ranges,i);return e.symbols[o]}NN.prototype._getSymbology=async function(e){let t={default:this._defaultSymbology};if(this._valueFields.length>0){let n=[];for(let r=0;r<this._valueFields.length;r++)n.push(e.loadField(this._valueFields[r]));await Promise.all(n);let i=[];for(let r=0;r<this._valueFields.length;r++)i.push(e.fields[this._valueFields[r]].values);let o;if(c(this._uniqueValueHash)?o=r=>hbe(this._uniqueValueHash,i,0,r):c(this._classBreaksHash)&&(o=r=>Bpt(this._classBreaksHash,i[0],r)),c(o)){let r=i[0];for(let s=0;s<r.length;s++){let a=o(s);c(a)&&(t[s]=a)}}}return t};var wY=NN;function Dl(e,t,n){this._dataProvider=e,this._parent=n,!c(t.href)&&c(t.id)&&(t.href=`layers/${t.id}`);let i=this._parent.resource.getUrlComponent(),o="";i.match(/layers\/\d/)?o=`${i}`.replace(/\/+$/,""):o=`${i}`.replace(/\/?$/,"/").concat(`${t.href}`),this._version=t.store.version;let r=this._version.split(".");this._majorVersion=parseInt(r[0]),this._minorVersion=r.length>1?parseInt(r[1]):0,this._resource=new De({url:o}),this._resource.setQueryParameters(this._dataProvider.resource.queryParameters),this._resource.appendForwardSlash(),this._data=t,this._rootNode=void 0,this._nodePages={},this._nodePageFetches={},this._extent=void 0,this._tileset=void 0,this._geometryDefinitions=void 0,this._filters=[],this._symbology=void 0,this._computeGeometryDefinitions(!0),this._computeExtent()}Object.defineProperties(Dl.prototype,{resource:{get:function(){return this._resource}},rootNode:{get:function(){return this._rootNode}},tileset:{get:function(){return this._tileset}},data:{get:function(){return this._data}},version:{get:function(){return this._version}},majorVersion:{get:function(){return this._majorVersion}},minorVersion:{get:function(){return this._minorVersion}},legacyVersion16:{get:function(){if(c(this.version))return this.majorVersion<1||this.majorVersion===1&&this.minorVersion<=6}}});Dl.prototype.load=async function(e){if(this._data.spatialReference.wkid!==4326)throw new ue(`Unsupported spatial reference: ${this._data.spatialReference.wkid}`);if(this._dataProvider.applySymbology&&(this._symbology=new wY(this)),await this._dataProvider.loadGeoidData(),await this._loadRootNode(e),await this._create3DTileset(e),this._rootNode._tile=this._tileset._root,this._tileset._root._i3sNode=this._rootNode,this.legacyVersion16)return this._rootNode._loadChildren()};Dl.prototype._computeGeometryDefinitions=function(e){if(this._geometryDefinitions=[],c(this._data.geometryDefinitions))for(let t=0;t<this._data.geometryDefinitions.length;t++){let n=[],i=this._data.geometryDefinitions[t].geometryBuffers;for(let o=0;o<i.length;o++){let r=i[o],s=[],a=!1;if(c(r.compressedAttributes)&&e){a=!0;let l=r.compressedAttributes.attributes;for(let u=0;u<l.length;u++)s.push(l[u])}else for(let l in r)l!=="offset"&&s.push(l);n.push({compressed:a,attributes:s,index:i.indexOf(r)})}n.sort(function(o,r){return o.compressed&&!r.compressed?-1:!o.compressed&&r.compressed?1:o.attributes.length-r.attributes.length}),this._geometryDefinitions.push(n)}};Dl.prototype._findBestGeometryBuffers=function(e,t){let n=this._geometryDefinitions[e];if(c(n)){for(let i=0;i<n.length;++i){let o=n[i],r=!1,s=o.attributes;for(let a=0;a<t.length;a++)if(!s.includes(t[a])){r=!0;break}if(!r)return{bufferIndex:o.index,definition:n,geometryBufferInfo:o}}if(c(n[0]))return{bufferIndex:0,definition:n,geometryBufferInfo:n[0]}}};Dl.prototype._loadRootNode=function(e){if(c(this._data.nodePages)){let t=0;c(this._data.nodePages.rootIndex)&&(t=this._data.nodePages.rootIndex),this._rootNode=new LN(this,t,!0)}else this._rootNode=new LN(this,this._data.store.rootNode,!0);return this._rootNode.load(e)};Dl.prototype._getNodeInNodePages=function(e){let t=Math.floor(e/this._data.nodePages.nodesPerPage),n=e%this._data.nodePages.nodesPerPage;return this._loadNodePage(t).then(function(i){return i.nodes[n]})};Dl._fetchJson=function(e){return e.fetchJson()};Dl.prototype._loadNodePage=function(e){let t=this;if(!c(this._nodePageFetches[e])){let n=this.resource.getDerivedResource({url:`nodepages/${e}/`}),i=Dl._fetchJson(n).then(function(o){return c(o.error)&&o.error.code!==200?Promise.reject(o.error):(t._nodePages[e]=o.nodes,o)});this._nodePageFetches[e]=i}return this._nodePageFetches[e]};Dl.prototype._computeExtent=function(){c(this._data.fullExtent)?this._extent=ae.fromDegrees(this._data.fullExtent.xmin,this._data.fullExtent.ymin,this._data.fullExtent.xmax,this._data.fullExtent.ymax):c(this._data.store.extent)&&(this._extent=ae.fromDegrees(this._data.store.extent[0],this._data.store.extent[1],this._data.store.extent[2],this._data.store.extent[3]))};Dl.prototype._create3DTileset=async function(e){let t={asset:{version:"1.0"},geometricError:Number.MAX_VALUE,root:this._rootNode._create3DTileDefinition()},n=new Blob([JSON.stringify(t)],{type:"application/json"}),i=URL.createObjectURL(n),o=this._symbology?.defaultSymbology?.edges?.color;c(o)&&!c(e?.outlineColor)&&(e=c(e)?qe(e):{},e.outlineColor=j.fromCartesian4(se.fromArray(o))),this._tileset=await pa.fromUrl(i,e),this._tileset.show=this._parent.show,this._tileset._isI3STileSet=!0,this._tileset.tileUnload.addEventListener(function(r){r._i3sNode._clearGeometryData(),URL.revokeObjectURL(r._contentResource._url),r._contentResource=r._i3sNode.resource}),this._tileset.tileVisible.addEventListener(function(r){c(r._i3sNode)&&r._i3sNode._loadChildren()})};Dl.prototype._updateVisibility=function(){c(this._tileset)&&(this._tileset.show=this._parent.show)};Dl.prototype.filterByAttributes=function(e){this._filters=c(e)?qe(e,!0):[];let t=this._rootNode;return c(t)?t._filterFeatures():Promise.resolve()};var nP=Dl;function FN(e,t){this._dataProvider=e,this._resource=new De({url:t}),this._resource.setQueryParameters(e.resource.queryParameters),this._resource.appendForwardSlash()}Object.defineProperties(FN.prototype,{resource:{get:function(){return this._resource}},data:{get:function(){return this._data}},names:{get:function(){let e=[],t=this._data.summary;if(c(t))for(let n=0;n<t.length;++n)e.push(t[n].fieldName);return e}}});FN.prototype.load=async function(){return this._data=await n_.loadJson(this._resource),this._data};FN.prototype._getValues=function(e){let t=this._data.summary;if(c(t))for(let n=0;n<t.length;++n){let i=t[n];if(i.fieldName===e)return c(i.mostFrequentValues)?[...i.mostFrequentValues]:[]}};var vY=FN;function iP(e,t,n){this._dataProvider=e,this._parent=t,this._data=n,this._name=n.name,this._modelName=n.modelName,this._visibility=y(n.visibility,!0),this._resource=void 0,this._sublayers=[],this._i3sLayers=[]}Object.defineProperties(iP.prototype,{resource:{get:function(){return this._resource}},data:{get:function(){return this._data}},name:{get:function(){return this._name}},modelName:{get:function(){return this._modelName}},sublayers:{get:function(){return this._sublayers}},visibility:{get:function(){return this._visibility},set:function(e){if(A.defined("value",e),this._visibility!==e){this._visibility=e;for(let t=0;t<this._i3sLayers.length;t++)this._i3sLayers[t]._updateVisibility()}}},show:{get:function(){return this._visibility&&this._parent.show}}});iP._fromData=async function(e,t,n,i){let o=new iP(e,i,n);if(o._data.layerType==="group"){let r=o._data.sublayers;if(c(r)){let s=[];for(let l=0;l<r.length;l++){let u=iP._fromData(e,t,r[l],o);s.push(u)}let a=await Promise.all(s);for(let l=0;l<a.length;l++){let u=a[l];o._sublayers.push(u),o._i3sLayers.push(...u._i3sLayers)}}}else if(o._data.layerType==="3DObject"){let r=t.concat(`/sublayers/${o._data.id}`),s=new De({url:r});s.setQueryParameters(e.resource.queryParameters),s.appendForwardSlash(),o._resource=s;let a=await n_.loadJson(o._resource),l=new nP(e,a,o);o._i3sLayers.push(l)}else console.log(`${o._data.layerType} layer ${o._data.name} is skipped as not supported.`);return o};var DY=iP;var _be=Ur(mbe(),1);function rs(e){e=y(e,y.EMPTY_OBJECT),this._name=e.name,this._show=y(e.show,!0),this._geoidTiledTerrainProvider=e.geoidTiledTerrainProvider,this._showFeatures=y(e.showFeatures,!1),this._adjustMaterialAlphaMode=y(e.adjustMaterialAlphaMode,!1),this._applySymbology=y(e.applySymbology,!1),this._calculateNormals=y(e.calculateNormals,!1),this._cesium3dTilesetOptions=y(e.cesium3dTilesetOptions,y.EMPTY_OBJECT),this._layers=[],this._sublayers=[],this._data=void 0,this._extent=void 0,this._geoidDataPromise=void 0,this._geoidDataList=void 0,this._decoderTaskProcessor=void 0,this._taskProcessorReadyPromise=void 0,this._attributeStatistics=[],this._layersExtent=[]}Object.defineProperties(rs.prototype,{name:{get:function(){return this._name}},show:{get:function(){return this._show},set:function(e){if(A.defined("value",e),this._show!==e){this._show=e;for(let t=0;t<this._layers.length;t++)this._layers[t]._updateVisibility()}}},geoidTiledTerrainProvider:{get:function(){return this._geoidTiledTerrainProvider}},layers:{get:function(){return this._layers}},sublayers:{get:function(){return this._sublayers}},data:{get:function(){return this._data}},extent:{get:function(){return this._extent}},resource:{get:function(){return this._resource}},showFeatures:{get:function(){return this._showFeatures}},adjustMaterialAlphaMode:{get:function(){return this._adjustMaterialAlphaMode}},applySymbology:{get:function(){return this._applySymbology}},calculateNormals:{get:function(){return this._calculateNormals}}});rs.prototype.destroy=function(){for(let e=0;e<this._layers.length;e++)c(this._layers[e]._tileset)&&this._layers[e]._tileset.destroy();return de(this)};rs.prototype.isDestroyed=function(){return!1};rs.prototype.update=function(e){for(let t=0;t<this._layers.length;t++)c(this._layers[t]._tileset)&&this._layers[t]._tileset.update(e)};rs.prototype.prePassesUpdate=function(e){for(let t=0;t<this._layers.length;t++)c(this._layers[t]._tileset)&&this._layers[t]._tileset.prePassesUpdate(e)};rs.prototype.postPassesUpdate=function(e){for(let t=0;t<this._layers.length;t++)c(this._layers[t]._tileset)&&this._layers[t]._tileset.postPassesUpdate(e)};rs.prototype.updateForPass=function(e,t){for(let n=0;n<this._layers.length;n++)c(this._layers[n]._tileset)&&this._layers[n]._tileset.updateForPass(e,t)};function kpt(e,t){let n=e.resource.getUrlComponent(),i="";return n.match(/layers\/\d/)?i=`${n}`.replace(/\/+$/,""):i=`${n}`.replace(/\/?$/,"/").concat(`layers/${t}`),i}async function pbe(e,t,n){if(t.layerType==="Building"){c(n.showFeatures)||(e._showFeatures=!0),c(n.adjustMaterialAlphaMode)||(e._adjustMaterialAlphaMode=!0),c(n.applySymbology)||(e._applySymbology=!0),c(n.calculateNormals)||(e._calculateNormals=!0);let i=kpt(e,t.id);if(c(t.sublayers)){let o=[];for(let s=0;s<t.sublayers.length;s++){let a=DY._fromData(e,i,t.sublayers[s],e);o.push(a)}let r=await Promise.all(o);for(let s=0;s<r.length;s++){let a=r[s];e._sublayers.push(a),e._layers.push(...a._i3sLayers)}}if(c(t.statisticsHRef)){let o=i.concat(`/${t.statisticsHRef}`),r=new vY(e,o);await r.load(),e._attributeStatistics.push(r)}if(c(t.fullExtent)){let o=ae.fromDegrees(t.fullExtent.xmin,t.fullExtent.ymin,t.fullExtent.xmax,t.fullExtent.ymax);e._layersExtent.push(o)}}else if(t.layerType==="3DObject"||t.layerType==="IntegratedMesh"){!c(n.calculateNormals)&&!c(t.textureSetDefinitions)&&(e._calculateNormals=!0);let i=new nP(e,t,e);e._layers.push(i),c(i._extent)&&e._layersExtent.push(i._extent)}else console.log(`${t.layerType} layer ${t.name} is skipped as not supported.`)}rs.fromUrl=async function(e,t){A.defined("url",e),t=y(t,y.EMPTY_OBJECT);let n=De.createIfNeeded(e);n.setQueryParameters({f:"pjson"},!0);let i=await rs.loadJson(n),o=new rs(t);if(o._resource=n,o._data=i,c(i.layers)){let s=[];for(let a=0;a<i.layers.length;a++){let l=pbe(o,i.layers[a],t);s.push(l)}await Promise.all(s)}else await pbe(o,i,t);o._computeExtent();let r=[];for(let s=0;s<o._layers.length;s++)r.push(o._layers[s].load(t.cesium3dTilesetOptions));return await Promise.all(r),o};rs._fetchJson=function(e){return e.fetchJson()};rs.loadJson=async function(e){let t=await rs._fetchJson(e);if(c(t.error)){if(console.error("Failed to fetch I3S ",e.url),c(t.error.message)&&console.error(t.error.message),c(t.error.details))for(let n=0;n<t.error.details.length;n++)console.log(t.error.details[n]);throw new ue(t.error)}return t};rs.prototype._loadBinary=async function(e){let t=await e.fetchArrayBuffer();if(t.byteLength>0&&new Uint8Array(t)[0]===123&&new TextDecoder().decode(t).includes("404"))throw new ue(`Failed to load binary: ${e.url}`);return t};rs.prototype._binarizeGltf=function(e){let n=new TextEncoder().encode(JSON.stringify(e)),i=new Uint8Array(n.byteLength+20),o={magic:new Uint8Array(i.buffer,0,4),version:new Uint32Array(i.buffer,4,1),length:new Uint32Array(i.buffer,8,1),chunkLength:new Uint32Array(i.buffer,12,1),chunkType:new Uint32Array(i.buffer,16,1),chunkData:new Uint8Array(i.buffer,20,n.byteLength)};return o.magic[0]=103,o.magic[1]=108,o.magic[2]=84,o.magic[3]=70,o.version[0]=2,o.length[0]=i.byteLength,o.chunkLength[0]=n.byteLength,o.chunkType[0]=1313821514,o.chunkData.set(n),i};var Vpt=new H;function Upt(e,t){let n=e.tilingScheme,i=[],o={},r=e._lodCount,s=he.fromRadians(t.west,t.north),a=he.fromRadians(t.east,t.south),l=n.positionToTileXY(s,r),u=n.positionToTileXY(a,r);for(let d=l.x;d<=u.x;d++)for(let p=l.y;p<=u.y;p++){let g=H.fromElements(d,p,Vpt),m=g.toString();if(!o.hasOwnProperty(m)){let b={x:g.x,y:g.y,level:r,tilingScheme:n,terrainProvider:e,positions:[]};o[m]=b,i.push(b)}}let f=[];for(let d=0;d<i.length;++d){let p=i[d],g=p.terrainProvider.requestTileGeometry(p.x,p.y,p.level);f.push(g)}return Promise.all(f).then(function(d){let p=[];for(let g=0;g<d.length;g++){let m={tilingScheme:n,x:i[g].x,y:i[g].y,level:i[g].level},b=d[g],x="Geographic";n._projection instanceof Li&&(x="WebMercator");let T={projectionType:x,projection:n._projection,nativeExtent:n.tileXYToNativeRectangle(m.x,m.y,m.level),height:b._height,width:b._width,scale:b._structure.heightScale,offset:b._structure.heightOffset};if(b._encoding===Jh.LERC){let C=_be.default.decode(b._buffer);T.buffer=C.pixels[0]}else T.buffer=b._buffer;p.push(T)}return p})}async function zpt(e){let t=e._geoidTiledTerrainProvider;if(c(t))try{let n=await Upt(t,e._extent);e._geoidDataList=n}catch{console.log("Error retrieving Geoid Terrain tiles - no geoid conversion will be performed.")}}rs.prototype.loadGeoidData=async function(){return c(this._geoidDataPromise)?this._geoidDataPromise:(this._geoidDataPromise=zpt(this),this._geoidDataPromise)};rs.prototype._computeExtent=function(){let e;for(let t=0;t<this._layersExtent.length;t++){let n=this._layersExtent[t];c(e)?ae.union(e,n,e):e=ae.clone(n)}this._extent=e};rs.prototype.getAttributeNames=function(){let e=[];for(let t=0;t<this._attributeStatistics.length;++t)e.push(...this._attributeStatistics[t].names);return e};rs.prototype.getAttributeValues=function(e){A.defined("name",e);for(let t=0;t<this._attributeStatistics.length;++t){let n=this._attributeStatistics[t]._getValues(e);if(c(n))return n}return[]};rs.prototype.filterByAttributes=function(e){let t=[];for(let n=0;n<this._layers.length;n++){let i=this._layers[n].filterByAttributes(e);t.push(i)}return Promise.all(t)};var n_=rs;function um(){this._numSamples=1,this.previousFramebuffer=void 0,this._previousFramebuffer=void 0,this._depthStencilTexture=void 0,this._depthStencilRenderbuffer=void 0,this._fbo=new gi({depthStencil:!0,createDepthAttachments:!1}),this._fboClassified=new gi({depthStencil:!0,createDepthAttachments:!1}),this._rsUnclassified=void 0,this._rsClassified=void 0,this._unclassifiedCommand=void 0,this._classifiedCommand=void 0,this._translucentCommand=void 0,this._clearColorCommand=new ri({color:new j(0,0,0,0),owner:this}),this._clearCommand=new ri({color:new j(0,0,0,0),depth:1,stencil:0});let e=this;this._uniformMap={colorTexture:function(){return e._fbo.getColorTexture()},depthTexture:function(){return e._depthStencilTexture},classifiedTexture:function(){return e._fboClassified.getColorTexture()}}}Object.defineProperties(um.prototype,{unclassifiedCommand:{get:function(){return this._unclassifiedCommand}}});um.isTranslucencySupported=function(e){return e.depthTexture&&e.fragmentDepth};var Hpt={depthMask:!1,stencilTest:{enabled:!0,frontFunction:Un.EQUAL,frontOperation:{fail:ft.KEEP,zFail:ft.KEEP,zPass:ft.KEEP},backFunction:Un.NEVER,reference:0,mask:Ut.CLASSIFICATION_MASK},blending:hn.ALPHA_BLEND},Gpt={depthMask:!1,stencilTest:{enabled:!0,frontFunction:Un.NOT_EQUAL,frontOperation:{fail:ft.KEEP,zFail:ft.KEEP,zPass:ft.KEEP},backFunction:Un.NEVER,reference:0,mask:Ut.CLASSIFICATION_MASK},blending:hn.ALPHA_BLEND},jpt={depthMask:!0,depthTest:{enabled:!0},stencilTest:Ut.setCesium3DTileBit(),stencilMask:Ut.CESIUM_3D_TILE_MASK,blending:hn.ALPHA_BLEND},Wpt=`uniform sampler2D colorTexture;
uniform sampler2D depthTexture;
uniform sampler2D classifiedTexture;
in vec2 v_textureCoordinates;
void main()
{
    vec4 color = texture(colorTexture, v_textureCoordinates);
    if (color.a == 0.0)
    {
        discard;
    }
    bool isClassified = all(equal(texture(classifiedTexture, v_textureCoordinates), vec4(0.0)));
#ifdef UNCLASSIFIED
    vec4 highlightColor = czm_invertClassificationColor;
    if (isClassified)
    {
        discard;
    }
#else
    vec4 highlightColor = vec4(1.0);
    if (!isClassified)
    {
        discard;
    }
#endif
    out_FragColor = color * highlightColor;
    gl_FragDepth = texture(depthTexture, v_textureCoordinates).r;
}
`,qpt=`uniform sampler2D colorTexture;
in vec2 v_textureCoordinates;
void main()
{
    vec4 color = texture(colorTexture, v_textureCoordinates);
    if (color.a == 0.0)
    {
        discard;
    }
#ifdef UNCLASSIFIED
    out_FragColor = color * czm_invertClassificationColor;
#else
    out_FragColor = color;
#endif
}
`;um.prototype.update=function(e,t,n){let i=this._fbo.getColorTexture(),o=this.previousFramebuffer!==this._previousFramebuffer;this._previousFramebuffer=this.previousFramebuffer;let r=this._numSamples!==t,s=e.drawingBufferWidth,a=e.drawingBufferHeight,l=!c(i)||i.width!==s||i.height!==a;if((l||o||r)&&(this._numSamples=t,this._depthStencilTexture=this._depthStencilTexture&&this._depthStencilTexture.destroy(),this._depthStencilRenderbuffer=this._depthStencilRenderbuffer&&this._depthStencilRenderbuffer.destroy(),c(this._previousFramebuffer)||(this._depthStencilTexture=new Lt({context:e,width:s,height:a,pixelFormat:Ve.DEPTH_STENCIL,pixelDatatype:Be.UNSIGNED_INT_24_8}),t>1&&(this._depthStencilRenderbuffer=new id({context:e,width:s,height:a,format:al.DEPTH24_STENCIL8,numSamples:t})))),!c(this._fbo.framebuffer)||l||o||r){this._fbo.destroy(),this._fboClassified.destroy();let u,f;c(this._previousFramebuffer)?(u=n.getDepthStencilTexture(),f=n.getDepthStencilRenderbuffer()):(u=this._depthStencilTexture,f=this._depthStencilRenderbuffer),this._fbo.setDepthStencilTexture(u),c(f)&&this._fbo.setDepthStencilRenderbuffer(f),this._fbo.update(e,s,a,t),c(this._previousFramebuffer)||(this._fboClassified.setDepthStencilTexture(u),this._fboClassified.update(e,s,a))}if(c(this._rsUnclassified)||(this._rsUnclassified=ze.fromCache(Hpt),this._rsClassified=ze.fromCache(Gpt),this._rsDefault=ze.fromCache(jpt)),!c(this._unclassifiedCommand)||o||r){c(this._unclassifiedCommand)&&(this._unclassifiedCommand.shaderProgram=this._unclassifiedCommand.shaderProgram&&this._unclassifiedCommand.shaderProgram.destroy(),this._classifiedCommand.shaderProgram=this._classifiedCommand.shaderProgram&&this._classifiedCommand.shaderProgram.destroy());let u=c(this._previousFramebuffer)?qpt:Wpt,f=new Ge({defines:["UNCLASSIFIED"],sources:[u]}),d=new Ge({sources:[u]});this._unclassifiedCommand=e.createViewportQuadCommand(f,{renderState:c(this._previousFramebuffer)?this._rsUnclassified:this._rsDefault,uniformMap:this._uniformMap,owner:this}),this._classifiedCommand=e.createViewportQuadCommand(d,{renderState:c(this._previousFramebuffer)?this._rsClassified:this._rsDefault,uniformMap:this._uniformMap,owner:this}),c(this._translucentCommand)&&(this._translucentCommand.shaderProgram=this._translucentCommand.shaderProgram&&this._translucentCommand.shaderProgram.destroy()),c(this._previousFramebuffer)||(this._translucentCommand=e.createViewportQuadCommand(Df,{renderState:this._rsUnclassified,uniformMap:this._uniformMap,owner:this}))}};um.prototype.prepareTextures=function(e,t){this._fbo._numSamples>1&&this._fbo.prepareTextures(e,t)};um.prototype.clear=function(e,t){c(this._previousFramebuffer)?this._fbo.clear(e,this._clearColorCommand,t):(this._fbo.clear(e,this._clearCommand,t),this._fboClassified.clear(e,this._clearCommand,t))};um.prototype.executeClassified=function(e,t){if(!c(this._previousFramebuffer)){let n=t.framebuffer;this.prepareTextures(e,!0),t.framebuffer=this._fboClassified.framebuffer,this._translucentCommand.execute(e,t),t.framebuffer=n}this._classifiedCommand.execute(e,t)};um.prototype.executeUnclassified=function(e,t){this._unclassifiedCommand.execute(e,t)};um.prototype.isDestroyed=function(){return!1};um.prototype.destroy=function(){return this._fbo.destroy(),this._fboClassified.destroy(),this._depthStencilTexture=this._depthStencilTexture&&this._depthStencilTexture.destroy(),this._depthStencilRenderbuffer=this._depthStencilRenderbuffer&&this._depthStencilRenderbuffer.destroy(),c(this._unclassifiedCommand)&&(this._unclassifiedCommand.shaderProgram=this._unclassifiedCommand.shaderProgram&&this._unclassifiedCommand.shaderProgram.destroy(),this._classifiedCommand.shaderProgram=this._classifiedCommand.shaderProgram&&this._classifiedCommand.shaderProgram.destroy()),de(this)};var kN=um;function VN(e){this._total=e,this.usedThisFrame=0,this.stolenFromMeThisFrame=0,this.starvedThisFrame=!1,this.starvedLastFrame=!1}Object.defineProperties(VN.prototype,{total:{get:function(){return this._total}}});function gy(e){if(c(e)&&e.length!==Ha.NUMBER_OF_JOB_TYPES)throw new E("A budget must be specified for each job type; budgets.length should equal JobType.NUMBER_OF_JOB_TYPES.");let t=new Array(Ha.NUMBER_OF_JOB_TYPES);t[Ha.TEXTURE]=new VN(c(e)?e[Ha.TEXTURE]:10),t[Ha.PROGRAM]=new VN(c(e)?e[Ha.PROGRAM]:10),t[Ha.BUFFER]=new VN(c(e)?e[Ha.BUFFER]:30);let n=t.length,i,o=0;for(i=0;i<n;++i)o+=t[i].total;let r=new Array(n);for(i=0;i<n;++i)r[i]=!1;this._totalBudget=o,this._totalUsedThisFrame=0,this._budgets=t,this._executedThisFrame=r}gy.getTimestamp=Ei;Object.defineProperties(gy.prototype,{totalBudget:{get:function(){return this._totalBudget}}});gy.prototype.disableThisFrame=function(){this._totalUsedThisFrame=this._totalBudget};gy.prototype.resetBudgets=function(){let e=this._budgets,t=e.length;for(let n=0;n<t;++n){let i=e[n];i.starvedLastFrame=i.starvedThisFrame,i.starvedThisFrame=!1,i.usedThisFrame=0,i.stolenFromMeThisFrame=0}this._totalUsedThisFrame=0};gy.prototype.execute=function(e,t){let n=this._budgets,i=n[t],o=this._executedThisFrame[t];if(this._totalUsedThisFrame>=this._totalBudget&&o)return i.starvedThisFrame=!0,!1;let r;if(i.usedThisFrame+i.stolenFromMeThisFrame>=i.total){let l=n.length,u;for(u=0;u<l&&(r=n[u],!(r.usedThisFrame+r.stolenFromMeThisFrame<r.total&&!r.starvedLastFrame));++u);if(u===l&&o)return!1;o&&(i.starvedThisFrame=!0)}let s=gy.getTimestamp();e.execute();let a=gy.getTimestamp()-s;return this._totalUsedThisFrame+=a,r?r.stolenFromMeThisFrame+=a:i.usedThisFrame+=a,this._executedThisFrame[t]=!0,!0};var PY=gy;var gbe=Object.freeze({UNLOADED:0,RECEIVING:1,RECEIVED:2,LOADED:3,FAILED:4,UNAVAILABLE:5});function UN(e,t){this.spatialNode=e,this.keyframe=t,this.state=gbe.UNLOADED,this.metadata=[],this.megatextureIndex=-1,this.priority=-Number.MAX_VALUE,this.highPriorityFrameNumber=-1}UN.priorityComparator=function(e,t){return e.priority-t.priority};UN.searchComparator=function(e,t){return e.keyframe-t.keyframe};UN.LoadState=gbe;var no=UN;function ybe(){}Object.defineProperties(ybe.prototype,{color:{get:E.throwInstantiationError},intensity:{get:E.throwInstantiationError}});var Ypt=ybe;var Xpt=/\/$/,bbe=new Pt('&copy; <a href="https://www.mapbox.com/about/maps/">Mapbox</a> &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> <strong><a href="https://www.mapbox.com/map-feedback/">Improve this map</a></strong>');function FC(e){e=y(e,y.EMPTY_OBJECT);let t=e.styleId;if(!c(t))throw new E("options.styleId is required.");let n=e.accessToken;if(!c(n))throw new E("options.accessToken is required.");this._defaultAlpha=void 0,this._defaultNightAlpha=void 0,this._defaultDayAlpha=void 0,this._defaultBrightness=void 0,this._defaultContrast=void 0,this._defaultHue=void 0,this._defaultSaturation=void 0,this._defaultGamma=void 0,this._defaultMinificationFilter=void 0,this._defaultMagnificationFilter=void 0;let i=De.createIfNeeded(y(e.url,"https://api.mapbox.com/styles/v1/"));this._styleId=t,this._accessToken=n;let o=y(e.tilesize,512);this._tilesize=o;let r=y(e.username,"mapbox");this._username=r;let s=c(e.scaleFactor)?"@2x":"",a=i.getUrlComponent();Xpt.test(a)||(a+="/"),a+=`${this._username}/${t}/tiles/${this._tilesize}/{z}/{x}/{y}${s}`,i.url=a,i.setQueryParameters({access_token:n});let l;c(e.credit)?(l=e.credit,typeof l=="string"&&(l=new Pt(l))):l=bbe,this._resource=i,this._imageryProvider=new Lc({url:i,credit:l,ellipsoid:e.ellipsoid,minimumLevel:e.minimumLevel,maximumLevel:e.maximumLevel,rectangle:e.rectangle})}Object.defineProperties(FC.prototype,{url:{get:function(){return this._imageryProvider.url}},rectangle:{get:function(){return this._imageryProvider.rectangle}},tileWidth:{get:function(){return this._imageryProvider.tileWidth}},tileHeight:{get:function(){return this._imageryProvider.tileHeight}},maximumLevel:{get:function(){return this._imageryProvider.maximumLevel}},minimumLevel:{get:function(){return this._imageryProvider.minimumLevel}},tilingScheme:{get:function(){return this._imageryProvider.tilingScheme}},tileDiscardPolicy:{get:function(){return this._imageryProvider.tileDiscardPolicy}},errorEvent:{get:function(){return this._imageryProvider.errorEvent}},credit:{get:function(){return this._imageryProvider.credit}},proxy:{get:function(){return this._imageryProvider.proxy}},hasAlphaChannel:{get:function(){return this._imageryProvider.hasAlphaChannel}}});FC.prototype.getTileCredits=function(e,t,n){};FC.prototype.requestImage=function(e,t,n,i){return this._imageryProvider.requestImage(e,t,n,i)};FC.prototype.pickFeatures=function(e,t,n,i,o){return this._imageryProvider.pickFeatures(e,t,n,i,o)};FC._defaultCredit=bbe;var Kpt=FC;function yy(e,t,n,i,o){i===Gt.UNSIGNED_SHORT&&(i=Gt.FLOAT32);let r=e.floatingPointTexture;if(i===Gt.FLOAT32&&!r)throw new ue("Floating point texture not supported");let s;i===Gt.FLOAT32||i===Gt.FLOAT64?s=Be.FLOAT:i===Gt.UINT8&&(s=Be.UNSIGNED_BYTE);let a;n===1?a=e.webgl2?Ve.RED:Ve.LUMINANCE:n===2?a=e.webgl2?Ve.RG:Ve.LUMINANCE_ALPHA:n===3?a=Ve.RGB:n===4&&(a=Ve.RGBA);let l=512*1024*1024,u=128*1024*1024;o=Math.min(y(o,u),l);let f=mt.maximumTextureSize,d=Gt.getSizeInBytes(i),p=Math.floor(o/(n*d)),g=Math.min(f,R.previousPowerOfTwo(Math.floor(Math.sqrt(p)))),m=Math.ceil(Math.sqrt(t.x)),b=Math.ceil(t.z/m),x=m*t.x,T=b*t.y,C=Math.floor(g/x),S=Math.floor(g/T);if(C===0||S===0)throw new ue("Tileset is too large to fit into megatexture");this.channelCount=n,this.componentType=i,this.voxelCountPerTile=h.clone(t,new h),this.maximumTileCount=C*S,this.regionCountPerMegatexture=new H(C,S),this.voxelCountPerRegion=new H(x,T),this.sliceCountPerRegion=new H(m,b),this.voxelSizeUv=new H(1/g,1/g),this.sliceSizeUv=new H(t.x/g,t.y/g),this.regionSizeUv=new H(x/g,T/g),this.texture=new Lt({context:e,pixelFormat:a,pixelDatatype:s,flipY:!1,width:g,height:g,sampler:new Qt({wrapS:yn.CLAMP_TO_EDGE,wrapT:yn.CLAMP_TO_EDGE,minificationFilter:$t.LINEAR,magnificationFilter:fi.LINEAR})});let v=Gt.toComponentDatatype(i);this.tileVoxelDataTemp=$.createTypedArray(v,x*T*n),this.nodes=new Array(this.maximumTileCount);for(let D=0;D<this.maximumTileCount;D++)this.nodes[D]=new $pt(D);for(let D=0;D<this.maximumTileCount;D++){let I=this.nodes[D];I.previousNode=D>0?this.nodes[D-1]:void 0,I.nextNode=D<this.maximumTileCount-1?this.nodes[D+1]:void 0}this.occupiedList=void 0,this.emptyList=this.nodes[0],this.occupiedCount=0}function $pt(e){this.index=e,this.nextNode=void 0,this.previousNode=void 0}yy.prototype.add=function(e){if(this.isFull())throw new E("Trying to add when there are no empty spots");let t=this.emptyList;this.emptyList=this.emptyList.nextNode,c(this.emptyList)&&(this.emptyList.previousNode=void 0),t.nextNode=this.occupiedList,c(t.nextNode)&&(t.nextNode.previousNode=t),this.occupiedList=t;let n=t.index;return this.writeDataToTexture(n,e),this.occupiedCount++,n};yy.prototype.remove=function(e){if(e<0||e>=this.maximumTileCount)throw new E("Megatexture index out of bounds");let t=this.nodes[e];c(t.previousNode)&&(t.previousNode.nextNode=t.nextNode),c(t.nextNode)&&(t.nextNode.previousNode=t.previousNode),t.nextNode=this.emptyList,c(t.nextNode)&&(t.nextNode.previousNode=t),t.previousNode=void 0,this.emptyList=t,this.occupiedCount--};yy.prototype.isFull=function(){return this.emptyList===void 0};yy.getApproximateTextureMemoryByteLength=function(e,t,n,i){i===Gt.UNSIGNED_SHORT&&(i=Gt.FLOAT32);let o=Gt.getSizeInBytes(i),r=e*t.x*t.y*t.z,s=Math.ceil(Math.sqrt(t.x)),a=Math.ceil(t.z/s),l=s*t.x,u=a*t.y,f=R.previousPowerOfTwo(Math.floor(Math.sqrt(r)));for(;;){let p=Math.floor(f/l),g=Math.floor(f/u);if(p*g>=e)break;f*=2}return f*f*n*o};yy.prototype.writeDataToTexture=function(e,t){let n=t.constructor===Uint16Array?new Float32Array(t):t,i=this.voxelCountPerTile,o=this.sliceCountPerRegion,r=this.voxelCountPerRegion,s=this.channelCount,a=this.tileVoxelDataTemp;for(let b=0;b<i.z;b++){let x=b%o.x*i.x,T=Math.floor(b/o.x)*i.y;for(let C=0;C<i.y;C++)for(let S=0;S<i.x;S++){let v=b*i.y*i.x+C*i.x+S,D=(T+C)*r.x+(x+S);for(let I=0;I<s;I++)a[D*s+I]=n[v*s+I]}}let l=this.regionCountPerMegatexture,u=r.x,f=r.y,d=e%l.x*r.x,p=Math.floor(e/l.x)*r.y,m={source:{arrayBufferView:a,width:u,height:f},xOffset:d,yOffset:p};this.texture.copyFrom(m)};yy.prototype.isDestroyed=function(){return!1};yy.prototype.destroy=function(){return this.texture=this.texture&&this.texture.destroy(),de(this)};var zN=yy;var Fc={};Fc.decodeRawMetadataValue=function(e,t,n){switch(e){case Gt.INT8:return t.getInt8(n);case Gt.UINT8:return t.getUint8(n);case Gt.INT16:return t.getInt16(n);case Gt.UINT16:return t.getUint16(n);case Gt.INT32:return t.getInt32(n);case Gt.UINT32:return t.getUint32(n);case Gt.INT64:return t.getBigInt64(n);case Gt.UINT64:return t.getBigUint64(n);case Gt.FLOAT32:return t.getFloat32(n);case Gt.FLOAT64:return t.getFloat64(n)}throw new ue(`Invalid component type: ${e}`)};Fc.decodeRawMetadataValueComponent=function(e,t,n){let i=e.componentType,o=Fc.decodeRawMetadataValue(i,t,n);return e.normalized?Gt.normalize(o,i):o};Fc.decodeRawMetadataValueElement=function(e,t,n){let i=e.componentType,o=Gt.getSizeInBytes(i),r=e.type,s=Et.getComponentCount(r),a=o*s;if(s>1){let f=Array(s);for(let d=0;d<s;d++){let p=n*a+d*o,g=Fc.decodeRawMetadataValueComponent(e,t,p);f[d]=g}return f}let l=n*a;return Fc.decodeRawMetadataValueComponent(e,t,l)};Fc.decodeRawMetadataValues=function(e,t){let n=new DataView(t.buffer,t.byteOffset,t.byteLength);if(e.isArray){let o=e.arrayLength,r=Array(o);for(let s=0;s<o;s++){let a=Fc.decodeRawMetadataValueElement(e,n,s);r[s]=a}return r}return Fc.decodeRawMetadataValueElement(e,n,0)};Fc.convertToObjectType=function(e,t){if(!c(t)||e===Et.SCALAR||e===Et.STRING||e===Et.BOOLEAN||e===Et.ENUM)return t;let n=t.map(i=>Number(i));switch(e){case Et.VEC2:return H.unpack(n,0,new H);case Et.VEC3:return h.unpack(n,0,new h);case Et.VEC4:return se.unpack(n,0,new h);case Et.MAT2:return Gi.unpack(n,0,new Gi);case Et.MAT3:return Q.unpack(n,0,new Q);case Et.MAT4:return k.unpack(n,0,new k)}return t};Fc.decodeMetadataValues=function(e,t){let n=Fc.decodeRawMetadataValues(e,t);if(e.isArray){let o=e.arrayLength,r=Array(o);for(let s=0;s<o;s++){let a=n[s],l=Fc.convertToObjectType(e.type,a);r[s]=l}return r}return Fc.convertToObjectType(e.type,n)};var IY=Object.freeze(Fc);function oP(e){e=y(e,y.EMPTY_OBJECT);let t=e.textureUrl;c(t)||(t=sn("Assets/Textures/moonSmall.jpg")),this.show=y(e.show,!0),this.textureUrl=t,this._ellipsoid=y(e.ellipsoid,ie.MOON),this.onlySunLighting=y(e.onlySunLighting,!0),this._ellipsoidPrimitive=new O7({radii:this.ellipsoid.radii,material:Ki.fromType(Ki.ImageType),depthTestEnabled:!1,_owner:this}),this._ellipsoidPrimitive.material.translucent=!1,this._axes=new wW}Object.defineProperties(oP.prototype,{ellipsoid:{get:function(){return this._ellipsoid}}});var HN=new Q,Zpt=new Q,Jpt=new h,GN=[];oP.prototype.update=function(e){if(!this.show)return;let t=this._ellipsoidPrimitive;t.material.uniforms.image=this.textureUrl,t.onlySunLighting=this.onlySunLighting;let n=e.time;c(Ft.computeIcrfToFixedMatrix(n,HN))||Ft.computeTemeToPseudoFixedMatrix(n,HN);let i=this._axes.evaluate(n,Zpt);Q.transpose(i,i),Q.multiply(HN,i,i);let o=hC.computeMoonPositionInEarthInertialFrame(n,Jpt);Q.multiplyByVector(HN,o,o),k.fromRotationTranslation(i,o,t.modelMatrix);let r=e.commandList;return e.commandList=GN,GN.length=0,t.update(e),e.commandList=r,GN.length===1?GN[0]:void 0};oP.prototype.isDestroyed=function(){return!1};oP.prototype.destroy=function(){return this._ellipsoidPrimitive=this._ellipsoidPrimitive&&this._ellipsoidPrimitive.destroy(),de(this)};var OY=oP;function RY(e){}RY.prototype.isReady=function(){return!0};RY.prototype.shouldDiscardImage=function(e){return!1};var Qpt=RY;var jN=`#ifdef MRT
layout (location = 0) out vec4 out_FragData_0;
layout (location = 1) out vec4 out_FragData_1;
#else
layout (location = 0) out vec4 out_FragColor;
#endif
uniform vec4 u_bgColor;
uniform sampler2D u_depthTexture;
in vec2 v_textureCoordinates;
void main()
{
if (texture(u_depthTexture, v_textureCoordinates).r < 1.0)
{
#ifdef MRT
out_FragData_0 = u_bgColor;
out_FragData_1 = vec4(u_bgColor.a);
#else
out_FragColor = u_bgColor;
#endif
return;
}
discard;
}
`;var MY=`uniform sampler2D u_opaque;
uniform sampler2D u_accumulation;
uniform sampler2D u_revealage;
in vec2 v_textureCoordinates;
void main()
{
vec4 opaque = texture(u_opaque, v_textureCoordinates);
vec4 accum = texture(u_accumulation, v_textureCoordinates);
float r = texture(u_revealage, v_textureCoordinates).r;
#ifdef MRT
vec4 transparent = vec4(accum.rgb / clamp(r, 1e-4, 5e4), accum.a);
#else
vec4 transparent = vec4(accum.rgb / clamp(accum.a, 1e-4, 5e4), r);
#endif
out_FragColor = (1.0 - transparent.a) * transparent + transparent.a * opaque;
if (opaque != czm_backgroundColor)
{
out_FragColor.a = 1.0;
}
}
`;function o_(e){this._numSamples=1,this._translucentMultipassSupport=!1,this._translucentMRTSupport=!1;let t=e.colorBufferFloat&&e.depthTexture&&e.floatBlend;this._translucentMRTSupport=e.drawBuffers&&t,this._translucentMultipassSupport=!this._translucentMRTSupport&&t,this._opaqueFBO=void 0,this._opaqueTexture=void 0,this._depthStencilTexture=void 0,this._accumulationTexture=void 0,this._translucentFBO=new gi({colorAttachmentsLength:this._translucentMRTSupport?2:1,createColorAttachments:!1,createDepthAttachments:!1,depth:!0}),this._alphaFBO=new gi({createColorAttachments:!1,createDepthAttachments:!1,depth:!0}),this._adjustTranslucentFBO=new gi({colorAttachmentsLength:this._translucentMRTSupport?2:1,createColorAttachments:!1}),this._adjustAlphaFBO=new gi({createColorAttachments:!1}),this._opaqueClearCommand=new ri({color:new j(0,0,0,0),owner:this}),this._translucentMRTClearCommand=new ri({color:new j(0,0,0,1),owner:this}),this._translucentMultipassClearCommand=new ri({color:new j(0,0,0,0),owner:this}),this._alphaClearCommand=new ri({color:new j(1,1,1,1),owner:this}),this._translucentRenderStateCache={},this._alphaRenderStateCache={},this._compositeCommand=void 0,this._adjustTranslucentCommand=void 0,this._adjustAlphaCommand=void 0,this._viewport=new Ke,this._rs=void 0,this._useScissorTest=!1,this._scissorRectangle=void 0,this._useHDR=!1}function xbe(e){e._accumulationTexture=e._accumulationTexture&&!e._accumulationTexture.isDestroyed()&&e._accumulationTexture.destroy(),e._revealageTexture=e._revealageTexture&&!e._revealageTexture.isDestroyed()&&e._revealageTexture.destroy()}function LY(e){e._translucentFBO.destroy(),e._alphaFBO.destroy(),e._adjustTranslucentFBO.destroy(),e._adjustAlphaFBO.destroy()}function Tbe(e){xbe(e),LY(e)}function e_t(e,t,n,i){xbe(e),e._accumulationTexture=new Lt({context:t,width:n,height:i,pixelFormat:Ve.RGBA,pixelDatatype:Be.FLOAT}),e._revealageTexture=new Lt({context:t,pixelFormat:Ve.RGBA,pixelDatatype:Be.FLOAT,width:n,height:i,flipY:!1})}function t_t(e,t){LY(e);let n=ne.FRAMEBUFFER_COMPLETE,i=!0,{width:o,height:r}=e._accumulationTexture;if(e._translucentMRTSupport&&(e._translucentFBO.setColorTexture(e._accumulationTexture,0),e._translucentFBO.setColorTexture(e._revealageTexture,1),e._translucentFBO.setDepthStencilTexture(e._depthStencilTexture),e._translucentFBO.update(t,o,r),e._adjustTranslucentFBO.setColorTexture(e._accumulationTexture,0),e._adjustTranslucentFBO.setColorTexture(e._revealageTexture,1),e._adjustTranslucentFBO.update(t,o,r),(e._translucentFBO.status!==n||e._adjustTranslucentFBO.status!==n)&&(LY(e),e._translucentMRTSupport=!1)),!e._translucentMRTSupport){e._translucentFBO.setColorTexture(e._accumulationTexture),e._translucentFBO.setDepthStencilTexture(e._depthStencilTexture),e._translucentFBO.update(t,o,r),e._alphaFBO.setColorTexture(e._revealageTexture),e._alphaFBO.setDepthStencilTexture(e._depthStencilTexture),e._alphaFBO.update(t,o,r),e._adjustTranslucentFBO.setColorTexture(e._accumulationTexture),e._adjustTranslucentFBO.update(t,o,r),e._adjustAlphaFBO.setColorTexture(e._revealageTexture),e._adjustAlphaFBO.update(t,o,r);let s=e._translucentFBO.status===n,a=e._alphaFBO.status===n,l=e._adjustTranslucentFBO.status===n,u=e._adjustAlphaFBO.status===n;(!s||!a||!l||!u)&&(Tbe(e),e._translucentMultipassSupport=!1,i=!1)}return i}o_.prototype.update=function(e,t,n,i,o){if(!this.isSupported())return;this._opaqueFBO=n,this._opaqueTexture=n.getColorTexture(0),this._depthStencilTexture=n.getDepthStencilTexture();let{width:r,height:s}=this._opaqueTexture,a=this._accumulationTexture,l=!c(a)||a.width!==r||a.height!==s||i!==this._useHDR,u=this._numSamples!==o;if((l||u)&&(this._numSamples=o,e_t(this,e,r,s)),(!c(this._translucentFBO.framebuffer)||l||u)&&!t_t(this,e))return;this._useHDR=i;let f=this,d,p;c(this._compositeCommand)||(d=new Ge({sources:[MY]}),this._translucentMRTSupport&&d.defines.push("MRT"),p={u_opaque:function(){return f._opaqueTexture},u_accumulation:function(){return f._accumulationTexture},u_revealage:function(){return f._revealageTexture}},this._compositeCommand=e.createViewportQuadCommand(d,{uniformMap:p,owner:this})),c(this._adjustTranslucentCommand)||(this._translucentMRTSupport?(d=new Ge({defines:["MRT"],sources:[jN]}),p={u_bgColor:function(){return f._translucentMRTClearCommand.color},u_depthTexture:function(){return f._depthStencilTexture}},this._adjustTranslucentCommand=e.createViewportQuadCommand(d,{uniformMap:p,owner:this})):this._translucentMultipassSupport&&(d=new Ge({sources:[jN]}),p={u_bgColor:function(){return f._translucentMultipassClearCommand.color},u_depthTexture:function(){return f._depthStencilTexture}},this._adjustTranslucentCommand=e.createViewportQuadCommand(d,{uniformMap:p,owner:this}),p={u_bgColor:function(){return f._alphaClearCommand.color},u_depthTexture:function(){return f._depthStencilTexture}},this._adjustAlphaCommand=e.createViewportQuadCommand(d,{uniformMap:p,owner:this}))),this._viewport.width=r,this._viewport.height=s;let g=!Ke.equals(this._viewport,t.viewport),m=g!==this._useScissorTest;this._useScissorTest=g,Ke.equals(this._scissorRectangle,t.viewport)||(this._scissorRectangle=Ke.clone(t.viewport,this._scissorRectangle),m=!0),(!c(this._rs)||!Ke.equals(this._viewport,this._rs.viewport)||m)&&(this._rs=ze.fromCache({viewport:this._viewport,scissorTest:{enabled:this._useScissorTest,rectangle:this._scissorRectangle}})),c(this._compositeCommand)&&(this._compositeCommand.renderState=this._rs),this._adjustTranslucentCommand&&(this._adjustTranslucentCommand.renderState=this._rs),c(this._adjustAlphaCommand)&&(this._adjustAlphaCommand.renderState=this._rs)};var n_t={enabled:!0,color:new j(0,0,0,0),equationRgb:fc.ADD,equationAlpha:fc.ADD,functionSourceRgb:Do.ONE,functionDestinationRgb:Do.ONE,functionSourceAlpha:Do.ZERO,functionDestinationAlpha:Do.ONE_MINUS_SOURCE_ALPHA},i_t={enabled:!0,color:new j(0,0,0,0),equationRgb:fc.ADD,equationAlpha:fc.ADD,functionSourceRgb:Do.ONE,functionDestinationRgb:Do.ONE,functionSourceAlpha:Do.ONE,functionDestinationAlpha:Do.ONE},o_t={enabled:!0,color:new j(0,0,0,0),equationRgb:fc.ADD,equationAlpha:fc.ADD,functionSourceRgb:Do.ZERO,functionDestinationRgb:Do.ONE_MINUS_SOURCE_ALPHA,functionSourceAlpha:Do.ZERO,functionDestinationAlpha:Do.ONE_MINUS_SOURCE_ALPHA};function NY(e,t,n,i){let o=n[i.id];if(!c(o)){let r=ze.getState(i);r.depthMask=!1,r.blending=t,o=ze.fromCache(r),n[i.id]=o}return o}function r_t(e,t,n){return NY(t,n_t,e._translucentRenderStateCache,n)}function s_t(e,t,n){return NY(t,i_t,e._translucentRenderStateCache,n)}function a_t(e,t,n){return NY(t,o_t,e._alphaRenderStateCache,n)}var c_t=`    vec3 Ci = czm_out_FragColor.rgb * czm_out_FragColor.a;
    float ai = czm_out_FragColor.a;
    float wzi = czm_alphaWeight(ai);
    out_FragData_0 = vec4(Ci * wzi, ai);
    out_FragData_1 = vec4(ai * wzi);
`,l_t=`    vec3 Ci = czm_out_FragColor.rgb * czm_out_FragColor.a;
    float ai = czm_out_FragColor.a;
    float wzi = czm_alphaWeight(ai);
    out_FragColor = vec4(Ci, ai) * wzi;
`,u_t=`    float ai = czm_out_FragColor.a;
    out_FragColor = vec4(ai);
`;function FY(e,t,n,i){let{shaderCache:o}=e,r=o.getDerivedShaderProgram(t,n);if(c(r))return r;let s=t._attributeLocations,a=t.fragmentShaderSource.clone();a.sources=a.sources.map(function(f){return Ge.replaceMain(f,"czm_translucent_main").replace(/out_FragColor/g,"czm_out_FragColor").replace(/layout\s*\(location\s*=\s*0\)\s*out\s+vec4\s+out_FragColor;/g,"").replace(/\bdiscard\b/g,"czm_discard = true").replace(/czm_phong/g,"czm_translucentPhong")}),a.sources.splice(0,0,`vec4 czm_out_FragColor;
bool czm_discard = false;
`);let l=[...i.matchAll(/out_FragData_(\d+)/g)],u="";for(let f=0;f<l.length;f++){let d=l[f];u=`layout (location = ${d[1]}) out vec4 ${d[0]};
${u}`}return a.sources.push(u),a.sources.push(`void main()
{
    czm_translucent_main();
    if (czm_discard)
    {
        discard;
    }
${i}}
`),o.createDerivedShaderProgram(t,n,{vertexShaderSource:t.vertexShaderSource,fragmentShaderSource:a,attributeLocations:s})}function f_t(e,t){return FY(e,t,"translucentMRT",c_t)}function d_t(e,t){return FY(e,t,"translucentMultipass",l_t)}function h_t(e,t){return FY(e,t,"alphaMultipass",u_t)}o_.prototype.createDerivedCommands=function(e,t,n){if(c(n)||(n={}),this._translucentMRTSupport){let a,l;return c(n.translucentCommand)&&(a=n.translucentCommand.shaderProgram,l=n.translucentCommand.renderState),n.translucentCommand=et.shallowClone(e,n.translucentCommand),!c(a)||n.shaderProgramId!==e.shaderProgram.id?(n.translucentCommand.shaderProgram=f_t(t,e.shaderProgram),n.translucentCommand.renderState=r_t(this,t,e.renderState),n.shaderProgramId=e.shaderProgram.id):(n.translucentCommand.shaderProgram=a,n.translucentCommand.renderState=l),n}let i,o,r,s;return c(n.translucentCommand)&&(i=n.translucentCommand.shaderProgram,o=n.translucentCommand.renderState,r=n.alphaCommand.shaderProgram,s=n.alphaCommand.renderState),n.translucentCommand=et.shallowClone(e,n.translucentCommand),n.alphaCommand=et.shallowClone(e,n.alphaCommand),!c(i)||n.shaderProgramId!==e.shaderProgram.id?(n.translucentCommand.shaderProgram=d_t(t,e.shaderProgram),n.translucentCommand.renderState=s_t(this,t,e.renderState),n.alphaCommand.shaderProgram=h_t(t,e.shaderProgram),n.alphaCommand.renderState=a_t(this,t,e.renderState),n.shaderProgramId=e.shaderProgram.id):(n.translucentCommand.shaderProgram=i,n.translucentCommand.renderState=o,n.alphaCommand.shaderProgram=r,n.alphaCommand.renderState=s),n};function m_t(e,t,n,i,o,r){let{context:s,frameState:a}=t,{useLogDepth:l,shadowState:u}=a,f=t._hdr,d=i.framebuffer,p=u.lightShadowsEnabled;i.framebuffer=e._adjustTranslucentFBO.framebuffer,e._adjustTranslucentCommand.execute(s,i),i.framebuffer=e._adjustAlphaFBO.framebuffer,e._adjustAlphaCommand.execute(s,i);let g=e._opaqueFBO.framebuffer;i.framebuffer=e._translucentFBO.framebuffer;for(let m=0;m<o.length;++m){let b=o[m];b=l?b.derivedCommands.logDepth.command:b,b=f?b.derivedCommands.hdr.command:b;let x=p&&b.receiveShadows?b.derivedCommands.oit.shadows.translucentCommand:b.derivedCommands.oit.translucentCommand;n(x,t,i,g)}if(c(r)){let m=r.unclassifiedCommand,b=p&&m.receiveShadows?m.derivedCommands.oit.shadows.translucentCommand:m.derivedCommands.oit.translucentCommand;n(b,t,i,g)}i.framebuffer=e._alphaFBO.framebuffer;for(let m=0;m<o.length;++m){let b=o[m];b=l?b.derivedCommands.logDepth.command:b,b=f?b.derivedCommands.hdr.command:b;let x=p&&b.receiveShadows?b.derivedCommands.oit.shadows.alphaCommand:b.derivedCommands.oit.alphaCommand;n(x,t,i,g)}if(c(r)){let m=r.unclassifiedCommand,b=p&&m.receiveShadows?m.derivedCommands.oit.shadows.alphaCommand:m.derivedCommands.oit.alphaCommand;n(b,t,i,g)}i.framebuffer=d}function p_t(e,t,n,i,o,r){let{context:s,frameState:a}=t,{useLogDepth:l,shadowState:u}=a,f=t._hdr,d=i.framebuffer,p=u.lightShadowsEnabled;i.framebuffer=e._adjustTranslucentFBO.framebuffer,e._adjustTranslucentCommand.execute(s,i);let g=e._opaqueFBO.framebuffer;i.framebuffer=e._translucentFBO.framebuffer;for(let m=0;m<o.length;++m){let b=o[m];b=l?b.derivedCommands.logDepth.command:b,b=f?b.derivedCommands.hdr.command:b;let x=p&&b.receiveShadows?b.derivedCommands.oit.shadows.translucentCommand:b.derivedCommands.oit.translucentCommand;n(x,t,i,g)}if(c(r)){let m=r.unclassifiedCommand,b=p&&m.receiveShadows?m.derivedCommands.oit.shadows.translucentCommand:m.derivedCommands.oit.translucentCommand;n(b,t,i,g)}i.framebuffer=d}o_.prototype.executeCommands=function(e,t,n,i,o){if(this._translucentMRTSupport){p_t(this,e,t,n,i,o);return}m_t(this,e,t,n,i,o)};o_.prototype.execute=function(e,t){this._compositeCommand.execute(e,t)};o_.prototype.clear=function(e,t,n){let i=t.framebuffer;t.framebuffer=this._opaqueFBO.framebuffer,j.clone(n,this._opaqueClearCommand.color),this._opaqueClearCommand.execute(e,t),t.framebuffer=this._translucentFBO.framebuffer,(this._translucentMRTSupport?this._translucentMRTClearCommand:this._translucentMultipassClearCommand).execute(e,t),this._translucentMultipassSupport&&(t.framebuffer=this._alphaFBO.framebuffer,this._alphaClearCommand.execute(e,t)),t.framebuffer=i};o_.prototype.isSupported=function(){return this._translucentMRTSupport||this._translucentMultipassSupport};o_.prototype.isDestroyed=function(){return!1};o_.prototype.destroy=function(){return Tbe(this),c(this._compositeCommand)&&(this._compositeCommand.shaderProgram=this._compositeCommand.shaderProgram&&this._compositeCommand.shaderProgram.destroy()),c(this._adjustTranslucentCommand)&&(this._adjustTranslucentCommand.shaderProgram=this._adjustTranslucentCommand.shaderProgram&&this._adjustTranslucentCommand.shaderProgram.destroy()),c(this._adjustAlphaCommand)&&(this._adjustAlphaCommand.shaderProgram=this._adjustAlphaCommand.shaderProgram&&this._adjustAlphaCommand.shaderProgram.destroy()),de(this)};var BY=o_;var __t=new Pt("MapQuest, Open Street Map and contributors, CC-BY-SA");function WN(e){e=y(e,y.EMPTY_OBJECT);let t=De.createIfNeeded(y(e.url,"https://tile.openstreetmap.org/"));t.appendForwardSlash(),t.url+=`{z}/{x}/{y}${e.retinaTiles?"@2x":""}.${y(e.fileExtension,"png")}`;let n=new ys({ellipsoid:e.ellipsoid}),i=256,o=256,r=y(e.minimumLevel,0),s=e.maximumLevel,a=y(e.rectangle,n.rectangle),l=n.positionToTileXY(ae.southwest(a),r),u=n.positionToTileXY(ae.northeast(a),r),f=(Math.abs(u.x-l.x)+1)*(Math.abs(u.y-l.y)+1);if(f>4)throw new E(`The rectangle and minimumLevel indicate that there are ${f} tiles at the minimum level. Imagery providers with more than four tiles at the minimum level are not supported.`);let d=y(e.credit,__t);typeof d=="string"&&(d=new Pt(d)),Lc.call(this,{url:t,credit:d,tilingScheme:n,tileWidth:i,tileHeight:o,minimumLevel:r,maximumLevel:s,rectangle:a})}c(Object.create)&&(WN.prototype=Object.create(Lc.prototype),WN.prototype.constructor=WN);var by=WN;var g_t=new H(1,1);function kY(e){e=y(e,y.EMPTY_OBJECT),this.mass=y(e.mass,1),this.position=h.clone(y(e.position,h.ZERO)),this.velocity=h.clone(y(e.velocity,h.ZERO)),this.life=y(e.life,Number.MAX_VALUE),this.image=e.image,this.startColor=j.clone(y(e.startColor,j.WHITE)),this.endColor=j.clone(y(e.endColor,j.WHITE)),this.startScale=y(e.startScale,1),this.endScale=y(e.endScale,1),this.imageSize=H.clone(y(e.imageSize,g_t)),this._age=0,this._normalizedAge=0,this._billboard=void 0}Object.defineProperties(kY.prototype,{age:{get:function(){return this._age}},normalizedAge:{get:function(){return this._normalizedAge}}});var Abe=new h;kY.prototype.update=function(e,t){return h.multiplyByScalar(this.velocity,e,Abe),h.add(this.position,Abe,this.position),c(t)&&t(this,e),this._age+=e,this.life===Number.MAX_VALUE?this._normalizedAge=0:this._normalizedAge=this._age/this.life,this._age<=this.life};var qN=kY;function Cbe(e){e=y(e,y.EMPTY_OBJECT),this.time=y(e.time,0),this.minimum=y(e.minimum,0),this.maximum=y(e.maximum,50),this._complete=!1}Object.defineProperties(Cbe.prototype,{complete:{get:function(){return this._complete}}});var y_t=Cbe;function Ebe(e){throw new E("This type should not be instantiated directly.  Instead, use BoxEmitter, CircleEmitter, ConeEmitter or SphereEmitter.")}Ebe.prototype.emit=function(e){E.throwInstantiationError()};var b_t=Ebe;var Sbe=new H(1,1);function rP(e){e=y(e,y.EMPTY_OBJECT),this.show=y(e.show,!0),this.updateCallback=e.updateCallback,this.loop=y(e.loop,!0),this.image=y(e.image,void 0);let t=e.emitter;c(t)||(t=new t7(.5)),this._emitter=t,this._bursts=e.bursts,this._modelMatrix=k.clone(y(e.modelMatrix,k.IDENTITY)),this._emitterModelMatrix=k.clone(y(e.emitterModelMatrix,k.IDENTITY)),this._matrixDirty=!0,this._combinedMatrix=new k,this._startColor=j.clone(y(e.color,y(e.startColor,j.WHITE))),this._endColor=j.clone(y(e.color,y(e.endColor,j.WHITE))),this._startScale=y(e.scale,y(e.startScale,1)),this._endScale=y(e.scale,y(e.endScale,1)),this._emissionRate=y(e.emissionRate,5),this._minimumSpeed=y(e.speed,y(e.minimumSpeed,1)),this._maximumSpeed=y(e.speed,y(e.maximumSpeed,1)),this._minimumParticleLife=y(e.particleLife,y(e.minimumParticleLife,5)),this._maximumParticleLife=y(e.particleLife,y(e.maximumParticleLife,5)),this._minimumMass=y(e.mass,y(e.minimumMass,1)),this._maximumMass=y(e.mass,y(e.maximumMass,1)),this._minimumImageSize=H.clone(y(e.imageSize,y(e.minimumImageSize,Sbe))),this._maximumImageSize=H.clone(y(e.imageSize,y(e.maximumImageSize,Sbe))),this._sizeInMeters=y(e.sizeInMeters,!1),this._lifetime=y(e.lifetime,Number.MAX_VALUE),this._billboardCollection=void 0,this._particles=[],this._particlePool=[],this._previousTime=void 0,this._currentTime=0,this._carryOver=0,this._complete=new pe,this._isComplete=!1,this._updateParticlePool=!0,this._particleEstimate=0}Object.defineProperties(rP.prototype,{emitter:{get:function(){return this._emitter},set:function(e){A.defined("value",e),this._emitter=e}},bursts:{get:function(){return this._bursts},set:function(e){this._bursts=e,this._updateParticlePool=!0}},modelMatrix:{get:function(){return this._modelMatrix},set:function(e){A.defined("value",e),this._matrixDirty=this._matrixDirty||!k.equals(this._modelMatrix,e),k.clone(e,this._modelMatrix)}},emitterModelMatrix:{get:function(){return this._emitterModelMatrix},set:function(e){A.defined("value",e),this._matrixDirty=this._matrixDirty||!k.equals(this._emitterModelMatrix,e),k.clone(e,this._emitterModelMatrix)}},startColor:{get:function(){return this._startColor},set:function(e){A.defined("value",e),j.clone(e,this._startColor)}},endColor:{get:function(){return this._endColor},set:function(e){A.defined("value",e),j.clone(e,this._endColor)}},startScale:{get:function(){return this._startScale},set:function(e){A.typeOf.number.greaterThanOrEquals("value",e,0),this._startScale=e}},endScale:{get:function(){return this._endScale},set:function(e){A.typeOf.number.greaterThanOrEquals("value",e,0),this._endScale=e}},emissionRate:{get:function(){return this._emissionRate},set:function(e){A.typeOf.number.greaterThanOrEquals("value",e,0),this._emissionRate=e,this._updateParticlePool=!0}},minimumSpeed:{get:function(){return this._minimumSpeed},set:function(e){A.typeOf.number.greaterThanOrEquals("value",e,0),this._minimumSpeed=e}},maximumSpeed:{get:function(){return this._maximumSpeed},set:function(e){A.typeOf.number.greaterThanOrEquals("value",e,0),this._maximumSpeed=e}},minimumParticleLife:{get:function(){return this._minimumParticleLife},set:function(e){A.typeOf.number.greaterThanOrEquals("value",e,0),this._minimumParticleLife=e}},maximumParticleLife:{get:function(){return this._maximumParticleLife},set:function(e){A.typeOf.number.greaterThanOrEquals("value",e,0),this._maximumParticleLife=e,this._updateParticlePool=!0}},minimumMass:{get:function(){return this._minimumMass},set:function(e){A.typeOf.number.greaterThanOrEquals("value",e,0),this._minimumMass=e}},maximumMass:{get:function(){return this._maximumMass},set:function(e){A.typeOf.number.greaterThanOrEquals("value",e,0),this._maximumMass=e}},minimumImageSize:{get:function(){return this._minimumImageSize},set:function(e){A.typeOf.object("value",e),A.typeOf.number.greaterThanOrEquals("value.x",e.x,0),A.typeOf.number.greaterThanOrEquals("value.y",e.y,0),this._minimumImageSize=e}},maximumImageSize:{get:function(){return this._maximumImageSize},set:function(e){A.typeOf.object("value",e),A.typeOf.number.greaterThanOrEquals("value.x",e.x,0),A.typeOf.number.greaterThanOrEquals("value.y",e.y,0),this._maximumImageSize=e}},sizeInMeters:{get:function(){return this._sizeInMeters},set:function(e){A.typeOf.bool("value",e),this._sizeInMeters=e}},lifetime:{get:function(){return this._lifetime},set:function(e){A.typeOf.number.greaterThanOrEquals("value",e,0),this._lifetime=e}},complete:{get:function(){return this._complete}},isComplete:{get:function(){return this._isComplete}}});function x_t(e){let t=e._emissionRate,n=e._maximumParticleLife,i=0,o=e._bursts;if(c(o)){let d=o.length;for(let p=0;p<d;++p)i+=o[p].maximum}let r=e._billboardCollection,s=e.image,a=Math.ceil(t*n+i),l=e._particles,u=e._particlePool,f=Math.max(a-l.length-u.length,0);for(let d=0;d<f;++d){let p=new qN;p._billboard=r.add({image:s,show:!1}),u.push(p)}e._particleEstimate=a}function T_t(e){let t=e._particlePool.pop();return c(t)||(t=new qN),t}function A_t(e,t){e._particlePool.push(t)}function C_t(e){let t=e._particles,n=e._particlePool,i=e._billboardCollection,o=t.length,r=n.length,s=e._particleEstimate,a=r-Math.max(s-o-r,0);for(let l=a;l<r;++l){let u=n[l];i.remove(u._billboard)}n.length=a}function E_t(e){c(e._billboard)&&(e._billboard.show=!1)}function wbe(e,t){let n=t._billboard;c(n)||(n=t._billboard=e._billboardCollection.add({image:t.image})),n.width=t.imageSize.x,n.height=t.imageSize.y,n.position=t.position,n.sizeInMeters=e.sizeInMeters,n.show=!0;let i=R.lerp(t.startColor.red,t.endColor.red,t.normalizedAge),o=R.lerp(t.startColor.green,t.endColor.green,t.normalizedAge),r=R.lerp(t.startColor.blue,t.endColor.blue,t.normalizedAge),s=R.lerp(t.startColor.alpha,t.endColor.alpha,t.normalizedAge);n.color=new j(i,o,r,s),n.scale=R.lerp(t.startScale,t.endScale,t.normalizedAge)}function S_t(e,t){t.startColor=j.clone(e._startColor,t.startColor),t.endColor=j.clone(e._endColor,t.endColor),t.startScale=e._startScale,t.endScale=e._endScale,t.image=e.image,t.life=R.randomBetween(e._minimumParticleLife,e._maximumParticleLife),t.mass=R.randomBetween(e._minimumMass,e._maximumMass),t.imageSize.x=R.randomBetween(e._minimumImageSize.x,e._maximumImageSize.x),t.imageSize.y=R.randomBetween(e._minimumImageSize.y,e._maximumImageSize.y),t._normalizedAge=0,t._age=0;let n=R.randomBetween(e._minimumSpeed,e._maximumSpeed);h.multiplyByScalar(t.velocity,n,t.velocity),e._particles.push(t)}function w_t(e,t){if(e._isComplete)return 0;t=R.mod(t,e._lifetime);let n=t*e._emissionRate,i=Math.floor(n);if(e._carryOver+=n-i,e._carryOver>1&&(i++,e._carryOver-=1),c(e.bursts)){let o=e.bursts.length;for(let r=0;r<o;r++){let s=e.bursts[r],a=e._currentTime;c(s)&&!s._complete&&a>s.time&&(i+=R.randomBetween(s.minimum,s.maximum),s._complete=!0)}}return i}var YN=new h;rP.prototype.update=function(e){if(!this.show)return;c(this._billboardCollection)||(this._billboardCollection=new rd),this._updateParticlePool&&(x_t(this),this._updateParticlePool=!1);let t=0;this._previousTime&&(t=J.secondsDifference(e.time,this._previousTime)),t<0&&(t=0);let n=this._particles,i=this._emitter,o=this.updateCallback,r,s,a=n.length;for(r=0;r<a;++r)s=n[r],s.update(t,o)?wbe(this,s):(E_t(s),A_t(this,s),n[r]=n[a-1],--r,--a);n.length=a;let l=w_t(this,t);if(l>0&&c(i)){this._matrixDirty&&(this._combinedMatrix=k.multiply(this.modelMatrix,this.emitterModelMatrix,this._combinedMatrix),this._matrixDirty=!1);let u=this._combinedMatrix;for(r=0;r<l;r++)s=T_t(this),this._emitter.emit(s),h.add(s.position,s.velocity,YN),k.multiplyByPoint(u,YN,YN),s.position=k.multiplyByPoint(u,s.position,s.position),h.subtract(YN,s.position,s.velocity),h.normalize(s.velocity,s.velocity),S_t(this,s),wbe(this,s)}if(this._billboardCollection.update(e),this._previousTime=J.clone(e.time,this._previousTime),this._currentTime+=t,this._lifetime!==Number.MAX_VALUE&&this._currentTime>this._lifetime)if(this.loop){if(this._currentTime=R.mod(this._currentTime,this._lifetime),this.bursts){let u=this.bursts.length;for(r=0;r<u;r++)this.bursts[r]._complete=!1}}else this._isComplete=!0,this._complete.raiseEvent(this);e.frameNumber%120===0&&C_t(this)};rP.prototype.isDestroyed=function(){return!1};rP.prototype.destroy=function(){return this._billboardCollection=this._billboardCollection&&this._billboardCollection.destroy(),de(this)};var v_t=rP;function XN(e){e=y(e,y.EMPTY_OBJECT);let t=On(e.container);if(!c(t))throw new E("container is required");this._container=t;let n=document.createElement("div");n.className="cesium-performanceDisplay";let i=document.createElement("div");i.className="cesium-performanceDisplay-fps",this._fpsText=document.createTextNode(""),i.appendChild(this._fpsText);let o=document.createElement("div");o.className="cesium-performanceDisplay-ms",this._msText=document.createTextNode(""),o.appendChild(this._msText),n.appendChild(o),n.appendChild(i),this._container.appendChild(n),this._lastFpsSampleTime=Ei(),this._lastMsSampleTime=Ei(),this._fpsFrameCount=0,this._msFrameCount=0,this._throttled=!1;let r=document.createElement("div");r.className="cesium-performanceDisplay-throttled",this._throttledText=document.createTextNode(""),r.appendChild(this._throttledText),n.appendChild(r)}Object.defineProperties(XN.prototype,{throttled:{get:function(){return this._throttled},set:function(e){this._throttled!==e&&(e?this._throttledText.nodeValue="(throttled)":this._throttledText.nodeValue="",this._throttled=e)}}});XN.prototype.update=function(e){let t=Ei(),n=y(e,!0);this._fpsFrameCount++;let i=t-this._lastFpsSampleTime;if(i>1e3){let r="N/A";n&&(r=this._fpsFrameCount*1e3/i|0),this._fpsText.nodeValue=`${r} FPS`,this._lastFpsSampleTime=t,this._fpsFrameCount=0}this._msFrameCount++;let o=t-this._lastMsSampleTime;if(o>200){let r="N/A";n&&(r=(o/this._msFrameCount).toFixed(2)),this._msText.nodeValue=`${r} MS`,this._lastMsSampleTime=t,this._msFrameCount=0}};XN.prototype.destroy=function(){return de(this)};var xy=XN;function Qb(){this._framebuffer=new gi,this._textureToCopy=void 0,this._copyDepthCommand=void 0}Object.defineProperties(Qb.prototype,{framebuffer:{get:function(){return this._framebuffer.framebuffer}}});function D_t(e,t,n){let{width:i,height:o}=n;e._framebuffer.update(t,i,o)}function P_t(e,t,n){c(e._copyDepthCommand)||(e._copyDepthCommand=t.createViewportQuadCommand(`uniform highp sampler2D colorTexture;

in vec2 v_textureCoordinates;

void main()
{
  vec4 globeDepthPacked = texture(czm_globeDepthTexture, v_textureCoordinates);
  float globeDepth = czm_unpackDepth(globeDepthPacked);
  float depth = texture(colorTexture, v_textureCoordinates).r;
  out_FragColor = czm_branchFreeTernary(globeDepth <= 0.0 || globeDepth >= 1.0 || depth < globeDepth && depth > 0.0 && depth < 1.0,
    czm_packDepth(depth), globeDepthPacked);
}
`,{renderState:ze.fromCache(),uniformMap:{colorTexture:function(){return e._textureToCopy}},owner:e})),e._textureToCopy=n,e._copyDepthCommand.framebuffer=e.framebuffer}Qb.prototype.update=function(e,t){D_t(this,e,t),P_t(this,e,t)};var I_t=new se,O_t=new se(1,1/255,1/65025,1/16581375);Qb.prototype.getDepth=function(e,t,n){if(!c(this.framebuffer))return;let i=e.readPixels({x:t,y:n,width:1,height:1,framebuffer:this.framebuffer}),o=se.unpack(i,0,I_t);return se.divideByScalar(o,255,o),se.dot(o,O_t)};Qb.prototype.executeCopyDepth=function(e,t){this._copyDepthCommand.execute(e,t)};Qb.prototype.isDestroyed=function(){return!1};Qb.prototype.destroy=function(){return this._framebuffer.destroy(),c(this._copyDepthCommand)&&(this._copyDepthCommand.shaderProgram=c(this._copyDepthCommand.shaderProgram)&&this._copyDepthCommand.shaderProgram.destroy()),de(this)};var VY=Qb;function sP(){this._framebuffer=new gi({color:!1,depthStencil:!0,supportsDepthTexture:!0}),this._passState=void 0}Object.defineProperties(sP.prototype,{framebuffer:{get:function(){return this._framebuffer.framebuffer}}});function R_t(e){e._framebuffer.destroy()}function M_t(e,t){let n=t.drawingBufferWidth,i=t.drawingBufferHeight;e._framebuffer.update(t,n,i);let o=new Cl(t);o.blendingEnabled=!1,o.scissorTest={enabled:!0,rectangle:new Ke},o.viewport=new Ke,e._passState=o}sP.prototype.update=function(e,t,n){let i=n.width,o=n.height;this._framebuffer.isDirty(i,o)&&M_t(this,e);let r=this.framebuffer,s=this._passState;return s.framebuffer=r,s.viewport.width=i,s.viewport.height=o,s.scissorTest.rectangle.x=t.x,s.scissorTest.rectangle.y=o-t.y,s.scissorTest.rectangle.width=1,s.scissorTest.rectangle.height=1,s};sP.prototype.isDestroyed=function(){return!1};sP.prototype.destroy=function(){return R_t(this),de(this)};var UY=sP;function L_t(e,t,n,i){this.schemaId=e,this.className=t,this.propertyName=n,this.classProperty=i}var zY=L_t;function BC(e){let t=new Cl(e);t.blendingEnabled=!1,t.scissorTest={enabled:!0,rectangle:new Ke},t.viewport=new Ke,this._context=e,this._fb=new gi({depthStencil:!0}),this._passState=t,this._width=0,this._height=0}BC.prototype.begin=function(e,t){let n=this._context,{width:i,height:o}=t;return Ke.clone(e,this._passState.scissorTest.rectangle),this._width=i,this._height=o,this._fb.update(n,i,o),this._passState.framebuffer=this._fb.framebuffer,this._passState.viewport.width=i,this._passState.viewport.height=o,this._passState};var aP=new j;BC.prototype.end=function(e){let t=y(e.width,1),n=y(e.height,1),i=this._context,o=i.readPixels({x:e.x,y:e.y,width:t,height:n,framebuffer:this._fb.framebuffer}),r=Math.max(t,n),s=r*r,a=Math.floor(t*.5),l=Math.floor(n*.5),u=0,f=0,d=0,p=-1;for(let g=0;g<s;++g){if(-a<=u&&u<=a&&-l<=f&&f<=l){let m=4*((l-f)*t+u+a);aP.red=j.byteToFloat(o[m]),aP.green=j.byteToFloat(o[m+1]),aP.blue=j.byteToFloat(o[m+2]),aP.alpha=j.byteToFloat(o[m+3]);let b=i.getObjectByPickColor(aP);if(c(b))return b}if(u===f||u<0&&-u===f||u>0&&u===1-f){let m=d;d=-p,p=m}u+=d,f+=p}};BC.prototype.readCenterPixel=function(e){let t=y(e.width,1),n=y(e.height,1),o=this._context.readPixels({x:e.x,y:e.y,width:t,height:n,framebuffer:this._fb.framebuffer}),r=Math.floor(t*.5),a=4*(Math.floor(n*.5)*t+r);return o.slice(a,a+4)};BC.prototype.isDestroyed=function(){return!1};BC.prototype.destroy=function(){return this._fb.destroy(),de(this)};var HY=BC;function r_(){this._numSamples=1,this._colorFramebuffer=new gi({depthStencil:!0,supportsDepthTexture:!0}),this._idFramebuffer=new gi({depthStencil:!0,supportsDepthTexture:!0}),this._idClearColor=new j(0,0,0,0),this._clearCommand=new ri({color:new j(0,0,0,0),depth:1,owner:this})}function N_t(e){e._colorFramebuffer.destroy(),e._idFramebuffer.destroy()}Object.defineProperties(r_.prototype,{framebuffer:{get:function(){return this._colorFramebuffer.framebuffer}},idFramebuffer:{get:function(){return this._idFramebuffer.framebuffer}},depthStencilTexture:{get:function(){return this._colorFramebuffer.getDepthStencilTexture()}}});r_.prototype.update=function(e,t,n,i){let o=t.width,r=t.height,s=n?e.halfFloatingPointTexture?Be.HALF_FLOAT:Be.FLOAT:Be.UNSIGNED_BYTE;this._numSamples=i,this._colorFramebuffer.update(e,o,r,i,s),this._idFramebuffer.update(e,o,r)};r_.prototype.clear=function(e,t,n){j.clone(n,this._clearCommand.color),j.clone(this._idClearColor,this._clearCommand.color),this._colorFramebuffer.clear(e,this._clearCommand,t),this._idFramebuffer.clear(e,this._clearCommand,t)};r_.prototype.getFramebuffer=function(){return this._colorFramebuffer.framebuffer};r_.prototype.getIdFramebuffer=function(){return this._idFramebuffer.framebuffer};r_.prototype.prepareColorTextures=function(e){this._numSamples>1&&this._colorFramebuffer.prepareTextures(e)};r_.prototype.isDestroyed=function(){return!1};r_.prototype.destroy=function(){return N_t(this),de(this)};var cP=r_;function ex(){}ex.getShadowCastShaderKeyword=function(e,t,n,i){return`castShadow ${e} ${t} ${n} ${i}`};ex.createShadowCastVertexShader=function(e,t,n){let i=e.defines.slice(0),o=e.sources.slice(0);i.push("SHADOW_MAP"),n&&i.push("GENERATE_POSITION");let r=Ge.findPositionVarying(e),s=c(r);if(t&&!s){let a=o.length;for(let u=0;u<a;++u)o[u]=Ge.replaceMain(o[u],"czm_shadow_cast_main");o.push(`out vec3 v_positionEC; 
void main() 
{ 
    czm_shadow_cast_main(); 
    v_positionEC = (czm_inverseProjection * gl_Position).xyz; 
}`)}return new Ge({defines:i,sources:o})};ex.createShadowCastFragmentShader=function(e,t,n,i){let o=e.defines.slice(0),r=e.sources.slice(0);o.push("SHADOW_MAP");let s=Ge.findPositionVarying(e),a=c(s);a||(s="v_positionEC");let l=r.length;for(let f=0;f<l;++f)r[f]=Ge.replaceMain(r[f],"czm_shadow_cast_main");let u="";return t&&(a||(u+=`in vec3 v_positionEC; 
`),u+=`uniform vec4 shadowMap_lightPositionEC; 
`),i?u+=`void main() 
{ 
`:u+=`void main() 
{ 
    czm_shadow_cast_main(); 
    if (out_FragColor.a == 0.0) 
    { 
       discard; 
    } 
`,t?u+=`    float distance = length(${s}); 
    if (distance >= shadowMap_lightPositionEC.w) 
    { 
        discard; 
    } 
    distance /= shadowMap_lightPositionEC.w; // radius 
    out_FragColor = czm_packDepth(distance); 
`:n?u+=`    out_FragColor = vec4(1.0); 
`:u+=`    out_FragColor = czm_packDepth(gl_FragCoord.z); 
`,u+=`} 
`,r.push(u),new Ge({defines:o,sources:r})};ex.getShadowReceiveShaderKeyword=function(e,t,n,i){let o=e._usesDepthTexture,r=e._polygonOffsetSupported,s=e._isPointLight,a=e._isSpotLight,l=e._numberOfCascades>1,u=e.debugCascadeColors,f=e.softShadows;return`receiveShadow ${o}${r}${s}${a}${l}${u}${f}${t}${n}${i}`};ex.createShadowReceiveVertexShader=function(e,t,n){let i=e.defines.slice(0),o=e.sources.slice(0);return i.push("SHADOW_MAP"),t&&(n?i.push("GENERATE_POSITION_AND_NORMAL"):i.push("GENERATE_POSITION")),new Ge({defines:i,sources:o})};ex.createShadowReceiveFragmentShader=function(e,t,n,i,o){let r=Ge.findNormalVarying(e),s=!i&&c(r)||i&&o,a=Ge.findPositionVarying(e),l=c(a),u=t._usesDepthTexture,f=t._polygonOffsetSupported,d=t._isPointLight,p=t._isSpotLight,g=t._numberOfCascades>1,m=t.debugCascadeColors,b=t.softShadows,x=d?t._pointBias:i?t._terrainBias:t._primitiveBias,T=e.defines.slice(0),C=e.sources.slice(0),S=C.length;for(let I=0;I<S;++I)C[I]=Ge.replaceMain(C[I],"czm_shadow_receive_main");d?T.push("USE_CUBE_MAP_SHADOW"):u&&T.push("USE_SHADOW_DEPTH_TEXTURE"),b&&!d&&T.push("USE_SOFT_SHADOWS"),g&&n&&i&&(s?T.push("ENABLE_VERTEX_LIGHTING"):T.push("ENABLE_DAYNIGHT_SHADING")),n&&x.normalShading&&s&&(T.push("USE_NORMAL_SHADING"),x.normalShadingSmooth>0&&T.push("USE_NORMAL_SHADING_SMOOTH"));let v="";d?v+=`uniform samplerCube shadowMap_textureCube; 
`:v+=`uniform sampler2D shadowMap_texture; 
`;let D;return l?D=`    return vec4(${a}, 1.0); 
`:D=`#ifndef LOG_DEPTH 
    return czm_windowToEyeCoordinates(gl_FragCoord); 
#else 
    return vec4(v_logPositionEC, 1.0); 
#endif 
`,v+=`uniform mat4 shadowMap_matrix; 
uniform vec3 shadowMap_lightDirectionEC; 
uniform vec4 shadowMap_lightPositionEC; 
uniform vec4 shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness; 
uniform vec4 shadowMap_texelSizeDepthBiasAndNormalShadingSmooth; 
#ifdef LOG_DEPTH 
in vec3 v_logPositionEC; 
#endif 
vec4 getPositionEC() 
{ 
${D}} 
vec3 getNormalEC() 
{ 
${s?`    return normalize(${r}); 
`:`    return vec3(1.0); 
`}} 
void applyNormalOffset(inout vec4 positionEC, vec3 normalEC, float nDotL) 
{ 
${x.normalOffset&&s?`    float normalOffset = shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness.x; 
    float normalOffsetScale = 1.0 - nDotL; 
    vec3 offset = normalOffset * normalOffsetScale * normalEC; 
    positionEC.xyz += offset; 
`:""}} 
`,v+=`void main() 
{ 
    czm_shadow_receive_main(); 
    vec4 positionEC = getPositionEC(); 
    vec3 normalEC = getNormalEC(); 
    float depth = -positionEC.z; 
`,v+=`    czm_shadowParameters shadowParameters; 
    shadowParameters.texelStepSize = shadowMap_texelSizeDepthBiasAndNormalShadingSmooth.xy; 
    shadowParameters.depthBias = shadowMap_texelSizeDepthBiasAndNormalShadingSmooth.z; 
    shadowParameters.normalShadingSmooth = shadowMap_texelSizeDepthBiasAndNormalShadingSmooth.w; 
    shadowParameters.darkness = shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness.w; 
`,i?v+=`    shadowParameters.depthBias *= max(depth * 0.01, 1.0); 
`:f||(v+=`    shadowParameters.depthBias *= mix(1.0, 100.0, depth * 0.0015); 
`),d?v+=`    vec3 directionEC = positionEC.xyz - shadowMap_lightPositionEC.xyz; 
    float distance = length(directionEC); 
    directionEC = normalize(directionEC); 
    float radius = shadowMap_lightPositionEC.w; 
    // Stop early if the fragment is beyond the point light radius 
    if (distance > radius) 
    { 
        return; 
    } 
    vec3 directionWC  = czm_inverseViewRotation * directionEC; 
    shadowParameters.depth = distance / radius; 
    shadowParameters.nDotL = clamp(dot(normalEC, -directionEC), 0.0, 1.0); 
    shadowParameters.texCoords = directionWC; 
    float visibility = czm_shadowVisibility(shadowMap_textureCube, shadowParameters); 
`:p?v+=`    vec3 directionEC = normalize(positionEC.xyz - shadowMap_lightPositionEC.xyz); 
    float nDotL = clamp(dot(normalEC, -directionEC), 0.0, 1.0); 
    applyNormalOffset(positionEC, normalEC, nDotL); 
    vec4 shadowPosition = shadowMap_matrix * positionEC; 
    // Spot light uses a perspective projection, so perform the perspective divide 
    shadowPosition /= shadowPosition.w; 
    // Stop early if the fragment is not in the shadow bounds 
    if (any(lessThan(shadowPosition.xyz, vec3(0.0))) || any(greaterThan(shadowPosition.xyz, vec3(1.0)))) 
    { 
        return; 
    } 
    shadowParameters.texCoords = shadowPosition.xy; 
    shadowParameters.depth = shadowPosition.z; 
    shadowParameters.nDotL = nDotL; 
    float visibility = czm_shadowVisibility(shadowMap_texture, shadowParameters); 
`:g?v+=`    float maxDepth = shadowMap_cascadeSplits[1].w; 
    // Stop early if the eye depth exceeds the last cascade 
    if (depth > maxDepth) 
    { 
        return; 
    } 
    // Get the cascade based on the eye-space depth 
    vec4 weights = czm_cascadeWeights(depth); 
    // Apply normal offset 
    float nDotL = clamp(dot(normalEC, shadowMap_lightDirectionEC), 0.0, 1.0); 
    applyNormalOffset(positionEC, normalEC, nDotL); 
    // Transform position into the cascade 
    vec4 shadowPosition = czm_cascadeMatrix(weights) * positionEC; 
    // Get visibility 
    shadowParameters.texCoords = shadowPosition.xy; 
    shadowParameters.depth = shadowPosition.z; 
    shadowParameters.nDotL = nDotL; 
    float visibility = czm_shadowVisibility(shadowMap_texture, shadowParameters); 
    // Fade out shadows that are far away 
    float shadowMapMaximumDistance = shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness.z; 
    float fade = max((depth - shadowMapMaximumDistance * 0.8) / (shadowMapMaximumDistance * 0.2), 0.0); 
    visibility = mix(visibility, 1.0, fade); 
${m?`    // Draw cascade colors for debugging 
    out_FragColor *= czm_cascadeColor(weights); 
`:""}`:v+=`    float nDotL = clamp(dot(normalEC, shadowMap_lightDirectionEC), 0.0, 1.0); 
    applyNormalOffset(positionEC, normalEC, nDotL); 
    vec4 shadowPosition = shadowMap_matrix * positionEC; 
    // Stop early if the fragment is not in the shadow bounds 
    if (any(lessThan(shadowPosition.xyz, vec3(0.0))) || any(greaterThan(shadowPosition.xyz, vec3(1.0)))) 
    { 
        return; 
    } 
    shadowParameters.texCoords = shadowPosition.xy; 
    shadowParameters.depth = shadowPosition.z; 
    shadowParameters.nDotL = nDotL; 
    float visibility = czm_shadowVisibility(shadowMap_texture, shadowParameters); 
`,v+=`    out_FragColor.rgb *= visibility; 
} 
`,C.push(v),new Ge({defines:T,sources:C})};var Ty=ex;function fm(e){e=y(e,y.EMPTY_OBJECT);let t=e.context;if(!c(t))throw new E("context is required.");if(!c(e.lightCamera))throw new E("lightCamera is required.");if(c(e.numberOfCascades)&&e.numberOfCascades!==1&&e.numberOfCascades!==4)throw new E("Only one or four cascades are supported.");this._enabled=y(e.enabled,!0),this._softShadows=y(e.softShadows,!1),this._normalOffset=y(e.normalOffset,!0),this.dirty=!0,this.fromLightSource=y(e.fromLightSource,!0),this.darkness=y(e.darkness,.3),this._darkness=this.darkness,this.fadingEnabled=y(e.fadingEnabled,!0),this.maximumDistance=y(e.maximumDistance,5e3),this._outOfView=!1,this._outOfViewPrevious=!1,this._needsUpdate=!0;let n=!0;(zt.isInternetExplorer()||zt.isEdge()||(zt.isChrome()||zt.isFirefox())&&zt.isWindows()&&!t.depthTexture)&&(n=!1),this._polygonOffsetSupported=n,this._terrainBias={polygonOffset:n,polygonOffsetFactor:1.1,polygonOffsetUnits:4,normalOffset:this._normalOffset,normalOffsetScale:.5,normalShading:!0,normalShadingSmooth:.3,depthBias:1e-4},this._primitiveBias={polygonOffset:n,polygonOffsetFactor:1.1,polygonOffsetUnits:4,normalOffset:this._normalOffset,normalOffsetScale:.1,normalShading:!0,normalShadingSmooth:.05,depthBias:2e-5},this._pointBias={polygonOffset:!1,polygonOffsetFactor:1.1,polygonOffsetUnits:4,normalOffset:this._normalOffset,normalOffsetScale:0,normalShading:!0,normalShadingSmooth:.1,depthBias:5e-4},this._depthAttachment=void 0,this._colorAttachment=void 0,this._shadowMapMatrix=new k,this._shadowMapTexture=void 0,this._lightDirectionEC=new h,this._lightPositionEC=new se,this._distance=0,this._lightCamera=e.lightCamera,this._shadowMapCamera=new KN,this._shadowMapCullingVolume=void 0,this._sceneCamera=void 0,this._boundingSphere=new ce,this._isPointLight=y(e.isPointLight,!1),this._pointLightRadius=y(e.pointLightRadius,100),this._cascadesEnabled=this._isPointLight?!1:y(e.cascadesEnabled,!0),this._numberOfCascades=this._cascadesEnabled?y(e.numberOfCascades,4):0,this._fitNearFar=!0,this._maximumCascadeDistances=[25,150,700,Number.MAX_VALUE],this._textureSize=new H,this._isSpotLight=!1,this._cascadesEnabled?this._shadowMapCamera.frustum=new er:c(this._lightCamera.frustum.fov)&&(this._isSpotLight=!0),this._cascadeSplits=[new se,new se],this._cascadeMatrices=[new k,new k,new k,new k],this._cascadeDistances=new se;let i;this._isPointLight?i=6:this._cascadesEnabled?i=this._numberOfCascades:i=1,this._passes=new Array(i);for(let o=0;o<i;++o)this._passes[o]=new F_t(t);this.debugShow=!1,this.debugFreezeFrame=!1,this._debugFreezeFrame=!1,this._debugCascadeColors=!1,this._debugLightFrustum=void 0,this._debugCameraFrustum=void 0,this._debugCascadeFrustums=new Array(this._numberOfCascades),this._debugShadowViewCommand=void 0,this._usesDepthTexture=t.depthTexture,this._isPointLight&&(this._usesDepthTexture=!1),this._primitiveRenderState=void 0,this._terrainRenderState=void 0,this._pointRenderState=void 0,jY(this),this._clearCommand=new ri({depth:1,color:new j}),this._clearPassState=new Cl(t),this._size=y(e.size,2048),this.size=this._size}fm.MAXIMUM_DISTANCE=2e4;function F_t(e){this.camera=new KN,this.passState=new Cl(e),this.framebuffer=void 0,this.textureOffsets=void 0,this.commandList=[],this.cullingVolume=void 0}function GY(e,t){return ze.fromCache({cull:{enabled:!0,face:xi.BACK},depthTest:{enabled:!0},colorMask:{red:e,green:e,blue:e,alpha:e},depthMask:!0,polygonOffset:{enabled:t.polygonOffset,factor:t.polygonOffsetFactor,units:t.polygonOffsetUnits}})}function jY(e){let t=!e._usesDepthTexture;e._primitiveRenderState=GY(t,e._primitiveBias),e._terrainRenderState=GY(t,e._terrainBias),e._pointRenderState=GY(t,e._pointBias)}fm.prototype.debugCreateRenderStates=function(){jY(this)};Object.defineProperties(fm.prototype,{enabled:{get:function(){return this._enabled},set:function(e){this.dirty=this._enabled!==e,this._enabled=e}},normalOffset:{get:function(){return this._normalOffset},set:function(e){this.dirty=this._normalOffset!==e,this._normalOffset=e,this._terrainBias.normalOffset=e,this._primitiveBias.normalOffset=e,this._pointBias.normalOffset=e}},softShadows:{get:function(){return this._softShadows},set:function(e){this.dirty=this._softShadows!==e,this._softShadows=e}},size:{get:function(){return this._size},set:function(e){H_t(this,e)}},outOfView:{get:function(){return this._outOfView}},shadowMapCullingVolume:{get:function(){return this._shadowMapCullingVolume}},passes:{get:function(){return this._passes}},isPointLight:{get:function(){return this._isPointLight}},debugCascadeColors:{get:function(){return this._debugCascadeColors},set:function(e){this.dirty=this._debugCascadeColors!==e,this._debugCascadeColors=e}}});function WY(e){let t=e._passes.length;for(let n=0;n<t;++n){let i=e._passes[n],o=i.framebuffer;c(o)&&!o.isDestroyed()&&o.destroy(),i.framebuffer=void 0}e._depthAttachment=e._depthAttachment&&e._depthAttachment.destroy(),e._colorAttachment=e._colorAttachment&&e._colorAttachment.destroy()}function B_t(e,t){let n=new id({context:t,width:e._textureSize.x,height:e._textureSize.y,format:al.DEPTH_COMPONENT16}),i=new Lt({context:t,width:e._textureSize.x,height:e._textureSize.y,pixelFormat:Ve.RGBA,pixelDatatype:Be.UNSIGNED_BYTE,sampler:Qt.NEAREST}),o=new Jr({context:t,depthRenderbuffer:n,colorTextures:[i],destroyAttachments:!1}),r=e._passes.length;for(let s=0;s<r;++s){let a=e._passes[s];a.framebuffer=o,a.passState.framebuffer=o}e._shadowMapTexture=i,e._depthAttachment=n,e._colorAttachment=i}function k_t(e,t){let n=new Lt({context:t,width:e._textureSize.x,height:e._textureSize.y,pixelFormat:Ve.DEPTH_STENCIL,pixelDatatype:Be.UNSIGNED_INT_24_8,sampler:Qt.NEAREST}),i=new Jr({context:t,depthStencilTexture:n,destroyAttachments:!1}),o=e._passes.length;for(let r=0;r<o;++r){let s=e._passes[r];s.framebuffer=i,s.passState.framebuffer=i}e._shadowMapTexture=n,e._depthAttachment=n}function V_t(e,t){let n=new id({context:t,width:e._textureSize.x,height:e._textureSize.y,format:al.DEPTH_COMPONENT16}),i=new Jo({context:t,width:e._textureSize.x,height:e._textureSize.y,pixelFormat:Ve.RGBA,pixelDatatype:Be.UNSIGNED_BYTE,sampler:Qt.NEAREST}),o=[i.negativeX,i.negativeY,i.negativeZ,i.positiveX,i.positiveY,i.positiveZ];for(let r=0;r<6;++r){let s=new Jr({context:t,depthRenderbuffer:n,colorTextures:[o[r]],destroyAttachments:!1}),a=e._passes[r];a.framebuffer=s,a.passState.framebuffer=s}e._shadowMapTexture=i,e._depthAttachment=n,e._colorAttachment=i}function Pbe(e,t){e._isPointLight?V_t(e,t):e._usesDepthTexture?k_t(e,t):B_t(e,t)}function U_t(e,t){e._usesDepthTexture&&e._passes[0].framebuffer.status!==ne.FRAMEBUFFER_COMPLETE&&(e._usesDepthTexture=!1,jY(e),WY(e),Pbe(e,t))}function z_t(e,t){(!c(e._passes[0].framebuffer)||e._shadowMapTexture.width!==e._textureSize.x)&&(WY(e),Pbe(e,t),U_t(e,t),Ibe(e,t))}function Ibe(e,t,n){n=y(n,0),(e._isPointLight||n===0)&&(e._clearCommand.framebuffer=e._passes[n].framebuffer,e._clearCommand.execute(t,e._clearPassState))}function H_t(e,t){e._size=t;let n=e._passes,i=n.length,o=e._textureSize;if(e._isPointLight){t=mt.maximumCubeMapSize>=t?t:mt.maximumCubeMapSize,o.x=t,o.y=t;let r=new Ke(0,0,t,t);n[0].passState.viewport=r,n[1].passState.viewport=r,n[2].passState.viewport=r,n[3].passState.viewport=r,n[4].passState.viewport=r,n[5].passState.viewport=r}else i===1?(t=mt.maximumTextureSize>=t?t:mt.maximumTextureSize,o.x=t,o.y=t,n[0].passState.viewport=new Ke(0,0,t,t)):i===4&&(t=mt.maximumTextureSize>=t*2?t:mt.maximumTextureSize/2,o.x=t*2,o.y=t*2,n[0].passState.viewport=new Ke(0,0,t,t),n[1].passState.viewport=new Ke(t,0,t,t),n[2].passState.viewport=new Ke(0,t,t,t),n[3].passState.viewport=new Ke(t,t,t,t));e._clearPassState.viewport=new Ke(0,0,o.x,o.y);for(let r=0;r<i;++r){let s=n[r],a=s.passState.viewport,l=a.x/o.x,u=a.y/o.y,f=a.width/o.x,d=a.height/o.y;s.textureOffsets=new k(f,0,0,l,0,d,0,u,0,0,1,0,0,0,0,1)}}var G_t=new Ke;function j_t(e,t){let n;e._isPointLight?n=`uniform samplerCube shadowMap_textureCube; 
in vec2 v_textureCoordinates; 
void main() 
{ 
    vec2 uv = v_textureCoordinates; 
    vec3 dir; 
 
    if (uv.y < 0.5) 
    { 
        if (uv.x < 0.333) 
        { 
            dir.x = -1.0; 
            dir.y = uv.x * 6.0 - 1.0; 
            dir.z = uv.y * 4.0 - 1.0; 
        } 
        else if (uv.x < 0.666) 
        { 
            dir.y = -1.0; 
            dir.x = uv.x * 6.0 - 3.0; 
            dir.z = uv.y * 4.0 - 1.0; 
        } 
        else 
        { 
            dir.z = -1.0; 
            dir.x = uv.x * 6.0 - 5.0; 
            dir.y = uv.y * 4.0 - 1.0; 
        } 
    } 
    else 
    { 
        if (uv.x < 0.333) 
        { 
            dir.x = 1.0; 
            dir.y = uv.x * 6.0 - 1.0; 
            dir.z = uv.y * 4.0 - 3.0; 
        } 
        else if (uv.x < 0.666) 
        { 
            dir.y = 1.0; 
            dir.x = uv.x * 6.0 - 3.0; 
            dir.z = uv.y * 4.0 - 3.0; 
        } 
        else 
        { 
            dir.z = 1.0; 
            dir.x = uv.x * 6.0 - 5.0; 
            dir.y = uv.y * 4.0 - 3.0; 
        } 
    } 
 
    float shadow = czm_unpackDepth(czm_textureCube(shadowMap_textureCube, dir)); 
    out_FragColor = vec4(vec3(shadow), 1.0); 
} 
`:n=`uniform sampler2D shadowMap_texture; 
in vec2 v_textureCoordinates; 
void main() 
{ 
${e._usesDepthTexture?`    float shadow = texture(shadowMap_texture, v_textureCoordinates).r; 
`:`    float shadow = czm_unpackDepth(texture(shadowMap_texture, v_textureCoordinates)); 
`}    out_FragColor = vec4(vec3(shadow), 1.0); 
} 
`;let i=t.createViewportQuadCommand(n,{uniformMap:{shadowMap_texture:function(){return e._shadowMapTexture},shadowMap_textureCube:function(){return e._shadowMapTexture}}});return i.pass=ve.OVERLAY,i}function W_t(e,t){let n=t.context,i=t.context.drawingBufferWidth,o=t.context.drawingBufferHeight,r=Math.min(i,o)*.3,s=G_t;s.x=i-r,s.y=0,s.width=r,s.height=r;let a=e._debugShadowViewCommand;c(a)||(a=j_t(e,n),e._debugShadowViewCommand=a),(!c(a.renderState)||!Ke.equals(a.renderState.viewport,s))&&(a.renderState=ze.fromCache({viewport:Ke.clone(s)})),t.commandList.push(e._debugShadowViewCommand)}var dm=new Array(8);dm[0]=new se(-1,-1,-1,1);dm[1]=new se(1,-1,-1,1);dm[2]=new se(1,1,-1,1);dm[3]=new se(-1,1,-1,1);dm[4]=new se(-1,-1,1,1);dm[5]=new se(1,-1,1,1);dm[6]=new se(1,1,1,1);dm[7]=new se(-1,1,1,1);var Ay=new k,qY=new Array(8);for(let e=0;e<8;++e)qY[e]=new se;function q_t(e,t){let n=new vt({geometry:new Sm({minimum:new h(-.5,-.5,-.5),maximum:new h(.5,.5,.5)}),attributes:{color:Wt.fromColor(t)}}),i=new vt({geometry:new j0({radius:.5}),attributes:{color:Wt.fromColor(t)}});return new Rn({geometryInstances:[n,i],appearance:new ln({translucent:!1,flat:!0}),asynchronous:!1,modelMatrix:e})}var Y_t=[j.RED,j.GREEN,j.BLUE,j.MAGENTA],X_t=new h;function K_t(e,t){W_t(e,t);let n=e.debugFreezeFrame&&!e._debugFreezeFrame;if(e._debugFreezeFrame=e.debugFreezeFrame,e.debugFreezeFrame&&(n&&(e._debugCameraFrustum=e._debugCameraFrustum&&e._debugCameraFrustum.destroy(),e._debugCameraFrustum=new my({camera:e._sceneCamera,color:j.CYAN,updateOnChange:!1})),e._debugCameraFrustum.update(t)),e._cascadesEnabled){if(e.debugFreezeFrame){n&&(e._debugLightFrustum=e._debugLightFrustum&&e._debugLightFrustum.destroy(),e._debugLightFrustum=new my({camera:e._shadowMapCamera,color:j.YELLOW,updateOnChange:!1})),e._debugLightFrustum.update(t);for(let i=0;i<e._numberOfCascades;++i)n&&(e._debugCascadeFrustums[i]=e._debugCascadeFrustums[i]&&e._debugCascadeFrustums[i].destroy(),e._debugCascadeFrustums[i]=new my({camera:e._passes[i].camera,color:Y_t[i],updateOnChange:!1})),e._debugCascadeFrustums[i].update(t)}}else if(e._isPointLight){if(!c(e._debugLightFrustum)||e._needsUpdate){let i=e._shadowMapCamera.positionWC,o=Ne.IDENTITY,r=e._pointLightRadius*2,s=h.fromElements(r,r,r,X_t),a=k.fromTranslationQuaternionRotationScale(i,o,s,Ay);e._debugLightFrustum=e._debugLightFrustum&&e._debugLightFrustum.destroy(),e._debugLightFrustum=q_t(a,j.YELLOW)}e._debugLightFrustum.update(t)}else(!c(e._debugLightFrustum)||e._needsUpdate)&&(e._debugLightFrustum=new my({camera:e._shadowMapCamera,color:j.YELLOW,updateOnChange:!1})),e._debugLightFrustum.update(t)}function KN(){this.viewMatrix=new k,this.inverseViewMatrix=new k,this.frustum=void 0,this.positionCartographic=new he,this.positionWC=new h,this.directionWC=h.clone(h.UNIT_Z),this.upWC=h.clone(h.UNIT_Y),this.rightWC=h.clone(h.UNIT_X),this.viewProjectionMatrix=new k}KN.prototype.clone=function(e){k.clone(e.viewMatrix,this.viewMatrix),k.clone(e.inverseViewMatrix,this.inverseViewMatrix),this.frustum=e.frustum.clone(this.frustum),he.clone(e.positionCartographic,this.positionCartographic),h.clone(e.positionWC,this.positionWC),h.clone(e.directionWC,this.directionWC),h.clone(e.upWC,this.upWC),h.clone(e.rightWC,this.rightWC)};var $_t=new k(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1);KN.prototype.getViewProjection=function(){let e=this.viewMatrix,t=this.frustum.projectionMatrix;return k.multiply(t,e,this.viewProjectionMatrix),k.multiply($_t,this.viewProjectionMatrix,this.viewProjectionMatrix),this.viewProjectionMatrix};var Z_t=new Array(5),J_t=new vi,Q_t=new Array(4),Obe=new h,Rbe=new h;function egt(e,t){let n=e._shadowMapCamera,i=e._sceneCamera,o=i.frustum.near,r=i.frustum.far,s=e._numberOfCascades,a,l=r-o,u=r/o,f=.9,d=!1;t.shadowState.closestObjectSize<200&&(d=!0,f=.9);let p=Q_t,g=Z_t;for(g[0]=o,g[s]=r,a=0;a<s;++a){let B=(a+1)/s,_=o*Math.pow(u,B),w=o+l*B,P=R.lerp(w,_,f);g[a+1]=P,p[a]=P-g[a]}if(d){for(a=0;a<s;++a)p[a]=Math.min(p[a],e._maximumCascadeDistances[a]);let B=g[0];for(a=0;a<s-1;++a)B+=p[a],g[a+1]=B}se.unpack(g,0,e._cascadeSplits[0]),se.unpack(g,1,e._cascadeSplits[1]),se.unpack(p,0,e._cascadeDistances);let m=n.frustum,b=m.left,x=m.right,T=m.bottom,C=m.top,S=m.near,v=m.far,D=n.positionWC,I=n.directionWC,L=n.upWC,M=i.frustum.clone(J_t),N=n.getViewProjection();for(a=0;a<s;++a){M.near=g[a],M.far=g[a+1];let B=k.multiply(M.projectionMatrix,i.viewMatrix,Ay),_=k.inverse(B,Ay),w=k.multiply(N,_,Ay),P=h.fromElements(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Obe),O=h.fromElements(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,Rbe);for(let W=0;W<8;++W){let U=se.clone(dm[W],qY[W]);k.multiplyByVector(w,U,U),h.divideByScalar(U,U.w,U),h.minimumByComponent(U,P,P),h.maximumByComponent(U,O,O)}P.x=Math.max(P.x,0),P.y=Math.max(P.y,0),P.z=0,O.x=Math.min(O.x,1),O.y=Math.min(O.y,1),O.z=Math.min(O.z,1);let F=e._passes[a],V=F.camera;V.clone(n);let G=V.frustum;G.left=b+P.x*(x-b),G.right=b+O.x*(x-b),G.bottom=T+P.y*(C-T),G.top=T+O.y*(C-T),G.near=S+P.z*(v-S),G.far=S+O.z*(v-S),F.cullingVolume=V.frustum.computeCullingVolume(D,I,L);let z=e._cascadeMatrices[a];k.multiply(V.getViewProjection(),i.inverseViewMatrix,z),k.multiply(F.textureOffsets,z,z)}}var tgt=new k,ngt=new h,igt=new h,vbe=new h;function ogt(e,t){let n=e._shadowMapCamera,i=e._sceneCamera,o=k.multiply(i.frustum.projectionMatrix,i.viewMatrix,Ay),r=k.inverse(o,Ay),s=n.directionWC,a=i.directionWC;h.equalsEpsilon(s,a,R.EPSILON10)&&(a=i.upWC);let l=h.cross(s,a,ngt);a=h.cross(l,s,igt),h.normalize(a,a),h.normalize(l,l);let u=h.fromElements(0,0,0,vbe),f=k.computeView(u,s,a,l,tgt),d=k.multiply(f,r,Ay),p=h.fromElements(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Obe),g=h.fromElements(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,Rbe);for(let v=0;v<8;++v){let D=se.clone(dm[v],qY[v]);k.multiplyByVector(d,D,D),h.divideByScalar(D,D.w,D),h.minimumByComponent(D,p,p),h.maximumByComponent(D,g,g)}g.z+=1e3,p.z-=10;let m=vbe;m.x=-(.5*(p.x+g.x)),m.y=-(.5*(p.y+g.y)),m.z=-g.z;let b=k.fromTranslation(m,Ay);f=k.multiply(b,f,f);let x=.5*(g.x-p.x),T=.5*(g.y-p.y),C=g.z-p.z,S=n.frustum;S.left=-x,S.right=x,S.bottom=-T,S.top=T,S.near=.01,S.far=C,k.clone(f,n.viewMatrix),k.inverse(f,n.inverseViewMatrix),k.getTranslation(n.inverseViewMatrix,n.positionWC),t.mapProjection.ellipsoid.cartesianToCartographic(n.positionWC,n.positionCartographic),h.clone(s,n.directionWC),h.clone(a,n.upWC),h.clone(l,n.rightWC)}var rgt=[new h(-1,0,0),new h(0,-1,0),new h(0,0,-1),new h(1,0,0),new h(0,1,0),new h(0,0,1)],sgt=[new h(0,-1,0),new h(0,0,-1),new h(0,-1,0),new h(0,-1,0),new h(0,0,1),new h(0,-1,0)],agt=[new h(0,0,1),new h(1,0,0),new h(-1,0,0),new h(0,0,-1),new h(1,0,0),new h(1,0,0)];function cgt(e,t){let n=new vi;n.fov=R.PI_OVER_TWO,n.near=1,n.far=e._pointLightRadius,n.aspectRatio=1;for(let i=0;i<6;++i){let o=e._passes[i].camera;o.positionWC=e._shadowMapCamera.positionWC,o.positionCartographic=t.mapProjection.ellipsoid.cartesianToCartographic(o.positionWC,o.positionCartographic),o.directionWC=rgt[i],o.upWC=sgt[i],o.rightWC=agt[i],k.computeView(o.positionWC,o.directionWC,o.upWC,o.rightWC,o.viewMatrix),k.inverse(o.viewMatrix,o.inverseViewMatrix),o.frustum=n}}var lgt=new h,ugt=new h,Mbe=new ce,Dbe=Mbe.center;function fgt(e,t){let n=e._sceneCamera,i=e._shadowMapCamera,o=Mbe;if(e._cascadesEnabled){if(n.frustum.near>=e.maximumDistance){e._outOfView=!0,e._needsUpdate=!1;return}let r=t.mapProjection.ellipsoid.geodeticSurfaceNormal(n.positionWC,lgt),s=h.negate(i.directionWC,ugt),a=h.dot(r,s);if(e.fadingEnabled){let l=R.clamp(a/.1,0,1);e._darkness=R.lerp(1,e.darkness,l)}else e._darkness=e.darkness;if(a<0){e._outOfView=!0,e._needsUpdate=!1;return}e._needsUpdate=!0,e._outOfView=!1}else if(e._isPointLight)o.center=i.positionWC,o.radius=e._pointLightRadius,e._outOfView=t.cullingVolume.computeVisibility(o)===qt.OUTSIDE,e._needsUpdate=!e._outOfView&&!e._boundingSphere.equals(o),ce.clone(o,e._boundingSphere);else{let r=i.frustum.far/2,s=h.add(i.positionWC,h.multiplyByScalar(i.directionWC,r,Dbe),Dbe);o.center=s,o.radius=r,e._outOfView=t.cullingVolume.computeVisibility(o)===qt.OUTSIDE,e._needsUpdate=!e._outOfView&&!e._boundingSphere.equals(o),ce.clone(o,e._boundingSphere)}}function dgt(e,t){let n=t.camera,i=e._lightCamera,o=e._sceneCamera,r=e._shadowMapCamera;e._cascadesEnabled?h.clone(i.directionWC,r.directionWC):e._isPointLight?h.clone(i.positionWC,r.positionWC):r.clone(i);let s=e._lightDirectionEC;k.multiplyByPointAsVector(n.viewMatrix,r.directionWC,s),h.normalize(s,s),h.negate(s,s),k.multiplyByPoint(n.viewMatrix,r.positionWC,e._lightPositionEC),e._lightPositionEC.w=e._pointLightRadius;let a,l;e._fitNearFar?(a=Math.min(t.shadowState.nearPlane,e.maximumDistance),l=Math.min(t.shadowState.farPlane,e.maximumDistance),l=Math.max(l,a+1)):(a=n.frustum.near,l=e.maximumDistance),e._sceneCamera=so.clone(n,o),n.frustum.clone(e._sceneCamera.frustum),e._sceneCamera.frustum.near=a,e._sceneCamera.frustum.far=l,e._distance=l-a,fgt(e,t),!e._outOfViewPrevious&&e._outOfView&&(e._needsUpdate=!0),e._outOfViewPrevious=e._outOfView}fm.prototype.update=function(e){if(dgt(this,e),this._needsUpdate)if(z_t(this,e.context),this._isPointLight&&cgt(this,e),this._cascadesEnabled&&(ogt(this,e),this._numberOfCascades>1&&egt(this,e)),this._isPointLight)this._shadowMapCullingVolume=Os.fromBoundingSphere(this._boundingSphere);else{let t=this._shadowMapCamera,n=t.positionWC,i=t.directionWC,o=t.upWC;this._shadowMapCullingVolume=t.frustum.computeCullingVolume(n,i,o),this._passes.length===1&&this._passes[0].camera.clone(t)}if(this._passes.length===1){let t=this._sceneCamera.inverseViewMatrix;k.multiply(this._shadowMapCamera.getViewProjection(),t,this._shadowMapMatrix)}this.debugShow&&K_t(this,e)};fm.prototype.updatePass=function(e,t){Ibe(this,e,t)};var hgt=new H;function Lbe(e,t,n){let i=e._isPointLight?e._pointBias:n?e._terrainBias:e._primitiveBias,o={shadowMap_texture:function(){return e._shadowMapTexture},shadowMap_textureCube:function(){return e._shadowMapTexture},shadowMap_matrix:function(){return e._shadowMapMatrix},shadowMap_cascadeSplits:function(){return e._cascadeSplits},shadowMap_cascadeMatrices:function(){return e._cascadeMatrices},shadowMap_lightDirectionEC:function(){return e._lightDirectionEC},shadowMap_lightPositionEC:function(){return e._lightPositionEC},shadowMap_cascadeDistances:function(){return e._cascadeDistances},shadowMap_texelSizeDepthBiasAndNormalShadingSmooth:function(){let r=hgt;return r.x=1/e._textureSize.x,r.y=1/e._textureSize.y,se.fromElements(r.x,r.y,i.depthBias,i.normalShadingSmooth,this.combinedUniforms1)},shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness:function(){return se.fromElements(i.normalOffsetScale,e._distance,e.maximumDistance,e._darkness,this.combinedUniforms2)},combinedUniforms1:new se,combinedUniforms2:new se};return At(t,o,!1)}function mgt(e,t,n,i,o,r){let s,a,l;if(c(r)&&(s=r.shaderProgram,a=r.renderState,l=r.uniformMap),r=et.shallowClone(n,r),r.castShadows=!0,r.receiveShadows=!1,!c(s)||o!==n.shaderProgram.id||t){let u=n.shaderProgram,f=n.pass===ve.GLOBE,d=n.pass!==ve.TRANSLUCENT,p=e._isPointLight,g=e._usesDepthTexture,m=Ty.getShadowCastShaderKeyword(p,f,g,d);if(s=i.shaderCache.getDerivedShaderProgram(u,m),!c(s)){let x=u.vertexShaderSource,T=u.fragmentShaderSource,C=Ty.createShadowCastVertexShader(x,p,f),S=Ty.createShadowCastFragmentShader(T,p,g,d);s=i.shaderCache.createDerivedShaderProgram(u,m,{vertexShaderSource:C,fragmentShaderSource:S,attributeLocations:u._attributeLocations})}a=e._primitiveRenderState,p?a=e._pointRenderState:f&&(a=e._terrainRenderState),n.renderState.cull.enabled||(a=qe(a,!1),a.cull=qe(a.cull,!1),a.cull.enabled=!1,a=ze.fromCache(a)),l=Lbe(e,n.uniformMap,f)}return r.shaderProgram=s,r.renderState=a,r.uniformMap=l,r}fm.createReceiveDerivedCommand=function(e,t,n,i,o){c(o)||(o={});let r=e.length>0,s=t.shaderProgram,a=s.vertexShaderSource,l=s.fragmentShaderSource,u=t.pass===ve.GLOBE,f=!1;if(u&&(f=t.owner.data.renderedMesh.encoding.hasVertexNormals),t.receiveShadows&&r){let d,p;c(o.receiveCommand)&&(d=o.receiveCommand.shaderProgram,p=o.receiveCommand.uniformMap),o.receiveCommand=et.shallowClone(t,o.receiveCommand),o.castShadows=!1,o.receiveShadows=!0;let g=o.receiveShaderCastShadows!==t.castShadows,m=o.receiveShaderProgramId!==t.shaderProgram.id;if(!c(d)||m||n||g){let b=Ty.getShadowReceiveShaderKeyword(e[0],t.castShadows,u,f);if(d=i.shaderCache.getDerivedShaderProgram(s,b),!c(d)){let x=Ty.createShadowReceiveVertexShader(a,u,f),T=Ty.createShadowReceiveFragmentShader(l,e[0],t.castShadows,u,f);d=i.shaderCache.createDerivedShaderProgram(s,b,{vertexShaderSource:x,fragmentShaderSource:T,attributeLocations:s._attributeLocations})}p=Lbe(e[0],t.uniformMap,u)}o.receiveCommand.shaderProgram=d,o.receiveCommand.uniformMap=p,o.receiveShaderProgramId=t.shaderProgram.id,o.receiveShaderCastShadows=t.castShadows}return o};fm.createCastDerivedCommand=function(e,t,n,i,o){if(c(o)||(o={}),t.castShadows){let r=o.castCommands;c(r)||(r=o.castCommands=[]);let s=o.castShaderProgramId,a=e.length;r.length=a;for(let l=0;l<a;++l)r[l]=mgt(e[l],n,t,i,s,r[l]);o.castShaderProgramId=t.shaderProgram.id}return o};fm.prototype.isDestroyed=function(){return!1};fm.prototype.destroy=function(){WY(this),this._debugLightFrustum=this._debugLightFrustum&&this._debugLightFrustum.destroy(),this._debugCameraFrustum=this._debugCameraFrustum&&this._debugCameraFrustum.destroy(),this._debugShadowViewCommand=this._debugShadowViewCommand&&this._debugShadowViewCommand.shaderProgram&&this._debugShadowViewCommand.shaderProgram.destroy();for(let e=0;e<this._numberOfCascades;++e)this._debugCascadeFrustums[e]=this._debugCascadeFrustums[e]&&this._debugCascadeFrustums[e].destroy();return de(this)};var tx=fm;var YY=`uniform sampler2D u_opaqueDepthTexture;
uniform sampler2D u_translucentDepthTexture;
in vec2 v_textureCoordinates;
void main()
{
float opaqueDepth = texture(u_opaqueDepthTexture, v_textureCoordinates).r;
float translucentDepth = texture(u_translucentDepthTexture, v_textureCoordinates).r;
translucentDepth = czm_branchFreeTernary(translucentDepth > opaqueDepth, 1.0, translucentDepth);
out_FragColor = czm_packDepth(translucentDepth);
}
`;var lP=`uniform sampler2D colorTexture;
#ifdef DEBUG_SHOW_DEPTH
uniform sampler2D u_packedTranslucentDepth;
#endif
in vec2 v_textureCoordinates;
void main()
{
#ifdef DEBUG_SHOW_DEPTH
if (v_textureCoordinates.x < 0.5)
{
out_FragColor.rgb = vec3(czm_unpackDepth(texture(u_packedTranslucentDepth, v_textureCoordinates)));
out_FragColor.a = 1.0;
}
#else
vec4 color = texture(colorTexture, v_textureCoordinates);
#ifdef PICK
if (color == vec4(0.0))
{
discard;
}
#else
color.rgb /= color.a;
#endif
out_FragColor = color;
#endif
}
`;var pgt=!1;function Cy(e){this._drawClassificationFBO=new gi({createDepthAttachments:!1}),this._accumulationFBO=new gi({createDepthAttachments:!1}),this._packFBO=new gi,this._opaqueDepthStencilTexture=void 0,this._textureToComposite=void 0,this._translucentDepthStencilTexture=void 0,this._packDepthCommand=void 0,this._accumulateCommand=void 0,this._compositeCommand=void 0,this._copyCommand=void 0,this._clearColorCommand=new ri({color:new j(0,0,0,0),owner:this}),this._clearDepthStencilCommand=new ri({depth:1,stencil:0,owner:this}),this._supported=e.depthTexture,this._viewport=new Ke,this._rsDepth=void 0,this._rsAccumulate=void 0,this._rsComp=void 0,this._useScissorTest=void 0,this._scissorRectangle=void 0,this._hasTranslucentDepth=!1,this._frustumsDrawn=0}Object.defineProperties(Cy.prototype,{hasTranslucentDepth:{get:function(){return this._hasTranslucentDepth}}});function Nbe(e){e._textureToComposite=void 0,e._translucentDepthStencilTexture=e._translucentDepthStencilTexture&&!e._translucentDepthStencilTexture.isDestroyed()&&e._translucentDepthStencilTexture.destroy()}function Fbe(e){e._drawClassificationFBO.destroy(),e._accumulationFBO.destroy(),e._packFBO.destroy()}function _gt(e,t,n,i){Nbe(e),e._translucentDepthStencilTexture=new Lt({context:t,width:n,height:i,pixelFormat:Ve.DEPTH_STENCIL,pixelDatatype:Be.UNSIGNED_INT_24_8,sampler:Qt.NEAREST})}function ggt(e,t,n,i){Fbe(e),e._drawClassificationFBO.setDepthStencilTexture(e._translucentDepthStencilTexture),e._drawClassificationFBO.update(t,n,i),e._accumulationFBO.setDepthStencilTexture(e._translucentDepthStencilTexture),e._accumulationFBO.update(t,n,i),e._packFBO.update(t,n,i)}function ygt(e,t,n,i){if(!e.isSupported())return;e._opaqueDepthStencilTexture=i;let o=e._opaqueDepthStencilTexture.width,r=e._opaqueDepthStencilTexture.height;e._drawClassificationFBO.isDirty(o,r)&&(_gt(e,t,o,r),ggt(e,t,o,r));let s,a;if(c(e._packDepthCommand)||(s=new Ge({sources:[YY]}),a={u_opaqueDepthTexture:function(){return e._opaqueDepthStencilTexture},u_translucentDepthTexture:function(){return e._translucentDepthStencilTexture}},e._packDepthCommand=t.createViewportQuadCommand(s,{uniformMap:a,owner:e})),!c(e._compositeCommand)){s=new Ge({sources:[lP]}),a={colorTexture:function(){return e._textureToComposite}},pgt&&(s.defines=["DEBUG_SHOW_DEPTH"],a.u_packedTranslucentDepth=function(){return e._packFBO.getColorTexture()}),e._compositeCommand=t.createViewportQuadCommand(s,{uniformMap:a,owner:e});let f=e._compositeCommand,d=f.shaderProgram,p=t.shaderCache.createDerivedShaderProgram(d,"pick",{vertexShaderSource:d.vertexShaderSource,fragmentShaderSource:new Ge({sources:s.sources,defines:["PICK"]}),attributeLocations:d._attributeLocations}),g=et.shallowClone(f);g.shaderProgram=p,f.derivedCommands.pick=g}c(e._copyCommand)||(s=new Ge({sources:[lP]}),a={colorTexture:function(){return e._drawClassificationFBO.getColorTexture()}},e._copyCommand=t.createViewportQuadCommand(s,{uniformMap:a,owner:e})),c(e._accumulateCommand)||(s=new Ge({sources:[lP]}),a={colorTexture:function(){return e._drawClassificationFBO.getColorTexture()}},e._accumulateCommand=t.createViewportQuadCommand(s,{uniformMap:a,owner:e})),e._viewport.width=o,e._viewport.height=r;let l=!Ke.equals(e._viewport,n.viewport),u=l!==e._useScissorTest;e._useScissorTest=l,Ke.equals(e._scissorRectangle,n.viewport)||(e._scissorRectangle=Ke.clone(n.viewport,e._scissorRectangle),u=!0),(!c(e._rsDepth)||!Ke.equals(e._viewport,e._rsDepth.viewport)||u)&&(e._rsDepth=ze.fromCache({viewport:e._viewport,scissorTest:{enabled:e._useScissorTest,rectangle:e._scissorRectangle}})),c(e._packDepthCommand)&&(e._packDepthCommand.renderState=e._rsDepth),(!c(e._rsAccumulate)||!Ke.equals(e._viewport,e._rsAccumulate.viewport)||u)&&(e._rsAccumulate=ze.fromCache({viewport:e._viewport,scissorTest:{enabled:e._useScissorTest,rectangle:e._scissorRectangle},stencilTest:{enabled:!0,frontFunction:Un.EQUAL,reference:Ut.CESIUM_3D_TILE_MASK}})),c(e._accumulateCommand)&&(e._accumulateCommand.renderState=e._rsAccumulate),(!c(e._rsComp)||!Ke.equals(e._viewport,e._rsComp.viewport)||u)&&(e._rsComp=ze.fromCache({viewport:e._viewport,scissorTest:{enabled:e._useScissorTest,rectangle:e._scissorRectangle},blending:hn.ALPHA_BLEND})),c(e._compositeCommand)&&(e._compositeCommand.renderState=e._rsComp,e._compositeCommand.derivedCommands.pick.renderState=e._rsComp)}Cy.prototype.executeTranslucentCommands=function(e,t,n,i,o){let r=e.frameState.useLogDepth,s=e.context,a=n.framebuffer;for(let l=0;l<i.length;++l){let u=i[l];if(u=r?u.derivedCommands.logDepth.command:u,u.depthForTranslucentClassification){this._hasTranslucentDepth=!0;break}}if(this._hasTranslucentDepth){ygt(this,s,n,o),n.framebuffer=this._drawClassificationFBO.framebuffer,this._clearDepthStencilCommand.execute(s,n);for(let l=0;l<i.length;++l){let u=i[l];if(u=r?u.derivedCommands.logDepth.command:u,!u.depthForTranslucentClassification)continue;let f=u.derivedCommands.depth.depthOnlyCommand;t(f,e,n)}this._frustumsDrawn+=this._hasTranslucentDepth?1:0,this._hasTranslucentDepth&&(n.framebuffer=this._packFBO.framebuffer,this._packDepthCommand.execute(s,n)),n.framebuffer=a}};Cy.prototype.executeClassificationCommands=function(e,t,n,i){if(!this._hasTranslucentDepth)return;let o=e.context,r=o.uniformState,s=n.framebuffer;n.framebuffer=this._accumulationFBO.framebuffer,this._accumulateCommand.execute(o,n),n.framebuffer=this._drawClassificationFBO.framebuffer,this._frustumsDrawn>1&&this._clearColorCommand.execute(o,n),r.updatePass(ve.CESIUM_3D_TILE_CLASSIFICATION);let a=r.globeDepthTexture;r.globeDepthTexture=this._packFBO.getColorTexture();let l=i.commands[ve.CESIUM_3D_TILE_CLASSIFICATION],u=i.indices[ve.CESIUM_3D_TILE_CLASSIFICATION];for(let f=0;f<u;++f)t(l[f],e,n);r.globeDepthTexture=a,n.framebuffer=s,this._frustumsDrawn!==1&&(n.framebuffer=this._accumulationFBO.framebuffer,this._accumulateCommand.execute(o,n),n.framebuffer=s)};Cy.prototype.execute=function(e,t){if(!this._hasTranslucentDepth)return;this._frustumsDrawn===1?this._textureToComposite=this._drawClassificationFBO.getColorTexture():this._textureToComposite=this._accumulationFBO.getColorTexture(),(e.frameState.passes.pick?this._compositeCommand.derivedCommands.pick:this._compositeCommand).execute(e.context,t),bgt(this,e,t)};function bgt(e,t,n){if(!e._hasTranslucentDepth)return;let i=n.framebuffer;n.framebuffer=e._drawClassificationFBO.framebuffer,e._clearColorCommand.execute(t._context,n),n.framebuffer=i,e._frustumsDrawn>1&&(n.framebuffer=e._accumulationFBO.framebuffer,e._clearColorCommand.execute(t._context,n)),e._hasTranslucentDepth=!1,e._frustumsDrawn=0}Cy.prototype.isSupported=function(){return this._supported};Cy.prototype.isDestroyed=function(){return!1};Cy.prototype.destroy=function(){return Nbe(this),Fbe(this),c(this._compositeCommand)&&(this._compositeCommand.shaderProgram=this._compositeCommand.shaderProgram&&this._compositeCommand.shaderProgram.destroy()),c(this._packDepthCommand)&&(this._packDepthCommand.shaderProgram=this._packDepthCommand.shaderProgram&&this._packDepthCommand.shaderProgram.destroy()),de(this)};var XY=Cy;function xgt(){this.command=void 0,this.near=void 0,this.far=void 0}function $N(e,t,n){let i=e.context,o;i.depthTexture&&(o=new hY);let r;e._useOIT&&i.depthTexture&&(r=new BY(i));let s=new Cl(i);s.viewport=Ke.clone(n),this.camera=t,this._cameraClone=so.clone(t),this._cameraStartFired=!1,this._cameraMovedTime=void 0,this.viewport=n,this.passState=s,this.pickFramebuffer=new HY(i),this.pickDepthFramebuffer=new UY,this.sceneFramebuffer=new cP,this.globeDepth=o,this.globeTranslucencyFramebuffer=new mY,this.oit=r,this.translucentTileClassification=new XY(i),this.pickDepths=[],this.frustumCommandsList=[],this.debugFrustumStatistics=void 0,this._commandExtents=[]}var KY=new h,$Y=new h;function Tgt(e,t,n){let i=Math.max(h.maximumComponent(h.abs(e.position,KY)),h.maximumComponent(h.abs(t.position,$Y))),o=1/Math.max(1,i);return h.multiplyByScalar(e.position,o,KY),h.multiplyByScalar(t.position,o,$Y),h.equalsEpsilon(KY,$Y,n)&&h.equalsEpsilon(e.direction,t.direction,n)&&h.equalsEpsilon(e.up,t.up,n)&&h.equalsEpsilon(e.right,t.right,n)&&k.equalsEpsilon(e.transform,t.transform,n)&&e.frustum.equalsEpsilon(t.frustum,n)}$N.prototype.checkForCameraUpdates=function(e){let t=this.camera,n=this._cameraClone;return Tgt(t,n,R.EPSILON15)?(this._cameraStartFired&&Ei()-this._cameraMovedTime>e.cameraEventWaitTime&&(t.moveEnd.raiseEvent(),this._cameraStartFired=!1),!1):(this._cameraStartFired||(t.moveStart.raiseEvent(),this._cameraStartFired=!0),this._cameraMovedTime=Ei(),so.clone(t,n),!0)};function Agt(e,t,n,i){let{frameState:o}=t,{camera:r,useLogDepth:s}=o,a=s?t.logarithmicDepthFarToNearRatio:t.farToNearRatio,l=t.mode===oe.SCENE2D,u=t.nearToFarDistance2D;i*=1+R.EPSILON2,n=Math.min(Math.max(n,r.frustum.near),r.frustum.far),i=Math.max(Math.min(i,r.frustum.far),n);let f;l?(i=Math.min(i,r.position.z+t.nearToFarDistance2D),n=Math.min(n,i),f=Math.ceil(Math.max(1,i-n)/t.nearToFarDistance2D)):f=Math.ceil(Math.log(i/n)/Math.log(a));let{frustumCommandsList:d}=e;d.length=f;for(let p=0;p<f;++p){let g,m;l?(g=Math.min(i-u,n+p*u),m=Math.min(i,g+u)):(g=Math.max(n,Math.pow(a,p)*n),m=Math.min(i,a*g));let b=d[p];c(b)?(b.near=g,b.far=m):b=d[p]=new B7(g,m)}}function Cgt(e,t,n){let{command:i,near:o,far:r}=n;t.debugShowFrustums&&(i.debugOverlappingFrustums=0);let{frustumCommandsList:s}=e;for(let a=0;a<s.length;++a){let l=s[a];if(o>l.far)continue;if(r<l.near)break;let u=i.pass,f=l.indices[u]++;if(l.commands[u][f]=i,t.debugShowFrustums&&(i.debugOverlappingFrustums|=1<<a),i.executeInClosestFrustum)break}if(t.debugShowFrustums){let{debugFrustumStatistics:a}=e,{debugOverlappingFrustums:l}=i,u=a.commandsInFrustums;u[l]=c(u[l])?u[l]+1:1,++a.totalCommands}t.updateDerivedCommands(i)}var Bbe=new Os,Egt=new lc;$N.prototype.createPotentiallyVisibleSet=function(e){let{frameState:t}=e,{camera:n,commandList:i,shadowState:o}=t,{positionWC:r,directionWC:s,frustum:a}=n,l=e._computeCommandList,u=e._overlayCommandList;e.debugShowFrustums&&(this.debugFrustumStatistics={totalCommands:0,commandsInFrustums:{}});let f=this.frustumCommandsList;for(let N=0;N<f.length;++N)for(let B=0;B<ve.NUMBER_OF_PASSES;++B)f[N].indices[B]=0;l.length=0,u.length=0;let d=this._commandExtents,p=d.length,g=0,m=+Number.MAX_VALUE,b=-Number.MAX_VALUE,{shadowsEnabled:x}=o,T=+Number.MAX_VALUE,C=-Number.MAX_VALUE,S=Number.MAX_VALUE,v=t.mode===oe.SCENE3D?t.occluder:void 0,{cullingVolume:D}=t,I=Bbe.planes;for(let N=0;N<5;++N)I[N]=D.planes[N];D=Bbe;for(let N=0;N<i.length;++N){let B=i[N],{pass:_,boundingVolume:w}=B;if(_===ve.COMPUTE)l.push(B);else if(_===ve.OVERLAY)u.push(B);else{let P,O;if(c(w)){if(!e.isVisible(D,B,v))continue;let V=w.computePlaneDistances(r,s,Egt);if(P=V.start,O=V.stop,m=Math.min(m,P),b=Math.max(b,O),x&&B.receiveShadows&&P<tx.MAXIMUM_DISTANCE&&!(_===ve.GLOBE&&P<-100&&O>100)){let G=O-P;_!==ve.GLOBE&&P<100&&(S=Math.min(S,G)),T=Math.min(T,P),C=Math.max(C,O)}}else B instanceof ri?(P=a.near,O=a.far):(P=a.near,O=a.far,m=Math.min(m,P),b=Math.max(b,O));let F=d[g];c(F)||(F=d[g]=new xgt),F.command=B,F.near=P,F.far=O,g++}}x&&(T=Math.min(Math.max(T,a.near),a.far),C=Math.max(Math.min(C,a.far),T),o.nearPlane=T,o.farPlane=C,o.closestObjectSize=S),Agt(this,e,m,b);for(let N=0;N<g;N++)Cgt(this,e,d[N]);if(g<p)for(let N=g;N<p;N++){let B=d[N];if(!c(B.command))break;B.command=void 0}let L=f.length,{frustumSplits:M}=t;M.length=L+1;for(let N=0;N<L;++N)M[N]=f[N].near,N===L-1&&(M[N+1]=f[N].far)};$N.prototype.destroy=function(){this.pickFramebuffer=this.pickFramebuffer&&this.pickFramebuffer.destroy(),this.pickDepthFramebuffer=this.pickDepthFramebuffer&&this.pickDepthFramebuffer.destroy(),this.sceneFramebuffer=this.sceneFramebuffer&&this.sceneFramebuffer.destroy(),this.globeDepth=this.globeDepth&&this.globeDepth.destroy(),this.oit=this.oit&&this.oit.destroy(),this.translucentTileClassification=this.translucentTileClassification&&this.translucentTileClassification.destroy(),this.globeTranslucencyFramebuffer=this.globeTranslucencyFramebuffer&&this.globeTranslucencyFramebuffer.destroy();let e=this.pickDepths;for(let t=0;t<e.length;++t)e[t].destroy()};var uP=$N;var Vbe=.1,Sgt=new sm({pass:Ro.MOST_DETAILED_PRELOAD}),wgt=new sm({pass:Ro.MOST_DETAILED_PICK}),fP=new sm({pass:Ro.PICK});function zs(e){this._mostDetailedRayPicks=[],this.pickRenderStateCache={},this._pickPositionCache={},this._pickPositionCacheDirty=!1;let t=new Ke(0,0,1,1),n=new so(e);n.frustum=new rn({width:Vbe,aspectRatio:1,near:.1}),this._pickOffscreenView=new uP(e,n,t)}zs.prototype.update=function(){this._pickPositionCacheDirty=!0};zs.prototype.getPickDepth=function(e,t){let n=e.view.pickDepths,i=n[t];return c(i)||(i=new VY,n[t]=i),i};var vgt=new er,Dgt=new h,ZN=new h,Pgt=new H,Igt=new k;function Ogt(e,t,n,i,o){let r=e.camera,s=r.frustum,a=s.offCenterFrustum;c(a)&&(s=a);let l=2*(t.x-o.x)/o.width-1;l*=(s.right-s.left)*.5;let u=2*(o.height-t.y-o.y)/o.height-1;u*=(s.top-s.bottom)*.5;let f=k.clone(r.transform,Igt);r._setTransform(k.IDENTITY);let d=h.clone(r.position,Dgt);h.multiplyByScalar(r.right,l,ZN),h.add(ZN,d,d),h.multiplyByScalar(r.up,u,ZN),h.add(ZN,d,d),r._setTransform(f),e.mode===oe.SCENE2D&&h.fromElements(d.z,d.x,d.y,d);let p=s.getPixelDimensions(o.width,o.height,1,1,Pgt),g=vgt;return g.right=p.x*.5,g.left=-g.right,g.top=p.y*.5,g.bottom=-g.top,g.near=s.near,g.far=s.far,g.computeCullingVolume(d,r.directionWC,r.upWC)}var Rgt=new lu,Mgt=new H;function Lgt(e,t,n,i,o){let r=e.camera,s=r.frustum,a=s.near,l=Math.tan(s.fovy*.5),u=s.aspectRatio*l,f=2*(t.x-o.x)/o.width-1,d=2*(o.height-t.y-o.y)/o.height-1,p=f*a*u,g=d*a*l,m=s.getPixelDimensions(o.width,o.height,1,1,Mgt),b=m.x*n*.5,x=m.y*i*.5,T=Rgt;return T.top=g+x,T.bottom=g-x,T.right=p+b,T.left=p-b,T.near=a,T.far=s.far,T.computeCullingVolume(r.positionWC,r.directionWC,r.upWC)}function JN(e,t,n,i,o){let r=e.camera.frustum;return r instanceof rn||r instanceof er?Ogt(e,t,n,i,o):Lgt(e,t,n,i,o)}var QN=new Ke(0,0,3,3),eF=new H,dP=new j(0,0,0,0);function ZY(e,t,n,i,o){return o.width=y(n,3),o.height=y(i,o.width),o.x=t.x-(o.width-1)*.5,o.y=e-t.y-(o.height-1)*.5,o}zs.prototype.pick=function(e,t,n,i){A.defined("windowPosition",t);let{context:o,frameState:r,defaultView:s}=e,{viewport:a,pickFramebuffer:l}=s;e.view=s,a.x=0,a.y=0,a.width=o.drawingBufferWidth,a.height=o.drawingBufferHeight;let u=s.passState;u.viewport=Ke.clone(a,u.viewport);let f=Ni.transformWindowToDrawingBuffer(e,t,eF),d=ZY(o.drawingBufferHeight,f,n,i,QN);e.jobScheduler.disableThisFrame(),e.updateFrameState(),r.cullingVolume=JN(e,f,d.width,d.height,a),r.invertClassification=!1,r.passes.pick=!0,r.tilesetPassState=fP,o.uniformState.update(r),e.updateEnvironment(),u=l.begin(d,a),e.updateAndExecuteCommands(u,dP),e.resolveFramebuffers(u);let p=l.end(d);return o.endFrame(),p};zs.prototype.pickVoxelCoordinate=function(e,t,n,i){A.defined("windowPosition",t);let{context:o,frameState:r,defaultView:s}=e,{viewport:a,pickFramebuffer:l}=s;e.view=s,a.x=0,a.y=0,a.width=o.drawingBufferWidth,a.height=o.drawingBufferHeight;let u=s.passState;u.viewport=Ke.clone(a,u.viewport);let f=Ni.transformWindowToDrawingBuffer(e,t,eF),d=ZY(o.drawingBufferHeight,f,n,i,QN);e.jobScheduler.disableThisFrame(),e.updateFrameState(),r.cullingVolume=JN(e,f,d.width,d.height,a),r.invertClassification=!1,r.passes.pickVoxel=!0,r.tilesetPassState=fP,o.uniformState.update(r),e.updateEnvironment(),u=l.begin(d,a),e.updateAndExecuteCommands(u,dP),e.resolveFramebuffers(u);let p=l.readCenterPixel(d);return o.endFrame(),p};zs.prototype.pickMetadata=function(e,t,n){A.typeOf.object("windowPosition",t),A.typeOf.object("pickedMetadataInfo",n);let{context:i,frameState:o,defaultView:r}=e,{viewport:s,pickFramebuffer:a}=r;e.view=r,s.x=0,s.y=0,s.width=i.drawingBufferWidth,s.height=i.drawingBufferHeight;let l=r.passState;l.viewport=Ke.clone(s,l.viewport);let u=Ni.transformWindowToDrawingBuffer(e,t,eF),f=ZY(i.drawingBufferHeight,u,1,1,QN);e.jobScheduler.disableThisFrame(),e.updateFrameState(),o.cullingVolume=JN(e,u,f.width,f.height,s),o.invertClassification=!1,o.passes.pick=!0,o.tilesetPassState=fP,o.pickingMetadata=!0,o.pickedMetadataInfo=n,i.uniformState.update(o),e.updateEnvironment(),l=a.begin(f,s),e.updateAndExecuteCommands(l,dP);let d=e._environmentState.useOIT;e._environmentState.useOIT=!1,e.resolveFramebuffers(l),e._environmentState.useOIT=d;let p=a.readCenterPixel(f);return i.endFrame(),o.pickingMetadata=!1,IY.decodeMetadataValues(n.classProperty,p)};function Ngt(e,t){let{defaultView:n,context:i,frameState:o,environmentState:r}=e,{viewport:s,pickDepthFramebuffer:a}=n;e.view=n,s.x=0,s.y=0,s.width=i.drawingBufferWidth,s.height=i.drawingBufferHeight;let l=n.passState;l.viewport=Ke.clone(s,l.viewport),e.clearPasses(o.passes),o.passes.pick=!0,o.passes.depth=!0,o.cullingVolume=JN(e,t,1,1,s),o.tilesetPassState=fP,e.updateEnvironment(),r.renderTranslucentDepthForPick=!0,l=a.update(i,t,s),e.updateAndExecuteCommands(l,dP),e.resolveFramebuffers(l),i.endFrame()}var Fgt=new vi,Bgt=new lu,kgt=new rn,Vgt=new er;zs.prototype.pickPositionWorldCoordinates=function(e,t,n){if(!e.useDepthPicking)return;if(A.defined("windowPosition",t),!e.context.depthTexture)throw new E("Picking from the depth buffer is not supported. Check pickPositionSupported.");let i=t.toString();if(this._pickPositionCacheDirty)this._pickPositionCache={},this._pickPositionCacheDirty=!1;else if(this._pickPositionCache.hasOwnProperty(i))return h.clone(this._pickPositionCache[i],n);let{context:o,frameState:r,camera:s,defaultView:a}=e,{uniformState:l}=o;e.view=a;let u=Ni.transformWindowToDrawingBuffer(e,t,eF);e.pickTranslucentDepth?Ngt(e,u):(e.updateFrameState(),l.update(r),e.updateEnvironment()),u.y=e.drawingBufferHeight-u.y;let f;c(s.frustum.fov)?f=s.frustum.clone(Fgt):c(s.frustum.infiniteProjectionMatrix)?f=s.frustum.clone(Bgt):c(s.frustum.width)?f=s.frustum.clone(kgt):f=s.frustum.clone(Vgt);let{frustumCommandsList:d}=a,p=d.length;for(let g=0;g<p;++g){let b=this.getPickDepth(e,g).getDepth(o,u.x,u.y);if(c(b)&&b>0&&b<1){let x=d[g],T;return e.mode===oe.SCENE2D?(T=s.position.z,s.position.z=T-x.near+1,f.far=Math.max(1,x.far-x.near),f.near=1,l.update(r),l.updateFrustum(f)):(f.near=x.near*(g!==0?e.opaqueFrustumNearOffset:1),f.far=x.far,l.updateFrustum(f)),n=Ni.drawingBufferToWorldCoordinates(e,u,b,n),e.mode===oe.SCENE2D&&(s.position.z=T,l.update(r)),this._pickPositionCache[i]=h.clone(n),n}}this._pickPositionCache[i]=void 0};var Ugt=new he;zs.prototype.pickPosition=function(e,t,n){if(n=this.pickPositionWorldCoordinates(e,t,n),c(n)&&e.mode!==oe.SCENE3D){h.fromElements(n.y,n.z,n.x,n);let i=e.mapProjection,o=i.ellipsoid,r=i.unproject(n,Ugt);o.cartographicToCartesian(r,n)}return n};function Ube(e,t){let n,i,o=[],r=[],s=[],a=[];c(e)||(e=Number.MAX_VALUE);let l=t();for(;c(l);){let u=l.object,f=l.position,d=l.exclude;if(c(f)&&!c(u)){o.push(l);break}if(!c(u)||!c(u.primitive)||!d&&(o.push(l),0>=--e))break;let p=u.primitive,g=!1;typeof p.getGeometryInstanceAttributes=="function"&&c(u.id)&&(i=p.getGeometryInstanceAttributes(u.id),c(i)&&c(i.show)&&(g=!0,i.show=Cn.toValue(!1,i.show),s.push(i))),u instanceof Ws&&(g=!0,u.show=!1,a.push(u)),g||(p.show=!1,r.push(p)),l=t()}for(n=0;n<r.length;++n)r[n].show=!0;for(n=0;n<s.length;++n)i=s[n],i.show=Cn.toValue(!0,i.show);for(n=0;n<a.length;++n)a[n].show=!0;return o}zs.prototype.drillPick=function(e,t,n,i,o){let r=this;return Ube(n,function(){let l=r.pick(e,t,i,o);if(c(l))return{object:l,position:void 0,exclude:!1}}).map(function(l){return l.object})};var kbe=new h,zgt=new h;function Hgt(e,t,n){this.ray=e,this.width=t,this.tilesets=n,this.ready=!1;let i=this;this.promise=new Promise(o=>{i._completePick=()=>{o()}})}function zbe(e,t,n,i){let o=t.direction,r=h.mostOrthogonalAxis(o,kbe),s=h.cross(o,r,kbe),a=h.cross(o,s,zgt);return i.position=t.origin,i.direction=o,i.up=a,i.right=s,i.frustum.width=y(n,Vbe),i.frustum.computeCullingVolume(i.positionWC,i.directionWC,i.upWC)}function Ggt(e,t,n){let i=t.frameState,{ray:o,width:r,tilesets:s}=n,a=e._pickOffscreenView.camera,l=zbe(e,o,r,a),u=Sgt;u.camera=a,u.cullingVolume=l;let f=!0,d=s.length;for(let p=0;p<d;++p){let g=s[p];g.show&&t.primitives.contains(g)&&(g.updateForPass(i,u),f=f&&u.ready)}return f&&n._completePick(),f}zs.prototype.updateMostDetailedRayPicks=function(e){let t=this._mostDetailedRayPicks;for(let n=0;n<t.length;++n)Ggt(this,e,t[n])&&t.splice(n--,1)};function Hbe(e,t,n){for(let i=0;i<e.length;++i){let o=e.get(i);o.show&&(c(o.isCesium3DTileset)?(!c(t)||t.indexOf(o)===-1)&&n.push(o):o instanceof mf&&Hbe(o,t,n))}}function tF(e,t,n,i,o,r){let s=[];if(Hbe(t.primitives,i,s),s.length===0)return Promise.resolve(r());let a=new Hgt(n,o,s);return e._mostDetailedRayPicks.push(a),a.promise.then(function(){return r()})}function jgt(e,t){return!c(e)||!c(t)||t.length===0?!1:t.indexOf(e)>-1||t.indexOf(e.primitive)>-1||t.indexOf(e.id)>-1}function Wgt(e,t,n,i,o,r,s){let{context:a,frameState:l}=t,u=a.uniformState,f=e._pickOffscreenView;t.view=f,zbe(e,n,o,f.camera);let d=Ke.clone(f.viewport,QN),p=f.pickFramebuffer.begin(d,f.viewport);t.jobScheduler.disableThisFrame(),t.updateFrameState(),l.invertClassification=!1,l.passes.pick=!0,l.passes.offscreen=!0,s?l.tilesetPassState=wgt:l.tilesetPassState=fP,u.update(l),t.updateEnvironment(),t.updateAndExecuteCommands(p,dP),t.resolveFramebuffers(p);let g,m=f.pickFramebuffer.end(d);if(t.context.depthTexture){let{frustumCommandsList:b}=f,x=b.length;for(let T=0;T<x;++T){let S=e.getPickDepth(t,T).getDepth(a,0,0);if(c(S)&&S>0&&S<1){let v=b[T],D=v.near*(T!==0?t.opaqueFrustumNearOffset:1),I=v.far,L=D+S*(I-D);g=_n.getPoint(n,L);break}}}if(t.view=t.defaultView,a.endFrame(),c(m)||c(g))return{object:m,position:g,exclude:!c(g)&&r||jgt(m,i)}}function Gbe(e,t,n,i,o,r,s,a){return Ube(i,function(){return Wgt(e,t,n,o,r,s,a)})}function kC(e,t,n,i,o,r,s){let a=Gbe(e,t,n,1,i,o,r,s);if(a.length>0)return a[0]}function jbe(e,t,n,i,o,r,s,a){return Gbe(e,t,n,i,o,r,s,a)}function nF(e,t){return new Promise((n,i)=>{t.then(function(o){let r=e.postRender.addEventListener(function(){r(),n(o)});e.requestRender()}).catch(function(o){i(o)})})}zs.prototype.pickFromRay=function(e,t,n,i){if(A.defined("ray",t),e.mode!==oe.SCENE3D)throw new E("Ray intersections are only supported in 3D mode.");return kC(this,e,t,n,i,!1,!1)};zs.prototype.drillPickFromRay=function(e,t,n,i,o){if(A.defined("ray",t),e.mode!==oe.SCENE3D)throw new E("Ray intersections are only supported in 3D mode.");return jbe(this,e,t,n,i,o,!1,!1)};zs.prototype.pickFromRayMostDetailed=function(e,t,n,i){if(A.defined("ray",t),e.mode!==oe.SCENE3D)throw new E("Ray intersections are only supported in 3D mode.");let o=this;return t=_n.clone(t),n=c(n)?n.slice():n,nF(e,tF(o,e,t,n,i,function(){return kC(o,e,t,n,i,!1,!0)}))};zs.prototype.drillPickFromRayMostDetailed=function(e,t,n,i,o){if(A.defined("ray",t),e.mode!==oe.SCENE3D)throw new E("Ray intersections are only supported in 3D mode.");let r=this;return t=_n.clone(t),i=c(i)?i.slice():i,nF(e,tF(r,e,t,i,o,function(){return jbe(r,e,t,n,i,o,!1,!0)}))};var qgt=new h,Ygt=new h,Xgt=new _n,Wbe=new he;function JY(e,t){let n=e.ellipsoid,i=di._defaultMaxTerrainHeight,o=n.geodeticSurfaceNormalCartographic(t,Ygt),r=he.toCartesian(t,n,qgt),s=Xgt;s.origin=r,s.direction=o;let a=new _n;return _n.getPoint(s,i,a.origin),h.negate(o,a.direction),a}function qbe(e,t){let n=e.ellipsoid,i=he.fromCartesian(t,n,Wbe);return JY(e,i)}function Ybe(e,t){let n=e.ellipsoid;return he.fromCartesian(t,n,Wbe).height}function Kgt(e,t,n,i,o){let r=JY(t,n);return tF(e,t,r,i,o,function(){let s=kC(e,t,r,i,o,!0,!0);if(c(s))return Ybe(t,s.position)})}function $gt(e,t,n,i,o,r){let s=qbe(t,n);return tF(e,t,s,i,o,function(){let a=kC(e,t,s,i,o,!0,!0);if(c(a))return h.clone(a.position,r)})}zs.prototype.sampleHeight=function(e,t,n,i){if(A.defined("position",t),e.mode!==oe.SCENE3D)throw new E("sampleHeight is only supported in 3D mode.");if(!e.sampleHeightSupported)throw new E("sampleHeight requires depth texture support. Check sampleHeightSupported.");let o=JY(e,t),r=kC(this,e,o,n,i,!0,!1);if(c(r))return Ybe(e,r.position)};zs.prototype.clampToHeight=function(e,t,n,i,o){if(A.defined("cartesian",t),e.mode!==oe.SCENE3D)throw new E("clampToHeight is only supported in 3D mode.");if(!e.clampToHeightSupported)throw new E("clampToHeight requires depth texture support. Check clampToHeightSupported.");let r=qbe(e,t),s=kC(this,e,r,n,i,!0,!1);if(c(s))return h.clone(s.position,o)};zs.prototype.sampleHeightMostDetailed=function(e,t,n,i){if(A.defined("positions",t),e.mode!==oe.SCENE3D)throw new E("sampleHeightMostDetailed is only supported in 3D mode.");if(!e.sampleHeightSupported)throw new E("sampleHeightMostDetailed requires depth texture support. Check sampleHeightSupported.");n=c(n)?n.slice():n;let o=t.length,r=new Array(o);for(let s=0;s<o;++s)r[s]=Kgt(this,e,t[s],n,i);return nF(e,Promise.all(r).then(function(s){let a=s.length;for(let l=0;l<a;++l)t[l].height=s[l];return t}))};zs.prototype.clampToHeightMostDetailed=function(e,t,n,i){if(A.defined("cartesians",t),e.mode!==oe.SCENE3D)throw new E("clampToHeightMostDetailed is only supported in 3D mode.");if(!e.clampToHeightSupported)throw new E("clampToHeightMostDetailed requires depth texture support. Check clampToHeightSupported.");n=c(n)?n.slice():n;let o=t.length,r=new Array(o);for(let s=0;s<o;++s)r[s]=$gt(this,e,t[s],n,i,t[s]);return nF(e,Promise.all(r).then(function(s){let a=s.length;for(let l=0;l<a;++l)t[l]=s[l];return t}))};zs.prototype.destroy=function(){this._pickOffscreenView=this._pickOffscreenView&&this._pickOffscreenView.destroy()};var QY=zs;var $be=Ur(UP(),1);var Zgt={modifyFragmentShader:function(t){return t=Ge.replaceMain(t,"czm_splitter_main"),t+=`uniform float czm_splitDirection; 
void main() 
{ 
#ifndef SHADOW_MAP
    if (czm_splitDirection < 0.0 && gl_FragCoord.x > czm_splitPosition) discard; 
    if (czm_splitDirection > 0.0 && gl_FragCoord.x < czm_splitPosition) discard; 
#endif
    czm_splitter_main(); 
} 
`,t},addUniforms:function(t,n){n.czm_splitDirection=function(){return t.splitDirection}}},iF=Zgt;var nx={NEEDS_DECODE:0,DECODING:1,READY:2,FAILED:3};function hP(e){A.typeOf.object("options",e),A.typeOf.object("options.arrayBuffer",e.arrayBuffer),this._parsedContent=void 0,this._drawCommand=void 0,this._isTranslucent=!1,this._styleTranslucent=!1,this._constantColor=j.clone(j.DARKGRAY),this._highlightColor=j.clone(j.WHITE),this._pointSize=1,this._rtcCenter=void 0,this._quantizedVolumeScale=void 0,this._quantizedVolumeOffset=void 0,this._styleableShaderAttributes=void 0,this._isQuantized=!1,this._isOctEncoded16P=!1,this._isRGB565=!1,this._hasColors=!1,this._hasNormals=!1,this._hasBatchIds=!1,this._decodingState=nx.READY,this._dequantizeInShader=!0,this._isQuantizedDraco=!1,this._isOctEncodedDraco=!1,this._quantizedRange=0,this._octEncodedRange=0,this.backFaceCulling=!1,this._backFaceCulling=!1,this.normalShading=!0,this._normalShading=!0,this._opaqueRenderState=void 0,this._translucentRenderState=void 0,this._mode=void 0,this._ready=!1,this._pointsLength=0,this._geometryByteLength=0,this._vertexShaderLoaded=e.vertexShaderLoaded,this._fragmentShaderLoaded=e.fragmentShaderLoaded,this._uniformMapLoaded=e.uniformMapLoaded,this._batchTableLoaded=e.batchTableLoaded,this._pickIdLoaded=e.pickIdLoaded,this._opaquePass=y(e.opaquePass,ve.OPAQUE),this._cull=y(e.cull,!0),this.style=void 0,this._style=void 0,this.styleDirty=!1,this.modelMatrix=k.clone(k.IDENTITY),this._modelMatrix=k.clone(k.IDENTITY),this.time=0,this.shadows=En.ENABLED,this._boundingSphere=void 0,this.clippingPlanes=void 0,this.isClipped=!1,this.clippingPlanesDirty=!1,this.clippingPlanesOriginMatrix=void 0,this.attenuation=!1,this._attenuation=!1,this.geometricError=0,this.geometricErrorScale=1,this.maximumAttenuation=this._pointSize,this.splitDirection=y(e.splitDirection,$r.NONE),this._splittingEnabled=!1,this._error=void 0,Jgt(this,e)}Object.defineProperties(hP.prototype,{pointsLength:{get:function(){return this._pointsLength}},geometryByteLength:{get:function(){return this._geometryByteLength}},ready:{get:function(){return this._ready}},color:{get:function(){return j.clone(this._highlightColor)},set:function(e){this._highlightColor=j.clone(e,this._highlightColor)}},boundingSphere:{get:function(){if(c(this._drawCommand))return this._drawCommand.boundingVolume},set:function(e){this._boundingSphere=ce.clone(e,this._boundingSphere)}}});function Jgt(e,t){let n=yw.parse(t.arrayBuffer,t.byteOffset);if(e._parsedContent=n,e._rtcCenter=n.rtcCenter,e._hasNormals=n.hasNormals,e._hasColors=n.hasColors,e._hasBatchIds=n.hasBatchIds,e._isTranslucent=n.isTranslucent,!n.hasBatchIds&&c(n.batchTableBinary)&&(n.styleableProperties=r0.getBinaryProperties(n.pointsLength,n.batchTableJson,n.batchTableBinary)),c(n.draco)){let a=n.draco;e._decodingState=nx.NEEDS_DECODE,a.dequantizeInShader=e._dequantizeInShader}let i=n.positions;c(i)&&(e._isQuantized=i.isQuantized,e._quantizedVolumeScale=i.quantizedVolumeScale,e._quantizedVolumeOffset=i.quantizedVolumeOffset,e._quantizedRange=i.quantizedRange);let o=n.normals;c(o)&&(e._isOctEncoded16P=o.octEncoded);let r=n.colors;c(r)&&(c(r.constantColor)&&(e._constantColor=j.clone(r.constantColor,e._constantColor),e._hasColors=!1),e._isRGB565=r.isRGB565);let s=n.batchIds;c(n.batchIds)&&(s.name="BATCH_ID",s.semantic="BATCH_ID",s.setIndex=void 0),n.hasBatchIds&&e._batchTableLoaded(n.batchLength,n.batchTableJson,n.batchTableBinary),e._pointsLength=n.pointsLength}var Qgt=new h,eyt=new h,tyt=new h,Xbe,oF;function nyt(e){if(!c(oF)){Xbe=new $be.default(0),oF=new Array(e);for(let t=0;t<e;++t)oF[t]=Xbe.random()}return oF}function iyt(e){let n=e.length/3,i=Math.min(n,20),o=nyt(20),r=Number.MAX_VALUE,s=-Number.MAX_VALUE,a=h.fromElements(r,r,r,Qgt),l=h.fromElements(s,s,s,eyt);for(let f=0;f<i;++f){let d=Math.floor(o[f]*n),p=h.unpack(e,d*3,tyt);h.minimumByComponent(a,p,a),h.maximumByComponent(l,p,l)}let u=ce.fromCornerPoints(a,l);return u.radius+=R.EPSILON2,u}function Kbe(e,t){let n=$.fromTypedArray(e);return n===$.INT||n===$.UNSIGNED_INT||n===$.DOUBLE?(_t("Cast pnts property to floats",`Point cloud property "${t}" will be cast to a float array because INT, UNSIGNED_INT, and DOUBLE are not valid WebGL vertex attribute types. Some precision may be lost.`),new Float32Array(e)):e}var oyt=new se,ryt=new se,syt=new j,Zbe=0,rF=1,oX=2,Jbe=3,ayt=4,eX=new k,cyt=new k;function lyt(e,t){let n=t.context,i=e._parsedContent,o=e._pointsLength,r=i.positions,s=i.colors,a=i.normals,l=i.batchIds,u=i.styleableProperties,f=c(u),d=e._isQuantized,p=e._isQuantizedDraco,g=e._isOctEncoded16P,m=e._isOctEncodedDraco,b=e._quantizedRange,x=e._octEncodedRange,T=e._isRGB565,C=e._isTranslucent,S=e._hasColors,v=e._hasNormals,D=e._hasBatchIds,I,L,M=[],N={};if(e._styleableShaderAttributes=N,f){let z=ayt;for(let W in u)if(u.hasOwnProperty(W)){let U=u[W],q=Kbe(U.typedArray,W);I=U.componentCount,L=$.fromTypedArray(q);let K=xt.createVertexBuffer({context:n,typedArray:q,usage:ke.STATIC_DRAW});e._geometryByteLength+=K.sizeInBytes;let te={index:z,vertexBuffer:K,componentsPerAttribute:I,componentDatatype:L,normalize:!1,offsetInBytes:0,strideInBytes:0};M.push(te),N[W]={location:z,componentCount:I},++z}}let B=xt.createVertexBuffer({context:n,typedArray:r.typedArray,usage:ke.STATIC_DRAW});e._geometryByteLength+=B.sizeInBytes;let _;S&&(_=xt.createVertexBuffer({context:n,typedArray:s.typedArray,usage:ke.STATIC_DRAW}),e._geometryByteLength+=_.sizeInBytes);let w;v&&(w=xt.createVertexBuffer({context:n,typedArray:a.typedArray,usage:ke.STATIC_DRAW}),e._geometryByteLength+=w.sizeInBytes);let P;D&&(l.typedArray=Kbe(l.typedArray,"batchIds"),P=xt.createVertexBuffer({context:n,typedArray:l.typedArray,usage:ke.STATIC_DRAW}),e._geometryByteLength+=P.sizeInBytes);let O=[];if(d?L=$.UNSIGNED_SHORT:p?L=b<=255?$.UNSIGNED_BYTE:$.UNSIGNED_SHORT:L=$.FLOAT,O.push({index:Zbe,vertexBuffer:B,componentsPerAttribute:3,componentDatatype:L,normalize:!1,offsetInBytes:0,strideInBytes:0}),e._cull&&(d||p?e._boundingSphere=ce.fromCornerPoints(h.ZERO,e._quantizedVolumeScale):e._boundingSphere=iyt(r.typedArray)),S)if(T)O.push({index:rF,vertexBuffer:_,componentsPerAttribute:1,componentDatatype:$.UNSIGNED_SHORT,normalize:!1,offsetInBytes:0,strideInBytes:0});else{let z=C?4:3;O.push({index:rF,vertexBuffer:_,componentsPerAttribute:z,componentDatatype:$.UNSIGNED_BYTE,normalize:!0,offsetInBytes:0,strideInBytes:0})}v&&(g?(I=2,L=$.UNSIGNED_BYTE):m?(I=2,L=x<=255?$.UNSIGNED_BYTE:$.UNSIGNED_SHORT):(I=3,L=$.FLOAT),O.push({index:oX,vertexBuffer:w,componentsPerAttribute:I,componentDatatype:L,normalize:!1,offsetInBytes:0,strideInBytes:0})),D&&O.push({index:Jbe,vertexBuffer:P,componentsPerAttribute:1,componentDatatype:$.fromTypedArray(l.typedArray),normalize:!1,offsetInBytes:0,strideInBytes:0}),f&&(O=O.concat(M));let F=new ni({context:n,attributes:O}),V={depthTest:{enabled:!0}},G={depthTest:{enabled:!0},depthMask:!1,blending:hn.ALPHA_BLEND};e._opaquePass===ve.CESIUM_3D_TILE&&(V.stencilTest=Ut.setCesium3DTileBit(),V.stencilMask=Ut.CESIUM_3D_TILE_MASK,G.stencilTest=Ut.setCesium3DTileBit(),G.stencilMask=Ut.CESIUM_3D_TILE_MASK),e._opaqueRenderState=ze.fromCache(V),e._translucentRenderState=ze.fromCache(G),e._drawCommand=new et({boundingVolume:new ce,cull:e._cull,modelMatrix:new k,primitiveType:Me.POINTS,vertexArray:F,count:o,shaderProgram:void 0,uniformMap:void 0,renderState:C?e._translucentRenderState:e._opaqueRenderState,pass:C?ve.TRANSLUCENT:e._opaquePass,owner:e,castShadows:!1,receiveShadows:!1,pickId:e._pickIdLoaded()})}function uyt(e,t){let n=t.context,i=e._isQuantized,o=e._isQuantizedDraco,r=e._isOctEncodedDraco,s={u_pointSizeAndTimeAndGeometricErrorAndDepthMultiplier:function(){let a=oyt;if(a.x=e._attenuation?e.maximumAttenuation:e._pointSize,a.x*=t.pixelRatio,a.y=e.time,e._attenuation){let l=t.camera.frustum,u;t.mode===oe.SCENE2D||l instanceof rn?u=Number.POSITIVE_INFINITY:u=n.drawingBufferHeight/t.camera.frustum.sseDenominator,a.z=e.geometricError*e.geometricErrorScale,a.w=u}return a},u_highlightColor:function(){return e._highlightColor},u_constantColor:function(){return e._constantColor},u_clippingPlanes:function(){let a=e.clippingPlanes;return e.isClipped?a.texture:n.defaultTexture},u_clippingPlanesEdgeStyle:function(){let a=e.clippingPlanes;if(!c(a))return j.TRANSPARENT;let l=j.clone(a.edgeColor,syt);return l.alpha=a.edgeWidth,l},u_clippingPlanesMatrix:function(){let a=e.clippingPlanes;if(!c(a))return k.IDENTITY;let l=y(e.clippingPlanesOriginMatrix,e._modelMatrix);k.multiply(n.uniformState.view3D,l,eX);let u=k.multiply(eX,a.modelMatrix,eX);return k.inverseTranspose(u,cyt)}};iF.addUniforms(e,s),(i||o||r)&&(s=At(s,{u_quantizedVolumeScaleAndOctEncodedRange:function(){let a=ryt;if(c(e._quantizedVolumeScale)){let l=h.clone(e._quantizedVolumeScale,a);h.divideByScalar(l,e._quantizedRange,a)}return a.w=e._octEncodedRange,a}})),c(e._uniformMapLoaded)&&(s=e._uniformMapLoaded(s)),e._drawCommand.uniformMap=s}function tX(e,t){let n=/czm_3dtiles_property_(\d+)/g,i=n.exec(e);for(;i!==null;){let o=parseInt(i[1]);t.indexOf(o)===-1&&t.push(o),i=n.exec(e)}}function nX(e,t){e=e.slice(e.indexOf(`
`));let n=/czm_3dtiles_builtin_property_(\w+)/g,i=n.exec(e);for(;i!==null;){let o=i[1];t.indexOf(o)===-1&&t.push(o),i=n.exec(e)}}function iX(e,t){let n=e.numberOfAttributes;for(let i=0;i<n;++i){let o=e.getAttribute(i);if(o.index===t)return o}}var fyt={POSITION:"czm_3dtiles_builtin_property_POSITION",POSITION_ABSOLUTE:"czm_3dtiles_builtin_property_POSITION_ABSOLUTE",COLOR:"czm_3dtiles_builtin_property_COLOR",NORMAL:"czm_3dtiles_builtin_property_NORMAL"};function dyt(e,t,n){let i,o,r,s=t.context,a=c(n),l=e._isQuantized,u=e._isQuantizedDraco,f=e._isOctEncoded16P,d=e._isOctEncodedDraco,p=e._isRGB565,g=e._isTranslucent,m=e._hasColors,b=e._hasNormals,x=e._hasBatchIds,T=e._backFaceCulling,C=e._normalShading,S=e._drawCommand.vertexArray,v=e.clippingPlanes,D=e._attenuation,I,L,M,N=g,B=qe(fyt),_={},w=e._styleableShaderAttributes;for(o in w)w.hasOwnProperty(o)&&(r=w[o],B[o]=`czm_3dtiles_property_${r.location}`,_[r.location]=r);if(a){let le={translucent:!1},ge="(vec3 czm_3dtiles_builtin_property_POSITION, vec3 czm_3dtiles_builtin_property_POSITION_ABSOLUTE, vec4 czm_3dtiles_builtin_property_COLOR, vec3 czm_3dtiles_builtin_property_NORMAL)";I=n.getColorShaderFunction(`getColorFromStyle${ge}`,B,le),L=n.getShowShaderFunction(`getShowFromStyle${ge}`,B,le),M=n.getPointSizeShaderFunction(`getPointSizeFromStyle${ge}`,B,le),c(I)&&le.translucent&&(N=!0)}e._styleTranslucent=N;let P=c(I),O=c(L),F=c(M),V=e.isClipped,G=[],z=[];P&&(tX(I,G),nX(I,z)),O&&(tX(L,G),nX(L,z)),F&&(tX(M,G),nX(M,z));let W=z.indexOf("COLOR")>=0,U=z.indexOf("NORMAL")>=0;if(U&&!b)throw new ue("Style references the NORMAL semantic but the point cloud does not have normals");for(o in w)if(w.hasOwnProperty(o)){r=w[o];let le=G.indexOf(r.location)>=0,ge=iX(S,r.location);ge.enabled=le}let q=m&&(!P||W);if(m){let le=iX(S,rF);le.enabled=q}let K=b&&(C||T||U);if(b){let le=iX(S,oX);le.enabled=K}let te={a_position:Zbe};q&&(te.a_color=rF),K&&(te.a_normal=oX),x&&(te.a_batchId=Jbe);let Y="",Z=G.length;for(i=0;i<Z;++i){let le=G[i];r=_[le];let ge=r.componentCount,xe=`czm_3dtiles_property_${le}`,Pe;ge===1?Pe="float":Pe=`vec${ge}`,Y+=`in ${Pe} ${xe}; 
`,te[xe]=r.location}uyt(e,t);let ee=`in vec3 a_position; 
out vec4 v_color; 
uniform vec4 u_pointSizeAndTimeAndGeometricErrorAndDepthMultiplier; 
uniform vec4 u_constantColor; 
uniform vec4 u_highlightColor; 
`;ee+=`float u_pointSize; 
float tiles3d_tileset_time; 
`,D&&(ee+=`float u_geometricError; 
float u_depthMultiplier; 
`),ee+=Y,q&&(g?ee+=`in vec4 a_color; 
`:p?ee+=`in float a_color; 
const float SHIFT_RIGHT_11 = 1.0 / 2048.0; 
const float SHIFT_RIGHT_5 = 1.0 / 32.0; 
const float SHIFT_LEFT_11 = 2048.0; 
const float SHIFT_LEFT_5 = 32.0; 
const float NORMALIZE_6 = 1.0 / 64.0; 
const float NORMALIZE_5 = 1.0 / 32.0; 
`:ee+=`in vec3 a_color; 
`),K&&(f||d?ee+=`in vec2 a_normal; 
`:ee+=`in vec3 a_normal; 
`),x&&(ee+=`in float a_batchId; 
`),(l||u||d)&&(ee+=`uniform vec4 u_quantizedVolumeScaleAndOctEncodedRange; 
`),P&&(ee+=I),O&&(ee+=L),F&&(ee+=M),ee+=`void main() 
{ 
    u_pointSize = u_pointSizeAndTimeAndGeometricErrorAndDepthMultiplier.x; 
    tiles3d_tileset_time = u_pointSizeAndTimeAndGeometricErrorAndDepthMultiplier.y; 
`,D&&(ee+=`    u_geometricError = u_pointSizeAndTimeAndGeometricErrorAndDepthMultiplier.z; 
    u_depthMultiplier = u_pointSizeAndTimeAndGeometricErrorAndDepthMultiplier.w; 
`),q?g?ee+=`    vec4 color = a_color; 
`:p?ee+=`    float compressed = a_color; 
    float r = floor(compressed * SHIFT_RIGHT_11); 
    compressed -= r * SHIFT_LEFT_11; 
    float g = floor(compressed * SHIFT_RIGHT_5); 
    compressed -= g * SHIFT_LEFT_5; 
    float b = compressed; 
    vec3 rgb = vec3(r * NORMALIZE_5, g * NORMALIZE_6, b * NORMALIZE_5); 
    vec4 color = vec4(rgb, 1.0); 
`:ee+=`    vec4 color = vec4(a_color, 1.0); 
`:ee+=`    vec4 color = u_constantColor; 
`,l||u?ee+=`    vec3 position = a_position * u_quantizedVolumeScaleAndOctEncodedRange.xyz; 
`:ee+=`    vec3 position = a_position; 
`,ee+=`    vec3 position_absolute = vec3(czm_model * vec4(position, 1.0)); 
`,K?(f?ee+=`    vec3 normal = czm_octDecode(a_normal); 
`:d?ee+=`    vec3 normal = czm_octDecode(a_normal, u_quantizedVolumeScaleAndOctEncodedRange.w).zxy; 
`:ee+=`    vec3 normal = a_normal; 
`,ee+=`    vec3 normalEC = czm_normal * normal; 
`):ee+=`    vec3 normal = vec3(1.0); 
`,P&&(ee+=`    color = getColorFromStyle(position, position_absolute, color, normal); 
`),O&&(ee+=`    float show = float(getShowFromStyle(position, position_absolute, color, normal)); 
`),F?ee+=`    gl_PointSize = getPointSizeFromStyle(position, position_absolute, color, normal) * czm_pixelRatio; 
`:D?ee+=`    vec4 positionEC = czm_modelView * vec4(position, 1.0); 
    float depth = -positionEC.z; 
    gl_PointSize = min((u_geometricError / depth) * u_depthMultiplier, u_pointSize); 
`:ee+=`    gl_PointSize = u_pointSize; 
`,ee+=`    color = color * u_highlightColor; 
`,K&&C&&(ee+=`    float diffuseStrength = czm_getLambertDiffuse(czm_lightDirectionEC, normalEC); 
    diffuseStrength = max(diffuseStrength, 0.4); 
    color.xyz *= diffuseStrength * czm_lightColor; 
`),ee+=`    v_color = color; 
    gl_Position = czm_modelViewProjection * vec4(position, 1.0); 
`,K&&T&&(ee+=`    float visible = step(-normalEC.z, 0.0); 
    gl_Position *= visible; 
    gl_PointSize *= visible; 
`),O&&(ee+=`    gl_Position.w *= float(show); 
    gl_PointSize *= float(show); 
`),ee+=`} 
`;let me=`in vec4 v_color; 
`;V&&(me+=`uniform highp sampler2D u_clippingPlanes; 
uniform mat4 u_clippingPlanesMatrix; 
uniform vec4 u_clippingPlanesEdgeStyle; 
`,me+=`
`,me+=Hb(v,s),me+=`
`),me+=`void main() 
{ 
    out_FragColor = czm_gammaCorrect(v_color); 
`,V&&(me+=k7("u_clippingPlanes","u_clippingPlanesMatrix","u_clippingPlanesEdgeStyle")),me+=`} 
`,e.splitDirection!==$r.NONE&&(me=iF.modifyFragmentShader(me)),c(e._vertexShaderLoaded)&&(ee=e._vertexShaderLoaded(ee)),c(e._fragmentShaderLoaded)&&(me=e._fragmentShaderLoaded(me));let be=e._drawCommand;c(be.shaderProgram)&&be.shaderProgram.destroy(),be.shaderProgram=an.fromCache({context:s,vertexShaderSource:ee,fragmentShaderSource:me,attributeLocations:te});try{be.shaderProgram._bind()}catch{throw new ue("Error generating style shader: this may be caused by a type mismatch, index out-of-bounds, or other syntax error.")}}function hyt(e,t){if(e._decodingState===nx.READY)return!1;if(e._decodingState===nx.NEEDS_DECODE){let n=e._parsedContent,i=n.draco,o=d0.decodePointCloud(i,t);c(o)&&(e._decodingState=nx.DECODING,o.then(function(r){e._decodingState=nx.READY;let s=c(r.POSITION)?r.POSITION.array:void 0,a=c(r.RGB)?r.RGB.array:void 0,l=c(r.RGBA)?r.RGBA.array:void 0,u=c(r.NORMAL)?r.NORMAL.array:void 0,f=c(r.BATCH_ID)?r.BATCH_ID.array:void 0,d=c(s)&&c(r.POSITION.data.quantization),p=c(u)&&c(r.NORMAL.data.quantization);if(d){let x=r.POSITION.data.quantization,T=x.range;e._quantizedVolumeScale=h.fromElements(T,T,T),e._quantizedVolumeOffset=h.unpack(x.minValues),e._quantizedRange=(1<<x.quantizationBits)-1,e._isQuantizedDraco=!0}p&&(e._octEncodedRange=(1<<r.NORMAL.data.quantization.quantizationBits)-1,e._isOctEncodedDraco=!0);let g=n.styleableProperties,m=i.batchTableProperties;for(let x in m)if(m.hasOwnProperty(x)){let T=r[x];c(g)||(g={}),g[x]={typedArray:T.array,componentCount:T.data.componentsPerAttribute}}c(s)&&(n.positions={typedArray:s});let b=y(l,a);c(b)&&(n.colors={typedArray:b}),c(u)&&(n.normals={typedArray:u}),c(f)&&(n.batchIds={typedArray:f}),n.styleableProperties=g}).catch(function(r){e._decodingState=nx.FAILED,e._error=r}))}return!0}var myt=new se,pyt=new h;hP.prototype.update=function(e){let t=e.context;if(c(this._error)){let u=this._error;throw this._error=void 0,u}if(hyt(this,t))return;let i=!1,o=!k.equals(this._modelMatrix,this.modelMatrix);if(this._mode!==e.mode&&(this._mode=e.mode,o=!0),c(this._drawCommand)||(lyt(this,e),o=!0,i=!0,this._ready=!0,this._parsedContent=void 0),o){k.clone(this.modelMatrix,this._modelMatrix);let u=this._drawCommand.modelMatrix;if(k.clone(this._modelMatrix,u),c(this._rtcCenter)&&k.multiplyByTranslation(u,this._rtcCenter,u),c(this._quantizedVolumeOffset)&&k.multiplyByTranslation(u,this._quantizedVolumeOffset,u),e.mode!==oe.SCENE3D){let d=e.mapProjection,p=k.getColumn(u,3,myt);se.equals(p,se.UNIT_W)||Ft.basisTo2D(d,u,u)}let f=this._drawCommand.boundingVolume;if(ce.clone(this._boundingSphere,f),this._cull){let d=f.center;k.multiplyByPoint(u,d,d);let p=k.getScale(u,pyt);f.radius*=h.maximumComponent(p)}}this.clippingPlanesDirty&&(this.clippingPlanesDirty=!1,i=!0),this._attenuation!==this.attenuation&&(this._attenuation=this.attenuation,i=!0),this.backFaceCulling!==this._backFaceCulling&&(this._backFaceCulling=this.backFaceCulling,i=!0),this.normalShading!==this._normalShading&&(this._normalShading=this.normalShading,i=!0),(this._style!==this.style||this.styleDirty)&&(this._style=this.style,this.styleDirty=!1,i=!0);let r=this.splitDirection!==$r.NONE;this._splittingEnabled!==r&&(this._splittingEnabled=r,i=!0),i&&dyt(this,e,this._style),this._drawCommand.castShadows=En.castShadows(this.shadows),this._drawCommand.receiveShadows=En.receiveShadows(this.shadows);let s=this._highlightColor.alpha<1||this._constantColor.alpha<1||this._styleTranslucent;this._drawCommand.renderState=s?this._translucentRenderState:this._opaqueRenderState,this._drawCommand.pass=s?ve.TRANSLUCENT:this._opaquePass;let a=e.commandList,l=e.passes;(l.render||l.pick)&&a.push(this._drawCommand)};hP.prototype.isDestroyed=function(){return!1};hP.prototype.destroy=function(){let e=this._drawCommand;return c(e)&&(e.vertexArray=e.vertexArray&&e.vertexArray.destroy(),e.shaderProgram=e.shaderProgram&&e.shaderProgram.destroy()),de(this)};var rX=hP;var _yt={NEAREST:0,LINEAR:1},Yd=_yt;function ix(e){e=y(e,y.EMPTY_OBJECT);let{fragmentShader:t,textureScale:n=1,pixelFormat:i=Ve.RGBA}=e;if(A.typeOf.string("options.fragmentShader",t),A.typeOf.number.greaterThan("options.textureScale",n,0),A.typeOf.number.lessThanOrEquals("options.textureScale",n,1),!Ve.isColorFormat(i))throw new E("options.pixelFormat must be a color format.");this._fragmentShader=t,this._uniforms=e.uniforms,this._textureScale=n,this._forcePowerOfTwo=y(e.forcePowerOfTwo,!1),this._sampleMode=y(e.sampleMode,Yd.NEAREST),this._pixelFormat=i,this._pixelDatatype=y(e.pixelDatatype,Be.UNSIGNED_BYTE),this._clearColor=y(e.clearColor,j.BLACK),this._uniformMap=void 0,this._command=void 0,this._colorTexture=void 0,this._depthTexture=void 0,this._idTexture=void 0,this._actualUniforms={},this._dirtyUniforms=[],this._texturesToRelease=[],this._texturesToCreate=[],this._texturePromise=void 0;let o=new Cl;o.scissorTest={enabled:!0,rectangle:c(e.scissorRectangle)?Ke.clone(e.scissorRectangle):new Ke},this._passState=o,this._ready=!1;let r=e.name;c(r)||(r=Hn()),this._name=r,this._logDepthChanged=void 0,this._useLogDepth=void 0,this._selectedIdTexture=void 0,this._selected=void 0,this._selectedShadow=void 0,this._parentSelected=void 0,this._parentSelectedShadow=void 0,this._combinedSelected=void 0,this._combinedSelectedShadow=void 0,this._selectedLength=0,this._parentSelectedLength=0,this._selectedDirty=!0,this._textureCache=void 0,this._index=void 0,this.enabled=!0,this._enabled=!0}Object.defineProperties(ix.prototype,{ready:{get:function(){return this._ready}},name:{get:function(){return this._name}},fragmentShader:{get:function(){return this._fragmentShader}},uniforms:{get:function(){return this._uniforms}},textureScale:{get:function(){return this._textureScale}},forcePowerOfTwo:{get:function(){return this._forcePowerOfTwo}},sampleMode:{get:function(){return this._sampleMode}},pixelFormat:{get:function(){return this._pixelFormat}},pixelDatatype:{get:function(){return this._pixelDatatype}},clearColor:{get:function(){return this._clearColor}},scissorRectangle:{get:function(){return this._passState.scissorTest.rectangle}},outputTexture:{get:function(){if(c(this._textureCache)){let e=this._textureCache.getFramebuffer(this._name);if(c(e))return e.getColorTexture(0)}}},selected:{get:function(){return this._selected},set:function(e){this._selected=e}},parentSelected:{get:function(){return this._parentSelected},set:function(e){this._parentSelected=e}}});var gyt=/uniform\s+sampler2D\s+depthTexture/g;ix.prototype._isSupported=function(e){return!gyt.test(this._fragmentShader)||e.depthTexture};function yyt(e,t,n){let i=t[n];return(typeof i=="string"||i instanceof HTMLCanvasElement||i instanceof HTMLImageElement||i instanceof HTMLVideoElement||i instanceof ImageData)&&e._dirtyUniforms.push(n),{get:function(){return t[n]},set:function(o){let r=t[n];t[n]=o;let s=e._actualUniforms,a=s[n];c(a)&&a!==r&&a instanceof Lt&&!c(e._textureCache.getStageByName(n))&&(e._texturesToRelease.push(a),delete s[n],delete s[`${n}Dimensions`]),r instanceof Lt&&e._texturesToRelease.push(r),typeof o=="string"||o instanceof HTMLCanvasElement||o instanceof HTMLImageElement||o instanceof HTMLVideoElement||o instanceof ImageData?e._dirtyUniforms.push(n):s[n]=o}}}function byt(e,t){return function(){let n=e._actualUniforms[t];return typeof n=="function"?n():n}}function xyt(e,t){return function(){let n=e[t]();if(c(n))return n.dimensions}}function Tyt(e){if(c(e._uniformMap))return;let t={},n={},i=e._uniforms,o=e._actualUniforms;for(let r in i){if(!i.hasOwnProperty(r))continue;typeof i[r]!="function"?(t[r]=byt(e,r),n[r]=yyt(e,i,r)):(t[r]=i[r],n[r]=i[r]),o[r]=i[r];let s=t[r]();(typeof s=="string"||s instanceof Lt||s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement)&&(t[`${r}Dimensions`]=xyt(t,r))}e._uniforms={},Object.defineProperties(e._uniforms,n),e._uniformMap=At(t,{colorTexture:function(){return e._colorTexture},colorTextureDimensions:function(){return e._colorTexture.dimensions},depthTexture:function(){return e._depthTexture},depthTextureDimensions:function(){return e._depthTexture.dimensions},czm_idTexture:function(){return e._idTexture},czm_selectedIdTexture:function(){return e._selectedIdTexture},czm_selectedIdTextureStep:function(){return 1/e._selectedIdTexture.width}})}function Ayt(e,t){return e=e.replace(/in\s+vec2\s+v_textureCoordinates;/g,""),`#define CZM_SELECTED_FEATURE
uniform sampler2D czm_idTexture;
uniform sampler2D czm_selectedIdTexture;
uniform float czm_selectedIdTextureStep;
in vec2 v_textureCoordinates;
bool czm_selected(vec2 offset)
{
    bool selected = false;
    vec4 id = texture(czm_idTexture, v_textureCoordinates + offset);
    for (int i = 0; i < ${t}; ++i)
    {
        vec4 selectedId = texture(czm_selectedIdTexture, vec2((float(i) + 0.5) * czm_selectedIdTextureStep, 0.5));
        if (all(equal(id, selectedId)))
        {
            return true;
        }
    }
    return false;
}
bool czm_selected()
{
    return czm_selected(vec2(0.0));
}

${e}`}function Cyt(e,t){if(c(e._command)&&!e._logDepthChanged&&!e._selectedDirty)return;let n=e._fragmentShader;if(c(e._selectedIdTexture)){let o=e._selectedIdTexture.width;n=Ayt(n,o)}let i=new Ge({defines:[e._useLogDepth?"LOG_DEPTH":""],sources:[n]});e._command=t.createViewportQuadCommand(i,{uniformMap:e._uniformMap,owner:e})}function Eyt(e){let t=e._sampleMode,n,i;t===Yd.LINEAR?(n=$t.LINEAR,i=fi.LINEAR):(n=$t.NEAREST,i=fi.NEAREST);let o=e._sampler;(!c(o)||o.minificationFilter!==n||o.magnificationFilter!==i)&&(e._sampler=new Qt({wrapS:yn.CLAMP_TO_EDGE,wrapT:yn.CLAMP_TO_EDGE,minificationFilter:n,magnificationFilter:i}))}function Syt(e,t){return function(n){e._texturesToCreate.push({name:t,source:n})}}function wyt(e,t){return function(){return e._textureCache.getOutputTexture(t)}}function vyt(e,t){let n=e._texturesToRelease;for(let a=0;a<n.length;++a){let l=n[a];l=l&&l.destroy()}n.length=0;let i=e._texturesToCreate;for(let a=0;a<i.length;++a){let{name:l,source:u}=i[a];e._actualUniforms[l]=new Lt({context:t,source:u})}i.length=0;let o=e._dirtyUniforms;if(o.length===0&&!c(e._texturePromise)){e._ready=!0;return}if(o.length===0||c(e._texturePromise))return;let r=e._uniforms,s=[];for(let a=0;a<o.length;++a){let l=o[a],u=r[l],f=e._textureCache.getStageByName(u);if(c(f))e._actualUniforms[l]=wyt(e,u);else if(typeof u=="string"){let d=new De({url:u});s.push(d.fetchImage().then(Syt(e,l)))}else e._texturesToCreate.push({name:l,source:u})}o.length=0,s.length>0?(e._ready=!1,e._texturePromise=Promise.all(s).then(function(){e._ready=!0,e._texturePromise=void 0})):e._ready=!0}function Qbe(e){c(e._command)&&(e._command.shaderProgram=e._command.shaderProgram&&e._command.shaderProgram.destroy(),e._command=void 0),e._selectedIdTexture=e._selectedIdTexture&&e._selectedIdTexture.destroy();let t=e._textureCache;if(!c(t))return;let n=e._uniforms,i=e._actualUniforms;for(let o in i){if(!i.hasOwnProperty(o))continue;let r=i[o];r instanceof Lt&&(c(t.getStageByName(n[o]))||r.destroy(),e._dirtyUniforms.push(o))}}function Dyt(e){let t=c(e._selected)?e._selected.length:0,n=c(e._parentSelected)?e._parentSelected:0,i=e._selected!==e._selectedShadow||t!==e._selectedLength||e._parentSelected!==e._parentSelectedShadow||n!==e._parentSelectedLength;if(c(e._selected)&&c(e._parentSelected)?e._combinedSelected=e._selected.concat(e._parentSelected):c(e._parentSelected)?e._combinedSelected=e._parentSelected:e._combinedSelected=e._selected,!i&&c(e._combinedSelected)){if(!c(e._combinedSelectedShadow))return!0;for(let o=0;o<e._combinedSelected.length;++o)if(e._combinedSelected[o]!==e._combinedSelectedShadow[o])return!0}return i}function Pyt(e,t){if(!e._selectedDirty)return;e._selectedIdTexture=e._selectedIdTexture&&e._selectedIdTexture.destroy(),e._selectedIdTexture=void 0;let n=e._combinedSelected;if(!c(n))return;let i=0;for(let s=0;s<n.length;++s){let a=n[s];c(a.pickIds)?i+=a.pickIds.length:c(a.pickId)&&++i}if(n.length===0||i===0){let s=new Uint8Array([255,255,255,255]);e._selectedIdTexture=new Lt({context:t,pixelFormat:Ve.RGBA,pixelDatatype:Be.UNSIGNED_BYTE,source:{arrayBufferView:s,width:1,height:1},sampler:Qt.NEAREST});return}let o=0,r=new Uint8Array(i*4);for(let s=0;s<n.length;++s){let a=n[s];if(c(a.pickIds)){let l=a.pickIds,u=l.length;for(let f=0;f<u;++f){let d=l[f].color;r[o]=j.floatToByte(d.red),r[o+1]=j.floatToByte(d.green),r[o+2]=j.floatToByte(d.blue),r[o+3]=j.floatToByte(d.alpha),o+=4}}else if(c(a.pickId)){let l=a.pickId.color;r[o]=j.floatToByte(l.red),r[o+1]=j.floatToByte(l.green),r[o+2]=j.floatToByte(l.blue),r[o+3]=j.floatToByte(l.alpha),o+=4}}e._selectedIdTexture=new Lt({context:t,pixelFormat:Ve.RGBA,pixelDatatype:Be.UNSIGNED_BYTE,source:{arrayBufferView:r,width:i,height:1},sampler:Qt.NEAREST})}ix.prototype.update=function(e,t){if(this.enabled!==this._enabled&&!this.enabled&&Qbe(this),this._enabled=this.enabled,!this._enabled||(this._logDepthChanged=t!==this._useLogDepth,this._useLogDepth=t,this._selectedDirty=Dyt(this),this._selectedShadow=this._selected,this._parentSelectedShadow=this._parentSelected,this._combinedSelectedShadow=this._combinedSelected,this._selectedLength=c(this._selected)?this._selected.length:0,this._parentSelectedLength=c(this._parentSelected)?this._parentSelected.length:0,Pyt(this,e),Tyt(this),vyt(this,e),Cyt(this,e),Eyt(this),this._selectedDirty=!1,!this._ready))return;let n=this._textureCache.getFramebuffer(this._name);if(this._command.framebuffer=n,!c(n))return;let i=n.getColorTexture(0),o;(i.width!==e.drawingBufferWidth||i.height!==e.drawingBufferHeight)&&(o=this._renderState,(!c(o)||i.width!==o.viewport.width||i.height!==o.viewport.height)&&(this._renderState=ze.fromCache({viewport:new Ke(0,0,i.width,i.height)}))),this._command.renderState=o};ix.prototype.execute=function(e,t,n,i){if(!c(this._command)||!c(this._command.framebuffer)||!this._ready||!this._enabled)return;this._colorTexture=t,this._depthTexture=n,this._idTexture=i,Qt.equals(this._colorTexture.sampler,this._sampler)||(this._colorTexture.sampler=this._sampler);let o=this.scissorRectangle.width>0&&this.scissorRectangle.height>0?this._passState:void 0;c(o)&&(o.context=e),this._command.execute(e,o)};ix.prototype.isDestroyed=function(){return!1};ix.prototype.destroy=function(){return Qbe(this),de(this)};var po=ix;var sX=`uniform sampler2D colorTexture;
in vec2 v_textureCoordinates;
#ifdef AUTO_EXPOSURE
uniform sampler2D autoExposure;
#else
uniform float exposure;
#endif
void main()
{
vec4 fragmentColor = texture(colorTexture, v_textureCoordinates);
vec3 color = fragmentColor.rgb;
#ifdef AUTO_EXPOSURE
color /= texture(autoExposure, vec2(0.5)).r;
#else
color *= vec3(exposure);
#endif
color = czm_acesTonemapping(color);
color = czm_inverseGamma(color);
out_FragColor = vec4(color, fragmentColor.a);
}
`;var aX=`precision highp float;
uniform sampler2D randomTexture;
uniform sampler2D depthTexture;
uniform float intensity;
uniform float bias;
uniform float lengthCap;
uniform float stepSize;
uniform float frustumLength;
vec3 pixelToEye(vec2 screenCoordinate)
{
vec2 uv = screenCoordinate / czm_viewport.zw;
float depth = czm_readDepth(depthTexture, uv);
vec2 xy = 2.0 * uv - vec2(1.0);
vec4 posEC = czm_inverseProjection * vec4(xy, depth, 1.0);
return posEC.xyz / posEC.w;
}
vec3 getNormalXEdge(vec3 positionEC)
{
vec2 centerCoord = gl_FragCoord.xy;
vec3 positionLeft = pixelToEye(centerCoord + vec2(-1.0, 0.0));
vec3 positionRight = pixelToEye(centerCoord + vec2(1.0, 0.0));
vec3 positionUp = pixelToEye(centerCoord + vec2(0.0, 1.0));
vec3 positionDown = pixelToEye(centerCoord + vec2(0.0, -1.0));
vec3 dx0 = positionEC - positionLeft;
vec3 dx1 = positionRight - positionEC;
vec3 dy0 = positionEC - positionDown;
vec3 dy1 = positionUp - positionEC;
vec3 dx = length(dx0) < length(dx1) ? dx0 : dx1;
vec3 dy = length(dy0) < length(dy1) ? dy0 : dy1;
return normalize(cross(dx, dy));
}
void main(void)
{
vec3 positionEC = pixelToEye(gl_FragCoord.xy);
if (positionEC.z > frustumLength)
{
out_FragColor = vec4(1.0);
return;
}
vec3 normalEC = getNormalXEdge(positionEC);
float ao = 0.0;
const int ANGLE_STEPS = 4;
float angleStepScale = 1.0 / float(ANGLE_STEPS);
float angleStep = angleStepScale * czm_twoPi;
float cosStep = cos(angleStep);
float sinStep = sin(angleStep);
mat2 rotateStep = mat2(cosStep, sinStep, -sinStep, cosStep);
const float randomTextureSize = 255.0;
vec2 randomTexCoord = fract(gl_FragCoord.xy / randomTextureSize);
float randomVal = texture(randomTexture, randomTexCoord).x;
vec2 sampleDirection = vec2(cos(angleStep * randomVal), sin(angleStep * randomVal));
for (int i = 0; i < ANGLE_STEPS; i++)
{
sampleDirection = rotateStep * sampleDirection;
float localAO = 0.0;
vec2 radialStep = stepSize * sampleDirection;
for (int j = 0; j < 6; j++)
{
vec2 newCoords = floor(gl_FragCoord.xy + float(j + 1) * radialStep) + vec2(0.5);
if (clamp(newCoords, vec2(0.0), czm_viewport.zw) != newCoords)
{
break;
}
vec3 stepPositionEC = pixelToEye(newCoords);
vec3 stepVector = stepPositionEC - positionEC;
float stepLength = length(stepVector);
if (stepLength > lengthCap)
{
break;
}
float dotVal = clamp(dot(normalEC, normalize(stepVector)), 0.0, 1.0);
if (dotVal < bias)
{
dotVal = 0.0;
}
float weight = stepLength / lengthCap;
weight = 1.0 - weight * weight;
localAO = max(localAO, dotVal * weight);
}
ao += localAO;
}
ao *= angleStepScale;
ao = 1.0 - clamp(ao, 0.0, 1.0);
ao = pow(ao, intensity);
out_FragColor = vec4(vec3(ao), 1.0);
}
`;var cX=`uniform sampler2D colorTexture;
uniform sampler2D ambientOcclusionTexture;
uniform bool ambientOcclusionOnly;
in vec2 v_textureCoordinates;
void main(void)
{
vec4 color = texture(colorTexture, v_textureCoordinates);
vec4 ao = texture(ambientOcclusionTexture, v_textureCoordinates);
out_FragColor = ambientOcclusionOnly ? ao : ao * color;
}
`;var lX=`uniform sampler2D colorTexture;
uniform float gradations;
in vec2 v_textureCoordinates;
void main(void)
{
vec3 rgb = texture(colorTexture, v_textureCoordinates).rgb;
#ifdef CZM_SELECTED_FEATURE
if (czm_selected()) {
out_FragColor = vec4(rgb, 1.0);
return;
}
#endif
float luminance = czm_luminance(rgb);
float darkness = luminance * gradations;
darkness = (darkness - fract(darkness)) / gradations;
out_FragColor = vec4(vec3(darkness), 1.0);
}
`;var uX=`uniform sampler2D colorTexture;
uniform sampler2D bloomTexture;
uniform bool glowOnly;
in vec2 v_textureCoordinates;
void main(void)
{
vec4 color = texture(colorTexture, v_textureCoordinates);
#ifdef CZM_SELECTED_FEATURE
if (czm_selected()) {
out_FragColor = color;
return;
}
#endif
vec4 bloom = texture(bloomTexture, v_textureCoordinates);
out_FragColor = glowOnly ? bloom : bloom + color;
}
`;var fX=`uniform sampler2D colorTexture;
uniform float brightness;
in vec2 v_textureCoordinates;
void main(void)
{
vec3 rgb = texture(colorTexture, v_textureCoordinates).rgb;
vec3 target = vec3(0.0);
out_FragColor = vec4(mix(target, rgb, brightness), 1.0);
}
`;var dX=`uniform sampler2D colorTexture;
uniform float contrast;
uniform float brightness;
in vec2 v_textureCoordinates;
void main(void)
{
vec3 sceneColor = texture(colorTexture, v_textureCoordinates).xyz;
sceneColor = czm_RGBToHSB(sceneColor);
sceneColor.z += brightness;
sceneColor = czm_HSBToRGB(sceneColor);
float factor = (259.0 * (contrast + 255.0)) / (255.0 * (259.0 - contrast));
sceneColor = factor * (sceneColor - vec3(0.5)) + vec3(0.5);
out_FragColor = vec4(sceneColor, 1.0);
}
`;var hX=`uniform sampler2D colorTexture;
uniform sampler2D blurTexture;
uniform sampler2D depthTexture;
uniform float focalDistance;
in vec2 v_textureCoordinates;
vec4 toEye(vec2 uv, float depth)
{
vec2 xy = vec2((uv.x * 2.0 - 1.0), ((1.0 - uv.y) * 2.0 - 1.0));
vec4 posInCamera = czm_inverseProjection * vec4(xy, depth, 1.0);
posInCamera = posInCamera / posInCamera.w;
return posInCamera;
}
float computeDepthBlur(float depth)
{
float f;
if (depth < focalDistance)
{
f = (focalDistance - depth) / (focalDistance - czm_currentFrustum.x);
}
else
{
f = (depth - focalDistance) / (czm_currentFrustum.y - focalDistance);
f = pow(f, 0.1);
}
f *= f;
f = clamp(f, 0.0, 1.0);
return pow(f, 0.5);
}
void main(void)
{
float depth = czm_readDepth(depthTexture, v_textureCoordinates);
vec4 posInCamera = toEye(v_textureCoordinates, depth);
float d = computeDepthBlur(-posInCamera.z);
out_FragColor = mix(texture(colorTexture, v_textureCoordinates), texture(blurTexture, v_textureCoordinates), d);
}
`;var mX=`uniform sampler2D depthTexture;
in vec2 v_textureCoordinates;
void main(void)
{
float depth = czm_readDepth(depthTexture, v_textureCoordinates);
out_FragColor = vec4(vec3(depth), 1.0);
}
`;var pX=`uniform sampler2D depthTexture;
uniform float length;
uniform vec4 color;
in vec2 v_textureCoordinates;
void main(void)
{
float directions[3];
directions[0] = -1.0;
directions[1] = 0.0;
directions[2] = 1.0;
float scalars[3];
scalars[0] = 3.0;
scalars[1] = 10.0;
scalars[2] = 3.0;
float padx = czm_pixelRatio / czm_viewport.z;
float pady = czm_pixelRatio / czm_viewport.w;
#ifdef CZM_SELECTED_FEATURE
bool selected = false;
for (int i = 0; i < 3; ++i)
{
float dir = directions[i];
selected = selected || czm_selected(vec2(-padx, dir * pady));
selected = selected || czm_selected(vec2(padx, dir * pady));
selected = selected || czm_selected(vec2(dir * padx, -pady));
selected = selected || czm_selected(vec2(dir * padx, pady));
if (selected)
{
break;
}
}
if (!selected)
{
out_FragColor = vec4(color.rgb, 0.0);
return;
}
#endif
float horizEdge = 0.0;
float vertEdge = 0.0;
for (int i = 0; i < 3; ++i)
{
float dir = directions[i];
float scale = scalars[i];
horizEdge -= texture(depthTexture, v_textureCoordinates + vec2(-padx, dir * pady)).x * scale;
horizEdge += texture(depthTexture, v_textureCoordinates + vec2(padx, dir * pady)).x * scale;
vertEdge -= texture(depthTexture, v_textureCoordinates + vec2(dir * padx, -pady)).x * scale;
vertEdge += texture(depthTexture, v_textureCoordinates + vec2(dir * padx, pady)).x * scale;
}
float len = sqrt(horizEdge * horizEdge + vertEdge * vertEdge);
out_FragColor = vec4(color.rgb, len > length ? color.a : 0.0);
}
`;var _X=`uniform sampler2D colorTexture;
in vec2 v_textureCoordinates;
#ifdef AUTO_EXPOSURE
uniform sampler2D autoExposure;
#else
uniform float exposure;
#endif
void main()
{
vec4 fragmentColor = texture(colorTexture, v_textureCoordinates);
vec3 color = fragmentColor.rgb;
#ifdef AUTO_EXPOSURE
float exposure = texture(autoExposure, vec2(0.5)).r;
color /= exposure;
#else
color *= vec3(exposure);
#endif
const float A = 0.22;
const float B = 0.30;
const float C = 0.10;
const float D = 0.20;
const float E = 0.01;
const float F = 0.30;
const float white = 11.2;
vec3 c = ((color * (A * color + C * B) + D * E) / (color * ( A * color + B) + D * F)) - E / F;
float w = ((white * (A * white + C * B) + D * E) / (white * ( A * white + B) + D * F)) - E / F;
c = czm_inverseGamma(c / w);
out_FragColor = vec4(c, fragmentColor.a);
}
`;var gX=`uniform sampler2D colorTexture;
in vec2 v_textureCoordinates;
#ifdef AUTO_EXPOSURE
uniform sampler2D autoExposure;
#else
uniform float exposure;
#endif
void main()
{
vec4 fragmentColor = texture(colorTexture, v_textureCoordinates);
vec3 color = fragmentColor.rgb;
#ifdef AUTO_EXPOSURE
color /= texture(autoExposure, vec2(0.5)).r;
#else
color *= vec3(exposure);
#endif
color = czm_pbrNeutralTonemapping(color);
color = czm_inverseGamma(color);
out_FragColor = vec4(color, fragmentColor.a);
}
`;var yX=`in vec2 v_textureCoordinates;
uniform sampler2D colorTexture;
const float fxaaQualitySubpix = 0.5;
const float fxaaQualityEdgeThreshold = 0.125;
const float fxaaQualityEdgeThresholdMin = 0.0833;
void main()
{
vec2 fxaaQualityRcpFrame = vec2(1.0) / czm_viewport.zw;
vec4 color = FxaaPixelShader(
v_textureCoordinates,
colorTexture,
fxaaQualityRcpFrame,
fxaaQualitySubpix,
fxaaQualityEdgeThreshold,
fxaaQualityEdgeThresholdMin);
float alpha = texture(colorTexture, v_textureCoordinates).a;
out_FragColor = vec4(color.rgb, alpha);
}
`;var VC=`#define SAMPLES 8
uniform float delta;
uniform float sigma;
uniform float direction;
uniform sampler2D colorTexture;
#ifdef USE_STEP_SIZE
uniform float stepSize;
#else
uniform vec2 step;
#endif
in vec2 v_textureCoordinates;
void main()
{
vec2 st = v_textureCoordinates;
vec2 dir = vec2(1.0 - direction, direction);
#ifdef USE_STEP_SIZE
vec2 step = vec2(stepSize * (czm_pixelRatio / czm_viewport.zw));
#else
vec2 step = step;
#endif
vec3 g;
g.x = 1.0 / (sqrt(czm_twoPi) * sigma);
g.y = exp((-0.5 * delta * delta) / (sigma * sigma));
g.z = g.y * g.y;
vec4 result = texture(colorTexture, st) * g.x;
for (int i = 1; i < SAMPLES; ++i)
{
g.xy *= g.yz;
vec2 offset = float(i) * dir * step;
result += texture(colorTexture, st - offset) * g.x;
result += texture(colorTexture, st + offset) * g.x;
}
out_FragColor = result;
}
`;var bX=`uniform sampler2D colorTexture;
uniform sampler2D dirtTexture;
uniform sampler2D starTexture;
uniform vec2 dirtTextureDimensions;
uniform float distortion;
uniform float ghostDispersal;
uniform float haloWidth;
uniform float dirtAmount;
uniform float earthRadius;
uniform float intensity;
in vec2 v_textureCoordinates;
#define DISTANCE_TO_SPACE 6500000.0
vec4 getNDCFromWC(vec3 WC, float earthRadius)
{
vec4 positionEC = czm_view * vec4(WC, 1.0);
positionEC = vec4(positionEC.x + earthRadius, positionEC.y, positionEC.z, 1.0);
vec4 positionWC = czm_eyeToWindowCoordinates(positionEC);
return czm_viewportOrthographic * vec4(positionWC.xy, -positionWC.z, 1.0);
}
float isInEarth(vec2 texcoord, vec2 sceneSize)
{
vec2 NDC = texcoord * 2.0 - 1.0;
vec4 earthPosSC = getNDCFromWC(vec3(0.0), 0.0);
vec4 earthPosSCEdge = getNDCFromWC(vec3(0.0), earthRadius * 1.5);
NDC.xy -= earthPosSC.xy;
float X = abs(NDC.x) * sceneSize.x;
float Y = abs(NDC.y) * sceneSize.y;
return clamp(0.0, 1.0, max(sqrt(X * X + Y * Y) / max(abs(earthPosSCEdge.x * sceneSize.x), 1.0) - 0.8 , 0.0));
}
vec4 textureDistorted(sampler2D tex, vec2 texcoord, vec2 direction, vec3 distortion, bool isSpace)
{
vec2 sceneSize = czm_viewport.zw;
vec3 color;
if(isSpace)
{
color.r = isInEarth(texcoord + direction * distortion.r, sceneSize) * texture(tex, texcoord + direction * distortion.r).r;
color.g = isInEarth(texcoord + direction * distortion.g, sceneSize) * texture(tex, texcoord + direction * distortion.g).g;
color.b = isInEarth(texcoord + direction * distortion.b, sceneSize) * texture(tex, texcoord + direction * distortion.b).b;
}
else
{
color.r = texture(tex, texcoord + direction * distortion.r).r;
color.g = texture(tex, texcoord + direction * distortion.g).g;
color.b = texture(tex, texcoord + direction * distortion.b).b;
}
return vec4(clamp(color, 0.0, 1.0), 0.0);
}
void main(void)
{
vec4 originalColor = texture(colorTexture, v_textureCoordinates);
vec3 rgb = originalColor.rgb;
bool isSpace = length(czm_viewerPositionWC.xyz) > DISTANCE_TO_SPACE;
vec4 sunPos = czm_morphTime == 1.0 ? vec4(czm_sunPositionWC, 1.0) : vec4(czm_sunPositionColumbusView.zxy, 1.0);
vec4 sunPositionEC = czm_view * sunPos;
vec4 sunPositionWC = czm_eyeToWindowCoordinates(sunPositionEC);
sunPos = czm_viewportOrthographic * vec4(sunPositionWC.xy, -sunPositionWC.z, 1.0);
if(!isSpace || !((sunPos.x >= -1.1 && sunPos.x <= 1.1) && (sunPos.y >= -1.1 && sunPos.y <= 1.1)))
{
out_FragColor = originalColor;
return;
}
vec2 texcoord = vec2(1.0) - v_textureCoordinates;
vec2 pixelSize = czm_pixelRatio / czm_viewport.zw;
vec2 invPixelSize = 1.0 / pixelSize;
vec3 distortionVec = pixelSize.x * vec3(-distortion, 0.0, distortion);
vec2 ghostVec = (vec2(0.5) - texcoord) * ghostDispersal;
vec3 direction = normalize(vec3(ghostVec, 0.0));
vec4 result = vec4(0.0);
vec4 ghost = vec4(0.0);
for (int i = 0; i < 4; ++i)
{
vec2 offset = fract(texcoord + ghostVec * float(i));
ghost += textureDistorted(colorTexture, offset, direction.xy, distortionVec, isSpace);
}
result += ghost;
vec2 haloVec = normalize(ghostVec) * haloWidth;
float weightForHalo = length(vec2(0.5) - fract(texcoord + haloVec)) / length(vec2(0.5));
weightForHalo = pow(1.0 - weightForHalo, 5.0);
result += textureDistorted(colorTexture, texcoord + haloVec, direction.xy, distortionVec, isSpace) * weightForHalo * 1.5;
vec2 dirtTexCoords = (v_textureCoordinates * invPixelSize) / dirtTextureDimensions;
if (dirtTexCoords.x > 1.0)
{
dirtTexCoords.x = mod(floor(dirtTexCoords.x), 2.0) == 1.0 ? 1.0 - fract(dirtTexCoords.x) :  fract(dirtTexCoords.x);
}
if (dirtTexCoords.y > 1.0)
{
dirtTexCoords.y = mod(floor(dirtTexCoords.y), 2.0) == 1.0 ? 1.0 - fract(dirtTexCoords.y) :  fract(dirtTexCoords.y);
}
result += dirtAmount * texture(dirtTexture, dirtTexCoords);
float camrot = czm_view[0].z + czm_view[1].y;
float cosValue = cos(camrot);
float sinValue = sin(camrot);
mat3 rotation = mat3(
cosValue, -sinValue, 0.0,
sinValue, cosValue, 0.0,
0.0, 0.0, 1.0
);
vec3 st1 = vec3(v_textureCoordinates * 2.0 - vec2(1.0), 1.0);
vec3 st2 = vec3((rotation * st1).xy, 1.0);
vec3 st3 = st2 * 0.5 + vec3(0.5);
vec2 lensStarTexcoord = st3.xy;
float weightForLensFlare = length(vec3(sunPos.xy, 0.0));
float oneMinusWeightForLensFlare = max(1.0 - weightForLensFlare, 0.0);
if (!isSpace)
{
result *= oneMinusWeightForLensFlare * intensity * 0.2;
}
else
{
result *= oneMinusWeightForLensFlare * intensity;
result *= texture(starTexture, lensStarTexcoord) * pow(weightForLensFlare, 1.0) * max((1.0 - length(vec3(st1.xy, 0.0))), 0.0) * 2.0;
}
result += texture(colorTexture, v_textureCoordinates);
out_FragColor = result;
}
`;var xX=`uniform sampler2D colorTexture;
uniform vec3 white;
in vec2 v_textureCoordinates;
#ifdef AUTO_EXPOSURE
uniform sampler2D autoExposure;
#else
uniform float exposure;
#endif
void main()
{
vec4 fragmentColor = texture(colorTexture, v_textureCoordinates);
vec3 color = fragmentColor.rgb;
#ifdef AUTO_EXPOSURE
float exposure = texture(autoExposure, vec2(0.5)).r;
color /= exposure;
#else
color *= vec3(exposure);
#endif
color = (color * (1.0 + color / white)) / (1.0 + color);
color = czm_inverseGamma(color);
out_FragColor = vec4(color, fragmentColor.a);
}
`;var TX=`uniform sampler2D colorTexture;
in vec2 v_textureCoordinates;
float rand(vec2 co)
{
return fract(sin(dot(co.xy ,vec2(12.9898, 78.233))) * 43758.5453);
}
void main(void)
{
float noiseValue = rand(v_textureCoordinates + sin(czm_frameNumber)) * 0.1;
vec3 rgb = texture(colorTexture, v_textureCoordinates).rgb;
vec3 green = vec3(0.0, 1.0, 0.0);
out_FragColor = vec4((noiseValue + rgb) * green, 1.0);
}
`;var AX=`uniform sampler2D colorTexture;
in vec2 v_textureCoordinates;
#ifdef AUTO_EXPOSURE
uniform sampler2D autoExposure;
#else
uniform float exposure;
#endif
void main()
{
vec4 fragmentColor = texture(colorTexture, v_textureCoordinates);
vec3 color = fragmentColor.rgb;
#ifdef AUTO_EXPOSURE
float exposure = texture(autoExposure, vec2(0.5)).r;
color /= exposure;
#else
color *= vec3(exposure);
#endif
color = color / (1.0 + color);
color = czm_inverseGamma(color);
out_FragColor = vec4(color, fragmentColor.a);
}
`;var CX=`uniform sampler2D colorTexture;
uniform sampler2D silhouetteTexture;
in vec2 v_textureCoordinates;
void main(void)
{
vec4 silhouetteColor = texture(silhouetteTexture, v_textureCoordinates);
vec4 color = texture(colorTexture, v_textureCoordinates);
out_FragColor = mix(color, silhouetteColor, silhouetteColor.a);
}
`;/**
 * @license
 * Copyright (c) 2014-2015, NVIDIA CORPORATION. All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 *  * Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 *  * Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 *  * Neither the name of NVIDIA CORPORATION nor the names of its
 *    contributors may be used to endorse or promote products derived
 *    from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS ``AS IS'' AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR
 * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */var EX=`#if (FXAA_QUALITY_PRESET == 10)
#define FXAA_QUALITY_PS 3
#define FXAA_QUALITY_P0 1.5
#define FXAA_QUALITY_P1 3.0
#define FXAA_QUALITY_P2 12.0
#endif
#if (FXAA_QUALITY_PRESET == 11)
#define FXAA_QUALITY_PS 4
#define FXAA_QUALITY_P0 1.0
#define FXAA_QUALITY_P1 1.5
#define FXAA_QUALITY_P2 3.0
#define FXAA_QUALITY_P3 12.0
#endif
#if (FXAA_QUALITY_PRESET == 12)
#define FXAA_QUALITY_PS 5
#define FXAA_QUALITY_P0 1.0
#define FXAA_QUALITY_P1 1.5
#define FXAA_QUALITY_P2 2.0
#define FXAA_QUALITY_P3 4.0
#define FXAA_QUALITY_P4 12.0
#endif
#if (FXAA_QUALITY_PRESET == 13)
#define FXAA_QUALITY_PS 6
#define FXAA_QUALITY_P0 1.0
#define FXAA_QUALITY_P1 1.5
#define FXAA_QUALITY_P2 2.0
#define FXAA_QUALITY_P3 2.0
#define FXAA_QUALITY_P4 4.0
#define FXAA_QUALITY_P5 12.0
#endif
#if (FXAA_QUALITY_PRESET == 14)
#define FXAA_QUALITY_PS 7
#define FXAA_QUALITY_P0 1.0
#define FXAA_QUALITY_P1 1.5
#define FXAA_QUALITY_P2 2.0
#define FXAA_QUALITY_P3 2.0
#define FXAA_QUALITY_P4 2.0
#define FXAA_QUALITY_P5 4.0
#define FXAA_QUALITY_P6 12.0
#endif
#if (FXAA_QUALITY_PRESET == 15)
#define FXAA_QUALITY_PS 8
#define FXAA_QUALITY_P0 1.0
#define FXAA_QUALITY_P1 1.5
#define FXAA_QUALITY_P2 2.0
#define FXAA_QUALITY_P3 2.0
#define FXAA_QUALITY_P4 2.0
#define FXAA_QUALITY_P5 2.0
#define FXAA_QUALITY_P6 4.0
#define FXAA_QUALITY_P7 12.0
#endif
#if (FXAA_QUALITY_PRESET == 20)
#define FXAA_QUALITY_PS 3
#define FXAA_QUALITY_P0 1.5
#define FXAA_QUALITY_P1 2.0
#define FXAA_QUALITY_P2 8.0
#endif
#if (FXAA_QUALITY_PRESET == 21)
#define FXAA_QUALITY_PS 4
#define FXAA_QUALITY_P0 1.0
#define FXAA_QUALITY_P1 1.5
#define FXAA_QUALITY_P2 2.0
#define FXAA_QUALITY_P3 8.0
#endif
#if (FXAA_QUALITY_PRESET == 22)
#define FXAA_QUALITY_PS 5
#define FXAA_QUALITY_P0 1.0
#define FXAA_QUALITY_P1 1.5
#define FXAA_QUALITY_P2 2.0
#define FXAA_QUALITY_P3 2.0
#define FXAA_QUALITY_P4 8.0
#endif
#if (FXAA_QUALITY_PRESET == 23)
#define FXAA_QUALITY_PS 6
#define FXAA_QUALITY_P0 1.0
#define FXAA_QUALITY_P1 1.5
#define FXAA_QUALITY_P2 2.0
#define FXAA_QUALITY_P3 2.0
#define FXAA_QUALITY_P4 2.0
#define FXAA_QUALITY_P5 8.0
#endif
#if (FXAA_QUALITY_PRESET == 24)
#define FXAA_QUALITY_PS 7
#define FXAA_QUALITY_P0 1.0
#define FXAA_QUALITY_P1 1.5
#define FXAA_QUALITY_P2 2.0
#define FXAA_QUALITY_P3 2.0
#define FXAA_QUALITY_P4 2.0
#define FXAA_QUALITY_P5 3.0
#define FXAA_QUALITY_P6 8.0
#endif
#if (FXAA_QUALITY_PRESET == 25)
#define FXAA_QUALITY_PS 8
#define FXAA_QUALITY_P0 1.0
#define FXAA_QUALITY_P1 1.5
#define FXAA_QUALITY_P2 2.0
#define FXAA_QUALITY_P3 2.0
#define FXAA_QUALITY_P4 2.0
#define FXAA_QUALITY_P5 2.0
#define FXAA_QUALITY_P6 4.0
#define FXAA_QUALITY_P7 8.0
#endif
#if (FXAA_QUALITY_PRESET == 26)
#define FXAA_QUALITY_PS 9
#define FXAA_QUALITY_P0 1.0
#define FXAA_QUALITY_P1 1.5
#define FXAA_QUALITY_P2 2.0
#define FXAA_QUALITY_P3 2.0
#define FXAA_QUALITY_P4 2.0
#define FXAA_QUALITY_P5 2.0
#define FXAA_QUALITY_P6 2.0
#define FXAA_QUALITY_P7 4.0
#define FXAA_QUALITY_P8 8.0
#endif
#if (FXAA_QUALITY_PRESET == 27)
#define FXAA_QUALITY_PS 10
#define FXAA_QUALITY_P0 1.0
#define FXAA_QUALITY_P1 1.5
#define FXAA_QUALITY_P2 2.0
#define FXAA_QUALITY_P3 2.0
#define FXAA_QUALITY_P4 2.0
#define FXAA_QUALITY_P5 2.0
#define FXAA_QUALITY_P6 2.0
#define FXAA_QUALITY_P7 2.0
#define FXAA_QUALITY_P8 4.0
#define FXAA_QUALITY_P9 8.0
#endif
#if (FXAA_QUALITY_PRESET == 28)
#define FXAA_QUALITY_PS 11
#define FXAA_QUALITY_P0 1.0
#define FXAA_QUALITY_P1 1.5
#define FXAA_QUALITY_P2 2.0
#define FXAA_QUALITY_P3 2.0
#define FXAA_QUALITY_P4 2.0
#define FXAA_QUALITY_P5 2.0
#define FXAA_QUALITY_P6 2.0
#define FXAA_QUALITY_P7 2.0
#define FXAA_QUALITY_P8 2.0
#define FXAA_QUALITY_P9 4.0
#define FXAA_QUALITY_P10 8.0
#endif
#if (FXAA_QUALITY_PRESET == 29)
#define FXAA_QUALITY_PS 12
#define FXAA_QUALITY_P0 1.0
#define FXAA_QUALITY_P1 1.5
#define FXAA_QUALITY_P2 2.0
#define FXAA_QUALITY_P3 2.0
#define FXAA_QUALITY_P4 2.0
#define FXAA_QUALITY_P5 2.0
#define FXAA_QUALITY_P6 2.0
#define FXAA_QUALITY_P7 2.0
#define FXAA_QUALITY_P8 2.0
#define FXAA_QUALITY_P9 2.0
#define FXAA_QUALITY_P10 4.0
#define FXAA_QUALITY_P11 8.0
#endif
#if (FXAA_QUALITY_PRESET == 39)
#define FXAA_QUALITY_PS 12
#define FXAA_QUALITY_P0 1.0
#define FXAA_QUALITY_P1 1.0
#define FXAA_QUALITY_P2 1.0
#define FXAA_QUALITY_P3 1.0
#define FXAA_QUALITY_P4 1.0
#define FXAA_QUALITY_P5 1.5
#define FXAA_QUALITY_P6 2.0
#define FXAA_QUALITY_P7 2.0
#define FXAA_QUALITY_P8 2.0
#define FXAA_QUALITY_P9 2.0
#define FXAA_QUALITY_P10 4.0
#define FXAA_QUALITY_P11 8.0
#endif
#define FxaaBool bool
#define FxaaFloat float
#define FxaaFloat2 vec2
#define FxaaFloat3 vec3
#define FxaaFloat4 vec4
#define FxaaHalf float
#define FxaaHalf2 vec2
#define FxaaHalf3 vec3
#define FxaaHalf4 vec4
#define FxaaInt2 vec2
#define FxaaTex sampler2D
#define FxaaSat(x) clamp(x, 0.0, 1.0)
#define FxaaTexTop(t, p) texture(t, p)
#define FxaaTexOff(t, p, o, r) texture(t, p + (o * r))
FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.y; }
FxaaFloat4 FxaaPixelShader(
FxaaFloat2 pos,
FxaaTex tex,
FxaaFloat2 fxaaQualityRcpFrame,
FxaaFloat fxaaQualitySubpix,
FxaaFloat fxaaQualityEdgeThreshold,
FxaaFloat fxaaQualityEdgeThresholdMin
) {
FxaaFloat2 posM;
posM.x = pos.x;
posM.y = pos.y;
FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);
#define lumaM rgbyM.y
FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0, 1), fxaaQualityRcpFrame.xy));
FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 0), fxaaQualityRcpFrame.xy));
FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0,-1), fxaaQualityRcpFrame.xy));
FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 0), fxaaQualityRcpFrame.xy));
FxaaFloat maxSM = max(lumaS, lumaM);
FxaaFloat minSM = min(lumaS, lumaM);
FxaaFloat maxESM = max(lumaE, maxSM);
FxaaFloat minESM = min(lumaE, minSM);
FxaaFloat maxWN = max(lumaN, lumaW);
FxaaFloat minWN = min(lumaN, lumaW);
FxaaFloat rangeMax = max(maxWN, maxESM);
FxaaFloat rangeMin = min(minWN, minESM);
FxaaFloat rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;
FxaaFloat range = rangeMax - rangeMin;
FxaaFloat rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);
FxaaBool earlyExit = range < rangeMaxClamped;
if(earlyExit)
return rgbyM;
FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1,-1), fxaaQualityRcpFrame.xy));
FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 1), fxaaQualityRcpFrame.xy));
FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1,-1), fxaaQualityRcpFrame.xy));
FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));
FxaaFloat lumaNS = lumaN + lumaS;
FxaaFloat lumaWE = lumaW + lumaE;
FxaaFloat subpixRcpRange = 1.0/range;
FxaaFloat subpixNSWE = lumaNS + lumaWE;
FxaaFloat edgeHorz1 = (-2.0 * lumaM) + lumaNS;
FxaaFloat edgeVert1 = (-2.0 * lumaM) + lumaWE;
FxaaFloat lumaNESE = lumaNE + lumaSE;
FxaaFloat lumaNWNE = lumaNW + lumaNE;
FxaaFloat edgeHorz2 = (-2.0 * lumaE) + lumaNESE;
FxaaFloat edgeVert2 = (-2.0 * lumaN) + lumaNWNE;
FxaaFloat lumaNWSW = lumaNW + lumaSW;
FxaaFloat lumaSWSE = lumaSW + lumaSE;
FxaaFloat edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);
FxaaFloat edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);
FxaaFloat edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;
FxaaFloat edgeVert3 = (-2.0 * lumaS) + lumaSWSE;
FxaaFloat edgeHorz = abs(edgeHorz3) + edgeHorz4;
FxaaFloat edgeVert = abs(edgeVert3) + edgeVert4;
FxaaFloat subpixNWSWNESE = lumaNWSW + lumaNESE;
FxaaFloat lengthSign = fxaaQualityRcpFrame.x;
FxaaBool horzSpan = edgeHorz >= edgeVert;
FxaaFloat subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;
if(!horzSpan) lumaN = lumaW;
if(!horzSpan) lumaS = lumaE;
if(horzSpan) lengthSign = fxaaQualityRcpFrame.y;
FxaaFloat subpixB = (subpixA * (1.0/12.0)) - lumaM;
FxaaFloat gradientN = lumaN - lumaM;
FxaaFloat gradientS = lumaS - lumaM;
FxaaFloat lumaNN = lumaN + lumaM;
FxaaFloat lumaSS = lumaS + lumaM;
FxaaBool pairN = abs(gradientN) >= abs(gradientS);
FxaaFloat gradient = max(abs(gradientN), abs(gradientS));
if(pairN) lengthSign = -lengthSign;
FxaaFloat subpixC = FxaaSat(abs(subpixB) * subpixRcpRange);
FxaaFloat2 posB;
posB.x = posM.x;
posB.y = posM.y;
FxaaFloat2 offNP;
offNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;
offNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;
if(!horzSpan) posB.x += lengthSign * 0.5;
if( horzSpan) posB.y += lengthSign * 0.5;
FxaaFloat2 posN;
posN.x = posB.x - offNP.x * FXAA_QUALITY_P0;
posN.y = posB.y - offNP.y * FXAA_QUALITY_P0;
FxaaFloat2 posP;
posP.x = posB.x + offNP.x * FXAA_QUALITY_P0;
posP.y = posB.y + offNP.y * FXAA_QUALITY_P0;
FxaaFloat subpixD = ((-2.0)*subpixC) + 3.0;
FxaaFloat lumaEndN = FxaaLuma(FxaaTexTop(tex, posN));
FxaaFloat subpixE = subpixC * subpixC;
FxaaFloat lumaEndP = FxaaLuma(FxaaTexTop(tex, posP));
if(!pairN) lumaNN = lumaSS;
FxaaFloat gradientScaled = gradient * 1.0/4.0;
FxaaFloat lumaMM = lumaM - lumaNN * 0.5;
FxaaFloat subpixF = subpixD * subpixE;
FxaaBool lumaMLTZero = lumaMM < 0.0;
lumaEndN -= lumaNN * 0.5;
lumaEndP -= lumaNN * 0.5;
FxaaBool doneN = abs(lumaEndN) >= gradientScaled;
FxaaBool doneP = abs(lumaEndP) >= gradientScaled;
if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P1;
if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P1;
FxaaBool doneNP = (!doneN) || (!doneP);
if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P1;
if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P1;
if(doneNP) {
if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));
if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));
if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;
if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;
doneN = abs(lumaEndN) >= gradientScaled;
doneP = abs(lumaEndP) >= gradientScaled;
if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P2;
if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P2;
doneNP = (!doneN) || (!doneP);
if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P2;
if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P2;
#if (FXAA_QUALITY_PS > 3)
if(doneNP) {
if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));
if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));
if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;
if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;
doneN = abs(lumaEndN) >= gradientScaled;
doneP = abs(lumaEndP) >= gradientScaled;
if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P3;
if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P3;
doneNP = (!doneN) || (!doneP);
if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P3;
if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P3;
#if (FXAA_QUALITY_PS > 4)
if(doneNP) {
if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));
if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));
if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;
if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;
doneN = abs(lumaEndN) >= gradientScaled;
doneP = abs(lumaEndP) >= gradientScaled;
if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P4;
if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P4;
doneNP = (!doneN) || (!doneP);
if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P4;
if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P4;
#if (FXAA_QUALITY_PS > 5)
if(doneNP) {
if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));
if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));
if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;
if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;
doneN = abs(lumaEndN) >= gradientScaled;
doneP = abs(lumaEndP) >= gradientScaled;
if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P5;
if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P5;
doneNP = (!doneN) || (!doneP);
if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P5;
if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P5;
#if (FXAA_QUALITY_PS > 6)
if(doneNP) {
if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));
if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));
if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;
if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;
doneN = abs(lumaEndN) >= gradientScaled;
doneP = abs(lumaEndP) >= gradientScaled;
if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P6;
if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P6;
doneNP = (!doneN) || (!doneP);
if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P6;
if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P6;
#if (FXAA_QUALITY_PS > 7)
if(doneNP) {
if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));
if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));
if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;
if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;
doneN = abs(lumaEndN) >= gradientScaled;
doneP = abs(lumaEndP) >= gradientScaled;
if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P7;
if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P7;
doneNP = (!doneN) || (!doneP);
if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P7;
if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P7;
#if (FXAA_QUALITY_PS > 8)
if(doneNP) {
if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));
if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));
if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;
if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;
doneN = abs(lumaEndN) >= gradientScaled;
doneP = abs(lumaEndP) >= gradientScaled;
if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P8;
if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P8;
doneNP = (!doneN) || (!doneP);
if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P8;
if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P8;
#if (FXAA_QUALITY_PS > 9)
if(doneNP) {
if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));
if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));
if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;
if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;
doneN = abs(lumaEndN) >= gradientScaled;
doneP = abs(lumaEndP) >= gradientScaled;
if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P9;
if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P9;
doneNP = (!doneN) || (!doneP);
if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P9;
if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P9;
#if (FXAA_QUALITY_PS > 10)
if(doneNP) {
if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));
if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));
if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;
if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;
doneN = abs(lumaEndN) >= gradientScaled;
doneP = abs(lumaEndP) >= gradientScaled;
if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P10;
if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P10;
doneNP = (!doneN) || (!doneP);
if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P10;
if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P10;
#if (FXAA_QUALITY_PS > 11)
if(doneNP) {
if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));
if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));
if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;
if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;
doneN = abs(lumaEndN) >= gradientScaled;
doneP = abs(lumaEndP) >= gradientScaled;
if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P11;
if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P11;
doneNP = (!doneN) || (!doneP);
if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P11;
if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P11;
#if (FXAA_QUALITY_PS > 12)
if(doneNP) {
if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));
if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));
if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;
if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;
doneN = abs(lumaEndN) >= gradientScaled;
doneP = abs(lumaEndP) >= gradientScaled;
if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P12;
if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P12;
doneNP = (!doneN) || (!doneP);
if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P12;
if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P12;
}
#endif
}
#endif
}
#endif
}
#endif
}
#endif
}
#endif
}
#endif
}
#endif
}
#endif
}
#endif
}
FxaaFloat dstN = posM.x - posN.x;
FxaaFloat dstP = posP.x - posM.x;
if(!horzSpan) dstN = posM.y - posN.y;
if(!horzSpan) dstP = posP.y - posM.y;
FxaaBool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;
FxaaFloat spanLength = (dstP + dstN);
FxaaBool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;
FxaaFloat spanLengthRcp = 1.0/spanLength;
FxaaBool directionN = dstN < dstP;
FxaaFloat dst = min(dstN, dstP);
FxaaBool goodSpan = directionN ? goodSpanN : goodSpanP;
FxaaFloat subpixG = subpixF * subpixF;
FxaaFloat pixelOffset = (dst * (-spanLengthRcp)) + 0.5;
FxaaFloat subpixH = subpixG * fxaaQualitySubpix;
FxaaFloat pixelOffsetGood = goodSpan ? pixelOffset : 0.0;
FxaaFloat pixelOffsetSubpix = max(pixelOffsetGood, subpixH);
if(!horzSpan) posM.x += pixelOffsetSubpix * lengthSign;
if( horzSpan) posM.y += pixelOffsetSubpix * lengthSign;
return FxaaFloat4(FxaaTexTop(tex, posM).xyz, lumaM);
}
`;function ox(e){e=y(e,y.EMPTY_OBJECT),A.defined("options.stages",e.stages),A.typeOf.number.greaterThan("options.stages.length",e.stages.length,0),this._stages=e.stages,this._inputPreviousStageTexture=y(e.inputPreviousStageTexture,!0);let t=e.name;c(t)||(t=Hn()),this._name=t,this._uniforms=e.uniforms,this._textureCache=void 0,this._index=void 0,this._selected=void 0,this._selectedShadow=void 0,this._parentSelected=void 0,this._parentSelectedShadow=void 0,this._combinedSelected=void 0,this._combinedSelectedShadow=void 0,this._selectedLength=0,this._parentSelectedLength=0,this._selectedDirty=!0}Object.defineProperties(ox.prototype,{ready:{get:function(){let e=this._stages,t=e.length;for(let n=0;n<t;++n)if(!e[n].ready)return!1;return!0}},name:{get:function(){return this._name}},enabled:{get:function(){return this._stages[0].enabled},set:function(e){let t=this._stages,n=t.length;for(let i=0;i<n;++i)t[i].enabled=e}},uniforms:{get:function(){return this._uniforms}},inputPreviousStageTexture:{get:function(){return this._inputPreviousStageTexture}},length:{get:function(){return this._stages.length}},selected:{get:function(){return this._selected},set:function(e){this._selected=e}},parentSelected:{get:function(){return this._parentSelected},set:function(e){this._parentSelected=e}}});ox.prototype._isSupported=function(e){let t=this._stages,n=t.length;for(let i=0;i<n;++i)if(!t[i]._isSupported(e))return!1;return!0};ox.prototype.get=function(e){return A.typeOf.number.greaterThanOrEquals("index",e,0),A.typeOf.number.lessThan("index",e,this.length),this._stages[e]};function Iyt(e){let t=c(e._selected)?e._selected.length:0,n=c(e._parentSelected)?e._parentSelected:0,i=e._selected!==e._selectedShadow||t!==e._selectedLength;if(i=i||e._parentSelected!==e._parentSelectedShadow||n!==e._parentSelectedLength,c(e._selected)&&c(e._parentSelected)?e._combinedSelected=e._selected.concat(e._parentSelected):c(e._parentSelected)?e._combinedSelected=e._parentSelected:e._combinedSelected=e._selected,!i&&c(e._combinedSelected)){if(!c(e._combinedSelectedShadow))return!0;t=e._combinedSelected.length;for(let o=0;o<t;++o)if(e._combinedSelected[o]!==e._combinedSelectedShadow[o])return!0}return i}ox.prototype.update=function(e,t){this._selectedDirty=Iyt(this),this._selectedShadow=this._selected,this._parentSelectedShadow=this._parentSelected,this._combinedSelectedShadow=this._combinedSelected,this._selectedLength=c(this._selected)?this._selected.length:0,this._parentSelectedLength=c(this._parentSelected)?this._parentSelected.length:0;let n=this._stages,i=n.length;for(let o=0;o<i;++o){let r=n[o];this._selectedDirty&&(r.parentSelected=this._combinedSelected),r.update(e,t)}};ox.prototype.isDestroyed=function(){return!1};ox.prototype.destroy=function(){let e=this._stages,t=e.length;for(let n=0;n<t;++n)e[n].destroy();return de(this)};var bu=ox;var Ar={};function sF(e){let o=`#define USE_STEP_SIZE
${VC}`,r=new po({name:`${e}_x_direction`,fragmentShader:o,uniforms:{delta:1,sigma:2,stepSize:1,direction:0},sampleMode:Yd.LINEAR}),s=new po({name:`${e}_y_direction`,fragmentShader:o,uniforms:{delta:1,sigma:2,stepSize:1,direction:1},sampleMode:Yd.LINEAR}),a={};return Object.defineProperties(a,{delta:{get:function(){return r.uniforms.delta},set:function(l){let u=r.uniforms,f=s.uniforms;u.delta=f.delta=l}},sigma:{get:function(){return r.uniforms.sigma},set:function(l){let u=r.uniforms,f=s.uniforms;u.sigma=f.sigma=l}},stepSize:{get:function(){return r.uniforms.stepSize},set:function(l){let u=r.uniforms,f=s.uniforms;u.stepSize=f.stepSize=l}}}),new bu({name:e,stages:[r,s],uniforms:a})}Ar.createBlurStage=function(){return sF("czm_blur")};Ar.createDepthOfFieldStage=function(){let e=sF("czm_depth_of_field_blur"),t=new po({name:"czm_depth_of_field_composite",fragmentShader:hX,uniforms:{focalDistance:5,blurTexture:e.name}}),n={};return Object.defineProperties(n,{focalDistance:{get:function(){return t.uniforms.focalDistance},set:function(i){t.uniforms.focalDistance=i}},delta:{get:function(){return e.uniforms.delta},set:function(i){e.uniforms.delta=i}},sigma:{get:function(){return e.uniforms.sigma},set:function(i){e.uniforms.sigma=i}},stepSize:{get:function(){return e.uniforms.stepSize},set:function(i){e.uniforms.stepSize=i}}}),new bu({name:"czm_depth_of_field",stages:[e,t],inputPreviousStageTexture:!1,uniforms:n})};Ar.isDepthOfFieldSupported=function(e){return e.context.depthTexture};Ar.createEdgeDetectionStage=function(){let e=Hn();return new po({name:`czm_edge_detection_${e}`,fragmentShader:pX,uniforms:{length:.25,color:j.clone(j.BLACK)}})};Ar.isEdgeDetectionSupported=function(e){return e.context.depthTexture};function Oyt(e){if(!c(e))return Ar.createEdgeDetectionStage();let t=new bu({name:"czm_edge_detection_multiple",stages:e,inputPreviousStageTexture:!1}),n={},i="",o="";for(let a=0;a<e.length;++a)i+=`uniform sampler2D edgeTexture${a}; 
`,o+=`        vec4 edge${a} = texture(edgeTexture${a}, v_textureCoordinates); 
        if (edge${a}.a > 0.0) 
        { 
            color = edge${a}; 
            break; 
        } 
`,n[`edgeTexture${a}`]=e[a].name;let r=`${i}in vec2 v_textureCoordinates; 
void main() { 
    vec4 color = vec4(0.0); 
    for (int i = 0; i < ${e.length}; i++) 
    { 
${o}    } 
    out_FragColor = color; 
} 
`,s=new po({name:"czm_edge_detection_combine",fragmentShader:r,uniforms:n});return new bu({name:"czm_edge_detection_composite",stages:[t,s]})}Ar.createSilhouetteStage=function(e){let t=Oyt(e),n=new po({name:"czm_silhouette_color_edges",fragmentShader:CX,uniforms:{silhouetteTexture:t.name}});return new bu({name:"czm_silhouette",stages:[t,n],inputPreviousStageTexture:!1,uniforms:t.uniforms})};Ar.isSilhouetteSupported=function(e){return e.context.depthTexture};Ar.createBloomStage=function(){let e=new po({name:"czm_bloom_contrast_bias",fragmentShader:dX,uniforms:{contrast:128,brightness:-.3}}),t=sF("czm_bloom_blur"),n=new bu({name:"czm_bloom_contrast_bias_blur",stages:[e,t]}),i=new po({name:"czm_bloom_generate_composite",fragmentShader:uX,uniforms:{glowOnly:!1,bloomTexture:n.name}}),o={};return Object.defineProperties(o,{glowOnly:{get:function(){return i.uniforms.glowOnly},set:function(r){i.uniforms.glowOnly=r}},contrast:{get:function(){return e.uniforms.contrast},set:function(r){e.uniforms.contrast=r}},brightness:{get:function(){return e.uniforms.brightness},set:function(r){e.uniforms.brightness=r}},delta:{get:function(){return t.uniforms.delta},set:function(r){t.uniforms.delta=r}},sigma:{get:function(){return t.uniforms.sigma},set:function(r){t.uniforms.sigma=r}},stepSize:{get:function(){return t.uniforms.stepSize},set:function(r){t.uniforms.stepSize=r}}}),new bu({name:"czm_bloom",stages:[n,i],inputPreviousStageTexture:!1,uniforms:o})};Ar.createAmbientOcclusionStage=function(){let e=new po({name:"czm_ambient_occlusion_generate",fragmentShader:aX,uniforms:{intensity:3,bias:.1,lengthCap:.26,stepSize:1.95,frustumLength:1e3,randomTexture:void 0}}),t=sF("czm_ambient_occlusion_blur");t.uniforms.stepSize=.86;let n=new bu({name:"czm_ambient_occlusion_generate_blur",stages:[e,t]}),i=new po({name:"czm_ambient_occlusion_composite",fragmentShader:cX,uniforms:{ambientOcclusionOnly:!1,ambientOcclusionTexture:n.name}}),o={};return Object.defineProperties(o,{intensity:{get:function(){return e.uniforms.intensity},set:function(r){e.uniforms.intensity=r}},bias:{get:function(){return e.uniforms.bias},set:function(r){e.uniforms.bias=r}},lengthCap:{get:function(){return e.uniforms.lengthCap},set:function(r){e.uniforms.lengthCap=r}},stepSize:{get:function(){return e.uniforms.stepSize},set:function(r){e.uniforms.stepSize=r}},frustumLength:{get:function(){return e.uniforms.frustumLength},set:function(r){e.uniforms.frustumLength=r}},randomTexture:{get:function(){return e.uniforms.randomTexture},set:function(r){e.uniforms.randomTexture=r}},delta:{get:function(){return t.uniforms.delta},set:function(r){t.uniforms.delta=r}},sigma:{get:function(){return t.uniforms.sigma},set:function(r){t.uniforms.sigma=r}},blurStepSize:{get:function(){return t.uniforms.stepSize},set:function(r){t.uniforms.stepSize=r}},ambientOcclusionOnly:{get:function(){return i.uniforms.ambientOcclusionOnly},set:function(r){i.uniforms.ambientOcclusionOnly=r}}}),new bu({name:"czm_ambient_occlusion",stages:[n,i],inputPreviousStageTexture:!1,uniforms:o})};Ar.isAmbientOcclusionSupported=function(e){return e.context.depthTexture};var Ryt=`#define FXAA_QUALITY_PRESET 39 
${EX}
${yX}`;Ar.createFXAAStage=function(){return new po({name:"czm_FXAA",fragmentShader:Ryt,sampleMode:Yd.LINEAR})};Ar.createAcesTonemappingStage=function(e){let t=e?`#define AUTO_EXPOSURE
`:"";return t+=sX,new po({name:"czm_aces",fragmentShader:t,uniforms:{autoExposure:void 0,exposure:1}})};Ar.createFilmicTonemappingStage=function(e){let t=e?`#define AUTO_EXPOSURE
`:"";return t+=_X,new po({name:"czm_filmic",fragmentShader:t,uniforms:{autoExposure:void 0,exposure:1}})};Ar.createPbrNeutralTonemappingStage=function(e){let t=e?`#define AUTO_EXPOSURE
`:"";return t+=gX,new po({name:"czm_pbr_neutral",fragmentShader:t,uniforms:{autoExposure:void 0,exposure:1}})};Ar.createReinhardTonemappingStage=function(e){let t=e?`#define AUTO_EXPOSURE
`:"";return t+=AX,new po({name:"czm_reinhard",fragmentShader:t,uniforms:{autoExposure:void 0,exposure:1}})};Ar.createModifiedReinhardTonemappingStage=function(e){let t=e?`#define AUTO_EXPOSURE
`:"";return t+=xX,new po({name:"czm_modified_reinhard",fragmentShader:t,uniforms:{white:j.WHITE,autoExposure:void 0,exposure:1}})};Ar.createAutoExposureStage=function(){return new uq};Ar.createBlackAndWhiteStage=function(){return new po({name:"czm_black_and_white",fragmentShader:lX,uniforms:{gradations:5}})};Ar.createBrightnessStage=function(){return new po({name:"czm_brightness",fragmentShader:fX,uniforms:{brightness:.5}})};Ar.createNightVisionStage=function(){return new po({name:"czm_night_vision",fragmentShader:TX})};Ar.createDepthViewStage=function(){return new po({name:"czm_depth_view",fragmentShader:mX})};Ar.createLensFlareStage=function(){return new po({name:"czm_lens_flare",fragmentShader:bX,uniforms:{dirtTexture:sn("Assets/Textures/LensFlare/DirtMask.jpg"),starTexture:sn("Assets/Textures/LensFlare/StarBurst.jpg"),intensity:2,distortion:10,ghostDispersal:.4,haloWidth:.4,dirtAmount:.4,earthRadius:ie.WGS84.maximumRadius}})};var Xd=Ar;function s_(e){this._collection=e,this._framebuffers=[],this._stageNameToFramebuffer={},this._width=void 0,this._height=void 0,this._updateDependencies=!1}function pP(e){for(;c(e.length);)e=e.get(e.length-1);return e.name}function SX(e,t,n,i,o){if(!i.enabled||!i._isSupported(t))return o;let r=n[i.name]={};if(c(o)){let a=e.getStageByName(o);r[pP(a)]=!0}let s=i.uniforms;if(c(s)){let a=Object.getOwnPropertyNames(s),l=a.length;for(let u=0;u<l;++u){let f=s[a[u]];if(typeof f=="string"){let d=e.getStageByName(f);c(d)&&(r[pP(d)]=!0)}}}return i.name}function mP(e,t,n,i,o){if(c(i.enabled)&&!i.enabled||c(i._isSupported)&&!i._isSupported(t))return o;let r=o,s=!c(i.inputPreviousStageTexture)||i.inputPreviousStageTexture,a=o,l=i.length;for(let d=0;d<l;++d){let p=i.get(d);c(p.length)?a=mP(e,t,n,p,o):a=SX(e,t,n,p,o),s&&(o=a)}let u,f;if(s)for(u=1;u<l;++u)f=pP(i.get(u)),c(n[f])||(n[f]={}),n[f][r]=!0;else for(u=1;u<l;++u){f=pP(i.get(u));let d=n[f];for(let p=0;p<u;++p)d[pP(i.get(p))]=!0}return a}function Myt(e,t){let n={};if(c(e.ambientOcclusion)){let i=e.ambientOcclusion,o=e.bloom,r=e._tonemapping,s=e.fxaa,a=mP(e,t,n,i,void 0);a=mP(e,t,n,o,a),a=SX(e,t,n,r,a),a=mP(e,t,n,e,a),SX(e,t,n,s,a)}else mP(e,t,n,e,void 0);return n}function Lyt(e,t,n){let o=e._collection.getStageByName(t),r=o._textureScale,s=o._forcePowerOfTwo,a=o._pixelFormat,l=o._pixelDatatype,u=o._clearColor,f,d,p=e._framebuffers,g=p.length;for(f=0;f<g;++f){if(d=p[f],r!==d.textureScale||s!==d.forcePowerOfTwo||a!==d.pixelFormat||l!==d.pixelDatatype||!j.equals(u,d.clearColor))continue;let m=d.stages,b=m.length,x=!1;for(let T=0;T<b;++T)if(n[m[T]]){x=!0;break}if(!x)break}return c(d)&&f<g?(d.stages.push(t),d):(d={textureScale:r,forcePowerOfTwo:s,pixelFormat:a,pixelDatatype:l,clearColor:u,stages:[t],buffer:new gi({pixelFormat:a,pixelDatatype:l}),clear:void 0},p.push(d),d)}function Nyt(e,t){let n=Myt(e._collection,t);for(let i in n)n.hasOwnProperty(i)&&(e._stageNameToFramebuffer[i]=Lyt(e,i,n[i]))}function wX(e){let t=e._framebuffers,n=t.length;for(let i=0;i<n;++i)t[i].buffer.destroy()}function Fyt(e,t){let n=e._width,i=e._height,o=e._framebuffers,r=o.length;for(let s=0;s<r;++s){let a=o[s],l=a.textureScale,u=Math.ceil(n*l),f=Math.ceil(i*l),d=Math.min(u,f);a.forcePowerOfTwo&&(R.isPowerOfTwo(d)||(d=R.nextPowerOfTwo(d)),u=d,f=d),a.buffer.update(t,u,f),a.clear=new ri({color:a.clearColor,framebuffer:a.buffer.framebuffer})}}s_.prototype.updateDependencies=function(){this._updateDependencies=!0};s_.prototype.update=function(e){let t=this._collection,n=this._updateDependencies,i=c(t.ambientOcclusion)&&t.ambientOcclusion.enabled&&t.ambientOcclusion._isSupported(e),o=c(t.bloom)&&t.bloom.enabled&&t.bloom._isSupported(e),r=c(t._tonemapping)&&t._tonemapping.enabled&&t._tonemapping._isSupported(e),s=c(t.fxaa)&&t.fxaa.enabled&&t.fxaa._isSupported(e),a=!c(t._activeStages)||t._activeStages.length>0||i||o||r||s;if((n||!a&&this._framebuffers.length>0)&&(wX(this),this._framebuffers.length=0,this._stageNameToFramebuffer={},this._width=void 0,this._height=void 0),!n&&!a)return;this._framebuffers.length===0&&Nyt(this,e);let l=e.drawingBufferWidth,u=e.drawingBufferHeight,f=this._width!==l||this._height!==u;!n&&!f||(this._width=l,this._height=u,this._updateDependencies=!1,wX(this),Fyt(this,e))};s_.prototype.clear=function(e){let t=this._framebuffers;for(let n=0;n<t.length;++n)t[n].clear.execute(e)};s_.prototype.getStageByName=function(e){return this._collection.getStageByName(e)};s_.prototype.getOutputTexture=function(e){return this._collection.getOutputTexture(e)};s_.prototype.getFramebuffer=function(e){let t=this._stageNameToFramebuffer[e];if(c(t))return t.buffer.framebuffer};s_.prototype.isDestroyed=function(){return!1};s_.prototype.destroy=function(){return wX(this),de(this)};var _P=s_;var UC={REINHARD:"REINHARD",MODIFIED_REINHARD:"MODIFIED_REINHARD",FILMIC:"FILMIC",ACES:"ACES",PBR_NEUTRAL:"PBR_NEUTRAL"};function exe(e){return e===UC.REINHARD||e===UC.MODIFIED_REINHARD||e===UC.FILMIC||e===UC.ACES||e===UC.PBR_NEUTRAL}var rx=Object.freeze(UC);var vX=[];function Bc(){let e=Xd.createFXAAStage(),t=Xd.createAmbientOcclusionStage(),n=Xd.createBloomStage();this._autoExposureEnabled=!1,this._autoExposure=Xd.createAutoExposureStage(),this._exposure=1,this._tonemapping=void 0,this._tonemapper=void 0,this.tonemapper=rx.PBR_NEUTRAL;let i=this._tonemapping;e.enabled=!1,t.enabled=!1,n.enabled=!1,i.enabled=!1;let o=new _P(this),r={},s=vX;for(s.push(e,t,n,i);s.length>0;){let l=s.pop();r[l.name]=l,l._textureCache=o;let u=l.length;if(c(u))for(let f=0;f<u;++f)s.push(l.get(f))}this._stages=[],this._activeStages=[],this._previousActiveStages=[],this._randomTexture=void 0;let a=this;t.uniforms.randomTexture=function(){return a._randomTexture},this._ao=t,this._bloom=n,this._fxaa=e,this._aoEnabled=void 0,this._bloomEnabled=void 0,this._tonemappingEnabled=void 0,this._fxaaEnabled=void 0,this._activeStagesChanged=!1,this._stagesRemoved=!1,this._textureCacheDirty=!1,this._stageNames=r,this._textureCache=o}Object.defineProperties(Bc.prototype,{ready:{get:function(){let e=!1,t=this._stages,n=t.length;for(let a=n-1;a>=0;--a){let l=t[a];e=e||l.ready&&l.enabled}let i=this._fxaa,o=this._ao,r=this._bloom,s=this._tonemapping;return e=e||i.ready&&i.enabled,e=e||o.ready&&o.enabled,e=e||r.ready&&r.enabled,e=e||s.ready&&s.enabled,e}},fxaa:{get:function(){return this._fxaa}},ambientOcclusion:{get:function(){return this._ao}},bloom:{get:function(){return this._bloom}},length:{get:function(){return DX(this),this._stages.length}},outputTexture:{get:function(){let e=this._fxaa;if(e.enabled&&e.ready)return this.getOutputTexture(e.name);let t=this._stages,n=t.length;for(let s=n-1;s>=0;--s){let a=t[s];if(c(a)&&a.ready&&a.enabled)return this.getOutputTexture(a.name)}let i=this._tonemapping;if(i.enabled&&i.ready)return this.getOutputTexture(i.name);let o=this._bloom;if(o.enabled&&o.ready)return this.getOutputTexture(o.name);let r=this._ao;if(r.enabled&&r.ready)return this.getOutputTexture(r.name)}},hasSelected:{get:function(){let e=this._stages.slice();for(;e.length>0;){let t=e.pop();if(!c(t))continue;if(c(t.selected))return!0;let n=t.length;if(c(n))for(let i=0;i<n;++i)e.push(t.get(i))}return!1}},tonemapper:{get:function(){return this._tonemapper},set:function(e){if(this._tonemapper===e)return;if(!exe(e))throw new E("tonemapper was set to an invalid value.");c(this._tonemapping)&&(delete this._stageNames[this._tonemapping.name],this._tonemapping.destroy());let t=this._autoExposureEnabled,n;switch(e){case rx.REINHARD:n=Xd.createReinhardTonemappingStage(t);break;case rx.MODIFIED_REINHARD:n=Xd.createModifiedReinhardTonemappingStage(t);break;case rx.FILMIC:n=Xd.createFilmicTonemappingStage(t);break;case rx.PBR_NEUTRAL:n=Xd.createPbrNeutralTonemappingStage(t);break;default:n=Xd.createAcesTonemappingStage(t);break}if(t){let i=this._autoExposure;n.uniforms.autoExposure=function(){return i.outputTexture}}else n.uniforms.exposure=this._exposure;this._tonemapper=e,this._tonemapping=n,c(this._stageNames)&&(this._stageNames[n.name]=n,n._textureCache=this._textureCache),this._textureCacheDirty=!0}},exposure:{get:function(){return this._exposure},set:function(e){this._tonemapping.uniforms.exposure=e,this._exposure=e}}});function DX(e){if(!e._stagesRemoved)return;e._stagesRemoved=!1;let t=[],n=e._stages;for(let i=0,o=0;i<n.length;++i){let r=n[i];r&&(r._index=o++,t.push(r))}e._stages=t}Bc.prototype.add=function(e){A.typeOf.object("stage",e);let t=this._stageNames,n=vX;for(n.push(e);n.length>0;){let o=n.pop();if(c(t[o.name]))throw new E(`${o.name} has already been added to the collection or does not have a unique name.`);t[o.name]=o,o._textureCache=this._textureCache;let r=o.length;if(c(r))for(let s=0;s<r;++s)n.push(o.get(s))}let i=this._stages;return e._index=i.length,i.push(e),this._textureCacheDirty=!0,e};Bc.prototype.remove=function(e){if(!this.contains(e))return!1;let t=this._stageNames,n=vX;for(n.push(e);n.length>0;){let i=n.pop();delete t[i.name];let o=i.length;if(c(o))for(let r=0;r<o;++r)n.push(i.get(r))}return this._stages[e._index]=void 0,this._stagesRemoved=!0,this._textureCacheDirty=!0,e._index=void 0,e._textureCache=void 0,e.destroy(),!0};Bc.prototype.contains=function(e){return c(e)&&c(e._index)&&e._textureCache===this._textureCache};Bc.prototype.get=function(e){DX(this);let t=this._stages,n=t.length;return A.typeOf.number.greaterThanOrEquals("stages length",n,0),A.typeOf.number.greaterThanOrEquals("index",e,0),A.typeOf.number.lessThan("index",e,n),t[e]};Bc.prototype.removeAll=function(){let e=this._stages,t=e.length;for(let n=0;n<t;++n)this.remove(e[n]);e.length=0};Bc.prototype.getStageByName=function(e){return this._stageNames[e]};Bc.prototype.update=function(e,t,n){DX(this);let i=this._activeStages,o=this._activeStages=this._previousActiveStages;this._previousActiveStages=i;let r=this._stages;o.length=r.length;let s=0;for(let T=0;T<r.length;++T){let C=r[T];C.ready&&C.enabled&&C._isSupported(e)&&(o[s++]=C)}o.length=s;let a=s!==i.length;if(!a){for(let T=0;T<s;++T)if(o[T]!==i[T]){a=!0;break}}let l=this._ao,u=this._bloom,f=this._autoExposure,d=this._tonemapping,p=this._fxaa;d.enabled=n;let g=l.enabled&&l._isSupported(e),m=u.enabled&&u._isSupported(e),b=d.enabled&&d._isSupported(e),x=p.enabled&&p._isSupported(e);if((a||this._textureCacheDirty||g!==this._aoEnabled||m!==this._bloomEnabled||b!==this._tonemappingEnabled||x!==this._fxaaEnabled)&&(this._textureCache.updateDependencies(),this._aoEnabled=g,this._bloomEnabled=m,this._tonemappingEnabled=b,this._fxaaEnabled=x,this._textureCacheDirty=!1),c(this._randomTexture)&&!g&&(this._randomTexture.destroy(),this._randomTexture=void 0),!c(this._randomTexture)&&g){let C=new Uint8Array(196608);for(let S=0;S<196608;S+=3)C[S]=Math.floor(Math.random()*255);this._randomTexture=new Lt({context:e,pixelFormat:Ve.RGB,pixelDatatype:Be.UNSIGNED_BYTE,source:{arrayBufferView:C,width:256,height:256},sampler:new Qt({wrapS:yn.REPEAT,wrapT:yn.REPEAT,minificationFilter:$t.NEAREST,magnificationFilter:fi.NEAREST})})}this._textureCache.update(e),p.update(e,t),l.update(e,t),u.update(e,t),d.update(e,t),this._autoExposureEnabled&&f.update(e,t);for(let T=0;T<r.length;++T)r[T].update(e,t);s=0;for(let T=0;T<r.length;++T){let C=r[T];C.ready&&C.enabled&&C._isSupported(e)&&s++}a=s!==o.length,a&&this.update(e,t,n)};Bc.prototype.clear=function(e){this._textureCache.clear(e),this._autoExposureEnabled&&this._autoExposure.clear(e)};function sx(e){for(;c(e.length);)e=e.get(e.length-1);return e.outputTexture}Bc.prototype.getOutputTexture=function(e){let t=this.getStageByName(e);if(c(t))return sx(t)};function hm(e,t,n,i,o){if(c(e.execute)){e.execute(t,n,i,o);return}if(e.inputPreviousStageTexture){hm(e.get(0),t,n,i,o);for(let r=1;r<e.length;++r)hm(e.get(r),t,sx(e.get(r-1)),i,o)}else for(let r=0;r<e.length;++r)hm(e.get(r),t,n,i,o)}Bc.prototype.execute=function(e,t,n,i){let o=this._activeStages,r=o.length,s=this._fxaa,a=this._ao,l=this._bloom,u=this._autoExposure,f=this._tonemapping,d=a.enabled&&a._isSupported(e),p=l.enabled&&l._isSupported(e),g=this._autoExposureEnabled,m=f.enabled&&f._isSupported(e),b=s.enabled&&s._isSupported(e);if(!b&&!d&&!p&&!m&&r===0)return;let x=t;d&&a.ready&&(hm(a,e,x,n,i),x=sx(a)),p&&l.ready&&(hm(l,e,x,n,i),x=sx(l)),g&&u.ready&&hm(u,e,x,n,i),m&&f.ready&&(hm(f,e,x,n,i),x=sx(f));let T=x;if(r>0){hm(o[0],e,x,n,i);for(let C=1;C<r;++C)hm(o[C],e,sx(o[C-1]),n,i);T=sx(o[r-1])}b&&s.ready&&hm(s,e,T,n,i)};Bc.prototype.copy=function(e,t){if(!c(this._copyColorCommand)){let n=this;this._copyColorCommand=e.createViewportQuadCommand(Df,{uniformMap:{colorTexture:function(){return n.outputTexture}},owner:this})}this._copyColorCommand.framebuffer=t,this._copyColorCommand.execute(e)};Bc.prototype.isDestroyed=function(){return!1};Bc.prototype.destroy=function(){return this._fxaa.destroy(),this._ao.destroy(),this._bloom.destroy(),this._autoExposure.destroy(),this._tonemapping.destroy(),this.removeAll(),this._textureCache=this._textureCache&&this._textureCache.destroy(),de(this)};var PX=Bc;function xu(){E.throwInstantiationError()}xu.computeDefaultLevelZeroMaximumGeometricError=function(e){return e.ellipsoid.maximumRadius*2*Math.PI*.25/(65*e.getNumberOfXTilesAtLevel(0))};Object.defineProperties(xu.prototype,{quadtree:{get:E.throwInstantiationError,set:E.throwInstantiationError},tilingScheme:{get:E.throwInstantiationError},errorEvent:{get:E.throwInstantiationError}});xu.prototype.update=E.throwInstantiationError;xu.prototype.beginUpdate=E.throwInstantiationError;xu.prototype.endUpdate=E.throwInstantiationError;xu.prototype.getLevelMaximumGeometricError=E.throwInstantiationError;xu.prototype.loadTile=E.throwInstantiationError;xu.prototype.computeTileVisibility=E.throwInstantiationError;xu.prototype.showTileThisFrame=E.throwInstantiationError;xu.prototype.computeDistanceToTile=E.throwInstantiationError;xu.prototype.isDestroyed=E.throwInstantiationError;xu.prototype.destroy=E.throwInstantiationError;var Byt=xu;function ax(e){A.typeOf.object("scene",e),this._scene=e,this._currentTweens=[],this._morphHandler=void 0,this._morphCancelled=!1,this._completeMorph=void 0,this._morphToOrthographic=!1}ax.prototype.completeMorph=function(){c(this._completeMorph)&&this._completeMorph()};ax.prototype.morphTo2D=function(e,t){c(this._completeMorph)&&this._completeMorph();let n=this._scene;this._previousMode=n.mode,this._morphToOrthographic=n.camera.frustum instanceof rn,!(this._previousMode===oe.SCENE2D||this._previousMode===oe.MORPHING)&&(this._scene.morphStart.raiseEvent(this,this._previousMode,oe.SCENE2D,!0),n._mode=oe.MORPHING,n.camera._setTransform(k.IDENTITY),this._previousMode===oe.COLUMBUS_VIEW?_0t(this,e):C0t(this,e,t),e===0&&c(this._completeMorph)&&this._completeMorph())};var kyt=new h,Vyt=new h,Uyt=new h,zyt=new h,Hyt=new h,Gyt=new h,jyt=new h,Wyt=new he,qyt=new k,Yyt=new vi,Xyt=new rn,Kyt={position:void 0,direction:void 0,up:void 0,position2D:void 0,direction2D:void 0,up2D:void 0,frustum:void 0};ax.prototype.morphToColumbusView=function(e,t){c(this._completeMorph)&&this._completeMorph();let n=this._scene;if(this._previousMode=n.mode,this._previousMode===oe.COLUMBUS_VIEW||this._previousMode===oe.MORPHING)return;this._scene.morphStart.raiseEvent(this,this._previousMode,oe.COLUMBUS_VIEW,!0),n.camera._setTransform(k.IDENTITY);let i=kyt,o=Vyt,r=Uyt;if(e>0)i.x=0,i.y=-1,i.z=1,i=h.multiplyByScalar(h.normalize(i,i),5*t.maximumRadius,i),h.negate(h.normalize(i,o),o),h.cross(h.UNIT_X,o,r);else{let u=n.camera;if(this._previousMode===oe.SCENE2D)h.clone(u.position,i),i.z=u.frustum.right-u.frustum.left,h.negate(h.UNIT_Z,o),h.clone(h.UNIT_Y,r);else{h.clone(u.positionWC,i),h.clone(u.directionWC,o),h.clone(u.upWC,r);let f=t.scaleToGeodeticSurface(i,jyt),d=Ft.eastNorthUpToFixedFrame(f,t,qyt);k.inverseTransformation(d,d),n.mapProjection.project(t.cartesianToCartographic(i,Wyt),i),k.multiplyByPointAsVector(d,o,o),k.multiplyByPointAsVector(d,r,r)}}let s;this._morphToOrthographic?(s=Xyt,s.width=n.camera.frustum.right-n.camera.frustum.left,s.aspectRatio=n.drawingBufferWidth/n.drawingBufferHeight):(s=Yyt,s.aspectRatio=n.drawingBufferWidth/n.drawingBufferHeight,s.fov=R.toRadians(60));let a=Kyt;a.position=i,a.direction=o,a.up=r,a.frustum=s;let l=S0t(a);gP(this,l),this._previousMode===oe.SCENE2D?E0t(this,e,a,l):(a.position2D=k.multiplyByPoint(so.TRANSFORM_2D,i,zyt),a.direction2D=k.multiplyByPointAsVector(so.TRANSFORM_2D,o,Hyt),a.up2D=k.multiplyByPointAsVector(so.TRANSFORM_2D,r,Gyt),n._mode=oe.MORPHING,fxe(this,e,a,l)),e===0&&c(this._completeMorph)&&this._completeMorph()};var RX={position:new h,direction:new h,up:new h,frustum:void 0},nxe=new vi;ax.prototype.morphTo3D=function(e,t){c(this._completeMorph)&&this._completeMorph();let n=this._scene;if(this._previousMode=n.mode,!(this._previousMode===oe.SCENE3D||this._previousMode===oe.MORPHING)){if(this._scene.morphStart.raiseEvent(this,this._previousMode,oe.SCENE3D,!0),n._mode=oe.MORPHING,n.camera._setTransform(k.IDENTITY),this._previousMode===oe.SCENE2D)s0t(this,e,t);else{let i;e>0?(i=RX,h.fromDegrees(0,0,5*t.maximumRadius,t,i.position),h.negate(i.position,i.direction),h.normalize(i.direction,i.direction),h.clone(h.UNIT_Z,i.up)):i=ixe(this,t);let o,r=n.camera;r.frustum instanceof rn?o=r.frustum.clone():(o=nxe,o.aspectRatio=n.drawingBufferWidth/n.drawingBufferHeight,o.fov=R.toRadians(60)),i.frustum=o;let s=hxe(i);gP(this,s),OX(this,e,i,s)}e===0&&c(this._completeMorph)&&this._completeMorph()}};ax.prototype.isDestroyed=function(){return!1};ax.prototype.destroy=function(){return aF(this),de(this)};function gP(e,t){if(e._scene.completeMorphOnUserInput){e._morphHandler=new Af(e._scene.canvas);let n=function(){e._morphCancelled=!0,e._scene.camera.cancelFlight(),t(e)};e._completeMorph=n,e._morphHandler.setInputAction(n,bn.LEFT_DOWN),e._morphHandler.setInputAction(n,bn.MIDDLE_DOWN),e._morphHandler.setInputAction(n,bn.RIGHT_DOWN),e._morphHandler.setInputAction(n,bn.WHEEL)}}function aF(e){let t=e._currentTweens;for(let n=0;n<t.length;++n)t[n].cancelTween();e._currentTweens.length=0,e._morphHandler=e._morphHandler&&e._morphHandler.destroy()}var $yt=new he,Zyt=new h,Jyt=new k;function ixe(e,t){let n=e._scene,i=n.camera,o=RX,r=o.position,s=o.direction,a=o.up,l=n.mapProjection.unproject(i.position,$yt);t.cartographicToCartesian(l,r);let u=t.scaleToGeodeticSurface(r,Zyt),f=Ft.eastNorthUpToFixedFrame(u,t,Jyt);return k.multiplyByPointAsVector(f,i.direction,s),k.multiplyByPointAsVector(f,i.up,a),o}var Qyt=new h,e0t=new h,t0t=new h,n0t=new h,i0t=new h,o0t=new h;function OX(e,t,n,i){t*=.5;let o=e._scene,r=o.camera,s=h.clone(r.position,Qyt),a=h.clone(r.direction,e0t),l=h.clone(r.up,t0t),u=k.multiplyByPoint(so.TRANSFORM_2D_INVERSE,n.position,n0t),f=k.multiplyByPointAsVector(so.TRANSFORM_2D_INVERSE,n.direction,i0t),d=k.multiplyByPointAsVector(so.TRANSFORM_2D_INVERSE,n.up,o0t);function p(m){If(s,u,m.time,r.position),If(a,f,m.time,r.direction),If(l,d,m.time,r.up),h.cross(r.direction,r.up,r.right),h.normalize(r.right,r.right)}let g=o.tweens.add({duration:t,easingFunction:qr.QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:p,complete:function(){dxe(e,o,0,1,t,i)}});e._currentTweens.push(g)}var r0t=new rn,oxe=new h,rxe=new h,sxe=new h,MX=new h,axe=new h,cxe=new h;function s0t(e,t,n){t/=3;let i=e._scene,o=i.camera,r;t>0?(r=RX,h.fromDegrees(0,0,5*n.maximumRadius,n,r.position),h.negate(r.position,r.direction),h.normalize(r.direction,r.direction),h.clone(h.UNIT_Z,r.up)):(o.position.z=o.frustum.right-o.frustum.left,r=ixe(e,n));let s;e._morphToOrthographic?(s=r0t,s.aspectRatio=i.drawingBufferWidth/i.drawingBufferHeight,s.width=o.frustum.right-o.frustum.left):(s=nxe,s.aspectRatio=i.drawingBufferWidth/i.drawingBufferHeight,s.fov=R.toRadians(60)),r.frustum=s;let a=hxe(r);gP(e,a);let l;e._morphToOrthographic?l=function(){OX(e,t,r,a)}:l=function(){uxe(e,t,r,function(){OX(e,t,r,a)})},t>0?(i._mode=oe.SCENE2D,o.flyTo({duration:t,destination:h.fromDegrees(0,0,5*n.maximumRadius,n,MX),complete:function(){i._mode=oe.MORPHING,l()}})):l()}function If(e,t,n,i){return h.lerp(e,t,n,i)}function lxe(e,t,n,i,o){let r=e._scene,s=r.camera;if(s.frustum instanceof rn)return;let a=s.frustum.fov,l=R.RADIANS_PER_DEGREE*.5,u=n.position.z*Math.tan(a*.5);s.frustum.far=u/Math.tan(l*.5)+1e7;function f(p){s.frustum.fov=R.lerp(a,l,p.time);let g=u/Math.tan(s.frustum.fov*.5);i(s,g)}let d=r.tweens.add({duration:t,easingFunction:qr.QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:f,complete:function(){s.frustum=n.frustum.clone(),o(e)}});e._currentTweens.push(d)}var a0t=new h,c0t=new h,l0t=new h,IX=new h,u0t=new h,f0t=new h,d0t=new er,h0t=new _n,m0t=new h,p0t={position:void 0,direction:void 0,up:void 0,frustum:void 0};function _0t(e,t){t*=.5;let n=e._scene,i=n.camera,o=h.clone(i.position,a0t),r=h.clone(i.direction,c0t),s=h.clone(i.up,l0t),a=h.negate(h.UNIT_Z,u0t),l=h.clone(h.UNIT_Y,f0t),u=IX;if(t>0)h.clone(h.ZERO,IX),u.z=5*n.ellipsoid.maximumRadius;else{h.clone(o,IX);let x=h0t;k.multiplyByPoint(so.TRANSFORM_2D,o,x.origin),k.multiplyByPointAsVector(so.TRANSFORM_2D,r,x.direction);let T=n.globe;if(c(T)){let C=T.pickWorldCoordinates(x,n,!0,m0t);c(C)&&(k.multiplyByPoint(so.TRANSFORM_2D_INVERSE,C,u),u.z+=h.distance(o,u))}}let f=d0t;f.right=u.z*.5,f.left=-f.right,f.top=f.right*(n.drawingBufferHeight/n.drawingBufferWidth),f.bottom=-f.top;let d=p0t;d.position=u,d.direction=a,d.up=l,d.frustum=f;let p=mxe(d);gP(e,p);function g(x){If(o,u,x.time,i.position),If(r,a,x.time,i.direction),If(s,l,x.time,i.up),h.cross(i.direction,i.up,i.right),h.normalize(i.right,i.right),i._adjustOrthographicFrustum(!0)}function m(x,T){x.position.z=T}let b=n.tweens.add({duration:t,easingFunction:qr.QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:g,complete:function(){lxe(e,t,d,m,p)}});e._currentTweens.push(b)}var txe=new he,g0t={position:new h,direction:new h,up:new h,position2D:new h,direction2D:new h,up2D:new h,frustum:new er},y0t={position:new h,direction:new h,up:new h,frustum:void 0},b0t=new h,x0t=new _n,T0t=new k,A0t=new h;function C0t(e,t,n){t*=.5;let i=e._scene,o=i.camera,r=g0t;if(t>0)h.clone(h.ZERO,r.position),r.position.z=5*n.maximumRadius,h.negate(h.UNIT_Z,r.direction),h.clone(h.UNIT_Y,r.up);else{n.cartesianToCartographic(o.positionWC,txe),i.mapProjection.project(txe,r.position),h.negate(h.UNIT_Z,r.direction),h.clone(h.UNIT_Y,r.up);let d=x0t;h.clone(r.position2D,d.origin);let p=h.clone(o.directionWC,d.direction),g=n.scaleToGeodeticSurface(o.positionWC,A0t),m=Ft.eastNorthUpToFixedFrame(g,n,T0t);k.inverseTransformation(m,m),k.multiplyByPointAsVector(m,p,p),k.multiplyByPointAsVector(so.TRANSFORM_2D,p,p);let b=i.globe;if(c(b)){let x=b.pickWorldCoordinates(d,i,!0,b0t);if(c(x)){let T=h.distance(r.position2D,x);x.x+=T,h.clone(x,r.position2D)}}}function s(d,p){d.position.x=p}k.multiplyByPoint(so.TRANSFORM_2D,r.position,r.position2D),k.multiplyByPointAsVector(so.TRANSFORM_2D,r.direction,r.direction2D),k.multiplyByPointAsVector(so.TRANSFORM_2D,r.up,r.up2D);let a=r.frustum;a.right=r.position.z*.5,a.left=-a.right,a.top=a.right*(i.drawingBufferHeight/i.drawingBufferWidth),a.bottom=-a.top;let l=y0t;k.multiplyByPoint(so.TRANSFORM_2D_INVERSE,r.position2D,l.position),h.clone(r.direction,l.direction),h.clone(r.up,l.up),l.frustum=a;let u=mxe(l);gP(e,u);function f(){lxe(e,t,r,s,u)}fxe(e,t,r,f)}function uxe(e,t,n,i){let o=e._scene,r=o.camera,s=r.frustum.right-r.frustum.left;r.frustum=n.frustum.clone();let a=r.frustum.fov,l=R.RADIANS_PER_DEGREE*.5,u=s*Math.tan(a*.5);r.frustum.far=u/Math.tan(l*.5)+1e7,r.frustum.fov=l;function f(p){r.frustum.fov=R.lerp(l,a,p.time),r.position.z=u/Math.tan(r.frustum.fov*.5)}let d=o.tweens.add({duration:t,easingFunction:qr.QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:f,complete:function(){i(e)}});e._currentTweens.push(d)}function E0t(e,t,n,i){t*=.5;let o=e._scene,r=o.camera,s=h.clone(n.position,MX),a=h.clone(n.direction,axe),l=h.clone(n.up,cxe);o._mode=oe.MORPHING;function u(){r.frustum=n.frustum.clone();let f=h.clone(r.position,oxe),d=h.clone(r.direction,rxe),p=h.clone(r.up,sxe);f.z=s.z;function g(b){If(f,s,b.time,r.position),If(d,a,b.time,r.direction),If(p,l,b.time,r.up),h.cross(r.direction,r.up,r.right),h.normalize(r.right,r.right)}let m=o.tweens.add({duration:t,easingFunction:qr.QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:g,complete:function(){i(e)}});e._currentTweens.push(m)}e._morphToOrthographic?u():uxe(e,0,n,u)}function fxe(e,t,n,i){let o=e._scene,r=o.camera,s=h.clone(r.position,oxe),a=h.clone(r.direction,rxe),l=h.clone(r.up,sxe),u=h.clone(n.position2D,MX),f=h.clone(n.direction2D,axe),d=h.clone(n.up2D,cxe);function p(m){If(s,u,m.time,r.position),If(a,f,m.time,r.direction),If(l,d,m.time,r.up),h.cross(r.direction,r.up,r.right),h.normalize(r.right,r.right),r._adjustOrthographicFrustum(!0)}let g=o.tweens.add({duration:t,easingFunction:qr.QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:p,complete:function(){dxe(e,o,1,0,t,i)}});e._currentTweens.push(g)}function dxe(e,t,n,i,o,r){let s={object:t,property:"morphTime",startValue:n,stopValue:i,duration:o,easingFunction:qr.QUARTIC_OUT};c(r)&&(s.complete=function(){r(e)});let a=t.tweens.addProperty(s);e._currentTweens.push(a)}function hxe(e){return function(t){let n=t._scene;n._mode=oe.SCENE3D,n.morphTime=oe.getMorphTime(oe.SCENE3D),aF(t);let i=n.camera;(t._previousMode!==oe.MORPHING||t._morphCancelled)&&(t._morphCancelled=!1,h.clone(e.position,i.position),h.clone(e.direction,i.direction),h.clone(e.up,i.up),h.cross(i.direction,i.up,i.right),h.normalize(i.right,i.right),i.frustum=e.frustum.clone());let o=i.frustum;n.frameState.useLogDepth&&(o.near=.1,o.far=1e10);let r=c(t._completeMorph);t._completeMorph=void 0,n.camera.update(n.mode),t._scene.morphComplete.raiseEvent(t,t._previousMode,oe.SCENE3D,r)}}function mxe(e){return function(t){let n=t._scene;n._mode=oe.SCENE2D,n.morphTime=oe.getMorphTime(oe.SCENE2D),aF(t);let i=n.camera;h.clone(e.position,i.position),i.position.z=n.ellipsoid.maximumRadius*2,h.clone(e.direction,i.direction),h.clone(e.up,i.up),h.cross(i.direction,i.up,i.right),h.normalize(i.right,i.right),i.frustum=e.frustum.clone();let o=c(t._completeMorph);t._completeMorph=void 0,n.camera.update(n.mode),t._scene.morphComplete.raiseEvent(t,t._previousMode,oe.SCENE2D,o)}}function S0t(e){return function(t){let n=t._scene;n._mode=oe.COLUMBUS_VIEW,n.morphTime=oe.getMorphTime(oe.COLUMBUS_VIEW),aF(t);let i=n.camera;(t._previousModeMode!==oe.MORPHING||t._morphCancelled)&&(t._morphCancelled=!1,h.clone(e.position,i.position),h.clone(e.direction,i.direction),h.clone(e.up,i.up),h.cross(i.direction,i.up,i.right),h.normalize(i.right,i.right));let o=i.frustum;n.frameState.useLogDepth&&(o.near=.1,o.far=1e10);let r=c(t._completeMorph);t._completeMorph=void 0,n.camera.update(n.mode),t._scene.morphComplete.raiseEvent(t,t._previousMode,oe.COLUMBUS_VIEW,r)}}var LX=ax;function cF(e,t,n,i,o,r,s,a,l,u){this._tweens=e,this._tweenjs=t,this._startObject=qe(n),this._stopObject=qe(i),this._duration=o,this._delay=r,this._easingFunction=s,this._update=a,this._complete=l,this.cancel=u,this.needsStart=!0}Object.defineProperties(cF.prototype,{startObject:{get:function(){return this._startObject}},stopObject:{get:function(){return this._stopObject}},duration:{get:function(){return this._duration}},delay:{get:function(){return this._delay}},easingFunction:{get:function(){return this._easingFunction}},update:{get:function(){return this._update}},complete:{get:function(){return this._complete}},tweenjs:{get:function(){return this._tweenjs}}});cF.prototype.cancelTween=function(){this._tweens.remove(this)};function Kd(){this._tweens=[]}Object.defineProperties(Kd.prototype,{length:{get:function(){return this._tweens.length}}});Kd.prototype.add=function(e){if(e=y(e,y.EMPTY_OBJECT),!c(e.startObject)||!c(e.stopObject))throw new E("options.startObject and options.stopObject are required.");if(!c(e.duration)||e.duration<0)throw new E("options.duration is required and must be positive.");if(e.duration===0)return c(e.complete)&&e.complete(),new cF(this);let t=e.duration/qn.SECONDS_PER_MILLISECOND,n=y(e.delay,0),i=n/qn.SECONDS_PER_MILLISECOND,o=y(e.easingFunction,qr.LINEAR_NONE),r=e.startObject,s=new mpe(r);s.to(qe(e.stopObject),t),s.delay(i),s.easing(o),c(e.update)&&s.onUpdate(function(){e.update(r)}),s.onComplete(y(e.complete,null)),s.repeat(y(e._repeat,0));let a=new cF(this,s,e.startObject,e.stopObject,e.duration,n,o,e.update,e.complete,e.cancel);return this._tweens.push(a),a};Kd.prototype.addProperty=function(e){e=y(e,y.EMPTY_OBJECT);let t=e.object,n=e.property,i=e.startValue,o=e.stopValue;if(!c(t)||!c(e.property))throw new E("options.object and options.property are required.");if(!c(t[n]))throw new E("options.object must have the specified property.");if(!c(i)||!c(o))throw new E("options.startValue and options.stopValue are required.");function r(s){t[n]=s.value}return this.add({startObject:{value:i},stopObject:{value:o},duration:y(e.duration,3),delay:e.delay,easingFunction:e.easingFunction,update:r,complete:e.complete,cancel:e.cancel,_repeat:e._repeat})};Kd.prototype.addAlpha=function(e){e=y(e,y.EMPTY_OBJECT);let t=e.material;if(!c(t))throw new E("options.material is required.");let n=[];for(let o in t.uniforms)t.uniforms.hasOwnProperty(o)&&c(t.uniforms[o])&&c(t.uniforms[o].alpha)&&n.push(o);if(n.length===0)throw new E("material has no properties with alpha components.");function i(o){let r=n.length;for(let s=0;s<r;++s)t.uniforms[n[s]].alpha=o.alpha}return this.add({startObject:{alpha:y(e.startValue,0)},stopObject:{alpha:y(e.stopValue,1)},duration:y(e.duration,3),delay:e.delay,easingFunction:e.easingFunction,update:i,complete:e.complete,cancel:e.cancel})};Kd.prototype.addOffsetIncrement=function(e){e=y(e,y.EMPTY_OBJECT);let t=e.material;if(!c(t))throw new E("material is required.");if(!c(t.uniforms.offset))throw new E("material.uniforms must have an offset property.");let n=t.uniforms;return this.addProperty({object:n,property:"offset",startValue:n.offset,stopValue:n.offset+1,duration:e.duration,delay:e.delay,easingFunction:e.easingFunction,update:e.update,cancel:e.cancel,_repeat:1/0})};Kd.prototype.remove=function(e){if(!c(e))return!1;let t=this._tweens.indexOf(e);return t!==-1?(e.tweenjs.stop(),c(e.cancel)&&e.cancel(),this._tweens.splice(t,1),!0):!1};Kd.prototype.removeAll=function(){let e=this._tweens;for(let t=0;t<e.length;++t){let n=e[t];n.tweenjs.stop(),c(n.cancel)&&n.cancel()}e.length=0};Kd.prototype.contains=function(e){return c(e)&&this._tweens.indexOf(e)!==-1};Kd.prototype.get=function(e){if(!c(e))throw new E("index is required.");return this._tweens[e]};Kd.prototype.update=function(e){let t=this._tweens,n=0;for(e=c(e)?e/qn.SECONDS_PER_MILLISECOND:Ei();n<t.length;){let i=t[n],o=i.tweenjs;i.needsStart?(i.needsStart=!1,o.start(e)):o.update(e)?n++:(o.stop(),t.splice(n,1))}};var yP=Kd;function xP(e){if(!c(e))throw new E("scene is required.");this.enableInputs=!0,this.enableTranslate=!0,this.enableZoom=!0,this.enableRotate=!0,this.enableTilt=!0,this.enableLook=!0,this.inertiaSpin=.9,this.inertiaTranslate=.9,this.inertiaZoom=.8,this.maximumMovementRatio=.1,this.bounceAnimationTime=3,this.minimumZoomDistance=1,this.maximumZoomDistance=Number.POSITIVE_INFINITY,this.zoomFactor=5,this.translateEventTypes=zi.LEFT_DRAG,this.zoomEventTypes=[zi.RIGHT_DRAG,zi.WHEEL,zi.PINCH],this.rotateEventTypes=zi.LEFT_DRAG,this.tiltEventTypes=[zi.MIDDLE_DRAG,zi.PINCH,{eventType:zi.LEFT_DRAG,modifier:Ca.CTRL},{eventType:zi.RIGHT_DRAG,modifier:Ca.CTRL}],this.lookEventTypes={eventType:zi.LEFT_DRAG,modifier:Ca.SHIFT};let t=y(e.ellipsoid,ie.default);this.minimumPickingTerrainHeight=ie.WGS84.equals(t)?15e4:t.minimumRadius*.025,this._minimumPickingTerrainHeight=this.minimumPickingTerrainHeight,this.minimumPickingTerrainDistanceWithInertia=ie.WGS84.equals(t)?4e3:t.minimumRadius*63e-5,this.minimumCollisionTerrainHeight=ie.WGS84.equals(t)?15e3:t.minimumRadius*.0025,this._minimumCollisionTerrainHeight=this.minimumCollisionTerrainHeight,this.minimumTrackBallHeight=ie.WGS84.equals(t)?75e5:t.minimumRadius*1.175,this._minimumTrackBallHeight=this.minimumTrackBallHeight,this.enableCollisionDetection=!0,this.maximumTiltAngle=void 0,this._scene=e,this._globe=void 0,this._ellipsoid=t,this._lastGlobeHeight=0,this._aggregator=new jq(e.canvas),this._lastInertiaSpinMovement=void 0,this._lastInertiaZoomMovement=void 0,this._lastInertiaTranslateMovement=void 0,this._lastInertiaTiltMovement=void 0,this._inertiaDisablers={_lastInertiaZoomMovement:["_lastInertiaSpinMovement","_lastInertiaTranslateMovement","_lastInertiaTiltMovement"],_lastInertiaTiltMovement:["_lastInertiaSpinMovement","_lastInertiaTranslateMovement"]},this._tweens=new yP,this._tween=void 0,this._horizontalRotationAxis=void 0,this._tiltCenterMousePosition=new H(-1,-1),this._tiltCenter=new h,this._rotateMousePosition=new H(-1,-1),this._rotateStartPosition=new h,this._strafeStartPosition=new h,this._strafeMousePosition=new H,this._strafeEndMousePosition=new H,this._zoomMouseStart=new H(-1,-1),this._zoomWorldPosition=new h,this._useZoomWorldPosition=!1,this._panLastMousePosition=new H,this._panLastWorldPosition=new h,this._tiltCVOffMap=!1,this._looking=!1,this._rotating=!1,this._strafing=!1,this._zoomingOnVector=!1,this._zoomingUnderground=!1,this._rotatingZoom=!1,this._adjustedHeightForTerrain=!1,this._cameraUnderground=!1;let n=e.mapProjection;this._maxCoord=n.project(new he(Math.PI,R.PI_OVER_TWO)),this._rotateFactor=void 0,this._rotateRateRangeAdjustment=void 0,this._maximumRotateRate=1.77,this._minimumRotateRate=1/5e3,this._minimumZoomRate=20,this._maximumZoomRate=5906376272e3,this._minimumUndergroundPickDistance=2e3,this._maximumUndergroundPickDistance=1e4}function w0t(e,t){if(e<0)return 0;let n=(1-t)*25;return Math.exp(-n*e)}function v0t(e){return H.equalsEpsilon(e.startPosition,e.endPosition,R.EPSILON14)}var D0t=.4;function P0t(e,t,n,i,o,r,s){let a=r[s];c(a)||(a=r[s]={startPosition:new H,endPosition:new H,motion:new H,inertiaEnabled:!0});let l=e.getButtonPressTime(t,n),u=e.getButtonReleaseTime(t,n),f=l&&u&&(u.getTime()-l.getTime())/1e3,p=u&&(new Date().getTime()-u.getTime())/1e3;if(l&&u&&f<D0t){let g=w0t(p,i),m=e.getLastMovement(t,n);if(!c(m)||v0t(m)||!a.inertiaEnabled||(a.motion.x=(m.endPosition.x-m.startPosition.x)*.5,a.motion.y=(m.endPosition.y-m.startPosition.y)*.5,a.startPosition=H.clone(m.startPosition,a.startPosition),a.endPosition=H.multiplyByScalar(a.motion,g,a.endPosition),a.endPosition=H.add(a.startPosition,a.endPosition,a.endPosition),isNaN(a.endPosition.x)||isNaN(a.endPosition.y)||H.distance(a.startPosition,a.endPosition)<.5))return;if(!e.isButtonDown(t,n)){let b=e.getStartMousePosition(t,n);o(r,b,a)}}}function I0t(e,t){if(c(t)){let n=e[t];c(n)&&(n.inertiaEnabled=!0);let i=e._inertiaDisablers[t];if(c(i)){let o=i.length;for(let r=0;r<o;++r)n=e[i[r]],c(n)&&(n.inertiaEnabled=!1)}}}var pxe=[];function kc(e,t,n,i,o,r){if(!c(n))return;let s=e._aggregator;Array.isArray(n)||(pxe[0]=n,n=pxe);let a=n.length;for(let l=0;l<a;++l){let u=n[l],f=c(u.eventType)?u.eventType:u,d=u.modifier,p=s.isMoving(f,d)&&s.getMovement(f,d),g=s.getStartMousePosition(f,d);e.enableInputs&&t&&(p?(i(e,g,p),I0t(e,r)):o<1&&P0t(s,f,d,o,i,e,r))}}var lF=new _n,O0t=new h,R0t=new H,M0t=new h,L0t=new H,N0t=new h,F0t=new h,B0t=new h,k0t=new h,vxe=new h,V0t=new h,U0t=new h,z0t=new h,H0t=new h,G0t=new h,j0t=new h,W0t=new h,q0t=new h,Y0t=new h,X0t=new h,cx=new h,_xe=new h,gxe=new h,NX={orientation:new Fa};function GX(e,t,n,i,o,r){let s=1;c(r)&&(s=R.clamp(Math.abs(r),.25,1));let a=n.endPosition.y-n.startPosition.y,u=a>0?e.minimumZoomDistance*s:0,f=e.maximumZoomDistance,d=o-u,p=i*d;p=R.clamp(p,e._minimumZoomRate,e._maximumZoomRate);let g=a/e._scene.canvas.clientHeight;g=Math.min(g,e.maximumMovementRatio);let m=p*g;if(e.enableCollisionDetection||e.minimumZoomDistance===0||!c(e._globe)){if(m>0&&Math.abs(o-u)<1||m<0&&Math.abs(o-f)<1)return;o-m<u?m=o-u-1:o-m>f&&(m=o-f)}let b=e._scene,x=b.camera,T=b.mode,C=NX.orientation;if(C.heading=x.heading,C.pitch=x.pitch,C.roll=x.roll,x.frustum instanceof rn){Math.abs(m)>0&&(x.zoomIn(m),x._adjustOrthographicFrustum(!0));return}let S=y(n.inertiaEnabled,H.equals(t,e._zoomMouseStart)),v=e._zoomingOnVector,D=e._rotatingZoom,I;if(S||(e._zoomMouseStart=H.clone(t,e._zoomMouseStart),c(e._globe)&&T===oe.SCENE2D?(I=x.getPickRay(t,lF).origin,I=h.fromElements(I.y,I.z,I.x)):c(e._globe)&&(I=a_(e,t,O0t)),c(I)?(e._useZoomWorldPosition=!0,e._zoomWorldPosition=h.clone(I,e._zoomWorldPosition)):e._useZoomWorldPosition=!1,v=e._zoomingOnVector=!1,D=e._rotatingZoom=!1,e._zoomingUnderground=e._cameraUnderground),!e._useZoomWorldPosition){x.zoomIn(m);return}let L=T===oe.COLUMBUS_VIEW;if(x.positionCartographic.height<2e6&&(D=!0),!S||D){if(T===oe.SCENE2D){let M=e._zoomWorldPosition,N=x.position;if(!h.equals(M,N)&&x.positionCartographic.height<e._maxCoord.x*2){let B=x.position.x,_=h.subtract(M,N,M0t);h.normalize(_,_);let w=h.distance(M,N)*m/(x.getMagnitude()*.5);x.move(_,w*.5),(x.position.x<0&&B>0||x.position.x>0&&B<0)&&(I=x.getPickRay(t,lF).origin,I=h.fromElements(I.y,I.z,I.x),e._zoomWorldPosition=h.clone(I,e._zoomWorldPosition))}}else if(T===oe.SCENE3D){let M=h.normalize(x.position,vxe);if(e._cameraUnderground||e._zoomingUnderground||x.positionCartographic.height<3e3&&Math.abs(h.dot(x.direction,M))<.6)L=!0;else{let N=b.canvas,B=L0t;B.x=N.clientWidth/2,B.y=N.clientHeight/2;let _=a_(e,B,N0t);if(!c(_))L=!0;else if(x.positionCartographic.height<1e6)if(h.dot(x.direction,M)>=-.5)L=!0;else{let w=U0t;h.clone(x.position,w);let P=e._zoomWorldPosition,O=V0t;if(O=h.normalize(P,O),h.dot(O,M)<0)return;let F=X0t,V=G0t;h.clone(x.direction,V),h.add(w,h.multiplyByScalar(V,1e3,cx),F);let G=j0t,z=W0t;h.subtract(P,w,G),h.normalize(G,z);let W=h.dot(M,z);if(W>=0){e._zoomMouseStart.x=-1;return}let U=Math.acos(-W),q=h.magnitude(w),K=h.magnitude(P),te=q-m,Y=h.magnitude(G),Z=Math.asin(R.clamp(Y/K*Math.sin(U),-1,1)),ee=Math.asin(R.clamp(te/K*Math.sin(U),-1,1)),me=Z-ee+U,be=z0t;h.normalize(w,be);let le=H0t;le=h.cross(z,be,le),le=h.normalize(le,le),h.normalize(h.cross(be,le,cx),V),h.multiplyByScalar(h.normalize(F,cx),h.magnitude(F)-m,F),h.normalize(w,w),h.multiplyByScalar(w,te,w);let ge=q0t;h.multiplyByScalar(h.add(h.multiplyByScalar(be,Math.cos(me)-1,_xe),h.multiplyByScalar(V,Math.sin(me),gxe),cx),te,ge),h.add(w,ge,w),h.normalize(F,be),h.normalize(h.cross(be,le,cx),V);let xe=Y0t;h.multiplyByScalar(h.add(h.multiplyByScalar(be,Math.cos(me)-1,_xe),h.multiplyByScalar(V,Math.sin(me),gxe),cx),h.magnitude(F),xe),h.add(F,xe,F),h.clone(w,x.position),h.normalize(h.subtract(F,w,cx),x.direction),h.clone(x.direction,x.direction),h.cross(x.direction,x.up,x.right),h.cross(x.right,x.direction,x.up),x.setView(NX);return}else{let w=h.normalize(_,F0t),P=h.normalize(e._zoomWorldPosition,B0t),O=h.dot(P,w);if(O>0&&O<1){let F=R.acosClamped(O),V=h.cross(P,w,k0t),G=Math.abs(F)>R.toRadians(20)?x.positionCartographic.height*.75:x.positionCartographic.height-m,z=m/G;x.rotate(V,F*z)}}}}e._rotatingZoom=!L}if(!S&&L||v){let M,N=Ni.worldToWindowCoordinates(b,e._zoomWorldPosition,R0t);T!==oe.COLUMBUS_VIEW&&H.equals(t,e._zoomMouseStart)&&c(N)?M=x.getPickRay(N,lF):M=x.getPickRay(t,lF);let B=M.direction;(T===oe.COLUMBUS_VIEW||T===oe.SCENE2D)&&h.fromElements(B.y,B.z,B.x,B),x.move(B,m),e._zoomingOnVector=!0}else x.zoomIn(m);e._cameraUnderground||x.setView(NX)}var K0t=new _n,$0t=new _n,Z0t=new h;function J0t(e,t,n){let o=e._scene.camera,r=o.getPickRay(n.startPosition,K0t).origin,s=o.getPickRay(n.endPosition,$0t).origin;r=h.fromElements(r.y,r.z,r.x,r),s=h.fromElements(s.y,s.z,s.x,s);let a=h.subtract(r,s,Z0t),l=h.magnitude(a);l>0&&(h.normalize(a,a),o.move(a,l))}function yxe(e,t,n){c(n.distance)&&(n=n.distance);let o=e._scene.camera;GX(e,t,n,e.zoomFactor,o.getMagnitude())}var Q0t=new H,ebt=new H;function bxe(e,t,n){if(c(n.angleAndHeight)){tbt(e,t,n.angleAndHeight);return}let i=e._scene,o=i.camera,r=i.canvas,s=r.clientWidth,a=r.clientHeight,l=Q0t;l.x=2/s*n.startPosition.x-1,l.y=2/a*(a-n.startPosition.y)-1,l=H.normalize(l,l);let u=ebt;u.x=2/s*n.endPosition.x-1,u.y=2/a*(a-n.endPosition.y)-1,u=H.normalize(u,u);let f=R.acosClamped(l.x);l.y<0&&(f=R.TWO_PI-f);let d=R.acosClamped(u.x);u.y<0&&(d=R.TWO_PI-d);let p=d-f;o.twistRight(p)}function tbt(e,t,n){let i=e._rotateFactor*e._rotateRateRangeAdjustment;i>e._maximumRotateRate&&(i=e._maximumRotateRate),i<e._minimumRotateRate&&(i=e._minimumRotateRate);let o=e._scene,r=o.camera,s=o.canvas,a=(n.endPosition.x-n.startPosition.x)/s.clientWidth;a=Math.min(a,e.maximumMovementRatio);let l=i*a*Math.PI*4;r.twistRight(l)}function nbt(e){let t=e._scene.mapMode2D===Ef.ROTATE;k.equals(k.IDENTITY,e._scene.camera.transform)?(kc(e,e.enableTranslate,e.translateEventTypes,J0t,e.inertiaTranslate,"_lastInertiaTranslateMovement"),kc(e,e.enableZoom,e.zoomEventTypes,yxe,e.inertiaZoom,"_lastInertiaZoomMovement"),t&&kc(e,e.enableRotate,e.tiltEventTypes,bxe,e.inertiaSpin,"_lastInertiaTiltMovement")):(kc(e,e.enableZoom,e.zoomEventTypes,yxe,e.inertiaZoom,"_lastInertiaZoomMovement"),t&&kc(e,e.enableRotate,e.translateEventTypes,bxe,e.inertiaSpin,"_lastInertiaSpinMovement"))}var Dxe=new _n,ibt=new h,obt=new h;function a_(e,t,n){let i=e._scene,o=e._globe,r=i.camera,s;if(i.pickPositionSupported&&(s=i.pickPositionWorldCoordinates(t,ibt)),!c(o))return h.clone(s,n);let a=!e._cameraUnderground,l=r.getPickRay(t,Dxe),u=o.pickWorldCoordinates(l,i,a,obt),f=c(s)?h.distance(s,r.positionWC):Number.POSITIVE_INFINITY,d=c(u)?h.distance(u,r.positionWC):Number.POSITIVE_INFINITY;return f<d?h.clone(s,n):h.clone(u,n)}var rbt=new he;function _F(e){let t=e._ellipsoid,n=e._scene,i=n.camera,o=n.mode,r=0;if(o===oe.SCENE3D){let l=t.cartesianToCartographic(i.position,rbt);c(l)&&(r=l.height)}else r=i.position.z;let s=y(e._scene.globeHeight,0);return Math.abs(s-r)}var sbt=new h;function Pxe(e,t){let n=t.origin,i=t.direction,o=_F(e),r=h.normalize(n,sbt),s=Math.abs(h.dot(r,i));return s=Math.max(s,.5)*2,o*s}function Ixe(e,t,n,i){let o=h.distance(t.origin,n),r=_F(e),s=R.clamp(r*5,e._minimumUndergroundPickDistance,e._maximumUndergroundPickDistance);return o>s&&(o=Math.min(o,r/5),o=Math.max(o,100)),_n.getPoint(t,o,i)}function Oxe(e,t,n,i){let o;return c(n)?(o=h.distance(t.origin,n),o>e._maximumUndergroundPickDistance&&(o=_F(e))):o=_F(e),_n.getPoint(t,o,i)}var abt=new H;function Rxe(e,t){let n=t.endPosition,i=H.subtract(t.endPosition,t.startPosition,abt),o=e._strafeEndMousePosition;H.add(o,i,o),t.endPosition=o,jX(e,t,e._strafeStartPosition),t.endPosition=n}var xxe=new _n,cbt=new _n,FX=new h,lbt=new h,ubt=new h,fbt=new h,dbt=new un(h.UNIT_X,0),hbt=new H,mbt=new H;function pbt(e,t,n){if(h.equals(t,e._translateMousePosition)||(e._looking=!1),h.equals(t,e._strafeMousePosition)||(e._strafing=!1),e._looking){Au(e,t,n);return}if(e._strafing){Rxe(e,n);return}let o=e._scene.camera,r=e._cameraUnderground,s=H.clone(n.startPosition,hbt),a=H.clone(n.endPosition,mbt),l=o.getPickRay(s,xxe),u=h.clone(h.ZERO,fbt),f=h.UNIT_X,d;if(o.position.z<e._minimumPickingTerrainHeight&&(d=a_(e,s,FX),c(d)&&(u.x=d.x)),r||u.x>o.position.z&&c(d)){let S=d;r&&(S=Oxe(e,l,d,FX)),H.clone(t,e._strafeMousePosition),H.clone(t,e._strafeEndMousePosition),h.clone(S,e._strafeStartPosition),e._strafing=!0,jX(e,n,e._strafeStartPosition);return}let p=un.fromPointNormal(u,f,dbt);l=o.getPickRay(s,xxe);let g=Qn.rayPlane(l,p,FX),m=o.getPickRay(a,cbt),b=Qn.rayPlane(m,p,lbt);if(!c(g)||!c(b)){e._looking=!0,Au(e,t,n),H.clone(t,e._translateMousePosition);return}let x=h.subtract(g,b,ubt),T=x.x;x.x=x.y,x.y=x.z,x.z=T;let C=h.magnitude(x);C>R.EPSILON6&&(h.normalize(x,x),o.move(x,C))}var Mxe=new H,dF=new _n,hF=new h,_bt=new h,Lxe=new k,gbt=new k,ybt=new h,bbt=new un(h.UNIT_X,0),BX=new h,UX=new he,Nxe=new k,xbt=new Ne,Tbt=new Q,mF=new h;function Abt(e,t,n){if(c(n.angleAndHeight)&&(n=n.angleAndHeight),H.equals(t,e._tiltCenterMousePosition)||(e._tiltCVOffMap=!1,e._looking=!1),e._looking){Au(e,t,n);return}let o=e._scene.camera;e._tiltCVOffMap||!e.onMap()||Math.abs(o.position.z)>e._minimumPickingTerrainHeight?(e._tiltCVOffMap=!0,Cbt(e,t,n)):Ebt(e,t,n)}function Cbt(e,t,n){let i=e._scene,o=i.camera,r=i.canvas,s=Mxe;s.x=r.clientWidth/2,s.y=r.clientHeight/2;let a=o.getPickRay(s,dF),l=h.UNIT_X,u=a.origin,f=a.direction,d,p=h.dot(l,f);if(Math.abs(p)>R.EPSILON6&&(d=-h.dot(l,u)/p),!c(d)||d<=0){e._looking=!0,Au(e,t,n),H.clone(t,e._tiltCenterMousePosition);return}let g=h.multiplyByScalar(f,d,hF);h.add(u,g,g);let m=i.mapProjection,b=m.ellipsoid;h.fromElements(g.y,g.z,g.x,g);let x=m.unproject(g,UX);b.cartographicToCartesian(x,g);let T=Ft.eastNorthUpToFixedFrame(g,b,Lxe),C=e._globe,S=e._ellipsoid;e._globe=void 0,e._ellipsoid=ie.UNIT_SPHERE,e._rotateFactor=1,e._rotateRateRangeAdjustment=1;let v=k.clone(o.transform,Nxe);o._setTransform(T),Tu(e,t,n,h.UNIT_Z),o._setTransform(v),e._globe=C,e._ellipsoid=S;let D=S.maximumRadius;e._rotateFactor=1/D,e._rotateRateRangeAdjustment=D}function Ebt(e,t,n){let i=e._scene,o=i.camera,r=e._cameraUnderground,s,a,l=h.UNIT_X;if(H.equals(t,e._tiltCenterMousePosition))s=h.clone(e._tiltCenter,hF);else{if(o.position.z<e._minimumPickingTerrainHeight&&(s=a_(e,t,hF)),!c(s)){a=o.getPickRay(t,dF);let _=a.origin,w=a.direction,P,O=h.dot(l,w);if(Math.abs(O)>R.EPSILON6&&(P=-h.dot(l,_)/O),!c(P)||P<=0){e._looking=!0,Au(e,t,n),H.clone(t,e._tiltCenterMousePosition);return}s=h.multiplyByScalar(w,P,hF),h.add(_,s,s)}r&&(c(a)||(a=o.getPickRay(t,dF)),Ixe(e,a,s,s)),H.clone(t,e._tiltCenterMousePosition),h.clone(s,e._tiltCenter)}let u=i.canvas,f=Mxe;f.x=u.clientWidth/2,f.y=e._tiltCenterMousePosition.y,a=o.getPickRay(f,dF);let d=h.clone(h.ZERO,ybt);d.x=s.x;let p=un.fromPointNormal(d,l,bbt),g=Qn.rayPlane(a,p,_bt),m=o._projection,b=m.ellipsoid;h.fromElements(s.y,s.z,s.x,s);let x=m.unproject(s,UX);b.cartographicToCartesian(x,s);let T=Ft.eastNorthUpToFixedFrame(s,b,Lxe),C;c(g)?(h.fromElements(g.y,g.z,g.x,g),x=m.unproject(g,UX),b.cartographicToCartesian(x,g),C=Ft.eastNorthUpToFixedFrame(g,b,gbt)):C=T;let S=e._globe,v=e._ellipsoid;e._globe=void 0,e._ellipsoid=ie.UNIT_SPHERE,e._rotateFactor=1,e._rotateRateRangeAdjustment=1;let D=h.UNIT_Z,I=k.clone(o.transform,Nxe);o._setTransform(T);let L=h.cross(h.UNIT_Z,h.normalize(o.position,BX),BX),M=h.dot(o.right,L);if(Tu(e,t,n,D,!1,!0),o._setTransform(C),M<0){let _=n.startPosition.y-n.endPosition.y;(r&&_<0||!r&&_>0)&&(D=void 0);let w=o.constrainedAxis;o.constrainedAxis=void 0,Tu(e,t,n,D,!0,!1),o.constrainedAxis=w}else Tu(e,t,n,D,!0,!1);if(c(o.constrainedAxis)){let _=h.cross(o.direction,o.constrainedAxis,mF);h.equalsEpsilon(_,h.ZERO,R.EPSILON6)||(h.dot(_,o.right)<0&&h.negate(_,_),h.cross(_,o.direction,o.up),h.cross(o.direction,o.up,o.right),h.normalize(o.up,o.up),h.normalize(o.right,o.right))}o._setTransform(I),e._globe=S,e._ellipsoid=v;let N=v.maximumRadius;e._rotateFactor=1/N,e._rotateRateRangeAdjustment=N;let B=h.clone(o.positionWC,BX);if(e.enableCollisionDetection&&YX(e,!0),!h.equals(o.positionWC,B)){o._setTransform(C),o.worldToCameraCoordinatesPoint(B,B);let _=h.magnitudeSquared(B);h.magnitudeSquared(o.position)>_&&(h.normalize(o.position,o.position),h.multiplyByScalar(o.position,Math.sqrt(_),o.position));let w=h.angleBetween(B,o.position),P=h.cross(B,o.position,B);h.normalize(P,P);let O=Ne.fromAxisAngle(P,w,xbt),F=Q.fromQuaternion(O,Tbt);Q.multiplyByVector(F,o.direction,o.direction),Q.multiplyByVector(F,o.up,o.up),h.cross(o.direction,o.up,o.right),h.cross(o.right,o.direction,o.up),o._setTransform(I)}}var Fxe=new H,Bxe=new _n,kxe=new h;function Sbt(e,t,n){c(n.distance)&&(n=n.distance);let i=e._scene,o=i.camera,r=i.canvas,s=e._cameraUnderground,a;s?a=t:(a=Fxe,a.x=r.clientWidth/2,a.y=r.clientHeight/2);let l=o.getPickRay(a,Bxe),u=l.origin,f=l.direction,d=o.position.z,p;d<e._minimumPickingTerrainHeight&&(p=a_(e,a,kxe));let g;if(c(p)&&(g=h.distance(u,p)),s){let m=Pxe(e,l,d);c(g)?g=Math.min(g,m):g=m}if(!c(g)){let m=h.UNIT_X;g=-h.dot(m,u)/h.dot(m,f)}GX(e,t,n,e.zoomFactor,g)}function wbt(e){let n=e._scene.camera;if(!k.equals(k.IDENTITY,n.transform))kc(e,e.enableRotate,e.rotateEventTypes,Tu,e.inertiaSpin,"_lastInertiaSpinMovement"),kc(e,e.enableZoom,e.zoomEventTypes,Uxe,e.inertiaZoom,"_lastInertiaZoomMovement");else{let i=e._tweens;if(e._aggregator.anyButtonDown&&i.removeAll(),kc(e,e.enableTilt,e.tiltEventTypes,Abt,e.inertiaSpin,"_lastInertiaTiltMovement"),kc(e,e.enableTranslate,e.translateEventTypes,pbt,e.inertiaTranslate,"_lastInertiaTranslateMovement"),kc(e,e.enableZoom,e.zoomEventTypes,Sbt,e.inertiaZoom,"_lastInertiaZoomMovement"),kc(e,e.enableLook,e.lookEventTypes,Au),!e._aggregator.anyButtonDown&&!i.contains(e._tween)){let o=n.createCorrectPositionTween(e.bounceAnimationTime);c(o)&&(e._tween=i.add(o))}i.update()}}var vbt=new _n,Dbt=new un(h.UNIT_X,0),Pbt=new h,Ibt=new h;function jX(e,t,n){let i=e._scene,o=i.camera,r=o.getPickRay(t.endPosition,vbt),s=h.clone(o.direction,Ibt);i.mode===oe.COLUMBUS_VIEW&&h.fromElements(s.z,s.x,s.y,s);let a=un.fromPointNormal(n,s,Dbt),l=Qn.rayPlane(r,a,Pbt);c(l)&&(s=h.subtract(n,l,s),i.mode===oe.COLUMBUS_VIEW&&h.fromElements(s.y,s.z,s.x,s),h.add(o.position,s,o.position))}var Txe=new h,Vxe=new he,zX=new h,HX=new ie,Obt=new h,Rbt=new h,Mbt=new h;function Lbt(e,t,n){let o=e._scene.camera,r=e._cameraUnderground,s=e._ellipsoid;if(!k.equals(o.transform,k.IDENTITY)){Tu(e,t,n);return}let a,l,u=s.geodeticSurfaceNormal(o.position,Obt);if(H.equals(t,e._rotateMousePosition)){if(e._looking)Au(e,t,n,u);else if(e._rotating)Tu(e,t,n);else if(e._strafing)Rxe(e,n);else{if(h.magnitude(o.position)<h.magnitude(e._rotateStartPosition))return;a=h.magnitude(e._rotateStartPosition),l=zX,l.x=l.y=l.z=a,s=ie.fromCartesian3(l,HX),VX(e,t,n,s)}return}e._looking=!1,e._rotating=!1,e._strafing=!1;let f=s.cartesianToCartographic(o.positionWC,Vxe).height,d=e._globe;if(c(d)&&f<e._minimumPickingTerrainHeight){let p=a_(e,n.startPosition,Mbt);if(c(p)){let g=!1,m=o.getPickRay(n.startPosition,Dxe);if(r)g=!0,Oxe(e,m,p,p);else{let b=s.geodeticSurfaceNormal(p,Rbt);Math.abs(h.dot(m.direction,b))<.05?g=!0:g=h.magnitude(o.position)<h.magnitude(p)}g?(H.clone(t,e._strafeEndMousePosition),h.clone(p,e._strafeStartPosition),e._strafing=!0,jX(e,n,e._strafeStartPosition)):(a=h.magnitude(p),l=zX,l.x=l.y=l.z=a,s=ie.fromCartesian3(l,HX),VX(e,t,n,s),h.clone(p,e._rotateStartPosition))}else e._looking=!0,Au(e,t,n,u)}else c(o.pickEllipsoid(n.startPosition,e._ellipsoid,Txe))?(VX(e,t,n,e._ellipsoid),h.clone(Txe,e._rotateStartPosition)):f>e._minimumTrackBallHeight?(e._rotating=!0,Tu(e,t,n)):(e._looking=!0,Au(e,t,n,u));H.clone(t,e._rotateMousePosition)}function Tu(e,t,n,i,o,r){o=y(o,!1),r=y(r,!1);let s=e._scene,a=s.camera,l=s.canvas,u=a.constrainedAxis;c(i)&&(a.constrainedAxis=i);let f=h.magnitude(a.position),d=e._rotateFactor*(f-e._rotateRateRangeAdjustment);d>e._maximumRotateRate&&(d=e._maximumRotateRate),d<e._minimumRotateRate&&(d=e._minimumRotateRate);let p=(n.startPosition.x-n.endPosition.x)/l.clientWidth,g=(n.startPosition.y-n.endPosition.y)/l.clientHeight;p=Math.min(p,e.maximumMovementRatio),g=Math.min(g,e.maximumMovementRatio);let m=d*p*Math.PI*2,b=d*g*Math.PI;if(c(i)&&c(e.maximumTiltAngle)){let x=e.maximumTiltAngle,T=h.dot(a.direction,i),C=Math.PI-Math.acos(T)+b;C>x&&(b-=C-x)}o||a.rotateRight(m),r||a.rotateUp(b),a.constrainedAxis=u}var kX=se.clone(se.UNIT_W),Axe=se.clone(se.UNIT_W),uF=new h,zC=new h,fF=new h,Cxe=new h,Nbt=new H,Fbt=new H,Bbt=new H,kbt=new H,Vbt=new _n;function VX(e,t,n,i){let o=e._scene,r=o.camera,s=H.clone(n.startPosition,Nbt),a=H.clone(n.endPosition,Fbt),l=i.cartesianToCartographic(r.positionWC,Vxe).height,u,f;if(!n.inertiaEnabled&&l<e._minimumPickingTerrainHeight&&(u=h.clone(e._panLastWorldPosition,kX),!c(e._globe)&&!H.equalsEpsilon(s,e._panLastMousePosition)&&(u=a_(e,s,kX)),!c(e._globe)&&c(u))){let d=h.subtract(u,r.positionWC,zC),p=h.multiplyByScalar(r.directionWC,h.dot(r.directionWC,d),zC),g=h.magnitude(p),m=r.frustum.getPixelDimensions(o.drawingBufferWidth,o.drawingBufferHeight,g,o.pixelRatio,kbt),b=H.subtract(a,s,Bbt),x=h.multiplyByScalar(r.rightWC,b.x*m.x,zC),T=h.normalize(r.positionWC,vxe),C=r.getPickRay(a,Vbt).direction,S=h.subtract(C,h.projectVector(C,r.rightWC,fF),fF),v=h.angleBetween(S,r.directionWC),D=1;c(r.frustum.fov)&&(D=Math.max(Math.tan(v),.1));let I=Math.abs(h.dot(r.directionWC,T)),L=-b.y*m.y*2/Math.sqrt(D)*(1-I),M=h.multiplyByScalar(C,L,fF);I=Math.abs(h.dot(r.upWC,T));let N=h.multiplyByScalar(r.upWC,-b.y*(1-I)*m.y,Cxe);f=h.add(u,x,Axe),f=h.add(f,M,f),f=h.add(f,N,f),h.clone(f,e._panLastWorldPosition),H.clone(a,e._panLastMousePosition)}if((!c(u)||!c(f))&&(u=r.pickEllipsoid(s,i,kX),f=r.pickEllipsoid(a,i,Axe)),!c(u)||!c(f)){e._rotating=!0,Tu(e,t,n);return}if(u=r.worldToCameraCoordinates(u,u),f=r.worldToCameraCoordinates(f,f),c(r.constrainedAxis)){let d=r.constrainedAxis,p=h.mostOrthogonalAxis(d,uF);h.cross(p,d,p),h.normalize(p,p);let g=h.cross(d,p,zC),m=h.magnitude(u),b=h.dot(d,u),x=Math.acos(b/m),T=h.multiplyByScalar(d,b,fF);h.subtract(u,T,T),h.normalize(T,T);let C=h.magnitude(f),S=h.dot(d,f),v=Math.acos(S/C),D=h.multiplyByScalar(d,S,Cxe);h.subtract(f,D,D),h.normalize(D,D);let I=Math.acos(h.dot(T,p));h.dot(T,g)<0&&(I=R.TWO_PI-I);let L=Math.acos(h.dot(D,p));h.dot(D,g)<0&&(L=R.TWO_PI-L);let M=I-L,N;h.equalsEpsilon(d,r.position,R.EPSILON2)?N=r.right:N=h.cross(d,r.position,uF);let B=h.cross(d,N,uF),_=h.dot(B,h.subtract(u,d,zC)),w=h.dot(B,h.subtract(f,d,zC)),P;_>0&&w>0?P=v-x:_>0&&w<=0?h.dot(r.position,d)>0?P=-x-v:P=x+v:P=x-v,r.rotateRight(M),r.rotateUp(P)}else{h.normalize(u,u),h.normalize(f,f);let d=h.dot(u,f),p=h.cross(u,f,uF);if(d<1&&!h.equalsEpsilon(p,h.ZERO,R.EPSILON14)){let g=Math.acos(d);r.rotate(p,g)}}}var Ubt=new h,zbt=new he,Exe=0;function Uxe(e,t,n){c(n.distance)&&(n=n.distance);let i=n.inertiaEnabled,o=e._ellipsoid,r=e._scene,s=r.camera,a=r.canvas,l=e._cameraUnderground,u;l?u=t:(u=Fxe,u.x=a.clientWidth/2,u.y=a.clientHeight/2);let f=s.getPickRay(u,Bxe),d,p=o.cartesianToCartographic(s.position,zbt).height,g=Math.abs(Exe)<e.minimumPickingTerrainDistanceWithInertia;(i?g:p<e._minimumPickingTerrainHeight)&&(d=a_(e,u,kxe));let b;if(c(d)&&(b=h.distance(f.origin,d),Exe=b),l){let T=Pxe(e,f,p);c(b)?b=Math.min(b,T):b=T}c(b)||(b=p);let x=h.normalize(s.position,Ubt);GX(e,t,n,e.zoomFactor,b,h.dot(x,s.direction))}var zxe=new H,pF=new _n,bP=new h,Hbt=new h,Hxe=new k,Gbt=new k,Gxe=new k,jbt=new Ne,Wbt=new Q,WX=new he,qX=new h;function qbt(e,t,n){let o=e._scene.camera;if(!k.equals(o.transform,k.IDENTITY))return;if(c(n.angleAndHeight)&&(n=n.angleAndHeight),H.equals(t,e._tiltCenterMousePosition)||(e._tiltOnEllipsoid=!1,e._looking=!1),e._looking){let a=e._ellipsoid.geodeticSurfaceNormal(o.position,qX);Au(e,t,n,a);return}let s=e._ellipsoid.cartesianToCartographic(o.position,WX);e._tiltOnEllipsoid||s.height>e._minimumCollisionTerrainHeight?(e._tiltOnEllipsoid=!0,Xbt(e,t,n)):Kbt(e,t,n)}var Ybt=new he;function Xbt(e,t,n){let i=e._ellipsoid,o=e._scene,r=o.camera,s=e.minimumZoomDistance*.25,a=i.cartesianToCartographic(r.positionWC,Ybt).height;if(a-s-1<R.EPSILON3&&n.endPosition.y-n.startPosition.y<0)return;let l=o.canvas,u=zxe;u.x=l.clientWidth/2,u.y=l.clientHeight/2;let f=r.getPickRay(u,pF),d,p=Qn.rayEllipsoid(f,i);if(c(p))d=_n.getPoint(f,p.start,bP);else if(a>e._minimumTrackBallHeight){let C=Qn.grazingAltitudeLocation(f,i);if(!c(C))return;let S=i.cartesianToCartographic(C,WX);S.height=0,d=i.cartographicToCartesian(S,bP)}else{e._looking=!0;let C=e._ellipsoid.geodeticSurfaceNormal(r.position,qX);Au(e,t,n,C),H.clone(t,e._tiltCenterMousePosition);return}let g=Ft.eastNorthUpToFixedFrame(d,i,Hxe),m=e._globe,b=e._ellipsoid;e._globe=void 0,e._ellipsoid=ie.UNIT_SPHERE,e._rotateFactor=1,e._rotateRateRangeAdjustment=1;let x=k.clone(r.transform,Gxe);r._setTransform(g),Tu(e,t,n,h.UNIT_Z),r._setTransform(x),e._globe=m,e._ellipsoid=b;let T=b.maximumRadius;e._rotateFactor=1/T,e._rotateRateRangeAdjustment=T}function Kbt(e,t,n){let i=e._ellipsoid,o=e._scene,r=o.camera,s=e._cameraUnderground,a,l,u;if(H.equals(t,e._tiltCenterMousePosition))a=h.clone(e._tiltCenter,bP);else{if(a=a_(e,t,bP),!c(a)){if(l=r.getPickRay(t,pF),u=Qn.rayEllipsoid(l,i),!c(u)){if(i.cartesianToCartographic(r.position,WX).height<=e._minimumTrackBallHeight){e._looking=!0;let w=e._ellipsoid.geodeticSurfaceNormal(r.position,qX);Au(e,t,n,w),H.clone(t,e._tiltCenterMousePosition)}return}a=_n.getPoint(l,u.start,bP)}s&&(c(l)||(l=r.getPickRay(t,pF)),Ixe(e,l,a,a)),H.clone(t,e._tiltCenterMousePosition),h.clone(a,e._tiltCenter)}let f=o.canvas,d=zxe;d.x=f.clientWidth/2,d.y=e._tiltCenterMousePosition.y,l=r.getPickRay(d,pF);let p=h.magnitude(a),g=h.fromElements(p,p,p,zX),m=ie.fromCartesian3(g,HX);if(u=Qn.rayEllipsoid(l,m),!c(u))return;let b=h.magnitude(l.origin)>p?u.start:u.stop,x=_n.getPoint(l,b,Hbt),T=Ft.eastNorthUpToFixedFrame(a,i,Hxe),C=Ft.eastNorthUpToFixedFrame(x,m,Gbt),S=e._globe,v=e._ellipsoid;e._globe=void 0,e._ellipsoid=ie.UNIT_SPHERE,e._rotateFactor=1,e._rotateRateRangeAdjustment=1;let D=h.UNIT_Z,I=k.clone(r.transform,Gxe);r._setTransform(C);let L=h.cross(x,r.positionWC,mF);if(h.dot(r.rightWC,L)<0){let _=n.startPosition.y-n.endPosition.y;(s&&_<0||!s&&_>0)&&(D=void 0);let w=r.constrainedAxis;r.constrainedAxis=void 0,Tu(e,t,n,D,!0,!1),r.constrainedAxis=w}else Tu(e,t,n,D,!0,!1);if(r._setTransform(T),Tu(e,t,n,D,!1,!0),c(r.constrainedAxis)){let _=h.cross(r.direction,r.constrainedAxis,mF);h.equalsEpsilon(_,h.ZERO,R.EPSILON6)||(h.dot(_,r.right)<0&&h.negate(_,_),h.cross(_,r.direction,r.up),h.cross(r.direction,r.up,r.right),h.normalize(r.up,r.up),h.normalize(r.right,r.right))}r._setTransform(I),e._globe=S,e._ellipsoid=v;let N=v.maximumRadius;e._rotateFactor=1/N,e._rotateRateRangeAdjustment=N;let B=h.clone(r.positionWC,mF);if(e.enableCollisionDetection&&YX(e,!0),!h.equals(r.positionWC,B)){r._setTransform(C),r.worldToCameraCoordinatesPoint(B,B);let _=h.magnitudeSquared(B);h.magnitudeSquared(r.position)>_&&(h.normalize(r.position,r.position),h.multiplyByScalar(r.position,Math.sqrt(_),r.position));let w=h.angleBetween(B,r.position),P=h.cross(B,r.position,B);h.normalize(P,P);let O=Ne.fromAxisAngle(P,w,jbt),F=Q.fromQuaternion(O,Wbt);Q.multiplyByVector(F,r.direction,r.direction),Q.multiplyByVector(F,r.up,r.up),h.cross(r.direction,r.up,r.right),h.cross(r.right,r.direction,r.up),r._setTransform(I)}}var $bt=new H,Zbt=new H,Sxe=new _n,wxe=new _n,Jbt=new h,Qbt=new h;function Au(e,t,n,i){let r=e._scene.camera,s=$bt;s.x=n.startPosition.x,s.y=0;let a=Zbt;a.x=n.endPosition.x,a.y=0;let l=r.getPickRay(s,Sxe),u=r.getPickRay(a,wxe),f=0,d,p;r.frustum instanceof rn?(d=l.origin,p=u.origin,h.add(r.direction,d,d),h.add(r.direction,p,p),h.subtract(d,r.position,d),h.subtract(p,r.position,p),h.normalize(d,d),h.normalize(p,p)):(d=l.direction,p=u.direction);let g=h.dot(d,p);g<1&&(f=Math.acos(g)),f=n.startPosition.x>n.endPosition.x?-f:f;let m=e._horizontalRotationAxis;if(c(i)?r.look(i,-f):c(m)?r.look(m,-f):r.lookLeft(f),s.x=0,s.y=n.startPosition.y,a.x=0,a.y=n.endPosition.y,l=r.getPickRay(s,Sxe),u=r.getPickRay(a,wxe),f=0,r.frustum instanceof rn?(d=l.origin,p=u.origin,h.add(r.direction,d,d),h.add(r.direction,p,p),h.subtract(d,r.position,d),h.subtract(p,r.position,p),h.normalize(d,d),h.normalize(p,p)):(d=l.direction,p=u.direction),g=h.dot(d,p),g<1&&(f=Math.acos(g)),f=n.startPosition.y>n.endPosition.y?-f:f,i=y(i,m),c(i)){let b=r.direction,x=h.negate(i,Jbt),T=h.equalsEpsilon(b,i,R.EPSILON2),C=h.equalsEpsilon(b,x,R.EPSILON2);if(!T&&!C){g=h.dot(b,i);let S=R.acosClamped(g);f>0&&f>S&&(f=S-R.EPSILON4),g=h.dot(b,x),S=R.acosClamped(g),f<0&&-f>S&&(f=-S+R.EPSILON4);let v=h.cross(i,b,Qbt);r.look(v,f)}else(T&&f<0||C&&f>0)&&r.look(r.right,-f)}else r.lookUp(f)}function ext(e){kc(e,e.enableRotate,e.rotateEventTypes,Lbt,e.inertiaSpin,"_lastInertiaSpinMovement"),kc(e,e.enableZoom,e.zoomEventTypes,Uxe,e.inertiaZoom,"_lastInertiaZoomMovement"),kc(e,e.enableTilt,e.tiltEventTypes,qbt,e.inertiaSpin,"_lastInertiaTiltMovement"),kc(e,e.enableLook,e.lookEventTypes,Au)}var txt=new k,nxt=new he;function YX(e,t){e._adjustedHeightForTerrain=!0;let n=e._scene,i=n.mode;if(i===oe.SCENE2D||i===oe.MORPHING)return;let o=n.camera,r=y(n.ellipsoid,ie.WGS84),s=n.mapProjection,a,l;k.equals(o.transform,k.IDENTITY)||(a=k.clone(o.transform,txt),l=h.magnitude(o.position),o._setTransform(k.IDENTITY));let u=nxt;i===oe.SCENE3D?r.cartesianToCartographic(o.position,u):s.unproject(o.position,u);let f=!1;if(u.height<e._minimumCollisionTerrainHeight){let d=e._scene.globeHeight;if(c(d)){let p=d+e.minimumZoomDistance,g=d-e._lastGlobeHeight,m=g/e._lastGlobeHeight;u.height<p&&(t||Math.abs(m)<=.1)&&(u.height=p,i===oe.SCENE3D?r.cartographicToCartesian(u,o.position):s.project(u,o.position),f=!0),t||Math.abs(m)<=.1?e._lastGlobeHeight=d:e._lastGlobeHeight+=g*.1}}c(a)&&(o._setTransform(a),f&&(h.normalize(o.position,o.position),h.negate(o.position,o.direction),h.multiplyByScalar(o.position,Math.max(l,e.minimumZoomDistance),o.position),h.normalize(o.direction,o.direction),h.cross(o.direction,o.up,o.right),h.cross(o.right,o.direction,o.up)))}xP.prototype.onMap=function(){let e=this._scene,t=e.mode,n=e.camera;return t===oe.COLUMBUS_VIEW?Math.abs(n.position.x)-this._maxCoord.x<0&&Math.abs(n.position.y)-this._maxCoord.y<0:!0};var ixt=new h,oxt=new h;xP.prototype.update=function(){let e=this._scene,{camera:t,globe:n,mode:i}=e;k.equals(t.transform,k.IDENTITY)?(this._globe=n,this._ellipsoid=y(e.ellipsoid,ie.default)):(this._globe=void 0,this._ellipsoid=ie.UNIT_SPHERE);let{verticalExaggeration:o,verticalExaggerationRelativeHeight:r}=e;this._minimumCollisionTerrainHeight=zr.getHeight(this.minimumCollisionTerrainHeight,o,r),this._minimumPickingTerrainHeight=zr.getHeight(this.minimumPickingTerrainHeight,o,r),this._minimumTrackBallHeight=zr.getHeight(this.minimumTrackBallHeight,o,r),this._cameraUnderground=e.cameraUnderground&&c(this._globe);let s=this._ellipsoid.maximumRadius;this._rotateFactor=1/s,this._rotateRateRangeAdjustment=s,this._adjustedHeightForTerrain=!1;let a=h.clone(t.positionWC,ixt),l=h.clone(t.directionWC,oxt);if(i===oe.SCENE2D?nbt(this):i===oe.COLUMBUS_VIEW?(this._horizontalRotationAxis=h.UNIT_Z,wbt(this)):i===oe.SCENE3D&&(this._horizontalRotationAxis=void 0,ext(this)),this.enableCollisionDetection&&!this._adjustedHeightForTerrain){let u=!h.equals(a,t.positionWC)||!h.equals(l,t.directionWC);YX(this,u)}this._aggregator.reset()};xP.prototype.isDestroyed=function(){return!1};xP.prototype.destroy=function(){return this._tweens.removeAll(),this._aggregator=this._aggregator&&this._aggregator.destroy(),de(this)};var XX=xP;var KX=`uniform sampler2D colorTexture;
uniform sampler2D colorTexture2;
uniform vec2 center;
uniform float radius;
in vec2 v_textureCoordinates;
void main()
{
vec4 color0 = texture(colorTexture, v_textureCoordinates);
vec4 color1 = texture(colorTexture2, v_textureCoordinates);
float x = length(gl_FragCoord.xy - center) / radius;
float t = smoothstep(0.5, 0.8, x);
out_FragColor = mix(color0 + color1, color1, t);
}
`;var $X=`uniform sampler2D colorTexture;
uniform float avgLuminance;
uniform float threshold;
uniform float offset;
in vec2 v_textureCoordinates;
float key(float avg)
{
float guess = 1.5 - (1.5 / (avg * 0.1 + 1.0));
return max(0.0, guess) + 0.1;
}
void main()
{
vec4 color = texture(colorTexture, v_textureCoordinates);
vec3 xyz = czm_RGBToXYZ(color.rgb);
float luminance = xyz.r;
float scaledLum = key(avgLuminance) * luminance / avgLuminance;
float brightLum = max(scaledLum - threshold, 0.0);
float brightness = brightLum / (offset + brightLum);
xyz.r = brightness;
out_FragColor = vec4(czm_XYZToRGB(xyz), 1.0);
}
`;function c_(){this._sceneFramebuffer=new cP;let e=.125,t=new Array(6);t[0]=new po({fragmentShader:Df,textureScale:e,forcePowerOfTwo:!0,sampleMode:Yd.LINEAR});let n=t[1]=new po({fragmentShader:$X,uniforms:{avgLuminance:.5,threshold:.25,offset:.1},textureScale:e,forcePowerOfTwo:!0}),i=this;this._delta=1,this._sigma=2,this._blurStep=new H,t[2]=new po({fragmentShader:VC,uniforms:{step:function(){return i._blurStep.x=i._blurStep.y=1/n.outputTexture.width,i._blurStep},delta:function(){return i._delta},sigma:function(){return i._sigma},direction:0},textureScale:e,forcePowerOfTwo:!0}),t[3]=new po({fragmentShader:VC,uniforms:{step:function(){return i._blurStep.x=i._blurStep.y=1/n.outputTexture.width,i._blurStep},delta:function(){return i._delta},sigma:function(){return i._sigma},direction:1},textureScale:e,forcePowerOfTwo:!0}),t[4]=new po({fragmentShader:Df,sampleMode:Yd.LINEAR}),this._uCenter=new H,this._uRadius=void 0,t[5]=new po({fragmentShader:KX,uniforms:{center:function(){return i._uCenter},radius:function(){return i._uRadius},colorTexture2:function(){return i._sceneFramebuffer.framebuffer.getColorTexture(0)}}}),this._stages=new bu({stages:t});let o=new _P(this),r=t.length;for(let s=0;s<r;++s)t[s]._textureCache=o;this._textureCache=o,this.length=t.length}c_.prototype.get=function(e){return this._stages.get(e)};c_.prototype.getStageByName=function(e){let t=this._stages.length;for(let n=0;n<t;++n){let i=this._stages.get(n);if(i.name===e)return i}};var rxt=new se,jxe=new H,sxt=new H,Wxe=new k;function axt(e,t,n){let i=t.uniformState,o=i.sunPositionWC,r=i.view,s=i.viewProjection,a=i.projection,l=k.computeViewportTransformation(n,0,1,Wxe),u=k.multiplyByPoint(r,o,rxt),f=Ft.pointToGLWindowCoordinates(s,l,o,jxe);u.x+=R.SOLAR_RADIUS;let d=Ft.pointToGLWindowCoordinates(a,l,u,u),p=H.magnitude(H.subtract(d,f,d))*30*2,g=sxt;g.x=p,g.y=p,e._uCenter=H.clone(f,e._uCenter),e._uRadius=Math.max(g.x,g.y)*.15;let m=t.drawingBufferWidth,b=t.drawingBufferHeight,x=e._stages,T=x.get(0),C=T.outputTexture.width,S=T.outputTexture.height,v=new Ke;v.width=C,v.height=S,l=k.computeViewportTransformation(v,0,1,Wxe),f=Ft.pointToGLWindowCoordinates(s,l,o,jxe),g.x*=C/m,g.y*=S/b;let D=T.scissorRectangle;D.x=Math.max(f.x-g.x*.5,0),D.y=Math.max(f.y-g.y*.5,0),D.width=Math.min(g.x,m),D.height=Math.min(g.y,b);for(let I=1;I<4;++I)Ke.clone(D,x.get(I).scissorRectangle)}c_.prototype.clear=function(e,t,n){this._sceneFramebuffer.clear(e,t,n),this._textureCache.clear(e)};c_.prototype.update=function(e){let t=e.context,n=e.viewport,i=this._sceneFramebuffer;i.update(t,n);let o=i.framebuffer;return this._textureCache.update(t),this._stages.update(t,!1),axt(this,t,n),o};c_.prototype.execute=function(e){let t=this._sceneFramebuffer.framebuffer.getColorTexture(0),n=this._stages,i=n.length;n.get(0).execute(e,t);for(let o=1;o<i;++o)n.get(o).execute(e,n.get(o-1).outputTexture)};c_.prototype.copy=function(e,t){if(!c(this._copyColorCommand)){let n=this;this._copyColorCommand=e.createViewportQuadCommand(Df,{uniformMap:{colorTexture:function(){return n._stages.get(n._stages.length-1).outputTexture}},owner:this})}this._copyColorCommand.framebuffer=t,this._copyColorCommand.execute(e)};c_.prototype.isDestroyed=function(){return!1};c_.prototype.destroy=function(){return this._textureCache.destroy(),this._stages.destroy(),de(this)};var ZX=c_;function lx(e,t,n){this._primitive=e,this._tileIndex=t,this._sampleIndex=n,this._metadata={},this._orientedBoundingBox=new Pn}lx.fromKeyframeNode=function(e,t,n,i){A.typeOf.object("primitive",e),A.typeOf.number("tileIndex",t),A.typeOf.number("sampleIndex",n),A.typeOf.object("keyframeNode",i);let o=new lx(e,t,n),{spatialNode:r,metadata:s}=i;return o._metadata=cxt(e,s,n),o._orientedBoundingBox=uxt(e,r,n,o._orientedBoundingBox),o};function cxt(e,t,n){if(!c(t))return;let{names:i,types:o}=e.provider,r={};for(let s=0;s<i.length;s++){let a=i[s],l=Et.getComponentCount(o[s]),u=t[s].slice(n*l,(n+1)*l);r[a]=u}return r}var qxe=new h,lxt=new h;function uxt(e,t,n,i){let o=t.dimensions,r=o.x*o.y,s=Math.floor(n/r),a=n-s*r,l=Math.floor(a/o.x),u=a-l*o.x,f=h.fromElements(u,l,s,qxe),d=h.divideComponents(h.subtract(f,e._paddingBefore,qxe),e.dimensions,lxt);return e._shape.computeOrientedBoundingBoxForSample(t,e.dimensions,d,i)}Object.defineProperties(lx.prototype,{metadata:{get:function(){return this._metadata}},primitive:{get:function(){return this._primitive}},sampleIndex:{get:function(){return this._sampleIndex}},tileIndex:{get:function(){return this._tileIndex}},orientedBoundingBox:{get:function(){return this._orientedBoundingBox.clone()}}});lx.prototype.hasProperty=function(e){return c(this._metadata[e])};lx.prototype.getNames=function(){return Object.keys(this._metadata)};lx.prototype.getProperty=function(e){return this._metadata[e]};var JX=lx;function Of(e,t,n,i,o,r,s){this.children=void 0,this.parent=o,this.level=e,this.x=t,this.y=n,this.z=i,this.dimensions=h.clone(s),this.keyframeNodes=[],this.renderableKeyframeNodes=[],this.renderableKeyframeNodeLerp=0,this.renderableKeyframeNodePrevious=void 0,this.renderableKeyframeNodeNext=void 0,this.orientedBoundingBox=new Pn,this.approximateVoxelSize=0,this.screenSpaceError=0,this.visitedFrameNumber=-1,this.computeBoundingVolumes(r)}var fxt=new h;Of.prototype.computeBoundingVolumes=function(e){this.orientedBoundingBox=e.computeOrientedBoundingBoxForTile(this.level,this.x,this.y,this.z,this.orientedBoundingBox);let t=Q.getScale(this.orientedBoundingBox.halfAxes,fxt),n=2*h.maximumComponent(t);this.approximateVoxelSize=n/h.minimumComponent(this.dimensions)};Of.prototype.constructChildNodes=function(e){let{level:t,x:n,y:i,z:o}=this,r=n*2,s=i*2,a=o*2,l=s+1,u=r+1,f=a+1,d=t+1,p=[[d,r,s,a],[d,u,s,a],[d,r,l,a],[d,u,l,a],[d,r,s,f],[d,u,s,f],[d,r,l,f],[d,u,l,f]];this.children=p.map(([g,m,b,x])=>new Of(g,m,b,x,this,e,this.dimensions))};Of.prototype.visibility=function(e,t){let n=this.orientedBoundingBox;return e.cullingVolume.computeVisibilityWithPlaneMask(n,t)};Of.prototype.computeScreenSpaceError=function(e,t){let n=this.orientedBoundingBox,i=Math.sqrt(n.distanceSquaredTo(e));i=Math.max(i,R.EPSILON7);let o=this.approximateVoxelSize,r=t*(o/i);this.screenSpaceError=r};var Yxe={keyframe:0};function TP(e,t){return Yxe.keyframe=e,vo(t,Yxe,no.searchComparator)}Of.prototype.computeSurroundingRenderableKeyframeNodes=function(e){let t=this,n=t.level,i=Math.floor(e),o=Math.ceil(e),r,s,a=+Number.MAX_VALUE,l=+Number.MAX_VALUE;for(;c(t);){let{renderableKeyframeNodes:d}=t;if(d.length>=1){let p=dxt(i,d),g=d[p],m=o===i||i<g.keyframe?p:Math.min(p+1,d.length-1),b=d[m],x=i-g.keyframe,T=Xxe(n-t.level,x);T<a&&(a=T,r=g);let C=b.keyframe-o,S=Xxe(n-t.level,C);if(S<l&&(l=S,s=b),x===0&&C===0)break}t=t.parent}if(this.renderableKeyframeNodePrevious=r,this.renderableKeyframeNodeNext=s,!c(r)||!c(s))return;let u=r.keyframe,f=s.keyframe;this.renderableKeyframeNodeLerp=u===f?0:R.clamp((e-u)/(f-u),0,1)};function dxt(e,t){let n=TP(e,t);return n<0?R.clamp(~n-1,0,t.length-1):n}function Xxe(e,t){let n=Math.exp(e*4),i=t>=0?1:-200;return e*n+t*i}Of.prototype.isVisited=function(e){return this.visitedFrameNumber===e};Of.prototype.createKeyframeNode=function(e){let t=TP(e,this.keyframeNodes);if(t<0){t=~t;let n=new no(this,e);this.keyframeNodes.splice(t,0,n)}};Of.prototype.destroyKeyframeNode=function(e,t){let n=e.keyframe,i=TP(n,this.keyframeNodes);if(i<0)throw new E("Keyframe node does not exist.");if(this.keyframeNodes.splice(i,1),e.megatextureIndex!==-1){for(let r=0;r<t.length;r++)t[r].remove(e.megatextureIndex);let o=TP(n,this.renderableKeyframeNodes);if(o<0)throw new E("Renderable keyframe node does not exist.");this.renderableKeyframeNodes.splice(o,1)}e.spatialNode=void 0,e.state=no.LoadState.UNLOADED,e.metadata={},e.megatextureIndex=-1,e.priority=-Number.MAX_VALUE,e.highPriorityFrameNumber=-1};Of.prototype.addKeyframeNodeToMegatextures=function(e,t){if(e.state!==no.LoadState.RECEIVED||e.megatextureIndex!==-1||e.metadata.length!==t.length)throw new E("Keyframe node cannot be added to megatexture");for(let o=0;o<t.length;o++){let r=t[o];e.megatextureIndex=r.add(e.metadata[o])}e.state=no.LoadState.LOADED;let n=this.renderableKeyframeNodes,i=TP(e.keyframe,n);if(i>=0)throw new E("Keyframe already renderable");i=~i,n.splice(i,0,e)};Of.prototype.isRenderable=function(e){let t=this.renderableKeyframeNodePrevious,n=this.renderableKeyframeNodeNext,i=this.level;return c(t)&&c(n)&&(t.spatialNode.level===i||n.spatialNode.level===i)&&this.visitedFrameNumber===e};var QX=Of;function l_(e,t,n,i,o,r,s){this._primitive=e,this.megatextures=new Array(i.length);for(let m=0;m<i.length;m++){let b=i[m],x=Et.getComponentCount(b),T=o[m];this.megatextures[m]=new zN(t,n,x,T,s)}let a=this.megatextures[0].maximumTileCount;this._simultaneousRequestCount=0,this._debugPrint=!1,this._frameNumber=0;let l=e._shape;this.rootNode=new QX(0,0,0,0,void 0,l,n),this._priorityQueue=new gD({maximumLength:a,comparator:no.priorityComparator}),this._highPriorityKeyframeNodes=new Array(a),this._keyframeNodesInMegatexture=new Array(a),this._keyframeCount=r,this._sampleCount=void 0,this._keyframeLocation=0,this._binaryTreeKeyframeWeighting=new Array(r);let u=this._binaryTreeKeyframeWeighting;u[0]=0,u[r-1]=0,eK(u,1,r-2,0);let f=9,d=2048,p=Math.floor(d/f),g=Math.ceil(a/p);this.internalNodeTexture=new Lt({context:t,pixelFormat:Ve.RGBA,pixelDatatype:Be.UNSIGNED_BYTE,flipY:!1,width:d,height:g,sampler:new Qt({minificationFilter:$t.NEAREST,magnificationFilter:fi.NEAREST})}),this.internalNodeTilesPerRow=p,this.internalNodeTexelSizeUv=new H(1/d,1/g),this.leafNodeTexture=void 0,this.leafNodeTilesPerRow=void 0,this.leafNodeTexelSizeUv=new H}l_.prototype.findKeyframeNode=function(e){return this._keyframeNodesInMegatexture.find(function(t){return t.megatextureIndex===e})};function eK(e,t,n,i){if(t>n)return;let o=Math.floor((t+n)/2);e[o]=i,eK(e,t,o-1,i+1),eK(e,o+1,n,i+1)}l_.simultaneousRequestCountMaximum=50;l_.prototype.update=function(e,t,n,i){let o=this._primitive,r=e.context,s=this.megatextures[0].maximumTileCount,a=this._keyframeCount,l=o._levelBlendFactor,u=l>0,f=a>1,d=(u?2:1)*(f?2:1);this._sampleCount=d;let p=d>=2;if(p&&!c(this.leafNodeTexture)){let C=Math.floor(512),S=Math.ceil(s/C);this.leafNodeTexture=new Lt({context:r,pixelFormat:Ve.RGBA,pixelDatatype:Be.UNSIGNED_BYTE,flipY:!1,width:1024,height:S,sampler:new Qt({minificationFilter:$t.NEAREST,magnificationFilter:fi.NEAREST})}),this.leafNodeTexelSizeUv=H.fromElements(1/1024,1/S,this.leafNodeTexelSizeUv),this.leafNodeTilesPerRow=C}else!p&&c(this.leafNodeTexture)&&(this.leafNodeTexture=this.leafNodeTexture.destroy());if(this._keyframeLocation=R.clamp(t,0,a-1),n&&Kxe(this,this.rootNode),i)return;this._frameNumber=e.frameNumber;let g=Ei();pxt(this,e);let m=Ei();yxt(this,d,l);let b=Ei();if(this._debugPrint){let x=m-g,T=b-m,C=b-g;gxt(this,x,T,C)}};l_.prototype.isRenderable=function(e){return e.isRenderable(this._frameNumber)};l_.prototype.isDestroyed=function(){return!1};l_.prototype.destroy=function(){let e=this.megatextures,t=e.length;for(let n=0;n<t;n++)e[n]=e[n]&&e[n].destroy();return this.internalNodeTexture=this.internalNodeTexture&&this.internalNodeTexture.destroy(),this.leafNodeTexture=this.leafNodeTexture&&this.leafNodeTexture.destroy(),de(this)};function Kxe(e,t){if(t.computeBoundingVolumes(e._primitive._shape),c(t.children))for(let n=0;n<8;n++){let i=t.children[n];Kxe(e,i)}}function hxt(e,t){if(e._simultaneousRequestCount>=l_.simultaneousRequestCountMaximum)return;let n=e._primitive._provider;function i(l){e._simultaneousRequestCount--;let u=n.types.length;if(!c(l))t.state=no.LoadState.UNAVAILABLE;else if(l===no.LoadState.FAILED)t.state=no.LoadState.FAILED;else if(!Array.isArray(l)||l.length!==u)t.state=no.LoadState.FAILED;else{let f=e.megatextures;for(let d=0;d<u;d++){let{voxelCountPerTile:p,channelCount:g}=f[d],{x:m,y:b,z:x}=p,T=m*b*x,C=l[d],S=T*g;if(C.length===S)t.metadata[d]=C,t.state=no.LoadState.RECEIVED;else{t.state=no.LoadState.FAILED;break}}}}function o(){e._simultaneousRequestCount--,t.state=no.LoadState.FAILED}let{keyframe:r,spatialNode:s}=t,a=n.requestData({tileLevel:s.level,tileX:s.x,tileY:s.y,tileZ:s.z,keyframe:r});c(a)?(e._simultaneousRequestCount++,t.state=no.LoadState.RECEIVING,a.then(i).catch(o)):t.state=no.LoadState.FAILED}function mxt(e){return e/(1+e)}function pxt(e,t){let n=e._frameNumber,i=e._primitive,o=i._shape,r=i.screenSpaceError,s=e._priorityQueue,a=e._keyframeCount,l=R.clamp(Math.floor(e._keyframeLocation),0,a-2),u=l+1,{camera:f,context:d,pixelRatio:p}=t,{positionWC:g,frustum:m}=f,x=d.drawingBufferHeight/p/m.sseDenominator;function T(B,_){if(B.computeScreenSpaceError(g,x),_=B.visibility(t,_),_===Os.MASK_OUTSIDE)return;if(B.visitedFrameNumber=n,a===1)B.createKeyframeNode(0);else if(B.keyframeNodes.length!==a)for(let V=0;V<a;V++)B.createKeyframeNode(V);let{screenSpaceError:w,keyframeNodes:P}=B,O=mxt(w),F=!1;for(let V=0;V<P.length;V++){let G=P[V];G.priority=10*O+_xt(l,G.keyframe,u,e),G.state!==no.LoadState.UNAVAILABLE&&G.state!==no.LoadState.FAILED&&G.priority!==-Number.MAX_VALUE&&s.insert(G),G.state===no.LoadState.LOADED&&(F=!0)}if(w<r||!F){B.children=void 0;return}c(B.children)||B.constructChildNodes(o);for(let V=0;V<8;V++){let G=B.children[V];T(G,_)}}s.reset(),T(e.rootNode,Os.MASK_INDETERMINATE);let C=e._highPriorityKeyframeNodes,S=0,v;for(;s.length>0;)v=s.removeMaximum(),v.highPriorityFrameNumber=n,C[S]=v,S++;let D=e._keyframeNodesInMegatexture,I=e.megatextures[0],L=I.occupiedCount;D.length=L,D.sort(function(B,_){return B.highPriorityFrameNumber===_.highPriorityFrameNumber?_.priority-B.priority:_.highPriorityFrameNumber-B.highPriorityFrameNumber});let M=0,N=0;for(let B=0;B<S;B++)if(v=C[B],!(v.state===no.LoadState.LOADED||v.spatialNode===void 0)&&(v.state===no.LoadState.UNLOADED&&hxt(e,v),v.state===no.LoadState.RECEIVED)){let _=0;if(I.isFull()){_=L-1-M,M++;let w=D[_];w.spatialNode.destroyKeyframeNode(w,e.megatextures)}else _=L+N,N++;v.spatialNode.addKeyframeNodeToMegatextures(v,e.megatextures),D[_]=v}}function _xt(e,t,n,i){let o=Math.min(Math.abs(t-e),Math.abs(t-n)),r=Math.max(e,i._keyframeCount-n-1,1),s=Math.pow(1-o/r,4),a=Math.exp(-i._binaryTreeKeyframeWeighting[t]);return R.lerp(a,s,.15+.85*s)}function gxt(e,t,n,i){let o=e._keyframeCount,r=e.rootNode,s=Object.keys(no.LoadState).length,a=new Array(s),l=new Array(s),u=0;for(let T=0;T<s;T++){let C=new Array(o);a[T]=C;for(let S=0;S<o;S++)C[S]=0;l[T]=0}function f(T){let C=T.keyframeNodes;for(let S=0;S<C.length;S++){let v=C[S],D=v.keyframe,I=v.state;a[I][D]+=1,l[I]+=1,u++}if(c(T.children))for(let S=0;S<8;S++){let v=T.children[S];f(v)}}f(r);let d=`KEYFRAMES: ${a[no.LoadState.LOADED]}`,p=`UNLOADED: ${l[no.LoadState.UNLOADED]} | RECEIVING: ${l[no.LoadState.RECEIVING]} | RECEIVED: ${l[no.LoadState.RECEIVED]} | LOADED: ${l[no.LoadState.LOADED]} | FAILED: ${l[no.LoadState.FAILED]} | UNAVAILABLE: ${l[no.LoadState.UNAVAILABLE]} | TOTAL: ${u}`,g=Math.round(t*100)/100,m=Math.round(n*100)/100,b=Math.round(i*100)/100,x=`LOAD: ${g} | OCT: ${m} | ALL: ${b}`;console.log(`${d} || ${p} || ${x}`)}var gF={INTERNAL:0,LEAF:1,PACKED_LEAF_FROM_PARENT:2};function yxt(e,t,n){let i=e._primitive._screenSpaceError,o=e._keyframeLocation,r=e._frameNumber,s=t>=2,a=0,l=0,u=[],f=[];function d(g,m,b,x,T){let C=!1;if(c(g.children))for(let S=0;S<8;S++){let v=g.children[S];v.computeSurroundingRenderableKeyframeNodes(o),v.isRenderable(r)&&(C=!0)}if(C){u[T]=gF.INTERNAL<<16|m,u[b]=x,a++,x=m,T=x*9+1;for(let S=0;S<8;S++){let v=g.children[S];m=a,b=m*9+0,d(v,m,b,x,T+S)}}else{if(s){let S=l*5,v=g.renderableKeyframeNodePrevious,D=g.level-v.spatialNode.level,I=v.spatialNode.parent,L=c(I)?I.renderableKeyframeNodePrevious:v,M=bxt(g,i,n),N=D,B=1,_=v.megatextureIndex,w=L.megatextureIndex;f[S+0]=M,f[S+1]=N,f[S+2]=B,f[S+3]=_,f[S+4]=w,u[T]=gF.LEAF<<16|l}else{let S=g.renderableKeyframeNodePrevious,D=g.level-S.spatialNode.level===0?gF.LEAF:gF.PACKED_LEAF_FROM_PARENT;u[T]=D<<16|S.megatextureIndex}l++}}let p=e.rootNode;p.computeSurroundingRenderableKeyframeNodes(o),p.isRenderable(r)&&d(p,0,0,0,0),xxt(u,9,e.internalNodeTilesPerRow,e.internalNodeTexture),s&&Txt(f,2,e.leafNodeTilesPerRow,e.leafNodeTexture)}function bxt(e,t,n){if(e.parent===void 0)return 0;let i=e.screenSpaceError,o=e.parent.screenSpaceError,s=((t-i)/(o-i)+n-1)/n;return R.clamp(s,0,1)}function xxt(e,t,n,i){let o=Ve.componentsLength(i.pixelFormat),r=Math.ceil(e.length/t),s=Math.max(1,t*Math.min(r,n)),a=Math.max(1,Math.ceil(r/n)),l=new Uint8Array(s*a*o);for(let d=0;d<e.length;d++){let p=e[d],g=d*o;for(let m=0;m<o;m++)l[g+m]=p>>>m*8&255}let f={source:{arrayBufferView:l,width:s,height:a},xOffset:0,yOffset:0};i.copyFrom(f)}function Txt(e,t,n,i){let o=Ve.componentsLength(i.pixelFormat),r=5,s=Math.ceil(e.length/r),a=Math.max(1,t*Math.min(s,n)),l=Math.max(1,Math.ceil(s/n)),u=new Uint8Array(a*l*o);for(let p=0;p<s;p++){let g=e[p*r+0],m=e[p*r+1],b=e[p*r+2],x=e[p*r+3],T=e[p*r+4],C=R.clamp(Math.floor(65536*g),0,65535);u[p*8+0]=C>>>0&255,u[p*8+1]=C>>>8&255,u[p*8+2]=m&255,u[p*8+3]=b&255,u[p*8+4]=x>>>0&255,u[p*8+5]=x>>>8&255,u[p*8+6]=T>>>0&255,u[p*8+7]=T>>>8&255}let d={source:{arrayBufferView:u,width:a,height:l},xOffset:0,yOffset:0};i.copyFrom(d)}l_.getApproximateTextureMemoryByteLength=function(e,t,n,i){let o=0,r=n.length;for(let s=0;s<r;s++){let a=n[s],l=i[s],u=Et.getComponentCount(a);o+=zN.getApproximateTextureMemoryByteLength(e,t,u,l)}return o};var yF=l_;var Axt={FLOAT:"float",VEC2:"vec2",VEC3:"vec3",VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",MAT2:"mat2",MAT3:"mat3",MAT4:"mat4",SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"usampler2D",SAMPLER_CUBE:"samplerCube"},AP=Object.freeze(Axt);function HC(){this._defaultTexture=void 0,this._textures={},this._loadedImages=[],this._lastUpdatedFrame=-1}HC.prototype.getTexture=function(e){return this._textures[e]};function Cxt(e,t,n){n.resource.fetchImage().then(function(i){e._loadedImages.push({id:t,image:i,textureUniform:n})}).catch(function(){let i=e._textures[t];c(i)&&i!==e._defaultTexture&&i.destroy(),e._textures[t]=e._defaultTexture})}HC.prototype.loadTexture2D=function(e,t){c(t.typedArray)?this._loadedImages.push({id:e,textureUniform:t}):Cxt(this,e,t)};function Ext(e,t,n){let{id:i,textureUniform:o,image:r}=t,s=n.webgl2?bF(o,r,n):Sxt(o,r,n),a=e._textures[i];c(a)&&a!==n.defaultTexture&&a.destroy(),e._textures[i]=s}function bF(e,t,n){let{typedArray:i,sampler:o}=e,r=c(i)?Zxe(e,n):new Lt({context:n,source:t,sampler:o});return $xe(o)&&r.generateMipmap(),r}function Sxt(e,t,n){let{typedArray:i,sampler:o}=e,r=$xe(o),s=o.wrapS===yn.REPEAT||o.wrapS===yn.MIRRORED_REPEAT||o.wrapT===yn.REPEAT||o.wrapT===yn.MIRRORED_REPEAT,{width:a,height:l}=c(i)?e:t,u=[a,l].every(R.isPowerOfTwo);if((r||s)&&!u)if(c(i)){if(e.pixelDatatype===Be.UNSIGNED_BYTE){let d=mW(i,a,l),p=aT(d);return bF({sampler:o},p,n)}}else{let d=aT(t);return bF(e,d,n)}else return bF(e,t,n);return r?console.warn("Texture requires resizing for mipmaps but pixelDataType cannot be resized. The texture may be rendered incorrectly."):s&&console.warn("Texture requires resizing for wrapping but pixelDataType cannot be resized. The texture may be rendered incorrectly."),Zxe(e,n)}function $xe(e){return[$t.NEAREST_MIPMAP_NEAREST,$t.NEAREST_MIPMAP_LINEAR,$t.LINEAR_MIPMAP_NEAREST,$t.LINEAR_MIPMAP_LINEAR].includes(e.minificationFilter)}function Zxe(e,t){let{pixelFormat:n,pixelDatatype:i,width:o,height:r,typedArray:s,sampler:a}=e;return new Lt({context:t,pixelFormat:n,pixelDatatype:i,source:{arrayBufferView:s,width:o,height:r},sampler:a,flipY:!1})}HC.prototype.update=function(e){if(e.frameNumber===this._lastUpdatedFrame)return;this._lastUpdatedFrame=e.frameNumber;let t=e.context;this._defaultTexture=t.defaultTexture;let n=this._loadedImages;for(let i=0;i<n.length;i++){let o=n[i];Ext(this,o,t)}n.length=0};HC.prototype.isDestroyed=function(){return!1};HC.prototype.destroy=function(){let e=this._textures;for(let t in e)if(e.hasOwnProperty(t)){let n=e[t];n!==this._defaultTexture&&n.destroy()}return de(this)};var tK=HC;function CP(e){e=y(e,y.EMPTY_OBJECT),this.mode=y(e.mode,O0.MODIFY_MATERIAL),this.lightingModel=e.lightingModel,this.uniforms=y(e.uniforms,y.EMPTY_OBJECT),this.varyings=y(e.varyings,y.EMPTY_OBJECT),this.vertexShaderText=e.vertexShaderText,this.fragmentShaderText=e.fragmentShaderText,this.translucencyMode=y(e.translucencyMode,MT.INHERIT),this._textureManager=new tK,this._defaultTexture=void 0,this.uniformMap=wxt(this),this.usedVariablesVertex={attributeSet:{},featureIdSet:{},metadataSet:{}},this.usedVariablesFragment={attributeSet:{},featureIdSet:{},metadataSet:{},materialSet:{}},Pxt(this),Ixt(this)}function wxt(e){let t=e.uniforms,n={};for(let i in t)if(t.hasOwnProperty(i)){let o=t[i],r=o.type;if(r===AP.SAMPLER_CUBE)throw new E("CustomShader does not support samplerCube uniforms");r===AP.SAMPLER_2D?(e._textureManager.loadTexture2D(i,o.value),n[i]=vxt(e,i)):n[i]=Dxt(e,i)}return n}function vxt(e,t){return function(){return y(e._textureManager.getTexture(t),e._defaultTexture)}}function Dxt(e,t){return function(){return e.uniforms[t].value}}function ux(e,t,n){let i;for(;(i=t.exec(e))!==null;){let o=i[1];n[o]=!0}}function Pxt(e){let t=/[vf]sInput\.attributes\.(\w+)/g,n=/[vf]sInput\.featureIds\.(\w+)/g,i=/[vf]sInput\.metadata.(\w+)/g,o,r=e.vertexShaderText;c(r)&&(o=e.usedVariablesVertex.attributeSet,ux(r,t,o),o=e.usedVariablesVertex.featureIdSet,ux(r,n,o),o=e.usedVariablesVertex.metadataSet,ux(r,i,o));let s=e.fragmentShaderText;if(c(s)){o=e.usedVariablesFragment.attributeSet,ux(s,t,o),o=e.usedVariablesFragment.featureIdSet,ux(s,n,o),o=e.usedVariablesFragment.metadataSet,ux(s,i,o);let a=/material\.(\w+)/g,l=e.usedVariablesFragment.materialSet;ux(s,a,l)}}function Jxe(e){let t=/^.*MC$/,n=/^.*WC$/,i=/^.*EC$/;return t.test(e)?`${e} (model coordinates)`:n.test(e)?`${e} (Cartesian world coordinates)`:i.test(e)?`${e} (eye coordinates)`:e}function sc(e,t,n,i){if(e.hasOwnProperty(t)){let o=`${Jxe(t)} is not available in the ${i} shader. Did you mean ${Jxe(n)} instead?`;throw new E(o)}}function Ixt(e){let t=e.usedVariablesVertex.attributeSet;sc(t,"position","positionMC","vertex"),sc(t,"normal","normalMC","vertex"),sc(t,"tangent","tangentMC","vertex"),sc(t,"bitangent","bitangentMC","vertex"),sc(t,"positionWC","positionMC","vertex"),sc(t,"positionEC","positionMC","vertex"),sc(t,"normalEC","normalMC","vertex"),sc(t,"tangentEC","tangentMC","vertex"),sc(t,"bitangentEC","bitangentMC","vertex");let n=e.usedVariablesFragment.attributeSet;sc(n,"position","positionEC","fragment"),sc(n,"normal","normalEC","fragment"),sc(n,"tangent","tangentEC","fragment"),sc(n,"bitangent","bitangentEC","fragment"),sc(n,"normalMC","normalEC","fragment"),sc(n,"tangentMC","tangentEC","fragment"),sc(n,"bitangentMC","bitangentEC","fragment")}CP.prototype.setUniform=function(e,t){if(A.typeOf.string("uniformName",e),A.defined("value",t),!c(this.uniforms[e]))throw new E(`Uniform ${e} must be declared in the CustomShader constructor.`);let n=this.uniforms[e];n.type===AP.SAMPLER_2D?this._textureManager.loadTexture2D(e,t):c(t.clone)?n.value=t.clone(n.value):n.value=t};CP.prototype.update=function(e){this._defaultTexture=e.context.defaultTexture,this._textureManager.update(e)};CP.prototype.isDestroyed=function(){return!1};CP.prototype.destroy=function(){this._textureManager=this._textureManager&&this._textureManager.destroy(),de(this)};var GC=CP;function mm(e){e=y(e,y.EMPTY_OBJECT),this._ready=!1,this._provider=y(e.provider,mm.DefaultProvider),this._traversal=void 0,this._shape=void 0,this._shapeVisible=!1,this._paddingBefore=new h,this._paddingAfter=new h,this._minBounds=new h,this._minBoundsOld=new h,this._maxBounds=new h,this._maxBoundsOld=new h,this._exaggeratedMinBounds=new h,this._exaggeratedMinBoundsOld=new h,this._exaggeratedMaxBounds=new h,this._exaggeratedMaxBoundsOld=new h,this._minClippingBounds=new h,this._minClippingBoundsOld=new h,this._maxClippingBounds=new h,this._maxClippingBoundsOld=new h,this._clippingPlanes=void 0,this._clippingPlanesState=0,this._clippingPlanesEnabled=!1,this._modelMatrix=k.clone(y(e.modelMatrix,k.IDENTITY)),this._exaggeratedModelMatrix=k.clone(this._modelMatrix),this._compoundModelMatrix=new k,this._compoundModelMatrixOld=new k,this._customShader=y(e.customShader,mm.DefaultCustomShader),this._customShaderCompilationEvent=new pe,this._shaderDirty=!0,this._drawCommand=void 0,this._drawCommandPick=void 0,this._pickId=void 0,this._clock=e.clock,this._transformPositionWorldToUv=new k,this._transformPositionUvToWorld=new k,this._transformDirectionWorldToLocal=new Q,this._transformNormalLocalToWorld=new Q,this._nearestSampling=!1,this._levelBlendFactor=0,this._stepSizeMultiplier=1,this._depthTest=!0,this._useLogDepth=void 0,this._screenSpaceError=4,this._debugPolylines=new yp,this._debugDraw=!1,this._disableRender=!1,this._disableUpdate=!1,this._uniforms={octreeInternalNodeTexture:void 0,octreeInternalNodeTilesPerRow:0,octreeInternalNodeTexelSizeUv:new H,octreeLeafNodeTexture:void 0,octreeLeafNodeTilesPerRow:0,octreeLeafNodeTexelSizeUv:new H,megatextureTextures:[],megatextureSliceDimensions:new H,megatextureTileDimensions:new H,megatextureVoxelSizeUv:new H,megatextureSliceSizeUv:new H,megatextureTileSizeUv:new H,dimensions:new h,paddingBefore:new h,paddingAfter:new h,transformPositionViewToUv:new k,transformPositionUvToView:new k,transformDirectionViewToLocal:new Q,transformNormalLocalToWorld:new Q,cameraPositionUv:new h,ndcSpaceAxisAlignedBoundingBox:new se,clippingPlanesTexture:void 0,clippingPlanesMatrix:new k,stepSize:0,pickColor:new j},this._shapeDefinesOld={},this._uniformMap={};let t=this._uniforms,n=this._uniformMap;for(let o in t)if(t.hasOwnProperty(o)){let r=`u_${o}`;n[r]=function(){return t[o]}}let i=this._provider;Oxt(this,i)}function Oxt(e,t){let{shape:n,minBounds:i=Oi.getMinBounds(n),maxBounds:o=Oi.getMaxBounds(n)}=t;e.minBounds=i,e.maxBounds=o,e.minClippingBounds=Oi.getMinBounds(n),e.maxClippingBounds=Oi.getMaxBounds(n),e._exaggeratedMinBounds=h.clone(e._minBounds,e._exaggeratedMinBounds),e._exaggeratedMaxBounds=h.clone(e._maxBounds,e._exaggeratedMaxBounds),e._exaggeratedModelMatrix=k.clone(e._modelMatrix,e._exaggeratedModelMatrix),eTe(e,t);let r=Oi.getShapeConstructor(n);e._shape=new r,e._shapeVisible=tTe(e,e._shape,t)}Object.defineProperties(mm.prototype,{ready:{get:function(){return this._ready}},provider:{get:function(){return this._provider}},boundingSphere:{get:function(){return this._shape.boundingSphere}},orientedBoundingBox:{get:function(){return this._shape.orientedBoundingBox}},modelMatrix:{get:function(){return this._modelMatrix},set:function(e){A.typeOf.object("modelMatrix",e),this._modelMatrix=k.clone(e,this._modelMatrix)}},shape:{get:function(){return this._provider.shape}},dimensions:{get:function(){return this._provider.dimensions}},minimumValues:{get:function(){return this._provider.minimumValues}},maximumValues:{get:function(){return this._provider.maximumValues}},show:{get:function(){return!this._disableRender},set:function(e){A.typeOf.bool("show",e),this._disableRender=!e}},disableUpdate:{get:function(){return this._disableUpdate},set:function(e){A.typeOf.bool("disableUpdate",e),this._disableUpdate=e}},debugDraw:{get:function(){return this._debugDraw},set:function(e){A.typeOf.bool("debugDraw",e),this._debugDraw=e}},depthTest:{get:function(){return this._depthTest},set:function(e){A.typeOf.bool("depthTest",e),this._depthTest!==e&&(this._depthTest=e,this._shaderDirty=!0)}},nearestSampling:{get:function(){return this._nearestSampling},set:function(e){A.typeOf.bool("nearestSampling",e),this._nearestSampling!==e&&(this._nearestSampling=e,this._shaderDirty=!0)}},levelBlendFactor:{get:function(){return this._levelBlendFactor},set:function(e){A.typeOf.number("levelBlendFactor",e),this._levelBlendFactor=R.clamp(e,0,1)}},screenSpaceError:{get:function(){return this._screenSpaceError},set:function(e){A.typeOf.number("screenSpaceError",e),this._screenSpaceError=e}},stepSize:{get:function(){return this._stepSizeMultiplier},set:function(e){A.typeOf.number("stepSize",e),this._stepSizeMultiplier=e}},minBounds:{get:function(){return this._minBounds},set:function(e){A.defined("minBounds",e),this._minBounds=h.clone(e,this._minBounds)}},maxBounds:{get:function(){return this._maxBounds},set:function(e){A.defined("maxBounds",e),this._maxBounds=h.clone(e,this._maxBounds)}},minClippingBounds:{get:function(){return this._minClippingBounds},set:function(e){A.defined("minClippingBounds",e),this._minClippingBounds=h.clone(e,this._minClippingBounds)}},maxClippingBounds:{get:function(){return this._maxClippingBounds},set:function(e){A.defined("maxClippingBounds",e),this._maxClippingBounds=h.clone(e,this._maxClippingBounds)}},clippingPlanes:{get:function(){return this._clippingPlanes},set:function(e){Ms.setOwner(e,this,"_clippingPlanes")}},customShader:{get:function(){return this._customShader},set:function(e){if(this._customShader!==e){let t=this._uniformMap,i=this._customShader.uniformMap;for(let o in i)i.hasOwnProperty(o)&&delete t[o];c(e)?this._customShader=e:this._customShader=mm.DefaultCustomShader,this._shaderDirty=!0}}},customShaderCompilationEvent:{get:function(){return this._customShaderCompilationEvent}}});var Rxt=new h,Mxt=new se,Lxt=new se,Nxt=new h,Fxt=new h,Bxt=new Q,kxt=new Q,Vxt=new k,Uxt=new k,zxt=new k,Hxt=k.fromRotationTranslation(Q.fromUniformScale(.5,new Q),new h(.5,.5,.5),new k),Gxt=k.fromRotationTranslation(Q.fromUniformScale(2,new Q),new h(-1,-1,-1),new k);mm.prototype.update=function(e){let t=this._provider;this._customShader.update(e);let n=e.context;if(!this._ready){Kxt(this,t,n),e.afterRender.push(()=>(this._ready=!0,!0));return}Yxt(this,e);let i=eTe(this,t),o=this._shape;if(i&&(this._shapeVisible=tTe(this,o,t),Jxt(this,o)&&(this._shaderDirty=!0)),!this._shapeVisible)return;let r=Qxt(t.timeIntervalCollection,this._clock),s=this._traversal,a=s._sampleCount;if(s.update(e,r,i,this._disableUpdate),a!==s._sampleCount&&(this._shaderDirty=!0),!s.isRenderable(s.rootNode)||(this._debugDraw&&aTt(this,e),this._disableRender))return;this._useLogDepth!==e.useLogDepth&&(this._useLogDepth=e.useLogDepth,this._shaderDirty=!0),eTt(this,e)&&(this._shaderDirty=!0);let u=s.leafNodeTexture,f=this._uniforms;c(u)&&(f.octreeLeafNodeTexture=s.leafNodeTexture,f.octreeLeafNodeTexelSizeUv=H.clone(s.leafNodeTexelSizeUv,f.octreeLeafNodeTexelSizeUv),f.octreeLeafNodeTilesPerRow=s.leafNodeTilesPerRow),this._shaderDirty&&(Oq(this,n),this._shaderDirty=!1);let d=n.uniformState.viewProjection,p=o.orientedBoundingBox,g=iTt(p,d,Lxt);if(g.x===1||g.y===1||g.z===-1||g.w===-1)return;f.ndcSpaceAxisAlignedBoundingBox=se.clone(g,f.ndcSpaceAxisAlignedBoundingBox);let b=n.uniformState.inverseView;f.transformPositionViewToUv=k.multiplyTransformation(this._transformPositionWorldToUv,b,f.transformPositionViewToUv);let x=n.uniformState.view;f.transformPositionUvToView=k.multiplyTransformation(x,this._transformPositionUvToWorld,f.transformPositionUvToView);let T=n.uniformState.inverseViewRotation;f.transformDirectionViewToLocal=Q.multiply(this._transformDirectionWorldToLocal,T,f.transformDirectionViewToLocal),f.transformNormalLocalToWorld=Q.clone(this._transformNormalLocalToWorld,f.transformNormalLocalToWorld);let C=e.camera.positionWC;f.cameraPositionUv=k.multiplyByPoint(this._transformPositionWorldToUv,C,f.cameraPositionUv),f.stepSize=this._stepSizeMultiplier;let S=e.passes.pick?this._drawCommandPick:e.passes.pickVoxel?this._drawCommandPickVoxel:this._drawCommand;S.boundingVolume=o.boundingSphere,e.commandList.push(S)};var jxt=new h,nK=new h,Wxt=new he,qxt=new h;function Yxt(e,t){if(e._exaggeratedMinBounds=h.clone(e._minBounds,e._exaggeratedMinBounds),e._exaggeratedMaxBounds=h.clone(e._maxBounds,e._exaggeratedMaxBounds),e.shape===Oi.ELLIPSOID){let n=t.verticalExaggerationRelativeHeight,i=t.verticalExaggeration;e._exaggeratedMinBounds.z=(e._minBounds.z-n)*i+n,e._exaggeratedMaxBounds.z=(e._maxBounds.z-n)*i+n}else if(e.shape===Oi.BOX){let n=h.fromElements(1,1,t.verticalExaggeration,jxt);e._exaggeratedModelMatrix=k.multiplyByScale(e._modelMatrix,n,e._exaggeratedModelMatrix),e._exaggeratedModelMatrix=k.multiplyByTranslation(e._exaggeratedModelMatrix,Xxt(e,t),e._exaggeratedModelMatrix)}}function Xxt(e,t){let{shapeTransform:n=k.IDENTITY,globalTransform:i=k.IDENTITY}=e._provider,o=k.getTranslation(n,nK),r=k.multiplyByPoint(e._modelMatrix,o,nK),s=k.multiplyByPoint(i,r,nK),l=ie.WGS84.cartesianToCartographic(s,Wxt),u=0;c(l)&&(u=l.height);let f=zr.getHeight(u,t.verticalExaggeration,t.verticalExaggerationRelativeHeight);return h.fromElements(0,0,(f-u)/t.verticalExaggeration,qxt)}function Kxt(e,t,n){let i=e._uniforms;e._pickId=n.createPickId({primitive:e}),i.pickColor=j.clone(e._pickId.color,i.pickColor);let{shaderDefines:o,shaderUniforms:r}=e._shape;e._shapeDefinesOld=qe(o,!0);let s=e._uniformMap;for(let a in r)if(r.hasOwnProperty(a)){let l=`u_${a}`;c(s[l])&&_t(`VoxelPrimitive: Uniform name "${l}" is already defined`),s[l]=function(){return r[a]}}i.dimensions=h.clone(t.dimensions,i.dimensions),e._paddingBefore=h.clone(y(t.paddingBefore,h.ZERO),e._paddingBefore),i.paddingBefore=h.clone(e._paddingBefore,i.paddingBefore),e._paddingAfter=h.clone(y(t.paddingAfter,h.ZERO),e._paddingBefore),i.paddingAfter=h.clone(e._paddingAfter,i.paddingAfter),e._traversal=$xt(e,t,n),Zxt(e._traversal,i)}function eTe(e,t){let n=y(t.shapeTransform,k.IDENTITY),i=y(t.globalTransform,k.IDENTITY);return k.multiplyTransformation(i,e._exaggeratedModelMatrix,e._compoundModelMatrix),k.multiplyTransformation(e._compoundModelMatrix,n,e._compoundModelMatrix),fx(e,"_compoundModelMatrix","_compoundModelMatrixOld")+fx(e,"_minBounds","_minBoundsOld")+fx(e,"_maxBounds","_maxBoundsOld")+fx(e,"_exaggeratedMinBounds","_exaggeratedMinBoundsOld")+fx(e,"_exaggeratedMaxBounds","_exaggeratedMaxBoundsOld")+fx(e,"_minClippingBounds","_minClippingBoundsOld")+fx(e,"_maxClippingBounds","_maxClippingBoundsOld")>0}function fx(e,t,n){let i=e[t],o=e[n],r=!i.equals(o);return r&&i.clone(o),r?1:0}function tTe(e,t,n){if(!t.update(e._compoundModelMatrix,e._exaggeratedMinBounds,e._exaggeratedMaxBounds,e.minClippingBounds,e.maxClippingBounds))return!1;let o=t.shapeTransform,r=k.inverse(o,Vxt),s=k.getRotation(o,Bxt),a=k.getScale(o,Nxt),l=h.maximumComponent(a),u=h.divideByScalar(a,l,Fxt),f=Q.multiplyByScale(s,u,kxt);return e._transformPositionWorldToUv=k.multiplyTransformation(Hxt,r,e._transformPositionWorldToUv),e._transformPositionUvToWorld=k.multiplyTransformation(o,Gxt,e._transformPositionUvToWorld),e._transformDirectionWorldToLocal=k.getMatrix3(r,e._transformDirectionWorldToLocal),e._transformNormalLocalToWorld=Q.inverseTranspose(f,e._transformNormalLocalToWorld),!0}function $xt(e,t,n){let i=h.clone(t.dimensions,Rxt);h.add(i,e._paddingBefore,i),h.add(i,e._paddingAfter,i);let o=t.maximumTileCount,r=c(o)?yF.getApproximateTextureMemoryByteLength(o,i,t.types,t.componentTypes):void 0,s=y(t.keyframeCount,1);return new yF(e,n,i,t.types,t.componentTypes,s,r)}function Zxt(e,t){t.octreeInternalNodeTexture=e.internalNodeTexture,t.octreeInternalNodeTexelSizeUv=H.clone(e.internalNodeTexelSizeUv,t.octreeInternalNodeTexelSizeUv),t.octreeInternalNodeTilesPerRow=e.internalNodeTilesPerRow;let n=e.megatextures,i=n[0],o=n.length;t.megatextureTextures=new Array(o);for(let r=0;r<o;r++)t.megatextureTextures[r]=n[r].texture;t.megatextureSliceDimensions=H.clone(i.sliceCountPerRegion,t.megatextureSliceDimensions),t.megatextureTileDimensions=H.clone(i.regionCountPerMegatexture,t.megatextureTileDimensions),t.megatextureVoxelSizeUv=H.clone(i.voxelSizeUv,t.megatextureVoxelSizeUv),t.megatextureSliceSizeUv=H.clone(i.sliceSizeUv,t.megatextureSliceSizeUv),t.megatextureTileSizeUv=H.clone(i.regionSizeUv,t.megatextureTileSizeUv)}function Jxt(e,t){let n=t.shaderDefines,i=Object.keys(n).some(o=>n[o]!==e._shapeDefinesOld[o]);return i&&(e._shapeDefinesOld=qe(n,!0)),i}function Qxt(e,t){if(!c(e)||!c(t))return 0;let n=t.currentTime,i,o=e.indexOf(n);o>=0?i=e.get(o):(o=~o,o===e.length?(o=e.length-1,i=e.get(o),n=i.stop):(i=e.get(o),n=i.start));let r=J.secondsDifference(i.stop,i.start),a=J.secondsDifference(n,i.start)/r;return o+a}function eTt(e,t){let n=e.clippingPlanes;if(!c(n))return!1;n.update(t);let{clippingPlanesState:i,enabled:o}=n;if(o){let r=e._uniforms;r.clippingPlanesTexture=n.texture,r.clippingPlanesMatrix=k.transpose(k.multiplyTransformation(k.inverse(n.modelMatrix,r.clippingPlanesMatrix),e._transformPositionUvToWorld,r.clippingPlanesMatrix),r.clippingPlanesMatrix)}return e._clippingPlanesState===i&&e._clippingPlanesEnabled===o?!1:(e._clippingPlanesState=i,e._clippingPlanesEnabled=o,!0)}mm.prototype.isDestroyed=function(){return!1};mm.prototype.destroy=function(){let e=this._drawCommand;c(e)&&(e.shaderProgram=e.shaderProgram&&e.shaderProgram.destroy());let t=this._drawCommandPick;return c(t)&&(t.shaderProgram=t.shaderProgram&&t.shaderProgram.destroy()),this._pickId=this._pickId&&this._pickId.destroy(),this._traversal=this._traversal&&this._traversal.destroy(),this._clippingPlanes=this._clippingPlanes&&this._clippingPlanes.destroy(),de(this)};var Qxe=new Array(new se(-1,-1,-1,1),new se(1,-1,-1,1),new se(-1,1,-1,1),new se(1,1,-1,1),new se(-1,-1,1,1),new se(1,-1,1,1),new se(-1,1,1,1),new se(1,1,1,1)),tTt=new Array(1,2,4,0,3,5,0,3,6,1,2,7,0,5,6,1,4,7,2,4,7,3,5,6),nTt=new Array(new se,new se,new se,new se,new se,new se,new se,new se);function iTt(e,t,n){let i=k.fromRotationTranslation(e.halfAxes,e.center,Uxt),o=k.multiply(t,i,zxt),r=+Number.MAX_VALUE,s=-Number.MAX_VALUE,a=+Number.MAX_VALUE,l=-Number.MAX_VALUE,u,f=nTt,d=Qxe.length;for(u=0;u<d;u++)k.multiplyByVector(o,Qxe[u],f[u]);for(u=0;u<d;u++){let p=f[u];if(p.z>=-p.w){let g=p.x/p.w,m=p.y/p.w;r=Math.min(r,g),s=Math.max(s,g),a=Math.min(a,m),l=Math.max(l,m)}else for(let g=0;g<3;g++){let m=tTt[u*3+g],b=f[m];if(b.z>=-b.w){let x=p.z+p.w,T=b.z+b.w,C=x/(x-T),S=se.lerp(p,b,C,Mxt),v=S.x/S.w,D=S.y/S.w;r=Math.min(r,v),s=Math.max(s,v),a=Math.min(a,D),l=Math.max(l,D)}}}return r=R.clamp(r,-1,1),a=R.clamp(a,-1,1),s=R.clamp(s,-1,1),l=R.clamp(l,-1,1),n=se.fromElements(r,a,s,l,n),n}var iK=3e7,oTt=new h(iK,0,0),rTt=new h(0,iK,0),sTt=new h(0,0,iK);function aTt(e,t){let n=e._traversal,i=e._debugPolylines;i.removeAll();function o(l,u,f,d){i.add({positions:[l,u],width:d,material:Ki.fromType("Color",{color:f})})}function r(l,u,f){let d=l.computeCorners();o(d[0],d[1],u,f),o(d[2],d[3],u,f),o(d[4],d[5],u,f),o(d[6],d[7],u,f),o(d[0],d[2],u,f),o(d[4],d[6],u,f),o(d[1],d[3],u,f),o(d[5],d[7],u,f),o(d[0],d[4],u,f),o(d[2],d[6],u,f),o(d[1],d[5],u,f),o(d[3],d[7],u,f)}function s(l){if(!n.isRenderable(l))return;let u=l.level,d=Math.max(1,5/Math.pow(2,u)),g=[j.RED,j.LIME,j.BLUE][u%3];if(r(l.orientedBoundingBox,g,d),c(l.children))for(let m=0;m<8;m++)s(l.children[m])}r(e._shape.orientedBoundingBox,j.WHITE,5),s(n.rootNode);let a=10;o(h.ZERO,oTt,j.RED,a),o(h.ZERO,rTt,j.LIME,a),o(h.ZERO,sTt,j.BLUE,a),i.update(t)}mm.DefaultCustomShader=new GC({fragmentShaderText:`void fragmentMain(FragmentInput fsInput, inout czm_modelMaterial material)
{
    material.diffuse = vec3(1.0);
    material.alpha = 1.0;
}`});function nTe(){this.ready=!0,this.shape=Oi.BOX,this.dimensions=new h(1,1,1),this.names=["data"],this.types=[Et.SCALAR],this.componentTypes=[Gt.FLOAT32],this.maximumTileCount=1}nTe.prototype.requestData=function(e){if(!((c(e)?y(e.tileLevel,0):0)>=1))return Promise.resolve([new Float32Array(1)])};mm.DefaultProvider=new nTe;var jC=mm;var TF=function(e){return function(){e.frameState.afterRender.push(function(){e.requestRender()})}};function Zn(e){e=y(e,y.EMPTY_OBJECT);let t=e.canvas,n=e.creditContainer,i=e.creditViewport,o=qe(e.contextOptions);if(!c(t))throw new E("options and options.canvas are required.");let r=c(n),s=new oq(t,o);r||(n=document.createElement("div"),n.style.position="absolute",n.style.bottom="0",n.style["text-shadow"]="0 0 2px #000000",n.style.color="#ffffff",n.style["font-size"]="10px",n.style["padding-right"]="5px",t.parentNode.appendChild(n)),c(i)||(i=t.parentNode),this._id=Hn(),this._jobScheduler=new PY,this._frameState=new F7(s,new C7(n,"\u2022",i),this._jobScheduler),this._frameState.scene3DOnly=y(e.scene3DOnly,!1),this._removeCreditContainer=!r,this._creditContainer=n,this._canvas=t,this._context=s,this._computeEngine=new XW(s),this._ellipsoid=y(e.ellipsoid,ie.default),this._globe=void 0,this._globeTranslucencyState=new yY,this._primitives=new mf,this._groundPrimitives=new mf,this._globeHeight=void 0,this._globeHeightDirty=!0,this._cameraUnderground=!1,this._removeUpdateHeightCallback=void 0,this._logDepthBuffer=Zn.defaultLogDepthBuffer&&s.fragmentDepth,this._logDepthBufferDirty=!0,this._tweens=new yP,this._shaderFrameCount=0,this._sunPostProcess=void 0,this._computeCommandList=[],this._overlayCommandList=[],this._useOIT=y(e.orderIndependentTranslucency,!0),this._executeOITFunction=void 0,this._depthPlane=new D7(e.depthPlaneEllipsoidOffset),this._clearColorCommand=new ri({color:new j,stencil:0,owner:this}),this._depthClearCommand=new ri({depth:1,owner:this}),this._stencilClearCommand=new ri({stencil:0}),this._classificationStencilClearCommand=new ri({stencil:0,renderState:ze.fromCache({stencilMask:Ut.CLASSIFICATION_MASK})}),this._depthOnlyRenderStateCache={},this._transitioner=new LX(this),this._preUpdate=new pe,this._postUpdate=new pe,this._renderError=new pe,this._preRender=new pe,this._postRender=new pe,this._minimumDisableDepthTestDistance=0,this._debugInspector=new E7,this._msaaSamples=y(e.msaaSamples,4),this.rethrowRenderErrors=!1,this.completeMorphOnUserInput=!0,this.morphStart=new pe,this.morphComplete=new pe,this.skyBox=void 0,this.skyAtmosphere=void 0,this.sun=void 0,this.sunBloom=!0,this._sunBloom=void 0,this.moon=void 0,this.backgroundColor=j.clone(j.BLACK),this._mode=oe.SCENE3D,this._mapProjection=c(e.mapProjection)?e.mapProjection:new Mi(this._ellipsoid),this.morphTime=1,this.farToNearRatio=1e3,this.logarithmicDepthFarToNearRatio=1e9,this.nearToFarDistance2D=175e4,this.verticalExaggeration=1,this.verticalExaggerationRelativeHeight=0,this.debugCommandFilter=void 0,this.debugShowCommands=!1,this.debugShowFrustums=!1,this.debugShowFramesPerSecond=!1,this.debugShowDepthFrustum=1,this.debugShowFrustumPlanes=!1,this._debugShowFrustumPlanes=!1,this._debugFrustumPlanes=void 0,this.useDepthPicking=!0,this.pickTranslucentDepth=!1,this.cameraEventWaitTime=500,this.atmosphere=new ew,this.fog=new N7,this.fog.enabled=ie.WGS84.equals(this._ellipsoid),ie.WGS84.equals(this._ellipsoid)||(so.DEFAULT_VIEW_RECTANGLE=ae.fromDegrees(-45,-45,45,45)),this._shadowMapCamera=new so(this),this.shadowMap=new tx({context:s,lightCamera:this._shadowMapCamera,enabled:y(e.shadows,!1)}),this.invertClassification=!1,this.invertClassificationColor=j.clone(j.WHITE),this._actualInvertClassificationColor=j.clone(this._invertClassificationColor),this._invertClassification=new kN,this.focalLength=void 0,this.eyeSeparation=void 0,this.postProcessStages=new PX,this._brdfLutGenerator=new mq,this._performanceDisplay=void 0,this._debugVolume=void 0,this._screenSpaceCameraController=new XX(this),this._cameraUnderground=!1,this._mapMode2D=y(e.mapMode2D,Ef.INFINITE_SCROLL),this._environmentState={skyBoxCommand:void 0,skyAtmosphereCommand:void 0,sunDrawCommand:void 0,sunComputeCommand:void 0,moonCommand:void 0,isSunVisible:!1,isMoonVisible:!1,isReadyForAtmosphere:!1,isSkyAtmosphereVisible:!1,clearGlobeDepth:!1,useDepthPlane:!1,renderTranslucentDepthForPick:!1,originalFramebuffer:void 0,useGlobeDepthFramebuffer:!1,useOIT:!1,useInvertClassification:!1,usePostProcess:!1,usePostProcessSelected:!1,useWebVR:!1},this._useWebVR=!1,this._cameraVR=void 0,this._aspectRatioVR=void 0,this.requestRenderMode=y(e.requestRenderMode,!1),this._renderRequested=!0,this.maximumRenderTimeChange=y(e.maximumRenderTimeChange,0),this._lastRenderTime=void 0,this._frameRateMonitor=void 0,this._removeRequestListenerCallback=qc.requestCompletedEvent.addEventListener(TF(this)),this._removeTaskProcessorListenerCallback=Ti.taskCompletedEvent.addEventListener(TF(this)),this._removeGlobeCallbacks=[],this._removeTerrainProviderReadyListener=void 0;let a=new Ke(0,0,s.drawingBufferWidth,s.drawingBufferHeight),l=new so(this);this._logDepthBuffer&&(l.frustum.near=.1,l.frustum.far=1e10),this.preloadFlightCamera=new so(this),this.preloadFlightCullingVolume=void 0,this._picking=new QY(this),this._defaultView=new uP(this,l,a),this._view=this._defaultView,this._hdr=void 0,this._hdrDirty=void 0,this.highDynamicRange=!1,this.gamma=2.2,this.sphericalHarmonicCoefficients=void 0,this.specularEnvironmentMaps=void 0,this._specularEnvironmentCubeMap=void 0,this.light=new Ub,aTe(this,0,J.now()),this.updateFrameState(),this.initializeFrame()}Zn.defaultLogDepthBuffer=!0;function cTt(e,t){for(let i=0;i<e._removeGlobeCallbacks.length;++i)e._removeGlobeCallbacks[i]();e._removeGlobeCallbacks.length=0;let n=[];c(t)&&(n.push(t.imageryLayersUpdatedEvent.addEventListener(TF(e))),n.push(t.terrainProviderChanged.addEventListener(TF(e)))),e._removeGlobeCallbacks=n}Object.defineProperties(Zn.prototype,{canvas:{get:function(){return this._canvas}},drawingBufferHeight:{get:function(){return this._context.drawingBufferHeight}},drawingBufferWidth:{get:function(){return this._context.drawingBufferWidth}},maximumAliasedLineWidth:{get:function(){return mt.maximumAliasedLineWidth}},maximumCubeMapSize:{get:function(){return mt.maximumCubeMapSize}},pickPositionSupported:{get:function(){return this._context.depthTexture}},sampleHeightSupported:{get:function(){return this._context.depthTexture}},clampToHeightSupported:{get:function(){return this._context.depthTexture}},invertClassificationSupported:{get:function(){return this._context.depthTexture}},specularEnvironmentMapsSupported:{get:function(){return Gm.isSupported(this._context)}},ellipsoid:{get:function(){return this._ellipsoid}},globe:{get:function(){return this._globe},set:function(e){this._globe=this._globe&&this._globe.destroy(),this._globe=e,cTt(this,e)}},primitives:{get:function(){return this._primitives}},groundPrimitives:{get:function(){return this._groundPrimitives}},camera:{get:function(){return this._view.camera},set:function(e){this._view.camera=e}},view:{get:function(){return this._view},set:function(e){this._view=e}},defaultView:{get:function(){return this._defaultView}},picking:{get:function(){return this._picking}},screenSpaceCameraController:{get:function(){return this._screenSpaceCameraController}},mapProjection:{get:function(){return this._mapProjection}},jobScheduler:{get:function(){return this._jobScheduler}},frameState:{get:function(){return this._frameState}},environmentState:{get:function(){return this._environmentState}},tweens:{get:function(){return this._tweens}},imageryLayers:{get:function(){if(c(this.globe))return this.globe.imageryLayers}},terrainProvider:{get:function(){if(c(this.globe))return this.globe.terrainProvider},set:function(e){this._removeTerrainProviderReadyListener=this._removeTerrainProviderReadyListener&&this._removeTerrainProviderReadyListener(),c(this.globe)&&(this.globe.terrainProvider=e)}},terrainProviderChanged:{get:function(){if(c(this.globe))return this.globe.terrainProviderChanged}},preUpdate:{get:function(){return this._preUpdate}},postUpdate:{get:function(){return this._postUpdate}},renderError:{get:function(){return this._renderError}},preRender:{get:function(){return this._preRender}},postRender:{get:function(){return this._postRender}},lastRenderTime:{get:function(){return this._lastRenderTime}},context:{get:function(){return this._context}},debugFrustumStatistics:{get:function(){return this._view.debugFrustumStatistics}},scene3DOnly:{get:function(){return this._frameState.scene3DOnly}},orderIndependentTranslucency:{get:function(){return this._useOIT}},id:{get:function(){return this._id}},mode:{get:function(){return this._mode},set:function(e){if(this.scene3DOnly&&e!==oe.SCENE3D)throw new E("Only SceneMode.SCENE3D is valid when scene3DOnly is true.");if(e===oe.SCENE2D)this.morphTo2D(0);else if(e===oe.SCENE3D)this.morphTo3D(0);else if(e===oe.COLUMBUS_VIEW)this.morphToColumbusView(0);else throw new E("value must be a valid SceneMode enumeration.");this._mode=e}},frustumCommandsList:{get:function(){return this._view.frustumCommandsList}},numberOfFrustums:{get:function(){return this._view.frustumCommandsList.length}},useWebVR:{get:function(){return this._useWebVR},set:function(e){if(this.camera.frustum instanceof rn)throw new E("VR is unsupported with an orthographic projection.");this._useWebVR=e,this._useWebVR?(this._frameState.creditDisplay.container.style.visibility="hidden",this._cameraVR=new so(this),c(this._deviceOrientationCameraController)||(this._deviceOrientationCameraController=new P7(this)),this._aspectRatioVR=this.camera.frustum.aspectRatio):(this._frameState.creditDisplay.container.style.visibility="visible",this._cameraVR=void 0,this._deviceOrientationCameraController=this._deviceOrientationCameraController&&!this._deviceOrientationCameraController.isDestroyed()&&this._deviceOrientationCameraController.destroy(),this.camera.frustum.aspectRatio=this._aspectRatioVR,this.camera.frustum.xOffset=0)}},mapMode2D:{get:function(){return this._mapMode2D}},splitPosition:{get:function(){return this._frameState.splitPosition},set:function(e){this._frameState.splitPosition=e}},minimumDisableDepthTestDistance:{get:function(){return this._minimumDisableDepthTestDistance},set:function(e){if(!c(e)||e<0)throw new E("minimumDisableDepthTestDistance must be greater than or equal to 0.0.");this._minimumDisableDepthTestDistance=e}},logarithmicDepthBuffer:{get:function(){return this._logDepthBuffer},set:function(e){e=this._context.fragmentDepth&&e,this._logDepthBuffer!==e&&(this._logDepthBuffer=e,this._logDepthBufferDirty=!0)}},gamma:{get:function(){return this._context.uniformState.gamma},set:function(e){this._context.uniformState.gamma=e}},highDynamicRange:{get:function(){return this._hdr},set:function(e){let t=this._context,n=e&&t.depthTexture&&(t.colorBufferFloat||t.colorBufferHalfFloat);this._hdrDirty=n!==this._hdr,this._hdr=n}},highDynamicRangeSupported:{get:function(){let e=this._context;return e.depthTexture&&(e.colorBufferFloat||e.colorBufferHalfFloat)}},cameraUnderground:{get:function(){return this._cameraUnderground}},msaaSamples:{get:function(){return this._msaaSamples},set:function(e){e=Math.min(e,mt.maximumSamples),this._msaaSamples=e}},msaaSupported:{get:function(){return this._context.msaa}},pixelRatio:{get:function(){return this._frameState.pixelRatio},set:function(e){this._frameState.pixelRatio=e}},opaqueFrustumNearOffset:{get:function(){return .9999}},globeHeight:{get:function(){return this._globeHeight}}});Zn.prototype.getCompressedTextureFormatSupported=function(e){let t=this.context;return(e==="WEBGL_compressed_texture_s3tc"||e==="s3tc")&&t.s3tc||(e==="WEBGL_compressed_texture_pvrtc"||e==="pvrtc")&&t.pvrtc||(e==="WEBGL_compressed_texture_etc"||e==="etc")&&t.etc||(e==="WEBGL_compressed_texture_etc1"||e==="etc1")&&t.etc1||(e==="WEBGL_compressed_texture_astc"||e==="astc")&&t.astc||(e==="EXT_texture_compression_bptc"||e==="bc7")&&t.bc7};function lTt(e,t){let n=e.pickedMetadataInfo,i=t.pickedMetadataInfo;return n?.schemaId!==i?.schemaId||n?.className!==i?.className||n?.propertyName!==i?.propertyName}function iTe(e,t,n){let i=e._frameState,o=e._context,r=e._view.oit,{lightShadowMaps:s,lightShadowsEnabled:a}=i.shadowState,l=t.derivedCommands;c(t.pickId)&&(l.picking=py.createPickDerivedCommand(e,t,o,l.picking)),i.pickingMetadata&&t.pickMetadataAllowed&&(t.pickedMetadataInfo=i.pickedMetadataInfo,c(t.pickedMetadataInfo)&&(l.pickingMetadata=py.createPickMetadataDerivedCommand(e,t,o,l.pickingMetadata))),t.pickOnly||(l.depth=py.createDepthOnlyDerivedCommand(e,t,o,l.depth)),l.originalCommand=t,e._hdr&&(l.hdr=py.createHdrCommand(t,o,l.hdr),t=l.hdr.command,l=t.derivedCommands),a&&t.receiveShadows&&(l.shadows=tx.createReceiveDerivedCommand(s,t,n,o,l.shadows)),t.pass===ve.TRANSLUCENT&&c(r)&&r.isSupported()&&(a&&t.receiveShadows?(l.oit=c(l.oit)?l.oit:{},l.oit.shadows=r.createDerivedCommands(l.shadows.receiveCommand,o,l.oit.shadows)):l.oit=r.createDerivedCommands(t,o,l.oit))}Zn.prototype.updateDerivedCommands=function(e){let{derivedCommands:t}=e;if(!c(t))return;let n=this._frameState,{shadowState:i,useLogDepth:o}=this._frameState,r=this._context,s=!1,a=i.lastDirtyTime;e.lastDirtyTime!==a&&(e.lastDirtyTime=a,e.dirty=!0,s=!0);let l=this._hdr,u=c(t.logDepth),f=c(t.hdr),d=c(t.originalCommand),p=o&&!u,g=l&&!f,m=(!o||!l)&&!d,b=n.pickingMetadata&&lTt(e,n);if(e.dirty=e.dirty||p||g||m||b,!e.dirty)return;e.dirty=!1;let{shadowsEnabled:x,shadowMaps:T}=i;x&&e.castShadows&&(t.shadows=tx.createCastDerivedCommand(T,e,s,r,t.shadows)),(u||p)&&(t.logDepth=py.createLogDepthCommand(e,r,t.logDepth),iTe(this,t.logDepth.command,s)),(d||m)&&iTe(this,e,s)};var uTt=new sm({pass:Ro.RENDER}),oK=new sm({pass:Ro.PRELOAD}),rK=new sm({pass:Ro.PRELOAD_FLIGHT}),fTt=new sm({pass:Ro.REQUEST_RENDER_MODE_DEFER_CHECK}),oTe=new ce,sK;function dTt(e){if(!(e._mode!==oe.SCENE3D||!e.globe?.show||e._cameraUnderground||e._globeTranslucencyState.translucent))return oTe.radius=e.ellipsoid.minimumRadius+e.frameState.minimumTerrainHeight,sK=LW.fromBoundingSphere(oTe,e.camera.positionWC,sK),sK}Zn.prototype.clearPasses=function(e){e.render=!1,e.pick=!1,e.pickVoxel=!1,e.depth=!1,e.postProcess=!1,e.offscreen=!1};function aTe(e,t,n){let i=e._frameState;i.frameNumber=t,i.time=J.clone(n,i.time)}Zn.prototype.updateFrameState=function(){let e=this.camera,t=this._frameState;t.commandList.length=0,t.shadowMaps.length=0,t.brdfLutGenerator=this._brdfLutGenerator,t.environmentMap=this.skyBox&&this.skyBox._cubeMap,t.mode=this._mode,t.morphTime=this.morphTime,t.mapProjection=this.mapProjection,t.camera=e,t.cullingVolume=e.frustum.computeCullingVolume(e.positionWC,e.directionWC,e.upWC),t.occluder=dTt(this),t.minimumTerrainHeight=0,t.minimumDisableDepthTestDistance=this._minimumDisableDepthTestDistance,t.invertClassification=this.invertClassification,t.useLogDepth=this._logDepthBuffer&&!(this.camera.frustum instanceof rn||this.camera.frustum instanceof er),t.light=this.light,t.cameraUnderground=this._cameraUnderground,t.globeTranslucencyState=this._globeTranslucencyState;let{globe:n}=this;c(n)&&n._terrainExaggerationChanged&&(this.verticalExaggeration=n._terrainExaggeration,this.verticalExaggerationRelativeHeight=n._terrainExaggerationRelativeHeight,n._terrainExaggerationChanged=!1),t.verticalExaggeration=this.verticalExaggeration,t.verticalExaggerationRelativeHeight=this.verticalExaggerationRelativeHeight,c(this._specularEnvironmentCubeMap)&&this._specularEnvironmentCubeMap.ready?(t.specularEnvironmentMaps=this._specularEnvironmentCubeMap.texture,t.specularEnvironmentMapsMaximumLOD=this._specularEnvironmentCubeMap.maximumMipmapLevel):(t.specularEnvironmentMaps=void 0,t.specularEnvironmentMapsMaximumLOD=void 0),t.sphericalHarmonicCoefficients=this.sphericalHarmonicCoefficients,this._actualInvertClassificationColor=j.clone(this.invertClassificationColor,this._actualInvertClassificationColor),kN.isTranslucencySupported(this._context)||(this._actualInvertClassificationColor.alpha=1),t.invertClassificationColor=this._actualInvertClassificationColor,c(this.globe)?t.maximumScreenSpaceError=this.globe.maximumScreenSpaceError:t.maximumScreenSpaceError=2,this.clearPasses(t.passes),t.tilesetPassState=void 0};Zn.prototype.isVisible=function(e,t,n){if(!c(t))return!1;let{boundingVolume:i}=t;return!c(i)||!t.cull?!0:e.computeVisibility(i)===qt.OUTSIDE?!1:!c(n)||!t.occlude||!i.isOccluded(n)};var xF=new k(0,0,1,0,1,0,0,0,0,1,0,0,0,0,0,1);xF=k.inverseTransformation(xF,xF);function hTt(e,t,n,i){let o=t._frameState,r=o.context,s=e.boundingVolume;c(t._debugVolume)&&t._debugVolume.destroy();let a=h.clone(s.center);if(o.mode!==oe.SCENE3D){a=k.multiplyByPoint(xF,a,a);let m=o.mapProjection,b=m.unproject(a);a=m.ellipsoid.cartographicToCartesian(b)}let l,u,{radius:f}=s;c(f)?(l=ga.createGeometry(new ga({radii:new h(f,f,f),vertexFormat:ln.FLAT_VERTEX_FORMAT})),u=k.fromTranslation(a)):(l=uc.createGeometry(uc.fromDimensions({dimensions:new h(2,2,2),vertexFormat:ln.FLAT_VERTEX_FORMAT})),u=k.fromRotationTranslation(s.halfAxes,a,new k)),t._debugVolume=new Rn({geometryInstances:new vt({geometry:Fn.toWireframe(l),modelMatrix:u,attributes:{color:new Wt(1,0,0,1)}}),appearance:new ln({flat:!0,translucent:!1}),asynchronous:!1});let d=o.commandList,p=o.commandList=[];t._debugVolume.update(o),e=p[0],o.useLogDepth&&(e=py.createLogDepthCommand(e,r).command);let g;c(i)&&(g=n.framebuffer,n.framebuffer=i),e.execute(r,n),c(g)&&(n.framebuffer=g),o.commandList=d}function pm(e,t,n,i){let o=t._frameState,r=t._context;if(c(t.debugCommandFilter)&&!t.debugCommandFilter(e))return;if(e instanceof ri){e.execute(r,n);return}e.debugShowBoundingVolume&&c(e.boundingVolume)&&hTt(e,t,n,i),o.useLogDepth&&c(e.derivedCommands.logDepth)&&(e=e.derivedCommands.logDepth.command);let s=o.passes;if(!s.pick&&!s.pickVoxel&&!s.depth&&t._hdr&&c(e.derivedCommands)&&c(e.derivedCommands.hdr)&&(e=e.derivedCommands.hdr.command),s.pick||s.depth){if(s.pick&&!s.depth){if(o.pickingMetadata&&c(e.derivedCommands.pickingMetadata)){e=e.derivedCommands.pickingMetadata.pickMetadataCommand,e.execute(r,n);return}if(!o.pickingMetadata&&c(e.derivedCommands.picking)){e=e.derivedCommands.picking.pickCommand,e.execute(r,n);return}}else if(c(e.derivedCommands.depth)){e=e.derivedCommands.depth.depthOnlyCommand,e.execute(r,n);return}}if(t.debugShowCommands||t.debugShowFrustums){t._debugInspector.executeDebugShowFrustumsCommand(t,e,n);return}o.shadowState.lightShadowsEnabled&&e.receiveShadows&&c(e.derivedCommands.shadows)?e.derivedCommands.shadows.receiveCommand.execute(r,n):e.execute(r,n)}function rTe(e,t,n){let{derivedCommands:i}=e;if(!c(i))return;let o=t._frameState,r=t._context;o.useLogDepth&&c(i.logDepth)&&(e=i.logDepth.command);let{picking:s,pickingMetadata:a,depth:l}=e.derivedCommands;c(a)&&(e=i.pickingMetadata.pickMetadataCommand,e.execute(r,n)),c(s)?(e=s.pickCommand,e.execute(r,n)):c(l)&&(e=l.depthOnlyCommand,e.execute(r,n))}function cTe(e,t,n){return t.boundingVolume.distanceSquaredTo(n)-e.boundingVolume.distanceSquaredTo(n)}function mTt(e,t,n){return e.boundingVolume.distanceSquaredTo(n)-t.boundingVolume.distanceSquaredTo(n)+R.EPSILON12}function pTt(e,t,n,i,o){Fb(i,cTe,e.camera.positionWC),c(o)&&t(o.unclassifiedCommand,e,n);for(let r=0;r<i.length;++r)t(i[r],e,n)}function _Tt(e,t,n,i,o){Fb(i,mTt,e.camera.positionWC),c(o)&&t(o.unclassifiedCommand,e,n);for(let r=0;r<i.length;++r)t(i[r],e,n)}function gTt(e,t,n){e.context.uniformState.updatePass(ve.VOXELS);let i=n.commands[ve.VOXELS];i.length=n.indices[ve.VOXELS],Fb(i,cTe,e.camera.positionWC);for(let o=0;o<i.length;++o)pm(i[o],e,t)}var yTt=new vi,bTt=new lu,xTt=new rn,TTt=new er;function ATt(e){let{frustum:t}=e;return c(t.fov)?t.clone(yTt):c(t.infiniteProjectionMatrix)?t.clone(bTt):c(t.width)?t.clone(xTt):t.clone(TTt)}function CTt(e){if(e._environmentState.useOIT){if(!c(e._executeOITFunction)){let{view:t,context:n}=e;e._executeOITFunction=function(i,o,r,s,a){t.globeDepth.prepareColorTextures(n),t.oit.executeCommands(i,o,r,s,a)}}return e._executeOITFunction}return e.frameState.passes.render?pTt:_Tt}function ETt(e,t,n){let{frameState:i,context:o}=e,{pick:r,pickVoxel:s}=i.passes,a=r||s,l;!a&&e._environmentState.useInvertClassification&&i.invertClassificationColor.alpha<1&&(l=e._invertClassification);let u=CTt(e);o.uniformState.updatePass(ve.TRANSLUCENT);let f=n.commands[ve.TRANSLUCENT];f.length=n.indices[ve.TRANSLUCENT],u(e,pm,t,f,l)}function STt(e,t,n){let{translucentTileClassification:i,globeDepth:o}=e._view;if(!(n.indices[ve.CESIUM_3D_TILE_CLASSIFICATION]>0)||!i.isSupported())return;let s=n.commands[ve.TRANSLUCENT];i.executeTranslucentCommands(e,pm,t,s,o.depthStencilTexture),i.executeClassificationCommands(e,pm,t,n)}function cK(e,t){let{camera:n,context:i,frameState:o}=e,{uniformState:r}=i;r.updateCamera(n);let s=ATt(n);s.near=n.frustum.near,s.far=n.frustum.far;let a=o.passes,l=a.pick||a.pickVoxel;l||wTt(e,t);let{clearGlobeDepth:u,renderTranslucentDepthForPick:f,useDepthPlane:d,useGlobeDepthFramebuffer:p,useInvertClassification:g,usePostProcessSelected:m}=e._environmentState,{globeDepth:b,globeTranslucencyFramebuffer:x,sceneFramebuffer:T,frustumCommandsList:C}=e._view,S=C.length,v=e._globeTranslucencyState,D=e._depthClearCommand,I=e._stencilClearCommand,L=e._classificationStencilClearCommand,M=e._depthPlane,N=n.position.z;function B(w,P){r.updatePass(P);let O=w.commands[P],F=w.indices[P];for(let V=0;V<F;++V)pm(O[V],e,t);return F}function _(w,P){r.updatePass(P);let O=w.commands[P],F=w.indices[P];for(let V=0;V<F;++V)rTe(O[V],e,t)}for(let w=0;w<S;++w){let P=S-w-1,O=C[P];e.mode===oe.SCENE2D?(n.position.z=N-O.near+1,s.far=Math.max(1,O.far-O.near),s.near=1,r.update(o),r.updateFrustum(s)):(s.near=P!==0?O.near*e.opaqueFrustumNearOffset:O.near,s.far=O.far,r.updateFrustum(s)),D.execute(i,t),i.stencilBuffer&&I.execute(i,t),v.translucent?(r.updatePass(ve.GLOBE),v.executeGlobeCommands(O,pm,x,e,t)):B(O,ve.GLOBE),p&&b.executeCopyDepth(i,t),f||(v.translucent?(r.updatePass(ve.TERRAIN_CLASSIFICATION),v.executeGlobeClassificationCommands(O,pm,x,e,t)):B(O,ve.TERRAIN_CLASSIFICATION)),u&&(D.execute(i,t),d&&M.execute(i,t));let F;if(!g||l||f)F=B(O,ve.CESIUM_3D_TILE),F>0&&(p&&(b.prepareColorTextures(i,u),b.executeUpdateDepth(i,t,b.depthStencilTexture)),f||(F=B(O,ve.CESIUM_3D_TILE_CLASSIFICATION)));else{e._invertClassification.clear(i,t);let G=t.framebuffer;t.framebuffer=e._invertClassification._fbo.framebuffer,F=B(O,ve.CESIUM_3D_TILE),p&&(e._invertClassification.prepareTextures(i),b.executeUpdateDepth(i,t,e._invertClassification._fbo.getDepthStencilTexture())),F=B(O,ve.CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW),t.framebuffer=G,e._invertClassification.executeClassified(i,t),o.invertClassificationColor.alpha===1&&e._invertClassification.executeUnclassified(i,t),F>0&&i.stencilBuffer&&L.execute(i,t),F=B(O,ve.CESIUM_3D_TILE_CLASSIFICATION)}if(F>0&&i.stencilBuffer&&I.execute(i,t),gTt(e,t,O),B(O,ve.OPAQUE),P!==0&&e.mode!==oe.SCENE2D&&(s.near=O.near,r.updateFrustum(s)),ETt(e,t,O),STt(e,t,O),i.depthTexture&&e.useDepthPicking&&(p||f)){let G=e._picking.getPickDepth(e,P);G.update(i,b.depthStencilTexture),G.executeCopyDepth(i,t)}if(l||!m)continue;let V=t.framebuffer;t.framebuffer=T.getIdFramebuffer(),s.near=P!==0?O.near*e.opaqueFrustumNearOffset:O.near,s.far=O.far,r.updateFrustum(s),v.translucent?(r.updatePass(ve.GLOBE),v.executeGlobeCommands(O,rTe,x,e,t)):_(O,ve.GLOBE),u&&(D.framebuffer=t.framebuffer,D.execute(i,t),D.framebuffer=void 0),u&&d&&M.execute(i,t),_(O,ve.CESIUM_3D_TILE),_(O,ve.OPAQUE),_(O,ve.TRANSLUCENT),t.framebuffer=V}}function wTt(e,t){let{context:n,environmentState:i,view:o}=e;if(n.uniformState.updatePass(ve.ENVIRONMENT),c(i.skyBoxCommand)&&pm(i.skyBoxCommand,e,t),i.isSkyAtmosphereVisible&&pm(i.skyAtmosphereCommand,e,t),i.isSunVisible&&(i.sunDrawCommand.execute(n,t),e.sunBloom&&!i.useWebVR)){let r;i.useGlobeDepthFramebuffer?r=o.globeDepth.framebuffer:i.usePostProcess?r=o.sceneFramebuffer.framebuffer:r=i.originalFramebuffer,e._sunPostProcess.execute(n),e._sunPostProcess.copy(n,r),t.framebuffer=r}i.isMoonVisible&&i.moonCommand.execute(n,t)}function lTe(e){e.context.uniformState.updatePass(ve.COMPUTE);let t=e._environmentState.sunComputeCommand;c(t)&&t.execute(e._computeEngine);let n=e._computeCommandList;for(let i=0;i<n.length;++i)n[i].execute(e._computeEngine)}function vTt(e,t){e.context.uniformState.updatePass(ve.OVERLAY);let n=e.context,i=e._overlayCommandList;for(let o=0;o<i.length;++o)i[o].execute(n,t)}function DTt(e,t,n){let{shadowMapCullingVolume:i,isPointLight:o,passes:r}=n,s=r.length,a=[ve.GLOBE,ve.CESIUM_3D_TILE,ve.OPAQUE,ve.TRANSLUCENT];for(let l=0;l<t.length;++l){let u=t[l];if(e.updateDerivedCommands(u),!(!u.castShadows||a.indexOf(u.pass)<0||!e.isVisible(i,u)))if(o)for(let f=0;f<s;++f)r[f].commandList.push(u);else if(s===1)r[0].commandList.push(u);else{let f=!1;for(let d=s-1;d>=0;--d){let p=r[d].cullingVolume;if(e.isVisible(p,u))r[d].commandList.push(u),f=!0;else if(f)break}}}}function uTe(e){let{shadowState:t,commandList:n}=e.frameState,{shadowsEnabled:i,shadowMaps:o}=t;if(!i)return;let{context:r}=e,{uniformState:s}=r;for(let a=0;a<o.length;++a){let l=o[a];if(l.outOfView)continue;let{passes:u}=l;for(let f=0;f<u.length;++f)u[f].commandList.length=0;DTt(e,n,l);for(let f=0;f<u.length;++f){let d=l.passes[f],{camera:p,commandList:g}=d;s.updateCamera(p),l.updatePass(r,f);for(let m=0;m<g.length;++m){let b=g[m];s.updatePass(b.pass);let x=b.derivedCommands.shadows.castCommands[a];pm(x,e,d.passState)}}}}var PTt=new h;Zn.prototype.updateAndExecuteCommands=function(e,t){HTt(this,e,t),this._environmentState.useWebVR?ITt(this,e,t):this._frameState.mode!==oe.SCENE2D||this._mapMode2D===Ef.ROTATE?Ey(!0,this,e):VTt(this,e)};function ITt(e,t){let n=e._view,i=n.camera,r=e._environmentState.renderTranslucentDepthForPick;fTe(e),n.createPotentiallyVisibleSet(e),lTe(e),r||uTe(e);let s=t.viewport;s.x=0,s.y=0,s.width=s.width*.5;let a=so.clone(i,e._cameraVR);a.frustum=i.frustum;let l=i.frustum.near,u=l*y(e.focalLength,5),f=y(e.eyeSeparation,u/30),d=h.multiplyByScalar(a.right,f*.5,PTt);i.frustum.aspectRatio=s.width/s.height;let p=.5*f*l/u;h.add(a.position,d,i.position),i.frustum.xOffset=p,cK(e,t),s.x=s.width,h.subtract(a.position,d,i.position),i.frustum.xOffset=-p,cK(e,t),so.clone(a,i)}var OTt=new he(Math.PI,R.PI_OVER_TWO),RTt=new h,MTt=new h,LTt=new k,NTt=new k,FTt=new h,BTt=new h,kTt=new Ke;function VTt(e,t){let{frameState:n,camera:i}=e,{uniformState:o}=e.context,r=t.viewport,s=Ke.clone(r,kTt);t.viewport=s;let a=OTt,l=RTt;e.mapProjection.project(a,l);let f=h.clone(i.position,MTt),d=k.clone(i.transform,NTt),p=i.frustum.clone();i._setTransform(k.IDENTITY);let g=k.computeViewportTransformation(s,0,1,LTt),m=i.frustum.projectionMatrix,b=i.positionWC.y,x=h.fromElements(R.sign(b)*l.x-b,0,-i.positionWC.x,FTt),T=Ft.pointToGLWindowCoordinates(m,g,x,BTt);T.x=Math.floor(T.x);let C=s.x,S=s.width;if(b===0||T.x<=C||T.x>=C+S)Ey(!0,e,t);else if(Math.abs(C+S*.5-T.x)<1)s.width=T.x-s.x,i.position.x*=R.sign(i.position.x),i.frustum.right=0,n.cullingVolume=i.frustum.computeCullingVolume(i.positionWC,i.directionWC,i.upWC),o.update(n),Ey(!0,e,t),s.x=T.x,i.position.x=-i.position.x,i.frustum.right=-i.frustum.left,i.frustum.left=0,n.cullingVolume=i.frustum.computeCullingVolume(i.positionWC,i.directionWC,i.upWC),o.update(n),Ey(!1,e,t);else if(T.x>C+S*.5){s.width=T.x-C;let v=i.frustum.right;i.frustum.right=l.x-b,n.cullingVolume=i.frustum.computeCullingVolume(i.positionWC,i.directionWC,i.upWC),o.update(n),Ey(!0,e,t),s.x=T.x,s.width=C+S-T.x,i.position.x=-i.position.x,i.frustum.left=-i.frustum.right,i.frustum.right=v-i.frustum.right*2,n.cullingVolume=i.frustum.computeCullingVolume(i.positionWC,i.directionWC,i.upWC),o.update(n),Ey(!1,e,t)}else{s.x=T.x,s.width=C+S-T.x;let v=i.frustum.left;i.frustum.left=-l.x-b,n.cullingVolume=i.frustum.computeCullingVolume(i.positionWC,i.directionWC,i.upWC),o.update(n),Ey(!0,e,t),s.x=C,s.width=T.x-C,i.position.x=-i.position.x,i.frustum.right=-i.frustum.left,i.frustum.left=v-i.frustum.left*2,n.cullingVolume=i.frustum.computeCullingVolume(i.positionWC,i.directionWC,i.upWC),o.update(n),Ey(!1,e,t)}i._setTransform(d),h.clone(f,i.position),i.frustum=p.clone(),t.viewport=r}function Ey(e,t,n){let i=t._view,{renderTranslucentDepthForPick:o}=t._environmentState;e||(t.frameState.commandList.length=0),fTe(t),i.createPotentiallyVisibleSet(t),e&&(lTe(t),o||uTe(t)),cK(t,n)}var sTe=new Os;Zn.prototype.updateEnvironment=function(){let e=this._frameState,t=this._view,n=this._environmentState,i=e.passes.render,o=e.passes.offscreen,r=this.atmosphere,s=this.skyAtmosphere,a=this.globe,l=this._globeTranslucencyState;if(!i||this._mode!==oe.SCENE2D&&t.camera.frustum instanceof rn||!l.environmentVisible)n.skyAtmosphereCommand=void 0,n.skyBoxCommand=void 0,n.sunDrawCommand=void 0,n.sunComputeCommand=void 0,n.moonCommand=void 0;else{if(c(s)){if(c(a))s.setDynamicLighting(T0.fromGlobeFlags(a)),n.isReadyForAtmosphere=n.isReadyForAtmosphere||!a.show||a._surface._tilesToRender.length>0;else{let T=r.dynamicLighting;s.setDynamicLighting(T),n.isReadyForAtmosphere=!0}n.skyAtmosphereCommand=s.update(e,a),c(n.skyAtmosphereCommand)&&this.updateDerivedCommands(n.skyAtmosphereCommand)}else n.skyAtmosphereCommand=void 0;n.skyBoxCommand=c(this.skyBox)?this.skyBox.update(e,this._hdr):void 0;let x=c(this.sun)?this.sun.update(e,t.passState,this._hdr):void 0;n.sunDrawCommand=c(x)?x.drawCommand:void 0,n.sunComputeCommand=c(x)?x.computeCommand:void 0,n.moonCommand=c(this.moon)?this.moon.update(e):void 0}let u=n.clearGlobeDepth=c(a)&&a.show&&(!a.depthTestAgainstTerrain||this.mode===oe.SCENE2D);(n.useDepthPlane=u&&this.mode===oe.SCENE3D&&l.useDepthPlane)&&this._depthPlane.update(e),n.renderTranslucentDepthForPick=!1,n.useWebVR=this._useWebVR&&this.mode!==oe.SCENE2D&&!o;let d=e.mode===oe.SCENE3D&&!l.sunVisibleThroughGlobe?e.occluder:void 0,p=e.cullingVolume,g=sTe.planes;for(let x=0;x<5;++x)g[x]=p.planes[x];p=sTe,n.isSkyAtmosphereVisible=c(n.skyAtmosphereCommand)&&n.isReadyForAtmosphere,n.isSunVisible=this.isVisible(p,n.sunDrawCommand,d),n.isMoonVisible=this.isVisible(p,n.moonCommand,d);let m=this.specularEnvironmentMaps,b=this._specularEnvironmentCubeMap;c(m)&&b?.url!==m?(b=b&&b.destroy(),this._specularEnvironmentCubeMap=new Gm(m)):!c(m)&&c(b)&&(b.destroy(),this._specularEnvironmentCubeMap=void 0),c(this._specularEnvironmentCubeMap)&&this._specularEnvironmentCubeMap.update(e)};function UTt(e){let t=e._frameState;e.debugShowFrustumPlanes!==e._debugShowFrustumPlanes&&(e.debugShowFrustumPlanes?e._debugFrustumPlanes=new my({camera:e.camera,updateOnChange:!1,frustumSplits:t.frustumSplits}):e._debugFrustumPlanes=e._debugFrustumPlanes&&e._debugFrustumPlanes.destroy(),e._debugShowFrustumPlanes=e.debugShowFrustumPlanes),c(e._debugFrustumPlanes)&&e._debugFrustumPlanes.update(t)}function zTt(e){let t=e._frameState,{passes:n,shadowState:i,shadowMaps:o}=t,r=o.length,s=r>0&&!n.pick&&!n.pickVoxel&&e.mode===oe.SCENE3D;if(s!==i.shadowsEnabled&&(++i.lastDirtyTime,i.shadowsEnabled=s),i.lightShadowsEnabled=!1,!!s){for(let a=0;a<r;++a)if(o[a]!==i.shadowMaps[a]){++i.lastDirtyTime;break}i.shadowMaps.length=0,i.lightShadowMaps.length=0;for(let a=0;a<r;++a){let l=o[a];l.update(t),i.shadowMaps.push(l),l.fromLightSource&&(i.lightShadowMaps.push(l),i.lightShadowsEnabled=!0),l.dirty&&(++i.lastDirtyTime,l.dirty=!1)}}}function fTe(e){let t=e._frameState;e._groundPrimitives.update(t),e._primitives.update(t),UTt(e),zTt(e),e._globe&&e._globe.render(t)}function HTt(e,t,n){let i=e._context,o=e._frameState,r=e._environmentState,s=e._view,a=o.passes,l=a.pick||a.pickVoxel;c(s.globeDepth)&&(s.globeDepth.picking=l);let u=r.useWebVR;r.originalFramebuffer=t.framebuffer,c(e.sun)&&e.sunBloom!==e._sunBloom?(e.sunBloom&&!u?e._sunPostProcess=new ZX:c(e._sunPostProcess)&&(e._sunPostProcess=e._sunPostProcess.destroy()),e._sunBloom=e.sunBloom):!c(e.sun)&&c(e._sunPostProcess)&&(e._sunPostProcess=e._sunPostProcess.destroy(),e._sunBloom=!1);let f=e._clearColorCommand;j.clone(n,f.color),f.execute(i,t);let d=r.useGlobeDepthFramebuffer=c(s.globeDepth);d&&(s.globeDepth.update(i,t,s.viewport,e.msaaSamples,e._hdr,r.clearGlobeDepth),s.globeDepth.clear(i,t,n));let p=s.oit,g=r.useOIT=!l&&c(p)&&p.isSupported();g&&(p.update(i,t,s.globeDepth.colorFramebufferManager,e._hdr,e.msaaSamples),p.clear(i,t,n),r.useOIT=p.isSupported());let m=e.postProcessStages,b=r.usePostProcess=!l&&(e._hdr||m.length>0||m.ambientOcclusion.enabled||m.fxaa.enabled||m.bloom.enabled);if(r.usePostProcessSelected=!1,b&&(s.sceneFramebuffer.update(i,s.viewport,e._hdr,e.msaaSamples),s.sceneFramebuffer.clear(i,t,n),m.update(i,o.useLogDepth,e._hdr),m.clear(i),b=r.usePostProcess=m.ready,r.usePostProcessSelected=b&&m.hasSelected),r.isSunVisible&&e.sunBloom&&!u?(t.framebuffer=e._sunPostProcess.update(t),e._sunPostProcess.clear(i,t,n)):d?t.framebuffer=s.globeDepth.framebuffer:b&&(t.framebuffer=s.sceneFramebuffer.framebuffer),c(t.framebuffer)&&f.execute(i,t),r.useInvertClassification=!l&&c(t.framebuffer)&&e.invertClassification){let T;if(o.invertClassificationColor.alpha===1&&d&&(T=s.globeDepth.framebuffer),c(T)||i.depthTexture){if(e._invertClassification.previousFramebuffer=T,e._invertClassification.update(i,e.msaaSamples,s.globeDepth.colorFramebufferManager),e._invertClassification.clear(i,t),o.invertClassificationColor.alpha<1&&g){let C=e._invertClassification.unclassifiedCommand,S=C.derivedCommands;S.oit=p.createDerivedCommands(C,i,S.oit)}}else r.useInvertClassification=!1}e._globeTranslucencyState.translucent&&s.globeTranslucencyFramebuffer.updateAndClear(e._hdr,s.viewport,i,t)}Zn.prototype.resolveFramebuffers=function(e){let t=this._context,n=this._environmentState,i=this._view,{globeDepth:o,translucentTileClassification:r}=i;c(o)&&o.prepareColorTextures(t);let{useOIT:s,useGlobeDepthFramebuffer:a,usePostProcess:l,originalFramebuffer:u}=n,f=a?o.colorFramebufferManager:void 0,d=i.sceneFramebuffer._colorFramebuffer,p=i.sceneFramebuffer.idFramebuffer;if(s&&(e.framebuffer=l?d.framebuffer:u,i.oit.execute(t,e)),r.hasTranslucentDepth&&r.isSupported()&&r.execute(this,e),l){i.sceneFramebuffer.prepareColorTextures(t);let g=d;a&&!s&&(g=f);let m=this.postProcessStages,b=g.getColorTexture(0),x=p.getColorTexture(0),T=y(f,d).getDepthStencilTexture();m.execute(t,b,T,x),m.copy(t,u)}!s&&!l&&a&&(e.framebuffer=u,o.executeCopyColor(t,e))};function GTt(e){let t=e._frameState.afterRender;for(let n=0;n<t.length;++n)t[n]()&&e.requestRender();t.length=0}function jTt(e){if(e.mode===oe.MORPHING)return;let t=e.camera.positionCartographic;return e.getHeight(t)}Zn.prototype.getHeight=function(e,t){if(!c(e))return;let n=t===$e.CLAMP_TO_TERRAIN||t===$e.RELATIVE_TO_TERRAIN,i=t===$e.CLAMP_TO_3D_TILE||t===$e.RELATIVE_TO_3D_TILE;if(!c(e))return;let o=Number.NEGATIVE_INFINITY;if(!n){let s=this.primitives.length;for(let a=0;a<s;++a){let l=this.primitives.get(a);if(!l.isCesium3DTileset||!l.show||!l.enableCollision)continue;let u=l.getHeight(e,this);c(u)&&u>o&&(o=u)}}let r=this._globe;if(!i&&c(r)&&r.show){let s=r.getHeight(e);s>o&&(o=s)}if(o>Number.NEGATIVE_INFINITY)return o};var aK=new he;Zn.prototype.updateHeight=function(e,t,n){A.typeOf.func("callback",t);let i=()=>{he.clone(e,aK);let g=this.getHeight(e,n);c(g)&&(aK.height=g,t(aK))},o=n===$e.CLAMP_TO_TERRAIN||n===$e.RELATIVE_TO_TERRAIN,r=n===$e.CLAMP_TO_3D_TILE||n===$e.RELATIVE_TO_3D_TILE,s;!r&&c(this.globe)&&(s=this.globe._surface.updateHeight(e,i));let a={},l=this._ellipsoid,u=g=>{if(o||g.isDestroyed()||!g.isCesium3DTileset)return;let m=g.updateHeight(e,i,l);a[g.id]=m};if(!o){let g=this.primitives.length;for(let m=0;m<g;++m){let b=this.primitives.get(m);u(b)}}let f=this.primitives.primitiveAdded.addEventListener(u),d=this.primitives.primitiveRemoved.addEventListener(g=>{g.isDestroyed()||!g.isCesium3DTileset||(c(a[g.id])&&a[g.id](),delete a[g.id])});return()=>{s=s&&s(),Object.values(a).forEach(g=>g()),a={},f(),d()}};function WTt(e){let t=e.camera,n=e._mode,i=e._screenSpaceCameraController,o=t.positionCartographic;if(!c(o))return!1;if(!i.onMap()&&o.height<0)return!0;if(n===oe.SCENE2D||n===oe.MORPHING)return!1;let r=e._globeHeight;return c(r)&&o.height<r}Zn.prototype.initializeFrame=function(){if(this._shaderFrameCount++===120&&(this._shaderFrameCount=0,this._context.shaderCache.destroyReleasedShaderPrograms(),this._context.textureCache.destroyReleasedTextures()),this._tweens.update(),this._globeHeightDirty){c(this._removeUpdateHeightCallback)&&(this._removeUpdateHeightCallback(),this._removeUpdateHeightCallback=void 0),this._globeHeight=jTt(this),this._globeHeightDirty=!1;let e=this.camera.positionCartographic;this._removeUpdateHeightCallback=this.updateHeight(e,t=>{this.isDestroyed()||(this._globeHeight=t.height)})}this._cameraUnderground=WTt(this),this._globeTranslucencyState.update(this),this._screenSpaceCameraController.update(),c(this._deviceOrientationCameraController)&&this._deviceOrientationCameraController.update(),this.camera.update(this._mode),this.camera._updateCameraChanged()};function qTt(e,t){if(e.debugShowFramesPerSecond){if(!c(e._performanceDisplay)){let n=document.createElement("div");n.className="cesium-performanceDisplay-defaultContainer",e._canvas.parentNode.appendChild(n);let o=new xy({container:n});e._performanceDisplay=o,e._performanceContainer=n}e._performanceDisplay.throttled=e.requestRenderMode,e._performanceDisplay.update(t)}else c(e._performanceDisplay)&&(e._performanceDisplay=e._performanceDisplay&&e._performanceDisplay.destroy(),e._performanceContainer.parentNode.removeChild(e._performanceContainer))}function YTt(e){e._jobScheduler.resetBudgets();let t=e._frameState;e.primitives.prePassesUpdate(t),c(e.globe)&&e.globe.update(t),e._picking.update(),t.creditDisplay.update()}function XTt(e){e.primitives.postPassesUpdate(e._frameState),qc.update()}var KTt=new j;function $Tt(e){let t=e._frameState,n=e.context,{uniformState:i}=n,o=e._defaultView;e._view=o,e.updateFrameState(),t.passes.render=!0,t.passes.postProcess=e.postProcessStages.hasSelected,t.tilesetPassState=uTt;let r=y(e.backgroundColor,j.BLACK);e._hdr&&(r=j.clone(r,KTt),r.red=Math.pow(r.red,e.gamma),r.green=Math.pow(r.green,e.gamma),r.blue=Math.pow(r.blue,e.gamma)),t.backgroundColor=r,t.atmosphere=e.atmosphere,e.fog.update(t),i.update(t);let s=e.shadowMap;c(s)&&s.enabled&&(!c(e.light)||e.light instanceof Ub?h.negate(i.sunDirectionWC,e._shadowMapCamera.direction):h.clone(e.light.direction,e._shadowMapCamera.direction),t.shadowMaps.push(s)),e._computeCommandList.length=0,e._overlayCommandList.length=0;let a=o.viewport;a.x=0,a.y=0,a.width=n.drawingBufferWidth,a.height=n.drawingBufferHeight;let l=o.passState;l.framebuffer=void 0,l.blendingEnabled=void 0,l.scissorTest=void 0,l.viewport=Ke.clone(a,l.viewport),c(e.globe)&&e.globe.beginFrame(t),e.updateEnvironment(),e.updateAndExecuteCommands(l,r),e.resolveFramebuffers(l),l.framebuffer=void 0,vTt(e,l),c(e.globe)&&(e.globe.endFrame(t),e.globe.tilesLoaded||(e._renderRequested=!0)),n.endFrame()}function dx(e,t){try{t(e)}catch(n){if(e._renderError.raiseEvent(e,n),e.rethrowRenderErrors)throw n}}function ZTt(e){return e._picking.updateMostDetailedRayPicks(e)}Zn.prototype.render=function(e){this._preUpdate.raiseEvent(this,e);let t=this._frameState;t.newFrame=!1,c(e)||(e=J.now());let n=this._view.checkForCameraUpdates(this);n&&(this._globeHeightDirty=!0);let i=!this.requestRenderMode||this._renderRequested||n||this._logDepthBufferDirty||this._hdrDirty||this.mode===oe.MORPHING;if(!i&&c(this.maximumRenderTimeChange)&&c(this._lastRenderTime)){let o=Math.abs(J.secondsDifference(this._lastRenderTime,e));i=i||o>this.maximumRenderTimeChange}if(i){this._lastRenderTime=J.clone(e,this._lastRenderTime),this._renderRequested=!1,this._logDepthBufferDirty=!1,this._hdrDirty=!1;let o=R.incrementWrap(t.frameNumber,15e6,1);aTe(this,o,e),t.newFrame=!0}dx(this,YTt),this.primitives.show&&(dx(this,ZTt),dx(this,JTt),dx(this,QTt),i||dx(this,eAt)),this._postUpdate.raiseEvent(this,e),i&&(this._preRender.raiseEvent(this,e),t.creditDisplay.beginFrame(),dx(this,$Tt)),qTt(this,i),dx(this,XTt),GTt(this),i&&(this._postRender.raiseEvent(this,e),t.creditDisplay.endFrame())};Zn.prototype.forceRender=function(e){this._renderRequested=!0,this.render(e)};Zn.prototype.requestRender=function(){this._renderRequested=!0};Zn.prototype.clampLineWidth=function(e){return Math.max(mt.minimumAliasedLineWidth,Math.min(e,mt.maximumAliasedLineWidth))};Zn.prototype.pick=function(e,t,n){return this._picking.pick(this,e,t,n)};Zn.prototype.pickVoxel=function(e,t,n){let i=this.pick(e,t,n);if(!c(i))return;let o=i.primitive;if(!(o instanceof jC))return;let r=this._picking.pickVoxelCoordinate(this,e,t,n),s=255*r[0]+r[1],a=o._traversal.findKeyframeNode(s);if(!c(a))return;let l=255*r[2]+r[3];return JX.fromKeyframeNode(o,s,l,a)};Zn.prototype.pickMetadata=function(e,t,n,i){A.typeOf.object("windowPosition",e),A.typeOf.string("className",n),A.typeOf.string("propertyName",i);let o=this.pick(e);if(!c(o))return;let r=o.detail?.model?.structuralMetadata?.schema,s=V7(r,t,n,i);if(!c(s))return;let a=new zY(t,n,i,s);return this._picking.pickMetadata(this,e,a)};Zn.prototype.pickMetadataSchema=function(e){A.typeOf.object("windowPosition",e);let t=this.pick(e);return c(t)?t.detail?.model?.structuralMetadata?.schema:void 0};Zn.prototype.pickPositionWorldCoordinates=function(e,t){return this._picking.pickPositionWorldCoordinates(this,e,t)};Zn.prototype.pickPosition=function(e,t){return this._picking.pickPosition(this,e,t)};Zn.prototype.drillPick=function(e,t,n,i){return this._picking.drillPick(this,e,t,n,i)};function JTt(e){let t=e._frameState;oK.camera=t.camera,oK.cullingVolume=t.cullingVolume,e.primitives.updateForPass(t,oK)}function QTt(e){let t=e._frameState;if(!t.camera.canPreloadFlight())return;rK.camera=e.preloadFlightCamera,rK.cullingVolume=e.preloadFlightCullingVolume,e.primitives.updateForPass(t,rK)}function eAt(e){e.primitives.updateForPass(e._frameState,fTt)}Zn.prototype.pickFromRay=function(e,t,n){return this._picking.pickFromRay(this,e,t,n)};Zn.prototype.drillPickFromRay=function(e,t,n,i){return this._picking.drillPickFromRay(this,e,t,n,i)};Zn.prototype.pickFromRayMostDetailed=function(e,t,n){return this._picking.pickFromRayMostDetailed(this,e,t,n)};Zn.prototype.drillPickFromRayMostDetailed=function(e,t,n,i){return this._picking.drillPickFromRayMostDetailed(this,e,t,n,i)};Zn.prototype.sampleHeight=function(e,t,n){return this._picking.sampleHeight(this,e,t,n)};Zn.prototype.clampToHeight=function(e,t,n,i){return this._picking.clampToHeight(this,e,t,n,i)};Zn.prototype.sampleHeightMostDetailed=function(e,t,n){return this._picking.sampleHeightMostDetailed(this,e,t,n)};Zn.prototype.clampToHeightMostDetailed=function(e,t,n){return this._picking.clampToHeightMostDetailed(this,e,t,n)};Zn.prototype.cartesianToCanvasCoordinates=function(e,t){return Ni.worldToWindowCoordinates(this,e,t)};Zn.prototype.completeMorph=function(){this._transitioner.completeMorph()};Zn.prototype.morphTo2D=function(e){e=y(e,2),this._transitioner.morphTo2D(e,this._ellipsoid)};Zn.prototype.morphToColumbusView=function(e){e=y(e,2),this._transitioner.morphToColumbusView(e,this._ellipsoid)};Zn.prototype.morphTo3D=function(e){e=y(e,2),this._transitioner.morphTo3D(e,this._ellipsoid)};function tAt(e,t){if(e._removeTerrainProviderReadyListener=e._removeTerrainProviderReadyListener&&e._removeTerrainProviderReadyListener(),t.ready){c(e.globe)&&(e.globe.terrainProvider=t.provider);return}e.globe.terrainProvider=void 0,e._removeTerrainProviderReadyListener=t.readyEvent.addEventListener(n=>{c(e)&&c(e.globe)&&(e.globe.terrainProvider=n),e._removeTerrainProviderReadyListener()})}Zn.prototype.setTerrain=function(e){return A.typeOf.object("terrain",e),tAt(this,e),e};Zn.prototype.isDestroyed=function(){return!1};Zn.prototype.destroy=function(){this._tweens.removeAll(),this._computeEngine=this._computeEngine&&this._computeEngine.destroy(),this._screenSpaceCameraController=this._screenSpaceCameraController&&this._screenSpaceCameraController.destroy(),this._deviceOrientationCameraController=this._deviceOrientationCameraController&&!this._deviceOrientationCameraController.isDestroyed()&&this._deviceOrientationCameraController.destroy(),this._primitives=this._primitives&&this._primitives.destroy(),this._groundPrimitives=this._groundPrimitives&&this._groundPrimitives.destroy(),this._globe=this._globe&&this._globe.destroy(),this._removeTerrainProviderReadyListener=this._removeTerrainProviderReadyListener&&this._removeTerrainProviderReadyListener(),this.skyBox=this.skyBox&&this.skyBox.destroy(),this.skyAtmosphere=this.skyAtmosphere&&this.skyAtmosphere.destroy(),this._debugSphere=this._debugSphere&&this._debugSphere.destroy(),this.sun=this.sun&&this.sun.destroy(),this._sunPostProcess=this._sunPostProcess&&this._sunPostProcess.destroy(),this._depthPlane=this._depthPlane&&this._depthPlane.destroy(),this._transitioner=this._transitioner&&this._transitioner.destroy(),this._debugFrustumPlanes=this._debugFrustumPlanes&&this._debugFrustumPlanes.destroy(),this._brdfLutGenerator=this._brdfLutGenerator&&this._brdfLutGenerator.destroy(),this._picking=this._picking&&this._picking.destroy(),this._defaultView=this._defaultView&&this._defaultView.destroy(),this._view=void 0,this._removeCreditContainer&&this._canvas.parentNode.removeChild(this._creditContainer),this.postProcessStages=this.postProcessStages&&this.postProcessStages.destroy(),this._context=this._context&&this._context.destroy(),this._frameState.creditDisplay=this._frameState.creditDisplay&&this._frameState.creditDisplay.destroy(),c(this._performanceDisplay)&&(this._performanceDisplay=this._performanceDisplay&&this._performanceDisplay.destroy(),this._performanceContainer.parentNode.removeChild(this._performanceContainer)),this._removeRequestListenerCallback(),this._removeTaskProcessorListenerCallback();for(let e=0;e<this._removeGlobeCallbacks.length;++e)this._removeGlobeCallbacks[e]();return this._removeGlobeCallbacks.length=0,c(this._removeUpdateHeightCallback)&&(this._removeUpdateHeightCallback(),this._removeUpdateHeightCallback=void 0),de(this)};var lK=Zn;var AF=`float interpolateByDistance(vec4 nearFarScalar, float distance)
{
float startDistance = nearFarScalar.x;
float startValue = nearFarScalar.y;
float endDistance = nearFarScalar.z;
float endValue = nearFarScalar.w;
float t = clamp((distance - startDistance) / (endDistance - startDistance), 0.0, 1.0);
return mix(startValue, endValue, t);
}
void computeAtmosphereScattering(vec3 positionWC, vec3 lightDirection, out vec3 rayleighColor, out vec3 mieColor, out float opacity, out float underTranslucentGlobe)
{
float ellipsoidRadiiDifference = czm_ellipsoidRadii.x - czm_ellipsoidRadii.z;
float distanceAdjustMin = czm_ellipsoidRadii.x / 4.0;
float distanceAdjustMax = czm_ellipsoidRadii.x;
float distanceAdjustModifier = ellipsoidRadiiDifference / 2.0;
float distanceAdjust = distanceAdjustModifier * clamp((czm_eyeHeight - distanceAdjustMin) / (distanceAdjustMax - distanceAdjustMin), 0.0, 1.0);
float radiusAdjust = (ellipsoidRadiiDifference / 4.0) + distanceAdjust;
float atmosphereInnerRadius = (length(czm_viewerPositionWC) - czm_eyeHeight) - radiusAdjust;
vec3 cameraToPositionWC = positionWC - czm_viewerPositionWC;
vec3 cameraToPositionWCDirection = normalize(cameraToPositionWC);
czm_ray primaryRay = czm_ray(czm_viewerPositionWC, cameraToPositionWCDirection);
underTranslucentGlobe = 0.0;
#if defined(GLOBE_TRANSLUCENT)
czm_raySegment primaryRayEarthIntersect = czm_raySphereIntersectionInterval(primaryRay, vec3(0.0), atmosphereInnerRadius + radiusAdjust);
if (primaryRayEarthIntersect.start > 0.0 && primaryRayEarthIntersect.stop > 0.0) {
vec3 direction = normalize(positionWC);
czm_ray ellipsoidRay = czm_ray(positionWC, -direction);
czm_raySegment ellipsoidIntersection = czm_rayEllipsoidIntersectionInterval(ellipsoidRay, vec3(0.0), czm_ellipsoidInverseRadii);
vec3 onEarth = positionWC - (direction * ellipsoidIntersection.start);
float angle = dot(normalize(czm_viewerPositionWC), normalize(onEarth));
opacity = interpolateByDistance(vec4(0.0, 1.0, czm_ellipsoidRadii.x, 0.0), length(czm_viewerPositionWC - onEarth));
vec3 horizonColor = vec3(0.1, 0.2, 0.3);
vec3 nearColor = vec3(0.0);
rayleighColor = mix(nearColor, horizonColor, exp(-angle) * opacity);
underTranslucentGlobe = 1.0;
return;
}
#endif
computeScattering(
primaryRay,
length(cameraToPositionWC),
lightDirection,
atmosphereInnerRadius,
rayleighColor,
mieColor,
opacity
);
float cameraHeight = czm_eyeHeight + atmosphereInnerRadius;
float atmosphereOuterRadius = atmosphereInnerRadius + ATMOSPHERE_THICKNESS;
opacity = clamp((atmosphereOuterRadius - cameraHeight) / (atmosphereOuterRadius - atmosphereInnerRadius), 0.0, 1.0);
float nightAlpha = (u_radiiAndDynamicAtmosphereColor.z != 0.0) ? clamp(dot(normalize(positionWC), lightDirection), 0.0, 1.0) : 1.0;
opacity *= pow(nightAlpha, 0.5);
}
`;var uK=`in vec3 v_outerPositionWC;
uniform vec3 u_hsbShift;
#ifndef PER_FRAGMENT_ATMOSPHERE
in vec3 v_mieColor;
in vec3 v_rayleighColor;
in float v_opacity;
in float v_translucent;
#endif
void main (void)
{
float lightEnum = u_radiiAndDynamicAtmosphereColor.z;
vec3 lightDirection = czm_getDynamicAtmosphereLightDirection(v_outerPositionWC, lightEnum);
vec3 mieColor;
vec3 rayleighColor;
float opacity;
float translucent;
#ifdef PER_FRAGMENT_ATMOSPHERE
computeAtmosphereScattering(
v_outerPositionWC,
lightDirection,
rayleighColor,
mieColor,
opacity,
translucent
);
#else
mieColor = v_mieColor;
rayleighColor = v_rayleighColor;
opacity = v_opacity;
translucent = v_translucent;
#endif
vec4 color = computeAtmosphereColor(v_outerPositionWC, lightDirection, rayleighColor, mieColor, opacity);
#ifndef HDR
color.rgb = czm_pbrNeutralTonemapping(color.rgb);
color.rgb = czm_inverseGamma(color.rgb);
#endif
#ifdef COLOR_CORRECT
const bool ignoreBlackPixels = true;
color.rgb = czm_applyHSBShift(color.rgb, u_hsbShift, ignoreBlackPixels);
#endif
if (translucent == 0.0) {
color.a = mix(color.b, 1.0, color.a) * smoothstep(0.0, 1.0, czm_morphTime);
}
out_FragColor = color;
}
`;var fK=`in vec4 position;
out vec3 v_outerPositionWC;
#ifndef PER_FRAGMENT_ATMOSPHERE
out vec3 v_mieColor;
out vec3 v_rayleighColor;
out float v_opacity;
out float v_translucent;
#endif
void main(void)
{
vec4 positionWC = czm_model * position;
float lightEnum = u_radiiAndDynamicAtmosphereColor.z;
vec3 lightDirection = czm_getDynamicAtmosphereLightDirection(positionWC.xyz, lightEnum);
#ifndef PER_FRAGMENT_ATMOSPHERE
computeAtmosphereScattering(
positionWC.xyz,
lightDirection,
v_rayleighColor,
v_mieColor,
v_opacity,
v_translucent
);
#endif
v_outerPositionWC = positionWC.xyz;
gl_Position = czm_modelViewProjection * position;
}
`;function WC(e){e=y(e,ie.WGS84),this.show=!0,this.perFragmentAtmosphere=!1,this._ellipsoid=e;let t=1.025,n=h.multiplyByScalar(e.radii,t,new h);this._scaleMatrix=k.fromScale(n),this._modelMatrix=new k,this._command=new et({owner:this,modelMatrix:this._modelMatrix}),this._spSkyFromSpace=void 0,this._spSkyFromAtmosphere=void 0,this._flags=void 0,this.atmosphereLightIntensity=50,this.atmosphereRayleighCoefficient=new h(55e-7,13e-6,284e-7),this.atmosphereMieCoefficient=new h(21e-6,21e-6,21e-6),this.atmosphereRayleighScaleHeight=1e4,this.atmosphereMieScaleHeight=3200,this.atmosphereMieAnisotropy=.9,this.hueShift=0,this.saturationShift=0,this.brightnessShift=0,this._hueSaturationBrightness=new h;let i=new h;i.x=e.maximumRadius*t,i.y=e.maximumRadius,i.z=0,this._radiiAndDynamicAtmosphereColor=i;let o=this;this._command.uniformMap={u_radiiAndDynamicAtmosphereColor:function(){return o._radiiAndDynamicAtmosphereColor},u_hsbShift:function(){return o._hueSaturationBrightness.x=o.hueShift,o._hueSaturationBrightness.y=o.saturationShift,o._hueSaturationBrightness.z=o.brightnessShift,o._hueSaturationBrightness},u_atmosphereLightIntensity:function(){return o.atmosphereLightIntensity},u_atmosphereRayleighCoefficient:function(){return o.atmosphereRayleighCoefficient},u_atmosphereMieCoefficient:function(){return o.atmosphereMieCoefficient},u_atmosphereRayleighScaleHeight:function(){return o.atmosphereRayleighScaleHeight},u_atmosphereMieScaleHeight:function(){return o.atmosphereMieScaleHeight},u_atmosphereMieAnisotropy:function(){return o.atmosphereMieAnisotropy}}}Object.defineProperties(WC.prototype,{ellipsoid:{get:function(){return this._ellipsoid}}});WC.prototype.setDynamicLighting=function(e){this._radiiAndDynamicAtmosphereColor.z=e};var dK=new k;WC.prototype.update=function(e,t){if(!this.show)return;let n=e.mode;if(n!==oe.SCENE3D&&n!==oe.MORPHING||!e.passes.render)return;let i=k.fromRotationTranslation(e.context.uniformState.inverseViewRotation,h.ZERO,dK),o=k.multiplyTransformation(i,zo.Y_UP_TO_Z_UP,dK),r=k.multiply(this._scaleMatrix,o,dK);k.clone(r,this._modelMatrix);let s=e.context,a=nAt(this),l=e.globeTranslucencyState.translucent,u=this.perFragmentAtmosphere||l||!c(t)||!t.show,f=this._command;if(!c(f.vertexArray)){let p=ga.createGeometry(new ga({radii:new h(1,1,1),slicePartitions:256,stackPartitions:256,vertexFormat:Ie.POSITION_ONLY}));f.vertexArray=ni.fromGeometry({context:s,geometry:p,attributeLocations:Fn.createAttributeLocations(p),bufferUsage:ke.STATIC_DRAW}),f.renderState=ze.fromCache({cull:{enabled:!0,face:xi.FRONT},blending:hn.ALPHA_BLEND,depthMask:!1})}let d=a|u<<2|l<<3;if(d!==this._flags){this._flags=d;let p=[];a&&p.push("COLOR_CORRECT"),u&&p.push("PER_FRAGMENT_ATMOSPHERE"),l&&p.push("GLOBE_TRANSLUCENT");let g=new Ge({defines:p,sources:[np,AF,fK]}),m=new Ge({defines:p,sources:[np,AF,uK]});this._spSkyAtmosphere=an.fromCache({context:s,vertexShaderSource:g,fragmentShaderSource:m}),f.shaderProgram=this._spSkyAtmosphere}return f};function nAt(e){return!(R.equalsEpsilon(e.hueShift,0,R.EPSILON7)&&R.equalsEpsilon(e.saturationShift,0,R.EPSILON7)&&R.equalsEpsilon(e.brightnessShift,0,R.EPSILON7))}WC.prototype.isDestroyed=function(){return!1};WC.prototype.destroy=function(){let e=this._command;return e.vertexArray=e.vertexArray&&e.vertexArray.destroy(),this._spSkyAtmosphere=this._spSkyAtmosphere&&this._spSkyAtmosphere.destroy(),de(this)};var hK=WC;var mK=`uniform samplerCube u_cubeMap;
in vec3 v_texCoord;
void main()
{
vec4 color = czm_textureCube(u_cubeMap, normalize(v_texCoord));
out_FragColor = vec4(czm_gammaCorrect(color).rgb, czm_morphTime);
}
`;var pK=`in vec3 position;
out vec3 v_texCoord;
void main()
{
vec3 p = czm_viewRotation * (czm_temeToPseudoFixed * (czm_entireFrustum.y * position));
gl_Position = czm_projection * vec4(p, 1.0);
v_texCoord = position.xyz;
}
`;function YC(e){this.sources=e.sources,this._sources=void 0,this.show=y(e.show,!0),this._command=new et({modelMatrix:k.clone(k.IDENTITY),owner:this}),this._cubeMap=void 0,this._attributeLocations=void 0,this._useHdr=void 0}YC.prototype.update=function(e,t){let n=this,{mode:i,passes:o,context:r}=e;if(!this.show||i!==oe.SCENE3D&&i!==oe.MORPHING||!o.render)return;if(this._sources!==this.sources){this._sources=this.sources;let a=this.sources;if(A.defined("this.sources",a),Object.values(Jo.FaceName).some(u=>!c(a[u])))throw new E("this.sources must have positiveX, negativeX, positiveY, negativeY, positiveZ, and negativeZ properties.");let l=typeof a.positiveX;if(Object.values(Jo.FaceName).some(u=>typeof a[u]!==l))throw new E("this.sources properties must all be the same type.");typeof a.positiveX=="string"?rq(r,this._sources).then(function(u){n._cubeMap=n._cubeMap&&n._cubeMap.destroy(),n._cubeMap=u}):(this._cubeMap=this._cubeMap&&this._cubeMap.destroy(),this._cubeMap=new Jo({context:r,source:a}))}let s=this._command;if(!c(s.vertexArray)){s.uniformMap={u_cubeMap:function(){return n._cubeMap}};let a=uc.createGeometry(uc.fromDimensions({dimensions:new h(2,2,2),vertexFormat:Ie.POSITION_ONLY})),l=this._attributeLocations=Fn.createAttributeLocations(a);s.vertexArray=ni.fromGeometry({context:r,geometry:a,attributeLocations:l,bufferUsage:ke.STATIC_DRAW}),s.renderState=ze.fromCache({blending:hn.ALPHA_BLEND})}if(!c(s.shaderProgram)||this._useHdr!==t){let a=new Ge({defines:[t?"HDR":""],sources:[mK]});s.shaderProgram=an.fromCache({context:r,vertexShaderSource:pK,fragmentShaderSource:a,attributeLocations:this._attributeLocations}),this._useHdr=t}if(c(this._cubeMap))return s};YC.prototype.isDestroyed=function(){return!1};YC.prototype.destroy=function(){let e=this._command;return e.vertexArray=e.vertexArray&&e.vertexArray.destroy(),e.shaderProgram=e.shaderProgram&&e.shaderProgram.destroy(),this._cubeMap=this._cubeMap&&this._cubeMap.destroy(),de(this)};function qC(e){return sn(`Assets/Textures/SkyBox/tycho2t3_80_${e}.jpg`)}YC.createEarthSkyBox=function(){return new YC({sources:{positiveX:qC("px"),negativeX:qC("mx"),positiveY:qC("py"),negativeY:qC("my"),positiveZ:qC("pz"),negativeZ:qC("mz")}})};var _K=YC;function gK(e){e=y(e,1),A.typeOf.number.greaterThan("radius",e,0),this._radius=y(e,1)}Object.defineProperties(gK.prototype,{radius:{get:function(){return this._radius},set:function(e){A.typeOf.number.greaterThan("value",e,0),this._radius=e}}});gK.prototype.emit=function(e){let t=R.randomBetween(0,R.TWO_PI),n=R.randomBetween(0,R.PI),i=R.randomBetween(0,this._radius),o=i*Math.cos(t)*Math.sin(n),r=i*Math.sin(t)*Math.sin(n),s=i*Math.cos(n);e.position=h.fromElements(o,r,s,e.position),e.velocity=h.normalize(e.position,e.velocity)};var iAt=gK;function EP(){}EP.prototype.evaluate=function(e,t){E.throwInstantiationError()};EP.prototype.evaluateColor=function(e,t){E.throwInstantiationError()};EP.prototype.getShaderFunction=function(e,t,n,i){E.throwInstantiationError()};EP.prototype.getVariables=function(){E.throwInstantiationError()};var oAt=EP;var yK=`uniform sampler2D u_texture;
in vec2 v_textureCoordinates;
void main()
{
vec4 color = texture(u_texture, v_textureCoordinates);
out_FragColor = czm_gammaCorrect(color);
}
`;var bK=`uniform float u_radiusTS;
in vec2 v_textureCoordinates;
vec2 rotate(vec2 p, vec2 direction)
{
return vec2(p.x * direction.x - p.y * direction.y, p.x * direction.y + p.y * direction.x);
}
vec4 addBurst(vec2 position, vec2 direction, float lengthScalar)
{
vec2 rotatedPosition = rotate(position, direction) * vec2(25.0, 0.75);
float radius = length(rotatedPosition) * lengthScalar;
float burst = 1.0 - smoothstep(0.0, 0.55, radius);
return vec4(burst);
}
void main()
{
float lengthScalar = 2.0 / sqrt(2.0);
vec2 position = v_textureCoordinates - vec2(0.5);
float radius = length(position) * lengthScalar;
float surface = step(radius, u_radiusTS);
vec4 color = vec4(vec2(1.0), surface + 0.2, surface);
float glow = 1.0 - smoothstep(0.0, 0.55, radius);
color.ba += mix(vec2(0.0), vec2(1.0), glow) * 0.75;
vec4 burst = vec4(0.0);
burst += 0.4 * addBurst(position, vec2(0.38942,  0.92106), lengthScalar);
burst += 0.4 * addBurst(position, vec2(0.99235,  0.12348), lengthScalar);
burst += 0.4 * addBurst(position, vec2(0.60327, -0.79754), lengthScalar);
burst += 0.3 * addBurst(position, vec2(0.31457,  0.94924), lengthScalar);
burst += 0.3 * addBurst(position, vec2(0.97931,  0.20239), lengthScalar);
burst += 0.3 * addBurst(position, vec2(0.66507, -0.74678), lengthScalar);
color += clamp(burst, vec4(0.0), vec4(1.0)) * 0.15;
out_FragColor = clamp(color, vec4(0.0), vec4(1.0));
}
`;var xK=`in vec2 direction;
uniform float u_size;
out vec2 v_textureCoordinates;
void main()
{
vec4 position;
if (czm_morphTime == 1.0)
{
position = vec4(czm_sunPositionWC, 1.0);
}
else
{
position = vec4(czm_sunPositionColumbusView.zxy, 1.0);
}
vec4 positionEC = czm_view * position;
vec4 positionWC = czm_eyeToWindowCoordinates(positionEC);
vec2 halfSize = vec2(u_size * 0.5);
halfSize *= ((direction * 2.0) - 1.0);
gl_Position = czm_viewportOrthographic * vec4(positionWC.xy + halfSize, -positionWC.z, 1.0);
v_textureCoordinates = direction;
}
`;function wP(){this.show=!0,this._drawCommand=new et({primitiveType:Me.TRIANGLES,boundingVolume:new ce,owner:this}),this._commands={drawCommand:this._drawCommand,computeCommand:void 0},this._boundingVolume=new ce,this._boundingVolume2D=new ce,this._texture=void 0,this._drawingBufferWidth=void 0,this._drawingBufferHeight=void 0,this._radiusTS=void 0,this._size=void 0,this.glowFactor=1,this._glowFactorDirty=!1,this._useHdr=void 0;let e=this;this._uniformMap={u_texture:function(){return e._texture},u_size:function(){return e._size}}}Object.defineProperties(wP.prototype,{glowFactor:{get:function(){return this._glowFactor},set:function(e){e=Math.max(e,0),this._glowFactor=e,this._glowFactorDirty=!0}}});var rAt=new H,sAt=new H,aAt=new se,SP=new se;wP.prototype.update=function(e,t,n){if(!this.show)return;let i=e.mode;if(i===oe.SCENE2D||i===oe.MORPHING||!e.passes.render)return;let o=e.context,r=t.viewport.width,s=t.viewport.height;if(!c(this._texture)||r!==this._drawingBufferWidth||s!==this._drawingBufferHeight||this._glowFactorDirty||n!==this._useHdr){this._texture=this._texture&&this._texture.destroy(),this._drawingBufferWidth=r,this._drawingBufferHeight=s,this._glowFactorDirty=!1,this._useHdr=n;let v=Math.max(r,s);v=Math.pow(2,Math.ceil(Math.log(v)/Math.log(2))-2),v=Math.max(1,v);let D=n?o.halfFloatingPointTexture?Be.HALF_FLOAT:Be.FLOAT:Be.UNSIGNED_BYTE;this._texture=new Lt({context:o,width:v,height:v,pixelFormat:Ve.RGBA,pixelDatatype:D}),this._glowLengthTS=this._glowFactor*5,this._radiusTS=1/(1+2*this._glowLengthTS)*.5;let I=this,L={u_radiusTS:function(){return I._radiusTS}};this._commands.computeCommand=new zl({fragmentShaderSource:bK,outputTexture:this._texture,uniformMap:L,persists:!1,owner:this,postExecute:function(){I._commands.computeCommand=void 0}})}let a=this._drawCommand;if(!c(a.vertexArray)){let v={direction:0},D=new Uint8Array(4*2);D[0]=0,D[1]=0,D[2]=255,D[3]=0,D[4]=255,D[5]=255,D[6]=0,D[7]=255;let I=xt.createVertexBuffer({context:o,typedArray:D,usage:ke.STATIC_DRAW}),L=[{index:v.direction,vertexBuffer:I,componentsPerAttribute:2,normalize:!0,componentDatatype:$.UNSIGNED_BYTE}],M=xt.createIndexBuffer({context:o,typedArray:new Uint16Array([0,1,2,0,2,3]),usage:ke.STATIC_DRAW,indexDatatype:Fe.UNSIGNED_SHORT});a.vertexArray=new ni({context:o,attributes:L,indexBuffer:M}),a.shaderProgram=an.fromCache({context:o,vertexShaderSource:xK,fragmentShaderSource:yK,attributeLocations:v}),a.renderState=ze.fromCache({blending:hn.ALPHA_BLEND}),a.uniformMap=this._uniformMap}let l=o.uniformState.sunPositionWC,u=o.uniformState.sunPositionColumbusView,f=this._boundingVolume,d=this._boundingVolume2D;h.clone(l,f.center),d.center.x=u.z,d.center.y=u.x,d.center.z=u.y,f.radius=R.SOLAR_RADIUS+R.SOLAR_RADIUS*this._glowLengthTS,d.radius=f.radius,i===oe.SCENE3D?ce.clone(f,a.boundingVolume):i===oe.COLUMBUS_VIEW&&ce.clone(d,a.boundingVolume);let p=Ni.computeActualEllipsoidPosition(e,l,SP),g=h.magnitude(h.subtract(p,e.camera.position,SP)),m=o.uniformState.projection,b=aAt;b.x=0,b.y=0,b.z=-g,b.w=1;let x=k.multiplyByVector(m,b,SP),T=Ni.clipToGLWindowCoordinates(t.viewport,x,rAt);b.x=R.SOLAR_RADIUS;let C=k.multiplyByVector(m,b,SP),S=Ni.clipToGLWindowCoordinates(t.viewport,C,sAt);return this._size=H.magnitude(H.subtract(S,T,SP)),this._size=2*this._size*(1+2*this._glowLengthTS),this._size=Math.ceil(this._size),this._commands};wP.prototype.isDestroyed=function(){return!1};wP.prototype.destroy=function(){let e=this._drawCommand;return e.vertexArray=e.vertexArray&&e.vertexArray.destroy(),e.shaderProgram=e.shaderProgram&&e.shaderProgram.destroy(),this._texture=this._texture&&this._texture.destroy(),de(this)};var TK=wP;function XC(e){A.typeOf.object("terrainProviderPromise",e),this._ready=!1,this._provider=void 0,this._errorEvent=new pe,this._readyEvent=new pe,lAt(this,e)}Object.defineProperties(XC.prototype,{errorEvent:{get:function(){return this._errorEvent}},readyEvent:{get:function(){return this._readyEvent}},ready:{get:function(){return this._ready}},provider:{get:function(){return this._provider}}});XC.fromWorldTerrain=function(e){return new XC(sC(e))};XC.fromWorldBathymetry=function(e){return new XC(sW(e))};function cAt(e,t){e.numberOfListeners>0?e.raiseEvent(t):console.error(t)}async function lAt(e,t){let n;try{n=await Promise.resolve(t),e._provider=n,e._ready=!0,e._readyEvent.raiseEvent(n)}catch(i){cAt(e._errorEvent,i)}}var CF=XC;function KC(){}KC.prototype.boundingVolume=void 0;KC.prototype.boundingSphere=void 0;KC.prototype.distanceToCamera=function(e){E.throwInstantiationError()};KC.prototype.intersectPlane=function(e){E.throwInstantiationError()};KC.prototype.createDebugVolume=function(e){E.throwInstantiationError()};var uAt=KC;function vP(e){e=y(e,y.EMPTY_OBJECT),this._tilingScheme=c(e.tilingScheme)?e.tilingScheme:new $i({ellipsoid:e.ellipsoid}),this._color=y(e.color,j.YELLOW),this._errorEvent=new pe,this._tileWidth=y(e.tileWidth,256),this._tileHeight=y(e.tileHeight,256),this._defaultAlpha=void 0,this._defaultNightAlpha=void 0,this._defaultDayAlpha=void 0,this._defaultBrightness=void 0,this._defaultContrast=void 0,this._defaultHue=void 0,this._defaultSaturation=void 0,this._defaultGamma=void 0,this._defaultMinificationFilter=void 0,this._defaultMagnificationFilter=void 0}Object.defineProperties(vP.prototype,{proxy:{get:function(){}},tileWidth:{get:function(){return this._tileWidth}},tileHeight:{get:function(){return this._tileHeight}},maximumLevel:{get:function(){}},minimumLevel:{get:function(){}},tilingScheme:{get:function(){return this._tilingScheme}},rectangle:{get:function(){return this._tilingScheme.rectangle}},tileDiscardPolicy:{get:function(){}},errorEvent:{get:function(){return this._errorEvent}},credit:{get:function(){}},hasAlphaChannel:{get:function(){return!0}}});vP.prototype.getTileCredits=function(e,t,n){};vP.prototype.requestImage=function(e,t,n,i){let o=document.createElement("canvas");o.width=256,o.height=256;let r=o.getContext("2d"),s=this._color.toCssColorString();return r.strokeStyle=s,r.lineWidth=2,r.strokeRect(1,1,255,255),r.font="bold 25px Arial",r.textAlign="center",r.fillStyle=s,r.fillText(`L: ${n}`,124,86),r.fillText(`X: ${e}`,124,136),r.fillText(`Y: ${t}`,124,186),Promise.resolve(o)};vP.prototype.pickFeatures=function(e,t,n,i,o){};var EF=vP;function AK(e){E.throwInstantiationError()}AK.prototype.isReady=E.throwInstantiationError;AK.prototype.shouldDiscardImage=E.throwInstantiationError;var fAt=AK;var dAt={START:0,LOADING:1,READY:2,UPSAMPLED_ONLY:3},hAt=Object.freeze(dAt);function mx(e){e=y(e,y.EMPTY_OBJECT),A.typeOf.object("options.clock",e.clock),A.typeOf.object("options.intervals",e.intervals),this.show=y(e.show,!0),this.modelMatrix=k.clone(y(e.modelMatrix,k.IDENTITY)),this.shadows=y(e.shadows,En.ENABLED),this.maximumMemoryUsage=y(e.maximumMemoryUsage,256),this.shading=new Z_(e.shading),this.style=e.style,this.frameFailed=new pe,this.frameChanged=new pe,this._clock=e.clock,this._intervals=e.intervals,this._clippingPlanes=void 0,this.clippingPlanes=e.clippingPlanes,this._pointCloudEyeDomeLighting=new w0,this._loadTimestamp=void 0,this._clippingPlanesState=0,this._styleDirty=!1,this._pickId=void 0,this._totalMemoryUsageInBytes=0,this._frames=[],this._previousInterval=void 0,this._nextInterval=void 0,this._lastRenderedFrame=void 0,this._clockMultiplier=0,this._runningSum=0,this._runningLength=0,this._runningIndex=0,this._runningSamples=new Array(5).fill(0),this._runningAverage=0}Object.defineProperties(mx.prototype,{clippingPlanes:{get:function(){return this._clippingPlanes},set:function(e){Ms.setOwner(e,this,"_clippingPlanes")}},totalMemoryUsageInBytes:{get:function(){return this._totalMemoryUsageInBytes}},boundingSphere:{get:function(){if(c(this._lastRenderedFrame))return this._lastRenderedFrame.pointCloud.boundingSphere}}});function mAt(e){return`uniform vec4 czm_pickColor;
${e}`}function pAt(e){return function(t){return At(t,{czm_pickColor:function(){return e._pickId.color}})}}function _At(){return"czm_pickColor"}mx.prototype.makeStyleDirty=function(){this._styleDirty=!0};mx.prototype._getAverageLoadTime=function(){return this._runningLength===0?.05:this._runningAverage};var gAt=new J;function EK(e){let t=e._clock,n=t.canAnimate&&t.shouldAnimate,i=t.multiplier;return n?i:0}function hx(e,t){return e._intervals.indexOf(t.start)}function yAt(e,t){let n=e._intervals,i=e._clock,o=EK(e);if(o===0)return;let r=e._getAverageLoadTime(),s=J.addSeconds(i.currentTime,r*o,gAt),a=n.indexOf(s),l=hx(e,t);return a===l&&(o>=0?++a:--a),n.get(a)}function bAt(e){let t=e._intervals,i=e._clock.currentTime,o=t.indexOf(i);return t.get(o)}function xAt(e,t,n){let i=EK(e),o=hx(e,t),r=hx(e,n);return i>=0?o>=r:o<=r}function hTe(e,t){return function(n){let i=c(n.message)?n.message:n.toString();e.frameFailed.numberOfListeners>0?e.frameFailed.raiseEvent({uri:t,message:i}):(console.log(`A frame failed to load: ${t}`),console.log(`Error: ${i}`))}}function TAt(e,t,n){let i=hx(e,t),o=e._frames,r=o[i];if(!c(r)){let s=t.data.transform,a=c(s)?k.fromArray(s):void 0,l=t.data.uri;r={pointCloud:void 0,transform:a,timestamp:Ei(),sequential:!0,ready:!1,touchedFrameNumber:n.frameNumber,uri:l},o[i]=r,De.fetchArrayBuffer({url:l}).then(function(u){r.pointCloud=new rX({arrayBuffer:u,cull:!0,fragmentShaderLoaded:mAt,uniformMapLoaded:pAt(e),pickIdLoaded:_At})}).catch(hTe(e,l))}return r}function AAt(e,t){e._runningSum+=t,e._runningSum-=e._runningSamples[e._runningIndex],e._runningSamples[e._runningIndex]=t,e._runningLength=Math.min(e._runningLength+1,e._runningSamples.length),e._runningIndex=(e._runningIndex+1)%e._runningSamples.length,e._runningAverage=e._runningSum/e._runningLength}function CAt(e,t,n,i){t.touchedFrameNumber<i.frameNumber-1&&(t.sequential=!1);let o=t.pointCloud;if(c(o)&&!t.ready){let r=i.commandList,s=r.length;if(mTe(e,t,n,i),o.ready&&(t.ready=!0,e._totalMemoryUsageInBytes+=o.geometryByteLength,r.length=s,t.sequential)){let a=(Ei()-t.timestamp)/1e3;AAt(e,a)}}t.touchedFrameNumber=i.frameNumber}var EAt=new k;function SAt(e,t){let n=e.shading;return c(n)&&c(n.baseResolution)?n.baseResolution:c(t.boundingSphere)?R.cbrt(t.boundingSphere.volume()/t.pointsLength):0}function wAt(e){let t=e.shading;return c(t)&&c(t.maximumAttenuation)?t.maximumAttenuation:10}var vAt=new Z_;function mTe(e,t,n,i){let o=y(e.shading,vAt),r=t.pointCloud,s=y(t.transform,k.IDENTITY);r.modelMatrix=k.multiplyTransformation(e.modelMatrix,s,EAt),r.style=e.style,r.time=n.timeSinceLoad,r.shadows=e.shadows,r.clippingPlanes=e._clippingPlanes,r.isClipped=n.isClipped,r.attenuation=o.attenuation,r.backFaceCulling=o.backFaceCulling,r.normalShading=o.normalShading,r.geometricError=SAt(e,r),r.geometricErrorScale=o.geometricErrorScale,r.maximumAttenuation=wAt(e);try{r.update(i)}catch(a){hTe(e,t.uri)(a)}t.touchedFrameNumber=i.frameNumber}function CK(e,t,n,i){let o=TAt(e,t,i);CAt(e,o,n,i)}function DAt(e){return function(t){return t.touchedFrameNumber<e.frameNumber}}function pTe(e,t){let n=e._frames,i=n.length;for(let o=0;o<i;++o){let r=n[o];if(c(r)&&(!c(t)||t(r))){let s=r.pointCloud;r.ready&&(e._totalMemoryUsageInBytes-=s.geometryByteLength),c(s)&&s.destroy(),r===e._lastRenderedFrame&&(e._lastRenderedFrame=void 0),n[o]=void 0}}}function PAt(e,t){let n=hx(e,t),i=e._frames[n];if(c(i)&&i.ready)return i}function dTe(e,t,n,i,o){return c(n)?n.ready?!0:(CK(e,t,i,o),n.ready):!1}function IAt(e,t,n,i,o){let r,s,a,l=e._intervals,u=e._frames,f=hx(e,n),d=hx(e,t);if(f>=d){for(r=f;r>=d;--r)if(s=l.get(r),a=u[r],dTe(e,s,a,i,o))return s}else for(r=f;r<=d;++r)if(s=l.get(r),a=u[r],dTe(e,s,a,i,o))return s;return t}function OAt(e,t,n){let i=e._frames,o=i.length;for(let r=0;r<o;++r){let s=i[r];c(s)&&c(s.pointCloud)&&(s.pointCloud.clippingPlanesDirty=t,s.pointCloud.styleDirty=n)}}var $C={timeSinceLoad:0,isClipped:!1,clippingPlanesDirty:!1};mx.prototype.update=function(e){if(e.mode===oe.MORPHING||!this.show)return;c(this._pickId)||(this._pickId=e.context.createPickId({primitive:this})),c(this._loadTimestamp)||(this._loadTimestamp=J.clone(e.time));let t=Math.max(J.secondsDifference(e.time,this._loadTimestamp)*1e3,0),n=this._clippingPlanes,i=0,o=!1,r=c(n)&&n.enabled;r&&(n.update(e),i=n.clippingPlanesState),this._clippingPlanesState!==i&&(this._clippingPlanesState=i,o=!0);let s=this._styleDirty;this._styleDirty=!1,(o||s)&&OAt(this,o,s),$C.timeSinceLoad=t,$C.isClipped=r;let a=this.shading,l=this._pointCloudEyeDomeLighting,u=e.commandList,f=u.length,d=this._previousInterval,p=this._nextInterval,g=bAt(this);if(!c(g))return;let m=!1,b=EK(this),x=b===0;b!==this._clockMultiplier&&(m=!0,this._clockMultiplier=b),(!c(d)||x)&&(d=g),(!c(p)||m||xAt(this,g,p))&&(p=yAt(this,g)),d=IAt(this,d,g,$C,e);let T=PAt(this,d);c(T)||(CK(this,d,$C,e),T=this._lastRenderedFrame),c(T)&&mTe(this,T,$C,e),c(p)&&CK(this,p,$C,e);let C=this;c(T)&&!c(this._lastRenderedFrame)&&e.afterRender.push(function(){return!0}),c(T)&&T!==this._lastRenderedFrame&&C.frameChanged.numberOfListeners>0&&e.afterRender.push(function(){return C.frameChanged.raiseEvent(C),!0}),this._previousInterval=d,this._nextInterval=p,this._lastRenderedFrame=T;let S=this._totalMemoryUsageInBytes,v=this.maximumMemoryUsage*1024*1024;S>v&&pTe(this,DAt(e));let I=u.length-f;c(a)&&a.attenuation&&a.eyeDomeLighting&&I>0&&l.update(e,f,a,this.boundingSphere)};mx.prototype.isDestroyed=function(){return!1};mx.prototype.destroy=function(){return pTe(this),this._clippingPlanes=this._clippingPlanes&&this._clippingPlanes.destroy(),this._pickId=this._pickId&&this._pickId.destroy(),de(this)};var SF=mx;var SK=`in vec2 v_textureCoordinates;
void main()
{
czm_materialInput materialInput;
materialInput.s = v_textureCoordinates.s;
materialInput.st = v_textureCoordinates;
materialInput.str = vec3(v_textureCoordinates, 0.0);
materialInput.normalEC = vec3(0.0, 0.0, -1.0);
czm_material material = czm_getMaterial(materialInput);
out_FragColor = vec4(material.diffuse + material.emission, material.alpha);
}
`;function wF(e,t){this.show=!0,c(e)||(e=new Ke),this.rectangle=Ke.clone(e),c(t)||(t=Ki.fromType(Ki.ColorType,{color:new j(1,1,1,1)})),this.material=t,this._material=void 0,this._overlayCommand=void 0,this._rs=void 0}wF.prototype.update=function(e){if(!this.show)return;if(!c(this.material))throw new E("this.material must be defined.");if(!c(this.rectangle))throw new E("this.rectangle must be defined.");let t=this._rs;if((!c(t)||!Ke.equals(t.viewport,this.rectangle))&&(this._rs=ze.fromCache({blending:hn.ALPHA_BLEND,viewport:this.rectangle})),e.passes.render){let i=e.context;if(this._material!==this.material||!c(this._overlayCommand)){this._material=this.material,c(this._overlayCommand)&&this._overlayCommand.shaderProgram.destroy();let o=new Ge({sources:[this._material.shaderSource,SK]});this._overlayCommand=i.createViewportQuadCommand(o,{renderState:this._rs,uniformMap:this._material._uniforms,owner:this}),this._overlayCommand.pass=ve.OVERLAY}this._material.update(i),this._overlayCommand.renderState=this._rs,this._overlayCommand.uniformMap=this._material._uniforms,e.commandList.push(this._overlayCommand)}};wF.prototype.isDestroyed=function(){return!1};wF.prototype.destroy=function(){return c(this._overlayCommand)&&(this._overlayCommand.shaderProgram=this._overlayCommand.shaderProgram&&this._overlayCommand.shaderProgram.destroy()),de(this)};var RAt=wF;function wK(){E.throwInstantiationError()}Object.defineProperties(wK.prototype,{globalTransform:{get:E.throwInstantiationError},shapeTransform:{get:E.throwInstantiationError},shape:{get:E.throwInstantiationError},minBounds:{get:E.throwInstantiationError},maxBounds:{get:E.throwInstantiationError},dimensions:{get:E.throwInstantiationError},paddingBefore:{get:E.throwInstantiationError},paddingAfter:{get:E.throwInstantiationError},names:{get:E.throwInstantiationError},types:{get:E.throwInstantiationError},componentTypes:{get:E.throwInstantiationError},minimumValues:{get:E.throwInstantiationError},maximumValues:{get:E.throwInstantiationError},maximumTileCount:{get:E.throwInstantiationError},keyframeCount:{get:E.throwInstantiationError},timeIntervalCollection:{get:E.throwInstantiationError}});wK.prototype.requestData=E.throwInstantiationError;var MAt=wK;function px(){E.throwInstantiationError()}Object.defineProperties(px.prototype,{orientedBoundingBox:{get:E.throwInstantiationError},boundingSphere:{get:E.throwInstantiationError},boundTransform:{get:E.throwInstantiationError},shapeTransform:{get:E.throwInstantiationError},shaderUniforms:{get:E.throwInstantiationError},shaderDefines:{get:E.throwInstantiationError},shaderMaximumIntersectionsLength:{get:E.throwInstantiationError}});px.prototype.update=E.throwInstantiationError;px.prototype.computeOrientedBoundingBoxForTile=E.throwInstantiationError;px.prototype.computeOrientedBoundingBoxForSample=E.throwInstantiationError;px.DefaultMinBounds=E.throwInstantiationError;px.DefaultMaxBounds=E.throwInstantiationError;var LAt=px;function _Te(e,t){if(c(t)){let n=t.clock;c(n)&&n.getValue(e)}}function NAt(e){e._renderLoopRunning=!0;let t=0;function n(i){if(!e.isDestroyed())if(e._useDefaultRenderLoop)try{let o=e._targetFrameRate;if(!c(o))e.resize(),e.render(),requestAnimationFrame(n);else{let r=1e3/o,s=i-t;s>r&&(e.resize(),e.render(),t=i-s%r),requestAnimationFrame(n)}}catch(o){e._useDefaultRenderLoop=!1,e._renderLoopRunning=!1,e._showRenderLoopErrors&&e.showErrorPanel("An error occurred while rendering.  Rendering has stopped.",void 0,o)}else e._renderLoopRunning=!1}requestAnimationFrame(n)}function gTe(e){let t=e._useBrowserRecommendedResolution?1:window.devicePixelRatio;return t*=e._resolutionScale,c(e._scene)&&(e._scene.pixelRatio=t),t}function yTe(e){let t=e._canvas,n=t.clientWidth,i=t.clientHeight,o=gTe(e);e._canvasClientWidth=n,e._canvasClientHeight=i,n*=o,i*=o,t.width=n,t.height=i,e._canRender=n!==0&&i!==0,e._lastDevicePixelRatio=window.devicePixelRatio}function bTe(e){let t=e._canvas,n=t.width,i=t.height;if(n!==0&&i!==0){let o=e._scene.camera.frustum;c(o.aspectRatio)?o.aspectRatio=n/i:(o.top=o.right*(i/n),o.bottom=-o.top)}}function xo(e,t){if(!c(e))throw new E("container is required.");e=On(e),t=y(t,y.EMPTY_OBJECT);let n=document.createElement("div");n.className="cesium-widget",e.appendChild(n);let i=document.createElement("canvas"),o=zt.supportsImageRenderingPixelated();this._supportsImageRenderingPixelated=o,o&&(i.style.imageRendering=zt.imageRenderingValue()),i.oncontextmenu=function(){return!1},i.onselectstart=function(){return!1};function r(){i!==i.ownerDocument.activeElement&&i.ownerDocument.activeElement.blur()}y(t.blurActiveElementOnCanvasFocus,!0)&&(i.addEventListener("mousedown",r),i.addEventListener("pointerdown",r)),n.appendChild(i);let a=document.createElement("div");a.className="cesium-widget-credits";let l=c(t.creditContainer)?On(t.creditContainer):n;l.appendChild(a);let u=c(t.creditViewport)?On(t.creditViewport):n,f=y(t.showRenderLoopErrors,!0),d=y(t.useBrowserRecommendedResolution,!0);this._element=n,this._container=e,this._canvas=i,this._canvasClientWidth=0,this._canvasClientHeight=0,this._lastDevicePixelRatio=0,this._creditViewport=u,this._creditContainer=l,this._innerCreditContainer=a,this._canRender=!1,this._renderLoopRunning=!1,this._showRenderLoopErrors=f,this._resolutionScale=1,this._useBrowserRecommendedResolution=d,this._forceResize=!1,this._entityView=void 0,this._clockTrackedDataSource=void 0,this._trackedEntity=void 0,this._needTrackedEntityUpdate=!1,this._zoomIsFlight=!1,this._zoomTarget=void 0,this._zoomPromise=void 0,this._zoomOptions=void 0,this._trackedEntityChanged=new pe,this._allowDataSourcesToSuspendAnimation=!0,this._clock=c(t.clock)?t.clock:new Oh,c(t.shouldAnimate)&&(this._clock.shouldAnimate=t.shouldAnimate),yTe(this);try{let p=y(t.ellipsoid,ie.default),g=new lK({canvas:i,contextOptions:t.contextOptions,creditContainer:a,creditViewport:u,ellipsoid:p,mapProjection:t.mapProjection,orderIndependentTranslucency:t.orderIndependentTranslucency,scene3DOnly:y(t.scene3DOnly,!1),shadows:t.shadows,mapMode2D:t.mapMode2D,requestRenderMode:t.requestRenderMode,maximumRenderTimeChange:t.maximumRenderTimeChange,depthPlaneEllipsoidOffset:t.depthPlaneEllipsoidOffset,msaaSamples:t.msaaSamples});this._scene=g,g.camera.constrainedAxis=h.UNIT_Z,gTe(this),bTe(this);let m=t.globe;c(m)||(m=new dY(p)),m!==!1&&(g.globe=m,g.globe.shadows=y(t.terrainShadows,En.RECEIVE_ONLY));let b=t.skyBox;!c(b)&&ie.WGS84.equals(p)&&(b=_K.createEarthSkyBox()),b!==!1&&(g.skyBox=b,g.sun=new TK,ie.WGS84.equals(p)&&(g.moon=new OY));let x=t.skyAtmosphere;!c(x)&&ie.WGS84.equals(p)&&(x=new hK(p),x.show=t.globe!==!1&&m.show),x!==!1&&(g.skyAtmosphere=x);let T=t.baseLayer;if(t.globe!==!1&&T!==!1&&(c(T)||(T=oc.fromWorldImagery()),g.imageryLayers.add(T)),c(t.terrainProvider)&&t.globe!==!1&&(g.terrainProvider=t.terrainProvider),c(t.terrain)&&t.globe!==!1){if(c(t.terrainProvider))throw new E("Specify either options.terrainProvider or options.terrain.");g.setTerrain(t.terrain)}this._screenSpaceEventHandler=new Af(i),c(t.sceneMode)&&(t.sceneMode===oe.SCENE2D&&this._scene.morphTo2D(0),t.sceneMode===oe.COLUMBUS_VIEW&&this._scene.morphToColumbusView(0)),this._useDefaultRenderLoop=void 0,this.useDefaultRenderLoop=y(t.useDefaultRenderLoop,!0),this._targetFrameRate=void 0,this.targetFrameRate=t.targetFrameRate;let C=this;this._onRenderError=function(M,N){C._useDefaultRenderLoop=!1,C._renderLoopRunning=!1,C._showRenderLoopErrors&&C.showErrorPanel("An error occurred while rendering.  Rendering has stopped.",void 0,N)},g.renderError.addEventListener(this._onRenderError);let S=t.dataSources,v=!1;c(S)||(S=new n6,v=!0);let D=new K6({scene:g,dataSourceCollection:S}),I=new yr;this._dataSourceChangedListeners={},this._automaticallyTrackDataSourceClocks=t.automaticallyTrackDataSourceClocks??!0,this._dataSourceCollection=S,this._destroyDataSourceCollection=v,this._dataSourceDisplay=D,this._eventHelper=I,this._canAnimateUpdateCallback=this._updateCanAnimate,I.add(this._clock.onTick,xo.prototype._onTick,this),I.add(g.morphStart,xo.prototype._clearTrackedObject,this),I.add(S.dataSourceAdded,xo.prototype._onDataSourceAdded,this),I.add(S.dataSourceRemoved,xo.prototype._onDataSourceRemoved,this),I.add(g.postRender,xo.prototype._postRender,this);let L=S.length;for(let M=0;M<L;M++)this._dataSourceAdded(S,S.get(M));this._dataSourceAdded(void 0,D.defaultDataSource),I.add(S.dataSourceAdded,xo.prototype._dataSourceAdded,this),I.add(S.dataSourceRemoved,xo.prototype._dataSourceRemoved,this)}catch(p){throw f&&this.showErrorPanel("Error constructing CesiumWidget.",'Visit <a href="http://get.webgl.org">http://get.webgl.org</a> to verify that your web browser and hardware support WebGL.  Consider trying a different web browser or updating your video drivers.  Detailed error information is below:',p),p}}Object.defineProperties(xo.prototype,{container:{get:function(){return this._container}},canvas:{get:function(){return this._canvas}},creditContainer:{get:function(){return this._creditContainer}},creditViewport:{get:function(){return this._creditViewport}},scene:{get:function(){return this._scene}},imageryLayers:{get:function(){return this._scene.imageryLayers}},terrainProvider:{get:function(){return this._scene.terrainProvider},set:function(e){this._scene.terrainProvider=e}},creditDisplay:{get:function(){return this._scene.frameState.creditDisplay}},dataSourceDisplay:{get:function(){return this._dataSourceDisplay}},entities:{get:function(){return this._dataSourceDisplay.defaultDataSource.entities}},dataSources:{get:function(){return this._dataSourceCollection}},camera:{get:function(){return this._scene.camera}},ellipsoid:{get:function(){return this._scene.ellipsoid}},clock:{get:function(){return this._clock}},screenSpaceEventHandler:{get:function(){return this._screenSpaceEventHandler}},targetFrameRate:{get:function(){return this._targetFrameRate},set:function(e){if(e<=0)throw new E("targetFrameRate must be greater than 0, or undefined.");this._targetFrameRate=e}},useDefaultRenderLoop:{get:function(){return this._useDefaultRenderLoop},set:function(e){this._useDefaultRenderLoop!==e&&(this._useDefaultRenderLoop=e,e&&!this._renderLoopRunning&&NAt(this))}},resolutionScale:{get:function(){return this._resolutionScale},set:function(e){if(e<=0)throw new E("resolutionScale must be greater than 0.");this._resolutionScale!==e&&(this._resolutionScale=e,this._forceResize=!0)}},useBrowserRecommendedResolution:{get:function(){return this._useBrowserRecommendedResolution},set:function(e){this._useBrowserRecommendedResolution!==e&&(this._useBrowserRecommendedResolution=e,this._forceResize=!0)}},allowDataSourcesToSuspendAnimation:{get:function(){return this._allowDataSourcesToSuspendAnimation},set:function(e){this._allowDataSourcesToSuspendAnimation=e}},trackedEntity:{get:function(){return this._trackedEntity},set:function(e){if(this._trackedEntity!==e){this._trackedEntity=e,vK(this);let t=this.scene,n=t.mode;!c(e)||!c(e.position)?(this._needTrackedEntityUpdate=!1,(n===oe.COLUMBUS_VIEW||n===oe.SCENE2D)&&(t.screenSpaceCameraController.enableTranslate=!0),(n===oe.COLUMBUS_VIEW||n===oe.SCENE3D)&&(t.screenSpaceCameraController.enableTilt=!0),this._entityView=void 0,this.camera.lookAtTransform(k.IDENTITY)):this._needTrackedEntityUpdate=!0,this._trackedEntityChanged.raiseEvent(e),this.scene.requestRender()}}},trackedEntityChanged:{get:function(){return this._trackedEntityChanged}},clockTrackedDataSource:{get:function(){return this._clockTrackedDataSource},set:function(e){this._clockTrackedDataSource!==e&&(this._clockTrackedDataSource=e,_Te(this.clock,e))}}});xo.prototype.showErrorPanel=function(e,t,n){let i=this._element,o=document.createElement("div");o.className="cesium-widget-errorPanel";let r=document.createElement("div");r.className="cesium-widget-errorPanel-content",o.appendChild(r);let s=document.createElement("div");s.className="cesium-widget-errorPanel-header",s.appendChild(document.createTextNode(e)),r.appendChild(s);let a=document.createElement("div");a.className="cesium-widget-errorPanel-scroll",r.appendChild(a);function l(){a.style.maxHeight=`${Math.max(Math.round(i.clientHeight*.9-100),30)}px`}l(),c(window.addEventListener)&&window.addEventListener("resize",l,!1);let u=c(t),f=c(n);if(u||f){let g=document.createElement("div");if(g.className="cesium-widget-errorPanel-message",a.appendChild(g),f){let m=Kg(n);u||(typeof n=="string"&&(n=new Error(n)),t=Kg({name:n.name,message:n.message}),m=n.stack),typeof console<"u"&&console.error(`${e}
${t}
${m}`);let b=document.createElement("div");b.className="cesium-widget-errorPanel-message-details collapsed";let x=document.createElement("span");x.className="cesium-widget-errorPanel-more-details",x.appendChild(document.createTextNode("See more...")),b.appendChild(x),b.onclick=function(T){b.removeChild(x),b.appendChild(document.createTextNode(m)),b.className="cesium-widget-errorPanel-message-details",r.className="cesium-widget-errorPanel-content expanded",b.onclick=void 0},a.appendChild(b)}g.innerHTML=`<p>${t}</p>`}let d=document.createElement("div");d.className="cesium-widget-errorPanel-buttonPanel",r.appendChild(d);let p=document.createElement("button");p.setAttribute("type","button"),p.className="cesium-button",p.appendChild(document.createTextNode("OK")),p.onclick=function(){c(l)&&c(window.removeEventListener)&&window.removeEventListener("resize",l,!1),i.removeChild(o)},d.appendChild(p),i.appendChild(o)};xo.prototype.isDestroyed=function(){return!1};xo.prototype.destroy=function(){let e=this.dataSources,t=e.length;for(let n=0;n<t;n++)this._dataSourceRemoved(e,e.get(n));this._dataSourceRemoved(void 0,this._dataSourceDisplay.defaultDataSource),this._dataSourceDisplay=this._dataSourceDisplay.destroy(),c(this._scene)&&(this._scene.renderError.removeEventListener(this._onRenderError),this._scene=this._scene.destroy()),this._container.removeChild(this._element),this._creditContainer.removeChild(this._innerCreditContainer),this._eventHelper.removeAll(),this._destroyDataSourceCollection&&(this._dataSourceCollection=this._dataSourceCollection.destroy()),de(this)};xo.prototype.resize=function(){let e=this._canvas;!this._forceResize&&this._canvasClientWidth===e.clientWidth&&this._canvasClientHeight===e.clientHeight&&this._lastDevicePixelRatio===window.devicePixelRatio||(this._forceResize=!1,yTe(this),bTe(this),this._scene.requestRender())};xo.prototype.render=function(){if(this._canRender){this._scene.initializeFrame();let e=this._clock.tick();this._scene.render(e)}else this._clock.tick()};xo.prototype._dataSourceAdded=function(e,t){t.entities.collectionChanged.addEventListener(xo.prototype._onEntityCollectionChanged,this)};xo.prototype._dataSourceRemoved=function(e,t){let n=t.entities;n.collectionChanged.removeEventListener(xo.prototype._onEntityCollectionChanged,this),c(this.trackedEntity)&&n.getById(this.trackedEntity.id)===this.trackedEntity&&(this.trackedEntity=void 0)};xo.prototype._updateCanAnimate=function(e){this._clock.canAnimate=e};var ZC=new ce;xo.prototype._onTick=function(e){let t=e.currentTime,n=this._dataSourceDisplay.update(t);this._allowDataSourcesToSuspendAnimation&&this._canAnimateUpdateCallback(n);let i=this._entityView;if(c(i)){let o=this._trackedEntity;this._dataSourceDisplay.getBoundingSphere(o,!0,ZC)===ct.DONE&&i.update(t,ZC)}};xo.prototype._onEntityCollectionChanged=function(e,t,n){let i=n.length;for(let o=0;o<i;o++){let r=n[o];this.trackedEntity===r&&(this.trackedEntity=void 0)}};xo.prototype._clearTrackedObject=function(){this.trackedEntity=void 0};xo.prototype._onDataSourceChanged=function(e){this.clockTrackedDataSource===e&&_Te(this.clock,e)};xo.prototype._onDataSourceAdded=function(e,t){this._automaticallyTrackDataSourceClocks&&(this.clockTrackedDataSource=t);let n=t.entities.id,i=this._eventHelper.add(t.changedEvent,xo.prototype._onDataSourceChanged,this);this._dataSourceChangedListeners[n]=i};xo.prototype._onDataSourceRemoved=function(e,t){let n=this.clockTrackedDataSource===t,i=t.entities.id;if(this._dataSourceChangedListeners[i](),this._dataSourceChangedListeners[i]=void 0,n){let o=e.length;this._automaticallyTrackDataSourceClocks&&o>0?this.clockTrackedDataSource=e.get(o-1):this.clockTrackedDataSource=void 0}};xo.prototype.zoomTo=function(e,t){return xTe(this,e,{offset:t},!1)};xo.prototype.flyTo=function(e,t){return xTe(this,e,t,!0)};function xTe(e,t,n,i){if(!c(t))throw new E("zoomTarget is required.");vK(e);let o=new Promise(r=>{e._completeZoom=function(s){r(s)}});return e._zoomPromise=o,e._zoomIsFlight=i,e._zoomOptions=n,Promise.resolve(t).then(function(r){if(e._zoomPromise===o){if(r instanceof oc){let s;c(r.imageryProvider)?s=Promise.resolve(r.getImageryRectangle()):s=new Promise(a=>{let l=r.readyEvent.addEventListener(()=>{l(),a(r.getImageryRectangle())})}),s.then(function(a){return AC(a,e.scene)}).then(function(a){e._zoomPromise===o&&(e._zoomTarget=a)});return}if(r instanceof pa||r instanceof SF||r instanceof jC){e._zoomTarget=r;return}if(r.isLoading&&c(r.loadingEvent)){let s=r.loadingEvent.addEventListener(function(){s(),e._zoomPromise===o&&(e._zoomTarget=r.entities.values.slice(0))});return}if(Array.isArray(r)){e._zoomTarget=r.slice(0);return}r=r.values??r,c(r.entities)&&(r=r.entities.values),Array.isArray(r)?e._zoomTarget=r.slice(0):e._zoomTarget=[r]}}),e.scene.requestRender(),o}function DP(e){e._zoomPromise=void 0,e._zoomTarget=void 0,e._zoomOptions=void 0}function vK(e){let t=e._zoomPromise;c(t)&&(DP(e),e._completeZoom(!1))}xo.prototype._postRender=function(){FAt(this),BAt(this)};function FAt(e){let t=e._zoomTarget;if(!c(t)||e.scene.mode===oe.MORPHING)return;let n=e.scene,i=n.camera,o=e._zoomOptions??{},r;function s(f){c(o.offset)||(o.offset=new zh(0,-.5,f.radius)),r={offset:o.offset,duration:o.duration,maximumHeight:o.maximumHeight,complete:function(){e._completeZoom(!0)},cancel:function(){e._completeZoom(!1)}},e._zoomIsFlight?i.flyToBoundingSphere(t.boundingSphere,r):(i.viewBoundingSphere(f,o.offset),i.lookAtTransform(k.IDENTITY),e._completeZoom(!0)),DP(e)}if(t instanceof SF){if(c(t.boundingSphere)){s(t.boundingSphere);return}let f=t.frameChanged.addEventListener(function(d){s(d.boundingSphere),f()});return}if(t instanceof pa||t instanceof jC){s(t.boundingSphere);return}if(t instanceof he){r={destination:n.ellipsoid.cartographicToCartesian(t),duration:o.duration,maximumHeight:o.maximumHeight,complete:function(){e._completeZoom(!0)},cancel:function(){e._completeZoom(!1)}},e._zoomIsFlight?i.flyTo(r):(i.setView(r),e._completeZoom(!0)),DP(e);return}let a=t,l=[];for(let f=0,d=a.length;f<d;f++){let p=e._dataSourceDisplay.getBoundingSphere(a[f],!1,ZC);if(p===ct.PENDING)return;p!==ct.FAILED&&l.push(ce.clone(ZC))}if(l.length===0){vK(e);return}e.trackedEntity=void 0;let u=ce.fromBoundingSpheres(l);e._zoomIsFlight?(DP(e),i.flyToBoundingSphere(u,{duration:o.duration,maximumHeight:o.maximumHeight,complete:function(){e._completeZoom(!0)},cancel:function(){e._completeZoom(!1)},offset:o.offset})):(i.viewBoundingSphere(u,o.offset),i.lookAtTransform(k.IDENTITY),DP(e),e._completeZoom(!0))}function BAt(e){if(!e._needTrackedEntityUpdate)return;let t=e._trackedEntity,n=e.clock.currentTime,i=X.getValueOrUndefined(t.position,n);if(!c(i))return;let o=e.scene,r=e._dataSourceDisplay.getBoundingSphere(t,!1,ZC);if(r===ct.PENDING)return;let s=o.mode;(s===oe.COLUMBUS_VIEW||s===oe.SCENE2D)&&(o.screenSpaceCameraController.enableTranslate=!1),(s===oe.COLUMBUS_VIEW||s===oe.SCENE3D)&&(o.screenSpaceCameraController.enableTilt=!1);let a=r!==ct.FAILED?ZC:void 0;e._entityView=new Q6(t,o,o.ellipsoid),e._entityView.update(n,a),e._needTrackedEntityUpdate=!1}var vF=xo;function kAt(e){e=y(e,y.EMPTY_OBJECT);let t=c(e.typedArray),n=c(e.url);if(t===n)throw new E("exactly one of options.typedArray, options.url must be defined");if(t&&(!c(e.width)||!c(e.height)))throw new E("options.width and options.height are required when options.typedArray is defined");this.typedArray=e.typedArray,this.width=e.width,this.height=e.height,this.pixelFormat=y(e.pixelFormat,Ve.RGBA),this.pixelDatatype=y(e.pixelDatatype,Be.UNSIGNED_BYTE);let i=e.url;typeof i=="string"&&(i=De.createIfNeeded(i)),this.resource=i;let r=y(e.repeat,!0)?yn.REPEAT:yn.CLAMP_TO_EDGE;this.sampler=new Qt({wrapS:r,wrapT:r,minificationFilter:e.minificationFilter,magnificationFilter:e.magnificationFilter,maximumAnisotropy:e.maximumAnisotropy})}var VAt=kAt;var UAt={FLOAT:"float",VEC2:"vec2",VEC3:"vec3",VEC4:"vec4",MAT2:"mat2",MAT3:"mat2",MAT4:"mat4"},zAt=Object.freeze(UAt);var HAt=`uniform sampler2D u_depthTexture;
in vec2 v_textureCoordinates;
void main()
{
float z_window = czm_unpackDepth(texture(u_depthTexture, v_textureCoordinates));
z_window = czm_reverseLogDepth(z_window);
float n_range = czm_depthRange.near;
float f_range = czm_depthRange.far;
float z_ndc = (2.0 * z_window - n_range - f_range) / (f_range - n_range);
float scale = pow(z_ndc * 0.5 + 0.5, 8.0);
out_FragColor = vec4(mix(vec3(0.0), vec3(1.0), scale), 1.0);
}
`;var GAt={SIGX:"SIGX",SIGY:"SIGY",SIGZ:"SIGZ",VARX:"VARX",VARY:"VARY",VARZ:"VARZ",SIGR:"VARZ"},jAt=Object.freeze(GAt);function WAt(e){async function t({data:i}){let o=[],r={id:i.id,result:void 0,error:void 0};self.CESIUM_BASE_URL=i.baseUrl;try{let s=await e(i.parameters,o);r.result=s}catch(s){s instanceof Error?r.error={name:s.name,message:s.message,stack:s.stack}:r.error=s}i.canTransferArrayBuffer||(o.length=0);try{postMessage(r,o)}catch(s){r.result=void 0,r.error=`postMessage failed with error: ${Kg(s)}
  with responseMessage: ${JSON.stringify(r)}`,postMessage(r)}}function n(i){postMessage({id:i.data?.id,error:`postMessage failed with error: ${JSON.stringify(i)}`})}return self.onmessage=t,self.onmessageerror=n,self}var TTe=WAt;globalThis.CESIUM_VERSION="1.123";var PP;typeof ko<"u"&&(PP=ko);(function(){/*!
 * Knockout JavaScript library v3.5.1
 * (c) The Knockout.js team - http://knockoutjs.com/
 * License: MIT (http://www.opensource.org/licenses/mit-license.php)
 */(function(){(function(e){var t=this||(0,eval)("this"),n=t.document,i=t.navigator,o=t.jQuery,r=t.JSON;o||typeof jQuery>"u"||(o=jQuery),function(s){s(t.ko={})}(function(s,a){function l(_,w){return _===null||typeof _ in b?_===w:!1}function u(_,w){var P;return function(){P||(P=m.a.setTimeout(function(){P=e,_()},w))}}function f(_,w){var P;return function(){clearTimeout(P),P=m.a.setTimeout(_,w)}}function d(_,w){w&&w!=="change"?w==="beforeChange"?this.pc(_):this.gb(_,w):this.qc(_)}function p(_,w){w!==null&&w.s&&w.s()}function g(_,w){var P=this.qd,O=P[v];O.ra||(this.Qb&&this.mb[w]?(P.uc(w,_,this.mb[w]),this.mb[w]=null,--this.Qb):O.I[w]||P.uc(w,_,O.J?{da:_}:P.$c(_)),_.Ja&&_.gd())}var m=typeof s<"u"?s:{};m.b=function(_,w){for(var P=_.split("."),O=m,F=0;F<P.length-1;F++)O=O[P[F]];O[P[P.length-1]]=w},m.L=function(_,w,P){_[w]=P},m.version="3.5.1",m.b("version",m.version),m.options={deferUpdates:!1,useOnlyNativeEvents:!1,foreachHidesDestroyed:!1},m.a=function(){function _(Y,Z){for(var ee in Y)F.call(Y,ee)&&Z(ee,Y[ee])}function w(Y,Z){if(Z)for(var ee in Z)F.call(Z,ee)&&(Y[ee]=Z[ee]);return Y}function P(Y,Z){return Y.__proto__=Z,Y}function O(Y,Z,ee,me){var be=Y[Z].match(K)||[];m.a.D(ee.match(K),function(le){m.a.Na(be,le,me)}),Y[Z]=be.join(" ")}var F=Object.prototype.hasOwnProperty,V={__proto__:[]}instanceof Array,G=typeof Symbol=="function",z={},W={};z[i&&/Firefox\/2/i.test(i.userAgent)?"KeyboardEvent":"UIEvents"]=["keyup","keydown","keypress"],z.MouseEvents="click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave".split(" "),_(z,function(Y,Z){if(Z.length)for(var ee=0,me=Z.length;ee<me;ee++)W[Z[ee]]=Y});var U={propertychange:!0},q=n&&function(){for(var Y=3,Z=n.createElement("div"),ee=Z.getElementsByTagName("i");Z.innerHTML="<!--[if gt IE "+ ++Y+"]><i></i><![endif]-->",ee[0];);return 4<Y?Y:e}(),K=/\S+/g,te;return{Jc:["authenticity_token",/^__RequestVerificationToken(_.*)?$/],D:function(Y,Z,ee){for(var me=0,be=Y.length;me<be;me++)Z.call(ee,Y[me],me,Y)},A:typeof Array.prototype.indexOf=="function"?function(Y,Z){return Array.prototype.indexOf.call(Y,Z)}:function(Y,Z){for(var ee=0,me=Y.length;ee<me;ee++)if(Y[ee]===Z)return ee;return-1},Lb:function(Y,Z,ee){for(var me=0,be=Y.length;me<be;me++)if(Z.call(ee,Y[me],me,Y))return Y[me];return e},Pa:function(Y,Z){var ee=m.a.A(Y,Z);0<ee?Y.splice(ee,1):ee===0&&Y.shift()},wc:function(Y){var Z=[];return Y&&m.a.D(Y,function(ee){0>m.a.A(Z,ee)&&Z.push(ee)}),Z},Mb:function(Y,Z,ee){var me=[];if(Y)for(var be=0,le=Y.length;be<le;be++)me.push(Z.call(ee,Y[be],be));return me},jb:function(Y,Z,ee){var me=[];if(Y)for(var be=0,le=Y.length;be<le;be++)Z.call(ee,Y[be],be)&&me.push(Y[be]);return me},Nb:function(Y,Z){if(Z instanceof Array)Y.push.apply(Y,Z);else for(var ee=0,me=Z.length;ee<me;ee++)Y.push(Z[ee]);return Y},Na:function(Y,Z,ee){var me=m.a.A(m.a.bc(Y),Z);0>me?ee&&Y.push(Z):ee||Y.splice(me,1)},Ba:V,extend:w,setPrototypeOf:P,Ab:V?P:w,P:_,Ga:function(Y,Z,ee){if(!Y)return Y;var me={},be;for(be in Y)F.call(Y,be)&&(me[be]=Z.call(ee,Y[be],be,Y));return me},Tb:function(Y){for(;Y.firstChild;)m.removeNode(Y.firstChild)},Yb:function(Y){Y=m.a.la(Y);for(var Z=(Y[0]&&Y[0].ownerDocument||n).createElement("div"),ee=0,me=Y.length;ee<me;ee++)Z.appendChild(m.oa(Y[ee]));return Z},Ca:function(Y,Z){for(var ee=0,me=Y.length,be=[];ee<me;ee++){var le=Y[ee].cloneNode(!0);be.push(Z?m.oa(le):le)}return be},va:function(Y,Z){if(m.a.Tb(Y),Z)for(var ee=0,me=Z.length;ee<me;ee++)Y.appendChild(Z[ee])},Xc:function(Y,Z){var ee=Y.nodeType?[Y]:Y;if(0<ee.length){for(var me=ee[0],be=me.parentNode,le=0,ge=Z.length;le<ge;le++)be.insertBefore(Z[le],me);for(le=0,ge=ee.length;le<ge;le++)m.removeNode(ee[le])}},Ua:function(Y,Z){if(Y.length){for(Z=Z.nodeType===8&&Z.parentNode||Z;Y.length&&Y[0].parentNode!==Z;)Y.splice(0,1);for(;1<Y.length&&Y[Y.length-1].parentNode!==Z;)Y.length--;if(1<Y.length){var ee=Y[0],me=Y[Y.length-1];for(Y.length=0;ee!==me;)Y.push(ee),ee=ee.nextSibling;Y.push(me)}}return Y},Zc:function(Y,Z){7>q?Y.setAttribute("selected",Z):Y.selected=Z},Db:function(Y){return Y===null||Y===e?"":Y.trim?Y.trim():Y.toString().replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")},Ud:function(Y,Z){return Y=Y||"",Z.length>Y.length?!1:Y.substring(0,Z.length)===Z},vd:function(Y,Z){if(Y===Z)return!0;if(Y.nodeType===11)return!1;if(Z.contains)return Z.contains(Y.nodeType!==1?Y.parentNode:Y);if(Z.compareDocumentPosition)return(Z.compareDocumentPosition(Y)&16)==16;for(;Y&&Y!=Z;)Y=Y.parentNode;return!!Y},Sb:function(Y){return m.a.vd(Y,Y.ownerDocument.documentElement)},kd:function(Y){return!!m.a.Lb(Y,m.a.Sb)},R:function(Y){return Y&&Y.tagName&&Y.tagName.toLowerCase()},Ac:function(Y){return m.onError?function(){try{return Y.apply(this,arguments)}catch(Z){throw m.onError&&m.onError(Z),Z}}:Y},setTimeout:function(Y,Z){return setTimeout(m.a.Ac(Y),Z)},Gc:function(Y){setTimeout(function(){throw m.onError&&m.onError(Y),Y},0)},B:function(Y,Z,ee){var me=m.a.Ac(ee);if(ee=U[Z],m.options.useOnlyNativeEvents||ee||!o)if(ee||typeof Y.addEventListener!="function")if(typeof Y.attachEvent<"u"){var be=function(ge){me.call(Y,ge)},le="on"+Z;Y.attachEvent(le,be),m.a.K.za(Y,function(){Y.detachEvent(le,be)})}else throw Error("Browser doesn't support addEventListener or attachEvent");else Y.addEventListener(Z,me,!1);else te||(te=typeof o(Y).on=="function"?"on":"bind"),o(Y)[te](Z,me)},Fb:function(Y,Z){if(!Y||!Y.nodeType)throw Error("element must be a DOM node when calling triggerEvent");var ee;if(m.a.R(Y)==="input"&&Y.type&&Z.toLowerCase()=="click"?(ee=Y.type,ee=ee=="checkbox"||ee=="radio"):ee=!1,m.options.useOnlyNativeEvents||!o||ee)if(typeof n.createEvent=="function")if(typeof Y.dispatchEvent=="function")ee=n.createEvent(W[Z]||"HTMLEvents"),ee.initEvent(Z,!0,!0,t,0,0,0,0,0,!1,!1,!1,!1,0,Y),Y.dispatchEvent(ee);else throw Error("The supplied element doesn't support dispatchEvent");else if(ee&&Y.click)Y.click();else if(typeof Y.fireEvent<"u")Y.fireEvent("on"+Z);else throw Error("Browser doesn't support triggering events");else o(Y).trigger(Z)},f:function(Y){return m.O(Y)?Y():Y},bc:function(Y){return m.O(Y)?Y.v():Y},Eb:function(Y,Z,ee){var me;Z&&(typeof Y.classList=="object"?(me=Y.classList[ee?"add":"remove"],m.a.D(Z.match(K),function(be){me.call(Y.classList,be)})):typeof Y.className.baseVal=="string"?O(Y.className,"baseVal",Z,ee):O(Y,"className",Z,ee))},Bb:function(Y,Z){var ee=m.a.f(Z);(ee===null||ee===e)&&(ee="");var me=m.h.firstChild(Y);!me||me.nodeType!=3||m.h.nextSibling(me)?m.h.va(Y,[Y.ownerDocument.createTextNode(ee)]):me.data=ee,m.a.Ad(Y)},Yc:function(Y,Z){if(Y.name=Z,7>=q)try{var ee=Y.name.replace(/[&<>'"]/g,function(me){return"&#"+me.charCodeAt(0)+";"});Y.mergeAttributes(n.createElement("<input name='"+ee+"'/>"),!1)}catch{}},Ad:function(Y){9<=q&&(Y=Y.nodeType==1?Y:Y.parentNode,Y.style&&(Y.style.zoom=Y.style.zoom))},wd:function(Y){if(q){var Z=Y.style.width;Y.style.width=0,Y.style.width=Z}},Pd:function(Y,Z){Y=m.a.f(Y),Z=m.a.f(Z);for(var ee=[],me=Y;me<=Z;me++)ee.push(me);return ee},la:function(Y){for(var Z=[],ee=0,me=Y.length;ee<me;ee++)Z.push(Y[ee]);return Z},Da:function(Y){return G?Symbol(Y):Y},Zd:q===6,$d:q===7,W:q,Lc:function(Y,Z){for(var ee=m.a.la(Y.getElementsByTagName("input")).concat(m.a.la(Y.getElementsByTagName("textarea"))),me=typeof Z=="string"?function(ge){return ge.name===Z}:function(ge){return Z.test(ge.name)},be=[],le=ee.length-1;0<=le;le--)me(ee[le])&&be.push(ee[le]);return be},Nd:function(Y){return typeof Y=="string"&&(Y=m.a.Db(Y))?r&&r.parse?r.parse(Y):new Function("return "+Y)():null},hc:function(Y,Z,ee){if(!r||!r.stringify)throw Error("Cannot find JSON.stringify(). Some browsers (e.g., IE < 8) don't support it natively, but you can overcome this by adding a script reference to json2.js, downloadable from http://www.json.org/json2.js");return r.stringify(m.a.f(Y),Z,ee)},Od:function(Y,Z,ee){ee=ee||{};var me=ee.params||{},be=ee.includeFields||this.Jc,le=Y;if(typeof Y=="object"&&m.a.R(Y)==="form")for(var le=Y.action,ge=be.length-1;0<=ge;ge--)for(var xe=m.a.Lc(Y,be[ge]),Pe=xe.length-1;0<=Pe;Pe--)me[xe[Pe].name]=xe[Pe].value;Z=m.a.f(Z);var Ee=n.createElement("form");Ee.style.display="none",Ee.action=le,Ee.method="post";for(var Ue in Z)Y=n.createElement("input"),Y.type="hidden",Y.name=Ue,Y.value=m.a.hc(m.a.f(Z[Ue])),Ee.appendChild(Y);_(me,function(Ye,it){var It=n.createElement("input");It.type="hidden",It.name=Ye,It.value=it,Ee.appendChild(It)}),n.body.appendChild(Ee),ee.submitter?ee.submitter(Ee):Ee.submit(),setTimeout(function(){Ee.parentNode.removeChild(Ee)},0)}}}(),m.b("utils",m.a),m.b("utils.arrayForEach",m.a.D),m.b("utils.arrayFirst",m.a.Lb),m.b("utils.arrayFilter",m.a.jb),m.b("utils.arrayGetDistinctValues",m.a.wc),m.b("utils.arrayIndexOf",m.a.A),m.b("utils.arrayMap",m.a.Mb),m.b("utils.arrayPushAll",m.a.Nb),m.b("utils.arrayRemoveItem",m.a.Pa),m.b("utils.cloneNodes",m.a.Ca),m.b("utils.createSymbolOrString",m.a.Da),m.b("utils.extend",m.a.extend),m.b("utils.fieldsIncludedWithJsonPost",m.a.Jc),m.b("utils.getFormFields",m.a.Lc),m.b("utils.objectMap",m.a.Ga),m.b("utils.peekObservable",m.a.bc),m.b("utils.postJson",m.a.Od),m.b("utils.parseJson",m.a.Nd),m.b("utils.registerEventHandler",m.a.B),m.b("utils.stringifyJson",m.a.hc),m.b("utils.range",m.a.Pd),m.b("utils.toggleDomNodeCssClass",m.a.Eb),m.b("utils.triggerEvent",m.a.Fb),m.b("utils.unwrapObservable",m.a.f),m.b("utils.objectForEach",m.a.P),m.b("utils.addOrRemoveItem",m.a.Na),m.b("utils.setTextContent",m.a.Bb),m.b("unwrap",m.a.f),Function.prototype.bind||(Function.prototype.bind=function(_){var w=this;if(arguments.length===1)return function(){return w.apply(_,arguments)};var P=Array.prototype.slice.call(arguments,1);return function(){var O=P.slice(0);return O.push.apply(O,arguments),w.apply(_,O)}}),m.a.g=new function(){var _=0,w="__ko__"+new Date().getTime(),P={},O,F;return m.a.W?(O=function(V,G){var z=V[w];if(!z||z==="null"||!P[z]){if(!G)return e;z=V[w]="ko"+_++,P[z]={}}return P[z]},F=function(V){var G=V[w];return G?(delete P[G],V[w]=null,!0):!1}):(O=function(V,G){var z=V[w];return!z&&G&&(z=V[w]={}),z},F=function(V){return V[w]?(delete V[w],!0):!1}),{get:function(V,G){var z=O(V,!1);return z&&z[G]},set:function(V,G,z){(V=O(V,z!==e))&&(V[G]=z)},Ub:function(V,G,z){return V=O(V,!0),V[G]||(V[G]=z)},clear:F,Z:function(){return _+++w}}},m.b("utils.domData",m.a.g),m.b("utils.domData.clear",m.a.g.clear),m.a.K=new function(){function _(G,z){var W=m.a.g.get(G,O);return W===e&&z&&(W=[],m.a.g.set(G,O,W)),W}function w(G){var z=_(G,!1);if(z)for(var z=z.slice(0),W=0;W<z.length;W++)z[W](G);m.a.g.clear(G),m.a.K.cleanExternalData(G),V[G.nodeType]&&P(G.childNodes,!0)}function P(G,z){for(var W=[],U,q=0;q<G.length;q++)if((!z||G[q].nodeType===8)&&(w(W[W.length]=U=G[q]),G[q]!==U))for(;q--&&m.a.A(W,G[q])==-1;);}var O=m.a.g.Z(),F={1:!0,8:!0,9:!0},V={1:!0,9:!0};return{za:function(G,z){if(typeof z!="function")throw Error("Callback must be a function");_(G,!0).push(z)},yb:function(G,z){var W=_(G,!1);W&&(m.a.Pa(W,z),W.length==0&&m.a.g.set(G,O,e))},oa:function(G){return m.u.G(function(){F[G.nodeType]&&(w(G),V[G.nodeType]&&P(G.getElementsByTagName("*")))}),G},removeNode:function(G){m.oa(G),G.parentNode&&G.parentNode.removeChild(G)},cleanExternalData:function(G){o&&typeof o.cleanData=="function"&&o.cleanData([G])}}},m.oa=m.a.K.oa,m.removeNode=m.a.K.removeNode,m.b("cleanNode",m.oa),m.b("removeNode",m.removeNode),m.b("utils.domNodeDisposal",m.a.K),m.b("utils.domNodeDisposal.addDisposeCallback",m.a.K.za),m.b("utils.domNodeDisposal.removeDisposeCallback",m.a.K.yb),function(){var _=[0,"",""],w=[1,"<table>","</table>"],P=[3,"<table><tbody><tr>","</tr></tbody></table>"],O=[1,"<select multiple='multiple'>","</select>"],F={thead:w,tbody:w,tfoot:w,tr:[2,"<table><tbody>","</tbody></table>"],td:P,th:P,option:O,optgroup:O},V=8>=m.a.W;m.a.ua=function(G,z){var W;if(o){if(o.parseHTML)W=o.parseHTML(G,z)||[];else if((W=o.clean([G],z))&&W[0]){for(var U=W[0];U.parentNode&&U.parentNode.nodeType!==11;)U=U.parentNode;U.parentNode&&U.parentNode.removeChild(U)}}else{(W=z)||(W=n);var U=W.parentWindow||W.defaultView||t,q=m.a.Db(G).toLowerCase(),K=W.createElement("div"),te;for(te=(q=q.match(/^(?:\x3c!--.*?--\x3e\s*?)*?<([a-z]+)[\s>]/))&&F[q[1]]||_,q=te[0],te="ignored<div>"+te[1]+G+te[2]+"</div>",typeof U.innerShiv=="function"?K.appendChild(U.innerShiv(te)):(V&&W.body.appendChild(K),K.innerHTML=te,V&&K.parentNode.removeChild(K));q--;)K=K.lastChild;W=m.a.la(K.lastChild.childNodes)}return W},m.a.Md=function(G,z){var W=m.a.ua(G,z);return W.length&&W[0].parentElement||m.a.Yb(W)},m.a.fc=function(G,z){if(m.a.Tb(G),z=m.a.f(z),z!==null&&z!==e)if(typeof z!="string"&&(z=z.toString()),o)o(G).html(z);else for(var W=m.a.ua(z,G.ownerDocument),U=0;U<W.length;U++)G.appendChild(W[U])}}(),m.b("utils.parseHtmlFragment",m.a.ua),m.b("utils.setHtml",m.a.fc),m.aa=function(){function _(P,O){if(P){if(P.nodeType==8){var F=m.aa.Uc(P.nodeValue);F!=null&&O.push({ud:P,Kd:F})}else if(P.nodeType==1)for(var F=0,V=P.childNodes,G=V.length;F<G;F++)_(V[F],O)}}var w={};return{Xb:function(P){if(typeof P!="function")throw Error("You can only pass a function to ko.memoization.memoize()");var O=(4294967296*(1+Math.random())|0).toString(16).substring(1)+(4294967296*(1+Math.random())|0).toString(16).substring(1);return w[O]=P,"<!--[ko_memo:"+O+"]-->"},bd:function(P,O){var F=w[P];if(F===e)throw Error("Couldn't find any memo with ID "+P+". Perhaps it's already been unmemoized.");try{return F.apply(null,O||[]),!0}finally{delete w[P]}},cd:function(P,O){var F=[];_(P,F);for(var V=0,G=F.length;V<G;V++){var z=F[V].ud,W=[z];O&&m.a.Nb(W,O),m.aa.bd(F[V].Kd,W),z.nodeValue="",z.parentNode&&z.parentNode.removeChild(z)}},Uc:function(P){return(P=P.match(/^\[ko_memo\:(.*?)\]$/))?P[1]:null}}}(),m.b("memoization",m.aa),m.b("memoization.memoize",m.aa.Xb),m.b("memoization.unmemoize",m.aa.bd),m.b("memoization.parseMemoText",m.aa.Uc),m.b("memoization.unmemoizeDomNodeAndDescendants",m.aa.cd),m.na=function(){function _(){if(F){for(var z=F,W=0,U;G<F;)if(U=O[G++]){if(G>z){if(5e3<=++W){G=F,m.a.Gc(Error("'Too much recursion' after processing "+W+" task groups."));break}z=F}try{U()}catch(q){m.a.Gc(q)}}}}function w(){_(),G=F=O.length=0}var P,O=[],F=0,V=1,G=0;return t.MutationObserver?P=function(z){var W=n.createElement("div");return new MutationObserver(z).observe(W,{attributes:!0}),function(){W.classList.toggle("foo")}}(w):P=n&&"onreadystatechange"in n.createElement("script")?function(z){var W=n.createElement("script");W.onreadystatechange=function(){W.onreadystatechange=null,n.documentElement.removeChild(W),W=null,z()},n.documentElement.appendChild(W)}:function(z){setTimeout(z,0)},{scheduler:P,zb:function(z){return F||m.na.scheduler(w),O[F++]=z,V++},cancel:function(z){z=z-(V-F),z>=G&&z<F&&(O[z]=null)},resetForTesting:function(){var z=F-G;return G=F=O.length=0,z},Sd:_}}(),m.b("tasks",m.na),m.b("tasks.schedule",m.na.zb),m.b("tasks.runEarly",m.na.Sd),m.Ta={throttle:function(_,w){_.throttleEvaluation=w;var P=null;return m.$({read:_,write:function(O){clearTimeout(P),P=m.a.setTimeout(function(){_(O)},w)}})},rateLimit:function(_,w){var P,O,F;typeof w=="number"?P=w:(P=w.timeout,O=w.method),_.Hb=!1,F=typeof O=="function"?O:O=="notifyWhenChangesStop"?f:u,_.ub(function(V){return F(V,P,w)})},deferred:function(_,w){if(w!==!0)throw Error("The 'deferred' extender only accepts the value 'true', because it is not supported to turn deferral off once enabled.");_.Hb||(_.Hb=!0,_.ub(function(P){var O,F=!1;return function(){if(!F){m.na.cancel(O),O=m.na.zb(P);try{F=!0,_.notifySubscribers(e,"dirty")}finally{F=!1}}}}))},notify:function(_,w){_.equalityComparer=w=="always"?null:l}};var b={undefined:1,boolean:1,number:1,string:1};m.b("extenders",m.Ta),m.ic=function(_,w,P){this.da=_,this.lc=w,this.mc=P,this.Ib=!1,this.fb=this.Jb=null,m.L(this,"dispose",this.s),m.L(this,"disposeWhenNodeIsRemoved",this.l)},m.ic.prototype.s=function(){this.Ib||(this.fb&&m.a.K.yb(this.Jb,this.fb),this.Ib=!0,this.mc(),this.da=this.lc=this.mc=this.Jb=this.fb=null)},m.ic.prototype.l=function(_){this.Jb=_,m.a.K.za(_,this.fb=this.s.bind(this))},m.T=function(){m.a.Ab(this,x),x.qb(this)};var x={qb:function(_){_.U={change:[]},_.sc=1},subscribe:function(_,w,P){var O=this;P=P||"change";var F=new m.ic(O,w?_.bind(w):_,function(){m.a.Pa(O.U[P],F),O.hb&&O.hb(P)});return O.Qa&&O.Qa(P),O.U[P]||(O.U[P]=[]),O.U[P].push(F),F},notifySubscribers:function(_,w){if(w=w||"change",w==="change"&&this.Gb(),this.Wa(w)){var P=w==="change"&&this.ed||this.U[w].slice(0);try{m.u.xc();for(var O=0,F;F=P[O];++O)F.Ib||F.lc(_)}finally{m.u.end()}}},ob:function(){return this.sc},Dd:function(_){return this.ob()!==_},Gb:function(){++this.sc},ub:function(_){var w=this,P=m.O(w),O,F,V,G,z;w.gb||(w.gb=w.notifySubscribers,w.notifySubscribers=d);var W=_(function(){w.Ja=!1,P&&G===w&&(G=w.nc?w.nc():w());var U=F||z&&w.sb(V,G);z=F=O=!1,U&&w.gb(V=G)});w.qc=function(U,q){q&&w.Ja||(z=!q),w.ed=w.U.change.slice(0),w.Ja=O=!0,G=U,W()},w.pc=function(U){O||(V=U,w.gb(U,"beforeChange"))},w.rc=function(){z=!0},w.gd=function(){w.sb(V,w.v(!0))&&(F=!0)}},Wa:function(_){return this.U[_]&&this.U[_].length},Bd:function(_){if(_)return this.U[_]&&this.U[_].length||0;var w=0;return m.a.P(this.U,function(P,O){P!=="dirty"&&(w+=O.length)}),w},sb:function(_,w){return!this.equalityComparer||!this.equalityComparer(_,w)},toString:function(){return"[object Object]"},extend:function(_){var w=this;return _&&m.a.P(_,function(P,O){var F=m.Ta[P];typeof F=="function"&&(w=F(w,O)||w)}),w}};m.L(x,"init",x.qb),m.L(x,"subscribe",x.subscribe),m.L(x,"extend",x.extend),m.L(x,"getSubscriptionsCount",x.Bd),m.a.Ba&&m.a.setPrototypeOf(x,Function.prototype),m.T.fn=x,m.Qc=function(_){return _!=null&&typeof _.subscribe=="function"&&typeof _.notifySubscribers=="function"},m.b("subscribable",m.T),m.b("isSubscribable",m.Qc),m.S=m.u=function(){function _(V){P.push(O),O=V}function w(){O=P.pop()}var P=[],O,F=0;return{xc:_,end:w,cc:function(V){if(O){if(!m.Qc(V))throw Error("Only subscribable things can act as dependencies");O.od.call(O.pd,V,V.fd||(V.fd=++F))}},G:function(V,G,z){try{return _(),V.apply(G,z||[])}finally{w()}},qa:function(){if(O)return O.o.qa()},Va:function(){if(O)return O.o.Va()},Ya:function(){if(O)return O.Ya},o:function(){if(O)return O.o}}}(),m.b("computedContext",m.S),m.b("computedContext.getDependenciesCount",m.S.qa),m.b("computedContext.getDependencies",m.S.Va),m.b("computedContext.isInitial",m.S.Ya),m.b("computedContext.registerDependency",m.S.cc),m.b("ignoreDependencies",m.Yd=m.u.G);var T=m.a.Da("_latestValue");m.ta=function(_){function w(){return 0<arguments.length?(w.sb(w[T],arguments[0])&&(w.ya(),w[T]=arguments[0],w.xa()),this):(m.u.cc(w),w[T])}return w[T]=_,m.a.Ba||m.a.extend(w,m.T.fn),m.T.fn.qb(w),m.a.Ab(w,C),m.options.deferUpdates&&m.Ta.deferred(w,!0),w};var C={equalityComparer:l,v:function(){return this[T]},xa:function(){this.notifySubscribers(this[T],"spectate"),this.notifySubscribers(this[T])},ya:function(){this.notifySubscribers(this[T],"beforeChange")}};m.a.Ba&&m.a.setPrototypeOf(C,m.T.fn);var S=m.ta.Ma="__ko_proto__";C[S]=m.ta,m.O=function(_){if((_=typeof _=="function"&&_[S])&&_!==C[S]&&_!==m.o.fn[S])throw Error("Invalid object that looks like an observable; possibly from another Knockout instance");return!!_},m.Za=function(_){return typeof _=="function"&&(_[S]===C[S]||_[S]===m.o.fn[S]&&_.Nc)},m.b("observable",m.ta),m.b("isObservable",m.O),m.b("isWriteableObservable",m.Za),m.b("isWritableObservable",m.Za),m.b("observable.fn",C),m.L(C,"peek",C.v),m.L(C,"valueHasMutated",C.xa),m.L(C,"valueWillMutate",C.ya),m.Ha=function(_){if(_=_||[],typeof _!="object"||!("length"in _))throw Error("The argument passed when initializing an observable array must be an array, or null, or undefined.");return _=m.ta(_),m.a.Ab(_,m.Ha.fn),_.extend({trackArrayChanges:!0})},m.Ha.fn={remove:function(_){for(var w=this.v(),P=[],O=typeof _!="function"||m.O(_)?function(G){return G===_}:_,F=0;F<w.length;F++){var V=w[F];if(O(V)){if(P.length===0&&this.ya(),w[F]!==V)throw Error("Array modified during remove; cannot remove item");P.push(V),w.splice(F,1),F--}}return P.length&&this.xa(),P},removeAll:function(_){if(_===e){var w=this.v(),P=w.slice(0);return this.ya(),w.splice(0,w.length),this.xa(),P}return _?this.remove(function(O){return 0<=m.a.A(_,O)}):[]},destroy:function(_){var w=this.v(),P=typeof _!="function"||m.O(_)?function(V){return V===_}:_;this.ya();for(var O=w.length-1;0<=O;O--){var F=w[O];P(F)&&(F._destroy=!0)}this.xa()},destroyAll:function(_){return _===e?this.destroy(function(){return!0}):_?this.destroy(function(w){return 0<=m.a.A(_,w)}):[]},indexOf:function(_){var w=this();return m.a.A(w,_)},replace:function(_,w){var P=this.indexOf(_);0<=P&&(this.ya(),this.v()[P]=w,this.xa())},sorted:function(_){var w=this().slice(0);return _?w.sort(_):w.sort()},reversed:function(){return this().slice(0).reverse()}},m.a.Ba&&m.a.setPrototypeOf(m.Ha.fn,m.ta.fn),m.a.D("pop push reverse shift sort splice unshift".split(" "),function(_){m.Ha.fn[_]=function(){var w=this.v();this.ya(),this.zc(w,_,arguments);var P=w[_].apply(w,arguments);return this.xa(),P===w?this:P}}),m.a.D(["slice"],function(_){m.Ha.fn[_]=function(){var w=this();return w[_].apply(w,arguments)}}),m.Pc=function(_){return m.O(_)&&typeof _.remove=="function"&&typeof _.push=="function"},m.b("observableArray",m.Ha),m.b("isObservableArray",m.Pc),m.Ta.trackArrayChanges=function(_,w){function P(){function K(){if(z){var te=[].concat(_.v()||[]),Y;_.Wa("arrayChange")&&((!F||1<z)&&(F=m.a.Pb(W,te,_.Ob)),Y=F),W=te,F=null,z=0,Y&&Y.length&&_.notifySubscribers(Y,"arrayChange")}}O?K():(O=!0,G=_.subscribe(function(){++z},null,"spectate"),W=[].concat(_.v()||[]),F=null,V=_.subscribe(K))}if(_.Ob={},w&&typeof w=="object"&&m.a.extend(_.Ob,w),_.Ob.sparse=!0,!_.zc){var O=!1,F=null,V,G,z=0,W,U=_.Qa,q=_.hb;_.Qa=function(K){U&&U.call(_,K),K==="arrayChange"&&P()},_.hb=function(K){q&&q.call(_,K),K!=="arrayChange"||_.Wa("arrayChange")||(V&&V.s(),G&&G.s(),G=V=null,O=!1,W=e)},_.zc=function(K,te,Y){function Z(Ee,Ue,Ye){return ee[ee.length]={status:Ee,value:Ue,index:Ye}}if(O&&!z){var ee=[],me=K.length,be=Y.length,le=0;switch(te){case"push":le=me;case"unshift":for(te=0;te<be;te++)Z("added",Y[te],le+te);break;case"pop":le=me-1;case"shift":me&&Z("deleted",K[le],le);break;case"splice":te=Math.min(Math.max(0,0>Y[0]?me+Y[0]:Y[0]),me);for(var me=be===1?me:Math.min(te+(Y[1]||0),me),be=te+be-2,le=Math.max(me,be),ge=[],xe=[],Pe=2;te<le;++te,++Pe)te<me&&xe.push(Z("deleted",K[te],te)),te<be&&ge.push(Z("added",Y[Pe],te));m.a.Kc(xe,ge);break;default:return}F=ee}}}};var v=m.a.Da("_state");m.o=m.$=function(_,w,P){function O(){if(0<arguments.length){if(typeof F=="function")F.apply(V.nb,arguments);else throw Error("Cannot write a value to a ko.computed unless you specify a 'write' option. If you wish to read the current value, don't pass any parameters.");return this}return V.ra||m.u.cc(O),(V.ka||V.J&&O.Xa())&&O.ha(),V.X}if(typeof _=="object"?P=_:(P=P||{},_&&(P.read=_)),typeof P.read!="function")throw Error("Pass a function that returns the value of the ko.computed");var F=P.write,V={X:e,sa:!0,ka:!0,rb:!1,jc:!1,ra:!1,wb:!1,J:!1,Wc:P.read,nb:w||P.owner,l:P.disposeWhenNodeIsRemoved||P.l||null,Sa:P.disposeWhen||P.Sa,Rb:null,I:{},V:0,Ic:null};return O[v]=V,O.Nc=typeof F=="function",m.a.Ba||m.a.extend(O,m.T.fn),m.T.fn.qb(O),m.a.Ab(O,D),P.pure?(V.wb=!0,V.J=!0,m.a.extend(O,I)):P.deferEvaluation&&m.a.extend(O,L),m.options.deferUpdates&&m.Ta.deferred(O,!0),V.l&&(V.jc=!0,V.l.nodeType||(V.l=null)),V.J||P.deferEvaluation||O.ha(),V.l&&O.ja()&&m.a.K.za(V.l,V.Rb=function(){O.s()}),O};var D={equalityComparer:l,qa:function(){return this[v].V},Va:function(){var _=[];return m.a.P(this[v].I,function(w,P){_[P.Ka]=P.da}),_},Vb:function(_){if(!this[v].V)return!1;var w=this.Va();return m.a.A(w,_)!==-1?!0:!!m.a.Lb(w,function(P){return P.Vb&&P.Vb(_)})},uc:function(_,w,P){if(this[v].wb&&w===this)throw Error("A 'pure' computed must not be called recursively");this[v].I[_]=P,P.Ka=this[v].V++,P.La=w.ob()},Xa:function(){var _,w,P=this[v].I;for(_ in P)if(Object.prototype.hasOwnProperty.call(P,_)&&(w=P[_],this.Ia&&w.da.Ja||w.da.Dd(w.La)))return!0},Jd:function(){this.Ia&&!this[v].rb&&this.Ia(!1)},ja:function(){var _=this[v];return _.ka||0<_.V},Rd:function(){this.Ja?this[v].ka&&(this[v].sa=!0):this.Hc()},$c:function(_){if(_.Hb){var w=_.subscribe(this.Jd,this,"dirty"),P=_.subscribe(this.Rd,this);return{da:_,s:function(){w.s(),P.s()}}}return _.subscribe(this.Hc,this)},Hc:function(){var _=this,w=_.throttleEvaluation;w&&0<=w?(clearTimeout(this[v].Ic),this[v].Ic=m.a.setTimeout(function(){_.ha(!0)},w)):_.Ia?_.Ia(!0):_.ha(!0)},ha:function(_){var w=this[v],P=w.Sa,O=!1;if(!w.rb&&!w.ra){if(w.l&&!m.a.Sb(w.l)||P&&P()){if(!w.jc){this.s();return}}else w.jc=!1;w.rb=!0;try{O=this.zd(_)}finally{w.rb=!1}return O}},zd:function(_){var w=this[v],O=!1,P=w.wb?e:!w.V,O={qd:this,mb:w.I,Qb:w.V};m.u.xc({pd:O,od:g,o:this,Ya:P}),w.I={},w.V=0;var F=this.yd(w,O);return w.V?O=this.sb(w.X,F):(this.s(),O=!0),O&&(w.J?this.Gb():this.notifySubscribers(w.X,"beforeChange"),w.X=F,this.notifySubscribers(w.X,"spectate"),!w.J&&_&&this.notifySubscribers(w.X),this.rc&&this.rc()),P&&this.notifySubscribers(w.X,"awake"),O},yd:function(_,w){try{var P=_.Wc;return _.nb?P.call(_.nb):P()}finally{m.u.end(),w.Qb&&!_.J&&m.a.P(w.mb,p),_.sa=_.ka=!1}},v:function(_){var w=this[v];return(w.ka&&(_||!w.V)||w.J&&this.Xa())&&this.ha(),w.X},ub:function(_){m.T.fn.ub.call(this,_),this.nc=function(){return this[v].J||(this[v].sa?this.ha():this[v].ka=!1),this[v].X},this.Ia=function(w){this.pc(this[v].X),this[v].ka=!0,w&&(this[v].sa=!0),this.qc(this,!w)}},s:function(){var _=this[v];!_.J&&_.I&&m.a.P(_.I,function(w,P){P.s&&P.s()}),_.l&&_.Rb&&m.a.K.yb(_.l,_.Rb),_.I=e,_.V=0,_.ra=!0,_.sa=!1,_.ka=!1,_.J=!1,_.l=e,_.Sa=e,_.Wc=e,this.Nc||(_.nb=e)}},I={Qa:function(_){var w=this,P=w[v];if(!P.ra&&P.J&&_=="change"){if(P.J=!1,P.sa||w.Xa())P.I=null,P.V=0,w.ha()&&w.Gb();else{var O=[];m.a.P(P.I,function(F,V){O[V.Ka]=F}),m.a.D(O,function(F,V){var G=P.I[F],z=w.$c(G.da);z.Ka=V,z.La=G.La,P.I[F]=z}),w.Xa()&&w.ha()&&w.Gb()}P.ra||w.notifySubscribers(P.X,"awake")}},hb:function(_){var w=this[v];w.ra||_!="change"||this.Wa("change")||(m.a.P(w.I,function(P,O){O.s&&(w.I[P]={da:O.da,Ka:O.Ka,La:O.La},O.s())}),w.J=!0,this.notifySubscribers(e,"asleep"))},ob:function(){var _=this[v];return _.J&&(_.sa||this.Xa())&&this.ha(),m.T.fn.ob.call(this)}},L={Qa:function(_){_!="change"&&_!="beforeChange"||this.v()}};m.a.Ba&&m.a.setPrototypeOf(D,m.T.fn);var M=m.ta.Ma;D[M]=m.o,m.Oc=function(_){return typeof _=="function"&&_[M]===D[M]},m.Fd=function(_){return m.Oc(_)&&_[v]&&_[v].wb},m.b("computed",m.o),m.b("dependentObservable",m.o),m.b("isComputed",m.Oc),m.b("isPureComputed",m.Fd),m.b("computed.fn",D),m.L(D,"peek",D.v),m.L(D,"dispose",D.s),m.L(D,"isActive",D.ja),m.L(D,"getDependenciesCount",D.qa),m.L(D,"getDependencies",D.Va),m.xb=function(_,w){return typeof _=="function"?m.o(_,w,{pure:!0}):(_=m.a.extend({},_),_.pure=!0,m.o(_,w))},m.b("pureComputed",m.xb),function(){function _(O,F,V){if(V=V||new P,O=F(O),typeof O!="object"||O===null||O===e||O instanceof RegExp||O instanceof Date||O instanceof String||O instanceof Number||O instanceof Boolean)return O;var G=O instanceof Array?[]:{};return V.save(O,G),w(O,function(z){var W=F(O[z]);switch(typeof W){case"boolean":case"number":case"string":case"function":G[z]=W;break;case"object":case"undefined":var U=V.get(W);G[z]=U!==e?U:_(W,F,V)}}),G}function w(O,F){if(O instanceof Array){for(var V=0;V<O.length;V++)F(V);typeof O.toJSON=="function"&&F("toJSON")}else for(V in O)F(V)}function P(){this.keys=[],this.values=[]}m.ad=function(O){if(arguments.length==0)throw Error("When calling ko.toJS, pass the object you want to convert.");return _(O,function(F){for(var V=0;m.O(F)&&10>V;V++)F=F();return F})},m.toJSON=function(O,F,V){return O=m.ad(O),m.a.hc(O,F,V)},P.prototype={constructor:P,save:function(O,F){var V=m.a.A(this.keys,O);0<=V?this.values[V]=F:(this.keys.push(O),this.values.push(F))},get:function(O){return O=m.a.A(this.keys,O),0<=O?this.values[O]:e}}}(),m.b("toJS",m.ad),m.b("toJSON",m.toJSON),m.Wd=function(_,w,P){function O(F){var V=m.xb(_,P).extend({ma:"always"}),G=V.subscribe(function(z){z&&(G.s(),F(z))});return V.notifySubscribers(V.v()),G}return typeof Promise!="function"||w?O(w.bind(P)):new Promise(O)},m.b("when",m.Wd),function(){m.w={M:function(_){switch(m.a.R(_)){case"option":return _.__ko__hasDomDataOptionValue__===!0?m.a.g.get(_,m.c.options.$b):7>=m.a.W?_.getAttributeNode("value")&&_.getAttributeNode("value").specified?_.value:_.text:_.value;case"select":return 0<=_.selectedIndex?m.w.M(_.options[_.selectedIndex]):e;default:return _.value}},cb:function(_,w,P){switch(m.a.R(_)){case"option":typeof w=="string"?(m.a.g.set(_,m.c.options.$b,e),"__ko__hasDomDataOptionValue__"in _&&delete _.__ko__hasDomDataOptionValue__,_.value=w):(m.a.g.set(_,m.c.options.$b,w),_.__ko__hasDomDataOptionValue__=!0,_.value=typeof w=="number"?w:"");break;case"select":(w===""||w===null)&&(w=e);for(var O=-1,F=0,V=_.options.length,G;F<V;++F)if(G=m.w.M(_.options[F]),G==w||G===""&&w===e){O=F;break}(P||0<=O||w===e&&1<_.size)&&(_.selectedIndex=O,m.a.W===6&&m.a.setTimeout(function(){_.selectedIndex=O},0));break;default:(w===null||w===e)&&(w=""),_.value=w}}}}(),m.b("selectExtensions",m.w),m.b("selectExtensions.readValue",m.w.M),m.b("selectExtensions.writeValue",m.w.cb),m.m=function(){function _(z){z=m.a.Db(z),z.charCodeAt(0)===123&&(z=z.slice(1,-1)),z+=`
,`;var W=[],U=z.match(O),q,K=[],te=0;if(1<U.length){for(var Y=0,Z;Z=U[Y];++Y){var ee=Z.charCodeAt(0);if(ee===44){if(0>=te){W.push(q&&K.length?{key:q,value:K.join("")}:{unknown:q||K.join("")}),q=te=0,K=[];continue}}else if(ee===58){if(!te&&!q&&K.length===1){q=K.pop();continue}}else{if(ee===47&&1<Z.length&&(Z.charCodeAt(1)===47||Z.charCodeAt(1)===42))continue;ee===47&&Y&&1<Z.length?(ee=U[Y-1].match(F))&&!V[ee[0]]&&(z=z.substr(z.indexOf(Z)+1),U=z.match(O),Y=-1,Z="/"):ee===40||ee===123||ee===91?++te:ee===41||ee===125||ee===93?--te:q||K.length||ee!==34&&ee!==39||(Z=Z.slice(1,-1))}K.push(Z)}if(0<te)throw Error("Unbalanced parentheses, braces, or brackets")}return W}var w=["true","false","null","undefined"],P=/^(?:[$_a-z][$\w]*|(.+)(\.\s*[$_a-z][$\w]*|\[.+\]))$/i,O=RegExp(`"(?:\\\\.|[^"])*"|'(?:\\\\.|[^'])*'|\`(?:\\\\.|[^\`])*\`|/\\*(?:[^*]|\\*+[^*/])*\\*+/|//.*
|/(?:\\\\.|[^/])+/w*|[^\\s:,/][^,"'\`{}()/:[\\]]*[^\\s,"'\`{}()/:[\\]]|[^\\s]`,"g"),F=/[\])"'A-Za-z0-9_$]+$/,V={in:1,return:1,typeof:1},G={};return{Ra:[],wa:G,ac:_,vb:function(z,W){function U(ee,me){var be;if(!Y){var le=m.getBindingHandler(ee);if(le&&le.preprocess&&!(me=le.preprocess(me,ee,U)))return;(le=G[ee])&&(be=me,0<=m.a.A(w,be)?be=!1:(le=be.match(P),be=le===null?!1:le[1]?"Object("+le[1]+")"+le[2]:be),le=be),le&&K.push("'"+(typeof G[ee]=="string"?G[ee]:ee)+"':function(_z){"+be+"=_z}")}te&&(me="function(){return "+me+" }"),q.push("'"+ee+"':"+me)}W=W||{};var q=[],K=[],te=W.valueAccessors,Y=W.bindingParams,Z=typeof z=="string"?_(z):z;return m.a.D(Z,function(ee){U(ee.key||ee.unknown,ee.value)}),K.length&&U("_ko_property_writers","{"+K.join(",")+" }"),q.join(",")},Id:function(z,W){for(var U=0;U<z.length;U++)if(z[U].key==W)return!0;return!1},eb:function(z,W,U,q,K){z&&m.O(z)?!m.Za(z)||K&&z.v()===q||z(q):(z=W.get("_ko_property_writers"))&&z[U]&&z[U](q)}}}(),m.b("expressionRewriting",m.m),m.b("expressionRewriting.bindingRewriteValidators",m.m.Ra),m.b("expressionRewriting.parseObjectLiteral",m.m.ac),m.b("expressionRewriting.preProcessBindings",m.m.vb),m.b("expressionRewriting._twoWayBindings",m.m.wa),m.b("jsonExpressionRewriting",m.m),m.b("jsonExpressionRewriting.insertPropertyAccessorsIntoJson",m.m.vb),function(){function _(U){return U.nodeType==8&&V.test(F?U.text:U.nodeValue)}function w(U){return U.nodeType==8&&G.test(F?U.text:U.nodeValue)}function P(U,q){for(var K=U,te=1,Y=[];K=K.nextSibling;){if(w(K)&&(m.a.g.set(K,W,!0),te--,te===0))return Y;Y.push(K),_(K)&&te++}if(!q)throw Error("Cannot find closing comment tag to match: "+U.nodeValue);return null}function O(U,q){var K=P(U,q);return K?0<K.length?K[K.length-1].nextSibling:U.nextSibling:null}var F=n&&n.createComment("test").text==="<!--test-->",V=F?/^\x3c!--\s*ko(?:\s+([\s\S]+))?\s*--\x3e$/:/^\s*ko(?:\s+([\s\S]+))?\s*$/,G=F?/^\x3c!--\s*\/ko\s*--\x3e$/:/^\s*\/ko\s*$/,z={ul:!0,ol:!0},W="__ko_matchedEndComment__";m.h={ea:{},childNodes:function(U){return _(U)?P(U):U.childNodes},Ea:function(U){if(_(U)){U=m.h.childNodes(U);for(var q=0,K=U.length;q<K;q++)m.removeNode(U[q])}else m.a.Tb(U)},va:function(U,q){if(_(U)){m.h.Ea(U);for(var K=U.nextSibling,te=0,Y=q.length;te<Y;te++)K.parentNode.insertBefore(q[te],K)}else m.a.va(U,q)},Vc:function(U,q){var K;_(U)?(K=U.nextSibling,U=U.parentNode):K=U.firstChild,K?q!==K&&U.insertBefore(q,K):U.appendChild(q)},Wb:function(U,q,K){K?(K=K.nextSibling,_(U)&&(U=U.parentNode),K?q!==K&&U.insertBefore(q,K):U.appendChild(q)):m.h.Vc(U,q)},firstChild:function(U){if(_(U))return!U.nextSibling||w(U.nextSibling)?null:U.nextSibling;if(U.firstChild&&w(U.firstChild))throw Error("Found invalid end comment, as the first child of "+U);return U.firstChild},nextSibling:function(U){if(_(U)&&(U=O(U)),U.nextSibling&&w(U.nextSibling)){var q=U.nextSibling;if(w(q)&&!m.a.g.get(q,W))throw Error("Found end comment without a matching opening comment, as child of "+U);return null}return U.nextSibling},Cd:_,Vd:function(U){return(U=(F?U.text:U.nodeValue).match(V))?U[1]:null},Sc:function(U){if(z[m.a.R(U)]){var q=U.firstChild;if(q)do if(q.nodeType===1){var K;K=q.firstChild;var te=null;if(K)do if(te)te.push(K);else if(_(K)){var Y=O(K,!0);Y?K=Y:te=[K]}else w(K)&&(te=[K]);while(K=K.nextSibling);if(K=te)for(te=q.nextSibling,Y=0;Y<K.length;Y++)te?U.insertBefore(K[Y],te):U.appendChild(K[Y])}while(q=q.nextSibling)}}}}(),m.b("virtualElements",m.h),m.b("virtualElements.allowedBindings",m.h.ea),m.b("virtualElements.emptyNode",m.h.Ea),m.b("virtualElements.insertAfter",m.h.Wb),m.b("virtualElements.prepend",m.h.Vc),m.b("virtualElements.setDomNodeChildren",m.h.va),function(){m.ga=function(){this.nd={}},m.a.extend(m.ga.prototype,{nodeHasBindings:function(_){switch(_.nodeType){case 1:return _.getAttribute("data-bind")!=null||m.j.getComponentNameForNode(_);case 8:return m.h.Cd(_);default:return!1}},getBindings:function(_,w){var P=this.getBindingsString(_,w),P=P?this.parseBindingsString(P,w,_):null;return m.j.tc(P,_,w,!1)},getBindingAccessors:function(_,w){var P=this.getBindingsString(_,w),P=P?this.parseBindingsString(P,w,_,{valueAccessors:!0}):null;return m.j.tc(P,_,w,!0)},getBindingsString:function(_){switch(_.nodeType){case 1:return _.getAttribute("data-bind");case 8:return m.h.Vd(_);default:return null}},parseBindingsString:function(_,w,P,O){try{var F=this.nd,V=_+(O&&O.valueAccessors||""),G;if(!(G=F[V])){var z,W="with($context){with($data||{}){return{"+m.m.vb(_,O)+"}}}";z=new Function("$context","$element",W),G=F[V]=z}return G(w,P)}catch(U){throw U.message=`Unable to parse bindings.
Bindings value: `+_+`
Message: `+U.message,U}}}),m.ga.instance=new m.ga}(),m.b("bindingProvider",m.ga),function(){function _(le){var ge=(le=m.a.g.get(le,be))&&le.N;ge&&(le.N=null,ge.Tc())}function w(le,ge,xe){this.node=le,this.yc=ge,this.kb=[],this.H=!1,ge.N||m.a.K.za(le,_),xe&&xe.N&&(xe.N.kb.push(le),this.Kb=xe)}function P(le){return function(){return le}}function O(le){return le()}function F(le){return m.a.Ga(m.u.G(le),function(ge,xe){return function(){return le()[xe]}})}function V(le,ge,xe){return typeof le=="function"?F(le.bind(null,ge,xe)):m.a.Ga(le,P)}function G(le,ge){return F(this.getBindings.bind(this,le,ge))}function z(le,ge){var xe=m.h.firstChild(ge);if(xe){var Pe,Ee=m.ga.instance,Ue=Ee.preprocessNode;if(Ue){for(;Pe=xe;)xe=m.h.nextSibling(Pe),Ue.call(Ee,Pe);xe=m.h.firstChild(ge)}for(;Pe=xe;)xe=m.h.nextSibling(Pe),W(le,Pe)}m.i.ma(ge,m.i.H)}function W(le,ge){var xe=le,Pe=ge.nodeType===1;Pe&&m.h.Sc(ge),(Pe||m.ga.instance.nodeHasBindings(ge))&&(xe=q(ge,null,le).bindingContextForDescendants),xe&&!ee[m.a.R(ge)]&&z(xe,ge)}function U(le){var ge=[],xe={},Pe=[];return m.a.P(le,function Ee(Ue){if(!xe[Ue]){var Ye=m.getBindingHandler(Ue);Ye&&(Ye.after&&(Pe.push(Ue),m.a.D(Ye.after,function(it){if(le[it]){if(m.a.A(Pe,it)!==-1)throw Error("Cannot combine the following bindings, because they have a cyclic dependency: "+Pe.join(", "));Ee(it)}}),Pe.length--),ge.push({key:Ue,Mc:Ye})),xe[Ue]=!0}}),ge}function q(le,ge,xe){var Pe=m.a.g.Ub(le,be,{}),Ee=Pe.hd;if(!ge){if(Ee)throw Error("You cannot apply bindings multiple times to the same element.");Pe.hd=!0}Ee||(Pe.context=xe),Pe.Zb||(Pe.Zb={});var Ue;if(ge&&typeof ge!="function")Ue=ge;else{var Ye=m.ga.instance,it=Ye.getBindingAccessors||G,It=m.$(function(){return(Ue=ge?ge(xe,le):it.call(Ye,le,xe))&&(xe[te]&&xe[te](),xe[Z]&&xe[Z]()),Ue},null,{l:le});Ue&&It.ja()||(It=null)}var Ot=xe,He;if(Ue){var tn=function(){return m.a.Ga(It?It():Ue,O)},dt=It?function(bt){return function(){return O(It()[bt])}}:function(bt){return Ue[bt]};tn.get=function(bt){return Ue[bt]&&O(dt(bt))},tn.has=function(bt){return bt in Ue},m.i.H in Ue&&m.i.subscribe(le,m.i.H,function(){var bt=(0,Ue[m.i.H])();if(bt){var nn=m.h.childNodes(le);nn.length&&bt(nn,m.Ec(nn[0]))}}),m.i.pa in Ue&&(Ot=m.i.Cb(le,xe),m.i.subscribe(le,m.i.pa,function(){var bt=(0,Ue[m.i.pa])();bt&&m.h.firstChild(le)&&bt(le)})),Pe=U(Ue),m.a.D(Pe,function(bt){var nn=bt.Mc.init,Ae=bt.Mc.update,Ce=bt.key;if(le.nodeType===8&&!m.h.ea[Ce])throw Error("The binding '"+Ce+"' cannot be used with virtual elements");try{typeof nn=="function"&&m.u.G(function(){var rt=nn(le,dt(Ce),tn,Ot.$data,Ot);if(rt&&rt.controlsDescendantBindings){if(He!==e)throw Error("Multiple bindings ("+He+" and "+Ce+") are trying to control descendant bindings of the same element. You cannot use these bindings together on the same element.");He=Ce}}),typeof Ae=="function"&&m.$(function(){Ae(le,dt(Ce),tn,Ot.$data,Ot)},null,{l:le})}catch(rt){throw rt.message='Unable to process binding "'+Ce+": "+Ue[Ce]+`"
Message: `+rt.message,rt}})}return Pe=He===e,{shouldBindDescendants:Pe,bindingContextForDescendants:Pe&&Ot}}function K(le,ge){return le&&le instanceof m.fa?le:new m.fa(le,e,e,ge)}var te=m.a.Da("_subscribable"),Y=m.a.Da("_ancestorBindingInfo"),Z=m.a.Da("_dataDependency");m.c={};var ee={script:!0,textarea:!0,template:!0};m.getBindingHandler=function(le){return m.c[le]};var me={};m.fa=function(le,ge,xe,Pe,Ee){function Ue(){var dt=Ot?It():It,bt=m.a.f(dt);return ge?(m.a.extend(Ye,ge),Y in ge&&(Ye[Y]=ge[Y])):(Ye.$parents=[],Ye.$root=bt,Ye.ko=m),Ye[te]=He,it?bt=Ye.$data:(Ye.$rawData=dt,Ye.$data=bt),xe&&(Ye[xe]=bt),Pe&&Pe(Ye,ge,bt),ge&&ge[te]&&!m.S.o().Vb(ge[te])&&ge[te](),tn&&(Ye[Z]=tn),Ye.$data}var Ye=this,it=le===me,It=it?e:le,Ot=typeof It=="function"&&!m.O(It),He,tn=Ee&&Ee.dataDependency;Ee&&Ee.exportDependencies?Ue():(He=m.xb(Ue),He.v(),He.ja()?He.equalityComparer=null:Ye[te]=e)},m.fa.prototype.createChildContext=function(le,ge,xe,Pe){if(!Pe&&ge&&typeof ge=="object"&&(Pe=ge,ge=Pe.as,xe=Pe.extend),ge&&Pe&&Pe.noChildContext){var Ee=typeof le=="function"&&!m.O(le);return new m.fa(me,this,null,function(Ue){xe&&xe(Ue),Ue[ge]=Ee?le():le},Pe)}return new m.fa(le,this,ge,function(Ue,Ye){Ue.$parentContext=Ye,Ue.$parent=Ye.$data,Ue.$parents=(Ye.$parents||[]).slice(0),Ue.$parents.unshift(Ue.$parent),xe&&xe(Ue)},Pe)},m.fa.prototype.extend=function(le,ge){return new m.fa(me,this,null,function(xe){m.a.extend(xe,typeof le=="function"?le(xe):le)},ge)};var be=m.a.g.Z();w.prototype.Tc=function(){this.Kb&&this.Kb.N&&this.Kb.N.sd(this.node)},w.prototype.sd=function(le){m.a.Pa(this.kb,le),!this.kb.length&&this.H&&this.Cc()},w.prototype.Cc=function(){this.H=!0,this.yc.N&&!this.kb.length&&(this.yc.N=null,m.a.K.yb(this.node,_),m.i.ma(this.node,m.i.pa),this.Tc())},m.i={H:"childrenComplete",pa:"descendantsComplete",subscribe:function(le,ge,xe,Pe,Ee){var Ue=m.a.g.Ub(le,be,{});return Ue.Fa||(Ue.Fa=new m.T),Ee&&Ee.notifyImmediately&&Ue.Zb[ge]&&m.u.G(xe,Pe,[le]),Ue.Fa.subscribe(xe,Pe,ge)},ma:function(le,ge){var xe=m.a.g.get(le,be);if(xe&&(xe.Zb[ge]=!0,xe.Fa&&xe.Fa.notifySubscribers(le,ge),ge==m.i.H)){if(xe.N)xe.N.Cc();else if(xe.N===e&&xe.Fa&&xe.Fa.Wa(m.i.pa))throw Error("descendantsComplete event not supported for bindings on this node")}},Cb:function(le,ge){var xe=m.a.g.Ub(le,be,{});return xe.N||(xe.N=new w(le,xe,ge[Y])),ge[Y]==xe?ge:ge.extend(function(Pe){Pe[Y]=xe})}},m.Td=function(le){return(le=m.a.g.get(le,be))&&le.context},m.ib=function(le,ge,xe){return le.nodeType===1&&m.h.Sc(le),q(le,ge,K(xe))},m.ld=function(le,ge,xe){return xe=K(xe),m.ib(le,V(ge,xe,le),xe)},m.Oa=function(le,ge){ge.nodeType!==1&&ge.nodeType!==8||z(K(le),ge)},m.vc=function(le,ge,xe){if(!o&&t.jQuery&&(o=t.jQuery),2>arguments.length){if(ge=n.body,!ge)throw Error("ko.applyBindings: could not find document.body; has the document been loaded?")}else if(!ge||ge.nodeType!==1&&ge.nodeType!==8)throw Error("ko.applyBindings: first parameter should be your view model; second parameter should be a DOM node");W(K(le,xe),ge)},m.Dc=function(le){return!le||le.nodeType!==1&&le.nodeType!==8?e:m.Td(le)},m.Ec=function(le){return(le=m.Dc(le))?le.$data:e},m.b("bindingHandlers",m.c),m.b("bindingEvent",m.i),m.b("bindingEvent.subscribe",m.i.subscribe),m.b("bindingEvent.startPossiblyAsyncContentBinding",m.i.Cb),m.b("applyBindings",m.vc),m.b("applyBindingsToDescendants",m.Oa),m.b("applyBindingAccessorsToNode",m.ib),m.b("applyBindingsToNode",m.ld),m.b("contextFor",m.Dc),m.b("dataFor",m.Ec)}(),function(_){function w(G,z){var W=Object.prototype.hasOwnProperty.call(F,G)?F[G]:_,U;W?W.subscribe(z):(W=F[G]=new m.T,W.subscribe(z),P(G,function(q,K){var te=!(!K||!K.synchronous);V[G]={definition:q,Gd:te},delete F[G],U||te?W.notifySubscribers(q):m.na.zb(function(){W.notifySubscribers(q)})}),U=!0)}function P(G,z){O("getConfig",[G],function(W){W?O("loadComponent",[G,W],function(U){z(U,W)}):z(null,null)})}function O(G,z,W,U){U||(U=m.j.loaders.slice(0));var q=U.shift();if(q){var K=q[G];if(K){var te=!1;if(K.apply(q,z.concat(function(Y){te?W(null):Y!==null?W(Y):O(G,z,W,U)}))!==_&&(te=!0,!q.suppressLoaderExceptions))throw Error("Component loaders must supply values by invoking the callback, not by returning values synchronously.")}else O(G,z,W,U)}else W(null)}var F={},V={};m.j={get:function(G,z){var W=Object.prototype.hasOwnProperty.call(V,G)?V[G]:_;W?W.Gd?m.u.G(function(){z(W.definition)}):m.na.zb(function(){z(W.definition)}):w(G,z)},Bc:function(G){delete V[G]},oc:O},m.j.loaders=[],m.b("components",m.j),m.b("components.get",m.j.get),m.b("components.clearCachedDefinition",m.j.Bc)}(),function(){function _(W,U,q,K){function te(){--Z===0&&K(Y)}var Y={},Z=2,ee=q.template;q=q.viewModel,ee?F(U,ee,function(me){m.j.oc("loadTemplate",[W,me],function(be){Y.template=be,te()})}):te(),q?F(U,q,function(me){m.j.oc("loadViewModel",[W,me],function(be){Y[z]=be,te()})}):te()}function w(W,U,q){if(typeof U=="function")q(function(te){return new U(te)});else if(typeof U[z]=="function")q(U[z]);else if("instance"in U){var K=U.instance;q(function(){return K})}else"viewModel"in U?w(W,U.viewModel,q):W("Unknown viewModel value: "+U)}function P(W){switch(m.a.R(W)){case"script":return m.a.ua(W.text);case"textarea":return m.a.ua(W.value);case"template":if(O(W.content))return m.a.Ca(W.content.childNodes)}return m.a.Ca(W.childNodes)}function O(W){return t.DocumentFragment?W instanceof DocumentFragment:W&&W.nodeType===11}function F(W,U,q){typeof U.require=="string"?a||t.require?(a||t.require)([U.require],function(K){K&&typeof K=="object"&&K.Xd&&K.default&&(K=K.default),q(K)}):W("Uses require, but no AMD loader is present"):q(U)}function V(W){return function(U){throw Error("Component '"+W+"': "+U)}}var G={};m.j.register=function(W,U){if(!U)throw Error("Invalid configuration for "+W);if(m.j.tb(W))throw Error("Component "+W+" is already registered");G[W]=U},m.j.tb=function(W){return Object.prototype.hasOwnProperty.call(G,W)},m.j.unregister=function(W){delete G[W],m.j.Bc(W)},m.j.Fc={getConfig:function(W,U){U(m.j.tb(W)?G[W]:null)},loadComponent:function(W,U,q){var K=V(W);F(K,U,function(te){_(W,K,te,q)})},loadTemplate:function(W,U,q){if(W=V(W),typeof U=="string")q(m.a.ua(U));else if(U instanceof Array)q(U);else if(O(U))q(m.a.la(U.childNodes));else if(U.element)if(U=U.element,t.HTMLElement?U instanceof HTMLElement:U&&U.tagName&&U.nodeType===1)q(P(U));else if(typeof U=="string"){var K=n.getElementById(U);K?q(P(K)):W("Cannot find element with ID "+U)}else W("Unknown element type: "+U);else W("Unknown template value: "+U)},loadViewModel:function(W,U,q){w(V(W),U,q)}};var z="createViewModel";m.b("components.register",m.j.register),m.b("components.isRegistered",m.j.tb),m.b("components.unregister",m.j.unregister),m.b("components.defaultLoader",m.j.Fc),m.j.loaders.push(m.j.Fc),m.j.dd=G}(),function(){function _(P,O){var F=P.getAttribute("params");if(F){var F=w.parseBindingsString(F,O,P,{valueAccessors:!0,bindingParams:!0}),F=m.a.Ga(F,function(z){return m.o(z,null,{l:P})}),V=m.a.Ga(F,function(z){var W=z.v();return z.ja()?m.o({read:function(){return m.a.f(z())},write:m.Za(W)&&function(U){z()(U)},l:P}):W});return Object.prototype.hasOwnProperty.call(V,"$raw")||(V.$raw=F),V}return{$raw:{}}}m.j.getComponentNameForNode=function(P){var O=m.a.R(P);if(m.j.tb(O)&&(O.indexOf("-")!=-1||""+P=="[object HTMLUnknownElement]"||8>=m.a.W&&P.tagName===O))return O},m.j.tc=function(P,O,F,V){if(O.nodeType===1){var G=m.j.getComponentNameForNode(O);if(G){if(P=P||{},P.component)throw Error('Cannot use the "component" binding on a custom element matching a component');var z={name:G,params:_(O,F)};P.component=V?function(){return z}:z}}return P};var w=new m.ga;9>m.a.W&&(m.j.register=function(P){return function(O){return P.apply(this,arguments)}}(m.j.register),n.createDocumentFragment=function(P){return function(){var O=P(),F=m.j.dd,V;for(V in F);return O}}(n.createDocumentFragment))}(),function(){function _(O,F,V){if(F=F.template,!F)throw Error("Component '"+O+"' has no template");O=m.a.Ca(F),m.h.va(V,O)}function w(O,F,V){var G=O.createViewModel;return G?G.call(O,F,V):F}var P=0;m.c.component={init:function(O,F,V,G,z){function W(){var Y=U&&U.dispose;typeof Y=="function"&&Y.call(U),K&&K.s(),q=U=K=null}var U,q,K,te=m.a.la(m.h.childNodes(O));return m.h.Ea(O),m.a.K.za(O,W),m.o(function(){var Y=m.a.f(F()),Z,ee;if(typeof Y=="string"?Z=Y:(Z=m.a.f(Y.name),ee=m.a.f(Y.params)),!Z)throw Error("No component name specified");var me=m.i.Cb(O,z),be=q=++P;m.j.get(Z,function(le){if(q===be){if(W(),!le)throw Error("Unknown component '"+Z+"'");_(Z,le,O);var ge=w(le,ee,{element:O,templateNodes:te});le=me.createChildContext(ge,{extend:function(xe){xe.$component=ge,xe.$componentTemplateNodes=te}}),ge&&ge.koDescendantsComplete&&(K=m.i.subscribe(O,m.i.pa,ge.koDescendantsComplete,ge)),U=ge,m.Oa(le,O)}})},null,{l:O}),{controlsDescendantBindings:!0}}},m.h.ea.component=!0}();var N={class:"className",for:"htmlFor"};m.c.attr={update:function(_,w){var P=m.a.f(w())||{};m.a.P(P,function(O,F){F=m.a.f(F);var V=O.indexOf(":"),V="lookupNamespaceURI"in _&&0<V&&_.lookupNamespaceURI(O.substr(0,V)),G=F===!1||F===null||F===e;G?V?_.removeAttributeNS(V,O):_.removeAttribute(O):F=F.toString(),8>=m.a.W&&O in N?(O=N[O],G?_.removeAttribute(O):_[O]=F):G||(V?_.setAttributeNS(V,O,F):_.setAttribute(O,F)),O==="name"&&m.a.Yc(_,G?"":F)})}},function(){m.c.checked={after:["value","attr"],init:function(_,w,P){function O(){var Y=_.checked,Z=V();if(!m.S.Ya()&&(Y||!z&&!m.S.qa())){var ee=m.u.G(w);if(U){var me=q?ee.v():ee,be=te;te=Z,be!==Z?Y&&(m.a.Na(me,Z,!0),m.a.Na(me,be,!1)):m.a.Na(me,Z,Y),q&&m.Za(ee)&&ee(me)}else G&&(Z===e?Z=Y:Y||(Z=e)),m.m.eb(ee,P,"checked",Z,!0)}}function F(){var Y=m.a.f(w()),Z=V();U?(_.checked=0<=m.a.A(Y,Z),te=Z):_.checked=G&&Z===e?!!Y:V()===Y}var V=m.xb(function(){if(P.has("checkedValue"))return m.a.f(P.get("checkedValue"));if(K)return P.has("value")?m.a.f(P.get("value")):_.value}),G=_.type=="checkbox",z=_.type=="radio";if(G||z){var W=w(),U=G&&m.a.f(W)instanceof Array,q=!(U&&W.push&&W.splice),K=z||U,te=U?V():e;z&&!_.name&&m.c.uniqueName.init(_,function(){return!0}),m.o(O,null,{l:_}),m.a.B(_,"click",O),m.o(F,null,{l:_}),W=e}}},m.m.wa.checked=!0,m.c.checkedValue={update:function(_,w){_.value=m.a.f(w())}}}(),m.c.class={update:function(_,w){var P=m.a.Db(m.a.f(w()));m.a.Eb(_,_.__ko__cssValue,!1),_.__ko__cssValue=P,m.a.Eb(_,P,!0)}},m.c.css={update:function(_,w){var P=m.a.f(w());P!==null&&typeof P=="object"?m.a.P(P,function(O,F){F=m.a.f(F),m.a.Eb(_,O,F)}):m.c.class.update(_,w)}},m.c.enable={update:function(_,w){var P=m.a.f(w());P&&_.disabled?_.removeAttribute("disabled"):P||_.disabled||(_.disabled=!0)}},m.c.disable={update:function(_,w){m.c.enable.update(_,function(){return!m.a.f(w())})}},m.c.event={init:function(_,w,P,O,F){var V=w()||{};m.a.P(V,function(G){typeof G=="string"&&m.a.B(_,G,function(z){var W,U=w()[G];if(U){try{var q=m.a.la(arguments);O=F.$data,q.unshift(O),W=U.apply(O,q)}finally{W!==!0&&(z.preventDefault?z.preventDefault():z.returnValue=!1)}P.get(G+"Bubble")===!1&&(z.cancelBubble=!0,z.stopPropagation&&z.stopPropagation())}})})}},m.c.foreach={Rc:function(_){return function(){var w=_(),P=m.a.bc(w);return!P||typeof P.length=="number"?{foreach:w,templateEngine:m.ba.Ma}:(m.a.f(w),{foreach:P.data,as:P.as,noChildContext:P.noChildContext,includeDestroyed:P.includeDestroyed,afterAdd:P.afterAdd,beforeRemove:P.beforeRemove,afterRender:P.afterRender,beforeMove:P.beforeMove,afterMove:P.afterMove,templateEngine:m.ba.Ma})}},init:function(_,w){return m.c.template.init(_,m.c.foreach.Rc(w))},update:function(_,w,P,O,F){return m.c.template.update(_,m.c.foreach.Rc(w),P,O,F)}},m.m.Ra.foreach=!1,m.h.ea.foreach=!0,m.c.hasfocus={init:function(_,w,P){function O(G){_.__ko_hasfocusUpdating=!0;var z=_.ownerDocument;if("activeElement"in z){var W;try{W=z.activeElement}catch{W=z.body}G=W===_}z=w(),m.m.eb(z,P,"hasfocus",G,!0),_.__ko_hasfocusLastValue=G,_.__ko_hasfocusUpdating=!1}var F=O.bind(null,!0),V=O.bind(null,!1);m.a.B(_,"focus",F),m.a.B(_,"focusin",F),m.a.B(_,"blur",V),m.a.B(_,"focusout",V),_.__ko_hasfocusLastValue=!1},update:function(_,w){var P=!!m.a.f(w());_.__ko_hasfocusUpdating||_.__ko_hasfocusLastValue===P||(P?_.focus():_.blur(),!P&&_.__ko_hasfocusLastValue&&_.ownerDocument.body.focus(),m.u.G(m.a.Fb,null,[_,P?"focusin":"focusout"]))}},m.m.wa.hasfocus=!0,m.c.hasFocus=m.c.hasfocus,m.m.wa.hasFocus="hasfocus",m.c.html={init:function(){return{controlsDescendantBindings:!0}},update:function(_,w){m.a.fc(_,w())}},function(){function _(w,P,O){m.c[w]={init:function(F,V,G,z,W){var U,q,K={},te,Y,Z;if(P){z=G.get("as");var ee=G.get("noChildContext");Z=!(z&&ee),K={as:z,noChildContext:ee,exportDependencies:Z}}return Y=(te=G.get("completeOn")=="render")||G.has(m.i.pa),m.o(function(){var me=m.a.f(V()),be=!O!=!me,le=!q,ge;(Z||be!==U)&&(Y&&(W=m.i.Cb(F,W)),be&&((!P||Z)&&(K.dataDependency=m.S.o()),ge=P?W.createChildContext(typeof me=="function"?me:V,K):m.S.qa()?W.extend(null,K):W),le&&m.S.qa()&&(q=m.a.Ca(m.h.childNodes(F),!0)),be?(le||m.h.va(F,m.a.Ca(q)),m.Oa(ge,F)):(m.h.Ea(F),te||m.i.ma(F,m.i.H)),U=be)},null,{l:F}),{controlsDescendantBindings:!0}}},m.m.Ra[w]=!1,m.h.ea[w]=!0}_("if"),_("ifnot",!1,!0),_("with",!0)}(),m.c.let={init:function(_,w,P,O,F){return w=F.extend(w),m.Oa(w,_),{controlsDescendantBindings:!0}}},m.h.ea.let=!0;var B={};m.c.options={init:function(_){if(m.a.R(_)!=="select")throw Error("options binding applies only to SELECT elements");for(;0<_.length;)_.remove(0);return{controlsDescendantBindings:!0}},update:function(_,w,P){function O(){return m.a.jb(_.options,function(ee){return ee.selected})}function F(ee,me,be){var le=typeof me;return le=="function"?me(ee):le=="string"?ee[me]:be}function V(ee,me){if(Y&&U)m.i.ma(_,m.i.H);else if(te.length){var be=0<=m.a.A(te,m.w.M(me[0]));m.a.Zc(me[0],be),Y&&!be&&m.u.G(m.a.Fb,null,[_,"change"])}}var G=_.multiple,z=_.length!=0&&G?_.scrollTop:null,W=m.a.f(w()),U=P.get("valueAllowUnset")&&P.has("value"),q=P.get("optionsIncludeDestroyed");w={};var K,te=[];U||(G?te=m.a.Mb(O(),m.w.M):0<=_.selectedIndex&&te.push(m.w.M(_.options[_.selectedIndex]))),W&&(typeof W.length>"u"&&(W=[W]),K=m.a.jb(W,function(ee){return q||ee===e||ee===null||!m.a.f(ee._destroy)}),P.has("optionsCaption")&&(W=m.a.f(P.get("optionsCaption")),W!==null&&W!==e&&K.unshift(B)));var Y=!1;if(w.beforeRemove=function(ee){_.removeChild(ee)},W=V,P.has("optionsAfterRender")&&typeof P.get("optionsAfterRender")=="function"&&(W=function(ee,me){V(0,me),m.u.G(P.get("optionsAfterRender"),null,[me[0],ee!==B?ee:e])}),m.a.ec(_,K,function(ee,me,be){return be.length&&(te=!U&&be[0].selected?[m.w.M(be[0])]:[],Y=!0),me=_.ownerDocument.createElement("option"),ee===B?(m.a.Bb(me,P.get("optionsCaption")),m.w.cb(me,e)):(be=F(ee,P.get("optionsValue"),ee),m.w.cb(me,m.a.f(be)),ee=F(ee,P.get("optionsText"),be),m.a.Bb(me,ee)),[me]},w,W),!U){var Z;G?Z=te.length&&O().length<te.length:Z=te.length&&0<=_.selectedIndex?m.w.M(_.options[_.selectedIndex])!==te[0]:te.length||0<=_.selectedIndex,Z&&m.u.G(m.a.Fb,null,[_,"change"])}(U||m.S.Ya())&&m.i.ma(_,m.i.H),m.a.wd(_),z&&20<Math.abs(z-_.scrollTop)&&(_.scrollTop=z)}},m.c.options.$b=m.a.g.Z(),m.c.selectedOptions={init:function(_,w,P){function O(){var G=w(),z=[];m.a.D(_.getElementsByTagName("option"),function(W){W.selected&&z.push(m.w.M(W))}),m.m.eb(G,P,"selectedOptions",z)}function F(){var G=m.a.f(w()),z=_.scrollTop;G&&typeof G.length=="number"&&m.a.D(_.getElementsByTagName("option"),function(W){var U=0<=m.a.A(G,m.w.M(W));W.selected!=U&&m.a.Zc(W,U)}),_.scrollTop=z}if(m.a.R(_)!="select")throw Error("selectedOptions binding applies only to SELECT elements");var V;m.i.subscribe(_,m.i.H,function(){V?O():(m.a.B(_,"change",O),V=m.o(F,null,{l:_}))},null,{notifyImmediately:!0})},update:function(){}},m.m.wa.selectedOptions=!0,m.c.style={update:function(_,w){var P=m.a.f(w()||{});m.a.P(P,function(O,F){if(F=m.a.f(F),(F===null||F===e||F===!1)&&(F=""),o)o(_).css(O,F);else if(/^--/.test(O))_.style.setProperty(O,F);else{O=O.replace(/-(\w)/g,function(G,z){return z.toUpperCase()});var V=_.style[O];_.style[O]=F,F===V||_.style[O]!=V||isNaN(F)||(_.style[O]=F+"px")}})}},m.c.submit={init:function(_,w,P,O,F){if(typeof w()!="function")throw Error("The value for a submit binding must be a function");m.a.B(_,"submit",function(V){var G,z=w();try{G=z.call(F.$data,_)}finally{G!==!0&&(V.preventDefault?V.preventDefault():V.returnValue=!1)}})}},m.c.text={init:function(){return{controlsDescendantBindings:!0}},update:function(_,w){m.a.Bb(_,w())}},m.h.ea.text=!0,function(){if(t&&t.navigator){var _=function(K){if(K)return parseFloat(K[1])},w=t.navigator.userAgent,P,O,F,V,G;(P=t.opera&&t.opera.version&&parseInt(t.opera.version()))||(G=_(w.match(/Edge\/([^ ]+)$/)))||_(w.match(/Chrome\/([^ ]+)/))||(O=_(w.match(/Version\/([^ ]+) Safari/)))||(F=_(w.match(/Firefox\/([^ ]+)/)))||(V=m.a.W||_(w.match(/MSIE ([^ ]+)/)))||(V=_(w.match(/rv:([^ )]+)/)))}if(8<=V&&10>V)var z=m.a.g.Z(),W=m.a.g.Z(),U=function(K){var te=this.activeElement;(te=te&&m.a.g.get(te,W))&&te(K)},q=function(K,te){var Y=K.ownerDocument;m.a.g.get(Y,z)||(m.a.g.set(Y,z,!0),m.a.B(Y,"selectionchange",U)),m.a.g.set(K,W,te)};m.c.textInput={init:function(K,te,Y){function Z(Ue,Ye){m.a.B(K,Ue,Ye)}function ee(){var Ue=m.a.f(te());(Ue===null||Ue===e)&&(Ue=""),xe!==e&&Ue===xe?m.a.setTimeout(ee,4):K.value!==Ue&&(Ee=!0,K.value=Ue,Ee=!1,le=K.value)}function me(){ge||(xe=K.value,ge=m.a.setTimeout(be,4))}function be(){clearTimeout(ge),xe=ge=e;var Ue=K.value;le!==Ue&&(le=Ue,m.m.eb(te(),Y,"textInput",Ue))}var le=K.value,ge,xe,Pe=m.a.W==9?me:be,Ee=!1;V&&Z("keypress",be),11>V&&Z("propertychange",function(Ue){Ee||Ue.propertyName!=="value"||Pe(Ue)}),V==8&&(Z("keyup",be),Z("keydown",be)),q&&(q(K,Pe),Z("dragend",me)),(!V||9<=V)&&Z("input",Pe),5>O&&m.a.R(K)==="textarea"?(Z("keydown",me),Z("paste",me),Z("cut",me)):11>P?Z("keydown",me):4>F?(Z("DOMAutoComplete",be),Z("dragdrop",be),Z("drop",be)):G&&K.type==="number"&&Z("keydown",me),Z("change",be),Z("blur",be),m.o(ee,null,{l:K})}},m.m.wa.textInput=!0,m.c.textinput={preprocess:function(K,te,Y){Y("textInput",K)}}}(),m.c.uniqueName={init:function(_,w){if(w()){var P="ko_unique_"+ ++m.c.uniqueName.rd;m.a.Yc(_,P)}}},m.c.uniqueName.rd=0,m.c.using={init:function(_,w,P,O,F){var V;return P.has("as")&&(V={as:P.get("as"),noChildContext:P.get("noChildContext")}),w=F.createChildContext(w,V),m.Oa(w,_),{controlsDescendantBindings:!0}}},m.h.ea.using=!0,m.c.value={init:function(_,w,P){var O=m.a.R(_),F=O=="input";if(!F||_.type!="checkbox"&&_.type!="radio"){var V=[],G=P.get("valueUpdate"),z=!1,W=null;G&&(typeof G=="string"?V=[G]:V=m.a.wc(G),m.a.Pa(V,"change"));var U=function(){W=null,z=!1;var te=w(),Y=m.w.M(_);m.m.eb(te,P,"value",Y)};!m.a.W||!F||_.type!="text"||_.autocomplete=="off"||_.form&&_.form.autocomplete=="off"||m.a.A(V,"propertychange")!=-1||(m.a.B(_,"propertychange",function(){z=!0}),m.a.B(_,"focus",function(){z=!1}),m.a.B(_,"blur",function(){z&&U()})),m.a.D(V,function(te){var Y=U;m.a.Ud(te,"after")&&(Y=function(){W=m.w.M(_),m.a.setTimeout(U,0)},te=te.substring(5)),m.a.B(_,te,Y)});var q;if(q=F&&_.type=="file"?function(){var te=m.a.f(w());te===null||te===e||te===""?_.value="":m.u.G(U)}:function(){var te=m.a.f(w()),Y=m.w.M(_);W!==null&&te===W?m.a.setTimeout(q,0):(te!==Y||Y===e)&&(O==="select"?(Y=P.get("valueAllowUnset"),m.w.cb(_,te,Y),Y||te===m.w.M(_)||m.u.G(U)):m.w.cb(_,te))},O==="select"){var K;m.i.subscribe(_,m.i.H,function(){K?P.get("valueAllowUnset")?q():U():(m.a.B(_,"change",U),K=m.o(q,null,{l:_}))},null,{notifyImmediately:!0})}else m.a.B(_,"change",U),m.o(q,null,{l:_})}else m.ib(_,{checkedValue:w})},update:function(){}},m.m.wa.value=!0,m.c.visible={update:function(_,w){var P=m.a.f(w()),O=_.style.display!="none";P&&!O?_.style.display="":!P&&O&&(_.style.display="none")}},m.c.hidden={update:function(_,w){m.c.visible.update(_,function(){return!m.a.f(w())})}},function(_){m.c[_]={init:function(w,P,O,F,V){return m.c.event.init.call(this,w,function(){var G={};return G[_]=P(),G},O,F,V)}}}("click"),m.ca=function(){},m.ca.prototype.renderTemplateSource=function(){throw Error("Override renderTemplateSource")},m.ca.prototype.createJavaScriptEvaluatorBlock=function(){throw Error("Override createJavaScriptEvaluatorBlock")},m.ca.prototype.makeTemplateSource=function(_,w){if(typeof _=="string"){w=w||n;var P=w.getElementById(_);if(!P)throw Error("Cannot find template with ID "+_);return new m.C.F(P)}if(_.nodeType==1||_.nodeType==8)return new m.C.ia(_);throw Error("Unknown template type: "+_)},m.ca.prototype.renderTemplate=function(_,w,P,O){return _=this.makeTemplateSource(_,O),this.renderTemplateSource(_,w,P,O)},m.ca.prototype.isTemplateRewritten=function(_,w){return this.allowTemplateRewriting===!1?!0:this.makeTemplateSource(_,w).data("isRewritten")},m.ca.prototype.rewriteTemplate=function(_,w,P){_=this.makeTemplateSource(_,P),w=w(_.text()),_.text(w),_.data("isRewritten",!0)},m.b("templateEngine",m.ca),m.kc=function(){function _(O,F,V,G){O=m.m.ac(O);for(var z=m.m.Ra,W=0;W<O.length;W++){var U=O[W].key;if(Object.prototype.hasOwnProperty.call(z,U)){var q=z[U];if(typeof q=="function"){if(U=q(O[W].value))throw Error(U)}else if(!q)throw Error("This template engine does not support the '"+U+"' binding within its templates")}}return V="ko.__tr_ambtns(function($context,$element){return(function(){return{ "+m.m.vb(O,{valueAccessors:!0})+" } })()},'"+V.toLowerCase()+"')",G.createJavaScriptEvaluatorBlock(V)+F}var w=/(<([a-z]+\d*)(?:\s+(?!data-bind\s*=\s*)[a-z0-9\-]+(?:=(?:\"[^\"]*\"|\'[^\']*\'|[^>]*))?)*\s+)data-bind\s*=\s*(["'])([\s\S]*?)\3/gi,P=/\x3c!--\s*ko\b\s*([\s\S]*?)\s*--\x3e/g;return{xd:function(O,F,V){F.isTemplateRewritten(O,V)||F.rewriteTemplate(O,function(G){return m.kc.Ld(G,F)},V)},Ld:function(O,F){return O.replace(w,function(V,G,z,W,U){return _(U,G,z,F)}).replace(P,function(V,G){return _(G,"<!-- ko -->","#comment",F)})},md:function(O,F){return m.aa.Xb(function(V,G){var z=V.nextSibling;z&&z.nodeName.toLowerCase()===F&&m.ib(z,O,G)})}}}(),m.b("__tr_ambtns",m.kc.md),function(){m.C={},m.C.F=function(P){if(this.F=P){var O=m.a.R(P);this.ab=O==="script"?1:O==="textarea"?2:O=="template"&&P.content&&P.content.nodeType===11?3:4}},m.C.F.prototype.text=function(){var P=this.ab===1?"text":this.ab===2?"value":"innerHTML";if(arguments.length==0)return this.F[P];var O=arguments[0];P==="innerHTML"?m.a.fc(this.F,O):this.F[P]=O};var _=m.a.g.Z()+"_";m.C.F.prototype.data=function(P){if(arguments.length===1)return m.a.g.get(this.F,_+P);m.a.g.set(this.F,_+P,arguments[1])};var w=m.a.g.Z();m.C.F.prototype.nodes=function(){var P=this.F;if(arguments.length==0){var O=m.a.g.get(P,w)||{},F=O.lb||(this.ab===3?P.content:this.ab===4?P:e);if(!F||O.jd){var V=this.text();V&&V!==O.bb&&(F=m.a.Md(V,P.ownerDocument),m.a.g.set(P,w,{lb:F,bb:V,jd:!0}))}return F}O=arguments[0],this.ab!==e&&this.text(""),m.a.g.set(P,w,{lb:O})},m.C.ia=function(P){this.F=P},m.C.ia.prototype=new m.C.F,m.C.ia.prototype.constructor=m.C.ia,m.C.ia.prototype.text=function(){if(arguments.length==0){var P=m.a.g.get(this.F,w)||{};return P.bb===e&&P.lb&&(P.bb=P.lb.innerHTML),P.bb}m.a.g.set(this.F,w,{bb:arguments[0]})},m.b("templateSources",m.C),m.b("templateSources.domElement",m.C.F),m.b("templateSources.anonymousTemplate",m.C.ia)}(),function(){function _(W,U,q){var K;for(U=m.h.nextSibling(U);W&&(K=W)!==U;)W=m.h.nextSibling(K),q(K,W)}function w(W,U){if(W.length){var q=W[0],K=W[W.length-1],te=q.parentNode,Y=m.ga.instance,Z=Y.preprocessNode;if(Z){if(_(q,K,function(ee,me){var be=ee.previousSibling,le=Z.call(Y,ee);le&&(ee===q&&(q=le[0]||me),ee===K&&(K=le[le.length-1]||be))}),W.length=0,!q)return;q===K?W.push(q):(W.push(q,K),m.a.Ua(W,te))}_(q,K,function(ee){ee.nodeType!==1&&ee.nodeType!==8||m.vc(U,ee)}),_(q,K,function(ee){ee.nodeType!==1&&ee.nodeType!==8||m.aa.cd(ee,[U])}),m.a.Ua(W,te)}}function P(W){return W.nodeType?W:0<W.length?W[0]:null}function O(W,U,q,K,te){te=te||{};var Y=(W&&P(W)||q||{}).ownerDocument,Z=te.templateEngine||V;if(m.kc.xd(q,Z,Y),q=Z.renderTemplate(q,K,te,Y),typeof q.length!="number"||0<q.length&&typeof q[0].nodeType!="number")throw Error("Template engine must return an array of DOM nodes");switch(Y=!1,U){case"replaceChildren":m.h.va(W,q),Y=!0;break;case"replaceNode":m.a.Xc(W,q),Y=!0;break;case"ignoreTargetNode":break;default:throw Error("Unknown renderMode: "+U)}return Y&&(w(q,K),te.afterRender&&m.u.G(te.afterRender,null,[q,K[te.as||"$data"]]),U=="replaceChildren"&&m.i.ma(W,m.i.H)),q}function F(W,U,q){return m.O(W)?W():typeof W=="function"?W(U,q):W}var V;m.gc=function(W){if(W!=e&&!(W instanceof m.ca))throw Error("templateEngine must inherit from ko.templateEngine");V=W},m.dc=function(W,U,q,K,te){if(q=q||{},(q.templateEngine||V)==e)throw Error("Set a template engine before calling renderTemplate");if(te=te||"replaceChildren",K){var Y=P(K);return m.$(function(){var ee=U&&U instanceof m.fa?U:new m.fa(U,null,null,null,{exportDependencies:!0}),Z=F(W,ee.$data,ee),ee=O(K,te,Z,ee,q);te=="replaceNode"&&(K=ee,Y=P(K))},null,{Sa:function(){return!Y||!m.a.Sb(Y)},l:Y&&te=="replaceNode"?Y.parentNode:Y})}return m.aa.Xb(function(Z){m.dc(W,U,q,Z,"replaceNode")})},m.Qd=function(W,U,q,K,te){function Y(xe,Pe){m.u.G(m.a.ec,null,[K,xe,ee,q,Z,Pe]),m.i.ma(K,m.i.H)}function Z(xe,Pe){w(Pe,me),q.afterRender&&q.afterRender(Pe,xe),me=null}function ee(xe,Pe){me=te.createChildContext(xe,{as:be,noChildContext:q.noChildContext,extend:function(Ue){Ue.$index=Pe,be&&(Ue[be+"Index"]=Pe)}});var Ee=F(W,xe,me);return O(K,"ignoreTargetNode",Ee,me,q)}var me,be=q.as,le=q.includeDestroyed===!1||m.options.foreachHidesDestroyed&&!q.includeDestroyed;if(le||q.beforeRemove||!m.Pc(U))return m.$(function(){var xe=m.a.f(U)||[];typeof xe.length>"u"&&(xe=[xe]),le&&(xe=m.a.jb(xe,function(Pe){return Pe===e||Pe===null||!m.a.f(Pe._destroy)})),Y(xe)},null,{l:K});Y(U.v());var ge=U.subscribe(function(xe){Y(U(),xe)},null,"arrayChange");return ge.l(K),ge};var G=m.a.g.Z(),z=m.a.g.Z();m.c.template={init:function(W,U){var q=m.a.f(U());if(typeof q=="string"||"name"in q)m.h.Ea(W);else if("nodes"in q){if(q=q.nodes||[],m.O(q))throw Error('The "nodes" option must be a plain, non-observable array.');var K=q[0]&&q[0].parentNode;K&&m.a.g.get(K,z)||(K=m.a.Yb(q),m.a.g.set(K,z,!0)),new m.C.ia(W).nodes(K)}else if(q=m.h.childNodes(W),0<q.length)K=m.a.Yb(q),new m.C.ia(W).nodes(K);else throw Error("Anonymous template defined, but no template content was provided");return{controlsDescendantBindings:!0}},update:function(W,U,q,K,te){var Y=U();U=m.a.f(Y),q=!0,K=null,typeof U=="string"?U={}:(Y="name"in U?U.name:W,"if"in U&&(q=m.a.f(U.if)),q&&"ifnot"in U&&(q=!m.a.f(U.ifnot)),q&&!Y&&(q=!1)),"foreach"in U?K=m.Qd(Y,q&&U.foreach||[],U,W,te):q?(q=te,"data"in U&&(q=te.createChildContext(U.data,{as:U.as,noChildContext:U.noChildContext,exportDependencies:!0})),K=m.dc(Y,q,U,W)):m.h.Ea(W),te=K,(U=m.a.g.get(W,G))&&typeof U.s=="function"&&U.s(),m.a.g.set(W,G,!te||te.ja&&!te.ja()?e:te)}},m.m.Ra.template=function(W){return W=m.m.ac(W),W.length==1&&W[0].unknown||m.m.Id(W,"name")?null:"This template engine does not support anonymous templates nested within its templates"},m.h.ea.template=!0}(),m.b("setTemplateEngine",m.gc),m.b("renderTemplate",m.dc),m.a.Kc=function(_,w,P){if(_.length&&w.length){var O,F,V,G,z;for(O=F=0;(!P||O<P)&&(G=_[F]);++F){for(V=0;z=w[V];++V)if(G.value===z.value){G.moved=z.index,z.moved=G.index,w.splice(V,1),O=V=0;break}O+=V}}},m.a.Pb=function(){function _(w,P,O,F,V){var G=Math.min,z=Math.max,W=[],U,q=w.length,K,te=P.length,Y=te-q||1,Z=q+te+1,ee,me,be;for(U=0;U<=q;U++)for(me=ee,W.push(ee=[]),be=G(te,U+Y),K=z(0,U-1);K<=be;K++)ee[K]=K?U?w[U-1]===P[K-1]?me[K-1]:G(me[K]||Z,ee[K-1]||Z)+1:K+1:U+1;for(G=[],z=[],Y=[],U=q,K=te;U||K;)te=W[U][K]-1,K&&te===W[U][K-1]?z.push(G[G.length]={status:O,value:P[--K],index:K}):U&&te===W[U-1][K]?Y.push(G[G.length]={status:F,value:w[--U],index:U}):(--K,--U,V.sparse||G.push({status:"retained",value:P[K]}));return m.a.Kc(Y,z,!V.dontLimitMoves&&10*q),G.reverse()}return function(w,P,O){return O=typeof O=="boolean"?{dontLimitMoves:O}:O||{},w=w||[],P=P||[],w.length<P.length?_(w,P,"added","deleted",O):_(P,w,"deleted","added",O)}}(),m.b("utils.compareArrays",m.a.Pb),function(){function _(O,F,V,G,z){var W=[],U=m.$(function(){var q=F(V,z,m.a.Ua(W,O))||[];0<W.length&&(m.a.Xc(W,q),G&&m.u.G(G,null,[V,q,z])),W.length=0,m.a.Nb(W,q)},null,{l:O,Sa:function(){return!m.a.kd(W)}});return{Y:W,$:U.ja()?U:e}}var w=m.a.g.Z(),P=m.a.g.Z();m.a.ec=function(O,F,V,G,z,W){function U(bt){Ee={Aa:bt,pb:m.ta(me++)},Z.push(Ee),Y||Pe.push(Ee)}function q(bt){Ee=te[bt],me!==Ee.pb.v()&&xe.push(Ee),Ee.pb(me++),m.a.Ua(Ee.Y,O),Z.push(Ee)}function K(bt,nn){if(bt)for(var Ae=0,Ce=nn.length;Ae<Ce;Ae++)m.a.D(nn[Ae].Y,function(rt){bt(rt,Ae,nn[Ae].Aa)})}F=F||[],typeof F.length>"u"&&(F=[F]),G=G||{};var te=m.a.g.get(O,w),Y=!te,Z=[],ee=0,me=0,be=[],le=[],ge=[],xe=[],Pe=[],Ee,Ue=0;if(Y)m.a.D(F,U);else{if(!W||te&&te._countWaitingForRemove){var Ye=m.a.Mb(te,function(bt){return bt.Aa});W=m.a.Pb(Ye,F,{dontLimitMoves:G.dontLimitMoves,sparse:!0})}for(var Ye=0,it,It,Ot;it=W[Ye];Ye++)switch(It=it.moved,Ot=it.index,it.status){case"deleted":for(;ee<Ot;)q(ee++);It===e&&(Ee=te[ee],Ee.$&&(Ee.$.s(),Ee.$=e),m.a.Ua(Ee.Y,O).length&&(G.beforeRemove&&(Z.push(Ee),Ue++,Ee.Aa===P?Ee=null:ge.push(Ee)),Ee&&be.push.apply(be,Ee.Y))),ee++;break;case"added":for(;me<Ot;)q(ee++);It!==e?(le.push(Z.length),q(It)):U(it.value)}for(;me<F.length;)q(ee++);Z._countWaitingForRemove=Ue}m.a.g.set(O,w,Z),K(G.beforeMove,xe),m.a.D(be,G.beforeRemove?m.oa:m.removeNode);var He,tn,dt;try{dt=O.ownerDocument.activeElement}catch{}if(le.length)for(;(Ye=le.shift())!=e;){for(Ee=Z[Ye],He=e;Ye;)if((tn=Z[--Ye].Y)&&tn.length){He=tn[tn.length-1];break}for(F=0;ee=Ee.Y[F];He=ee,F++)m.h.Wb(O,ee,He)}for(Ye=0;Ee=Z[Ye];Ye++){for(Ee.Y||m.a.extend(Ee,_(O,V,Ee.Aa,z,Ee.pb)),F=0;ee=Ee.Y[F];He=ee,F++)m.h.Wb(O,ee,He);!Ee.Ed&&z&&(z(Ee.Aa,Ee.Y,Ee.pb),Ee.Ed=!0,He=Ee.Y[Ee.Y.length-1])}for(dt&&O.ownerDocument.activeElement!=dt&&dt.focus(),K(G.beforeRemove,ge),Ye=0;Ye<ge.length;++Ye)ge[Ye].Aa=P;K(G.afterMove,xe),K(G.afterAdd,Pe)}}(),m.b("utils.setDomNodeChildrenFromArrayMapping",m.a.ec),m.ba=function(){this.allowTemplateRewriting=!1},m.ba.prototype=new m.ca,m.ba.prototype.constructor=m.ba,m.ba.prototype.renderTemplateSource=function(_,w,P,O){return(w=!(9>m.a.W)&&_.nodes?_.nodes():null)?m.a.la(w.cloneNode(!0).childNodes):(_=_.text(),m.a.ua(_,O))},m.ba.Ma=new m.ba,m.gc(m.ba.Ma),m.b("nativeTemplateEngine",m.ba),function(){m.$a=function(){var w=this.Hd=function(){if(!o||!o.tmpl)return 0;try{if(0<=o.tmpl.tag.tmpl.open.toString().indexOf("__"))return 2}catch{}return 1}();this.renderTemplateSource=function(P,O,F,V){if(V=V||n,F=F||{},2>w)throw Error("Your version of jQuery.tmpl is too old. Please upgrade to jQuery.tmpl 1.0.0pre or later.");var G=P.data("precompiled");return G||(G=P.text()||"",G=o.template(null,"{{ko_with $item.koBindingContext}}"+G+"{{/ko_with}}"),P.data("precompiled",G)),P=[O.$data],O=o.extend({koBindingContext:O},F.templateOptions),O=o.tmpl(G,P,O),O.appendTo(V.createElement("div")),o.fragments={},O},this.createJavaScriptEvaluatorBlock=function(P){return"{{ko_code ((function() { return "+P+" })()) }}"},this.addTemplate=function(P,O){n.write("<script type='text/html' id='"+P+"'>"+O+"<\/script>")},0<w&&(o.tmpl.tag.ko_code={open:"__.push($1 || '');"},o.tmpl.tag.ko_with={open:"with($1) {",close:"} "})},m.$a.prototype=new m.ca,m.$a.prototype.constructor=m.$a;var _=new m.$a;0<_.Hd&&m.gc(_),m.b("jqueryTmplTemplateEngine",m.$a)}()})})()})()})();var qAt=ko;typeof window<"u"?(ko=window.ko,typeof PP<"u"?window.ko=PP:delete window.ko):(ko=global.ko,typeof PP<"u"?global.ko=PP:delete global.ko);var IP=qAt;/**
 * @license
 * Knockout ES5 plugin - https://github.com/SteveSanderson/knockout-es5
 * Copyright (c) Steve Sanderson
 * MIT license
 */var DK="__knockoutObservables",PK="__knockoutSubscribable";function ATe(e,t){if(!e)throw new Error("When calling ko.track, you must pass an object as the first parameter.");var n=this,i=CTe(e,!0);return t=t||Object.getOwnPropertyNames(e),t.forEach(function(o){if(!(o===DK||o===PK)&&!(o in i)){var r=e[o],s=r instanceof Array,a=n.isObservable(r)?r:s?n.observableArray(r):n.observable(r);Object.defineProperty(e,o,{configurable:!0,enumerable:!0,get:a,set:n.isWriteableObservable(a)?a:void 0}),i[o]=a,s&&XAt(n,a)}}),e}function CTe(e,t){var n=e[DK];return!n&&t&&(n={},Object.defineProperty(e,DK,{value:n})),n}function YAt(e,t,n){var i=this,o={owner:e,deferEvaluation:!0};if(typeof n=="function")o.read=n;else{if("value"in n)throw new Error('For ko.defineProperty, you must not specify a "value" for the property. You must provide a "get" function.');if(typeof n.get!="function")throw new Error('For ko.defineProperty, the third parameter must be either an evaluator function, or an options object containing a function called "get".');o.read=n.get,o.write=n.set}return e[t]=i.computed(o),ATe.call(i,e,[t]),e}function XAt(e,t){var n=null;e.computed(function(){n&&(n.dispose(),n=null);var i=t();i instanceof Array&&(n=KAt(e,t,i))})}function KAt(e,t,n){var i=$At(e,n);return i.subscribe(t)}function $At(e,t){var n=t[PK];if(!n){n=new e.subscribable,Object.defineProperty(t,PK,{value:n});var i={};ZAt(t,n,i),JAt(e,t,n,i)}return n}function ZAt(e,t,n){["pop","push","reverse","shift","sort","splice","unshift"].forEach(function(i){var o=e[i];e[i]=function(){var r=o.apply(this,arguments);return n.pause!==!0&&t.notifySubscribers(this),r}})}function JAt(e,t,n,i){["remove","removeAll","destroy","destroyAll","replace"].forEach(function(o){Object.defineProperty(t,o,{enumerable:!1,value:function(){var r;i.pause=!0;try{r=e.observableArray.fn[o].apply(e.observableArray(t),arguments)}finally{i.pause=!1}return n.notifySubscribers(t),r}})})}function ETe(e,t){if(!e)return null;var n=CTe(e,!1);return n&&n[t]||null}function QAt(e,t){var n=ETe(e,t);n&&n.valueHasMutated()}function eCt(e){e.track=ATe,e.getObservable=ETe,e.valueHasMutated=QAt,e.defineProperty=YAt}var IK={attachToKo:eCt};var STe="http://www.w3.org/2000/svg",wTe="cesium-svgPath-svg",tCt={register:function(e){e.bindingHandlers.cesiumSvgPath={init:function(t,n){let i=document.createElementNS(STe,"svg:svg");i.setAttribute("class",wTe);let o=document.createElementNS(STe,"path");return i.appendChild(o),e.virtualElements.setDomNodeChildren(t,[i]),e.computed({read:function(){let r=e.unwrap(n());o.setAttribute("d",e.unwrap(r.path));let s=e.unwrap(r.width),a=e.unwrap(r.height);i.setAttribute("width",s),i.setAttribute("height",a),i.setAttribute("viewBox",`0 0 ${s} ${a}`),r.css&&i.setAttribute("class",`${wTe} ${e.unwrap(r.css)}`)},disposeWhenNodeIsRemoved:t}),{controlsDescendantBindings:!0}}},e.virtualElements.allowedBindings.cesiumSvgPath=!0}},OK=tCt;IK.attachToKo(IP);OK.register(IP);var Te=IP;function OP(e){c(e)||(e=new Oh),this._clock=e,this._eventHelper=new yr,this._eventHelper.add(e.onTick,this.synchronize,this),this.systemTime=Te.observable(J.now()),this.systemTime.equalityComparer=J.equals,this.startTime=Te.observable(e.startTime),this.startTime.equalityComparer=J.equals,this.startTime.subscribe(function(t){e.startTime=t,this.synchronize()},this),this.stopTime=Te.observable(e.stopTime),this.stopTime.equalityComparer=J.equals,this.stopTime.subscribe(function(t){e.stopTime=t,this.synchronize()},this),this.currentTime=Te.observable(e.currentTime),this.currentTime.equalityComparer=J.equals,this.currentTime.subscribe(function(t){e.currentTime=t,this.synchronize()},this),this.multiplier=Te.observable(e.multiplier),this.multiplier.subscribe(function(t){e.multiplier=t,this.synchronize()},this),this.clockStep=Te.observable(e.clockStep),this.clockStep.subscribe(function(t){e.clockStep=t,this.synchronize()},this),this.clockRange=Te.observable(e.clockRange),this.clockRange.subscribe(function(t){e.clockRange=t,this.synchronize()},this),this.canAnimate=Te.observable(e.canAnimate),this.canAnimate.subscribe(function(t){e.canAnimate=t,this.synchronize()},this),this.shouldAnimate=Te.observable(e.shouldAnimate),this.shouldAnimate.subscribe(function(t){e.shouldAnimate=t,this.synchronize()},this),Te.track(this,["systemTime","startTime","stopTime","currentTime","multiplier","clockStep","clockRange","canAnimate","shouldAnimate"])}Object.defineProperties(OP.prototype,{clock:{get:function(){return this._clock}}});OP.prototype.synchronize=function(){let e=this._clock;this.systemTime=J.now(),this.startTime=e.startTime,this.stopTime=e.stopTime,this.currentTime=e.currentTime,this.multiplier=e.multiplier,this.clockStep=e.clockStep,this.clockRange=e.clockRange,this.canAnimate=e.canAnimate,this.shouldAnimate=e.shouldAnimate};OP.prototype.isDestroyed=function(){return!1};OP.prototype.destroy=function(){this._eventHelper.removeAll(),de(this)};var RK=OP;function nCt(){this.canExecute=void 0,this.beforeExecute=void 0,this.afterExecute=void 0,E.throwInstantiationError()}var iCt=nCt;function oCt(e,t){if(!c(e))throw new E("func is required.");t=y(t,!0);let n=new pe,i=new pe;function o(){if(!o.canExecute)throw new E("Cannot execute command, canExecute is false.");let r={args:arguments,cancel:!1},s;return n.raiseEvent(r),r.cancel||(s=e.apply(null,arguments),i.raiseEvent(s)),s}return o.canExecute=t,Te.track(o,["canExecute"]),Object.defineProperties(o,{beforeExecute:{value:n},afterExecute:{value:i}}),o}var vn=oCt;var RP={};RP.createCheckbox=function(e,t,n){A.typeOf.string("labelText",e),A.typeOf.string("checkedBinding",t);let i=document.createElement("div"),o=document.createElement("label"),r=document.createElement("input");r.type="checkbox";let s=`checked: ${t}`;return c(n)&&(s+=`, enable: ${n}`),r.setAttribute("data-bind",s),o.appendChild(r),o.appendChild(document.createTextNode(e)),i.appendChild(o),i};RP.createSection=function(e,t,n,i){A.defined("panel",e),A.typeOf.string("headerText",t),A.typeOf.string("sectionVisibleBinding",n),A.typeOf.string("toggleSectionVisibilityBinding",i);let o=document.createElement("div");o.className="cesium-cesiumInspector-section",o.setAttribute("data-bind",`css: { "cesium-cesiumInspector-section-collapsed": !${n} }`),e.appendChild(o);let r=document.createElement("h3");r.className="cesium-cesiumInspector-sectionHeader",r.appendChild(document.createTextNode(t)),r.setAttribute("data-bind",`click: ${i}`),o.appendChild(r);let s=document.createElement("div");return s.className="cesium-cesiumInspector-sectionContent",o.appendChild(s),s};RP.createRangeInput=function(e,t,n,i,o,r){A.typeOf.string("rangeText",e),A.typeOf.string("sliderValueBinding",t),A.typeOf.number("min",n),A.typeOf.number("max",i),r=y(r,t);let s=document.createElement("input");s.setAttribute("data-bind",`value: ${r}`),s.type="number";let a=document.createElement("input");a.type="range",a.min=n,a.max=i,a.step=y(o,"any"),a.setAttribute("data-bind",`valueUpdate: "input", value: ${t}`);let l=document.createElement("div");l.appendChild(a);let u=document.createElement("div");return u.className="cesium-cesiumInspector-slider",u.appendChild(document.createTextNode(e)),u.appendChild(s),u.appendChild(l),u};RP.createButton=function(e,t,n){A.typeOf.string("buttonText",e),A.typeOf.string("clickedBinding",t);let i=document.createElement("button");i.type="button",i.textContent=e,i.className="cesium-cesiumInspector-pickButton";let o=`click: ${t}`;return c(n)&&(o+=`, css: {"cesium-cesiumInspector-pickButtonHighlight" : ${n}}`),i.setAttribute("data-bind",o),i};var Vc=RP;function rCt(e,t,n,i,o){return n.call(i,e[t]),Te.getObservable(e,t).subscribe(n,i,o)}var ac=rCt;function vTe(e,t){if(!c(e))throw new E("command is required.");this._command=e,t=y(t,y.EMPTY_OBJECT),this.toggled=y(t.toggled,!1),this.tooltip=y(t.tooltip,""),Te.track(this,["toggled","tooltip"])}Object.defineProperties(vTe.prototype,{command:{get:function(){return this._command}}});var JC=vTe;var _x="http://www.w3.org/2000/svg",ITe="http://www.w3.org/1999/xlink",DF,MP=j.fromCssColorString("rgba(247,250,255,0.384)"),PF=j.fromCssColorString("rgba(143,191,255,0.216)"),MK=j.fromCssColorString("rgba(153,197,255,0.098)"),IF=j.fromCssColorString("rgba(255,255,255,0.086)"),sCt=j.fromCssColorString("rgba(255,255,255,0.267)"),aCt=j.fromCssColorString("rgba(255,255,255,0)"),DTe=j.fromCssColorString("rgba(66,67,68,0.3)"),PTe=j.fromCssColorString("rgba(0,0,0,0.5)");function Sy(e){return j.fromCssColorString(window.getComputedStyle(e).getPropertyValue("color"))}var LP={animation_pathReset:{tagName:"path",transform:"translate(16,16) scale(0.85) translate(-16,-16)",d:"M24.316,5.318,9.833,13.682,9.833,5.5,5.5,5.5,5.5,25.5,9.833,25.5,9.833,17.318,24.316,25.682z"},animation_pathPause:{tagName:"path",transform:"translate(16,16) scale(0.85) translate(-16,-16)",d:"M13,5.5,7.5,5.5,7.5,25.5,13,25.5zM24.5,5.5,19,5.5,19,25.5,24.5,25.5z"},animation_pathPlay:{tagName:"path",transform:"translate(16,16) scale(0.85) translate(-16,-16)",d:"M6.684,25.682L24.316,15.5L6.684,5.318V25.682z"},animation_pathPlayReverse:{tagName:"path",transform:"translate(16,16) scale(-0.85,0.85) translate(-16,-16)",d:"M6.684,25.682L24.316,15.5L6.684,5.318V25.682z"},animation_pathLoop:{tagName:"path",transform:"translate(16,16) scale(0.85) translate(-16,-16)",d:"M24.249,15.499c-0.009,4.832-3.918,8.741-8.75,8.75c-2.515,0-4.768-1.064-6.365-2.763l2.068-1.442l-7.901-3.703l0.744,8.694l2.193-1.529c2.244,2.594,5.562,4.242,9.26,4.242c6.767,0,12.249-5.482,12.249-12.249H24.249zM15.499,6.75c2.516,0,4.769,1.065,6.367,2.764l-2.068,1.443l7.901,3.701l-0.746-8.693l-2.192,1.529c-2.245-2.594-5.562-4.245-9.262-4.245C8.734,3.25,3.25,8.734,3.249,15.499H6.75C6.758,10.668,10.668,6.758,15.499,6.75z"},animation_pathClock:{tagName:"path",transform:"translate(16,16) scale(0.85) translate(-16,-15.5)",d:"M15.5,2.374C8.251,2.375,2.376,8.251,2.374,15.5C2.376,22.748,8.251,28.623,15.5,28.627c7.249-0.004,13.124-5.879,13.125-13.127C28.624,8.251,22.749,2.375,15.5,2.374zM15.5,25.623C9.909,25.615,5.385,21.09,5.375,15.5C5.385,9.909,9.909,5.384,15.5,5.374c5.59,0.01,10.115,4.535,10.124,10.125C25.615,21.09,21.091,25.615,15.5,25.623zM8.625,15.5c-0.001-0.552-0.448-0.999-1.001-1c-0.553,0-1,0.448-1,1c0,0.553,0.449,1,1,1C8.176,16.5,8.624,16.053,8.625,15.5zM8.179,18.572c-0.478,0.277-0.642,0.889-0.365,1.367c0.275,0.479,0.889,0.641,1.365,0.365c0.479-0.275,0.643-0.887,0.367-1.367C9.27,18.461,8.658,18.297,8.179,18.572zM9.18,10.696c-0.479-0.276-1.09-0.112-1.366,0.366s-0.111,1.09,0.365,1.366c0.479,0.276,1.09,0.113,1.367-0.366C9.821,11.584,9.657,10.973,9.18,10.696zM22.822,12.428c0.478-0.275,0.643-0.888,0.366-1.366c-0.275-0.478-0.89-0.642-1.366-0.366c-0.479,0.278-0.642,0.89-0.366,1.367C21.732,12.54,22.344,12.705,22.822,12.428zM12.062,21.455c-0.478-0.275-1.089-0.111-1.366,0.367c-0.275,0.479-0.111,1.09,0.366,1.365c0.478,0.277,1.091,0.111,1.365-0.365C12.704,22.344,12.54,21.732,12.062,21.455zM12.062,9.545c0.479-0.276,0.642-0.888,0.366-1.366c-0.276-0.478-0.888-0.642-1.366-0.366s-0.642,0.888-0.366,1.366C10.973,9.658,11.584,9.822,12.062,9.545zM22.823,18.572c-0.48-0.275-1.092-0.111-1.367,0.365c-0.275,0.479-0.112,1.092,0.367,1.367c0.477,0.275,1.089,0.113,1.365-0.365C23.464,19.461,23.3,18.848,22.823,18.572zM19.938,7.813c-0.477-0.276-1.091-0.111-1.365,0.366c-0.275,0.48-0.111,1.091,0.366,1.367s1.089,0.112,1.366-0.366C20.581,8.702,20.418,8.089,19.938,7.813zM23.378,14.5c-0.554,0.002-1.001,0.45-1.001,1c0.001,0.552,0.448,1,1.001,1c0.551,0,1-0.447,1-1C24.378,14.949,23.929,14.5,23.378,14.5zM15.501,6.624c-0.552,0-1,0.448-1,1l-0.466,7.343l-3.004,1.96c-0.478,0.277-0.642,0.889-0.365,1.365c0.275,0.479,0.889,0.643,1.365,0.367l3.305-1.676C15.39,16.99,15.444,17,15.501,17c0.828,0,1.5-0.671,1.5-1.5l-0.5-7.876C16.501,7.072,16.053,6.624,15.501,6.624zM15.501,22.377c-0.552,0-1,0.447-1,1s0.448,1,1,1s1-0.447,1-1S16.053,22.377,15.501,22.377zM18.939,21.455c-0.479,0.277-0.643,0.889-0.366,1.367c0.275,0.477,0.888,0.643,1.366,0.365c0.478-0.275,0.642-0.889,0.366-1.365C20.028,21.344,19.417,21.18,18.939,21.455z"},animation_pathWingButton:{tagName:"path",d:"m 4.5,0.5 c -2.216,0 -4,1.784 -4,4 l 0,24 c 0,2.216 1.784,4 4,4 l 13.71875,0 C 22.478584,27.272785 27.273681,22.511272 32.5,18.25 l 0,-13.75 c 0,-2.216 -1.784,-4 -4,-4 l -24,0 z"},animation_pathPointer:{tagName:"path",d:"M-15,-65,-15,-55,15,-55,15,-65,0,-95z"},animation_pathSwooshFX:{tagName:"path",d:"m 85,0 c 0,16.617 -4.813944,35.356 -13.131081,48.4508 h 6.099803 c 8.317138,-13.0948 13.13322,-28.5955 13.13322,-45.2124 0,-46.94483 -38.402714,-85.00262 -85.7743869,-85.00262 -1.0218522,0 -2.0373001,0.0241 -3.0506131,0.0589 45.958443,1.59437 82.723058,35.77285 82.723058,81.70532 z"}};function $d(e){let t=document.createElementNS(_x,e.tagName);for(let n in e)if(e.hasOwnProperty(n)&&n!=="tagName")if(n==="children"){let i=e.children.length;for(let o=0;o<i;++o)t.appendChild($d(e.children[o]))}else n.indexOf("xlink:")===0?t.setAttributeNS(ITe,n.substring(6),e[n]):n==="textContent"?t.textContent=e[n]:t.setAttribute(n,e[n]);return t}function LK(e,t,n){let i=document.createElementNS(_x,"text");i.setAttribute("x",e),i.setAttribute("y",t),i.setAttribute("class","cesium-animation-svgText");let o=document.createElementNS(_x,"tspan");return o.textContent=n,i.appendChild(o),i}function cCt(e,t,n){e.setAttribute("transform",`translate(100,100) rotate(${n})`),t.setAttribute("transform",`rotate(${n})`)}var OF=new j;function Xr(e,t){let n=t.alpha,i=1-n;return OF.red=e.red*i+t.red*n,OF.green=e.green*i+t.green*n,OF.blue=e.blue*i+t.blue*n,OF.toCssColorString()}function NK(e,t,n){let i=LP[n],o={tagName:"g",class:"cesium-animation-rectButton",transform:`translate(${e},${t})`,children:[{tagName:"rect",class:"cesium-animation-buttonGlow",width:32,height:32,rx:2,ry:2},{tagName:"rect",class:"cesium-animation-buttonMain",width:32,height:32,rx:4,ry:4},{class:"cesium-animation-buttonPath",id:n,tagName:i.tagName,transform:i.transform,d:i.d},{tagName:"title",textContent:""}]};return $d(o)}function lCt(e,t,n){let i=LP[n],o=LP.animation_pathWingButton,r={tagName:"g",class:"cesium-animation-rectButton",transform:`translate(${e},${t})`,children:[{class:"cesium-animation-buttonGlow",id:"animation_pathWingButton",tagName:o.tagName,d:o.d},{class:"cesium-animation-buttonMain",id:"animation_pathWingButton",tagName:o.tagName,d:o.d},{class:"cesium-animation-buttonPath",id:n,tagName:i.tagName,transform:i.transform,d:i.d},{tagName:"title",textContent:""}]};return $d(r)}function uCt(e,t){let n=e._viewModel,i=n.shuttleRingDragging;if(!(i&&DF!==e))if(t.type==="mousedown"||i&&t.type==="mousemove"||t.type==="touchstart"&&t.touches.length===1||i&&t.type==="touchmove"&&t.touches.length===1){let o=e._centerX,r=e._centerY,a=e._svgNode.getBoundingClientRect(),l,u;if(t.type==="touchstart"||t.type==="touchmove"?(l=t.touches[0].clientX,u=t.touches[0].clientY):(l=t.clientX,u=t.clientY),!i&&(l>a.right||l<a.left||u<a.top||u>a.bottom))return;let f=e._shuttleRingPointer.getBoundingClientRect(),d=l-o-a.left,p=u-r-a.top,g=Math.atan2(p,d)*180/Math.PI+90;g>180&&(g-=360);let m=n.shuttleRingAngle;i||l<f.right&&l>f.left&&u>f.top&&u<f.bottom?(DF=e,n.shuttleRingDragging=!0,n.shuttleRingAngle=g):g<m?n.slower():g>m&&n.faster(),t.preventDefault()}else e===DF&&(DF=void 0),n.shuttleRingDragging=!1}function u_(e,t){this._viewModel=t,this.svgElement=e,this._enabled=void 0,this._toggled=void 0;let n=this;this._clickFunction=function(){let i=n._viewModel.command;i.canExecute&&i()},e.addEventListener("click",this._clickFunction,!0),this._subscriptions=[ac(t,"toggled",this.setToggled,this),ac(t,"tooltip",this.setTooltip,this),ac(t.command,"canExecute",this.setEnabled,this)]}u_.prototype.destroy=function(){this.svgElement.removeEventListener("click",this._clickFunction,!0);let e=this._subscriptions;for(let t=0,n=e.length;t<n;t++)e[t].dispose();de(this)};u_.prototype.isDestroyed=function(){return!1};u_.prototype.setEnabled=function(e){if(this._enabled!==e){if(this._enabled=e,!e){this.svgElement.setAttribute("class","cesium-animation-buttonDisabled");return}if(this._toggled){this.svgElement.setAttribute("class","cesium-animation-rectButton cesium-animation-buttonToggled");return}this.svgElement.setAttribute("class","cesium-animation-rectButton")}};u_.prototype.setToggled=function(e){this._toggled!==e&&(this._toggled=e,this._enabled&&(e?this.svgElement.setAttribute("class","cesium-animation-rectButton cesium-animation-buttonToggled"):this.svgElement.setAttribute("class","cesium-animation-rectButton")))};u_.prototype.setTooltip=function(e){this.svgElement.getElementsByTagName("title")[0].textContent=e};function QC(e,t){if(!c(e))throw new E("container is required.");if(!c(t))throw new E("viewModel is required.");e=On(e),this._viewModel=t,this._container=e,this._centerX=0,this._centerY=0,this._defsElement=void 0,this._svgNode=void 0,this._topG=void 0,this._lastHeight=void 0,this._lastWidth=void 0;let n=e.ownerDocument,i=document.createElement("style");i.textContent=".cesium-animation-rectButton .cesium-animation-buttonGlow { filter: url(#animation_blurred); }.cesium-animation-rectButton .cesium-animation-buttonMain { fill: url(#animation_buttonNormal); }.cesium-animation-buttonToggled .cesium-animation-buttonMain { fill: url(#animation_buttonToggled); }.cesium-animation-rectButton:hover .cesium-animation-buttonMain { fill: url(#animation_buttonHovered); }.cesium-animation-buttonDisabled .cesium-animation-buttonMain { fill: url(#animation_buttonDisabled); }.cesium-animation-shuttleRingG .cesium-animation-shuttleRingSwoosh { fill: url(#animation_shuttleRingSwooshGradient); }.cesium-animation-shuttleRingG:hover .cesium-animation-shuttleRingSwoosh { fill: url(#animation_shuttleRingSwooshHovered); }.cesium-animation-shuttleRingPointer { fill: url(#animation_shuttleRingPointerGradient); }.cesium-animation-shuttleRingPausePointer { fill: url(#animation_shuttleRingPointerPaused); }.cesium-animation-knobOuter { fill: url(#animation_knobOuter); }.cesium-animation-knobInner { fill: url(#animation_knobInner); }",n.head.insertBefore(i,n.head.childNodes[0]);let o=document.createElement("div");o.className="cesium-animation-theme",o.innerHTML='<div class="cesium-animation-themeNormal"></div><div class="cesium-animation-themeHover"></div><div class="cesium-animation-themeSelect"></div><div class="cesium-animation-themeDisabled"></div><div class="cesium-animation-themeKnob"></div><div class="cesium-animation-themePointer"></div><div class="cesium-animation-themeSwoosh"></div><div class="cesium-animation-themeSwooshHover"></div>',this._theme=o,this._themeNormal=o.childNodes[0],this._themeHover=o.childNodes[1],this._themeSelect=o.childNodes[2],this._themeDisabled=o.childNodes[3],this._themeKnob=o.childNodes[4],this._themePointer=o.childNodes[5],this._themeSwoosh=o.childNodes[6],this._themeSwooshHover=o.childNodes[7];let r=document.createElementNS(_x,"svg:svg");this._svgNode=r,r.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink",ITe);let s=document.createElementNS(_x,"g");this._topG=s,this._realtimeSVG=new u_(lCt(3,4,"animation_pathClock"),t.playRealtimeViewModel),this._playReverseSVG=new u_(NK(44,99,"animation_pathPlayReverse"),t.playReverseViewModel),this._playForwardSVG=new u_(NK(124,99,"animation_pathPlay"),t.playForwardViewModel),this._pauseSVG=new u_(NK(84,99,"animation_pathPause"),t.pauseViewModel);let a=document.createElementNS(_x,"g");a.appendChild(this._realtimeSVG.svgElement),a.appendChild(this._playReverseSVG.svgElement),a.appendChild(this._playForwardSVG.svgElement),a.appendChild(this._pauseSVG.svgElement);let l=$d({tagName:"circle",class:"cesium-animation-shuttleRingBack",cx:100,cy:100,r:99});this._shuttleRingBackPanel=l;let u=LP.animation_pathSwooshFX,f=LP.animation_pathPointer,d=$d({tagName:"g",class:"cesium-animation-shuttleRingSwoosh",children:[{tagName:u.tagName,transform:"translate(100,97) scale(-1,1)",id:"animation_pathSwooshFX",d:u.d},{tagName:u.tagName,transform:"translate(100,97)",id:"animation_pathSwooshFX",d:u.d},{tagName:"line",x1:100,y1:8,x2:100,y2:22}]});this._shuttleRingSwooshG=d,this._shuttleRingPointer=$d({class:"cesium-animation-shuttleRingPointer",id:"animation_pathPointer",tagName:f.tagName,d:f.d});let p=$d({tagName:"g",transform:"translate(100,100)"});this._knobOuter=$d({tagName:"circle",class:"cesium-animation-knobOuter",cx:0,cy:0,r:71});let g=61,m=$d({tagName:"circle",class:"cesium-animation-knobInner",cx:0,cy:0,r:g});this._knobDate=LK(0,-24,""),this._knobTime=LK(0,-7,""),this._knobStatus=LK(0,-41,"");let b=$d({tagName:"circle",class:"cesium-animation-blank",cx:0,cy:0,r:g}),x=document.createElementNS(_x,"g");x.setAttribute("class","cesium-animation-shuttleRingG"),e.appendChild(o),s.appendChild(x),s.appendChild(p),s.appendChild(a),x.appendChild(l),x.appendChild(d),x.appendChild(this._shuttleRingPointer),p.appendChild(this._knobOuter),p.appendChild(m),p.appendChild(this._knobDate),p.appendChild(this._knobTime),p.appendChild(this._knobStatus),p.appendChild(b),r.appendChild(s),e.appendChild(r);let T=this;function C(L){uCt(T,L)}this._mouseCallback=C,l.addEventListener("mousedown",C,!0),l.addEventListener("touchstart",C,!0),d.addEventListener("mousedown",C,!0),d.addEventListener("touchstart",C,!0),n.addEventListener("mousemove",C,!0),n.addEventListener("touchmove",C,!0),n.addEventListener("mouseup",C,!0),n.addEventListener("touchend",C,!0),n.addEventListener("touchcancel",C,!0),this._shuttleRingPointer.addEventListener("mousedown",C,!0),this._shuttleRingPointer.addEventListener("touchstart",C,!0),this._knobOuter.addEventListener("mousedown",C,!0),this._knobOuter.addEventListener("touchstart",C,!0);let S=this._knobTime.childNodes[0],v=this._knobDate.childNodes[0],D=this._knobStatus.childNodes[0],I;this._subscriptions=[ac(t.pauseViewModel,"toggled",function(L){I!==L&&(I=L,I?T._shuttleRingPointer.setAttribute("class","cesium-animation-shuttleRingPausePointer"):T._shuttleRingPointer.setAttribute("class","cesium-animation-shuttleRingPointer"))}),ac(t,"shuttleRingAngle",function(L){cCt(T._shuttleRingPointer,T._knobOuter,L)}),ac(t,"dateLabel",function(L){v.textContent!==L&&(v.textContent=L)}),ac(t,"timeLabel",function(L){S.textContent!==L&&(S.textContent=L)}),ac(t,"multiplierLabel",function(L){D.textContent!==L&&(D.textContent=L)})],this.applyThemeChanges(),this.resize()}Object.defineProperties(QC.prototype,{container:{get:function(){return this._container}},viewModel:{get:function(){return this._viewModel}}});QC.prototype.isDestroyed=function(){return!1};QC.prototype.destroy=function(){c(this._observer)&&(this._observer.disconnect(),this._observer=void 0);let e=this._container.ownerDocument,t=this._mouseCallback;this._shuttleRingBackPanel.removeEventListener("mousedown",t,!0),this._shuttleRingBackPanel.removeEventListener("touchstart",t,!0),this._shuttleRingSwooshG.removeEventListener("mousedown",t,!0),this._shuttleRingSwooshG.removeEventListener("touchstart",t,!0),e.removeEventListener("mousemove",t,!0),e.removeEventListener("touchmove",t,!0),e.removeEventListener("mouseup",t,!0),e.removeEventListener("touchend",t,!0),e.removeEventListener("touchcancel",t,!0),this._shuttleRingPointer.removeEventListener("mousedown",t,!0),this._shuttleRingPointer.removeEventListener("touchstart",t,!0),this._knobOuter.removeEventListener("mousedown",t,!0),this._knobOuter.removeEventListener("touchstart",t,!0),this._container.removeChild(this._svgNode),this._container.removeChild(this._theme),this._realtimeSVG.destroy(),this._playReverseSVG.destroy(),this._playForwardSVG.destroy(),this._pauseSVG.destroy();let n=this._subscriptions;for(let i=0,o=n.length;i<o;i++)n[i].dispose();return de(this)};QC.prototype.resize=function(){let e=this._container.clientWidth,t=this._container.clientHeight;if(e===this._lastWidth&&t===this._lastHeight)return;let n=this._svgNode,i=200,o=132,r=e,s=t;e===0&&t===0?(r=i,s=o):e===0?(s=t,r=i*(t/o)):t===0&&(r=e,s=o*(e/i));let a=r/i,l=s/o;n.style.cssText=`width: ${r}px; height: ${s}px; position: absolute; bottom: 0; left: 0; overflow: hidden;`,n.setAttribute("width",r),n.setAttribute("height",s),n.setAttribute("viewBox",`0 0 ${r} ${s}`),this._topG.setAttribute("transform",`scale(${a},${l})`),this._centerX=Math.max(1,100*a),this._centerY=Math.max(1,100*l),this._lastHeight=e,this._lastWidth=t};QC.prototype.applyThemeChanges=function(){let e=this._container.ownerDocument;if(!e.body.contains(this._container)){if(c(this._observer))return;let f=this;f._observer=new MutationObserver(function(){e.body.contains(f._container)&&(f._observer.disconnect(),f._observer=void 0,f.applyThemeChanges())}),f._observer.observe(e,{childList:!0,subtree:!0});return}let t=Sy(this._themeNormal),n=Sy(this._themeHover),i=Sy(this._themeSelect),o=Sy(this._themeDisabled),r=Sy(this._themeKnob),s=Sy(this._themePointer),a=Sy(this._themeSwoosh),l=Sy(this._themeSwooshHover),u=$d({tagName:"defs",children:[{id:"animation_buttonNormal",tagName:"linearGradient",x1:"50%",y1:"0%",x2:"50%",y2:"100%",children:[{tagName:"stop",offset:"0%","stop-color":Xr(t,MP)},{tagName:"stop",offset:"12%","stop-color":Xr(t,PF)},{tagName:"stop",offset:"46%","stop-color":Xr(t,MK)},{tagName:"stop",offset:"81%","stop-color":Xr(t,IF)}]},{id:"animation_buttonHovered",tagName:"linearGradient",x1:"50%",y1:"0%",x2:"50%",y2:"100%",children:[{tagName:"stop",offset:"0%","stop-color":Xr(n,MP)},{tagName:"stop",offset:"12%","stop-color":Xr(n,PF)},{tagName:"stop",offset:"46%","stop-color":Xr(n,MK)},{tagName:"stop",offset:"81%","stop-color":Xr(n,IF)}]},{id:"animation_buttonToggled",tagName:"linearGradient",x1:"50%",y1:"0%",x2:"50%",y2:"100%",children:[{tagName:"stop",offset:"0%","stop-color":Xr(i,MP)},{tagName:"stop",offset:"12%","stop-color":Xr(i,PF)},{tagName:"stop",offset:"46%","stop-color":Xr(i,MK)},{tagName:"stop",offset:"81%","stop-color":Xr(i,IF)}]},{id:"animation_buttonDisabled",tagName:"linearGradient",x1:"50%",y1:"0%",x2:"50%",y2:"100%",children:[{tagName:"stop",offset:"0%","stop-color":Xr(o,sCt)},{tagName:"stop",offset:"75%","stop-color":Xr(o,aCt)}]},{id:"animation_blurred",tagName:"filter",width:"200%",height:"200%",x:"-50%",y:"-50%",children:[{tagName:"feGaussianBlur",stdDeviation:4,in:"SourceGraphic"}]},{id:"animation_shuttleRingSwooshGradient",tagName:"linearGradient",x1:"50%",y1:"0%",x2:"50%",y2:"100%",children:[{tagName:"stop",offset:"0%","stop-opacity":.2,"stop-color":a.toCssColorString()},{tagName:"stop",offset:"85%","stop-opacity":.85,"stop-color":a.toCssColorString()},{tagName:"stop",offset:"95%","stop-opacity":.05,"stop-color":a.toCssColorString()}]},{id:"animation_shuttleRingSwooshHovered",tagName:"linearGradient",x1:"50%",y1:"0%",x2:"50%",y2:"100%",children:[{tagName:"stop",offset:"0%","stop-opacity":.2,"stop-color":l.toCssColorString()},{tagName:"stop",offset:"85%","stop-opacity":.85,"stop-color":l.toCssColorString()},{tagName:"stop",offset:"95%","stop-opacity":.05,"stop-color":l.toCssColorString()}]},{id:"animation_shuttleRingPointerGradient",tagName:"linearGradient",x1:"0%",y1:"50%",x2:"100%",y2:"50%",children:[{tagName:"stop",offset:"0%","stop-color":s.toCssColorString()},{tagName:"stop",offset:"40%","stop-color":s.toCssColorString()},{tagName:"stop",offset:"60%","stop-color":Xr(s,PTe)},{tagName:"stop",offset:"100%","stop-color":Xr(s,PTe)}]},{id:"animation_shuttleRingPointerPaused",tagName:"linearGradient",x1:"0%",y1:"50%",x2:"100%",y2:"50%",children:[{tagName:"stop",offset:"0%","stop-color":"#CCC"},{tagName:"stop",offset:"40%","stop-color":"#CCC"},{tagName:"stop",offset:"60%","stop-color":"#555"},{tagName:"stop",offset:"100%","stop-color":"#555"}]},{id:"animation_knobOuter",tagName:"linearGradient",x1:"20%",y1:"0%",x2:"90%",y2:"100%",children:[{tagName:"stop",offset:"5%","stop-color":Xr(r,MP)},{tagName:"stop",offset:"60%","stop-color":Xr(r,DTe)},{tagName:"stop",offset:"85%","stop-color":Xr(r,PF)}]},{id:"animation_knobInner",tagName:"linearGradient",x1:"20%",y1:"0%",x2:"90%",y2:"100%",children:[{tagName:"stop",offset:"5%","stop-color":Xr(r,DTe)},{tagName:"stop",offset:"60%","stop-color":Xr(r,MP)},{tagName:"stop",offset:"85%","stop-color":Xr(r,IF)}]}]});c(this._defsElement)?this._svgNode.replaceChild(u,this._defsElement):this._svgNode.appendChild(u),this._defsElement=u};var FK=QC;var fCt=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wy=15,eE=105;function OTe(e,t){return e-t}function BK(e,t){let n=vo(t,e,OTe);return n<0?~n:n}function dCt(e,t){if(Math.abs(e)<=wy)return e/wy;let n=wy,i=eE,o,r=0,s;return e>0?(o=Math.log(t[t.length-1]),s=(o-r)/(i-n),Math.exp(r+s*(e-n))):(o=Math.log(-t[0]),s=(o-r)/(i-n),-Math.exp(r+s*(Math.abs(e)-n)))}function hCt(e,t,n){if(n.clockStep===ho.SYSTEM_CLOCK)return wy;if(Math.abs(e)<=1)return e*wy;let i=t[t.length-1];e>i?e=i:e<-i&&(e=-i);let o=wy,r=eE,s,a=0,l;return e>0?(s=Math.log(i),l=(s-a)/(r-o),(Math.log(e)-a)/l+o):(s=Math.log(-t[0]),l=(s-a)/(r-o),-((Math.log(Math.abs(e))-a)/l+o))}function Rf(e){if(!c(e))throw new E("clockViewModel is required.");let t=this;this._clockViewModel=e,this._allShuttleRingTicks=[],this._dateFormatter=Rf.defaultDateFormatter,this._timeFormatter=Rf.defaultTimeFormatter,this.shuttleRingDragging=!1,this.snapToTicks=!1,Te.track(this,["_allShuttleRingTicks","_dateFormatter","_timeFormatter","shuttleRingDragging","snapToTicks"]),this._sortedFilteredPositiveTicks=[],this.setShuttleRingTicks(Rf.defaultTicks),this.timeLabel=void 0,Te.defineProperty(this,"timeLabel",function(){return t._timeFormatter(t._clockViewModel.currentTime,t)}),this.dateLabel=void 0,Te.defineProperty(this,"dateLabel",function(){return t._dateFormatter(t._clockViewModel.currentTime,t)}),this.multiplierLabel=void 0,Te.defineProperty(this,"multiplierLabel",function(){let s=t._clockViewModel;if(s.clockStep===ho.SYSTEM_CLOCK)return"Today";let a=s.multiplier;return a%1===0?`${a.toFixed(0)}x`:`${a.toFixed(3).replace(/0{0,3}$/,"")}x`}),this.shuttleRingAngle=void 0,Te.defineProperty(this,"shuttleRingAngle",{get:function(){return hCt(e.multiplier,t._allShuttleRingTicks,e)},set:function(s){s=Math.max(Math.min(s,eE),-eE);let a=t._allShuttleRingTicks,l=t._clockViewModel;if(l.clockStep=ho.SYSTEM_CLOCK_MULTIPLIER,Math.abs(s)===eE){l.multiplier=s>0?a[a.length-1]:a[0];return}let u=dCt(s,a);if(t.snapToTicks)u=a[BK(u,a)];else if(u!==0){let f=Math.abs(u);if(f>100){let d=f.toFixed(0).length-2,p=Math.pow(10,d);u=Math.round(u/p)*p|0}else f>wy?u=Math.round(u):f>1?u=+u.toFixed(1):f>0&&(u=+u.toFixed(2))}l.multiplier=u}}),this._canAnimate=void 0,Te.defineProperty(this,"_canAnimate",function(){let s=t._clockViewModel,a=s.clockRange;if(t.shuttleRingDragging||a===jr.UNBOUNDED)return!0;let l=s.multiplier,u=s.currentTime,f=s.startTime,d=!1;if(a===jr.LOOP_STOP)d=J.greaterThan(u,f)||u.equals(f)&&l>0;else{let p=s.stopTime;d=J.greaterThan(u,f)&&J.lessThan(u,p)||u.equals(f)&&l>0||u.equals(p)&&l<0}return d||(s.shouldAnimate=!1),d}),this._isSystemTimeAvailable=void 0,Te.defineProperty(this,"_isSystemTimeAvailable",function(){let s=t._clockViewModel;if(s.clockRange===jr.UNBOUNDED)return!0;let l=s.systemTime;return J.greaterThanOrEquals(l,s.startTime)&&J.lessThanOrEquals(l,s.stopTime)}),this._isAnimating=void 0,Te.defineProperty(this,"_isAnimating",function(){return t._clockViewModel.shouldAnimate&&(t._canAnimate||t.shuttleRingDragging)});let n=vn(function(){let s=t._clockViewModel;s.shouldAnimate?s.shouldAnimate=!1:t._canAnimate&&(s.shouldAnimate=!0)});this._pauseViewModel=new JC(n,{toggled:Te.computed(function(){return!t._isAnimating}),tooltip:"Pause"});let i=vn(function(){let s=t._clockViewModel,a=s.multiplier;a>0&&(s.multiplier=-a),s.shouldAnimate=!0});this._playReverseViewModel=new JC(i,{toggled:Te.computed(function(){return t._isAnimating&&e.multiplier<0}),tooltip:"Play Reverse"});let o=vn(function(){let s=t._clockViewModel,a=s.multiplier;a<0&&(s.multiplier=-a),s.shouldAnimate=!0});this._playForwardViewModel=new JC(o,{toggled:Te.computed(function(){return t._isAnimating&&e.multiplier>0&&e.clockStep!==ho.SYSTEM_CLOCK}),tooltip:"Play Forward"});let r=vn(function(){t._clockViewModel.clockStep=ho.SYSTEM_CLOCK},Te.getObservable(this,"_isSystemTimeAvailable"));this._playRealtimeViewModel=new JC(r,{toggled:Te.computed(function(){return e.clockStep===ho.SYSTEM_CLOCK}),tooltip:Te.computed(function(){return t._isSystemTimeAvailable?"Today (real-time)":"Current time not in range"})}),this._slower=vn(function(){let s=t._clockViewModel,a=t._allShuttleRingTicks,l=s.multiplier,u=BK(l,a)-1;u>=0&&(s.multiplier=a[u])}),this._faster=vn(function(){let s=t._clockViewModel,a=t._allShuttleRingTicks,l=s.multiplier,u=BK(l,a)+1;u<a.length&&(s.multiplier=a[u])})}Rf.defaultDateFormatter=function(e,t){let n=J.toGregorianDate(e);return`${fCt[n.month-1]} ${n.day} ${n.year}`};Rf.defaultTicks=[.001,.002,.005,.01,.02,.05,.1,.25,.5,1,2,5,10,15,30,60,120,300,600,900,1800,3600,7200,14400,21600,43200,86400,172800,345600,604800];Rf.defaultTimeFormatter=function(e,t){let n=J.toGregorianDate(e),i=Math.round(n.millisecond);return Math.abs(t._clockViewModel.multiplier)<1?`${n.hour.toString().padStart(2,"0")}:${n.minute.toString().padStart(2,"0")}:${n.second.toString().padStart(2,"0")}.${i.toString().padStart(3,"0")}`:`${n.hour.toString().padStart(2,"0")}:${n.minute.toString().padStart(2,"0")}:${n.second.toString().padStart(2,"0")} UTC`};Rf.prototype.getShuttleRingTicks=function(){return this._sortedFilteredPositiveTicks.slice(0)};Rf.prototype.setShuttleRingTicks=function(e){if(!c(e))throw new E("positiveTicks is required.");let t,n,i,o={},r=this._sortedFilteredPositiveTicks;for(r.length=0,t=0,n=e.length;t<n;++t)i=e[t],o.hasOwnProperty(i)||(o[i]=!0,r.push(i));r.sort(OTe);let s=[];for(n=r.length,t=n-1;t>=0;--t)i=r[t],i!==0&&s.push(-i);Array.prototype.push.apply(s,r),this._allShuttleRingTicks=s};Object.defineProperties(Rf.prototype,{slower:{get:function(){return this._slower}},faster:{get:function(){return this._faster}},clockViewModel:{get:function(){return this._clockViewModel}},pauseViewModel:{get:function(){return this._pauseViewModel}},playReverseViewModel:{get:function(){return this._playReverseViewModel}},playForwardViewModel:{get:function(){return this._playForwardViewModel}},playRealtimeViewModel:{get:function(){return this._playRealtimeViewModel}},dateFormatter:{get:function(){return this._dateFormatter},set:function(e){if(typeof e!="function")throw new E("dateFormatter must be a function");this._dateFormatter=e}},timeFormatter:{get:function(){return this._timeFormatter},set:function(e){if(typeof e!="function")throw new E("timeFormatter must be a function");this._timeFormatter=e}}});Rf._maxShuttleRingAngle=eE;Rf._realtimeShuttleRingAngle=wy;var kK=Rf;function mCt(e){return function(t){let n=e._scene.pick(t.position);c(n)&&n.primitive instanceof pa&&(e.tileset=n.primitive),e.pickActive=!1}}function MTe(e,t){t?e._eventHandler.setInputAction(function(n){let i=e._scene.pick(n.endPosition);c(i)&&i.primitive instanceof pa&&(e.tileset=i.primitive)},bn.MOUSE_MOVE):(e._eventHandler.removeInputAction(bn.MOUSE_MOVE),e.picking=e.picking)}var pCt={maximumFractionDigits:3};function NP(e){let t=e/1048576;return t<1?t.toLocaleString(void 0,pCt):Math.round(t).toLocaleString()}function FP(e,t){if(!c(e))return"";let n=t?e._statisticsPerPass[Ro.PICK]:e._statisticsPerPass[Ro.RENDER],i='<ul class="cesium-cesiumInspector-statistics">';return i+=`<li><strong>Visited: </strong>${n.visited.toLocaleString()}</li><li><strong>Selected: </strong>${n.selected.toLocaleString()}</li><li><strong>Commands: </strong>${n.numberOfCommands.toLocaleString()}</li>`,i+="</ul>",t||(i+='<ul class="cesium-cesiumInspector-statistics">',i+=`<li><strong>Requests: </strong>${n.numberOfPendingRequests.toLocaleString()}</li><li><strong>Attempted: </strong>${n.numberOfAttemptedRequests.toLocaleString()}</li><li><strong>Processing: </strong>${n.numberOfTilesProcessing.toLocaleString()}</li><li><strong>Content Ready: </strong>${n.numberOfTilesWithContentReady.toLocaleString()}</li><li><strong>Total: </strong>${n.numberOfTilesTotal.toLocaleString()}</li>`,i+="</ul>",i+='<ul class="cesium-cesiumInspector-statistics">',i+=`<li><strong>Features Selected: </strong>${n.numberOfFeaturesSelected.toLocaleString()}</li><li><strong>Features Loaded: </strong>${n.numberOfFeaturesLoaded.toLocaleString()}</li><li><strong>Points Selected: </strong>${n.numberOfPointsSelected.toLocaleString()}</li><li><strong>Points Loaded: </strong>${n.numberOfPointsLoaded.toLocaleString()}</li><li><strong>Triangles Selected: </strong>${n.numberOfTrianglesSelected.toLocaleString()}</li>`,i+="</ul>",i+='<ul class="cesium-cesiumInspector-statistics">',i+=`<li><strong>Tiles styled: </strong>${n.numberOfTilesStyled.toLocaleString()}</li><li><strong>Features styled: </strong>${n.numberOfFeaturesStyled.toLocaleString()}</li>`,i+="</ul>",i+='<ul class="cesium-cesiumInspector-statistics">',i+=`<li><strong>Children Union Culled: </strong>${n.numberOfTilesCulledWithChildrenUnion.toLocaleString()}</li>`,i+="</ul>",i+='<ul class="cesium-cesiumInspector-statistics">',i+=`<li><strong>Geometry Memory (MB): </strong>${NP(n.geometryByteLength)}</li><li><strong>Texture Memory (MB): </strong>${NP(n.texturesByteLength)}</li><li><strong>Batch Table Memory (MB): </strong>${NP(n.batchTableByteLength)}</li>`,i+="</ul>"),i}function LTe(){let e=Ci.statistics;return`
  <ul class="cesium-cesiumInspector-statistics">
    <li><strong>Geometry Memory (MB): </strong>${NP(e.geometryByteLength)}</li>
    <li><strong>Texture Memory (MB): </strong>${NP(e.texturesByteLength)}</li>
  </ul>
  `}var _Ct=[{text:"Highlight",value:Vl.HIGHLIGHT},{text:"Replace",value:Vl.REPLACE},{text:"Mix",value:Vl.MIX}],RTe=new j(1,1,0,.4),gCt=new j,RF=new j;function ra(e,t){A.typeOf.object("scene",e),A.typeOf.object("performanceContainer",t);let n=this,i=e.canvas;this._eventHandler=new Af(i),this._scene=e,this._performanceContainer=t,this._canvas=i,this._performanceDisplay=new xy({container:t}),this._statisticsText="",this._pickStatisticsText="",this._resourceCacheStatisticsText="",this._editorError="",this.performance=!1,this.showStatistics=!0,this.showPickStatistics=!0,this.showResourceCacheStatistics=!1,this.inspectorVisible=!0,this.tilesetVisible=!1,this.displayVisible=!1,this.updateVisible=!1,this.loggingVisible=!1,this.styleVisible=!1,this.tileDebugLabelsVisible=!1,this.optimizationVisible=!1,this.styleString="{}",this.hasEnabledWireframe=!1,this._tileset=void 0,this._feature=void 0,this._tile=void 0,Te.track(this,["performance","inspectorVisible","_statisticsText","_pickStatisticsText","_resourceCacheStatisticsText","_editorError","showPickStatistics","showStatistics","showResourceCacheStatistics","tilesetVisible","displayVisible","updateVisible","loggingVisible","styleVisible","optimizationVisible","tileDebugLabelsVisible","styleString","_feature","_tile","_tileset","hasEnabledWireframe"]),this._properties=Te.observable({}),this.properties=[],Te.defineProperty(this,"properties",function(){let U=[],q=n._properties();for(let K in q)q.hasOwnProperty(K)&&U.push(K);return U});let o=Te.observable();Te.defineProperty(this,"dynamicScreenSpaceError",{get:function(){return o()},set:function(U){o(U),c(n._tileset)&&(n._tileset.dynamicScreenSpaceError=U)}}),this.dynamicScreenSpaceError=!1;let r=Te.observable();Te.defineProperty(this,"colorBlendMode",{get:function(){return r()},set:function(U){r(U),c(n._tileset)&&(n._tileset.colorBlendMode=U,n._scene.requestRender())}}),this.colorBlendMode=Vl.HIGHLIGHT;let s=Te.observable(),a=Te.observable();Te.defineProperty(this,"picking",{get:function(){return a()},set:function(U){a(U),U?n._eventHandler.setInputAction(function(q){let K=e.pick(q.endPosition);if(K instanceof Ws?(n.feature=K,n.tile=K.content.tile):c(K)&&c(K.content)?(n.feature=void 0,n.tile=K.content.tile):(n.feature=void 0,n.tile=void 0),!!c(n._tileset)){if(s&&c(K)&&c(K.content)){let te;e.pickPositionSupported&&(te=e.pickPosition(q.endPosition),c(te)&&(n._tileset.debugPickPosition=te)),n._tileset.debugPickedTile=K.content.tile}else n._tileset.debugPickedTile=void 0;n._scene.requestRender()}},bn.MOUSE_MOVE):(n.feature=void 0,n.tile=void 0,n._eventHandler.removeInputAction(bn.MOUSE_MOVE))}}),this.picking=!0;let l=Te.observable();Te.defineProperty(this,"colorize",{get:function(){return l()},set:function(U){l(U),c(n._tileset)&&(n._tileset.debugColorizeTiles=U,n._scene.requestRender())}}),this.colorize=!1;let u=Te.observable();Te.defineProperty(this,"wireframe",{get:function(){return u()},set:function(U){u(U),c(n._tileset)&&(n._tileset.debugWireframe=U,n._scene.requestRender())}}),this.wireframe=!1;let f=Te.observable();Te.defineProperty(this,"showBoundingVolumes",{get:function(){return f()},set:function(U){f(U),c(n._tileset)&&(n._tileset.debugShowBoundingVolume=U,n._scene.requestRender())}}),this.showBoundingVolumes=!1;let d=Te.observable();Te.defineProperty(this,"showContentBoundingVolumes",{get:function(){return d()},set:function(U){d(U),c(n._tileset)&&(n._tileset.debugShowContentBoundingVolume=U,n._scene.requestRender())}}),this.showContentBoundingVolumes=!1;let p=Te.observable();Te.defineProperty(this,"showRequestVolumes",{get:function(){return p()},set:function(U){p(U),c(n._tileset)&&(n._tileset.debugShowViewerRequestVolume=U,n._scene.requestRender())}}),this.showRequestVolumes=!1;let g=Te.observable();Te.defineProperty(this,"freezeFrame",{get:function(){return g()},set:function(U){g(U),c(n._tileset)&&(n._tileset.debugFreezeFrame=U,n._scene.debugShowFrustumPlanes=U,n._scene.requestRender())}}),this.freezeFrame=!1,Te.defineProperty(this,"showOnlyPickedTileDebugLabel",{get:function(){return s()},set:function(U){s(U),c(n._tileset)&&(n._tileset.debugPickedTileLabelOnly=U,n._scene.requestRender())}}),this.showOnlyPickedTileDebugLabel=!1;let m=Te.observable();Te.defineProperty(this,"showGeometricError",{get:function(){return m()},set:function(U){m(U),c(n._tileset)&&(n._tileset.debugShowGeometricError=U,n._scene.requestRender())}}),this.showGeometricError=!1;let b=Te.observable();Te.defineProperty(this,"showRenderingStatistics",{get:function(){return b()},set:function(U){b(U),c(n._tileset)&&(n._tileset.debugShowRenderingStatistics=U,n._scene.requestRender())}}),this.showRenderingStatistics=!1;let x=Te.observable();Te.defineProperty(this,"showMemoryUsage",{get:function(){return x()},set:function(U){x(U),c(n._tileset)&&(n._tileset.debugShowMemoryUsage=U,n._scene.requestRender())}}),this.showMemoryUsage=!1;let T=Te.observable();Te.defineProperty(this,"showUrl",{get:function(){return T()},set:function(U){T(U),c(n._tileset)&&(n._tileset.debugShowUrl=U,n._scene.requestRender())}}),this.showUrl=!1;let C=Te.observable();Te.defineProperty(this,"maximumScreenSpaceError",{get:function(){return C()},set:function(U){U=Number(U),isNaN(U)||(C(U),c(n._tileset)&&(n._tileset.maximumScreenSpaceError=U))}}),this.maximumScreenSpaceError=16;let S=Te.observable();Te.defineProperty(this,"dynamicScreenSpaceErrorDensity",{get:function(){return S()},set:function(U){U=Number(U),isNaN(U)||(S(U),c(n._tileset)&&(n._tileset.dynamicScreenSpaceErrorDensity=U))}}),this.dynamicScreenSpaceErrorDensity=2e-4,this.dynamicScreenSpaceErrorDensitySliderValue=void 0,Te.defineProperty(this,"dynamicScreenSpaceErrorDensitySliderValue",{get:function(){return Math.pow(S(),1/6)},set:function(U){let q=Math.pow(U,6);S(q),c(n._tileset)&&(n._tileset.dynamicScreenSpaceErrorDensity=q)}});let v=Te.observable();Te.defineProperty(this,"dynamicScreenSpaceErrorFactor",{get:function(){return v()},set:function(U){U=Number(U),isNaN(U)||(v(U),c(n._tileset)&&(n._tileset.dynamicScreenSpaceErrorFactor=U))}}),this.dynamicScreenSpaceErrorFactor=24;let D=mCt(this),I=Te.observable();Te.defineProperty(this,"pickActive",{get:function(){return I()},set:function(U){I(U),U?n._eventHandler.setInputAction(D,bn.LEFT_CLICK):n._eventHandler.removeInputAction(bn.LEFT_CLICK)}});let L=Te.observable();Te.defineProperty(this,"pointCloudShading",{get:function(){return L()},set:function(U){L(U),c(n._tileset)&&(n._tileset.pointCloudShading.attenuation=U)}}),this.pointCloudShading=!1;let M=Te.observable();Te.defineProperty(this,"geometricErrorScale",{get:function(){return M()},set:function(U){U=Number(U),isNaN(U)||(M(U),c(n._tileset)&&(n._tileset.pointCloudShading.geometricErrorScale=U))}}),this.geometricErrorScale=1;let N=Te.observable();Te.defineProperty(this,"maximumAttenuation",{get:function(){return N()},set:function(U){U=Number(U),isNaN(U)||(N(U),c(n._tileset)&&(n._tileset.pointCloudShading.maximumAttenuation=U===0?void 0:U))}}),this.maximumAttenuation=0;let B=Te.observable();Te.defineProperty(this,"baseResolution",{get:function(){return B()},set:function(U){U=Number(U),isNaN(U)||(B(U),c(n._tileset)&&(n._tileset.pointCloudShading.baseResolution=U===0?void 0:U))}}),this.baseResolution=0;let _=Te.observable();Te.defineProperty(this,"eyeDomeLighting",{get:function(){return _()},set:function(U){_(U),c(n._tileset)&&(n._tileset.pointCloudShading.eyeDomeLighting=U)}}),this.eyeDomeLighting=!1;let w=Te.observable();Te.defineProperty(this,"eyeDomeLightingStrength",{get:function(){return w()},set:function(U){U=Number(U),isNaN(U)||(w(U),c(n._tileset)&&(n._tileset.pointCloudShading.eyeDomeLightingStrength=U))}}),this.eyeDomeLightingStrength=1;let P=Te.observable();Te.defineProperty(this,"eyeDomeLightingRadius",{get:function(){return P()},set:function(U){U=Number(U),isNaN(U)||(P(U),c(n._tileset)&&(n._tileset.pointCloudShading.eyeDomeLightingRadius=U))}}),this.eyeDomeLightingRadius=1,this.pickActive=!1;let O=Te.observable();Te.defineProperty(this,"skipLevelOfDetail",{get:function(){return O()},set:function(U){O(U),c(n._tileset)&&(n._tileset.skipLevelOfDetail=U)}}),this.skipLevelOfDetail=!0;let F=Te.observable();Te.defineProperty(this,"skipScreenSpaceErrorFactor",{get:function(){return F()},set:function(U){U=Number(U),isNaN(U)||(F(U),c(n._tileset)&&(n._tileset.skipScreenSpaceErrorFactor=U))}}),this.skipScreenSpaceErrorFactor=16;let V=Te.observable();Te.defineProperty(this,"baseScreenSpaceError",{get:function(){return V()},set:function(U){U=Number(U),isNaN(U)||(V(U),c(n._tileset)&&(n._tileset.baseScreenSpaceError=U))}}),this.baseScreenSpaceError=1024;let G=Te.observable();Te.defineProperty(this,"skipLevels",{get:function(){return G()},set:function(U){U=Number(U),isNaN(U)||(G(U),c(n._tileset)&&(n._tileset.skipLevels=U))}}),this.skipLevels=1;let z=Te.observable();Te.defineProperty(this,"immediatelyLoadDesiredLevelOfDetail",{get:function(){return z()},set:function(U){z(U),c(n._tileset)&&(n._tileset.immediatelyLoadDesiredLevelOfDetail=U)}}),this.immediatelyLoadDesiredLevelOfDetail=!1;let W=Te.observable();Te.defineProperty(this,"loadSiblings",{get:function(){return W()},set:function(U){W(U),c(n._tileset)&&(n._tileset.loadSiblings=U)}}),this.loadSiblings=!1,this._style=void 0,this._shouldStyle=!1,this._definedProperties=["properties","dynamicScreenSpaceError","colorBlendMode","picking","colorize","wireframe","showBoundingVolumes","showContentBoundingVolumes","showRequestVolumes","freezeFrame","maximumScreenSpaceError","dynamicScreenSpaceErrorDensity","baseScreenSpaceError","skipScreenSpaceErrorFactor","skipLevelOfDetail","skipLevels","immediatelyLoadDesiredLevelOfDetail","loadSiblings","dynamicScreenSpaceErrorDensitySliderValue","dynamicScreenSpaceErrorFactor","pickActive","showOnlyPickedTileDebugLabel","showGeometricError","showRenderingStatistics","showMemoryUsage","showUrl","pointCloudShading","geometricErrorScale","maximumAttenuation","baseResolution","eyeDomeLighting","eyeDomeLightingStrength","eyeDomeLightingRadius"],this._removePostRenderEvent=e.postRender.addEventListener(function(){n._update()}),c(this._tileset)||MTe(this,!0)}Object.defineProperties(ra.prototype,{scene:{get:function(){return this._scene}},performanceContainer:{get:function(){return this._performanceContainer}},statisticsText:{get:function(){return this._statisticsText}},pickStatisticsText:{get:function(){return this._pickStatisticsText}},resourceCacheStatisticsText:{get:function(){return this._resourceCacheStatisticsText}},colorBlendModes:{get:function(){return _Ct}},editorError:{get:function(){return this._editorError}},tileset:{get:function(){return this._tileset},set:function(e){if(this._tileset=e,this._style=void 0,this.styleString="{}",this.feature=void 0,this.tile=void 0,c(e)){this._properties(e.properties);let t=["colorize","wireframe","showBoundingVolumes","showContentBoundingVolumes","showRequestVolumes","freezeFrame","showOnlyPickedTileDebugLabel","showGeometricError","showRenderingStatistics","showMemoryUsage","showUrl"],n=t.length;for(let o=0;o<n;++o){let r=t[o];this[r]=this[r]}this.maximumScreenSpaceError=e.maximumScreenSpaceError,this.dynamicScreenSpaceError=e.dynamicScreenSpaceError,this.dynamicScreenSpaceErrorDensity=e.dynamicScreenSpaceErrorDensity,this.dynamicScreenSpaceErrorFactor=e.dynamicScreenSpaceErrorFactor,this.colorBlendMode=e.colorBlendMode,this.skipLevelOfDetail=e.skipLevelOfDetail,this.skipScreenSpaceErrorFactor=e.skipScreenSpaceErrorFactor,this.baseScreenSpaceError=e.baseScreenSpaceError,this.skipLevels=e.skipLevels,this.immediatelyLoadDesiredLevelOfDetail=e.immediatelyLoadDesiredLevelOfDetail,this.loadSiblings=e.loadSiblings,this.hasEnabledWireframe=e._enableDebugWireframe;let i=e.pointCloudShading;this.pointCloudShading=i.attenuation,this.geometricErrorScale=i.geometricErrorScale,this.maximumAttenuation=i.maximumAttenuation?i.maximumAttenuation:0,this.baseResolution=i.baseResolution?i.baseResolution:0,this.eyeDomeLighting=i.eyeDomeLighting,this.eyeDomeLightingStrength=i.eyeDomeLightingStrength,this.eyeDomeLightingRadius=i.eyeDomeLightingRadius,this._scene.requestRender()}else this._properties({});this._statisticsText=FP(e,!1),this._pickStatisticsText=FP(e,!0),this._resourceCacheStatisticsText=LTe(),MTe(this,!1)}},feature:{get:function(){return this._feature},set:function(e){if(this._feature===e)return;let t=this._feature;c(t)&&!t.content.isDestroyed()&&(!this.colorize&&c(this._style)?t.color=c(this._style.color)?this._style.color.evaluateColor(t,gCt):j.WHITE:t.color=RF,this._scene.requestRender()),c(e)&&(j.clone(e.color,RF),e.color=RTe,this._scene.requestRender()),this._feature=e}},tile:{get:function(){return this._tile},set:function(e){if(this._tile===e)return;let t=this._tile;c(t)&&!t.isDestroyed()&&!VK(t.content)&&(t.color=RF,this._scene.requestRender()),c(e)&&!VK(e.content)&&(j.clone(e.color,RF),e.color=RTe,this._scene.requestRender()),this._tile=e}}});function VK(e){if(!c(e))return!1;if(e.featuresLength>0)return!0;let t=e.innerContents;if(c(t)){let n=t.length;for(let i=0;i<n;++i)if(!VK(t[i]))return!1;return!0}return!1}ra.prototype.togglePickTileset=function(){this.pickActive=!this.pickActive};ra.prototype.toggleInspector=function(){this.inspectorVisible=!this.inspectorVisible};ra.prototype.toggleTileset=function(){this.tilesetVisible=!this.tilesetVisible};ra.prototype.toggleDisplay=function(){this.displayVisible=!this.displayVisible};ra.prototype.toggleUpdate=function(){this.updateVisible=!this.updateVisible};ra.prototype.toggleLogging=function(){this.loggingVisible=!this.loggingVisible};ra.prototype.toggleStyle=function(){this.styleVisible=!this.styleVisible};ra.prototype.toggleTileDebugLabels=function(){this.tileDebugLabelsVisible=!this.tileDebugLabelsVisible};ra.prototype.toggleOptimization=function(){this.optimizationVisible=!this.optimizationVisible};ra.prototype.trimTilesCache=function(){c(this._tileset)&&this._tileset.trimLoadedTiles()};ra.prototype.compileStyle=function(){let e=this._tileset;if(!(!c(e)||this.styleString===JSON.stringify(e.style))){this._editorError="";try{this.styleString.length===0&&(this.styleString="{}"),this._style=new TC(JSON.parse(this.styleString)),this._shouldStyle=!0,this._scene.requestRender()}catch(t){this._editorError=t.toString()}this.feature=this._feature,this.tile=this._tile}};ra.prototype.styleEditorKeyPress=function(e,t){if(t.keyCode===9){t.preventDefault();let n=t.target,i=n.selectionStart,o=n.selectionEnd,r=o,a=n.value.slice(i,o).split(`
`),l=a.length,u;if(t.shiftKey)for(u=0;u<l;++u)a[u][0]===" "&&(a[u][1]===" "?(a[u]=a[u].substr(2),r-=2):(a[u]=a[u].substr(1),r-=1));else for(u=0;u<l;++u)a[u]=`  ${a[u]}`,r+=2;let f=a.join(`
`);n.value=n.value.slice(0,i)+f+n.value.slice(o),n.selectionStart=i!==o?i:r,n.selectionEnd=r}else t.ctrlKey&&(t.keyCode===10||t.keyCode===13)&&this.compileStyle();return!0};ra.prototype._update=function(){let e=this._tileset;if(this.performance&&this._performanceDisplay.update(),c(e)){if(e.isDestroyed()){this.tile=void 0,this.feature=void 0,this.tileset=void 0;return}let t=e.style;this._style!==e.style&&(this._shouldStyle?(e.style=this._style,this._shouldStyle=!1):(this._style=t,this.styleString=JSON.stringify(t.style,null,"  ")))}this.showStatistics&&(this._statisticsText=FP(e,!1),this._pickStatisticsText=FP(e,!0),this._resourceCacheStatisticsText=LTe())};ra.prototype.isDestroyed=function(){return!1};ra.prototype.destroy=function(){this._eventHandler.destroy(),this._removePostRenderEvent();let e=this;return this._definedProperties.forEach(function(t){Te.getObservable(e,t).dispose()}),de(this)};ra.getStatistics=FP;var UK=ra;function MF(e,t){A.defined("container",e),A.typeOf.object("scene",t),e=On(e);let n=document.createElement("div"),i=document.createElement("div");i.setAttribute("data-bind","visible: performance");let o=new UK(t,i);this._viewModel=o,this._container=e,this._element=n;let r=document.createElement("div");r.textContent="3D Tiles Inspector",r.className="cesium-cesiumInspector-button",r.setAttribute("data-bind","click: toggleInspector"),n.appendChild(r),n.className="cesium-cesiumInspector cesium-3DTilesInspector",n.setAttribute("data-bind",'css: { "cesium-cesiumInspector-visible" : inspectorVisible, "cesium-cesiumInspector-hidden" : !inspectorVisible}'),e.appendChild(n);let s=document.createElement("div");s.className="cesium-cesiumInspector-dropDown",n.appendChild(s);let a=Vc.createSection,l=Vc.createCheckbox,u=Vc.createRangeInput,f=Vc.createButton,d=a(s,"Tileset","tilesetVisible","toggleTileset"),p=a(s,"Display","displayVisible","toggleDisplay"),g=a(s,"Update","updateVisible","toggleUpdate"),m=a(s,"Logging","loggingVisible","toggleLogging"),b=a(s,"Tile Debug Labels","tileDebugLabelsVisible","toggleTileDebugLabels"),x=a(s,"Style","styleVisible","toggleStyle"),T=a(s,"Optimization","optimizationVisible","toggleOptimization"),C=document.createElement("div");C.className="field-group";let S=document.createElement("label");S.className="field-label",S.appendChild(document.createTextNode("Properties: "));let v=document.createElement("div");v.setAttribute("data-bind","text: properties"),C.appendChild(S),C.appendChild(v),d.appendChild(C),d.appendChild(f("Pick Tileset","togglePickTileset","pickActive")),d.appendChild(f("Trim Tiles Cache","trimTilesCache")),d.appendChild(l("Enable Picking","picking")),p.appendChild(l("Colorize","colorize"));let D=p.appendChild(l("Wireframe","wireframe","_tileset === undefined || hasEnabledWireframe")),I=document.createElement("p");I.setAttribute("data-bind","visible: _tileset !== undefined && !hasEnabledWireframe"),I.setAttribute("class","cesium-3DTilesInspector-disabledElementsInfo"),I.innerText="Set enableDebugWireframe to true in the tileset constructor to enable this option.",D.appendChild(I),p.appendChild(l("Bounding Volumes","showBoundingVolumes")),p.appendChild(l("Content Volumes","showContentBoundingVolumes")),p.appendChild(l("Request Volumes","showRequestVolumes")),p.appendChild(l("Point Cloud Shading","pointCloudShading"));let L=document.createElement("div");L.setAttribute("data-bind","visible: pointCloudShading"),L.appendChild(u("Geometric Error Scale","geometricErrorScale",0,2,.01)),L.appendChild(u("Maximum Attenuation","maximumAttenuation",0,32,1)),L.appendChild(u("Base Resolution","baseResolution",0,1,.01)),L.appendChild(l("Eye Dome Lighting (EDL)","eyeDomeLighting")),p.appendChild(L);let M=document.createElement("div");M.setAttribute("data-bind","visible: eyeDomeLighting"),M.appendChild(u("EDL Strength","eyeDomeLightingStrength",0,2,.1)),M.appendChild(u("EDL Radius","eyeDomeLightingRadius",0,4,.1)),L.appendChild(M),g.appendChild(l("Freeze Frame","freezeFrame")),g.appendChild(l("Dynamic Screen Space Error","dynamicScreenSpaceError"));let N=document.createElement("div");N.appendChild(u("Maximum Screen Space Error","maximumScreenSpaceError",0,128,1)),g.appendChild(N);let B=document.createElement("div");B.setAttribute("data-bind","visible: dynamicScreenSpaceError"),B.appendChild(u("Screen Space Error Density","dynamicScreenSpaceErrorDensitySliderValue",0,1,.005,"dynamicScreenSpaceErrorDensity")),B.appendChild(u("Screen Space Error Factor","dynamicScreenSpaceErrorFactor",1,32,.1)),g.appendChild(B),m.appendChild(l("Performance","performance")),m.appendChild(i),m.appendChild(l("Statistics","showStatistics"));let _=document.createElement("div");_.className="cesium-3dTilesInspector-statistics",_.setAttribute("data-bind","html: statisticsText, visible: showStatistics"),m.appendChild(_),m.appendChild(l("Pick Statistics","showPickStatistics"));let w=document.createElement("div");w.className="cesium-3dTilesInspector-statistics",w.setAttribute("data-bind","html: pickStatisticsText, visible: showPickStatistics"),m.appendChild(w),m.appendChild(l("Resource Cache Statistics","showResourceCacheStatistics"));let P=document.createElement("div");P.className="cesium-3dTilesInspector-statistics",P.setAttribute("data-bind","html: resourceCacheStatisticsText, visible: showResourceCacheStatistics"),m.appendChild(P);let O=document.createElement("div");x.appendChild(O),O.appendChild(document.createTextNode("Color Blend Mode: "));let F=document.createElement("select");F.setAttribute("data-bind",'options: colorBlendModes, optionsText: "text", optionsValue: "value", value: colorBlendMode'),O.appendChild(F);let V=document.createElement("textarea");V.setAttribute("data-bind","textInput: styleString, event: { keydown: styleEditorKeyPress }"),O.className="cesium-cesiumInspector-styleEditor",O.appendChild(V);let G=f("Compile (Ctrl+Enter)","compileStyle");O.appendChild(G);let z=document.createElement("div");z.className="cesium-cesiumInspector-error",z.setAttribute("data-bind","text: editorError"),O.appendChild(z),b.appendChild(l("Show Picked Only","showOnlyPickedTileDebugLabel")),b.appendChild(l("Geometric Error","showGeometricError")),b.appendChild(l("Rendering Statistics","showRenderingStatistics")),b.appendChild(l("Memory Usage (MB)","showMemoryUsage")),b.appendChild(l("Url","showUrl")),T.appendChild(l("Skip Tile LODs","skipLevelOfDetail"));let W=document.createElement("div");W.appendChild(u("Skip SSE Factor","skipScreenSpaceErrorFactor",1,50,1)),T.appendChild(W);let U=document.createElement("div");U.appendChild(u("SSE before skipping LOD","baseScreenSpaceError",0,4096,1)),T.appendChild(U);let q=document.createElement("div");q.appendChild(u("Min. levels to skip","skipLevels",0,10,1)),T.appendChild(q),T.appendChild(l("Load only tiles that meet the max SSE.","immediatelyLoadDesiredLevelOfDetail")),T.appendChild(l("Load siblings of visible tiles","loadSiblings")),Te.applyBindings(o,n)}Object.defineProperties(MF.prototype,{container:{get:function(){return this._container}},viewModel:{get:function(){return this._viewModel}}});MF.prototype.isDestroyed=function(){return!1};MF.prototype.destroy=function(){return Te.cleanNode(this._element),this._container.removeChild(this._element),this.viewModel.destroy(),de(this)};var zK=MF;function LF(e,t){c(t)||(t=document.body),t=On(t);let n=this,i=Te.observable(wr.fullscreen),o=Te.observable(wr.enabled),r=t.ownerDocument;this.isFullscreen=void 0,Te.defineProperty(this,"isFullscreen",{get:function(){return i()}}),this.isFullscreenEnabled=void 0,Te.defineProperty(this,"isFullscreenEnabled",{get:function(){return o()},set:function(s){o(s&&wr.enabled)}}),this.tooltip=void 0,Te.defineProperty(this,"tooltip",function(){return this.isFullscreenEnabled?i()?"Exit full screen":"Full screen":"Full screen unavailable"}),this._command=vn(function(){wr.fullscreen?wr.exitFullscreen():wr.requestFullscreen(n._fullscreenElement)},Te.getObservable(this,"isFullscreenEnabled")),this._fullscreenElement=y(On(e),r.body),this._callback=function(){i(wr.fullscreen)},r.addEventListener(wr.changeEventName,this._callback)}Object.defineProperties(LF.prototype,{fullscreenElement:{get:function(){return this._fullscreenElement},set:function(e){if(!(e instanceof Element))throw new E("value must be a valid Element.");this._fullscreenElement=e}},command:{get:function(){return this._command}}});LF.prototype.isDestroyed=function(){return!1};LF.prototype.destroy=function(){document.removeEventListener(wr.changeEventName,this._callback),de(this)};var HK=LF;var yCt="M 83.96875 17.5625 L 83.96875 17.59375 L 76.65625 24.875 L 97.09375 24.96875 L 76.09375 45.96875 L 81.9375 51.8125 L 102.78125 30.9375 L 102.875 51.15625 L 110.15625 43.875 L 110.1875 17.59375 L 83.96875 17.5625 z M 44.125 17.59375 L 17.90625 17.625 L 17.9375 43.90625 L 25.21875 51.1875 L 25.3125 30.96875 L 46.15625 51.8125 L 52 45.96875 L 31 25 L 51.4375 24.90625 L 44.125 17.59375 z M 46.0625 76.03125 L 25.1875 96.875 L 25.09375 76.65625 L 17.8125 83.9375 L 17.8125 110.21875 L 44 110.25 L 51.3125 102.9375 L 30.90625 102.84375 L 51.875 81.875 L 46.0625 76.03125 z M 82 76.15625 L 76.15625 82 L 97.15625 103 L 76.71875 103.0625 L 84.03125 110.375 L 110.25 110.34375 L 110.21875 84.0625 L 102.9375 76.8125 L 102.84375 97 L 82 76.15625 z",bCt="M 104.34375 17.5625 L 83.5 38.4375 L 83.40625 18.21875 L 76.125 25.5 L 76.09375 51.78125 L 102.3125 51.8125 L 102.3125 51.78125 L 109.625 44.5 L 89.1875 44.40625 L 110.1875 23.40625 L 104.34375 17.5625 z M 23.75 17.59375 L 17.90625 23.4375 L 38.90625 44.4375 L 18.5 44.53125 L 25.78125 51.8125 L 52 51.78125 L 51.96875 25.53125 L 44.6875 18.25 L 44.625 38.46875 L 23.75 17.59375 z M 25.6875 76.03125 L 18.375 83.3125 L 38.78125 83.40625 L 17.8125 104.40625 L 23.625 110.25 L 44.5 89.375 L 44.59375 109.59375 L 51.875 102.3125 L 51.875 76.0625 L 25.6875 76.03125 z M 102.375 76.15625 L 76.15625 76.1875 L 76.1875 102.4375 L 83.46875 109.71875 L 83.5625 89.53125 L 104.40625 110.375 L 110.25 104.53125 L 89.25 83.53125 L 109.6875 83.46875 L 102.375 76.15625 z";function NF(e,t){if(!c(e))throw new E("container is required.");e=On(e);let n=new HK(t,e);n._exitFullScreenPath=bCt,n._enterFullScreenPath=yCt;let i=document.createElement("button");i.type="button",i.className="cesium-button cesium-fullscreenButton",i.setAttribute("data-bind","attr: { title: tooltip },click: command,enable: isFullscreenEnabled,cesiumSvgPath: { path: isFullscreen ? _exitFullScreenPath : _enterFullScreenPath, width: 128, height: 128 }"),e.appendChild(i),Te.applyBindings(n,i),this._container=e,this._viewModel=n,this._element=i}Object.defineProperties(NF.prototype,{container:{get:function(){return this._container}},viewModel:{get:function(){return this._viewModel}}});NF.prototype.isDestroyed=function(){return!1};NF.prototype.destroy=function(){return this._viewModel.destroy(),Te.cleanNode(this._element),this._container.removeChild(this._element),de(this)};var GK=NF;function NTe(e){e=y(e,y.EMPTY_OBJECT);let t=e.globe,n=y(e.imageryProviderViewModels,[]),i=y(e.terrainProviderViewModels,[]);if(!c(t))throw new E("globe is required");this._globe=t,this.imageryProviderViewModels=n.slice(0),this.terrainProviderViewModels=i.slice(0),this.dropDownVisible=!1,Te.track(this,["imageryProviderViewModels","terrainProviderViewModels","dropDownVisible"]);let o=Te.getObservable(this,"imageryProviderViewModels"),r=Te.pureComputed(function(){let d=o(),p={},g;for(g=0;g<d.length;g++){let x=d[g],T=x.category;c(p[T])?p[T].push(x):p[T]=[x]}let m=Object.keys(p),b=[];for(g=0;g<m.length;g++){let x=m[g];b.push({name:x,providers:p[x]})}return b});this._imageryProviders=r;let s=Te.getObservable(this,"terrainProviderViewModels"),a=Te.pureComputed(function(){let d=s(),p={},g;for(g=0;g<d.length;g++){let x=d[g],T=x.category;c(p[T])?p[T].push(x):p[T]=[x]}let m=Object.keys(p),b=[];for(g=0;g<m.length;g++){let x=m[g];b.push({name:x,providers:p[x]})}return b});this._terrainProviders=a,this.buttonTooltip=void 0,Te.defineProperty(this,"buttonTooltip",function(){let d=this.selectedImagery,p=this.selectedTerrain,g=c(d)?d.name:void 0,m=c(p)?p.name:void 0;return c(g)&&c(m)?`${g}
${m}`:c(g)?g:m}),this.buttonImageUrl=void 0,Te.defineProperty(this,"buttonImageUrl",function(){let d=this.selectedImagery;if(c(d))return d.iconUrl}),this.selectedImagery=void 0;let l=Te.observable();this._currentImageryLayers=[],Te.defineProperty(this,"selectedImagery",{get:function(){return l()},set:function(d){if(l()===d){this.dropDownVisible=!1;return}let p,g=this._currentImageryLayers,m=g.length,b=this._globe.imageryLayers,x=!1;for(p=0;p<m;p++){let T=b.length;for(let C=0;C<T;C++){let S=b.get(C);if(S===g[p]){b.remove(S),x=!0;break}}}if(c(d)){let T=d.creationCommand();if(Array.isArray(T)){let C=T.length;for(this._currentImageryLayers=[],p=C-1;p>=0;p--){let S=oc.fromProviderAsync(T[p]);b.add(S,0),this._currentImageryLayers.push(S)}}else{this._currentImageryLayers=[];let C=oc.fromProviderAsync(T);if(C.name=d.name,x)b.add(C,0);else{let S=b.get(0);c(S)&&b.remove(S),b.add(C,0)}this._currentImageryLayers.push(C)}}l(d),this.dropDownVisible=!1}}),this.selectedTerrain=void 0;let u=Te.observable();Te.defineProperty(this,"selectedTerrain",{get:function(){return u()},set:function(d){if(u()===d){this.dropDownVisible=!1;return}let p;if(c(d)&&(p=d.creationCommand()),c(p)&&!c(p.then))this._globe.depthTestAgainstTerrain=!(p instanceof Jp),this._globe.terrainProvider=p;else if(c(p)){let g=!1,m=this._globe.terrainProviderChanged.addEventListener(()=>{g=!0,m()}),x=new CF(p).readyEvent.addEventListener(T=>{g||(this._globe.depthTestAgainstTerrain=!(T instanceof Jp),this._globe.terrainProvider=T,x())})}u(d),this.dropDownVisible=!1}});let f=this;this._toggleDropDown=vn(function(){f.dropDownVisible=!f.dropDownVisible}),this.selectedImagery=y(e.selectedImageryProviderViewModel,n[0]),this.selectedTerrain=e.selectedTerrainProviderViewModel}Object.defineProperties(NTe.prototype,{toggleDropDown:{get:function(){return this._toggleDropDown}},globe:{get:function(){return this._globe}}});var jK=NTe;function FF(e,t){if(!c(e))throw new E("container is required.");e=On(e);let n=new jK(t),i=document.createElement("button");i.type="button",i.className="cesium-button cesium-toolbar-button",i.setAttribute("data-bind","attr: { title: buttonTooltip },click: toggleDropDown"),e.appendChild(i);let o=document.createElement("img");o.setAttribute("draggable","false"),o.className="cesium-baseLayerPicker-selected",o.setAttribute("data-bind","attr: { src: buttonImageUrl }, visible: !!buttonImageUrl"),i.appendChild(o);let r=document.createElement("div");r.className="cesium-baseLayerPicker-dropDown",r.setAttribute("data-bind",'css: { "cesium-baseLayerPicker-dropDown-visible" : dropDownVisible }'),e.appendChild(r);let s=document.createElement("div");s.className="cesium-baseLayerPicker-sectionTitle",s.setAttribute("data-bind","visible: imageryProviderViewModels.length > 0"),s.innerHTML="Imagery",r.appendChild(s);let a=document.createElement("div");a.className="cesium-baseLayerPicker-section",a.setAttribute("data-bind","foreach: _imageryProviders"),r.appendChild(a);let l=document.createElement("div");l.className="cesium-baseLayerPicker-category",a.appendChild(l);let u=document.createElement("div");u.className="cesium-baseLayerPicker-categoryTitle",u.setAttribute("data-bind","text: name"),l.appendChild(u);let f=document.createElement("div");f.className="cesium-baseLayerPicker-choices",f.setAttribute("data-bind","foreach: providers"),l.appendChild(f);let d=document.createElement("div");d.className="cesium-baseLayerPicker-item",d.setAttribute("data-bind",'css: { "cesium-baseLayerPicker-selectedItem" : $data === $parents[1].selectedImagery },attr: { title: tooltip },visible: creationCommand.canExecute,click: function($data) { $parents[1].selectedImagery = $data; }'),f.appendChild(d);let p=document.createElement("img");p.className="cesium-baseLayerPicker-itemIcon",p.setAttribute("data-bind","attr: { src: iconUrl }"),p.setAttribute("draggable","false"),d.appendChild(p);let g=document.createElement("div");g.className="cesium-baseLayerPicker-itemLabel",g.setAttribute("data-bind","text: name"),d.appendChild(g);let m=document.createElement("div");m.className="cesium-baseLayerPicker-sectionTitle",m.setAttribute("data-bind","visible: terrainProviderViewModels.length > 0"),m.innerHTML="Terrain",r.appendChild(m);let b=document.createElement("div");b.className="cesium-baseLayerPicker-section",b.setAttribute("data-bind","foreach: _terrainProviders"),r.appendChild(b);let x=document.createElement("div");x.className="cesium-baseLayerPicker-category",b.appendChild(x);let T=document.createElement("div");T.className="cesium-baseLayerPicker-categoryTitle",T.setAttribute("data-bind","text: name"),x.appendChild(T);let C=document.createElement("div");C.className="cesium-baseLayerPicker-choices",C.setAttribute("data-bind","foreach: providers"),x.appendChild(C);let S=document.createElement("div");S.className="cesium-baseLayerPicker-item",S.setAttribute("data-bind",'css: { "cesium-baseLayerPicker-selectedItem" : $data === $parents[1].selectedTerrain },attr: { title: tooltip },visible: creationCommand.canExecute,click: function($data) { $parents[1].selectedTerrain = $data; }'),C.appendChild(S);let v=document.createElement("img");v.className="cesium-baseLayerPicker-itemIcon",v.setAttribute("data-bind","attr: { src: iconUrl }"),v.setAttribute("draggable","false"),S.appendChild(v);let D=document.createElement("div");D.className="cesium-baseLayerPicker-itemLabel",D.setAttribute("data-bind","text: name"),S.appendChild(D),Te.applyBindings(n,i),Te.applyBindings(n,r),this._viewModel=n,this._container=e,this._element=i,this._dropPanel=r,this._closeDropDown=function(I){i.contains(I.target)||r.contains(I.target)||(n.dropDownVisible=!1)},zt.supportsPointerEvents()?document.addEventListener("pointerdown",this._closeDropDown,!0):(document.addEventListener("mousedown",this._closeDropDown,!0),document.addEventListener("touchstart",this._closeDropDown,!0))}Object.defineProperties(FF.prototype,{container:{get:function(){return this._container}},viewModel:{get:function(){return this._viewModel}}});FF.prototype.isDestroyed=function(){return!1};FF.prototype.destroy=function(){return zt.supportsPointerEvents()?document.removeEventListener("pointerdown",this._closeDropDown,!0):(document.removeEventListener("mousedown",this._closeDropDown,!0),document.removeEventListener("touchstart",this._closeDropDown,!0)),Te.cleanNode(this._element),Te.cleanNode(this._dropPanel),this._container.removeChild(this._element),this._container.removeChild(this._dropPanel),de(this)};var WK=FF;function FTe(e){if(!c(e.name))throw new E("options.name is required.");if(!c(e.tooltip))throw new E("options.tooltip is required.");if(!c(e.iconUrl))throw new E("options.iconUrl is required.");if(typeof e.creationFunction!="function")throw new E("options.creationFunction is required.");let t=e.creationFunction;c(t.canExecute)||(t=vn(t)),this._creationCommand=t,this.name=e.name,this.tooltip=e.tooltip,this.iconUrl=e.iconUrl,this._category=y(e.category,""),Te.track(this,["name","tooltip","iconUrl"])}Object.defineProperties(FTe.prototype,{creationCommand:{get:function(){return this._creationCommand}},category:{get:function(){return this._category}}});var Cs=FTe;function xCt(){let e=[],t=devicePixelRatio>=2;return e.push(new Cs({name:"Bing Maps Aerial",iconUrl:sn("Widgets/Images/ImageryProviders/bingAerial.png"),tooltip:"Bing Maps aerial imagery, provided by Cesium ion",category:"Cesium ion",creationFunction:function(){return hy({style:dy.AERIAL})}})),e.push(new Cs({name:"Bing Maps Aerial with Labels",iconUrl:sn("Widgets/Images/ImageryProviders/bingAerialLabels.png"),tooltip:"Bing Maps aerial imagery with labels, provided by Cesium ion",category:"Cesium ion",creationFunction:function(){return hy({style:dy.AERIAL_WITH_LABELS})}})),e.push(new Cs({name:"Bing Maps Roads",iconUrl:sn("Widgets/Images/ImageryProviders/bingRoads.png"),tooltip:"Bing Maps standard road maps, provided by Cesium ion",category:"Cesium ion",creationFunction:function(){return hy({style:dy.ROAD})}})),e.push(new Cs({name:"ArcGIS World Imagery",iconUrl:sn("Widgets/Images/ImageryProviders/ArcGisMapServiceWorldImagery.png"),tooltip:`ArcGIS World Imagery provides one meter or better satellite and aerial imagery in many parts of the world and lower resolution satellite imagery worldwide. The map includes 15m TerraColor imagery at small and mid-scales (~1:591M down to ~1:288k) for the world. The map features Maxar imagery at 0.3m resolution for select metropolitan areas around the world, 0.5m resolution across the United States and parts of Western Europe, and 1m resolution imagery across the rest of the world. In addition to commercial sources, the World Imagery map features high-resolution aerial photography contributed by the GIS User Community. This imagery ranges from 0.3m to 0.03m resolution (down to ~1:280 nin select communities). For more information on this map, including the terms of use, visit us online at 
https://www.arcgis.com/home/item.html?id=10df2279f9684e4a9f6a7f08febac2a9`,category:"Other",creationFunction:function(){return sy.fromBasemapType(im.SATELLITE,{enablePickFeatures:!1})}})),e.push(new Cs({name:"ArcGIS World Hillshade",iconUrl:sn("Widgets/Images/ImageryProviders/ArcGisMapServiceWorldHillshade.png"),tooltip:`ArcGIS World Hillshade map portrays elevation as an artistic hillshade. This map is designed to be used as a backdrop for topographical, soil, hydro, landcover or other outdoor recreational maps. The map was compiled from a variety of sources from several data providers. The basemap has global coverage down to a scale of ~1:72k. In select areas of the United States and Europe, coverage is available down to ~1:9k. For more information on this map, including the terms of use, visit us online at 
https://www.arcgis.com/home/item.html?id=1b243539f4514b6ba35e7d995890db1d`,category:"Other",creationFunction:function(){return sy.fromBasemapType(im.HILLSHADE,{enablePickFeatures:!1})}})),e.push(new Cs({name:"Esri World Ocean",iconUrl:sn("Widgets/Images/ImageryProviders/ArcGisMapServiceWorldOcean.png"),tooltip:`ArcGIS World Ocean map is designed to be used as a base map by marine GIS professionals and as a reference map by anyone interested in ocean data.  The base map features marine bathymetry. Land features include inland waters and roads overlaid on land cover and shaded relief imagery. The map was compiled from a variety of best available sources from several data providers, including General Bathymetric Chart of the Oceans GEBCO_08 Grid, National Oceanic and Atmospheric Administration (NOAA), and National Geographic, Garmin, HERE, Geonames.org, and Esri, and various other contributors. The base map currently provides coverage for the world down to a scale of ~1:577k, and coverage down to 1:72k in US coastal areas, and various other areas. Coverage down to ~ 1:9k is available limited areas based on regional hydrographic survey data. The base map was designed and developed by Esri. For more information on this map, including our terms of use, visit us online at 
https://www.arcgis.com/home/item.html?id=1e126e7520f9466c9ca28b8f28b5e500`,category:"Other",creationFunction:function(){return sy.fromBasemapType(im.OCEANS,{enablePickFeatures:!1})}})),e.push(new Cs({name:"Open\xADStreet\xADMap",iconUrl:sn("Widgets/Images/ImageryProviders/openStreetMap.png"),tooltip:`OpenStreetMap (OSM) is a collaborative project to create a free editable map of the world.
http://www.openstreetmap.org`,category:"Other",creationFunction:function(){return new by({url:"https://tile.openstreetmap.org/"})}})),e.push(new Cs({name:"Stadia x Stamen Watercolor",iconUrl:sn("Widgets/Images/ImageryProviders/stamenWatercolor.png"),tooltip:`Based on the original basemaps created for the Knight Foundation and reminiscent of hand drawn maps, the watercolor maps from Stamen Design apply raster effect area washes and organic edges over a paper texture to add warm pop to any map.
https://docs.stadiamaps.com/map-styles/stamen-watercolor/`,category:"Other",creationFunction:function(){return new by({url:"https://tiles.stadiamaps.com/tiles/stamen_watercolor/",fileExtension:"jpg",credit:`&copy; <a href="https://stamen.com/" target="_blank">Stamen Design</a>
           &copy; <a href="https://www.stadiamaps.com/" target="_blank">Stadia Maps</a>
           &copy; <a href="https://openmaptiles.org/" target="_blank">OpenMapTiles</a>
           &copy; <a href="https://www.openstreetmap.org/about/" target="_blank">OpenStreetMap contributors</a>`})}})),e.push(new Cs({name:"Stadia x Stamen Toner",iconUrl:sn("Widgets/Images/ImageryProviders/stamenToner.png"),tooltip:`Based on the original basemaps created for the Knight Foundation and the most popular of the excellent styles from Stamen Design, these high-contrast B+W (black and white) maps are the perfect backdrop for your colorful and eye-catching overlays.
https://docs.stadiamaps.com/map-styles/stamen-toner/`,category:"Other",creationFunction:function(){return new by({url:"https://tiles.stadiamaps.com/tiles/stamen_toner/",retinaTiles:t,credit:`&copy; <a href="https://stamen.com/" target="_blank">Stamen Design</a>
            &copy; <a href="https://www.stadiamaps.com/" target="_blank">Stadia Maps</a>
            &copy; <a href="https://openmaptiles.org/" target="_blank">OpenMapTiles</a>
            &copy; <a href="https://www.openstreetmap.org/about/" target="_blank">OpenStreetMap contributors</a>`})}})),e.push(new Cs({name:"Stadia Alidade Smooth",iconUrl:sn("Widgets/Images/ImageryProviders/stadiaAlidadeSmooth.png"),tooltip:`Stadia's custom Alidade Smooth style is designed for maps that use a lot of markers or overlays. It features a muted color scheme and fewer points of interest to allow your added data to shine.
https://docs.stadiamaps.com/map-styles/alidade-smooth/`,category:"Other",creationFunction:function(){return new by({url:"https://tiles.stadiamaps.com/tiles/alidade_smooth/",retinaTiles:t,credit:`&copy; <a href="https://www.stadiamaps.com/" target="_blank">Stadia Maps</a>
            &copy; <a href="https://openmaptiles.org/" target="_blank">OpenMapTiles</a>
            &copy; <a href="https://www.openstreetmap.org/about/" target="_blank">OpenStreetMap contributors</a>`})}})),e.push(new Cs({name:"Stadia Alidade Smooth Dark",iconUrl:sn("Widgets/Images/ImageryProviders/stadiaAlidadeSmoothDark.png"),tooltip:`Stadia Alidade Smooth Dark, like its lighter cousin, is also designed to stay out of the way. It just flips the dark mode switch on the color scheme. With the lights out, your data can now literally shine.
https://docs.stadiamaps.com/map-styles/alidade-smooth-dark/`,category:"Other",creationFunction:function(){return new by({url:"https://tiles.stadiamaps.com/tiles/alidade_smooth_dark/",retinaTiles:t,credit:`&copy; <a href="https://www.stadiamaps.com/" target="_blank">Stadia Maps</a>
            &copy; <a href="https://openmaptiles.org/" target="_blank">OpenMapTiles</a>
            &copy; <a href="https://www.openstreetmap.org/about/" target="_blank">OpenStreetMap contributors</a>`})}})),e.push(new Cs({name:"Sentinel-2",iconUrl:sn("Widgets/Images/ImageryProviders/sentinel-2.png"),tooltip:"Sentinel-2 cloudless by EOX IT Services GmbH (Contains modified Copernicus Sentinel data 2016 and 2017).",category:"Cesium ion",creationFunction:function(){return fy.fromAssetId(3954)}})),e.push(new Cs({name:"Blue Marble",iconUrl:sn("Widgets/Images/ImageryProviders/blueMarble.png"),tooltip:"Blue Marble Next Generation July, 2004 imagery from NASA.",category:"Cesium ion",creationFunction:function(){return fy.fromAssetId(3845)}})),e.push(new Cs({name:"Earth at night",iconUrl:sn("Widgets/Images/ImageryProviders/earthAtNight.png"),tooltip:"The Earth at night, also known as The Black Marble, is a 500 meter resolution global composite imagery layer released by NASA.",category:"Cesium ion",creationFunction:function(){return fy.fromAssetId(3812)}})),e.push(new Cs({name:"Natural Earth\xA0II",iconUrl:sn("Widgets/Images/ImageryProviders/naturalEarthII.png"),tooltip:`Natural Earth II, darkened for contrast.
http://www.naturalearthdata.com/`,category:"Cesium ion",creationFunction:function(){return jb.fromUrl(sn("Assets/Textures/NaturalEarthII"))}})),e}var qK=xCt;function TCt(){let e=[];return e.push(new Cs({name:"WGS84 Ellipsoid",iconUrl:sn("Widgets/Images/TerrainProviders/Ellipsoid.png"),tooltip:"WGS84 standard ellipsoid, also known as EPSG:4326",category:"Cesium ion",creationFunction:function(){return new Jp({ellipsoid:ie.WGS84})}})),e.push(new Cs({name:"Cesium World Terrain",iconUrl:sn("Widgets/Images/TerrainProviders/CesiumWorldTerrain.png"),tooltip:"High-resolution global terrain tileset curated from several datasources and hosted by Cesium ion",category:"Cesium ion",creationFunction:function(){return sC({requestWaterMask:!0,requestVertexNormals:!0})}})),e}var YK=TCt;var BTe=1e3;function Mf(e){if(!c(e)||!c(e.scene))throw new E("options.scene is required.");c(e.geocoderServices)?this._geocoderServices=e.geocoderServices:this._geocoderServices=[new xL({scene:e.scene})],this._viewContainer=e.container,this._scene=e.scene,this._flightDuration=e.flightDuration,this._searchText="",this._isSearchInProgress=!1,this._wasGeocodeCancelled=!1,this._previousCredits=[],this._complete=new pe,this._suggestions=[],this._selectedSuggestion=void 0,this._showSuggestions=!0,this._handleArrowDown=VTe,this._handleArrowUp=kTe;let t=this;this._suggestionsVisible=Te.pureComputed(function(){let o=Te.getObservable(t,"_suggestions")().length>0,r=Te.getObservable(t,"_showSuggestions")();return o&&r}),this._searchCommand=vn(function(i){if(i=y(i,Mb.SEARCH),t._focusTextbox=!1,c(t._selectedSuggestion))return t.activateSuggestion(t._selectedSuggestion),!1;if(t.hideSuggestions(),t.isSearchInProgress)vCt(t);else return SCt(t,t._geocoderServices,i)}),this.deselectSuggestion=function(){t._selectedSuggestion=void 0},this.handleKeyDown=function(i,o){let r=o.key==="ArrowDown"||o.key==="Down"||o.keyCode===40,s=o.key==="ArrowUp"||o.key==="Up"||o.keyCode===38;return(r||s)&&o.preventDefault(),!0},this.handleKeyUp=function(i,o){let r=o.key==="ArrowDown"||o.key==="Down"||o.keyCode===40,s=o.key==="ArrowUp"||o.key==="Up"||o.keyCode===38,a=o.key==="Enter"||o.keyCode===13;return s?kTe(t):r?VTe(t):a&&t._searchCommand(),!0},this.activateSuggestion=function(i){t.hideSuggestions(),t._searchText=i.displayName;let o=i.destination;HTe(t),t.destinationFound(t,o)},this.hideSuggestions=function(){t._showSuggestions=!1,t._selectedSuggestion=void 0},this.showSuggestions=function(){t._showSuggestions=!0},this.handleMouseover=function(i,o){i!==t._selectedSuggestion&&(t._selectedSuggestion=i)},this.keepExpanded=!1,this.autoComplete=y(e.autocomplete,!0),this.destinationFound=y(e.destinationFound,Mf.flyToDestination),this._focusTextbox=!1,Te.track(this,["_searchText","_isSearchInProgress","keepExpanded","_suggestions","_selectedSuggestion","_showSuggestions","_focusTextbox"]);let n=Te.getObservable(this,"_searchText");n.extend({rateLimit:{timeout:500}}),this._suggestionSubscription=n.subscribe(function(){Mf._updateSearchSuggestions(t)}),this.isSearchInProgress=void 0,Te.defineProperty(this,"isSearchInProgress",{get:function(){return this._isSearchInProgress}}),this.searchText=void 0,Te.defineProperty(this,"searchText",{get:function(){return this.isSearchInProgress?"Searching...":this._searchText},set:function(i){if(typeof i!="string")throw new E("value must be a valid string.");this._searchText=i}}),this.flightDuration=void 0,Te.defineProperty(this,"flightDuration",{get:function(){return this._flightDuration},set:function(i){if(c(i)&&i<0)throw new E("value must be positive.");this._flightDuration=i}})}Object.defineProperties(Mf.prototype,{complete:{get:function(){return this._complete}},scene:{get:function(){return this._scene}},search:{get:function(){return this._searchCommand}},selectedSuggestion:{get:function(){return this._selectedSuggestion}},suggestions:{get:function(){return this._suggestions}}});Mf.prototype.destroy=function(){this._suggestionSubscription.dispose()};function kTe(e){if(e._suggestions.length===0)return;let t=e._suggestions.indexOf(e._selectedSuggestion);if(t===-1||t===0){e._selectedSuggestion=void 0;return}let n=t-1;e._selectedSuggestion=e._suggestions[n],Mf._adjustSuggestionsScroll(e,n)}function VTe(e){if(e._suggestions.length===0)return;let t=e._suggestions.length,i=(e._suggestions.indexOf(e._selectedSuggestion)+1)%t;e._selectedSuggestion=e._suggestions[i],Mf._adjustSuggestionsScroll(e,i)}function ACt(e,t){let n=c(t)?t.availability:void 0;return c(n)?fC(t,[e]).then(function(i){return e=i[0],e.height+=BTe,e}):(e.height+=BTe,Promise.resolve(e))}function CCt(e,t){let n=e._scene,i=n.ellipsoid,o=n.camera,r=n.terrainProvider,s=t,a;return t instanceof ae?R.equalsEpsilon(t.south,t.north,R.EPSILON7)&&R.equalsEpsilon(t.east,t.west,R.EPSILON7)?t=ae.center(t):a=AC(t,n):t=i.cartesianToCartographic(t),c(a)||(a=ACt(t,r)),a.then(function(l){s=i.cartographicToCartesian(l)}).finally(function(){o.flyTo({destination:s,complete:function(){e._complete.raiseEvent()},duration:e._flightDuration,endTransform:k.IDENTITY})})}async function ECt(e,t,n){try{return{state:"fulfilled",value:await e.geocode(t,n),credits:e.credit}}catch(i){return{state:"rejected",reason:i}}}async function SCt(e,t,n){let i=e._searchText;if(zTe(i)){e.showSuggestions();return}e._isSearchInProgress=!0,e._wasGeocodeCancelled=!1;let o,r;for(o=0;o<t.length;o++){if(e._wasGeocodeCancelled)return;if(r=await ECt(t[o],i,n),c(r)&&r.state==="fulfilled"&&r.value.length>0)break}if(e._wasGeocodeCancelled)return;e._isSearchInProgress=!1,KK(e);let s=r.value;if(r.state==="fulfilled"&&c(s)&&s.length>0){e._searchText=s[0].displayName,e.destinationFound(e,s[0].destination);let a=UTe(e,TD.getCreditsFromResult(s[0]));c(a)||XK(e,t[o].credit);return}e._searchText=`${i} (not found)`}function XK(e,t){c(t)&&!e._scene.isDestroyed()&&!e._scene.frameState.creditDisplay.isDestroyed()&&(e._scene.frameState.creditDisplay.addStaticCredit(t),e._previousCredits.push(t))}function UTe(e,t){return c(t)&&t.forEach(n=>XK(e,n)),t}function KK(e){!e._scene.isDestroyed()&&!e._scene.frameState.creditDisplay.isDestroyed()&&e._previousCredits.forEach(t=>{e._scene.frameState.creditDisplay.removeStaticCredit(t)}),e._previousCredits.length=0}function wCt(e,t){let n=On(e._viewContainer),i=n.getElementsByClassName("search-results")[0],r=n.getElementsByTagName("li")[t];if(t===0){i.scrollTop=0;return}let s=r.offsetTop;s+r.clientHeight>i.clientHeight?i.scrollTop=s+r.clientHeight:s<i.scrollTop&&(i.scrollTop=s)}function vCt(e){e._isSearchInProgress&&(e._isSearchInProgress=!1,e._wasGeocodeCancelled=!0)}function zTe(e){return/^\s*$/.test(e)}function HTe(e){Te.getObservable(e,"_suggestions").removeAll()}async function DCt(e){if(!e.autoComplete)return;let t=e._searchText;if(HTe(e),KK(e),!zTe(t))for(let n of e._geocoderServices){let i=await n.geocode(t,Mb.AUTOCOMPLETE);if(e._suggestions=e._suggestions.concat(i),i.length>0){let o=!0;i.forEach(r=>{let s=TD.getCreditsFromResult(r);o=o&&!c(s),UTe(e,s)}),o&&XK(e,n.credit)}if(e._suggestions.length>=5)return}}Mf.flyToDestination=CCt;Mf._updateSearchSuggestions=DCt;Mf._adjustSuggestionsScroll=wCt;Mf.prototype.isDestroyed=function(){return!1};Mf.prototype.destroy=function(){return KK(this),de(this)};var $K=Mf;var PCt="M29.772,26.433l-7.126-7.126c0.96-1.583,1.523-3.435,1.524-5.421C24.169,8.093,19.478,3.401,13.688,3.399C7.897,3.401,3.204,8.093,3.204,13.885c0,5.789,4.693,10.481,10.484,10.481c1.987,0,3.839-0.563,5.422-1.523l7.128,7.127L29.772,26.433zM7.203,13.885c0.006-3.582,2.903-6.478,6.484-6.486c3.579,0.008,6.478,2.904,6.484,6.486c-0.007,3.58-2.905,6.476-6.484,6.484C10.106,20.361,7.209,17.465,7.203,13.885z",ICt="M24.778,21.419 19.276,15.917 24.777,10.415 21.949,7.585 16.447,13.087 10.945,7.585 8.117,10.415 13.618,15.917 8.116,21.419 10.946,24.248 16.447,18.746 21.948,24.248z";function BF(e){if(!c(e)||!c(e.container))throw new E("options.container is required.");if(!c(e.scene))throw new E("options.scene is required.");let t=On(e.container),n=new $K(e);n._startSearchPath=PCt,n._stopSearchPath=ICt;let i=document.createElement("form");i.setAttribute("data-bind","submit: search");let o=document.createElement("input");o.type="search",o.className="cesium-geocoder-input",o.setAttribute("placeholder","Enter an address or landmark..."),o.setAttribute("data-bind",'textInput: searchText,disable: isSearchInProgress,event: { keyup: handleKeyUp, keydown: handleKeyDown, mouseover: deselectSuggestion },css: { "cesium-geocoder-input-wide" : keepExpanded || searchText.length > 0 },hasFocus: _focusTextbox'),this._onTextBoxFocus=function(){setTimeout(function(){o.select()},0)},o.addEventListener("focus",this._onTextBoxFocus,!1),i.appendChild(o),this._textBox=o;let r=document.createElement("span");r.className="cesium-geocoder-searchButton",r.setAttribute("data-bind","click: search,cesiumSvgPath: { path: isSearchInProgress ? _stopSearchPath : _startSearchPath, width: 32, height: 32 }"),i.appendChild(r),t.appendChild(i);let s=document.createElement("div");s.className="search-results",s.setAttribute("data-bind","visible: _suggestionsVisible");let a=document.createElement("ul");a.setAttribute("data-bind","foreach: _suggestions");let l=document.createElement("li");a.appendChild(l),l.setAttribute("data-bind","text: $data.displayName, click: $parent.activateSuggestion, event: { mouseover: $parent.handleMouseover}, css: { active: $data === $parent._selectedSuggestion }"),s.appendChild(a),t.appendChild(s),Te.applyBindings(n,i),Te.applyBindings(n,s),this._container=t,this._searchSuggestionsContainer=s,this._viewModel=n,this._form=i,this._onInputBegin=function(u){let f=u.target;typeof u.composedPath=="function"&&(f=u.composedPath()[0]),t.contains(f)||(n._focusTextbox=!1,n.hideSuggestions())},this._onInputEnd=function(u){n._focusTextbox=!0,n.showSuggestions()},zt.supportsPointerEvents()?(document.addEventListener("pointerdown",this._onInputBegin,!0),t.addEventListener("pointerup",this._onInputEnd,!0),t.addEventListener("pointercancel",this._onInputEnd,!0)):(document.addEventListener("mousedown",this._onInputBegin,!0),t.addEventListener("mouseup",this._onInputEnd,!0),document.addEventListener("touchstart",this._onInputBegin,!0),t.addEventListener("touchend",this._onInputEnd,!0),t.addEventListener("touchcancel",this._onInputEnd,!0))}Object.defineProperties(BF.prototype,{container:{get:function(){return this._container}},searchSuggestionsContainer:{get:function(){return this._searchSuggestionsContainer}},viewModel:{get:function(){return this._viewModel}}});BF.prototype.isDestroyed=function(){return!1};BF.prototype.destroy=function(){let e=this._container;return zt.supportsPointerEvents()?(document.removeEventListener("pointerdown",this._onInputBegin,!0),e.removeEventListener("pointerup",this._onInputEnd,!0)):(document.removeEventListener("mousedown",this._onInputBegin,!0),e.removeEventListener("mouseup",this._onInputEnd,!0),document.removeEventListener("touchstart",this._onInputBegin,!0),e.removeEventListener("touchend",this._onInputEnd,!0)),this._viewModel.destroy(),Te.cleanNode(this._form),Te.cleanNode(this._searchSuggestionsContainer),e.removeChild(this._form),e.removeChild(this._searchSuggestionsContainer),this._textBox.removeEventListener("focus",this._onTextBoxFocus,!1),de(this)};var ZK=BF;function GTe(e,t){if(!c(e))throw new E("scene is required.");this._scene=e,this._duration=t;let n=this;this._command=vn(function(){n._scene.camera.flyHome(n._duration)}),this.tooltip="View Home",Te.track(this,["tooltip"])}Object.defineProperties(GTe.prototype,{scene:{get:function(){return this._scene}},command:{get:function(){return this._command}},duration:{get:function(){return this._duration},set:function(e){if(c(e)&&e<0)throw new E("value must be positive.");this._duration=e}}});var JK=GTe;function kF(e,t,n){if(!c(e))throw new E("container is required.");e=On(e);let i=new JK(t,n);i._svgPath="M14,4l-10,8.75h20l-4.25-3.7188v-4.6562h-2.812v2.1875l-2.938-2.5625zm-7.0938,9.906v10.094h14.094v-10.094h-14.094zm2.1876,2.313h3.3122v4.25h-3.3122v-4.25zm5.8442,1.281h3.406v6.438h-3.406v-6.438z";let o=document.createElement("button");o.type="button",o.className="cesium-button cesium-toolbar-button cesium-home-button",o.setAttribute("data-bind","attr: { title: tooltip },click: command,cesiumSvgPath: { path: _svgPath, width: 28, height: 28 }"),e.appendChild(o),Te.applyBindings(i,o),this._container=e,this._viewModel=i,this._element=o}Object.defineProperties(kF.prototype,{container:{get:function(){return this._container}},viewModel:{get:function(){return this._viewModel}}});kF.prototype.isDestroyed=function(){return!1};kF.prototype.destroy=function(){return Te.cleanNode(this._element),this._container.removeChild(this._element),de(this)};var QK=kF;function OCt(e){let t;if(c(e)){t="Command Statistics";let n=e.commandsInFrustums;for(let i in n)if(n.hasOwnProperty(i)){let o=parseInt(i,10),r;if(o===7)r="1, 2 and 3";else{let s=[];for(let a=2;a>=0;a--){let l=Math.pow(2,a);o>=l&&(s.push(a+1),o-=l)}r=s.reverse().join(" and ")}t+=`<br>&nbsp;&nbsp;&nbsp;&nbsp;${n[i]} in frustum ${r}`}t+=`<br>Total: ${e.totalCommands}`}return t}function e$(e,t,n){let i=Math.min(n,t);return i=Math.max(i,e),i}var RCt=new _n,MCt=new h;function BP(e,t){if(!c(e))throw new E("scene is required");if(!c(t))throw new E("performanceContainer is required");let n=this,i=e.canvas,o=new Af(i);this._eventHandler=o,this._scene=e,this._canvas=i,this._primitive=void 0,this._tile=void 0,this._modelMatrixPrimitive=void 0,this._performanceDisplay=void 0,this._performanceContainer=t;let r=this._scene.globe;r.depthTestAgainstTerrain=!0,this.frustums=!1,this.frustumPlanes=!1,this.performance=!1,this.shaderCacheText="",this.primitiveBoundingSphere=!1,this.primitiveReferenceFrame=!1,this.filterPrimitive=!1,this.tileBoundingSphere=!1,this.filterTile=!1,this.wireframe=!1,this.depthFrustum=1,this._numberOfFrustums=1,this.suspendUpdates=!1,this.tileCoordinates=!1,this.frustumStatisticText=!1,this.tileText="",this.hasPickedPrimitive=!1,this.hasPickedTile=!1,this.pickPrimitiveActive=!1,this.pickTileActive=!1,this.dropDownVisible=!0,this.generalVisible=!0,this.primitivesVisible=!1,this.terrainVisible=!1,this.depthFrustumText="",Te.track(this,["frustums","frustumPlanes","performance","shaderCacheText","primitiveBoundingSphere","primitiveReferenceFrame","filterPrimitive","tileBoundingSphere","filterTile","wireframe","depthFrustum","suspendUpdates","tileCoordinates","frustumStatisticText","tileText","hasPickedPrimitive","hasPickedTile","pickPrimitiveActive","pickTileActive","dropDownVisible","generalVisible","primitivesVisible","terrainVisible","depthFrustumText"]),this._toggleDropDown=vn(function(){n.dropDownVisible=!n.dropDownVisible}),this._toggleGeneral=vn(function(){n.generalVisible=!n.generalVisible}),this._togglePrimitives=vn(function(){n.primitivesVisible=!n.primitivesVisible}),this._toggleTerrain=vn(function(){n.terrainVisible=!n.terrainVisible}),this._frustumsSubscription=Te.getObservable(this,"frustums").subscribe(function(u){n._scene.debugShowFrustums=u,n._scene.requestRender()}),this._frustumPlanesSubscription=Te.getObservable(this,"frustumPlanes").subscribe(function(u){n._scene.debugShowFrustumPlanes=u,n._scene.requestRender()}),this._performanceSubscription=Te.getObservable(this,"performance").subscribe(function(u){u?n._performanceDisplay=new xy({container:n._performanceContainer}):n._performanceContainer.innerHTML=""}),this._showPrimitiveBoundingSphere=vn(function(){return n._primitive.debugShowBoundingVolume=n.primitiveBoundingSphere,n._scene.requestRender(),!0}),this._primitiveBoundingSphereSubscription=Te.getObservable(this,"primitiveBoundingSphere").subscribe(function(){n._showPrimitiveBoundingSphere()}),this._showPrimitiveReferenceFrame=vn(function(){if(n.primitiveReferenceFrame){let u=n._primitive.modelMatrix;n._modelMatrixPrimitive=new rN({modelMatrix:u}),n._scene.primitives.add(n._modelMatrixPrimitive)}else c(n._modelMatrixPrimitive)&&(n._scene.primitives.remove(n._modelMatrixPrimitive),n._modelMatrixPrimitive=void 0);return n._scene.requestRender(),!0}),this._primitiveReferenceFrameSubscription=Te.getObservable(this,"primitiveReferenceFrame").subscribe(function(){n._showPrimitiveReferenceFrame()}),this._doFilterPrimitive=vn(function(){return n.filterPrimitive?n._scene.debugCommandFilter=function(u){return c(n._modelMatrixPrimitive)&&u.owner===n._modelMatrixPrimitive._primitive?!0:c(n._primitive)?u.owner===n._primitive||u.owner===n._primitive._billboardCollection||u.owner.primitive===n._primitive:!1}:n._scene.debugCommandFilter=void 0,!0}),this._filterPrimitiveSubscription=Te.getObservable(this,"filterPrimitive").subscribe(function(){n._doFilterPrimitive(),n._scene.requestRender()}),this._wireframeSubscription=Te.getObservable(this,"wireframe").subscribe(function(u){r._surface.tileProvider._debug.wireframe=u,n._scene.requestRender()}),this._depthFrustumSubscription=Te.getObservable(this,"depthFrustum").subscribe(function(u){n._scene.debugShowDepthFrustum=u,n._scene.requestRender()}),this._incrementDepthFrustum=vn(function(){let u=n.depthFrustum+1;return n.depthFrustum=e$(1,n._numberOfFrustums,u),n._scene.requestRender(),!0}),this._decrementDepthFrustum=vn(function(){let u=n.depthFrustum-1;return n.depthFrustum=e$(1,n._numberOfFrustums,u),n._scene.requestRender(),!0}),this._suspendUpdatesSubscription=Te.getObservable(this,"suspendUpdates").subscribe(function(u){r._surface._debug.suspendLodUpdate=u,u||(n.filterTile=!1)});let s;this._showTileCoordinates=vn(function(){return n.tileCoordinates&&!c(s)?s=e.imageryLayers.addImageryProvider(new EF({tilingScheme:e.terrainProvider.tilingScheme})):!n.tileCoordinates&&c(s)&&(e.imageryLayers.remove(s),s=void 0),!0}),this._tileCoordinatesSubscription=Te.getObservable(this,"tileCoordinates").subscribe(function(){n._showTileCoordinates(),n._scene.requestRender()}),this._tileBoundingSphereSubscription=Te.getObservable(this,"tileBoundingSphere").subscribe(function(){n._showTileBoundingSphere(),n._scene.requestRender()}),this._showTileBoundingSphere=vn(function(){return n.tileBoundingSphere?r._surface.tileProvider._debug.boundingSphereTile=n._tile:r._surface.tileProvider._debug.boundingSphereTile=void 0,n._scene.requestRender(),!0}),this._doFilterTile=vn(function(){return n.filterTile?(n.suspendUpdates=!0,r._surface._tilesToRender=[],c(n._tile)&&n._tile.renderable&&r._surface._tilesToRender.push(n._tile)):n.suspendUpdates=!1,!0}),this._filterTileSubscription=Te.getObservable(this,"filterTile").subscribe(function(){n.doFilterTile(),n._scene.requestRender()});function a(u){let f=n._scene.pick({x:u.position.x,y:u.position.y});c(f)&&(n.primitive=c(f.collection)?f.collection:f.primitive),n._scene.requestRender(),n.pickPrimitiveActive=!1}this._pickPrimitive=vn(function(){n.pickPrimitiveActive=!n.pickPrimitiveActive}),this._pickPrimitiveActiveSubscription=Te.getObservable(this,"pickPrimitiveActive").subscribe(function(u){u?o.setInputAction(a,bn.LEFT_CLICK):o.removeInputAction(bn.LEFT_CLICK)});function l(u){let f,d=r.ellipsoid,p=n._scene.camera.getPickRay(u.position,RCt),g=r.pick(p,n._scene,MCt);if(c(g)){let m=d.cartesianToCartographic(g),b=r._surface.tileProvider._tilesToRenderByTextureCount;for(let x=0;!f&&x<b.length;++x){let T=b[x];if(c(T))for(let C=0;!f&&C<T.length;++C){let S=T[C];ae.contains(S.rectangle,m)&&(f=S)}}}n.tile=f,n.pickTileActive=!1}this._pickTile=vn(function(){n.pickTileActive=!n.pickTileActive}),this._pickTileActiveSubscription=Te.getObservable(this,"pickTileActive").subscribe(function(u){u?o.setInputAction(l,bn.LEFT_CLICK):o.removeInputAction(bn.LEFT_CLICK)}),this._removePostRenderEvent=e.postRender.addEventListener(function(){n._update()})}Object.defineProperties(BP.prototype,{scene:{get:function(){return this._scene}},performanceContainer:{get:function(){return this._performanceContainer}},toggleDropDown:{get:function(){return this._toggleDropDown}},showPrimitiveBoundingSphere:{get:function(){return this._showPrimitiveBoundingSphere}},showPrimitiveReferenceFrame:{get:function(){return this._showPrimitiveReferenceFrame}},doFilterPrimitive:{get:function(){return this._doFilterPrimitive}},incrementDepthFrustum:{get:function(){return this._incrementDepthFrustum}},decrementDepthFrustum:{get:function(){return this._decrementDepthFrustum}},showTileCoordinates:{get:function(){return this._showTileCoordinates}},showTileBoundingSphere:{get:function(){return this._showTileBoundingSphere}},doFilterTile:{get:function(){return this._doFilterTile}},toggleGeneral:{get:function(){return this._toggleGeneral}},togglePrimitives:{get:function(){return this._togglePrimitives}},toggleTerrain:{get:function(){return this._toggleTerrain}},pickPrimitive:{get:function(){return this._pickPrimitive}},pickTile:{get:function(){return this._pickTile}},selectParent:{get:function(){let e=this;return vn(function(){e.tile=e.tile.parent})}},selectNW:{get:function(){let e=this;return vn(function(){e.tile=e.tile.northwestChild})}},selectNE:{get:function(){let e=this;return vn(function(){e.tile=e.tile.northeastChild})}},selectSW:{get:function(){let e=this;return vn(function(){e.tile=e.tile.southwestChild})}},selectSE:{get:function(){let e=this;return vn(function(){e.tile=e.tile.southeastChild})}},primitive:{get:function(){return this._primitive},set:function(e){let t=this._primitive;e!==t&&(this.hasPickedPrimitive=!0,c(t)&&(t.debugShowBoundingVolume=!1),this._scene.debugCommandFilter=void 0,c(this._modelMatrixPrimitive)&&(this._scene.primitives.remove(this._modelMatrixPrimitive),this._modelMatrixPrimitive=void 0),this._primitive=e,e.show=!1,setTimeout(function(){e.show=!0},50),this.showPrimitiveBoundingSphere(),this.showPrimitiveReferenceFrame(),this.doFilterPrimitive())}},tile:{get:function(){return this._tile},set:function(e){if(c(e)){this.hasPickedTile=!0;let t=this._tile;if(e!==t){this.tileText=`L: ${e.level} X: ${e.x} Y: ${e.y}`,this.tileText+=`<br>SW corner: ${e.rectangle.west}, ${e.rectangle.south}`,this.tileText+=`<br>NE corner: ${e.rectangle.east}, ${e.rectangle.north}`;let n=e.data;c(n)&&c(n.tileBoundingRegion)?this.tileText+=`<br>Min: ${n.tileBoundingRegion.minimumHeight} Max: ${n.tileBoundingRegion.maximumHeight}`:this.tileText+="<br>(Tile is not loaded)"}this._tile=e,this.showTileBoundingSphere(),this.doFilterTile()}else this.hasPickedTile=!1,this._tile=void 0}}});BP.prototype._update=function(){this.frustums&&(this.frustumStatisticText=OCt(this._scene.debugFrustumStatistics));let e=this._scene.numberOfFrustums;this._numberOfFrustums=e,this.depthFrustum=e$(1,e,this.depthFrustum),this.depthFrustumText=`${this.depthFrustum} of ${e}`,this.performance&&this._performanceDisplay.update(),this.primitiveReferenceFrame&&(this._modelMatrixPrimitive.modelMatrix=this._primitive.modelMatrix),this.shaderCacheText=`Cached shaders: ${this._scene.context.shaderCache.numberOfShaders}`};BP.prototype.isDestroyed=function(){return!1};BP.prototype.destroy=function(){return this._eventHandler.destroy(),this._removePostRenderEvent(),this._frustumsSubscription.dispose(),this._frustumPlanesSubscription.dispose(),this._performanceSubscription.dispose(),this._primitiveBoundingSphereSubscription.dispose(),this._primitiveReferenceFrameSubscription.dispose(),this._filterPrimitiveSubscription.dispose(),this._wireframeSubscription.dispose(),this._depthFrustumSubscription.dispose(),this._suspendUpdatesSubscription.dispose(),this._tileCoordinatesSubscription.dispose(),this._tileBoundingSphereSubscription.dispose(),this._filterTileSubscription.dispose(),this._pickPrimitiveActiveSubscription.dispose(),this._pickTileActiveSubscription.dispose(),de(this)};var t$=BP;function VF(e,t){if(!c(e))throw new E("container is required.");if(!c(t))throw new E("scene is required.");e=On(e);let n=document.createElement("div"),i=new t$(t,n);this._viewModel=i,this._container=e;let o=document.createElement("div");this._element=o;let r=document.createElement("div");r.textContent="Cesium Inspector",r.className="cesium-cesiumInspector-button",r.setAttribute("data-bind","click: toggleDropDown"),o.appendChild(r),o.className="cesium-cesiumInspector",o.setAttribute("data-bind",'css: { "cesium-cesiumInspector-visible" : dropDownVisible, "cesium-cesiumInspector-hidden" : !dropDownVisible }'),e.appendChild(this._element);let s=document.createElement("div");s.className="cesium-cesiumInspector-dropDown",o.appendChild(s);let a=Vc.createSection,l=Vc.createCheckbox,u=a(s,"General","generalVisible","toggleGeneral"),f=l("Show Frustums","frustums"),d=document.createElement("div");d.className="cesium-cesiumInspector-frustumStatistics",d.setAttribute("data-bind","visible: frustums, html: frustumStatisticText"),f.appendChild(d),u.appendChild(f),u.appendChild(l("Show Frustum Planes","frustumPlanes")),u.appendChild(l("Performance Display","performance")),n.className="cesium-cesiumInspector-performanceDisplay",u.appendChild(n);let p=document.createElement("div");p.className="cesium-cesiumInspector-shaderCache",p.setAttribute("data-bind","html: shaderCacheText"),u.appendChild(p);let g=document.createElement("div");u.appendChild(g);let m=document.createElement("span");m.setAttribute("data-bind",'html: "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Frustum:"'),g.appendChild(m);let b=document.createElement("span");b.setAttribute("data-bind","text: depthFrustumText"),g.appendChild(b);let x=document.createElement("input");x.type="button",x.value="-",x.className="cesium-cesiumInspector-pickButton",x.setAttribute("data-bind","click: decrementDepthFrustum"),g.appendChild(x);let T=document.createElement("input");T.type="button",T.value="+",T.className="cesium-cesiumInspector-pickButton",T.setAttribute("data-bind","click: incrementDepthFrustum"),g.appendChild(T);let C=a(s,"Primitives","primitivesVisible","togglePrimitives"),S=document.createElement("div");S.className="cesium-cesiumInspector-pickSection",C.appendChild(S);let v=document.createElement("input");v.type="button",v.value="Pick a primitive",v.className="cesium-cesiumInspector-pickButton",v.setAttribute("data-bind",'css: {"cesium-cesiumInspector-pickButtonHighlight" : pickPrimitiveActive}, click: pickPrimitive');let D=document.createElement("div");D.className="cesium-cesiumInspector-center",D.appendChild(v),S.appendChild(D),S.appendChild(l("Show bounding sphere","primitiveBoundingSphere","hasPickedPrimitive")),S.appendChild(l("Show reference frame","primitiveReferenceFrame","hasPickedPrimitive")),this._primitiveOnly=l("Show only selected","filterPrimitive","hasPickedPrimitive"),S.appendChild(this._primitiveOnly);let I=a(s,"Terrain","terrainVisible","toggleTerrain"),L=document.createElement("div");L.className="cesium-cesiumInspector-pickSection",I.appendChild(L);let M=document.createElement("input");M.type="button",M.value="Pick a tile",M.className="cesium-cesiumInspector-pickButton",M.setAttribute("data-bind",'css: {"cesium-cesiumInspector-pickButtonHighlight" : pickTileActive}, click: pickTile'),D=document.createElement("div"),D.appendChild(M),D.className="cesium-cesiumInspector-center",L.appendChild(D);let N=document.createElement("div");L.appendChild(N);let B=document.createElement("input");B.type="button",B.value="Parent",B.className="cesium-cesiumInspector-pickButton",B.setAttribute("data-bind","click: selectParent");let _=document.createElement("input");_.type="button",_.value="NW",_.className="cesium-cesiumInspector-pickButton",_.setAttribute("data-bind","click: selectNW");let w=document.createElement("input");w.type="button",w.value="NE",w.className="cesium-cesiumInspector-pickButton",w.setAttribute("data-bind","click: selectNE");let P=document.createElement("input");P.type="button",P.value="SW",P.className="cesium-cesiumInspector-pickButton",P.setAttribute("data-bind","click: selectSW");let O=document.createElement("input");O.type="button",O.value="SE",O.className="cesium-cesiumInspector-pickButton",O.setAttribute("data-bind","click: selectSE");let F=document.createElement("div");F.className="cesium-cesiumInspector-tileText",N.className="cesium-cesiumInspector-frustumStatistics",N.appendChild(F),N.setAttribute("data-bind","visible: hasPickedTile"),F.setAttribute("data-bind","html: tileText");let V=document.createElement("div");V.className="cesium-cesiumInspector-relativeText",V.textContent="Select relative:",N.appendChild(V);let G=document.createElement("table"),z=document.createElement("tr"),W=document.createElement("tr"),U=document.createElement("td");U.appendChild(B);let q=document.createElement("td");q.appendChild(_);let K=document.createElement("td");K.appendChild(w),z.appendChild(U),z.appendChild(q),z.appendChild(K);let te=document.createElement("td"),Y=document.createElement("td");Y.appendChild(P);let Z=document.createElement("td");Z.appendChild(O),W.appendChild(te),W.appendChild(Y),W.appendChild(Z),G.appendChild(z),G.appendChild(W),N.appendChild(G),L.appendChild(l("Show bounding volume","tileBoundingSphere","hasPickedTile")),L.appendChild(l("Show only selected","filterTile","hasPickedTile")),I.appendChild(l("Wireframe","wireframe")),I.appendChild(l("Suspend LOD update","suspendUpdates")),I.appendChild(l("Show tile coordinates","tileCoordinates")),Te.applyBindings(i,this._element)}Object.defineProperties(VF.prototype,{container:{get:function(){return this._container}},viewModel:{get:function(){return this._viewModel}}});VF.prototype.isDestroyed=function(){return!1};VF.prototype.destroy=function(){return Te.cleanNode(this._element),this._container.removeChild(this._element),this.viewModel.destroy(),de(this)};var n$=VF;function LCt(e,t){t.currentTarget.parentElement.parentElement.querySelector(`#${e.name}-expander`).classList.toggle("active"),t.currentTarget.textContent=t.currentTarget.textContent==="+"?"-":"+"}function WTe(e,t){Te.track(e);for(let n=0;n<e.sublayers.length;n++)WTe(e.sublayers[n],t)}function UF(e){return e.modelName==="FullModel"}function qTe(e){return e.modelName==="Overview"}function YTe(e){return qTe(e)||UF(e)}function jTe(e,t){if(YTe(e)){e.visibility=!1;for(let i=0;i<e.sublayers.length;i++)e.sublayers[i].visibility=!0;let n={name:e.name,modelName:e.modelName,disable:Te.observable(!1),index:t.sublayers.length};return t.topLayers.push(n),t.sublayers.push(e),n}}function NCt(e,t){if(YTe(e)){t.sublayers.forEach(i=>i.visibility=!1),t.sublayers[e.index].visibility=!0;let n=document.getElementById("bsl-wrapper");UF(e)?(t.currentLevel=t.selectedLevel,n.style.display="block"):(t.selectedLevel=t.currentLevel,t.currentLevel="All",n.style.display="none")}}async function FCt(e,t){try{let n=e.getAttributeNames();for(let i=0;i<n.length;i++)if(n[i]==="BldgLevel"){let o=e.getAttributeValues(n[i]);for(let r=0;r<o.length;r++)t.push(o[r])}t.sort((i,o)=>i-o),t.unshift("All")}catch(n){console.log(`There was an error getting attributes: ${n}`)}}function BCt(e){let t=this;this.levels=[],this.viewModel={sublayers:[],levels:this.levels,currentLevel:Te.observable(),selectedLevel:"All",topLayers:[{name:"Select a layer to explore...",disable:Te.observable(!0),index:-1}],currentLayer:Te.observable(),expandClickHandler:LCt,setOptionDisable:function(i,o){Te.applyBindingsToNode(i,{disable:o.disable},o)},defaultLayer:void 0},this.viewModel.currentLayer.subscribe(function(i){NCt(i,t.viewModel)});let n=e.sublayers;for(let i=0;i<n.length;i++){WTe(n[i],this.viewModel);let o=jTe(n[i],this.viewModel);c(o)&&(qTe(o)||!c(this.viewModel.defaultLayer)&&UF(o))&&(this.viewModel.defaultLayer=o)}if(this.viewModel.topLayers.length===1&&n.length>0){e.show=!1;let i={name:"Full Model",modelName:"FullModel",visibility:e.show,sublayers:e.sublayers};this.viewModel.defaultLayer=jTe(i,this.viewModel),this.viewModel.currentLayer.subscribe(function(o){e.show=UF(o)})}else this.viewModel.topLayers.length===1&&(this.viewModel.topLayers[0].name="Building layers not found");return FCt(e,this.levels),this.viewModel.currentLevel.subscribe(function(i){i!=="All"?e.filterByAttributes([{name:"BldgLevel",values:[i]}]):e.filterByAttributes()}),this.viewModel}var i$=BCt;function kCt(e,t){let n=document.getElementById(e);A.defined("container",n),A.defined("i3sProvider",t);let i=document.createElement("div");i.classList.add("cesium-viewer-i3s-explorer"),i.innerHTML=`
        <h3>Building explorer</h3>
        <select
          data-bind="options: topLayers, optionsText: 'name', optionsAfterRender: setOptionDisable, value: currentLayer"
        ></select>
        <div id="bsl-wrapper">
          <h3>Select Level</h3>
          <select data-bind="options: levels, value: currentLevel"></select>
          <h3>Disciplines & Categories</h3>
          <ul class="layersList" data-bind="foreach: sublayers">
            <ul class="layersList" data-bind="foreach: sublayers.sort(function (l, r) { return l.name.localeCompare(r.name) })">
              <li>
                <div class="li-wrapper">
                  <span
                    class="expandItem"
                    data-bind="click: $root.expandClickHandler"
                    >+</span
                  >
                  <input
                    type="checkbox"
                    data-bind="checked: visibility, valueUpdate: 'input', attr: { id: name}"
                  />
                  <label data-bind="attr: { for: name}">
                    <span data-bind="text: name"></span>
                  </label>
                </div>
                <ul class="nested" data-bind="attr: { id: name + '-expander'}">
                  <li data-bind="foreach: sublayers.sort(function (l, r) { return l.name.localeCompare(r.name) })">
                    <div class="li-wrapper">
                      <input
                        type="checkbox"
                        data-bind="checked: visibility, valueUpdate: 'input', attr: { id: name}"
                      />
                      <label data-bind="attr: { for: name}">
                        <span data-bind="text: name"></span>
                      </label>
                    </div>
                  </li>
                </ul>
              </li>
            </ul>
          </ul>
        </div>`,n.appendChild(i);let o=new i$(t);Te.track(o),Te.applyBindings(o,n),c(o.defaultLayer)&&(o.currentLayer=o.defaultLayer)}var VCt=kCt;var UCt="M 13.84375 7.03125 C 11.412798 7.03125 9.46875 8.975298 9.46875 11.40625 L 9.46875 11.59375 L 2.53125 7.21875 L 2.53125 24.0625 L 9.46875 19.6875 C 9.4853444 22.104033 11.423165 24.0625 13.84375 24.0625 L 25.875 24.0625 C 28.305952 24.0625 30.28125 22.087202 30.28125 19.65625 L 30.28125 11.40625 C 30.28125 8.975298 28.305952 7.03125 25.875 7.03125 L 13.84375 7.03125 z",zCt="M 27.34375 1.65625 L 5.28125 27.9375 L 8.09375 30.3125 L 30.15625 4.03125 L 27.34375 1.65625 z M 13.84375 7.03125 C 11.412798 7.03125 9.46875 8.975298 9.46875 11.40625 L 9.46875 11.59375 L 2.53125 7.21875 L 2.53125 24.0625 L 9.46875 19.6875 C 9.4724893 20.232036 9.5676108 20.7379 9.75 21.21875 L 21.65625 7.03125 L 13.84375 7.03125 z M 28.21875 7.71875 L 14.53125 24.0625 L 25.875 24.0625 C 28.305952 24.0625 30.28125 22.087202 30.28125 19.65625 L 30.28125 11.40625 C 30.28125 9.8371439 29.456025 8.4902779 28.21875 7.71875 z";function o$(){this._cameraClicked=new pe,this._closeClicked=new pe,this.maxHeight=500,this.enableCamera=!1,this.isCameraTracking=!1,this.showInfo=!1,this.titleText="",this.description="",Te.track(this,["showInfo","titleText","description","maxHeight","enableCamera","isCameraTracking"]),this._loadingIndicatorHtml='<div class="cesium-infoBox-loadingContainer"><span class="cesium-infoBox-loading"></span></div>',this.cameraIconPath=void 0,Te.defineProperty(this,"cameraIconPath",{get:function(){return!this.enableCamera||this.isCameraTracking?zCt:UCt}}),Te.defineProperty(this,"_bodyless",{get:function(){return!c(this.description)||this.description.length===0}})}o$.prototype.maxHeightOffset=function(e){return`${this.maxHeight-e}px`};Object.defineProperties(o$.prototype,{cameraClicked:{get:function(){return this._cameraClicked}},closeClicked:{get:function(){return this._closeClicked}}});var r$=o$;function zF(e){A.defined("container",e),e=On(e);let t=document.createElement("div");t.className="cesium-infoBox",t.setAttribute("data-bind",'css: { "cesium-infoBox-visible" : showInfo, "cesium-infoBox-bodyless" : _bodyless }'),e.appendChild(t);let n=document.createElement("div");n.className="cesium-infoBox-title",n.setAttribute("data-bind","text: titleText"),t.appendChild(n);let i=document.createElement("button");i.type="button",i.className="cesium-button cesium-infoBox-camera",i.setAttribute("data-bind",'attr: { title: "Focus camera on object" },click: function () { cameraClicked.raiseEvent(this); },enable: enableCamera,cesiumSvgPath: { path: cameraIconPath, width: 32, height: 32 }'),t.appendChild(i);let o=document.createElement("button");o.type="button",o.className="cesium-infoBox-close",o.setAttribute("data-bind","click: function () { closeClicked.raiseEvent(this); }"),o.innerHTML="&times;",t.appendChild(o);let r=document.createElement("iframe");r.className="cesium-infoBox-iframe",r.setAttribute("sandbox","allow-same-origin allow-popups allow-forms"),r.setAttribute("data-bind","style : { maxHeight : maxHeightOffset(40) }"),r.setAttribute("allowfullscreen",!0),t.appendChild(r);let s=new r$;Te.applyBindings(s,t),this._container=e,this._element=t,this._frame=r,this._viewModel=s,this._descriptionSubscription=void 0;let a=this;r.addEventListener("load",function(){let l=r.contentDocument,u=l.createElement("link");u.href=sn("Widgets/InfoBox/InfoBoxDescription.css"),u.rel="stylesheet",u.type="text/css";let f=l.createElement("div");f.className="cesium-infoBox-description",l.head.appendChild(u),l.body.appendChild(f),a._descriptionSubscription=ac(s,"description",function(d){r.style.height="5px",f.innerHTML=d;let p=null,g=f.firstElementChild;if(g!==null&&f.childNodes.length===1){let b=window.getComputedStyle(g);if(b!==null){let x=b["background-color"],T=j.fromCssColorString(x);c(T)&&T.alpha!==0&&(p=b["background-color"])}}t.style["background-color"]=p;let m=f.getBoundingClientRect().height;r.style.height=`${m}px`})}),r.setAttribute("src","about:blank")}Object.defineProperties(zF.prototype,{container:{get:function(){return this._container}},viewModel:{get:function(){return this._viewModel}},frame:{get:function(){return this._frame}}});zF.prototype.isDestroyed=function(){return!1};zF.prototype.destroy=function(){let e=this._container;return Te.cleanNode(this._element),e.removeChild(this._element),c(this._descriptionSubscription)&&this._descriptionSubscription.dispose(),de(this)};var s$=zF;function a$(e){if(!c(e)||!c(e.scene))throw new E("options.scene is required.");this._scene=e.scene,this.lowFrameRateMessage=y(e.lowFrameRateMessage,"This application appears to be performing poorly on your system.  Please try using a different web browser or updating your video drivers."),this.lowFrameRateMessageDismissed=!1,this.showingLowFrameRateMessage=!1,Te.track(this,["lowFrameRateMessage","lowFrameRateMessageDismissed","showingLowFrameRateMessage"]);let t=this;this._dismissMessage=vn(function(){t.showingLowFrameRateMessage=!1,t.lowFrameRateMessageDismissed=!0});let n=fN.fromScene(e.scene);this._unsubscribeLowFrameRate=n.lowFrameRate.addEventListener(function(){t.lowFrameRateMessageDismissed||(t.showingLowFrameRateMessage=!0)}),this._unsubscribeNominalFrameRate=n.nominalFrameRate.addEventListener(function(){t.showingLowFrameRateMessage=!1})}Object.defineProperties(a$.prototype,{scene:{get:function(){return this._scene}},dismissMessage:{get:function(){return this._dismissMessage}}});a$.prototype.destroy=function(){return this._unsubscribeLowFrameRate(),this._unsubscribeNominalFrameRate(),de(this)};var c$=a$;function HF(e){if(!c(e)||!c(e.container))throw new E("options.container is required.");if(!c(e.scene))throw new E("options.scene is required.");let t=On(e.container),n=new c$(e),i=document.createElement("div");i.className="cesium-performance-watchdog-message-area",i.setAttribute("data-bind","visible: showingLowFrameRateMessage");let o=document.createElement("button");o.setAttribute("type","button"),o.className="cesium-performance-watchdog-message-dismiss",o.innerHTML="&times;",o.setAttribute("data-bind","click: dismissMessage"),i.appendChild(o);let r=document.createElement("div");r.className="cesium-performance-watchdog-message",r.setAttribute("data-bind","html: lowFrameRateMessage"),i.appendChild(r),t.appendChild(i),Te.applyBindings(n,i),this._container=t,this._viewModel=n,this._element=i}Object.defineProperties(HF.prototype,{container:{get:function(){return this._container}},viewModel:{get:function(){return this._viewModel}}});HF.prototype.isDestroyed=function(){return!1};HF.prototype.destroy=function(){return this._viewModel.destroy(),Te.cleanNode(this._element),this._container.removeChild(this._element),de(this)};var l$=HF;function GF(e){if(!c(e))throw new E("scene is required.");this._scene=e,this._orthographic=e.camera.frustum instanceof rn,this._flightInProgress=!1,this.dropDownVisible=!1,this.tooltipPerspective="Perspective Projection",this.tooltipOrthographic="Orthographic Projection",this.selectedTooltip=void 0,this.sceneMode=e.mode,Te.track(this,["_orthographic","_flightInProgress","sceneMode","dropDownVisible","tooltipPerspective","tooltipOrthographic"]);let t=this;Te.defineProperty(this,"selectedTooltip",function(){return t._orthographic?t.tooltipOrthographic:t.tooltipPerspective}),this._toggleDropDown=vn(function(){t.sceneMode===oe.SCENE2D||t._flightInProgress||(t.dropDownVisible=!t.dropDownVisible)}),this._eventHelper=new yr,this._eventHelper.add(e.morphComplete,function(n,i,o,r){t.sceneMode=o,t._orthographic=o===oe.SCENE2D||t._scene.camera.frustum instanceof rn}),this._eventHelper.add(e.preRender,function(){t._flightInProgress=c(e.camera._currentFlight)}),this._switchToPerspective=vn(function(){t.sceneMode!==oe.SCENE2D&&(t._scene.camera.switchToPerspectiveFrustum(),t._orthographic=!1,t.dropDownVisible=!1)}),this._switchToOrthographic=vn(function(){t.sceneMode!==oe.SCENE2D&&(t._scene.camera.switchToOrthographicFrustum(),t._orthographic=!0,t.dropDownVisible=!1)}),this._sceneMode=oe}Object.defineProperties(GF.prototype,{scene:{get:function(){return this._scene}},toggleDropDown:{get:function(){return this._toggleDropDown}},switchToPerspective:{get:function(){return this._switchToPerspective}},switchToOrthographic:{get:function(){return this._switchToOrthographic}},isOrthographicProjection:{get:function(){return this._orthographic}}});GF.prototype.isDestroyed=function(){return!1};GF.prototype.destroy=function(){this._eventHelper.removeAll(),de(this)};var u$=GF;var HCt="M 28.15625,10.4375 9.125,13.21875 13.75,43.25 41.75,55.09375 50.8125,37 54.5,11.9375 z m 0.125,3 19.976451,0.394265 L 43.03125,16.875 22.6875,14.28125 z M 50.971746,15.705477 47.90625,36.03125 42.53125,46 44.84375,19.3125 z M 12.625,16.03125 l 29.15625,3.6875 -2.65625,31 L 16.4375,41.125 z",GCt="m 31.560594,6.5254438 -20.75,12.4687502 0.1875,24.5625 22.28125,11.8125 19.5,-12 0.65625,-0.375 0,-0.75 0.0312,-23.21875 z m 0.0625,3.125 16.65625,9.5000002 -16.125,10.28125 -17.34375,-9.71875 z m 18.96875,11.1875002 0.15625,20.65625 -17.46875,10.59375 0.15625,-20.28125 z m -37.0625,1.25 17.21875,9.625 -0.15625,19.21875 -16.9375,-9 z";function jF(e,t){if(!c(e))throw new E("container is required.");if(!c(t))throw new E("scene is required.");e=On(e);let n=new u$(t);n._perspectivePath=HCt,n._orthographicPath=GCt;let i=document.createElement("span");i.className="cesium-projectionPicker-wrapper cesium-toolbar-button",e.appendChild(i);let o=document.createElement("button");o.type="button",o.className="cesium-button cesium-toolbar-button",o.setAttribute("data-bind",'css: { "cesium-projectionPicker-buttonPerspective": !_orthographic,       "cesium-projectionPicker-buttonOrthographic": _orthographic,       "cesium-button-disabled" : sceneMode === _sceneMode.SCENE2D || _flightInProgress,        "cesium-projectionPicker-selected": dropDownVisible },attr: { title: selectedTooltip },click: toggleDropDown'),o.innerHTML='<!-- ko cesiumSvgPath: { path: _perspectivePath, width: 64, height: 64, css: "cesium-projectionPicker-iconPerspective" } --><!-- /ko --><!-- ko cesiumSvgPath: { path: _orthographicPath, width: 64, height: 64, css: "cesium-projectionPicker-iconOrthographic" } --><!-- /ko -->',i.appendChild(o);let r=document.createElement("button");r.type="button",r.className="cesium-button cesium-toolbar-button cesium-projectionPicker-dropDown-icon",r.setAttribute("data-bind",'css: { "cesium-projectionPicker-visible" : (dropDownVisible && _orthographic),       "cesium-projectionPicker-none" : !_orthographic,       "cesium-projectionPicker-hidden" : !dropDownVisible },attr: { title: tooltipPerspective },click: switchToPerspective,cesiumSvgPath: { path: _perspectivePath, width: 64, height: 64 }'),i.appendChild(r);let s=document.createElement("button");s.type="button",s.className="cesium-button cesium-toolbar-button cesium-projectionPicker-dropDown-icon",s.setAttribute("data-bind",'css: { "cesium-projectionPicker-visible" : (dropDownVisible && !_orthographic),       "cesium-projectionPicker-none" : _orthographic,       "cesium-projectionPicker-hidden" : !dropDownVisible},attr: { title: tooltipOrthographic },click: switchToOrthographic,cesiumSvgPath: { path: _orthographicPath, width: 64, height: 64 }'),i.appendChild(s),Te.applyBindings(n,i),this._viewModel=n,this._container=e,this._wrapper=i,this._closeDropDown=function(a){i.contains(a.target)||(n.dropDownVisible=!1)},zt.supportsPointerEvents()?document.addEventListener("pointerdown",this._closeDropDown,!0):(document.addEventListener("mousedown",this._closeDropDown,!0),document.addEventListener("touchstart",this._closeDropDown,!0))}Object.defineProperties(jF.prototype,{container:{get:function(){return this._container}},viewModel:{get:function(){return this._viewModel}}});jF.prototype.isDestroyed=function(){return!1};jF.prototype.destroy=function(){return this._viewModel.destroy(),zt.supportsPointerEvents()?document.removeEventListener("pointerdown",this._closeDropDown,!0):(document.removeEventListener("mousedown",this._closeDropDown,!0),document.removeEventListener("touchstart",this._closeDropDown,!0)),Te.cleanNode(this._wrapper),this._container.removeChild(this._wrapper),de(this)};var f$=jF;var jCt=new H,WF="-1000px";function kP(e,t,n){if(!c(e))throw new E("scene is required.");if(!c(t))throw new E("selectionIndicatorElement is required.");if(!c(n))throw new E("container is required.");this._scene=e,this._screenPositionX=WF,this._screenPositionY=WF,this._tweens=e.tweens,this._container=y(n,document.body),this._selectionIndicatorElement=t,this._scale=1,this.position=void 0,this.showSelection=!1,Te.track(this,["position","_screenPositionX","_screenPositionY","_scale","showSelection"]),this.isVisible=void 0,Te.defineProperty(this,"isVisible",{get:function(){return this.showSelection&&c(this.position)}}),Te.defineProperty(this,"_transform",{get:function(){return`scale(${this._scale})`}}),this.computeScreenSpacePosition=function(i,o){return Ni.worldToWindowCoordinates(e,i,o)}}kP.prototype.update=function(){if(this.showSelection&&c(this.position)){let e=this.computeScreenSpacePosition(this.position,jCt);if(!c(e))this._screenPositionX=WF,this._screenPositionY=WF;else{let t=this._container,n=t.parentNode.clientWidth,i=t.parentNode.clientHeight,o=this._selectionIndicatorElement.clientWidth,r=o*.5;e.x=Math.min(Math.max(e.x,-o),n+o)-r,e.y=Math.min(Math.max(e.y,-o),i+o)-r,this._screenPositionX=`${Math.floor(e.x+.25)}px`,this._screenPositionY=`${Math.floor(e.y+.25)}px`}}};kP.prototype.animateAppear=function(){this._tweens.addProperty({object:this,property:"_scale",startValue:2,stopValue:1,duration:.8,easingFunction:qr.EXPONENTIAL_OUT})};kP.prototype.animateDepart=function(){this._tweens.addProperty({object:this,property:"_scale",startValue:this._scale,stopValue:1.5,duration:.8,easingFunction:qr.EXPONENTIAL_OUT})};Object.defineProperties(kP.prototype,{container:{get:function(){return this._container}},selectionIndicatorElement:{get:function(){return this._selectionIndicatorElement}},scene:{get:function(){return this._scene}}});var d$=kP;function qF(e,t){if(!c(e))throw new E("container is required.");e=On(e),this._container=e;let n=document.createElement("div");n.className="cesium-selection-wrapper",n.setAttribute("data-bind",'style: { "top" : _screenPositionY, "left" : _screenPositionX },css: { "cesium-selection-wrapper-visible" : isVisible }'),e.appendChild(n),this._element=n;let i="http://www.w3.org/2000/svg",o="M -34 -34 L -34 -11.25 L -30 -15.25 L -30 -30 L -15.25 -30 L -11.25 -34 L -34 -34 z M 11.25 -34 L 15.25 -30 L 30 -30 L 30 -15.25 L 34 -11.25 L 34 -34 L 11.25 -34 z M -34 11.25 L -34 34 L -11.25 34 L -15.25 30 L -30 30 L -30 15.25 L -34 11.25 z M 34 11.25 L 30 15.25 L 30 30 L 15.25 30 L 11.25 34 L 34 34 L 34 11.25 z",r=document.createElementNS(i,"svg:svg");r.setAttribute("width",160),r.setAttribute("height",160),r.setAttribute("viewBox","0 0 160 160");let s=document.createElementNS(i,"g");s.setAttribute("transform","translate(80,80)"),r.appendChild(s);let a=document.createElementNS(i,"path");a.setAttribute("data-bind","attr: { transform: _transform }"),a.setAttribute("d",o),s.appendChild(a),n.appendChild(r);let l=new d$(t,this._element,this._container);this._viewModel=l,Te.applyBindings(this._viewModel,this._element)}Object.defineProperties(qF.prototype,{container:{get:function(){return this._container}},viewModel:{get:function(){return this._viewModel}}});qF.prototype.isDestroyed=function(){return!1};qF.prototype.destroy=function(){let e=this._container;return Te.cleanNode(this._element),e.removeChild(this._element),de(this)};var h$=qF;function YF(e,t){if(!c(e))throw new E("scene is required.");this._scene=e;let n=this,i=function(o,r,s,a){n.sceneMode=s,n.dropDownVisible=!1};this._eventHelper=new yr,this._eventHelper.add(e.morphStart,i),this._duration=y(t,2),this.sceneMode=e.mode,this.dropDownVisible=!1,this.tooltip2D="2D",this.tooltip3D="3D",this.tooltipColumbusView="Columbus View",Te.track(this,["sceneMode","dropDownVisible","tooltip2D","tooltip3D","tooltipColumbusView"]),this.selectedTooltip=void 0,Te.defineProperty(this,"selectedTooltip",function(){let o=n.sceneMode;return o===oe.SCENE2D?n.tooltip2D:o===oe.SCENE3D?n.tooltip3D:n.tooltipColumbusView}),this._toggleDropDown=vn(function(){n.dropDownVisible=!n.dropDownVisible}),this._morphTo2D=vn(function(){e.morphTo2D(n._duration)}),this._morphTo3D=vn(function(){e.morphTo3D(n._duration)}),this._morphToColumbusView=vn(function(){e.morphToColumbusView(n._duration)}),this._sceneMode=oe}Object.defineProperties(YF.prototype,{scene:{get:function(){return this._scene}},duration:{get:function(){return this._duration},set:function(e){if(e<0)throw new E("duration value must be positive.");this._duration=e}},toggleDropDown:{get:function(){return this._toggleDropDown}},morphTo2D:{get:function(){return this._morphTo2D}},morphTo3D:{get:function(){return this._morphTo3D}},morphToColumbusView:{get:function(){return this._morphToColumbusView}}});YF.prototype.isDestroyed=function(){return!1};YF.prototype.destroy=function(){this._eventHelper.removeAll(),de(this)};var m$=YF;var WCt="m 32.401392,4.9330437 c -7.087603,0 -14.096095,2.884602 -19.10793,7.8946843 -5.0118352,5.010083 -7.9296167,11.987468 -7.9296167,19.072999 0,7.085531 2.9177815,14.097848 7.9296167,19.107931 4.837653,4.835961 11.541408,7.631372 18.374354,7.82482 0.05712,0.01231 0.454119,0.139729 0.454119,0.139729 l 0.03493,-0.104797 c 0.08246,7.84e-4 0.162033,0.03493 0.244525,0.03493 0.08304,0 0.161515,-0.03414 0.244526,-0.03493 l 0.03493,0.104797 c 0,0 0.309474,-0.129487 0.349323,-0.139729 6.867765,-0.168094 13.582903,-2.965206 18.444218,-7.82482 2.558195,-2.5573 4.551081,-5.638134 5.903547,-8.977584 1.297191,-3.202966 2.02607,-6.661489 2.02607,-10.130347 0,-6.237309 -2.366261,-12.31219 -6.322734,-17.116794 -0.0034,-0.02316 0.0049,-0.04488 0,-0.06986 -0.01733,-0.08745 -0.104529,-0.278855 -0.104797,-0.279458 -5.31e-4,-0.0012 -0.522988,-0.628147 -0.523984,-0.62878         -3.47e-4,-2.2e-4 -0.133444,-0.03532 -0.244525,-0.06987 C 51.944299,13.447603 51.751076,13.104317 51.474391,12.827728 46.462556,7.8176457 39.488996,4.9330437 32.401392,4.9330437 z m -2.130866,3.5281554 0.104797,9.6762289 c -4.111695,-0.08361 -7.109829,-0.423664 -9.257041,-0.943171 1.198093,-2.269271 2.524531,-4.124404 3.91241,-5.414496 2.167498,-2.0147811 3.950145,-2.8540169 5.239834,-3.3185619 z m 2.794579,0 c 1.280302,0.4754953 3.022186,1.3285948 5.065173,3.2486979 1.424667,1.338973 2.788862,3.303645 3.982275,5.728886 -2.29082,0.403367 -5.381258,0.621049 -8.942651,0.698645 L 33.065105,8.4611991 z m 5.728886,0.2445256 c 4.004072,1.1230822 7.793098,3.1481363 10.724195,6.0782083 0.03468,0.03466 0.07033,0.06991 0.104797,0.104797 -0.45375,0.313891 -0.923054,0.663002 -1.956205,1.082899 -0.647388,0.263114 -1.906242,0.477396 -2.829511,0.733577 -1.382296,-2.988132         -3.027146,-5.368585 -4.785716,-7.0213781 -0.422866,-0.397432 -0.835818,-0.6453247 -1.25756,-0.9781032 z m -15.33525,0.7685092 c -0.106753,0.09503 -0.207753,0.145402 -0.31439,0.244526 -1.684973,1.5662541 -3.298068,3.8232211 -4.680919,6.5672591 -0.343797,-0.14942 -1.035052,-0.273198 -1.292493,-0.419186 -0.956528,-0.542427 -1.362964,-1.022024 -1.537018,-1.292493 -0.0241,-0.03745 -0.01868,-0.0401 -0.03493,-0.06986 2.250095,-2.163342 4.948824,-3.869984 7.859752,-5.0302421 z m -9.641296,7.0912431 c 0.464973,0.571618 0.937729,1.169056 1.956205,1.746612 0.349907,0.198425 1.107143,0.335404 1.537018,0.523983 -1.20166,3.172984 -1.998037,7.051901 -2.165798,11.772162 C 14.256557,30.361384 12.934823,30.161483 12.280427,29.90959 10.644437,29.279855 9.6888882,28.674891 9.1714586,28.267775 8.6540289,27.860658 8.6474751,27.778724 8.6474751,27.778724 l -0.069864,0.03493 C 9.3100294,23.691285         11.163248,19.798527 13.817445,16.565477 z m 37.552149,0.523984 c 2.548924,3.289983 4.265057,7.202594 4.890513,11.318043 -0.650428,0.410896 -1.756876,1.001936 -3.563088,1.606882 -1.171552,0.392383 -3.163859,0.759153 -4.960377,1.117832 -0.04367,-4.752703 -0.784809,-8.591423 -1.88634,-11.807094 0.917574,-0.263678 2.170552,-0.486495 2.864443,-0.76851 1.274693,-0.518066 2.003942,-1.001558 2.654849,-1.467153 z m -31.439008,2.619917 c 2.487341,0.672766 5.775813,1.137775 10.479669,1.222628 l 0.104797,10.689263 0,0.03493 0,0.733577 c -5.435005,-0.09059 -9.512219,-0.519044 -12.610536,-1.117831 0.106127,-4.776683 0.879334,-8.55791 2.02607,-11.562569 z m 23.264866,0.31439 c 1.073459,3.067541 1.833795,6.821314 1.816476,11.702298 -3.054474,0.423245 -7.062018,0.648559 -11.702298,0.698644 l 0,-0.838373 -0.104796,-10.654331 c 4.082416,-0.0864 7.404468,-0.403886 9.990618,-0.908238 z         M 8.2632205,30.922625 c 0.7558676,0.510548 1.5529563,1.013339 3.0041715,1.57195 0.937518,0.360875 2.612202,0.647642 3.91241,0.978102 0.112814,3.85566 0.703989,7.107756 1.606883,9.920754 -1.147172,-0.324262 -2.644553,-0.640648 -3.423359,-0.978102 -1.516688,-0.657177 -2.386627,-1.287332 -2.864443,-1.71168 -0.477816,-0.424347 -0.489051,-0.489051 -0.489051,-0.489051 L 9.8002387,40.319395 C 8.791691,37.621767 8.1584238,34.769583 8.1584238,31.900727 c 0,-0.330153 0.090589,-0.648169 0.1047967,-0.978102 z m 48.2763445,0.419186 c 0.0047,0.188973 0.06986,0.36991 0.06986,0.558916 0,2.938869 -0.620228,5.873558 -1.676747,8.628261 -0.07435,0.07583 -0.06552,0.07411 -0.454119,0.349323 -0.606965,0.429857 -1.631665,1.042044 -3.318562,1.676747 -1.208528,0.454713 -3.204964,0.850894 -5.135038,1.25756 0.84593,-2.765726 1.41808,-6.005357 1.606883,-9.815957 2.232369,-0.413371 4.483758,-0.840201         5.938479,-1.327425 1.410632,-0.472457 2.153108,-0.89469 2.96924,-1.327425 z m -38.530252,2.864443 c 3.208141,0.56697 7.372279,0.898588 12.575603,0.978103 l 0.174662,9.885821 c -4.392517,-0.06139 -8.106722,-0.320566 -10.863925,-0.803441 -1.051954,-2.664695 -1.692909,-6.043794 -1.88634,-10.060483 z m 26.793022,0.31439 c -0.246298,3.923551 -0.877762,7.263679 -1.816476,9.885822 -2.561957,0.361954 -5.766249,0.560708 -9.431703,0.62878 l -0.174661,-9.815957 c 4.491734,-0.04969 8.334769,-0.293032 11.42284,-0.698645 z M 12.035901,44.860585 c 0.09977,0.04523 0.105535,0.09465 0.209594,0.139729 1.337656,0.579602 3.441099,1.058072 5.589157,1.537018 1.545042,3.399208 3.548524,5.969402 5.589157,7.789888 -3.034411,-1.215537 -5.871615,-3.007978 -8.174142,-5.309699 -1.245911,-1.245475 -2.271794,-2.662961 -3.213766,-4.156936 z m 40.69605,0 c -0.941972,1.493975 -1.967855,2.911461         -3.213765,4.156936 -2.74253,2.741571 -6.244106,4.696717 -9.955686,5.868615 0.261347,-0.241079 0.507495,-0.394491 0.768509,-0.663713 1.674841,-1.727516 3.320792,-4.181056 4.645987,-7.265904 2.962447,-0.503021 5.408965,-1.122293 7.161107,-1.781544 0.284034,-0.106865 0.337297,-0.207323 0.593848,-0.31439 z m -31.404076,2.305527 c 2.645807,0.376448 5.701178,0.649995 9.466635,0.698645 l 0.139729,7.789888 c -1.38739,-0.480844 -3.316218,-1.29837 -5.659022,-3.388427 -1.388822,-1.238993 -2.743668,-3.0113 -3.947342,-5.100106 z m 20.365491,0.104797 c -1.04872,2.041937 -2.174337,3.779068 -3.353494,4.995309 -1.853177,1.911459 -3.425515,2.82679 -4.611055,3.353494 l -0.139729,-7.789887 c 3.13091,-0.05714 5.728238,-0.278725 8.104278,-0.558916 z",qCt="m 2.9825053,17.550598 0,1.368113 0,26.267766 0,1.368113 1.36811,0 54.9981397,0 1.36811,0 0,-1.368113 0,-26.267766 0,-1.368113 -1.36811,0 -54.9981397,0 -1.36811,0 z m 2.73623,2.736226 10.3292497,0 0,10.466063 -10.3292497,0 0,-10.466063 z m 13.0654697,0 11.69737,0 0,10.466063 -11.69737,0 0,-10.466063 z m 14.43359,0 11.69737,0 0,10.466063 -11.69737,0 0,-10.466063 z m 14.43359,0 10.32926,0 0,10.466063 -10.32926,0 0,-10.466063 z m -41.9326497,13.202288 10.3292497,0 0,10.329252 -10.3292497,0 0,-10.329252 z m 13.0654697,0 11.69737,0 0,10.329252 -11.69737,0 0,-10.329252 z m 14.43359,0 11.69737,0 0,10.329252 -11.69737,0 0,-10.329252 z m 14.43359,0 10.32926,0 0,10.329252 -10.32926,0 0,-10.329252 z",YCt="m 14.723969,17.675598 -0.340489,0.817175 -11.1680536,26.183638 -0.817175,1.872692 2.076986,0 54.7506996,0 2.07698,0 -0.81717,-1.872692 -11.16805,-26.183638 -0.34049,-0.817175 -0.91933,0 -32.414586,0 -0.919322,0 z m 1.838643,2.723916 6.196908,0 -2.928209,10.418977 -7.729111,0 4.460412,-10.418977 z m 9.02297,0 4.903049,0 0,10.418977 -7.831258,0 2.928209,-10.418977 z m 7.626964,0 5.584031,0 2.62176,10.418977 -8.205791,0 0,-10.418977 z m 8.410081,0 5.51593,0 4.46042,10.418977 -7.38863,0 -2.58772,-10.418977 z m -30.678091,13.142892 8.103649,0 -2.89416,10.282782 -9.6018026,0 4.3923136,-10.282782 z m 10.929711,0 8.614384,0 0,10.282782 -11.508544,0 2.89416,-10.282782 z m 11.338299,0 8.852721,0 2.58772,10.282782 -11.440441,0 0,-10.282782 z m 11.678781,0 7.86531,0 4.39231,10.282782 -9.6699,0 -2.58772,-10.282782 z";function XF(e,t,n){if(!c(e))throw new E("container is required.");if(!c(t))throw new E("scene is required.");e=On(e);let i=new m$(t,n);i._globePath=WCt,i._flatMapPath=qCt,i._columbusViewPath=YCt;let o=document.createElement("span");o.className="cesium-sceneModePicker-wrapper cesium-toolbar-button",e.appendChild(o);let r=document.createElement("button");r.type="button",r.className="cesium-button cesium-toolbar-button",r.setAttribute("data-bind",'css: { "cesium-sceneModePicker-button2D": sceneMode === _sceneMode.SCENE2D,       "cesium-sceneModePicker-button3D": sceneMode === _sceneMode.SCENE3D,       "cesium-sceneModePicker-buttonColumbusView": sceneMode === _sceneMode.COLUMBUS_VIEW,       "cesium-sceneModePicker-selected": dropDownVisible },attr: { title: selectedTooltip },click: toggleDropDown'),r.innerHTML='<!-- ko cesiumSvgPath: { path: _globePath, width: 64, height: 64, css: "cesium-sceneModePicker-slide-svg cesium-sceneModePicker-icon3D" } --><!-- /ko --><!-- ko cesiumSvgPath: { path: _flatMapPath, width: 64, height: 64, css: "cesium-sceneModePicker-slide-svg cesium-sceneModePicker-icon2D" } --><!-- /ko --><!-- ko cesiumSvgPath: { path: _columbusViewPath, width: 64, height: 64, css: "cesium-sceneModePicker-slide-svg cesium-sceneModePicker-iconColumbusView" } --><!-- /ko -->',o.appendChild(r);let s=document.createElement("button");s.type="button",s.className="cesium-button cesium-toolbar-button cesium-sceneModePicker-dropDown-icon",s.setAttribute("data-bind",'css: { "cesium-sceneModePicker-visible" : (dropDownVisible && (sceneMode !== _sceneMode.SCENE3D)) || (!dropDownVisible && (sceneMode === _sceneMode.SCENE3D)),       "cesium-sceneModePicker-none" : sceneMode === _sceneMode.SCENE3D,       "cesium-sceneModePicker-hidden" : !dropDownVisible },attr: { title: tooltip3D },click: morphTo3D,cesiumSvgPath: { path: _globePath, width: 64, height: 64 }'),o.appendChild(s);let a=document.createElement("button");a.type="button",a.className="cesium-button cesium-toolbar-button cesium-sceneModePicker-dropDown-icon",a.setAttribute("data-bind",'css: { "cesium-sceneModePicker-visible" : (dropDownVisible && (sceneMode !== _sceneMode.SCENE2D)),       "cesium-sceneModePicker-none" : sceneMode === _sceneMode.SCENE2D,       "cesium-sceneModePicker-hidden" : !dropDownVisible },attr: { title: tooltip2D },click: morphTo2D,cesiumSvgPath: { path: _flatMapPath, width: 64, height: 64 }'),o.appendChild(a);let l=document.createElement("button");l.type="button",l.className="cesium-button cesium-toolbar-button cesium-sceneModePicker-dropDown-icon",l.setAttribute("data-bind",'css: { "cesium-sceneModePicker-visible" : (dropDownVisible && (sceneMode !== _sceneMode.COLUMBUS_VIEW)) || (!dropDownVisible && (sceneMode === _sceneMode.COLUMBUS_VIEW)),       "cesium-sceneModePicker-none" : sceneMode === _sceneMode.COLUMBUS_VIEW,       "cesium-sceneModePicker-hidden" : !dropDownVisible},attr: { title: tooltipColumbusView },click: morphToColumbusView,cesiumSvgPath: { path: _columbusViewPath, width: 64, height: 64 }'),o.appendChild(l),Te.applyBindings(i,o),this._viewModel=i,this._container=e,this._wrapper=o,this._closeDropDown=function(u){o.contains(u.target)||(i.dropDownVisible=!1)},zt.supportsPointerEvents()?document.addEventListener("pointerdown",this._closeDropDown,!0):(document.addEventListener("mousedown",this._closeDropDown,!0),document.addEventListener("touchstart",this._closeDropDown,!0))}Object.defineProperties(XF.prototype,{container:{get:function(){return this._container}},viewModel:{get:function(){return this._viewModel}}});XF.prototype.isDestroyed=function(){return!1};XF.prototype.destroy=function(){return this._viewModel.destroy(),zt.supportsPointerEvents()?document.removeEventListener("pointerdown",this._closeDropDown,!0):(document.removeEventListener("mousedown",this._closeDropDown,!0),document.removeEventListener("touchstart",this._closeDropDown,!0)),Te.cleanNode(this._wrapper),this._container.removeChild(this._wrapper),de(this)};var p$=XF;function XTe(){this.showInstructions=!1;let e=this;this._command=vn(function(){e.showInstructions=!e.showInstructions}),this._showClick=vn(function(){e._touch=!1}),this._showTouch=vn(function(){e._touch=!0}),this._touch=!1,this.tooltip="Navigation Instructions",Te.track(this,["tooltip","showInstructions","_touch"])}Object.defineProperties(XTe.prototype,{command:{get:function(){return this._command}},showClick:{get:function(){return this._showClick}},showTouch:{get:function(){return this._showTouch}}});var _$=XTe;function KF(e){if(!c(e)||!c(e.container))throw new E("options.container is required.");let t=On(e.container),n=new _$,i=y(e.instructionsInitiallyVisible,!1);n.showInstructions=i,n._svgPath="M16,1.466C7.973,1.466,1.466,7.973,1.466,16c0,8.027,6.507,14.534,14.534,14.534c8.027,0,14.534-6.507,14.534-14.534C30.534,7.973,24.027,1.466,16,1.466z M17.328,24.371h-2.707v-2.596h2.707V24.371zM17.328,19.003v0.858h-2.707v-1.057c0-3.19,3.63-3.696,3.63-5.963c0-1.034-0.924-1.826-2.134-1.826c-1.254,0-2.354,0.924-2.354,0.924l-1.541-1.915c0,0,1.519-1.584,4.137-1.584c2.487,0,4.796,1.54,4.796,4.136C21.156,16.208,17.328,16.627,17.328,19.003z";let o=document.createElement("span");o.className="cesium-navigationHelpButton-wrapper",t.appendChild(o);let r=document.createElement("button");r.type="button",r.className="cesium-button cesium-toolbar-button cesium-navigation-help-button",r.setAttribute("data-bind","attr: { title: tooltip },click: command,cesiumSvgPath: { path: _svgPath, width: 32, height: 32 }"),o.appendChild(r);let s=document.createElement("div");s.className="cesium-navigation-help",s.setAttribute("data-bind",'css: { "cesium-navigation-help-visible" : showInstructions}'),o.appendChild(s);let a=document.createElement("button");a.type="button",a.className="cesium-navigation-button cesium-navigation-button-left",a.setAttribute("data-bind",'click: showClick, css: {"cesium-navigation-button-selected": !_touch, "cesium-navigation-button-unselected": _touch}');let l=document.createElement("img");l.src=sn("Widgets/Images/NavigationHelp/Mouse.svg"),l.className="cesium-navigation-button-icon",l.style.width="25px",l.style.height="25px",a.appendChild(l),a.appendChild(document.createTextNode("Mouse"));let u=document.createElement("button");u.type="button",u.className="cesium-navigation-button cesium-navigation-button-right",u.setAttribute("data-bind",'click: showTouch, css: {"cesium-navigation-button-selected": _touch, "cesium-navigation-button-unselected": !_touch}');let f=document.createElement("img");f.src=sn("Widgets/Images/NavigationHelp/Touch.svg"),f.className="cesium-navigation-button-icon",f.style.width="25px",f.style.height="25px",u.appendChild(f),u.appendChild(document.createTextNode("Touch")),s.appendChild(a),s.appendChild(u);let d=document.createElement("div");d.className="cesium-click-navigation-help cesium-navigation-help-instructions",d.setAttribute("data-bind",'css: { "cesium-click-navigation-help-visible" : !_touch}'),d.innerHTML=`            <table>                <tr>                    <td><img src="${sn("Widgets/Images/NavigationHelp/MouseLeft.svg")}" width="48" height="48" /></td>                    <td>                        <div class="cesium-navigation-help-pan">Pan view</div>                        <div class="cesium-navigation-help-details">Left click + drag</div>                    </td>                </tr>                <tr>                    <td><img src="${sn("Widgets/Images/NavigationHelp/MouseRight.svg")}" width="48" height="48" /></td>                    <td>                        <div class="cesium-navigation-help-zoom">Zoom view</div>                        <div class="cesium-navigation-help-details">Right click + drag, or</div>                        <div class="cesium-navigation-help-details">Mouse wheel scroll</div>                    </td>                </tr>                <tr>                    <td><img src="${sn("Widgets/Images/NavigationHelp/MouseMiddle.svg")}" width="48" height="48" /></td>                    <td>                        <div class="cesium-navigation-help-rotate">Rotate view</div>                        <div class="cesium-navigation-help-details">Middle click + drag, or</div>                        <div class="cesium-navigation-help-details">CTRL + Left/Right click + drag</div>                    </td>                </tr>            </table>`,s.appendChild(d);let p=document.createElement("div");p.className="cesium-touch-navigation-help cesium-navigation-help-instructions",p.setAttribute("data-bind",'css: { "cesium-touch-navigation-help-visible" : _touch}'),p.innerHTML=`            <table>                <tr>                    <td><img src="${sn("Widgets/Images/NavigationHelp/TouchDrag.svg")}" width="70" height="48" /></td>                    <td>                        <div class="cesium-navigation-help-pan">Pan view</div>                        <div class="cesium-navigation-help-details">One finger drag</div>                    </td>                </tr>                <tr>                    <td><img src="${sn("Widgets/Images/NavigationHelp/TouchZoom.svg")}" width="70" height="48" /></td>                    <td>                        <div class="cesium-navigation-help-zoom">Zoom view</div>                        <div class="cesium-navigation-help-details">Two finger pinch</div>                    </td>                </tr>                <tr>                    <td><img src="${sn("Widgets/Images/NavigationHelp/TouchTilt.svg")}" width="70" height="48" /></td>                    <td>                        <div class="cesium-navigation-help-rotate">Tilt view</div>                        <div class="cesium-navigation-help-details">Two finger drag, same direction</div>                    </td>                </tr>                <tr>                    <td><img src="${sn("Widgets/Images/NavigationHelp/TouchRotate.svg")}" width="70" height="48" /></td>                    <td>                        <div class="cesium-navigation-help-tilt">Rotate view</div>                        <div class="cesium-navigation-help-details">Two finger drag, opposite direction</div>                    </td>                </tr>            </table>`,s.appendChild(p),Te.applyBindings(n,o),this._container=t,this._viewModel=n,this._wrapper=o,this._closeInstructions=function(g){o.contains(g.target)||(n.showInstructions=!1)},zt.supportsPointerEvents()?document.addEventListener("pointerdown",this._closeInstructions,!0):(document.addEventListener("mousedown",this._closeInstructions,!0),document.addEventListener("touchstart",this._closeInstructions,!0))}Object.defineProperties(KF.prototype,{container:{get:function(){return this._container}},viewModel:{get:function(){return this._viewModel}}});KF.prototype.isDestroyed=function(){return!1};KF.prototype.destroy=function(){return zt.supportsPointerEvents()?document.removeEventListener("pointerdown",this._closeInstructions,!0):(document.removeEventListener("mousedown",this._closeInstructions,!0),document.removeEventListener("touchstart",this._closeInstructions,!0)),Te.cleanNode(this._wrapper),this._container.removeChild(this._wrapper),de(this)};var g$=KF;function gx(e,t,n){this._color=e,this._height=t,this._base=y(n,0)}gx.prototype.getHeight=function(){return this._height};gx.prototype.getBase=function(){return this._base};gx.prototype.getStartTime=function(){return this._start};gx.prototype.getStopTime=function(){return this._stop};gx.prototype.setRange=function(e,t){this._start=e,this._stop=t};gx.prototype.render=function(e){let t="";if(this._start&&this._stop&&this._color){let n=J.secondsDifference(this._start,e.epochJulian),i=Math.round(e.timeBarWidth*e.getAlpha(n)),o=J.secondsDifference(this._stop,e.epochJulian),r=Math.round(e.timeBarWidth*e.getAlpha(o))-i;i<0&&(r+=i,i=0),i+r>e.timeBarWidth&&(r=e.timeBarWidth-i),r>0&&(t=`<span class="cesium-timeline-highlight" style="left: ${i.toString()}px; width: ${r.toString()}px; bottom: ${this._base.toString()}px; height: ${this._height}px; background-color: ${this._color};"></span>`)}return t};var y$=gx;function KTe(e,t,n,i){this.interval=e,this.height=t,this.color=n||new j(.5,.5,.5,1),this.backgroundColor=i||new j(0,0,0,0)}KTe.prototype.render=function(e,t){let n=this.interval.start,i=this.interval.stop,o=t.startJulian,r=J.addSeconds(t.startJulian,t.duration,new J);if(J.lessThan(n,o)&&J.greaterThan(i,r))e.fillStyle=this.color.toCssColorString(),e.fillRect(0,t.y,t.timeBarWidth,this.height);else if(J.lessThanOrEquals(n,r)&&J.greaterThanOrEquals(i,o)){let s,a,l;for(s=0;s<t.timeBarWidth;++s){let u=J.addSeconds(t.startJulian,s/t.timeBarWidth*t.duration,new J);!c(a)&&J.greaterThanOrEquals(u,n)?a=s:!c(l)&&J.greaterThanOrEquals(u,i)&&(l=s)}e.fillStyle=this.backgroundColor.toCssColorString(),e.fillRect(0,t.y,t.timeBarWidth,this.height),c(a)&&(c(l)||(l=t.timeBarWidth),e.fillStyle=this.color.toCssColorString(),e.fillRect(a,t.y,Math.max(l-a,1),this.height))}};var b$=KTe;var x$=1e12,Lf={none:0,scrub:1,slide:2,zoom:3,touchOnly:4},Uc={none:0,scrub:1,slideZoom:2,singleTap:3,ignore:4},vy=[.001,.002,.005,.01,.02,.05,.1,.25,.5,1,2,5,10,15,30,60,120,300,600,900,1800,3600,7200,14400,21600,43200,86400,172800,345600,604800,1296e3,2592e3,5184e3,7776e3,15552e3,31536e3,63072e3,126144e3,15768e4,31536e4,63072e4,126144e4,15768e5,31536e5,63072e5,126144e5,15768e6,31536e6],XCt=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function zc(e,t){if(!c(e))throw new E("container is required.");if(!c(t))throw new E("clock is required.");e=On(e);let n=e.ownerDocument;this.container=e;let i=n.createElement("div");i.className="cesium-timeline-main",e.appendChild(i),this._topDiv=i,this._endJulian=void 0,this._epochJulian=void 0,this._lastXPos=void 0,this._scrubElement=void 0,this._startJulian=void 0,this._timeBarSecondsSpan=void 0,this._clock=t,this._scrubJulian=t.currentTime,this._mainTicSpan=-1,this._mouseMode=Lf.none,this._touchMode=Uc.none,this._touchState={centerX:0,spanX:0},this._mouseX=0,this._timelineDrag=0,this._timelineDragLocation=void 0,this._lastHeight=void 0,this._lastWidth=void 0,this._topDiv.innerHTML='<div class="cesium-timeline-bar"></div><div class="cesium-timeline-trackContainer"><canvas class="cesium-timeline-tracks" width="10" height="1"></canvas></div><div class="cesium-timeline-needle"></div><span class="cesium-timeline-ruler"></span>',this._timeBarEle=this._topDiv.childNodes[0],this._trackContainer=this._topDiv.childNodes[1],this._trackListEle=this._topDiv.childNodes[1].childNodes[0],this._needleEle=this._topDiv.childNodes[2],this._rulerEle=this._topDiv.childNodes[3],this._context=this._trackListEle.getContext("2d"),this._trackList=[],this._highlightRanges=[],this.zoomTo(t.startTime,t.stopTime),this._onMouseDown=KCt(this),this._onMouseUp=$Ct(this),this._onMouseMove=ZCt(this),this._onMouseWheel=JCt(this),this._onTouchStart=QCt(this),this._onTouchMove=tEt(this),this._onTouchEnd=eEt(this);let o=this._timeBarEle;n.addEventListener("mouseup",this._onMouseUp,!1),n.addEventListener("mousemove",this._onMouseMove,!1),o.addEventListener("mousedown",this._onMouseDown,!1),o.addEventListener("DOMMouseScroll",this._onMouseWheel,!1),o.addEventListener("mousewheel",this._onMouseWheel,!1),o.addEventListener("touchstart",this._onTouchStart,!1),o.addEventListener("touchmove",this._onTouchMove,!1),o.addEventListener("touchend",this._onTouchEnd,!1),o.addEventListener("touchcancel",this._onTouchEnd,!1),this._topDiv.oncontextmenu=function(){return!1},t.onTick.addEventListener(this.updateFromClock,this),this.updateFromClock()}zc.prototype.addEventListener=function(e,t,n){this._topDiv.addEventListener(e,t,n)};zc.prototype.removeEventListener=function(e,t,n){this._topDiv.removeEventListener(e,t,n)};zc.prototype.isDestroyed=function(){return!1};zc.prototype.destroy=function(){this._clock.onTick.removeEventListener(this.updateFromClock,this);let e=this.container.ownerDocument;e.removeEventListener("mouseup",this._onMouseUp,!1),e.removeEventListener("mousemove",this._onMouseMove,!1);let t=this._timeBarEle;t.removeEventListener("mousedown",this._onMouseDown,!1),t.removeEventListener("DOMMouseScroll",this._onMouseWheel,!1),t.removeEventListener("mousewheel",this._onMouseWheel,!1),t.removeEventListener("touchstart",this._onTouchStart,!1),t.removeEventListener("touchmove",this._onTouchMove,!1),t.removeEventListener("touchend",this._onTouchEnd,!1),t.removeEventListener("touchcancel",this._onTouchEnd,!1),this.container.removeChild(this._topDiv),de(this)};zc.prototype.addHighlightRange=function(e,t,n){let i=new y$(e,t,n);return this._highlightRanges.push(i),this.resize(),i};zc.prototype.addTrack=function(e,t,n,i){let o=new b$(e,t,n,i);return this._trackList.push(o),this._lastHeight=void 0,this.resize(),o};zc.prototype.zoomTo=function(e,t){if(!c(e))throw new E("startTime is required.");if(!c(t))throw new E("stopTime is required");if(J.lessThanOrEquals(t,e))throw new E("Start time must come before end time.");if(this._startJulian=e,this._endJulian=t,this._timeBarSecondsSpan=J.secondsDifference(t,e),this._clock&&this._clock.clockRange!==jr.UNBOUNDED){let i=this._clock.startTime,o=this._clock.stopTime,r=J.secondsDifference(o,i),s=J.secondsDifference(i,this._startJulian),a=J.secondsDifference(o,this._endJulian);this._timeBarSecondsSpan>=r?(this._timeBarSecondsSpan=r,this._startJulian=this._clock.startTime,this._endJulian=this._clock.stopTime):s>0?(this._endJulian=J.addSeconds(this._endJulian,s,new J),this._startJulian=i,this._timeBarSecondsSpan=J.secondsDifference(this._endJulian,this._startJulian)):a<0&&(this._startJulian=J.addSeconds(this._startJulian,a,new J),this._endJulian=o,this._timeBarSecondsSpan=J.secondsDifference(this._endJulian,this._startJulian))}this._makeTics();let n=document.createEvent("Event");n.initEvent("setzoom",!0,!0),n.startJulian=this._startJulian,n.endJulian=this._endJulian,n.epochJulian=this._epochJulian,n.totalSpan=this._timeBarSecondsSpan,n.mainTicSpan=this._mainTicSpan,this._topDiv.dispatchEvent(n)};zc.prototype.zoomFrom=function(e){let t=J.secondsDifference(this._scrubJulian,this._startJulian);e>1||t<0||t>this._timeBarSecondsSpan?t=this._timeBarSecondsSpan*.5:t+=t-this._timeBarSecondsSpan*.5;let n=this._timeBarSecondsSpan-t;this.zoomTo(J.addSeconds(this._startJulian,t-t*e,new J),J.addSeconds(this._endJulian,n*e-n,new J))};function T$(e){return e<10?`0${e.toString()}`:e.toString()}zc.prototype.makeLabel=function(e){let t=J.toGregorianDate(e),n=t.millisecond,i=" UTC";if(n>0&&this._timeBarSecondsSpan<3600){for(i=Math.floor(n).toString();i.length<3;)i=`0${i}`;i=`.${i}`}return`${XCt[t.month-1]} ${t.day} ${t.year} ${T$(t.hour)}:${T$(t.minute)}:${T$(t.second)}${i}`};zc.prototype.smallestTicInPixels=7;zc.prototype._makeTics=function(){let e=this._timeBarEle,t=J.secondsDifference(this._scrubJulian,this._startJulian),n=Math.round(t*this._topDiv.clientWidth/this._timeBarSecondsSpan),i=n-8,o,r=this;this._needleEle.style.left=`${n.toString()}px`;let s="",a=.01,l=31536e6,u=1e-10,f=0,d=this._timeBarSecondsSpan;d<a?(d=a,this._timeBarSecondsSpan=a,this._endJulian=J.addSeconds(this._startJulian,a,new J)):d>l&&(d=l,this._timeBarSecondsSpan=l,this._endJulian=J.addSeconds(this._startJulian,l,new J));let p=this._timeBarEle.clientWidth;p<10&&(p=10);let g=this._startJulian,m=Math.min(d/p*1e-5,.4),b,x=J.toGregorianDate(g);d>31536e4?b=J.fromDate(new Date(Date.UTC(Math.floor(x.year/100)*100,0))):d>31536e3?b=J.fromDate(new Date(Date.UTC(Math.floor(x.year/10)*10,0))):d>86400?b=J.fromDate(new Date(Date.UTC(x.year,0))):b=J.fromDate(new Date(Date.UTC(x.year,x.month,x.day)));let T=J.secondsDifference(this._startJulian,J.addSeconds(b,m,new J)),C=T+d;this._epochJulian=b;function S(U){return Math.floor(T/U)*U}function v(U,q){return Math.ceil(U/q+.5)*q}function D(U){return(U-T)/d}function I(U,q){return U-q*Math.round(U/q)}this._rulerEle.innerHTML=this.makeLabel(J.addSeconds(this._endJulian,-a,new J));let L=this._rulerEle.offsetWidth+20;L<30&&(L=180);let M=f;f-=u;let N={startTime:T,startJulian:g,epochJulian:b,duration:d,timeBarWidth:p,getAlpha:D};this._highlightRanges.forEach(function(U){s+=U.render(N)});let B=0,_=0,w=0,P=L/p;P>1&&(P=1),P*=this._timeBarSecondsSpan;let O=-1,F=-1,V=vy.length,G;for(G=0;G<V;++G){let U=vy[G];if(++O,B=U,U>P&&U>f)break;F<0&&p*(U/this._timeBarSecondsSpan)>=this.smallestTicInPixels&&(F=O)}if(O>0){for(;O>0;)if(--O,Math.abs(I(B,vy[O]))<1e-5){vy[O]>=f&&(_=vy[O]);break}if(F>=0)for(;F<O;){if(Math.abs(I(_,vy[F]))<1e-5&&vy[F]>=f){w=vy[F];break}++F}}f=M,f>u&&w<1e-5&&Math.abs(f-B)>u&&(w=f,f<=B+u&&(_=0));let z=-999999,W;if(p*(w/this._timeBarSecondsSpan)>=3)for(o=S(w);o<=C;o=v(o,w))s+=`<span class="cesium-timeline-ticTiny" style="left: ${Math.round(p*D(o)).toString()}px;"></span>`;if(p*(_/this._timeBarSecondsSpan)>=3)for(o=S(_);o<=C;o=v(o,_))s+=`<span class="cesium-timeline-ticSub" style="left: ${Math.round(p*D(o)).toString()}px;"></span>`;if(p*(B/this._timeBarSecondsSpan)>=2){this._mainTicSpan=B,C+=B,o=S(B);let U=J.computeTaiMinusUtc(b);for(;o<=C;){let q=J.addSeconds(g,o-T,new J);if(B>2.1){let Z=J.computeTaiMinusUtc(q);Math.abs(Z-U)>.1&&(o+=Z-U,q=J.addSeconds(g,o-T,new J))}let K=Math.round(p*D(o)),te=this.makeLabel(q);this._rulerEle.innerHTML=te,W=this._rulerEle.offsetWidth,W<10&&(W=L);let Y=K-(W/2-1);Y>z?(z=Y+W+5,s+=`<span class="cesium-timeline-ticMain" style="left: ${K.toString()}px;"></span><span class="cesium-timeline-ticLabel" style="left: ${Y.toString()}px;">${te}</span>`):s+=`<span class="cesium-timeline-ticSub" style="left: ${K.toString()}px;"></span>`,o=v(o,B)}}else this._mainTicSpan=-1;s+=`<span class="cesium-timeline-icon16" style="left:${i}px;bottom:0;background-position: 0 0;"></span>`,e.innerHTML=s,this._scrubElement=e.lastChild,this._context.clearRect(0,0,this._trackListEle.width,this._trackListEle.height),N.y=0,this._trackList.forEach(function(U){U.render(r._context,N),N.y+=U.height})};zc.prototype.updateFromClock=function(){this._scrubJulian=this._clock.currentTime;let e=this._scrubElement;if(c(this._scrubElement)){let t=J.secondsDifference(this._scrubJulian,this._startJulian),n=Math.round(t*this._topDiv.clientWidth/this._timeBarSecondsSpan);this._lastXPos!==n&&(this._lastXPos=n,e.style.left=`${n-8}px`,this._needleEle.style.left=`${n}px`)}c(this._timelineDragLocation)&&(this._setTimeBarTime(this._timelineDragLocation,this._timelineDragLocation*this._timeBarSecondsSpan/this._topDiv.clientWidth),this.zoomTo(J.addSeconds(this._startJulian,this._timelineDrag,new J),J.addSeconds(this._endJulian,this._timelineDrag,new J)))};zc.prototype._setTimeBarTime=function(e,t){if(e=Math.round(e),this._scrubJulian=J.addSeconds(this._startJulian,t,new J),this._scrubElement){let i=e-8;this._scrubElement.style.left=`${i.toString()}px`,this._needleEle.style.left=`${e.toString()}px`}let n=document.createEvent("Event");n.initEvent("settime",!0,!0),n.clientX=e,n.timeSeconds=t,n.timeJulian=this._scrubJulian,n.clock=this._clock,this._topDiv.dispatchEvent(n)};function KCt(e){return function(t){e._mouseMode!==Lf.touchOnly&&(t.button===0?(e._mouseMode=Lf.scrub,e._scrubElement&&(e._scrubElement.style.backgroundPosition="-16px 0"),e._onMouseMove(t)):(e._mouseX=t.clientX,t.button===2?e._mouseMode=Lf.zoom:e._mouseMode=Lf.slide)),t.preventDefault()}}function $Ct(e){return function(t){e._mouseMode=Lf.none,e._scrubElement&&(e._scrubElement.style.backgroundPosition="0 0"),e._timelineDrag=0,e._timelineDragLocation=void 0}}function ZCt(e){return function(t){let n;if(e._mouseMode===Lf.scrub){t.preventDefault();let i=t.clientX-e._topDiv.getBoundingClientRect().left;i<0?(e._timelineDragLocation=0,e._timelineDrag=-.01*e._timeBarSecondsSpan):i>e._topDiv.clientWidth?(e._timelineDragLocation=e._topDiv.clientWidth,e._timelineDrag=.01*e._timeBarSecondsSpan):(e._timelineDragLocation=void 0,e._setTimeBarTime(i,i*e._timeBarSecondsSpan/e._topDiv.clientWidth))}else if(e._mouseMode===Lf.slide){if(n=e._mouseX-t.clientX,e._mouseX=t.clientX,n!==0){let i=n*e._timeBarSecondsSpan/e._topDiv.clientWidth;e.zoomTo(J.addSeconds(e._startJulian,i,new J),J.addSeconds(e._endJulian,i,new J))}}else e._mouseMode===Lf.zoom&&(n=e._mouseX-t.clientX,e._mouseX=t.clientX,n!==0&&e.zoomFrom(Math.pow(1.01,n)))}}function JCt(e){return function(t){let n=t.wheelDeltaY||t.wheelDelta||-t.detail;x$=Math.max(Math.min(Math.abs(n),x$),1),n/=x$,e.zoomFrom(Math.pow(1.05,-n))}}function QCt(e){return function(t){let n=t.touches.length,i,o,r=e._topDiv.getBoundingClientRect().left;t.preventDefault(),e._mouseMode=Lf.touchOnly,n===1?(i=J.secondsDifference(e._scrubJulian,e._startJulian),o=Math.round(i*e._topDiv.clientWidth/e._timeBarSecondsSpan+r),Math.abs(t.touches[0].clientX-o)<50?(e._touchMode=Uc.scrub,e._scrubElement&&(e._scrubElement.style.backgroundPosition=n===1?"-16px 0":"0 0")):(e._touchMode=Uc.singleTap,e._touchState.centerX=t.touches[0].clientX-r)):n===2?(e._touchMode=Uc.slideZoom,e._touchState.centerX=(t.touches[0].clientX+t.touches[1].clientX)*.5-r,e._touchState.spanX=Math.abs(t.touches[0].clientX-t.touches[1].clientX)):e._touchMode=Uc.ignore}}function eEt(e){return function(t){let n=t.touches.length,i=e._topDiv.getBoundingClientRect().left;e._touchMode===Uc.singleTap?(e._touchMode=Uc.scrub,e._onTouchMove(t)):e._touchMode===Uc.scrub&&e._onTouchMove(t),e._mouseMode=Lf.touchOnly,n!==1?e._touchMode=n>0?Uc.ignore:Uc.none:e._touchMode===Uc.slideZoom&&(e._touchState.centerX=t.touches[0].clientX-i),e._scrubElement&&(e._scrubElement.style.backgroundPosition="0 0")}}function tEt(e){return function(t){let n,i,o,r,s,a,l=1,u=e._topDiv.getBoundingClientRect().left;e._touchMode===Uc.singleTap&&(e._touchMode=Uc.slideZoom),e._mouseMode=Lf.touchOnly,e._touchMode===Uc.scrub?(t.preventDefault(),t.changedTouches.length===1&&(i=t.changedTouches[0].clientX-u,i>=0&&i<=e._topDiv.clientWidth&&e._setTimeBarTime(i,i*e._timeBarSecondsSpan/e._topDiv.clientWidth))):e._touchMode===Uc.slideZoom&&(o=t.touches.length,o===2?(r=(t.touches[0].clientX+t.touches[1].clientX)*.5-u,s=Math.abs(t.touches[0].clientX-t.touches[1].clientX)):o===1&&(r=t.touches[0].clientX-u,s=0),c(r)&&(s>0&&e._touchState.spanX>0?(l=e._touchState.spanX/s,a=J.addSeconds(e._startJulian,(e._touchState.centerX*e._timeBarSecondsSpan-r*e._timeBarSecondsSpan*l)/e._topDiv.clientWidth,new J)):(n=e._touchState.centerX-r,a=J.addSeconds(e._startJulian,n*e._timeBarSecondsSpan/e._topDiv.clientWidth,new J)),e.zoomTo(a,J.addSeconds(a,e._timeBarSecondsSpan*l,new J)),e._touchState.centerX=r,e._touchState.spanX=s))}}zc.prototype.resize=function(){let e=this.container.clientWidth,t=this.container.clientHeight;if(e===this._lastWidth&&t===this._lastHeight)return;this._trackContainer.style.height=`${t}px`;let n=1;this._trackList.forEach(function(i){n+=i.height}),this._trackListEle.style.height=`${n.toString()}px`,this._trackListEle.width=this._trackListEle.clientWidth,this._trackListEle.height=n,this._makeTics(),this._lastXPos=void 0,this._lastWidth=e,this._lastHeight=t};var A$=zc;var eAe=Ur(QTe(),1);function oEt(e){let t=!1,n=window.screen;return c(n)&&(c(n.lockOrientation)?t=n.lockOrientation(e):c(n.mozLockOrientation)?t=n.mozLockOrientation(e):c(n.msLockOrientation)?t=n.msLockOrientation(e):c(n.orientation&&n.orientation.lock)&&(t=n.orientation.lock(e))),t}function tAe(){let e=window.screen;c(e)&&(c(e.unlockOrientation)?e.unlockOrientation():c(e.mozUnlockOrientation)?e.mozUnlockOrientation():c(e.msUnlockOrientation)?e.msUnlockOrientation():c(e.orientation&&e.orientation.unlock)&&e.orientation.unlock())}function rEt(e,t,n,i){i()||(n()?(t.useWebVR=!1,e._locked&&(tAe(),e._locked=!1),e._noSleep.disable(),wr.exitFullscreen(),n(!1)):(wr.fullscreen||wr.requestFullscreen(e._vrElement),e._noSleep.enable(),e._locked||(e._locked=oEt("landscape")),t.useWebVR=!0,n(!0)))}function $F(e,t){if(!c(e))throw new E("scene is required.");let n=this,i=Te.observable(wr.enabled),o=Te.observable(!1);this.isVRMode=void 0,Te.defineProperty(this,"isVRMode",{get:function(){return o()}}),this.isVREnabled=void 0,Te.defineProperty(this,"isVREnabled",{get:function(){return i()},set:function(s){i(s&&wr.enabled)}}),this.tooltip=void 0,Te.defineProperty(this,"tooltip",function(){return i()?o()?"Exit VR mode":"Enter VR mode":"VR mode is unavailable"});let r=Te.observable(!1);this._isOrthographic=void 0,Te.defineProperty(this,"_isOrthographic",{get:function(){return r()}}),this._eventHelper=new yr,this._eventHelper.add(e.preRender,function(){r(e.camera.frustum instanceof rn)}),this._locked=!1,this._noSleep=new eAe.default,this._command=vn(function(){rEt(n,e,o,r)},Te.getObservable(this,"isVREnabled")),this._vrElement=y(On(t),document.body),this._callback=function(){!wr.fullscreen&&o()&&(e.useWebVR=!1,n._locked&&(tAe(),n._locked=!1),n._noSleep.disable(),o(!1))},document.addEventListener(wr.changeEventName,this._callback)}Object.defineProperties($F.prototype,{vrElement:{get:function(){return this._vrElement},set:function(e){if(!(e instanceof Element))throw new E("value must be a valid Element.");this._vrElement=e}},command:{get:function(){return this._command}}});$F.prototype.isDestroyed=function(){return!1};$F.prototype.destroy=function(){this._eventHelper.removeAll(),document.removeEventListener(wr.changeEventName,this._callback),de(this)};var w$=$F;var sEt="M 5.3125 6.375 C 4.008126 6.375 2.96875 7.4141499 2.96875 8.71875 L 2.96875 19.5 C 2.96875 20.8043 4.008126 21.875 5.3125 21.875 L 13.65625 21.875 C 13.71832 20.0547 14.845166 18.59375 16.21875 18.59375 C 17.592088 18.59375 18.71881 20.0552 18.78125 21.875 L 27.09375 21.875 C 28.398125 21.875 29.4375 20.8043 29.4375 19.5 L 29.4375 8.71875 C 29.4375 7.4141499 28.398125 6.375 27.09375 6.375 L 5.3125 6.375 z M 9.625 10.4375 C 11.55989 10.4375 13.125 12.03385 13.125 13.96875 C 13.125 15.90365 11.55989 17.46875 9.625 17.46875 C 7.69011 17.46875 6.125 15.90365 6.125 13.96875 C 6.125 12.03385 7.69011 10.4375 9.625 10.4375 z M 22.46875 10.4375 C 24.40364 10.4375 25.96875 12.03385 25.96875 13.96875 C 25.96875 15.90365 24.40364 17.46875 22.46875 17.46875 C 20.53386 17.46875 18.96875 15.90365 18.96875 13.96875 C 18.96875 12.03385 20.53386 10.4375 22.46875 10.4375 z",aEt="M 25.770585,2.4552065 C 15.72282,13.962707 10.699956,19.704407 8.1768352,22.580207 c -1.261561,1.4379 -1.902282,2.1427 -2.21875,2.5 -0.141624,0.1599 -0.208984,0.2355 -0.25,0.2813 l 0.6875,0.75 c 10e-5,-10e-5 0.679191,0.727 0.6875,0.7187 0.01662,-0.016 0.02451,-0.024 0.03125,-0.031 0.01348,-0.014 0.04013,-0.038 0.0625,-0.062 0.04474,-0.05 0.120921,-0.1315 0.28125,-0.3126 0.320657,-0.3619 0.956139,-1.0921 2.2187499,-2.5312 2.5252219,-2.8781 7.5454589,-8.6169 17.5937499,-20.1250005 l -1.5,-1.3125 z m -20.5624998,3.9063 c -1.304375,0 -2.34375,1.0391 -2.34375,2.3437 l 0,10.8125005 c 0,1.3043 1.039375,2.375 2.34375,2.375 l 2.25,0 c 1.9518039,-2.2246 7.4710958,-8.5584 13.5624998,-15.5312005 l -15.8124998,0 z m 21.1249998,0 c -1.855467,2.1245 -2.114296,2.4005 -3.59375,4.0936995 1.767282,0.1815 3.15625,1.685301 3.15625,3.500001 0,1.9349 -1.56511,3.5 -3.5,3.5 -1.658043,0 -3.043426,-1.1411 -3.40625,-2.6875 -1.089617,1.2461 -2.647139,2.9988 -3.46875,3.9375 0.191501,-0.062 0.388502,-0.094 0.59375,-0.094 1.373338,0 2.50006,1.4614 2.5625,3.2812 l 8.3125,0 c 1.304375,0 2.34375,-1.0707 2.34375,-2.375 l 0,-10.8125005 c 0,-1.3046 -1.039375,-2.3437 -2.34375,-2.3437 l -0.65625,0 z M 9.5518351,10.423906 c 1.9348899,0 3.4999999,1.596401 3.4999999,3.531301 0,1.9349 -1.56511,3.5 -3.4999999,3.5 -1.9348899,0 -3.4999999,-1.5651 -3.4999999,-3.5 0,-1.9349 1.56511,-3.531301 3.4999999,-3.531301 z m 4.2187499,10.312601 c -0.206517,0.2356 -0.844218,0.9428 -1.03125,1.1562 l 0.8125,0 c 0.01392,-0.4081 0.107026,-0.7968 0.21875,-1.1562 z";function ZF(e,t,n){if(!c(e))throw new E("container is required.");if(!c(t))throw new E("scene is required.");e=On(e);let i=new w$(t,n);i._exitVRPath=aEt,i._enterVRPath=sEt;let o=document.createElement("button");o.type="button",o.className="cesium-button cesium-vrButton",o.setAttribute("data-bind",'css: { "cesium-button-disabled" : _isOrthographic }, attr: { title: tooltip },click: command,enable: isVREnabled,cesiumSvgPath: { path: isVRMode ? _exitVRPath : _enterVRPath, width: 32, height: 32 }'),e.appendChild(o),Te.applyBindings(i,o),this._container=e,this._viewModel=i,this._element=o}Object.defineProperties(ZF.prototype,{container:{get:function(){return this._container}},viewModel:{get:function(){return this._viewModel}}});ZF.prototype.isDestroyed=function(){return!1};ZF.prototype.destroy=function(){return this._viewModel.destroy(),Te.cleanNode(this._element),this._container.removeChild(this._element),de(this)};var v$=ZF;var nAe=new ce;function rAe(e){let t=e.clock;t.currentTime=e.timeJulian,t.shouldAnimate=!1}function cEt(e){let t=e.getPropertyIds(),n="";return t.forEach(function(i){let o=e.getProperty(i);c(o)&&(n+=`<tr><th>${i}</th><td>${o}</td></tr>`)}),n.length>0&&(n=`<table class="cesium-infoBox-defaultTable"><tbody>${n}</tbody></table>`),n}function lEt(e){let t,n=[],i=e.getPropertyIds();for(t=0;t<i.length;t++){let r=i[t];/^name$/i.test(r)?n[0]=e.getProperty(r):/name/i.test(r)?n[1]=e.getProperty(r):/^title$/i.test(r)?n[2]=e.getProperty(r):/^(id|identifier)$/i.test(r)?n[3]=e.getProperty(r):/element/i.test(r)?n[4]=e.getProperty(r):/(id|identifier)$/i.test(r)&&(n[5]=e.getProperty(r))}let o=n.length;for(t=0;t<o;t++){let r=n[t];if(c(r)&&r!=="")return r}return"Unnamed Feature"}function iAe(e,t){let n=e.scene.pick(t.position);if(c(n)){let i=y(n.id,n.primitive.id);if(i instanceof Qo)return i;if(n instanceof Ws)return new Qo({name:lEt(n),description:cEt(n),feature:n})}if(c(e.scene.globe))return dEt(e,t.position)}var uEt=new J;function D$(e,t){if(c(t)){let n=t.clock;if(c(n)&&c(e)){let i=n.startTime,o=n.stopTime;J.equals(i,o)&&(o=J.addSeconds(i,R.EPSILON2,uEt)),e.updateFromClock(),e.zoomTo(i,o)}}}var fEt=new h;function dEt(e,t){let n=e.scene,i=n.camera.getPickRay(t),o=n.imageryLayers.pickImageryLayerFeatures(i,n);if(!c(o))return;let r=new Qo({id:"Loading...",description:"Loading feature information..."});return o.then(function(s){if(e.selectedEntity!==r)return;if(!c(s)||s.length===0){e.selectedEntity=oAe();return}let a=s[0],l=new Qo({id:a.name,description:a.description});if(c(a.position)){let u=e.scene.ellipsoid.cartographicToCartesian(a.position,fEt);l.position=new Qc(u)}e.selectedEntity=l},function(){e.selectedEntity===r&&(e.selectedEntity=oAe())}),r}function oAe(){return new Qo({id:"None",description:"No features found."})}function hEt(e,t){let n=e._geocoder,i=e._homeButton,o=e._sceneModePicker,r=e._projectionPicker,s=e._baseLayerPicker,a=e._animation,l=e._timeline,u=e._fullscreenButton,f=e._infoBox,d=e._selectionIndicator,p=t?"hidden":"visible";if(c(n)&&(n.container.style.visibility=p),c(i)&&(i.container.style.visibility=p),c(o)&&(o.container.style.visibility=p),c(r)&&(r.container.style.visibility=p),c(s)&&(s.container.style.visibility=p),c(a)&&(a.container.style.visibility=p),c(l)&&(l.container.style.visibility=p),c(u)&&u.viewModel.isFullscreenEnabled&&(u.container.style.visibility=p),c(f)&&(f.container.style.visibility=p),c(d)&&(d.container.style.visibility=p),e._container){let g=t||!c(u)?0:u.container.clientWidth;e._vrButton.container.style.right=`${g}px`,e.forceResize()}}function Hi(e,t){if(!c(e))throw new E("container is required.");e=On(e),t=y(t,y.EMPTY_OBJECT);let n=(!c(t.globe)||t.globe!==!1)&&(!c(t.baseLayerPicker)||t.baseLayerPicker!==!1);if(!n&&c(t.selectedImageryProviderViewModel))throw new E("options.selectedImageryProviderViewModel is not available when not using the BaseLayerPicker widget. Either specify options.baseLayer instead or set options.baseLayerPicker to true.");if(!n&&c(t.selectedTerrainProviderViewModel))throw new E("options.selectedTerrainProviderViewModel is not available when not using the BaseLayerPicker widget. Either specify options.terrainProvider instead or set options.baseLayerPicker to true.");let i=this,o=document.createElement("div");o.className="cesium-viewer",e.appendChild(o);let r=document.createElement("div");r.className="cesium-viewer-cesiumWidgetContainer",o.appendChild(r);let s=document.createElement("div");s.className="cesium-viewer-bottom",o.appendChild(s);let a=y(t.scene3DOnly,!1),l,u,f=!1;c(t.clockViewModel)?(u=t.clockViewModel,l=u.clock):(l=new Oh,u=new RK(l),f=!0);let d=new vF(r,{baseLayer:n&&c(t.selectedImageryProviderViewModel)||c(t.baseLayer)||c(t.imageryProvider)?!1:void 0,clock:l,shouldAnimate:t.shouldAnimate,skyBox:t.skyBox,skyAtmosphere:t.skyAtmosphere,sceneMode:t.sceneMode,ellipsoid:t.ellipsoid,mapProjection:t.mapProjection,globe:t.globe,orderIndependentTranslucency:t.orderIndependentTranslucency,automaticallyTrackDataSourceClocks:t.automaticallyTrackDataSourceClocks,contextOptions:t.contextOptions,useDefaultRenderLoop:t.useDefaultRenderLoop,targetFrameRate:t.targetFrameRate,showRenderLoopErrors:t.showRenderLoopErrors,useBrowserRecommendedResolution:t.useBrowserRecommendedResolution,creditContainer:c(t.creditContainer)?t.creditContainer:s,creditViewport:t.creditViewport,dataSources:t.dataSources,scene3DOnly:a,shadows:t.shadows,terrainShadows:t.terrainShadows,mapMode2D:t.mapMode2D,blurActiveElementOnCanvasFocus:t.blurActiveElementOnCanvasFocus,requestRenderMode:t.requestRenderMode,maximumRenderTimeChange:t.maximumRenderTimeChange,depthPlaneEllipsoidOffset:t.depthPlaneEllipsoidOffset,msaaSamples:t.msaaSamples}),p=d.scene,g=new yr;g.add(l.onTick,Hi.prototype._onTick,this);let m;if(!c(t.selectionIndicator)||t.selectionIndicator!==!1){let q=document.createElement("div");q.className="cesium-viewer-selectionIndicatorContainer",o.appendChild(q),m=new h$(q,p)}let b;if(!c(t.infoBox)||t.infoBox!==!1){let q=document.createElement("div");q.className="cesium-viewer-infoBoxContainer",o.appendChild(q),b=new s$(q);let K=b.viewModel;g.add(K.cameraClicked,Hi.prototype._onInfoBoxCameraClicked,this),g.add(K.closeClicked,Hi.prototype._onInfoBoxClockClicked,this)}let x=document.createElement("div");x.className="cesium-viewer-toolbar",o.appendChild(x);let T;if(!c(t.geocoder)||t.geocoder!==!1){let q=document.createElement("div");q.className="cesium-viewer-geocoderContainer",x.appendChild(q);let K;c(t.geocoder)&&typeof t.geocoder!="boolean"&&(K=Array.isArray(t.geocoder)?t.geocoder:[t.geocoder]),T=new ZK({container:q,geocoderServices:K,scene:p}),g.add(T.viewModel.search.beforeExecute,Hi.prototype._clearObjects,this)}let C;if((!c(t.homeButton)||t.homeButton!==!1)&&(C=new QK(x,p),c(T)&&g.add(C.viewModel.command.afterExecute,function(){let q=T.viewModel;q.searchText="",q.isSearchInProgress&&q.search()}),g.add(C.viewModel.command.beforeExecute,Hi.prototype._clearTrackedObject,this)),t.sceneModePicker===!0&&a)throw new E("options.sceneModePicker is not available when options.scene3DOnly is set to true.");let S;!a&&(!c(t.sceneModePicker)||t.sceneModePicker!==!1)&&(S=new p$(x,p));let v;t.projectionPicker&&(v=new f$(x,p));let D,I;if(n){let q=y(t.imageryProviderViewModels,qK()),K=y(t.terrainProviderViewModels,YK());D=new WK(x,{globe:p.globe,imageryProviderViewModels:q,selectedImageryProviderViewModel:t.selectedImageryProviderViewModel,terrainProviderViewModels:K,selectedTerrainProviderViewModel:t.selectedTerrainProviderViewModel}),I=x.getElementsByClassName("cesium-baseLayerPicker-dropDown")[0]}if(c(t.baseLayer)&&t.baseLayer!==!1&&(n&&(D.viewModel.selectedImagery=void 0),p.imageryLayers.removeAll(),p.imageryLayers.add(t.baseLayer)),c(t.terrainProvider)&&(n&&(D.viewModel.selectedTerrain=void 0),p.terrainProvider=t.terrainProvider),c(t.terrain)){if(c(t.terrainProvider))throw new E("Specify either options.terrainProvider or options.terrain.");n&&(p.globe.depthTestAgainstTerrain=!0),p.setTerrain(t.terrain)}let L;if(!c(t.navigationHelpButton)||t.navigationHelpButton!==!1){let q=!0;try{if(c(window.localStorage)){let K=window.localStorage.getItem("cesium-hasSeenNavHelp");c(K)&&K?q=!1:window.localStorage.setItem("cesium-hasSeenNavHelp","true")}}catch{}L=new g$({container:x,instructionsInitiallyVisible:y(t.navigationInstructionsInitiallyVisible,q)})}let M;if(!c(t.animation)||t.animation!==!1){let q=document.createElement("div");q.className="cesium-viewer-animationContainer",o.appendChild(q),M=new FK(q,new kK(u))}let N;if(!c(t.timeline)||t.timeline!==!1){let q=document.createElement("div");q.className="cesium-viewer-timelineContainer",o.appendChild(q),N=new A$(q,l),N.addEventListener("settime",rAe,!1),N.zoomTo(l.startTime,l.stopTime)}let B,_,w;(!c(t.fullscreenButton)||t.fullscreenButton!==!1)&&(w=document.createElement("div"),w.className="cesium-viewer-fullscreenContainer",o.appendChild(w),B=new GK(w,t.fullscreenElement),_=ac(B.viewModel,"isFullscreenEnabled",function(q){w.style.display=q?"block":"none",c(N)&&(N.container.style.right=`${w.clientWidth}px`,N.resize())}));let P,O,F;if(t.vrButton){let q=document.createElement("div");q.className="cesium-viewer-vrContainer",o.appendChild(q),P=new v$(q,p,t.fullScreenElement),O=ac(P.viewModel,"isVREnabled",function(K){q.style.display=K?"block":"none",c(B)&&(q.style.right=`${w.clientWidth}px`),c(N)&&(N.container.style.right=`${q.clientWidth}px`,N.resize())}),F=ac(P.viewModel,"isVRMode",function(K){hEt(i,K)})}this._baseLayerPickerDropDown=I,this._fullscreenSubscription=_,this._vrSubscription=O,this._vrModeSubscription=F,this._dataSourceChangedListeners={},this._container=e,this._bottomContainer=s,this._element=o,this._cesiumWidget=d,this._selectionIndicator=m,this._infoBox=b,this._clockViewModel=u,this._destroyClockViewModel=f,this._toolbar=x,this._homeButton=C,this._sceneModePicker=S,this._projectionPicker=v,this._baseLayerPicker=D,this._navigationHelpButton=L,this._animation=M,this._timeline=N,this._fullscreenButton=B,this._vrButton=P,this._geocoder=T,this._eventHelper=g,this._lastWidth=0,this._lastHeight=0,this._enableInfoOrSelection=c(b)||c(m),this._selectedEntity=void 0,this._selectedEntityChanged=new pe;let V=this._cesiumWidget.dataSources,G=this._cesiumWidget.dataSourceDisplay;g.add(V.dataSourceAdded,Hi.prototype._onDataSourceAdded,this),g.add(V.dataSourceRemoved,Hi.prototype._onDataSourceRemoved,this),g.add(p.postUpdate,Hi.prototype.resize,this);let z=V.length;for(let q=0;q<z;q++)this._dataSourceAdded(V,V.get(q));this._dataSourceAdded(void 0,G.defaultDataSource),g.add(V.dataSourceAdded,Hi.prototype._dataSourceAdded,this),g.add(V.dataSourceRemoved,Hi.prototype._dataSourceRemoved,this);function W(q){let K=iAe(i,q);c(K)?X.getValueOrUndefined(K.position,i.clock.currentTime)?i.trackedEntity=K:i.zoomTo(K):c(i.trackedEntity)&&(i.trackedEntity=void 0)}function U(q){i.selectedEntity=iAe(i,q)}d.screenSpaceEventHandler.setInputAction(U,bn.LEFT_CLICK),d.screenSpaceEventHandler.setInputAction(W,bn.LEFT_DOUBLE_CLICK),d._canAnimateUpdateCallback=this._updateCanAnimate(this)}Object.defineProperties(Hi.prototype,{container:{get:function(){return this._container}},creditDisplay:{get:function(){return this._cesiumWidget.creditDisplay}},bottomContainer:{get:function(){return this._bottomContainer}},cesiumWidget:{get:function(){return this._cesiumWidget}},selectionIndicator:{get:function(){return this._selectionIndicator}},infoBox:{get:function(){return this._infoBox}},geocoder:{get:function(){return this._geocoder}},homeButton:{get:function(){return this._homeButton}},sceneModePicker:{get:function(){return this._sceneModePicker}},projectionPicker:{get:function(){return this._projectionPicker}},baseLayerPicker:{get:function(){return this._baseLayerPicker}},navigationHelpButton:{get:function(){return this._navigationHelpButton}},animation:{get:function(){return this._animation}},timeline:{get:function(){return this._timeline}},fullscreenButton:{get:function(){return this._fullscreenButton}},vrButton:{get:function(){return this._vrButton}},dataSourceDisplay:{get:function(){return this._cesiumWidget.dataSourceDisplay}},entities:{get:function(){return this._cesiumWidget.entities}},dataSources:{get:function(){return this._cesiumWidget.dataSources}},canvas:{get:function(){return this._cesiumWidget.canvas}},scene:{get:function(){return this._cesiumWidget.scene}},shadows:{get:function(){return this.scene.shadowMap.enabled},set:function(e){this.scene.shadowMap.enabled=e}},terrainShadows:{get:function(){return this.scene.globe.shadows},set:function(e){this.scene.globe.shadows=e}},shadowMap:{get:function(){return this.scene.shadowMap}},imageryLayers:{get:function(){return this.scene.imageryLayers}},terrainProvider:{get:function(){return this.scene.terrainProvider},set:function(e){this.scene.terrainProvider=e}},camera:{get:function(){return this.scene.camera}},ellipsoid:{get:function(){return this._scene.ellipsoid}},postProcessStages:{get:function(){return this.scene.postProcessStages}},clock:{get:function(){return this._clockViewModel.clock}},clockViewModel:{get:function(){return this._clockViewModel}},screenSpaceEventHandler:{get:function(){return this._cesiumWidget.screenSpaceEventHandler}},targetFrameRate:{get:function(){return this._cesiumWidget.targetFrameRate},set:function(e){this._cesiumWidget.targetFrameRate=e}},useDefaultRenderLoop:{get:function(){return this._cesiumWidget.useDefaultRenderLoop},set:function(e){this._cesiumWidget.useDefaultRenderLoop=e}},resolutionScale:{get:function(){return this._cesiumWidget.resolutionScale},set:function(e){this._cesiumWidget.resolutionScale=e}},useBrowserRecommendedResolution:{get:function(){return this._cesiumWidget.useBrowserRecommendedResolution},set:function(e){this._cesiumWidget.useBrowserRecommendedResolution=e}},allowDataSourcesToSuspendAnimation:{get:function(){return this._cesiumWidget.allowDataSourcesToSuspendAnimation},set:function(e){this._cesiumWidget.allowDataSourcesToSuspendAnimation=e}},trackedEntity:{get:function(){return this._cesiumWidget.trackedEntity},set:function(e){this._cesiumWidget.trackedEntity=e}},selectedEntity:{get:function(){return this._selectedEntity},set:function(e){if(this._selectedEntity!==e){this._selectedEntity=e;let t=c(this._selectionIndicator)?this._selectionIndicator.viewModel:void 0;c(e)?c(t)&&t.animateAppear():c(t)&&t.animateDepart(),this._selectedEntityChanged.raiseEvent(e)}}},selectedEntityChanged:{get:function(){return this._selectedEntityChanged}},trackedEntityChanged:{get:function(){return this._cesiumWidget.trackedEntityChanged}},clockTrackedDataSource:{get:function(){return this._cesiumWidget.clockTrackedDataSource},set:function(e){this._cesiumWidget.clockTrackedDataSource!==e&&(this._cesiumWidget.clockTrackedDataSource=e,D$(this._timeline,e))}}});Hi.prototype.extend=function(e,t){if(!c(e))throw new E("mixin is required.");e(this,t)};Hi.prototype.resize=function(){let e=this._cesiumWidget,t=this._container,n=t.clientWidth,i=t.clientHeight,o=c(this._animation),r=c(this._timeline);if(e.resize(),n===this._lastWidth&&i===this._lastHeight)return;let s=i-125,a=this._baseLayerPickerDropDown;if(c(a)&&(a.style.maxHeight=`${s}px`),c(this._geocoder)){let m=this._geocoder.searchSuggestionsContainer;m.style.maxHeight=`${s}px`}c(this._infoBox)&&(this._infoBox.viewModel.maxHeight=s);let l=this._timeline,u,f=0,d=5,p=3,g=0;if(o&&window.getComputedStyle(this._animation.container).visibility!=="hidden"){let m=this._lastWidth;u=this._animation.container,n>900?(f=169,m<=900&&(u.style.width="169px",u.style.height="112px",this._animation.resize())):n>=600?(f=136,(m<600||m>900)&&(u.style.width="136px",u.style.height="90px",this._animation.resize())):(f=106,(m>600||m===0)&&(u.style.width="106px",u.style.height="70px",this._animation.resize())),d=f+5}if(r&&window.getComputedStyle(this._timeline.container).visibility!=="hidden"){let m=this._fullscreenButton,b=this._vrButton,x=l.container,T=x.style;p=x.clientHeight+3,T.left=`${f}px`;let C=0;c(m)&&(C+=m.container.clientWidth),c(b)&&(C+=b.container.clientWidth),T.right=`${C}px`,l.resize()}!r&&c(this._fullscreenButton)&&(g=this._fullscreenButton.container.clientWidth),this._bottomContainer.style.left=`${d}px`,this._bottomContainer.style.bottom=`${p}px`,this._bottomContainer.style.right=`${g}px`,this._lastWidth=n,this._lastHeight=i};Hi.prototype.forceResize=function(){this._lastWidth=0,this.resize()};Hi.prototype.render=function(){this._cesiumWidget.render()};Hi.prototype.isDestroyed=function(){return!1};Hi.prototype.destroy=function(){return c(this.screenSpaceEventHandler)&&!this.screenSpaceEventHandler.isDestroyed()&&(this.screenSpaceEventHandler.removeInputAction(bn.LEFT_CLICK),this.screenSpaceEventHandler.removeInputAction(bn.LEFT_DOUBLE_CLICK)),this._container.removeChild(this._element),this._element.removeChild(this._toolbar),this._eventHelper.removeAll(),c(this._geocoder)&&(this._geocoder=this._geocoder.destroy()),c(this._homeButton)&&(this._homeButton=this._homeButton.destroy()),c(this._sceneModePicker)&&(this._sceneModePicker=this._sceneModePicker.destroy()),c(this._projectionPicker)&&(this._projectionPicker=this._projectionPicker.destroy()),c(this._baseLayerPicker)&&(this._baseLayerPicker=this._baseLayerPicker.destroy()),c(this._animation)&&(this._element.removeChild(this._animation.container),this._animation=this._animation.destroy()),c(this._timeline)&&(this._timeline.removeEventListener("settime",rAe,!1),this._element.removeChild(this._timeline.container),this._timeline=this._timeline.destroy()),c(this._fullscreenButton)&&(this._fullscreenSubscription.dispose(),this._element.removeChild(this._fullscreenButton.container),this._fullscreenButton=this._fullscreenButton.destroy()),c(this._vrButton)&&(this._vrSubscription.dispose(),this._vrModeSubscription.dispose(),this._element.removeChild(this._vrButton.container),this._vrButton=this._vrButton.destroy()),c(this._infoBox)&&(this._element.removeChild(this._infoBox.container),this._infoBox=this._infoBox.destroy()),c(this._selectionIndicator)&&(this._element.removeChild(this._selectionIndicator.container),this._selectionIndicator=this._selectionIndicator.destroy()),this._destroyClockViewModel&&(this._clockViewModel=this._clockViewModel.destroy()),this._cesiumWidget=this._cesiumWidget.destroy(),de(this)};Hi.prototype._dataSourceAdded=function(e,t){t.entities.collectionChanged.addEventListener(Hi.prototype._onEntityCollectionChanged,this)};Hi.prototype._dataSourceRemoved=function(e,t){let n=t.entities;n.collectionChanged.removeEventListener(Hi.prototype._onEntityCollectionChanged,this),c(this.selectedEntity)&&n.getById(this.selectedEntity.id)===this.selectedEntity&&(this.selectedEntity=void 0)};Hi.prototype._updateCanAnimate=function(e){return function(t){e._clockViewModel.canAnimate=t}};Hi.prototype._onTick=function(e){let t=e.currentTime,n,i=!1,o=this.selectedEntity,r=c(o)&&this._enableInfoOrSelection;r&&o.isShowing&&o.isAvailable(t)&&(this._cesiumWidget.dataSourceDisplay.getBoundingSphere(o,!0,nAe)!==ct.FAILED?n=nAe.center:c(o.position)&&(n=o.position.getValue(t,n)),i=c(n));let s=c(this._selectionIndicator)?this._selectionIndicator.viewModel:void 0;c(s)&&(s.position=h.clone(n,s.position),s.showSelection=r&&i,s.update());let a=c(this._infoBox)?this._infoBox.viewModel:void 0;c(a)&&(a.showInfo=r,a.enableCamera=i,a.isCameraTracking=this.trackedEntity===this.selectedEntity,r?(a.titleText=y(o.name,o.id),a.description=X.getValueOrDefault(o.description,t,"")):(a.titleText="",a.description=""))};Hi.prototype._onEntityCollectionChanged=function(e,t,n){let i=n.length;for(let o=0;o<i;o++){let r=n[o];this.selectedEntity===r&&(this.selectedEntity=void 0)}};Hi.prototype._onInfoBoxCameraClicked=function(e){if(e.isCameraTracking&&this.trackedEntity===this.selectedEntity)this.trackedEntity=void 0;else{let n=this.selectedEntity.position;c(n)?this.trackedEntity=this.selectedEntity:this.zoomTo(this.selectedEntity)}};Hi.prototype._clearTrackedObject=function(){this.trackedEntity=void 0};Hi.prototype._onInfoBoxClockClicked=function(e){this.selectedEntity=void 0};Hi.prototype._clearObjects=function(){this.trackedEntity=void 0,this.selectedEntity=void 0};Hi.prototype._onDataSourceChanged=function(e){this.clockTrackedDataSource===e&&D$(this.timeline,e)};Hi.prototype._onDataSourceAdded=function(e,t){this._cesiumWidget._automaticallyTrackDataSourceClocks&&t===this.clockTrackedDataSource&&D$(this._timeline,t);let n=t.entities.id,i=this._eventHelper.add(t.changedEvent,Hi.prototype._onDataSourceChanged,this);this._dataSourceChangedListeners[n]=i};Hi.prototype._onDataSourceRemoved=function(e,t){let n=t.entities.id;this._dataSourceChangedListeners[n](),this._dataSourceChangedListeners[n]=void 0};Hi.prototype.zoomTo=function(e,t){return this._cesiumWidget.zoomTo(e,t)};Hi.prototype.flyTo=function(e,t){return this._cesiumWidget.flyTo(e,t)};var mEt=Hi;function pEt(e){A.typeOf.object("viewer",e);let t=document.createElement("div");t.className="cesium-viewer-cesium3DTilesInspectorContainer",e.container.appendChild(t);let n=new zK(t,e.scene);Object.defineProperties(e,{cesium3DTilesInspector:{get:function(){return n}}})}var _Et=pEt;function gEt(e){if(!c(e))throw new E("viewer is required.");let t=document.createElement("div");t.className="cesium-viewer-cesiumInspectorContainer",e.container.appendChild(t);let n=new n$(t,e.scene);Object.defineProperties(e,{cesiumInspector:{get:function(){return n}}})}var yEt=gEt;function bEt(e,t){if(!c(e))throw new E("viewer is required.");if(e.hasOwnProperty("dropTarget"))throw new E("dropTarget is already defined by another mixin.");if(e.hasOwnProperty("dropEnabled"))throw new E("dropEnabled is already defined by another mixin.");if(e.hasOwnProperty("dropError"))throw new E("dropError is already defined by another mixin.");if(e.hasOwnProperty("clearOnDrop"))throw new E("clearOnDrop is already defined by another mixin.");if(e.hasOwnProperty("flyToOnDrop"))throw new E("flyToOnDrop is already defined by another mixin.");t=y(t,y.EMPTY_OBJECT);let n=!0,i=y(t.flyToOnDrop,!0),o=new pe,r=y(t.clearOnDrop,!0),s=y(t.dropTarget,e.container),a=y(t.clampToGround,!0),l=t.proxy;s=On(s),Object.defineProperties(e,{dropTarget:{get:function(){return s},set:function(f){if(!c(f))throw new E("value is required.");sAe(s,u),s=f,P$(s,u)}},dropEnabled:{get:function(){return n},set:function(f){f!==n&&(f?P$(s,u):sAe(s,u),n=f)}},dropError:{get:function(){return o}},clearOnDrop:{get:function(){return r},set:function(f){r=f}},flyToOnDrop:{get:function(){return i},set:function(f){i=f}},proxy:{get:function(){return l},set:function(f){l=f}},clampToGround:{get:function(){return a},set:function(f){a=f}}});function u(f){yx(f),r&&(e.entities.removeAll(),e.dataSources.removeAll());let d=f.dataTransfer.files,p=d.length;for(let g=0;g<p;g++){let m=d[g],b=new FileReader;b.onload=xEt(e,m,l,a),b.onerror=TEt(e,m),b.readAsText(m)}}P$(s,u),e.destroy=IL(e,e.destroy,function(){e.dropEnabled=!1}),e._handleDrop=u}function yx(e){e.stopPropagation(),e.preventDefault()}function sAe(e,t){let n=e;c(n)&&(n.removeEventListener("drop",t,!1),n.removeEventListener("dragenter",yx,!1),n.removeEventListener("dragover",yx,!1),n.removeEventListener("dragexit",yx,!1))}function P$(e,t){e.addEventListener("drop",t,!1),e.addEventListener("dragenter",yx,!1),e.addEventListener("dragover",yx,!1),e.addEventListener("dragexit",yx,!1)}function xEt(e,t,n,i){let o=e.scene;return function(r){let s=t.name;try{let a;if(/\.czml$/i.test(s))a=mR.load(JSON.parse(r.target.result),{sourceUri:s});else if(/\.geojson$/i.test(s)||/\.json$/i.test(s)||/\.topojson$/i.test(s))a=FM.load(JSON.parse(r.target.result),{sourceUri:s,clampToGround:i});else if(/\.(kml|kmz)$/i.test(s))a=tL.load(t,{sourceUri:s,proxy:n,camera:o.camera,canvas:o.canvas,clampToGround:i,screenOverlayContainer:e.container});else if(/\.gpx$/i.test(s))a=qM.load(t,{sourceUri:s,proxy:n});else{e.dropError.raiseEvent(e,s,`Unrecognized file: ${s}`);return}c(a)&&e.dataSources.add(a).then(function(l){e.flyToOnDrop&&e.flyTo(l)}).catch(function(l){e.dropError.raiseEvent(e,s,l)})}catch(a){e.dropError.raiseEvent(e,s,a)}}}function TEt(e,t){return function(n){e.dropError.raiseEvent(e,t.name,n.target.error)}}var AEt=bEt;function CEt(e,t){if(!c(e))throw new E("viewer is required.");t=y(t,y.EMPTY_OBJECT);let n=new l$({scene:e.scene,container:e.bottomContainer,lowFrameRateMessage:t.lowFrameRateMessage});Object.defineProperties(e,{performanceWatchdog:{get:function(){return n}}})}var EEt=CEt;function aAe(e){let t=e.split(`
`),n;for(n=0;n<t.length&&!t[n].match(/\S/);n++);if(n===t.length)return"";let i="",o=/^\s*/,s=t[n].match(o)[0].length;for(let a=n;a<t.length;a++){let l=t[a];l.match(o)[0].length>=s&&(l=l.slice(s)),i+=`${l}
`}return i}function Nf(e){A.typeOf.object("scene",e),this._scene=e,this._voxelPrimitive=void 0,this._customShaderCompilationRemoveCallback=void 0,this._definedProperties=[],this._getPrimitiveFunctions=[],this._modelMatrixReady=!1;let t=this;function n(o){let{name:r,initialValue:s}=o;t._definedProperties.push(r);let a=o.setPrimitiveFunction;a===!0&&(a=function(f){t._voxelPrimitive[r]=f});let l=o.getPrimitiveFunction;l===!0&&(l=function(){t[r]=t._voxelPrimitive[r]}),c(l)&&t._getPrimitiveFunctions.push(l);let u=Te.observable();return Te.defineProperty(t,r,{get:function(){return u()},set:function(f){typeof s=="number"&&typeof f=="string"&&(f=Number(f),isNaN(f)&&(f=s)),typeof s=="boolean"&&typeof f=="number"&&(f=f===1),u(f),c(a)&&c(t._voxelPrimitive)&&(a(f),e.requestRender())}}),t[r]=s,u}function i(o,r){return function(s){let a=t._voxelPrimitive[o].clone();a[r]=s,t._voxelPrimitive[o]=a}}n({name:"inspectorVisible",initialValue:!0}),n({name:"displayVisible",initialValue:!1}),n({name:"transformVisible",initialValue:!1}),n({name:"boundsVisible",initialValue:!1}),n({name:"clippingVisible",initialValue:!1}),n({name:"shaderVisible",initialValue:!1}),n({name:"shaderString",initialValue:"",getPrimitiveFunction:function(){let o=t._voxelPrimitive.customShader.fragmentShaderText;t.shaderString=aAe(o)}}),n({name:"shaderCompilationMessage",initialValue:""}),n({name:"shaderCompilationSuccess",initialValue:!0}),n({name:"depthTest",initialValue:!1,setPrimitiveFunction:!0,getPrimitiveFunction:!0}),n({name:"show",initialValue:!0,setPrimitiveFunction:!0,getPrimitiveFunction:!0}),n({name:"disableUpdate",initialValue:!1,setPrimitiveFunction:!0,getPrimitiveFunction:!0}),n({name:"debugDraw",initialValue:!1,setPrimitiveFunction:!0,getPrimitiveFunction:!0}),n({name:"jitter",initialValue:!0,setPrimitiveFunction:!0,getPrimitiveFunction:!0}),n({name:"nearestSampling",initialValue:!0,setPrimitiveFunction:!0,getPrimitiveFunction:!0}),n({name:"screenSpaceError",initialValue:4,setPrimitiveFunction:!0,getPrimitiveFunction:!0}),n({name:"stepSize",initialValue:1,setPrimitiveFunction:!0,getPrimitiveFunction:!0}),n({name:"shapeIsBox",getPrimitiveFunction:function(){let o=t._voxelPrimitive.shape;t.shapeIsBox=o===Oi.BOX}}),n({name:"shapeIsEllipsoid",getPrimitiveFunction:function(){let o=t._voxelPrimitive.shape;t.shapeIsEllipsoid=o===Oi.ELLIPSOID}}),n({name:"shapeIsCylinder",getPrimitiveFunction:function(){let o=t._voxelPrimitive.shape;t.shapeIsCylinder=o===Oi.CYLINDER}}),n({name:"boundsBoxMaxX",initialValue:0,setPrimitiveFunction:i("maxBounds","x"),getPrimitiveFunction:function(){t.boundsBoxMaxX=t._voxelPrimitive.maxBounds.x}}),n({name:"boundsBoxMinX",initialValue:0,setPrimitiveFunction:i("minBounds","x"),getPrimitiveFunction:function(){t.boundsBoxMinX=t._voxelPrimitive.minBounds.x}}),n({name:"boundsBoxMaxY",initialValue:0,setPrimitiveFunction:i("maxBounds","y"),getPrimitiveFunction:function(){t.boundsBoxMaxY=t._voxelPrimitive.maxBounds.y}}),n({name:"boundsBoxMinY",initialValue:0,setPrimitiveFunction:i("minBounds","y"),getPrimitiveFunction:function(){t.boundsBoxMinY=t._voxelPrimitive.minBounds.y}}),n({name:"boundsBoxMaxZ",initialValue:0,setPrimitiveFunction:i("maxBounds","z"),getPrimitiveFunction:function(){t.boundsBoxMaxZ=t._voxelPrimitive.maxBounds.z}}),n({name:"boundsBoxMinZ",initialValue:0,setPrimitiveFunction:i("minBounds","z"),getPrimitiveFunction:function(){t.boundsBoxMinZ=t._voxelPrimitive.minBounds.z}}),n({name:"boundsEllipsoidMaxLongitude",initialValue:0,setPrimitiveFunction:i("maxBounds","x"),getPrimitiveFunction:function(){t.boundsEllipsoidMaxLongitude=t._voxelPrimitive.maxBounds.x}}),n({name:"boundsEllipsoidMinLongitude",initialValue:0,setPrimitiveFunction:i("minBounds","x"),getPrimitiveFunction:function(){t.boundsEllipsoidMinLongitude=t._voxelPrimitive.minBounds.x}}),n({name:"boundsEllipsoidMaxLatitude",initialValue:0,setPrimitiveFunction:i("maxBounds","y"),getPrimitiveFunction:function(){t.boundsEllipsoidMaxLatitude=t._voxelPrimitive.maxBounds.y}}),n({name:"boundsEllipsoidMinLatitude",initialValue:0,setPrimitiveFunction:i("minBounds","y"),getPrimitiveFunction:function(){t.boundsEllipsoidMinLatitude=t._voxelPrimitive.minBounds.y}}),n({name:"boundsEllipsoidMaxHeight",initialValue:0,setPrimitiveFunction:i("maxBounds","z"),getPrimitiveFunction:function(){t.boundsEllipsoidMaxHeight=t._voxelPrimitive.maxBounds.z}}),n({name:"boundsEllipsoidMinHeight",initialValue:0,setPrimitiveFunction:i("minBounds","z"),getPrimitiveFunction:function(){t.boundsEllipsoidMinHeight=t._voxelPrimitive.minBounds.z}}),n({name:"boundsCylinderMaxRadius",initialValue:0,setPrimitiveFunction:i("maxBounds","x"),getPrimitiveFunction:function(){t.boundsCylinderMaxRadius=t._voxelPrimitive.maxBounds.x}}),n({name:"boundsCylinderMinRadius",initialValue:0,setPrimitiveFunction:i("minBounds","x"),getPrimitiveFunction:function(){t.boundsCylinderMinRadius=t._voxelPrimitive.minBounds.x}}),n({name:"boundsCylinderMaxHeight",initialValue:0,setPrimitiveFunction:i("maxBounds","y"),getPrimitiveFunction:function(){t.boundsCylinderMaxHeight=t._voxelPrimitive.maxBounds.y}}),n({name:"boundsCylinderMinHeight",initialValue:0,setPrimitiveFunction:i("minBounds","y"),getPrimitiveFunction:function(){t.boundsCylinderMinHeight=t._voxelPrimitive.minBounds.y}}),n({name:"boundsCylinderMaxAngle",initialValue:0,setPrimitiveFunction:i("maxBounds","z"),getPrimitiveFunction:function(){t.boundsCylinderMaxAngle=t._voxelPrimitive.maxBounds.z}}),n({name:"boundsCylinderMinAngle",initialValue:0,setPrimitiveFunction:i("minBounds","z"),getPrimitiveFunction:function(){t.boundsCylinderMinAngle=t._voxelPrimitive.minBounds.z}}),n({name:"clippingBoxMaxX",initialValue:0,setPrimitiveFunction:i("maxClippingBounds","x"),getPrimitiveFunction:function(){t.clippingBoxMaxX=t._voxelPrimitive.maxClippingBounds.x}}),n({name:"clippingBoxMinX",initialValue:0,setPrimitiveFunction:i("minClippingBounds","x"),getPrimitiveFunction:function(){t.clippingBoxMinX=t._voxelPrimitive.minClippingBounds.x}}),n({name:"clippingBoxMaxY",initialValue:0,setPrimitiveFunction:i("maxClippingBounds","y"),getPrimitiveFunction:function(){t.clippingBoxMaxY=t._voxelPrimitive.maxClippingBounds.y}}),n({name:"clippingBoxMinY",initialValue:0,setPrimitiveFunction:i("minClippingBounds","y"),getPrimitiveFunction:function(){t.clippingBoxMinY=t._voxelPrimitive.minClippingBounds.y}}),n({name:"clippingBoxMaxZ",initialValue:0,setPrimitiveFunction:i("maxClippingBounds","z"),getPrimitiveFunction:function(){t.clippingBoxMaxZ=t._voxelPrimitive.maxClippingBounds.z}}),n({name:"clippingBoxMinZ",initialValue:0,setPrimitiveFunction:i("minClippingBounds","z"),getPrimitiveFunction:function(){t.clippingBoxMinZ=t._voxelPrimitive.minClippingBounds.z}}),n({name:"clippingEllipsoidMaxLongitude",initialValue:0,setPrimitiveFunction:i("maxClippingBounds","x"),getPrimitiveFunction:function(){t.clippingEllipsoidMaxLongitude=t._voxelPrimitive.maxClippingBounds.x}}),n({name:"clippingEllipsoidMinLongitude",initialValue:0,setPrimitiveFunction:i("minClippingBounds","x"),getPrimitiveFunction:function(){t.clippingEllipsoidMinLongitude=t._voxelPrimitive.minClippingBounds.x}}),n({name:"clippingEllipsoidMaxLatitude",initialValue:0,setPrimitiveFunction:i("maxClippingBounds","y"),getPrimitiveFunction:function(){t.clippingEllipsoidMaxLatitude=t._voxelPrimitive.maxClippingBounds.y}}),n({name:"clippingEllipsoidMinLatitude",initialValue:0,setPrimitiveFunction:i("minClippingBounds","y"),getPrimitiveFunction:function(){t.clippingEllipsoidMinLatitude=t._voxelPrimitive.minClippingBounds.y}}),n({name:"clippingEllipsoidMaxHeight",initialValue:0,setPrimitiveFunction:i("maxClippingBounds","z"),getPrimitiveFunction:function(){t.clippingEllipsoidMaxHeight=t._voxelPrimitive.maxClippingBounds.z}}),n({name:"clippingEllipsoidMinHeight",initialValue:0,setPrimitiveFunction:i("minClippingBounds","z"),getPrimitiveFunction:function(){t.clippingEllipsoidMinHeight=t._voxelPrimitive.minClippingBounds.z}}),n({name:"clippingCylinderMaxRadius",initialValue:0,setPrimitiveFunction:i("maxClippingBounds","x"),getPrimitiveFunction:function(){t.clippingCylinderMaxRadius=t._voxelPrimitive.maxClippingBounds.x}}),n({name:"clippingCylinderMinRadius",initialValue:0,setPrimitiveFunction:i("minClippingBounds","x"),getPrimitiveFunction:function(){t.clippingCylinderMinRadius=t._voxelPrimitive.minClippingBounds.x}}),n({name:"clippingCylinderMaxHeight",initialValue:0,setPrimitiveFunction:i("maxClippingBounds","y"),getPrimitiveFunction:function(){t.clippingCylinderMaxHeight=t._voxelPrimitive.maxClippingBounds.y}}),n({name:"clippingCylinderMinHeight",initialValue:0,setPrimitiveFunction:i("minClippingBounds","y"),getPrimitiveFunction:function(){t.clippingCylinderMinHeight=t._voxelPrimitive.minClippingBounds.y}}),n({name:"clippingCylinderMaxAngle",initialValue:0,setPrimitiveFunction:i("maxClippingBounds","z"),getPrimitiveFunction:function(){t.clippingCylinderMaxAngle=t._voxelPrimitive.maxClippingBounds.z}}),n({name:"clippingCylinderMinAngle",initialValue:0,setPrimitiveFunction:i("minClippingBounds","z"),getPrimitiveFunction:function(){t.clippingCylinderMinAngle=t._voxelPrimitive.minClippingBounds.z}}),n({name:"translationX",initialValue:0,setPrimitiveFunction:function(){t._modelMatrixReady&&_m(t)},getPrimitiveFunction:function(){t.translationX=k.getTranslation(t._voxelPrimitive.modelMatrix,new h).x}}),n({name:"translationY",initialValue:0,setPrimitiveFunction:function(){t._modelMatrixReady&&_m(t)},getPrimitiveFunction:function(){t.translationY=k.getTranslation(t._voxelPrimitive.modelMatrix,new h).y}}),n({name:"translationZ",initialValue:0,setPrimitiveFunction:function(){t._modelMatrixReady&&_m(t)},getPrimitiveFunction:function(){t.translationZ=k.getTranslation(t._voxelPrimitive.modelMatrix,new h).z}}),n({name:"scaleX",initialValue:1,setPrimitiveFunction:function(){t._modelMatrixReady&&_m(t)},getPrimitiveFunction:function(){t.scaleX=k.getScale(t._voxelPrimitive.modelMatrix,new h).x}}),n({name:"scaleY",initialValue:1,setPrimitiveFunction:function(){t._modelMatrixReady&&_m(t)},getPrimitiveFunction:function(){t.scaleY=k.getScale(t._voxelPrimitive.modelMatrix,new h).y}}),n({name:"scaleZ",initialValue:1,setPrimitiveFunction:function(){t._modelMatrixReady&&_m(t)},getPrimitiveFunction:function(){t.scaleZ=k.getScale(t._voxelPrimitive.modelMatrix,new h).z}}),n({name:"angleX",initialValue:0,setPrimitiveFunction:function(){t._modelMatrixReady&&_m(t)}}),n({name:"angleY",initialValue:0,setPrimitiveFunction:function(){t._modelMatrixReady&&_m(t)}}),n({name:"angleZ",initialValue:0,setPrimitiveFunction:function(){t._modelMatrixReady&&_m(t)}})}var SEt=new h,wEt=new h,vEt=new Fa,DEt=new Q;function _m(e){let t=h.fromElements(e.translationX,e.translationY,e.translationZ,SEt),n=h.fromElements(e.scaleX,e.scaleY,e.scaleZ,wEt),i=vEt;i.heading=e.angleX,i.pitch=e.angleY,i.roll=e.angleZ;let o=Q.fromHeadingPitchRoll(i,DEt),r=Q.multiplyByScale(o,n,o);e._voxelPrimitive.modelMatrix=k.fromRotationTranslation(r,t,e._voxelPrimitive.modelMatrix)}Object.defineProperties(Nf.prototype,{scene:{get:function(){return this._scene}},voxelPrimitive:{get:function(){return this._voxelPrimitive},set:function(e){if(c(this._customShaderCompilationRemoveCallback)&&this._customShaderCompilationRemoveCallback(),c(e)){this._voxelPrimitive=e;let t=this;t._customShaderCompilationRemoveCallback=t._voxelPrimitive.customShaderCompilationEvent.addEventListener(function(n){let i=t._voxelPrimitive.customShader.fragmentShaderText;t.shaderString=aAe(i),c(n)?(t.shaderCompilationMessage=n.message,t.shaderCompilationSuccess=!1):(t.shaderCompilationMessage="Shader compiled successfully!",t.shaderCompilationSuccess=!0)}),t._modelMatrixReady=!1;for(let n=0;n<t._getPrimitiveFunctions.length;n++)t._getPrimitiveFunctions[n]();t._modelMatrixReady=!0,_m(t)}}}});Nf.prototype.toggleInspector=function(){this.inspectorVisible=!this.inspectorVisible};Nf.prototype.toggleDisplay=function(){this.displayVisible=!this.displayVisible};Nf.prototype.toggleTransform=function(){this.transformVisible=!this.transformVisible};Nf.prototype.toggleBounds=function(){this.boundsVisible=!this.boundsVisible};Nf.prototype.toggleClipping=function(){this.clippingVisible=!this.clippingVisible};Nf.prototype.toggleShader=function(){this.shaderVisible=!this.shaderVisible};Nf.prototype.compileShader=function(){c(this._voxelPrimitive)&&(this._voxelPrimitive.customShader=new GC({fragmentShaderText:this.shaderString,uniforms:this._voxelPrimitive.customShader.uniforms}))};Nf.prototype.shaderEditorKeyPress=function(e,t){if(t.keyCode===9){t.preventDefault();let n=t.target,i=n.selectionStart,o=n.selectionEnd,r=o,a=n.value.slice(i,o).split(`
`),l=a.length,u;if(t.shiftKey)for(u=0;u<l;++u)a[u][0]===" "&&(a[u][1]===" "?(a[u]=a[u].substr(2),r-=2):(a[u]=a[u].substr(1),r-=1));else for(u=0;u<l;++u)a[u]=`  ${a[u]}`,r+=2;let f=a.join(`
`);n.value=n.value.slice(0,i)+f+n.value.slice(o),n.selectionStart=i!==o?i:r,n.selectionEnd=r}else t.ctrlKey&&(t.keyCode===10||t.keyCode===13)&&this.compileShader();return!0};Nf.prototype.isDestroyed=function(){return!1};Nf.prototype.destroy=function(){let e=this;return this._definedProperties.forEach(function(t){Te.getObservable(e,t).dispose()}),de(this)};var I$=Nf;function JF(e,t){A.defined("container",e),A.typeOf.object("scene",t),e=On(e);let n=document.createElement("div"),i=new I$(t);this._viewModel=i,this._container=e,this._element=n;let o=document.createElement("div");o.textContent="Voxel Inspector",o.className="cesium-cesiumInspector-button",o.setAttribute("data-bind","click: toggleInspector"),n.appendChild(o),n.className="cesium-cesiumInspector cesium-VoxelInspector",n.setAttribute("data-bind",'css: { "cesium-cesiumInspector-visible" : inspectorVisible, "cesium-cesiumInspector-hidden" : !inspectorVisible}'),e.appendChild(n);let r=document.createElement("div");r.className="cesium-cesiumInspector-dropDown",n.appendChild(r);let s=Vc.createSection,a=Vc.createCheckbox,l=Vc.createRangeInput,u=Vc.createButton,f=s(r,"Display","displayVisible","toggleDisplay"),d=s(r,"Transform","transformVisible","toggleTransform"),p=s(r,"Bounds","boundsVisible","toggleBounds"),g=s(r,"Clipping","clippingVisible","toggleClipping"),m=s(r,"Shader","shaderVisible","toggleShader");f.appendChild(a("Depth Test","depthTest")),f.appendChild(a("Show","show")),f.appendChild(a("Disable Update","disableUpdate")),f.appendChild(a("Debug Draw","debugDraw")),f.appendChild(a("Jitter","jitter")),f.appendChild(a("Nearest Sampling","nearestSampling")),f.appendChild(l("Screen Space Error","screenSpaceError",0,128)),f.appendChild(l("Step Size","stepSize",0,2));let b=10,x=10,T=R.PI;d.appendChild(l("Translation X","translationX",-b,+b)),d.appendChild(l("Translation Y","translationY",-b,+b)),d.appendChild(l("Translation Z","translationZ",-b,+b)),d.appendChild(l("Scale X","scaleX",0,+x)),d.appendChild(l("Scale Y","scaleY",0,+x)),d.appendChild(l("Scale Z","scaleZ",0,+x)),d.appendChild(l("Heading","angleX",-T,+T)),d.appendChild(l("Pitch","angleY",-T,+T)),d.appendChild(l("Roll","angleZ",-T,+T));let C=Oi.getMinBounds(Oi.BOX),S=Oi.getMaxBounds(Oi.BOX),v=h.fromElements(Oi.getMinBounds(Oi.ELLIPSOID).x,Oi.getMinBounds(Oi.ELLIPSOID).y,-ie.WGS84.maximumRadius,new h),D=h.fromElements(Oi.getMaxBounds(Oi.ELLIPSOID).x,Oi.getMaxBounds(Oi.ELLIPSOID).y,1e7,new h),I=Oi.getMinBounds(Oi.CYLINDER),L=Oi.getMaxBounds(Oi.CYLINDER);tE("Max X","Min X","Max Y","Min Y","Max Z","Min Z","boundsBoxMaxX","boundsBoxMinX","boundsBoxMaxY","boundsBoxMinY","boundsBoxMaxZ","boundsBoxMinZ",C,S,"shapeIsBox",p),tE("Max Longitude","Min Longitude","Max Latitude","Min Latitude","Max Height","Min Height","boundsEllipsoidMaxLongitude","boundsEllipsoidMinLongitude","boundsEllipsoidMaxLatitude","boundsEllipsoidMinLatitude","boundsEllipsoidMaxHeight","boundsEllipsoidMinHeight",v,D,"shapeIsEllipsoid",p),tE("Max Radius","Min Radius","Max Height","Min Height","Max Angle","Min Angle","boundsCylinderMaxRadius","boundsCylinderMinRadius","boundsCylinderMaxHeight","boundsCylinderMinHeight","boundsCylinderMaxAngle","boundsCylinderMinAngle",I,L,"shapeIsCylinder",p),tE("Max X","Min X","Max Y","Min Y","Max Z","Min Z","clippingBoxMaxX","clippingBoxMinX","clippingBoxMaxY","clippingBoxMinY","clippingBoxMaxZ","clippingBoxMinZ",C,S,"shapeIsBox",g),tE("Max Longitude","Min Longitude","Max Latitude","Min Latitude","Max Height","Min Height","clippingEllipsoidMaxLongitude","clippingEllipsoidMinLongitude","clippingEllipsoidMaxLatitude","clippingEllipsoidMinLatitude","clippingEllipsoidMaxHeight","clippingEllipsoidMinHeight",v,D,"shapeIsEllipsoid",g),tE("Max Radius","Min Radius","Max Height","Min Height","Max Angle","Min Angle","clippingCylinderMaxRadius","clippingCylinderMinRadius","clippingCylinderMaxHeight","clippingCylinderMinHeight","clippingCylinderMaxAngle","clippingCylinderMinAngle",I,L,"shapeIsCylinder",g);let M=document.createElement("div");m.appendChild(M);let N=document.createElement("textarea");N.setAttribute("data-bind","textInput: shaderString, event: { keydown: shaderEditorKeyPress }"),M.className="cesium-cesiumInspector-styleEditor",M.appendChild(N);let B=u("Compile (Ctrl+Enter)","compileShader");M.appendChild(B);let _=document.createElement("label");_.style.display="block",_.setAttribute("data-bind","text: shaderCompilationMessage, style: {color: shaderCompilationSuccess ? 'green' : 'red'}"),M.appendChild(_),Te.applyBindings(i,n)}Object.defineProperties(JF.prototype,{container:{get:function(){return this._container}},viewModel:{get:function(){return this._viewModel}}});JF.prototype.isDestroyed=function(){return!1};JF.prototype.destroy=function(){return Te.cleanNode(this._element),this._container.removeChild(this._element),this.viewModel.destroy(),de(this)};function tE(e,t,n,i,o,r,s,a,l,u,f,d,p,g,m,b){let x=Vc.createRangeInput,T=p,C=g,S=b.appendChild(document.createElement("div"));S.setAttribute("data-bind",`if: ${m}`),S.appendChild(x(e,s,T.x,C.x)),S.appendChild(x(t,a,T.x,C.x)),S.appendChild(x(n,l,T.y,C.y)),S.appendChild(x(i,u,T.y,C.y)),S.appendChild(x(o,f,T.z,C.z)),S.appendChild(x(r,d,T.z,C.z))}var O$=JF;function PEt(e){A.typeOf.object("viewer",e);let t=document.createElement("div");t.className="cesium-viewer-voxelInspectorContainer",e.container.appendChild(t);let n=new O$(t,e.scene);Object.defineProperties(e,{voxelInspector:{get:function(){return n}}})}var IEt=PEt;var wZi="1.123";export{H_ as AlphaMode,y8 as AlphaPipelineStage,a4 as AnchorPointDirect,c4 as AnchorPointIndirect,FK as Animation,kK as AnimationViewModel,io as Appearance,di as ApproximateTerrainHeights,dnt as ArcGISTiledElevationTerrainProvider,im as ArcGisBaseMapType,sy as ArcGisMapServerImageryProvider,Vd as ArcGisMapService,Yt as ArcType,rl as ArticulationStageType,St as AssociativeArray,ew as Atmosphere,q4 as AtmospherePipelineStage,Nn as AttributeCompression,cn as AttributeType,uq as AutoExposure,Wy as AutomaticUniforms,zo as Axis,jx as AxisAlignedBoundingBox,S4 as B3dmLoader,E4 as B3dmParser,WK as BaseLayerPicker,jK as BaseLayerPickerViewModel,kE as BatchTable,RS as BatchTableHierarchy,kl as BatchTexture,b8 as BatchTexturePipelineStage,fo as Billboard,rd as BillboardCollection,Wc as BillboardGraphics,q2 as BillboardVisualizer,hnt as BingMapsGeocoderService,fq as BingMapsImageryProvider,RL as BingMapsStyle,fc as BlendEquation,Do as BlendFunction,Oo as BlendOption,hn as BlendingState,Ke as BoundingRectangle,ce as BoundingSphere,ct as BoundingSphereState,XS as BoundingVolumeSemantics,oat as BoxEmitter,uc as BoxGeometry,DU as BoxGeometryUpdater,YE as BoxGraphics,Sm as BoxOutlineGeometry,mq as BrdfLutGenerator,xt as Buffer,NS as BufferLoader,ke as BufferUsage,C8 as CPUStylingPipelineStage,PU as CallbackPositionProperty,Hm as CallbackProperty,so as Camera,jq as CameraEventAggregator,zi as CameraEventType,Lq as CameraFlightPath,H as Cartesian2,h as Cartesian3,se as Cartesian4,he as Cartographic,mnt as CartographicGeocoderService,bnt as CatmullRomSpline,vS as Cesium3DContentGroup,Ph as Cesium3DTile,r0 as Cesium3DTileBatchTable,Vl as Cesium3DTileColorBlendMode,flt as Cesium3DTileContent,kw as Cesium3DTileContentFactory,rr as Cesium3DTileContentState,Zs as Cesium3DTileContentType,Ws as Cesium3DTileFeature,ap as Cesium3DTileFeatureTable,Eh as Cesium3DTileOptimizationHint,UG as Cesium3DTileOptimizations,Ro as Cesium3DTilePass,sm as Cesium3DTilePassState,N0 as Cesium3DTilePointFeature,nr as Cesium3DTileRefine,TC as Cesium3DTileStyle,qG as Cesium3DTileStyleEngine,zK as Cesium3DTilesInspector,UK as Cesium3DTilesInspectorViewModel,rut as Cesium3DTilesVoxelProvider,pa as Cesium3DTileset,JG as Cesium3DTilesetBaseTraversal,HG as Cesium3DTilesetCache,aS as Cesium3DTilesetGraphics,WG as Cesium3DTilesetHeatmap,Ww as Cesium3DTilesetMetadata,$G as Cesium3DTilesetMostDetailedTraversal,QG as Cesium3DTilesetSkipTraversal,X0 as Cesium3DTilesetStatistics,ma as Cesium3DTilesetTraversal,i5 as Cesium3DTilesetVisualizer,n$ as CesiumInspector,t$ as CesiumInspectorViewModel,pD as CesiumTerrainProvider,vF as CesiumWidget,A as Check,z1 as CheckerboardMaterialProperty,t7 as CircleEmitter,Mnt as CircleGeometry,Nnt as CircleOutlineGeometry,EH as ClassificationModelDrawCommand,x8 as ClassificationPipelineStage,ZI as ClassificationPrimitive,Vn as ClassificationType,ri as ClearCommand,KS as ClippingPlane,Ms as ClippingPlaneCollection,$O as ClippingPolygon,tp as ClippingPolygonCollection,Oh as Clock,jr as ClockRange,ho as ClockStep,RK as ClockViewModel,But as CloudCollection,kD as CloudType,j as Color,ol as ColorBlendMode,Wt as ColorGeometryInstanceAttribute,Ht as ColorMaterialProperty,iCt as Command,$ as ComponentDatatype,HU as Composite3DTileContent,jWe as CompositeEntityCollection,j1 as CompositeMaterialProperty,Ka as CompositePositionProperty,fl as CompositeProperty,mB as CompressedTextureBuffer,zl as ComputeCommand,XW as ComputeEngine,Wq as ConditionsExpression,Vut as ConeEmitter,Qc as ConstantPositionProperty,Kn as ConstantProperty,R4 as ConstantSpline,_G as ContentMetadata,oq as Context,mt as ContextLimits,b6 as CoplanarPolygonGeometry,k0 as CoplanarPolygonGeometryLibrary,vh as CoplanarPolygonOutlineGeometry,ki as CornerType,l4 as CorrelationGroup,cv as CorridorGeometry,Wi as CorridorGeometryLibrary,g5 as CorridorGeometryUpdater,KE as CorridorGraphics,_5 as CorridorOutlineGeometry,Pt as Credit,C7 as CreditDisplay,Jo as CubeMap,UB as CubeMapFace,EE as CubicRealPolynomial,xi as CullFace,Os as CullingVolume,zd as CumulusCloud,L5 as CustomDataSource,knt as CustomHeightmapTerrainProvider,GC as CustomShader,O0 as CustomShaderMode,I8 as CustomShaderPipelineStage,MT as CustomShaderTranslucencyMode,B5 as CylinderGeometry,mv as CylinderGeometryLibrary,U5 as CylinderGeometryUpdater,ZE as CylinderGraphics,V5 as CylinderOutlineGeometry,mR as CzmlDataSource,ns as DataSource,Lp as DataSourceClock,n6 as DataSourceCollection,K6 as DataSourceDisplay,ldt as DebugAppearance,my as DebugCameraPrimitive,E7 as DebugInspector,rN as DebugModelMatrixPrimitive,znt as DefaultProxy,Kc as DepthFunction,D7 as DepthPlane,O8 as DequantizationPipelineStage,py as DerivedCommand,E as DeveloperError,P7 as DeviceOrientationCameraController,Vdt as DirectionalLight,LL as DiscardEmptyTileImagePolicy,cq as DiscardMissingTileImagePolicy,Bt as DistanceDisplayCondition,kn as DistanceDisplayConditionGeometryInstanceAttribute,gD as DoubleEndedPriorityQueue,zG as DoublyLinkedList,d0 as DracoLoader,et as DrawCommand,T0 as DynamicAtmosphereLightingType,A0 as DynamicEnvironmentMapManager,Av as DynamicGeometryBatch,ii as DynamicGeometryUpdater,h2 as EarthOrientationParameters,Tx as EarthOrientationParametersSample,qr as EasingFunction,$l as EllipseGeometry,pf as EllipseGeometryLibrary,l6 as EllipseGeometryUpdater,QE as EllipseGraphics,xd as EllipseOutlineGeometry,ie as Ellipsoid,Xy as EllipsoidGeodesic,ga as EllipsoidGeometry,m6 as EllipsoidGeometryUpdater,tS as EllipsoidGraphics,fd as EllipsoidOutlineGeometry,O7 as EllipsoidPrimitive,mc as EllipsoidRhumbLine,zdt as EllipsoidSurfaceAppearance,cs as EllipsoidTangentPlane,Jp as EllipsoidTerrainProvider,Z0 as EllipsoidalOccluder,P1 as Empty3DTileContent,Gn as EncodedCartesian3,Qo as Entity,_d as EntityCluster,_a as EntityCollection,Q6 as EntityView,pe as Event,yr as EventHelper,hh as Expression,gt as ExpressionNodeType,gd as ExtrapolationType,zt as FeatureDetection,RT as FeatureIdPipelineStage,N7 as Fog,Oe as ForEach,fN as FrameRateMonitor,F7 as FrameState,Jr as Framebuffer,gi as FramebufferManager,B7 as FrustumCommands,bD as FrustumGeometry,hW as FrustumOutlineGeometry,wr as Fullscreen,GK as FullscreenButton,HK as FullscreenButtonViewModel,FM as GeoJsonDataSource,D4 as GeoJsonLoader,Mb as GeocodeType,ZK as Geocoder,TD as GeocoderService,$K as GeocoderViewModel,Mi as GeographicProjection,$i as GeographicTilingScheme,ut as Geometry,JU as Geometry3DTileContent,we as GeometryAttribute,pn as GeometryAttributes,lit as GeometryFactory,vt as GeometryInstance,Zc as GeometryInstanceAttribute,Jt as GeometryOffsetAttribute,Fn as GeometryPipeline,L8 as GeometryPipelineStage,th as GeometryType,oi as GeometryUpdater,Mv as GeometryUpdaterSet,B6 as GeometryVisualizer,HD as GetFeatureInfoFormat,dY as Globe,hY as GlobeDepth,G7 as GlobeSurfaceShaderSet,cm as GlobeSurfaceTile,eY as GlobeSurfaceTileProvider,tY as GlobeTranslucency,mY as GlobeTranslucencyFramebuffer,yY as GlobeTranslucencyState,CO as GltfBufferViewLoader,EO as GltfDracoLoader,f4 as GltfGpmLoader,QO as GltfGpmLocal,SO as GltfImageLoader,wO as GltfIndexBufferLoader,RO as GltfJsonLoader,S0 as GltfLoader,Xu as GltfLoaderUtil,p4 as GltfMeshPrimitiveGpmLoader,i4 as GltfStructuralMetadataLoader,LO as GltfTextureLoader,NO as GltfVertexBufferLoader,apt as GoogleEarthEnterpriseImageryProvider,p7 as GoogleEarthEnterpriseMapsProvider,Lb as GoogleEarthEnterpriseMetadata,_L as GoogleEarthEnterpriseTerrainData,Rit as GoogleEarthEnterpriseTerrainProvider,_W as GoogleEarthEnterpriseTileInformation,AD as GoogleMaps,qM as GpxDataSource,d_ as GregorianDate,fpt as GridImageryProvider,nR as GridMaterialProperty,jn as GroundGeometryUpdater,jE as GroundPolylineGeometry,Fm as GroundPolylinePrimitive,Ll as GroundPrimitive,F1 as GroupMetadata,zh as HeadingPitchRange,Fa as HeadingPitchRoll,u2 as Heap,$e as HeightReference,Jh as HeightmapEncoding,Mc as HeightmapTerrainData,rL as HeightmapTessellator,H5 as HermitePolynomialApproximation,ST as HermiteSpline,_O as HilbertOrder,QK as HomeButton,JK as HomeButtonViewModel,bi as HorizontalOrigin,VCt as I3SBuildingSceneLayerExplorer,i$ as I3SBuildingSceneLayerExplorerViewModel,n_ as I3SDataProvider,xY as I3SDecoder,AY as I3SFeature,CY as I3SField,RN as I3SGeometry,nP as I3SLayer,LN as I3SNode,vY as I3SStatistics,DY as I3SSublayer,wY as I3SSymbology,O4 as I3dmLoader,P4 as I3dmParser,SW as Iau2000Orientation,g2 as Iau2006XysData,mE as Iau2006XysSample,wW as IauOrientationAxes,CW as IauOrientationParameters,SS as ImageBasedLighting,X4 as ImageBasedLightingPipelineStage,Zx as ImageMaterialProperty,hN as Imagery,oc as ImageryLayer,nY as ImageryLayerCollection,Qp as ImageryLayerFeatureInfo,mu as ImageryProvider,ci as ImageryState,HO as Implicit3DTileContent,bO as ImplicitAvailabilityBitstream,xO as ImplicitMetadataView,_r as ImplicitSubdivisionScheme,qS as ImplicitSubtree,qq as ImplicitSubtreeCache,nz as ImplicitSubtreeMetadata,$w as ImplicitTileCoordinates,Xw as ImplicitTileset,Fe as IndexDatatype,s$ as InfoBox,r$ as InfoBoxViewModel,Vc as InspectorShared,fs as InstanceAttributeSemantic,d8 as InstancingPipelineStage,Hit as InterpolationAlgorithm,op as InterpolationType,qt as Intersect,Qn as IntersectionTests,Ob as Intersections2D,lc as Interval,kN as InvertClassification,jm as Ion,xL as IonGeocoderService,fy as IonImageryProvider,Xf as IonResource,dy as IonWorldImageryStyle,je as Iso8601,PY as JobScheduler,Ha as JobType,C0 as JsonMetadataTable,J as JulianDate,yB as KTX2Transcoder,Ca as KeyboardEventModifier,no as KeyframeNode,D9 as KmlCamera,tL as KmlDataSource,P9 as KmlLookAt,I9 as KmlTour,R9 as KmlTourFlyTo,L9 as KmlTourWait,zT as Label,ag as LabelCollection,km as LabelGraphics,ir as LabelStyle,V6 as LabelVisualizer,j5 as LagrangePolynomialApproximation,qi as LeapSecond,Ypt as Light,ng as LightingModel,F8 as LightingPipelineStage,pv as LinearApproximation,CT as LinearSpline,Bl as ManagedArray,Ef as MapMode2D,jit as MapProjection,_7 as MapboxImageryProvider,Kpt as MapboxStyleImageryProvider,Ki as Material,uo as MaterialAppearance,U8 as MaterialPipelineStage,pr as MaterialProperty,R as Math,Gi as Matrix2,Q as Matrix3,k as Matrix4,zN as Megatexture,m4 as MeshPrimitiveGpmLocal,Qm as MetadataClass,rT as MetadataClassProperty,Gt as MetadataComponentType,Bn as MetadataEntity,Rz as MetadataEnum,Oz as MetadataEnumValue,IY as MetadataPicking,od as MetadataPickingPipelineStage,bh as MetadataPipelineStage,Qf as MetadataSchema,VO as MetadataSchemaLoader,YS as MetadataSemantic,qu as MetadataTable,rz as MetadataTableProperty,Et as MetadataType,rh as MipmapHint,mp as Model,rg as Model3DTileContent,cH as ModelAlphaOptions,k4 as ModelAnimation,F4 as ModelAnimationChannel,U4 as ModelAnimationCollection,$u as ModelAnimationLoop,up as ModelAnimationState,J4 as ModelArticulation,Z4 as ModelArticulationStage,t8 as ModelClippingPlanesPipelineStage,o8 as ModelClippingPolygonsPipelineStage,IT as ModelColorPipelineStage,Sn as ModelComponents,SH as ModelDrawCommand,DH as ModelDrawCommands,z4 as ModelFeature,H4 as ModelFeatureTable,Jy as ModelGraphics,xH as ModelLightingOptions,m8 as ModelMatrixUpdateStage,r8 as ModelNode,hH as ModelRenderResources,g8 as ModelRuntimeNode,rH as ModelRuntimePrimitive,PH as ModelSceneGraph,_H as ModelSilhouettePipelineStage,aH as ModelSkin,yH as ModelSplitterPipelineStage,IH as ModelStatistics,Rr as ModelType,Zt as ModelUtility,z6 as ModelVisualizer,OY as Moon,H8 as MorphTargetsPipelineStage,Yit as MorphWeightSpline,eA as MortonOrder,AG as Multiple3DTileContent,b4 as MultisampleFramebuffer,g$ as NavigationHelpButton,_$ as NavigationHelpButtonViewModel,Vt as NearFarScalar,Qpt as NeverTileDiscardPolicy,bH as NodeRenderResources,p8 as NodeStatisticsPipelineStage,oS as NodeTransformationProperty,BY as OIT,LW as Occluder,Qi as OffsetGeometryInstanceAttribute,tot as OpenCageGeocoderService,by as OpenStreetMapImageryProvider,i6 as OrderedGroundPrimitiveCollection,Pn as OrientedBoundingBox,rn as OrthographicFrustum,er as OrthographicOffCenterFrustum,iot as Packable,rot as PackableForInterpolation,qN as Particle,y_t as ParticleBurst,b_t as ParticleEmitter,v_t as ParticleSystem,ve as Pass,Cl as PassState,Qy as PathGraphics,j6 as PathVisualizer,DW as PeliasGeocoderService,ln as PerInstanceColorAppearance,xy as PerformanceDisplay,l$ as PerformanceWatchdog,c$ as PerformanceWatchdogViewModel,vi as PerspectiveFrustum,lu as PerspectiveOffCenterFrustum,VY as PickDepth,UY as PickDepthFramebuffer,HY as PickFramebuffer,zY as PickedMetadataInfo,QY as Picking,G8 as PickingPipelineStage,vb as PinBuilder,Be as PixelDatatype,Ve as PixelFormat,un as Plane,p6 as PlaneGeometry,y6 as PlaneGeometryUpdater,SU as PlaneGraphics,_6 as PlaneOutlineGeometry,OH as PntsLoader,yw as PntsParser,rX as PointCloud,w0 as PointCloudEyeDomeLighting,Z_ as PointCloudShading,Y8 as PointCloudStylingPipelineStage,fS as PointGraphics,ea as PointPrimitive,eR as PointPrimitiveCollection,W6 as PointVisualizer,b0 as PolygonGeometry,zn as PolygonGeometryLibrary,T6 as PolygonGeometryUpdater,Um as PolygonGraphics,_c as PolygonHierarchy,x6 as PolygonOutlineGeometry,ai as PolygonPipeline,Ah as Polyline,iR as PolylineArrowMaterialProperty,yp as PolylineCollection,us as PolylineColorAppearance,oR as PolylineDashMaterialProperty,yb as PolylineGeometry,q6 as PolylineGeometryUpdater,rR as PolylineGlowMaterialProperty,el as PolylineGraphics,Ua as PolylineMaterialAppearance,_A as PolylineOutlineMaterialProperty,Bi as PolylinePipeline,X6 as PolylineVisualizer,A6 as PolylineVolumeGeometry,Ip as PolylineVolumeGeometryLibrary,E6 as PolylineVolumeGeometryUpdater,pS as PolylineVolumeGraphics,C6 as PolylineVolumeOutlineGeometry,Bm as PositionProperty,tb as PositionPropertyArray,po as PostProcessStage,PX as PostProcessStageCollection,bu as PostProcessStageComposite,Xd as PostProcessStageLibrary,Yd as PostProcessStageSampleMode,_P as PostProcessStageTextureCache,h4 as PpeMetadata,jAt as PpeSource,d4 as PpeTexture,Rn as Primitive,mf as PrimitiveCollection,aw as PrimitiveLoadPlan,sw as PrimitiveOutlineGenerator,$8 as PrimitiveOutlinePipelineStage,VE as PrimitivePipeline,TH as PrimitiveRenderResources,Hr as PrimitiveState,Z8 as PrimitiveStatisticsPipelineStage,Me as PrimitiveType,f$ as ProjectionPicker,u$ as ProjectionPickerViewModel,X as Property,sR as PropertyArray,ow as PropertyAttribute,Qz as PropertyAttributeProperty,Vu as PropertyBag,Hl as PropertyTable,E0 as PropertyTexture,Zz as PropertyTextureProperty,Cs as ProviderViewModel,lot as Proxy,Rl as QuadraticRealPolynomial,iY as QuadtreeOccluders,lY as QuadtreePrimitive,oY as QuadtreeTile,Sa as QuadtreeTileLoadState,Byt as QuadtreeTileProvider,mD as QuantizedMeshTerrainData,wB as QuarticRealPolynomial,Ne as Quaternion,L4 as QuaternionSpline,dT as Queue,_n as Ray,ae as Rectangle,Lv as RectangleCollisionChecker,Pv as RectangleGeometry,Js as RectangleGeometryLibrary,P6 as RectangleGeometryUpdater,zm as RectangleGraphics,Hw as RectangleOutlineGeometry,ji as ReferenceFrame,ib as ReferenceProperty,ze as RenderState,id as Renderbuffer,al as RenderbufferFormat,ur as Request,p_ as RequestErrorEvent,qc as RequestScheduler,Jn as RequestState,Es as RequestType,De as Resource,Ci as ResourceCache,Ku as ResourceCacheKey,Lz as ResourceCacheStatistics,Zi as ResourceLoader,yt as ResourceLoaderState,Rh as Rotation,ue as RuntimeError,u0 as S2Cell,ha as SDFSettings,Ja as SampledPositionProperty,bd as SampledProperty,Qt as Sampler,Pg as ScaledPositionProperty,lK as Scene,cP as SceneFramebuffer,oe as SceneMode,J8 as SceneMode2DPipelineStage,p$ as SceneModePicker,m$ as SceneModePickerViewModel,Ni as SceneTransforms,LX as SceneTransitioner,XX as ScreenSpaceCameraController,Af as ScreenSpaceEventHandler,bn as ScreenSpaceEventType,LT as SelectedFeatureIdPipelineStage,h$ as SelectionIndicator,d$ as SelectionIndicatorViewModel,lR as SensorVolumePortionToDisplay,_w as ShaderBuilder,$W as ShaderCache,_e as ShaderDestination,dH as ShaderFunction,an as ShaderProgram,Ge as ShaderSource,uH as ShaderStruct,tx as ShadowMap,Ty as ShadowMapShader,En as ShadowMode,Wf as ShadowVolumeAppearance,Cn as ShowGeometryInstanceAttribute,hC as Simon1994PlanetaryPositions,xrt as SimplePolylineGeometry,y7 as SingleTileImageryProvider,eH as SkinningPipelineStage,hK as SkyAtmosphere,_K as SkyBox,QX as SpatialNode,u4 as Spdcf,Gm as SpecularEnvironmentCubeMap,iAt as SphereEmitter,Art as SphereGeometry,j0 as SphereOutlineGeometry,q5 as Spherical,Fi as Spline,$r as SplitDirection,iF as Splitter,kh as StaticGeometryColorBatch,Vh as StaticGeometryPerMaterialBatch,IR as StaticGroundGeometryColorBatch,F6 as StaticGroundGeometryPerMaterialBatch,Y6 as StaticGroundPolylinePerMaterialBatch,OR as StaticOutlineGeometryBatch,Ut as StencilConstants,Un as StencilFunction,ft as StencilOperation,M4 as SteppedSpline,il as Stereographic,$_ as StorageType,cR as StripeMaterialProperty,Fp as StripeOrientation,ua as StructuralMetadata,dp as StyleCommandsNeeded,oAt as StyleExpression,TK as Sun,Ub as SunLight,ZX as SunPostProcess,s4 as SupportedImageFormats,OK as SvgPathBindingHandler,Ti as TaskProcessor,CF as Terrain,Xp as TerrainData,xl as TerrainEncoding,CN as TerrainFillMesh,em as TerrainMesh,yS as TerrainOffsetProperty,gs as TerrainProvider,Ta as TerrainQuantization,mo as TerrainState,Lt as Texture,kT as TextureAtlas,ZW as TextureCache,fi as TextureMagnificationFilter,tK as TextureManager,$t as TextureMinificationFilter,VAt as TextureUniform,yn as TextureWrap,$p as TileAvailability,wh as TileBoundingRegion,LG as TileBoundingS2Cell,W0 as TileBoundingSphere,uAt as TileBoundingVolume,EF as TileCoordinatesImageryProvider,fAt as TileDiscardPolicy,xn as TileEdge,mN as TileImagery,jb as TileMapServiceImageryProvider,yG as TileMetadata,dd as TileOrientedBoundingBox,No as TileProviderError,rY as TileReplacementQueue,Xn as TileSelectionResult,hAt as TileState,BH as Tileset3DTileContent,VG as TilesetMetadata,G4 as TilesetPipelineStage,Srt as TilingScheme,qn as TimeConstants,jD as TimeDynamicImagery,SF as TimeDynamicPointCloud,wn as TimeInterval,ts as TimeIntervalCollection,ob as TimeIntervalCollectionPositionProperty,sb as TimeIntervalCollectionProperty,Wn as TimeStandard,A$ as Timeline,y$ as TimelineHighlightRange,b$ as TimelineTrack,PB as Tipsify,JC as ToggleButtonViewModel,rx as Tonemapper,Ft as Transforms,Qx as TranslationRotationScale,XY as TranslucentTileClassification,s1 as TridiagonalSystemSolver,iI as TrustedServers,yP as TweenCollection,eq as UniformState,AP as UniformType,Lc as UrlTemplateImageryProvider,wZi as VERSION,v$ as VRButton,w$ as VRButtonViewModel,Mrt as VRTheWorldTerrainProvider,zAt as VaryingType,O_ as Vector3DTileBatch,fG as Vector3DTileClampedPolylines,pG as Vector3DTileContent,c0 as Vector3DTileGeometry,sG as Vector3DTilePoints,aG as Vector3DTilePolygons,Fw as Vector3DTilePolylines,MS as Vector3DTilePrimitive,J5 as VelocityOrientationProperty,_v as VelocityVectorProperty,ni as VertexArray,L0 as VertexArrayFacade,Ct as VertexAttributeSemantic,Ie as VertexFormat,zr as VerticalExaggeration,nH as VerticalExaggerationPipelineStage,Ln as VerticalOrigin,vrt as VideoSynchronizer,uP as View,mEt as Viewer,RAt as ViewportQuad,Br as Visibility,Ftt as Visualizer,ly as VoxelBoxShape,JX as VoxelCell,$q as VoxelContent,uy as VoxelCylinderShape,BD as VoxelEllipsoidShape,O$ as VoxelInspector,I$ as VoxelInspectorViewModel,jC as VoxelPrimitive,MAt as VoxelProvider,Pq as VoxelRenderResources,LAt as VoxelShape,Oi as VoxelShapeType,yF as VoxelTraversal,Nrt as VulkanConstants,O6 as WallGeometry,Iv as WallGeometryLibrary,M6 as WallGeometryUpdater,e0 as WallGraphics,R6 as WallOutlineGeometry,ne as WebGLConstants,T7 as WebMapServiceImageryProvider,A7 as WebMapTileServiceImageryProvider,Li as WebMercatorProjection,ys as WebMercatorTilingScheme,ls as WindingOrder,f1 as WireframeIndexGenerator,oH as WireframePipelineStage,sX as _shadersAcesTonemappingStage,KX as _shadersAdditiveBlend,jN as _shadersAdjustTranslucentFS,cB as _shadersAllMaterialAppearanceFS,lB as _shadersAllMaterialAppearanceVS,aX as _shadersAmbientOcclusionGenerate,cX as _shadersAmbientOcclusionModulate,GB as _shadersAspectRampMaterial,np as _shadersAtmosphereCommon,j4 as _shadersAtmosphereStageFS,W4 as _shadersAtmosphereStageVS,uB as _shadersBasicMaterialAppearanceFS,fB as _shadersBasicMaterialAppearanceVS,VH as _shadersBillboardCollectionFS,UH as _shadersBillboardCollectionVS,lX as _shadersBlackAndWhite,uX as _shadersBloomComposite,hq as _shadersBrdfLutGeneratorFS,$X as _shadersBrightPass,fX as _shadersBrightness,jB as _shadersBumpMapMaterial,A8 as _shadersCPUStylingStageFS,T8 as _shadersCPUStylingStageVS,WB as _shadersCheckerboardMaterial,i7 as _shadersCloudCollectionFS,o7 as _shadersCloudCollectionVS,r7 as _shadersCloudNoiseFS,s7 as _shadersCloudNoiseVS,YY as _shadersCompareAndPackTranslucentDepth,MY as _shadersCompositeOITFS,lP as _shadersCompositeTranslucentClassification,Wz as _shadersComputeIrradianceFS,qz as _shadersComputeRadianceMapFS,dX as _shadersContrastBias,Yz as _shadersConvolveSpecularMapFS,Xz as _shadersConvolveSpecularMapVS,S8 as _shadersCustomShaderStageFS,E8 as _shadersCustomShaderStageVS,FE as _shadersCzmBuiltins,hX as _shadersDepthOfField,S7 as _shadersDepthPlaneFS,w7 as _shadersDepthPlaneVS,mX as _shadersDepthView,HAt as _shadersDepthViewPacked,qB as _shadersDotMaterial,pX as _shadersEdgeDetection,YB as _shadersElevationBandMaterial,XB as _shadersElevationContourMaterial,KB as _shadersElevationRampMaterial,cN as _shadersEllipsoidFS,R7 as _shadersEllipsoidSurfaceAppearanceFS,M7 as _shadersEllipsoidSurfaceAppearanceVS,lN as _shadersEllipsoidVS,yX as _shadersFXAA,EX as _shadersFXAA3_11,$B as _shadersFadeMaterial,w8 as _shadersFeatureIdStageFS,v8 as _shadersFeatureIdStageVS,_X as _shadersFilmicTonemapping,VC as _shadersGaussianBlur1D,R8 as _shadersGeometryStageFS,M8 as _shadersGeometryStageVS,U7 as _shadersGlobeFS,z7 as _shadersGlobeVS,ZB as _shadersGridMaterial,dN as _shadersGroundAtmosphere,Yk as _shadersHSBToRGB,Xk as _shadersHSLToRGB,Y4 as _shadersImageBasedLightingStageFS,s8 as _shadersInstancingStageCommon,a8 as _shadersInstancingStageVS,Tq as _shadersIntersectBox,xq as _shadersIntersectClippingPlanes,Aq as _shadersIntersectCylinder,bq as _shadersIntersectDepth,Cq as _shadersIntersectEllipsoid,NL as _shadersIntersectLongitude,RD as _shadersIntersection,yq as _shadersIntersectionUtils,c8 as _shadersLegacyInstancingStageVS,bX as _shadersLensFlare,N8 as _shadersLightingStageFS,B8 as _shadersMaterialStageFS,Dq as _shadersMegatexture,D8 as _shadersMetadataStageFS,P8 as _shadersMetadataStageVS,e8 as _shadersModelClippingPlanesStageFS,i8 as _shadersModelClippingPolygonsStageFS,n8 as _shadersModelClippingPolygonsStageVS,Q4 as _shadersModelColorStageFS,vH as _shadersModelFS,mH as _shadersModelSilhouetteStageFS,pH as _shadersModelSilhouetteStageVS,gH as _shadersModelSplitterStageFS,wH as _shadersModelVS,xX as _shadersModifiedReinhardTonemapping,z8 as _shadersMorphTargetsStageVS,TX as _shadersNightVision,JB as _shadersNormalMapMaterial,vq as _shadersOctree,Df as _shadersPassThrough,MC as _shadersPassThroughDepth,gX as _shadersPbrNeutralTonemapping,l3 as _shadersPerInstanceColorAppearanceFS,u3 as _shadersPerInstanceColorAppearanceVS,RE as _shadersPerInstanceFlatColorAppearanceFS,f3 as _shadersPerInstanceFlatColorAppearanceVS,x4 as _shadersPointCloudEyeDomeLighting,j8 as _shadersPointCloudStylingStageVS,aA as _shadersPointPrimitiveCollectionFS,x5 as _shadersPointPrimitiveCollectionVS,Gz as _shadersPolygonSignedDistanceFS,QB as _shadersPolylineArrowMaterial,xU as _shadersPolylineColorAppearanceVS,qf as _shadersPolylineCommon,e3 as _shadersPolylineDashMaterial,WE as _shadersPolylineFS,t3 as _shadersPolylineGlowMaterial,AU as _shadersPolylineMaterialAppearanceVS,n3 as _shadersPolylineOutlineMaterial,_U as _shadersPolylineShadowVolumeFS,gU as _shadersPolylineShadowVolumeMorphFS,yU as _shadersPolylineShadowVolumeMorphVS,bU as _shadersPolylineShadowVolumeVS,ZH as _shadersPolylineVS,K8 as _shadersPrimitiveOutlineStageFS,X8 as _shadersPrimitiveOutlineStageVS,xV as _shadersRGBToHSB,TV as _shadersRGBToHSL,AV as _shadersRGBToXYZ,AX as _shadersReinhardTonemapping,W7 as _shadersReprojectWebMercatorFS,q7 as _shadersReprojectWebMercatorVS,i3 as _shadersRimLightingMaterial,u1 as _shadersSelectedFeatureIdStageCommon,XI as _shadersShadowVolumeAppearanceFS,XV as _shadersShadowVolumeAppearanceVS,qx as _shadersShadowVolumeFS,CX as _shadersSilhouette,Q8 as _shadersSkinningStageVS,AF as _shadersSkyAtmosphereCommon,uK as _shadersSkyAtmosphereFS,fK as _shadersSkyAtmosphereVS,mK as _shadersSkyBoxFS,pK as _shadersSkyBoxVS,o3 as _shadersSlopeRampMaterial,r3 as _shadersStripeMaterial,yK as _shadersSunFS,bK as _shadersSunTextureFS,xK as _shadersSunVS,dB as _shadersTexturedMaterialAppearanceFS,hB as _shadersTexturedMaterialAppearanceVS,uG as _shadersVector3DTileClampedPolylinesFS,lG as _shadersVector3DTileClampedPolylinesVS,cG as _shadersVector3DTilePolylinesVS,cO as _shadersVectorTileVS,tH as _shadersVerticalExaggerationStageVS,SK as _shadersViewportQuadFS,DD as _shadersViewportQuadVS,_q as _shadersVoxelFS,pq as _shadersVoxelUtils,gq as _shadersVoxelVS,a3 as _shadersWater,s3 as _shadersWaterMaskMaterial,qV as _shadersXYZToRGB,fk as _shadersacesTonemapping,dk as _shadersalphaWeight,hk as _shadersantialias,mk as _shadersapplyHSBShift,pk as _shadersapproximateSphericalCoordinates,_k as _shadersapproximateTanh,gk as _shadersbackFacing,yk as _shadersbranchFreeTernary,bk as _shaderscascadeColor,xk as _shaderscascadeDistance,Tk as _shaderscascadeMatrix,Ak as _shaderscascadeWeights,Ck as _shadersclipPolygons,Ek as _shaderscolumbusViewMorph,Sk as _shaderscomputeAtmosphereColor,wk as _shaderscomputeGroundAtmosphereScattering,vk as _shaderscomputePosition,Dk as _shaderscomputeScattering,Eq as _shadersconvertUvToBox,Sq as _shadersconvertUvToCylinder,wq as _shadersconvertUvToEllipsoid,Pk as _shaderscosineAndSine,Ik as _shadersdecompressTextureCoordinates,b3 as _shadersdegreesPerRadian,Ok as _shadersdepthClamp,x3 as _shadersdepthRange,ik as _shadersdepthRangeStruct,Rk as _shaderseastNorthUpToEyeCoordinates,Mk as _shadersellipsoidContainsPoint,Lk as _shadersellipsoidTextureCoordinates,T3 as _shadersepsilon1,A3 as _shadersepsilon2,C3 as _shadersepsilon3,E3 as _shadersepsilon4,S3 as _shadersepsilon5,w3 as _shadersepsilon6,v3 as _shadersepsilon7,Nk as _shadersequalsEpsilon,Fk as _shaderseyeOffset,Bk as _shaderseyeToWindowCoordinates,kk as _shadersfastApproximateAtan,Vk as _shadersfog,Uk as _shadersgammaCorrect,zk as _shadersgeodeticSurfaceNormal,Hk as _shadersgetDefaultMaterial,Gk as _shadersgetDynamicAtmosphereLightDirection,jk as _shadersgetLambertDiffuse,Wk as _shadersgetSpecular,qk as _shadersgetWaterNoise,Kk as _shadershue,D3 as _shadersinfinity,$k as _shadersinverseGamma,Zk as _shadersisEmpty,Jk as _shadersisFull,Qk as _shaderslatitudeToWebMercatorFraction,tV as _shaderslineDistance,eV as _shaderslinearToSrgb,nV as _shadersluminance,ok as _shadersmaterial,rk as _shadersmaterialInput,iV as _shadersmaximumComponent,oV as _shadersmetersPerPixel,sk as _shadersmodelMaterial,rV as _shadersmodelToWindowCoordinates,ak as _shadersmodelVertexOutput,sV as _shadersmultiplyWithColorBalance,aV as _shadersnearFarScalar,cV as _shadersoctDecode,P3 as _shadersoneOverPi,I3 as _shadersoneOverTwoPi,lV as _shaderspackDepth,O3 as _shaderspassCesium3DTile,R3 as _shaderspassCesium3DTileClassification,M3 as _shaderspassCesium3DTileClassificationIgnoreShow,L3 as _shaderspassClassification,N3 as _shaderspassCompute,F3 as _shaderspassEnvironment,B3 as _shaderspassGlobe,k3 as _shaderspassOpaque,V3 as _shaderspassOverlay,U3 as _shaderspassTerrainClassification,z3 as _shaderspassTranslucent,H3 as _shaderspassVoxels,uV as _shaderspbrLighting,fV as _shaderspbrNeutralTonemapping,dV as _shadersphong,G3 as _shaderspi,j3 as _shaderspiOverFour,W3 as _shaderspiOverSix,q3 as _shaderspiOverThree,Y3 as _shaderspiOverTwo,hV as _shadersplaneDistance,mV as _shaderspointAlongRay,X3 as _shadersradiansPerDegree,ck as _shadersray,pV as _shadersrayEllipsoidIntersectionInterval,lk as _shadersraySegment,_V as _shadersraySphereIntersectionInterval,gV as _shadersreadDepth,yV as _shadersreadNonPerspective,bV as _shadersreverseLogDepth,CV as _shadersround,EV as _shaderssaturation,K3 as _shaderssceneMode2D,$3 as _shaderssceneMode3D,Z3 as _shaderssceneModeColumbusView,J3 as _shaderssceneModeMorphing,SV as _shadersshadowDepthCompare,uk as _shadersshadowParameters,wV as _shadersshadowVisibility,vV as _shaderssignNotZero,Q3 as _shaderssolarRadius,DV as _shaderssphericalHarmonics,PV as _shaderssrgbToLinear,IV as _shaderstangentToEyeSpaceMatrix,OV as _shaderstextureCube,ek as _shadersthreePiOver2,RV as _shaderstransformPlane,MV as _shaderstranslateRelativeToEye,LV as _shaderstranslucentPhong,NV as _shaderstranspose,tk as _shaderstwoPi,FV as _shadersunpackClippingExtents,BV as _shadersunpackDepth,kV as _shadersunpackFloat,VV as _shadersunpackUint,UV as _shadersvalueTransform,zV as _shadersvertexLogDepth,nk as _shaderswebMercatorMaxLatitude,HV as _shaderswindowToEyeCoordinates,GV as _shaderswriteDepthClamp,jV as _shaderswriteLogDepth,WV as _shaderswriteNonPerspective,_z as addBuffer,cz as addDefaults,hz as addExtensionsRequired,ph as addExtensionsUsed,sT as addPipelineExtras,Ys as addToArray,r2 as appendForwardSlash,Ao as arrayRemoveDuplicates,CE as barycentricCoordinates,vo as binarySearch,sn as buildModuleUrl,Oq as buildVoxelDrawCommands,qe as clone,At as combine,AC as computeFlyToLocationForRectangle,Ew as createBillboardPointCallback,vn as createCommand,qK as createDefaultImageryProviderViewModels,YK as createDefaultTerrainProviderViewModels,qut as createElevationBandMaterial,Kut as createGooglePhotorealistic3DTileset,Hn as createGuid,Uo as createMaterialPropertyDescriptor,Zut as createOsmBuildingsAsync,fe as createPropertyDescriptor,ku as createRawPropertyDescriptor,Qut as createTangentSpaceDebugPrimitive,TTe as createTaskProcessorWorker,_3 as createUniform,y3 as createUniformArray,sW as createWorldBathymetryAsync,hy as createWorldImageryAsync,sC as createWorldTerrainAsync,cW as decodeGoogleEarthEnterpriseData,hG as decodeVectorPolylinePositions,y as defaultValue,Pu as defer,c as defined,YV as demodernizeShader,Ss as deprecationWarning,de as destroyObject,NQe as exportKml,kS as findAccessorMinMax,Vw as findContentMetadata,Uw as findGroupMetadata,xG as findTileMetadata,PO as forEachTextureInMaterial,Kg as formatError,m3 as freezeRenderState,m_ as getAbsoluteUri,Yu as getAccessorByteStride,a2 as getBaseUri,Kf as getBinaryAccessor,k7 as getClipAndStyleCode,Hb as getClippingFunction,m0 as getComponentReader,On as getElement,sE as getExtensionFromUri,Q0 as getFilenameFromUri,mW as getImageFromTypedArray,xm as getImagePixels,Ho as getJsonFromTypedArray,qm as getMagic,V7 as getMetadataClassProperty,Gu as getStringFromTypedArray,Ei as getTimestamp,si as hasExtension,t0 as heightReferenceOnEntityPropertyChanged,Al as isBitSet,aE as isBlobUri,Sx as isCrossOriginUrl,Oy as isDataUri,bm as isLeapYear,Te as knockout,IP as knockout_3_5_1,IK as knockout_es5,cE as loadAndExecuteScript,rq as loadCubeMap,FS as loadImageFromTypedArray,Mu as loadKTX2,Fb as mergeSort,dz as moveTechniqueRenderStates,mz as moveTechniquesToExtension,Jf as numberOfComponentsForType,lE as objectToQuery,_t as oneTimeWarning,v0 as parseBatchTable,n4 as parseFeatureMetadataLegacy,uz as parseGlb,c2 as parseResponseHeaders,t4 as parseStructuralMetadata,g1 as pickModel,cot as pointInsideTriangle,fg as preprocess3DTileContent,Iq as processVoxelProperties,Bf as queryToObject,gz as readAccessorPacked,VS as removeExtension,lz as removeExtensionsRequired,BS as removeExtensionsUsed,fz as removePipelineExtras,pz as removeUnusedElements,aT as resizeImageToNextPowerOfTwo,BW as sampleTerrain,fC as sampleTerrainMostDetailed,rE as scaleToGeodeticSurface,vD as srgbToLinear,KV as subdivideArray,ac as subscribeAndEvaluate,yz as updateAccessorComponentTypes,Sz as updateVersion,Pr as usesExtension,_Et as viewerCesium3DTilesInspectorMixin,yEt as viewerCesiumInspectorMixin,AEt as viewerDragDropMixin,EEt as viewerPerformanceWatchdogMixin,IEt as viewerVoxelInspectorMixin,Brt as webGLConstantToGlslType,IL as wrapFunction,Sw as writeTextToCanvas};
//# sourceMappingURL=index.js.map
